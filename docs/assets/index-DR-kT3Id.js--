var sne=Object.defineProperty;var lne=(t,e,i)=>e in t?sne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Ve=(t,e,i)=>lne(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const aG="tournament_title_block",oG="tournaments_control",dC="tournaments_table",une="tournament_events",sG="tournament_logo",oN="tournaments",L0="tournament",Ey="splash",cne=[oN,L0,Ey];var dne=Object.defineProperty,bt=(t,e)=>{for(var i in e)dne(t,i,{get:e[i],enumerable:!0})};function _0(){return"2.2.3"}var lG={};bt(lG,{competitionGovernor:()=>uG,drawsGovernor:()=>UT,entriesGovernor:()=>cY,eventGovernor:()=>vY,generationGovernor:()=>OY,matchUpFormatGovernor:()=>HY,matchUpGovernor:()=>zY,mocksGovernor:()=>ix,participantGovernor:()=>_4,policyGovernor:()=>_6,publishingGovernor:()=>s5,queryGovernor:()=>j6,reportGovernor:()=>g5,scheduleGovernor:()=>fx,scoreGovernor:()=>VO,tieFormatGovernor:()=>E5,tournamentGovernor:()=>L5,venueGovernor:()=>J5});var uG={};bt(uG,{getLinkedTournamentIds:()=>Wy,getTournamentIds:()=>Hy,linkTournaments:()=>Qz,mutate:()=>cG,query:()=>tW,unlinkTournament:()=>eW,unlinkTournaments:()=>Zz});var cG={};bt(cG,{linkTournaments:()=>Qz,unlinkTournament:()=>eW,unlinkTournaments:()=>Zz});var Jp="SINGLES",ii="SINGLES",Md="DOUBLES",Zt="DOUBLES",xa="TEAM",fi="TEAM",pne={SINGLES_MATCHUP:Jp,SINGLES:ii,DOUBLES_MATCHUP:Md,DOUBLES:Zt,TEAM_MATCHUP:xa,TEAM:fi},dG={[ii]:[ii,"S"],[Zt]:[Zt,"D"],[fi]:[fi,"T"],S:[ii,"S"],D:[Zt,"D"],T:[fi,"T"]};function sr(t,e){return(t??0)-(e??0)}function et(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function Rs(t){return isNaN(t)?!1:t&&(t&t-1)===0}function yB(t){if(!t.length)return;let e=[...t].sort(sr),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function mne(t){if(!Rs(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function sN(t){return isNaN(t)?0:t%2&&t+1||t}function lN(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function _i(t){return!isNaN(parseFloat(t))}function pG(t){let e=et(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function Pg(t){if(isNaN(t))return!1;for(;!Rs(t);)t++;return t}function ro(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function ot(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function hne(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function fne(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function mG(t,e,i,r,n=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=mG(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),r&&(s=fne(s,r)),parseFloat(s.toFixed(n))}function dS(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function ct(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function gne(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function wn(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function Pf(t){return ot(t)?t:1/0}function Ua(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function vne(t){return hG(Ua(t))}function hG(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function Ine(t,e,i){return i.indexOf(t)===e}function fG(t){return t.filter(Ine)}function ga(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function ma(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Te(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function qs(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function Vi(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function bB(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function Rn(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function yne(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function bne(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function Rr(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function gG(t,[e,...i]){return t.length?[t.slice(0,e),...gG(t.slice(e),[...i,e])]:[]}function wne(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function vG(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function IG(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function pC(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let o=i?!!(Math.floor(a/e)%2):!1,s=a%e,l=o?e-1-s:s;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function Une(t,e=1){if(!Array.isArray(t)||!t.every(ot))return[];let i=Math.min(...t,e),r=Math.max(...t);return Te(i,r+1).filter(n=>!t.includes(n))}function ha(t){return typeof t=="function"}function Di(t){return typeof t=="string"}function Nt(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function Sne(t,e){if(!Nt(t)||!Nt(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function yG(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(Nt).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var Tne=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function mC(t,e){if(t===void 0)return null;if(!Nt(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>mC(a))}:{[n]:e?r(t[n]):mC(t[n])}))}function hC(t){return Array.isArray(t)?t.length+t.map(hC).reduce((e,i)=>e+i,0):Nt(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>hC(t[e])).reduce((e,i)=>e+i,0):0}function Dne(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=hC(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function $0(t,e){return!Array.isArray(t)||!Di(e)?!1:Vi(t,dG[e]).length}var X={success:!0},bG="error",Pne={SUCCESS:X,ERROR:bG};function wG({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:o}=n;if(typeof a!="number"||typeof o!="number"||o>e||o<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==ct(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...X}}var Rne={};bt(Rne,{addNotice:()=>lt,callListener:()=>TC,createInstanceState:()=>lae,cycleMutationStatus:()=>LN,deepCopyEnabled:()=>FN,deleteNotice:()=>_N,deleteNotices:()=>ky,disableNotifications:()=>AH,enableNotifications:()=>CU,getDevContext:()=>La,getMethods:()=>xH,getNotices:()=>FH,getProvider:()=>DC,getTopics:()=>yo,getTournamentId:()=>Xm,getTournamentRecord:()=>$N,getTournamentRecords:()=>Qm,globalLog:()=>$H,handleCaughtError:()=>iT,hasTopic:()=>eT,removeTournamentRecord:()=>_H,setDeepCopy:()=>TI,setDevContext:()=>SI,setGlobalLog:()=>NH,setGlobalMethods:()=>OH,setGlobalSubscriptions:()=>cae,setMethods:()=>kH,setStateMethods:()=>BH,setStateProvider:()=>sae,setSubscriptions:()=>dae,setTournamentId:()=>DI,setTournamentRecord:()=>LH,setTournamentRecords:()=>tT,timeKeeper:()=>uae});var fC={message:"Chronological error; time violation.",code:"ANACHRONISM"},wI={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},UG={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},gC={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Oi={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},ge={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},Cy={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},Rf={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Xp={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},Le={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},SG={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Fa={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},sp={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},uN={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},cN={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},Ef={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},TG={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},DG={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},Ene={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},dN={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},My={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},B0={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},Cne={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},Rg={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},Eg={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},pN={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},V0={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},mN={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},Ny={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},$s={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},PG={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},RG={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},EG={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},CG={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},MG={message:"Invalid action",code:"ERR_INVALID_ACTION"},vC={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},NG={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},AG={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},OG={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},hN={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},kG={message:"Existing round",code:"ERR_EXISTING_ROUND"},Mne={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},Wa={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Ci={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},fN={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},lp={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},xG={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Vl={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},vi={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},co={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},FG={message:"Event exists",code:"ERR_EXISTING_EVENT"},LG={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},_G={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},gN={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},$G={message:"Missing stage",code:"ERR_MISSING_STAGE"},up={message:"Invalid stage",code:"ERR_INVALID_STAGE"},BG={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},VG={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},jG={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},IC={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},Ay={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},RU={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},Cg={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Cl={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},vN={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},IN={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},GG={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},Mg={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},yn={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},Wm={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},pn={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Gu={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},aa={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},oa={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},yN={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},j0={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},Nne={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},HG={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},bN={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},zG={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},wN={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},Ane={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},Qp={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},One={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},UN={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},kne={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},G0={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},xne={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},Fne={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},qm={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Xe={message:"Missing value",code:"ERR_MISSING_VALUE"},WG={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},qG={message:"Missing date",code:"ERR_MISSING_DATE"},YG={message:"No valid dates",code:"ERR_NO_VALID_DATES"},pS={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},EU={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},KG={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Ar={message:"Invalid Date",code:"ERR_INVALID_DATE"},Ao={message:"Invalid time",code:"ERR_INVALID_TIME"},JG={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},yC={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},XG={message:"Invalid score",code:"ERR_INVALID_SCORE"},H0={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},Lne={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},SN={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},QG={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},z0={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},bC={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},W0={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Ym={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Es={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Ia={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},ZG={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Cs={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},eH={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},Km={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},Oy={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},mr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},zi={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},tH={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},_ne={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},iH={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},jc={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},rH={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},nH={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},aH={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},Ng={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},q0={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},TN={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},wC={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},oH={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},$ne={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},Bne={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},sH={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},lH={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},UC={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},uH={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},DN={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},cH={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},PN={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},Cf={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},dH={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},Ag={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},pH={message:"Court exists",code:"ERR_EXISTING_COURT"},mH={message:"Venue exists",code:"ERR_EXISTING_VENUE"},Jm={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Gc={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},hH={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},RN={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},fH={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},gH={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},Vne={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},EN={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},vH={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},CN={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},MN={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},Y0={message:"Missing context",code:"ERR_MISSING_CONTEXT"},IH={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},bm={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},yH={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},Og={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},bH={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},K0={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},wH={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},UH={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Hu={message:"Invalid object",code:"ERR_INVALID_OBJECT"},Yv={message:"Invalid gender",code:"ERR_INVALID_GENDER"},UI={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},se={message:"Invalid values",code:"ERR_INVALID_VALUES"},SH={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},NN={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},TH={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},J0={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},AN={message:"Value unchanged",code:"ABORT_UNCHANGED"},$r={message:"Not found",code:"ERR_NOT_FOUND"},X0={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},DH={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},ON={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},PH={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},RH={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},SC={message:"Existing stage",code:"ERR_EXISTING_STAGE"},kN={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},Q0={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},EH={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},Z0={message:"Scores present",code:"ERR_SCORES_PRESENT"},jne={ANACHRONISM:fC,CANNOT_CHANGE_WINNING_SIDE:W0,CANNOT_MODIFY_TIEFORMAT:SN,CANNOT_MODIFY_PARTICIPANT_TYPE:QG,CANNOT_REMOVE_MAIN_STRUCTURE:UG,CANNOT_REMOVE_PARTICIPANTS:z0,CATEGORY_MISMATCH:bC,COURT_EXISTS:pH,COURT_NOT_FOUND:Ag,DRAW_DEFINITION_NOT_FOUND:Fa,DRAW_ID_EXISTS:PG,DRAW_POSITION_ACTIVE:B0,DRAW_POSITION_ASSIGNED:Ef,DRAW_POSITION_NOT_CLEARED:DG,DRAW_POSITION_NOT_FOUND:Ene,DRAW_SIZE_MISMATCH:mN,DUPLICATE_ENTRY:wI,DUPLICATE_VALUE:SH,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:lH,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:sH,EVENT_EXISTS:FG,EVENT_NOT_FOUND:co,EXISTING_DRAW_DEFINITIONS:SG,EXISTING_END_TIME:RN,EXISTING_FLIGHT:DH,EXISTING_MATCHUP_ID:RH,EXISTING_OUTCOME:PH,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:Ng,EXISTING_PARTICIPANT:q0,EXISTING_POLICY_TYPE:wN,EXISTING_PROFILE:ON,EXISTING_ROUND:kG,EXISTING_STAGE:SC,EXISTING_STRUCTURE:kN,INCOMPATIBLE_MATCHUP_STATUS:RU,INCOMPLETE_SOURCE_STRUCTURE:uN,INSUFFICIENT_DRAW_POSITIONS:DN,INVALID_ACTION:MG,INVALID_ASSIGNMENT:vC,INVALID_BOOKINGS:pS,INVALID_CATEGORY:UI,INVALID_COLLECTION_DEFINITION:UH,INVALID_CONFIGURATION:wH,INVALID_DATE_AVAILABILITY:EU,INVALID_DATE:Ar,INVALID_DRAW_DEFINITION:Xp,INVALID_DRAW_POSITION_FOR_SEEDING:cN,INVALID_DRAW_POSITION:Rg,INVALID_DRAW_SIZE:V0,INVALID_END_TIME:hH,INVALID_ENTRIES:_G,INVALID_EVENT_TYPE:Vl,INVALID_GAME_SCORES:yC,INVALID_GENDER:Yv,INVALID_MATCHUP_FORMAT:vN,INVALID_MATCHUP_STATUS:Cg,INVALID_MATCHUP_STATUS_BYE:jG,INVALID_MATCHUP:oa,INVALID_OBJECT:Hu,INVALID_PARTICIPANT_ID:Es,INVALID_PARTICIPANT_IDS:Ia,INVALID_PARTICIPANT_ROLE:ZG,INVALID_PARTICIPANT_SEEDING:RG,INVALID_PARTICIPANT_TYPE:Cs,INVALID_PARTICIPANT:Ym,INVALID_POLICY_DEFINITION:zG,INVALID_RECORDS:gC,INVALID_SCALE_ITEM:bm,INVALID_SEED_NUMBER:AG,INVALID_SEED_POSITION:OG,INVALID_SET_NUMBER:kne,INVALID_SIDE_NUMBER:UN,INVALID_SCORE:XG,INVALID_STAGE:up,INVALID_START_TIME:gH,INVALID_STRUCTURE:sp,INVALID_STOP_TIME:fH,INVALID_TIE_FORMAT:Cl,INVALID_TIME:Ao,INVALID_TIME_ITEM:EN,INVALID_TOURNAMENT_DATES:JG,INVALID_TOURNAMENT_RECORD:Cy,INVALID_VALUES:se,INVALID_WINNING_SIDE:H0,MATCHUP_NOT_FOUND:pn,METHOD_NOT_FOUND:Q0,MISSING_ASSIGNMENTS:gN,MISSING_ASYNC_STATE_PROVIDER:vH,MISSING_AVOIDANCE_POLICY:HG,MISSING_BIRTH_DATE:WG,MISSING_COLLECTION_DEFINITION:GG,MISSING_COURT_ID:qm,MISSING_COURTS_INFO:dH,MISSING_DATE_AVAILABILITY:KG,MISSING_DATE:qG,MISSING_DRAW_DEFINITION:Le,MISSING_DRAW_ID:$s,MISSING_DRAW_POSITION:Eg,MISSING_DRAW_POSITIONS:My,MISSING_DRAW_SIZE:Ny,MISSING_ENTRIES:LG,MISSING_EVENT:vi,MISSING_MATCHUP_FORMAT:IN,MISSING_MATCHUP_ID:yn,MISSING_MATCHUP_IDS:Wm,MISSING_MATCHUP:aa,MISSING_MATCHUPS:Gu,MISSING_PARTICIPANT_COUNT:rH,MISSING_PARTICIPANT_ID:mr,MISSING_PARTICIPANT_IDS:jc,MISSING_PARTICIPANT_ROLE:eH,MISSING_PARTICIPANT:Km,MISSING_PARTICIPANTS:Oy,MISSING_PENALTY_ID:PN,MISSING_PENALTY_TYPE:cH,MISSING_PERSON_DETAILS:aH,MISSING_POLICY_ATTRIBUTES:bN,MISSING_POLICY_DEFINITION:j0,MISSING_POLICY_TYPE:yN,MISSING_POSITION_ASSIGNMENTS:VG,MISSING_ROUND_NUMBER:Mne,MISSING_SCHEDULE:IH,MISSING_SCORING_POLICY:One,MISSING_SEED_ASSIGNMENTS:NG,MISSING_SEEDCOUNT_THRESHOLDS:CG,MISSING_SEEDING_POLICY:Nne,MISSING_SET_NUMBER:xne,MISSING_SET_OBJECT:G0,MISSING_SIDE_NUMBER:Fne,MISSING_STAGE:$G,MISSING_STRUCTURE_ID:Wa,MISSING_STRUCTURE:lp,MISSING_STRUCTURES:fN,MISSING_TARGET_LINK:hN,MISSING_TIE_FORMAT:Mg,MISSING_TIME_ITEM:CN,MISSING_TIME_ITEMS:MN,MISSING_TOURNAMENT_ID:Rf,MISSING_TOURNAMENT_RECORD:ge,MISSING_TOURNAMENT_RECORDS:Oi,MISSING_VALUE:Xe,MISSING_VENUE_ID:Gc,MODIFICATIONS_FAILED:yH,NO_CANDIDATES:K0,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:uH,NO_MODIFICATIONS_APPLIED:Og,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:UC,NO_PARTICIPANT_REMOVED:iH,NO_VALID_ACTIONS:TH,NO_VALID_ATTRIBUTES:J0,NO_VALID_DATES:YG,NOT_FOUND:$r,NOT_IMPLEMENTED:X0,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:TN,PARTICIPANT_ID_EXISTS:tH,PARTICIPANT_NOT_CHECKED_IN:nH,PARTICIPANT_NOT_FOUND:zi,PARTICIPANT_PAIR_EXISTS:_ne,PENALTY_NOT_FOUND:Cf,POLICY_NOT_ATTACHED:Ane,POLICY_NOT_FOUND:Qp,SCHEDULE_NOT_CLEARED:TG,SCHEDULED_MATCHUPS:EH,SCORES_PRESENT:Z0,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:EG,STAGE_SEQUENCE_LIMIT:BG,STRUCTURE_NOT_FOUND:Ci,TEAM_NOT_FOUND:NN,UNABLE_TO_ASSIGN_COURT:bH,UNLINKED_STRUCTURES:xG,UNRECOGNIZED_DRAW_TYPE:dN,UNRECOGNIZED_MATCHUP_FORMAT:Ay,UNRECOGNIZED_MATCHUP_STATUS:IC,VALUE_UNCHANGED:AN,VENUE_EXISTS:mH},Ri={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},CH={addNotice:eae,callListener:aae,cycleMutationStatus:Zne,deleteNotice:rae,deleteNotices:iae,disableNotifications:Gne,enableNotifications:Hne,getMethods:xN,getNotices:tae,getTopics:nae,getTournamentId:MH,getTournamentRecord:zne,getTournamentRecords:Wne,removeTournamentRecord:Jne,setMethods:Qne,setSubscriptions:Xne,setTournamentId:Yne,setTournamentRecord:qne,setTournamentRecords:Kne,handleCaughtError:oae};function Gne(){Ri.disableNotifications=!0}function Hne(){Ri.disableNotifications=!1}function MH(){return Ri.tournamentId}function zne(t){return Ri.tournamentRecords[t]}function Wne(){return Ri.tournamentRecords}function qne(t){let e=t==null?void 0:t.tournamentId;return e?(Ri.tournamentRecords[e]=t,{success:!0}):{error:Cy}}function Yne(t){return t?Ri.tournamentRecords[t]?(Ri.tournamentId=t,{success:!0}):{error:ge}:(Ri.tournamentId=void 0,{success:!0})}function Kne(t){Ri.tournamentRecords=t;let e=Object.keys(t);e.length===1?Ri.tournamentId=e[0]:e.length||(Ri.tournamentId=void 0)}function Jne(t){if(typeof t!="string")return{error:se};if(!Ri.tournamentRecords[t])return{error:$r};delete Ri.tournamentRecords[t];let e=Object.keys(Ri.tournamentRecords);return e.length===1?Ri.tournamentId=e[0]:e.length||(Ri.tournamentId=void 0),{success:!0}}function Xne(t){return typeof t.subscriptions!="object"?{error:se}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?Ri.subscriptions[e]=t.subscriptions[e]:delete Ri.subscriptions[e]}),{...X})}function Qne(t){return typeof t!="object"?{error:se}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(Ri.methods[e]=t[e])}),{...X})}function Zne(){let t=Ri.modified;return Ri.modified=!1,t}function eae({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(Ri.disableNotifications||(Ri.modified=!0),!(Ri.disableNotifications||!Ri.subscriptions[t]&&!r)))return i&&(Ri.notices=Ri.notices.filter(n=>!(n.topic===t&&n.key===i))),Ri.notices.push({topic:t,payload:e,key:i}),{...X}}function xN(){return Ri.methods??{}}function tae({topic:t}){return Ri.notices.filter(e=>e.topic===t).map(e=>e.payload)}function iae(){Ri.notices=[]}function rae({topic:t,key:e}){Ri.notices=Ri.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function nae(){return{topics:Object.keys(Ri.subscriptions)}}function aae({topic:t,notices:e},i){let r=Ri.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i==null?void 0:i[t];n&&typeof n=="function"&&n(e)}function oae({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:MH(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var ni={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Br=CH,wB=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function sae(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Vi(Object.keys(t),wB).length!==wB.length)throw new Error("Global state provider is missing required methods");return Br=t,{success:!0}}function lae(){if(Br.createInstanceState){try{Br.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:vH}}function La(t){return!t||typeof t!="object"?ni.devContext??!1:typeof ni.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=ni.devContext)==null?void 0:i[e])===t[e]})&&ni.devContext}function uae(t="reset",e="default"){var r,n;let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(ni.timers).filter(a=>a!=="default"||ni.timers[a].startTime).map(a=>{let o=ni.timers[a],s=o.state==="stopped"?0:(i-((o==null?void 0:o.startTime)??0))/1e3,l=o.elapsedTime+s;return{state:ni.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=ni.timers[e].state==="stopped"?0:(i-(((r=ni.timers[e])==null?void 0:r.startTime)??0))/1e3,o=ni.timers[e].elapsedTime+a;return{state:ni.timers[e].state,elapsedTime:o.toFixed(2),timer:e}}}if(!ni.timers[e]||t==="reset"){if(e==="allTimers")return ni.timers={default:{elapsedTime:0}},!0;ni.timers[e]={startTime:i,state:"active",elapsedTime:0}}return ni.timers[e].elapsedTime||(ni.timers[e].elapsedTime=0),t==="stop"&&ni.timers[e].state!=="stopped"&&(ni.timers[e].state="stopped")&&(ni.timers[e].elapsedTime+=(i-(((n=ni.timers[e])==null?void 0:n.startTime)??0))/1e3),t==="start"&&(ni.timers[e].startTime=i)&&(ni.timers[e].state="active"),ni.timers[e]}function NH(t){ha(t)?ni.globalLog=t:delete ni.globalLog}function SI(t){ni.devContext=t}function AH(){Br.disableNotifications()}function CU(){Br.enableNotifications()}function TI(t,e){typeof t=="boolean"&&(ni.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(ni.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(ni.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(ni.deepCopyAttributes.stringify=e.stringify),e.threshold&&(ni.deepCopyAttributes.threshold=e.threshold))}function FN(){return{enabled:ni.deepCopy,...ni.deepCopyAttributes}}function cae(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{ni.globalSubscriptions[e]=t.subscriptions[e]}),{...X}):{error:Xe,info:"missing subscriptions"}}function dae(t){return t!=null&&t.subscriptions?Br.setSubscriptions({subscriptions:t.subscriptions}):{error:Xe,info:"missing subscriptions"}}function OH(t){return t?typeof t!="object"?{error:se}:(Object.keys(t).forEach(e=>{ha(t[e])&&(ni.globalMethods[e]=t[e])}),{...X}):{error:Xe,info:"missing method declarations"}}function kH(t){return t?typeof t!="object"?{error:se}:Br.setMethods(t):{error:Xe,info:"missing method declarations"}}function LN(){return Br.cycleMutationStatus()}function lt(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=ni.globalSubscriptions[t.topic];return Br.addNotice(t,e)}function xH(){return{...ni.globalMethods,...Br.getMethods()}}function FH(t){return Br.getNotices(t)}function _N({key:t,topic:e}){return Br.deleteNotice({key:t,topic:e})}function ky(){return Br.deleteNotices()}function yo(){return Br.getTopics()}function eT(t){var e,i;return(i=(e=yo())==null?void 0:e.topics)==null?void 0:i.includes(t)}async function TC(t){return Br.callListener(t,ni.globalSubscriptions)}function Xm(){return Br.getTournamentId()}function $N(t){return Br.getTournamentRecord(t)}function Qm(){return Br.getTournamentRecords()}function LH(t){return Br.setTournamentRecord(t)}function tT(t){return Br.setTournamentRecords(t)}function DI(t){return Br.setTournamentId(t)}function _H(t){return Br.removeTournamentRecord(t)}function DC(){return Br}function iT({engineName:t,methodName:e,params:i,err:r}){let n=ha(Br.handleCaughtError)&&Br.handleCaughtError||CH.handleCaughtError,{tournamentRecord:a,...o}=i;return n({params:o,engineName:t,methodName:e,err:r})}function $H(t,e){if(ni.globalLog)try{ni.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),NH()}else console.log(e,t)}function BH(t,e,i,r){if(!Nt(t))return{error:se};_i||(i=1);let n=Array.isArray(e)?e:[],a={},o=(s,l=0)=>{Object.keys(s).forEach(u=>{ha(s[u])?a[u]=s[u]:Nt(s[u])&&(e===!0||n!=null&&n.includes(u))&&(i===void 0||l<i)&&o(s[u],l+1)})};return o(t),r?OH(a):kH(a),{methods:a}}function pae(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function je(t,e,i,r){var o;if(typeof t!="object"||t===null)return t;(o=FN())!=null&&o.enabled||(r=!0);let n=["",void 0,null];e&&n.push(!1);let a=pae(t,n,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(l=>je(l))}:{[s]:r?t[s]:je(t[s])}))}function ee({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,je(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...X}),e??{success:!0}}var Ms="ANY",Xt="MALE",Bn="MIXED",Ud="OTHER",mi="FEMALE",rT={ANY:Ms,MALE:Xt,FEMALE:mi,MIXED:Bn,OTHER:Ud},mae="MIXED events can not contain mixed singles or { gender: ANY } collections",hae="events with { gender: ANY } can not contain MIXED singles collections";function nT(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&[Xt,mi].includes(i)&&i!==n?ee({result:{valid:!1,error:Yv},context:{gender:n},stack:e}):i===Bn&&(n===Ms||n===Bn&&r!==Zt)?ee({result:{error:Yv,valid:!1},info:mae,stack:e}):i===Ms&&n===Bn&&r!==Zt?ee({result:{error:Yv,valid:!1},info:hae,stack:e}):{valid:!0}}var fae="normal",UB="timed",gae="final",BN="NOAD",MU="SET",vae={S:fae,F:gae};function aT(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&(t!=null&&t.setFormat))return Iae(t,e)}function PI(t){return!isNaN(Number(t))&&Number(t)}function VH(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function Iae(t,e){var c;let i=PI(t.bestOf)||void 0,r=PI(t.exactly)||void 0,n=i||r;if((c=t.setFormat)!=null&&c.timed&&t.simplified&&n===1)return VH(t.setFormat);let a=n&&`${MU}${n}`||"",o=SB(t.setFormat,e),s=o&&`S:${o}`||"",l=SB(t.finalSetFormat,e),u=n&&n>1&&l&&o!==l&&`F:${l}`||"";if(a&&o)return[a,s,u].filter(d=>d).join("-")}function SB(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return VH(t);if(t.tiebreakSet)return TB(t.tiebreakSet);let i=PI(t.setTo);if(i){let r=t.NoAD&&BN||"",n=TB(t.tiebreakFormat),a=n&&`/${n}`||"",o=PI(t.tiebreakAt),s=o&&(o!==i||e)&&`@${o}`||"";if(n!==!1)return`${i}${r}${a}${s}`}}}function TB(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&PI(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?BN:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function kn(t){if(Di(t)){let e=t.startsWith("T")&&UB||t.startsWith(MU)&&MU||"";if(e===UB){let i=GH(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e===MU)return yae(t)}}function yae(t){let e=t.split("-"),i=xy(e[0].slice(3)),r=i===1||i%2!==0?i:void 0,n=i!==1&&i%2===0?i:void 0,a=e&&DB(e[1]),o=e&&DB(e[2]),s=a&&a.timed||o&&o.timed,l=r&&r<6||s&&n,u=!e[2]||o,c=a,d=je({setFormat:a,exactly:n,bestOf:r});if(o&&(d.finalSetFormat=o),l&&c&&u)return d}function DB(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=vae[e[0]],r=e[1];if(i&&r){if(r.startsWith("TB")){let h=PB(r);return h===!1?!1:typeof h=="object"?{tiebreakSet:h}:void 0}if(r.startsWith("T"))return GH(r);let n=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=n&&HH(n[2])||!1,o=!(n!=null&&n[2])||a,s=n?xy(n[1]):void 0,l=jH(r),u=l!==!1,c=u&&l||s,d=PB(r.split("/")[1]),p=d!==!1,m={setTo:s};return a&&(m.NoAD=!0),d?(m.tiebreakFormat=d,m.tiebreakAt=c):m.noTiebreak=!0,s&&o&&p&&u&&m||!1}}}function jH(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?xy(i[1]):i[1])||!1}function PB(t){if(t)if(t.startsWith("TB")){let e=jH(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),r=i==null?void 0:i[1],n=i&&HH(i[2]),a=!(i!=null&&i[2])||n,o=xy(r);if(o&&a){let s={tiebreakTo:o};return e&&typeof e=="string"&&!ot(e)&&(s.modifier=e),n&&(s.NoAD=!0),s}else return!1}else return!1}function GH(t){var s;let e=t.slice(1),i=e.match(/^(\d+)(@?[A-Za-z]*)/),r=xy(i==null?void 0:i[1]);if(!r)return;let n={timed:!0,minutes:r},a=i==null?void 0:i[2],o=[void 0,"P","G"].includes(a);if(a&&!o){let l=(s=e.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:s[3];return l?(n.modifier=l,n):void 0}return a&&(n.based=i[2]),n}function HH(t){return t&&t.indexOf(BN)>=0}function xy(t){return isNaN(Number(t))?0:Number(t)}function Sa({matchUpFormat:t}){if(!Di(t)||t==="")return!1;let e=kn(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),r=i==null?void 0:i[1],n=i==null?void 0:i[2],a=i==null?void 0:i[3],o=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o==null?void 0:o[1],l=o==null?void 0:o[2],u=o==null?void 0:o[3];return aT(e,!!(i&&n&&r===a||o&&l&&s===u))===t}var mS=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,zH=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,il=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Sd=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function hS(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=mt(t.scheduledTime)),!e)return;let i=wi(t.scheduledTime),r=mt(e);return r&&i&&(r+=`T${i}`),r}function bae(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function kg(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Sd.test(Zm(t,!0,!0)))}function ya(t){return Nd(t)||mS.test(t)}function wae(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return Uae(i,{displaySeconds:!1})}function Uae(t,e){let i=parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e!=null&&e.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(oo).join(":")}var VN=t=>{let e=RI(t)||Nd(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${oo(r)}-${oo(e.getUTCDate())}`};function Sae(t){let e=RI(t)||Nd(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Vo(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),o=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,o].join(e):i==="MDY"?[n,a,o].join(e):i==="YDM"?[o,a,n].join(e):i==="DYM"?[a,o,n].join(e):i==="MYD"?[n,o,a].join(e):[o,n,a].join(e)}function fS(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function Tae(t){return fS(t).getTime()}function RI(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function Mf(t,e){if(!ya(t)||!ya(e))return[];let i=mt(t)+"T00:00",r=mt(e)+"T00:00",n=new Date(i),a=new Date(r),o=RI(a)&&RI(n)&&u(n,a),s=[],l=0;if(o){let c=n,d=c.getTime();for(;d<=a.getTime()&&l<300;)l+=1,s.push(new Date(c)),d=c.setDate(c.getDate()+1)}return s.map(c=>Vo(c));function u(c,d){return c<=d}}var Dae=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Nd(t){return typeof t!="string"?!1:Dae.test(t)}function jN(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!isNaN(parseInt(r)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function Ot(t){let e=wi(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>parseInt(n));return i*60+r}function Pae(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[oo(e),oo(i)].join(":")}function gS(t){return jN(t)?t.split(":").slice(0,2).map(oo).join(":"):void 0}function wi(t){return Nd(t)&&t.indexOf("T")>0?gS(t.split("T").reverse()[0]):gS(t)}function mt(t){return Nd(t)||il.test(t)?t.split("T")[0]:void 0}function zv(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),mt(i.toISOString())}function vS(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function Rae(t){let e=vS(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(oo).join(":")}function Eae(t){var i;let e=vS(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),((i=e.hours)==null?void 0:i[0])==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function Zm(t,e,i){let r=mt(t),n=wi(t),a=r?n:t;return t?e&&(r&&i&&t||Rae(a))||Eae(a):void 0}function WH(t,e){let i=vS(t),r=vS(e);if(parseInt(i.hours)<parseInt(r.hours))return-1;if(parseInt(i.hours)>parseInt(r.hours))return 1;if(i.hours===r.hours){if(parseInt(i.minutes)<parseInt(r.minutes))return-1;if(parseInt(i.minutes)>parseInt(r.minutes))return 1}return 0}function GN(t,e=7){let i=mt(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return Vo(n)}function Cae(t){return GN(t)}function Mae(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),Vo(n,i)}function Nae(t,e,i){let r=new Date(t,0);return Vo(new Date(r.setDate(e)),i)}function rr(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(oo),n=fS(e).setHours(i,r,0,0);return fS(n)}function Fy(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function ra(t,e){let i=wi(t);if(!i)return"00:00";let r=isNaN(e)?0:e;return wi(HN(rr(i),r).toISOString())}function HN(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function oo(t){return t.toString()[1]?t:"0"+t}function jl(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var qH={addDays:GN,addWeek:Cae,addMinutesToTimeString:ra,convertTime:Zm,getIsoDateString:hS,getUTCdateString:VN,DateHHMM:wae,extractDate:mt,extractTime:wi,formatDate:Vo,getDateByWeek:Mae,isISODateString:Nd,isDate:RI,isTimeString:jN,offsetDate:fS,offsetTime:Tae,sameDay:jl,timeStringMinutes:Ot,timeToDate:rr,timeUTC:Sae,validTimeValue:kg,validDateString:mS,timeValidation:Sd,dateValidation:il},Aae=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),Oae=t=>t.filter(Boolean).every(_i);function wm(t){let e=t.category;if(typeof e!="object")return{error:UI};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o}=e,s=e.categoryName,l;if(!Aae([i,r,n,s],"string")||!Oae([a,o]))return{error:UI};let u=t.consideredDate??mt(new Date().toLocaleDateString("sv"));if(!ya(u))return{error:Ar};let[c]=u.split("-").slice(0,3).map(x=>parseInt(x)),d=zv(u,-1),[p,m]=d.split("-").slice(1,3).map(x=>parseInt(x)),h=`${oo(p)}-${oo(m)}`,f=zv(u,1),[g,v]=f.split("-").slice(1,3).map(x=>parseInt(x)),y=`${oo(g)}-${oo(v)}`,I=o&&zv(u,-1*365*o),b=a&&zv(u,-1*365*a),S=[],w=x=>!S.includes(x)&&S.push(x);i=i??s;let U=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,D=i==null?void 0:i.includes("-"),P=D&&(i==null?void 0:i.match(T)),E=i==null?void 0:i.match(U),R=(x,F)=>`${x}-${F}`,N=x=>{let F=c-x,$=R(F,y);e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x-1&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=x-1)},A=x=>{let F=c-x-1,$=R(F,y);e.ageMin&&e.ageMin>x&&w(`Invalid submitted ageMin: ${o}`),e.ageMax&&e.ageMax>x&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=x)},M=x=>{let F=c-x,$=R(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x+1&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=x+1)},C=x=>{let F=c-x-1,$=R(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=x)},O=x=>{let[F,$,_]=(x.match(U)||[]).slice(1),L=parseInt($);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(L)):F==="O"&&M(L),_==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),A(L)):_==="O"&&C(L),r=r??I,n=n??b};if(P){if(r=void 0,n=void 0,a=void 0,o=void 0,e.ageMin){let $=c-e.ageMin;r=R($,h)}if(e.ageMax){let $=c-e.ageMax-1;n=R($,y)}let[x,F]=((i==null?void 0:i.match(T))??[]).slice(1).map($=>parseInt($));x<=F?(o=x,a=F,l=!0):w(`Invalid combined age range ${i}`)}else D?i==null||i.split("-").forEach(O):E?O(i):(o&&M(o),a&&A(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),o=void 0);let k=je({consideredDate:u,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o});return S.length&&(k.errors=S),k}function EI({category:t}){if(!Nt(t))return{error:se};let e=wm({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!_i(i)?ee({result:{error:se},context:{ratingMax:i}}):r&&!_i(r)?ee({result:{error:se},context:{ratingMin:r}}):{...e}}function Ly({childCategory:t,withDetails:e,category:i}){let r=EI({category:i}),n=EI({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),o=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),s=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),u=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=je({invalidRatingRange:u,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:o,invalidAgeMin:a,valid:!u&&!s&&!l&&!c&&!o&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function _y({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:o}){a=a??(o==null?void 0:o.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),ee({result:{errors:l,error:Hu},stack:s});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:m,matchUpFormat:h,matchUpValue:f,matchUpType:g,scoreValue:v,setValue:y,category:I,gender:b}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof m!="number"&&l.push(`matchUpCount is not type number: ${m}`),g&&!$0([ii,Zt],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(u!=null&&u.length)].concat([f,d,v,y].map(ot)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),f&&typeof f!="number"&&l.push(`matchUpValue is not type number: ${f}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&m){let S=wG({collectionValueProfiles:u,matchUpCount:m});S.errors&&l.push(...S.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),h&&!Sa({matchUpFormat:h})&&l.push(`Invalid matchUpFormat: ${h}`),r){let S=nT({referenceGender:a,matchUpType:g,gender:b});if(S.error)return ee({context:{referenceGender:a,gender:b},result:S,stack:s})}if(t&&n&&I){let S=Ly({category:n,childCategory:I});if(!S.valid)return ee({result:{error:UI},context:S,stack:s})}return l.length?ee({result:{errors:l,error:UH},stack:s}):{valid:!0}}function Hn(t){var g,v,y,I;let e=!!((t==null?void 0:t.enforceCategory)!==!1&&(t!=null&&t.category)),i=!!((t==null?void 0:t.enforceGender)!==!1&&(t!=null&&t.gender)),r=t==null?void 0:t.checkCollectionIds,n=t==null?void 0:t.tieFormat,a=t==null?void 0:t.event,o="validateTieFormat",s=[],l=kae({...t,stack:o});if(l!=null&&l.error)return l;let u,c=n.collectionDefinitions.every(b=>{let{setValue:S,scoreValue:w,collectionValue:U}=b;(S||w)&&!U&&(u=!0);let{valid:T,errors:D}=_y({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:b,checkCollectionIds:r,checkCategory:e,checkGender:i,event:a});return T?!0:(Array.isArray(D)&&s.push(...D),!1)}),d=typeof((g=n.winCriteria)==null?void 0:g.valueGoal)=="number"&&((v=n.winCriteria)==null?void 0:v.valueGoal)>0&&!u||((y=n.winCriteria)==null?void 0:y.aggregateValue);if(!(d||(I=n.winCriteria)!=null&&I.aggregateValue))return u?s.push("aggregateValue is required"):s.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),ee({context:{tieFormat:n,errors:s,aggregateValueImperative:u},result:{error:Cl},stack:o});let p=n.collectionDefinitions.map(({collectionId:b})=>b),m=!r||p.length===ct(p).length,h=c&&d&&m;return h?{valid:h,errors:s}:ee({result:{error:Cl},context:{tieFormat:n,errors:s},stack:o})}function kae(t){let{tieFormat:e,stack:i}=t;return!t||!e||!Nt(e)?ee({result:{error:Cl},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):Nt(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...X}:ee({result:{error:Cl},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):ee({result:{error:Cl},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var Nf="resourceSubType",Af="resourceType",Of="identifier",xae={RESOURCE_SUB_TYPE:Nf,RESOURCE_TYPE:Af,IDENTIFIER:Of};function Ce(t,e,i,r,n=0){if(DC().makeDeepCopy)return DC().makeDeepCopy(t,e,i,r);let a=FN(),{stringify:o,toJSON:s,ignore:l,modulate:u}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||ha(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&n>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(m=>!i||!l||Array.isArray(l)&&!l.includes(m)||ha(l)&&!l(m)),p=(m,h)=>{c[m]=ha(h==null?void 0:h.toString)?h.toString():JSON.stringify(h)};for(let m of d){let h=t[m],f=ha(u)?u(h):void 0;if(f!==void 0)c[m]=f;else if(e&&m==="extensions"&&Array.isArray(h)){let g=zN(h);Object.assign(c,...g)}else r&&m==="extensions"?c[m]=[]:Array.isArray(o)&&o.includes(m)?p(m,h):Array.isArray(s)&&s.includes(m)&&ha(h==null?void 0:h.toJSON)?c[m]=h.toJSON():h===null?c[m]=void 0:bae(h)?c[m]=new Date(h).toISOString():c[m]=Ce(h,e,i,r,n+1)}return c}function zN(t){return t==null?void 0:t.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function YH(t=1,e){return Te(0,t).map(()=>Gt(e))}function Gt(t){let e=[];for(let s=0;s<256;s++)e[s]=(s<16?"0":"")+s.toString(16);let i=Math.random()*4294967295|0,r=Math.random()*4294967295|0,n=Math.random()*4294967295|0,a=Math.random()*4294967295|0,o=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${o.replace(/-/g,"")}`:o}var KH={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},JH={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},XH={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},QH={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},ZH={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},ez={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},tz={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},iz={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},rz={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},nz={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},fu="SET3-S:6/TB7",Fae="SET3-S:6/TB7-F:TB10",az={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},oz={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},sz={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},lz={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},uz={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},cz={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},dz={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},IS="COLLEGE_DEFAULT",PC="COLLEGE_JUCO",RC="COLLEGE_D3",pz="DOMINANT_DUO",mz="DOMINANT_DUO_MIXED",hz="LAVER_CUP",fz="TEAM_DOUBLES_3_AGGREGATION",gz="TIME_TENNIS_DUAL",vz="TIME_TENNIS_PRO_CIRCUIT",Iz="USTA_BREWER_CUP",yz="USTA_OZAKI_CUP",bz="USTA_COLLEGE",wz="USTA_GOLD_TEAM_CHALLENGE",Uz="USTA_LEVEL_1",Sz="USTA_INTERSECTIONAL",Tz="USTA_SECTION_BATTLE",Dz="USTA_SOUTHERN_LEVEL_5",Pz="USTA_TOC",Rz="USTA_WTT_ITT",Ez="USTA_ZONAL",Lae={COLLEGE_D3:RC,COLLEGE_DEFAULT:IS,COLLEGE_JUCO:PC,DOMINANT_DUO:pz,DOMINANT_DUO_MIXED:mz,LAVER_CUP:hz,TEAM_DOUBLES_3_AGGREGATION:fz,TIME_TENNIS_DUAL:gz,TIME_TENNIS_PRO_CIRCUIT:vz,USTA_BREWER_CUP:Iz,USTA_OZAKI_CUP:yz,USTA_COLLEGE:bz,USTA_GOLD_TEAM_CHALLENGE:wz,USTA_INTERSECTIONAL:Sz,USTA_LEVEL_1:Uz,USTA_SECTION_BATTLE:Tz,USTA_SOUTHERN_LEVEL_5:Dz,USTA_TOC:Pz,USTA_WTT_ITT:Rz,USTA_ZONAL:Ez},Cz="STANDARD",RB={[Cz]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[RC]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:fu,matchUpCount:6,matchUpValue:1},tieFormatName:RC,valueGoal:5},[IS]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:fu,matchUpCount:6,matchUpValue:1},tieFormatName:IS,valueGoal:4},[PC]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:fu,matchUpCount:6,matchUpValue:1},tieFormatName:PC,valueGoal:5},[hz]:cz,[pz]:az,[mz]:tz,[fz]:JH,[gz]:iz,[vz]:ez,[Iz]:rz,[yz]:nz,[bz]:oz,[wz]:KH,[Sz]:ZH,[Uz]:sz,[Tz]:QH,[Dz]:XH,[Rz]:lz,[Pz]:dz,[Ez]:uz},_ae=t=>{let e=t!=null&&t.namedFormat&&Object.keys(RB).includes(t.namedFormat)?t.namedFormat:Cz,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],r,{category:n,gender:a}=(t==null?void 0:t.event)??{},o=Ce(RB[e],!1,!0),s=l=>{var c,d;if(!(t!=null&&t.isMock)&&!((c=t==null?void 0:t.event)!=null&&c.isMock)||!t.event)return(i==null?void 0:i.pop())??Gt();let u=(d=t==null?void 0:t.event)==null?void 0:d.eventId;return i.pop()??`${u}-COL-${l+1}`};return o.hydrate?(r={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:Fae,collectionName:"Doubles",matchUpType:Zt,...o.doubles},{collectionId:s(1),matchUpFormat:fu,collectionName:"Singles",matchUpType:ii,...o.singles}]},o.tieFormatName&&(r.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((l,u)=>l.collectionId=s(u)),r=o),t!=null&&t.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},wu=_ae,rl="SINGLES",Um="SINGLES",po="DOUBLES",Uu="DOUBLES",lr="TEAM",Ta="TEAM",$ae="AGE",Bae="RATING",Vae="BOTH",Mz={AGE:$ae,BOTH:Vae,DOUBLES:po,DOUBLES_EVENT:Uu,RATING:Bae,SINGLES:rl,SINGLES_EVENT:Um,TEAM_EVENT:Ta,TEAM:lr},Oe="MAIN",Ke="QUALIFYING",rn="CONSOLATION",Or="VOLUNTARY_CONSOLATION",$i="PLAY_OFF",oT=[Oe,Ke,rn,$i,Or],Sm={[Ke]:1,[Oe]:2,[$i]:3,[rn]:3,[Or]:4},Nz="finishingPositions",Az="aggregateEventStructures",Oz={[Oe]:1,[$i]:2,[rn]:3,[Ke]:4,[Or]:5},jae={[$i]:1,[Oe]:2,[rn]:3,[Ke]:4,[Or]:5},WN="CLUSTER",Gae="SEPARATE",Ad="WATERFALL",sT="ITEM",xn="CONTAINER",xo="DRAW",lT="RANDOM",_o="TOP_DOWN",Od="BOTTOM_UP",Su="POSITION",Tu="WINNER",Gl="LOSER",nl="FIRST_MATCHUP",_a="AD_HOC",Hae="AD_HOC",xg="FEED_IN",kf="COMPASS",xf="OLYMPIC",zae="SINGLE_ELIMINATION",Ys="SINGLE_ELIMINATION",$y="DOUBLE_ELIMINATION",Ff="FIRST_MATCH_LOSER_CONSOLATION",By="FIRST_ROUND_LOSER_CONSOLATION",cp="LUCKY_DRAW",uT="CURTIS_CONSOLATION",Wae="CURTIS_CONSOLATION",qN="FEED_IN_CHAMPIONSHIP_TO_SF",CI="FEED_IN_CHAMPIONSHIP_TO_SF",YN="FEED_IN_CHAMPIONSHIP_TO_QF",MI="FEED_IN_CHAMPIONSHIP_TO_QF",KN="FEED_IN_CHAMPIONSHIP_TO_R16",NI="FEED_IN_CHAMPIONSHIP_TO_R16",kz="MODIFIED_FEED_IN_CHAMPIONSHIP",AI="MODIFIED_FEED_IN_CHAMPIONSHIP",Vy="FEED_IN_CHAMPIONSHIP",qae="DOUBLE_ROUND_ROBIN",es="ROUND_ROBIN",Hl="ROUND_ROBIN_WITH_PLAYOFF",xz="DECIDER",Fz="BACKDRAW",JN={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},XN={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},kd="WIN_RATIO",eh="ROUND_OUTCOME",Lz=[kf,uT,MI,NI,CI,Vy,YN,KN,qN,Ff,By,cp,AI,xf,$i,Hl],Yae=[_a,kf,uT,$y,MI,NI,CI,Vy,xg,Ff,By,cp,AI,xf,$i,es,Hl,Ys],cT={MAIN:Oe,QUALIFYING:Ke,CONSOLATION:rn,ITEM:sT,CONTAINER:xn,FIRST_MATCHUP:nl,WINNER:Tu,LOSER:Gl,AD_HOC:_a,FEED_IN:xg,FLEX_ROUNDS:Hae,COMPASS:kf,PLAY_OFF:$i,OLYMPIC:xf,KNOCKOUT:zae,SINGLE_ELIMINATION:Ys,DOUBLE_ELIMINATION:$y,CURTIS:uT,FICSF:qN,FICQF:YN,FICR16:KN,MFIC:kz,VOLUNTARY_CONSOLATION:Or,FIRST_MATCH_LOSER_CONSOLATION:Ff,FIRST_ROUND_LOSER_CONSOLATION:By,MODIFIED_FEED_IN_CHAMPIONSHIP:AI,FEED_IN_CHAMPIONSHIP_TO_R16:NI,FEED_IN_CHAMPIONSHIP_TO_QF:MI,FEED_IN_CHAMPIONSHIP_TO_SF:CI,FEED_IN_CHAMPIONSHIP:Vy,LUCKY_DRAW:cp,ROUND_ROBIN_WITH_PLAYOFF:Hl,ROUND_ROBIN:es,DECIDER:xz,BACKDRAW:Fz,COMPASS_ATTRIBUTES:JN,OLYMPIC_ATTRIBUTES:XN,DRAW:xo,RANDOM:lT,TOP_DOWN:_o,BOTTOM_UP:Od,WATERFALL:Ad,WIN_RATIO:kd,ROUND_OUTCOME:eh,MULTI_STRUCTURE_DRAWS:Lz,generatedDrawTypes:Yae,stageOrder:Sm,finishOrder:Oz,AGGREGATE_EVENT_STRUCTURES:Az,FINISHING_POSITIONS:Nz},Kae=cT,mn="tournamentRecords",QN="policyDefinitions",wr="tournamentRecord",ZN="onlineResource",Fn="drawDefinition",_z="tieFormatName",eA="matchUpFormat",zl="participantId",$z="scheduleDates",Jae="tournamentId",Xae="scheduleDate",Qae="roundNumber",dT="structureId",tA="participant",jy="matchUpIds",Bz="entryStage",Zae="policyType",Vz="structures",iA="eventType",Il="matchUpId",pT="tieFormat",mT="inContext",hT="structure",fT="courtIds",eoe="personId",gT="venueIds",rA="matchUps",jz="courtId",Gz="eventId",eu="matchUp",Hz="drawId",jo="error",Hc="event",Fg="param",nA="uuids",toe="averageMatchUpMinutes",ioe="recoveryMinutes",roe="periodLength",noe="number",ta="object",cn="array",Kr="_validate",zz="_message",$a="_invalid",Jn="_ofType",aA="_anyOf",Lf="_oneOf",EB={[ZN]:t=>Vi(Object.keys(t),[Nf,Af,Of]).length===3,[_z]:t=>t&&wu({namedFormat:t}),[nA]:t=>!t||Array.isArray(t)&&t.every(Di),[pT]:t=>!Hn({tieFormat:t}).error,[iA]:t=>[rl,po,lr].includes(t),[Bz]:t=>oT.includes(t)},aoe={[mn]:Oi,[wr]:ge,[QN]:j0,[Fn]:Le,[zl]:mr,[eA]:IN,[Jae]:Rf,[dT]:Wa,[jy]:Wm,[tA]:Km,[ZN]:Hu,[iA]:Vl,[Vz]:fN,[Il]:yn,[pT]:Cl,[hT]:lp,[jz]:qm,[rA]:Gu,[Gz]:co,[eu]:aa,[fT]:Xe,[gT]:Xe,[Hz]:$s,[Hc]:vi},ooe={[mn]:ta,[QN]:ta,[wr]:ta,[Fn]:ta,[ZN]:ta,[$z]:cn,[tA]:ta,[jy]:cn,[Vz]:cn,[pT]:ta,[hT]:ta,[fT]:cn,[gT]:cn,[rA]:cn,[eu]:ta,[Hc]:ta,[nA]:cn};function ze(t,e,i){if(!t&&!Nt(t))return{error:se};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:se};let{paramError:r,errorParam:n}=uoe(t,e);if(!r)return{valid:!0};let a=r[Kr]&&(r[jo]||r[$a])||(t==null?void 0:t[n])===void 0&&(r[jo]||r[$a]||aoe[n]||se)||se,o=n??(r[Lf]&&Object.keys(r[Lf]).join(", "));return ee({info:{param:o,message:r[zz]},result:{error:a},stack:i})}function Wz(t,e){let i=Object.keys(t),r=Object.keys(e);return Vi(i,r)}function soe(t,e){if(!e)return;let i=Wz(t,e);return i.length!==1?{error:se}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function loe(t,e){if(!e)return;let i=Wz(t,e).filter(r=>t[r]);return i.length<1?{error:se}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function uoe(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:o,_validate:s,_info:l,...u})=>{let c=a&&soe(t,a);if(c!=null&&c.error)return c.error;c&&Object.assign(u,c);let d=o&&loe(t,o);if(d!=null&&d.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(h=>typeof u[h]=="boolean"),m=p.find(h=>{let f=s&&!ha(s),g=t[h]!==void 0&&!s&&coe(t,h,n),v=u[h]&&[void 0,null].includes(t[h]),y=f||g||v||s&&t[h]!==void 0&&!doe(t[h],s)||EB[h]&&!EB[h](t[h]);return y&&(i=h,r=l),y});return!p.length||m}),errorParam:i,paramInfo:r}}function coe(t,e,i){return i=i||ooe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function doe(t,e){return ha(e)?e(t):!0}var oA="DYNAMIC",Uc="RANKING",vc="RATING",xd="SCALE",Ml="SEEDING",poe={RANKING:Uc,RATING:vc,SCALE:xd,SEEDING:Ml};function Lg(t){var n;let e=ze(t,[{[tA]:!0}]);if(e.error)return e;let i=(n=t.participant.timeItems)==null?void 0:n.filter(({itemType:a})=>(a==null?void 0:a.startsWith(xd))&&[Uc,vc,Ml].includes(a.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(i!=null&&i.length){let a=s=>i.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,u)=>new Date(l.createdAt||void 0).getTime()-new Date(u.createdAt||void 0).getTime()).pop(),o=ct(i.map(({itemType:s})=>s));for(let s of o){let l=a(s);if(l){let[,u,c,d,p]=l.itemType.split("."),m=p?`${d}.${p}`:d,h=u===Ml&&"seedings"||u===Uc&&"rankings"||"ratings";r[h][c]||(r[h][c]=[]),r[h][c].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:m})}}}return{...X,...r}}function Tm(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,o,s){if(!a||!o)return;let l=Object.keys(a),u=Object.keys(o),c=Object.assign({},...u.filter(m=>m.indexOf("||")).map(m=>m.split("||").map(h=>({[h]:m}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let m of l)if(d.indexOf(m)>=0||p){let h=c[m]||m,f=o[h]||p,g=a[m];if(typeof f=="object"&&typeof g!="function"&&!Array.isArray(f))if(Array.isArray(g)){let v=g.map(y=>{let I={};return n(y,f,I)!==!1?I:void 0}).filter(Boolean);s[m]=v}else g&&(s[m]={},n(g,f,s[m]));else{let v=a[m];if(Array.isArray(f)&&!f.includes(v))return!1;(o[m]||p&&o[m]!==!1)&&(s[m]=v)}}}}var EC="voluntaryConsolation",lu="competitiveBands",sA="roundRobinTally",Dm="positionActions",kr="matchUpActions",NU="rankingPoints",_f="roundNaming",Gy="participant",OI="progression",zc="scheduling",yS="avoidance",moe="participant",hoe="display",Ns="scoring",vs="seeding",$f="feedIn",foe="audit",bS="draws",goe={POLICY_TYPE_VOLUNTARY_CONSOLATION:EC,POLICY_TYPE_COMPETITIVE_BANDS:lu,POLICY_TYPE_ROUND_ROBIN_TALLY:sA,POLICY_TYPE_POSITION_ACTIONS:Dm,POLICY_TYPE_MATCHUP_ACTIONS:kr,POLICY_TYPE_RANKING_POINTS:NU,POLICY_TYPE_ROUND_NAMING:_f,POLICY_TYPE_PARTICIPANT:Gy,POLICY_TYPE_PROGRESSION:OI,POLICY_TYPE_SCHEDULING:zc,POLICY_TYPE_AVOIDANCE:yS,POLICY_TYPE_DISPLAY:hoe,POLICY_TYPE_PRIVACY:moe,POLICY_TYPE_FEED_IN:$f,POLICY_TYPE_SCORING:Ns,POLICY_TYPE_SEEDING:vs,POLICY_TYPE_AUDIT:foe,POLICY_TYPE_DRAWS:bS};function Sc({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let o=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),s=Ce(o,!1,n);if(s){let l=e==null?void 0:e[Gy];if(i!=null&&i.withScaleValues){let{ratings:u,rankings:c}=Lg({participant:s});s.rankings=c,s.ratings=u}if(l!=null&&l.participant)return Tm({template:l.participant,source:s})}return s}var voe="element required",Ioe="missing name";function Un(t){if(!t||typeof t!="object")return{error:Xe};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:se};if(!(t!=null&&t.name))return{error:Xe,info:Ioe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=Un({element:i,name:t.name});if(r.error)return ee({result:r,stack:"removeExtension"})}return{...X}}return{error:Xe,info:voe}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...X}):{...X,info:$r}}function al({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function Lt(t){if(typeof t!="object")return{error:Xe};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return ee({result:{error:se},stack:e});if(!al({extension:t.extension}))return ee({result:{error:se,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=Lt({extension:t.extension,element:r});if(n.error)return ee({result:n,stack:e})}return{...X}}else return ee({result:{error:Xe},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...X}}function lA(t){return!t||typeof t!="object"?{error:Xe}:t.tournamentRecord?Lt({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:ge}}function vT(t){return!t||typeof t!="object"?{error:Xe}:t.drawDefinition?Lt({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:Fa}}function Wc(t){return!t||typeof t!="object"?{error:Xe}:t.event?Lt({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:co}}function qz(t){var r;if(!t||typeof t!="object")return{error:Xe};if(!t.participantId)return{error:mr};let e=((r=t.tournamentRecord)==null?void 0:r.participants)||[],i=Sc({participantId:t.participantId,tournamentParticipants:e});return i?Lt({creationTime:t.creationTime,extension:t.extension,element:i}):{error:zi}}function uA(t){return!t||typeof t!="object"?{error:Xe}:t.tournamentRecord?Un({element:t.tournamentRecord,name:t.name}):{error:ge}}function Yz(t){return!t||typeof t!="object"?{error:Xe}:t.drawDefinition?Un({element:t.drawDefinition,name:t.name}):{error:Fa}}function IT(t){return!t||typeof t!="object"?{error:Xe}:t!=null&&t.event?Un({element:t.event,name:t.name}):{error:co}}function Kz(t){var r;if(!t||typeof t!="object")return{error:Xe};if(!t.participantId)return{error:mr};let e=((r=t.tournamentRecord)==null?void 0:r.participants)||[],i=Sc({participantId:t.participantId,tournamentParticipants:e});return i?Un({element:i,name:t.name}):{error:zi}}function Hy({tournamentRecords:t}){return{tournamentIds:Nt(t)?Object.keys(t):[],...X}}var yoe="extensionQueries";function vt({discover:t,element:e,name:i,...r}){var a;if(!e||!i){if(t&&r){let o=Object.keys(r).filter(u=>typeof t=="boolean"||Array.isArray(t)&&t.includes(u)).find(u=>{var c;return Array.isArray((c=r[u])==null?void 0:c.extensions)?r[u].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=o&&r[o];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(u=>{var c;return(c=u.extensions)==null?void 0:c.length}));let l=(a=s==null?void 0:s.extensions)==null?void 0:a.find(u=>(u==null?void 0:u.name)===i);return{extension:l,info:l?void 0:$r}}return ee({result:{error:Xe},stack:yoe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let n=e.extensions.find(o=>(o==null?void 0:o.name)===i);return{extension:n,info:n?void 0:$r}}var boe="activeSuspension",kI="appliedPolicies",Jz="context",yT="delegatedOutcome",Us="disabled",Pm="disableAutoCalc",bT="disableLinks",wS="display",Pd="drawDeletions",woe="drawProfile",US="entryProfile",Uoe="eventProfile",Soe="eventWithdrawalRequests",Toe="factory",ts="flightProfile",CC="groupingAttribute",Du="lineUps",Fd="linkedTournamentsIds",wT="matchUpHistory",cA="participantRepresentatives",_g="personRequests",bf="positionActions",Doe="rankingPoints",Poe="registration",yl="roundTarget",zy="scheduleLimits",Pu="scheduleTiming",Rm="schedulingProfile",Roe="statusDetail",Bf="subOrder",Tc="tally",Kv="tieFormatModification",Xz={ACTIVE_SUSPENSION:boe,APPLIED_POLICIES:kI,CONTEXT:Jz,DELEGATED_OUTCOME:yT,DISABLED:Us,DISABLE_LINKS:bT,DISABLE_AUTO_CALC:Pm,DISPLAY:wS,DRAW_DELETIONS:Pd,DRAW_PROFILE:woe,ENTRY_PROFILE:US,EVENT_PROFILE:Uoe,EVENT_WITHDRAWAL_REQUESTS:Soe,FLIGHT_PROFILE:ts,GROUPING_ATTRIBUTE:CC,LINEUPS:Du,LINKED_TOURNAMENTS:Fd,MATCHUP_HISTORY:wT,PARTICIPANT_REPRESENTATIVES:cA,PERSON_REQUESTS:_g,POSITION_ACTIONS:bf,RANKING_POINTS:Doe,REGISTRATION:Poe,ROUND_TARGET:yl,SCHEDULE_LIMITS:zy,SCHEDULE_TIMING:Pu,SCHEDULING_PROFILE:Rm,STATUS_DETAIL:Roe,SUB_ORDER:Bf,TALLY:Tc,TIE_FORMAT_MODIFICATIONS:Kv,FACTORY:Toe},CB=[yT,Us,Pm,bT,ts,Du,Fd,wT,cA,_g,yl,zy,Pu,Rm,Bf,Tc,Kv];function Qz({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Oi};let e=Hy({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?Lt({tournamentRecords:t,discover:!0,extension:{name:Fd,value:{tournamentIds:i}}}):{...X}}function Zz({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Oi};let e=Un({name:Fd,tournamentRecords:t,discover:!0});return ee({result:e,stack:"unlinkTournaments"})}function eW({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:se};if(!e)return{error:Rf};let i=Hy({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:Rf};let n;return r.every(a=>{var d;let o=t[a],{extension:s}=vt({element:o,name:Fd});if(!s)return!0;let l=((d=s==null?void 0:s.value)==null?void 0:d.tournamentIds)||[];if(!(l!=null&&l.length)||l.length===1&&l.includes(e)||a===e){let p=uA({name:Fd,tournamentRecord:o});return p.error&&(n=p.error),p.success}let u=l.filter(p=>p!==e);s.value={tournamentIds:u};let c=lA({tournamentRecord:o,extension:s});return c.error&&(n=c.error),c.success}),n?{error:n}:{...X}}var tW={};bt(tW,{getLinkedTournamentIds:()=>Wy,getTournamentIds:()=>Hy});function Wy({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Oi}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var o;let i=t[e],r=i==null?void 0:i.tournamentId,{extension:n}=vt({element:i,name:Fd}),a=(((o=n==null?void 0:n.value)==null?void 0:o.tournamentIds)||[]).filter(s=>s!==r);return{[e]:a}}))}}var UT={};bt(UT,{adHocPositionSwap:()=>Wq,addAdHocMatchUps:()=>JT,addDrawDefinitionTimeItem:()=>dO,addFinishingRounds:()=>sb,addGoesTo:()=>$d,addPlayoffStructures:()=>KT,addQualifyingStructure:()=>zq,addVoluntaryConsolationStage:()=>$q,addVoluntaryConsolationStructure:()=>ZA,allPlayoffPositionsFilled:()=>uO,alternateDrawPositionAssignment:()=>Eq,assignDrawPosition:()=>I3,assignDrawPositionBye:()=>Ka,attachConsolationStructures:()=>h3,attachPlayoffStructures:()=>EO,attachQualifyingStructure:()=>cO,attachStructures:()=>YT,autoSeeding:()=>Rpe,automatedPlayoffPositioning:()=>Wg,automatedPositioning:()=>vb,checkValidEntries:()=>ZT,deleteAdHocMatchUps:()=>b3,drawMatic:()=>XO,findDrawDefinition:()=>OO,generateAdHocMatchUps:()=>eD,generateAdHocRounds:()=>JO,generateAndPopulatePlayoffStructures:()=>PO,generateDrawDefinition:()=>xb,generateDrawMaticRound:()=>BO,generateDrawStructuresAndLinks:()=>LO,generateDrawTypeAndModifyDrawDefinition:()=>_O,generateQualifyingStructure:()=>vO,generateVoluntaryConsolation:()=>H3,getAssignedParticipantIds:()=>Ip,getAvailableMatchUpsCount:()=>XT,getAvailablePlayoffProfiles:()=>yb,getDrawDefinitionTimeItem:()=>NA,getDrawParticipantRepresentativeIds:()=>NO,getDrawStructures:()=>is,getDrawTypeCoercion:()=>Rb,getEligibleVoluntaryConsolationParticipants:()=>MO,getMatchUpsMap:()=>sn,getParticipantIdFinishingPositions:()=>AO,getPositionAssignments:()=>BI,getPositionsPlayedOff:()=>qg,getSeedingThresholds:()=>rO,getSeedsCount:()=>Eb,getStructureSeedAssignments:()=>ho,getTeamLineUp:()=>_d,getValidGroupSizes:()=>fb,isAdHoc:()=>zn,isCompletedStructure:()=>Cc,isValidForQualifying:()=>FO,luckyLoserDrawPositionAssignment:()=>wq,modifyDrawDefinition:()=>f3,modifyDrawName:()=>CO,modifySeedAssignment:()=>Cq,mutate:()=>iW,positionActions:()=>xO,pruneDrawDefinition:()=>v3,qualifierDrawPositionAssignment:()=>Rq,query:()=>S3,removeDrawPositionAssignment:()=>$I,removeRoundMatchUps:()=>w3,removeSeededParticipant:()=>Hq,removeStructure:()=>Lq,renameStructures:()=>Fq,resetDrawDefinition:()=>g3,resetVoluntaryConsolationStructure:()=>IW,setDrawParticipantRepresentativeIds:()=>rW,setPositionAssignments:()=>Dq,setStructureOrder:()=>kq,setSubOrder:()=>U3,shiftAdHocRounds:()=>Tq,swapAdHocRounds:()=>Pq,swapDrawPositionAssignments:()=>jq,updateTeamLineUp:()=>hh,withdrawParticipantAtDrawPosition:()=>mq});var iW={};bt(iW,{adHocPositionSwap:()=>Wq,addAdHocMatchUps:()=>JT,addDrawDefinitionTimeItem:()=>dO,addPlayoffStructures:()=>KT,addQualifyingStructure:()=>zq,addVoluntaryConsolationStage:()=>$q,addVoluntaryConsolationStructure:()=>ZA,alternateDrawPositionAssignment:()=>Eq,assignDrawPosition:()=>I3,assignDrawPositionBye:()=>Ka,attachConsolationStructures:()=>h3,attachPlayoffStructures:()=>EO,attachQualifyingStructure:()=>cO,attachStructures:()=>YT,automatedPlayoffPositioning:()=>Wg,automatedPositioning:()=>vb,deleteAdHocMatchUps:()=>b3,luckyLoserDrawPositionAssignment:()=>wq,modifyDrawDefinition:()=>f3,modifyDrawName:()=>CO,modifySeedAssignment:()=>Cq,pruneDrawDefinition:()=>v3,qualifierDrawPositionAssignment:()=>Rq,removeDrawPositionAssignment:()=>$I,removeRoundMatchUps:()=>w3,removeSeededParticipant:()=>Hq,removeStructure:()=>Lq,renameStructures:()=>Fq,resetDrawDefinition:()=>g3,resetVoluntaryConsolationStructure:()=>IW,setDrawParticipantRepresentativeIds:()=>rW,setPositionAssignments:()=>Dq,setStructureOrder:()=>kq,setSubOrder:()=>U3,shiftAdHocRounds:()=>Tq,swapAdHocRounds:()=>Pq,swapDrawPositionAssignments:()=>jq,updateTeamLineUp:()=>hh,withdrawParticipantAtDrawPosition:()=>mq});var dA=t=>e=>t[e],pA=(t=[])=>t.map(Dr).filter(Boolean),MC=(t=[])=>t.map(Ut).filter(Boolean),Ut=(t={})=>dA(t)("participantId"),Dr=(t={})=>dA(t)("matchUpId"),xI=(t={})=>dA(t)("drawId");function rW({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:Fa};if(!Array.isArray(t))return{error:se};let i=MC((e==null?void 0:e.entries)||[]);return t.length&&Vi(t,i).length<t.length?{error:se}:vT({drawDefinition:e,extension:{name:cA,value:t}})}var Ba="ABANDONED",th="AWAITING_RESULT",Vt="BYE",zu="CANCELLED",qi="COMPLETED",$g="DEAD_RUBBER",Mt="DEFAULTED",dr="DOUBLE_DEFAULT",tr="DOUBLE_WALKOVER",cs="IN_PROGRESS",mo="INCOMPLETE",mA="NOT_PLAYED",hn="RETIRED",qc="SUSPENDED",Xi="TO_BE_PLAYED",zt="WALKOVER",Eoe=[th,qi,Mt,cs,mo,hn,qc],nW=[th,qi,Mt,tr,dr,cs,mo,hn,qc,zt],aW=[Ba,th,Vt,zu,qi,$g,Mt,tr,dr,cs,mo,mA,hn,qc,Xi,zt],oW=[Vt,tr,dr,qi,Mt,hn,zt],sW=[Ba,th,zu,$g,cs,mo,mA,qc,Xi,void 0],vr=[zu,Ba,qi,$g,Mt,tr,dr,hn,zt],hA=[Ba,qi,Mt,tr,dr,cs,hn,zt],lW=[cs,mo,qc,Xi],uW={ABANDONED:Ba,AWAITING_RESULT:th,BYE:Vt,CANCELLED:zu,COMPLETED:qi,DEAD_RUBBER:$g,DEFAULTED:Mt,DOUBLE_WALKOVER:tr,DOUBLE_DEFAULT:dr,IN_PROGRESS:cs,INCOMPLETE:mo,NOT_PLAYED:mA,RETIRED:hn,SUSPENDED:qc,TO_BE_PLAYED:Xi,WALKOVER:zt};function ih(t,e,i){var d,p;let r=m=>{var h,f;return(f=(h=vt({element:m,name:yl}))==null?void 0:h.extension)==null?void 0:f.value},n=i==null?void 0:i.deprioritizeCompleted,a=(i==null?void 0:i.mode)===Az&&jae,o=(i==null?void 0:i.mode)===Nz&&Oz,s=o||a||Sm,l=m=>(m==null?void 0:m.stage)===Oe&&(m==null?void 0:m.stageSequence)===1,u=m=>l(m)?-1:s[m==null?void 0:m.stage],c=m=>m==null?void 0:m.matchUps.every(({matchUpStatus:h})=>vr.includes(h)?1:-1);return n&&c(t)-c(e)||a&&u(t)-u(e)||((t==null?void 0:t.stage)&&s[t.stage]||0)-((e==null?void 0:e.stage)&&s[e.stage]||0)||(r(t)||0)-(r(e)||0)||!o&&!a&&(((d=e==null?void 0:e.positionAssignments)==null?void 0:d.length)??1/0)-(((p=t==null?void 0:t.positionAssignments)==null?void 0:p.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(SS(t)||0)-(SS(e)||0)}function SS(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var n;let r=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((a,o)=>a+o,0);return!e||r<e?r:e},void 0)}function it(t){let e=ze(t,[{[Fn]:!0,[dT]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=is({drawDefinition:i}),a=n==null?void 0:n.map(l=>l.structures?[...l.structures].concat(l):l).flat(),o=a==null?void 0:a.find(l=>l.structureId===r);if(!o)return{error:Ci};let s=o.structureType===sT?a==null?void 0:a.find(l=>{var u;return(u=l.structures)==null?void 0:u.some(c=>c.structureId===r)}):void 0;return{structure:o,containingStructure:s}}function is({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:o,stage:s}){var h;let l=!e&&Le||!(e!=null&&e.structures)&&fN||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let u=f=>{var v,y;let g=(y=(v=vt({element:f,name:yl}))==null?void 0:v.extension)==null?void 0:y.value;return!n||n===g},c=((h=e==null?void 0:e.structures)==null?void 0:h.filter(p).filter(m).filter(u).sort((f,g)=>ih(f,g,a)))??[],d=t?Object.assign({},...oT.map(f=>{let g=c==null?void 0:c.filter(v=>v.stage===f);return(g==null?void 0:g.length)&&{[f]:g}}).filter(Boolean)):{};return{structures:c,stageStructures:d};function p(f){return!s&&!Array.isArray(o)||s&&f.stage===s||Array.isArray(o)&&o.includes(f.stage)}function m(f){return!r&&!Array.isArray(i)||r&&f.stageSequence===r||Array.isArray(i)&&i.includes(f.stageSequence)}}function cW({drawDefinition:t}){if(!t)return{error:Le};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=oi({structure:i}),a=(n==null?void 0:n.map(Ut).filter(Boolean))??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function oi({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:Le};if({structure:i,error:r}=it({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>oi({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=VG,{positionAssignments:n,error:r}}function Er({drawDefinition:t,structureId:e,structure:i}){var u;let r=((u=oi({drawDefinition:t,structureId:e,structure:i}))==null?void 0:u.positionAssignments)||[],n=r==null?void 0:r.filter(c=>c.participantId??c.bye??c.qualifier),a=r&&(r==null?void 0:r.length)===(n==null?void 0:n.length),o=r==null?void 0:r.filter(c=>!c.participantId&&!c.bye&&!c.qualifier),s=r==null?void 0:r.filter(c=>!c.participantId&&c.bye),l=r==null?void 0:r.filter(c=>!c.participantId&&c.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:o,assignedPositions:n,qualifierPositions:l,byePositions:s}}var fA="addDrawDefinition",ST="addMatchUps",Dc="addParticipants",gA="addScaleItems",dW="addEvent",vA="addVenue",gu="audit",IA="dataIssue",yA="deleteParticipants",bA="deleteVenue",wA="deletedDrawIds",UA="deletedMatchUpIds",SA="modifyDrawDefinition",pW="modifyDrawEntries",mW="modifyEventEntries",TA="modifyMatchUp",nn="modifyParticipants",DA="modifyPositionAssignments",PA="modifySeedAssignments",dp="modifyTournamentDetail",pp="modifyVenue",NC="mutations",AC="publishEvent",hW="publishEventSeeding",fW="publishOrderOfPlay",gW="publishParticipants",RA="unPublishEvent",EA="unPublishEventSeeding",CA="unPublishOrderOfPlay",Coe="unPublishParticipants",TT="updateInContextMatchUp",Moe={ADD_DRAW_DEFINITION:fA,ADD_MATCHUPS:ST,ADD_PARTICIPANTS:Dc,ADD_SCALE_ITEMS:gA,ADD_EVENT:dW,ADD_VENUE:vA,AUDIT:gu,DATA_ISSUE:IA,DELETE_PARTICIPANTS:yA,DELETE_VENUE:bA,DELETED_DRAW_IDS:wA,DELETED_MATCHUP_IDS:UA,MODIFY_DRAW_DEFINITION:SA,MODIFY_DRAW_ENTRIES:pW,MODIFY_EVENT_ENTRIES:mW,MODIFY_MATCHUP:TA,MODIFY_PARTICIPANTS:nn,MODIFY_POSITION_ASSIGNMENTS:DA,MODIFY_SEED_ASSIGNMENTS:PA,MODIFY_TOURNAMENT_DETAIL:dp,MODIFY_VENUE:pp,MUTATIONS:NC,PUBLISH_EVENT_SEEDING:hW,PUBLISH_EVENT:AC,PUBLISH_ORDER_OF_PLAY:fW,PUBLISH_PARTICIPANTS:gW,UNPUBLISH_EVENT_SEEDING:EA,UNPUBLISH_EVENT:RA,UNPUBLISH_ORDER_OF_PLAY:CA,UPDATE_INCONTEXT_MATCHUP:TT};function DT(t,e){var a;if(!t)return{error:Le};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=e==null?void 0:e.filter(Boolean);return t.updatedAt=r,(a=t.structures)==null||a.filter(Boolean).forEach(o=>{(!(n!=null&&n.length)||n!=null&&n.includes(o.structureId))&&(o.updatedAt=r)}),{...X}}function Pc({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&DT(t),lt({payload:{matchUps:i,tournamentId:e,eventId:r},topic:ST}),{...X}}function Wu({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&DT(t),lt({topic:UA,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)_N({key:a});return{...X}}function Rt({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&li({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),lt({topic:TA,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...X}):(console.log(aa),{error:aa})}function Noe({tournamentId:t,inContextMatchUp:e}){return e?(lt({payload:{inContextMatchUp:e,tournamentId:t},topic:TT,key:e.matchUpId}),{...X}):{error:aa}}function qy({tournamentId:t,eventId:e,drawDefinition:i}){return i?(DT(i),lt({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:fA,key:i.drawId}),{...X}):(console.log(Le),{error:Le})}function Aoe({tournamentId:t,eventId:e,drawId:i}){return lt({payload:{drawId:i,tournamentId:t,eventId:e},topic:wA,key:i}),_N({key:i}),{...X}}function li({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(DT(t,i),lt({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:SA,key:t.drawId}),{...X}):{error:Le}}function vW({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:Le};if(!i)return{error:lp};let n=i.seedAssignments,a=i.structureId,o=t.drawId;return lt({payload:{tournamentId:e,eventId:r,drawId:o,structureId:a,seedAssignments:n},topic:PA,key:t.drawId}),li({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...X}}function Rc({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:Le};if(!i)return{error:lp};let n=oi({structure:i}),a=i.structureId,o=t.drawId,s=r==null?void 0:r.eventId;return lt({topic:DA,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:s,drawId:o},key:a}),li({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:s}),{...X}}function IW({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){var o,s;if(!e)return{error:Le};let n=(o=e.structures)==null?void 0:o.find(l=>l.stage===Or);if(!n)return{error:Ci};let a=((s=n.matchUps)==null?void 0:s.map(({matchUpId:l})=>l))||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],Wu({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==Or)),li({tournamentId:t==null?void 0:t.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...X}}function MA({drawPositions:t,structure:e}){var r;if([Ke,Oe].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=oi({structure:e});(r=i==null?void 0:i.filter(({drawPosition:n})=>t==null?void 0:t.includes(n)))==null||r.forEach(n=>{Lt({element:n,extension:{name:bT,value:!0}})})}function PT(t){var s,l;let{appliedPolicies:e,positionAction:i,drawDefinition:r}=t;if(((s=e==null?void 0:e.audit)==null?void 0:s[bf])===!1)return;let{extension:n}=vt({name:bf,element:r}),a=Array.isArray(n==null?void 0:n.value)?(n==null?void 0:n.value)??[]:[];if(!(a!=null&&a.length)){let u=r.structures.find(c=>c.stage===Oe);if(u){let c=(l=oi({structure:u}).positionAssignments)==null?void 0:l.map(({drawPosition:d,participantId:p,bye:m,qualifier:h})=>({drawPosition:d,participantId:p,qualifier:h,bye:m}));a.push({name:"initialMainAssignments",initialAssignments:c})}}let o={value:a.concat(i),name:bf};Lt({element:r,extension:o})}function Bg({tournamentRecord:t,drawDefinition:e,event:i}){var s;let r=((s=(t==null?void 0:t.events)||i&&[i])==null?void 0:s.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],n={},a={},o=r.map(l=>{var u;return(u=l==null?void 0:l.structures)==null?void 0:u.filter(c=>c==null?void 0:c.structures)}).flat().filter(Boolean);for(let l of o){let{structures:u,structureId:c}=l??{};u&&c&&(n[c]=u==null?void 0:u.map(d=>d.structureId))&&u.forEach(d=>a[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:n,containerStructures:a}}function RT(t){var a;let{sides:e,matchUpType:i}=t||{},r=(a=t.potentialParticipants)!=null&&a.length?t.potentialParticipants.flat().map(o=>i===Zt?(o==null?void 0:o.individualParticipantIds)||[]:o.participantId).flat():[],n=(e||[]).map(o=>{var s;return i===Zt&&(((s=o==null?void 0:o.participant)==null?void 0:s.individualParticipantIds)||[])||(o==null?void 0:o.participantId)&&[o.participantId]||[]}).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function bo(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var Yy="SIGN_IN_STATUS",yW="SIGNED_OUT",FI="SIGNED_IN",Vn="TEAM",St="INDIVIDUAL",qa="GROUP",ft="PAIR",Kt="TEAM",Jv={TEAM_PARTICIPANT:Vn,INDIVIDUAL:St,GROUP:qa,TEAM:Kt,PAIR:ft},bW={INDIVIDUAL:St,GROUP:qa,PAIR:ft,TEAM:Kt,SIGN_IN_STATUS:Yy,SIGNED_OUT:yW,SIGNED_IN:FI};function ET({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?Ce(e,t==null?void 0:t.convertExtensions,!0):e,a=n.filter(l=>l.participantType===Kt),o=n.filter(l=>l.participantType===qa),s=n.filter(l=>l.participantType===ft);return n.forEach(l=>{if(l.participantType===St){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{var p;d===u&&!((p=l.teamParticipantIds)!=null&&p.includes(c.participantId))&&(l.teamParticipantIds.push(c.participantId),r.get(c.participantId)||r.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),s.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),o.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}var Zp=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function wW({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n==null?void 0:n.map(({person:s})=>s)].flat().filter(Boolean);function o(s){let{nationalityCode:l}=s||{};if(l){let u=Zp.find(({iso:c})=>c===l);i&&(u!=null&&u.ioc)&&!s.iocNationalityCode&&(s.iocNationalityCode=u.ioc),e&&(u!=null&&u.iso2)&&!s.iso2NationalityCode&&(s.iso2NationalityCode=u.iso2),u!=null&&u.label&&!s.countryName&&(s.countryName=u.label)}}a.forEach(o)}function Ooe({participantMap:t,template:e}){var r;let i=Object.values(t);for(let n of i){let a=n.participant;if((r=a.individualParticipantIds)!=null&&r.length){a.individualParticipants=[];for(let o of a.individualParticipantIds){let s=t[o].participant;a.individualParticipants.push(e?Tm({template:e,source:s}):s)}}}}function Yc(t){var n;let{tournamentRecord:e,participantId:i}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let a of Object.values(r)){let o=(n=a.participants)==null?void 0:n.find(s=>s.participantId===i);if(o)return{participant:o,tournamentId:a.tournamentId}}return{error:zi}}function UW(t){let{tournamentRecord:e,participantId:i}=t;if(i){let n=Yc({tournamentRecord:e,participantId:i});return n.participant??n}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Xe}}function wo(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=UW(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:se,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:MN};let a=n.timeItems.filter(s=>(s==null?void 0:s.itemType)===r).filter(s=>!(i!=null&&i.length)||i.some(l=>{var u;return(u=s==null?void 0:s.itemSubTypes)==null?void 0:u.includes(l)})).sort((s,l)=>{let u=new Date(s.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),o=Ce(a.pop(),!1,!0);if(o){let s={timeItem:o,...X};return e&&Object.assign(s,{previousItems:a}),s}else return{info:$r}}function NA({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:$s};if(!e.timeItems)return{info:$r};let{timeItem:n,previousItems:a,info:o}=wo({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function Ky({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:vi};if(!r.timeItems)return{info:$r};let{timeItem:n,previousItems:a,info:o}=wo({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:o}}function CT({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:ge};if(!e.timeItems)return{info:$r};let{timeItem:n,previousItems:a,info:o}=wo({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function AA({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:ge};if(!i)return{error:mr};let a=Yc({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:o}=a;if(!(o!=null&&o.timeItems))return{info:$r};let{timeItem:s,previousItems:l,info:u}=wo({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return s&&{timeItem:s,previousItems:l}||{info:u}}var koe={[qa]:"groupParticipantIds",[ft]:"pairParticipantIds",[Kt]:"teamParticipantIds"},xoe={[qa]:"groups",[Kt]:"teams"};function SW({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,withGroupings:a,internalUse:o,withISO2:s,withIOC:l}){let u=[],c={};for(let p of i.participants??[]){let m=p==null?void 0:p.participantId;m&&_oe({participantMap:c,participantId:m})}for(let p of i.participants??[]){let m=Ce(p,e,o),{participantId:h,individualParticipantIds:f,participantType:g}=m;if(!c[h]){u.push(h);continue}if(Object.assign(c[h].participant,m),f){let v=Loe({individualParticipantIds:f,participantCopy:m,participantMap:c,participantType:g,participantId:h});v.missingParticipantIds.length&&u.push(...v.missingParticipantIds)}if(r&&(c[h].participant.signedIn=Foe(m)),n){let{ratings:v,rankings:y,seedings:I}=Lg({participant:m});c[h].participant.seedings=I,c[h].participant.rankings=y,c[h].participant.ratings=v}(l||s)&&wW({participant:c[h].participant,withISO2:s,withIOC:l})}if(t){let p=Nt(t)?t:void 0;Ooe({participantMap:c,template:p})}let d;return a&&(d=ET({participants:Object.values(c).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:u,participantMap:c,groupInfo:d}}function Foe(t){let{timeItem:e}=wo({itemType:Yy,element:t});return(e==null?void 0:e.itemValue)===FI}function Loe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){var o;let a=[];for(let s of t){let l=(o=i[s])==null?void 0:o.participant;if(!l){a.push(s);continue}if(l[koe[r]].push(n),[Kt,qa].includes(r)){let{participantRoleResponsibilities:u,participantOtherName:c,participantName:d,participantId:p,teamId:m}=e,h=xoe[r];l[h].push({participantRoleResponsibilities:u,participantOtherName:c,participantName:d,participantId:p,teamId:m})}if(r===ft){let u=t.find(c=>c!==s);i[s].pairIdMap[n]=u,i[s].pairIdMap[u]=n}}return{missingParticipantIds:a}}function _oe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[ii]:{...i},[Zt]:{...i},[Kt]:{...i},...i}}}function mp({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){if(e)return SW({...t,...r,tournamentRecord:i});let a=Ce(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&a.forEach(s=>wW({participant:s,...t}));let o;if((n||t!=null&&t.withGroupings)&&(a!=null&&a.length)&&({participantsWithGroupings:a,groupInfo:o}=ET({participantsProfile:t,deepCopy:!1,participants:a})),(t==null?void 0:t.withScaleValues)&&(a==null?void 0:a.length))for(let s of a){let{ratings:l,rankings:u}=Lg({participant:s});s.rankings=u,s.ratings=l}return{participants:a,groupInfo:o}}function $t({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:yN};let o={};return i&&s(i),a&&s(a),r&&s(r),n&&s(n),{appliedPolicies:o,...X};function s(l){var c,d;let u=(d=(c=l==null?void 0:l.extensions)==null?void 0:c.find(p=>p.name===kI))==null?void 0:d.value;if(u)for(let p of Object.keys(u))(t?e.includes(p):!e.length||e.includes(p))&&(o[p]=Ce(u[p],!1,!0))}}function qu({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:yN};let{appliedPolicies:a}=$t({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),o={};for(let s of t){let l=a==null?void 0:a[s];l&&(o[s]=l)}return Object.keys(o).length?{policyDefinitions:o}:{info:Qp.message}}var TW="WALKOVER",MB="RETIRED",OA="COMPETITIVE",LI="ROUTINE",_I="DECISIVE",AU="winRatio",$oe={[lu]:{policyName:"Competitive Bands Default",profileBands:{[_I]:20,[LI]:50}}},kA=$oe;function Yu({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let o=qu({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[lu])??(o==null?void 0:o[lu])??kA[lu];a.policies[lu]=s}return a}function hp({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:ge};let{appliedPolicies:a}=$t({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a!=null&&a[i]?{policy:a[i]}:{info:Qp==null?void 0:Qp.message}}function Jy({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){var s,l,u,c,d,p;e=e??((s=r==null?void 0:r.category)==null?void 0:s.categoryName)??((l=r==null?void 0:r.category)==null?void 0:l.ageCategoryCode),i=i??((u=r==null?void 0:r.category)==null?void 0:u.categoryType)??((c=r==null?void 0:r.category)==null?void 0:c.subType);let{policy:n}=hp({policyType:zc,tournamentRecord:t,event:r}),a=(d=t?vt({element:t,name:Pu}).extension:void 0)==null?void 0:d.value,o=(p=r&&vt({name:Pu,element:r}).extension)==null?void 0:p.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:o,categoryName:e,categoryType:i,policy:n}}}function xA({drawDefinition:t,attributes:e}){let{extension:i}=vt({element:t,name:US}),r=(i==null?void 0:i.value)||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:US,value:r},vT({drawDefinition:t,extension:i}),{entryProfile:r}}function Xy({drawDefinition:t}){let{extension:e}=vt({element:t,name:US});return{entryProfile:(e==null?void 0:e.value)||{}}}var Go="ALTERNATE",Qy="CONFIRMED",sa="DIRECT_ACCEPTANCE",Zy="FEED_IN",eb="JUNIOR_EXEMPT",Ru="LUCKY_LOSER",tb="ORGANISER_ACCEPTANCE",ib="QUALIFIER",Boe="REGISTERED",rb="SPECIAL_EXEMPT",Uo="UNGROUPED",fp="UNPAIRED",Vf="WILDCARD",Eu="WITHDRAWN",OU=[Qy,sa,eb,tb,rb],DW=[Zy,Ru,ib],gp=[Qy,sa,Zy,eb,tb,rb,Vf],ds=[Qy,sa,eb,Ru,ib,tb,rb,Vf],PW=[Go,Qy,sa,Zy,eb,Ru,tb,ib,Boe,rb,Uo,fp,Vf,Eu],Voe={ALTERNATE:Go,CONFIRMED:Qy,DIRECT_ACCEPTANCE:sa,DIRECT_ENTRY_STATUSES:gp,DRAW_SPECIFIC_STATUSES:DW,EQUIVALENT_ACCEPTANCE_STATUSES:OU,FEED_IN:Zy,JUNIOR_EXEMPT:eb,LUCKY_LOSER:Ru,ORGANISER_ACCEPTANCE:tb,QUALIFIER:ib,SPECIAL_EXEMPT:rb,STRUCTURE_SELECTED_STATUSES:ds,UNGROUPED:Uo,UNPAIRED:fp,VALID_ENTRY_STATUSES:PW,WILDCARD:Vf,WITHDRAWN:Eu};function FA({stage:t,drawDefinition:e}){let{entryProfile:i}=Xy({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&oT.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return xA({drawDefinition:e,attributes:n}),!0}return r}function joe({stage:t,drawDefinition:e}){var r;let{entryProfile:i}=Xy({drawDefinition:e});return((r=i[t])==null?void 0:r.alternates)||0}function Goe({stage:t,drawDefinition:e}){var r;let{entryProfile:i}=Xy({drawDefinition:e});return((r=i[t])==null?void 0:r.wildcardsCount)||0}function OC({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function rh({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:o,stages:s,stage:l}){var c;let u=((c=i.entries)==null?void 0:c.reduce((d,p)=>{var v,y;let m=(y=(v=vt({name:yl,element:p}))==null?void 0:v.extension)==null?void 0:y.value,h=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),f=!n||p.entryStatus&&n.includes(p.entryStatus),g=p.entryStageSequence??1;return h&&(!r||g===r)&&f&&(!o||!m||o===m)?d.concat(p):d},[]))??[];if(a&&l===$i){let{playoffEntries:d,error:p}=Hoe({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:u).filter(m=>!e||m.placementGroup===e)}return u}function Hoe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===Su&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:o}=n.source,{structure:s}=it({drawDefinition:e,structureId:o});(s==null?void 0:s.structureType)===xn&&(s.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(f=>{var y;let{participantId:g}=f,v=(y=vt({element:f,name:Tc}).extension)==null?void 0:y.value;return v&&g?{[g]:v}:void 0}).filter(Boolean)),m=Object.keys(p).reduce((f,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return f.includes(y)||f.push(y),f},[]).length===Object.keys(p).length,h=Object.keys(p).filter(f=>{let g=p[f],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||m)&&h.forEach(f=>{let g=p[f],{groupOrder:v,provisionalOrder:y,GEMscore:I}=g,b=v||t&&y,S=[...a??[]].sort(sr).indexOf(b)+1;r.push({entryStage:$i,entryStatus:Zy,placementGroup:S,groupingValue:d,participantId:f,GEMscore:I})})})}return{playoffEntries:r}}function zoe({stage:t,drawDefinition:e}){return gp.reduce((i,r)=>(OC({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function ho({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){var h;let a,o=[];n||({structure:n,error:a}=it({drawDefinition:i,structureId:r}));let s=oi({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:Ci};r||(r=n.structureId);let{stage:l,stageSequence:u}=n,c=l===$i&&i&&rh({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:r,stage:l}),d=c?c.filter(f=>f.placementGroup===1).sort((f,g)=>f.GEMscore<g.GEMscore&&1||f.GEMscore>g.GEMscore&&-1||0).map((f,g)=>{let v=g+1;return{participantId:f.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],p=d==null?void 0:d.slice(0,e?d.length:s.length/2);p.length?o=p:n.seedAssignments?o=n.seedAssignments:a=NG;let m=n.seedLimit??((h=n==null?void 0:n.positionAssignments)==null?void 0:h.length);return{seedAssignments:o,stageSequence:u,seedLimit:m,stage:l,error:a}}function js(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function Xv({item:t,drawDefinition:e,structure:i,event:r}){var n,a,o;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((n=e.tieFormats)==null?void 0:n.find(l=>t.tieFormatId===l.tieFormatId))||(r.tieFormat?r.tieFormat:(a=r.tieFormats)==null?void 0:a.find(l=>t.tieFormatId===l.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(o=e.tieFormats)==null?void 0:o.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function vn({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:Xv({item:i,drawDefinition:t,structure:e,event:r})||Xv({item:e,drawDefinition:t,structure:e,event:r})||js(t)||js(r)}}function Woe({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function sn({drawDefinition:t,structure:e}){let i={},r=[];return((t==null?void 0:t.structures)??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:o,structures:s}=n,l=Array.isArray(s);if(l)l&&s.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=o;i[a]={matchUps:u,itemStructureIds:[]},u==null||u.forEach(c=>{r.push(c),c.tieMatchUps&&r.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function Ld({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=(e==null?void 0:e.mappedMatchUps)??t;let n=t[i],a=((n==null?void 0:n.itemStructureIds)||[]).map(o=>{let{matchUps:s,structureName:l}=t[o];return r?s.map(u=>Object.assign(Ce(u,!0,!0),{containerStructureId:i,structureId:o,structureName:l})):s}).flat();return((n==null?void 0:n.matchUps)||[]).concat(...a)}function RW({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=Rr(t,t.length/e).map(n=>n.reduce((a,o)=>a+o)),r=i.slice().sort(sr);return i.map(n=>r.indexOf(n)+1)}function MT(t){if(!Nt(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>ot(a)||a===void 0||a===null);return r&&n}function So(t){return Array.isArray(t)?t.every(MT):!1}function En({matchUps:t=[],interpolate:e}){var d;if(!So(t))return{roundMatchUps:[],error:se};let i=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?et(m.roundNumber):m.roundNumber;return!m.roundNumber||p.includes(h)?p:p.concat(h)},[]).sort(sr).map(p=>{let m=t.filter(g=>g.roundNumber===p),h=m.find(({matchUpType:g})=>g===fi)?m.filter(({matchUpType:g})=>g===fi):m,f=g=>g.sort((v,y)=>sr(v.roundPosition,y.roundPosition));return{[p]:f(h)}}),r=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?et(m.roundNumber):m.roundNumber;return p[h]||(p[h]=je({abbreviatedRoundName:m.abbreviatedRoundName,finishingRound:m.finishingRound,roundName:m.roundName})),p},{}),n=Object.assign({},...i);if(e){let p=Math.max(...Object.keys(n).map(h=>et(h)).filter(h=>!isNaN(h))),m=(d=n[p])==null?void 0:d.length;if(m>1&&Rs(m)){let h=p+1,f=h+m/2;Te(h,f).forEach((g,v)=>{n[g]=Te(0,m/(2+v*2)).map(()=>({}))})}}let a=0,o=Object.assign({},...Object.keys(n).map(p=>{var g,v,y;let m=(g=n[p])==null?void 0:g.length,h=(y=(v=n[p])==null?void 0:v.filter(I=>{var b;return!vr.includes(I.matchUpStatus)&&!((b=I.score)!=null&&b.scoreStringSide1)}))==null?void 0:y.length,f=m&&m===h;return a=Math.max(a,m),{[p]:{matchUpsCount:m,inactiveCount:h,inactiveRound:f}}})),s=0,l=0,u=Object.keys(n).map(p=>et(p)).filter(p=>!isNaN(p));u.forEach(p=>{var f,g,v,y,I;let m=n[p].sort((b,S)=>b.roundPosition-S.roundPosition),h=m.map(b=>(b==null?void 0:b.drawPositions)||[]).flat();if(o[p].roundNumber=p,o[p].roundFactor=o[p].matchUpsCount?a/o[p].matchUpsCount:1,o[p].finishingRound=(f=r[p])==null?void 0:f.finishingRound,o[p].roundName=(g=r[p])==null?void 0:g.roundName,o[p].abbreviatedRoundName=(v=r[p])==null?void 0:v.abbreviatedRoundName,o[p].finishingPositionRange=(I=(y=n[p])==null?void 0:y[0])==null?void 0:I.finishingPositionRange,p===1||!o[p-1]){let b=h.sort(sr),S=Rr(b,2);o[p].drawPositions=b,o[p].pairedDrawPositions=S}else{let b=o[p-1],S=b.drawPositions,w=b.matchUpsCount/o[p].matchUpsCount,U=Rr(S,w),T=m.map(D=>{let{roundPosition:P}=D,E=[...D.drawPositions||[],void 0,void 0].slice(0,2);if(!P)return E;let R=(E==null?void 0:E.filter(Boolean))||[];if(!(R!=null&&R.length))return[void 0,void 0];if(p<3&&(R==null?void 0:R.length)===2)return E==null?void 0:E.slice().sort(sr);let N=Vi(S,R).length!==(R==null?void 0:R.length);if(R!=null&&R.length&&N)return(R==null?void 0:R.length)===1?[R[0],void 0]:E==null?void 0:E.slice().sort(sr);let A=(P-1)*2;return U.slice(A,A+2).map(M=>R==null?void 0:R.find(C=>M.includes(C)))});o[p].drawPositions=T==null?void 0:T.flat(),o[p].pairedDrawPositions=T}o[p+1]&&o[p+1].matchUpsCount===o[p].matchUpsCount&&(o[p+1].feedRound=!0,o[p+1].feedRoundIndex=l,o[p].preFeedRound=!0,l+=1),o[p]&&!o[p].feedRound&&(o[p].roundIndex=s,s+=1)});let c=!!Object.values(o).find(({matchUpsCount:p})=>!Rs(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:c,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:u,roundProfile:o,...X}}function kU(t){if(!Array.isArray(t))return"";let e=t.filter(_i);return e.length?ct([Math.min(...e),Math.max(...e)]).join("-"):""}function qoe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:Le};if(!e)return{error:Wa};let{structure:r}=it({drawDefinition:t,structureId:e});if((r==null?void 0:r.stage)!==rn)return{error:up,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=(n==null?void 0:n.filter(d=>d.target.structureId===e))||[],o=(a==null?void 0:a.reduce((d,p)=>{let{structureId:m}=p.source;return d.includes(m)?d:d.concat(m)},[]))||[],s=Object.assign({},...o.map(d=>{let p=Ld({structureId:d,matchUpsMap:i}),m=En({matchUps:p}).roundProfile;return{[d]:m}})),l=Ld({matchUpsMap:i,structureId:e}),{roundProfile:u}=En({matchUps:l}),c={};return a==null||a.forEach(d=>{var R,N,A;let{structureId:p,roundNumber:m}=d.source,{feedProfile:h,groupedOrder:f,positionInterleave:g,roundNumber:v}=d.target,y=s[p],I=(R=y[1])==null?void 0:R.drawPositions,b=(N=y[m])==null?void 0:N.matchUpsCount;if(!b)return;let S=b?I.length/b:0,w=I.length/S,U=I.slice(),T=RW({roundPositionsCount:w,groupedOrder:f}),D=(T==null?void 0:T.length)||1;if(D<=w){let M=I.length/D,C=Rr(U,M);h===Od&&C.forEach(O=>O.reverse()),U=(T==null?void 0:T.length)&&(T==null?void 0:T.map(O=>C[O-1]).flat())||U}let P=Rr(U,S);if(g){let M=Te(0,g.interleave).map(()=>{}),C=Te(0,g.offset).map(()=>{});P=P.map(k=>[k,...M]),P.unshift(C),P=P.flat(1);let O=P.length-g.offset;P=P.slice(0,O)}c[v]||(c[v]={});let E=(A=u==null?void 0:u[v])!=null&&A.feedRound?2:1;P.forEach((M,C)=>{let O=1+C*E;c[v][O]||(c[v][O]=kU(M))})}),{sourceDrawPositionRanges:c}}function EW({drawDefinition:t}){if(typeof t!="object")return{error:Xp};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((o,s)=>{let{stage:l}=s;return o[l]?o[l].push(s):o[l]=[s],o},{});for(let o of Object.keys(n)){let s=n[o].find(({stageSequence:u})=>u===1);if(!s)continue;let{structureId:l}=s;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:o})}return{exitProfiles:e};function a({exitProfiles:o,exitProfile:s,structureId:l,targetRound:u,aggregator:c,stage:d}){o[l]||(o[l]=[]),s==="0"&&[rn,$i].includes(d)||o[l].push(s);let p=r.filter(m=>m.source.structureId===l&&m.source.roundNumber>=u);for(let m of p){let h=m.source.roundNumber,f=m.target.roundNumber,g=m.target.structureId,v=i.find(I=>I.structureId===g).stage,y=[v,g,f,h].join("|");if(c[y])return;c[y]=!0,a({exitProfile:`${s}-${h}`,structureId:g,exitProfiles:o,targetRound:f,aggregator:c,stage:v})}}}function Yoe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){var o;if(!t)return{error:Le};if(!i)return{error:Wa};if(!e){let s=Ld({matchUpsMap:r,structureId:i});if({roundProfile:e}=En({matchUps:s}),!e)return{error:Xe}}let n=(Math.min(...((o=e==null?void 0:e[1])==null?void 0:o.drawPositions)??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{var v,y;let l=(v=e==null?void 0:e[s])==null?void 0:v.matchUpsCount,u=((y=e==null?void 0:e[1])==null?void 0:y.drawPositions)??[],c=Rr(u,u.length/l),d=c.map(kU),p=c.map(I=>I.map(b=>b-n)).map(kU),m=a.map(I=>{var S;if(I>s)return;let b=((S=e==null?void 0:e[I])==null?void 0:S.drawPositions)??[];return Rr(b,b.length/l)}).filter(Boolean),h=Te(0,l).map(I=>m.map(b=>b[I]).flat().filter(Boolean).sort(sr)).map(I=>ct(I)),f=h.map(I=>wne(I).map(kU).join(", ")),g=Object.assign({},...Te(0,l).map(I=>({[I+1]:{firstRoundDrawPositionsRange:d[I],firstRoundOffsetDrawPositionsRange:p[I],possibleDrawPositions:h[I],drawPositionsRange:f[I]}})));return{[s]:g}}))}}function LA({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){var a;if(!i)return!1;r=r??i.matchUps??[],t=t??En({matchUps:r}).roundsNotPowerOf2;let n=!!((a=i.positionAssignments)!=null&&a.find(({drawPosition:o})=>o))||!!(r!=null&&r.find(({drawPositions:o})=>o==null?void 0:o.length));return(!(e!=null&&e.drawType)||e.drawType!==cp)&&!(i!=null&&i.structures)&&t&&n}function zn({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(n=>n==null?void 0:n.roundPosition)),r=!!(e!=null&&e.find(n=>{var a;return(a=n==null?void 0:n.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==Or&&(!e.length||!i&&!r)}var CW={[_f]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Oe]:"",[$i]:"P",[Ke]:"Q",[rn]:"C"}}},Koe=CW;function Joe({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){var R,N,A;let{roundProfile:n,roundMatchUps:a}=En({matchUps:r}),{structureAbbreviation:o,stage:s}=i,l=zn({structure:i}),u=LA({structure:i}),c=i.structures,d={},p=CW[_f],m=i.stage===Ke,h=m?Math.max(...((e==null?void 0:e.structures)??[]).filter(M=>M.stage===Ke).map(({stageSequence:M})=>M??1),0):0,f=(i.stageSequence??1)<h?i.stageSequence??1:"",g=f&&(((R=t==null?void 0:t.affixes)==null?void 0:R.preQualifying)||p.affixes.preQualifying)||"",v=(t==null?void 0:t.roundNamingMap)||p.roundNamingMap||{},y=(t==null?void 0:t.abbreviatedRoundNamingMap)||p.abbreviatedRoundNamingMap||{},I=((N=t==null?void 0:t.affixes)==null?void 0:N.preFeedRound)||p.affixes.preFeedRound,b=((A=t==null?void 0:t.affixes)==null?void 0:A.roundNumber)||p.affixes.roundNumber,S=((t==null?void 0:t.namingConventions)||p.namingConventions).round,w=s&&s!==Oe?s[0]:"",U=(t==null?void 0:t.stageConstants)||p.stageConstants,T=s&&(U==null?void 0:U[s])||w,D=`${g}${T}${f}`,P=n?Object.keys(n):[],E=m&&(U!=null&&U[Ke])?`${U==null?void 0:U[Ke]}-`:"";if(c||l||u)Object.assign(d,...P.map(M=>{let C=`${E}${S} ${M}`,O=`${b}${M}`;return{[M]:{roundName:C,abbreviatedRoundName:O}}}));else{let M=m&&((t==null?void 0:t.qualifyingFinishMap)||(p==null?void 0:p.qualifyingFinishMap)||{});Object.assign(d,...P.map(C=>{if(!(n!=null&&n[C]))return;let{matchUpsCount:O,preFeedRound:k}=n[C],x=O*2,F=(M==null?void 0:M[n==null?void 0:n[C].finishingRound])||M&&`${b}${x}`||v[O]||`${b}${x}`,$=k?`-${I}`:"",_=`${F}${$}`,L=[D,o,_].filter(Boolean).join("-"),B=`${y[O]||`${b}${x}`}${$}`,V=[D,o,B].filter(Boolean).join("-");return{[C]:{abbreviatedRoundName:V,roundName:L}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}var Xoe=(t,e)=>(t||0)+(e||0);function MW(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&TW||i<=e[_I]&&_I||i<=e[LI]&&LI||OA}function NW({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(Xoe)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function Qoe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function AW(t){return t.map(Qoe).sort().map(e=>parseFloat(e.toFixed(2)))}function nb({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:aa};let{score:r,winningSide:n}=i;if(!n)return{error:se};let a=!e&&t&&hp({policyType:lu,tournamentRecord:t}).policy,o=e||(a==null?void 0:a.profileBands)||kA[lu].profileBands,s=NW({score:r}),l=AW([s]),u=MW(l,o),c=Array.isArray(l)?l[0]:l;return{...X,competitiveness:u,pctSpread:c}}function OW({matchUp:t}){var o,s,l;if(!t)return{error:aa};if(t&&!t.sides)return{error:oa};if(t&&!t.hasContext)return{error:Y0};let e=(o=t.sides??[])==null?void 0:o.map(u=>u==null?void 0:u.participantId).filter(Boolean),i=((s=t.sides)==null?void 0:s.filter(u=>{var c;return((c=u.participant)==null?void 0:c.participantType)===St}).map(u=>u.participantId).filter(Boolean))??[],r=(((l=t.sides??[])==null?void 0:l.map(u=>{var c;return(c=u.participant)==null?void 0:c.individualParticipants}).filter(Boolean))??[]).map(u=>(u??[]).map(c=>c==null?void 0:c.participantId).filter(Boolean)),n=[...i,...r.flat()].filter(Boolean)??[],a=ct(n.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:a,individualParticipantIds:n,sideParticipantIds:e,...X}}var TS="CHECK_IN",DS="CHECK_OUT",Zoe="SCHEDULE",nh="SCHEDULE.ASSIGNMENT.VENUE",Wl="SCHEDULE.ALLOCATION.COURTS",Ec="SCHEDULE.ASSIGNMENT.COURT",NT="SCHEDULE.COURT.ORDER",ah="SCHEDULE.DATE",ese="COMPLETED.DATE",_A="HOME_PARTICIPANT_ID",$A="SCHEDULE.ASSIGN.OFFICIAL",oh="SCHEDULE.TIME.SCHEDULED",Is="SCHEDULE.TIME.START",vu="SCHEDULE.TIME.STOP",Nl="SCHEDULE.TIME.RESUME",Cu="SCHEDULE.TIME.END",AT="SCHEDULE.TIME.MODIFIERS",kW="TO_BE_ANNOUNCED",xW="NEXT_AVAILABLE",FW="FOLLOWED_BY",LW="AFTER_REST",_W="RAIN_DELAY",tse="NOT_BEFORE",kC=[kW,xW,FW,LW,_W],ise="ELIGIBILITY",rse="REGISTRATION",nse="SUSPENSION",ase="MEDICAL",ose="PENALTY",$W="SCALE",BW="RATING",VW="RANKING",BA="SEEDING",Kc="PUBLISH",Ya="PUBLIC",Jc="STATUS",sse="MODIFICATION",lse="RETRIEVAL",use="other",cse={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:kC,AFTER_REST:LW,ALLOCATE_COURTS:Wl,ASSIGN_COURT:Ec,ASSIGN_OFFICIAL:$A,ASSIGN_VENUE:nh,CHECK_IN:TS,CHECK_OUT:DS,COMPLETED_DATE:ese,COURT_ORDER:NT,ELIGIBILITY:ise,END_TIME:Cu,FOLLOWED_BY:FW,MEDICAL:ase,MODIFICATION:sse,NEXT_AVAILABLE:xW,NOT_BEFORE:tse,OTHER:use,PENALTY:ose,PUBLIC:Ya,PUBLISH:Kc,RANKING:VW,RATING:BW,RAIN_DELAY:_W,REGISTRATION:rse,RESUME_TIME:Nl,RETRIEVAL:lse,SCALE:$W,SCHEDULE:Zoe,SCHEDULED_DATE:ah,SCHEDULED_TIME:oh,SEEDING:BA,START_TIME:Is,STATUS:Jc,STOP_TIME:vu,SUSPENSION:nse,TIME_MODIFIERS:AT,TO_BE_ANNOUNCED:kW};function sh({matchUp:t}){if(!t)return{error:aa};if(!t.hasContext)return{error:Y0};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:oa};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=OW({matchUp:t}),n=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[TS,DS].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(s=>s.itemValue).filter(s=>n.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===TS);e==null||e.forEach((s,l)=>{let u=r==null?void 0:r[l],c=(s==null?void 0:s.length)&&s.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),r==null||r.forEach((s,l)=>{a.includes(s)&&((e==null?void 0:e[l])??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let o=r==null?void 0:r.reduce((s,l)=>a.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...X}}var Yi=t=>e=>{let i=Nt(e)&&(e==null?void 0:e.matchUpType)||Di(e)&&e;return i&&dG[t].includes(i)};function Qv(t){var a;let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},r=(e==null?void 0:e.map(({matchUpFormatCodes:o})=>o==null?void 0:o.filter(s=>s===i)).flat().filter(Boolean).sort((o,s)=>((o==null?void 0:o.length)||0)-((s==null?void 0:s.length)||0)))||[],n=r.includes(i)?i:r[0];return(a=e==null?void 0:e.find(({matchUpFormatCodes:o,averageTimes:s})=>(o==null?void 0:o.find(l=>n===l))&&s))==null?void 0:a.averageTimes}function Zv(t){var n;let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:r}=t||{};return(n=e==null?void 0:e.find(({matchUpFormatCodes:a,averageTimes:o,recoveryTimes:s})=>{if(o&&i){let{greaterThan:l=0,lessThan:u=360}=o;if(i>l&&i<u)return!0}return(a==null?void 0:a.find(l=>l===r))&&s}))==null?void 0:n.recoveryTimes}function jW({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>{var o,s;return(((o=a.categoryNames)==null?void 0:o.length)||0)-(((s=n.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:n,categoryNames:a})=>!(a!=null&&a.length)&&!(n!=null&&n.length)||(a==null?void 0:a.includes(e))||(n==null?void 0:n.includes(i)))).find(Boolean)}function dse({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:o,policy:s}){var p;let l=(e==null?void 0:e.matchUpRecoveryTimes)&&Zv({...e,averageMinutes:i,matchUpFormat:n}),u=(t==null?void 0:t.matchUpRecoveryTimes)&&Zv({...t,averageMinutes:i,matchUpFormat:n}),c=(s==null?void 0:s.matchUpRecoveryTimes)&&Zv({...s,averageMinutes:i,matchUpFormat:n}),d=[l,u,c,(p=s==null?void 0:s.defaultTimes)==null?void 0:p.recoveryTimes,r==null?void 0:r.recoveryTimes];return jW({categoryName:a,categoryType:o,timesBlockArray:d})}function pse({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:o}){var d;let s=(a==null?void 0:a.matchUpAverageTimes)&&Qv({...a,matchUpFormat:t}),l=(n==null?void 0:n.matchUpAverageTimes)&&Qv({...n,matchUpFormat:t}),u=(o==null?void 0:o.matchUpAverageTimes)&&Qv({...o,matchUpFormat:t}),c=[s,l,u,(d=o==null?void 0:o.defaultTimes)==null?void 0:d.averageTimes,r==null?void 0:r.averageTimes];return jW({categoryName:e,categoryType:i,timesBlockArray:c})}var GW="DOUBLES_SINGLES",HW="SINGLES_DOUBLES",Ho="total",xC="participantConflict",lc="matchUpConflict",zW="ISSUE_IDS",dd="CONFLICT",pd="WARNING",FC="ERROR",LC="ISSUE",xU="STATE",mse={SINGLES_DOUBLES:HW,DOUBLES_SINGLES:GW,TOTAL:Ho,CONFLICT_MATCHUP_ORDER:lc,CONFLICT_PARTICIPANTS:xC,SCHEDULE_ISSUE_IDS:zW,SCHEDULE_CONFLICT:dd,SCHEDULE_WARNING:pd,SCHEDULE_ERROR:FC,SCHEDULE_ISSUE:LC,SCHEDULE_STATE:xU};function ab({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:s}){if(!i)return{error:ge};o=o??(s==null?void 0:s.eventType)??Um;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=Jy({tournamentRecord:i,categoryName:n,categoryType:a,event:s}),c={...u,matchUpFormat:r,categoryType:a,defaultTiming:l};return OT({eventType:o,timingDetails:c})}function OT({timingDetails:t,eventType:e}){let i=pse(t),r=Object.keys((i==null?void 0:i.minutes)||{}),n=(i==null?void 0:i.minutes)&&((r==null?void 0:r.includes(e))&&i.minutes[e]||i.minutes.default),a=dse({...t,averageMinutes:n}),o=Object.keys((a==null?void 0:a.minutes)||{}),s=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),l=Yi(Um)(e)?HW:GW,u=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(l))&&a.minutes[l]||s);return{averageMinutes:n,recoveryMinutes:s,typeChangeRecoveryMinutes:u}}function uE(t){return t.createdAt?new Date(t.createdAt).getTime():0}function vp({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>uE(n)-uE(a)).pop(),r=i&&uE(i);return{itemValue:i==null?void 0:i.itemValue,timeStamp:r}}function WW({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=vp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:oh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function lh({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=vp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:ah});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function Bp(t){if(zH.test(t)){let e=VN();return new Date(`${e}T${t}`)}else return new Date(t)}function hse({matchUp:t}){if(!t)return{error:aa};if(!t.timeItems)return{error:MN};let e=t.timeItems.filter(r=>[Is,vu,Nl,Cu].includes(r==null?void 0:r.itemType)).sort((r,n)=>Bp(r.itemValue).getTime()-Bp(n.itemValue).getTime()),i=e.reduce((r,n)=>{var l,u;let a,o=(l=n==null?void 0:n.itemType)==null?void 0:l.split("."),s=`SCHEDULE.TIME.${((u=n==null?void 0:n.itemType)==null?void 0:u.startsWith("SCHEDULE.TIME"))&&o[2]}`;switch(s){case Is:a=0;break;case Cu:if(r.lastValue&&[Is,Nl].includes(r.lastType)){let c=Bp(n.itemValue).getTime()-Bp(r.lastValue).getTime();a=r.milliseconds+c}else a=r.milliseconds;break;case vu:if([Is,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let c=Bp(n.itemValue).getTime()-Bp(r.lastValue).getTime();a=r.milliseconds+c}else a=r.milliseconds;break;default:a=r.milliseconds;break}return{milliseconds:a,lastType:s,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([Is,Nl].includes(i.lastType)){let r=new Date().getTime()-Bp(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:fse(i.milliseconds),relevantTimeItems:e}}function fse(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function gse({matchUp:t}){var r;let e=(t==null?void 0:t.timeItems)||[],i=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{startTime:(r=e.reduce((n,a)=>{let o=a.itemType===Is&&a;return o&&(!n||i(o)<i(n))?o:n},void 0))==null?void 0:r.itemValue}}function ob(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:se};let n=bo(t);i.venueId||(i.venueId=Gt());let a;for(let o of Object.values(n)){let s=vse({disableNotice:!0,tournamentRecord:o,context:r,venue:i});if(s!=null&&s.error)return s;a=s.venue}return e||lt({topic:vA,payload:{venue:i}}),je({...X,venue:a})}function vse({tournamentRecord:t,disableNotice:e,context:i,venue:r}){return t?r?(t.venues||(t.venues=[]),r.venueId||(r.venueId=Gt()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0)?{error:mH}:(i&&Lt({element:r,extension:{value:i,name:Jz}}),t.venues.push(r),e||lt({payload:{venue:r,tournamentId:t.tournamentId},topic:vA}),{...X,venue:Ce(r)})):{error:Xe,info:"missing venue"}:{error:ge}}function tu({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:ge};if(!i)return{error:Gc};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(Wy({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let o=t[a],s=tu({tournamentRecord:o,venueId:i});if(s.success&&s.venue)return ob({tournamentRecord:e,venue:s.venue}),{...X,venue:r}}}return r?{...X,venue:r}:{error:Jm}}function VA({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=tu({tournamentRecords:i,tournamentRecord:r,venueId:n});return Ce(a,t,!0)}function uh({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:ge};if(!i)return{error:qm};let r="findCourt",n,a;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(s=>{s.courtId===i&&(n=s,a=o)})}),n)return{...X,court:n,venue:a};if(t){let o=(Wy({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of o){let l=t[s],u=uh({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&ob({tournamentRecord:e,venue:u.venue}),{...X,court:n,venue:a}}}return ee({result:{error:Ag},stack:r})}function jA(t){return Ce(uh(t),!1,!0)}function kT({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:ge};if(!i)return{error:qm};let r=uh({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f})=>({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f}))(r.court);return{...X,courtInfo:Ce(n,!1,e)}}function jf(t){var l;let e=ze(t,[{[wr]:!0},{venueId:!0,[jo]:Gc}]);if(e.error)return e;let{tournamentRecord:i,venueId:r}=t,n=tu({tournamentRecord:i,venueId:r});if(n.error)return n;let a=(((l=n.venue)==null?void 0:l.courts)??[]).map(u=>(({courtInfo:c})=>({...c}))(kT({courtId:u.courtId,internalUse:!0,tournamentRecord:i}))),o=n.venue&&(({venueId:u,venueName:c,venueAbbreviation:d})=>({venueAbbreviation:d,venueName:c,venueId:u}))(n.venue),s=o&&{...o,courtsInfo:a};return{...X,venueData:Ce(s,!1,!0)}}function Ise({matchUp:t}){var r;let e=(t==null?void 0:t.timeItems)||[],i=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{endTime:(r=e.reduce((n,a)=>{let o=a.itemType===Cu&&a;return o&&(!n||i(o)>i(n))?o:n},void 0))==null?void 0:r.itemValue}}function Gi({event:t,eventId:e}){var n,a;if(!t)return{error:vi};let i=(n=vt({name:ts,element:t}))==null?void 0:n.extension,r=e?Ce(i==null?void 0:i.value,!1,!0):i==null?void 0:i.value;return e&&((a=t.drawDefinitions)==null||a.forEach(o=>{var s;(s=r==null?void 0:r.flights)==null||s.forEach(l=>{l.drawId===o.drawId&&Object.assign(l,{drawDefinition:o})})})),{flightProfile:r}}function Wn(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},o=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(o).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(r){let u,c=s.find(d=>{var m,h,f;let p=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===r);if(p)u=p,l=a[d.eventId].tournamentId;else{let g=(f=(h=d&&((m=Gi({event:d}))==null?void 0:m.flightProfile))==null?void 0:h.flights)==null?void 0:f.find(v=>v.drawId===r);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:r}}return p});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=s.find(c=>(c==null?void 0:c.eventId)===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...ee({result:{error:co},stack:n})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...ee({result:{error:Fa},context:{drawId:r,eventId:i},stack:n})}}function xT(t){var S,w,U,T,D,P,E,R,N,A;let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:o,scheduleTiming:s,matchUpFormat:l,publishStatus:u,matchUp:c}=t;if(!c)return{error:aa};if(n&&!c.matchUpType&&!t.matchUpType&&(e||a)&&c.drawId){let M=t.drawDefinition||((S=e==null?void 0:e.drawDefinitions)==null?void 0:S.find(O=>O.drawId===c.drawId));!M&&a&&({drawDefinition:M,event:e}=Wn({drawId:c.drawId,tournamentRecord:a}));let C=c.structureId&&((w=M==null?void 0:M.structures)==null?void 0:w.find(({structureId:O})=>O===c.structureId));i=t.matchUpType||(C==null?void 0:C.matchUpType)||(M==null?void 0:M.matchUpType)||(e==null?void 0:e.eventType)!==lr&&(e==null?void 0:e.eventType)}let{milliseconds:d,time:p}=hse({matchUp:c}),{startTime:m}=gse({matchUp:c}),{endTime:h}=Ise({matchUp:c}),f,{eventIds:g,drawIds:v}=r??{};if((!g||g.includes(c.eventId))&&(!v||v.includes(c.drawId))){let M=ne=>ne.createdAt?new Date(ne.createdAt).getTime():0,C=new Map,O=((U=c.timeItems)==null?void 0:U.toSorted((ne,de)=>M(ne)-M(de)))??[];for(let ne of O)C.set(ne.itemType,ne.itemValue);let k=C.get(_A),x=C.get(Wl),F=C.get(oh),$=C.get(AT),_=C.get(ah),L=C.get($A),B=C.get(NT),V=C.get(nh),G=C.get(Ec),j,z,W,q,Y,re=c.matchUpType??i;if(s&&F&&n&&re){let ne={matchUpFormat:c.matchUpFormat??l,...s};({averageMinutes:z=0,recoveryMinutes:W=0,typeChangeRecoveryMinutes:q=0}=OT({timingDetails:ne,eventType:re})),(z||W)&&(j=h?ra(wi(h),W):ra(F,z+W)),q&&(Y=h?ra(wi(h),q):ra(F,z+q))}!_&&F&&(_=mt(F));let J=hS({scheduledDate:_,scheduledTime:F}),H={},Z=((T=a&&V&&jf({tournamentRecord:a,venueId:V}))==null?void 0:T.venueData)||{};V&&(H[V]=Z);let{venueName:K,venueAbbreviation:ie,courtsInfo:ae}=Z,oe=(D=G&&(ae==null?void 0:ae.find(ne=>ne.courtId===G)))==null?void 0:D.courtName;for(let ne of x||[]){if(!a)break;ne.venueId&&!H[ne.venueid]&&(H[ne.venueId]=(P=jf({venueId:ne.venueId,tournamentRecord:a}))==null?void 0:P.venueData);let de=H[ne.venueId];ne.venueName=de==null?void 0:de.venueName;let ye=(E=de==null?void 0:de.courtsInfo)==null?void 0:E.find(ce=>ce.courtId===ne.courtId);ne.courtName=ye==null?void 0:ye.courtName}f=je({typeChangeTimeAfterRecovery:Y,timeAfterRecovery:j,scheduledDate:_,scheduledTime:F,isoDateString:J,homeParticipantId:k,venueAbbreviation:ie,allocatedCourts:x,timeModifiers:$,venueName:K,venueId:V,courtOrder:B,courtName:oe,courtId:G,official:L,typeChangeRecoveryMinutes:q,recoveryMinutes:W,averageMinutes:z,milliseconds:d,startTime:m,endTime:h,time:p})}else f=je({milliseconds:d,startTime:m,endTime:h,time:p});let{scheduledDate:y}=lh({matchUp:c}),{scheduledTime:I}=WW({matchUp:c});if(o&&((R=u==null?void 0:u.displaySettings)!=null&&R.draws)){let M=u.displaySettings.draws,C=(N=(M==null?void 0:M[c.drawId])??(M==null?void 0:M.default))==null?void 0:N.scheduleDetails;if(C){let O=(A=C.find(k=>{var x;return y&&((x=k.dates)==null?void 0:x.includes(y))})??C.find(k=>{var x;return!((x=k.dates)!=null&&x.length)}))==null?void 0:A.attributes;if(O){let k=Object.assign({},...Object.keys(f).map(x=>({[x]:!0})),O);f=Tm({source:f,template:k})}}}let b=c.matchUpStatus&&vr.includes(c.matchUpStatus)&&(mt(h)||mt(y)||mt(I))||void 0;return{schedule:f,endDate:b}}function yse({drawPositions:t,roundProfile:e,roundNumber:i}){var s;let r=[void 0,void 0];if(IG(t))return{orderedDrawPositions:r,displayOrder:r};let n=e==null?void 0:e[i],a=((s=n==null?void 0:n.pairedDrawPositions)==null?void 0:s.find(l=>Rn(l||[],t.filter(Boolean))))??r,o=n==null?void 0:n.feedRound;if(vG(t)){let l=[...t].sort(sr);return{orderedDrawPositions:l.length===2?l:a,displayOrder:o?l:a}}if(o){let l=[t.find(u=>!isNaN(et(u))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:a,displayOrder:a}}function PS({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=s=>s===void 0?-1:s,o=i.map(s=>{let{collectionAssignments:l,participantId:u}=s,c=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((s,l)=>a(s.substitutionOrder)-a(l.substitutionOrder));for(let s of o){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=s;r.includes(l)||(u&&n.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),r=r.filter(d=>d!==u),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function rs({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:ge};if(!Array.isArray(i)||i.length>2)return{error:Ia};if(!i.length)return ee({result:{error:jc},stack:r});t=t??(e==null?void 0:e.participants)??[];let n=t.filter(s=>s.participantType===ft&&Vi(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),a=n[0];if(!a)return ee({result:{error:zi},stack:r});let o=Ce(n.slice(1),!1,!0);return{participant:Ce(a),duplicatedPairParticipants:o,...X}}function _d({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:Le};if(typeof e!="string")return{error:mr};let{extension:i}=vt({element:t,name:Du});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function bse({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:m})=>{var g,v,y,I;let{assignedParticipantIds:h,substitutions:f}=PS({collectionPosition:i,collectionId:o,lineUp:p});if(l===Zt){if((h==null?void 0:h.length)<=2){let b=(v=(g=n==null?void 0:n[h[0]])==null?void 0:g.pairIdMap)==null?void 0:v[h[1]],S=(I=b&&((y=n[b])==null?void 0:y.participant)||rs({participantIds:h,tournamentParticipants:t}).participant)==null?void 0:I.participantId;return{[d]:{participantId:S,teamParticipant:m,substitutions:f}}}else if((h==null?void 0:h.length)>2)return{[d]:{teamParticipant:m,substitutions:f}}}else{let b=h==null?void 0:h[0];return b&&{[d]:{participantId:b,teamParticipant:m,substitutions:f}}}};if(!(r!=null&&r.length)){let d=(s==null?void 0:s.map(p=>{var g;let{teamParticipant:m,sideNumber:h}=p,f=p.lineUp||((g=_d({participantId:m.teamParticipantId,drawDefinition:a}))==null?void 0:g.lineUp);return u({attribute:h,lineUp:f,teamParticipant:m})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=(r==null?void 0:r.map(d=>{var g,v,y;let p=(g=e.find(I=>I.drawPosition===d))==null?void 0:g.participantId,m=s==null?void 0:s.find(I=>(I==null?void 0:I.drawPosition)===d),h=(m==null?void 0:m.teamParticipant)||p&&((v=n==null?void 0:n[p])==null?void 0:v.participant)||(t==null?void 0:t.find(({participantId:I})=>I===p)),f=(m==null?void 0:m.lineUp)||((y=_d({participantId:p,drawDefinition:a}))==null?void 0:y.lineUp);return u({attribute:d,lineUp:f,teamParticipant:h})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function FT(t){var n,a,o;let e=ze(t,[{[eu]:!0}]);if(e.error)return e;let i=t==null?void 0:t.matchUp,r=i==null?void 0:i.matchUpType;if(!r&&((n=i==null?void 0:i.sides)!=null&&n.length)){let s=(o=(a=i.sides.find(({participant:l})=>l))==null?void 0:a.participant)==null?void 0:o.participantType;r=s===St&&ii||s===ft&&Zt||s===Kt&&Kt||void 0}return{matchUpType:r}}function wse({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:o,sideNumber:s}){var m,h,f,g;let l=i.find(v=>v.drawPosition&&v.drawPosition===a),u=a&&t,c=s&&e,d=u?(m=u[a])==null?void 0:m.participantId:l==null?void 0:l.participantId,p=l?Use({displaySideNumber:r,seedAssignments:n,participantId:d,assignment:l,sideNumber:s}):{...c==null?void 0:c[s]};if(o&&(s===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&u){let v=(h=u[a])==null?void 0:h.teamParticipant,y=(f=u[a])==null?void 0:f.participant,I=(g=u[a])==null?void 0:g.substitutions;y&&(p.participant=y),I&&(p.substitutions=I),v&&(p.teamParticipant=v)}return p}function Use({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let o=Sse({seedAssignments:e,participantId:i});Object.assign(a,o,{participantId:i}),o!=null&&o.seedNumber&&(o==null?void 0:o.seedValue)===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function Sse({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}function qW({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:o,initialRoundOfPlay:s,additionalContext:l,roundNamingProfile:u,tournamentRecord:c,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:m,seedAssignments:h,usePublishState:f,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:I,drawDefinition:b,publishStatus:S,scoringActive:w,matchUpTieId:U,isRoundRobin:T,roundProfile:D,sideLineUps:P,structure:E,context:R,matchUp:N,event:A}){var He,ue,me,Ue,$e,Ee,Be,xe,qe,Pe,at,di,Ae,yt,yi;l=l??{};let M=(He=vn({drawDefinition:b,structure:E,matchUp:N,event:A}))==null?void 0:He.tieFormat,{roundOffset:C,structureId:O,structureName:k,stage:x,stageSequence:F}=E,{drawId:$,drawName:_,drawType:L}=b??{},B=M==null?void 0:M.collectionDefinitions,V=N.collectionId&&(B==null?void 0:B.find(be=>be.collectionId===N.collectionId)),G=N.collectionId?V==null?void 0:V.matchUpFormat:N.matchUpFormat??(E==null?void 0:E.matchUpFormat)??(b==null?void 0:b.matchUpFormat)??(A==null?void 0:A.matchUpFormat),j=N.matchUpType||(V==null?void 0:V.matchUpType)||(E==null?void 0:E.matchUpType)||(b==null?void 0:b.matchUpType)||!Yi(lr)(A==null?void 0:A.eventType)&&(A==null?void 0:A.eventType),z=m?Vt:N.matchUpStatus,{schedule:W,endDate:q}=xT({scheduleVisibilityFilters:t,afterRecoveryTimes:o,tournamentRecord:c,usePublishState:f,scheduleTiming:y,drawDefinition:b,matchUpFormat:G,publishStatus:S,matchUpType:j,matchUp:N,event:A}),Y=d??N.drawPositions??[],{collectionPosition:re,collectionId:J,roundPosition:H}=N,Z=N.roundNumber??l.roundNumber,K=J?bse({tournamentParticipants:i,positionAssignments:r,collectionPosition:re,participantMap:g,drawDefinition:b,drawPositions:Y,collectionId:J,sideLineUps:P,matchUpType:j}):void 0,ie=((ue=u==null?void 0:u[Z])==null?void 0:ue.roundName)||l.roundName,ae=((me=u==null?void 0:u[Z])==null?void 0:me.abbreviatedRoundName)||l.abbreviatedRoundName,oe=(Ue=D==null?void 0:D[Z])==null?void 0:Ue.feedRound,ne=($e=D==null?void 0:D[Z])==null?void 0:$e.preFeedRound,de=(Ee=D==null?void 0:D[Z])==null?void 0:Ee.roundFactor,ye=n==null?void 0:n[Z],ce=H?ye==null?void 0:ye[H]:void 0,ke=e==null?void 0:e[Z],we=V!=null&&V.category?{...(R==null?void 0:R.category)||{},...V.category}:(R==null?void 0:R.category)??(A==null?void 0:A.category),Ze=((Be=N.processCodes)==null?void 0:Be.length)&&N.processCodes||((xe=V==null?void 0:V.processCodes)==null?void 0:xe.length)&&(V==null?void 0:V.processCodes)||((qe=E==null?void 0:E.processCodes)==null?void 0:qe.length)&&(E==null?void 0:E.processCodes)||((Pe=b==null?void 0:b.processCodes)==null?void 0:Pe.length)&&(b==null?void 0:b.processCodes)||((at=A==null?void 0:A.processCodes)==null?void 0:at.length)&&(A==null?void 0:A.processCodes)||(c==null?void 0:c.processCodes),pt=(I==null?void 0:I.withCompetitiveness)&&nb({...v,matchUp:N}),he=N.finishingPositionRange??l.finishingPositionRange,fe=be=>je(be,void 0,!0),pe={...fe(R),...fe({matchUpFormat:N.matchUpType===lr?void 0:G,tieFormat:N.matchUpType!==lr?void 0:M,gender:(V==null?void 0:V.gender)??(A==null?void 0:A.gender),roundOfPlay:x!==Ke&&ot(s)&&s+(Z||0),endDate:N.endDate??q,discipline:A==null?void 0:A.discipline,category:we,finishingPositionRange:he,abbreviatedRoundName:ae,drawPositionsRange:ce,competitiveProfile:pt,structureName:k,stageSequence:F,drawPositions:Y,matchUpStatus:z,processCodes:Ze,isRoundRobin:T,matchUpTieId:U,preFeedRound:ne,matchUpType:j,roundFactor:de,roundOffset:C,structureId:O,roundNumber:Z,feedRound:oe,roundName:ie,drawName:_,drawType:L,schedule:W,drawId:$,stage:x}),...Ce(fe(N),!0,!0)};if(G&&((di=N.score)!=null&&di.scoreStringSide1)){let be=kn(G),{bestOf:Ct,finalSetFormat:Re,setFormat:Ye}=be??{};(Re!=null&&Re.tiebreakSet||Ye!=null&&Ye.tiebreakSet||Ye!=null&&Ye.timed)&&(pe.score.sets=pe.score.sets.sort((xt,Fi)=>xt.setNumber-Fi.setNumber).map((xt,Fi)=>(Fi+1===Ct?(Re!=null&&Re.tiebreakSet||Re!=null&&Re.timed)&&(xt.tiebreakSet=!0):(Ye!=null&&Ye.tiebreakSet||Ye!=null&&Ye.timed)&&(xt.tiebreakSet=!0),xt)))}if(Array.isArray(Y)){let{orderedDrawPositions:be,displayOrder:Ct}=yse({drawPositions:Y,roundProfile:D,roundNumber:Z}),Re=(Ae=D==null?void 0:D[Z])==null?void 0:Ae.feedRound,Ye=Ct[0]!==be[0],xt=be.concat(void 0,void 0).slice(0,2).map((Fi,bi)=>{var $p;let pi=bi+1,Li=Ye?3-pi:pi,un=wse({...K,positionAssignments:r,displaySideNumber:Li,seedAssignments:h,drawPosition:Fi,isFeedRound:Re,sideNumber:pi}),er=($p=N.sides)==null?void 0:$p.find(lE=>lE.sideNumber===pi),Qn=H?(H-1)*2+bi+1:void 0,to=Qn?ke==null?void 0:ke[Qn]:void 0;return fe({sourceDrawPositionRange:to,...er,...un})});Object.assign(pe,Ce({sides:xt},!0,!0))}if(i&&pe.sides){let be=p==null?void 0:p[Gy],Ct=Re=>{var xt;let Ye=(xt=g==null?void 0:g[Re])==null?void 0:xt.participant;return Ye&&Tm({template:be==null?void 0:be.participant,source:Ye})};if(pe.sides.filter(Boolean).forEach(Re=>{var Ye,xt,Fi,bi;if(Re.participantId){let pi=Ce(Ct(Re.participantId)||(i?Sc({policyDefinitions:p,participantId:Re.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:I}):void 0),void 0,!0);if(pi){let Li,un;if(b!=null&&b.entries){let er=b.entries.find(to=>to.participantId===Re.participantId),Qn=(Ye=A==null?void 0:A.entries)==null?void 0:Ye.find(to=>to.participantId===Re.participantId);Li=(er==null?void 0:er.entryStatus)||(Qn==null?void 0:Qn.entryStatus),pi.entryStatus=Li,er!=null&&er.entryStage&&(un=er.entryStage,pi.entryStage=un)}a!==!1?Object.assign(Re,{participant:pi}):Object.assign(Re,{participant:{entryStage:un,entryStatus:Li}})}}if((Fi=(xt=Re==null?void 0:Re.participant)==null?void 0:xt.individualParticipantIds)!=null&&Fi.length&&!((bi=Re.participant.individualParticipants)!=null&&bi.length)){let pi=Re.participant.individualParticipantIds.map(Li=>Ct(Li)||(i?Sc({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:I,participantId:Li}):void 0));a!==!1&&Object.assign(Re.participant,{individualParticipants:pi})}}),!pe.matchUpType){let{matchUpType:Re}=FT({matchUp:pe});Re&&Object.assign(pe,{matchUpType:Re})}if(I!=null&&I.inferGender&&(!pe.gender||pe.gender===Bn)&&((yt=pe.sides)==null?void 0:yt.length)===2&&pe.matchUpType!==lr){let Re=pe.sides.map(Ye=>{var xt,Fi,bi,pi;if(Yi(ii)(pe.matchUpType))return(Fi=(xt=Ye.participant)==null?void 0:xt.person)==null?void 0:Fi.sex;if(((pi=(bi=Ye.participant)==null?void 0:bi.individualParticipants)==null?void 0:pi.length)===2){let Li=ct(Ye.participant.individualParticipants.map(un=>{var er;return(er=un.person)==null?void 0:er.sex})).filter(Boolean);if(Li.length===1)return Li[0]}});if(Re.filter(Boolean).length===2&&ct(Re).length===1){let Ye=Re[0];pe.inferredGender=Ye}}}if(pe.tieMatchUps){let be=pe.matchUpStatus===Vt,Ct=(yi=pe.sides)==null?void 0:yi.map(({participant:Re,drawPosition:Ye,sideNumber:xt,lineUp:Fi})=>{let bi=(Re==null?void 0:Re.participantType)===lr&&Re;return{teamParticipant:bi&&je({participantRoleResponsibilities:bi.participantRoleResponsibilities,participantOtherName:bi.participanOthertName,participantName:bi.participantName,participantId:bi.participantId,teamId:bi.teamId}),drawPosition:Ye,sideNumber:xt,lineUp:Fi}});pe.tieMatchUps=pe.tieMatchUps.map(Re=>{let Ye=pe.matchUpId,xt={finishingPositionRange:pe.finishingPositionRange,abbreviatedRoundName:ae,roundNumber:Z,roundName:ie};return qW({tieDrawPositions:Y,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:Ct,drawPositionsRanges:n,initialRoundOfPlay:s,roundNamingProfile:u,additionalContext:xt,appliedPolicies:p,isCollectionBye:be,usePublishState:f,publishStatus:S,matchUpTieId:Ye,isRoundRobin:T,roundProfile:D,matchUp:Re,event:A,tournamentParticipants:i,positionAssignments:r,tournamentRecord:c,seedAssignments:h,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:I,drawDefinition:b,scoringActive:w,structure:E,context:R})})}let Fe=pe.sides&&pe.sides.filter(be=>be==null?void 0:be.participantId).length===2,Se=!pe.winningSide;if(Object.assign(pe,{readyToScore:w&&Fe&&Se,hasContext:!0}),Fe){let{allParticipantsCheckedIn:be,checkedInParticipantIds:Ct}=sh({matchUp:pe});Object.assign(pe,{allParticipantsCheckedIn:be,checkedInParticipantIds:Ct})}return Array.isArray(I==null?void 0:I.exclude)&&(I==null||I.exclude.forEach(be=>delete pe[be])),pe}function Tse({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=vp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Wl});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:Ce(r,!1,!0)}:e}function Dse({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=vp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Ec});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function Pse({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=vp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:nh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function uu(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:o,matchUpFormats:s,roundPositions:l,matchUpFormat:u,collectionIds:c,isMatchUpTie:d,roundNumbers:p,matchUpIds:m,roundNames:h,filterMatchUpTypes:f=!0,filterMatchUpIds:g=!0,stageSequences:v,scheduledDates:y,scheduledDate:I,participantIds:b,processContext:S,tournamentIds:w,matchUpTypes:U,structureIds:T,readyToScore:D,courtIds:P,eventIds:E,venueIds:R,drawIds:N,stages:A}=t,M=Array.isArray(b)?b.filter(Boolean):[],C=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],k=Array.isArray(A)?A.filter(Boolean):[],x=Array.isArray(v)?v.filter(Boolean):[],F=Array.isArray(c)?c.filter(Boolean):[],$=Array.isArray(h)?h.filter(Boolean):[],_=Array.isArray(p)?p.filter(Boolean):[],L=Array.isArray(l)?l.filter(Boolean):[],B=Array.isArray(m)&&g?m.filter(Boolean):[],V=Array.isArray(U)&&f?U.filter(Boolean):[],G=Array.isArray(P)?P.filter(Boolean):[],j=Array.isArray(R)?R.filter(Boolean):[],z=Array.isArray(s)&&s.filter(Boolean)||typeof u=="string"&&[u]||[],W=Array.isArray(y)&&y.filter(Boolean)||typeof I=="string"&&I.length&&[I]||[],q=Array.isArray(w)?w.filter(Boolean):[],Y=Array.isArray(E)?E.filter(Boolean):[],re=Array.isArray(N)?N.filter(Boolean):[],J=Array.isArray(T)?T.filter(Boolean):[];return e.filter(H=>{var Z;if(D&&!Yi(xa)(H)&&!H.readyToScore||H.winningSide&&o&&![1,2].includes(H.winningSide)||d!==void 0&&(d&&!H.tieMatchUps||!d&&H.tieMatchUps)||n!==void 0&&(n&&!H.collectionId||!n&&H.collectionId)||k.length&&!k.includes(H.stage)||x.length&&!x.includes(H.stageSequence)||F.length&&(!H.collectionId||!F.includes(H.collectionId))||$.length&&(!H.roundName||!$.includes(H.roundName))||_.length&&(!H.roundNumber||!_.includes(H.roundNumber))||L.length&&(!H.roundPosition||!L.includes(H.roundPosition))||C.length&&(!H.matchUpStatus||!C.includes(H.matchUpStatus))||O.length&&H.matchUpStatus&&O.includes(H.matchUpStatus)||B.length&&!B.includes(H.matchUpId)||V.length&&(!H.matchUpType||!$0(V,H.matchUpType))||z.length&&(!H.matchUpFormat||!z.includes(H.matchUpFormat)))return!1;if(W!=null&&W.length){let{scheduledTime:K}=WW({matchUp:H}),{scheduledDate:ie}=lh({matchUp:H}),ae=mt(K)||ie;if(!W.find(oe=>jl(oe,ae)))return!1}if(G.length){let{courtId:K}=Dse({matchUp:H}),{allocatedCourts:ie}=Tse({matchUp:H}),ae=ie==null?void 0:ie.map(({courtId:oe})=>oe);if(!G.filter(Boolean).includes(K)||ae!=null&&ae.includes(K))return!1}if(j.length){let{venueId:K}=Pse({matchUp:H});if(!j.filter(Boolean).includes(K))return!1}if(S){if(q.length&&!q.includes(H.tournamentId)||Y.length&&!Y.includes(H.eventId)||re.length&&!re.includes(H.drawId)||J.length&&!J.includes(H.structureId))return!1;let K=((Z=H.sides)==null?void 0:Z.map(({participantId:ie})=>ie).filter(Boolean))??[];if(r&&K.length<r||M.length&&!M.some(ie=>K.includes(ie)))return!1}return!0})}function Wt(t){var G,j,z,W,q,Y,re;let{provisionalPositioning:e,tournamentRecord:i,contextFilters:r,matchUpFilters:n,contextProfile:a,drawDefinition:o,context:s={},structure:l,inContext:u,event:c}=t,{seedAssignments:d,contextContent:p,exitProfiles:m,matchUpsMap:h}=t,f={},g={};if(!l)return{collectionPositionMatchUps:f,error:lp,roundMatchUps:g,matchUps:[]};let v=Array.isArray(n==null?void 0:n.eventIds)?n==null?void 0:n.eventIds.filter(Boolean):[],y=Array.isArray(n==null?void 0:n.structureIds)?n==null?void 0:n.structureIds.filter(Boolean):[],I=Array.isArray(n==null?void 0:n.drawIds)?n==null?void 0:n.drawIds.filter(Boolean):[],b=!(s!=null&&s.eventId)||!(v!=null&&v.length)&&!((G=r==null?void 0:r.eventIds)!=null&&G.filter(Boolean).length)||(v==null?void 0:v.includes(s.eventId))||((j=r==null?void 0:r.eventIds)==null?void 0:j.includes(s.eventId)),S=!(y!=null&&y.length)||y.includes(l.structureId),w=!o||!(I!=null&&I.length)||I.includes(o.drawId);if(!b||!S||!w)return{collectionPositionMatchUps:f,roundMatchUps:g,matchUps:[]};a&&!p&&(p=Yu({tournamentRecord:i,contextProfile:a,drawDefinition:o}));let{appliedPolicies:U}=$t({drawDefinition:o}),T={...t.tournamentAppliedPolicies,...U,...t.policyDefinitions},D=(z=T==null?void 0:T.scoring)==null?void 0:z.structures,P=l.stage&&((W=D==null?void 0:D.stage)==null?void 0:W[l.stage]),E=l.stageSequence&&((q=P==null?void 0:P.stageSequence)==null?void 0:q[l.stageSequence]),R=((Y=T==null?void 0:T.scoring)==null?void 0:Y.requireAllPositionsAssigned)||(P==null?void 0:P.requireAllPositionsAssigned)||(E==null?void 0:E.requireAllPositionsAssigned);h||(h=sn({drawDefinition:o,structure:l}));let{positionAssignments:N,allPositionsAssigned:A}=Er({structure:l}),M=!R||A,{seedAssignments:C}=ho({provisionalPositioning:e,drawDefinition:o,structure:l});d=d??C;let{structureId:O}=l;m=m||o&&EW({drawDefinition:o}).exitProfiles;let k=m==null?void 0:m[O],x=(k==null?void 0:k.length)&&(k[0].split("-").map(J=>parseInt(J)).reduce((J,H)=>J+H)||0),F=!!l.structures,$=Ld({matchUpsMap:h,structureId:O,inContext:u}),_=T==null?void 0:T[_f],L=Joe({roundNamingPolicy:_,drawDefinition:o,structure:l,matchUps:$}),{roundNamingProfile:B,roundProfile:V}=L;if(g=(L==null?void 0:L.roundMatchUps)??[],n&&($=uu({matchUps:$,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),u){let{sourceDrawPositionRanges:J}=qoe({drawDefinition:o,matchUpsMap:h,structureId:O}),H=o?Yoe({drawDefinition:o,roundProfile:V,matchUpsMap:h,structureId:O}).drawPositionsRanges:void 0,Z=t.tournamentParticipants,K=t.participantMap;!(Z!=null&&Z.length)&&!K&&i&&({participants:Z=[],participantMap:K}=mp({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:u})),$=$.map(ie=>qW({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:J,tournamentParticipants:Z,positionAssignments:N,drawPositionsRanges:H,initialRoundOfPlay:x,roundNamingProfile:B,tournamentRecord:i,appliedPolicies:T,seedAssignments:d,contextContent:p,participantMap:K,contextProfile:a,drawDefinition:o,scoringActive:M,isRoundRobin:F,roundProfile:V,structure:l,context:s,matchUp:ie,event:c})),($==null?void 0:$.filter(ie=>Array.isArray(ie.tieMatchUps))).forEach(ie=>{let ae=ie.tieMatchUps;$=$.concat(...ae)}),r&&($=uu({processContext:!0,...r,matchUps:$}))}else($==null?void 0:$.filter(J=>Array.isArray(J.tieMatchUps))).forEach(J=>{let H=J.tieMatchUps;$=$.concat(...H)});return n&&($=uu({matchUps:$,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n!=null&&n.matchUpTypes||n!=null&&n.matchUpIds)&&($=uu({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:$})),(n!=null&&n.matchUpTypes||n!=null&&n.matchUpIds||u)&&(g=En({matchUps:$}).roundMatchUps??[]),(re=vn({drawDefinition:o,structure:l,event:c}))!=null&&re.tieFormat&&({collectionPositionMatchUps:f}=Woe({matchUps:$})),{collectionPositionMatchUps:f,roundMatchUps:g,isRoundRobin:F,roundProfile:V,matchUpsMap:h,matchUps:$}}function Rd({matchUp:t}){return t?vr.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function LT({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:m,publishStatus:h,contextProfile:f,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structureId:I,inContext:b,structure:S,context:w,event:U}){!S&&I&&({structure:S}=it({drawDefinition:g,structureId:I}));let T=Wt({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:m,publishStatus:h,contextProfile:f,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structure:S,inContext:b,context:w,event:U}),D=[],P=[],E=[],R=[],N=[];if(T.error)return T;let{matchUps:A}=T,{assignedPositions:M}=Er({structure:S}),C=M==null?void 0:M.filter(k=>k.participantId).map(k=>k.drawPosition),O;return A.filter(k=>{var F;let x=((F=u==null?void 0:u.matchUpTypes)==null?void 0:F.length)===1&&u.matchUpTypes[0]===fi;return!(k.matchUpType!==fi&&x)}).forEach(k=>{var G,j,z,W;if(k.matchUpStatus===Ba){D.push(k);return}k.matchUpType===fi&&(O=!0);let x=k.collectionId,F=x&&((G=k.sides)==null?void 0:G.every(q=>q.participantId)),$=!x&&((j=k.drawPositions)==null?void 0:j.filter(Boolean).length)===2,_=!x&&((z=k.drawPositions)==null?void 0:z.every(q=>C==null?void 0:C.includes(q))),L=M==null?void 0:M.filter(q=>q.bye).map(q=>q.drawPosition),B=!x&&((W=k.drawPositions)==null?void 0:W.find(q=>L==null?void 0:L.includes(q))),V=lW.includes(k.matchUpStatus)&&(F||$&&(!t||_));return B?N.push(k):Rd({matchUp:k})?P.push(k):V?E.push(k):R.push(k)}),{includesTeamMatchUps:O,abandonedMatchUps:D,completedMatchUps:P,upcomingMatchUps:E,pendingMatchUps:R,byeMatchUps:N,structure:S}}function Rse({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:Le};if(!i)return{error:Wa};let{links:r}=Vg({drawDefinition:t,structureId:i}),n=r.source.reduce((o,s)=>!s.source.roundNumber||s.source.roundNumber===e?o.concat(s):o,[]),a=r.target.reduce((o,s)=>!s.target.roundNumber||s.target.roundNumber===e?o.concat(s):o,[]);return{links:{source:n,target:a}}}function cE({finishingPositions:t,linkCondition:e,linkType:i,source:r}){var a;let n=r.find(o=>{var l,u;let s=!((l=o.source)!=null&&l.finishingPositions)||!t||Rn(t,(u=o.source)==null?void 0:u.finishingPositions);return e===o.linkCondition&&s&&o.linkType===i});return[Tu,Gl].includes(n==null?void 0:n.linkType)&&!((a=n==null?void 0:n.source)!=null&&a.roundNumber)?ee({result:{error:se},stack:"getTargetLink",context:n}):n}function Vg({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>{var a,o;return((a=n.source)==null?void 0:a.structureId)===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),((o=n.target)==null?void 0:o.structureId)===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r},{source:[],target:[]})}:{error:Wa}:{error:Le}}function Ese({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(o=>o.roundNumber===i&&!o.matchUpTieId),a=t.filter(o=>o.roundNumber===i+1&&!o.matchUpTieId);if(a.length){let o;return a.length===n.length?o=a.find(s=>s.roundPosition===r):a.length===n.length/2&&(o=a.find(s=>s.roundPosition===Math.ceil(r/2))),{matchUp:o}}return{message:"no progression found"}}function dE({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){var D;if(!n)return{error:hN};let{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:l,positionInterleave:u}}=n,{structure:c}=it({drawDefinition:r,structureId:a}),{positionAssignments:d}=oi({structure:c}),p=(e==null?void 0:e.filter(P=>P.structureId===(c==null?void 0:c.structureId))).filter(P=>P.roundNumber===l&&!P.matchUpTieId),m=p.length,h=Te(1,m+1),f=m/t,g=Math.ceil(f*i),v=1-i%2;if(u!=null&&u.interleave&&f!==.5){let P=u.offset+(i-1)*u.interleave,E=i+P;g=Math.ceil(E/2),v=1-E%2}let y=h,I=h[g-1],b=RW({roundPositionsCount:h.length,groupedOrder:s}),S=(b==null?void 0:b.length)||1;if(S<=h.length){let P=m/S,E=Rr(h,P);o===Od&&E.forEach(R=>R.reverse()),y=(b==null?void 0:b.length)&&(b==null?void 0:b.map(R=>E[R-1]).flat())||y}o===_o?I=y[g-1]:o===Od?((!(b!=null&&b.length)||S>h.length)&&(g=p.length+1-g),I=y[g-1]):o===lT&&La()&&console.log(X0,{feedProfile:o});let w=I&&p.reduce((P,E)=>E.roundPosition===I?E:P,void 0),U;w!=null&&w.feedRound?(v=0,U=Math.min(...(w.drawPositions||[]).filter(Boolean))):U=((D=w==null?void 0:w.drawPositions)==null?void 0:D.length)===2&&(w==null?void 0:w.drawPositions[v]);let T=d==null?void 0:d.find(({drawPosition:P})=>P===U);if(T){let{extension:P}=vt({element:T,name:bT});if(P!=null&&P.value)return{disabledDrawPosition:U}}return{matchUp:w,targetDrawPosition:U,matchUpDrawPositionIndex:v}}function Cn({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(s=>s.matchUpId===n));let{structure:o}=it({structureId:a==null?void 0:a.structureId,drawDefinition:r});return(o==null?void 0:o.finishingPosition)===eh?Cse({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:o,matchUp:a}):Mse({matchUp:a})}function Cse({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){var R,N,A;let{winnerMatchUpId:a,loserMatchUpId:o}=n,{links:s}=Rse({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),l=s==null?void 0:s.source,u=cE({source:l,linkType:Tu}),c=cE({linkCondition:nl,linkType:Gl,source:l}),d=cE({source:l,linkType:Gl}),p=c&&d;d||(d=c);let m=(R=u==null?void 0:u.target)==null?void 0:R.feedProfile,h=(N=d==null?void 0:d.target)==null?void 0:N.feedProfile,f=(A=c==null?void 0:c.target)==null?void 0:A.feedProfile,g,v,y,I,b,S,w,U,T,D;if(e&&(a||o)&&(w=a&&m!==xo&&t.find(({matchUpId:M})=>M===a),I=o&&h!==xo&&t.find(({matchUpId:M})=>M===o),w||I))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u},targetMatchUps:{loserMatchUp:I,winnerMatchUp:w}};let{roundPosition:P}=n;D=D||t.filter(M=>M.structureId===r.structureId);let E=D.reduce((M,C)=>C.roundNumber===n.roundNumber&&!C.matchUpTieId?M+1:M,0);return d&&!I&&h!==xo&&({matchUpDrawPositionIndex:S,targetDrawPosition:b,matchUp:I}=dE({targetLink:d,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),p&&f!==xo&&({matchUpDrawPositionIndex:y,targetDrawPosition:v,matchUp:g}=dE({targetLink:c,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),u&&!w&&m!==xo&&({matchUpDrawPositionIndex:T,targetDrawPosition:U,matchUp:w}=dE({targetLink:u,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),w||(D=D||t.filter(M=>M.structureId===r.structureId),{matchUp:w}=Ese({structureMatchUps:D,matchUp:n})),je({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u,byeTargetLink:c},targetMatchUps:{winnerMatchUpDrawPositionIndex:T,loserMatchUpDrawPositionIndex:S,byeMatchUpDrawPositionIndex:y,winnerTargetDrawPosition:U,loserTargetDrawPosition:b,byeTargetDrawPosition:v,winnerMatchUp:w,loserMatchUp:I,byeMatchUp:g},targetMatchUpIds:!!(a||o)})}function Mse({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function Nse({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{var l,u,c,d,p,m;let{matchUpId:n,structureId:a,drawPositions:o=[]}=r,{structure:s}=it({drawDefinition:t,structureId:a});if((s==null?void 0:s.finishingPosition)===kd){let{roundNumber:h}=r,f=h&&et(h)+1,g=s.matchUps??[],{roundMatchUps:v}=En({matchUps:g});if(f&&(v!=null&&v[f])){let y=[...o].sort(sr).map((I,b)=>{let S=v[f].find(w=>{var U;return(U=w.drawPositions)==null?void 0:U.includes(I)});return{matchUpId:S==null?void 0:S.matchUpId,roundNumber:f,schedule:S==null?void 0:S.schedule,sideNumber:b+1,structureName:s.structureName}});Object.assign(r,{sidesTo:y})}}else{let h=Cn({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:n}),{winnerMatchUp:f}=h.targetMatchUps,{loserMatchUp:g}=h.targetMatchUps;!r.winnerMatchUpId&&f&&(r.winnerMatchUpId=f.matchUpId),!r.loserMatchUpId&&g&&(r.loserMatchUpId=g.matchUpId);let v=pE({upcomingMatchUp:f}),y=pE({upcomingMatchUp:g});if(r.matchUpStatus!==Vt&&(g==null?void 0:g.matchUpStatus)===Vt){let{matchUp:b}=YW({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=b&&pE({upcomingMatchUp:b})||y}let I=(l=r.schedule)==null?void 0:l.timeAfterRecovery;if(I&&((u=v==null?void 0:v.schedule)!=null&&u.scheduledTime&&Ot(v.schedule.scheduledTime)<Ot(I)&&(i[v.matchUpId]=r.matchUpId,v.schedule.scheduleConflict=r.matchUpId),(c=y==null?void 0:y.schedule)!=null&&c.scheduledTime&&Ot(y.schedule.scheduledTime)<Ot(I)&&(i[y.matchUpId]=r.matchUpId,y.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:v,loserTo:y}),(d=r.drawPositions)==null?void 0:d.filter(Boolean).length){let b=((m=(p=h.targetLinks)==null?void 0:p.loserTargetLink)==null?void 0:m.linkCondition)===nl,S=Ase(r);if(S.length){let w=MC(f==null?void 0:f.sides),U=MC(g==null?void 0:g.sides),T=S.find(({participantId:P})=>w.includes(P))?[]:S,D=S.find(({participantId:P})=>U.includes(P))?[]:S;g&&b&&D.length<2&&D.push({bye:!0,tbd:!0}),T!=null&&T.length&&f&&(!h.targetMatchUpIds&&f&&(f=e.find(({matchUpId:P})=>P===f.matchUpId)),f.potentialParticipants||(f.potentialParticipants=[]),f.potentialParticipants.push(T)),D!=null&&D.length&&g&&(h.targetMatchUpIds||(f=e.find(({matchUpId:P})=>P===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(D))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function Ase(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:r,qualifier:n})=>i||r&&{participantId:r}||n&&{qualifier:n}).filter(Boolean))||[]}function YW({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var o;let{matchUpId:r,matchUpStatus:n,structureId:a}=t||{};if(!t||!a||(t==null?void 0:t.matchUpStatus)===Xi)return{matchUp:t};if(n===Vt){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((o=Cn({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r}))==null?void 0:o.targetMatchUps)||{},YW({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function pE(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o}))(t.upcomingMatchUp)}function hr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=jg(t);if(i.error)return ee({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:o,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...o??[],...s??[]),matchUpsMap:l}}function jg(t){if(!(t!=null&&t.drawDefinition))return{error:Le};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:m,scheduleTiming:h,participantMap:f,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:I,inContext:b,context:S,event:w}=t,U=[],T=[],D=[],P=[],E=[];v&&!i&&(i=Yu({policyDefinitions:u,tournamentRecord:c,contextProfile:v,event:w}));let R;!(e!=null&&e.length)&&c&&(e=c==null?void 0:c.participants,(b||s!=null&&s.withGroupings)&&(e!=null&&e.length)&&({participantsWithGroupings:e,groupInfo:R}=ET({participants:e,participantsProfile:s})));let{structures:N}=is({drawDefinition:y});if(!N)return{error:Ci};r||(r=sn({drawDefinition:y}));let A=y&&EW({drawDefinition:y}).exitProfiles;N.forEach(O=>{let{byeMatchUps:k=[],pendingMatchUps:x=[],upcomingMatchUps:F=[],completedMatchUps:$=[],abandonedMatchUps:_=[]}=LT({matchUpFilters:I?void 0:m,contextFilters:I?void 0:p,inContext:b||I||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:f,scheduleTiming:h,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:A,matchUpsMap:r,structure:O,context:S,event:w});U=U.concat(..._),T=T.concat(...$),D=D.concat(...F),P=P.concat(...x),E=E.concat(...k)});let M=O=>(!m&&!I&&!p||(m&&(O=uu({matchUps:O,...m})),p&&(O=uu({matchUps:O,...p,processContext:!0}))),O),C={abandonedMatchUps:M(U),completedMatchUps:M(T),upcomingMatchUps:M(D),pendingMatchUps:M(P),byeMatchUps:M(E),matchUpsMap:r,...X,groupInfo:R};if(I){let O=typeof I=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:k,completed:x,upcoming:F,pending:$,bye:_}=O,L=[].concat(...k&&U||[],...x&&T||[],...F&&D||[],...$&&P||[],..._&&E||[]);Nse({inContextDrawMatchUps:L,drawDefinition:y})}return C}function iu(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextFilters:d,contextProfile:p,matchUpFilters:m,nextMatchUps:h,inContext:f,context:g,event:v}=t;if(!v)return{error:vi};let{eventId:y,eventName:I,endDate:b,eventType:S,category:w,gender:U,matchUpFormat:T}=v??{},D={...g,...je({indoorOutDoor:v.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),surfaceCategory:v.surfaceCategory??(c==null?void 0:c.surfaceCategory),endDate:v.endDate??(c==null?void 0:c.endDate),tournamentId:c==null?void 0:c.tournamentId,matchUpFormat:T,eventName:I,eventType:S,category:w,eventId:y,gender:U})};b&&(D.endDate=b),p&&!i&&(i=Yu({policyDefinitions:l,tournamentRecord:c,contextProfile:p,event:v}));let P;if(!(e!=null&&e.length)&&!r&&c){let N=mp({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:p,inContext:f});r=N.participantMap,e=N.participants??[],P=N.groupInfo}let E=v.drawDefinitions??[],R=Jy({tournamentRecord:c,event:v}).scheduleTiming;return{matchUps:E.flatMap(N=>{let{matchUps:A}=hr({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:D,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,contextFilters:d,contextProfile:p,drawDefinition:N,contextContent:i,matchUpFilters:m,participantMap:r,scheduleTiming:R,nextMatchUps:h,inContext:f,event:v});return A??[]}),groupInfo:P}}function Vr(t){let e=ze(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:ge};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,contextProfile:d,matchUpFilters:p,contextFilters:m,nextMatchUps:h,context:f}=t,g=t.tournamentId??u.tournamentId,v=(u==null?void 0:u.events)??[];r||({participants:r,participantMap:i}=mp({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,contextProfile:d,inContext:c}));let{appliedPolicies:y}=$t({tournamentRecord:u}),I={...f,tournamentId:g,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},b=Yu({policyDefinitions:l,tournamentRecord:u,contextProfile:d});return{matchUps:v.flatMap(S=>{var w;return I.eventDrawsCount=((w=S.drawDefinitions)==null?void 0:w.length)??0,iu({context:I,scheduleVisibilityFilters:n,tournamentAppliedPolicies:y,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,contextContent:b,contextFilters:m,contextProfile:d,matchUpFilters:p,participantMap:i,nextMatchUps:h,participants:r,inContext:c,event:S}).matchUps??[]}).concat(...u.matchUps??[])}}function As({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof r!="object"||!Object.keys(r).length)return{error:Oi};let u=Object.keys(r).map(c=>{let d=r[c];return Vr({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:d,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}).matchUps??[]}).flat();return{...X,matchUps:u}}function ch(t,e){return Ose(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function Ose(t,e){return(Sm[t==null?void 0:t.stage]||0)-(Sm[e==null?void 0:e.stage]||0)}function Sn(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:m,drawDefinition:h,nextMatchUps:f,inContext:g,context:v,event:y}=t,{eventId:I,eventName:b,endDate:S,eventType:w,category:U,gender:T,matchUpFormat:D}=y??{},P={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(c==null?void 0:c.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(c==null?void 0:c.indoorOutdoor),matchUpFormat:D,eventType:w,eventName:b,category:U,eventId:I,endDate:S,gender:T},E;return!(e!=null&&e.length)&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:E}=mp({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:m,inContext:g})),m&&!r&&(r=Yu({policyDefinitions:l,tournamentRecord:c,contextProfile:m,drawDefinition:h,event:y})),{...hr({context:P,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,drawDefinition:h,contextContent:r,contextFilters:p,contextProfile:m,matchUpFilters:d,participantMap:i,nextMatchUps:f,inContext:g,event:y}),groupInfo:E}}function em({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Ce(t),r=e.split("."),n=[],a;s({targetElement:i,attributes:r});let o={value:a};return n.length&&(o.values=n),o;function s({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,m]of u.entries())if(l!=null&&l[m]){let h=u.slice(p+1);h.length?Array.isArray(l[m])?l[m].forEach(f=>s({targetElement:f,attributes:h})):(l=l[m],d({targetElement:l,index:p})):(a||(a=l[m]),n.includes(l[m])||n.push(l[m]))}function d({targetElement:p,index:m}){if(p&&m===u.length-1&&["string","number"].includes(typeof p)){let h=c?p.slice(0,c):p;a?n.includes(h)||n.push(h):(a=h,n.push(h))}}}}var KW=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(r=>{var n;return{[r]:(n=em({element:e,accessor:r}))==null?void 0:n.value}})||typeof t=="object"&&Object.keys(t).map(r=>{var n;return{[r]:(n=em({element:e,accessor:r}))==null?void 0:n.value}})||((i=typeof t=="string"&&em({element:e,accessor:t}))==null?void 0:i.value)},Da=KW;function sb({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:o,fmlc:s}){var g;if(!So(a))return[];let{roundProfile:l,roundNumbers:u=[]}=En({interpolate:!0,matchUps:a});r=r??Math.max(...u,0);let c=n?r-n:0,d=c&&((g=l==null?void 0:l[r-c])==null?void 0:g.matchUpsCount),p=l&&Object.values(l).map(Da("matchUpsCount")),m=(v,y)=>{let I=Math.min(...v);d&&y&&I===1&&(I=d);let b=Math.max(...v);return e&&b>e&&(b=e),[I,b]},h=l&&Object.assign({},...u.map(v=>{let y=(r??0)+1-v-c,I=l[v].matchUpsCount,b={finishingPositionRange:{},finishingRound:y},S=p==null?void 0:p.slice(v-1).reduce((N,A)=>N+(A||0),0),w=s&&v!==1,U=1+t+(w?i??0:0),T=1,D=Te(U,o?U+I*2:S+U+T),P=S+T-I,E=m(D.slice(P)),R=m(D.slice(0,P),!0);return b.finishingPositionRange={loser:E,winner:R},{[v]:b}})),f=La({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&h[v.roundNumber];f&&!y&&console.log({roundFinishingData:h,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),a}function $d({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var n;if(!e)return{error:Le};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=hr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((n=e==null?void 0:e.structures)==null?void 0:n.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];sb({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:o,structureId:s}=a,l=Cn({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:o}),{winnerMatchUp:u,loserMatchUp:c}=l.targetMatchUps,d=u==null?void 0:u.matchUpId,p=c==null?void 0:c.matchUpId,m=Ld({matchUpsMap:i,structureId:s}).find(h=>h.matchUpId===o);if(m&&(d&&(r.winnerMatchUpIds[m.matchUpId]=d,Object.assign(m,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(r.loserMatchUpIds[m.matchUpId]=p,a.loserMatchUpId=p,m.loserMatchUpId=p,a.finishingPositionRange))){let h=c.finishingPositionRange&&[...a.finishingPositionRange.loser,...c.finishingPositionRange.loser],f=h&&[Math.min(...h),Math.max(...h)];a.finishingPositionRange.loser=f,m.finishingPositionRange.loser=f}}),{inContextDrawMatchUps:t,goesToMap:r}}function ps(t){var y;let e=bo(t),i=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:o}=t;if(!Array.isArray(i))return{error:Gu};if(!Array.isArray(r))return{error:$s};let s=(y=t.matchUpIds)!=null&&y.length?t.matchUpIds:i.map(I=>I.matchUpId);if(!Array.isArray(s))return{error:Wm};let l={},u={},c={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),m=p.reduce((I,b)=>I.concat(b.events??[]).map(S=>(S.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:I})=>I===Su),h=i;if(m.length){h=As({nextMatchUps:!0,tournamentRecords:e}).matchUps;let I=m.reduce((b,S)=>{var T,D;let w=(T=S.source)==null?void 0:T.structureId,U=(D=S.target)==null?void 0:D.structureId;return w&&U&&(c[U]=w),w&&!b.includes(w)&&b.push(w),b},[]);for(let b of I)l[b]=[];for(let b of h??[]){let S=b.containerStructureId||b.structureId;I.includes(S)&&l[S].push(b.matchUpId)}}let f=I=>{u[I]||(u[I]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[I]=[])},g=(I,b)=>{u[I].matchUpIds.forEach(S=>{u[b].matchUpIds.push(S)}),u[b].matchUpIds.push(I),u[I].dependentMatchUpIds.push(b),n&&u[I].participantIds.forEach(S=>u[b].participantIds.push(S))},v=I=>{let b=Object.keys(l).length;for(let S of I||[]){let{matchUpId:w,winnerMatchUpId:U,loserMatchUpId:T}=S;if(!s.length||s.includes(w)){if(f(w),n){let{individualParticipantIds:E}=RT(S);u[w].participantIds=E}U&&(f(U),g(w,U),d[U].push(w)),T&&(f(T),g(w,T),d[T].push(w)),u[w].sources.push(d[w]);let D=d[w].map(E=>u[E].sources[0]).flat(),P=d[w].map(E=>u[E].sources[1]).flat();if(u[w].sources.push(D,P),b){let E=S.containerStructureId||S.structureId,R=c[E];if(l[R])for(let N of l[R])f(N),g(N,w),d[N].push(w)}}}};if(o)$d({drawDefinition:o}),h!=null&&h.length||(h=Sn({drawDefinition:o}).matchUps),v(h);else{if(h!=null&&h.length||(h=As({nextMatchUps:!0,tournamentRecords:e}).matchUps),!r.length){let I=p!=null&&p.length?p.map(({events:b=[]})=>b.map(({drawDefinitions:S=[]})=>S.map(({drawId:w})=>w))).flat(1/0):[];I&&(r=I)}for(let I of r){let b=h==null?void 0:h.filter(S=>S.drawId===I).sort(ch);if(!(b!=null&&b.find(({roundPosition:S})=>!S))){let S=b==null?void 0:b.find(({tournamentId:U})=>U),{drawDefinition:w}=Wn({tournamentRecord:e[S==null?void 0:S.tournamentId],drawId:I});w&&$d({drawDefinition:w})}v(b)}}return{positionDependencies:l,matchUpDependencies:u,sourceMatchUpIds:d,matchUps:h,...X}}function Ir(t){var d,p;let e=t==null?void 0:t.matchUp,i=(t==null?void 0:t.score)||(e==null?void 0:e.score),r=(d=i==null?void 0:i.sets)==null?void 0:d[0],{side1Score:n,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s,side1PointScore:l,side2PointScore:u}=r||{},c=n||a||o||s||l||u;return!!(((p=i==null?void 0:i.sets)==null?void 0:p.length)>1||c)}function lb({matchUpStatus:t}){return oW.includes(t)}function kse({matchUpStatus:t}){return hA.includes(t)}function _C({matchUpStatus:t}){return sW.includes(t)}function GA({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){var s;let a=r==null?void 0:r.find(({participantId:l})=>l),o=(s=i==null?void 0:i.filter(GA))==null?void 0:s.length;return Ir({score:n})||o||e&&a||t&&kse({matchUpStatus:t})&&![Mt,zt,cs].includes(t)}function ub(t){var U;let{drawDefinition:e,findContainer:i,structureId:r,event:n}=t,a=t.structure,o={isCollectionMatchUp:!1},{containedStructures:s}=Bg({drawDefinition:e}),l=r?s[r]||[]:[];if(!a){let T=it({drawDefinition:e,structureId:r});if(T.error)return T;a=i?T.containingStructure??T.structure:T.structure}if(zn({structure:a}))return{structure:a,isAdHoc:!0,error:Rg};let{matchUps:u}=hr({inContext:!0,matchUpFilters:o,drawDefinition:e,event:n}),c=u==null?void 0:u.filter(T=>T.structureId===r||l.includes(T.structureId)),{matchUpDependencies:d}=ps({drawIds:[e.drawId],matchUps:u,drawDefinition:e}),p=[],m=[],h={},f=[];for(let T of u??[]){if(T.structureId===r||l.includes(T.structureId)){m.push(...T.drawPositions??[]);let D=T.roundNumber;for(let P of(T.drawPositions??[]).filter(Boolean))(!h[P]||D&&h[P]>D)&&(h[P]=D)}GA(T)&&(f.push(T),p.push(T.matchUpId,...((U=d==null?void 0:d[T==null?void 0:T.matchUpId])==null?void 0:U.matchUpIds)||[]))}let g=ct(m.filter(Boolean)).sort(sr),v=ct(p),y=ct(c==null?void 0:c.map(({matchUpId:T,drawPositions:D})=>v.includes(T)?D:[]).flat().filter(Boolean)).sort(sr),{positionAssignments:I}=oi({drawDefinition:e,structure:a}),b=I==null?void 0:I.filter(T=>T.bye).map(T=>T.drawPosition),S=I==null?void 0:I.filter(T=>T.qualifier).map(T=>T.drawPosition),w=(g==null?void 0:g.filter(T=>!y.includes(T)))||[];return{allDrawPositions:g,inContextStructureMatchUps:c,drawPositionInitialRounds:h,activeDependentMatchUpIds:v,qualifyingDrawPositions:S,inactiveDrawPositions:w,positionAssignments:I,activeDrawPositions:y,byeDrawPositions:b,activeMatchUps:f,structure:a}}function Em({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(sr)[0]}}var oc={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},HA=[];function Oa(t,e){Di(t)&&(t={method:t}),(e||La())&&HA.push(t)}function xse(t){return HA.slice()}function Fse(t){let e=xse().map(i=>{let{color:r,keyColors:n,method:a,newline:o}=i,s=Object.keys(oc).includes(r)?oc[r]:oc.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=n&&Object.keys(n).includes(c)&&oc[n[c]]?oc[n[c]]:oc.brightwhite;return`${oc.white}${c}: ${d}${i[c]}`}).join(", "),u=(a==null?void 0:a.length)<15?"		":"	";return[o?`
`:"",s,a,u,oc.white,l,oc.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function Lse(){HA.length=0}function Ka({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUpsMap:a,structureId:o,structure:s,event:l}){var D,P,E;if(!r)return{error:Le};if(s||({structure:s}=it({drawDefinition:r,structureId:o})),!s)return{error:Ci};o||({structureId:o}=s);let u="assignDrawPositionBye";Oa({method:u,color:"cyan",drawPosition:n}),a||(a=sn({drawDefinition:r}));let{positionAssignments:c}=oi({structure:s}),{activeDrawPositions:d}=ub({drawDefinition:r,structureId:o});if((D=c==null?void 0:c.find(R=>R.drawPosition===n))!=null&&D.bye)return{...X};if(d!=null&&d.includes(n))return{error:B0};let p=c==null?void 0:c.find(R=>R.drawPosition===n);if(!p)return{error:Rg};let{filled:m,containsBye:h,assignedParticipantId:f}=_se(p);if(h)return{...X};if(m&&!h)return ee({result:{error:Ef},stack:u});let g=$t({tournamentRecord:i,drawDefinition:r,event:l}).appliedPolicies??{},v=hr({inContext:!0,drawDefinition:r,matchUpsMap:a}).matchUps??[],y={isCollectionMatchUp:!1},{matchUps:I}=Wt({provisionalPositioning:t,drawDefinition:r,matchUpFilters:y,matchUpsMap:a,structure:s});if(c==null||c.forEach(R=>{R.drawPosition===n&&(R.bye=!0)}),s.structureType===xn)return $se({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:I}),Rc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),NB({assignedParticipantId:f,isPositionAction:e,appliedPolicies:g,drawDefinition:r,drawPosition:n,structureId:o,stack:u});let{roundProfile:b,roundMatchUps:S}=En({matchUps:I}),w=(P=b&&Object.keys(b).map(R=>parseInt(R)).reverse())==null?void 0:P.find(R=>{var N;return(N=b==null?void 0:b[R].drawPositions)==null?void 0:N.includes(n)}),U=w?S==null?void 0:S[w].find(({drawPositions:R})=>R==null?void 0:R.includes(n)):void 0;U&&JW({tournamentRecord:i,drawDefinition:r,matchUp:U,event:l});let T=(E=U==null?void 0:U.drawPositions)==null?void 0:E.find(R=>R!==n);if(U&&T){let R=zA({sourceDrawPositions:U.drawPositions,matchUpId:U.matchUpId,inContextDrawMatchUps:v,drawPositionToAdvance:T,tournamentRecord:i,drawDefinition:r,matchUpsMap:a});if(R.error)return R}return Rc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),NB({assignedParticipantId:f,isPositionAction:e,appliedPolicies:g,drawDefinition:r,drawPosition:n,structureId:o,stack:u})}function NB({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:o}){return e&&PT({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:o}}),ee({result:{...X},stack:o})}function _se(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:r,filled:e||i||r}}function JW({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:Vt,score:void 0,winningSide:void 0}),Rt({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(n==null?void 0:n.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function $se({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{var o;(o=a.drawPositions)!=null&&o.includes(i)&&JW({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function zA({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:o,event:s}){var I,b;Oa({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(S=>S.matchUpId===o),u=(I=e.find(S=>S.matchUpId===o))==null?void 0:I.structureId,{structure:c}=it({drawDefinition:n,structureId:u}),{positionAssignments:d}=oi({structure:c}),p=d==null?void 0:d.filter(S=>S.bye).map(S=>S.drawPosition),m=(b=l==null?void 0:l.drawPositions)==null?void 0:b.find(S=>S!==t),h=m&&(p==null?void 0:p.includes(m)),{targetLinks:{loserTargetLink:f},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v,loserTargetDrawPosition:y}}=Cn({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:o});if(v&&v.structureId===(c==null?void 0:c.structureId)&&Bse({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:v,matchUpsMap:a,event:s}),g&&h&&g.structureId!==(c==null?void 0:c.structureId)){let{roundNumber:S}=g;if(S===1){let w=Ka({structureId:f.target.structureId,drawPosition:y,tournamentRecord:r,drawDefinition:n,event:s});if(w.error)return w}else XW({loserTargetDrawPosition:y,tournamentRecord:r,loserTargetLink:f,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:s})}return{...X}}function Bse({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:o,event:s}){var A,M,C,O,k,x;let l="advanceWinner",u=o.drawMatchUps.find(F=>F.matchUpId===a.matchUpId),c=(A=e.find(F=>F.matchUpId===a.matchUpId))==null?void 0:A.structureId,{structure:d}=it({drawDefinition:n,structureId:c}),{positionAssignments:p}=oi({structure:d}),m=(M=p==null?void 0:p.find(({drawPosition:F})=>F===t))==null?void 0:M.bye,h=(C=u.drawPositions)==null?void 0:C.filter(Boolean),f=p==null?void 0:p.filter(F=>h==null?void 0:h.includes(F.drawPosition)),g=p==null?void 0:p.find(({drawPosition:F})=>F===t),v=i==null?void 0:i.find(F=>F!==t),y=(O=v&&(f==null?void 0:f.find(({drawPosition:F})=>F===v)))==null?void 0:O.bye,I=m&&y;if(I&&console.log({isByeAdvancedBye:I}),(h==null?void 0:h.length)>1&&m&&!y)return ee({result:{error:Ef},stack:l});let b=h==null?void 0:h.find(F=>F!==t),S=I,w=[...(u.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),U=w.map(F=>!F&&!S||F===t?(S=!0,t):F).sort(sr);if(!S)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:f}),ee({result:{error:Ef},stack:l});let T=(k=p==null?void 0:p.find(({drawPosition:F})=>F===b))==null?void 0:k.bye,D=(x=p==null?void 0:p.find(({drawPosition:F})=>F===t))==null?void 0:x.bye;Object.assign(u,{matchUpStatus:D||T?Vt:Xi,score:void 0,winningSide:void 0,drawPositions:U});let P=u.drawPositions.find(F=>!w.includes(F));Oa({method:l,color:"brightyellow",changedDrawPosition:P,pairedDrawPositionIsBye:T,drawPositionIsBye:D}),Rt({tournamentId:r==null?void 0:r.tournamentId,matchUp:u,eventId:s==null?void 0:s.eventId,context:l,drawDefinition:n});let{targetLinks:{loserTargetLink:E},targetMatchUps:{loserMatchUp:R,loserTargetDrawPosition:N}}=Cn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(T||D){let F=T?t:b;if(F)zA({drawPositionToAdvance:F,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:o});else if(D&&E&&R)if(R.feedRound)XW({loserTargetDrawPosition:N,tournamentRecord:r,loserTargetLink:E,drawDefinition:n,loserMatchUp:R,matchUpsMap:o});else{let $=1-a.roundPosition%2,_=R.drawPositions[$],L=Ka({structureId:E.target.structureId,drawPosition:_,tournamentRecord:r,drawDefinition:n,event:s});if(L.error)return L}}}function XW({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){let{roundNumber:s}=n;Oa({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[n.structureId].matchUps,{initialRoundNumber:u}=Em({drawPosition:t,matchUps:l});if(u===s){let c=Ka({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:o});if(c.error)return c}}function QW({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:o}=Wt({drawDefinition:i,matchUpsMap:r,structure:n,event:a});o.forEach(s=>{let l=t.filter(({drawPosition:u})=>{var c;return(c=s.drawPositions)==null?void 0:c.includes(u)}).filter(u=>u.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?Vt:Xi}),Rt({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:s}))})}function cb(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=t,{structure:u}=it({drawDefinition:a,structureId:o}),c=(Er({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(c&&i&&!r&&(r=c==null?void 0:c.drawPosition),!r)return{error:Eg};i||(i=c==null?void 0:c.participantId);let{activeDrawPositions:d}=ub({drawDefinition:a,structureId:o});return d.includes(r)?{error:B0}:(e||({matchUps:e}=hr({inContext:!0,drawDefinition:a,matchUpsMap:s})),$C({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:o,drawPosition:r,matchUpsMap:s,event:l}).drawPositionCleared?(Rc({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:u,event:l}),{...X,participantId:i}):{error:DG})}function $C({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:o}){var v,y;let{structure:s}=it({drawDefinition:i,structureId:a});if(!s)return{error:Ci};let l=Er({drawDefinition:i,structure:s}).positionAssignments||[],u=l.some(I=>{if(I.drawPosition===r)return delete I.participantId,delete I.qualifier,delete I.bye,!0});if(s.structureType===xn)return QW({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:s}),{drawPositionCleared:u,...X};let c={isCollectionMatchUp:!1},{matchUps:d}=Wt({drawDefinition:i,matchUpFilters:c,matchUpsMap:n,structure:s,event:o}),{roundProfile:p,roundMatchUps:m}=En({matchUps:d}),h=(v=p&&Object.keys(p))==null?void 0:v.map(I=>et(I)),f=r,g=(y=h==null?void 0:h.map(I=>{var R,N,A,M;let b=(N=(R=p==null?void 0:p[I])==null?void 0:R.pairedDrawPositions)==null?void 0:N.find(C=>C.includes(f)),S=b==null?void 0:b.find(C=>C!==f),w=l.find(C=>C.drawPosition===S),U=p==null?void 0:p[I+1],T=w==null?void 0:w.bye,D=(A=U==null?void 0:U.pairedDrawPositions)==null?void 0:A.find(C=>C.includes(S)),P=T&&D&&U&&((M=U.drawPositions)==null?void 0:M.includes(S)),E=b&&{pairedDrawPositionByeAdvancedPair:!P&&D,pairedDrawPosition:S,targetDrawPosition:f,relevantPair:b,roundNumber:I};return P&&(f=S),E}).filter(I=>I==null?void 0:I.targetDrawPosition))==null?void 0:y.reduce((I,b)=>{let{roundNumber:S,relevantPair:w,targetDrawPosition:U,pairedDrawPosition:T,pairedDrawPositionByeAdvancedPair:D}=b,P={roundNumber:S,targetDrawPosition:U,relevantPair:w},E=D&&{roundNumber:S+1,targetDrawPosition:T,relevantPair:D,subsequentRoundRemoval:!0},R=[P,E].filter(Boolean);return I.concat(...R)},[]);return g==null||g.forEach(({roundNumber:I,targetDrawPosition:b,relevantPair:S})=>{let w=m==null?void 0:m[I].find(U=>{var T;return Rn((T=U.drawPositions)==null?void 0:T.filter(Boolean),S.filter(Boolean))});w&&(Vse({inContextDrawMatchUps:t,targetDrawPosition:b,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:I,matchUpsMap:n}),ZW({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:r,matchUpsMap:n,structure:s,event:o}))}),{tasks:g,drawPositionCleared:u,positionAssignments:l}}function Vse({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:o}){let{structure:s}=it({drawDefinition:r,structureId:o});if(!s)return{error:Ci};if(s.structureType===xn)return;n=n||sn({drawDefinition:r});let l=((n==null?void 0:n.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:u}=Em({drawPosition:e,matchUps:l}),c=l==null?void 0:l.filter(p=>{var m;return p.roundNumber>=a&&p.roundNumber!==u&&((m=p.drawPositions)==null?void 0:m.includes(e))}),d=oi({drawDefinition:r,structureId:o}).positionAssignments??[];return c==null||c.forEach(p=>ZW({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:s})),{...X}}function ZW({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var U,T,D,P,E;let u="removeDrawPosition",c=(U=n.drawPositions)==null?void 0:U.slice(),d=n.matchUpStatus,p=n.winningSide;o=o??sn({drawDefinition:r});let m=o.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:h}=Em({drawPosition:a,matchUps:m});if(n.roundNumber&&h&&n.roundNumber>h){let R=(n.drawPositions??[]).map(N=>N===a?void 0:N);n.drawPositions=R}if(n.matchUpType===fi){let R=(((T=t==null?void 0:t.find(N=>N.matchUpId===n.matchUpId))==null?void 0:T.sides)??[]).reduce((N,A,M)=>A.drawPosition===a?M:N,void 0);R!==void 0&&((P=(D=n.sides)==null?void 0:D[R])!=null&&P.lineUp)&&((E=n.sides)==null||delete E[R].lineUp,Rt({tournamentId:i==null?void 0:i.tournamentId,context:`${u}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:n,drawDefinition:r}))}let f=Cn({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:v,winnerMatchUp:y,loserMatchUpDrawPositionIndex:I}}=f,b=e.filter(({drawPosition:R})=>{var N;return(N=n.drawPositions)==null?void 0:N.includes(R)}).filter(R=>R.bye).length,S=b&&Vt||n.matchUpStatus&&[Mt,zt].includes(n.matchUpStatus)&&n.matcHUpStatus||Xi;n.matchUpStatus=S,n.matchUpStatus&&[zt,Mt].includes(n.matchUpStatus)&&(n.winningSide=void 0);let w=c==null?void 0:c.find(R=>{var N;return!((N=n.drawPositions)!=null&&N.includes(R))});if(c!=null&&c.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(w&&Oa({method:u,color:"brightyellow",removedDrawPosition:w}),Rt({tournamentId:i==null?void 0:i.tournamentId,context:`${u}-${a}`,eventId:l==null?void 0:l.eventId,matchUp:n,drawDefinition:r})),v&&v.structureId!==f.matchUp.structureId&&!b){let{drawPositions:R,roundNumber:N}=v;if(N===1){let A=R[I];$C({structureId:v.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o})}else{let A=Math.min(...R.filter(Boolean)),M=jse({loserMatchUpDrawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:v,matchUpsMap:o,event:l});if(M.error)return ee({result:M,stack:u});let C=((o==null?void 0:o.mappedMatchUps)||{})[v.structureId].matchUps,{initialRoundNumber:O}=Em({drawPosition:A,matchUps:C});O===1&&(Oa({method:u,color:"brightyellow",loserMatchUpDrawPosition:A}),$C({structureId:v.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o}))}}return y&&y.structureId!==f.matchUp.structureId&&g.target.feedProfile,{...X}}function jse({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){var u;let{structure:s}=it({structureId:n.structureId,drawDefinition:r}),{positionAssignments:l}=oi({structure:s});if((u=l==null?void 0:l.find(c=>c.drawPosition===t))!=null&&u.bye){let c=cb({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:o});if(c.error)return c}return{...X}}function Ip({drawDefinition:t,stages:e}){if(!t)return{error:Le};let i=((t==null?void 0:t.structures)??[]).filter(n=>!(e!=null&&e.length)||n.stage&&e.includes(n.stage)),r=ct(i.map(n=>{let{positionAssignments:a}=oi({structure:n});return a?a.map(Ut):[]}).flat().filter(Boolean));return{...X,assignedParticipantIds:r}}function Ss(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:o}=n,s=`_${a||Oe}${o||""}`;return r[s]||(r[s]=[]),r[s].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let o=a+1;return{...n,entryPosition:o}})).flat()}function fd(t){return[fp,Uo].includes(t)}function RS({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:u,stage:c,event:d}){var D,P,E,R,N,A,M,C,O,k,x,F;if(!n||!Array.isArray(n))return{error:Es,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:vi};if(a&&!PW.includes(a))return{error:wC};if(o&&!oT.includes(o))return{error:up};let p="modifyEntriesStatus",m=[];if(!a&&!s)return ee({result:{error:Xe},info:"Missing entryStatus",stack:p});if(s&&!al({extension:s,requiredAttributes:["name"]}))return ee({result:{error:se},info:"Invalid extension",context:{extension:s},stack:p});let h=[];(D=d==null?void 0:d.drawDefinitions)==null||D.forEach($=>{let _=Ip({stages:c&&[c],drawDefinition:$}).assignedParticipantIds??[];h.push(..._)});let f=(i==null?void 0:i.participants)??[];if(!n.every($=>{var L;let _=(L=Sc({tournamentParticipants:f,participantId:$}))==null?void 0:L.participantType;return!(_&&[ft,Vn].includes(_)&&fd(a))&&!(a&&(d!=null&&d.eventType)&&_===St&&[po,Ta].includes(d.eventType)&&[Go,...OU].includes(a))}))return{error:wC};let g=d&&Gi({event:d}).flightProfile,v=(P=g==null?void 0:g.flights)==null?void 0:P.find($=>$.drawId===u),y=$=>{let _=($||[]).filter(B=>!c||!B.entryStage||c===B.entryStage).filter(({participantId:B})=>n.includes(B)),L=B=>a&&h.includes(B.participantId)&&!(OU.includes(B.entryStatus)&&OU.includes(a));return _.every(B=>L(B)&&!e?!1:(a&&(B.entryStatus=a,delete B.entryPosition),o&&(B.entryStage=o,delete B.entryPosition),s&&(s.value?Lt({element:B,extension:s}):Un({element:B,name:s.name})),!0))?{...X}:{error:Ng}},I=({flight:$,drawDefinition:_})=>{d&&(d.entries=Ss({entries:d.entries??[]})),$&&($.drawEntries=Ss({entries:$.drawEntries})),_&&(_.entries=Ss({entries:_.entries}))},b=$=>{let{flight:_,drawDefinition:L}=$,B="updateDrawEntries";if(_){let V=y(_.drawEntries);if(V.error)return ee({result:V,stack:B})}if(L){let V=y(L.entries);if(V.error)return ee({result:V,stack:B});m.includes(L.drawId)||m.push(L.drawId)}return{...X}},S=((E=d==null?void 0:d.entries)==null?void 0:E.find(({entryPosition:$})=>$))??(((R=v==null?void 0:v.drawEntries)==null?void 0:R.find(({entryPosition:$})=>$))||((N=r==null?void 0:r.entries)==null?void 0:N.find(({entryPosition:$})=>$)));if(t&&!S&&I({flight:v,drawDefinition:r}),v||r){let $=b({flight:v,drawDefinition:r});if($.error)return ee({result:$,stack:p})}let w=((A=d==null?void 0:d.drawDefinitions)==null?void 0:A.map(({drawId:$})=>$))??[],U=((M=g==null?void 0:g.flights)==null?void 0:M.filter($=>!w.includes($.drawId)))||[];for(let $ of U){let _=$&&b({flight:$});if(_!=null&&_.error)return ee({result:_,stack:p})}let T=((C=g==null?void 0:g.flights)==null?void 0:C.length)===1&&(((O=d==null?void 0:d.drawDefinitions)==null?void 0:O.length)??0)<=((k=g==null?void 0:g.flights)==null?void 0:k.length);if(!v&&!r&&a&&DW.includes(a))return{error:lH};if(!v&&!r||a===Eu||l&&T){let $=y(d==null?void 0:d.entries);if($!=null&&$.error)return ee({result:$,stack:p});let _;if(a===Eu&&((x=g==null?void 0:g.flights)==null||x.every(L=>{let B=y(L.drawEntries);return B.error?(_=B.error,!1):(L.drawEntries=L.drawEntries.filter(({participantId:V})=>!n.includes(V)),!0)}),(F=d==null?void 0:d.drawDefinitions)==null||F.every(L=>{var V;let B=y(L.entries);return B.error?(_=B.error,!1):(L.entries=(V=L.entries)==null?void 0:V.filter(({participantId:G})=>!n.includes(G)),!0)})),_)return ee({result:{error:_},stack:p})}t&&I({flight:v,drawDefinition:r});for(let $ of(d==null?void 0:d.drawDefinitions)??[])m.length&&!m.includes($.drawId)||li({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:$});return{...X}}function Al({requireTimeStamp:t,scaleAttributes:e,participant:i}){var r,n;if(!i)return{error:Km};if(!Nt(e))return{error:se};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=e,u=[xd,o,s,l].join("."),c=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===u).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(c){let[d,p,m,h]=((r=c.itemType)==null?void 0:r.split("."))??[];if(d!==xd)return{error:bm};let f=((n=a&&em({element:c.itemValue,accessor:a}))==null?void 0:n.value)||c.itemValue,g={eventType:m,scaleDate:c.itemDate,scaleValue:f,scaleName:h,scaleType:p};return{...X,scaleItem:g}}}return{...X,scaleItem:void 0}}function Gse({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){var c,d,p;let a={},o=m=>[xd,Ml,n.eventType,m].join("."),s=Object.assign({},...(r.timeItems||[]).filter(({itemType:m})=>m.split(".")[1]===Ml).map(({itemType:m,itemValue:h})=>({[m]:h}))),l=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(o),u=Vi(Object.keys(s),l);if((!e||!Object.keys(s).length&&!((c=t==null?void 0:t.drawIds)!=null&&c.length)||u.length)&&u.length){if(t!=null&&t.stageSeedingScaleNames){let m=Object.keys(t.stageSeedingScaleNames).map(f=>{let g=o(t.stageSeedingScaleNames[f]),v=s[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);a.seedAssignments=h}else if(u){let m=u.map(h=>s[h]);a.seedValue=m.pop()}}else if(!e&&typeof i=="object"){let m=Object.keys(i).map(f=>{let g=o(i[f]),v=s[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);a.seedAssignments=h}else{let{categoryName:m,ageCategoryCode:h}=n.category||{},f=[h,n.eventId,m].filter(Boolean),g;for(let v of f){let y={eventType:n.eventType,scaleType:Ml,scaleName:v},I=Al({scaleAttributes:y,participant:r});if(I.scaleItem){g=I.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((p=(d=t==null?void 0:t.published)==null?void 0:d.drawIds)!=null&&p.length))){let v=g.scaleValue;a.seedValue=v}}return a}function Hse({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...zN(d??[])):{},m=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:o,eventId:a});i.events[a]=je(m,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function eq(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||r===Vt||e[i].scheduleItems.push({...c,scheduledDate:mt(c==null?void 0:c.scheduledDate),scheduledTime:wi(c==null?void 0:c.scheduledTime),checkScoreHasValue:Ir({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,drawId:d})}function db(t){var a,o,s;let e=ze(t,[{[wr]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:r=Ya}=t,n=`${Kc}.${Jc}`;return Ce((s=(o=(a=CT({tournamentRecord:i,itemType:n}))==null?void 0:a.timeItem)==null?void 0:o.itemValue)==null?void 0:s[r],!1,!0)}function zse(t){let{tournamentId:e}=t??{};return!!e}function To({event:t,status:e=Ya}){var r,n,a;let i=`${Kc}.${Jc}`;return(a=(n=(r=Ky({itemType:i,event:t}))==null?void 0:r.timeItem)==null?void 0:n.itemValue)==null?void 0:a[e]}function WA({drawDetails:t,drawId:e}){var i,r;return(r=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:r.published}function dh(t){var d,p,m,h,f,g,v,y,I;let{tournamentRecord:e,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:o,event:s}=t??{};if(e&&!zse(e))return{error:se};if(n&&!s)return{error:co};if(Array.isArray(r)&&(r!=null&&r.length)){let b={};for(let S of r){if(!Di(S))return{error:se};let w=(d=Wn({tournamentRecord:e,eventId:S}))==null?void 0:d.event;if(!w)return{error:co};let U=mE({event:w});b[S]=U}return{...X,publishState:b}}if(s){let b=mE({event:s}),S={};if(o)return i?{publishState:{status:{published:!!((p=b.status.publishedDrawIds)!=null&&p.includes(o)),drawDetail:(m=b.status.drawDetails)==null?void 0:m[o]},...X}}:{error:Fa};if(Array.isArray(a)&&(a!=null&&a.length)){let w=((h=s.drawDefinitions)==null?void 0:h.map(xI))??[];for(let U of a){if(!Di(U))return{error:se};if(!w.includes(U))return{error:Fa};S[U]={status:{published:!!b.status.publishedDrawIds.includes(U),drawDetail:(f=b.status.drawDetails)==null?void 0:f[U]}}}}else S=b;return{...X,publishState:S}}let l=[],u=!1,c={};for(let b of(e==null?void 0:e.events)??[]){let S=mE({event:b});c[b.eventId]=S,S.status.published&&(l.push(b.eventId),u=!0);for(let{drawId:w}of b.drawDefinitions??[]){let U=(v=(g=S.status)==null?void 0:g.publishedDrawIds)==null?void 0:v.includes(w);U&&(c[w]={status:{published:U}})}}if(e){let b=db({tournamentRecord:e});c.tournament=b??{},((y=b==null?void 0:b.orderOfPlay)!=null&&y.published||(I=b==null?void 0:b.participants)!=null&&I.published)&&(u=!0),c.tournament.status={published:u,publishedEventIds:l}}return{...X,publishState:c}}function mE({event:t}){var s;let e=To({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let r=e.drawDetails??{};for(let l of((s=t.drawDefinitions)==null?void 0:s.map(xI))||[])r[l]||(r[l]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter(l=>WA({drawDetails:r,drawId:l})),a=n!=null&&n.length?n:e.drawIds??[];if(a!=null&&a.length&&!(n!=null&&n.length))for(let l of a)r[l]={publishingDetail:{published:!0}};let o=(a==null?void 0:a.length)>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:r,published:o}}}function _T(t,e){return(t||"").localeCompare(e||"")}function Wse({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:r,matchUpStatus:n,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:u,drawId:c,stage:d}){let p=e[a],m=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:c});let h=p.structureParticipation[l],{winner:f,loser:g}=t,v=r?f:g;r&&(h.winCount+=1,n===zt&&(h.walkoverWinCount+=1),n===Mt&&(h.defaultWinCount+=1)),v&&(!h.finishingPositionRange||m(v)<m(h.finishingPositionRange))&&(h.finishingPositionRange=v),i&&((!h.finishingRound||i<h.finishingRound)&&(h.finishingMatchUpId=u,h.finishingRound=i,h.roundNumber=s),i===1&&(h.participantWon=r))}function AB(t){var M,C,O,k,x,F,$,_,L,B;let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:o,withEvents:s,withDraws:l,finishingPositionRange:u,finishingRound:c,matchUpStatus:d,stageSequence:p,roundNumber:m,structureId:h,score:f,stage:g,withRankingProfile:v,tieWinningSide:y,roundPosition:I,matchUpTieId:b,matchUpSides:S,collectionId:w,matchUpType:U,winningSide:T,matchUpId:D,schedule:P,eventId:E,drawId:R,sides:N}=t,A=a&&(N==null?void 0:N.length)===2&&Object.assign({},...N.map(({sideNumber:V},G)=>{let j=N[1-G].participantId;return V&&{[V]:j}}).filter(Boolean));for(let V of N){let{participantId:G,sideNumber:j,bye:z}=V;if(z)continue;let W=T===j,q=J=>{var ie,ae;let H=(ie=n[J])==null?void 0:ie.participant,Z=H==null?void 0:H.participantType,K=[{participantId:J,participantType:Z}];if(Z!==Vn)for(let oe of(H==null?void 0:H.individualParticipantIds)||[]){let ne=(ae=n[oe])==null?void 0:ae.participant;K.push({participantType:ne==null?void 0:ne.participantType,participantId:oe})}return K},Y=(J,H)=>{if(o){if(n[J].matchUps[D]={participantWon:W,matchUpType:U,structureId:h,sideNumber:j,matchUpId:D,eventId:E,drawId:R,stage:g},a){let Z=q(H);n[J].matchUps[D].opponentParticipantInfo=Z}w&&(n[J].matchUps[D].collectionId=w)}a&&H&&(n[J].opponents[H]={participantId:H,matchUpId:D,eventId:E,drawId:R}),v&&Wse({finishingPositionRange:u,participantMap:n,participantWon:W,finishingRound:c,matchUpStatus:d,participantId:J,stageSequence:p,roundNumber:m,structureId:h,matchUpId:D,drawId:R,stage:g}),(i||e)&&eq({participantMap:n,participantId:J,matchUpStatus:d,roundPosition:I,matchUpType:U,roundNumber:m,structureId:h,matchUpId:D,schedule:P,drawId:R,score:f})},re=({participant:J,partnerParticipantId:H})=>{var K,ie,ae;let Z=(oe,ne)=>{oe&&(oe.partnerParticipantIds||(oe.partnerParticipantIds=[]),oe.partnerParticipantIds.includes(ne)||oe.partnerParticipantIds.push(ne))};l&&Z((K=J==null?void 0:J.draws)==null?void 0:K[R],H),s&&Z((ie=J==null?void 0:J.events)==null?void 0:ie[E],H),o&&Z((ae=J==null?void 0:J.matchUps)==null?void 0:ae[D],H)};if(G&&n[G]){let J=A==null?void 0:A[j];Y(G,J);let H=((M=n[G])==null?void 0:M.participant.participantType)===ft,Z=((C=n[G])==null?void 0:C.participant.individualParticipantIds)||[];if(b){if(r){let K=ie=>n[ie].matchUps[b]={participantWon:y===j,matchUpId:b,matchUpType:fi,sideNumber:j};K(G),Z.forEach(K)}if(l&&!n[G].draws[R]){let K=(k=(O=S.find(oe=>oe.sideNumber===j))==null?void 0:O.participant)==null?void 0:k.participantId,ie=($=(F=(x=n[K])==null?void 0:x.draws)==null?void 0:F[R])==null?void 0:$.entryStatus,ae=oe=>n[oe].draws[R]={entryStatus:ie,eventId:E,drawId:R};ae(G),Z.forEach(ae)}}if(H&&(Z.forEach(K=>n[K]&&Y(K,J)),Z.forEach((K,ie)=>{let ae=Z[1-ie],oe=n[K];oe&&re({participant:oe,partnerParticipantId:ae})}),s&&S)){let K=(L=(_=S.find(ie=>ie.sideNumber===j))==null?void 0:_.participant)==null?void 0:L.participantId;if(K){let ie=(B=n[K])==null?void 0:B.events[E];ie?(n[G].events[E]={...ie},Z.forEach(ae=>n[ae].events[E]={...ie})):console.log("Missing teamEntry",{eventId:E,teamParticipantId:K})}}if(T){let K=ie=>{W?(n[ie].counters[U].wins+=1,n[ie].counters.wins+=1,d===zt&&(n[ie].counters[U].walkoverWins+=1,n[ie].counters.walkoverWins+=1),d===Mt&&(n[ie].counters[U].defaultWins+=1,n[ie].counters.defaultWins+=1)):(n[ie].counters[U].losses+=1,n[ie].counters.losses+=1,d===zt&&(n[ie].counters[U].walkovers+=1,n[ie].counters.walkovers+=1),d===Mt&&(n[ie].counters[U].defaults+=1,n[ie].counters.defaults+=1))};K(G),Z.forEach(K)}}}}function qse(t){var N,A,M,C,O,k,x;let{participantFilters:e,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,participantMap:o,contextProfile:s,withPotentialMatchUps:l,withRankingProfile:u,withScheduleItems:c,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:m,withOpponents:h,withMatchUps:f,withSeeding:g,withEvents:v,withDraws:y}=t,I=e==null?void 0:e.participantIds,b=F=>{var _,L;let $=[F];return(L=(_=o[F])==null?void 0:_.participant.individualParticipantIds)==null||L.forEach(B=>$.push(B)),$.some(B=>!(I!=null&&I.length)||I.includes(B))?$:[]},S={withMatchUps:f||u,withEvents:v||u,withDraws:y||u,withPotentialMatchUps:l,withRankingProfile:u,withScheduleItems:c,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:m,participantMap:o,withOpponents:h,withSeeding:g},w=[],U={},T=[],D={},P={},E={},R=({eventType:F,scaleNames:$,participantId:_})=>{var L,B,V,G,j;return(j=(G=(V=(B=(L=o[_])==null?void 0:L.participant)==null?void 0:B.rankings)==null?void 0:V[F])==null?void 0:G.find(z=>$.includes(z.scaleName)))==null?void 0:j.scaleValue};for(let F of(n==null?void 0:n.events)||[]){if(e!=null&&e.eventIds&&!e.eventIds.includes(F.eventId))continue;let{drawDefinitions:$=[],extensions:_=[],eventType:L,eventName:B,category:V,entries:G,eventId:j,gender:z}=F,{flightProfile:W}=Gi({event:F}),q=(W==null?void 0:W.flights)??[],Y=dh({event:F}).publishState;Y&&(D[j]=Y);let re=(N=Y==null?void 0:Y.status)==null?void 0:N.publishedSeeding;if(v||g||u){let H=i?Object.assign({},...zN(_??[])):{};P[j]={...H,eventName:B,eventType:L,category:V,eventId:j,gender:z};let Z=[V==null?void 0:V.categoryName,V==null?void 0:V.ageCategoryCode].filter(Boolean);for(let K of G){let{participantId:ie}=K;if(!ie||!o[ie])continue;let ae=R({eventType:L,scaleNames:Z,participantId:ie}),oe,ne;if(g){let ye=o[ie].participant;({seedAssignments:oe,seedValue:ne}=Gse({publishedSeeding:re,usePublishState:a,withSeeding:g,participant:ye,event:F}))}let de=ye=>{var ke,we;if((we=(ke=o[ye])==null?void 0:ke.events)!=null&&we[j])return;let ce=o[ye];Hse({convertExtensions:i,seedAssignments:oe,participant:ce,withSeeding:g,seedValue:ne,eventId:j,ranking:ae,entry:K})};de(ie),(o[ie].participant.individualParticipantIds||[]).forEach(de)}}let J=(A=D==null?void 0:D[j])==null?void 0:A.publishedSeeding;if(y||u||g){let H=K=>K?Object.assign({},...K.map(({participantId:ie,seedValue:ae,seedNumber:oe})=>({[ie]:{seedValue:ae,seedNumber:oe}}))):void 0,Z=ct([...$.map(xI),...q.map(xI)]);for(let K of Z){let ie=$.find(Be=>Be.drawId===K),ae=[V==null?void 0:V.categoryName,V==null?void 0:V.ageCategoryCode].filter(Boolean),{structures:oe=[],drawOrder:ne,drawName:de,drawType:ye}=ie??{},ce=q==null?void 0:q.find(Be=>Be.drawId===K),ke=(ie==null?void 0:ie.entries)||(ce==null?void 0:ce.drawEntries),we=ce==null?void 0:ce.flightNumber,Ze=((ie==null?void 0:ie.structures)||[]).sort((Be,xe)=>ih(Be,xe)).map(({structureId:Be,structures:xe})=>[Be,...(xe||[]).map(({structureId:qe})=>qe)]).flat(1/0),pt,he,fe,pe,Fe=0,Se=oe.filter(({stage:Be,stageSequence:xe})=>Be===Oe&&xe===1||Be===Ke).flatMap(Be=>{let{positionAssignments:xe}=oi({structure:Be}),{seedAssignments:qe,stageSequence:Pe,stage:at}=Be;return at===Oe?(Fe=(xe==null?void 0:xe.length)??0,fe=xe,pe=qe):Pe===1&&(pt=xe,he=qe),xe}).map(({participantId:Be})=>Be).filter(Boolean),He=H(pe),ue=H(he),me=ie?ke.filter(({participantId:Be})=>Se.includes(Be)):ke,Ue=!a||(J==null?void 0:J.published)&&(((M=J==null?void 0:J.drawIds)==null?void 0:M.length)===0||((C=J==null?void 0:J.drawIds)==null?void 0:C.includes(K)));for(let Be of me){if(!o[Be.participantId])continue;let{entryStatus:xe,entryStage:qe,entryPosition:Pe,participantId:at}=Be,di=R({participantId:at,scaleNames:ae,eventType:L}),Ae=yt=>{var bi,pi,Li,un,er;if(!o[yt]||(bi=o[yt].draws)!=null&&bi[K])return;let yi=g&&Ue,be=yi?{}:void 0,Ct=yi?((pi=He==null?void 0:He[at])==null?void 0:pi.seedValue)||((Li=He==null?void 0:He[at])==null?void 0:Li.seedNumber):void 0,Re=Ct?He==null?void 0:He[at]:void 0,Ye=yi?((un=ue==null?void 0:ue[at])==null?void 0:un.seedValue)||((er=ue==null?void 0:ue[at])==null?void 0:er.seedNumber):void 0,xt=Ye?ue==null?void 0:ue[at]:void 0;be&&Ct&&(be[Oe]=Re),be&&Ye&&(be[Ke]=xt);let Fi=Ct||Ye;Fi&&(o[yt].participant.seedings[L]||(o[yt].participant.seedings[L]=[]),Re&&o[yt].participant.seedings[L].push({...Re,scaleName:K}),xt&&o[yt].participant.seedings[L].push({...xt,scaleName:K}),be&&(o[yt].events[j].seedAssignments||(o[yt].events[j].seedAssignments={}),Object.keys(be).forEach(Qn=>o[yt].events[j].seedAssignments[Qn]=be[Qn]))),(y||u)&&(o[yt].draws[K]=je({seedAssignments:be,entryPosition:Pe,entryStatus:xe,entryStage:qe,seedValue:Fi,eventId:j,ranking:di,drawId:K},!1,!1,!0))};[Uo,fp].includes(xe)||(Ae(at),(O=o[at].participant.individualParticipantIds||[])==null||O.forEach(Ae))}let $e=((ie==null?void 0:ie.structures)??[]).reduce((Be,xe)=>(Be.includes(xe.stage)||Be.push(xe.stage),Be),[]),Ee=((ie==null?void 0:ie.links)??[]).length;E[K]={qualifyingPositionAssignments:pt,qualifyingSeedAssignments:he,mainPositionAssignments:fe,qualifyingSeedingMap:ue,mainSeedAssignments:pe,orderedStructureIds:Ze,mainSeedingMap:He,flightNumber:we,linksCount:Ee,drawOrder:ne,drawName:de,drawType:ye,drawSize:Fe,drawId:K,stages:$e}}}if(u||d||p||m||h||f||y){let H=!!d||l,Z=((k=iu({afterRecoveryTimes:!!d,policyDefinitions:r,tournamentRecord:n,inContext:!0,contextProfile:s,participantMap:o,nextMatchUps:H,event:F}))==null?void 0:k.matchUps)??[];for(let K of Z){let{finishingPositionRange:ie,potentialParticipants:ae,tieMatchUps:oe=[],sides:ne=[],winningSide:de,matchUpType:ye,matchUpId:ce,eventId:ke,drawId:we,collectionId:Ze,stageSequence:pt,finishingRound:he,matchUpStatus:fe,roundPosition:pe,roundNumber:Fe,structureId:Se,schedule:He,score:ue,stage:me}=K;U[ce]=K;let Ue={finishingPositionRange:ie,finishingRound:he,stageSequence:pt,roundPosition:pe,collectionId:Ze,roundNumber:Fe,structureId:Se,schedule:He,eventId:ke,drawId:we,score:ue,stage:me};AB({...Ue,...S,matchUpStatus:fe,winningSide:de,matchUpType:ye,matchUpId:ce,sides:ne});for(let $e of oe){let{winningSide:Ee,sides:Be=[],matchUpId:xe,matchUpStatus:qe,matchUpType:Pe}=$e;AB({...Ue,...S,winningSide:Ee,tieWinningSide:de,matchUpTieId:ce,matchUpId:xe,sides:Be,matchUpSides:ne,matchUpStatus:qe,matchUpType:Pe})}Array.isArray(ae)&&(H||d||c)&&((x=ae.flat().map(Ut).filter(Boolean))==null||x.forEach($e=>{var Ee;(Ee=b($e))==null||Ee.forEach(Be=>{o[Be]&&(o[Be].potentialMatchUps[ce]=je({tournamentId:n==null?void 0:n.tournamentId,matchUpId:ce,eventId:ke,drawId:we}))}),(d||c)&&eq({potential:!0,participantMap:o,participantId:$e,matchUpStatus:fe,roundPosition:pe,structureId:Se,matchUpType:ye,roundNumber:Fe,matchUpId:ce,schedule:He,drawId:we,score:ue})}))}T.push(...Z)}}if(m||u||d){let F=Object.values(o);for(let $ of F){let{wins:_,losses:L,[ii]:{wins:B,losses:V},[Zt]:{wins:G,losses:j}}=$.counters,z=(W,q,Y)=>{let re=q+Y,J=q,H=re&&J/re;$.statistics[W]={denominator:re,numerator:J,statValue:H,statCode:W}};if(m&&(z(AU,_,L),z(`${AU}.${ii}`,B,V),z(`${AU}.${Zt}`,G,j)),u){let W=(q=[])=>Math.abs(q[0]-q[1]);for(let q of Object.keys($.draws)){let{orderedStructureIds:Y=[],flightNumber:re}=E[q]||{};if($.structureParticipation&&Y.length){let J,H=0,Z=Y.map(K=>{let ie=$.structureParticipation[K];if(!ie)return;J||(J=ie==null?void 0:ie.finishingPositionRange),W(J)>W(ie==null?void 0:ie.finishingPositionRange)&&(J=ie==null?void 0:ie.finishingPositionRange);let ae=ie.stage!==Ke;return ae&&(H+=1),je({...ie,participationOrder:ae?H:void 0,flightNumber:re})}).filter(Boolean);$.draws[q]&&($.draws[q].finishingPositionRange=J,$.draws[q].structureParticipation=Z)}}}if(d){let W=Nt(d)?d.scheduledMinutesDifference:0,q=$.scheduleItems||[],Y=$.potentialMatchUps||{},re=q.reduce((H,Z)=>{let{scheduledDate:K,scheduledTime:ie}=Z;return H[K]||(H[K]=[]),ie&&H[K].push(Z),H},{});Object.values(re).forEach(H=>H.sort(WH));for(let H of q){let{typeChangeTimeAfterRecovery:Z,timeAfterRecovery:K,scheduledDate:ie,scheduledTime:ae}=H,oe=re[ie],ne=Ot(ae);for(let de of oe){if(de.matchUpId===H.matchUpId||[zt,Mt].includes(de.matchUpStatus)&&!de.checkScoreHasValue)continue;let ye=H.matchUpType!==de.matchUpType&&Z||K,ce=H.drawId===de.drawId,ke=Y[H.matchUpId]&&Y[de.matchUpId],we=Ot(de.scheduledTime),Ze=Math.abs(we-ne),pt=we>=ne;if((W&&!isNaN(W)?Ze<=W:pt&&Ot(de.scheduledTime)<Ot(ye))&&!(ke&&ce)&&pt){let he=[H.matchUpId,de.matchUpId].sort(_T).join("|");$.scheduleConflicts[he]={priorScheduledMatchUpId:H.matchUpId,matchUpIdWithConflict:de.matchUpId}}}}let J=$.participant.participantId;Object.keys($.scheduleConflicts).length&&w.push(J),o[J].scheduleConflicts=$.scheduleConflicts}}}return{participantIdsWithConflicts:w,eventsPublishStatuses:D,derivedEventInfo:P,derivedDrawInfo:E,mappedMatchUps:U,participantMap:o,matchUps:T}}function pb({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var b;if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:o,participantRoles:s,participantRoleResponsibilities:l,participantTypes:u,participantIds:c,signInStatus:d,enableOrFiltering:p,eventIds:m,genders:h}=t,f=Dl(m)&&((b=e==null?void 0:e.events)==null?void 0:b.filter(S=>m==null?void 0:m.includes(S.eventId)))||(e==null?void 0:e.events)||[],g=n&&Yse({drawEntryStatuses:n,tournamentEvents:f}),v=o&&Kse({eventEntryStatuses:o,tournamentEvents:f}),y=a!==void 0&&[!0,!1].includes(a)&&f.reduce((S,w)=>S.concat(...(w.drawDefinitions||[]).map(U=>cW({drawDefinition:U}).allPositionedParticipantIds).filter(Boolean)),[]),I=S=>r==null?void 0:r.reduce((w,U)=>{let{accessor:T,value:D}=U,{values:P}=em({element:S,accessor:T});return w&&(P==null?void 0:P.includes(D))},!0);if(i=i==null?void 0:i.filter(S=>{var N,A;let w=(A=(N=wo({element:S,itemType:Yy}))==null?void 0:N.timeItem)==null?void 0:A.itemValue,{participantRoleResponsibilities:U,participantType:T,participantRole:D,participantId:P,person:E}=S,R=Array.isArray(h)&&(h==null?void 0:h.length)&&(E==null?void 0:E.sex)&&h.includes(E.sex);return p?h&&R||a&&y.includes(P)||a===!1&&!y.includes(P)||(g==null?void 0:g.includes(P))||(v==null?void 0:v.includes(P))||(c==null?void 0:c.includes(P))||d&&w===d||u&&T&&Dl(u)&&u.includes(T)||s&&D&&Dl(s)&&s.includes(D)||l&&Dl(U)&&Dl(l)&&l.find(M=>U==null?void 0:U.includes(M))||(r==null?void 0:r.length)&&Dl(r)&&I(S):(!h||R)&&(a===void 0||a&&y.includes(P)||a===!1&&!y.includes(P))&&(!g||g.includes(P))&&(!v||v.includes(P))&&(!c||c.includes(P))&&(!d||w===d)&&(!u||T&&Dl(u)&&u.includes(T))&&(!s||D&&Dl(s)&&s.includes(D))&&(!l||Dl(U)&&Dl(l)&&l.find(M=>U==null?void 0:U.includes(M)))&&(!(r!=null&&r.length)||Dl(r)&&I(S))}),f.length&&m){let S=f.filter(w=>m.includes(w.eventId)).map(w=>{let U=(w.entries||[]).map(D=>D.participantId);if(Yi(rl)(w.eventType))return U;let T=((e==null?void 0:e.participants)??[]).filter(D=>U.includes(D.participantId)).map(D=>D.individualParticipantIds).flat(1);return U.concat(...T)}).flat(1);i=i==null?void 0:i.filter(w=>S.includes(w.participantId))}return i}function Dl(t){return t&&Array.isArray(t)&&t.length}function Yse({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return ct(e.reduce((r,n)=>{var l,u;let{flightProfile:a}=Gi({event:n}),o=((l=a==null?void 0:a.flights)==null?void 0:l.map(({drawEntries:c})=>Array.isArray(c)?c.filter(i).map(Ut):[]).flat())||[],s=((u=n.drawDefinitions)==null?void 0:u.map(({entries:c})=>c?c.filter(i).map(Ut):[]))||[];return r.concat(...o,...s)},[]))}function Kse({eventEntryStatuses:t,tournamentEvents:e}){return ct(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Ut);return i.concat(...n)},[]))}function Mi(t){var B;let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:o,withScheduleItems:s,tournamentRecord:l,scheduleAnalysis:u,withSignInStatus:c,withTeamMatchUps:d,withScaleValues:p,usePublishState:m,contextProfile:h,withStatistics:f,withOpponents:g,withMatchUps:v,internalUse:y,withSeeding:I,withEvents:b,withDraws:S,withISO2:w,withIOC:U}=t;if(!l)return{error:ge};(v||n)&&ps({tournamentRecord:l});let T=SW({convertExtensions:a,tournamentRecord:l,withSignInStatus:c,withScaleValues:p,internalUse:y,withISO2:w,withIOC:U}),{participantMap:D}=T,P=qse({withMatchUps:v??n,withEvents:b??n,withDraws:S??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:s,policyDefinitions:o,tournamentRecord:l,scheduleAnalysis:u,withTeamMatchUps:d,usePublishState:m,withStatistics:f,participantMap:D,withOpponents:g,contextProfile:h,withSeeding:I}),{participantIdsWithConflicts:E,eventsPublishStatuses:R,derivedEventInfo:N,derivedDrawInfo:A,mappedMatchUps:M}=P,C=P.matchUps;D=P.participantMap;let O=u??r,k=({potentialMatchUps:V,scheduleConflicts:G,scheduleItems:j,participant:z,statistics:W,opponents:q,matchUps:Y,events:re,draws:J})=>{let H=Object.values(J),Z=Object.values(q);return g&&(H==null||H.forEach(K=>{K.opponents=Z.filter(ie=>ie.drawId===K.drawId)})),je({...z,scheduleConflicts:u?Object.values(G):void 0,draws:S||n?H:void 0,events:b||n?Object.values(re):void 0,matchUps:v||n?Object.values(Y):void 0,opponents:g?Z:void 0,potentialMatchUps:O?Object.values(V):void 0,statistics:f?Object.values(W):void 0,scheduleItems:s?j:void 0},!1,!1,!0)},x=new Map;for(let V of Object.keys(D))x.set(V,k(D[V]));let F=[...x.values()],$=(B=o==null?void 0:o[Gy])==null?void 0:B.participant,_=pb({participants:F,participantFilters:i,tournamentRecord:l});if(e){let V=Nt(e)?e:void 0;for(let G of _)for(let j of G.individualParticipantIds??[]){G.individualParticipants||(G.individualParticipants=[]);let z=x.get(j),W=V?Tm({template:V,source:z}):z;G.individualParticipants.push(W)}}let L=$?_.map(V=>Tm({source:V,template:$})):_;return{participantMap:t.returnParticipantMap!==!1?D:void 0,mappedMatchUps:t.returnMatchUps!==!1?M:void 0,matchUps:t.returnMatchUps!==!1?C:void 0,missingParticipantIds:T.missingParticipantIds,participantIdsWithConflicts:E,eventsPublishStatuses:R,derivedEventInfo:N,derivedDrawInfo:A,participants:L,...X}}function tm({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){var a;if(!e)return{error:Le};let n=(a=e.entries)==null?void 0:a.find(o=>o.participantId===t&&(!i||i===o.entryStatus)&&(!r||r===o.entryStage));return t&&n}function Gg(t){var m,h,f,g,v,y,I,b,S;let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=t;if(!i)return{error:Le};let{entryProfile:o}=Xy({drawDefinition:i}),s=a&&r&&((f=(h=(m=o==null?void 0:o[a])==null?void 0:m.stageSequence)==null?void 0:h[r])==null?void 0:f.qualifiersCount)||a&&((g=o==null?void 0:o[a])==null?void 0:g.qualifiersCount)||0,l={};if(!n)return{qualifiersCount:s,roundQualifiersCounts:l};let{structure:u}=it({drawDefinition:i,structureId:n}),c=(v=i.links)==null?void 0:v.filter(w=>{var U;return((U=w==null?void 0:w.target)==null?void 0:U.structureId)===(u==null?void 0:u.structureId)}),d=0;if(c!=null&&c.length)for(let w of c){let U=(y=it({structureId:w.source.structureId,drawDefinition:i}))==null?void 0:y.structure;if((U==null?void 0:U.stage)===Ke){let T=w.source.roundNumber,D=w.target.roundNumber,P=0;if(U.structureType===xn){let E=((I=U.structures)==null?void 0:I.length)??0,R=((b=w.source.finishingPositions)==null?void 0:b.length)??0;P=E*R}else P=((S=Wt({matchUpFilters:{roundNumbers:[T]},structure:U,afterRecoveryTimes:!1,provisionalPositioning:e,inContext:!1}).matchUps)==null?void 0:S.length)||0;l[D]||(l[D]=0),l[D]+=P,d+=P}}let p=Object.keys(l);if(p.length<=1){let w=p[0]||1;l[w]=Math.max(l[w]||0,s)}return d=Math.max(d,s),{qualifiersCount:d,roundQualifiersCounts:l}}function ES({stage:t,drawDefinition:e}){var r;let{entryProfile:i}=Xy({drawDefinition:e});return((r=i==null?void 0:i[t])==null?void 0:r.drawSize)||0}function Jse(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=ES({stage:n,drawDefinition:i}),{qualifiersCount:o}=Gg({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-o}function tq({stage:t,drawDefinition:e}){return!!(t===Or||FA({stage:t,drawDefinition:e})&&ES({stage:t,drawDefinition:e}))}function iq({entryStatus:t=sa,drawDefinition:e,stageSequence:i,stage:r}){if(t===Go)return joe({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...X}:{error:sH};let n=Jse({drawDefinition:e,stageSequence:i,stage:r}),a=Goe({drawDefinition:e,stage:r}),o=OC({entryStatus:Vf,drawDefinition:e,stage:r}),s=OC({entryStatus:sa,drawDefinition:e,stage:r}),l=o+s,u=l>=n,c=n-l;return r!==Or&&u?{error:UC}:t===Vf?o<a?{...X}:{error:UC}:{positionsAvailable:c,...X}}function qA(t){let e=ze(t,[{[Fn]:!0,[Bz]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=sa,entryStageSequence:n,entryStage:a=Oe,ignoreStageSpace:o,drawDefinition:s,entryPosition:l,participant:u,roundTarget:c,extensions:d,extension:p,drawType:m,event:h}=t,f="addDrawEntry";if(m!==_a&&!tq({stage:a,drawDefinition:s}))return ee({result:{error:up},stack:f});let g=iq({stageSequence:n,stage:a,drawDefinition:s,entryStatus:r});if(!o&&!g.success&&(!m||m!==_a))return{error:g.error};if(p&&!al({extension:p}))return ee({result:{error:se},info:"Invalid extension",context:{extension:p},stack:f});let v=t.participantId||(u==null?void 0:u.participantId);if(!v)return ee({result:{error:mr},stack:f});let y=r===Ru&&tm({participantId:v,drawDefinition:s,entryStatus:r}),I=a===Or&&tm({participantId:v,drawDefinition:s,entryStage:a}),b=tm({participantId:v,drawDefinition:s}),S=r!==Ru&&a!==Or&&b;if(S)return i?(lt({payload:{drawId:s.drawId,eventId:h==null?void 0:h.eventId,error:wI,participantId:v},topic:IA}),{...X}):ee({result:{error:wI},context:{participantId:v},stack:f});if(y||I)return ee({context:{invalidEntry:S,invalidLuckyLoser:y,invalidVoluntaryConsolation:I},result:{error:q0},stack:f});let w=je({entryStageSequence:n,participantId:v,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&Lt({element:w,extension:p}),c&&Lt({extension:{name:"roundEntry",value:c},element:w}),s.entries||(s.entries=[]),s.entries.push(w),li({drawDefinition:s}),{...X}}function Xse(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=sa,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:o,drawDefinition:s,stageSequence:l,stage:u=Oe,roundTarget:c,extension:d,event:p}=t;if(!u)return{error:$G};if(!s)return{error:Le};if(!Array.isArray(o))return{error:Ia};if(!tq({stage:u,drawDefinition:s}))return{error:up};if(d&&!al({extension:d}))return ee({result:{error:se},info:"Invalid extension",context:{extension:d},stack:e});let m=iq({drawDefinition:s,stageSequence:l,entryStatus:r,stage:u});if(!a&&!m.success)return{error:m.error};let h=m.positionsAvailable??0;if(!a&&u!==Or&&h<o.length)return{error:TN};let f=[],g=s.drawId,v=p==null?void 0:p.eventId,y=o.reduce((I,b)=>{let S=r===Ru&&tm({participantId:b,drawDefinition:s,entryStatus:r}),w=u===Or&&tm({entryStage:u,drawDefinition:s,participantId:b}),U=tm({participantId:b,drawDefinition:s});return r!==Ru&&u!==Or&&U&&(f.push(b),i&&lt({payload:{error:wI,participantId:b,eventId:v,drawId:g},topic:IA})),S||w?I.concat(b):I},[]);return f.length&&!i?ee({context:{eventId:v,drawId:g,duplicateEntries:f},result:{error:wI},stack:e}):(o.filter(I=>I&&!y.includes(I)).forEach(I=>{let b={entryStageSequence:l,entryStage:u,participantId:I,entryStatus:r};d&&Lt({element:b,extension:d}),c&&Lt({extension:{name:yl,value:c},element:b}),s.entries||(s.entries=[]),s.entries.push(b)}),n&&(s.entries=Ss({entries:s.entries})),li({drawDefinition:s}),y!=null&&y.length||f!=null&&f.length?{info:"some participantIds could not be added",participantIdsNotAdded:y,duplicateEntries:f,...X}:{...X})}function YA({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,entryStage:l,extension:u,drawId:c,event:d}){if(!(n!=null&&n.length))return{error:jc};if(!d)return{error:co};if(!c)return{error:$s};let p=(d.entries||[]).map(Ut);if(n.filter(f=>!p.includes(f)).length)return{error:LG};if(a){let f=Xse({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,extension:u});if(f.error)return f}let{flightProfile:m}=Gi({event:d}),h=m==null?void 0:m.flights.find(f=>f.drawId===c);return h!=null&&h.drawEntries&&(n.forEach(f=>{let g=o===Ru&&hE({participantId:f,entryStatus:o,flight:h}),v=l===Or&&hE({participantId:f,entryStage:l,flight:h});!(o!==Ru&&l!==Or&&hE({flight:h,participantId:f}))&&!g&&!v&&h.drawEntries.push({participantId:f,entryStatus:o,entryStage:l})}),e&&(h.drawEntries=Ss({entries:h.drawEntries}))),{...X}}function hE({participantId:t,entryStatus:e,entryStage:i,flight:r}){var a;let n=(a=r.drawEntries)==null?void 0:a.find(o=>o.participantId===t&&(!e||e===o.entryStatus)&&(!i||i===o.entryStage));return t&&n}function mb({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){var d,p,m,h;let a="removeEventEntries";if(!(n!=null&&n.eventId))return{error:vi};if(!Array.isArray(e)||e.some(f=>!Di(f)))return ee({result:{error:Es},stack:a});let o=(n.drawDefinitions??[]).flatMap(f=>Ip({drawDefinition:f}).assignedParticipantIds??[]),s=((i==null?void 0:i.length)&&((d=n.entries)==null?void 0:d.filter(f=>f.entryStatus&&i.includes(f.entryStatus)))||[]).map(Ut).filter(f=>!o.includes(f)),l=(r&&((p=n.entries)==null?void 0:p.filter(f=>f.entryStage&&f.entryStage===r))||[]).map(Ut).filter(f=>!o.includes(f));if(e.length?e=e.filter(f=>(!(i!=null&&i.length)||s.includes(f))&&(!r||l.includes(f))):s.length&&l.length?e=Vi(s,l):s.length?e=s:l.length&&(e=l),(e==null?void 0:e.length)&&o.some(f=>e.includes(f)))return ee({result:{error:Ng},stack:a});if(!(e!=null&&e.length))return{...X,participantIdsRemoved:[]};let u=[];n.entries=(n.entries??[]).filter(f=>{let g=!e.includes(f==null?void 0:f.participantId);return g||u.push(f.participantId),g}),t&&(n.entries=Ss({entries:n.entries}));let{flightProfile:c}=Gi({event:n});return(m=c==null?void 0:c.flights)==null||m.forEach(f=>{f.drawEntries=(f.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(h=n.drawDefinitions)==null||h.forEach(f=>{f.entries=(f.entries??[]).filter(g=>!e.includes(g.participantId))}),{...X,participantIdsRemoved:u}}var rq={[kr]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},Hg=rq;function Ks(t){var M,C;let{suppressDuplicateEntries:e=!0,entryStatus:i=sa,autoEntryPositions:r=!0,enforceGender:n=!0,entryStageSequence:a,policyDefinitions:o,entryStage:s=Oe,tournamentRecord:l,ignoreStageSpace:u,drawDefinition:c,roundTarget:d,extensions:p,extension:m,drawId:h,event:f}=t,g="addEventEntries";if(!Array.isArray(t.participantIds))return ee({result:{error:Ia},stack:g});let v=ct(t.participantIds??[]);if(!f)return{error:vi};if(!(v!=null&&v.length))return ee({result:{error:jc},stack:g});if(!(f!=null&&f.eventId))return{error:co};let y=$t({tournamentRecord:l,event:f}).appliedPolicies??{},I=(o==null?void 0:o[kr])??(y==null?void 0:y[kr])??Hg[kr],b=(n??((M=I==null?void 0:I.participants)==null?void 0:M.enforceGender))!==!1,S=[],w=[];if(p&&(!Array.isArray(p)||!p.every(O=>al({extension:O})))||m&&!al({extension:m}))return ee({context:je({extension:m,extensions:p}),result:{error:se},info:"Invalid extension(s)",stack:g});let U=!!l,T=[],D,P=((C=l==null?void 0:l.participants)==null?void 0:C.filter(O=>{var F,$,_;if(!v.includes(O.participantId))return!1;let k=Yi(ii)(f.eventType)&&O.participantType===St&&!fd(i),x=f.eventType===Zt&&O.participantType===ft;return k&&(!f.gender||!b||[Bn,Ms].includes(f.gender)||f.gender===((F=O.person)==null?void 0:F.sex))||x&&!fd(i)||f.eventType===Zt&&O.participantType===St&&fd(i)?!0:k&&f.gender&&b&&![Bn,Ms].includes(f.gender)&&f.gender!==(($=O.person)==null?void 0:$.sex)?(T.push({participantId:O.participantId,sex:(_=O.person)==null?void 0:_.sex}),!1):f.eventType===Kt&&(O.participantType===Kt||fd(i)&&O.participantType===St)}).map(O=>O.participantId))??[],E=v.filter(O=>!U||P.includes(O));f.entries||(f.entries=[]);let R=f.entries.map(O=>{var k;return O.participantId||((k=O.participant)==null?void 0:k.participantId)});if(E.forEach(O=>{var k;if(!R.includes(O)){let x=je({participantId:O,entryStatus:i,entryStage:s,extensions:p});m&&Lt({element:x,extension:m}),d&&Lt({extension:{name:yl,value:d},element:x}),a&&(x.entryStageSequence=a),S.push(x.participantId),(k=f.entries)==null||k.push(x)}}),h&&!fd(s)){let O=YA({participantIds:E,suppressDuplicateEntries:e,autoEntryPositions:r,entryStageSequence:a,ignoreStageSpace:u,drawDefinition:c,entryStatus:i,roundTarget:d,entryStage:s,extension:m,drawId:h,event:f});O.error&&(D=O.error)}if(f.eventType&&[Uu,Ta].includes(f.eventType)){let O=(f.entries||[]).map($=>$.participantId),k=(f.entries||[]).filter($=>fd($.entryStatus)).map($=>$.participantId),x=((l==null?void 0:l.participants)??[]).filter($=>O.includes($.participantId)&&$.participantType&&[ft,Kt].includes($.participantType)).map($=>$.individualParticipantIds).flat(1/0),F=k.filter($=>x.includes($));F.length&&(w.push(...F),mb({participantIds:F,autoEntryPositions:!1,event:f}))}if(E.length!==v.length)return ee({context:{mismatchedGender:T,gender:f.gender},result:{error:Ia},stack:g});r&&(f.entries=Ss({entries:f.entries||[]}));let N=S.length,A=w.length;return ee({result:{...X,addedEntriesCount:N,removedEntriesCount:A},stack:g,info:D})}var nq="ADMINISTRATION",Qse="CAPTAIN",Zse="COACH",Qr="COMPETITOR",aq="MEDIA",oq="MEDICAL",KA="OFFICIAL",sq="OTHER",lq="SECURITY",JA={ADMINISTRATION:nq,CAPTAIN:Qse,COACH:Zse,COMPETITOR:Qr,MEDIA:aq,MEDICAL:oq,OFFICIAL:KA,OTHER:sq,SECURITY:lq};function XA({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return ee({result:{error:ge},stack:a});if(!i||!e)return ee({result:{error:Xe},stack:a});let o=(r.participants??[]).find(c=>c.participantId===i);if(!o)return ee({result:{error:zi},stack:a});if(![Kt,qa].includes(o.participantType))return ee({result:{participantType:o.participantType,error:Cs},stack:a});let s=uq({individualParticipantIds:e,groupingParticipant:o,tournamentRecord:r,suppressErrors:n}),{removed:l,error:u}=s;if(u)return ee({result:s,stack:a});if(t)for(let c of r.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(m=>!d.includes(m));Ks({participantIds:p,entryStatus:Uo,tournamentRecord:r,event:c})}}return l&&lt({topic:nn,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...X,...s}}function uq({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){var p,m;let o=[];if(!e)return{removed:o};let s=[],l=[];a||({participants:a,mappedMatchUps:n}=Mi({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let u=(m=(p=a==null?void 0:a.find(({participantId:h})=>h===e.participantId))==null?void 0:p.events)==null?void 0:m.map(({eventId:h})=>h),c=(e.individualParticipantIds??[]).filter(h=>{var y;let f=t==null?void 0:t.includes(h),g=f&&((y=a==null?void 0:a.find(I=>I.participantId===h))==null?void 0:y.matchUps.filter(({eventId:I})=>u.includes(I)).map(({matchUpId:I})=>n==null?void 0:n[I]).filter(({winningSide:I,score:b})=>I||Ir({score:b}))),v=f&&!(g!=null&&g.length);if(f&&!v&&l.push(h),v){o.push(h);for(let I of i.events??[])for(let b of I.drawDefinitions??[]){let{extension:S}=vt({element:b,name:Du}),w=S==null?void 0:S.value[e.participantId];S&&w&&(S.value[e.participantId]=w.filter(T=>T.participantId!==h),Lt({element:b,extension:S}),qy({drawDefinition:b}));let U=Sn({drawDefinition:b,inContext:!1}).matchUps??[];for(let T of U){let D=T.sides??[];for(let P of D){let E=P.lineUp??[];E.find(R=>R.participantId===h)&&(P.lineUp=E.filter(R=>R.participantId!==h),Rt({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:b,matchUp:T}))}}}}else s.push(h);return!v});e.individualParticipantIds=c;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:s,removed:o};return l.length&&!r&&{...d,cannotRemove:l,error:z0}||d}function $T({participantRole:t=Qr,individualParticipantIds:e=[],groupingTypes:i=[Vn,qa],tournamentRecord:r}){if(!r)return{error:ge};let n=r.participants??[],{participants:a,mappedMatchUps:o}=Mi({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),s=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=uq({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:o,participants:a});u&&s++}),s?X:{error:iH}}function ph(t){var h,f;let e=ze(t,[{[wr]:!0},{participantIds:!0,[Jn]:cn,[jo]:jc}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:r,participantIds:n}=t,a=((h=r.participants)==null?void 0:h.length)||0;if(!a)return{...X};let o=(f=r.events||[])==null?void 0:f.filter(({eventType:g})=>g===lr).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),s=Mi({participantFilters:{participantIds:n},tournamentRecord:r,withDraws:!0}).participants??[],l=g=>{let v=(Vr({matchUpFilters:{drawIds:g,matchUpTypes:[Zt]},tournamentRecord:r}).matchUps??[]).flatMap(({sides:y})=>y==null?void 0:y.map(({participantId:I})=>I||[])).filter(Boolean);return Vi(v,n)},u=o!=null&&o.length?l(o):[],c=s.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(o!=null&&o.length)||!(o!=null&&o.includes(y.drawId)))&&y.positionAssignments).length});if(u!=null&&u.length||c.length)return{error:Ng};let d={},p={};for(let g of r.events||[]){let v=mb({participantIds:n,event:g});if(v.error)return v;d[g.eventId]=v.participantIdsRemoved}r.participants=(r.participants??[]).filter(g=>{var y,I;let v=n.includes(g.participantId)||g.participantType===ft&&((y=g.individualParticipantIds)==null?void 0:y.some(b=>n.includes(b)));if(!v&&g.participantType===lr&&((I=g.individualParticipantIds)!=null&&I.some(b=>n.includes(b)))&&(g.individualParticipantIds=g.individualParticipantIds.filter(b=>!n.includes(b))),v&&i&&g.participantType&&[ft,Kt].includes(g.participantType))for(let b of g.individualParticipantIds||[])n.includes(b)||(p[g.participantId]||(p[g.participantId]=[]),p[g.participantId].push(b));return!v});let m=a-r.participants.length;if($T({individualParticipantIds:n,tournamentRecord:r}),i)for(let g of r.events||[]){let v=d[g.eventId].map(y=>p[y]||[]).flat();Ks({participantIds:v,entryStatus:Uo,tournamentRecord:r,event:g})}return m&&lt({payload:{participantIds:n,tournamentId:r.tournamentId},topic:yA}),m?{...X,participantsRemovedCount:m}:{error:z0}}function cq({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){var l;let o=n.entries??[];if(r){let{flightProfile:u}=Gi({event:n}),c=(l=u==null?void 0:u.flights)==null?void 0:l.find(d=>d.drawId===r);c?o=c.drawEntries:e.entries&&(o=e==null?void 0:e.entries)}let s=o.filter(u=>(!(i!=null&&i.length)||!u.entryStatus||i.includes(u.entryStatus))&&(!a||!u.entryStage||u.entryStage===a)&&(!t||u.entryStatus&&ds.includes(u.entryStatus)));return{entries:o,stageEntries:s}}function dq({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:o}){var v;let s="destroyGroupEntry";if(!e)return{error:ge};if(!r)return ee({result:{error:mr},stack:s});if(!o)return{error:vi};if(!o.eventType||![Uu,Ta].includes(o.eventType))return ee({result:{error:Vl},stack:s});let l=e.participants??[],u=l.find(y=>y.participantId===r);if(!u)return ee({result:{error:zi},stack:s});if(!u.participantType||![ft,Vn].includes(u.participantType)||u.participantType===Vn&&o.eventType!==Ta||u.participantType===ft&&o.eventType!==Uu)return{error:Cs};let c=(o.entries??[]).find(y=>y.participantId===r);if(!c)return{error:oH};let{stageEntries:d}=cq({selected:!1,drawDefinition:i,drawId:n,event:o,stage:a}),p=d.map(Ut),m=l.filter(({participantId:y})=>p.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),h=(v=u.individualParticipantIds)==null?void 0:v.filter(y=>qs(y,m).length===1),f=mb({participantIds:[r],event:o});if(f.error||h!=null&&h.length&&(f=Ks({participantIds:h,entryStatus:Uo,entryStage:c.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:o}),f.error))return f;let g;return t&&ph({participantIds:[r],tournamentRecord:e}).success&&(g=!0),{...X,participantRemoved:g}}function QA({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return dq({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function pq(t){if(!t.tournamentRecord)return{error:ge};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let o=dq({participantId:a,...i});o.success&&(r+=1),o.error&&n.push(o.error)}return r?{destroyedCount:r,...X}:{error:n}}function $I(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:o,drawId:s}=t,l="removeDrawPositionAssignment",u=cb(t);if(u.error)return ee({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:m}=t,h=$t({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([Go,Eu].includes(a)&&c){let{tournamentRecord:g}=t,{participant:v}=Yc({tournamentRecord:g,participantId:c}),{participantType:y,individualParticipantIds:I}=v??{};if(n&&y===ft){let b=QA({tournamentRecord:g,drawDefinition:r,participantId:c,event:p});if(b.error)return ee({result:b,stack:l});I&&RS({participantIds:I,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:s,event:p})}else RS({participantIds:[c],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:s,event:p})}if(i){let g=Ka({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:m,matchUpsMap:o,event:p});if(g.error)return ee({result:g,stack:l})}let{structure:f}=it({drawDefinition:r,structureId:m});return MA({structure:f,drawPositions:[d]}),PT({appliedPolicies:h,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:m}}),u}function mq(t){return Object.assign(t,{entryStatus:Eu}),$I(t)}function BC(t){return Di(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Zr(t){return Di(t)?BC(t.replace(/_/g," ")):""}var Ic=({finishingPosition:t=eh,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:r=[],stageSequence:n=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:u,matchUpType:c,matchUps:d=[],structureId:p,roundOffset:m,roundLimit:h,stageOrder:f,structures:g,stage:v})=>{let y={structureId:p??Gt(),structureAbbreviation:i,finishingPosition:t,seedAssignments:r,matchUpFormat:s,stageSequence:n,structureName:u};a&&(y.structureOrder=a),l&&(y.structureType=l),o&&(typeof o=="string"?y.seedingProfile=o:typeof o=="object"&&typeof o.positioning=="string"&&(y.seedingProfile=o.positioning)),c&&(y.matchUpType=c),m&&(y.roundOffset=m),f&&(y.stageOrder=f),h&&(y.roundLimit=h),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let I=d.flatMap(({drawPositions:b})=>b).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=ct(I).sort((b,S)=>b-S).map(b=>({drawPosition:b}))),y},so=Ic;function ZA({structureName:t=Zr(Or),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:Le};let a=so({stage:Or,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),li({drawDefinition:i,structureIds:[a.structureId]}),{...X}}function eO({drawPositions:t}){if(!(t!=null&&t.length))return{error:My};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=ct(i.map(BT)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function BT(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(sr).join("|")}function hq({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,m)=>m),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),o=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{n[p].push([a[v],o[v]])});let m=a.shift(),h=a.pop(),f=o.shift();a=[m,f,...a].filter(Boolean),o=[...o,h].filter(Boolean)});let s=a.shift(),l=a.pop(),u=o.shift();a=[s,u,...a].filter(Boolean),o=[...o,l].filter(Boolean);let c=d=>d[0].reduce((p,m)=>p+m);return[...n].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(m=>m<=t)).map(p=>{let m=p.map(h=>h+e);return BT(m)}))}function ele({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Xe}}var tle={getRoundRobinGroupMatchUps:eO,determineRoundNumber:ele,drawPositionsHash:BT,groupRounds:hq};function hb(t){var U;let{groupNameBase:e="Group",playoffAttributes:i,stageSequence:r=1,structureOptions:n,appliedPolicies:a,seedingProfile:o,stage:s=Oe,matchUpType:l,roundTarget:u,structureId:c,groupNames:d,drawSize:p,idPrefix:m,isMock:h,uuids:f}=t,g=t.structureName??((U=i==null?void 0:i["0"])==null?void 0:U.name)??Zr(Oe),{groupCount:v,groupSize:y}=ile({structureOptions:n,appliedPolicies:a,drawSize:p}),I=kd,b,S=Te(1,v+1).map(T=>{let D=rle({groupSize:y,structureOrder:T,matchUpType:l,drawSize:p,idPrefix:m,isMock:h});b=Array.isArray(D)?Math.max(...D.map(({roundNumber:E})=>E??0)):0;let P=(d==null?void 0:d[T-1])??`${e} ${T}`;return Ic({structureId:f==null?void 0:f.pop(),structureType:sT,finishingPosition:I,structureOrder:T,structureName:P,matchUps:D})}),w=Ic({structureId:c??(f==null?void 0:f.pop()),structureType:xn,finishingPosition:I,seedingProfile:o,structureName:g,stageSequence:r,structures:S,stage:s});return u&&Lt({extension:{name:yl,value:u},element:w}),{structures:[w],maxRoundNumber:b,groupCount:v,links:[],groupSize:y,...X}}function ile({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e==null?void 0:e.groupSize,n=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=fb({groupSizeLimit:n,drawSize:i}),o=a&&Math.max(...a);r&&(a!=null&&a.includes(r))||(r&&r>4||!(a!=null&&a.includes(4))?r=o:r=4);let s=Math.ceil(i/r);return{groupSize:r,groupCount:s}}function fb(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=Te(3,e+1).filter(n=>{let a=Math.ceil(i/n),o=a*n-i,s=Math.ceil(i/a),l=Math.ceil(o/a);return(!o||o<n)&&s===n&&s>=3&&l<2});return{...X,validGroupSizes:r}}function rle({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:o}){let s=(t-1)*i,l=Te(1+s,i+1+s),u=eO({drawPositions:l}).uniqueMatchUpGroupings??[],c=hq({groupSize:i,drawPositionOffset:s});return u.map(p).sort((m,h)=>(m.roundNumber??1/0)-(h.roundNumber??1/0));function d(m){return c.reduce((h,f,g)=>f.includes(m)?g+1:h,void 0)}function p(m){let h=BT(m),f=d(h),g=[1,r],v=nle({structureOrder:t,drawPositions:m,roundNumber:f,idPrefix:n,uuids:o}),y={matchUpStatus:f?Xi:Vt,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:m,roundNumber:f,matchUpId:v};return a&&(y.isMock=!0),y}}function nle({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:(n==null?void 0:n.pop())||Gt()}function tO(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!ot(i))return{seedBlocks:void 0,...ee({result:{error:se},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=Pg(i);if(e){let m=Math.min(e,n),h=[],f=1;for(Te(0,m).forEach(()=>{h.push([f]),f++});f<n;){let g=Te(f,f+m);f+=m,h.push(g)}return{...X,seedBlocks:h}}let a=Te(1,n+1),o=[],s=n/2;for(;s>1;){let m=Rr(a,s),h=m.length;m.forEach((f,g)=>{let v,y=g<h/2,I=g%2===0,b=f[0],S=f[f.length-1];r&&h>4?h===8?v=y?S:b:v=I?b:S:v=y?b:S,Rn(f,o)||o.push(v)}),s=s/2}let l=a.filter(m=>!o.includes(m));for(;l.length;)l.length%2===0?o.push(l.pop()):o.push(l.shift());let u=Te(0,20).map(m=>Math.pow(2,m));u.unshift(1);let c=u.indexOf(n),d=0,p=[];return Te(0,c).forEach(m=>{p.push(o.slice(d,d+u[m])),d+=u[m]}),{...X,seedBlocks:p}}function iO({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!ot(e))return{seedGroups:void 0,...ee({result:{error:se},context:{drawSize:e},stack:i})};if(t){if(!ot(t))return{seedGroups:void 0,...ee({context:{roundRobinGroupsCount:t},result:{error:se},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:Te(0,n).map(()=>{let a=Te(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=tO({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function rO({roundRobinGroupsCount:t,participantsCount:e}){var n;if(t){let{validGroupSizes:a}=fb({drawSize:e});if(!((n=a==null?void 0:a.map(o=>Math.ceil(e/o)))!=null&&n.includes(t)))return ee({context:{roundRobinGroupsCount:t},result:{error:se}})}let{seedGroups:i}=iO({drawSize:e,roundRobinGroupsCount:t}),r=(i==null?void 0:i.map(a=>Math.min(...a)))||[];return{...X,seedingThresholds:r}}function Gf(t){if(!t)return 1/0;if(ot(t))return et(t);let e=t.split("-")[0];return ot(e)?et(e):1/0}function ale({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(sr),e.reverse(),e}function ole({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function sle({positioning:t,size:e}){let i=ale({size:e}),r=[],n=[],a=p=>p[0],o=p=>p[p.length-1],s=(p,m)=>(t&&[WN,Ad].includes(t)&&m%2?o(p):a(p))||a(p),l=(p,m)=>{if(p.every(h=>!n.includes(h))){let h=s(p,m);return n.push(h),h}},u=p=>{let m=p.filter(h=>!n.includes(h));if(m.length)return n.push(...m),m},c=(p,m)=>{let h=s(p,m);if(!n.includes(h))return n.push(h),h},d=Te(1,e+1);for(let p of i)if(p===1){let m=Rr(d,2),h=m.map(l).filter(Boolean);h.length&&r.push(h);let f=m.flatMap(u).filter(Boolean);f.length&&r.push(f)}else{let m=Rr(d,p).map(c).filter(Boolean);m.length&&r.push(m)}return{divisions:i,divisionGroupings:r}}function mh({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:o}){var C;let s=[];if(!o)return{error:lp};let{matchUps:l,roundMatchUps:u}=Wt({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:c}=ho({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:o}),{positionAssignments:d}=Er({structure:o}),p=d==null?void 0:d.length,m=(c==null?void 0:c.length)??0,h=[],f=Object.keys(u).map(O=>parseInt(O)).sort((O,k)=>O-k).map(O=>{let k=u[O].map(F=>F.drawPositions).flat(1/0).filter(Boolean),x=k.filter(F=>!h.includes(F));return h=h.concat(...k),x}).filter(O=>O.length).reverse(),g=f.pop()??[],v=g&&Math.min(...g)-1||0;r=r??((C=i==null?void 0:i.seeding)==null?void 0:C.seedingProfile);let y=(g==null?void 0:g.length)||0,I=f.filter(O=>O.filter(k=>k<=m).length),{stage:b,structureType:S,roundLimit:w}=o,U=S===xn,T=!U&&(f==null?void 0:f.length),D=!U&&b===Ke&&w,P=I.flat(1/0),E=T?P==null?void 0:P.length:0,R=a?p:m,N=LA({drawDefinition:n,structure:o,matchUps:l}),A=N?0:!T&&R||R&&P.length<R&&R-P.length||0;if(D){let O=o!=null&&o.matchUps?o.matchUps.filter(({roundNumber:x})=>x===o.roundLimit).length:0,k=g.length/O;if(!T){let x=gb(r),F=Rr(g,k),$=1,_=Te(0,F[0].length).map(()=>{let L=Te($,$+F.length);return $+=F.length,L});({validSeedBlocks:s}=fq({drawPositionBlocks:F,nonRandom:r==null?void 0:r.nonRandom,positioning:x,seedGroups:_}))}}else U?{validSeedBlocks:s}=lle({nonRandom:r==null?void 0:r.nonRandom,seedingProfile:r,structure:o}):T?s=I.map(O=>({seedNumbers:O,drawPositions:O})):N&&Rr(g,2).map((O,k)=>({drawPositions:[O[0]],seedNumbers:[k+1]})).forEach(O=>s.push(O));if(!U&&!N&&!D){let{blocks:O}=ule({drawPositionOffset:v,seedNumberOffset:E,seedCountGoal:A,seedingProfile:r,baseDrawSize:y});O.forEach(k=>s.push(k))}let M=s.flatMap(O=>O.drawPositions).reduce((O,k)=>(g==null?void 0:g.includes(k))&&O,!0);return!N&&!T&&!U&&!M?{error:OG,validSeedBlocks:[],isContainer:U,isFeedIn:T}:{isLuckyStructure:N,validSeedBlocks:s,isContainer:U,isFeedIn:T}}function lle({seedingProfile:t,structure:e,nonRandom:i}){var c;let r=e.structures||[],n=r.length,a=(c=oi({structure:e}))==null?void 0:c.positionAssignments,o=gb(t),s=(a==null?void 0:a.length)??0,{seedGroups:l}=iO({roundRobinGroupsCount:n,drawSize:s}),u=r.map(d=>{var p;return(p=oi({structure:d}).positionAssignments)==null?void 0:p.map(m=>m.drawPosition)});return fq({drawPositionBlocks:u,positioning:o,seedGroups:l,nonRandom:i})}function fq({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=sle({size:i.length,positioning:e}),o=[];return i.forEach((s,l)=>{let u=ole({blockPattern:a,index:l});s.forEach((c,d)=>{let p=l%2?t.length-d-1:d,m=t[p].slice().filter((f,g)=>u.includes(g+1)&&f);e!==Ad?m=r?m:wn(m):l%2&&m.reverse();let h=m.find(f=>!o.includes(f));h&&(o.push(h),n.push({drawPositions:[h],seedNumbers:[c]}))})}),{validSeedBlocks:n}}function ule(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:o}=t,s=1,l=[],{seedBlocks:u}=tO({cluster:gb(n)===WN,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let d of u){if(s+1>a)break;let p=d.map(h=>h+e),m=c(s+1,d.length).map(h=>+h+r);s+=d.length,l.push({drawPositions:p,seedNumbers:m})}return{blocks:l};function c(d,p){return Array.from(new Array(p),(m,h)=>h+d)}}function CS({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){var l,u,c,d,p,m;let{structure:o}=it({drawDefinition:e,structureId:n});t||(t=$t({drawDefinition:e}).appliedPolicies);let s=i==null?void 0:i.validSeedBlocks;return!s&&o&&(s=(l=mh({appliedPolicies:t,drawDefinition:e,structure:o}))==null?void 0:l.validSeedBlocks),(c=(u=t==null?void 0:t.seeding)==null?void 0:u.validSeedPositions)!=null&&c.ignore?!0:(p=(d=t==null?void 0:t.seeding)==null?void 0:d.validSeedPositions)!=null&&p.strict?(((m=s.find(h=>h.seedNumbers.includes(a)))==null?void 0:m.drawPositions)||[]).includes(r):[].concat(...s.map(h=>h.drawPositions)).includes(r)}function gq(t){var R,N,A;let{provisionalPositioning:e,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:o}=t,{structure:s}=it({drawDefinition:i,structureId:a}),{seedAssignments:l}=ho({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:s}),{positionAssignments:u}=Er({structure:s}),c=(R=u==null?void 0:u.filter(M=>M.participantId??M.bye??M.qualifier))==null?void 0:R.map(M=>M.drawPosition).filter(Boolean),{appliedPolicies:d}=$t({drawDefinition:i}),p=((n==null?void 0:n.validSeedBlocks)||s&&((N=mh({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:r,structure:s}))==null?void 0:N.validSeedBlocks)||[]).filter(M=>M.drawPositions.filter(C=>!(c!=null&&c.includes(C))).length)[0],m=l==null?void 0:l.map(M=>M.participantId).filter(Boolean),h=u==null?void 0:u.map(M=>M.participantId).filter(Boolean),f=m==null?void 0:m.filter(M=>h==null?void 0:h.includes(M)),g=m==null?void 0:m.filter(M=>!(h!=null&&h.includes(M))),v=l==null?void 0:l.filter(M=>g==null?void 0:g.includes(M.participantId)),y=l==null?void 0:l.filter(M=>!M.participantId),I=(v!=null&&v.length&&v.length>0?v.length:(y==null?void 0:y.length)??0)&&(p==null?void 0:p.drawPositions.filter(M=>!(c!=null&&c.includes(M))))||[],b=o?wn(I):I,S=[],w=b.map(()=>{var C;let M=(C=E(v,S))==null?void 0:C.participantId;return M&&S.push(M),M}).filter(Boolean),U=l==null?void 0:l.filter(M=>f==null?void 0:f.includes(M.participantId)).map(M=>M.seedNumber),T=((p==null?void 0:p.seedNumbers)||[]).filter(M=>!(U!=null&&U.includes(M))),D=l==null?void 0:l.filter(M=>T.includes(M.seedNumber)).map(M=>M.participantId),P=(A=d==null?void 0:d.seeding)==null?void 0:A.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:P===void 0||P?w:D,unplacedSeedNumbers:T,unfilledPositions:b,unplacedSeedAssignments:v};function E(M,C){let O=M.filter(F=>!C.includes(F.participantId)),k=Math.min(...O.map(F=>Gf(F.seedValue))),x=O.filter(F=>Gf(F.seedValue)===k);return wn(x).pop()}}function gb(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function zg({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:u,event:c}){var S,w,U;let d="assignSeed",{structure:p}=it({drawDefinition:i,structureId:o}),{positionAssignments:m}=Er({structure:p}),h=ho({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,f=h.map(T=>T.seedNumber),g=tm({drawDefinition:i,participantId:n});if(n&&!g)return ee({result:{error:Es},context:{participantId:n},stack:d});let v=c?(w=(S=Gi({event:c}).flightProfile)==null?void 0:S.flights)==null?void 0:w.length:0,y=v&&v>1,I=(U=m==null?void 0:m.find(T=>T.participantId===n))==null?void 0:U.drawPosition;if(I&&!CS({drawPosition:I,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s}))return ee({result:{error:cN},context:{assignedDrawPosition:I},info:"invalid seed position",stack:d});f.includes(s)||h.push({seedNumber:s,seedValue:l});let b;return h.forEach(T=>{T.participantId===n&&T.seedNumber!==s&&(T.participantId=void 0),T.seedNumber===s&&(T.participantId=n,!(r!=null&&r.groupSeedingThreshold)&&!y&&(T.seedValue=l??s),b=!0)}),b?(vW({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:p,eventId:u}),{...X}):ee({result:{error:AG},stack:d})}function nO({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:o}){var p,m,h,f;let s=(m=(p=t==null?void 0:t.sides)==null?void 0:p[e])==null?void 0:m.sideNumber,l=s&&((h=a.sides)==null?void 0:h.find(g=>g.sideNumber===s)),{extension:u}=vt({element:n,name:Du}),c=(u==null?void 0:u.value)||{},d=Ce(c[i],!1,!0);if(l)(f=a==null?void 0:a.sides)==null||f.forEach(g=>{g.sideNumber===s&&(g.lineUp=d)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(I=>I.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===s);g&&(g.lineUp=d)}Rt({tournamentId:r==null?void 0:r.tournamentId,context:"updateSidLineUp",eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUp:a})}function vq(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,o=i.roundNumber>1&&i.roundNumber-1,s=Ld({structureId:r.structureId,matchUpsMap:n});!e&&a&&(e=s.find(({drawPositions:h,roundNumber:f})=>f===o&&(h==null?void 0:h.includes(a))));let l=e==null?void 0:e.roundPosition,u=l%2?1:-1,c=l+u,d=o&&s.find(({roundNumber:h,roundPosition:f})=>h===o&&f===c),p=d==null?void 0:d.matchUpStatus,m=[tr,dr].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:m}}function cle({drawPosition:t,drawPositions:e}){let i=!1,r=!!(e!=null&&e.includes(t));return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(sr).filter(Boolean),positionAdded:i,positionAssigned:r}}function Iq({structureId:t,matchUpsMap:e,matchUp:i}){let r=i==null?void 0:i.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:Ld({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:s})=>o===(i==null?void 0:i.roundNumber)&&s===a)}}function yq({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:o}=Iq({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:r});if(a&&o){let s=o==null?void 0:o.matchUpId,l=t.find(c=>c.matchUpId===s),u=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(c=>{let d=Di(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function FU({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,o)=>{var s;return(s=a.drawPositions)!=null&&s.includes(e)?o+1:n},void 0)}function Hf({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:u}){var R,N,A,M;let c="assignMatchUpDrawPosition";s||(s=sn({drawDefinition:n})),t||(t=hr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[]);let d=t.find(C=>C.matchUpId===l),p=d==null?void 0:d.structureId,m=(R=n==null?void 0:n.structures)==null?void 0:R.find(C=>C.structureId===p);if(!m)return{error:Ci};let h=(N=s==null?void 0:s.drawMatchUps)==null?void 0:N.find(C=>C.matchUpId===l),f=(h==null?void 0:h.drawPositions)??[],{positionAdded:g,positionAssigned:v,updatedDrawPositions:y}=cle({drawPositions:f,drawPosition:o}),{positionAssignments:I}=oi({drawDefinition:n,structure:m}),b=(A=I==null?void 0:I.filter(C=>y.includes(C.drawPosition)))==null?void 0:A.find(({bye:C})=>C),S=(h==null?void 0:h.matchUpStatus)&&[zt,Mt].includes(h.matchUpStatus)&&y.filter(Boolean).length<2;if(a=b&&Vt||a||S&&h.matchUpStatus||(h==null?void 0:h.matchUpStatus)&&[tr,dr].includes(h.matchUpStatus)&&h.matchUpStatus||Xi,h&&g){t=hr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[];let C=S&&FU({inContextDrawMatchUps:t,drawPosition:o,matchUpId:l})||void 0;h!=null&&h.matchUpStatusCodes&&yq({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:s,matchUp:h}),Object.assign(h,{drawPositions:y,winningSide:C,matchUpStatus:a}),Rt({tournamentId:i==null?void 0:i.tournamentId,eventId:d==null?void 0:d.eventId,context:c,drawDefinition:n,matchUp:h})}let w=Cn({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:U,loserMatchUp:T,loserTargetDrawPosition:D},targetLinks:{loserTargetLink:P}}=w,E=Ld({structureId:m.structureId,matchUpsMap:s});if(v&&b){if(U)if([Vt,tr,dr].includes(a)){let C=Hf({matchUpId:U.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(C.error)return C}else{let{structureId:C}=U;C!==m.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(U&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:C}=vq({targetMatchUp:h,drawPosition:o,matchUpsMap:s,structure:m});if(C){let O=Hf({matchUpId:U.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(O.error)return O}}if((h==null?void 0:h.matchUpType)===fi){let C=t==null?void 0:t.find(({matchUpId:x})=>x===h.matchUpId),O=((C==null?void 0:C.sides)??[]).reduce((x,F,$)=>F.drawPosition===o?$:x,void 0),k=(M=I==null?void 0:I.find(x=>x.drawPosition===o))==null?void 0:M.participantId;k&&O!==void 0&&nO({inContextTargetMatchUp:C,drawPositionSideIndex:O,teamParticipantId:k,tournamentRecord:i,drawDefinition:n,matchUp:h})}if((P==null?void 0:P.linkCondition)===nl&&y.filter(Boolean).length===2&&!b&&E.filter(({drawPositions:C,roundNumber:O})=>O===1&&Rn(C,y)).every(({matchUpStatus:C})=>[qi,hn].includes(C))&&T){let{structureId:C}=T,O=Ka({drawPosition:D,tournamentRecord:i,drawDefinition:n,structureId:C,matchUpsMap:s,event:u});if(O.error)return O}return v?{...X}:ee({result:{error:Ef},context:{drawPosition:o},stack:c})}function bq({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){var c,d,p,m;let a=((p=(d=(c=Bg({drawDefinition:e}))==null?void 0:c.containedStructures)==null?void 0:d[n.structureId])==null?void 0:p.map(({structureId:h})=>h))||[];a.push(n==null?void 0:n.structureId);let o=(i==null?void 0:i.map(({drawPosition:h})=>h))||[],s=(t==null?void 0:t.filter(h=>a.includes(h.structureId)&&Vi(h.drawPositions??[],o).length))??[],l=s.map(({matchUpId:h})=>h),u=((m=r==null?void 0:r.drawMatchUps)==null?void 0:m.filter(h=>l.includes(h.matchUpId)))??[];return{drawPositions:o,matchUps:u,targetMatchUps:s}}function aO({lineUp:t}){if(!Array.isArray(t))return;let e={};return ct(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:o}=PS({collectionPosition:a,collectionId:r,lineUp:t});o.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Bd(t){return`${t} must be an array`}function VT({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Bd("lineUp")),{valid:!1,errors:i,error:se};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:o,collectionAssignments:s}=a;return o?typeof o!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Bd("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=ct(t.map(Ut)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?se:void 0}}function hh({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:Le};if(typeof e!="string")return{error:mr};let n=VT({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=vt({element:t,name:Du}),o=(a==null?void 0:a.value)||{};return o[e]=aO({lineUp:r}),Lt({element:t,extension:{name:Du,value:o}}),qy({drawDefinition:t}),{...X}}function oO({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:o,event:s}){if(!r)return{error:Le};let{drawPositions:l,matchUps:u,targetMatchUps:c}=bq({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:o});for(let d of c)d.matchUpType===xa&&(d.sides??[]).forEach((p,m)=>{var h;if(p!=null&&p.drawPosition&&(l!=null&&l.includes(p.drawPosition))){let f=u.find(({matchUpId:g})=>g===d.matchUpId);if((h=f==null?void 0:f.sides)!=null&&h[m]){if(delete f.sides[m].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&hh({drawDefinition:r,participantId:v,lineUp:[],tieFormat:g})}Rt({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:r,matchUp:f})}}});return{...X}}function ol({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){var P,E,R,N,A;let m="assignDrawPosition";if(!s&&!i)return ee({result:{error:mr},stack:m});c=c??sn({drawDefinition:a}),e||({matchUps:e}=hr({inContext:!0,drawDefinition:a,matchUpsMap:c}));let h=it({drawDefinition:a,structureId:d});if(h.error)return ee({result:h,stack:m});let{structure:f}=h;if(!f)return{error:Ci};if(zn({structure:f}))return ee({result:{error:oa},stack:m});let{seedAssignments:g}=ho({provisionalPositioning:t,drawDefinition:a,structure:f}),v=(P=g==null?void 0:g.find(M=>M.participantId===s))==null?void 0:P.seedNumber,{appliedPolicies:y}=$t({tournamentRecord:n,drawDefinition:a,structure:f,event:p});if(v&&!CS({seedNumber:v,appliedPolicies:y,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return ee({result:{error:cN},context:{drawPosition:u},stack:m});let I=Er({structure:f}).positionAssignments||[],b=I==null?void 0:I.find(M=>M.drawPosition===u);if(!b)return ee({result:{error:Rg},context:{drawPosition:u},stack:m});if(I!=null&&I.map(Ut).includes(s))return ee({result:{error:Ng},context:{drawPosition:u},stack:m});let{containsParticipant:S,containsBye:w}=D(b);if(w){let M=cb({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(M.error)return ee({result:M,stack:m})}if(S&&b.participantId!==s){let{activeDrawPositions:M}=ub({drawDefinition:a,structureId:d});if(M.includes(u))return ee({result:{error:B0},stack:m});oO({assignments:[b],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:f})}if(b.participantId=s,i&&(b.qualifier=!0),f.stage===Oe&&(!f.stageSequence||f.stageSequence>1)||f.stage&&[rn,$i].includes(f.stage)){let M=f.stage===Ke?Ke:Oe,C=(((R=(E=a.structures)==null?void 0:E.find(O=>(O==null?void 0:O.stage)===M&&(O==null?void 0:O.stageSequence)===1))==null?void 0:R.seedAssignments)??[]).find(O=>O.participantId===s);if(C!=null&&C.participantId){let{participantId:O,seedNumber:k,seedValue:x}=C;zg({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:O,seedNumber:k,seedValue:x,structureId:d,event:p})}}if(f.structureType!==xn)dle({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:f,event:p});else{QW({positionAssignments:I,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:f});let{drawPositions:M,matchUps:C,targetMatchUps:O}=bq({assignments:[b],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:f});if(M&&(C==null?void 0:C.length)===1&&C[0].matchUpType===fi){let k=((O==null?void 0:O[0].sides)??[]).reduce((x,F,$)=>M!=null&&M.includes(F.drawPosition)?$:x,void 0);nO({inContextTargetMatchUp:O[0],teamParticipantId:s,matchUp:C[0],drawPositionSideIndex:k,tournamentRecord:n,drawDefinition:a})}}let U=(N=a.entries)==null?void 0:N.find(M=>M.participantId===s),T=(A=p==null?void 0:p.entries)==null?void 0:A.find(M=>M.participantId===s);return!U&&T&&qA({entryStatus:T.entryStatus,entryStage:f.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:s,event:p}),Rc({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:f,event:p}),{positionAssignments:I,...X};function D(M){let C=M.bye,O=M.qualifier,k=M.participantId;return{containsBye:C,containsQualifier:O,containsParticipant:k,filled:C||O||k}}}function dle({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=Wt({provisionalPositioning:t,matchUpFilters:u,drawDefinition:n,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:d}=En({matchUps:c}),{initialRoundNumber:p}=Em({drawPosition:a,matchUps:c}),m=p&&(d==null?void 0:d[p].find(h=>{var f;return(f=h.drawPositions)==null?void 0:f.includes(a)}));if(m){let h=Hf({matchUpId:m.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o});if(h.error)return ee({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:h})}return{...X}}function sO(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:Le};let d=$t({tournamentRecord:n,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:m}=t;m||(m=sn({drawDefinition:a}),Object.assign(t,{matchUpsMap:m})),p||({matchUps:p}=hr({inContext:!0,drawDefinition:a,matchUpsMap:m}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:h}=oi({drawDefinition:a,structureId:l}),f=h==null?void 0:h.find(b=>b.drawPosition===s);if(f!=null&&f.participantId){let b=f.participantId,S=ol({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:u});return S.success?I({appliedPolicies:d,removedParticipantId:b}):ee({result:S,stack:c})}let g=cb({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:m,event:u});if(g.error)return ee({result:g,stack:c});let v=g.participantId,y=ol({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:u});if(!y.success)return ee({result:y,stack:c});return I({appliedPolicies:d,removedParticipantId:v});function I({appliedPolicies:b,removedParticipantId:S}){let{structure:w}=it({drawDefinition:a,structureId:l});MA({drawPositions:[s],structure:w});let U={[e]:o,name:r,drawPosition:s,structureId:l};return PT({appliedPolicies:b,drawDefinition:a,positionAction:U}),ee({context:{removedParticipantId:S},result:{...X},stack:c})}}function ple({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return sO({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function wq(t){return ple(t)}function Uq({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let o of i.matchUps)e[o.matchUpId]&&(o.roundNumber=e[o.matchUpId],Rt({tournamentId:r==null?void 0:r.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:n,matchUp:o}))}function Sq(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=ze(t,i);if(r.error)return r;let n=it(t);if(n.error)return n;let a=n.structure;if(!zn({structure:a}))return ee({result:{error:sp,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=En({matchUps:a==null?void 0:a.matchUps});return s!=null&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Gu}}function Tq(t){var c;let e=Sq(t,[{targetRoundNumber:!0,roundNumber:!0,[Jn]:noe}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e,{targetRoundNumber:a,roundNumber:o}=t;if(!(n!=null&&n.includes(o))||!(n!=null&&n.includes(a)))return ee({result:{error:se},info:"roundNumbers must be valid rounds"});let s=a>o,l=s?Te(o+1,a+1):Te(a,o),u={};return l.forEach(d=>((r==null?void 0:r[d])??[]).forEach(({matchUpId:p})=>{u[p]=d-(s?1:-1)})),(c=r==null?void 0:r[o])==null||c.forEach(({matchUpId:d})=>u[d]=a),Uq({params:t,modMap:u,structure:i}),{...X}}function Dq({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){var s;if(!r)return{error:Le};if(!Array.isArray(t))return{error:se};let a="setPositionAssignments";for(let l of t){let{structureId:u,positionAssignments:c}=l;if(!c)continue;let d=it({drawDefinition:r,structureId:u});if(d.error)return d;let p=d.structure;if(!p)return{error:Ci};let m=(s=oi({structure:p}).positionAssignments)==null?void 0:s.map(({drawPosition:v})=>v),h=c==null?void 0:c.map(({drawPosition:v})=>v);if(Vi(m,h).length!==(m==null?void 0:m.length))return ee({result:{error:se},info:"drawPositions do not match",stack:a});let f=sn({drawDefinition:r}),{matchUps:g}=hr({inContext:!0,drawDefinition:r,matchUpsMap:f});for(let v of c||[]){let{drawPosition:y,participantId:I,bye:b,qualifier:S}=v;if(b){let w=Ka({tournamentRecord:i,drawDefinition:r,drawPosition:y,matchUpsMap:f,structureId:u,structure:p,event:n});if(w!=null&&w.error)return w}else if(S)c.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(I){let w=ol({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:r,participantId:I,drawPosition:y,matchUpsMap:f,structureId:u,event:n});if(w!=null&&w.error)return w}}Rc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:p,event:n})}let o=t.map(({structureId:l})=>l);return li({tournamentId:i==null?void 0:i.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:r,structureIds:o}),{...X}}function Pq(t){let e=Sq(t,[{roundNumbers:!0,[Jn]:cn,[Kr]:o=>o.length===2&&o.every(_i)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(o=>n==null?void 0:n.includes(o)))return ee({result:{error:se,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((o,s)=>((r==null?void 0:r[o])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-s]})),Uq({params:t,modMap:a,structure:i}),{...X}}function mle({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return sO({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function Rq(t){return mle(t)}function Eq({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return sO({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function Cq({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:o}){if(!i)return{error:Le};if(!n)return{error:Wa};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===r);if(e&&!s)return{error:Es};let{structure:l}=it({drawDefinition:i,structureId:n});if(!l)return{error:Ci};if(!(!t||_i(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>_i(p)&&et(p)>0)))return{error:se};let{seedAssignments:u}=ho({drawDefinition:i,structure:l}),c=u==null?void 0:u.map(p=>p.seedNumber),d=u==null?void 0:u.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(m=>parseInt(m)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return vW({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:i,structure:l}),{...X}}function Mq({drawDefinition:t,structureId:e}){if(!t)return{error:Le};let{structure:i}=it({drawDefinition:t,structureId:e}),r=((t==null?void 0:t.links)||[]).filter(n=>{var a;return((a=n.source)==null?void 0:a.structureId)===e}).map(n=>{var a;return(a=n.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(n=>r.includes(n.structureId)),structure:i}}function jT({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:o}){if(!a)return{error:vi};let s={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=is({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:r,stages:n,stage:o});if(l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function lO({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:o}){if(!e)return{error:ge};let s={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=jT({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:u,stage:o});if(c&&l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function Cc(t){if(!(t!=null&&t.drawDefinition))return!1;let e=LT(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r==null?void 0:r.filter(({matchUpType:o})=>o===fi),n=n==null?void 0:n.filter(({matchUpType:o})=>o===fi),a=a==null?void 0:a.filter(({matchUpType:o})=>o===fi)),!!(r!=null&&r.length&&!(n!=null&&n.length)&&!(a!=null&&a.length))}function uO(t){var o,s;let{drawDefinition:e,structureId:i}=t;if(!e)return{error:Le};let{playoffStructures:r}=Mq({drawDefinition:e,structureId:i});if(!(r!=null&&r.length))return!1;let n=((s=(o=e==null?void 0:e.entries)==null?void 0:o.filter(l=>(l==null?void 0:l.entryStatus)&&ds.includes(l.entryStatus)))==null?void 0:s.length)??0,a=0;return(r||[]).reduce((l,u)=>{var c;return!!((c=oi({structure:u}).positionAssignments??[])!=null&&c.filter(d=>(d.participantId&&a++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!r.length)||a===n}function VC({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i!=null&&i[n]){let o=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(s=>{let l=VC({accessors:o,significantCharacters:t,value:s});r.push(...l)});else if(i=i[n],o.length){let s=VC({accessors:o,significantCharacters:t,value:i});r.push(...s)}else a({value:i})}function a({value:o}){if(o&&["string","number"].includes(typeof o)){let s=t?o.slice(0,t):o;r.push(s)}}return r}function hle({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:bN};if(!Array.isArray(r))return{error:Oy};let n={};return t.forEach(a=>{let o=r.find(l=>l.participantId===a),{values:s}=Nq({policyAttributes:e,idCollections:i,participants:r,participant:o});s&&s.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function Nq({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:bN};if(!r)return{error:Km};let n=[];return t.forEach(a=>{let{directive:o,groupings:s,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");n.push(...VC({significantCharacters:u,value:r,accessors:c}))}else if(o){let c=a==null?void 0:a.includeIds,d=((e==null?void 0:e[o])||[]).filter(p=>!c||c.includes(p));d!=null&&d.length&&(i!=null&&i.length)&&d.forEach(p=>{var h;let m=i.find(f=>f.participantId===p);if((h=m==null?void 0:m.individualParticipantIds)!=null&&h.includes(r.participantId)){let f=m==null?void 0:m.participantId;n.push(f)}})}else s&&Object.keys(s).forEach(c=>{s[c].includes(r.participantId)&&n.push(c)})}),{values:ct(n)}}function OB({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let o=n[a.participantId],{values:s}=Nq({participants:e,policyAttributes:i,idCollections:r,participant:o});return{...a,values:s}})}function Aq({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r==null?void 0:r.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,o=t?t[a]||[]:[],s=!!i.some(l=>o.includes(l));return{[n]:{participantGroups:o,includesGroupsToAvoid:s}}}))}function fle(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=Aq(t);return i.map(a=>{let o=e.filter(u=>a.includes(u)),s=n(o),l=o.filter(u=>!s.includes(u)).filter(u=>{var d;let c=kB(u);return!((d=r[c])!=null&&d.includesGroupsToAvoid)});return{unassigned:o,unpaired:s,pairedNoConflict:l}});function n(a){return a.filter(s=>!o(s));function o(s){let l=kB(s);return!a.includes(l)}}}function gle(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=Aq(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),o=a.length===n.length?a:[],s=n.filter(l=>{var u;return(u=r[l])==null?void 0:u.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:o,pairedNoConflict:s?[]:a,conflictsCount:s}})}function kB(t){return Number(t%2?t+1:t-1)}function vle({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function Ile({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let o=r.map(s=>a?gle({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):fle({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:u}}else{let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length);return{unassigned:s,unpaired:l,pairedNoConflict:u}}}function Oq({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function yle({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){var u;let a=Object.assign({},...Object.keys(r).map(c=>[c,r[c].filter(d=>e.includes(d))]).filter(c=>c[1].length).map(([c,d])=>({[c]:d}))),o=Object.keys(a).reduce((c,d)=>a[d].length>c?a[d].length:c,0),s=Object.keys(a).filter(c=>a[c].length===o),l=ma(i?s:Object.keys(a));return n=t&&((u=a[n])!=null&&u.length)?n:l,{participantId:n&&a[n]?ma(a[n]):ma(e),groupKey:n}}function ble({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function wle({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:o,groupKey:s}){let l=n.reduce((T,D)=>D.length>T?D.length:T,0)<=2,u=Oq({positionAssignments:t,participantIds:e}),c=ble({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=yle({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:o,groupKey:s}),m=vle({participantId:d,allGroups:o}),h=Ile({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:m,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:c}),{unassigned:f,unpaired:g,pairedNoConflict:v}=h,y=(v==null?void 0:v.length)&&v[0],I=(g==null?void 0:g.length)&&g[0],b=a&&y?y:I,S=a?I:y,w=(b==null?void 0:b.length)&&b||(S==null?void 0:S.length)&&S,U;if(w!=null&&w.length){let T=ga(w);U=ga(T)}else{let T=ga(f[0]);U=ga(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:U}}function MS({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(s=>s.drawPosition),a=eO({drawPositions:n}).uniqueMatchUpGroupings??[],o=Object.assign({},...r.map(s=>({[s.drawPosition]:s})));a.forEach(s=>{Rn(o[s[0]].values||[],o[s[1]].values||[])&&(i.push(s),r.conflict=!0)})}):e.forEach(r=>{var n,a;Rn(((n=r[0])==null?void 0:n.values)||[],((a=r[1])==null?void 0:a.values)||[])&&(i.push(r),r.conflict=!0)}),i}function Ule({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.map(a=>{let o=a.map(s=>s.drawPosition);return a.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(u=>!(o!=null&&o.includes(u))).filter(u=>{let c=i.find(f=>f.includes(u)).find(f=>f!==u),d=t.find(f=>f.drawPosition===c),p=MS({isRoundRobin:n,groupedParticipants:[[s,d]]}),m=[t.find(f=>f.drawPosition===u),d],h=MS({isRoundRobin:n,groupedParticipants:[m]});return!p.length&&!h.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function xB(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(I=>I==null?void 0:I.length).filter(Boolean)),p=d>2,m=Ce(e,!1,!0).filter(I=>!I.qualifier),h=e.filter(I=>!I.participantId&&(!I.bye||(n==null?void 0:n.includes(I.drawPosition)))).map(I=>I.drawPosition);Te(0,r).forEach(()=>{let{newGroupKey:I,selectedParticipantId:b,targetDrawPosition:S}=wle({...t,candidatePositionAssignments:m,allGroups:l,groupKey:c});c=I,m.forEach(w=>{w.drawPosition===S&&(w.participantId=b)})});let f=OB({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Rr(f,d),v=MS({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let I=Ule({positionedParticipants:f,potentialDrawPositions:h,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(I.length){let b=Sle({candidatePositionAssignments:m,swapOptions:I});b.error&&console.log({result:b}),f=OB({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Rr(f,d),v=MS({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return m.forEach(I=>{if(I.bye&&I.participantId){let b=vC;u.push(b)}if(I.qualifier&&I.participantId){let b=vC;u.push(b)}}),{positionAssignments:m,conflicts:v.length,groupedParticipants:g,errors:u}}function Sle({candidatePositionAssignments:t,swapOptions:e}){let i=ga(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=ga(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===r),o=t.find(u=>u.drawPosition===n)??{},s={participantId:o==null?void 0:o.participantId,qualifier:o==null?void 0:o.qualifier,bye:o==null?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...X}}function Tle({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){var $;if(!c)return{error:HG};let{candidatesCount:m=1,policyAttributes:h,targetDivisions:f}=c,{roundsToSeparate:g}=c,v="randomUnseededSeparation",{structure:y}=it({drawDefinition:a,structureId:u}),{matchUps:I}=Wt({provisionalPositioning:t,matchUpsMap:l,structure:y,event:p});if(f&&Rs(f)&&!g){let _=mne(f)||0,L=I.reduce((B,V)=>V.roundNumber>B?V.roundNumber:B,0);g=L<_?1:L-_+1}let{positionAssignments:b}=Er({structure:y}),S=ET({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,w=b==null?void 0:b.filter(_=>!_.participantId),U=b==null?void 0:b.map(_=>_.drawPosition),T=(y==null?void 0:y.structureType)===xn,D=T?{structure:y,matchUps:I,allDrawPositions:U,roundsToSeparate:g}:{matchUps:I,allDrawPositions:U,roundsToSeparate:g},{drawPositionGroups:P,drawPositionChunks:E}=T?Dle(D):Ple(D),R={groupParticipants:s.filter(_=>_.participantType===qa).map(_=>_.participantId),teamParticipants:s.filter(_=>_.participantType===Kt).map(_=>_.participantId),pairParticipants:s.filter(_=>_.participantType===ft).map(_=>_.participantId)},N=hle({targetParticipantIds:e,policyAttributes:h,idCollections:R,participants:s});if(N.error)return ee({result:N,stack:v});let A=Object.assign({},...e.map(_=>{let L=Object.keys(N).filter(B=>(N[B]??[]).includes(_));return{[_]:L}})),M=Oq({participantIds:e,positionAssignments:b});if(M.length>((w==null?void 0:w.length)||0))return{error:DN};let C,O=M.length,k=Te(0,m).map(()=>xB({initialPositionAssignments:b,participantsWithGroupings:S,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:r,participantIdGroups:A,drawPositionChunks:E,drawPositionGroups:P,policyAttributes:h,idCollections:R,allGroups:N,drawSize:d}));if(C=k.reduce((_,L)=>!_||(L.conflicts||0)<(_.conflicts||0)?L:_,void 0),!C||C.conflicts){let _=Te(0,m).map(()=>xB({initialPositionAssignments:b,participantsWithGroupings:S,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:r,participantIdGroups:A,drawPositionChunks:E,drawPositionGroups:P,policyAttributes:h,idCollections:R,allGroups:N,drawSize:d}));C=k.concat(..._).filter(L=>{var B;return!((B=L.errors)!=null&&B.length)}).reduce((L,B)=>!L||(B.conflicts||0)<(L.conflicts||0)?B:L,void 0)}if(!C)return{error:K0};let x=((($=oi({structure:y}))==null?void 0:$.positionAssignments)??[]).filter(_=>_.participantId).map(_=>_.participantId),F=C.positionAssignments.filter(_=>!x.includes(_.participantId));for(let _ of F)if(_.bye){let L=Ka({tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,..._});if(L.error)return ee({result:L,stack:v})}else if(_.participantId){let L=ol({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,..._});if(L.error)return ee({result:L,stack:v,context:{assignment:_}})}return{...X}}function Dle(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function Ple({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),n=r.flat().sort(sr),a=Math.max(...n),o=t.filter(c=>c>a),s=n.length,l=Te(s===2?1:2,s).filter(c=>c===lN(c)),u=l.slice(0,e||l.length).reverse().map(c=>Rr(n,c));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:r,drawPositionChunks:u}}function Rle({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){var D,P;let m="positionUnseededParticipants";c||({structure:c}=it({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:h}=Er({structure:c}),{seedAssignments:f}=ho({provisionalPositioning:t,drawDefinition:a,structure:c}),g=f==null?void 0:f.map(E=>E.participantId).filter(Boolean),{stage:v,stageSequence:y}=c,I=v===Ke?(P=(D=vt({element:c,name:yl}))==null?void 0:D.extension)==null?void 0:P.value:void 0,b=rh({provisionalPositioning:t,drawDefinition:a,stageSequence:y,entryStatuses:gp,structureId:u,roundTarget:I,stage:v}),S=b.filter(E=>!(g!=null&&g.includes(E.participantId))).map(E=>E.participantId),w=h==null?void 0:h.filter(E=>!E.participantId&&!E.bye&&!E.qualifier).map(E=>E.drawPosition);if(!r&&S.length>((w==null?void 0:w.length)||0))return ee({result:{error:DN},context:{unseededParticipantsCount:S.length,unfilledDrawPositionsCount:w==null?void 0:w.length},stack:m});let{appliedPolicies:U}=$t({tournamentRecord:n,drawDefinition:a,event:p}),T=U==null?void 0:U[yS];if(c.stage===$i){let E=b.reduce((R,N)=>(R[N.groupingValue]||(R[N.groupingValue]=[]),R[N.groupingValue].push(N.participantId),R),{});Object.keys(E).length&&(T||(T={policyName:"Playoff Avoidance"}),T.policyAttributes||(T.policyAttributes=[]),T.policyAttributes.push({groupings:E}))}return T&&s?Tle({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:T,drawSize:d,entries:b}):Ele({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unfilledDrawPositions:w,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function Ele({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?wn(r):r.reverse();for(let m of e){let h=p.pop();if(!n||h){let f=ol({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:m,drawPosition:h,matchUpsMap:l,structureId:u,event:d});if(f!=null&&f.error&&console.log("!!!!!",{result:f}),f==null?void 0:f.error)return ee({result:f,stack:"randomUnseededDistribution"})}}return{...X}}function Cle(t){let e=t.structure??it(t).structure,i="positionQualifiers",r=[];if(e.stage===rn)return ee({result:{error:up},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:o}=Mle(t);for(let s of Object.keys(n)){let l=a==null?void 0:a.filter(u=>o[s].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(n[s]>(l||0))return ee({result:{error:uH},context:{unfilledDrawPositions:l},stack:i});Te(0,n[s]).forEach(()=>{let u=ga(l);r.push(u),a==null||a.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...X,qualifierDrawPositions:r}}function Mle({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=it({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=Er({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:o,roundQualifiersCounts:s}=Gg({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(s?Object.keys(s):[]).map(f=>et(f)),{matchUps:u}=Wt({structure:e}),{roundProfile:c}=En({matchUps:u}),d=Object.assign({},...l.filter(f=>c==null?void 0:c[f]).map(f=>{var g,v;return{[f]:((v=(g=c==null?void 0:c[f])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=r==null?void 0:r.filter(f=>f.qualifier).map(f=>f.drawPosition),m=o-((p==null?void 0:p.length)??0),h=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(f=>{let g=r==null?void 0:r.filter(v=>{var y,I;return v.qualifier&&((I=(y=d[f])==null?void 0:y.drawPositions)==null?void 0:I.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[f]:((s==null?void 0:s[f])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:m,placedQualifiersCount:h,roundQualifiersCounts:s,positionAssignments:r,roundDrawPositions:d,qualifiersCount:o}}function FB({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:m}){let h=[],f=[],g=0;if(p||({structure:p}=it({drawDefinition:a,structureId:c})),c||(c=p==null?void 0:p.structureId),r||(r=$t({drawDefinition:a}).appliedPolicies),!n){let v=p&&mh({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:o,structure:p});v!=null&&v.error&&f.push(v.error),n=v==null?void 0:v.validSeedBlocks}return u=u??(n==null?void 0:n.length)??0,Te(0,u).forEach(()=>{if(g<(u||0)){let v=Nle({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:c,matchUpsMap:d,event:m});v!=null&&v.success&&(g++,h.push(...v.seedPositions??[])),v.error&&f.push({seedPositionError:v.error})}}),f.length?{error:f}:{...X,seedPositions:h}}function Nle({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=gq({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:s,event:u}),{appliedPolicies:p}=$t({drawDefinition:r}),{avoidance:m}=p??{};m&&o&&(c==null?void 0:c.length)>2;let h=[];for(let f of c){let g=d.pop();if(!g)return{error:Eg};h.push(g);let v=ol({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:f,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:s,event:u});if(!v.success)return v}return{...X,seedPositions:h}}function Ale({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=Er({structure:i}),{seedAssignments:n}=ho({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(o=>o.participantId).map(o=>({[o.participantId]:o})));return r==null?void 0:r.map(o=>a[o.participantId]?{...o,seedNumber:a[o.participantId].seedNumber,seedValue:a[o.participantId].seedValue}:"").filter(Boolean)}function Ole({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>{if(i-r.length>a.drawPositions.length)r.push(...a.drawPositions);else{let o=jC(Rr(a.drawPositions,2)),s,l=t[r.length];for(;s=LU(o,l);)r.push(s),l=t[r.length]}});let n=r.map(a=>Array.isArray(a)?wn(a):a).flat(1/0);return pG(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function LU(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return LU(e?n:t[Math.round(Math.random())],e)}return i<r?LU(t[1],e):LU(t[0],e)}function jC(t){let e=Math.floor(t.length/2);return t.length>2?[jC(t.slice(0,e)),jC(t.slice(e))]:t}function kle({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:o,structure:s}){var b;a||(a=mh({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:s}));let{isFeedIn:l,isLuckyStructure:u,isContainer:c}=a,{validSeedBlocks:d}=a;(b=i==null?void 0:i.seeding)!=null&&b.containerByesIgnoreSeeding&&(d=[]);let p=Ale({provisionalPositioning:t,drawDefinition:r,structure:s})??[],m=ct([].concat(...e.map(S=>S.drawPositions))),h=p.filter(S=>m.includes(S.drawPosition)),f=(S,w)=>Gf(S.seedValue)-Gf(w.seedValue),g=d.reduce((S,w)=>{let U=h.filter(T=>{var D;return(D=w.drawPositions)==null?void 0:D.includes(T.drawPosition)}).sort(f);return S.concat(...U)},[]).map(S=>S.drawPosition),v=Ole({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:o}),y=LB({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,o),I=LB({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,o);return{strictSeedOrderByePositions:y,blockSeedOrderByePositions:I,isLuckyStructure:u,positionedSeeds:p,isContainer:c,isFeedIn:l}}function LB({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r==null?void 0:r.sort((n,a)=>n-a)).filter(r=>(r==null?void 0:r[0])+1===(r==null?void 0:r[1]));return t.map(r=>i.find(n=>n==null?void 0:n.includes(r))).filter(Boolean).map(r=>r==null?void 0:r.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function xle({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:o,isFeedIn:s}){var M,C;let l=(M=r==null?void 0:r.seeding)==null?void 0:M.seedingProfile,u=o.stage===Ke,{positionAssignments:c}=Er({structure:o}),d=c==null?void 0:c.filter(O=>O.participantId).map(O=>O.drawPosition),p={isCollectionMatchUp:!1},{matchUps:m,roundMatchUps:h}=Wt({provisionalPositioning:t,matchUpFilters:p,structure:o}),f=(h==null?void 0:h[1])||[],g=o.structureType===xn?m:f,v=ct([].concat(...g.map(O=>O.drawPositions))),y=Math.min(...v)-1,I=d==null?void 0:d.filter(O=>v.includes(O)),b=O=>{let k=Math.ceil(O.length/2),x=[O.slice(0,k),O.slice(k)],F=x.map(z=>[].concat(...z.flat(1/0)).length),$=Math.min(...F.flat(1/0)),_=Math.max(...F.flat(1/0)),L=F.indexOf(_),B=$!==_,V=wn(x),[G,j]=!$||B?[x[L],x[1-L]]:[V[0],V[1]];return{greaterHalf:G,lesserHalf:j}},S=O=>{let{greaterHalf:k,lesserHalf:x}=b(O),{greaterHalf:F,lesserHalf:$}=b(k),_=wn(F.flat(1/0)).pop(),L=F.flat().filter(B=>B!==_);return{newlyFilteredChunks:[...x,...$,L],drawPosition:_}},w=O=>!e.includes(O),U=O=>!(I!=null&&I.includes(O)),T=O=>{let k=Rr(O.sort(sr),Math.ceil(O.length/4)).map($=>$.filter(U)),x=[].concat(...k.flat(1/0)).length,F=[];for(let $=0;$<x;$++){let{newlyFilteredChunks:_,drawPosition:L}=S(k);F.push(L),k=_}return F},{validSeedBlocks:D}=mh({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:o}),P=D==null?void 0:D.map(O=>{var k;return(k=O.drawPositions)==null?void 0:k.map(x=>x+y)}),E;if(s){let O=v.length,{seedBlocks:k}=tO({cluster:gb(l)===WN,participantsCount:O});E=k.map(x=>x.map(F=>F+y)).map(T).filter(x=>x.length)}else u?E=P==null?void 0:P.map(O=>O.filter(U)):E=P==null?void 0:P.map(T).filter(O=>O.length);let R=g.map(O=>O.drawPositions).map(O=>O==null?void 0:O.sort((k,x)=>k-x)).filter(O=>(O==null?void 0:O[0])+1===(O==null?void 0:O[1])),N=O=>R.reduce((k,x)=>x.includes(O)?x.reduce((F,$)=>$!==O?$:F,void 0):k,void 0),A=E.map(O=>O.map(N)).flat(1/0).filter(U).filter(w).filter(Boolean);if(u&&!o.structures){let O=a%4,k=A.slice(0,O),x=(C=h[o.roundLimit])==null?void 0:C.length,F=Rr(A.slice(O),x).map(wn).flat();A=k.concat(F)}return{unseededByePositions:A}}function Fle({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){var P;let a={isCollectionMatchUp:!1},{matchUps:o,roundMatchUps:s}=Wt({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:r,event:n}),l=(s==null?void 0:s[1])||[],u=(r==null?void 0:r.structureType)===xn,c=u?o:l,d=u?((P=r==null?void 0:r.structures)==null?void 0:P.length)||0:o.length,{structureId:p,stage:m,stageSequence:h}=r,f=rh({entryStatuses:ds,provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:m}),{qualifiersCount:g}=Gg({provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:m}),v=f.length+g,{positionAssignments:y,unassignedPositions:I}=Er({structure:r}),b=I==null?void 0:I.map(E=>E.drawPosition),S=y==null?void 0:y.filter(E=>E.bye).length,w=y==null?void 0:y.filter(E=>E.bye).map(E=>E.drawPosition),U=c.map(E=>E.drawPositions).filter(E=>E==null?void 0:E.reduce((R,N)=>!(w!=null&&w.includes(N))&&R,!0)).flat(1/0).filter(E=>b==null?void 0:b.includes(E)),T=y==null?void 0:y.length,D=T?T-v:0;return D>d&&r.stageSequence===1&&r.stage!==rn&&(D=d),{placedByes:S,byesCount:D,relevantMatchUps:c,placedByePositions:w,roundMatchUps:s,positionsToAvoidDoubleBye:U}}function _B({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:u,seedsOnly:c,event:d}){var R;l||({structure:l}=it({drawDefinition:r,structureId:s})),s||(s=l==null?void 0:l.structureId);let p=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===Ke),{byesCount:m,placedByes:h,relevantMatchUps:f}=Fle({provisionalPositioning:t,drawDefinition:r,matchUpsMap:o,structure:l,event:d}),g=m-(h||0);if(g<=0)return{...X};let{strictSeedOrderByePositions:v,blockSeedOrderByePositions:y,isLuckyStructure:I,isFeedIn:b}=kle({provisionalPositioning:t,relevantMatchUps:f,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:l}),S=(l==null?void 0:l.structureType)&&[xn,sT].includes(l.structureType)&&((R=i==null?void 0:i.seeding)==null?void 0:R.containerByesIgnoreSeeding),w=p&&(y!=null&&y.length)?y:v,{unseededByePositions:U}=xle({provisionalPositioning:t,seedOrderByePositions:w,isLuckyStructure:I,appliedPolicies:i,drawDefinition:r,seedLimit:u,structure:l,isFeedIn:b}),T=N=>N%2,D=(N,A)=>(N||[]).every(M=>T(M)?A!==M+1:A!==M-1),P=[].concat(...w);if(!c)for(;U.length;){let N=U.find(A=>D(P,A));N?(P.push(N),U=U.filter(A=>A!==N)):(P.push(...U),U=[])}S&&(P=wn(P),La({ignoreSeededByes:S})&&console.log({byePositions:P}));let E=P.slice(0,g);for(let N of E){let A=Ka({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:d});if(A!=null&&A.error)return A}return{...X,unseededByePositions:U,byeDrawPositions:E}}function vb(t){var M,C,O,k;let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:o,placementGroup:s,seedingProfile:l,structureId:u,seedLimit:c,seedsOnly:d,drawType:p,drawSize:m,event:h}=t,f=[];i||(AH(),e=Ce(e,!1,!0));let g=x=>(i||CU(),ee({result:x,stack:"automatedPositioning"})),v=x=>(i||CU(),x),y=it({drawDefinition:e,structureId:u});if(y.error)return g(y);let I=y.structure;if(!I)return{error:Ci};let b=t.appliedPolicies||((M=$t({drawDefinition:e,structure:I,event:h}))==null?void 0:M.appliedPolicies),{qualifiersCount:S}=Gg({stageSequence:I.stageSequence,provisionalPositioning:r,stage:I.stage,drawDefinition:e,structureId:u}),w=gp;if(!((C=rh({stageSequence:I.stageSequence,provisionalPositioning:r,stage:I.stage,placementGroup:s,drawDefinition:e,entryStatuses:w,structureId:u}))!=null&&C.length)&&!S)return v({...X});let U=t.matchUpsMap??sn({drawDefinition:e}),T=t.inContextDrawMatchUps??((O=hr({inContext:!0,drawDefinition:e,matchUpsMap:U}))==null?void 0:O.matchUps),D=[],P=mh({provisionalPositioning:r,appliedPolicies:b,drawDefinition:e,seedingProfile:l,structure:I});if(P.error)return P;let{validSeedBlocks:E}=P;f.push({validSeedBlocks:E});let R=t.participants||(o?(k=Mi({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:o}))==null?void 0:k.participants:[]);if(gb(I.seedingProfile||l)===Ad){let x=a?_B({provisionalPositioning:r,tournamentRecord:o,appliedPolicies:b,drawDefinition:e,seedBlockInfo:P,matchUpsMap:U,structure:I,seedLimit:c,seedsOnly:d,event:h}):void 0;if(x!=null&&x.error)return g(x);D=x.unseededByePositions,f.push({action:"positionByes",unseededByePositions:D});let F=I.seedingProfile?{positioning:I.seedingProfile}:l;if(x=FB({seedingProfile:F,provisionalPositioning:r,inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:E,drawDefinition:e,seedBlockInfo:P,participants:R,matchUpsMap:U,structure:I,event:h}),x.error)return g(x);f.push({seedPositions:x.seedPositions,action:"positionSeedBlocks"})}else{if(p!==cp){let F=I.seedingProfile?{positioning:I.seedingProfile}:l,$=FB({seedingProfile:F,provisionalPositioning:r,inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:E,drawDefinition:e,seedBlockInfo:P,participants:R,matchUpsMap:U,structure:I,event:h});if($.error)return g($);f.push({action:"positionSeedBlocks",seedPositions:$.seedPositions})}let x=a?_B({provisionalPositioning:r,tournamentRecord:o,appliedPolicies:b,drawDefinition:e,seedBlockInfo:P,matchUpsMap:U,structure:I,seedLimit:c,seedsOnly:d,event:h}):void 0;if(x!=null&&x.error)return g(x);D=x==null?void 0:x.unseededByePositions,f.push({action:"positionByes",byeDrawPositions:x==null?void 0:x.byeDrawPositions,unseededByePositions:D})}let N={};if(!d){let x=Cle({inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:E,drawDefinition:e,seedBlockInfo:P,participants:R,matchUpsMap:U,structure:I});if(x.error||(x.conflicts&&(N.qualifierConflicts=x.conflicts),f.push({action:"positionQualifiers",qualifierDrawPositions:x.qualifierDrawPositions}),x=Rle({provisionalPositioning:r,inContextDrawMatchUps:T,unseededByePositions:D,multipleStructures:n,tournamentRecord:o,drawDefinition:e,seedBlockInfo:P,participants:R,matchUpsMap:U,structureId:u,structure:I,drawSize:m,event:h}),x.error))return g(x);x.conflicts&&(N.unseededConflicts=x.conflicts),f.push({action:"positionUnseededParticipants"})}let{positionAssignments:A}=oi({drawDefinition:e,structure:I});return li({drawDefinition:e,structureIds:[u]}),i||CU(),{positionAssignments:A,conflicts:N,...X,positioningReport:f}}function Wg(t){var p;let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,placeByes:s,seedsOnly:l}=t;if(!n)return{error:Fa};if(!Cc({drawDefinition:n,structureId:o})&&!i)return{error:uN};let u=(p=Mq({drawDefinition:n,structureId:o}).playoffStructures)==null?void 0:p.sort((m,h)=>SS(m)-SS(h)),c=[],d=[];if(u)for(let m of u){let{structureId:h}=m,f=vb({structureId:h,provisionalPositioning:i,applyPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:s,seedsOnly:l});if(f.error)return f;f.positionAssignments&&c.push({positionAssignments:f.positionAssignments,structureId:h}),f.positioningReport&&d.push(f.positioningReport)}return{...X,structurePositionAssignments:c,positioningReports:d}}function kq({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>ot(i)))&&ee({result:{error:se},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>Pf(i.structureOrder)-Pf(r.structureOrder)),{...X}):{error:Le}}function GT({drawDefinition:t}){var g,v,y,I,b,S,w;let e=t.structures??[],i=t.links??[],r=new Map,n=U=>{let T=r.get(U)||r.set(U,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(U);if(T&&!(T!=null&&T.stage)){let D=e.find(P=>P.structureId===U);T.stage=D==null?void 0:D.stage}return T},a={},o={},s=i.map(U=>{let T=U.source.structureId,D=U.target.structureId,P=n(T),E=n(D);return[Od,_o,lT,Ad].includes(U.target.feedProfile)?(P==null||P.targets.push(D),E==null||E.sources.push(T)):U.target.feedProfile===xo&&(E==null||E.drawSources.push(T),P==null||P.drawTargets.push(D)),o[D]=o[D]||U.target.feedProfile===xo,a[D]=ct([...a[D]||[],T]).filter(Boolean),[U.source.structureId,U.target.structureId]});for(let U of r.keys()){let T=r.get(U);if(T){let D=T.targets??[];for(;D.length;){let P=D.pop(),E=P&&r[P];(g=E==null?void 0:E.targets)!=null&&g.length?D.push(...E.targets):E&&(T.rootStage=E.stage)}if(T.rootStage||(T.rootStage=T.stage),!((v=T.targets)!=null&&v.length)){let P=T.sources??[];for(;P.length;){let E=P.pop(),R=E&&r[E];if((y=R==null?void 0:R.sources)!=null&&y.length){for(let N of R.sources)(I=T.progeny)!=null&&I.includes(N)||((b=T.progeny)==null||b.push(N));P.push(...R.sources)}}}}}let l=0;for(let U of r.keys()){let T=r.get(U);if(T&&T.rootStage===Ke){let D=[(S=T.drawTargets)==null?void 0:S[0]],P=0;for(;D.length;){P+=1;let E=D.pop(),R=E?r.get(E):void 0;(w=R==null?void 0:R.drawTargets)!=null&&w.length&&D.push(R.drawTargets[0])}T.distanceFromMain=P,P>l&&(l=P)}}let u=s.length;Te(0,Math.ceil(u/2)).forEach(()=>{s=Te(0,u).map(U=>{let T=s[U],D=s.reduce((P,E)=>Rn(T,E)?P.concat(...E):P,[])||[];return ct(T.concat(...D))})});let c=s[0],d=(U,T)=>Vi(U,T).length===U.length,p=s.slice(1).reduce((U,T)=>U&&d(T,c),!0),m=[c].filter(Boolean),h=[c].filter(Boolean);e.forEach(U=>{let{structureId:T,stage:D}=U;m.find(P=>P.includes(T))||(m.push([T]),D!==Or&&h.push([T]))});let f=p&&h.length===1;return!(i!=null&&i.length)&&e.length===1&&n(e[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:f,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:o,structureGroups:m}}function xq({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=GT({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...X}}function cO(t){let e=ze(t,[{[wr]:!0,[Fn]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return Lle({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function Lle(t){var c;let e=ze(t,[{[Fn]:!0,[hT]:!0},{link:!0,[Jn]:ta,[bG]:hN}]);if(e.error)return e;let{drawDefinition:i,tournamentId:r,structure:n,eventId:a,link:o}=t,s=o.target.structureId,l=it({drawDefinition:i,structureId:s});if(l.error)return ee({stack:"attachQualifyingStructure",context:{targetStructureId:s},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(n),i.links.push(o),xq({drawDefinition:i});let u=((c=Wt({structure:n}))==null?void 0:c.matchUps)||[];return Pc({drawDefinition:i,tournamentId:r,matchUps:u,eventId:a}),li({drawDefinition:i,structureIds:[n.structureId]}),{...X}}function Fq({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:se};if(!t)return{error:Le};let i=Object.assign({},...e.map(r=>{if(!Nt(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Xe};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let o=i[a.structureId];o&&(a.structureName=o)}}return{...X}}function dO({drawDefinition:t,timeItem:e}){if(!t)return{error:Fa};if(!e)return{error:CN};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:EN};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),qy({drawDefinition:t}),{...X}}function Lq(t){var v;let{tournamentRecord:e,drawDefinition:i,structureId:r,event:n}=t,a=ze(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let o=i.structures??[],s=o.find(y=>y.structureId===r);if(!s)return{error:Ci};let l=o.find(({stage:y,stageSequence:I})=>y===Oe&&I===1),u=r===(l==null?void 0:l.structureId),c=o.filter(({stage:y})=>y===Ke).map(Da("structureId"));if(u&&!c.length)return{error:UG};let d=c.includes(r),p=_le({isQualifyingStructure:d,structure:s,...t});if(p!=null&&p.error)return p;let{structureIdsToRemove:m,relatedStructureIdsMap:h}=Ble({qualifyingStructureIds:c,isQualifyingStructure:d,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureId:r}),{removedMatchUpIds:f,removedStructureIds:g}=Vle({relatedStructureIdsMap:h,qualifyingStructureIds:c,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:m,structureId:r});if($le({removedMatchUpIds:f,drawDefinition:i}),u){let y=(v=l.matchUps??[])==null?void 0:v.map(Da("matchUpId"));f.push(...y),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&xq({drawDefinition:i}),Wu({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:f,action:"removeStructure",eventId:n==null?void 0:n.eventId,drawDefinition:i}),li({drawDefinition:i,eventId:n==null?void 0:n.eventId}),{...X,removedMatchUpIds:f,removedStructureIds:g}}function _le({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:o}){var l,u,c,d,p,m;let s=[r];if(t){let h=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},f=(l=h(r))==null?void 0:l.source.structureId;for(;f;)s.push(f),f=(u=h(f))==null?void 0:u.source.structureId}if((c=hr({matchUpFilters:{structureIds:s},drawDefinition:i}).matchUps)!=null&&c.some(({score:h})=>Ir({score:h}))){let h=(d=$t({tournamentRecord:e,drawDefinition:i,structure:n,event:a}))==null?void 0:d.appliedPolicies;if(!(o??((m=(p=h==null?void 0:h[Ns])==null?void 0:p.allowDeletionWithScoresPresent)==null?void 0:m.structures)))return{error:Z0}}return{...X}}function $le({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=hr({drawDefinition:e});i==null||i.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function Ble({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let o=(n.structures??[]).map(Da("structureId")),s=c=>{var d;return((d=n.links)==null?void 0:d.map(p=>p.source.structureId===c&&p.target.structureId!==(r==null?void 0:r.structureId)&&p.target.structureId).filter(Boolean))??[]},l=c=>{var d;return((d=n.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===c&&p.source.structureId).filter(Boolean))??[]},u=new Map;return o.forEach(c=>u.set(c,e?l(c):s(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function Vle({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;a!=null&&a.length;){let u=a.pop();l.push(...Hle({idBeingRemoved:u,drawDefinition:n}));let c=Gle({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:n,structureId:o});s.push(...c.removedStructureIds);let d=jle({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:u,structureId:o});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function jle({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){var n;return t&&((n=e.get(t))==null?void 0:n.filter(a=>a!==(i==null?void 0:i.structureId)||r===i.structureId))}function Gle({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){var o;let a=[];return r.links=((o=r.links)==null?void 0:o.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function Hle({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=it({structureId:t,drawDefinition:e}),r=Wt({structure:i}).matchUps;return pA(r)}function NS({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:Le};if(!FA({drawDefinition:e,stage:r}))return{error:up};let n=zoe({drawDefinition:e,stage:r}),{qualifiersCount:a}=Gg({drawDefinition:e,stageSequence:t,stage:r}),o=n+a;if(i<o)return{error:mN};let{entryProfile:s}=xA({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return li({drawDefinition:e}),{...X,entryProfile:s}}function _q({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?FA({drawDefinition:e,stage:i})?i!==Oe?{error:mN,info:"qualifiersCount can only be set for main stage"}:(xA({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),li({drawDefinition:e}),{...X}):{error:up}:{error:Le}}function zle({drawDefinition:t,drawSize:e}){if(!t)return{error:Le};let i=NS({stage:Or,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(li({drawDefinition:t}),{...X})}function $q(t){return zle(t)}var Wle="qualifierDrawPositionAssignment",qle="withdrawParticipantAtDrawPosition",Yle="alternateDrawPositionAssignment",Kle="luckyLoserDrawPositionAssignment",$B="removeDrawPositionAssignment",Bq="swapDrawPositionAssignments",Jle="modifyPairAssignment",Xle="adHocPositionSwap",Qle="modifyParticipantOtherName",BB="assignDrawPosition",Zle="removeSeededParticipant",eue="assignDrawPositionBye",tue="modifySeedAssignment",Vq="addPenalty",pO="MODIFY_PAIR",HT="QUALIFIER",mO="ALTERNATE",hO="WITHDRAW",Cm="ASSIGN",GC="REMOVE",fO="LUCKY",_U="REMOVE_SEED",zT="SWAP",AS="NICKNAME",eI="SEED_VALUE",zf="PENALTY",OS="BYE",iue={MODIFY_PAIR_ASSIGNMENT:pO,QUALIFYING_PARTICIPANT:HT,ALTERNATE_PARTICIPANT:mO,WITHDRAW_PARTICIPANT:hO,ASSIGN_PARTICIPANT:Cm,LUCKY_PARTICIPANT:fO,REMOVE_ASSIGNMENT:GC,SWAP_PARTICIPANTS:zT,ADD_NICKNAME:AS,REMOVE_SEED:_U,ADD_PENALTY:zf,ASSIGN_BYE:OS,SEED_VALUE:eI};function jq({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:Le};if(!r)return{error:Wa};if((i==null?void 0:i.length)!==2)return{error:se,drawPositions:i};let a=sn({drawDefinition:e}),{matchUps:o}=hr({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:s}=it({drawDefinition:e,structureId:r});if(!s)return{error:Ci};let l=$t({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},u;if(s.structureType===xn?u=aue({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}):u=rue({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}),u.error)return u;if(MA({structure:s,drawPositions:i}),PT({appliedPolicies:l,drawDefinition:e,positionAction:{name:Bq,drawPositions:i,structureId:r}}),Rc({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:n}),n.eventType===Ta){let c=Wt({matchUpFilters:{matchUpTypes:[xa]},inContext:!0,structure:s}).matchUps.filter(p=>{var m;return(m=p.drawPositions)==null?void 0:m.some(h=>i.includes(h))}),d=Wt({matchUpFilters:{matchUpTypes:[xa]},structure:s}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(m=>{var f;let h=m==null?void 0:m.drawPosition;if(i.includes(h)){let g=m.participantId,v=d.find(({matchUpId:I})=>I===p.matchUpId),y=(f=p==null?void 0:p.sides)==null?void 0:f.reduce((I,b,S)=>b.drawPosition===h?S:I,void 0);nO({inContextTargetMatchUp:p,drawPositionSideIndex:y,teamParticipantId:g,tournamentRecord:t,drawDefinition:e,matchUp:v,event:n})}})})}return li({drawDefinition:e,structureIds:[r]}),{...X}}function rue({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){let s=a==null?void 0:a.positionAssignments.filter(u=>r==null?void 0:r.includes(u.drawPosition));if(!s)return{error:se,structure:a,info:"Missing positionAssignments"};if(s.filter(({bye:u})=>u).length===2)return{...X};if(s.filter(({qualifier:u})=>u).length===2)return{...X};let l=s.some(({qualifier:u})=>u);return s.some(({bye:u})=>u)&&!l?Gq({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o}):nue({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o})}function Gq({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=r.find(({bye:h})=>h),l=r.find(({participantId:h})=>h),u=s.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,m=$I({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return m.error||(m=$I({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),m.error)||(Ka({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:o}),m=ol({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:n,event:o}),m.error)?m:{...X}}function nue({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=Object.assign({},...r.map((l,u)=>{let{drawPosition:c}=l,d={...r[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>s[l.drawPosition]||l),oO({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:o}),{...X}}function aue({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){var u;let s=(u=a.structures)==null?void 0:u.reduce((c,d)=>{let p=d==null?void 0:d.positionAssignments.filter(m=>r==null?void 0:r.includes(m.drawPosition));return p&&c.push(...p),c},[]);if(s.filter(({bye:c})=>c).length===2)return{...X};if(s.filter(({qualifier:c})=>c).length===2)return{...X};oO({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:s,structure:a,event:o});let l=s.some(({qualifier:c})=>c);if(s.some(({bye:c})=>c)&&!l)Gq({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o});else{let c=Ce(s,!1,!0);s.forEach((d,p)=>{let m=c[1-p].participantId;d.qualifier=c[1-p].qualifier,d.participantId=m})}return{...X}}function Hq({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){var o;let n="removeSeededParticipant";if(!t)return{error:ge};if(!e)return{error:Le};let a=(e.structures??[]).find(s=>s.structureId===r);return a?!a.stage||![Oe,Ke].includes(a.stage)||a.stage===Oe&&a.stageSequence!==1?ee({result:{error:sp},stack:n}):(o=a.seedAssignments)!=null&&o.find(s=>s.participantId===i)?{...X}:ee({info:"participant not seeded",result:{error:$r},context:{participantId:i}}):ee({result:{error:Ci},stack:n})}function Ib({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=Tu}){return!r||!n?{error:Wa}:{link:je({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:xo,roundNumber:t,structureId:n}})}}function gO({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:(r==null?void 0:r.pop())||Gt()}function kS({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:o,nodes:s}){let l=0,u=[],c=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let m=s==null?void 0:s[l],h=s==null?void 0:s[l+1];d&&(m.roundNumber=d),h&&d&&(h.roundNumber=d);let f=gO({roundPosition:c,roundNumber:i,idPrefix:n,uuids:o}),g={roundPosition:c,children:[m,h],matchUpId:f};u.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:Xi,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),r.push(v),c++,l+=2}return{roundNodes:u,matchUps:r}}function sl({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:u}){if(isNaN(s)||s<2||r&&s<=r)return{matchUps:[],roundsCount:0};if(r&&(!Rs(s)||s%r)){let g=r;for(;g<s;)g=2*g;s=g}let c=r&&!(s%2)&&(!isNaN(r)||i&&!isNaN(i))&&(s/r===Math.round(s/r)||i&&s/i===Math.round(s/i));if(!Rs(s)&&!c)return{matchUps:[],roundsCount:0};let d=Te(1,s+1).map(g=>({drawPosition:g})),p,m=[],h=1;for({roundNodes:p,matchUps:m}=kS({matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,nodes:d,uuids:u}),h++,a=a??i;p.length>1;)r&&p.length===r&&(a=h-1),{roundNodes:p,matchUps:m}=kS({nodes:p,matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,uuids:u}),h++;let f=h-1;return m=sb({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:f,roundLimit:a,matchUps:m}),a?m=m.filter(g=>a&&(g.roundNumber??0)<=a):a=h-1,{drawSize:s,matchUps:m,roundsCount:f,roundLimit:a}}function vO(t){var k,x,F,$,_,L;let e="generateQualifyingStructure";if(!t.drawDefinition)return ee({result:{error:Le},stack:e});if(t.drawSize&&!ot(t.drawSize)||t.participantsCount&&!ot(t.participantsCount)||t.qualifyingPositions&&!ot(t.qualifyingPositions))return ee({result:{error:se},stack:e});let i=t.drawSize??sN(t.participantsCount),{qualifyingRoundNumber:r,qualifyingPositions:n,targetStructureId:a,structureOptions:o,appliedPolicies:s,drawDefinition:l,matchUpFormat:u,structureName:c,structureId:d,roundTarget:p,drawType:m,idPrefix:h,isMock:f,uuids:g}=t;if(!t.drawSize)return ee({result:{error:Ny},context:{drawSize:i},stack:e});if(n&&n>=t.drawSize)return ee({result:{error:se},context:{drawSize:i,qualifyingPositions:n},stack:e});let v,y,I,b,S=0,w,U=1,{structureProfiles:T}=GT({drawDefinition:l}),D=T[a];if(!D)return ee({result:{error:Ci},context:{targetStructureId:a},stack:e});let P=l.matchUpType,E=p?`${p}-`:"",R=D.stage===Ke,N=((x=(k=s==null?void 0:s[_f])==null?void 0:k.namingConventions)==null?void 0:x.pre)??(($=(F=Koe[_f])==null?void 0:F.namingConventions)==null?void 0:$.pre),A=R&&N?`${N}-`:"",M=c??(E?`${A}${Zr(Ke)} ${E}`:`${A}${Zr(Ke)}`);if(m===es){let{maxRoundNumber:B,structures:V,groupCount:G}=hb({structureName:c??M,structureId:d??(g==null?void 0:g.pop()),stage:Ke,structureOptions:o,appliedPolicies:s,stageSequence:U,matchUpType:P,roundTarget:p,idPrefix:h,drawSize:i,isMock:f,uuids:g});S=G,v=B,I=V[0],w=[1]}else({drawSize:i,matchUps:b,roundLimit:v,roundsCount:y}=sl({qualifyingRoundNumber:r,qualifyingPositions:n,matchUpType:P,idPrefix:h,drawSize:i,isMock:f,uuids:g})),v||(v=y),I=so({structureName:c??M,structureId:d??(g==null?void 0:g.pop()),qualifyingRoundNumber:v,stage:Ke,matchUpFormat:u,stageSequence:U,matchUpType:P,roundLimit:v,matchUps:b}),p&&Lt({extension:{name:yl,value:p},element:I}),S=(_=b==null?void 0:b.filter(B=>B.roundNumber===v))==null?void 0:_.length;let C=m===es?Su:Tu,O=I&&v&&((L=Ib({sourceStructureId:I.structureId,sourceRoundNumber:v,targetStructureId:a,finishingPositions:w,linkType:C}))==null?void 0:L.link);return{qualifyingDrawPositionsCount:i,qualifiersCount:S,...X,structure:I,link:O}}function zq(t){if(!t.tournamentRecord)return{error:ge};let e=oue(t);return e.error,e}function oue(t){if(!t.drawDefinition)return{error:Le};if(!t.targetStructureId)return{error:Wa};let e=vO(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:se}:cO({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function Wq(t){var d;let e=ze(t,[{[Fn]:!0,[dT]:!0,[Il]:!0},{[Qae]:!0,[Kr]:p=>Number.isInteger(p)&&p>0},{[Kr]:p=>Array.isArray(p)&&p.length===2&&p.every(Di),[$a]:Ia,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=t,{structure:o}=it({drawDefinition:i,structureId:r});if(!o)return{error:Ci};if(!zn({structure:o}))return{error:sp};let s=p=>{var m;return(m=p.sides)==null?void 0:m.map(h=>h.participantId).some(h=>t.participantIds.includes(h))},l=p=>p.roundNumber===t.roundNumber,u=p=>!Ir(p),c=((o==null?void 0:o.matchUps)??[]).filter(l).filter(u).filter(s);if(c.length!==2)return{error:Ia};for(let p of c){let m=(d=p==null?void 0:p.sides)==null?void 0:d.find(h=>t.participantIds.includes(h==null?void 0:h.participantId));if(m){let h=t.participantIds.find(f=>f!==(m==null?void 0:m.participantId));m.participantId=h,Rt({tournamentId:n==null?void 0:n.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:p})}}return li({drawDefinition:i,structureIds:[r]}),{...X}}function sue({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:o,uuids:s,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Te(0,c).map(f=>d?d+f:void 0),m=[];for(let f=0;f<c;f++){let g=p.shift(),v={drawPosition:g,fed:u+1,feed:!0},y=l[f];y.roundNumber=i-1;let I=gO({roundPosition:y.roundPosition,roundNumber:i,idPrefix:n,uuids:s}),b={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Xi,roundNumber:i,matchUpId:I};t&&(b.matchUpType=r),o&&(b.isMock=!0),a.push(b);let S={children:[y,v]};m.push(S)}let h=e?e-c:void 0;return{roundNodes:m,matchUps:a,drawPosition:h}}function Mc(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:m,uuids:h,fmlc:f}=t;a=a??A(e);let g=lue({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((M,C)=>M+C,0);else if(e){let M=e-a;i=g.filter(C=>C<=M?(M-=C,!0):!1),y=i.reduce((C,O)=>C+O,0),r=i.length}else n>=v?r=0:u&&(r=v-u,n=0),i=g.filter((M,C)=>u&&!r||r&&C>=n+r||C<n?0:M),y=i.reduce((M,C)=>M+C,0),r=i.length;let I=[...g,...i].sort((M,C)=>C-M),b=I.length,S=[...(l??[]).map(M=>M-1),...(o??[]).map(M=>b-M)].map(M=>I[M]).reduce((M,C)=>M+C,0);y=y-S;let w=0,U=[],T,D=1,P=Te(0,a).map((M,C)=>({drawPosition:C+1+y})),E=y+1;for(let M of g){if({roundNodes:T,matchUps:U}=kS({matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:m,nodes:P,uuids:h}),D++,i.includes(M)){let C=Ua(i)[M],O=Te(0,C),k=b+1-D,x=(o==null?void 0:o.includes(k))??(l==null?void 0:l.includes(D));O.forEach(()=>{({roundNodes:T,matchUps:U,drawPosition:E}=sue({drawPosition:!x&&E||void 0,nodes:T,matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:m,uuids:h,fed:w})),D++,w+=1})}P=T}b!==D-1&&console.log("ERROR");let R=a-y;U=sb({finishingPositionOffset:c?R:s,positionsFed:y,roundsCount:b,matchUps:U,fmlc:f});let N=T!=null&&T.length?T[0]:T;return N&&(N.roundNumber=D-1,N.matchUps=U),{draw:N,matchUps:U,roundsCount:b};function A(M){let C=lN(M);return C>M?C/2:C}}function lue({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Te(0,e).reverse().map(i=>Math.pow(2,i))}function wf(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:m,sequenceLimit:h,stage:f=Oe,drawSize:g,idPrefix:v,isMock:y,uuids:I}=t;if(!(!o||!u||o!=null&&o[l])||g<2||h&&s>h)return{};let b=[],S=[],w=[],U=t.matchUpType??(p==null?void 0:p.matchUpType),T=e+1,D=e+g,P=`${T}-${D}`,E=o==null?void 0:o[l],R=r&&`${r} `||"",N=(o==null?void 0:o[P])??(n==null?void 0:n[P]),A=t.structureName||(N==null?void 0:N.name)||(E==null?void 0:E.name)&&(i?`${R}${E==null?void 0:E.name}`:E.name)||`${R}${P}`,M=(N==null?void 0:N.abbreviation)??(E==null?void 0:E.abbreviation),C=t.structureId??(E==null?void 0:E.structureId)??(I==null?void 0:I.pop()),O={idPrefix:v&&`${v}-${A}-RP`,finishingPositionOffset:e,matchUpType:U,drawSize:g,isMock:y,uuids:I},{matchUps:k}=m?Mc(O):sl(O),x=so({structureAbbreviation:M,stageSequence:s,structureName:A,matchUpType:U,roundOffset:d,structureId:C,matchUps:k,stage:f});b.push(...k),S.push(x);let F=Math.ceil(Math.log(g)/Math.log(2)),$=c?Math.min(c-d,F):(!a||T<a)&&F||0;return g>2&&Te(1,$+1).forEach(L=>_(L)),{structureId:x.structureId,matchUps:b,structureName:A,structures:S,links:w,...X};function _(L){let B=g/Math.pow(2,L);if(B<2)return;let V=g/Math.pow(2,L)+e;if(a&&V+1>a)return;let{structures:G,structureId:j,matchUps:z,links:W}=wf({finishingPositionOffset:V,exitProfile:`${l}-${L}`,roundOffset:d+L,stageSequence:s+1,drawSize:B,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:h,matchUpType:U,idPrefix:v,uuids:I,stage:f});if(x.structureId&&j){let q={linkType:Gl,source:{roundNumber:L,structureId:x.structureId},target:{roundNumber:1,feedProfile:_o,structureId:j}};W&&x&&W.push(q),W!=null&&W.length&&w.push(...W)}return G!=null&&G.length&&S.push(...G),z!=null&&z.length&&b.push(...z),{structureId:j,childLinks:W,structures:S}}}function IO({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=it({drawDefinition:t,structureId:i});if(r.error)return ee({result:r});let{matchUps:n}=Wt({structure:r.structure,matchUpsMap:e});return{...En({matchUps:n}),matchUps:n,matchUpsMap:e}}function VB({finishingPositions:t,drawDefinition:e,structureId:i}){var n;let{roundProfile:r}=IO({drawDefinition:e,structureId:i});return(n=r&&Object.keys(r))==null?void 0:n.reduce((a,o)=>(qq(r==null?void 0:r[o]).forEach(s=>{t.forEach(l=>{uue({position:l,rangeDefinition:s})&&(a[l]={roundNumber:o})})}),a),{})}function uue({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return Te(i,(r||i)+1).includes(t)}function qq(t){var e,i;return[ct(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),ct(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function cue(t){return qq(t).map(e=>Te(e[0],e[1]&&e[1]+1||e[0]+1))}function qg({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:se,context:{structureIds:e}};if(!t)return{error:Le};e=e??(t.structures??[]).filter(a=>a.stage!==Ke).map(({structureId:a})=>a);let r=e.map(a=>{var s;let{roundProfile:o}=IO({drawDefinition:t,matchUpsMap:i,structureId:a});return(s=o&&Object.values(o))==null?void 0:s.map(cue).flat()}).flat(),n=r.filter(a=>(a==null?void 0:a.length)===1).sort(sr).flat();return{positionsNotPlayedOff:ct(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function Yq({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:Le};if(!r)return{error:Wa};if(!e)return{error:Xe,info:"missing playoffPositions"};let n=qg({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,o=e.filter(v=>!a.includes(v)),s=VB({finishingPositions:o,drawDefinition:i,structureId:r}),l=Object.values(s).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>et(v)).filter(v=>!t.includes(v)),u=VB({finishingPositions:a,drawDefinition:i,structureId:r}),c=u?Object.values(u):[],d=u?c.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>et(v)):[],p=l.filter(v=>!d.includes(v)).sort(sr),{roundProfile:m}=IO({drawDefinition:i,structureId:r}),h=p.map(v=>{let y=m==null?void 0:m[v].finishingPositionRange.loser,[I,b]=y??[0,0];return Te(I,(b||I)+1)}).flat().sort(sr),{playoffRoundsRanges:f}=due({playoffSourceRounds:p,roundProfile:m}),g=[...p,...d];return{playoffPositionsReturned:h,playedOffSourceRounds:d,playoffRoundsRanges:f,playoffSourceRounds:p,sourceRounds:g,roundProfile:m}}function due({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,o=Te(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:o,roundNumber:i}})}}function yb({drawDefinition:t,structureId:e}){if(!t)return{error:Le};let{matchUps:i,matchUpsMap:r}=Sn({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=qg({drawDefinition:t,matchUpsMap:r}),{structures:o}=is({drawDefinition:t}),s=o.filter(u=>!e&&u.stage!==Or||u.structureId===e),l={};for(let u of s){let c=u==null?void 0:u.structureId,d=pue({playoffPositions:n,drawDefinition:t,structure:u,matchUps:i}),{error:p,...m}=d;if(p)return d;l[c]={structureId:c,...m}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function pue({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){var m,h,f,g,v,y,I,b,S;let n=i==null?void 0:i.structureId,{links:a}=Vg({drawDefinition:e,structureId:n});if(i.structureType===xn||i.structures){let w=(h=(m=oi({structure:i}))==null?void 0:m.positionAssignments)==null?void 0:h.length,U=i.structures.length,T=(w??0)/U,D=((f=a.source)==null?void 0:f.flatMap(({source:x})=>(x==null?void 0:x.finishingPositions)||[]))||[],P=Te(1,T+1).filter(x=>!D.includes(x)),E=((v=(g=r.find(x=>x.containerStructureId===n&&x.finishingPositionRange))==null?void 0:g.finishingPositionRange)==null?void 0:v.winner)||[0,1],R=a==null?void 0:a.source.map(({target:x})=>x.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:A=[]}=qg({structureIds:R,drawDefinition:e}),M=[...N,...A],C=Te(E[0],E[1]+1).filter(x=>!M.includes(x)),O=Rr(C,C.length/P.length),k=P.map((x,F)=>{let $=O[F],_=[Math.min(...$||[]),Math.max(...$||[])].join("-");return{finishingPosition:x,finishingPositions:$,finishingPositionRange:_}});return{positionsNotPlayedOff:C,playoffFinishingPositionRanges:k,finishingPositionsAvailable:P,finishingPositionsPlayedOff:D,positionsPlayedOff:N,groupCount:U,groupSize:T}}let o=((y=a==null?void 0:a.source)==null?void 0:y.filter(w=>w.linkCondition!==nl).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],s=((I=a==null?void 0:a.source)==null?void 0:I.filter(w=>w.linkCondition===nl).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],l=Yq({excludeRoundNumbers:o,playoffPositions:t,drawDefinition:e,structureId:n}),u=l!=null&&l.playoffSourceRounds?[...(l==null?void 0:l.playoffSourceRounds)||[]]:void 0,c=[...(l==null?void 0:l.playoffRoundsRanges)||[]],{roundProfile:d,error:p}=l;for(let w of s){let U=a==null?void 0:a.source.find(R=>R.source.roundNumber===w),T=U==null?void 0:U.target.roundNumber,D=U==null?void 0:U.target.structureId,P=r.filter(({roundNumber:R,structureId:N})=>N===D&&R===T),E=P.filter(({sides:R})=>R.find(N=>N.participantFed&&!N.participantId)).length;if(u&&E===P.length){u.push(w);let R=(S=(b=d==null?void 0:d[w])==null?void 0:b.finishingPositionRange)==null?void 0:S.loser;if(R){let N=Math.min(...R),A=N+E,M=Te(N,A),C={finishingPositionRange:[N,A-1].join("-"),finishingPositions:M,roundNumber:w};c.push(C)}}}return u&&u.sort(sr),c.sort((w,U)=>w.roundNumber-U.roundNumber),{playoffRounds:u,playoffRoundsRanges:c,error:p}}function mue({playoffGroups:t,drawDefinition:e,structureId:i}){var n,a;if(!e)return{error:Le};if(!Di(i)||!Array.isArray(t))return{error:se};let r=t.map(({finishingPositions:o})=>o).flat();return{positionRangeMap:(a=(n=yb({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:n.filter(o=>r.includes(o.finishingPosition)))==null?void 0:a.reduce((o,s)=>(o[s.finishingPosition]=s,o),{})}}function Kq(t){var y,I;let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:o=Oe,matchUpType:s,structureId:l,idPrefix:u,drawSize:c,isMock:d,uuids:p}=t,m={finishingPositionOffset:e,matchUpType:s,drawSize:c,idPrefix:u,isMock:d,uuids:p},{matchUps:h}=n?Mc(m):sl(m),f=so({structureName:a||((y=i==null?void 0:i["0"])==null?void 0:y.name)||Zr(Oe),structureId:l||(p==null?void 0:p.pop()),stageSequence:r,matchUpType:s,matchUps:h,stage:o}),g=[f],v=[];if(c>2){let b=c/2,{matchUps:S}=sl({finishingPositionOffset:e+b,idPrefix:u&&`${u}-c`,drawSize:b,matchUpType:s,isMock:d}),w=Zr(rn),U=((I=i==null?void 0:i["0-1"])==null?void 0:I.name)??t.consolationStructureName??(a?`${a} ${w}`:w),T=so({structureName:U,matchUps:S,structureId:p==null?void 0:p.pop(),stage:rn,stageSequence:1,matchUpType:s});g.push(T);let D={linkType:Gl,source:{roundNumber:1,structureId:f.structureId},target:{roundNumber:1,feedProfile:_o,structureId:T.structureId}};v.push(D)}return{...X,structures:g,links:v}}function Jq({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let o=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),s=(n==null?void 0:n.roundGroupedOrder)||[],l=n==null?void 0:n.roundFeedProfiles;return Te(1+e,r+1+e).map(u=>{let c=l!=null&&l[u-1]?l[u-1]:u%2&&_o||Od,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:Gl,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},m=s[u-1];return m&&(p.target.groupedOrder=m),La()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=nl,p.target.feedProfile=_o),o.includes(d)?p:void 0}).filter(Boolean)}function Xq(t){var S,w;let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:o,stage:s=Oe,matchUpType:l,structureId:u,drawSize:c,idPrefix:d,isMock:p,uuids:m}=t,h={finishingPositionOffset:i,matchUpType:l,drawSize:c,idPrefix:d,isMock:p,uuids:m},{matchUps:f,roundsCount:g}=o?Mc(h):sl(h),v=t.structureName??((S=n==null?void 0:n["0"])==null?void 0:S.name)??Zr(Oe),y=Ic({structureId:u||(m==null?void 0:m.pop()),structureName:v,stageSequence:r,matchUpType:l,matchUps:f,stage:s}),I=[y],b=[];if(c>2){let U=[0,2].slice(0,c/16).map((T,D)=>{let P=D+1,{consolationStructure:E}=hue({idPrefix:d&&`${d}-c${D}`,structureId:m==null?void 0:m.pop(),playoffStructureNameBase:e,playoffAttributes:n,structureNameMap:a,stageSequence:P,roundOffset:T,matchUpType:l,drawSize:c,isMock:p,index:D,uuids:m});I.push(E);let R=Jq({consolationStructure:E,roundsCount:2,mainStructure:y,roundOffset:T});return{consolationStructure:E,links:R}}).map(T=>T.links).flat();if(b.push(...U),c>=4&&c<=16||c>32){let{matchUps:T}=sl({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),D=((w=n==null?void 0:n["3-4"])==null?void 0:w.name)??Zr($i),P=(a==null?void 0:a[D])||D,E=e?`${e} ${P}`:P,R=Ic({structureId:m==null?void 0:m.pop(),matchUps:T,stageSequence:2,stage:$i,structureName:E,matchUpType:l}),N={linkType:Gl,source:{roundNumber:g-1,structureId:y.structureId},target:{structureId:R.structureId,feedProfile:_o,roundNumber:1}};I.push(R),b.push(N)}}return{structures:I,links:b,...X}}function hue({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:u,index:c,uuids:d}){var y,I;let p=l/(2*Math.pow(2,n)),{matchUps:m,roundsCount:h}=Mc({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:u,uuids:d}),f=c===0&&((y=i==null?void 0:i["0-1"])==null?void 0:y.name)||c===1&&((I=i==null?void 0:i["0-3"])==null?void 0:I.name)||`${Zr(rn)} ${c+1}`,g=(r==null?void 0:r[f])||f,v=t?`${t} ${g}`:g;return{consolationStructure:Ic({matchUps:m,stage:rn,structureName:v,stageSequence:e,matchUpType:a,structureId:o}),consolationRoundsCount:h}}function jp(t){var P,E,R,N;let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:o,stage:s=Oe,structureId:l,matchUpType:u,skipRounds:c,feedRounds:d,idPrefix:p,drawSize:m,isMock:h,uuids:f,fmlc:g}=t,v=t.feedPolicy||((P=t.policyDefinitions)==null?void 0:P[$f])||((E=t.appliedPolicies)==null?void 0:E[$f]),y={finishingPositionOffset:e,matchUpType:u,skipRounds:c,drawSize:m,idPrefix:p,isMock:h,uuids:f},{matchUps:I}=a?Mc(y):sl(y),b=so({structureName:o||((R=r==null?void 0:r["0"])==null?void 0:R.name)||Zr(Oe),structureId:l||(f==null?void 0:f.pop()),stageSequence:i,matchUpType:u,matchUps:I,stage:s}),S=[b],w=[],U=m/2,{matchUps:T,roundsCount:D}=Mc({finishingPositionOffset:U,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:U,matchUpType:u,feedRounds:d,skipRounds:c,isMock:h,uuids:f,fmlc:g});if(m>2){let A=((N=r==null?void 0:r["0-1"])==null?void 0:N.name)??Zr(rn),M=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${A}`:A,C=so({matchUps:T,structureId:f==null?void 0:f.pop(),stage:rn,stageSequence:1,structureName:M,matchUpType:u});S.push(C);let O=Jq({consolationStructure:C,mainStructure:b,roundsCount:D,feedPolicy:v,fmlc:g});w.push(...O)}return{...X,structures:S,links:w}}function Qq({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:m}){var S,w,U,T,D,P;u=u||(n==null?void 0:n[$f]);let h="processPlayoffGroups",f=0,g=[],v=[],y=[],{error:I,positionRangeMap:b}=mue({structureId:r,drawDefinition:o,playoffGroups:s});if(I)return ee({result:{error:I},stack:h});if(!(!b||s!=null&&s.every(E=>{let{finishingPositions:R=[]}=E;if(!R.length)return!1;let N=[...R].sort(sr).map((A,M)=>(R[M+1]||A)-A).every(A=>A<2);return(!t||N)&&R.every(A=>b[A])})))return ee({context:{validFinishingPositions:Object.values(b)},result:{error:se},stack:h});for(let E of s){let R=E.finishingPositions,N=b&&R.map($=>{var _;return(_=b[$])==null?void 0:_.finishingPositions}).flat(),A=c*R.length,M=Pg(A),C=M===2&&Ys||E.drawType||Ys;N&&(f=Math.min(...N)-1);let O=N&&`${Math.min(...N)}-${Math.max(...N)}`,k=E.structureName||O&&((w=(S=E.playoffAttributes)==null?void 0:S[O])==null?void 0:w.name)||((T=(U=E.playoffAttributes)==null?void 0:U["0"])==null?void 0:T.name),x={addNameBaseToAttributeName:E.addNameBaseToAttributeName,playoffStructureNameBase:E.playoffStructureNameBase,finishingPositionNaming:E.finishingPositionNaming,finishingPositionLimit:E.finishingPositionLimit,structureId:E.structureId??(m==null?void 0:m.pop()),playoffAttributes:E.playoffAttributes,structureNameMap:E.structureNameMap,sequenceLimit:E.sequenceLimit,structureName:k,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:f,stage:$i,stageSequence:a,matchUpType:l,drawSize:M,isMock:p,uuids:m},F=({playoffStructures:$,playoffLinks:_})=>{let[L]=$,B=pU({playoffStructureId:L.structureId,finishingPositions:R,sourceStructureId:r});y.push(B),y.push(..._),v.push(...$),g.push({structureId:L.structureId,finishingPositions:R}),f+=A};if(C===Ys){let{matchUps:$}=sl({finishingPositionLimit:f+A,idPrefix:d&&`${d}-po`,finishingPositionOffset:f,matchUpType:l,drawSize:M,isMock:p,uuids:m}),_=so({structureId:E.structureId??(m==null?void 0:m.pop()),matchUpFormat:e,stage:$i,structureName:k,stageSequence:a,matchUps:$});v.push(_);let L=pU({playoffStructureId:_.structureId,finishingPositions:R,sourceStructureId:r});y.push(L),f+=A,g.push({structureId:_.structureId,finishingPositions:R})}else if([kf,xf,$i].includes(C)){let $={playoffAttributes:E.playoffAttributes??i,playoffStructureNameBase:E.playoffStructureNameBase,structureId:E.structureId??(m==null?void 0:m.pop()),structureName:E.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:f,stage:$i,roundOffset:0,stageSequence:a,drawSize:M,isMock:p,uuids:m};C===kf?Object.assign($,{playoffAttributes:(E==null?void 0:E.playoffAttributes)??i??JN,roundOffsetLimit:3}):C===xf&&Object.assign($,{playoffAttributes:(E==null?void 0:E.playoffAttributes)??i??XN,roundOffsetLimit:2});let _=wf($);if(_.error)return _;if((D=_.links)!=null&&D.length&&y.push(..._.links),(P=_.structures)!=null&&P.length&&v.push(..._.structures),v.sort(ih),_.structureId){let L=pU({playoffStructureId:_.structureId,finishingPositions:R,sourceStructureId:r});y.push(L),g.push({structureId:_.structureId,finishingPositions:R})}f+=A}else if([Ff,Vy,NI,MI,CI,AI].includes(C)){let $=[m==null?void 0:m.pop(),m==null?void 0:m.pop()],_={playoffStructureNameBase:E.playoffStructureNameBase,structureId:E.structureId??(m==null?void 0:m.pop()),playoffAttributes:E.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:f,uuids:$,stage:$i,structureName:k,matchUpType:l,feedPolicy:u,drawSize:M,isMock:p},L={[Ff]:{fmlc:!0,feedRounds:1},[AI]:{feedRounds:1},[NI]:{feedsFromFinal:3},[MI]:{feedsFromFinal:2},[CI]:{feedsFromFinal:1}};Object.assign(_,L[C]||{});let{structures:B,links:V}=jp(_),[G]=B,j=pU({playoffStructureId:G.structureId,finishingPositions:R,sourceStructureId:r});y.push(j),y.push(...V),v.push(...B),g.push({structureId:G.structureId,finishingPositions:R}),f+=A}else if([es].includes(C)){let{structures:$,links:_}=hb({...x,structureOptions:E.structureOptions||{groupSize:4}});F({playoffStructures:$,playoffLinks:_})}else if([By].includes(C)){let{structures:$,links:_}=Kq(x);F({playoffStructures:$,playoffLinks:_})}else if([Wae].includes(C)){let{structures:$,links:_}=Xq(x);F({playoffStructures:$,playoffLinks:_})}else if([_a].includes(C)){let $=so({structureId:E.structureId??(m==null?void 0:m.pop()),structureName:E.structureName,finishingPosition:AU,stage:$i,stageSequence:a,matchUps:[]});F({playoffStructures:[$],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:b,structures:v,links:y}}function pU({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:Su,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:xo,roundNumber:1}}}function bb({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>wb({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function wb({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:u}=e||{},c=i??o??0,d=p=>{if(!n&&!(r!=null&&r.isMock))return(a==null?void 0:a.pop())??Gt();let m=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${r==null?void 0:r.matchUpId}-${m}-TMU-${p+1}`};return Te(0,c).map(p=>{let m=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Xi,collectionPosition:m,collectionId:l,processCodes:u,matchUpType:s,isMock:n}})}function fue(t){var T,D,P;let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return ee({result:{error:Xe},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:o,groupCount:s,groupSize:l,event:u}=t,c=Qq({requireSequential:r,sourceStructureId:i,playoffGroups:o,groupCount:s,groupSize:l,...t});if(c.error)return ee({result:c,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:m,positionRangeMap:h}=c,f=m==null?void 0:m.map(({finishingPositions:E})=>E).flat().map(E=>h[E].finishingPositions).flat();a.structures.push(...d),a.links.push(...p);let{matchUps:g,matchUpsMap:v}=hr({inContext:!0,drawDefinition:a}),y=d.map(({structureId:E})=>E),I=g==null?void 0:g.filter(({structureId:E})=>y.includes(E)).map(Dr),b=(T=v==null?void 0:v.drawMatchUps)==null?void 0:T.filter(({matchUpId:E})=>I==null?void 0:I.includes(E));if(b!=null&&b.length){let E=(D=vn({drawDefinition:a,event:u}))==null?void 0:D.tieFormat;E&&b.forEach(R=>{let{tieMatchUps:N}=bb({isMock:t.isMock,tieFormat:E,matchUp:R});Object.assign(R,{tieMatchUps:N,matchUpType:xa})})}let{positionAssignments:S}=oi({structureId:i,drawDefinition:a}),w={};S==null||S.forEach(E=>{var N,A,M;let R=(M=(A=(N=vt({element:E,name:Tc}))==null?void 0:N.extension)==null?void 0:A.value)==null?void 0:M.groupOrder;R&&(w[R]||(w[R]=[]),w[R].push(E.participantId))});let U=Wg({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:n,drawDefinition:a});return U.error&&((P=U.error)==null?void 0:P.code)!==uN.code?ee({result:U,stack:e}):{structures:d,links:p,positionsPlayedOff:f,drawDefinition:a,...X}}function cf({value:t,sourceRange:e,targetRange:i}){let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),o=Math.max(...i);return(t-r)*(o-a)/(n-r)+a}var Fo="ELO",Zq="NTRP",gue="TRN",e3="UTR",yO="WTN",vue={ELO:Fo,NTRP:Zq,TRN:gue,UTR:e3,WTN:yO},Iue={[Fo]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[Zq]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[e3]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[yO]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Nr=Iue;function yue({sourceRatingType:t,sourceRating:e}){let i=Nr[t].range,r=i[0]>i[1],n=Nr[Fo].range;return cf({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function bue({targetRatingType:t,sourceRating:e}){let i=Nr[t].decimalsCount||0,r=Nr[t].range,n=r[0]>r[1],a=Math.max(...r),o=Nr[Fo].range,s=cf({targetRange:r,sourceRange:o,value:e}),l=parseFloat(s.toFixed(i));return n?a-l:l}function jB(t){var d;let e=ze(t,[{ratings:!0,[Jn]:ta}]);if(e.error)return e;let i=t.matchUpType&&[ii,Zt].includes(t.matchUpType)?t.matchUpType:ii,r=Object.keys(Nr),n=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:Fo,a=t.ratings[i]?t.ratings[i].reduce((p,m)=>p.includes(m.scaleName)?p:p.concat(m.scaleName),[]):[];if(!a)return{error:$r};let o=((d=t.ratings[i])==null?void 0:d.find(p=>p.scaleName===n))??t.ratings[i][0];if(a[0]===n)return o;let s=o.scaleName,l=Nr[o.scaleName].accessor,u=l?o.scaleValue[l]:o.scaleValue,c=yue({sourceRatingType:s,sourceRating:u});return{convertedRating:bue({targetRatingType:n,sourceRating:c}),sourceRating:u}}function wue({participantResults:t,sides:e,score:i}){var s,l;let r=e.find(({sideNumber:u})=>u===1),n=e.find(({sideNumber:u})=>u===2),a=(s=r==null?void 0:r.participant)==null?void 0:s.ratings,o=(l=n==null?void 0:n.participant)==null?void 0:l.ratings;if(a!=null&&a[ii]&&(o!=null&&o[ii])){let u=Fo,{convertedRating:c}=jB({ratings:a,targetRatingType:u}),{convertedRating:d}=jB({ratings:o,targetRatingType:u}),{side1pressure:p,side2pressure:m}=Uue({side1ConvertedRating:c,side2ConvertedRating:d,score:i});p&&t[r==null?void 0:r.participantId].pressureScores.push(p),m&&t[n==null?void 0:n.participantId].pressureScores.push(m);let h=Math.max(...Nr[Fo].range),f=dS((d-c)/h),g=dS((c-d)/h);t[r==null?void 0:r.participantId].ratingVariation.push(f),t[n==null?void 0:n.participantId].ratingVariation.push(g)}}function Uue({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){var y,I;let r=t>e?t:e,n=t>e?e:t,a=Math.abs(t-e),o=Nr[Fo].range,s=Math.max(...o),l=(s-r)*0,u=(r+l)/s*a,c=(y=i==null?void 0:i.sets)==null?void 0:y.reduce((b,S)=>b+((S==null?void 0:S.side1Score)??0),0),d=(I=i==null?void 0:i.sets)==null?void 0:I.reduce((b,S)=>b+(S.side2Score??0),0),p=t>e?2:1,m=(c||0)*(n+(p===1?u:0)),h=(d||0)*(n+(p===2?u:0)),f=m+h,g=f?dS(m/f):0,v=f?dS(h/f):0;return{side1pressure:g,side2pressure:v}}function bO({winningSide:t,matchUpFormat:e=fu,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],o=n==null?void 0:n.sets,s=typeof t=="number"&&t-1,l=kn(e),u=wO((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===Mt&&(r!=null&&r.setsCreditForDefaults)||i===zt&&(r!=null&&r.setsCreditForWalkovers)))a[s]=u;else for(let c of o||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof s=="number"&&i===hn&&(+a[1-s]===u&&(a[1-s]-=1),r!=null&&r.setsCreditForRetirements&&(a[s]=u)),a}function t3({matchUpFormat:t=fu,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){var p,m;let{sets:a}=n||{};if(!a)return[0,0];let o=typeof e=="number"&&e-1,s=kn(t),l=(s==null?void 0:s.bestOf)??1,u=wO(l),c=((p=s==null?void 0:s.setFormat)==null?void 0:p.tiebreakAt)||0,d=[[],[]];if(typeof o=="number"&&(i===Mt&&(r!=null&&r.gamesCreditForDefaults)||i===zt&&(r!=null&&r.gamesCreditForWalkovers))){let h=((m=s==null?void 0:s.setFormat)==null?void 0:m.setTo)||0,f=u*h;d[o].push(f)}else a.forEach((h,f)=>{var S;let g=(h.setNumber||f+1)>u&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",v=(S=s==null?void 0:s[g])==null?void 0:S.based,y=s==null?void 0:s[g].tiebreakSet,{side1Score:I,side2Score:b}=h;GB(v)&&(d[0].push(et(I||0)),d[1].push(et(b||0))),y&&h.winningSide&&(r==null?void 0:r.gamesCreditForTiebreakSets)!==!1&&d[h.winningSide-1].push(1)});if(i===hn&&typeof o=="number"){let h=a.length>u&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",f=s==null?void 0:s[h];if(GB(f.based)){let g=(f==null?void 0:f.setTo)||0,v=I=>{if(!(!s||I===""))return+I===c-1||+I===c?et(c||0)+1:+I<c?g:c},y=bO({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(d.map(I=>I[o]<=I[1-o]).reduce((I,b)=>I+(b?1:0),0)>y[1-o]){let I=d[o].length,b=v(d[1-o][I-1]);b&&(d[o][I-1]=b)}u>d[o].length&&(r!=null&&r.gamesCreditForRetirements)&&d[o].push(g)}}return[d[0].reduce((h,f)=>h+f,0),d[1].reduce((h,f)=>h+f,0)]}function i3({matchUpFormat:t,score:e}){var s;let i=t?kn(t):void 0,r=(i==null?void 0:i.bestOf)??1,n=wO(r),a=[0,0],o=[0,0];return(s=e==null?void 0:e.sets)==null||s.forEach((l,u)=>{var p;let c=(l.setNumber||u+1)>n&&(i!=null&&i.finalSetFormat)?"finalSetFormat":"setFormat",d=(p=i==null?void 0:i[c])==null?void 0:p.based;if(r3(d)){let{side1Score:m,side2Score:h}=l;m&&(o[0]+=et(m||0)),h&&(o[1]+=et(h||0))}else l.side1TiebreakScore&&(o[0]+=et(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(o[1]+=et(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(a[l.winningSide-1]+=1)}),{pointsTally:o,tiebreaksTally:a}}function wO(t){return t&&Math.ceil(t/2)||1}function r3(t){return t==="P"}function GB(t){return!r3(t)}function Sue({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:r,totalSets:n}){var u;let a=e&&kn(e)||{},o=a.bestOf,s=o&&Math.ceil(o/2)||1,l=(u=a.setFormat)==null?void 0:u.setTo;Object.keys(t).forEach(c=>{let d=t[c].setsWon,p=t[c].setsLost,m=i!=null&&i.groupTotalSetsPlayed?n:r*(s||0)||d+p,h=Math.round(d/m*1e3)/1e3;(h===1/0||isNaN(h))&&(h=m);let f=t[c].tieMatchUpsWon,g=t[c].tieMatchUpsLost,v=f+g,y=Math.round(f/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=f);let I=t[c].matchUpsWon,b=t[c].matchUpsLost,S=I+b,w=Math.round(I/S*1e3)/1e3;(w===1/0||isNaN(w))&&(w=I);let U=t[c].gamesWon||0,T=t[c].gamesLost||0,D=(r||0)*(s||0)*(l||0),P=Math.max(D,U+T),E=Math.round(U/P*1e3)/1e3;(E===1/0||isNaN(E))&&(E=0);let R=t[c].pointsWon+t[c].pointsLost,N=Math.round(t[c].pointsWon/R*1e3)/1e3;(N===1/0||isNaN(N))&&(N=0),t[c].setsWon=d,t[c].setsLost=p,t[c].setsPct=h,t[c].tieMatchUpsWon=f,t[c].tieMatchUpsPct=y,t[c].matchUpsPct=w,t[c].gamesWon=U,t[c].gamesLost=T,t[c].gamesPct=E,t[c].pointsPct=N,t[c].result=`${t[c].matchUpsWon}/${t[c].matchUpsLost}`})}function Ub({participantIds:t,pressureRating:e,matchUpFormat:i,tallyPolicy:r,perPlayer:n,matchUps:a}){var c,d,p,m,h,f,g;let o={},s=(r==null?void 0:r.excludeMatchUpStatuses)||[],l=a==null?void 0:a.filter(v=>(v.tieMatchUps||!s.includes(v.matchUpStatus))&&(!(t!=null&&t.length)||Vi(t,[df(v,0),df(v,1)]).length===2)),u=(c=l==null?void 0:l.flatMap(({score:v,tieMatchUps:y})=>{var I;return y?y.filter(({matchUpStatus:b})=>!s.includes(b)).flatMap(({score:b})=>{var S;return((S=b==null?void 0:b.sets)==null?void 0:S.length)??0}):((I=v==null?void 0:v.sets)==null?void 0:I.length)??0}))==null?void 0:c.reduce((v,y)=>v+y,0);for(let v of l??[]){let{matchUpStatus:y,tieMatchUps:I,tieFormat:b,score:S,winningSide:w,sides:U}=v,T=b&&v._disableAutoCalc&&b.collectionDefinitions.every(({scoreValue:N})=>N),D=w&&Tue(v),P=w&&Due(v);if(!D&&!P)if(y&&vr.includes(y)){let N=df(v,0),A=df(v,1);N&&(uc(o,N),o[N].matchUpsCancelled+=1),A&&(uc(o,A),o[A].matchUpsCancelled+=1)}else if(I!=null&&I.length){n=0;for(let N of I){if(N.winningSide){let A=(d=U==null?void 0:U.find(({sideNumber:C})=>C===N.winningSide))==null?void 0:d.participantId,M=(p=U==null?void 0:U.find(({sideNumber:C})=>C===N.winningSide))==null?void 0:p.participantId;A&&M&&(uc(o,A),uc(o,M),o[A].tieMatchUpsWon+=1,o[M].tieMatchUpsLost+=1,Yi(ii)(N.matchUpType)?(o[A].tieSinglesWon+=1,o[M].tieSinglesLost+=1):Yi(Zt)(N.matchUpType)&&(o[A].tieDoublesWon+=1,o[M].tieDoublesLost+=1))}HB({score:N.score,manualGamesOverride:T,participantResults:o,sides:U})}}else HB({manualGamesOverride:T,participantResults:o,score:S,sides:U});else if(uc(o,D),uc(o,P),I==null?void 0:I.length){n=0;for(let N of I){let{matchUpType:A}=N,M=Yi(Zt)(A),C=Yi(ii)(A);N.winningSide&&(N.winningSide===w?(D&&(o[D].tieMatchUpsWon+=1,C&&(o[D].tieSinglesWon+=1),M&&(o[D].tieDoublesWon+=1)),P&&(o[P].tieMatchUpsLost+=1,C&&(o[P].tieSinglesLost+=1),M&&(o[P].tieDoublesLost+=1))):N.winningSide!==w&&(P&&(o[P].tieMatchUpsWon+=1,C&&(o[P].tieSinglesWon+=1),M&&(o[P].tieDoublesWon+=1)),D&&(o[D].tieMatchUpsLost+=1,C&&(o[D].tieSinglesLost+=1),M&&(o[D].tieDoublesLost+=1)))),zB({matchUpFormat:N.matchUpFormat,matchUpStatus:N.matchUpStatus,matchUpType:N.matchUpType,score:N.score,sides:N.sides,winningParticipantId:D,losingParticipantId:P,manualGamesOverride:T,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:r,winningSide:w})}n3({winningParticipantId:D,losingParticipantId:P,participantResults:o,matchUpStatus:y})}else zB({matchUpFormat:v.matchUpFormat??i,matchUpType:v.matchUpType,isTieMatchUp:void 0,winningParticipantId:D,manualGamesOverride:T,losingParticipantId:P,participantResults:o,pressureRating:e,matchUpStatus:y,tallyPolicy:r,winningSide:w,score:S,sides:U});let E=(m=S==null?void 0:S.sets)==null?void 0:m.reduce((N,A)=>N+((A==null?void 0:A.side1Score)??0),0),R=(h=S==null?void 0:S.sets)==null?void 0:h.reduce((N,A)=>N+(A.side2Score??0),0);if(T){let N=(f=U==null?void 0:U.find(({sideNumber:M})=>M===1))==null?void 0:f.participantId,A=(g=U==null?void 0:U.find(({sideNumber:M})=>M===2))==null?void 0:g.participantId;uc(o,N),uc(o,A),N&&(o[N].gamesWon+=E,o[N].gamesLost+=R),A&&(o[A].gamesWon+=R,o[A].gamesLost+=E)}}return Sue({participantResults:o,matchUpFormat:i,tallyPolicy:r,perPlayer:n,totalSets:u}),{participantResults:o}}function Tue(t){let e=t.winningSide-1;return df(t,e)}function Due(t){let e=1-(t.winningSide-1);return df(t,e)}function df(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function uc(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function HB({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],o=[0,0];for(let l of n||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(o[u-1]+=1),a[0].push(et(c||0)),a[1].push(et(d||0))}let s=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];r.forEach((l,u)=>{let{participantId:c}=l;c&&(uc(e,c),e[c].setsWon+=o[u],e[c].setsLost+=o[1-u],t||(e[c].gamesWon+=s[u],e[c].gamesLost+=s[1-u]))})}function zB({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:o,isTieMatchUp:s,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let m=c&&c-1,h=1-m;n&&l===ii&&wue({participantResults:r,sides:p,score:d}),s||n3({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:o});let f=bO({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=t3({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:v}=i3({score:d,matchUpFormat:a});t&&(r[t].setsWon+=f[m],r[t].setsLost+=f[h],e||(r[t].gamesWon+=g[m],r[t].gamesLost+=g[h]),r[t].pointsWon+=v[m],r[t].pointsLost+=v[h]),i&&(r[i].setsWon+=f[h],r[i].setsLost+=f[m],e||(r[i].gamesWon+=g[h],r[i].gamesLost+=g[m]),r[i].pointsWon+=v[h],r[i].pointsLost+=v[m])}function n3({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===zt&&(i[e].walkovers+=1),r===Mt&&(i[e].defaults+=1),r===hn&&(i[e].retirements+=1),[Mt,hn,zt].includes(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function Pue({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(o=>{o.participantId&&o.participant&&(r[o.participantId]=o.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,o)=>{var s,l;if((s=a.excludedDirectives)!=null&&s.length){let u=a.excludedDirectives.map(({attribute:p})=>p).join(", "),c=`${u.length} directives were excluded due to participants limit}`;n.push(c);let d=`Excluded: ${u}`;n.push(d)}else{let u=(f,g)=>parseFloat(a.reversed?f:g)-parseFloat(a.reversed?g:f),c=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=f=>{f.groups&&Object.keys(f.groups).sort(u).forEach(g=>{let v=f.groups[g].map(I=>r[I]).join(", "),y=`${g} ${f.attribute}: ${v}`;n.push(y)})},p=a.reversed?" in reverse order":"",m=a.groups?"grouped":"separated",h=`Step ${o+1}: ${c} particiants were ${m}${p} by ${a.attribute}`;if(n.push(h),a.idsFilter){let f=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;n.push(f)}d(a)}n.push("----------------------")}),n.push("Final Order:"),e.forEach(a=>{let{participantId:o,resolved:s}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[o]} => resolved: ${!!s}`)}),n.join(`\r
`)}function a3({participantResults:t,participantIds:e,attribute:i}){return o3({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:o}=n,s=o==null?void 0:o[i];return!isNaN(s)&&a&&(r[s]?r[s].push(a):r[s]=[a]),r},{})}function o3(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var Rue=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],fE={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function WB(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!Eue(t))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n==null?void 0:n.groupOrderKey)?n.groupOrderKey:"matchUpsWon",s=a3({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l=Object.keys(s).map(g=>parseFloat(g)).sort((g,v)=>v-g).map(g=>s[g]).map(g=>{let v=s3({participantIds:g,...t});return a.push(...v.report??[]),v.order}).map((g,v)=>g.map(y=>y.resolved?y:{...y,subGroup:[v].concat(...y.subGroup??[])})).flat(),u,c=0,d=1,p;l.forEach((g,v)=>{var I;v&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let y=parseInt(((I=g.subGroup)==null?void 0:I.join(""))||0);g.resolved?(g.position=v+1,d=g.position):(u&&y>u&&(d+=c,c=0),g.position=d,c+=1),u=y});let m=l.map(({position:g})=>g),h=Ua(m);return l.forEach(g=>{let{participantId:v,position:y}=g||{},I=i[v];g.GEMscore=f(I);let b=h[y];(g==null?void 0:g.position)!==void 0&&(b>1&&(g.ties=b,r&&(g.subOrder=r[v])),g.rankOrder=y,g.groupOrder=y+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function f(g){return(Array.isArray(n==null?void 0:n.GEMscore)?Object.keys(fE).filter(v=>n.GEMscore.includes(v)):Object.keys(fE)).map(v=>(g[v]||0)*Math.pow(10,fE[v].toFixed(3))).reduce((v,y)=>v+y,0)}}function Eue({participantResults:t,participantsCount:e}){let i=o3({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function Cue({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:r,attribute:n,idsFilter:a,matchUps:o,reversed:s}){let{participantResults:l}=Ub({participantIds:a&&e,matchUpFormat:i,tallyPolicy:r,matchUps:o}),u=a3({participantResults:l,participantIds:e,attribute:n}),c=[{attribute:n,reversed:s,groups:u,idsFilter:a}],d;return Object.keys(u).length>1&&e.length&&(d=Object.keys(u).map(p=>parseFloat(p)).sort((p,m)=>s?p-m:m-p).map(p=>u[p]).map(p=>{let m=s3({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:r,matchUps:o});return c.push(...m.report??[]),m.order}).map((p,m)=>p.map(h=>h.resolved?h:{...h,subGroup:[m].concat(...h.subGroup??[])})).flat()),{order:d,report:c}}function s3({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let o=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(n!=null&&n.headToHead)||!n.headToHead.disabled&&!e)){let c=Mue({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:c,headToHeadWinner:d,report:s}}}let u=((n==null?void 0:n.tallyDirectives)||Rue).filter(c=>{let d=!(_i(c.maxParticipants)&&(i==null?void 0:i.length)>c.maxParticipants);return d||o.push(c),d});return o.length&&s.push({excludedDirectives:o,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,disableHeadToHead:m})=>(l=Cue({disableHeadToHead:m,participantIds:i,matchUpFormat:r,tallyPolicy:n,attribute:c,idsFilter:p,matchUps:a,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(c=>({participantId:c})),report:s}}function Mue({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function Yg({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:o}){if(!(n!=null&&n.length)||!So(n))return{error:Gu};let s=ct(n.map(({structureId:b})=>b));if(s.length!==1)return ee({result:{error:se,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:s}});let l=n.filter(b=>b&&b.matchUpStatus!==Vt),u=l.length&&ct(l.map(({drawPositions:b})=>b).flat()).length,c=l.filter(b=>Rd({matchUp:b})).length===l.length;c||(o=0);let d=n.every(({matchUpType:b,tieMatchUps:S})=>b===fi&&(S==null?void 0:S.every(w=>Rd({matchUp:w})))),p=t==null?void 0:t[sA],m=n.filter(b=>Rd({matchUp:b})||b.matchUpType===fi),{participantResults:h}=Ub({matchUps:m,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:o}),f,g,{groupOrder:v,report:y}=WB({matchUps:m,participantResults:h,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a});if(i&&Nue({participantResults:h}),c&&v)f=y,g=v,v.forEach(b=>{let{participantId:S,groupOrder:w,rankOrder:U,subOrder:T,ties:D,GEMscore:P}=b,E=h[S];Object.assign(E,{groupOrder:w,rankOrder:U,GEMscore:P,subOrder:T,ties:D})});else{let{groupOrder:b,report:S}=WB({requireCompletion:!1,participantResults:h,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});f=S,g=b,b&&b.forEach(w=>{let{participantId:U,groupOrder:T,GEMscore:D}=w,P=h[U];Object.assign(P,{provisionalOrder:T,GEMscore:D})})}let I={completedTieMatchUps:d,readableReport:"",participantResults:h,bracketComplete:c,order:[],report:f};if((c||d)&&(I.order=g),e||La({tally:!0})){let b=Pue({matchUps:n,report:f,order:g});La({tally:!0})&&console.log(b),I.readableReport=b}return I}function Nue({participantResults:t}){let e=n=>n.reduce((a,o)=>a+parseFloat(o),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:o}=a,s=o!=null&&o.length?i(o):0;return{participantId:n,averagePressure:s}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function l3({positionAssignments:t}){let e=(t||[]).filter(Da(zl)).map(n=>{let{extension:a}=vt({element:n,name:Bf}),o=et(a==null?void 0:a.value),s=!isNaN(o)&&o;return s&&{participantId:n.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=Ua(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function UO({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!So(n))return{error:se};if(!t)return{error:se};let{policyDefinitions:o}=qu({policyTypes:[sA],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:s}=l3({positionAssignments:t}),l=n.length?Yg({policyDefinitions:o,matchUpFormat:r,subOrderMap:s,matchUps:n}):void 0;if(l!=null&&l.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(m=>{let{participantId:h}=m;if(p.includes(h)){let f={value:u[h],name:Tc};Lt({element:m,extension:f}),u[h].ties||Un({element:m,name:Bf})}else Un({element:m,name:Tc}),Un({element:m,name:Bf})}),li({drawDefinition:i}),{...X,participantResults:u,bracketComplete:c,report:d}}function u3({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function Ui(t){let e=ze(t,[{[Fn]:!0,[Il]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:o,matchUpId:s,inContext:l,context:u,event:c}=t,{structures:d=[]}=is({drawDefinition:a}),p=t.contextContent||n&&Yu({contextProfile:n,drawDefinition:a});for(let m of d){let{matchUps:h}=Wt({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:o,inContext:l,structure:m,context:u,event:c}),{matchUp:f}=u3({matchUps:h,matchUpId:s});if(f)return{matchUp:f,structure:m}}return{error:pn}}function WT(t){var e;return!Nt(t)||!t.notes?{error:Xe}:Nt(t.element)?!Di(t.notes)&&!((e=t.notes)!=null&&e.testing)?{error:se}:(Object.assign(t.element,{notes:t.notes}),{...X}):{error:se}}function SO(t){return Nt(t)?Nt(t.element)?(t.element.notes&&delete t.element.notes,{...X}):{error:se}:{error:Xe}}var qT={matchUpStatus:Xi,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Js(t){var U,T,D,P,E,R,N,A;let e="modifyMatchUpScore",i=t.matchUpFormat,r=t.matchUp,n,{matchUpStatusCodes:a,tournamentRecord:o,drawDefinition:s,matchUpStatus:l,removeScore:u,winningSide:c,matchUpId:d,event:p,notes:m,score:h}=t,f=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(U=$t({policyTypes:[Ns],tournamentRecord:o,drawDefinition:s,structure:n,event:p}))==null?void 0:U.appliedPolicies,g=r.matchUpType===fi;if(g&&s){if(d&&r.matchUpId!==d){let M=Ui({drawDefinition:s,matchUpId:d,event:p});if(!M.matchUp)return{error:pn};({matchUp:r,structure:n}=M)}}else r.matchUpId!==d&&console.log("!!!!!");l&&[zt,tr].includes(l)||u?Object.assign(r,{...qT}):h&&(r.score=h);let v=l&&(r==null?void 0:r.matchUpStatus)===Mt&&l!==Mt;l&&(r.matchUpStatus=l),i&&(r.matchUpFormat=i),a&&(r.matchUpStatusCodes=a),c&&(r.winningSide=c),t.removeWinningSide&&(r.winningSide=void 0),!n&&s&&({structure:n}=Ui({drawDefinition:s,matchUpId:d,event:p})),l&&!r.winningSide&&Ir(r)&&!vr.includes(l)&&![th,qc,mo].includes(l)&&(r.matchUpStatus=cs);let y;if((v&&((T=r==null?void 0:r.processCodes)!=null&&T.length)||l===Mt)&&(y=(P=(D=f==null?void 0:f[Ns])==null?void 0:D.processCodes)==null?void 0:P.incompleteAssignmentsOnDefault),!r.collectionId){let M=(n==null?void 0:n.structureType)===xn,C=zn({structure:n});if(LA({drawDefinition:s,structure:n})||C||M){let O=F=>{i=g?"SET1-S:T100":i??r.matchUpFormat??(F==null?void 0:F.matchUpFormat)??(s==null?void 0:s.matchUpFormat)??(p==null?void 0:p.matchUpFormat);let $=g?{matchUpTypes:[fi]}:void 0,{matchUps:_}=Wt({afterRecoveryTimes:!1,tournamentRecord:o,inContext:!0,matchUpFilters:$,drawDefinition:s,structure:F,event:p});return C&&(F.positionAssignments=ct(_.flatMap(L=>(L.sides??[]).map(B=>B.participantId)).filter(Boolean)).map(L=>({participantId:L}))),UO({positionAssignments:F.positionAssignments,tournamentRecord:o,drawDefinition:s,matchUpFormat:i,matchUps:_,event:p})},k=M&&n.structures.find(F=>F==null?void 0:F.matchUps.find($=>$.matchUpId===d)),x=O(k||n);if(x.error)return ee({result:x,stack:e})}}if(m){let M=WT({element:r,notes:m});if(M.error)return ee({result:M,stack:e})}let I=o==null?void 0:o.tournamentId,b=yo().topics.includes(TT),S=(b||y)&&sn({drawDefinition:s}),w=S&&((E=hr({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:o,inContext:!0,drawDefinition:s,matchUpsMap:S}).matchUps)==null?void 0:E[0]);if(b&&w&&Noe({tournamentId:I,inContextMatchUp:w}),Array.isArray(y)&&w&&!((R=w.sides)!=null&&R.every(({participantId:M})=>M)))if(l===Mt)r.processCodes=ct([...r.processCodes??[],...y]);else for(let M of y||[]){let C=M&&((N=r==null?void 0:r.processCodes)==null?void 0:N.lastIndexOf(M));(A=r==null?void 0:r.processCodes)==null||A.splice(C,1)}return Rt({eventId:p==null?void 0:p.eventId,context:e,drawDefinition:s,tournamentId:I,matchUp:r}),{...X}}function TO(t){var h,f,g,v;let{matchUpStatusCodes:e,matchUpStatus:i,structure:r,matchUp:n,dualMatchUp:a,inContextMatchUp:o,autoCalcDisabled:s}=t,l=lb({matchUpStatus:i})||[zu,Ba].includes(i)&&a||s,u=((h=n==null?void 0:n.sides)==null?void 0:h.map(y=>y.participantId).filter(Boolean).length)||((f=o==null?void 0:o.sides)==null?void 0:f.map(y=>y.participantId).filter(Boolean).length),c="attemptToModifyScore";if(!(zn({structure:r})&&u===1||i===Mt&&u||Aue({structure:r,matchUp:n,inContextMatchUp:o})||((v=(g=t.appliedPolicies)==null?void 0:g[Ns])==null?void 0:v.requireParticipantsForScoring)===!1))return ee({result:{error:gN},stack:c});let d=[zt].includes(i),p=l?i:t.winningSide&&qi||mo,m=Js({...t,matchUpStatusCodes:l&&e||[],matchUpStatus:p,context:c,removeScore:d});return ee({result:m,stack:c})}function Aue({structure:t,matchUp:e,inContextMatchUp:i}){var s;let{drawPositions:r}=e,{positionAssignments:n}=Er({structure:t}),a=n==null?void 0:n.filter(l=>(r==null?void 0:r.includes(l.drawPosition))&&l.participantId),o=(s=i==null?void 0:i.sides)==null?void 0:s.every(l=>l.participantId);return(a==null?void 0:a.length)===2||o}function c3({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>ot(r==null?void 0:r.groupValue)&&(r==null?void 0:r.groupNumber)).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>et(r));return{groupValueGroups:e,groupValueNumbers:i}}function Oue({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(y=>y.collectionId===t.collectionId),o=[0,0],s=[0,0],l=a.every(y=>vr.includes(y.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:m,scoreValue:h,setValue:f}=t,g=c&&e.includes(c),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),ot(p)?a.forEach(y=>{y.winningSide&&(o[y.winningSide-1]+=p)}):ot(f)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(S=>{S.winningSide&&(o[S.winningSide-1]+=f)})}):ot(h)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(S=>{let{side1TiebreakScore:w=0,side2TiebreakScore:U=0,side1Score:T=0,side2Score:D=0}=S;(y.matchUpStatus===qi||y.winningSide||S.winningSide)&&(T||D?(o[0]+=T,o[1]+=D):(w||U)&&S.winningSide&&(o[S.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(y=>{if(y.winningSide){let I=y.collectionPosition,b=kue({collectionDefinition:t,collectionPosition:I});ot(b)&&(o[y.winningSide-1]+=b)}}),ot(d)){let y;if(m!=null&&m.aggregateValue)l&&(ot(p||f||h)&&o[0]!==o[1]?y=o[0]>o[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(m!=null&&m.valueGoal)y=o.reduce((I,b,S)=>b>=m.valueGoal?S+1:I,0);else{let I=Math.floor(t.matchUpCount/2)+1;y=v.reduce((b,S,w)=>S>=I?w+1:b,0)}y&&(g?i[c].values[y-1]+=d:s[y-1]+=d)}else g?(i[c].values[0]+=o[0]||0,i[c].values[1]+=o[1]||0):s=o;g?(i[c].sideWins[0]+=v[0]||0,i[c].sideWins[1]+=v[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):s.forEach((y,I)=>r[I]+=y||0)}function kue({collectionDefinition:t,collectionPosition:e}){var i,r;return(r=(i=t.collectionValueProfiles||[])==null?void 0:i.find(n=>n.collectionPosition===e))==null?void 0:r.matchUpValue}function Sb(t){var b,S,w,U,T;let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:o,event:s}=t;if(!Array.isArray(e)||e.length!==2||isNaN(e.reduce((D,P)=>D+P)))return{error:se};if(!o)return{error:aa};let l=((b=vn({matchUp:o,drawDefinition:r,structure:a,event:s}))==null?void 0:b.tieFormat)||(t==null?void 0:t.tieFormat);if(!l)return{error:Mg};let u=Hn({tieFormat:l});if(u.error)return u;let c=(l==null?void 0:l.collectionDefinitions)||[],d=(o==null?void 0:o.tieMatchUps)??[],p=[0,0],{groupValueGroups:m,groupValueNumbers:h}=c3(l);for(let D of c)Oue({collectionDefinition:D,groupValueNumbers:h,groupValueGroups:m,sideTieValues:p,tieMatchUps:d});for(let D of h){let P=m[D],{allGroupMatchUpsCompleted:E,matchUpCount:R,winCriteria:N,groupValue:A,sideWins:M,values:C}=P,O;if(N!=null&&N.aggregateValue)E&&C[0]!==C[1]&&(O=C[0]>C[1]?1:2);else if(N!=null&&N.valueGoal)O=C.reduce((k,x,F)=>x>=N.valueGoal?F+1:k,void 0);else{let k=Math.floor(R/2)+1;O=M.reduce((x,F,$)=>F>=k?$+1:x,void 0)}O&&(p[O-1]+=A||0)}let f=p.map((D,P)=>(D||0)+e[P]),g={side1Score:f[0],side2Score:f[1],winningSide:void 0},v=f.join(i),y=f.slice().reverse().join(i),I;if(l!=null&&l.winCriteria){let{valueGoal:D,aggregateValue:P,tallyDirectives:E}=l.winCriteria;if(D?I=(S=f.map((R,N)=>({sideNumber:N+1,points:R})).find(({points:R})=>R>=D))==null?void 0:S.sideNumber:P&&d.every(R=>R.matchUpStatus&&vr.includes(R.matchUpStatus)||R.winningSide)&&f[0]!==f[1]&&(I=f[0]>f[1]?1:2),!I&&E){let R=o.matchUpId,N=o.hasContext?o:((w=n==null?void 0:n.drawMatchUps)==null?void 0:w[R])||r&&((U=Ui({inContext:!0,drawDefinition:r,matchUpId:R}))==null?void 0:U.matchUp);if(N){let{completedTieMatchUps:A,order:M}=Yg({matchUps:[N]});if(A&&(M!=null&&M.length)){let C=M[0].participantId;I=(T=N.sides.find(({participantId:O})=>O===C))==null?void 0:T.sideNumber}}}}return I&&(g.winningSide=I),{scoreStringSide1:v,scoreStringSide2:y,winningSide:I,set:g}}function Tb({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){var a,o;if(r){t||(t=(a=Ui({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:s}=vt({element:e,name:Du}),l=Ce((s==null?void 0:s.value)||{},!1,!0),u=({displaySideNumber:c,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:c});r.sides=(o=t==null?void 0:t.sides)==null?void 0:o.map(c=>{var g;let d=c.participantId,p=d&&l[d]||void 0,{lineUp:m,...h}=((g=r.sides)==null?void 0:g.find(({sideNumber:v})=>v===c.sideNumber))??{},f=m!=null&&m.length?m:p;return{...u(c),...h,lineUp:f}}),Rt({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function qr(t){if(t)return Ce(t,!1,!0)}function DO(t){let e=ze(t,[{[mn]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:s})=>s),o=n.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...o),i.eventIds.push(...a),i.drawIds.push(...o),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function d3({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=DO({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&(r==null?void 0:r[n].includes(e))||i&&(r==null?void 0:r[n].includes(i)))}function Ku(t){var R,N,A,M;let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:o,event:s}=t,l=t.tournamentRecords||t.tournamentRecord&&{[(R=t.tournamentRecord)==null?void 0:R.tournamentId]:t.tournamentRecord}||{},u=t.tournamentId||((N=t.tournamentRecord)==null?void 0:N.tournamentId);l&&d3({tournamentRecords:l,...t});let c=u&&l[u];if(!c)return{error:ge};let d=Ui({drawDefinition:i,event:s,matchUpId:o});if(d.error)return d;if(!d.matchUp)return{error:pn};let{matchUp:p,structure:m}=d;if(!p.tieMatchUps)return{error:oa};Tb({tournamentId:c==null?void 0:c.tournamentId,eventId:s==null?void 0:s.eventId,dualMatchUp:p,drawDefinition:i});let{extension:h}=vt({name:Pm,element:p});if(h!=null&&h.value)if(n)Un({element:p,name:Pm});else return{...X,score:p.score};let f=(A=vn({drawDefinition:i,structure:m,matchUp:p,event:s}))==null?void 0:A.tieFormat;p.tieFormat=qr(f);let g=Sb({drawDefinition:i,matchUpsMap:a,structure:m,matchUp:p,event:s}),{winningSide:v,set:y,scoreStringSide1:I,scoreStringSide2:b}=g,S=(y==null?void 0:y.side1Score)||(y==null?void 0:y.side2Score);if(e&&!p.score&&!S)return{...X};let w={scoreStringSide1:I,scoreStringSide2:b,sets:y?[y]:[]},U=v&&[1,2].includes(v),T=U&&qi||GA({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:w})&&cs||Xi,D=!!(p.winningSide&&!U),P=p.tieMatchUps.find(({score:C,winningSide:O,matchUpStatus:k})=>{var x;return((x=C==null?void 0:C.sets)==null?void 0:x.length)&&(C.sets[0].side1Score||C.sets[0].side2Score)||k&&vr.includes(k)||O}),E;if(p.tieFormat&&!U&&!P){let C=(M=vn({drawDefinition:i,structure:m,event:s}))==null?void 0:M.tieFormat;C&&JSON.stringify(f)===JSON.stringify(C)&&(p.tieFormatId=void 0,p.tieFormat=void 0,E=!0)}return Js({appliedPolicies:t.appliedPolicies,matchUpStatus:T,score:w,removeWinningSide:D,tournamentRecord:c,drawDefinition:i,removeScore:n,winningSide:v,matchUpId:o,matchUp:p,event:s}),{...X,score:w,removeWinningSide:D,tieFormatRemoved:E,winningSide:v}}function xue({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){var h,f,g,v,y;let m="directWinner";if(o){let I=u.drawPositions||[],b=I[t],S=o.source.structureId,w=it({structureId:S,drawDefinition:l});if(w.error)return w;let{structure:U}=w,{positionAssignments:T}=Er({structureId:S,drawDefinition:l}),D=(h=T==null?void 0:T.find(M=>M.drawPosition===n))==null?void 0:h.participantId,P=o.target.structureId,{positionAssignments:E}=Er({structureId:P,drawDefinition:l}),R=(f=E==null?void 0:E.find(M=>M.participantId===D))==null?void 0:f.drawPosition,N=E==null?void 0:E.filter(M=>{let C=I.includes(M.drawPosition),O=!M.participantId&&!M.bye&&!M.qualifier;return C&&O}).map(M=>M.drawPosition),A=N==null?void 0:N.includes(b);if(D&&o.target.roundNumber===1&&A)ol({drawPosition:b,participantId:D,structureId:P,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(D&&(N!=null&&N.length)){let M=N.pop();M&&ol({participantId:D,structureId:P,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:M,matchUpsMap:d,event:p})}else if(R){let M=Hf({drawPosition:R,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(M.error)return ee({result:M,stack:m})}else if((U==null?void 0:U.stage)!==Ke){let M="winner target position unavaiallble";return console.log(M),{error:M}}if(U!=null&&U.seedAssignments&&U.structureId!==P){let M=U.seedAssignments.find(({participantId:O})=>O===D),C=M==null?void 0:M.participantId;M&&C&&zg({eventId:u==null?void 0:u.eventId,structureId:P,...M,tournamentRecord:a,drawDefinition:l,participantId:C})}}else{let I=Hf({matchUpId:u.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(I.error)return I}if(c&&i){let I=(g=c.sides)==null?void 0:g.find(b=>b.sideNumber===i);if(I!=null&&I.lineUp){let b=c.roundPosition,S=u.roundPosition,w=b===S&&b!==1||Math.floor(b/2)===S?2:1,U=(v=d==null?void 0:d.drawMatchUps)==null?void 0:v.find(({matchUpId:P})=>P===u.matchUpId),T=[1,2].map(P=>{var E;return{...((E=U.sides)==null?void 0:E.find(R=>R.sideNumber===P))||{},sideNumber:P}});U.sides=T;let D=U.sides.find(P=>P.sideNumber===w);if(D){let P=(y=I.lineUp)==null?void 0:y.filter(E=>E==null?void 0:E.participantId);D.lineUp=aO({lineUp:P}),Rt({tournamentId:a==null?void 0:a.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:U,context:m,drawDefinition:l})}}}return{...X}}function Fue(t){var F,$,_;let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:r,sourceMatchUpStatus:n,loserDrawPosition:a,tournamentRecord:o,loserTargetLink:s,drawDefinition:l,loserMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}=t,m="directLoser",h=s.linkCondition,f=u.drawPositions||[],g=h===nl&&u.roundNumber===2&&Math.min(...f.filter(Boolean)),v=g||f[e],y=g||f[1-e],I=s.source.structureId,{structure:b}=it({structureId:I,drawDefinition:l}),{matchUps:S}=Wt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:b,event:p}),w=S.filter(L=>{var B;return(B=L.drawPositions)==null?void 0:B.includes(a)}).filter(L=>{let B=L.sides.find(G=>G.drawPosition===a),V=L.matchUpStatus===zt||L.matchUpStatus===Mt&&!Ir(L);return(B==null?void 0:B.sideNumber)===L.winningSide&&!V}),U=h===nl&&w.length===0,{positionAssignments:T}=Er({structureId:I,drawDefinition:l}),D=(F=T==null?void 0:T.find(L=>L.drawPosition===a))==null?void 0:F.participantId,P=s.target.structureId,{positionAssignments:E}=Er({structureId:P,drawDefinition:l}),R=E==null?void 0:E.filter(({drawPosition:L})=>f.includes(L));if(R!=null&&R.some(L=>L.participantId===D))return{...X};let N=R==null?void 0:R.filter(L=>{let B=f.includes(L.drawPosition),V=!L.participantId&&!L.bye&&!L.qualifier;return B&&V}).map(L=>L.drawPosition),A=N==null?void 0:N.includes(v),M=s.target.roundNumber>1&&(N==null?void 0:N.length),C=s.target.roundNumber===1&&A;if(g){let L=O();if(L.error)return ee({result:L,stack:m})}else if(C){let L=x();if(L.error)return ee({result:L,stack:m})}else if(D&&M){N.sort(sr);let L=N[0],B=ol({participantId:D,structureId:P,drawPosition:L,inContextDrawMatchUps:i,sourceMatchUpStatus:n,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p});if(B.error)return ee({result:B,stack:m})}else return ee({context:{loserDrawPosition:a,loserTargetLink:s,targetDrawPositionIsUnfilled:A},result:{error:A?Rg:Cne},stack:m});if(b!=null&&b.seedAssignments&&b.structureId!==P){let L=b.seedAssignments.find(({participantId:V})=>V===D),B=L==null?void 0:L.participantId;L&&B&&zg({eventId:u==null?void 0:u.eventId,structureId:P,...L,tournamentRecord:o,drawDefinition:l,participantId:B})}if(c&&r){let L=($=c.sides)==null?void 0:$.find(B=>B.sideNumber===3-r);if(L!=null&&L.lineUp){let{roundNumber:B,eventId:V}=u,{roundPosition:G}=c,j=B===1?2-G%2:1,z=(_=d==null?void 0:d.drawMatchUps)==null?void 0:_.find(({matchUpId:Y})=>Y===u.matchUpId),W=[1,2].map(Y=>{var re;return{...((re=z.sides)==null?void 0:re.find(J=>J.sideNumber===Y))||{},sideNumber:Y}});z.sides=W;let q=z.sides.find(Y=>Y.sideNumber===j);q&&(q.lineUp=aO({lineUp:L.lineUp}),Rt({tournamentId:o==null?void 0:o.tournamentId,matchUp:z,context:m,drawDefinition:l,eventId:V}))}}return{...X};function O(){let L="loserLinkFedFMLC";return ee(U?{result:x(),stack:L}:{result:k(),stack:L})}function k(){let L=Ka({drawPosition:y,structureId:P,tournamentRecord:o,drawDefinition:l,event:p});return ee({result:L,stack:"assignLoserPositionBye"})}function x(){let L=D?ol({drawPosition:v,participantId:D,structureId:P,inContextDrawMatchUps:i,sourceMatchUpStatus:n,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p}):{error:mr};return ee({result:L,stack:"assignLoserDrawPosition"})}}function p3(t){var w;let e="directParticipants",i=TO(t);if(i.error)return ee({result:i,stack:e});let r=lb({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,projectedWinningSide:a,inContextDrawMatchUps:o,tournamentRecord:s,drawDefinition:l,matchUpStatus:u,dualMatchUp:c,matchUpsMap:d,winningSide:p,targetData:m,matchUpId:h,structure:f,matchUp:g,event:v}=t,y=!!g.collectionId,I=zn({structure:f}),b=g.drawPositions,S;if(y){let{matchUpTieId:U,matchUpsMap:T}=t,D=Ku({appliedPolicies:t.appliedPolicies,matchUpId:U,tournamentRecord:s,drawDefinition:l,matchUpsMap:T,event:v});if(S=D&&{tieMatchUpResult:D},b=(w=o.find(({matchUpId:P})=>P===U))==null?void 0:w.drawPositions,!n)return ee({result:{...X,...S},stack:e})}if(I)return ee({result:{...X,...S},stack:e});if(b){let U=a?a-1:p-1,T=1-U,D=b[U],P=b[T],{targetLinks:{loserTargetLink:E,winnerTargetLink:R,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:A,loserMatchUpDrawPositionIndex:M,winnerMatchUp:C,loserMatchUp:O,byeMatchUp:k}}=m;if(C){let x=xue({sourceMatchUpStatus:r&&u||qi,winnerMatchUpDrawPositionIndex:A,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:a,winningDrawPosition:D,tournamentRecord:s,winnerTargetLink:R,drawDefinition:l,winnerMatchUp:C,dualMatchUp:c,matchUpsMap:d,event:v});if(x.error)return ee({result:x,stack:e})}if(O){let x=Fue({sourceMatchUpStatus:r&&u||qi,loserMatchUpDrawPositionIndex:M,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:a,loserDrawPosition:P,tournamentRecord:s,loserTargetLink:E,drawDefinition:l,loserMatchUp:O,winningSide:p,matchUpsMap:d,dualMatchUp:c,event:v});if(x.error)return ee({result:x,stack:e})}if(k){let x=k.drawPositions||[],F=Math.min(...x.filter(Boolean)),$=N.target.structureId,_=Ka({drawPosition:F,structureId:$,tournamentRecord:s,drawDefinition:l,event:v});if(_.error)return ee({result:_,stack:e})}}else return ee({result:{error:My},stack:e});return ee({result:{...X,...S},stack:e})}function PO(t){var j,z,W,q;let e="genPlayoffStructure";if(!t.drawDefinition)return ee({result:{error:Le},stack:e});let i=yb(t);if(i.error)return ee({result:i,stack:e});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:o,finishingPositionLimit:s,playoffAttributes:l,playoffPositions:u,roundOffsetLimit:c,tournamentRecord:d,exitProfileLimit:p,roundProfiles:m,roundNumbers:h,idPrefix:f,isMock:g,event:v,uuids:y}=t,I=Ce(t.drawDefinition,!1,!0),{structure:b}=it({structureId:r,drawDefinition:I});if(!b)return ee({result:{error:Ci},stack:e});if(b.structureType===xn||b.structures)return fue({sourceStructureId:b.structureId,...t,...i,drawDefinition:I});let{playoffRoundsRanges:S,playoffRounds:w}=i,{playoffPositionsReturned:U,error:T,playoffSourceRounds:D,playoffRoundsRanges:P}=Yq(t);if(T)return ee({result:{error:T},stack:e});let E=(m==null?void 0:m.length)&&Object.assign({},...m),R=h||typeof m=="object"&&m.map(Y=>Object.keys(Y)).flat(),N=Array.isArray(R)&&R.map(Y=>!isNaN(Y)&&et(Y)).filter(Boolean);if(N){if(!Array.isArray(N))return ee({result:{error:se},context:{validRoundNumbers:N},stack:e});N.forEach(Y=>{if(!(w!=null&&w.includes(Y)))return ee({result:{error:se},context:{roundNumber:Y},stack:e})})}u&&u.forEach(Y=>{if(!(U!=null&&U.includes(Y)))return ee({result:{error:se},context:{playoffPosition:Y},stack:e})});let A=N||D,M=N?S:P,C=[],O=[];for(let Y of A??[]){let re=M==null?void 0:M.find(ne=>ne.roundNumber===Y);if(!re)return ee({result:{error:se},context:{roundNumber:Y},stack:e});let J=re.finishingPositions.length,H=Math.min(...re.finishingPositions)-1,Z=2,K=Y&&(E==null?void 0:E[Y])&&Z+E[Y]-1,ie=wf({exitProfile:`0-${Y}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:H,playoffAttributes:l,exitProfileLimit:p,stage:$i,roundOffset:0,drawDefinition:I,sequenceLimit:K,stageSequence:Z,drawSize:J,idPrefix:f,isMock:g,uuids:y,finishingPositionNaming:o,finishingPositionLimit:s,roundOffsetLimit:c});if(ie.error)return ee({result:ie,stack:e});let{structures:ae,links:oe}=ie;if(ae!=null&&ae.length&&C.push(...ae),oe!=null&&oe.length&&O.push(...oe),ie.structureId&&Y){let ne={linkType:Gl,source:{structureId:r,roundNumber:Y},target:{structureId:ie.structureId,feedProfile:_o,roundNumber:1}};O.push(ne)}}if(!C.length)return ee({result:{error:se},info:"No structures generated",stack:e});I.structures.push(...C),I.links.push(...O);let{matchUps:k,matchUpsMap:x}=hr({inContext:!0,drawDefinition:I}),F=C.map(({structureId:Y})=>Y),$=k==null?void 0:k.filter(({structureId:Y})=>F.includes(Y)).map(Dr),_=(j=x==null?void 0:x.drawMatchUps)==null?void 0:j.filter(({matchUpId:Y})=>$==null?void 0:$.includes(Y));if(_!=null&&_.length){let Y=(z=vn({drawDefinition:I,event:v}))==null?void 0:z.tieFormat;Y&&_.forEach(re=>{let{tieMatchUps:J}=bb({matchUp:re,tieFormat:Y,isMock:g});Object.assign(re,{tieMatchUps:J,matchUpType:fi})})}(W=k==null?void 0:k.filter(Y=>Rd({matchUp:Y})&&Y.structureId===r))==null||W.forEach(Y=>{let{matchUpId:re,score:J,winningSide:H}=Y,Z=Cn({inContextDrawMatchUps:k,drawDefinition:I,matchUpId:re}),K=p3({inContextDrawMatchUps:k,tournamentRecord:d,drawDefinition:I,matchUpsMap:x,winningSide:H,targetData:Z,matchUpId:re,structure:b,matchUp:Y,score:J,event:v});K.error&&console.log(K.error)}),(q=k==null?void 0:k.filter(Y=>Y.matchUpStatus===Vt&&Y.structureId===r))==null||q.forEach(Y=>{let{matchUpId:re}=Y,J=Cn({inContextDrawMatchUps:k,drawDefinition:I,matchUpId:re}),{targetLinks:{loserTargetLink:H},targetMatchUps:{loserMatchUpDrawPositionIndex:Z,loserMatchUp:K}}=J;if(H&&K){let ie=H.target.structureId,ae=K.drawPositions[Z],oe=Ka({drawPosition:ae,structureId:ie,tournamentRecord:d,drawDefinition:I,event:v});oe.error&&console.log(oe.error)}});let L=[],B=$d({inContextDrawMatchUps:k,drawDefinition:I,matchUpsMap:x}).goesToMap,{structure:V}=it({drawDefinition:t.drawDefinition,structureId:r}),{matchUps:G}=Wt({structure:V});return G.forEach(Y=>{var H,Z;let re=B==null?void 0:B.loserMatchUpIds[Y.matchUpId];if(re&&Y.loserMatchUpId!==re){Y.loserMatchUpId=re;let K={tournamentId:d==null?void 0:d.tournamentId,eventId:(H=t.event)==null?void 0:H.eventId,context:e,matchUp:Y};L.push(K)}let J=B==null?void 0:B.winnerMatchUpIds[Y.matchUpId];if(J&&Y.winnerMatchUpId!==J){Y.winnerMatchUpId=J;let K={tournamentId:d==null?void 0:d.tournamentId,eventId:(Z=t.event)==null?void 0:Z.eventId,context:e,matchUp:Y};L.push(K)}}),{structures:C,matchUpModifications:L,links:O,drawDefinition:I,...X}}function m3({element:t}){if(!t)return{error:se};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:se};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function bl(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:CN};let a=UW(t);if(a.error)return a;if(!(Nt(n)&&Di(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:EN};if(!a.timeItems)a.timeItems=[];else if(Lue({element:a,duplicateValues:e,timeItem:n}))return{...X};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let o=new Date().toISOString();Object.assign(n,{createdAt:o})}return r&&(a.timeItems=a.timeItems.filter(({itemType:o})=>n.itemType!==o)),r&&!n.itemValue||a.timeItems.push(n),{...X}}function Lue({element:t,duplicateValues:e,timeItem:i}){var s;let{itemType:r,itemSubTypes:n,itemValue:a}=i,o=r&&((s=wo({itemSubTypes:n,itemType:r,element:t}))==null?void 0:s.timeItem);return o&&JSON.stringify(o==null?void 0:o.itemValue)===JSON.stringify(a)&&!e}function RO({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:ge};if(!n)return{error:mr};let o=Yc({tournamentRecord:i,participantId:n});return o.error?o:bl({element:o.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function Db(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:ge};let o=bl({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(o.error)return o;let s=m3({element:i});return lt({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:s},topic:dp}),o}function fh(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?bl({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:co}}function h3(t){return YT({...t,itemType:"attachConsolationStructures"})}function EO(t){return YT({...t,itemType:"attachPlayoffStructures"})}function YT({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:o}){var g,v,y;let s="attachStructures";if(!r)return{error:Le};if(!Array.isArray(n)||!Array.isArray(a))return ee({result:{error:se},stack:s});let l=I=>{var b;return[I.source.structureId,I.source.roundNumber||((b=I.source.finishingPositions)==null?void 0:b.join("|")),I.target.roundNumber].join("|")},u=(g=r.links)==null?void 0:g.map(l);if(a.some(I=>{let b=l(I);return u==null?void 0:u.includes(b)}))return ee({result:{error:kN},info:"playoff structure exists",stack:s});a.length&&((v=r.links)==null||v.push(...a));let c=n.map(({structureId:I})=>I),d=(y=r.structures)==null?void 0:y.map(({structureId:I})=>I);r.structures=(r.structures??[]).map(I=>c.includes(I.structureId)?n.find(({structureId:b})=>b===I.structureId):I);let p=n==null?void 0:n.filter(({structureId:I})=>!(d!=null&&d.includes(I)));p.length&&r.structures.push(...p),$d({drawDefinition:r});let m=n.map(I=>{var b;return((b=Wt({structure:I}))==null?void 0:b.matchUps)||[]}).flat();Pc({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUps:m});let h=n.map(({structureId:I})=>I);if(li({drawDefinition:r,structureIds:h}),e==null?void 0:e.length){let I={};e.forEach(S=>{var U;let w=(U=S.matchUp)==null?void 0:U.matchUpId;w&&(I[w]=S)});let b=S=>{S.matchUps.forEach(w=>{if(I[w.matchUpId]){let{tieMatchUps:U,...T}=I[w.matchUpId].matchUp;if(Object.assign(w,T),U==null?void 0:U.length){let D={};U.forEach(P=>I[P.matchUpId]=P),w.tieMatchUps.forEach(P=>Object.assign(P,D[P.matchUpId]))}I[w.matchUpId].matchUp=w,Rt(I[w.matchUpId])}})};r.structures.forEach(S=>{if(d!=null&&d.includes(S.structureId))if(S.structures)for(let w of S.structures)b(w);else b(S)})}let f=p.map(Da("structureId"));if(i){let I={itemValue:{structureIds:h,drawId:r.drawId},itemType:t};bl({element:i,timeItem:I})}return{...X,addedStructureIds:f}}function KT(t){var o,s;let{structures:e,links:i,matchUpModifications:r,error:n}=PO(t);if(n)return{error:n};let a=t.drawDefinition;return EO({tournamentId:(o=t.tournamentRecord)==null?void 0:o.tournamentId,eventId:((s=t.event)==null?void 0:s.eventId)||t.eventId,matchUpModifications:r,drawDefinition:a,structures:e,links:i})}function Vd(t){let e=ze(t,[{_anyOf:{[mn]:!1,[wr]:!1,[Fn]:!1,[Hc]:!1},[QN]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=qB(t,r);if(n.error)return n;i.push(...(n==null?void 0:n.applied)??[]),t.drawDefinition&&li({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ge};for(let a of n){let o=t.tournamentRecords[a],s=qB(t,o);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:ge};return i.length?{...X,applied:i}:{error:wN}}function qB(t,e){let i=$t(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:j0};for(let a of n)if(!i[a]||t.allowReplacement){let o=t.policyDefinitions[a];if(!o)continue;if(!Nt(o))return{error:se};let{policyName:s,...l}=o;if(!l||!Object.keys(l).length||s&&!Di(s))return{error:se};i[a]=t.policyDefinitions[a],r.push(a)}return r!=null&&r.length?{...Lt({element:e,extension:{name:kI,value:i}}),applied:r}:{applied:r,error:wN}}function CO({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){var s;if(!r||typeof r!="string")return ee({result:{error:se},context:{drawName:r}});i||(i=Gi({event:a}).flightProfile);let o=(s=i==null?void 0:i.flights)==null?void 0:s.find(l=>l.drawId===n);if(o){o.drawName=r;let l={name:ts,value:{...i,flights:i.flights}};Wc({event:a,extension:l})}return e&&(e.drawName=r,li({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!o&&!e?{error:Le}:{...X,flight:o}}function f3({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){var l;if(!Nt(i))return{error:se};let a=Gi({event:n}).flightProfile,o=i.drawName&&CO({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:r,event:n});if(o!=null&&o.error)return o==null?void 0:o.error;let s=(o==null?void 0:o.flight)||((l=a==null?void 0:a.flights)==null?void 0:l.find(u=>u.drawId===r));if(!s&&!e)return{error:Le};if(s){let u={name:ts,value:{...a,flights:a.flights}};Wc({event:n,extension:u})}return e&&(i.policyDefinitions&&Vd({policyDefinitions:i.policyDefinitions,drawDefinition:e}),li({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...X}}function g3({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var o,s;if(!i)return{error:Le};let r=sn({drawDefinition:i}),n=l=>{var u;return(u=r==null?void 0:r.drawMatchUps)==null?void 0:u.find(c=>c.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:u,stage:c,stageSequence:d}=l;u&&(d!==1||![Ke,Oe].includes(c))&&(l.positionAssignments=u.map(h=>(delete h.participantId,h)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:m}=Wt({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:l});for(let h of p){let{matchUpId:f,roundNumber:g}=h,v=h.sides||[],y=n(f);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==Vt&&Object.assign(y,qT),g&&g>1&&((o=y.drawPositions)==null?void 0:o.length)&&!m){let I=v==null?void 0:v.map(({drawPosition:S,participantFed:w})=>!w&&S).filter(Boolean),b=y.drawPositions.map(S=>I.includes(S)?void 0:S);y.drawPositions=b}e?delete y.timeItems:(s=y.timeItems)!=null&&s.length&&(y.timeItems=y.timeItems.filter(I=>I.itemType&&![Wl,Ec,nh,$A,ah,oh].includes(I.itemType))),Rt({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}i.extensions=i.extensions.filter(l=>l.name!==bf);let a=(i.structures||[]).map(({structureId:l})=>l);return li({drawDefinition:i,structureIds:a}),{...X}}function Pb({tournamentRecord:t}){var r;if(!t)return{error:ge};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return((r=t.events)==null?void 0:r.map(n=>{let a=n.eventId;return i[a]=n,((n==null?void 0:n.drawDefinitions)||[]).map(o=>({drawDefinition:o,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:n,eventId:a})=>{let o=0,s=0,l=0,{allStructuresLinked:u}=GT({drawDefinition:n}),c=i[a],d=((n==null?void 0:n.structures)||[]).map(b=>{let{stage:S,stageSequence:w,structureId:U}=b,T=Sm[S],{inContextStructureMatchUps:D}=ub({drawDefinition:n,structure:b,event:c}),P=D==null?void 0:D.filter(({winningSide:L})=>L),E=P.filter(Boolean).length||0;s+=E,l+=D.length-s;let R=Math.max(P.filter(({roundNumber:L})=>L===1).map(({roundPosition:L})=>L)),{positionAssignments:N}=oi({structure:b}),A=N==null?void 0:N.filter(({participantId:L})=>L);o+=(A==null?void 0:A.length)??0;let M=((N==null?void 0:N.length)??0)-((A==null?void 0:A.length)??0),{roundMatchUps:C,roundProfile:O,roundNumbers:k,maxMatchUpsCount:x}=En({matchUps:D}),F=O&&Object.keys(O).filter(L=>!O[L].inactiveRound).map(L=>parseInt(L)),$=O&&Object.keys(O).filter(L=>O[L].inactiveRound).map(L=>parseInt(L)),_=O&&Object.values(O).every(L=>L.inactiveRound);return{positionsAssignedCount:(A==null?void 0:A.length)??0,maxWinningSideFirstRoundPosition:R,unassignedPositionsCount:M,inactiveStructure:_,maxMatchUpsCount:x,inactiveRounds:$,roundMatchUps:C,activeRounds:F,roundNumbers:k,roundProfile:O,structureId:U,stageSequence:w,orderNumber:T,stage:S}}),p=d.find(b=>b.orderNumber===2&&b.stageSequence===1),m=d.filter(({inactiveStructure:b})=>!b).length,{links:h}=Vg({structureId:p.structureId,drawDefinition:n}),f=et(p.activeRounds[0])===1&&p.activeRounds.length===1&&m===1,g=d==null?void 0:d.every(({inactiveStructure:b})=>b),v=!h.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=n.drawId;o&&!s&&e.positionsNoOutcomes.push(y),g&&e.inactive.push(y),f&&e.matchPlay.push(y),v&&e.canBePruned.push(y);let I={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:o,allStructuresLinked:u,structuresData:d,inactiveDraw:g,isMatchPlay:f,drawId:y};e.drawAnalysis[y]=I}),{...X,drawsAnalysis:e}}function v3({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){var o;if(!e)return{error:ge};if(!i)return{error:Le};let n=[],{drawsAnalysis:a}=Pb({tournamentRecord:e});if(a.canBePruned.includes(r)){let s=a.matchPlay.includes(r),l=a.drawAnalysis[r],{structures:[u]}=is({stageSequence:1,drawDefinition:i,stage:Oe}),c=l.structuresData.find(({structureId:h})=>u.structureId===h),d=(u.matchUps??[]).sort((h,f)=>h.roundPosition-f.roundPosition);n=d.filter(({roundNumber:h})=>!c.inactiveRounds.includes(h));let p=n.map(Dr),m=d.map(Dr).filter(h=>!p.includes(h));if(s){let h=n.filter(({roundNumber:I})=>!c.inactiveRounds.includes(I)).filter(({winningSide:I})=>I),f=h.map(Dr),g=p.filter(I=>!f.includes(I));m.push(...g);let v=h.flatMap(I=>I.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((I,b)=>({[I]:b+1})));if(h.forEach(I=>{t?I.drawPositions=I.drawPositions.map(b=>y[b]):delete I.drawPositions}),t){let I=(o=u==null?void 0:u.positionAssignments)==null?void 0:o.filter(b=>v.includes(b.drawPosition)).map(b=>(b.drawPosition=y[b.drawPosition],b));u.positionAssignments=I}else u.positionAssignments=[];u.matchUps=h,n=h}Wu({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:m,drawDefinition:i}),li({drawDefinition:i})}return{...X,matchUps:n}}function I3({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:o,bye:s}){if(!e)return{error:Le};if(!r)return{error:Eg};if(!n)return{error:Wa};if(s){let l=Ka({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:o});if(l.error)return l}else{if(a)return{error:X0};{let l=ol({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,event:o});if(l.error)return l}}return{...X}}function y3(t){var l,u,c,d,p;let e=t.matchUpIds??[],{drawDefinition:i}=t,r=t.structureId??((u=(l=i==null?void 0:i.structures)==null?void 0:l.find(m=>{var h;return(h=m.matchUps)==null?void 0:h.some(({matchUpId:f})=>e.includes(f))}))==null?void 0:u.structureId)??((d=(c=i==null?void 0:i.structures)==null?void 0:c[0])==null?void 0:d.structureId);if(!r)return{error:Ci};let n=(p=i.structures)==null?void 0:p.find(m=>m.structureId===r);if(!n)return{error:Ci};let a=n==null?void 0:n.matchUps,o=a==null?void 0:a.find(m=>!!m.roundPosition);if(n.structures||o||n.finishingPosition===eh)return{error:sp};let s=a.filter(({roundNumber:m})=>{var h;return(h=t.roundNumbers)==null?void 0:h.includes(m)}).map(Dr);return e=e.filter(m=>!s.includes(m)),t.roundNumbers&&!e.length&&(e=s),{existingMatchUps:a,matchUpIds:e,structureId:r,structure:n}}function b3(t){let e=ze(t,[{[Fn]:!0},{[Lf]:{[jy]:!1,roundNumbers:!1},[$a]:se,[Jn]:cn}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:o,event:s}=t,l=y3(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,m=[],h=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:I})=>{if(I&&!n)return!1;if(I||Ir({score:y})){if(!I&&!i)return!1;m.push(v)}else if(!r)return!1;return p==null?void 0:p.includes(v)}))??[],f=h.map(Dr),g=h.map(({tieMatchUps:v})=>v==null?void 0:v.map(Dr)).filter(Boolean).flat();if(f.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:I})=>!f.includes(I)),Wu({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...f],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:o});let v=ct(u.matchUps.map(Da("roundNumber"))),y=Une(v);if(y.length){y.reverse();for(let I of y)u.matchUps.forEach(b=>{b.roundNumber&&b.roundNumber>I&&(b.roundNumber-=1,Rt({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:b}))})}if(m.length){u.positionAssignments=ct(u.matchUps.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U}));let I=(u==null?void 0:u.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(s==null?void 0:s.matchUpFormat),b=l.existingMatchUps.some(U=>U.matchUpType===xa)?{matchUpTypes:[xa]}:void 0,{matchUps:S}=Wt({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:b,structure:u,event:s});zn({structure:u})&&(u.positionAssignments=ct(S.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U})));let w=UO({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:I,matchUps:S,event:s});w.error&&console.log(w)}li({structureIds:[c],eventId:s==null?void 0:s.eventId,drawDefinition:o})}return!f.length&&p.length?{error:Z0}:{...X,deletedMatchUpsCount:[...f,...g].length}}function w3({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:ge};if(!i)return{error:Le};if(!n)return ee({result:{error:Xe},info:"roundNumber required"});let o=it({drawDefinition:i,structureId:r});if(o.error)return o;let s=o.structure;return s!=null&&s.structures?{error:sp}:zn({structure:s})?_ue({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:s}):(console.log("not implemented"),{...X})}function _ue({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let o=(n==null?void 0:n.matchUps)??[],s=[],l=[],u=!1;if(o.reduce((c,d)=>{let p=d==null?void 0:d.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(sr).includes(r)){let c=o.filter(d=>{let p=d.roundNumber===r&&(!vr.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map(Dr))),!p});l.length&&(Wu({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===r)||(c.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Rt({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),n.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...X}}function JT(t){var p,m,h,f,g,v;let{suppressNotifications:e,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=t;if(typeof r!="object")return{error:Le};let o=t==null?void 0:t.structureId;if(!o&&((p=r.structures)==null?void 0:p.length)===1&&(o=(h=(m=r.structures)==null?void 0:m[0])==null?void 0:h.structureId),typeof o!="string")return{error:Wa};if(!So(n))return{error:se,info:Bd("matchUps")};let s=(f=r.structures)==null?void 0:f.find(y=>y.structureId===o);if(!s)return{error:Ci};let l=(s==null?void 0:s.matchUps).find(y=>!!y.roundPosition);if(s.structures||l||s.finishingPosition===eh)return{error:sp};let u=((v=(g=Vr({tournamentRecord:i,inContext:!1}))==null?void 0:g.matchUps)==null?void 0:v.map(Dr))??[],c=n.map(Dr);if(Rn(u,c))return{error:RH,info:"One or more matchUpIds already present in tournamentRecord"};s.matchUps.push(...n);let d=n.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return e||(Pc({tournamentId:i==null?void 0:i.tournamentId,matchUps:[...d,...n],eventId:a==null?void 0:a.eventId,drawDefinition:r}),li({drawDefinition:r,structureIds:[o]})),{...X}}function U3({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){var m;if(!e)return{error:Le};if(!r)return{error:Wa};if(!i)return{error:Eg};let{structure:o}=it({drawDefinition:e,structureId:r});if(!o)return{error:Ci};let s=o;o.structures&&o.structureType===xn&&(s=(m=o.structures)==null?void 0:m.find(h=>{var f;return(f=h.positionAssignments)==null?void 0:f.find(g=>g.drawPosition===i)}));let l=s==null?void 0:s.positionAssignments,u=l==null?void 0:l.find(h=>h.drawPosition===i);u&&Lt({element:u,extension:{name:Bf,value:n}});let c=((a==null?void 0:a.eventType)===fi||e.matchUpType===fi||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(o==null?void 0:o.tieFormat)))&&{matchUpTypes:[fi]},{matchUps:d}=Wt({structure:s,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:c,event:a}),p=(o==null?void 0:o.matchUpFormat)??e.matchUpFormat;return UO({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),li({drawDefinition:e,structureIds:[r]}),{...X}}var S3={};bt(S3,{addGoesTo:()=>$d,allPlayoffPositionsFilled:()=>uO,checkValidEntries:()=>ZT,findDrawDefinition:()=>OO,getAssignedParticipantIds:()=>Ip,getAvailableMatchUpsCount:()=>XT,getAvailablePlayoffProfiles:()=>yb,getDrawDefinitionTimeItem:()=>NA,getDrawParticipantRepresentativeIds:()=>NO,getDrawStructures:()=>is,getDrawTypeCoercion:()=>Rb,getEligibleVoluntaryConsolationParticipants:()=>MO,getMatchUpsMap:()=>sn,getParticipantIdFinishingPositions:()=>AO,getPositionAssignments:()=>BI,getPositionsPlayedOff:()=>qg,getSeedingThresholds:()=>rO,getSeedsCount:()=>Eb,getStructureSeedAssignments:()=>ho,getTeamLineUp:()=>_d,getValidGroupSizes:()=>fb,isAdHoc:()=>zn,isCompletedStructure:()=>Cc,isValidForQualifying:()=>FO,positionActions:()=>xO});function MO({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:m}){var O,k,x,F,$;if(!s)return{error:Le};let h=[Oe,$i];i&&h.push(Ke);let f=m!=null&&m.eventType?{matchUpTypes:[m.eventType]}:void 0,g=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,v=e&&m?((O=iu({contextFilters:{stages:h},matchUpFilters:f,tournamentRecord:o,inContext:!0,event:m}))==null?void 0:O.matchUps)??[]:((k=Sn({contextFilters:{stages:h},matchUpFilters:g,tournamentRecord:o,inContext:!0,drawDefinition:s}))==null?void 0:k.matchUps)??[],y=rh({stage:Or,drawDefinition:s}).map(({participantId:_})=>_),I={},b={},S={},w={};n||(n=qu({policyTypes:[EC],tournamentRecord:o,drawDefinition:s,event:m}).policyDefinitions);let U=n==null?void 0:n[EC];t=t.length&&t||(U==null?void 0:U.excludedMatchUpStatuses)||[],e=e??(U==null?void 0:U.includeEventParticipants),d=d??(U==null?void 0:U.allEntries),r=r??(U==null?void 0:U.finishingRoundLimit),a=a??(U==null?void 0:U.roundNumberLimit),l=l??(U==null?void 0:U.matchUpsLimit),u===void 0&&(u=(U==null?void 0:U.requirePlay)!==void 0?U.requirePlay:!0),c===void 0&&(c=(U==null?void 0:U.requireLoss)!==void 0?U.requireLoss:!0),p=p??(U==null?void 0:U.winsLimit);for(let _ of v){if(u&&_.winningSide&&![1,2].includes(_.winningSide)&&_.matchUpStatus!==tr||_.finishingRound&&r&&_.finishingRound>=r||_.finishingRound&&a&&_.finishingRound<=a)continue;let L=(x=_.sides)==null?void 0:x.find(({sideNumber:V})=>_.winningSide&&V===3-_.winningSide),B=(F=_.sides)==null?void 0:F.find(({sideNumber:V})=>_.winningSide&&V===_.winningSide);if(($=_.sides)==null||$.forEach(V=>{var j;let G=(j=V==null?void 0:V.participant)==null?void 0:j.participantId;G&&(S[G]=V.participant,_.matchUpStatus===tr&&!u&&(b[G]=V.participant,I[G]||(I[G]=0),(!_.matchUpStatus||!t.includes(_.matchUpStatus))&&(I[G]+=1)))}),L==null?void 0:L.participant){let V=L.participant.participantId;b[V]=L.participant,I[V]||(I[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(I[V]+=1)}if(B!=null&&B.participant){let V=B.participant.participantId;w[V]||(w[V]=0),w[V]+=1,I[V]||(I[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(I[V]+=1)}}let T=(o==null?void 0:o.participants)&&!u&&!c&&d,D=T?((e&&m?m.entries:s.entries)??[]).filter(_=>![Eu,Uo].includes(_.entryStatus)).map(({participantId:_})=>_):[],P=Object.keys(b),E=T?((o==null?void 0:o.participants)??[]).filter(({participantId:_})=>D.includes(_)):c&&Object.values(b)||Object.values(S),R=_=>!c||P.includes(_),N=_=>!u||(I[_]||0)>=0,A=_=>!p||(w[_]||0)<=p,M=_=>!l||I[_]<=l,C=_=>!y.includes(_);return{eligibleParticipants:E.filter(_=>R(_.participantId)&&N(_.participantId)&&A(_.participantId)&&M(_.participantId)&&C(_.participantId)).map(_=>{var L;return{..._,individualParticipants:(L=_.individualParticipantIds)==null?void 0:L.map(B=>{var V;return(V=o==null?void 0:o.participants)==null?void 0:V.find(G=>G.participantId===B)})}}),losingParticipantIds:P,...X}}function XT(t){var h,f,g,v,y,I,b,S;let e=ze(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:r}=t,n=t.structureId??(((h=i.structures)==null?void 0:h.length)===1&&((g=(f=i.structures)==null?void 0:f[0])==null?void 0:g.structureId));if(typeof n!="string")return{error:Wa};let a=(v=i.structures)==null?void 0:v.find(w=>w.structureId===n);if(!a)return{error:Ci};let o,s=(y=a.matchUps??[])==null?void 0:y.reduce((w,U)=>(U.roundPosition&&(o=!0),((U==null?void 0:U.roundNumber)||0)>w?U.roundNumber:w),0);if(a.structures||o||a.finishingPosition===eh)return{error:sp};let l=((I=i==null?void 0:i.entries)==null?void 0:I.filter(w=>{let U=w.entryStatus;return ds.includes(U)}))??[],u=Math.floor((l==null?void 0:l.length)/2)||1,c=r??s??1,d=((S=(b=a.matchUps)==null?void 0:b.filter(w=>w.roundNumber===c))==null?void 0:S.length)??0,p=u-d,m=p>0?p:0;return{...X,availableMatchUpsCount:m,lastRoundNumber:s,roundMatchUpsCount:u}}function NO({drawDefinition:t}){var i;let e=vt({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:((i=e.extension)==null?void 0:i.value)||[]}}function $ue({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:Le};let r=hr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=Ce(r.matchUps,!1,!0),a=ct(n.reduce((s,l)=>s.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),o=Object.assign({},...a.map(s=>{let l=n.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:a,participantIdMatchUps:o}}function AO({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:Le};let{participantIds:r,participantIdMatchUps:n}=$ue({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(r==null?void 0:r.map(o=>{let s=n[o].filter(d=>[qi,Vt].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(h=>h.bye),m=d.sides.find(h=>h.participantId===o).sideNumber;return(d.winningSide||t&&p&&m)===m?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),u=d=>Math.abs(d[0]-d[1]),c=l.reduce((d,p)=>d&&u(d)<u(p)?d:p,void 0);return{[o]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:c}}}))||[];return Object.assign({},...a)}function Xc({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:ge};if(!r)return{error:$s};if(!e&&t){if(typeof i!="string"&&(i=d3({tournamentRecords:t,drawId:r}),!i))return{error:Rf};if(e=t[i],!e)return{error:ge}}let n=e&&Wn({tournamentRecord:e,drawId:r});return n!=null&&n.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...X}:ee({result:{error:Fa},stack:"findDrawDefinition"})}function OO(t){let{drawDefinition:e,error:i}=Xc(t);return i?{error:i}:{drawDefinition:Ce(e)}}function HC({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=Vg({drawDefinition:i,structureId:r})||{},o=((a==null?void 0:a.target)||[]).filter(({linkType:s})=>s===n).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:u}=it({structureId:l,drawDefinition:i});if(!(e&&(u==null?void 0:u.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:o.map(({source:s})=>s.structureId),relevantLinks:o}}function Bue({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){var s;let o=((s=a==null?void 0:a.entries)==null?void 0:s.filter(({entryStatus:l})=>[Uo,fp].includes(l)).map(({participantId:l})=>l))||[];if(o.length){let l=r.individualParticipantIds,u=e?t.filter(({participantId:d})=>o.includes(d)):void 0,c=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:je({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:Jle,availableIndividualParticipantIds:o,availableIndividualParticipants:u,existingIndividualParticipantIds:l,existingIndividualParticipants:c,type:pO},!1,!1,!0)}}return{}}function jd(t){var g,v,y,I,b;let{inContextDrawMatchUps:e,targetData:i,drawDefinition:r,relevantLink:n}=t;if((n==null?void 0:n.linkCondition)===nl&&((g=i==null?void 0:i.matchUp)==null?void 0:g.matchUpStatus)===Vt)return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:o},targetLinks:s}=i,l=a&&Cn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),u=(v=l==null?void 0:l.targetMatchUps)==null?void 0:v.loserMatchUp,c=(y=l==null?void 0:l.targetMatchUps)==null?void 0:y.loserMatchUpDrawPositionIndex,d=(I=u==null?void 0:u.sides[c])==null?void 0:I.participant,p=[Mt,zt].includes(a==null?void 0:a.matchUpStatus)&&!d,m=((b=o==null?void 0:o.drawPositions)==null?void 0:b.filter(Boolean).length)||0;if(a!=null&&a.winningSide&&!p||o!=null&&o.winningSide&&m===2&&(!o.feedRound||![zt,Mt].includes(o==null?void 0:o.matchUpStatus)))return!0;let h=o&&Cn({matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),f=l&&jd({relevantLink:s==null?void 0:s.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:r});return!!(h&&jd({targetData:h,inContextDrawMatchUps:e,drawDefinition:r})||f)}var Vue={[Dm]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Ke,Oe],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[AS,zf,HT,eI],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},$U="positionAction",zC="matchUpAction";function T3({actionType:t=$U,appliedPolicies:e,drawDefinition:i,structure:r}){var d,p;let n=t===$U&&Dm||t===zC&&kr,a=t===$U&&Vue||t===zC&&rq,o=n&&((e==null?void 0:e[n])||(a==null?void 0:a[n])),s=((p=(d=i.links)==null?void 0:d.filter(m=>{var h;return((h=m==null?void 0:m.target)==null?void 0:h.structureId)===(r==null?void 0:r.structureId)}))==null?void 0:p.map(({target:m})=>m.feedProfile))??[],{enabledStructures:l,disabledStructures:u}=o||{},c=u==null?void 0:u.find(m=>{let{stages:h,stageSequences:f,structureTypes:g,feedProfiles:v}=m;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>s.includes(y)))&&(!(h!=null&&h.length)||Array.isArray(h)&&(h==null?void 0:h.includes(r==null?void 0:r.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(r==null?void 0:r.structureType)))&&(!(f!=null&&f.length)||Array.isArray(f)&&f.includes(r==null?void 0:r.stageSequence))});return{enabledStructures:l,actionsDisabled:c,actionsPolicy:o}}function YB({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function D3({enabledStructures:t,drawDefinition:e,structure:i}){var s,l;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},o=((l=(s=e.links)==null?void 0:s.filter(u=>{var c;return((c=u==null?void 0:u.target)==null?void 0:c.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:l.map(({target:u})=>u.feedProfile))||[];return{policyActions:t.find(u=>{let{stages:c,stageSequences:d,structureTypes:p,feedProfiles:m}=u||{},h=!(c!=null&&c.length)||Array.isArray(c)&&c.includes(r),f=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(n),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(a),v=!(m!=null&&m.length)||Array.isArray(m)&&m.some(y=>o.includes(y));return f&&g&&v&&u&&h})}}function Zn({action:t,policyActions:e}){var r;let i=!(e!=null&&e.enabledActions)||((r=e==null?void 0:e.disabledActions)==null?void 0:r.length)&&e.disabledActions.includes(t);return i?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!i}var P3="replaceTieMatchUpParticipantId",R3="assignTieMatchUpParticipantId",WC="removeTieMatchUpParticipantId",KB="assignMatchUpSideParticipant",jue="removeMatchUpSideParticipant",E3="substituteParticipant",qC="REMOVE_SUBSTITUTION",C3="REPLACE_PARTICIPANT",kO="REMOVE_PARTICIPANT",YC="setMatchUpStatus",KC="SUBSTITUTION",M3="SCHEDULE",Gue="PENALTY",JC="REFEREE",N3="STATUS",XC="START",A3="SCORE",QC="END",Hue={REPLACE_TEAM_POSITION_METHOD:P3,ASSIGN_TEAM_POSITION_METHOD:R3,REMOVE_TEAM_POSITION_METHOD:WC,REPLACE_PARTICIPANT:C3,SUBSTITUTION_METHOD:E3,REMOVE_SUBSTITUTION:qC,REMOVE_PARTICIPANT:kO,SCHEDULE_METHOD:YC,SUBSTITUTION:KC,SCHEDULE:M3,PENALTY:Gue,REFEREE:JC,STATUS:N3,SCORE:A3,START:XC,END:QC};function zue({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){var A,M,C,O,k,x,F,$,_,L,B,V,G,j,z;let m=[],h=(A=n.sides)==null?void 0:A.find(W=>W.participant),f=n.gender===Bn&&n.sideNumber&&((M=n.sides)==null?void 0:M.filter(W=>W.particiapntId).length)===1&&((O=(C=h==null?void 0:h.participant)==null?void 0:C.person)==null?void 0:O.sex),g=n.matchUpType,v=(o??((k=r==null?void 0:r.participants)==null?void 0:k.enforceGender))!==!1?n.gender:void 0,y=(F=(x=n.sides)==null?void 0:x.flatMap(W=>{var q;return((q=W.participant)==null?void 0:q.individualParticipants)||W.participant}).filter(Boolean))==null?void 0:F.map(Ut),I=($=n.sides)==null?void 0:$.filter(W=>!l||W.sideNumber===l).flatMap(W=>{var q;return((q=W.participant)==null?void 0:q.individualParticipants)||W.participant}).filter(Boolean),b=I==null?void 0:I.map(Ut),S=(L=(_=e==null?void 0:e.find(W=>W.matchUpId===n.matchUpTieId))==null?void 0:_.sides)==null?void 0:L.map(W=>{var q,Y;return(Y=(q=W==null?void 0:W.participant)==null?void 0:q.individualParticipants)==null?void 0:Y.filter(({participantId:re,person:J})=>!(b!=null&&b.includes(re))&&(!v||v===Ms||J.sex===v||v===Bn&&!f||f&&J.sex!==f))}),w=l?S==null?void 0:S[l-1]:S==null?void 0:S.map((W,q)=>({participants:W,sideNumber:q+1})),U=l?(B=S==null?void 0:S[l-1])==null?void 0:B.map(Ut):S==null?void 0:S.map((W,q)=>({participants:W==null?void 0:W.map(Ut),sideNumber:q+1})),T=l&&(Yi(Jp)(g)&&!(b!=null&&b.length)||Yi(Md)(g)&&((b==null?void 0:b.length)??0)<2)||!l&&(Yi(Jp)(g)&&((b==null?void 0:b.length)??0)<2||Yi(Md)(g)&&((b==null?void 0:b.length)??0)<4),D=U==null?void 0:U.filter(W=>!(y!=null&&y.includes(W))),P=w==null?void 0:w.filter(({participantId:W})=>D.includes(W));if(T&&(D!=null&&D.length)&&m.push({availableParticipantIds:D,method:R3,availableParticipants:P,type:Cm,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),b!=null&&b.length&&(!Ir(c)||(V=p==null?void 0:p.substitutions)!=null&&V.length)&&m.push({method:WC,type:kO,existingParticipantIds:b,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),P!=null&&P.length&&(!l&&(b!=null&&b.length)||l&&(p!=null&&p.participant))&&m.push({availableParticipantIds:D,method:P3,availableParticipants:P,type:C3,existingParticipantIds:b,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),Zn({policyActions:a,action:qC})&&((G=p==null?void 0:p.substitutions)==null?void 0:G.length)){let W=((j=p.participant)==null?void 0:j.participantType)===St&&[p.participantId]||((z=p.participant)==null?void 0:z.participantType)===ft&&p.participant.individualParticipantIds||[],q=p.substitutions.map(Y=>Y.participantId).filter(Y=>W.includes(Y));(!s||q.includes(s))&&m.push({method:WC,type:qC,substitutedParticipantIds:q,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let E=t==null?void 0:t[kr],R=E==null?void 0:E.substituteWithoutScore,N=E==null?void 0:E.substituteAfterCompleted;if(Zn({policyActions:a,action:KC})&&i.length===2&&(!l&&(b!=null&&b.length)||l&&(p!=null&&p.participant))&&(R||Ir(c))&&(N||c.matchUpStatus&&!vr.includes(c.matchUpStatus))&&(I!=null&&I.length)&&w.length){let W=I.map(Ut);m.push({info:"list of team players available for substitution",method:E3,availableParticipantIds:U,existingParticipantIds:W,availableParticipants:w,existingParticipants:I,type:KC,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return m}function Wue({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:u,structure:c,drawId:d,event:p}){var U,T,D,P,E;if(i.includes(s))return{};let m=(U=l.find(R=>R.type===Cm))==null?void 0:U.availableParticipantIds,h=(T=a==null?void 0:a[Dm])==null?void 0:T.otherFlightEntries,f=(D=a==null?void 0:a[Dm])==null?void 0:D.restrictQualifyingAlternates,g=(o.entries??[]).filter(({entryStage:R})=>!f||(c.stage===Ke?R===Ke:R!==Ke)).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:R})=>R).filter(Boolean),{allPositionedParticipantIds:v}=cW({drawDefinition:o}),y=r.map(R=>R.participantId).filter(Boolean),I=g.filter(R=>c.stage&&[Ke,Oe,$i].includes(c.stage)?!(v!=null&&v.includes(R)):!y.includes(R)),b=((p==null?void 0:p.entries)??[]).filter(R=>R.entryStatus===Go&&O3({restrictQualifyingAlternates:f,structure:c,entry:R})&&(c.stage&&[Ke,Oe,$i].includes(c.stage)?!(v!=null&&v.includes(R.participantId)):!y.includes(R.participantId))).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(R=>R.participantId),S=ct(I.concat(b));if(h){let R=(E=(P=p?Gi({event:p}).flightProfile:void 0)==null?void 0:P.flights)==null?void 0:E.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(A=>A.participantId&&![Eu,Uo,fp].includes(A.entryStatus)&&!g.includes(A.participantId)).map(({participantId:A})=>A)).flat().filter(Boolean);R!=null&&R.length&&S.push(...R)}m!=null&&m.length&&(S=S.filter(R=>!m.includes(R)));let w=n?t==null?void 0:t.filter(R=>S.includes(R.participantId)):void 0;return w==null||w.forEach(R=>{let N=(o.entries??[]).find(A=>A.participantId===R.participantId);R.entryPosition=N==null?void 0:N.entryPosition}),w==null||w.sort((R,N)=>(R.entryPosition||1/0)-(N.entryPosition||1/0)),S.length?{validAlternatesAction:je({payload:{drawId:d,structureId:u,drawPosition:s},willDisableLinks:e,method:Yle,availableAlternatesParticipantIds:S,type:mO,availableAlternates:w})}:{}}function O3({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===Ke&&!t||i.entryStage===Oe&&r===rn)return!0}function que({eventEntries:t,structure:e}){let i=n=>n.entryStatus===Go&&O3({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(Ut)}function Yue({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:u,drawId:c,event:d}){var T,D,P,E,R,N,A;let p=[],m=(l==null?void 0:l.matchUps)??[],h=(D=(T=u.sides)==null?void 0:T.find(M=>M.sideNumber===o))==null?void 0:D.participantId,f=m.filter(({roundNumber:M})=>M===u.roundNumber),g=((P=n==null?void 0:n.entries)==null?void 0:P.filter(({entryStatus:M})=>M&&gp.includes(M)).map(Ut))??[],v=f.map(M=>(M.sides??[]).flatMap(Ut)).flat().filter(Boolean),y=g.filter(M=>!i.includes(M)&&(!t||!v.includes(M))),I=e==null?void 0:e.filter(M=>y==null?void 0:y.includes(M.participantId)).map(M=>Ce(M,void 0,!0));I==null||I.forEach(M=>{let C=(n.entries??[]).find(O=>O.participantId===M.participantId);M.entryPosition=C==null?void 0:C.entryPosition}),y.length&&p.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:KB,type:Cm,availableParticipantIds:y,participantsAvailable:I});let b=(d==null?void 0:d.entries)??[],S=que({eventEntries:b,structure:l}),w=ct(g.concat(S));if(r){let M=(R=(E=d?Gi({event:d}):void 0)==null?void 0:E.flights)==null?void 0:R.filter(C=>C.drawId!==c).flatMap(C=>C.drawEntries.filter(O=>O.participantId&&![Eu,Uo,fp].includes(O.entryStatus)).map(({participantId:O})=>O)).filter(Boolean);M!=null&&M.length&&w.push(...M)}w=w.filter(M=>!i.includes(M)&&!y.includes(M)&&(!t||!v.includes(M)));let U=e==null?void 0:e.filter(M=>w.includes(M.participantId)).map(M=>Ce(M,void 0,!0));if(U==null||U.forEach(M=>{let C=(n.entries??[]).find(O=>O.participantId===M.participantId);M.entryPosition=C==null?void 0:C.entryPosition}),U==null||U.sort((M,C)=>(M.entryPosition||1/0)-(C.entryPosition||1/0)),w.length&&p.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:w,participantsAvailable:U,method:KB,type:Go}),!Ir(u)&&o&&h){p.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:jue,type:kO});let M=L=>L.sides.map(Ut),C=({matchUpId:L})=>L!==u.matchUpId,O=L=>!Ir(L),k=(A=(N=u.sides)==null?void 0:N.find(L=>L.sideNumber!==o))==null?void 0:A.participantId,x=m.filter(({roundNumber:L})=>L!==u.roundNumber).filter(C).map(M),F=[k,...x.filter(L=>L.includes(h)).flat()].filter(Boolean),$=L=>!F.flat().includes(L),_=f.filter(O).filter(C).map(M).flat().filter($);if(_.length){let L=e==null?void 0:e.filter(B=>_.includes(B.participantId)).map(B=>Ce(B,void 0,!0));p.push({payload:{participantIds:[h],roundNumber:u.roundNumber,structureId:a,sideNumber:o,matchUpId:s,drawId:c},swappableParticipantIds:_,method:Xle,type:zT,swappableParticipants:L})}}return p}function QT(t){var W,q,Y,re,J,H,Z,K,ie;if(!t)return{error:se};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:o,sideNumber:s,matchUpId:l}=t,u=t.tournamentRecord??(t.tournamentId&&Di(t.tournamentId)&&((W=t.tournamentRecords)==null?void 0:W[t.tournamentId]));if(!u)return{error:ge};if(!l||!Di(l))return{error:yn};if(s&&![1,2].includes(s))return ee({result:{error:se},context:{sideNumber:s}});if(!e){let ae=(Vr({tournamentRecord:u}).matchUps??[]).find(ne=>ne.matchUpId===l);i=((u==null?void 0:u.events)??[]).find(ne=>ne.eventId===(ae==null?void 0:ae.eventId));let oe=((i==null?void 0:i.drawDefinitions)??[]).find(ne=>ne.drawId===(ae==null?void 0:ae.drawId));oe&&(e=oe)}if(!e)return{error:Le};let c=Mi({withIndividualParticipants:!0,tournamentRecord:u}).participants,{drawId:d}=e,{matchUp:p,structure:m}=Ui({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:pn};let h=$t({tournamentRecord:u,drawDefinition:e,structure:m,event:i}).appliedPolicies??{};Object.assign(h,n??{});let f=(q=h==null?void 0:h[Dm])==null?void 0:q.otherFlightEntries,g=(h==null?void 0:h[kr])??Hg[kr],{enabledStructures:v}=T3({actionType:zC,appliedPolicies:h,drawDefinition:e,structure:m}),{policyActions:y}=D3({enabledStructures:v,drawDefinition:e,structure:m}),I=t.matchUpsMap??sn({drawDefinition:e}),b=t.inContextDrawMatchUps??hr({tournamentParticipants:c,inContext:!0,drawDefinition:e,matchUpsMap:I,event:i}).matchUps,S=b==null?void 0:b.find(ae=>ae.matchUpId===l),w=s&&((Y=S==null?void 0:S.sides)==null?void 0:Y.find(ae=>ae.sideNumber===s)),U=((re=S==null?void 0:S.sides)==null?void 0:re.map(ae=>{var oe;return ae.participantId||((oe=ae.participant)==null?void 0:oe.participantid)}).filter(Boolean))??[],{assignedPositions:T,allPositionsAssigned:D}=Er({structure:m}),{structureId:P}=m??{},E=[];if(!P)return{validActions:E};let R=zn({structure:m}),N=p.collectionId;if(R&&!N){let ae=Yue({restrictAdHocRoundParticipants:r,tournamentParticipants:c,matchUpParticipantIds:U,otherFlightEntries:f,drawDefinition:e,structureId:P,sideNumber:s,matchUpId:l,structure:m,matchUp:p,drawId:d,event:i});E.push(...ae)}let A=Cc({drawDefinition:e,structure:m}),M=T==null?void 0:T.filter(ae=>ae.participantId).map(ae=>ae.drawPosition),C=T==null?void 0:T.filter(ae=>ae.bye).map(ae=>ae.drawPosition),O=p.matchUpStatus===Vt||!N&&((J=p.drawPositions)==null?void 0:J.reduce((ae,oe)=>(C==null?void 0:C.includes(oe))||ae,!1));if(O)return{validActions:E,isByeMatchUp:O};Zn({policyActions:y,action:JC})&&E.push({type:JC,payload:{matchUpId:l}});let k=!lb({matchUpStatus:p.matchUpStatus}),x=(H=h==null?void 0:h.scoring)==null?void 0:H.structures,F=(m==null?void 0:m.stage)&&(x==null?void 0:x.stage)&&(x==null?void 0:x.stage[m.stage]),$=(m==null?void 0:m.stageSequence)&&(F==null?void 0:F.stageSequence)&&F.stageSequence[m.stageSequence],_=!((Z=h==null?void 0:h.scoring)!=null&&Z.requireAllPositionsAssigned||F!=null&&F.requireAllPositionsAssigned||$!=null&&$.requireAllPositionsAssigned)||D,L=p.sides&&p.sides.filter(ae=>ae==null?void 0:ae.participantId).length===2,B=p.matchUpStatus&&[tr,dr].includes(p.matchUpStatus),V=Cn({inContextDrawMatchUps:b,drawDefinition:e,matchUpId:l}),G=jd({inContextDrawMatchUps:b,drawDefinition:e,targetData:V}),j=(((K=S==null?void 0:S.drawPositions)==null?void 0:K.length)===2&&S.drawPositions.every(ae=>M==null?void 0:M.includes(ae))&&((ie=S==null?void 0:S.sides)==null?void 0:ie.length)===2&&S.sides.every(({participantId:ae})=>ae)||L)&&!(B&&G),z={method:Vq,type:zf,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(k&&E.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:YC,type:M3}),Zn({policyActions:y,action:zf})&&(w!=null&&w.participant||!s&&(U!=null&&U.length))&&E.push(z),k&&j&&E.push({type:N3}),_&&j){let{matchUpId:ae,matchUpFormat:oe}=p,ne={drawId:d,matchUpId:ae,matchUpFormat:oe,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};E.push({info:"set outcome and winningSide",method:YC,type:A3,payload:ne}),Zn({policyActions:y,action:XC})&&E.push({type:XC}),Zn({policyActions:y,action:QC})&&E.push({type:QC})}if(N&&S){let ae=zue({specifiedPolicyDefinitions:n,inContextDrawMatchUps:b,matchUpParticipantIds:U,matchUpActionsPolicy:g,inContextMatchUp:S,policyActions:y,enforceGender:a,participantId:o,sideNumber:s,matchUpId:l,matchUp:p,drawId:d,side:w});E.push(...ae)}return{structureIsComplete:A,validActions:E,isDoubleExit:B,...X}}function Kue({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:u,drawId:c,event:d}){var v,y,I,b,S,w,U;if(n.includes(s)||r&&!e)return{};let{sourceStructureIds:p,targetStructureIds:m}=((v=o.links)==null?void 0:v.reduce((T,D)=>{var R,N;let P=(R=D.source)==null?void 0:R.structureId,E=(N=D.target)==null?void 0:N.structureId;return T.sourceStructureIds.includes(P)||T.sourceStructureIds.push(P),T.targetStructureIds.includes(E)||T.targetStructureIds.push(E),T},{sourceStructureIds:[],targetStructureIds:[]}))||{},h=[],f=((y=o.links)==null?void 0:y.filter(T=>{var D;return((D=T.target)==null?void 0:D.structureId)===u.structureId}))??[];for(let T of f){let D=(I=T==null?void 0:T.source)==null?void 0:I.structureId,{structure:P}=it({structureId:D,drawDefinition:o}),E=(P==null?void 0:P.finishingPosition)===eh&&((p==null?void 0:p.length)!==1||(m==null?void 0:m.length)!==1),R={};if(E){let{matchUps:M}=Wt({drawDefinition:o,structure:u,event:d}),{initialRoundNumber:C}=Em({drawPosition:s,matchUps:M}),O=(w=(S=(b=o.links)==null?void 0:b.find(k=>{var x;return((x=k.target)==null?void 0:x.structureId)===(u==null?void 0:u.structureId)&&k.target.roundNumber===C}))==null?void 0:S.source)==null?void 0:w.roundNumber;R.roundNumbers=[O]}let{completedMatchUps:N}=LT({structureId:D,inContext:!0,matchUpFilters:R,drawDefinition:o}),A=a.map(M=>M.participantId).filter(Boolean);(U=N==null?void 0:N.filter(({matchUpType:M,winningSide:C})=>C&&((d==null?void 0:d.eventType)!==lr||M===lr)).map(({winningSide:M,sides:C})=>M&&(C==null?void 0:C[1-(M-1)])).map(Ut).filter(M=>M&&!A.includes(M)))==null||U.forEach(M=>{h.includes(M)||h.push(M)})}let g=t==null?void 0:t.filter(T=>h==null?void 0:h.includes(T.participantId));return g==null||g.forEach(T=>{let D=(o.entries??[]).find(P=>P.participantId===T.participantId);T.entryPosition=D==null?void 0:D.entryPosition}),h!=null&&h.length?{validLuckyLosersAction:{type:fO,method:Kle,availableLuckyLosers:g,availableLuckyLoserParticipantIds:h,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:s}}}:{}}function Jue({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:m,event:h}){var S,w,U;let{drawId:f}=u,g=[],v,y,I=[],b=(w=(S=l==null?void 0:l[vs])==null?void 0:S.validSeedPositions)==null?void 0:w.ignore;if(b||({unplacedSeedParticipantIds:v,unplacedSeedAssignments:y,unfilledPositions:I}=gq({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:m,event:h})),I!=null&&I.length||(I=o.filter(T=>!T.participantId&&!T.bye&&!T.qualifier).map(T=>T.drawPosition)),d||g.push({payload:{drawId:f,structureId:m,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:eue,type:OS}),a&&b){let T=o.map(N=>N.participantId).filter(Boolean),D={structureIds:t},{completedMatchUps:P}=jg({inContext:!0,matchUpFilters:D,drawDefinition:u}),E=ct((U=(P??[]).filter(({matchUpType:N})=>(h==null?void 0:h.eventType)!==lr||N===lr))==null?void 0:U.map(({sides:N})=>N==null?void 0:N.map(Ut)).flat().filter(N=>N&&!T.includes(N))),R=s?n==null?void 0:n.filter(N=>E==null?void 0:E.includes(N.participantId)).map(N=>Ce(N,void 0,!0)):void 0;return R==null||R.forEach(N=>{let A=(u.entries??[]).find(M=>M.participantId===N.participantId);N.entryPosition=A==null?void 0:A.entryPosition}),R!=null&&R.length&&g.push(je({payload:{drawId:f,structureId:m,drawPosition:p},willDisableLinks:i,method:BB,type:Cm,availableParticipantIds:E,participantsAvailable:R})),{validAssignmentActions:g}}if(I.includes(p)||d){let T;if(y!=null&&y.length){let P=y.filter(E=>v==null?void 0:v.includes(E.participantId));P.sort(Xue),T=P.map(E=>E.participantId)}else T=e;let D=s?n==null?void 0:n.filter(P=>T.includes(P.participantId)).map(P=>Ce(P,void 0,!0)):void 0;D!=null&&D.length&&g.push(je({payload:{drawId:f,structureId:m,drawPosition:p},willDisableLinks:i,method:BB,type:Cm,availableParticipantIds:T,participantsAvailable:D}))}return{validAssignmentActions:g}}function Xue(t,e){return t.bye||Gf(t.seedValue)<Gf(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function Que({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var S,w,U;let u=[],c=[],d=[],p=[],m=i.map(T=>T.participantId).filter(Boolean),h=n==null?void 0:n[Dm],f=!(h!=null&&h.disableRoundRestrictions)&&t[o],g=h==null?void 0:h.requireCompletedStructures,{sourceStructureIds:v,relevantLinks:y}=HC({targetRoundNumber:f,linkType:Tu,drawDefinition:a,structureId:s})||{};v!=null&&v.length&&p.push(...v);let{sourceStructureIds:I,relevantLinks:b}=HC({targetRoundNumber:f,linkType:Su,drawDefinition:a,structureId:s})||{};I!=null&&I.length&&p.push(...I);for(let T of y){let D=(S=a.structures)==null?void 0:S.find(E=>E.structureId===T.source.structureId);if((D==null?void 0:D.stage)!==Ke)continue;let P=Cc({structureId:T.source.structureId,drawDefinition:a});if(!g||P){let E=D.qualifyingRoundNumber,{matchUps:R}=Wt({matchUpFilters:{roundNumbers:[E],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:D});for(let N of R){let A=N.sides.find(C=>(C==null?void 0:C.sideNumber)===N.winningSide),M=N.matchUpStatus===Vt&&((w=N.sides)==null?void 0:w.find(({participantId:C})=>C));if(A||M){let{participantId:C,participant:O}=A||M||{};C&&!m.includes(C)&&(O&&r&&u.push(O),c.push(C))}}}}for(let T of b){let D=(U=a.structures)==null?void 0:U.find(E=>E.structureId===T.source.structureId);if((D==null?void 0:D.stage)!==Ke)continue;let P=Cc({structureId:T.source.structureId,drawDefinition:a});if(!g||P){let{positionAssignments:E}=oi({structure:D}),R=(E==null?void 0:E.map(N=>{var C;let A=N.participantId,M=(C=vt({element:N,name:Tc}).extension)==null?void 0:C.value;return M?{participantId:A,groupOrder:M==null?void 0:M.groupOrder}:{}}).filter(({groupOrder:N,participantId:A})=>N===1&&!m.includes(A)).map(({participantId:N})=>N))??[];if(R&&c.push(...R),r){let N=e.filter(({participantId:A})=>R.includes(A));u.push(...N)}}}return c.length&&d.push(je({qualifyingParticipants:r?u:void 0,method:Wle,type:HT,qualifyingParticipantIds:c,payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function Zue({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:m,event:h}){if(n.includes(c))return{};let f=P=>!t||P.participantId||P.qualifier||P.bye,g=r==null?void 0:r.filter(P=>P!==c&&!(u&&s.includes(P))),v=(a==null?void 0:a.filter(P=>f(P)&&(g==null?void 0:g.includes(P.drawPosition))))??[],y=v.map(({drawPosition:P})=>P),{matchUps:I}=Wt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:h}),b=I.filter(({drawPositions:P})=>Rn(P,y)),S=Object.assign({},...b.map(P=>{var E;return(E=P.sides)==null?void 0:E.filter(({sourceDrawPositionRange:R})=>R).map(({drawPosition:R,sourceDrawPositionRange:N})=>({[R]:N}))}).flat()),w=v.map(P=>P.participantId).filter(Boolean),U=(i??[]).filter(P=>w.includes(P.participantId)),T=Object.assign({},...U.map(P=>({[P.participantId]:P}))),D=v.map(P=>{let E=T==null?void 0:T[P.participantId],R=S[P.drawPosition];return je({...P,participant:o?Ce(E,!1,!0):void 0,sourceDrawPositionRange:R})});return D.length?{validSwapAction:{payload:{drawId:m,structureId:d,drawPositions:[c]},willDisableLinks:e,method:Bq,type:zT,availableAssignments:D}}:{}}function xO(t){var z;let e=ze(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:o,drawPosition:s,event:l}=t,u=t.tournamentParticipants??(a&&Mi({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],c=it({structureId:t.structureId,drawDefinition:o});if(c.error)return c;let d=c.containingStructure||c.structure;if(!d)return{error:Ci};let p=d.structureId;if(c=ub({drawDefinition:o,structureId:p}),s===void 0&&!c.isAdHoc)return{error:Eg};if(c.isAdHoc)return QT(t);if(c.error)return c;let{drawPositionInitialRounds:m,inactiveDrawPositions:h,activeDrawPositions:f,byeDrawPositions:g}=c,v=$t({tournamentRecord:a,drawDefinition:o,structure:d,event:l}).appliedPolicies??{};Object.assign(v,i??{});let{actionsPolicy:y,enabledStructures:I,actionsDisabled:b}=T3({actionType:$U,appliedPolicies:v,drawDefinition:o,structure:d}),S=(y==null?void 0:y.activePositionOverrides)||[],{sourceStructureIds:w}=HC({finishingPosition:kd,targetRoundNumber:1,linkType:Su,drawDefinition:o,structureId:p})||{},U;w!=null&&w.length&&(U=w.every(W=>Cc({structureId:W,drawDefinition:o})));let T=w.length,D=w.length&&!U,{policyActions:P}=D3({enabledStructures:I,drawDefinition:o,structure:d}),E=![Ke,Oe].includes(d.stage)||d.stageSequence!==1,{drawId:R}=o,N=[],{assignedPositions:A,positionAssignments:M}=Er({structure:d}),C=A==null?void 0:A.find(W=>W.drawPosition===s),O=!!C;if(!((z=M==null?void 0:M.map(W=>W.drawPosition))!=null&&z.includes(s)))return{error:Rg};let{stage:k,stageSequence:x}=d,F=[k];k===rn&&F.push(Oe),k===Oe&&F.push(rn);let $=rh({entryStatuses:gp,provisionalPositioning:n,drawDefinition:o,stageSequence:x,structureId:p,stages:F}),_=Ip({drawDefinition:o,stages:F}).assignedParticipantIds??[],L=$.filter(W=>!_.includes(W.participantId)).map(W=>W.participantId),B=g.includes(s),V=f.includes(s);if(b)return{info:"Actions Disabled for structure",isActiveDrawPosition:V,isDrawPosition:!0,hasPositionAssigned:O,validActions:[],isByePosition:B};if(Zn({policyActions:P,action:Cm})&&!V&&M&&!D&&(!C||B)){let{validAssignmentActions:W}=Jue({positionSourceStructureIds:w,unassignedParticipantIds:L,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,positionAssignments:M,returnParticipants:r,appliedPolicies:v,drawDefinition:o,isByePosition:B,drawPosition:s,structureId:p,event:l});W==null||W.forEach(q=>N.push(q))}if(Zn({policyActions:P,action:HT})&&!V){let{validAssignmentActions:W}=Que({drawPositionInitialRounds:m,tournamentParticipants:u,positionAssignments:M,returnParticipants:r,appliedPolicies:v,drawDefinition:o,drawPosition:s,structureId:p,drawId:R});W==null||W.forEach(q=>N.push(q))}let{participantId:G}=C||{},j=G&&u.find(W=>W.participantId===G);if(C){Zn({policyActions:P,action:GC})&&!V&&(N.push({type:GC,method:$B,payload:{drawId:R,structureId:p,drawPosition:s},willDisableLinks:E}),B||N.push({type:hO,method:qle,payload:{drawId:R,structureId:p,drawPosition:s},willDisableLinks:E}),Zn({policyActions:P,action:OS})&&!B&&N.push({type:OS,method:$B,payload:{drawId:R,structureId:p,drawPosition:s,replaceWithBye:!0},willDisableLinks:E}));let W=d.stage===Ke||d.stage===Oe&&d.stageSequence===1;if(!B&&YB({activePositionOverrides:S,activeDrawPositions:f,action:eI})&&Zn({policyActions:P,action:eI})&&CS({drawDefinition:o,structureId:p,drawPosition:s})&&W){let{seedAssignments:q}=ho({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:Y,seedValue:re}=(q==null?void 0:q.find(J=>J.participantId===G))??{};N.push({type:eI,method:tue,participant:j,seedNumber:Y,payload:{drawId:R,structureId:p,participantId:G,seedValue:re}})}if(!B&&YB({activePositionOverrides:S,activeDrawPositions:f,action:_U})&&Zn({policyActions:P,action:_U})&&CS({drawDefinition:o,structureId:p,drawPosition:s})&&W){let{seedAssignments:q}=ho({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:Y}=(q==null?void 0:q.find(re=>re.participantId===G))??{};N.push({method:Zle,type:_U,participant:j,seedNumber:Y,payload:{participantId:G,structureId:p,drawId:R}})}if(!B&&G){if(Zn({policyActions:P,action:zf})){let q={type:zf,method:Vq,participant:j,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:R}};N.push(q)}if(Zn({policyActions:P,action:AS})){let q={type:AS,method:Qle,participant:j,payload:{participantId:G,otherName:void 0}};N.push(q)}}if(Zn({policyActions:P,action:zT})){let{validSwapAction:q}=Zue({possiblyDisablingAction:E,tournamentParticipants:u,inactiveDrawPositions:h,activeDrawPositions:f,positionAssignments:M,returnParticipants:r,byeDrawPositions:g,drawDefinition:o,isByePosition:B,drawPosition:s,structureId:p,structure:d,drawId:R});q&&N.push(q)}}if(Zn({policyActions:P,action:mO})&&!D){let{validAlternatesAction:W}=Wue({possiblyDisablingAction:E,tournamentParticipants:u,positionAssignments:M,activeDrawPositions:f,returnParticipants:r,appliedPolicies:v,drawDefinition:o,drawPosition:s,validActions:N,structureId:p,structure:d,drawId:R,event:l});W&&N.push(W)}if(Zn({policyActions:P,action:fO})&&!D&&!V&&M){let{validLuckyLosersAction:W}=Kue({sourceStructuresComplete:U,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,activeDrawPositions:f,positionAssignments:M,drawDefinition:o,drawPosition:s,structureId:p,structure:d,drawId:R});W&&N.push(W)}if((j==null?void 0:j.participantType)===ft&&Zn({policyActions:P,action:pO})){let{validModifyAssignedPairAction:W}=Bue({tournamentParticipants:u,returnParticipants:r,drawPosition:s,participant:j,drawId:R,event:l});W&&N.push(W)}return{isActiveDrawPosition:V,isDrawPosition:!0,hasPositionAssigned:O,isByePosition:B,validActions:N,...X}}function Rb({policyDefinitions:t,appliedPolicies:e,drawType:i}){var a,o;let r=(a=t==null?void 0:t[bS])==null?void 0:a.drawTypeCoercion,n=(o=e==null?void 0:e[bS])==null?void 0:o.drawTypeCoercion;return(typeof r=="boolean"?r:void 0)??(i&&(r==null?void 0:r[i]))??(typeof n=="boolean"?n:void 0)??(i&&(n==null?void 0:n[i]))??!0}function BI({tournamentRecord:t,drawDefinition:e,stage:i=Oe,structureId:r,structure:n}){var s;if(!t)return{error:ge};if(!n&&!e)return{error:Le};if(!n&&!r&&((s=e==null?void 0:e.structures)==null?void 0:s.filter(l=>l.stage===i).length)===1&&(n=e.structures.find(l=>l.stage===i)),!n&&!r)return{error:Wa};let{error:a,positionAssignments:o}=oi({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:o??[],structureId:n==null?void 0:n.structureId,error:a}}function FO({structureId:t,drawDefinition:e}){if(!e)return{error:Le};if(!Di(t))return{error:se};let i=Vg({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!Vi([Od,_o,lT,Ad],r).length;return{...X,valid:n}}function k3({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:se};let i=Pg(t);return i?{drawSize:i}:ee({result:{error:se},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function Eb(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:o,event:s}=t||{},l="getSeedsCount",u=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let h=qu({tournamentRecord:a,drawDefinition:o,event:s});if(h.error)return ee({result:h,stack:l});i=h.policyDefinitions}let c=ot(u);if(u&&!c)return ee({result:{error:se},context:{participantsCount:u},stack:l});if(n&&!c)return ee({result:{error:rH},stack:l});if(isNaN(r))if(u)({drawSize:r}=k3({participantsCount:u}));else return ee({result:{error:Ny},stack:l});let d=n&&u||r;if(d&&d>r)return{error:TN};let p=i==null?void 0:i[vs];if(!p)return{error:zG};let m=p.seedsCountThresholds;return m?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:m.filter(h=>e?h.drawSize<=r:r===h.drawSize).reduce((h,f)=>u&&u>=f.minimumParticipantCount?f.seedsCount:h,0)}):{error:CG}}function ZT({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:o,event:s}){var v;if((!o||!n)&&i&&({participants:o,participantMap:n}=Mi({tournamentRecord:i})),!o)return{error:Oy};if(!Array.isArray(o))return{error:se};if(!s)return{error:vi};let l=(e==null?void 0:e[kr])??(r==null?void 0:r[kr])??Hg[kr],u=(a??((v=l==null?void 0:l.participants)==null?void 0:v.enforceGender))!==!1,{eventType:c,gender:d}=s,p=c===Uu,m=c===Ta&&Kt||p&&ft||St,h=Object.assign({},...(t??s.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),f=Object.keys(h),g=o.filter(y=>f.includes(y.participantId)).filter(y=>{let I=ece({participant:y,participantType:m,eventType:c,entryStatusMap:h}),b=tce({genderEnforced:u,participantMap:n,eventGender:d,participant:y,isDoubles:p,mismatch:I});return I||!b});if(g.length){let y=g.map(I=>I.participantId);return{error:_G,invalidParticipantIds:y}}return{...X,valid:!0}}function ece({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[Uu,Ta].includes(i)&&t.participantType===St&&(fd(n)||n===Eu);return t.participantType!==e&&!a}function tce(t){var d,p,m;let{participant:e,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:o}=t,s=!n&&a&&ct(((d=e==null?void 0:e.individualParticipantIds)==null?void 0:d.map(h=>{var f,g,v;return(v=(g=(f=i==null?void 0:i[h])==null?void 0:f.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],l=!r||!(s!=null&&s.length)||Ms===r||[Xt,mi].includes(r)&&s[0]===r||Bn===r&&(s.length===1&&((p=e.individualParticipantIds)==null?void 0:p.length)===1||s.length===2),u=(m=e==null?void 0:e.person)==null?void 0:m.sex,c=!(e!=null&&e.person)||!r||[Ms,Bn].includes(r)||[Xt,mi].includes(r)&&u===r;return!o||l&&c}function x3({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:r,uuids:n}){var f;let a="generateQualifyingSTructures",o=[],s=[],l=[],u=(g,v)=>g.stageSequence-v.stageSequence,c=(g,v)=>g.roundTarget-v.roundTarget,d=0,p=0,m,h=1;for(let g of t.sort(c)){let v=g.structureProfiles||[];h=g.roundTarget||h;let y=1,I=0,b,S,w;for(let U of(v||[]).sort(u)){let T=sN(U.drawSize||U.participantsCount),{qualifyingRoundNumber:D,structureOptions:P,matchUpFormat:E,structureName:R,structureId:N,drawType:A}=U,M=U.matchUpType,C=U.qualifyingPositions||ice({drawSize:T,qualifyingRoundNumber:D}),O,k,x;if(!ot(T))return ee({result:{error:Ny},stack:a});let F=t.length>1?`${h}-`:"",$=v.length>1||F?y:"",_=R||(F||$?`${Zr(Ke)} ${F}${$}`:Zr(Ke));if(A===es){let{structures:L,groupCount:B,maxRoundNumber:V}=hb({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),stage:Ke,structureOptions:P,appliedPolicies:e,stageSequence:y,matchUpType:M,roundTarget:h,drawSize:T,idPrefix:i,isMock:r,uuids:n});I=B,O=V,k=L[0],m=[1]}else({drawSize:T,matchUps:x,roundLimit:O}=sl({qualifyingRoundNumber:D,qualifyingPositions:C,matchUpType:M,drawSize:T,idPrefix:i,isMock:r,uuids:n})),k=so({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),qualifyingRoundNumber:O,stage:Ke,matchUpFormat:E,stageSequence:y,matchUpType:M,roundLimit:O,matchUps:x}),h&&Lt({extension:{name:yl,value:h},element:k}),I=((f=x==null?void 0:x.filter(L=>L.roundNumber===O))==null?void 0:f.length)||0;if(y>1){let{link:L}=Ib({sourceStructureId:S,sourceRoundNumber:b,targetStructureId:k.structureId,finishingPositions:w===Su?[1]:void 0,linkType:w});l.push(L),d+=(T||0)-I}else d+=T||0;w=A===es?Su:Tu,S=k.structureId,b=O,s.push(k),y+=1}p+=I,o.push({qualifiersCount:I,finalQualifyingRoundNumber:b,finalQualifyingStructureId:S,finishingPositions:m,roundTarget:h,linkType:w}),h+=1}return{qualifiersCount:p,qualifyingDrawPositionsCount:d,qualifyingDetails:o,structures:s,...X,links:l}}function ice({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function F3(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=et(t.drawSize),n=e&&t.drawType!==_a&&(typeof e=="boolean"||e<=2)&&r===2&&Ys||t.drawType||Ys,a=Lz.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=Ys;else if(r<4&&i)return{...ee({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:V0},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function rce(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:Zr(Oe),...t,stage:Oe},{structures:a,groupCount:o,groupSize:s}=hb(n);if(o<1)return{error:wH};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:Zr($i)}],[u]=a,{structures:c,links:d}=Qq({sourceStructureId:u.structureId,requireSequential:r,drawDefinition:e,playoffGroups:l,groupCount:o,groupSize:s,...t});return c&&a.push(...c),{...X,structures:a,links:d}}function nce({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),n=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),o=r.map((u,c)=>{let d=r.indexOf(u)%2?_o:Od,p=1+c;return{linkType:Gl,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),s={linkType:Tu,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:_o,roundNumber:n,structureId:t.structureId}},l=[{linkType:Tu,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:_o,roundNumber:1,structureId:i.structureId}},{linkType:Gl,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:_o,roundNumber:1,structureId:i.structureId}}];return[...o,s,...l]}function ace({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let o=[],{matchUps:s}=Mc({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=Ic({structureName:t||Zr(Oe),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:Oe,matchUpType:e,matchUps:s});o.push(l);let u=r/2,{matchUps:c}=Mc({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=Ic({structureName:Zr(Fz),matchUps:c,structureId:a==null?void 0:a.pop(),stage:rn,stageSequence:2,matchUpType:e});o.push(d);let{matchUps:p}=sl({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),m=Ic({structureName:Zr(xz),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:$i,matchUpType:e});o.push(m);let h=nce({mainStructure:l,consolationStructure:d,deciderStructure:m});return{structures:o,links:h,...X}}function oce(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:o,isMock:s,uuids:l}=t;if(!ot(o)||o<2)return{matchUps:[],roundsCount:0};if(Rs(o))return sl(t);let u=sce(o),c=u.shift(),d=Te(1,((c==null?void 0:c.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],m=1;({matchUps:p}=kS({roundNumber:m,matchUpType:n,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:l})),m++;let h=t.roundLimit||e;for(let g of u){let v=g.participantsCount/2,y=Te(1,v+1);r&&v===r&&(h=m-1);let I=y.map(b=>{let S=gO({roundPosition:b,roundNumber:m,idPrefix:a,uuids:l});return{roundPosition:b,roundNumber:m,matchUpId:S}});p.push(...I),m++}let f=m-1;return p=sb({finishingPositionOffset:i,lucky:!0,roundsCount:f,roundLimit:h,matchUps:p}),h&&(p=p.filter(g=>g.roundNumber<=h)),{matchUps:p,roundsCount:f,roundLimit:h}}function sce(t){let e=et(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),o=a===1,s=!!(!o&&a%2);i=!o&&s?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:s})}return n}function L3(t){var m,h;let{playoffAttributes:e,stageSequence:i=1,stage:r=Oe,matchUpType:n,drawSize:a,uuids:o}=t,s=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,l=t.structureId||s()||(o==null?void 0:o.pop()),u=t.appliedPolicies??$t(t),c=((m=t.policyDefinitions)==null?void 0:m[$f])||(u==null?void 0:u[$f]);t.skipRounds=t.skipRounds||a<=4&&(c!=null&&c.feedFromMainFinal?0:1)||0;let d=t.structureName??((h=e==null?void 0:e["0"])==null?void 0:h.name)??Zr(Oe),p=()=>{let{matchUps:f}=sl(t);return{structures:[so({stageSequence:i,structureName:d,matchUpType:n,structureId:l,matchUps:f,stage:r})],links:[],...X}};return{generators:{[_a]:()=>({structures:[so({finishingPosition:kd,stageSequence:i,structureName:d,matchUps:[],matchUpType:n,structureId:l,stage:r})],links:[],...X}),[cp]:()=>{let{matchUps:f}=oce(t);return{structures:[so({stageSequence:i,structureName:d,matchUpType:n,structureId:l,matchUps:f,stage:r})],links:[],...X}},[Ys]:()=>p(),[$y]:()=>ace(t),[kf]:()=>wf({...t,roundOffsetLimit:3,playoffAttributes:e??JN}),[xf]:()=>wf({...t,roundOffsetLimit:2,playoffAttributes:e??XN}),[$i]:()=>wf(t),[xg]:()=>{let{matchUps:f}=Mc({drawSize:a,uuids:o,matchUpType:n});return{structures:[so({stageSequence:i,structureName:d,matchUpType:n,structureId:l,stage:Oe,matchUps:f})],links:[],...X}},[By]:()=>Kq(t),[Ff]:()=>jp({...t,feedRounds:1,fmlc:!0}),[kz]:()=>jp({...t,feedRounds:1}),[qN]:()=>jp({...t,feedsFromFinal:1}),[YN]:()=>jp({...t,feedsFromFinal:2}),[KN]:()=>jp({...t,feedsFromFinal:3}),[Vy]:()=>jp(t),[uT]:()=>Xq(t),[es]:()=>hb(t),[Hl]:()=>rce(t)}}}function LO(t){var _,L,B,V,G;let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:r,staggeredEntry:n,drawDefinition:a,tieFormat:o,isMock:s,uuids:l}=t||{},u=et(t.drawSize),c=t.drawTypeCoercion??Rb({appliedPolicies:r,drawType:t.drawType}),d="generateDrawStructuresAndLinks",p=F3({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:c,drawSize:u});if(p.error)return p;let m=p.drawType,h=[],f=[],g=(t==null?void 0:t.matchUpType)??ii,v=(_=a==null?void 0:a.structures)==null?void 0:_.filter(({stage:j})=>j===Ke);v&&h.push(...v);let y=v==null?void 0:v.map(({structureId:j})=>j),I=(L=a==null?void 0:a.structures)==null?void 0:L.find(({stage:j,stageSequence:z})=>j===Oe&&z===1),b=(B=a==null?void 0:a.links)==null?void 0:B.filter(j=>j.target.structureId===(I==null?void 0:I.structureId)&&(y==null?void 0:y.includes(j.source.structureId))),S=(j,z)=>{var W;if(j.linkType===Su&&(z!=null&&z.structures)){let q=j.source.finishingPositions||[];return z.structures.length*q.length}else if(j.linkType===Tu&&((W=z==null?void 0:z.matchUps)!=null&&W.length)){let q=j.source.roundNumber;return z.matchUps.filter(({roundNumber:Y})=>Y===q).length}},w=v==null?void 0:v.map(j=>{var J,H,Z;let z=b==null?void 0:b.find(K=>K.target.structureId===j.structureId),W=((H=(J=oi({structure:j}))==null?void 0:J.positionAssignments)==null?void 0:H.length)??0;if(!z)return W;let q=z==null?void 0:z.source.structureId,Y=(Z=a.structures)==null?void 0:Z.find(K=>K.structureId===q),re=S(z,Y)||0;return W-re}).filter(Boolean).reduce((j,z)=>j+z,0),U=b==null?void 0:b.map(j=>{let z=j.source.structureId,W=v==null?void 0:v.find(q=>q.structureId===z);return S(j,W)}).filter(Boolean).reduce((j,z)=>j+z,0),T=!!(I&&!((V=I==null?void 0:I.matchUps)!=null&&V.length));if(v!=null&&v.length&&!T)return{error:SC};let D=!(v!=null&&v.length)&&t.qualifyingProfiles,P=(D==null?void 0:D.length)&&x3({idPrefix:t.idPrefix,qualifyingProfiles:D,appliedPolicies:r,isMock:s,uuids:l});if(P!=null&&P.error)return P;let{qualifyingDrawPositionsCount:E,qualifyingDetails:R,qualifiersCount:N}=P||{qualifyingDrawPositionsCount:w,qualifiersCount:U};E&&(P!=null&&P.structures&&h.push(...P.structures),P!=null&&P.links&&f.push(...P.links)),Object.assign(t,je({drawSize:u,matchUpType:g,tieFormat:o}));let A=m!==_a&&(!u||u<2||!n&&![xg,cp].includes(m)&&([Hl,es].includes(m)&&u<3||![es,Hl].includes(m)&&!Rs(u)));if(A&&!E)return ee({context:{drawSize:u,invalidDrawSize:A},result:{error:V0},stack:d});let{generators:M,error:C}=L3(t);if(C)return{error:C};let O=M[m];if(!O)return{error:dN};let k=O==null?void 0:O();if(k.error)return k;let{structures:x,links:F}=k;if(x!=null&&x.length){let j=x.find(({stage:z,stageSequence:W})=>z===Oe&&W===1);if(I&&j){if(T){let z=j.structureId;if(j.structureId=I.structureId,F==null?void 0:F.length)for(let W of F)W.source.structureId===z&&(W.source.structureId=I.structureId),W.target.structureId===z&&(W.target.structureId=I.structureId)}else if(!i)return{error:SC}}h.push(...x)}h.sort(ih),F!=null&&F.length&&f.push(...F);let $=k.structures.find(({stage:j,stageSequence:z})=>j===Oe&&z===1);for(let j of R||[]){let{finalQualifyingRoundNumber:z,finalQualifyingStructureId:W,roundTarget:q,finishingPositions:Y,linkType:re}=j,J=$&&((G=Ib({targetStructureId:$.structureId,sourceStructureId:W,sourceRoundNumber:z,finishingPositions:Y,targetEntryRound:q,linkType:re}))==null?void 0:G.link);if(J!=null&&J.error)return J;J&&f.push(J)}return b&&f.push(...b),{...X,qualifyingResult:{qualifyingDrawPositionsCount:E,qualifiersCount:N},structures:h,links:f}}function _O(t){var I,b;let{modifyOriginal:e=!0,stageSequence:i=1,isMock:r}=t||{},n="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return ee({result:{error:Le},stack:n});let a=e?t.drawDefinition:Ce(t.drawDefinition,!1,!0),{tieFormat:o,matchUpType:s}=t;if(o){let S=Hn({tieFormat:o});if(S.error)return S}o=qr(o??((I=vn({drawDefinition:a}))==null?void 0:I.tieFormat)),s=s??(a.matchUpType||ii),t.tieFormat=o,t.matchUpType=s;let l=ES({drawDefinition:a,stage:Oe});t.drawSize=t.drawSize??l,!l&&t.drawSize&&NS({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:Oe});let u=sn({drawDefinition:a}).drawMatchUps.map(Dr),c=LO(t);if(c.error)return ee({result:c,stack:n});let{structures:d,links:p,qualifyingResult:m}=c;a.structures=d,a.links=p;let h=Math.max(t.qualifiersCount??0,(m==null?void 0:m.qualifiersCount)||0);if(m!=null&&m.qualifyingDrawPositionsCount&&!ES({stage:Ke,drawDefinition:a})){let S=NS({drawSize:m.qualifyingDrawPositionsCount,stage:Ke,drawDefinition:a});if(S.error)return S}if(h){let S=_q({qualifiersCount:h,drawDefinition:a,stage:Oe});if(S.error)return S}let f=t.drawSize??l;Object.assign(t,je({drawSize:f,matchUpType:s,tieFormat:o}));let{matchUps:g,matchUpsMap:v}=hr({drawDefinition:a});o&&(g==null||g.forEach(S=>{if(!u.includes(S.matchUpId)){let{tieMatchUps:w}=bb({tieFormat:o,matchUp:S,isMock:r});Object.assign(S,{tieMatchUps:w,matchUpType:s})}}));let{inContextDrawMatchUps:y}=$d({drawDefinition:a,matchUpsMap:v});return li({tournamentId:(b=t.tournamentRecord)==null?void 0:b.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:y,drawDefinition:a,matchUpsMap:v,...X,structures:d,matchUps:g,links:p}}function Cb(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,o;if(!$3({scaleItem:n}))return{error:bm};if(r&&Array.isArray(i.participants)&&(o=i.participants.find(s=>s.participantId===r),o)){if(o.participantType===Vn&&(n==null?void 0:n.eventType)!==Ta)return{error:bm};let s=B3({removePriorValues:e,participant:o,scaleItem:n});if(s.error)return s;a=!s.valueChanged;let{topics:l}=yo();l.includes(nn)&&lt({topic:nn,payload:{tournamentId:i.tournamentId,participants:[o]}})}return a&&{...X,info:AN,existingValue:n==null?void 0:n.scaleValue}||o&&{...X,newValue:n==null?void 0:n.scaleValue}||{error:zi}}function _3(t){var d;let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=t;if(!r)return{error:ge};if(!r.participants)return{error:Oy};let o=0,s={},l=[];for(let p of e){let m=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let h of p.scaleItems)if($3({scaleItem:h}))Array.isArray(s[m])||(s[m]=[]),s[m].push(h);else return{error:bm}}for(let p of r.participants){let{participantId:m}=p||{};if(Array.isArray(s[m]))for(let h of s[m]){if(p.participantType===Vn&&(h==null?void 0:h.eventType)!==Ta)return ee({context:{participantId:m,scaleItem:h,participantType:p.participantType},info:"Invalid participantType for eventType",result:{error:bm}});B3({participant:p,scaleItem:h,removePriorValues:i}),l.push(p),o++}}let u=o?void 0:Og,{topics:c}=yo();if(c.includes(nn)&&o&&lt({topic:nn,payload:{tournamentId:r.tournamentId,participants:l}}),a){let{eventId:p,drawId:m,...h}=a,f=((d=h.scaleAttributes)==null?void 0:d.scaleType)&&[h.scaleAttributes.scaleType];if(Object.keys(h).length){let g={itemType:gA,itemValue:h};if(f&&(g.itemSubTypes=f),m||p){let{drawDefinition:v,event:y}=Wn({tournamentRecord:r,eventId:p,drawId:m});m&&dO({drawDefinition:v,timeItem:g}),p&&fh({event:y,timeItem:g})}else Db({tournamentRecord:r,timeItem:g})}}return n&&c.includes(gu)&&lt({topic:gu,payload:n}),je({...X,modificationsApplied:o,info:u})}function $3({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e==null?void 0:e.includes(r)).length===i.length}function B3({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:Km};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(u=>r.includes(u)&&i[u]).length!==n.length)return{error:bm};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:o}=Al({scaleAttributes:i,participant:e}),s=u=>[void 0,null,""].includes(u),l=!(s(o==null?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o==null?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[xd,u,c,d].join("."),m=je({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(m.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(h=>h.itemType!==p)),e.timeItems.push(m)}return{...X,valueChanged:l,newValue:i.scaleValue}}function $O(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=ze(t,[{[wr]:!0},{modifiedScaleValues:!0,[Jn]:ta}]);if(n.error)return n;for(let a in i){let o=Cb({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(o.error)return o}return{...X}}function Wf(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:mr};let{participant:a,tournamentId:o}=Yc({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...Al({participant:a,scaleAttributes:i}),tournamentId:o}:{error:zi}}var lce=(t=0)=>250/Math.pow(t+5,.4),uce=()=>1;function cce(t=3,e=2){let i=t/e;return isNaN(i)?sf.kDefault():i}var sf={nSpread:400,diffThreshold:.125,kCalc:lce,kMultiplier:cce,kDefault:uce};function V3(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=Nr,winnerCountables:n=1,loserCountables:a=0,ratingType:o=Fo,maxCountables:s,countables:l}=t||{},u=r==null?void 0:r[o];if(!u)return{error:Xe};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,m=d?c.slice().reverse():c,h=(C,O)=>parseFloat(O)>=Math.min(...C)&&parseFloat(O)<=Math.max(...C);(!h(c,e)||!h(c,i))&&(h(c,e)||(e=u.defaultInitialization),h(c,i)||(i=u.defaultInitialization));let f=cf({targetRange:Nr[Fo].range,sourceRange:m,value:d?c[0]-e:e}),g=cf({targetRange:Nr[Fo].range,sourceRange:m,value:d?c[0]-i:i}),v=(C,O)=>1/(1+Math.pow(10,(O-C)/sf.nSpread)),y=v(f,g),I=v(g,f),b=sf.kCalc(n),S=sf.kCalc(a),w=sf.kMultiplier(s,l),U=f+w*b*(1-y),T=g+w*S*(0-I),D=cf({sourceRange:Nr[Fo].range,value:U,targetRange:m}),P=cf({sourceRange:Nr[Fo].range,value:T,targetRange:m}),E=d?c[0]-D:D,R=parseFloat(E.toFixed(p)),N=d?c[0]-P:P,A=parseFloat(N.toFixed(p)),M=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(D>P&&M>sf.diffThreshold||R<0||A<0)&&(R=e,A=i),{newWinnerRating:R,newLoserRating:A}}var dce=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function j3(t){var y,I;let e=ze(t,[{[wr]:!0},{matchUpIds:!0,[Jn]:cn,[jo]:Wm},{ratingType:!1,[Kr]:b=>Nr[b]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a=Fo,refreshDynamic:o,considerGames:s,drawDefinition:l,matchUpIds:u,asDynamic:c}=t,d=Nr[a],{accessor:p}=d,m={},h=(t.matchUps||o&&Sn({drawDefinition:l,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:vr}}).matchUps||Vr({matchUpFilters:{matchUpIds:u,matchUpStatuses:vr},tournamentRecord:n,inContext:!0}).matchUps)??[],f=`${a}.${oA}`,g=c?f:a;h.sort(ch);for(let b of h){let{endDate:S,matchUpFormat:w,score:U,sides:T,winningSide:D}=b,P=b.matchUpType,E={eventType:P,scaleName:a,scaleType:vc},R={scaleName:f,eventType:P,scaleType:vc},N=Object.assign({},...(T??[]).map(_=>{let{sideNumber:L,participant:B}=_;return L&&{[L]:[B==null?void 0:B.participantId,...(B==null?void 0:B.individualParticipantIds)??[]].filter(Boolean).flat()}})),A=Object.assign({},...Object.values(N).flat().map(_=>{let L=m[_],B=!o||L?Wf({scaleAttributes:R,tournamentRecord:n,participantId:_}).scaleItem:void 0,V=Wf({tournamentRecord:n,scaleAttributes:E,participantId:_}).scaleItem,G=p?{[p]:void 0}:void 0;return _&&{[_]:B??V??{scaleName:g,eventType:P,scaleDate:S,scaleType:vc,scaleValue:G}}})),M=w?kn(w):{},C=(M==null?void 0:M.bestOf)||1,O=(M==null?void 0:M.setsTo)||1,k=s?C&O:C,x=(U==null?void 0:U.sets)&&dce(U.sets)||D===1&&[1,0]||[0,1],F=D?N[D]:[],$=D?N[3-D]:[];for(let _ of F){let L=(y=A[_])==null?void 0:y.scaleValue,B=typeof L=="object"?L[p]:L;for(let V of $){let G=(I=A[V])==null?void 0:I.scaleValue,j=typeof G=="object"?G[p]:G,z=D?x[D]:[0,0],W=D?x[3-D]:[0,0],{newWinnerRating:q,newLoserRating:Y}=V3({winnerCountables:z,loserCountables:W,maxCountables:k,winnerRating:B,loserRating:j,ratingType:a}),re=p?{...L,[p]:q}:q,J=p?{...G,[p]:Y}:Y;A[_].scaleValue=re,A[V].scaleValue=J,A[_].scaleName=g,A[V].scaleName=g}}Object.assign(m,A),i&&$O({tournamentRecord:n,modifiedScaleValues:m,removePriorValues:r})}let v=h.map(({matchUpId:b})=>b);return{...X,modifiedScaleValues:m,outputScaleName:g,processedMatchUpIds:v}}function eD(t){var g;let{matchUpIds:e=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:o}=t;if(typeof i!="object")return{error:Le};let{participantIdPairings:s,matchUpsCount:l}=t,u=XT(t);if(u.error)return ee({result:u});let{lastRoundNumber:c,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=u;if(!l)n?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return ee({result:{error:se,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(s&&!Array.isArray(s)||l&&!ot(l)||e&&!Array.isArray(e)||!s&&!l)return{error:se,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:se,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(c||0))return{error:se,info:"roundNumber error"};let m=r??(n&&(c??0)+1||c||1);s=s??Te(0,l).map(()=>({participantIds:[void 0,void 0]}));let h=v=>{if(!t.idPrefix)return;let y=i.drawId,I=t.idPrefix??"ah";return`${y}-${I}-${m}-${v}`},f=s==null?void 0:s.map((v,y)=>{let I=(v==null?void 0:v.participantIds)??[void 0,void 0];I.push(void 0,void 0);let b=I.slice(0,2).map((w,U)=>je({sideNumber:U+1,participantId:w})),S=e[y]??h(y)??Gt();return{roundNumber:m,matchUpStatus:Xi,matchUpId:S,sides:b}});if(f!=null&&f.length){let v=(g=vn({drawDefinition:i,event:o}))==null?void 0:g.tieFormat;v&&f.forEach(y=>{let{tieMatchUps:I}=bb({tieFormat:v,matchUp:y,isMock:a});Object.assign(y,{tieMatchUps:I,matchUpType:fi})})}return{roundNumber:m,matchUpsCount:(f==null?void 0:f.length)??0,matchUps:f,...X}}function pce({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),o=Object.keys(i),s=[],l=JB({actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),u=[gE(l)];s.push(l);let c=l.value,d=l,p=1,m=0,h=o.length,f;do h-=1,f=o.length*i[o[0]].length;while(f>t&&h>5);let g=[];o.forEach(y=>{i[y].slice(0,h).forEach(I=>{m+=1;let b=im(y,I.opponent);if(!g.includes(b)){let S=JB({stipulated:[[y,I.opponent]],actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!u.includes(gE(S))){u.push(gE(S)),s.push(S);let{maxDelta:w,value:U}=S;w<d.maxDelta&&(d=S),(U<c||U===c&&Math.round(Math.random()))&&(c=U),g.push(b),p+=1}}}),s=s.filter(I=>Math.abs(I.value-c)<5)}),s.sort((y,I)=>y.maxDiff-I.maxDiff);let v=ga(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:m,candidate:v}}function gE(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function JB({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let o=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,m]=d,h=im(p,m),f=i[h];s.push({participantIds:d,value:f}),l+=i[h]}),Rr(t,a).map(d=>wn(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((m,h)=>o.includes(h)||m,!1)){o.push(...p);let m=d.value;l+=m,s.push({participantIds:p,value:m})}}),s.sort((d,p)=>d.value-p.value);let u=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=im(m,h),g=r[f];return g>d?g:d},0),c=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=im(m,h),g=n[f];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:u,maxDiff:c}}function im(t,e){return[t,e].sort(_T).join("|")}function G3({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let o=im(a,n);i.includes(o)||i.push(o)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function mce({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(Ut);if(r.length===2){let[n,a]=r,o=im(n,a);e.includes(o)||e.push(o)}}return{encounters:e}}function hce({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(o=>r(n,o));i[n]=a.sort((o,s)=>o.value-s.value)}function r(n,a){let o=im(n,a);return{opponent:a,value:e[o]}}return{pairingValues:i}}var fce=0;function gce({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){var o;let a=((o=Nr[r])==null?void 0:o.defaultInitialization)??fce;return n.split("|").map(s=>{var l;if(i===po){let u=(l=t==null?void 0:t.find(c=>c.participantId===s))==null?void 0:l.individualParticipantIds;return u?u==null?void 0:u.map(c=>e[c]||a):a*2}else return e[s]||a})}function vce(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:o,deltaObjects:s,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;n.forEach(I=>{let b=gce({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:I}),S=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?S:S*-1)||0,U=Math.abs(b[0]-b[1])+w,T=Math.abs(b[0]-b[1]);s[I]=T,l[I]||(l[I]=0),l[I]+=U?Math.pow(U,2):0});let p=n.map(I=>({pairing:I,value:l[I]})).sort((I,b)=>I.value-b.value),{pairingValues:m}=hce({possiblePairings:r,valueObjects:l}),{candidate:h,candidatesCount:f,deltaCandidate:g,iterations:v}=pce({valueSortedPairings:p,maxIterations:a,pairingValues:m,deltaObjects:s,valueObjects:l}),{participantIdPairings:y}=o?g:h;return{participantIdPairings:y,candidatesCount:f,deltaCandidate:g,iterations:v,candidate:h}}var Ice=100,yce=100,bce=4e3;function BO(t){var G,j;let{encounterValue:e=Ice,sameTeamValue:i=yce,maxIterations:r=bce,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:o,iterationMatchUps:s,tournamentRecord:l,dynamicRatings:u,refreshDynamic:c,participantIds:d,drawDefinition:p,roundNumber:m,structureId:h,matchUpIds:f,eventType:g,scaleName:v,idPrefix:y,isMock:I,salted:b,event:S}=t;if(!p)return{error:Le};if(!t.structure&&!h)return{error:Ci};let w=t.structure||it({drawDefinition:p,structureId:h}).structure;if(!Nt(w))return{error:lp};if(!(d!=null&&d.length))return{error:jc};let U=[...s??[],...(w==null?void 0:w.matchUps)??[]],{encounters:T}=mce({matchUps:U}),D=(l==null?void 0:l.participants)??[],P={};if(u){let z=ct(w!=null&&w.matchUps?w.matchUps.map(({roundNumber:q})=>q):[]),W=Math.max(...z,0);if(W){let q=(G=w==null?void 0:w.matchUps)==null?void 0:G.filter(({roundNumber:re})=>re===W).map(({matchUpId:re})=>re),Y=j3({ratingType:v??((j=S==null?void 0:S.category)==null?void 0:j.ratingType),updateParticipantRatings:n,tournamentRecord:l,asDynamic:!0,refreshDynamic:c,drawDefinition:p,matchUpIds:q});if(Y.error)return Y;Y.modifiedScaleValues&&(P=Y.modifiedScaleValues)}}let{valueObjects:E}=wce({tournamentParticipants:D,encounterValue:e,sameTeamValue:i,encounters:T}),{uniquePairings:R,possiblePairings:N,deltaObjects:A}=G3({participantIds:d}),M=Object.values(P).length?P:t.adHocRatings,C={tournamentParticipants:D,possiblePairings:N,participantIds:d,uniquePairings:R,drawDefinition:p,maxIterations:r,adHocRatings:M,deltaObjects:A,valueObjects:E,eventType:g,scaleName:v,structure:w,salted:b},{candidatesCount:O,participantIdPairings:k,deltaCandidate:x,iterations:F,candidate:$}=vce(C);if(!O)return{error:K0};let _,L;if(a){let z=eD({structureId:w==null?void 0:w.structureId,ignoreLastRoundNumber:o,participantIdPairings:k,newRound:!0,drawDefinition:p,roundNumber:m,matchUpIds:f,idPrefix:y,isMock:I,event:S});if(z.error)return z;_=z.roundNumber,L=z.matchUps}let{maxDelta:B,maxDiff:V}=$;return{roundNumber:_,participantIdPairings:k,modifiedScaleValues:P,candidatesCount:O,deltaCandidate:x,...X,iterations:F,matchUps:L,maxDelta:B,maxDiff:V}}function wce({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let o of t)n[o]||(n[o]=0),n[o]+=i;let a=e==null?void 0:e.filter(({participantType:o})=>o===Kt);if(a)for(let o of a){let s=o.individualParticipantIds??[],{uniquePairings:l}=G3({participantIds:s});for(let u of l)n[u]||(n[u]=0),n[u]+=r}return{valueObjects:n}}function H3(t){var E,R,N,A;let{drawType:e=Ys,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:o,placeByes:s,isMock:l,event:u}=t,c=t==null?void 0:t.drawDefinition;if(!c)return{error:Le};let d=Or,p=rh({stageSequence:1,drawDefinition:c,stage:d}),m=[es,$y,Hl].includes(e)?p.length:Pg(p.length);if(!a&&e===xg&&p.length<2||e===es&&p.length<3)return{error:V0};let{tieFormat:h,matchUpType:f}=t;if(h){let M=Hn({tieFormat:h});if(M.error)return M}h=qr(h??((E=vn({drawDefinition:c}))==null?void 0:E.tieFormat)),f=f??c.matchUpType;let{structures:g}=is({stageSequence:1,drawDefinition:c,stage:d});if(g.length>1)return{error:BG};if((N=(R=g==null?void 0:g[0])==null?void 0:R.matchUps)!=null&&N.length)return{error:kN};let v=(A=g==null?void 0:g[0])==null?void 0:A.structureId;Object.assign(t,je({structureName:t.structureName??Zr(Or),structureId:v,matchUpType:f,tieFormat:h,drawSize:m,stage:d}));let y=L3(t);if(y.error)return y;let I=y.generators[e];if(!I)return{error:dN};let b=I==null?void 0:I();if(b.error)return b;let{structures:S,links:w}=b,U=S.map(M=>Wt({structure:M}).matchUps).flat();h&&U.forEach(M=>{let{tieMatchUps:C}=bb({matchUp:M,tieFormat:h,isMock:l});Object.assign(M,{tieMatchUps:C,matchUpType:f})}),(!r||!i)&&(c=Ce(c,!1,!0)),c.links||(c.links=[]),w.length&&c.links.push(...w);let T=S.map(({structureId:M})=>M);c.structures||(c.structures=[]);let D=c.structures.map(({structureId:M})=>M);c.structures=c.structures.map(M=>T.includes(M.structureId)?S.find(({structureId:C})=>C===M.structureId):M);let P=S.filter(({structureId:M})=>!D.includes(M));return P.length&&c.structures.push(...P),o&&vb({seedingProfile:t.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:c,structureId:v,placeByes:s,drawSize:m,event:u}),i&&li({drawDefinition:c}),{links:w,structures:S,...X}}var VO={};bt(VO,{addGame:()=>Q3,addPoint:()=>X3,addSet:()=>e6,addShot:()=>Z3,analyzeScore:()=>qO,analyzeSet:()=>jI,calculateHistoryScore:()=>Y3,checkScoreHasValue:()=>Ir,checkSetIsComplete:()=>rD,clearHistory:()=>J3,generate:()=>z3,generateScoreString:()=>Ol,generateTieMatchUpScore:()=>Sb,getSetComplement:()=>KO,getTiebreakComplement:()=>sD,helpers:()=>n6,isValidMatchUpFormat:()=>Sa,keyValueScore:()=>M6,mutate:()=>q3,parseMatchUpFormat:()=>kn,parseScoreString:()=>_S,query:()=>x6,redo:()=>t6,reverseScore:()=>W3,setServingSide:()=>K3,stringifyMatchUpFormat:()=>aT,tidyScore:()=>k6,umo:()=>r6,undo:()=>i6,validateScore:()=>YO,validateTieFormat:()=>Hn});var z3={};bt(z3,{generateScoreString:()=>Ol,generateTieMatchUpScore:()=>Sb,reverseScore:()=>W3});function Ol(t){let{winnerFirst:e=!0,addOutcomeString:i,reversed:r=!1,matchUpStatus:n,matchUpFormat:a,autoComplete:o,winningSide:s,sets:l}=t;if(!l)return{error:Xe,info:"missing sets"};let u=a&&kn(a),{bestOf:c,finalSetFormat:d,setFormat:p}=u??{},m=r||!(!e||!s||s===1),h=i?Uce({matchUpStatus:n}):"",f=(l==null?void 0:l.sort(Sce).map(g).filter(Boolean).join(" "))||"";if(!h)return f;if(s===2)return`${h} ${f}`;return`${f} ${h}`;function g(v){let y=c&&v.setNumber===c&&d?d:p,I=$=>_i($==null?void 0:$.side1Score)||_i($==null?void 0:$.side2Score),b=$=>_i($==null?void 0:$.side1TiebreakScore)||_i($==null?void 0:$.side2TiebreakScore),S=(y==null?void 0:y.tiebreakSet)||!I(v)&&b(v),{side1Score:w,side2Score:U,side1TiebreakScore:T,side2TiebreakScore:D}=v,P=T||(_i(T)||o?0:""),E=D||(_i(D)||o?0:"");if(S)return`[${(m?[E,P]:[P,E]).join("-")}]`;let R=Math.min(P,E),N=R===P?1:2,A=R?`(${R})`:"",M=w||(_i(w)||o?0:""),C=U||(_i(U)||o?0:""),O=$=>N===$?A:"",k=`${M}${O(1)}`,x=`${C}${O(2)}`,F=m?`${[x,k].join("-")}`:`${[k,x].join("-")}`;return["-"," "].includes(F)&&(F=""),F}}function Uce({matchUpStatus:t}){let e={[hn]:"RET",[zt]:"WO",[dr]:"DF/DF",[tr]:"WO/WO",[qc]:"SUS",[Ba]:"ABN",[Mt]:"DEF",[$g]:"DR"};return t&&e[t]||""}function Sce(t,e){return t.setNumber-e.setNumber}function W3(t){if(!(t!=null&&t.score))return{error:Xe};let{sets:e}=t.score,i=e.map(a=>{let{side1TiebreakScore:o,side2TiebreakScore:s,winningSide:l,side1Score:u,side2Score:c,setNumber:d}=a;return je({winningSide:l?3-l:void 0,side1TiebreakScore:s,side2TiebreakScore:o,side1Score:c,side2Score:u,setNumber:d})}),r=Ol({sets:i}),n=Ol({sets:i,reversed:!0});return{reversedScore:{sets:i,scoreStringSide1:r,scoreStringSide2:n},...X}}var q3={};bt(q3,{addGame:()=>Q3,addPoint:()=>X3,addSet:()=>e6,addShot:()=>Z3,calculateHistoryScore:()=>Y3,clearHistory:()=>J3,redo:()=>t6,setServingSide:()=>K3,umo:()=>r6,undo:()=>i6});function yp({matchUp:t}){let{extension:e}=vt({name:wT,element:t});if(!e)return{error:$r};let{history:i=[],undoHistory:r=[]}=e.value;return{history:i,undoHistory:r,...X}}function Y3(t){var P,E;if(!t)return{error:Xe};let{matchUp:e,updateScore:i}=t;if(!e)return{error:aa};let r=((P=yp({matchUp:e}))==null?void 0:P.history)||[];if(!Array.isArray(r))return{error:se,info:"history is not an array"};let{matchUpFormat:n}=e;if(!n)return{error:IN};if(!Sa({matchUpFormat:n}))return{error:vN};let a=kn(n),{bestOf:o,finalSetFormat:s,setFormat:l}=a,u=["0","15","30","40","A","G"],c={sets:[]},d=[],p,m=[0,0],h=1,f=0,g,v=0,y=R=>[1,2].includes(R),I=()=>(f+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:f,games:[]}),b=()=>({winningSide:void 0,points:[]}),S=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),w=S(),U=b(),T=I(),D=0;for(let R of r){D+=1,g=c.sets.length+1===o;let N=g&&s?s:l,{tiebreakAt:A,setTo:M,NoAD:C,tiebbreakFormat:O}=N,k=T.side1Score===A&&T.side1Score===T.side2Score,x=!!N.tiebreakSet,F=x?N.tiebreakSet:O,{tiebreakTo:$,NoAD:_}=F||{},L=()=>{p=void 0,m=[0,0],h=3-h,T.side1TiebreakScore=0,T.side2TiebreakScore=0,T.side1PointScore="",T.side2PointScore="",v=0},B=j=>{T.winningSide=j;let{s:z,...W}=T;c.sets.push(W),w=S(),U=b(),T=I(),L()},V=j=>{U.winningSide=j;let{g:z,...W}=U;T.games.push(W),w=S(),U=b(),L();let q=`side${j}Score`;T[q]+=1},G=j=>{w.winningSide=j;let{p:z,...W}=w;U.points.push(W),w=S(),v=0;let q=()=>m.reduce((re,J)=>re+J)%4/4>.5?h:3-h,Y=j-1;if(k||x){m[Y]+=1,p=q(),T[`side${j}TiebreakScore`]=m[Y],T[`side${3-j}TiebreakScore`]=m[1-Y];let re=_?1:2;if(m[Y]>=$&&m[Y]>=m[1-Y]+re)return V(j),{gameCompleted:!0}}else if(m[1-Y]===4&&m[Y]===3?m[1-Y]-=1:m[Y]+=1,T.side1PointScore=u[m[0]],T.side2PointScore=u[m[1]],m[Y]===5||m[Y]===4&&m[1-Y]<3||C&&m[Y]===4)return V(j),{gameCompleted:!0}};if(y(R.srv)&&(h=R.srv),["p","s","g","o"].includes(R.u)&&d.push(R.u),R.shotOutcome&&(w.shots.push(R),R.shotType==="SERVE"&&["OUT","NET"].includes(R.shotOutcome)&&(v+=1),v===2)){let j=3-h;G(j)}if(y(R.p)||ot(R.pointNumber)){let j=R.winningSide||R.p;if((E=G(j))!=null&&E.gameCompleted)continue}if(y(R.g)||ot(R.gameNumber)){let j=R.winningSide||R.g;U.winningSide=j;let z=`side${j}Score`,W=`side${3-j}Score`;if(d.length&&(d.includes("p"),d=[]),V(j),T[z]===M&&T[z]-T[W]>=(C?1:2)&&(B(j),g))break}if(y(R.s)||ot(R.setNumber)){let j=R.winningSide||R.s;if(B(j),d.length&&(d.includes("p"),d.includes("g"),d=[]),g)break}}return D!==r.length&&console.log({error:"Match completed with excess history"}),(T.side1Score||T.side2Score||T.games.length||T.side1TiebreakScore||T.side2TiebreakScore)&&c.sets.push(T),c.scoreStringSide1=Ol({...c,matchUpFormat:n}),c.scoreStringSide2=Ol({...c,matchUpFormat:n,reversed:!0}),h=p||h,i&&(e.score=c),{...X,servingSide:h,score:c}}function bp({undoHistory:t,history:e,matchUp:i}){return Lt({element:i,extension:{value:{history:e,undoHistory:t},name:wT}})}function K3({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:UN};let{history:i=[]}=yp({matchUp:t});return i.push({srv:e}),bp({matchUp:t,history:i})}function J3({matchUp:t}){return bp({matchUp:t})}function X3({matchUp:t,point:e}){if(!e||!t)return{error:Xe};if(typeof e!="object")return{error:se,context:{point:e}};let{history:i=[]}=yp({matchUp:t});return i.push(e),bp({matchUp:t,history:i})}function Q3({matchUp:t,game:e}){if(typeof e!="object")return{error:se,context:{game:e}};let{history:i=[]}=yp({matchUp:t});return i.push(e),bp({matchUp:t,history:i})}function Z3({matchUp:t,shot:e}){if(typeof e!="object")return{error:Xe};let{history:i=[]}=yp({matchUp:t});return i.push(e),bp({matchUp:t,history:i})}function e6({matchUp:t,set:e}){if(typeof e!="object")return{error:Xe};let{history:i=[]}=yp({matchUp:t});return i.push(e),bp({matchUp:t,history:i})}function t6({matchUp:t}){let{history:e=[],undoHistory:i=[]}=yp({matchUp:t});return i.length&&e.push(i.pop()),bp({matchUp:t,history:e,undoHistory:i})}function i6({matchUp:t}){let{history:e=[],undoHistory:i=[]}=yp({matchUp:t});return i.push(e.pop()),bp({matchUp:t,history:e,undoHistory:i})}var r6={},n6={};bt(n6,{keyValueScore:()=>M6,parseMatchUpFormat:()=>kn,stringifyMatchUpFormat:()=>aT,tidyScore:()=>k6});var rm=" ",ZC="DEF",Tce="COMPLETED",a6="WO",Dce="WO/WO",o6="ABN",s6="SUS",l6="RET",u6="INT",c6=[l6,ZC,a6,Dce,o6,s6,u6],e1="DEFAULTED",d6="WALKOVER",p6="ABANDONED",m6="SUSPENDED",h6="RETIRED",f6="INTERRUPTED",Pce=[h6,e1,d6],Rce="Enter Score",Mm="()",Gd="[]",jO=["up","left","shift+tab"],GO=["enter","down","tab","right"],xS="backspace",g6="r",v6="s",I6="a",y6="d",b6="w",w6="i",tD=[g6,y6,b6,I6,v6,w6],iD="space",vE=["[","("],FS=[...jO,...GO,iD,"]"],U6="-",Ece="/",nm=U6,kl=U6,S6=[Ece],Cce=0,Mce=["=","+","num_1","num_2","shift+=","shift+-"],HO=["0","1","2","3","4","5","6","7","8","9"].concat(tD),T6=HO.map(t=>`shift+${t}`),D6=[nm,xS].concat(FS,S6),P6=[HO,T6,D6].join(","),Nce=[P6,jO,GO,Mce].join(","),Ace={OUTCOMEKEYS:tD,SIDE1KEYS:HO,SIDE2KEYS:T6,MODIFIERS:D6,PROMPT:Rce,MOVEUP:jO,MOVEDOWN:GO,HOTKEYS:Nce};function Jh({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=R6({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==rm?rm:"";return t+r+i}else return i+rm+t}function R6({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of c6){let r=t==null?void 0:t.indexOf(i);r===0?t=t.slice(i.length+1).trim()+rm:r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function t1({analysis:t,scoreString:e,sets:i,lowSide:r}){var f,g,v;let n,a;if(!e)return{scoreString:e,sets:i};let{scoreString:o,removed:s}=R6({scoreString:e});if(e=o,s)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},u=Object.values(l).filter(y=>y!==void 0).length;l.setNumber&&u===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:c}=t.setFormat,{tiebreakTo:d,NoAD:p}=c||{},{isTiebreakEntry:m}=Uf({brackets:Gd,scoreString:e}),h=kce(e);if(h>=0){n=e.slice(0,h);let{isTiebreakEntry:y}=Uf({brackets:Mm,scoreString:n}),{lastOpenBracketIndex:I,isTiebreakEntry:b}=Uf({brackets:Gd,scoreString:n}),S=n&&n[n.length-1].trim(),w=n&&!isNaN(S),U=t.isIncompleteSetScore;if(m&&b){let T=n.slice(I+1).split(kl),D=(T==null?void 0:T.length)>0&&T[0]!==void 0&&!isNaN(parseInt(T[0]))&&parseInt(T[0])||void 0,P=(T==null?void 0:T.length)>1&&T[1]!==void 0&&parseInt(T[1])||void 0,E=[D,P];if(P){let R=r===1?1:0;E[R]=((E==null?void 0:E[1-R])||0)+(p?1:2),(E[R]||0)<d&&(E[R]=d),n=e.slice(0,I+1),n+=E.join(kl)}else D!==void 0?(n=e.slice(0,I+1),n+=D):(n=e.slice(0,I),U=!0);l.side1TiebreakScore=E[0]||0,l.side2TiebreakScore=E[1]||0}if(n.length||(n=void 0),U){let T=(f=l.side1Score)==null?void 0:f.toString();if(T){let D=T==null?void 0:T.slice(0,T.length-1);l.side1Score=!isNaN(D)&&parseInt(D)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let T=(g=l.side2Score)==null?void 0:g.toString(),D=(v=l.side1Score)==null?void 0:v.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let P=T==null?void 0:T.slice(0,T.length-1);l.side2Score=!isNaN(P)&&parseInt(P)||void 0}else{let P=D==null?void 0:D.slice(0,D.length-1);l.side1Score=!isNaN(P)&&parseInt(P)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else y?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(m&&!b?a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i,a[i.length-1]=l),m||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:e,sets:i}}function Uf({brackets:t=Mm,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...qs(i,n)),o=Math.max(...qs(r,n));return{isTiebreakEntry:a>o,lastOpenBracketIndex:a}}function Oce({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=Gd.split(""),a=t.split(""),o=Math.max(...qs(r,a)),s=Math.max(...qs(n,a)),l=Math.max(...qs(kl,a));return i&&o>s&&l>o}function kce(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function E6(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function XB({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){var l;let n=kn(t),{bestOf:a}=n,o=Math.ceil(a/2),s=((l=r==null?void 0:r.reduce((u,c)=>{let{winningSide:d}=c;return d&&u[d-1]++,u},[0,0]))==null?void 0:l.indexOf(o))+1||void 0;return Pce.includes(e)&&i&&(s=i),{matchUpWinningSide:s}}function rD({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:o}){var b;if(!o)return{error:Xe,info:"missing set"};e=e||i&&kn(i);let s=n&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:l,side2Score:u}=o,{setTo:c,tiebreakAt:d}=s,p=l||u,m=nD({set:o}),h=Math.abs(l-u),f=l>=c||u>=c,g=r||l>=c&&u>=c||d&&d<c&&(l===d||u===d),v=t||g&&(m===1&&o.side1TiebreakScore>o.side2TiebreakScore||m===2&&o.side2TiebreakScore>o.side1TiebreakScore),y=!g&&s.NoAD||g||r&&((b=s.tiebreakFormat)!=null&&b.NoAD)?1:2,I=h>=y;return!!((a&&p||f&&(I||g)||r)&&(!g||v))}function nD({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function zO({analysis:t,set:e}){let i=nD({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return rD({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function xce({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];r=et(r);let{validSide2Score:o,requiresTiebreak:s}=Fce({analysis:t,set:a,value:r});if(o){n=!0,e=(e||"")+r,a.side2Score=r;let l=zO({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,s){let u=Mm.split("")[0];e+=u}else t.isDecidingSet||(e+=rm)}return{sets:i,scoreString:e,updated:n}}function Fce({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:o}=r,{side1Score:s}=e,l,u;return n&&n<a?s===n?l=i<=a:l=i<=n:s===a?o?l=i<a:l=i<=a+1:s===a-1?o?l=i<=a:l=i<=a+1:s===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?u=s===a&&i===n||s===n&&i===a:u=s>=a&&i>=a&&s!==i),{validSide2Score:l,requiresTiebreak:u}}function C6({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let o;return e===g6?r?(o=!0,r=Jh({scoreString:r,lowSide:t,outcome:l6}),n=t===2?1:2,a=h6):(o=!0,r=Jh({scoreString:r,lowSide:t,outcome:ZC}),n=t===2?1:2,a=e1):e===y6?(o=!0,r=Jh({scoreString:r,lowSide:t,outcome:ZC}),n=t===2?1:2,a=e1):e===b6?(o=!0,i=[],r=a6,n=t===2?1:2,a=d6):e===v6&&r?(o=!0,r=Jh({scoreString:r,lowSide:t,outcome:s6}),a=m6,n=void 0):e===I6?(o=!0,r=Jh({scoreString:r,lowSide:t,outcome:o6}),a=p6,n=void 0):e===w6&&r&&(o=!0,r=Jh({scoreString:r,lowSide:t,outcome:u6}),a=f6,n=void 0),{updated:o,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function Lce(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:o,lowSide:s,value:l}=t,u,c;!(e!=null&&e.length)&&l!==xS&&(e=[{setNumber:1}]);let d=e.length-1;if(tD.includes(l)){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;m&&!h?i="missing side2Score":o.finalSetIsComplete||n?i="final set is already complete":o.isIncompleteSetScore?i="incomplete set scoreString":o.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:u}=C6({lowSide:s,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===xS){if({scoreString:r,sets:e,outcomeRemoved:c}=t1({analysis:o,scoreString:r,sets:e}),(r==null?void 0:r.trim())===""&&(r=r.trim()),r||(e=[]),c){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;if(m&&h){let f=m>h&&1||h>m&&2||void 0;f&&(p.winningSide=f,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,u=!0}else if(o.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===iD){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p,f=m>h&&1||h>m&&2||void 0;f&&!n&&!o.isIncompleteSetScore&&(e[e.length-1].winningSide=f,e.push({setNumber:e.length+1}),r+=" ",u=!0)}else if(l===nm&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&o.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let m=et((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=et(m),p=e[d].side1Score.toString(),u=!0}else{let m=et((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=et(m),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let m=(e.slice(0,d)||[]).filter(h=>h).map(h=>{let{side1Score:f,side2Score:g}=h;return[f,g].join("-")}).join(" ");m?r=m+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:u}}function _ce({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){var d;let o,s,{tiebreakSet:{tiebreakTo:l,NoAD:u}}=t.setFormat,[c]=Gd.split("");if(t.isMatchTiebreakEntry||(r+=c),n[t.setNumber-1]){let{lastOpenBracketIndex:p}=Uf({brackets:Gd,scoreString:r}),m=(r.slice((p??0)+1)+(e?"":a)).split(kl);if((((d=m[i-1])==null?void 0:d.length)||0)>=2)s="tiebreak digit limit";else if(e){i===1&&(m[0]=(m[0]||"")+a),i===2&&(m[1]=(m[1]||"")+a);let h=[m[0]||0,m[1]||0].map(v=>et(v)),f=i===1?1:0;h[f]=h[1-f]+(u?1:2),h[f]<l&&(h[f]=l);let g=n[n.length-1];g.side1TiebreakScore=h[0],g.side2TiebreakScore=h[1],r=r.slice(0,(p??0)+1),r+=h.join(kl),o=!0}else{let h=[m[0]||0,m[1]||0].map(g=>et(g)),f=n[n.length-1];f.side1TiebreakScore=h[0],f.side2TiebreakScore=h[1],r+=a,o=!0}}else{let p=E6({lowValue:et(a||0),tiebreakTo:l,NoAD:u}),m=[et(a),p];i===2&&m.reverse();let h={side1TiebreakScore:m[0],side2TiebreakScore:m[1],setNumber:(n==null?void 0:n.length)+1||1};n.push(h),r+=m.join(kl),o=!0}return{info:s,scoreString:r,sets:n,updated:o}}function $ce({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:o}=(t==null?void 0:t.setFormat)||{},s=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(o&&r===n||r>n)return{scoreString:i};let l=h(),u=[r,l];e===2&&u.reverse();let c=Mm.split("")[0],d=u.join(nm)+(s?c:rm);i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},m=zO({analysis:t,set:p});return p.winningSide=m||void 0,{scoreString:i,set:p};function h(){return s?r+1:r+1===n?r+(o?1:2):n}}function Bce({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){var x,F,$;let a=(((x=n==null?void 0:n.filter(_=>_==null?void 0:_.winningSide))==null?void 0:x.length)||0)+(i?0:1),o=kn(t),s=a===(o==null?void 0:o.bestOf),l=s&&(o==null?void 0:o.finalSetFormat)||(o==null?void 0:o.setFormat)||{},u=l==null?void 0:l.timed,c=s&&n[(o==null?void 0:o.bestOf)-1],d=c==null?void 0:c.winningSide,{isTiebreakEntry:p}=Uf({brackets:Mm,scoreString:e}),{isTiebreakEntry:m}=Uf({brackets:Gd,scoreString:e}),h=p||m,f=!!l.tiebreakSet,g=(F=e==null?void 0:e[e.length-1])==null?void 0:F.trim(),v=e&&!isNaN(g),y=!h&&g===nm,I=p&&vE.includes(g),b=m&&vE.includes(g),S=m&&g===kl,w=e==null?void 0:e.split(""),[U]=Gd.split(""),T=w&&Math.max(...qs(U,w)),D=w&&Math.max(...qs(kl,w)),P=w&&D>T,E=($=n[n.length-1])==null?void 0:$.winningSide,R=(n==null?void 0:n.length)&&!E,N=c6.find(_=>(e==null?void 0:e.indexOf(_))>=0),A=!isNaN(r),M=r===iD,C=FS.includes(r),O=e==null?void 0:e.split("").find(_=>vE.includes(_)),k=C&&m&&!b&&(S||!Oce({scoreString:e}));return{isTiebreakSetValue:f&&A,matchUpScoringFormat:o,setNumber:a,setFormat:l,matchTiebreakHasJoiner:P,isGameScoreEntry:R,isSpace:M,isCloser:C,isTiebreakCloser:C&&O&&h&&v,isDecidingSet:s,isTiebreakSet:f,isTimedSet:u,isNumericEnding:v,isNumericValue:A,hasOpener:O,hasOutcome:N,finalSet:c,finalSetIsComplete:d,lastSetIsComplete:E,isInvalidSetTiebreakValue:M&&h&&I,isInvalidMatchTiebreakValue:k,isTiebreakEntry:h,isSetTiebreakEntry:p,isMatchTiebreakEntry:m,isIncompleteSetScore:y,isIncompleteSetTiebreak:I,isIncompleteMatchTiebreak:b,isPartialMatchTiebreakValue:S}}function M6(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:o}=t,{matchUpFormat:s,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!P6.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:m}=XB({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=m;let h=Bce({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:s});if(S6.includes(i)&&(i=nm),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&p&&et(i)===0&&(h.isTiebreakCloser=!0),FS.includes(i)&&h.hasOpener&&(i=""),FS.includes(i)&&(i=iD),h.lastSetIsComplete){let f=(r==null?void 0:r.length)&&r[r.length-1];r&&f!==" "&&(r+=" ")}if(h.isTimedSet)({info:d,sets:n,scoreString:r,updated:c,matchUpStatus:o,winningSide:a}=Lce({analysis:h,lowSide:e,scoreString:r,sets:n,matchUpStatus:o,winningSide:a,value:i}));else if(tD.includes(i))h.finalSetIsComplete||a?d="final set is already complete":!h.isTiebreakEntry&&!h.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:o,winningSide:a,updated:c}=C6({lowSide:e,sets:n,scoreString:r,matchUpStatus:o,winningSide:a,value:i}):h.isTiebreakEntry||h.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===xS)c=!0,{scoreString:r,sets:n}=t1({analysis:h,scoreString:r,sets:n,lowSide:e}),r||(n=[]),o=void 0,a=void 0;else if(h.hasOutcome)d="has outcome";else if(i===nm&&!h.isMatchTiebreakEntry)(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(c=!0,{scoreString:r,sets:n}=t1({analysis:h,scoreString:r,sets:n,lowSide:e}),o=void 0);else if(i===kl&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?d="existing joiner":h.isNumericEnding&&(c=!0,r+=kl);else if([nm,kl].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:n,scoreString:r,updated:c}=xce({analysis:h,scoreString:r,sets:n,value:i}));else if(h.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(h.isTiebreakCloser){let f=h.isSetTiebreakEntry?Mm:Gd,g=f.split("").reverse()[0],v=f.split("")[0],y=n[n.length-1],{tiebreakFormat:I}=h.setFormat,{tiebreakTo:b,NoAD:S}=I||{},w=nD({set:y});if(!h.isTiebreakSet){let T=parseInt(r.split(v).reverse()[0]),D=E6({lowValue:T,tiebreakTo:b,NoAD:S});w===1?(y.side1TiebreakScore=D,y.side2TiebreakScore=T):(y.side1TiebreakScore=T,y.side2TiebreakScore=D)}r=(r||"")+g,h.isDecidingSet||(r+=rm);let U=zO({analysis:h,set:y});y.winningSide=U||void 0,c=!0}else if(h.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:c}=_ce({analysis:h,auto:u,lowSide:e,scoreString:r,sets:n,value:i}));else if(h.isSetTiebreakEntry){let[f]=Mm.split(""),g=Math.max(...qs(f,r.split(""))),v=r.slice(g+1),y=v&&et(v)===Cce,I=et(v?v+i:i),{tiebreakFormat:b}=h.setFormat,{tiebreakTo:S,NoAD:w}=b||{};!y&&v.length<2?w&&I>S-1?d="invalid low value for NoAD tiebreak":(c=!0,r=(r||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)d=`invalid key: ${i}`;else if(h.isGameScoreEntry)d="game scoreString entry";else if(h.lastSetIsComplete||!n.length){c=!0;let{scoreString:f,set:g}=$ce({analysis:h,lowSide:e,scoreString:r,value:et(i)});g&&(g.setNumber=(n==null?void 0:n.length)+1||1),n=(n==null?void 0:n.concat(g).filter(Boolean))||[g],r=f||void 0}else console.log("error: unknown outcome")}if(c){n=n==null?void 0:n.filter(Boolean);let{matchUpWinningSide:f}=XB({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=f,f&&(!o||[Xi,mo].includes(o))?(o=Tce,n=n.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:I,side2TiebreakScore:b}=g;return v||y||I||b})):r&&!a&&![m6,p6,f6].includes(o)&&(o=void 0),{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}return{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}var aD="\\d+-\\d+",VI="\\d+-\\d+\\(\\d+\\)",WO="\\[\\d+-\\d+\\]",Vce="\\d+-\\d+\\(\\d+-\\d+\\)",jce=new RegExp(`(${aD}),`,"g"),Gce=new RegExp(`(${VI}),`,"g"),Hce=[aD,VI,WO,Vce],zce=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],Wce=zce.map(t=>{let e=t.split("").map(i=>Hce[i]).join(" ");return new RegExp(`^${e}$`)});function QB(t){return!t||Wce.some(e=>e.test(t))}function qce(t){let e="[];",i="()",r=e+i,n=[e[0],i[0]],a=Object.assign({},...r.split("").map(l=>({[l]:0}))),o="",s=t.split("").map(l=>{let u=r.includes(l)&&l,c=n.includes(u);if(c&&u)return a[u]+=1,o=u,l;if(!c&&u&&o&&u!==o){a[o]-=1;let d=e.includes(o)&&e||i.includes(o)&&i||"",p=d.split("").find(m=>m!==o);if(d.includes(u))a[o]||(o="");else return a[u]||(o=""),p}return l}).join("");return t!==s?s:t}function BU(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function Yce(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function qf(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function LS(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function ZB(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function Kce(t){return t.startsWith("(")&&t.endsWith(")")}function Jce({score:t,applied:e}){t=qce(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let U=w.replace(")",") ");t=t.replace(w,U)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let w of a||[]){let[U]=w.match(n).slice(1),T=U.replace(/ /g,"");t=t.replace(w,`(${T})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(U,T)})}if(o=/\(\((\d)\)\)/g,o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(U,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(w=>{let U=new RegExp(`(\\d+)${w}(\\d+)`,"g"),T=t.match(U);T&&T.forEach(D=>t=t.replace(D,D.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[U]=w.match(/\((\d+), \)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"&&(t=t.replace(w,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(w=>{let[U]=w.match(/\((\d+)\/\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${U})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(w=>{let[U]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${U},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[U]=w.match(/\(\/(\d+)\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&parseInt(U)<6?t=t.replace(w,`(6-${U})`):t=t.replace(w,`(${U})`)});let p,m,h,f,g,v=()=>{g=Ua(t.split("")),m=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],h=g["["]===g["]"]+1,f=m&&!h};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(Kce)?t=w.map(U=>{let T=U.slice(1,U.length-1);return T.length>2?T:U}).join(" "):t=w.join(" ")}v();let I=/[A-Za-z]+/.test(t),b=/\d+/.test(t);if(!I&&!b)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],U=0;for(let T of t.split("").reverse())T===")"&&(U?w.push("("):U+=1),T==="("&&(U-=1),w.push(T);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),f&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),f&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),f){let w="",U=0;for(let T of t.split(""))T==="("&&(U?w+=")":U+=1),T===")"&&(U-=1),w+=T;t=w}v(),h&&!m&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let S=w=>{let U=w.indexOf("("),T=w.indexOf(")");return U>=0&&T>=0&&U<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);S(w)&&(t=w,v())}return{score:t,applied:e}}function oD(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=qs("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,o)=>o%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function Xce({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[jce,Gce].forEach(i=>{let r=t.match(i);r!=null&&r.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(oD).join(" "),{score:t,applied:e}}function Qce({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let m=/^-(\d+)$/;if(m.test(p)){let[h]=p.match(m).slice(1);if(h.length===2)return h.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(BU),a=0,o="";for(let p of n){let m=qs(p,r).filter(v=>!a||v>a)[0],h=r.slice(a,m-1),f=r[m-1],g=e(f);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((I,b)=>+I-+b));if(y===1){let I=[h.join(" "),[f,p].join("")].join(" ");o+=I,a=m+1}else if(y===0){let I=Math.max(...v);if([4,5,6,7,8,9].includes(I)){let b=[6,4].includes(I)?I+1:I-1,S=[I,b].sort().reverse().join("-"),w=[h.join(" "),[S,p].join("")].join(" ");o+=w,a=m+1}}}}if(n.length&&o.length){let p=r.slice(a).join(" ");return o=[o,p].join(" "),{score:o.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((m,h)=>+m-+h,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let s=r.map(p=>Yce(p)&&"bracket"||qf(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,m="";return r.forEach((h,f)=>{s[f]==="bracket"&&p==="set"?(h=i(h),m+=h):m+=` ${h}`,p=s[f]}),{score:m.trim()}}r=t.split(" ");let l,u=r.map(p=>{let m=new RegExp(/^(\d+)-(\d+)$/);if(m.test(p)){let[h,f]=p.match(m).slice(1),g=Math.abs([h,f].reduce((y,I)=>+y-+I)),v=Math.max(h,f);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=qs("tiebreak",u);if(c.length){let p="";r.forEach((m,h)=>{c.includes(h)?p+=`(${m}) `:c.includes(h+1)?p+=`${m}`:p+=`${m} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,m,h]=t.match(d).slice(1),f=Math.max(m,h)>=10;!qf(p)&&f&&(t=t.replace(d,`${p} [${m}-${h}]`))}return u=[],t=t.split(" ").map(p=>{let m=/^\((.*)\)$/,h=m.test(p),f=new RegExp(WO).test(p)&&"super"||new RegExp(VI).test(p)&&"tiebreak"||new RegExp(aD).test(p)&&"standard"||"unknown";return u.push(f),f==="standard"&&h?p.match(m)[1]:p}).join(" "),{score:t}}function Zce({score:t,applied:e}){for(let T of[".",","," ","/"]){let D=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(D.test(t)){let P=t.match(D).slice(1).map(R=>parseInt(R)),E=Math.abs(P[0]-P[1]);E<=10&&E>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,D,P,E,R,N]=t.match(i).slice(1);t=t.replace(i,`${T}${D}-${P} ${E}-${R}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let o=oD(t);o!==t&&(t=o,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[T,D,P]=t.match(s).slice(1),[E,R]=D.split("");t=`${T}-${E} ${R}-${P}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[T,D]=t.match(u).slice(1),P=T.trim(),E=D.trim();if(l.test(P)&&l.test(E)){let R=P.match(l).slice(1,3).join("-"),N=E.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[T,D]=t.match(c).slice(1),P=T.trim(),E=D.trim();if(l.test(P)&&l.test(E)){let R=P.match(l).slice(1,3).join("-"),N=E.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("singleSetCommaSeparationPattern")}let p=0,m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(t)&&p<3;){let[T,D,P]=t.match(m).slice(1),E=D.split(""),R=`${T}-${E[0]} ${E[1]}-${P}`;t=t.replace(m,R),e.push("noSetSeparationPattern"),p+=1}let h=/(^|\s)7-6\s(\d+)\s/g,f=t.match(h);if(f!=null&&f.length){let T=/(^|\s)7-6\s(\d+)\s/;f.forEach(D=>{let P=D.match(T).slice(2)[0];t=t.replace(D,`7-6(${P}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(T=>{let D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(T=>{let D=" "+T.slice(1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let T=t.match(v)[0],D=T.split("/").map(P=>`(${P})`).join(" ")+" ";t=t.replace(T,D),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let I=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(I.test(t)){let T=t.match(I),D=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),P=t;T.forEach(E=>{let[R,N]=E.match(D).slice(1),A=`${R}-${N}`;P=P.replace(E,A)}),t=P,e.push("slashSetPattern")}let b=/(.*)\s(1\d)\s(\d+)$/;if(b.test(t)){let[T,D,P]=t.match(b).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${D}${P}`,e.push("spaceSeparatedSuperPattern"))}let S=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(S)||[]){let[D,P,E,R]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,A]=P.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${D}${P}(${E})${R}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(w)||[]){let D=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[P,E,R]=T.match(D).slice(1),[N,A]=P.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${P}(${E})${R}`),e.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let T of t.match(U)||[]){let D=/(^|\s)(\d \d)\(/,[P,E]=T.match(D).slice(1);t=t.replace(T,`${P}${E.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function ede({score:t,matchUpStatus:e}){var s;let i=t==null?void 0:t.split(" ");t=i.map(l=>{if(l.endsWith("]")){let u=l.split("[");if(qf(u[0]))return u[0]+`(${u[1].slice(0,u[1].length-1)})`}return l}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let l of t.match(r)){let u=(s=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:s[1];if(_i(u)&&(u==null?void 0:u[0])>2){if([2,4].includes(u.length))u=u.split("").join("-");else if(u.length===3){let c=u.indexOf("1");u=LS(u.split(""),c)}}t=t.replace(l,`(${u})`)}i=t==null?void 0:t.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((l,u)=>{let c=[void 0,"","COMPLETED"].includes(e)||u!==a;if(n.test(l)&&c){let[d,p,m]=Array.from(l.match(n)).slice(1),h=Math.min(p,m);return`${d}(${h})`}return l}).join(" "),i=t==null?void 0:t.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(l=>{if(n.test(l)){let[u,c]=Array.from(l.match(n)).slice(1),d=u.split("");return`${d[0]}-${d[1]}(${c})`}return l}).join(" "),i=t==null?void 0:t.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(l=>{if(n.test(l)){let[u,c]=Array.from(l.match(n)).slice(1);return qf(u)?`${u}(${c})`:u}return l}).join(" "),i=t==null?void 0:t.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),t=i.map(l=>{if(n.test(l)){let[u]=l.match(n).slice(1);return`[${u<9?10:parseInt(u)+2}-${u}]`}return l}).join(" ");let o=/\((\d)+0 /;if(o.test(t)){let l=t.match(o)[1];t=t.replace(o,`(${l}) `)}return{score:t}}function tde({score:t,attributes:e,identifier:i}){var c,d,p;if(typeof t!="string")return{score:t,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=t.match(r);for(let m of n||[]){let h=(d=(c=m.match(/^\((.*)\)$/))==null?void 0:c.slice(1))==null?void 0:d[0],f=t.split(m)[0].split(")").reverse()[0].replace(/\D/g,"");if((h==null?void 0:h.length)===2&&(f==null?void 0:f.length)>=2){let y=f.slice(f.length-2).split("").map(I=>parseInt(I));if(Math.abs(y[0]-y[1])===1)continue}let g=ZB(h),v=oD(g);t=t.replace(m,`(${v})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);(p=t.match(a))==null||p.forEach(m=>{let h=ZB(m.match(/^\[(.*)\]$/)[1]);t=t.replace(m,`(${h}) `).trim()});let o=[")","]"],s=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&o.some(m=>t.endsWith(m))&&s.some(m=>t.includes(m))){let m="",h=t.split(/[)\]]/).filter(Boolean).map(I=>(I.startsWith(",")&&(I=I.slice(1)),I.trim())),f=h.every(I=>I.includes(",")||BU(I)),g=h.every(I=>I.includes("/")||BU(I)),v=h.every(I=>I.includes("-")||BU(I)),y=f&&","||v&&"-"||g&&"/";if(y){let I;h.forEach(b=>{if(b.startsWith("("))if(I==="set"&&(m+=" "),b.includes(y))m+=b.slice(1).split(y).map(S=>S.trim()).join("-"),I="set";else{let S=b.slice(1);m+=`(${S}) `,I="tiebreak"}else if(b.startsWith("[")){let S=b.slice(1).split(y).map(U=>parseInt(U.trim())),w=Math.min(...S);I==="set"?m+=`(${w}) `:m+=`[${S.join("-")}] `,I="tiebreak"}}),t=m.trim()}}let l=Ua(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&qf(t)&&_i(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let u=/\(\)/g;return u.test(t)&&(t=t.replace(u,"").trim()),{score:t}}function N6({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let s=`${r[0]}-${r[1]}`;return r[2]&&(s+=` (${r[2]})`),n(),r.push(r),s};n();let o=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let s=e.shift(),l=_i(s)&&parseInt(s),u=r[0]!==void 0&&r[1]!==void 0;if(_i(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,o())){i.push(a()),r=[void 0,void 0];continue}if(u&&e.length===1&&_i(e[0])){let c=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=c,i.push(a()),r=[void 0,void 0]}u&&o()}}return{sets:i}}function i1(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=LS(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=LS(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function A6(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e==null?void 0:e.toString().split(""),a=n==null?void 0:n.every(s=>_i(s)),o=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let s=a?n.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(N6({score:e}),s.length,e.length===3&&o(s.slice(0,2))===1){let[l,u,c]=s;e=`${l}-${u}(${c})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,u,c]=s;e=`[${l}${u}-${c}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&o(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,u,c,d]=s,p=Math.min(c,d);e=`${l}-${u}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,u,c,d]=s;e=`[${l}${u}-${c}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,u,c,d]=s;e=`${l}${u} ${c}${d}`,i.push("split4")}else if(e.length===5&&o(s.slice(0,2))===1){let[l,u,c,d,p]=s;e=`${l}-${u}(${c}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&o(s.slice(3))===1){let[l,u,c,d,p]=s;e=`${l}-${u} ${c}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&s[4]===1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d} [${p}${m}-${h}]`,i.push("numericTiebreakPattern6")}else if(o(s.slice(0,2))===1&&o(s.slice(3,5))>1&&o(s.slice(5,7))>1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u}(${c}) ${d}-${p} ${m}-${h}`,i.push("numericTiebreakPattern7")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))===1&&o(s.slice(5,7))>1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d}(${p}) ${m}-${h}`,i.push("numericTiebreakPattern8")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&o(s.slice(4,6))===1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d} ${p}-${m}(${h})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=i1(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=Rr(e.split(""),2).map(g=>g.join("")),u=l.map(g=>{let[v,y]=g.split("").map(S=>parseInt(S)),I=Math.abs(v-y),b=v>y?1:2;return I>1&&b||b*-1}),c=u.reduce((g,v)=>g>0&&v>0,1),d=Ua(u),p=u.map(g=>Math.abs(g)),m=Ua(p),h=u[0]<0,f=!h&&u[1]<0;if(u[0]>0&&u[1]>0&&u[0]!==u[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(c)e=l.join(" "),i.push("chunkSplit");else if(s.length===6){if(d[1]===2||d[2]===2)if(!Object.values(m).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,I,b,S]=s,w=u.reduce((U,T,D)=>T<0?D:U,void 0);if(w===0){let U=Math.min(y,I);e=`${g}-${v}(${U}) ${b}-${S}`,i.push("chunkSplitTiebreak1")}else if(w===1){let U=Math.min(b,S);e=`${g}-${v} ${y}-${I}(${U})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${I}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,y,I,b,S,w,U]=s;h||f?s[5]===1&&(h?e=`${g}-${v}(${y}) ${I}-${b} [${S}${w}-${U}]`:e=`${g}-${v} ${y}-${I}(${b}) [${S}${w}-${U}]`):(u[0],u[1])}}}return{score:e,applied:i,matchUpStatus:r}}function O6(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let u=l.match(n).slice(1).map(d=>parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,o=e[0]>0&&e[0]===e[1],s=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}function ide({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),o=a.length;t=a.map((c,d)=>{if(new RegExp(VI).test(c)){let m=c.slice(3),h=c.slice(0,3),f=h.split("-");if(!qf(h)&&!e){let g=Math.max(...f),v=h.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+m}}else if(c.length===2&&_i(c))return c.split("").join("-");c=oD(c);let p=new RegExp(`^${WO}$`).test(c)&&"super"||new RegExp(`^${VI}$`).test(c)&&"tiebreak"||new RegExp(`^${aD}$`).test(c)&&"standard"||"unknown";if(r.push(p),o>1&&p==="standard"&&d<2){let[m,h]=c.split("-"),f=Math.abs(parseInt(m)-parseInt(h)),g=Math.max(m,h),v=Math.min(m,h),y=[parseInt(m),parseInt(h)].indexOf(v);if(g>9&&f>2){let I=g.toString().split(""),b=I.find(S=>parseInt(S)>v||d&&parseInt(S)<=n)??I[0];b&&(c=y?[b,v].join("-"):[v,b].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[m,h]=c.split("-");if(!Math.abs(parseInt(m)-parseInt(h))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:u}=O6(t);if(u===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function rde({score:t}){let{setsTied:e,winningSide:i}=O6(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let s=t.match(r).slice(1)[0],l=s<=8?10:s+2;t=t.replace(r,` [${l}-${s}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(s=>_i(s)))return{score:t};if(o[0]==="76"){let s=o[1].length===2?Math.min(...o[1].split("").map(l=>parseInt(l))):o[1];t=[...n.slice(0,n.length-1),`7-6(${s})`].join(" ")}else{o=o.map(u=>parseInt(u));let s=Math.max(...o),l=Math.abs(o[0]-o[1]);if(s>=10){if(l>2&&o.every(u=>+u>=10)){let u=o.map(c=>c===s?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(o=u)}t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" ")}else n.length===3&&s>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" "))}return{score:t}}function nde({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function ade({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function ode({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=LS(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=A6({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function sde({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&i1(t)?{score:i1(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function lde({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function ude({score:t,profile:e,applied:i}){var o;t=t==null?void 0:t.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let n=(o=e==null?void 0:e.matchUpStatuses)==null?void 0:o.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(a,"").trim(),applied:i}):{score:t}}function cde({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function dde({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function pde({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function mde({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function hde({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[o,s]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${o}-${s}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>_i(i))&&e.length===4&&(t=e)}return{score:t}}function fde({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var gde={handleTiebreakSlashSeparation:mde,handleSetSlashSeparation:dde,punctuationAdjustments:Jce,handleGameSeparation:pde,joinFloatingTiebreak:Qce,handleBracketSpacing:Xce,handleSpaceSeparator:hde,separateScoreBlocks:ode,matchKnownPatterns:Zce,removeDanglingBits:cde,removeErroneous:sde,handleWalkover:lde,properTiebreak:ede,handleNumeric:A6,handleRetired:ude,containedSets:tde,sensibleSets:ide,stringScore:nde,superSquare:rde,setBuilder:N6,excisions:fde,replaceOh:ade},IE={},vde=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],Ide=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function k6(t){if(!t.score)return{error:se};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:o,profile:s}=t,l=[],u,c=[],d,p,m=e,h=g=>{g.forEach(v=>{p=gde[v]({profile:s,identifier:r,matchUpStatus:u,attributes:d,applied:c,score:m});let y=p.score!==m;y&&l.push({method:v,score:p.score}),a&&(o||y||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},v),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),m=p.score})};h(vde);let f=QB(m);return f||(m=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),h(Ide),f=QB(m),f||(m="")),c.forEach(g=>{IE[g]||(IE[g]=0),IE[g]+=1}),{matchUpStatus:u==null?void 0:u.toUpperCase(),modifications:l,attributes:d,isValid:f,score:m}}var x6={};bt(x6,{analyzeScore:()=>qO,analyzeSet:()=>jI,checkScoreHasValue:()=>Ir,checkSetIsComplete:()=>rD,getSetComplement:()=>KO,getTiebreakComplement:()=>sD,isValidMatchUpFormat:()=>Sa,parseScoreString:()=>_S,validateScore:()=>YO,validateTieFormat:()=>Hn});function qO({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){var S,w;let a=(n==null?void 0:n.sets)??[],o=((a==null?void 0:a.filter(U=>U==null?void 0:U.winningSide))||[]).reduce((U,T)=>{let{winningSide:D}=T;if(!D)return U;let P=D-1;return U[P]++,U},[0,0]),s=r?r-1:void 0,l=s!==void 0?1-s:void 0,u=s!==void 0&&o[s],c=l!==void 0&&o[l],d=e?kn(e):void 0,p=Math.max(...o),m=Ua(o)[p],h=((S=d==null?void 0:d.setFormat)==null?void 0:S.timed)||((w=d==null?void 0:d.finalSetFormat)==null?void 0:w.timed),f=d==null?void 0:d.bestOf,g=f&&Math.ceil(f/2)||1,v=i??t,y=v&&[Mt,hn,zt].includes(v),I=!d||!a.length||a.every((U,T)=>{let D=T+1,P=D===f,E=D===a.length,{side1Score:R,side2Score:N,side1TiebreakScore:A,side2TiebreakScore:M,winningSide:C}=U,O=Math.max(R??0,N??0),k=A??M,{finalSetFormat:x,setFormat:F}=d,$=P&&x||F;if(k){let{tiebreakTo:_,NoAD:L}=($==null?void 0:$.tiebreakFormat)||{},B=Math.max(A??0,M??0);if(L&&B>_||B<_&&C&&(E&&!y||!E))return!1}return $.setTo?!(!$.noTiebreak&&O>$.setTo+1):!0}),b=(!e||p===g)&&m===1&&o.indexOf(p)+1||void 0;return{valid:!!(I&&(r&&u>c&&r===b||r&&y||!r&&!b&&(![qi,Mt,hn,zt].includes(v)||h&&v===qi)))}}function YO({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:se};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=n,l="scoreString must be a string!";if(o!==void 0&&typeof o!="string")return{error:se,info:l};if(s!==void 0&&typeof s!="string")return{error:se,info:l};if(a!==void 0&&!Array.isArray(a))return{error:se,info:Bd("sets")};if(a!=null&&a.length){let u=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(u.length!==ct(u).length)return{error:se,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:m,side1TiebreakScore:h,side2TiebreakScore:f,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:I}=d;if(![[p,m],[h,f],[g,v]].filter(b=>b.some(S=>![void 0,null].includes(S))).every(b=>b.every(S=>ot(S))))return{error:se,info:"non-numeric values"};if(![I,y].filter(b=>![void 0,null].includes(b)).every(b=>ot(b)))return{error:se,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:se,info:"winningSide must be 1 or 2"}}let{valid:c}=qO({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!c)return{error:XG,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var KO=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let o=et(i);(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),n&&n<r&&o>n&&(o=n);let s;return a&&!n?(o>r&&(s=r),s=o<r?r:r-1):s=o+1<r&&r||n&&n<r&&o===n&&r||!n&&o+2||r+1,[e?o:s,e?s:o]},sD=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let o=yde({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:o,e?o:a]};function yde(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function _S({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((r,n)=>i({set:r,setNumber:n+1}));function i({set:r,setNumber:n}){let a=/\(([^)]+)\)/,o=/\[([^)]+)\]/,s=a.exec(r),l=o.exec(r),u=(r==null?void 0:r.startsWith("["))&&l&&l[1].split("-").map(I=>parseInt(I)),c=s&&r.replace(s[0],"")||l&&r.replace(l[0],"")||r,d=!u&&c.split("-").map(I=>parseInt(I)),p=u?u[0]>u[1]&&1||u[0]<u[1]&&2||void 0:d[0]>d[1]&&1||d[0]<d[1]&&2||void 0,m=s?s[1]:void 0,h=(m&&sD({lowValue:m,isSide1:p===2,tiebreakTo:t}))??[],[f,g]=d||[],[v,y]=u||h||[];return{side1Score:f,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:y,winningSide:p,setNumber:n}}}function bde({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=nD({set:n});return rD({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function jI(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:G0};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},o=n||a,s=!!(r&&o&&r===o),l=s&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),u=!!(l!=null&&l.tiebreakSet),c=!!(l!=null&&l.timed),d=!u&&!c,p=!!(r&&o&&r<=o),m=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],h=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],f=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],g=m.filter(k=>k!==void 0).length,v=h.filter(k=>k!==void 0).length,y=f.filter(k=>k!==void 0).length,I=m==null?void 0:m.filter(k=>!isNaN(k)).length,b=f==null?void 0:f.filter(k=>!isNaN(k)).length,{tiebreakAt:S}=l||{},w=S&&m.filter(k=>k>=S).length===2,U=w&&(m[0]>m[1]&&1||m[1]>m[0]&&2||void 0),T=!!(b&&!I),D=!!(e!=null&&e.winningSide),{error:P,result:E}=wde({sideTiebreakScores:f,sideGameScores:m,setFormat:l,setObject:e}),{error:R,result:N}=Ude({sideTiebreakScores:f,setObject:e,setFormat:l}),A=d&&!T&&E||u&&T&&N||c,M=p&&!(u&&!T)&&!(d&&T)&&(!D||A),C=bde({isTimedSet:c,matchUpScoringFormat:i,isDecidingSet:s,isTiebreakSet:T,setObject:e}),O={expectTiebreakSet:u,expectTimedSet:c,hasTiebreakCondition:w,isCompletedSet:D,isDecidingSet:s,isTiebreakSet:T,isValidSet:M,isValidSetNumber:p,isValidSetOutcome:A,leadingSide:U,setFormat:l,sideGameScores:m,sideGameScoresCount:g,sidePointScores:h,sidePointScoresCount:v,sideTiebreakScores:f,sideTiebreakScoresCount:y,winningSide:C};return(e==null?void 0:e.winningSide)!==void 0&&(T?(O.isValidTiebreakSetOutcome=N,N||(O.tiebreakSetError=R)):(O.isValidStandardSetOutcome=E,E||(O.standardSetError=P))),O}function wde({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:G0};let n=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||n||a)return{result:!1,error:se};if((i==null?void 0:i.filter(U=>!isNaN(U)).length)!==2)return{result:!1,error:yC};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:u}=e||{};if(!(o&&(i!=null&&i.find(U=>U>=o))))return{result:!1,error:yC};let c=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!c)return{result:!1,error:H0};let d=(t==null?void 0:t.winningSide)-1,p=1-d,m=i[d],h=i[p],f=m-h;if(!(m>h))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(r==null?void 0:r.filter(U=>!isNaN(U)).length)===2,y=r==null?void 0:r[d],I=r==null?void 0:r[p],b=s&&i.filter(U=>U>=s).length===2;if(g){let{NoAD:U,tiebreakTo:T}=l;if(b){if(f>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&(r!=null&&r.find(N=>N>=T))))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let D=s<o?o:o+1;if(m>D)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!I||y<I)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let P=U?1:2,E=y-I,R=I>=T-1;if(E&&R&&E<P)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(m>o&&!b)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let S=u?1:2,w=h>=o-1;return f&&w&&!b&&f<S?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:f>S&&m>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function Ude({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:G0};let r=!!(e!=null&&e.tiebreakSet),n=!!(e!=null&&e.timed);if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:H0};let{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:l}=o||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=(t==null?void 0:t.winningSide)-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let m=s?1:2,h=d-p,f=p>=l-1;return h&&f&&h<m?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}function Sde(t){var d,p,m;let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:o,isMock:s,event:l}=t,{tieFormat:u,matchUpFormat:c}=t;if(a===lr&&o===lr){let h=(p=(d=e==null?void 0:e.structures)==null?void 0:d.find(({stage:f})=>f===Oe))==null?void 0:p.tieFormat;u=u||h||n&&((m=l==null?void 0:l.tieFormat)==null?void 0:m.tieFormatName)===n&&l.tieFormat||n&&wu({namedFormat:n,hydrateCollections:i,isMock:s,event:l})||(l==null?void 0:l.tieFormat)||wu({event:l,isMock:s,hydrateCollections:i}),c=void 0}else c||(u=void 0,l!=null&&l.matchUpFormat||(c=fu));if(u){let h=Hn({gender:l==null?void 0:l.gender,enforceGender:r,tieFormat:u});if(h.error)return h}return{tieFormat:u,matchUpFormat:c}}function Tde(t){var I,b,S,w,U;let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,drawEntries:n,structureId:a,idPrefix:o,isMock:s,event:l}=t,u=t.qualifyingProfiles,c=u!=null&&u.length?x3({uuids:t.uuids,qualifyingProfiles:u,appliedPolicies:r,idPrefix:o,isMock:s}):void 0;if(c!=null&&c.error)return c;e.structures=(I=e.structures)==null?void 0:I.filter(({structureId:T})=>T!==i),e.links=(b=e.links)==null?void 0:b.filter(({source:T})=>T.structureId!==i);let{qualifiersCount:d,qualifyingDrawPositionsCount:p,qualifyingDetails:m}=c??{};p&&(c!=null&&c.structures&&((S=e.structures)==null||S.push(...c.structures)),c!=null&&c.links&&((w=e.links)==null||w.push(...c.links)));let h=(U=e.structures)==null?void 0:U.find(({stage:T,stageSequence:D})=>T===Oe&&D===1),{qualifiersCount:f}=Gg({stageSequence:1,drawDefinition:e,structureId:a,stage:Oe}),g=Math.max(d??0,f??0),v=_q({qualifiersCount:g,drawDefinition:e,stage:Oe});if(v.error||(v=NS({drawSize:p,stage:Ke,drawDefinition:e}),v.error))return v;Dde({drawDefinition:e,drawEntries:n,event:l});let y=Pde({mainStructure:h,qualifyingDetails:m,drawDefinition:e});return y.error?y:{drawDefinition:e,structureId:a}}function Dde({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===Ke)){let n={...r,entryStage:r.entryStage??Oe,drawDefinition:t,event:i};qA(n)}}function Pde({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var r;for(let n of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:o,roundTarget:s,finishingPositions:l,linkType:u}=n,c=t&&((r=Ib({targetStructureId:t.structureId,sourceStructureId:o,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:s,linkType:u}))==null?void 0:r.link);if(c!=null&&c.error)return c;c&&(i.links||(i.links=[]),i.links.push(c))}return{error:void 0}}function F6(t){var r,n;let{participantIds:e}=t,i=((n=(r=t.drawDefinition)==null?void 0:r.entries)==null?void 0:n.filter(a=>{let o=a.entryStatus;return!t.restrictEntryStatus||ds.includes(o)}).map(Ut))??[];if(e){let a=e.filter(o=>!(i!=null&&i.includes(o)));if(a!=null&&a.length)return ee({result:{error:Es},info:{invalidParticipantIds:a}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:se,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:se,info:"roundsCount must be less than 32"}:{participantIds:e}}function JO(t){var d;let e=[],{roundsCount:i=1,drawDefinition:r,matchUpsCount:n,structureId:a,idPrefix:o,isMock:s,event:l}=t,u,c=F6(t);if(c.error)return c;for(let p of Te(1,i+1)){let m=eD({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:r,matchUpsCount:n,structureId:a,roundNumber:u,idPrefix:o,isMock:s,event:l});if(m.error)return ee({result:m,info:{iteration:p}});(d=m.matchUps)!=null&&d.length&&e.push(...m.matchUps),u=((m==null?void 0:m.roundNumber)??1)+1}return{matchUps:e}}function Rde(t){var l;let{tournamentRecord:e,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=t,o=t.scaleAccessor??((l=Nr[r])==null?void 0:l.accessor),s=e.participants??[];for(let u of i??[]){let c=s==null?void 0:s.find(p=>p.participantId===u),d=eV({scaleName:`${r}.${oA}`,participant:c,eventType:n});!d&&r&&(d=eV({scaleAccessor:o,participant:c,scaleName:r,eventType:n})),d&&!a[u]&&(a[u]=d)}return a}function eV({scaleType:t=vc,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){var o,s;let a=(s=(o=i&&Al({scaleAttributes:{eventType:n??Um,scaleType:t,scaleName:r},participant:i}))==null?void 0:o.scaleItem)==null?void 0:s.scaleValue;return e&&Nt(a)?a[e]:a}function XO(t){var c,d;let e=Cde(t);if(e!=null&&e.error)return e;let i=F6(t);if(i.error)return i;let r=Ede(t);if(r.error)return r;let n=Rde(t),a=((c=t.tournamentRecord)==null?void 0:c.isMock)??t.isMock,o=t.eventType??((d=t.event)==null?void 0:d.eventType),s=[],l=[],u;for(let p of Te(1,(t.roundsCount??1)+1)){let m=BO({...t,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:s,adHocRatings:n,roundNumber:u,eventType:o,isMock:a});if(m.error)return m;let{matchUps:h,...f}=m;f.modifiedScaleValues&&(n=f.modifiedScaleValues),l.push({...f,iteration:p,matchUpsCount:h==null?void 0:h.length}),u=((f==null?void 0:f.roundNumber)??1)+1,h!=null&&h.length&&s.push(...h)}return{...X,matchUps:s,roundResults:l}}function Ede(t){var n,a,o;if(t.structureId)return t.structureId;let e=t.drawDefinition,i=(a=(n=e==null?void 0:e.structures)==null?void 0:n.filter(s=>s.stageSequence===1))==null?void 0:a.reduce((s,l)=>{let u=l.stage&&Sm[l.stage];return zn({structure:l})&&u>(Sm[s==null?void 0:s.stage]||1)?l:s},void 0),r=(o=e==null?void 0:e.structures)==null?void 0:o.find(s=>s.structureId===(i==null?void 0:i.structureId));return r?zn({structure:r})?{structure:r}:{error:Xp}:{error:Ci}}function Cde(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:se,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==_a?{error:Xp}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:se,info:"Missing Entries"}:{error:void 0}}function Mde(t){var c,d;let{tournamentRecord:e,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:o}=t,s=(c=o==null?void 0:o.entries)==null?void 0:c.filter(({entryStage:p,entryStatus:m})=>(!p||p===Oe)&&m&&ds.includes(m)),l=s==null?void 0:s.map(Ut),u=s?Math.floor(s.length/2):0;if(t.automated)return Nde({...t,participantIds:l});{let p=JO({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:u,idPrefix:n,isMock:a,event:o});if(p.error)return p;(d=p.matchUps)!=null&&d.length&&JT({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:r,event:o})}return{...X}}function Nde(t){var l,u;let{restrictEntryStatus:e,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:o}=t.drawMatic??{},s=XO({...t,eventType:((l=t.drawMatic)==null?void 0:l.eventType)??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:o??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:r,matchUpIds:n});return s.error?s:((u=s==null?void 0:s.matchUps)!=null&&u.length&&JT({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:s.matchUps,event:t.event,structureId:r}),{...X})}function Ade({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:u}){var y,I;r=r??n;let c=it({drawDefinition:o,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:Ci};let{positionAssignments:p}=Er({structure:d}),m=(p==null?void 0:p.length)||0;if(u>m)return{error:EG};let h=(y=d.structures)==null?void 0:y.length,f=ot(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),g=(I=iO({roundRobinGroupsCount:h,drawSize:m}))==null?void 0:I.seedGroups,{seedsCount:v}=Eb({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:m});return v&&(a!=null&&a[vs])&&u>v&&e&&(u=v),d.seedLimit=u,d.seedAssignments=Te(1,u+1).map(b=>{let S=g==null?void 0:g.find(T=>T.includes(b)),w=S&&Math.min(...S),U=f&&b>=f?w:b;return{participantId:void 0,seedNumber:b,seedValue:U}}),li({drawDefinition:o,structureIds:[l]}),{...X,seedLimit:u}}function gh({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:o,stage:s}){if(!e)return{error:ge};return a=a??(o==null?void 0:o.entries)??[],{scaledEntries:a.filter(c=>(!s||!c.entryStage||c.entryStage===s)&&(!n||!c.entryStageSequence||c.entryStageSequence===n)&&ds.includes(c.entryStatus)).map(c=>{let{participantId:d}=c,{scaleItem:p}=Wf({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...c,...p}}).filter(c=>{let d=c.scaleValue;return!r&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(r||l)};function l(c,d){return t?u(d)-u(c):u(c)-u(d)}function u(c){return parseFloat(c.scaleValue||(t?-1:1e5))}}function L6(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=is({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r==null?void 0:r.find(({structureId:m})=>!n.includes(m));if(!a)return ee({result:{error:Ci},stack:e});let o=a==null?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:u}=Bde({...t,structureId:o});(t.seededParticipants||t.event||t.seedingScaleName)&&xde({...t,seedsCount:s,structure:a,structureId:o});let c=t.automated!==!1&&t.drawType!==_a&&!(t.qualifyingOnly&&t.stage!==Ke),d=((r==null?void 0:r.length)||0)>1,p=c?kde({...t,multipleStructures:d,seedLimit:u,structureId:o}):{};return p!=null&&p.error?ee({result:p,stack:e}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function Ode({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{var o,s;let a=(s=(o=vt({name:yl,element:n}))==null?void 0:o.extension)==null?void 0:s.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!a||a===r)&&gp.includes(n.entryStatus)})}function kde(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=vb({...t,seedsOnly:e});if(i.error)return i;let r=i==null?void 0:i.positionAssignments,n=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function xde(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(Ut);e?Fde({...t,enteredParticipantIds:a}):(n||i)&&Lde({...t,enteredParticipantIds:a})}function Fde(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:u,event:c}=t,d=u?mh({provisionalPositioning:e,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:u}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,m)=>p.seedNumber<m.seedNumber?-1:p.seedNumber<m.seedNumber?1:0).forEach(p=>{let{participantId:m,seedNumber:h,seedValue:f}=p;zg({provisionalPositioning:e,tournamentRecord:n,drawDefinition:o,seedingProfile:s,participantId:m,seedBlockInfo:d,structureId:l,seedNumber:h,seedValue:f,event:c})})}function Lde(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:m}=(d==null?void 0:d.category)||{},h=d==null?void 0:d.eventType,f=_de({...t,ageCategoryCode:m,categoryName:p,eventType:h})||l&&$de({...t,ageCategoryCode:m,categoryName:p,eventType:h}),g=(f==null?void 0:f.length)??0;g<e&&(e=g),f==null||f.filter(({participantId:v})=>r.includes(v)).slice(0,a||e).forEach((v,y)=>{let I=y+1,{participantId:b,scaleValue:S}=v,w=(n==null?void 0:n[I])||S||I;zg({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:u,participantId:b,structureId:c,seedNumber:I,seedValue:w,event:d})})}function _de(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:o}=t,{categoryName:s,ageCategoryCode:l}=(o==null?void 0:o.category)||{},u=o==null?void 0:o.eventType,c={scaleName:i||s||l||o.eventId,scaleType:Ml,eventType:u};return gh({scaleAttributes:c,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function $de(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:o,ageCategoryCode:s}=(r==null?void 0:r.category)||{},l=r==null?void 0:r.eventType;return gh({scaleAttributes:{scaleName:o||s,scaleType:Uc,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function Bde(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=Ode(t);e>i.length&&(e=i.length);let{seedLimit:r}=Ade({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function Vde(t){var b;let e=_O({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:o,seedingProfile:s,participants:l,drawEntries:u,placeByes:c,drawSize:d,drawType:p,entries:m}=t,h=[],f=[],g=jde({suppressDuplicateEntries:r,ignoreStageSpace:n,drawDefinition:i,drawEntries:u,drawType:p,entries:m});if(g.error)return g;let v=p===cp?0:et(t.seedsCount??0),y=L6({...t,qualifyingOnly:!d||o,appliedPolicies:a,drawDefinition:i,seedingProfile:s,participants:l,stage:Oe,seedsCount:v,placeByes:c,drawSize:d,entries:m});if(y.error&&!y.conflicts)return y;(b=y.positioningReport)!=null&&b.length&&h.push({[Oe]:y.positioningReport});let I=y.structureId;return y.conflicts&&(f=y.conflicts),p===_a&&t.roundsCount&&Mde({...t,drawDefinition:i,structureId:I}),{drawDefinition:i,positioningReports:h,conflicts:f,structureId:I}}function jde(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let o of a){if(r&&o.entryStage&&o.entryStage!==Oe)continue;let s={...o,ignoreStageSpace:e??n===_a,entryStage:o.entryStage??Oe,event:t.event,drawDefinition:i,drawType:n},l=qA(s);if(r&&l.error)return l}return{error:void 0}}var Gde=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),Hde=Gde;function zde(t){let{drawId:e=Gt(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=Hde();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function QO(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:o,event:s}=t,l=ze(t,[{[Fn]:!0,[eA]:!0}]);if(l.error)return l;if(!Sa({matchUpFormat:n}))return{error:Ay};let u="setMatchUpFormat";if(o){let c=Ui({drawDefinition:r,matchUpId:o,event:s});if(c.error)return c;let d=c.matchUp;if((d==null?void 0:d.matchUpType)===lr)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:oa};d&&(d.matchUpFormat=n,Rt({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:u,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===lr)return{error:Vl};for(let c of e){let d=it({drawDefinition:r,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if((s==null?void 0:s.eventType)===lr)return{error:Vl};let c=it({drawDefinition:r,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),li({drawDefinition:r,structureIds:e}),{...X}}function Wde({tieFormat:t}){let e=Hn({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Gt());return{tieFormat:t}}function qde({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:r,tieFormat:n,event:a}){if((i||n)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&n&&JSON.stringify(a.tieFormat)===JSON.stringify(n))){if(n){let o=Wde({tieFormat:n});if(o.error)return o;e.tieFormat=o.tieFormat??n}else if(i){let o=QO({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}r&&(e.matchUpType=r)}return{error:void 0}}var _6={};bt(_6,{attachPolicies:()=>Vd,findPolicy:()=>hp,getAppliedPolicies:()=>$t,getPolicyDefinitions:()=>qu,mutate:()=>$6,query:()=>V6,removePolicy:()=>B6});var $6={};bt($6,{attachPolicies:()=>Vd,removePolicy:()=>B6});function B6(t){let e=ze(t,[{[Zae]:!0,_anyOf:{[mn]:!1,[wr]:!1,[Fn]:!1,[Hc]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return tV(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ge};for(let a of n){let o=t.tournamentRecords[a],s=tV(t,o);if(s.error)return s;i=!0}}else return{error:ge};return i?{...X}:{error:Qp}}function tV(t,e){let i=$t(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?Lt({element:e,extension:{name:kI,value:i}}):Un({element:e,name:kI}),{...X}):{error:Qp}}var V6={};bt(V6,{findPolicy:()=>hp,getAppliedPolicies:()=>$t,getPolicyDefinitions:()=>qu});var Yde={[vs]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Hl]:{positioning:Ad},[es]:{positioning:Ad}},positioning:Gae},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},r1=Yde;function Kde({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return ee({info:"policyDefinitions must be an object",result:{error:se},stack:r});let n={[yS]:t==null?void 0:t[yS]};return e?Jde({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&Vd({drawDefinition:i,policyDefinitions:n}),!(t!=null&&t[vs])&&!(e!=null&&e[vs])&&(Vd({policyDefinitions:r1,drawDefinition:i}),t&&Object.assign(t,r1)),{error:void 0}}function Jde({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e==null?void 0:e[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(Vd({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function Xde(t){var v,y,I,b,S;let{tournamentRecord:e,matchUpFormat:i,appliedPolicies:r,policyDefinitions:n,matchUpType:a,tieFormat:o,drawType:s,stack:l,event:u}=t,c=t.drawId?(v=u==null?void 0:u.drawDefinitions)==null?void 0:v.find(w=>w.drawId===t.drawId):void 0;c&&s!==c.drawType&&(c.drawType=s);let d=c??zde({processCodes:t.processCodes,drawId:t.drawId,drawType:s}),p=qde({tournamentRecord:e,drawDefinition:d,matchUpFormat:i,matchUpType:a,tieFormat:o,event:u});if(p.error)return ee({result:p,stack:l});let m=Kde({appliedPolicies:r,policyDefinitions:n,drawDefinition:d,stack:l});if(m.error)return m;let h=(I=(y=c==null?void 0:c.structures)==null?void 0:y.find(w=>w.stage===Oe&&w.stageSequence===1))==null?void 0:I.structureId,f=c?(b=c.structures)==null?void 0:b.filter(w=>w.stage===Ke):[],g=(f==null?void 0:f.length)===1&&!((S=f[0].matchUps)!=null&&S.length)&&f[0].structureId;return{drawDefinition:d,structureId:h,existingDrawDefinition:c,existingQualifyingPlaceholderStructureId:g}}function Qde(t){var c,d;let e="generateOrGetExisting",i=[],r=[],n=Xde(t);if(n.error)return ee({result:n,stack:e});let a=n.existingDrawDefinition,o=n.drawDefinition??{},s=n.structureId,l=t.drawEntries??t.eventEntries??[],u=n.existingQualifyingPlaceholderStructureId&&Tde({...t,...n})||Vde({...t,...n,entries:l});return u.error?ee({result:u,stack:e}):((c=u.positioningReports)!=null&&c.length&&i.push(...u.positioningReports??[]),(d=u.conflicts)!=null&&d.length&&r.push(...u.conflicts??[]),o=u.drawDefinition,s=u.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:o,structureId:s,conflicts:r,entries:l})}function Zde(t){var f,g,v;let{qualifyingPlaceholder:e,qualifyingProfiles:i,existingDrawDefinition:r,positioningReports:n,appliedPolicies:a,qualifyingOnly:o,drawDefinition:s,seedingProfile:l,participants:u,structureId:c,entries:d,stack:p}=t,m=e&&!(i!=null&&i.length)&&!r,h=[];if(i){let y=(w,U)=>w.stageSequence-U.stageSequence,I=(w,U)=>w.roundTarget-U.roundTarget,b=[],S=1;i.sort(I);for(let w of i){if(!Array.isArray(w.structureProfiles))return ee({info:Bd("structureProfiles"),result:{error:Xe},stack:p});S=w.roundTarget||S;let U=((f=w.structureProfiles)==null?void 0:f.sort(y))||[],T=1;for(let D of U){let{qualifyingRoundNumber:P,qualifyingPositions:E,seededParticipants:R,seedingScaleName:N,seedsCount:A=0,seedByRanking:M,placeByes:C,drawSize:O}=D,k=L6({...t,seedingProfile:D.seedingProfile??l,stageSequence:T,qualifyingRoundNumber:P,preparedStructureIds:b,qualifyingPositions:E,seededParticipants:R,stage:Ke,seedingScaleName:N,appliedPolicies:a,drawDefinition:s,qualifyingOnly:o,seedByRanking:M,participants:u,roundTarget:S,seedsCount:A,placeByes:C,drawSize:O,entries:d});if(k.error)return k;k.structureId&&b.push(k.structureId),T+=1,(g=k.conflicts)!=null&&g.length&&h.push(...k.conflicts),(v=k.positioningReport)!=null&&v.length&&n.push({[Ke]:k.positioningReport})}S+=1}}else if(c&&m){let y=so({structureName:Zr(Ke),stage:Ke}),{link:I}=Ib({sourceStructureId:y.structureId,targetStructureId:c,sourceRoundNumber:0,linkType:Su});s.structures||(s.structures=[]),s.structures.push(y),s.links||(s.links=[]),s.links.push(I)}return{qualifyingConflicts:h,error:void 0}}var j6={};bt(j6,{addGoesTo:()=>$d,allCompetitionMatchUps:()=>As,allDrawMatchUps:()=>Sn,allEventMatchUps:()=>iu,allPlayoffPositionsFilled:()=>uO,allTournamentMatchUps:()=>Vr,analyzeDraws:()=>Pb,analyzeMatchUp:()=>HI,analyzeTournament:()=>lk,bulkUpdatePublishedEventIds:()=>dk,calculateWinCriteria:()=>Ih,categoryCanContain:()=>Ly,checkMatchUpIsComplete:()=>Rd,checkValidEntries:()=>ZT,compareTieFormats:()=>Mu,competitionScheduleMatchUps:()=>kb,courtGridRows:()=>ID,credits:()=>epe,drawMatchUps:()=>Dk,eventMatchUps:()=>wD,filterMatchUps:()=>uu,filterParticipants:()=>pb,findDrawDefinition:()=>OO,findExtension:()=>vt,findVenue:()=>tu,getAggregateTeamResults:()=>sk,getAllDrawMatchUps:()=>hr,getAllEventData:()=>pk,getAllStructureMatchUps:()=>Wt,getAllowedDrawTypes:()=>lD,getAllowedMatchUpFormats:()=>nk,getAppliedPolicies:()=>$t,getAssignedParticipantIds:()=>Ip,getAvailableMatchUpsCount:()=>XT,getAvailablePlayoffProfiles:()=>yb,getCategoryAgeDetails:()=>wm,getCheckedInParticipantIds:()=>sh,getCompetitionDateRange:()=>cD,getCompetitionMatchUps:()=>GI,getCompetitionParticipants:()=>ZO,getCompetitionPenalties:()=>ak,getCompetitionVenues:()=>Mb,getCourtInfo:()=>kT,getCourts:()=>Pk,getDrawData:()=>pD,getDrawDefinitionTimeItem:()=>NA,getDrawParticipantRepresentativeIds:()=>NO,getDrawStructures:()=>is,getDrawTypeCoercion:()=>Rb,getEligibleVoluntaryConsolationParticipants:()=>MO,getEntriesAndSeedsCount:()=>yD,getEvent:()=>Ck,getEventData:()=>mD,getEventMatchUpFormatTiming:()=>gk,getEventProperties:()=>Rk,getEventPublishStatus:()=>To,getEventStructures:()=>jT,getEventTimeItem:()=>Ky,getEvents:()=>Ek,getFlightProfile:()=>Gi,getHomeParticipantId:()=>bk,getLinkedTournamentIds:()=>Wy,getMatchUpCompetitiveProfile:()=>nb,getMatchUpContextIds:()=>wk,getMatchUpDailyLimits:()=>SD,getMatchUpDailyLimitsUpdate:()=>vk,getMatchUpDependencies:()=>ps,getMatchUpFormat:()=>Uk,getMatchUpFormatTiming:()=>ab,getMatchUpFormatTimingUpdate:()=>fk,getMatchUpScheduleDetails:()=>xT,getMatchUpType:()=>FT,getMatchUpsMap:()=>sn,getMatchUpsStats:()=>Sk,getMatchUpsToSchedule:()=>hD,getMaxEntryPosition:()=>hk,getModifiedMatchUpFormatTiming:()=>bD,getPairedParticipant:()=>rs,getParticipantEventDetails:()=>ek,getParticipantIdFinishingPositions:()=>AO,getParticipantMembership:()=>tk,getParticipantResults:()=>Ub,getParticipantScaleItem:()=>Wf,getParticipantSchedules:()=>ik,getParticipantSignInStatus:()=>rk,getParticipantTimeItem:()=>AA,getParticipants:()=>Mi,getPersonRequests:()=>wp,getPolicyDefinitions:()=>qu,getPositionAssignments:()=>BI,getPositionsPlayedOff:()=>qg,getPredictiveAccuracy:()=>yk,getProfileRounds:()=>vD,getPublishState:()=>dh,getRoundMatchUps:()=>En,getRounds:()=>Tk,getScaleValues:()=>Lg,getScaledEntries:()=>gh,getScheduledRoundsDetails:()=>Nb,getSchedulingProfile:()=>Xu,getSchedulingProfileIssues:()=>mk,getSeedingThresholds:()=>rO,getSeedsCount:()=>Eb,getStructureSeedAssignments:()=>ho,getTeamLineUp:()=>_d,getTieFormat:()=>ck,getTimeItem:()=>wo,getTournamentIds:()=>Hy,getTournamentInfo:()=>vh,getTournamentPenalties:()=>uD,getTournamentPersons:()=>ok,getTournamentPoints:()=>dD,getTournamentPublishStatus:()=>db,getTournamentStructures:()=>lO,getTournamentTimeItem:()=>CT,getValidGroupSizes:()=>fb,getVenueData:()=>jf,getVenuesAndCourts:()=>Ju,isAdHoc:()=>zn,isCompletedStructure:()=>Cc,isValidForQualifying:()=>FO,isValidMatchUpFormat:()=>Sa,matchUpActions:()=>QT,participantScaleItem:()=>Al,participantScheduledMatchUps:()=>Ik,positionActions:()=>xO,publicFindCourt:()=>jA,publicFindVenue:()=>VA,tallyParticipantResults:()=>Yg,tieFormatGenderValidityCheck:()=>nT,tournamentMatchUps:()=>UD,validMatchUp:()=>MT,validMatchUps:()=>So,validateCollectionDefinition:()=>_y,validateLineUp:()=>VT});function epe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var G6={};bt(G6,{filterParticipants:()=>pb,getCompetitionParticipants:()=>ZO,getPairedParticipant:()=>rs,getParticipantEventDetails:()=>ek,getParticipantMembership:()=>tk,getParticipantScaleItem:()=>Wf,getParticipantSchedules:()=>ik,getParticipantSignInStatus:()=>rk,getParticipantTimeItem:()=>AA,getParticipants:()=>Mi,getScaleValues:()=>Lg,participantScaleItem:()=>Al,validateLineUp:()=>VT});function ZO(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Oi};let i=[],r={},n={},a={},o=[],s={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:m,matchUps:h,derivedEventInfo:f,derivedDrawInfo:g}=Mi({...t,tournamentRecord:u});Object.assign(s,d),Object.assign(r,p),Object.assign(n,f),Object.assign(a,g),i.push(...m??[]),o.push(...h??[]),c==null||c.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:s,participants:i,...X,matchUps:o}}function ek({tournamentRecord:t,participantId:e}){if(!t)return{error:ge};if(!e)return{error:mr};let i=[e].concat((t.participants??[]).filter(r=>{var n;return(r==null?void 0:r.participantType)&&[Kt,ft].includes(r.participantType)&&((n=r.individualParticipantIds)==null?void 0:n.includes(e))}).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=((r==null?void 0:r.entries)??[]).map(a=>a.participantId);return Rn(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function tk({tournamentRecord:t,participantId:e}){if(!t)return{error:ge};if(!e)return{error:mr};let{participants:i}=Mi({participantFilters:{participantTypes:[Kt,ft,qa]},tournamentRecord:t});return(i??[]).filter(r=>{var n;return(n=r.individualParticipantIds)==null?void 0:n.includes(e)}).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function ik({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:ge};if(typeof t!="object")return{error:Hu,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=Vr({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),o=ps({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],s={};for(let l of a){let{sides:u}=l,c,d=(u==null?void 0:u.map(m=>{if(m.participant)return[m.participant].concat(...m.participant.individualParticipants||[]);o[l.matchUpId]&&!c&&(c=(o[l.matchUpId]||[]).map(h=>n[h]).filter(({winningSide:h,bye:f})=>!h&&!f))}).filter(Boolean).flat())??[];for(let m of d){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].matchUps.push(l)}let p=(c==null?void 0:c.map(({sides:m})=>m).flat().map(({participant:m})=>m&&[m].concat(...m.individualParticipants||[])).filter(Boolean).flat())||[];for(let m of p){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...X}}function rk({tournamentRecord:t,participantId:e}){if(!t)return{error:ge};if(!e)return{error:mr};let{participant:i}=Yc({tournamentRecord:t,participantId:e});if(!i)return{error:zi};let{timeItem:r}=wo({itemType:Yy,element:i});return r&&r.itemValue===FI&&FI}var H6={};bt(H6,{analyzeDraws:()=>Pb,analyzeTournament:()=>lk,getAggregateTeamResults:()=>sk,getAllowedDrawTypes:()=>lD,getAllowedMatchUpFormats:()=>nk,getAppliedPolicies:()=>$t,getCompetitionDateRange:()=>cD,getCompetitionPenalties:()=>ak,getPolicyDefinitions:()=>qu,getTournamentInfo:()=>vh,getTournamentPenalties:()=>uD,getTournamentPersons:()=>ok,getTournamentPoints:()=>dD,getTournamentStructures:()=>lO,getTournamentTimeItem:()=>CT});function nk({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:ge};let{appliedPolicies:r}=$t({tournamentRecord:t});return(((n=r==null?void 0:r[Ns])==null?void 0:n.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function lD({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:ge};let{appliedPolicies:r}=$t({tournamentRecord:t});return(((n=r==null?void 0:r[bS])==null?void 0:n.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function uD({tournamentRecord:t}){if(!t)return{error:ge};let e=((t==null?void 0:t.participants)??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:o}=a||{};i[o]?i[o].participants.push(n):i[o]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function ak({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Oi};let e=[];for(let i of Object.values(t)){let{penalties:r}=uD({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function z6({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:m,notes:h})=>({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:m,notes:h}))(t)}}var tpe={[Gy]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},ipe=tpe;function vh(t){var s,l,u,c;let{tournamentRecord:e}=t??{};if(!e)return{error:ge};let i=(({tournamentId:d,tournamentRank:p,tournamentStatus:m,formalName:h,tournamentName:f,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:I,startDate:b,endDate:S,hostCountryCode:w,venues:U,notes:T,updatedAt:D})=>({tournamentId:d,tournamentRank:p,tournamentStatus:m,formalName:h,tournamentName:f,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:I,startDate:b,endDate:S,hostCountryCode:w,venues:U,notes:T,updatedAt:D}))(e),r=((s=Mi({participantFilters:{participantRoles:[nq,KA,aq,oq,lq]},policyDefinitions:ipe,tournamentRecord:e}))==null?void 0:s.participants)??[];r&&(i.tournamentContacts=r);let n=(l=dh({tournamentRecord:e}))==null?void 0:l.publishState,a=((c=(u=n==null?void 0:n.tournament)==null?void 0:u.status)==null?void 0:c.publishedEventIds)||[],o=[];for(let d of e.events??[])if(!(t!=null&&t.usePublishState)||a.includes(d.eventId)){let p=z6({event:d}).eventInfo;p&&o.push(p)}return i.timeItemValues=m3({element:e}),i.publishState=n==null?void 0:n.tournament,i.eventInfo=o,{tournamentInfo:Ce(je(i),!1,!0),...X}}function cD({tournamentRecords:t}){if(!Nt(t))return{error:Oi};let e=Object.keys(t??{}).reduce((n,a)=>{let o=t[a],{tournamentInfo:{startDate:s,endDate:l}}=vh({tournamentRecord:o}),u=s&&new Date(mt(s));(!n.startDate||u&&u<n.startDate)&&(n.startDate=u);let c=l&&new Date(mt(l));return(!n.endDate||c&&c>n.endDate)&&(n.endDate=c),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&mt(e.startDate.toISOString()),r=e.endDate&&mt(e.endDate.toISOString());return!i||!r?{error:qG}:{startDate:i,endDate:r}}function ok({tournamentRecord:t,participantFilters:e}){if(!t)return{error:ge};let i=t.participants||[];e&&(i=pb({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:o}=a.person;r[o]?r[o].participantIds.push(a.participantId):r[o]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function sk(t){var d,p,m,h,f,g,v,y;let e=ze(t,[{[wr]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},r={},n=I=>{var S,w,U;let b=(S=I==null?void 0:I.individualParticipants)==null?void 0:S.map(T=>{var D;return((D=T.teams)==null?void 0:D.length)===1&&T.teams[0]});return((w=I==null?void 0:I.teams)==null?void 0:w.length)===1&&((U=I==null?void 0:I.teams)==null?void 0:U[0])||(b==null?void 0:b[0].participantId)===(b==null?void 0:b[1].participantId)&&(b==null?void 0:b[0])},{matchUps:a,participants:o}=Mi({participantFilters:{participantTypes:[St]},withRankingProfile:!0,withStatistics:!0,...t});for(let I of o??[]){if(I.participantType===Vn)continue;((p=(d=I.draws)==null?void 0:d[0])==null?void 0:p.drawId)==="draw-0-3"&&console.log(I.participantType,I.draws[0].finishingPositionRange);let b=n(I);if(b)for(let S of(I==null?void 0:I.draws)??[]){let w=(m=S==null?void 0:S.finishingPositionRange)==null?void 0:m.join("-");if(w&&(i!=null&&i[w])){let U=b==null?void 0:b.participantId,T=S==null?void 0:S.drawId,D=`${U}|${T}|${w}`;r[D]=i[w]}}}let s=I=>({teamName:I,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(I,b,S)=>{I[b]===void 0&&(I[b]=0),I[b]+=S},u={},c={};for(let I of a??[]){let{sides:b,matchUpFormat:S}=I,w=S&&kn(S);if((b==null?void 0:b.length)===2&&((h=w.setFormat)!=null&&h.timed)&&(!w.finalSetFormat||(f=w.finalSetFormat)!=null&&f.timed))for(let U of b){let T=n(U.participant),D=T==null?void 0:T.participantId,P=(g=U.participant)==null?void 0:g.participantId,E=T==null?void 0:T.participantName,R=U.sideNumber,N=((v=U.participant)==null?void 0:v.individualParticipantIds)||P&&[P]||[];if(N.forEach(A=>{A&&!u[A]&&(u[A]=s(E))}),D&&R){c[D]||(c[D]=s(E));let A=[...N.map(C=>u[C]),c[D]];I.winningSide&&(R===I.winningSide?A.forEach(C=>l(C,"win",1)):A.forEach(C=>l(C,"loss",1)));let M=((y=I.score)==null?void 0:y.sets)||[];for(let C of M){let O=(C==null?void 0:C[`side${3-R}Score`])||0,k=(C==null?void 0:C[`side${R}Score`])||0,x=k-O;A.forEach(F=>l(F,"pointsPlayed",k+O)),A.forEach(F=>l(F,"points",k)),A.forEach(F=>l(F,"diff",x))}}}}for(let I of Object.keys(r)){let[b]=I.split("|");c[b]&&(c[b].bonus+=r[I],c[b].pointsPct=parseFloat((c[b].points/c[b].pointsPlayed).toFixed(2)),c[b].standingPoints=c[b].win+c[b].bonus)}for(let I of Object.keys(u))u[I].pointsPct=parseFloat((u[I].points/u[I].pointsPlayed).toFixed(2));return{...X,individualResults:u,teamResults:c}}function rpe(t){var a,o,s,l,u,c,d;let e=((o=(a=t.participants)==null?void 0:a.filter(({participantType:p})=>p===Kt))==null?void 0:o.length)===2,i=((s=t.events)==null?void 0:s.length)===1&&t.events[0],r=((l=i==null?void 0:i.drawDefinitions)==null?void 0:l.length)===1&&i.drawDefinitions[0],n=((d=(c=((u=r==null?void 0:r.structures)==null?void 0:u.length)===1&&r.structures[0])==null?void 0:c.positionAssignments)==null?void 0:d.length)===2;return!!(i.tieFormat&&e&&n)}function lk({tournamentRecord:t}){var n;if(!t)return{error:ge};let{drawsAnalysis:e}=Pb({tournamentRecord:t}),i={isDual:rpe(t),drawsAnalysis:e},r=Mi({tournamentRecord:t});return(n=r.missingParticipantIds)!=null&&n.length&&(i.missingParticipantIds=r.missingParticipantIds),{...X,analysis:i}}function W6(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function npe(t){let{participation:e={},awardProfiles:i,startDate:r,eventType:n,drawSize:a,drawType:o,category:s,endDate:l,level:u}=t,{participationOrder:c,flightNumber:d,rankingStage:p}=e,m=h=>!r&&!l||!h.dateRanges?!0:h.dateRanges.some(f=>{let g=!r||!f.startDate||new Date(r)>new Date(f.startDate),v=!l||!f.endDate||new Date(l)<=new Date(f.endDate);return g&&v});return{awardProfile:i.find(h=>{var f,g,v,y,I,b,S,w,U,T;return m(h)&&(!h.maxFlightNumber||d<=h.maxFlightNumber)&&(!((f=h.drawTypes)!=null&&f.length)||((g=h.drawTypes)==null?void 0:g.includes(o)))&&(!((v=h.drawSizes)!=null&&v.length)||h.drawSizes.includes(a))&&(!((y=h.stages)!=null&&y.length)||h.stages.includes(p))&&(!((I=h.levels)!=null&&I.length)||h.levels.includes(u))&&(!h.maxDrawSize||a<=h.maxDrawSize)&&(!h.drawSize||h.drawSize===a)&&(!h.maxLevel||u<=h.maxLevel)&&(!d||!((S=(b=h.flights)==null?void 0:b.flightNumbers)!=null&&S.length)||h.flights.flightNumbers.includes(d))&&(!h.participationOrder||h.participationOrder===c)&&(!((w=h.category)!=null&&w.ageCategoryCodes)||h.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((U=h.eventTypes)!=null&&U.length)||((T=h.eventTypes)==null?void 0:T.includes(n)))})}}function iV({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){var h,f;let o=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(I=>I.flight===g||I.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},s=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(ot(g)?g:0),I=W6(a,g==null?void 0:g.level);return{value:o(v,I)||ot(I)&&I||y}},l=0,u,c,d,p,m=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(I=>{var b;return I.drawSize===r||((b=I.drawSizes)==null?void 0:b.includes(r))}),v=i.find(I=>I.drawSize&&I.threshold&&r>I.drawSize),y=i.find(I=>{var b;return!I.drawSize&&!((b=I.drawSizes)!=null&&b.length)});m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m],y=y==null?void 0:y[m]),c=s(g,e).value,d=s(v,e).value,p=s(y,e).value,l=c||d||p,u=c&&g.requireWin||d&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(h=i==null?void 0:i.drawSizes)==null?void 0:h[r],v=i;m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m]),c=s(g,e).value,p=s(v,e).value,l=c||p,u=c?g.requireWin:v==null?void 0:v.requireWin}else ot(i)&&m===void 0&&(l=i);return e&&((f=n==null?void 0:n.pct)!=null&&f[e])&&(l=Math.round(l*n.pct[e])),{awardPoints:l,requireWin:u}}function dD({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){var v;if(!i)return{error:ge};let{policyDefinitions:n}=qu({policyTypes:[NU],tournamentRecord:i}),a=(e==null?void 0:e[NU])??(n==null?void 0:n[NU]);if(!a)return{error:j0};let o=a.awardProfiles,s=a.requireWinFirstRound,l=a.requireWinForPoints,{participants:u,derivedEventInfo:c,derivedDrawInfo:d,mappedMatchUps:p}=Mi({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),m=u==null?void 0:u.filter(y=>{var I;return(I=y.draws)==null?void 0:I.length}),h={},f={},g={};for(let y of m??[]){let{participantType:I,participantId:b,person:S,draws:w}=y;for(let U of w){let{drawId:T,structureParticipation:D,eventId:P}=U,E=c[P],R=d[T],N=R==null?void 0:R.drawType,{category:A,eventType:M}=E||{},C=U.startDate||E.startDate||i.startDate,O=U.endDate||E.endDate||i.endDate;if(M===Ta&&b!==Vn)continue;let k;if(o){let x=l,F=0,$=0,_=0,L;for(let B of D){let{finishingPositionRange:V,participationOrder:G,participantWon:j,flightNumber:z,rankingStage:W,winCount:q}=B;F+=q||0;let Y=R==null?void 0:R.drawSize,{awardProfile:re}=npe({awardProfiles:o,participation:B,eventType:M,startDate:C,category:A,drawSize:Y,drawType:N,endDate:O,level:r});if(re){if(!Y)continue;let J=Array.isArray(V)&&Math.max(...V),H=ct(V||[]).join("-"),Z=J&&W!==Ke&&(V==null?void 0:V.includes(Y));re.requireWinForPoints!==void 0&&(x=re.requireWinForPoints),re.requireWinFirstRound!==void 0&&(s=re.requireWinFirstRound);let{finishingPositionPoints:K={},finishingPositionRanges:ie,finishingRound:ae,pointsPerWin:oe,flights:ne}=re,de=Array.isArray(re.perWinPoints)?(v=re.perWinPoints)==null?void 0:v.find(we=>{var Ze;return(Ze=we.participationOrders)==null?void 0:Ze.includes(G)}):re.perWinPoints,ye=K.participationOrders,ce=0,ke;if((!ye||ye.includes(G))&&ie&&J){let we=ie[J];we&&({awardPoints:ce,requireWin:ke}=iV({flightNumber:z,valueObj:we,drawSize:Y,flights:ne,level:r}))}if(!ce&&ae&&G===1&&J){let we=ae[J];we&&({awardPoints:ce,requireWin:ke}=iV({participantWon:j,flightNumber:z,valueObj:we,drawSize:Y,flights:ne,level:r}))}if(Z&&s!==void 0&&(x=s),ke!==void 0&&(x=ke),ce>$&&(!x||q)&&($=ce,L=J),!ce&&oe&&q&&(_+=q*oe,L=H),!ce&&q&&de){let we=W6(r,de==null?void 0:de.level);we?_+=q*we:de.value&&(_+=q*de.value)}}if(k=$+_,I===Vn){let J=(y.matchUps||[]).filter(({structureId:H})=>H===B.structureId);for(let{matchUpId:H}of J){let Z=p[H],K=Z.sides.find(ie=>ie.participantId===b).sideNumber;if(Z.winningSice===K)for(let ie of Z.tieMatchUps)ie.winningSide}}}if(_||$){let B={winCount:F,positionPoints:$,rangeAccessor:L,perWinPoints:_,eventType:M,drawId:T,points:k},V=S==null?void 0:S.personId;V?(h[V]||(h[V]=[]),h[V].push(B)):I===ft?(g[b]||(g[b]=[]),g[b].push(B)):I===Vn&&(f[b]||(f[b]=[]),f[b].push(B))}}}}return{participantsWithOutcomes:m,personPoints:h,pairPoints:g,teamPoints:f,...X}}var q6={};bt(q6,{compareTieFormats:()=>Mu,getTieFormat:()=>ck,tieFormatGenderValidityCheck:()=>nT,validateCollectionDefinition:()=>_y});function $S(t){var n;if(!t)return{};let e=[],i=t.tieFormatName,r=(n=t.collectionDefinitions)==null?void 0:n.map(a=>{let{matchUpType:o,matchUpFormat:s,matchUpCount:l,category:u,gender:c}=a;e.includes(s)||e.push(s);let d=u==null?void 0:u.ageCategoryCode;return[l,o===Md?"D":"S",d,s,c].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:r}}function Mu({considerations:t={},descendant:e,ancestor:i}){var S,w;let r={},n={},{matchUpFormats:a,tieFormatDesc:o}=$S(e),{matchUpFormats:s,tieFormatDesc:l}=$S(i),u=ct((a??[]).filter(U=>!(s??[]).includes(U)).concat((s??[]).filter(U=>!(a??[]).includes(U)))),c=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionName:U})=>U).join("|")),d=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")),p=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U}))),m=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U})));r.collectionIds=bB(Object.keys(p),Object.keys(m)),n.collectionIds=bB(Object.keys(m),Object.keys(p)),r.collectionsValue=rV(p),n.collectionsValue=rV(m),r.groupsCount=((S=i==null?void 0:i.collectionGroups)==null?void 0:S.length)??(0-(((w=e==null?void 0:e.collectionGroups)==null?void 0:w.length)??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let h=r.collectionsValue.totalValue-n.collectionsValue.totalValue,f=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,v=n.collectionsValue.assignmentValues.some((U,T)=>{let D=r.collectionsValue.assignmentValues[T];return!D||U.valueKey!==D.valueKey||U.value!==D.value?!0:Array.isArray(U.value)?U.value.every((P,E)=>D.value[E]===P):!1}),y=c||d||l!==o||g||v||h!==0,I=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],b=I.length&&I;return{matchUpFormatDifferences:u,matchUpCountDifference:f,descendantDifferences:r,ancestorDifferences:n,orderDifference:d,valueDifference:h,nameDifference:c,descendantDesc:o,ancestorDesc:l,...X,different:y,invalid:b}}function rV(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(_T).reduce((n,a)=>{let o=t[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=o,m={collectionValueProfiles:s,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},h=Object.keys(m).filter(g=>![void 0,null].includes(m[g])&&(!Array.isArray(m[g])||m[g].length>0));h.length!==1&&e.push({collectionId:a});let f=h[0];if(f){let g=f==="collectionValueProfiles"?Object.values(s):m[f];i.push({valueKey:f,value:g})}return r+=u,s!=null&&s.length?n+s.reduce((g,v)=>g+v.value,0):u?ot(c)?n+c*u:ot(d)?n+d*u:ot(p)?n+p*u:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function uk(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=Y6(t);return{matchUp:Ce(e,!0,!0),error:i}}function Y6({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:u,drawId:c,event:d}){var h;if(!i)return{error:ge};if(typeof s!="string")return{error:yn};if(!a||!d){let f=(Vr({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find(g=>g.matchUpId===s);if(!f)return{error:pn};({eventId:u,drawId:c}=f),{event:d,drawDefinition:a}=Wn({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:Fa};n&&!r&&(r=Yu({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:u??(d==null?void 0:d.eventId),drawId:c},{participants:m=[]}=mp({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(o){let f=(Sn({context:l?p:void 0,participants:m,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!f)return{error:pn};let g=(h=a==null?void 0:a.structures)==null?void 0:h.find(v=>v.structureId===f.structureId);return{drawDefinition:a,structure:g,matchUp:f}}else{let{matchUp:f,structure:g}=Ui({context:l?p:void 0,tournamentParticipants:m,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:s,inContext:l,event:d});return{matchUp:f,structure:g,drawDefinition:a}}}function ck({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:o,event:s}){var m,h,f,g,v;if(!t)return{error:ge};if(!o&&!s&&!i&&!r)return ee({result:{error:Xe},stack:"getTieFormat"});a&&!s&&(s=(m=t.events)==null?void 0:m.find(y=>y.eventId===a));let l=uk({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:o,event:s});if(r&&(l!=null&&l.error))return l;if(!e&&(l!=null&&l.drawDefinition)&&(e=l==null?void 0:l.drawDefinition),n=n??(l==null?void 0:l.structure),!n&&i&&!r){if(!e)return{error:$s};let y=it({drawDefinition:e,structureId:i});if(y.error)return y;n=y.structure}let u=((n==null?void 0:n.tieFormat)||(n==null?void 0:n.tieFormatId))&&((h=vn({structure:n,drawDefinition:e,event:s}))==null?void 0:h.tieFormat),c=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((f=vn({drawDefinition:e,event:s}))==null?void 0:f.tieFormat),d=(g=vn({event:s}))==null?void 0:g.tieFormat,p=(v=vn({matchUp:l==null?void 0:l.matchUp,drawDefinition:e,structure:n,event:s}))==null?void 0:v.tieFormat;return{...X,matchUp:l==null?void 0:l.matchUp,structureDefaultTieFormat:qr(u),eventDefaultTieFormat:qr(d),drawDefaultTieFormat:qr(c),tieFormat:qr(p),structure:n}}var K6={};bt(K6,{bulkUpdatePublishedEventIds:()=>dk,getAllEventData:()=>pk,getCourtInfo:()=>kT,getDrawData:()=>pD,getEventData:()=>mD,getEventPublishStatus:()=>To,getPublishState:()=>dh,getTournamentPublishStatus:()=>db,getVenueData:()=>jf});function dk({tournamentRecord:t,outcomes:e}){var n;if(!t)return{error:ge};if(!(e!=null&&e.length))return{error:Xe,info:"Missing outcomes"};let i=e.reduce((a,o)=>{let{drawId:s,eventId:l}=o;return l&&s&&(a[l]?a[l].includes(s)||a[l].push(s):a[l]=[s]),a},{}),r=Object.keys(i);return{publishedEventIds:((n=t.events)==null?void 0:n.filter(a=>r.includes(a.eventId))).filter(a=>{let o=To({event:a}),{drawDetails:s,drawIds:l}=o??{},{eventId:u}=a;return i[u].filter(c=>{let d=s?Object.keys(o.drawDetails).filter(p=>WA({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(c))||d.includes(c)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:i}}function J6({dates:t=[],extension:e}){var r;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=Nt(e.value)?(r=e.value)==null?void 0:r.dates:void 0;if(Array.isArray(i))return i!=null&&i.length?!!i.filter(n=>!t.length||t.includes(n)).length:!1}function X6({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){var o;let n={...Ce(r,t,!0),venueId:i.venueId},{extension:a}=vt({name:Us,element:r});if(e&&a){let s=Nt(a.value)?(o=a.value)==null?void 0:o.dates:void 0,l=(a==null?void 0:a.value)===!0?[]:n.dateAvailability.map(u=>{let c=u.date;if(!(!c||s.includes(c)))return u}).filter(Boolean);n.dateAvailability=l}return{inContextCourt:n}}function Ju(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},o=[],s=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])if(!(r.length&&!r.includes(p.venueId))){if(i){let{extension:m}=vt({name:Us,element:p});if(m!=null&&m.value)continue}o.includes(p.venueId)||(u.push(Ce(p,e,!0)),o.push(p.venueId));for(let m of p.courts??[])if(!s.includes(m.courtId)){if(i){let{extension:f}=vt({name:Us,element:m});if(J6({extension:f,dates:n}))continue}let{inContextCourt:h}=X6({convertExtensions:e,ignoreDisabled:i,venue:p,court:m});l.push(h),s.push(m.courtId)}}}),{courts:l,venues:u,...X}}function ape({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:Oi};let n=Ce(e.venues??[],t).filter(o=>{if(!i)return o;let{extension:s}=vt({name:Us,element:o});return!(s!=null&&s.value)&&o}).filter(Boolean),a=n.reduce((o,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(u=>{if(!i&&!(r!=null&&r.length))return u;let{extension:c}=vt({name:Us,element:u});return J6({extension:c,dates:r})}).filter(Boolean).map(u=>{let{inContextCourt:c}=X6({convertExtensions:t,ignoreDisabled:i,venue:s,court:u});return c});return l.length?o.concat(l):o},[]);return{venues:n,courts:a}}function Mb({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Oi}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:o}=ape({tournamentRecord:a,dates:i});return o==null||o.forEach(s=>{let{venueId:l,courts:u}=s;(!e||u!=null&&u.length)&&!r.venueIds.includes(l)&&(r.venues.push(s),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function pk({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:ge};let i=t.events||[],r=(t==null?void 0:t.participants)||[],{tournamentInfo:n}=vh({tournamentRecord:t}),{venues:a}=Ju({tournamentRecord:t}),o=i.map(s=>{let{eventId:l}=s,u=z6({event:s}).eventInfo,c=Jy({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(m=>{let h=(({drawId:I,drawName:b,matchUpFormat:S,updatedAt:w})=>({matchUpFormat:S,updatedAt:w,drawName:b,drawId:I}))(m),{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=jg({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:m,event:s});return{drawInfo:h,matchUps:{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=To({event:s});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:o}}}function Q6({publishStatus:t,drawId:e}){var i,r,n;return t!=null&&t.drawDetails?(n=(r=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:r.publishingDetail)==null?void 0:n.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}var Z6="PUBLIC",ope="ADMIN",spe={PUBLIC_DISPLAY:Z6,ADMIN_DISPLAY:ope};function pD(t){var R,N,A;let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:o,status:s=Ya,pressureRating:l,refreshResults:u,contextProfile:c,drawDefinition:d,noDeepCopy:p,sortConfig:m,context:h,event:f}=t;if(!d)return{error:Le};let g=(({matchUpFormat:M,updatedAt:C,drawType:O,drawName:k,drawId:x})=>({matchUpFormat:M,updatedAt:C,drawName:k,drawType:O,drawId:x}))(d);g.display=(R=vt({element:d,name:wS}).extension)==null?void 0:R.value;let v={},y,{allStructuresLinked:I,sourceStructureIds:b,hasDrawFeedProfile:S,structureGroups:w}=GT({drawDefinition:d});if(!I)return{error:xG};let U=(t==null?void 0:t.publishStatus)??To({event:f,status:s}),T=t.eventPublished??!!((A=(N=dh({event:f}).publishState)==null?void 0:N.status)!=null&&A.published),D=!1,P=!1,E=w.map(M=>{let C={},O=M.map(k=>{let{structure:x}=it({drawDefinition:d,structureId:k}),{seedAssignments:F}=ho({drawDefinition:d,structure:x});return(x==null?void 0:x.stage)===Oe&&x.stageSequence===1&&(y=F),(x==null?void 0:x.stage)===Ke&&(v[x.stageSequence??0]=F),x}).sort((k,x)=>ih(k,x,m)).map(k=>{var W,q;if(!k)return;let x=k==null?void 0:k.structureId,F=[];k.stage&&[Oe,rn,$i].includes(k.stage)&&(F=y),(k==null?void 0:k.stage)===Ke&&(F=v[k.stageSequence??0]);let{matchUps:$,roundMatchUps:_,roundProfile:L}=Wt({seedAssignments:(W=k==null?void 0:k.seedAssignments)!=null&&W.length?void 0:F,context:{drawId:g.drawId,...h},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:e,policyDefinitions:r,tournamentRecord:n,usePublishState:o,publishStatus:U,contextProfile:c,drawDefinition:d,inContext:a,structure:k,event:f}),{positionAssignments:B}=oi({structure:k}),V=B==null?void 0:B.filter(Da(zl)).map(Y=>{var Z,K;let re=(K=(Z=vt({element:Y,name:Tc}))==null?void 0:Z.extension)==null?void 0:K.value,{drawPosition:J,participantId:H}=Y;return P=!0,{participantResult:re,participantId:H,drawPosition:J}});if($.length&&(!(V!=null&&V.length)&&t.allParticipantResults||u&&!k.structures)){let{subOrderMap:Y}=l3({positionAssignments:B}),re=$.some(H=>H.matchUpType===xa)?$.filter(H=>H.matchUpType===xa):$,J=Yg({matchUpFormat:k.matchUpFormat,matchUps:re,policyDefinitions:r,pressureRating:l,subOrderMap:Y});V=B==null?void 0:B.filter(Da(zl)).map(H=>{var ie;let{drawPosition:Z,participantId:K}=H;return P=!0,{participantResult:K&&((ie=J==null?void 0:J.participantResults)==null?void 0:ie[K]),participantId:K,drawPosition:Z}})}let G=k?(({stageSequence:Y,structureName:re,structureType:J,matchUpFormat:H,stage:Z})=>({stageSequence:Y,structureName:re,structureType:J,matchUpFormat:H,stage:Z}))(k):{},j=(q=vt({element:k,name:wS}).extension)==null?void 0:q.value;G.display=(j==null?void 0:j[Z6])??j,G.sourceStructureIds=b[x],G.hasDrawFeedProfile=S[x],G.positionAssignments=B,G.structureActive=$.reduce((Y,re)=>{var H;let J=[tr,dr,cs,qi,zu,Mt,hn,zt].includes(re.matchUpStatus);return Y||J||!!re.winningSide||!!((H=re.score)!=null&&H.scoreStringSide1)},!1);let z=$.reduce((Y,re)=>Y&&[Vt,qi,hn,zt,Mt,Ba].includes(re.matchUpStatus),!!$.length);return G.structureCompleted=z,C[x]=z,G.structureActive&&(D=!0),{...G,participantResults:V,seedAssignments:F,roundMatchUps:_,roundProfile:L,structureId:x}});return O.forEach(k=>{var x;i||delete k.positionAssignments,k.sourceStructuresComplete=(x=k.sourceStructureIds)==null?void 0:x.every(F=>C[F])}),O}).flat();return g.drawActive=D,g.participantPlacements=P,g.drawGenerated=E==null?void 0:E.reduce((M,C)=>M||!!(C!=null&&C.roundMatchUps),!1),g.drawCompleted=E==null?void 0:E.reduce((M,C)=>M&&C.structureCompleted,!0),g.drawPublished=o?T&&Q6({publishStatus:U,drawId:g.drawId}):void 0,{structures:!o||g.drawPublished?p&&E||Ce(E,!1,!0):void 0,drawInfo:p?g:Ce(g,!1,!0),...X}}function mD(t){var N,A,M;let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=Ya,contextProfile:o,sortConfig:s}=t,l=ze(t,[{tournamentRecord:!0},{[aA]:{event:!1,eventId:!1}}]);if(l.error)return l;let u=Ce(t.tournamentRecord,!1,!0),c=t.event?void 0:Wn({tournamentRecord:u,eventId:t.eventId}).event,d=t.event?Ce(t.event,!1,!0):c&&Ce(c,!1,!0)||void 0;if(!d)return{error:co};let{eventId:p}=d,{tournamentId:m,endDate:h}=u,f=To({event:d,status:a}),g=dh({event:d}).publishState??{},v=!!((N=g==null?void 0:g.status)!=null&&N.published),{participants:y}=Mi({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:u}),I=({stage:C,drawId:O})=>{var x,F,$;if(!n)return!0;let k=(F=(x=f==null?void 0:f.drawDetails)==null?void 0:x[O])==null?void 0:F.stageDetails;return!k||!Object.keys(k).length?!0:($=k[C])==null?void 0:$.published},b=({structureId:C,drawId:O})=>{var x,F,$;if(!n)return!0;let k=(F=(x=f==null?void 0:f.drawDetails)==null?void 0:x[O])==null?void 0:F.structureDetails;return!k||!Object.keys(k).length?!0:($=k[C])==null?void 0:$.published},S=({drawId:C})=>n?Q6({publishStatus:f,drawId:C}):!0,w=({drawId:C,structure:O})=>{var x,F,$,_;if(!n)return O;let k=(_=($=(F=(x=f==null?void 0:f.drawDetails)==null?void 0:x[C])==null?void 0:F.structureDetails)==null?void 0:$[O.structureId])==null?void 0:_.roundLimit;if(ot(k)){let L=Te(1,k+1),B={},V={};for(let G of L)O.roundMatchUps[G]&&(B[G]=O.roundMatchUps[G],V[G]=O.roundProfile[G]);O.roundMatchUps=B,O.roundProfile=V}return O},U=d.drawDefinitions||[],T=!n||v?U.filter(S).map(C=>(({drawInfo:O,structures:k})=>({...O,structures:k}))(pD({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:p,tournamentId:m,endDate:h},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:y,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:u,usePublishState:n,contextProfile:o,drawDefinition:C,publishStatus:f,sortConfig:s,event:d}))).map(({structures:C,...O})=>{let k=C==null?void 0:C.filter(({stage:x,structureId:F})=>b({structureId:F,drawId:O.drawId})&&I({stage:x,drawId:O.drawId})).map(x=>w({drawId:O.drawId,structure:x}));return{...O,structures:k}}).filter(C=>{var O;return(O=C.structures)==null?void 0:O.length}):void 0,D=(Array.isArray(u.venues)?u.venues:[]).map(C=>(({venueData:O})=>({...O}))(jf({venueId:C.venueId,tournamentRecord:u}))),P=(({eventId:C,eventName:O,eventType:k,eventLevel:x,surfaceCategory:F,matchUpFormat:$,category:_,gender:L,startDate:B,endDate:V,ballType:G,discipline:j})=>({eventId:C,eventName:O,eventType:k,eventLevel:x,surfaceCategory:F,matchUpFormat:$,category:_,gender:L,startDate:B,endDate:V,ballType:G,discipline:j}))(d);P.display=(A=vt({element:d,name:wS}).extension)==null?void 0:A.value;let{tournamentInfo:E}=vh({tournamentRecord:u}),R={tournamentInfo:E,venuesData:D,eventInfo:P,drawsData:T};return R.eventInfo.publishState=g,R.eventInfo.published=(M=g==null?void 0:g.status)==null?void 0:M.published,{...X,eventData:R,participants:y}}var eY={};bt(eY,{courtGridRows:()=>ID,findVenue:()=>tu,getMatchUpsToSchedule:()=>hD,getPersonRequests:()=>wp,getProfileRounds:()=>vD,getScheduledRoundsDetails:()=>Nb,getSchedulingProfile:()=>Xu,getSchedulingProfileIssues:()=>mk,publicFindCourt:()=>jA});function Yf({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){var u,c,d,p;let{individualParticipantIds:n}=RT(r);i=i??((u=r.schedule)==null?void 0:u.timeAfterRecovery);let a=m=>{t[m]||(t[m]=[]),t[m]=ct(t[m].concat(...n))},o=m=>{i&&(!e[m]||i>e[m])&&(e[m]=i)},s=((c=r.winnerTo)==null?void 0:c.matchUpId)||r.winnerMatchUpId;s&&(i&&o(s),a(s));let l=((d=r.loserTo)==null?void 0:d.matchUpId)||r.loserMatchUpId;l&&(i&&o(l),a(l)),(p=r.sidesTo)!=null&&p.length&&r.sidesTo.forEach(({matchUpId:m})=>{m&&(i&&o(m),a(m))})}function hD(t){let e=ze(t,[{[rA]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,orderedMatchUpIds:s,clearDate:l,matchUps:u}=t,c=o?Object.keys(o):[],d=(s??[]).map(m=>u.find(h=>h.matchUpId===m)).filter(Boolean).filter(m=>{let h=!l&&(r.includes(m.matchUpId)||c.includes(m.matchUpId)),f=[Vt,Mt,qi,Ba,hn,zt,tr,dr].includes(m==null?void 0:m.matchUpStatus);return n||!h&&!m.winningSide&&!f}),p=i&&a?d.reduce((m,h)=>{let{drawId:f,tournamentId:g}=h;return m.matchUpMap[g]||(m.matchUpMap[g]={}),m.matchUpMap[g][f]?m.matchUpMap[g][f].push(h):m.matchUpMap[g][f]=[h],Yf({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:h}),m},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function fD({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!Sa({matchUpFormat:r}))return{error:Ay};let u=Object.keys(i).filter(d=>!o||d===o),c;return u.forEach(d=>{var h;if(c)return;let p=i[d],m=l?(h=Wn({tournamentRecord:p,eventId:l}))==null?void 0:h.event:void 0;return c=ab({tournamentRecord:p,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:m}),(c==null?void 0:c.averageMinutes)||(c==null?void 0:c.recoveryMinutes)}),{recoveryMinutes:(c==null?void 0:c.recoveryMinutes)||t,averageMinutes:(c==null?void 0:c.averageMinutes)||e,typeChangeRecoveryMinutes:(c==null?void 0:c.typeChangeRecoveryMinutes)||(c==null?void 0:c.recoveryMinutes)||t}}function Nb(t){let e=ze(t,[{[aA]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[Jn]:cn}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:Oi};let a={},o=[],s=t.rounds.toSorted((h,f)=>(h.sortOrder??0)-(f.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(h=>Bg({tournamentRecord:h}).containedStructures)),u=t.matchUps??As({nextMatchUps:!0,tournamentRecords:n}).matchUps,c=0,d={},p={},m={};return{scheduledRoundsDetails:s.flatMap(h=>{var U;let f=h.periodLength||r,g=[];l!=null&&l[h.structureId]?g.push(...l[h.structureId]):g.push(h.structureId);let v=u?uu({tournamentIds:[h.tournamentId],roundNumbers:[h.roundNumber],matchUpIds:h.matchUpIds,eventIds:[h.eventId],drawIds:[h.drawId],processContext:!0,structureIds:g,matchUps:u}).sort(ch):[],{segmentNumber:y,segmentsCount:I}=h.roundSegment||{};if(ot(y)&&Rs(v==null?void 0:v.length)&&Rs(I)&&y>0&&y<=I&&I<(v==null?void 0:v.length)&&!((U=h.matchUpIds)!=null&&U.length)){let T=v.length/I,D=T*(y-1);v=v.slice(D,D+T)}let b=n[h.tournamentId],S=Wn({drawId:h.drawId,tournamentRecord:b}).event,w=[];for(let T of v){let D=T.matchUpFormat;D&&(a[D]||(a[D]=[],a[D].push(T)),w.push(D))}for(let T of w){let{eventType:D,category:P}=S??{},{categoryName:E,ageCategoryCode:R}=P??{},{typeChangeRecoveryMinutes:N,recoveryMinutes:A,averageMinutes:M,error:C}=fD({categoryName:E??R,categoryType:P==null?void 0:P.categoryType,tournamentId:h.tournamentId,eventId:h.eventId,tournamentRecords:n,matchUpFormat:T,eventType:D});if(C)return{error:C,round:h};let O=v.filter(x=>(i||!vr.includes(x.matchUpStatus))&&x.matchUpStatus!==Vt).map(Dr);O.forEach(x=>{m[x]={typeChangeRecoveryMinutes:N,recoveryMinutes:A,averageMinutes:M},d[x]=A,p[x]=M}),o.push(...O),c=Math.max(M||0,c);let k=`${M}|${f}`;return{roundPeriodLength:f,recoveryMinutes:A,averageMinutes:M,matchUpIds:O,hash:k}}}),greatestAverageMinutes:c,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:o,minutesMap:m,...X}}function tY({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t==null?void 0:t.map(s=>{let l=mt(s==null?void 0:s.scheduleDate);if(!l){n.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let u=((s==null?void 0:s.venues)||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!(e!=null&&e.includes(p))){n.push(`Missing venueId: ${p}`);return}let m=d.filter(h=>{let f=i.includes(h.eventId)&&r.includes(h.drawId);return f||n.push(`Invalid eventId: ${h.eventId} or drawId: ${h.drawId}`),f});if(m.length)return{venueId:p,rounds:m}}).filter(Boolean);return u.length&&l&&{...s,venues:u}}).filter(Boolean),o=n.length;return{updatedSchedulingProfile:a,modifications:o,issues:n}}function gD({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:se};let{venueIds:i,tournamentsMap:r}=upe({tournamentRecords:t}),n,a,o=e.every(s=>{let{scheduleDate:l,venues:u}=s;return ya(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(m=>{var T,D,P,E;if(!m)return a="empty round",!1;let{roundSegment:h,tournamentId:f,structureId:g,roundNumber:v,eventId:y,drawId:I}=m,b=(E=(P=(D=(T=r==null?void 0:r[f])==null?void 0:T[y])==null?void 0:D[I])==null?void 0:P[g])==null?void 0:E.includes(v);b||(a="Invalid rounds");let{segmentNumber:S,segmentsCount:w}=h||{},U=!h||ot(S)&&Rs(w)&&S<=w;return U||(a="Invalid segment"),b&&U}):(n=Jm,!1):(a="rounds should be an array",!1)}):!1});return!o&&!n&&(n=se),{valid:!!o,error:n,info:a}}function lpe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],o=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:c,courts:d})=>(!r||(d==null?void 0:d.length))&&c),u=e==null?void 0:e.tournamentId;return u&&(n.push(u),i[u]={},((e==null?void 0:e.events)||[]).forEach(c=>{let d=c.eventId;o.push(d),i[u][d]={},(c.drawDefinitions||[]).forEach(p=>{let m=p.drawId;s.push(m),i[u][d][m]={};let{structures:h}=is({drawDefinition:p});(h||[]).forEach(f=>{var b;let g=f.structureId,{matchUps:v}=Wt({structure:f}),{roundMatchUps:y}=En({matchUps:v}),I=y&&Object.keys(y).map(S=>parseInt(S));i[u][d][m][g]=I,a.push(g),(b=f.structures)!=null&&b.length&&f.structures.forEach(S=>{a.push(S.structureId),i[u][d][m][S.structureId]=I})})})})),{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}function upe(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:m,eventIds:h,drawIds:f}=lpe({tournamentRecord:u});return m.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...h),l.drawIds.push(...f),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:r,eventIds:n,drawIds:a}}function Xu({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Oi};let{extension:i}=vt({element:e,name:Rm,tournamentRecords:t,discover:!0}),r=(i==null?void 0:i.value)||[];if(r.length){let{venueIds:n}=Mb({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:o}=DO({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:u}=tY({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:o});if(l){r=s;let c=Kg({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return c.error?c:{schedulingProfile:r,modifications:l,issues:u}}}return{schedulingProfile:r,modifications:0}}function Kg({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=gD({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?Lt({tournamentRecords:t,discover:!0,extension:{name:Rm,value:i}}):Un({element:e,name:Rm,tournamentRecords:t,discover:!0})}function Ab(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=Xu({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:r}=Mb({tournamentRecords:i}),{eventIds:n,drawIds:a}=DO({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=tY({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return s?{...Kg({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...X,modifications:s,issues:l}}function mk(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:Cy};if(!Array.isArray(e))return{error:se};if(!e.every(ya))return{error:Ar};let n=[],a=0,o={},{schedulingProfile:s}=Xu({tournamentRecords:i});if(!s)return{issues:n,...X};let{matchUps:l}=As({nextMatchUps:!0,tournamentRecords:i});for(let c of s){let{scheduleDate:d,venues:p=[]}=c;if(!(e!=null&&e.length)||e.includes(d)){for(let m of p||[])if(m){let{rounds:h}=m,f=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=Nb({tournamentRecords:i,periodLength:r,matchUps:l,rounds:h}),{matchUpDependencies:y}=ps({tournamentRecords:i,matchUps:l}),I=b=>{let S;return v==null||v.find((w,U)=>{let T=w.matchUpIds.includes(b);return T&&(S=U),T}),S};if(g==null||g.forEach((b,S)=>{var T;let w=g.slice(S+1),U=Vi(w,((T=y==null?void 0:y[b])==null?void 0:T.matchUpIds)||[]);U.length&&f.push({matchUpId:b,shouldBeAfter:U})}),f.length){a+=f.length;let b=f.map(({matchUpId:S,shouldBeAfter:w})=>{let U=I(S),T=ct(w.map(I));return o[d]||(o[d]={}),o[d][U]||(o[d][U]=[]),T.forEach(D=>{o[d][U].includes(D)||o[d][U].push(D)}),{matchUpId:S,matchUpRoundIndex:U,earlierRoundIndices:T,shouldBeAfter:w}});n.push(...b)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...n.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:m}=c;return{[d]:{earlierRoundIndices:m,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:o,...X}}function wp(t){let{tournamentRecords:e,requestType:i}=t,r=ze(t,[{[mn]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:o}=vt({element:a,name:_g}),s=(o==null?void 0:o.value)||[];for(let l of s){let{personId:u,requests:c}=l||{};n[u]||(n[u]=[]);for(let d of c)i&&d.requestType!==i||n[u].push(d)}}return{personRequests:n,...X}}function n1(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:o,eventId:s,drawId:l}=t,u=r?e:o,c=[n,s,l,u,a].join("|");return je({structureId:u,roundSegment:i,tournamentId:n,roundNumber:a,eventId:s,drawId:l,id:c})}function nV({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:o,categoryType:s}=n||{},{categoryName:l,ageCategoryCode:u}=o||{},c=Ua(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let m=c[p],h=fD({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:s,eventType:a});if(h.error)return h;let f=h.averageMinutes*m;isNaN(d)||(d+=f)}),{roundMinutes:d}}function cpe(t){return(t||[]).reduce((e,i)=>{var a,o;let r=(((a=i.finishingPositionRange)==null?void 0:a.winner)||[]).reduce((s,l)=>s+l,0),n=(((o=i.finishingPositionRange)==null?void 0:o.winner)||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:n}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function aV(t){let e=t.length,i=t.filter(({sides:u})=>u==null?void 0:u.some(({bye:c})=>c)).length||0,r=t.filter(({winningSide:u,matchUpStatus:c})=>u||vr.includes(c)).length||0,n=t.filter(({schedule:u,matchUpStatus:c})=>(u==null?void 0:u.scheduledDate)&&(u==null?void 0:u.scheduledTime)&&c!==Vt).length||0,a=e-i,o=a===r,s=a-n,l=a-n;return{unscheduledCount:s,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:o,byeCount:i}}function vD({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:Cy};t={[i.tournamentId]:i}}if(e){let a=gD({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=Xu({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:$r};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:o})=>a.map(({rounds:s})=>s.map(l=>{var c;let u=n1(l);return(c=u.roundSegment)!=null&&c.segmentsCount&&(n[u.id]=u.roundSegment.segmentsCount),je({id:r?u.id:void 0,scheduleDate:o,...u})}))).flat(1/0),segmentedRounds:n}}function ID({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:se};let r=i==null?void 0:i.reduce((o,s)=>{let l=s.matchUps||[],u=Math.max(0,...l.map(c=>c.schedule.courtOrder||0));return u>o?u:o},1),n=e?Math.max(e,r):r,a=Te(0,n).map(o=>({matchUps:Te(0,i.length).map(s=>{let l=i[s],{courtId:u,venueId:c}=l;return{schedule:{courtOrder:o+1,venueId:c,courtId:u}}})}));return i.forEach((o,s)=>{var l;for(let u of o.matchUps){let c=(l=u.schedule)==null?void 0:l.courtOrder;c&&(a[c-1].matchUps[s]=u)}}),{courtPrefix:t,rows:a.map((o,s)=>Object.assign({rowId:`rowId-${s+1}`},...o.matchUps.map((l,u)=>({[`${t}${u}`]:l}))))}}var iY={};bt(iY,{getEntriesAndSeedsCount:()=>yD,getMaxEntryPosition:()=>hk});function yD({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:vi};let{entries:o,stageEntries:s}=cq({drawDefinition:e,drawId:r,stage:a,event:n}),l=s.length,{drawSize:u}=k3({participantsCount:l}),c=Eb({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return ee({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:o,seedsCount:d,stageEntries:s}}function hk(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>et(n||0)),0)}var rY={};bt(rY,{allCompetitionMatchUps:()=>As,allDrawMatchUps:()=>Sn,allEventMatchUps:()=>iu,allTournamentMatchUps:()=>Vr,analyzeMatchUp:()=>HI,calculateWinCriteria:()=>Ih,checkMatchUpIsComplete:()=>Rd,competitionScheduleMatchUps:()=>kb,drawMatchUps:()=>Dk,eventMatchUps:()=>wD,filterMatchUps:()=>uu,getAllDrawMatchUps:()=>hr,getAllStructureMatchUps:()=>Wt,getCheckedInParticipantIds:()=>sh,getCompetitionMatchUps:()=>GI,getEventMatchUpFormatTiming:()=>gk,getHomeParticipantId:()=>bk,getMatchUpCompetitiveProfile:()=>nb,getMatchUpContextIds:()=>wk,getMatchUpDailyLimits:()=>SD,getMatchUpDailyLimitsUpdate:()=>vk,getMatchUpDependencies:()=>ps,getMatchUpFormat:()=>Uk,getMatchUpFormatTiming:()=>ab,getMatchUpFormatTimingUpdate:()=>fk,getMatchUpScheduleDetails:()=>xT,getMatchUpType:()=>FT,getMatchUpsStats:()=>Sk,getModifiedMatchUpFormatTiming:()=>bD,getParticipantResults:()=>Ub,getPredictiveAccuracy:()=>yk,getRoundMatchUps:()=>En,getRounds:()=>Tk,isValidMatchUpFormat:()=>Sa,matchUpActions:()=>QT,participantScheduledMatchUps:()=>Ik,tallyParticipantResults:()=>Yg,tournamentMatchUps:()=>UD,validMatchUp:()=>MT,validMatchUps:()=>So});function nY({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Oi};let i=[],r;for(let n of Object.values(t)){let{extension:a}=vt({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let o=n.events??[];for(let s of o){let{eventId:l}=s,{extension:u}=vt({name:e,element:s});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function fk({tournamentRecords:t}){return nY({extensionName:Pu,tournamentRecords:t})}var yE="ADULT",bE="JUNIOR",mU="WHEELCHAIR",dpe={[zc]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Zt]:30,default:60}}]},defaultDailyLimits:{[ii]:2,[Zt]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[fu],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[mU],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[yE,mU],minutes:{default:60,[Zt]:30}},{categoryTypes:[bE],minutes:{default:60,[Zt]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[yE,mU],minutes:{default:30}},{categoryTypes:[bE],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[yE,bE],minutes:{default:30}},{categoryTypes:[mU],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},ppe=dpe;function gk({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:vi};let n=[],a;if(e!=null&&e.length){let d=[];n=e.map(p=>{let m=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(m==null?void 0:m.matchUpFormat)&&Sa({matchUpFormat:m==null?void 0:m.matchUpFormat}))return d.push(m.matchUpFormat),m}).filter(Boolean)}else{let{policy:d}=hp({policyType:Ns,tournamentRecord:t,event:r});if(d!=null&&d.matchUpFormats)n=d==null?void 0:d.matchUpFormats;else{let{extension:p}=vt({name:Pu,element:r}),m,h;p!=null&&p.value?{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=p.value:{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=ppe[zc],n=ct([...(m||[]).map(f=>f.matchUpFormatCodes),...(h||[]).map(f=>f.matchUpFormatCodes)].flat()).map(f=>({matchUpFormat:f})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=r,u=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:vi};let c=n.map(({matchUpFormat:d,description:p})=>{let m=ab({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:o,event:r});return{matchUpFormat:d,description:p,...m}});return je({eventMatchUpFormatTiming:c,info:a})}function bD(t){let e=ze(t,[{[wr]:!0},{[Kr]:f=>Sa({matchUpFormat:f}),[$a]:Ay,[eA]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=vt({name:Pu,element:n}),o=a==null?void 0:a.value,{extension:s}=vt({element:i,name:Pu}),l=s==null?void 0:s.value,u=(o==null?void 0:o.matchUpAverageTimes)&&Qv({...o,matchUpFormat:r}),c=(l==null?void 0:l.matchUpAverageTimes)&&Qv({...l,matchUpFormat:r}),d=[u,c].find(f=>f),p=(o==null?void 0:o.matchUpRecoveryTimes)&&Zv({...o,matchUpFormat:r}),m=(l==null?void 0:l.matchUpRecoveryTimes)&&Zv({...l,matchUpFormat:r}),h=[p,m].find(f=>f);return{matchUpFormat:r,recoveryTimes:h,averageTimes:d}}function vk({tournamentRecords:t}){return nY({extensionName:zy,tournamentRecords:t})}var Ob=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function Ik({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!So(e))return{error:Gu};if(!Array.isArray(t))return{error:se};let i=e.filter(Boolean).filter(({schedule:r})=>Ob({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,o=mt(a==null?void 0:a.scheduledDate),s=wi(a==null?void 0:a.scheduledTime);return o&&s&&(r[o]?r[o].push(n):r[o]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>{var o,s;return WH(wi((o=n.schedule)==null?void 0:o.scheduledTime),wi((s=a.schedule)==null?void 0:s.scheduledTime))})}),{...X,scheduledMatchUps:i}}function mpe({tournamentRecords:t}){var r;let e={},i=[];for(let n of Object.values(t))for(let a of n.events??[]){let o=To({event:a}),s=o==null?void 0:o.drawDetails;Nt(s)?(Object.assign(e,s),i.push(...Object.keys(s).filter(l=>WA({drawId:l,drawDetails:s})))):(r=o==null?void 0:o.drawIds)!=null&&r.length&&i.push(...o.drawIds)}return{drawIds:i,detailsMap:e}}function BS({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:s,drawId:l,structureId:u,roundNumber:c})=>`${s}|${l}|${u}${c}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let m=r({eventId:l,drawId:u,structureId:c,roundNumber:d});i[m]=p})});let n=[],a={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},u=l.scheduledDate&&mt(l.scheduledDate)||l.scheduledTime&&mt(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(s)}let o=Object.keys(a).sort();for(let s of o){let l=a[s],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},m=p.scheduledTime&&wi(p.scheduledTime)||"noScheduledTime";u[m]||(u[m]=[]),u[m].push(d)}let c=Object.keys(u).sort();for(let d of c){let p=u[d];p.sort((m,h)=>{let f=i[r(m)]||0,g=i[r(h)]||0;return f-g}),n.push(...p)}}return n}function wD(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:m,contextProfile:h,nextMatchUps:f,tournamentId:g,inContext:v,context:y,event:I}=t;if(!I)return{error:vi};let{eventId:b,eventName:S,endDate:w,eventType:U,category:T,gender:D}=I??{},P={...y,...je({surfaceCategory:I.surfaceCategory??(c==null?void 0:c.surfaceCategory),indoorOutDoor:I.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),tournamentId:g??(c==null?void 0:c.tournamentId),endDate:w??(c==null?void 0:c.endDate),eventName:S,eventType:U,category:T,eventId:b,gender:D})},E;!e&&c&&({participants:e,participantMap:r,groupInfo:E}=mp({participantsProfile:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextProfile:h,inContext:v})),h&&!i&&(i=Yu({policyDefinitions:l,tournamentRecord:c,contextProfile:h,event:I}));let R=To({event:I});return{...(I.drawDefinitions??[]).reduce((N,A)=>{var C;let M=jg({hydrateParticipants:t.hydrateParticipants,context:P,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:m,participantMap:r,publishStatus:R,contextProfile:h,drawDefinition:A,nextMatchUps:f,inContext:v,event:I});return(C=Object.keys(M))==null||C.forEach(O=>{Array.isArray(M[O])&&(N[O]||(N[O]=[]),N[O]=N[O].concat(M[O]))}),N},{}),...X,groupInfo:E}}function UD(t){if(!(t!=null&&t.tournamentRecord))return{error:ge};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,inContext:s=!0,usePublishState:l,contextFilters:u,matchUpFilters:c,contextProfile:d,nextMatchUps:p,context:m}=t,h=t.tournamentId??o.tournamentId,f=(o==null?void 0:o.events)??[],{participants:g,participantMap:v,groupInfo:y}=mp({participantsProfile:r,policyDefinitions:a,tournamentRecord:o,contextProfile:d,inContext:s});d&&!e&&(e=Yu({policyDefinitions:a,tournamentRecord:o,contextProfile:d}));let{appliedPolicies:I}=$t({tournamentRecord:o}),b=(u==null?void 0:u.eventIds)??[];return{...f.filter(S=>!b.includes(S.eventId)).map(S=>{var U,T,D;let w={eventDrawsCount:((T=(U=Gi({event:S}).flightProfile)==null?void 0:U.flights)==null?void 0:T.length)||((D=S.drawDefinitions)==null?void 0:D.length)||0,...m};return wD({hydrateParticipants:t.hydrateParticipants,context:w,tournamentAppliedPolicies:I,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,contextFilters:u,contextProfile:d,contextContent:e,matchUpFilters:c,participantMap:v,participants:g,tournamentId:h,nextMatchUps:p,inContext:s,event:S})}).reduce((S,w)=>{var U;return(U=w&&Object.keys(w).filter(T=>!["success","matchUpsMap"].includes(T)))==null||U.forEach(T=>{Array.isArray(w[T])&&(S[T]||(S[T]=[]),S[T]=S[T].concat(w[T]),S.matchUpsCount!==void 0?S.matchUpsCount+=w[T].length:S.matchUpsCount=w[T].length)}),S},{matchUpsCount:0}),groupInfo:y,participants:g}}function GI({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,useParticipantMap:n,policyDefinitions:a,usePublishState:o,matchUpFilters:s,contextFilters:l,nextMatchUps:u,inContext:c}){if(typeof r!="object"||!Object.keys(r).length)return{error:Oi};let d=Object.keys(r).map(h=>{let f=r[h];return UD({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,useParticipantMap:n,policyDefinitions:a,tournamentRecord:f,usePublishState:o,matchUpFilters:s,contextFilters:l,nextMatchUps:u,inContext:c})}),p={},m={};return{...d.reduce((h,f)=>(Object.keys(f).forEach(g=>{if(g==="groupInfo")Object.assign(m,f[g]);else if(g==="participants")for(let v of f[g]??[])p[v.participantId]=v;else Array.isArray(f[g])&&(h[g]||(h[g]=[]),h[g]=h[g].concat(f[g]))}),h),{}),groupInfo:m,mappedParticipants:p}}function kb(t){var N,A,M,C,O,k,x;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:Oi};let{courts:e,venues:i}=Ju(t),r=Xu(t).schedulingProfile,{sortDateMatchUps:n=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:o,activeTournamentId:s,tournamentRecords:l,withCourtGridRows:u,minCourtGridRows:c,usePublishState:d,status:p=Ya,sortCourtsData:m}=t,h=s??Xm()??Object.keys(l)[0],f=d?db({tournamentRecord:l[h],status:p}):void 0,g=o?GI({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[qi]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!((N=f==null?void 0:f.orderOfPlay)!=null&&N.published))return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let v,y;d&&({drawIds:v,detailsMap:y}=mpe({tournamentRecords:l})),v!=null&&v.length&&(t.contextFilters||(t.contextFilters={}),(A=t.contextFilters)!=null&&A.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(F=>v.includes(F)):t.contextFilters.drawIds=v),(M=f==null?void 0:f.eventIds)!=null&&M.length&&(t.matchUpFilters||(t.matchUpFilters={}),(C=t.matchUpFilters)!=null&&C.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(F=>f.eventIds.includes(F)):t.matchUpFilters.eventIds=f.eventIds),(O=f==null?void 0:f.scheduledDates)!=null&&O.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(F=>f.scheduledDates.includes(F)):t.matchUpFilters.scheduledDates=f.scheduledDates),o&&(t.matchUpFilters||(t.matchUpFilters={}),(x=(k=t.matchUpFilters)==null?void 0:k.excludeMatchUpStatuses)!=null&&x.length?t.matchUpFilters.excludeMatchUpStatuses.includes(qi)||t.matchUpFilters.excludeMatchUpStatuses.push(qi):t.matchUpFilters.excludeMatchUpStatuses=[qi]);let{completedMatchUps:I,upcomingMatchUps:b,pendingMatchUps:S,groupInfo:w,mappedParticipants:U}=GI({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),T=[...b??[],...S??[]];y&&(!(v!=null&&v.length)||Object.keys(y).length)&&(T=T.filter(F=>{var B,V;let{drawId:$,structureId:_,stage:L}=F;if(!((V=(B=y==null?void 0:y[$])==null?void 0:B.publishingDetail)!=null&&V.published))return!1;if(y[$].stageDetails){let G=Object.keys(y[$].stageDetails),j=G.filter(W=>!y[$].stageDetails[W].published),z=G.filter(W=>y[$].stageDetails[W].published);return j.length&&j.includes(L)?!1:z.length&&z.includes(L)?!0:j.length&&!j.includes(L)&&!z.length}if(y[$].structureDetails){let G=Object.keys(y[$].structureDetails),j=G.filter(W=>!y[$].structureDetails[W].published),z=G.filter(W=>y[$].structureDetails[W].published);return j.length&&j.includes(_)?!1:z.length&&z.includes(_)?!0:j.length&&!j.includes(_)&&!z.length}return!0}));let D=n?BS({matchUps:T,schedulingProfile:r}):T,P=e==null?void 0:e.map(F=>{let $=R(F);return{surfaceCategory:(F==null?void 0:F.surfaceCategory)??"",matchUps:$,...F}}),E={completedMatchUps:o?g:I,mappedParticipants:t.hydrateParticipants?void 0:U,dateMatchUps:D,courtsData:P,groupInfo:w,venues:i};if(u){let{rows:F,courtPrefix:$}=ID({minRowsCount:c,courtsData:P});E.courtPrefix=$,E.rows=F}return{...E,...X};function R({courtId:F}){let $=(a?D.concat(I??[]):D).filter(_=>{var L,B,V;return((L=_.schedule)==null?void 0:L.courtId)===F||((V=(B=_.schedule)==null?void 0:B.allocatedCourts)==null?void 0:V.map(({courtId:G})=>G).includes(F))});return m?BS({matchUps:$,schedulingProfile:r}):$}}function SD({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Oi};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:o}=hpe({tournamentRecord:a});r=o}),{matchUpDailyLimits:r}}function hpe(t){var s;let e=ze(t,[{[wr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:r}=hp({policyType:zc,tournamentRecord:i}),{extension:n}=vt({element:i,name:zy}),a=(s=n==null?void 0:n.value)==null?void 0:s.dailyLimits,o=r==null?void 0:r.defaultDailyLimits;return{matchUpDailyLimits:a||o}}function yk(t){var A,M,C,O;let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:o,zoneDoubling:s,matchUpType:l,scaleName:u,eventId:c,zonePct:d,drawId:p,event:m}=t;if(!r&&!e)return{error:ge};if(l&&![ii,Zt].includes(l))return{error:se,info:{matchUpType:l}};if(e&&!So(e))return{error:se,context:{matchUps:e}};let h=Nr[u],f=(h==null?void 0:h.ascending)??t.ascending??!1,g=(h==null?void 0:h.accessor)??t.valueAccessor,v=Array.isArray(h==null?void 0:h.range)?Math.abs(h.range[0]-h.range[1]):0,y=ot(d)&&v?(d??0/100)*v:t.zoneMargin??v,I={withScaleValues:!0,withCompetitiveness:!0},b={matchUpTypes:l?[l]:[ii,Zt]},S=r==null?void 0:r.participants;(A=e==null?void 0:e[0])!=null&&A.hasContext?p?e=e.filter(k=>k.drawId===p):c&&(e=e.filter(k=>k.eventId===c)):e===void 0&&(e=p&&!n&&[]||!p&&c&&!m&&[]||p&&((M=Sn({inContext:!0,drawDefinition:n,contextFilters:b,contextProfile:I,participants:S}))==null?void 0:M.matchUps)||!p&&c&&((C=iu({inContext:!0,contextFilters:b,contextProfile:I,participants:S,event:m}))==null?void 0:C.matchUps)||((O=Vr({tournamentRecord:r,contextFilters:b,contextProfile:I}))==null?void 0:O.matchUps)||[]),l&&(e=e.filter(k=>k.matchUpType===l));let w=e.filter(({winningSide:k,score:x,sides:F,matchUpStatus:$})=>![hn,Mt,zt,$g,Ba].includes($??"")&&Ir({score:x})&&(F==null?void 0:F.length)===2&&k),U=gpe({matchUps:w,excludeMargin:a,exclusionRule:o,valueAccessor:g,ascending:f,scaleName:u}),T=!s||Yi(ii)(l)?y:(y||0)*2,D=y?w.map(({competitiveProfile:k,matchUpType:x,score:F,sides:$})=>{let _=aY({singlesForDoubles:i,valueAccessor:g,matchUpType:x,scaleName:u,sides:$}),L=Math.abs(_[0].value-_[1].value);return{competitiveness:k==null?void 0:k.competitiveness,valuesGap:L,score:F}}).filter(({valuesGap:k})=>k<=T):[],P=fpe({zoneData:D}),E=P&&[].concat(Object.values(P)).flat().length,R=E&&Object.assign({},...Object.keys(P).map(k=>({[k]:Math.round(1e4*P[k].length/E)/100}))),N=w.length-((D==null?void 0:D.length)||0);return{...X,relevantMatchUps:w,zoneDistribution:R,zoneData:D,accuracy:U,nonZone:N}}function fpe({zoneData:t}){let e={[OA]:[],[LI]:[],[_I]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function aY({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let o=e==null?void 0:e.range.sort(),s=l=>{let u=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&u>=o[0]&&u<=o[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l==null?void 0:l.individualParticipants;if(c!=null&&c.length){let d=[],p=0;for(let m of c){let{scaleValue:h,value:f}=oV({singlesForDoubles:t,valueAccessor:i,participant:m,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:v}=s(h);g&&u.push(v),d.push(h),f&&!isNaN(p)?p+=f:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=oV({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:m,exclusionValue:h}=s(d);return m&&u.push(h),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function oV({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){var u,c,d,p,m;let a=t?ii:i,o=(c=(u=r==null?void 0:r.rankings)==null?void 0:u[a])==null?void 0:c.find(h=>h.scaleName===n),s=(m=((p=(d=r==null?void 0:r.ratings)==null?void 0:d[a])==null?void 0:p.find(h=>h.scaleName===n))||o)==null?void 0:m.scaleValue,l=e?s==null?void 0:s[e]:s;return{scaleValue:s,value:l}}function gpe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let u of a){let{matchUpType:c,sides:d,score:p,winningSide:m}=u;if(!m)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:Xe};let h=m-1,f=aY({exclusionRule:e,valueAccessor:i,matchUpType:c,scaleName:n,sides:d});if(e){let S=f.map(({exclusionValues:w})=>w).flat();if(S.length){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:S,winningSide:m,sideValues:f});continue}}if(f.filter(S=>![void 0,"",null].includes(S.value)).length<2){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:m,sideValues:f});continue}let g=f[h].value-f[1-h].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:m,excludeGap:y,sideValues:f,valuesGap:g});continue}let I=r?g:g*-1,b=m===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;I>0?o.affirmative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p}):o.negative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}function Ih({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=c3({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:o,collectionGroupNumber:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,m=s&&r.includes(s);if(ot(p||d))n=!0;else{if(m)continue;if(typeof l=="number"&&ot(l))i+=l;else if(Array.isArray(o)&&(o!=null&&o.length))for(let h of o)i+=h.matchUpValue;else typeof c=="number"&&ot(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...X}:{valueGoal:Math.floor(i/2)+1,...X}}function bk(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=ze(t,[{[eu]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:o}=vp({timeItems:(r==null?void 0:r.timeItems)||[],itemType:_A});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function wk({matchUps:t,matchUpId:e}){if(!So(t))return{error:se};let i=t.find(s=>s.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:o}}function Jg(t,e){if(!Nt(t))return{error:se};if(!Array.isArray(e))return{error:se};let i={};for(let{param:r,error:n,attr:a}of e){let o=vpe({params:t,param:r,attr:a,error:n});if(o!=null&&o.error)return o;i[r]=o}return i}function vpe({params:t,param:e,attr:i,error:r}){if(e===hT&&Nt(t.drawDefinition)&&Di(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===eu){let n=Y6({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:$r,info:{param:e}}}function Uk(t){var p,m;let{structureId:e,matchUpId:i,event:r}=t,n=t.drawDefinition,a=ze(t,[{[wr]:!0},{[aA]:{[dT]:!1,[Il]:!1,[Hz]:!1,[Hc]:!1}}]);if(a[jo])return a;let o=(p=Jg(t,[{[Fg]:eu,[jo]:Xe}]))==null?void 0:p.matchUp;if(i&&(o!=null&&o.error))return o;!n&&(o!=null&&o.drawDefinition)&&(n=o==null?void 0:o.drawDefinition);let s=o==null?void 0:o.structure;if(!s&&e&&!i){if(!n)return{error:$s};let h=it({drawDefinition:n,structureId:e});if(h.error)return h;s=h.structure}let l=s==null?void 0:s.matchUpFormat,u=n==null?void 0:n.matchUpFormat,c=r==null?void 0:r.matchUpFormat,d=((m=o==null?void 0:o.matchUp)==null?void 0:m.matchUpFormat)||l||u||c;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:c,drawDefaultMatchUpFormat:u,matchUpFormat:d}}function Sk({profileBands:t,tournamentRecord:e,matchUps:i}){if(!So(i))return{error:Gu};let r=!t&&hp({policyType:lu,tournamentRecord:e}).policy,n=t||(r==null?void 0:r.profileBands)||kA[lu].profileBands,a=i.filter(({winningSide:p})=>p),o=a.map(NW),s=(p,m)=>{let h=MW(m,n);return p[h]+=1,p},l=AW(o).reduce((p,m)=>s(p,m),{[OA]:0,[LI]:0,[_I]:0,[TW]:0}),u=Object.keys(l).reduce((p,m)=>(l[m]||0)+p,0),c=Object.keys(l).map(p=>{let m=parseFloat((l[p]/u).toFixed(4));return{[p]:m*100}}),d=a.filter(({matchUpStatus:p})=>p===MB).length;return c.push({[MB]:parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...X}}var{stageOrder:sV}=Kae;function Ipe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(sV[t==null?void 0:t.stage]||0)-(sV[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function Tk({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){var w;if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:se,inContextMatchUps:r};if(o&&!n){if(typeof o!="object")return{error:Cy};n={[o.tournamentId]:o}}let m=typeof n!="object"||!Object.keys(n).length;if((d||u||!r||!a&&(t||i||a||s))&&m)return{error:Oi};let h=Object.assign({},...Object.values(n??{}).map(({venues:U=[],tournamentId:T})=>({[T]:U==null?void 0:U.map(({venueId:D})=>D)}))),f=Object.values(n??{}).map(({events:U=[],tournamentId:T,startDate:D,endDate:P})=>U.map(E=>({...E,validVenueIds:h[T],startDate:E.startDate??D,endDate:E.endDate??P}))).flat(),{segmentedRounds:g,profileRounds:v}=n&&(t||i||a||s)&&vD({tournamentRecords:n,schedulingProfile:a})||{},y=t&&Object.assign({},...v.map(U=>({[U.id]:U}))),I=r||n&&((w=As({tournamentRecords:n,matchUpFilters:l}))==null?void 0:w.matchUps)||[],b=[],S=I&&Object.values(I.reduce((U,T)=>{var j;let D=n1(T).id,P=g==null?void 0:g[D],E=[...((j=U[D])==null?void 0:j.matchUps)??[],T],{containerStructureId:R,stageSequence:N,structureName:A,tournamentId:M,isRoundRobin:C,matchUpType:O,roundNumber:k,roundOffset:x,structureId:F,eventName:$,roundName:_,drawName:L,eventId:B,drawId:V}=T,G=C?R:F;return{...U,[D]:{id:c?D:void 0,structureId:G,stageSequence:N,segmentsCount:P,structureName:A,tournamentId:M,matchUpType:O,roundNumber:k,roundOffset:x,eventName:$,roundName:_,drawName:L,matchUps:E,eventId:B,drawId:V}}},{})).map(U=>{let{minFinishingSum:T,winnerFinishingPositionRange:D}=cpe(U.matchUps),P=U.segmentsCount;if(P){let k=U.matchUps.length/P;return Rr(U.matchUps.sort((x,F)=>x.roundPosition-F.roundPosition),k).map((x,F)=>{let{unscheduledCount:$,incompleteCount:_,matchUpsCount:L,isScheduled:B,isComplete:V,byeCount:G}=aV(x),j=nV({matchUps:U.matchUps,tournamentRecords:n,events:f,round:U});return je({...U,...p,roundSegment:{segmentsCount:P,segmentNumber:F+1},winnerFinishingPositionRange:D,unscheduledCount:$,incompleteCount:_,minFinishingSum:T,matchUpsCount:L,isScheduled:B,roundTiming:j,isComplete:V,byeCount:G,matchUps:x})})}let{unscheduledCount:E,incompleteCount:R,matchUpsCount:N,isScheduled:A,isComplete:M,byeCount:C}=aV(U.matchUps),O=nV({matchUps:U.matchUps,tournamentRecords:n,events:f,round:U});return je({...U,...p,winnerFinishingPositionRange:D,unscheduledCount:E,incompleteCount:R,minFinishingSum:T,matchUpsCount:N,isScheduled:A,roundTiming:O,isComplete:M,byeCount:C})}).flat().filter(U=>{if(t){let F=mt(t),$=c?U.id:n1(U).id;if(F&&y[$]&&mt(y[$].scheduleDate)===F)return!1}let{isComplete:T,isScheduled:D}=U,P=!i||!T,E=!e||!D,R=d||u?f==null?void 0:f.find(({eventId:F})=>F===U.eventId):void 0,N=(R==null?void 0:R.startDate)??(o==null?void 0:o.startDate),A=(R==null?void 0:R.endDate)??(o==null?void 0:o.endDate),M=!u||!N||new Date(u)>=new Date(N),C=!u||!A||new Date(u)<=new Date(A),O=M&&C,k=!d||(R==null?void 0:R.validVenueIds.includes(d)),x=P&&E&&k&&O;return x||b.push(U),x}).sort(Ipe)||[];return{...X,rounds:S,excludedRounds:b}}function HI(t){var V;let{matchUp:e,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=t||{},{matchUpFormat:o}=t||{};if(!e)return{error:aa};o=o||(e==null?void 0:e.matchUpFormat);let s=kn(o),l=!!(e!=null&&e.winningSide),u=(V=e.score)==null?void 0:V.sets,c=u==null?void 0:u.length,d=r&&r-1,p=!!(u!=null&&u.find((G,j)=>G.setNumber===r&&j===d)),m=(u==null?void 0:u.filter(G=>G==null?void 0:G.winningSide))||[],h=(m==null?void 0:m.length)||0,f=r&&(u==null?void 0:u.slice(r))||[],g=!!(c&&r&&(f!=null&&f.reduce((G,j)=>(!j||!j.side1Score&&!j.side2Score&&!j.side1TiebreakScore&&!j.side2TiebreakScore&&!j.side1PointScore&&!j.side2PointScore)&&G,!0))),v=r<=c&&u.find(G=>G.setNumber===r),y=v&&jI({setObject:v,matchUpScoringFormat:s}),{isCompletedSet:I,sideGameScores:b,sideTiebreakScores:S}=y||{},w=!!(v&&!I&&g||r&&r===c+1&&!l),U=[1,2].includes(i),T=U?i-1:0,D=v&&U&&(!n&&!a&&b[T]!==void 0&&b[T]||n&&S[T]!==void 0&&S[T]),P=!!D,E=m==null?void 0:m.map(G=>jI({setObject:G,matchUpScoringFormat:s}).isValidSetOutcome).reduce((G,j)=>G&&j,!0),R=m.reduce((G,j)=>{let{winningSide:z}=j,W=z-1;return G[W]++,G},[0,0]),N=e==null?void 0:e.winningSide,A=N&&N-1,M=1-A,C=R[A],O=R[M],k=Math.max(...R),x=Ua(R)[k],{bestOf:F,exactly:$}=s??{},_=F&&Math.ceil(F/2)||$||1,L=k===_&&x===1&&R.indexOf(k)+1||void 0,B=C>O&&N===L;return{completedSetsHaveValidOutcomes:E,validMatchUpWinningSide:B,calculatedWinningSide:L,matchUpScoringFormat:s,validMatchUpOutcome:L&&E&&B,isLastSetWithValues:g,completedSetsCount:h,isCompletedMatchUp:l,isValidSideNumber:U,hasExistingValue:P,existingValue:D,isExistingSet:p,isActiveSet:w,...y}}function Dk({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,tournamentId:v,inContext:y,context:I,event:b}){let{eventId:S,eventName:w,endDate:U,eventType:T,category:D,gender:P}=b??{},E={...I,...je({surfaceCategory:(b==null?void 0:b.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(b==null?void 0:b.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:U??(b==null?void 0:b.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:w,eventType:T,category:D,eventId:S,gender:P})},R;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:R}=mp({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:h,inContext:y})),b&&h&&!c&&(c=Yu({policyDefinitions:a,tournamentRecord:s,contextProfile:h,drawDefinition:f,event:b})),{...jg({context:E,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,inContext:y,event:b}),groupInfo:R}}var oY={};bt(oY,{getCompetitionVenues:()=>Mb,getCourts:()=>Pk,getVenuesAndCourts:()=>Ju,publicFindVenue:()=>VA});function Pk({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=Ce(r.courts||[]);return a.forEach(o=>Object.assign(o,{venueId:n})),a}).flat()}:{error:ge}}var sY={};bt(sY,{categoryCanContain:()=>Ly,getCategoryAgeDetails:()=>wm,getEvent:()=>Ck,getEventProperties:()=>Rk,getEventStructures:()=>jT,getEventTimeItem:()=>Ky,getEvents:()=>Ek,getFlightProfile:()=>Gi,getScaledEntries:()=>gh});function Rk({tournamentRecord:t,event:e}){var d,p;if(!t)return{error:ge};if(!e)return{error:vi};let i=e.entries||[],r=t.participants||[],n=((d=e.category)==null?void 0:d.categoryName)||((p=e.category)==null?void 0:p.ageCategoryCode),{eventType:a}=e,o=i.map(m=>m.participantId),s=r.filter(m=>o.includes(m.participantId)),l,u,c;return{entryScaleAttributes:s.map(m=>{var S,w,U,T,D,P;let{participantId:h,participantName:f,name:g}=m,v={scaleType:BA,eventType:a,scaleName:n},y=(w=(S=Al({participant:m,scaleAttributes:v}))==null?void 0:S.scaleItem)==null?void 0:w.scaleValue;v={scaleType:VW,eventType:a,scaleName:n};let I=(T=(U=Al({participant:m,scaleAttributes:v}))==null?void 0:U.scaleItem)==null?void 0:T.scaleValue;v={scaleType:BW,eventType:a,scaleName:n};let b=(P=(D=Al({participant:m,scaleAttributes:v}))==null?void 0:D.scaleItem)==null?void 0:P.scaleValue;return l=!!(l||y),u=!!(u||I),c=!!(c||b),{participantId:h,participantName:f||g,seed:y,ranking:I,rating:b}}),hasSeededParticipants:l,hasRankedParticipants:u,hasRatedParticipants:c}}function Ek({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:o}){var c,d,p,m;if(!t)return{error:ge};let{tournamentId:s}=t,l=(t.events??[]).filter(({eventId:h})=>!n||Array.isArray(n)&&n.includes(h)).map(h=>{var v;let f=(v=h.drawDefinitions)==null?void 0:v.map(xI);if(a!=null&&a.length&&!Vi(a,f).length)return;let g=Ce(h);return r&&Object.assign(g,{tournamentId:s}),o&&Object.assign(g,o),g}).filter(Boolean),u={};if(e){let h=Mi({withScaleValues:!0,tournamentRecord:t}).participantMap,f=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of l){let v=i??g.eventType,y=g.eventId;u[y]||(u[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let I=(g.entries??[]).filter(({entryStatus:P})=>ds.includes(P)).map(Ut),b=P=>{var E,R,N,A,M,C;if((E=P==null?void 0:P.ratings)!=null&&E[v])for(let O of((R=P==null?void 0:P.ratings)==null?void 0:R[v])??[]){let k=O.scaleName;u[y].ratings[k]||(u[y].ratings[k]=[]);let x=(N=Nr[k])==null?void 0:N.accessor;if(x){let F=parseFloat((A=O.scaleValue)==null?void 0:A[x]);F&&u[y].ratings[k].push(F)}}if((M=P==null?void 0:P.rankings)!=null&&M[v])for(let O of((C=P==null?void 0:P.rankings)==null?void 0:C[v])??[]){let k=O.scaleName;u[y].ranking[k]||(u[y].ranking[k]=[]),O.scaleValue&&u[y].ranking[k].push(O.scaleValue)}};for(let P of I){let E=(c=h==null?void 0:h[P])==null?void 0:c.participant;if((E==null?void 0:E.participantType)!==St)for(let R of(E==null?void 0:E.individualParticipantIds)??[]){let N=(d=h==null?void 0:h[R])==null?void 0:d.participant;b(N)}else b(E)}let S=u[y].ratings;for(let P of Object.keys(S)){let E=S[P];if(!E.length)continue;let R=(p=yB(E))==null?void 0:p.toFixed(2);u[y].ratingsStats[P]={avg:parseFloat((f(E)/E.length).toFixed(2)),median:R?parseFloat(R):void 0,max:Math.max(...E),min:Math.min(...E)}}let w=(P,E)=>{var N,A;let R=M=>{var C,O,k,x,F,$,_,L,B,V;if((C=u[y].draws)!=null&&C[P]&&((O=M==null?void 0:M.ratings)!=null&&O[v]))for(let G of((k=M==null?void 0:M.ratings)==null?void 0:k[v])??[]){let j=G.scaleName;(x=u[y].draws[P])!=null&&x.ratings[j]||(u[y].draws[P].ratings[j]=[]);let z=(F=Nr[j])==null?void 0:F.accessor;if(z){let W=parseFloat(($=G.scaleValue)==null?void 0:$[z]);W&&u[y].draws[P].ratings[j].push(W)}}if((_=u[y].draws)!=null&&_[P]&&((L=M==null?void 0:M.rankings)!=null&&L[v]))for(let G of((B=M==null?void 0:M.rankings)==null?void 0:B[v])??[]){let j=G.scaleName;(V=u[y].draws[P])!=null&&V.ranking[j]||(u[y].draws[P].ranking[j]=[]);let z=G.scaleValue;z&&u[y].draws[P].ranking[j].push(z)}};for(let M of E.filter(Boolean)){let C=(N=h==null?void 0:h[M])==null?void 0:N.participant;if((C==null?void 0:C.participantType)!==St)for(let O of(C==null?void 0:C.individualParticipantIds)??[]){let k=(A=h==null?void 0:h[O])==null?void 0:A.participant;R(k)}else R(C)}},U=[],T=P=>(a==null?void 0:a.length)&&a.includes(P)||U.includes(P);for(let P of g.drawDefinitions??[]){let E=P.drawId;if(T(E))continue;let R=Ip({drawDefinition:P}).assignedParticipantIds??[];u[y].draws[E]||(u[y].draws[E]={ratingsStats:{},ratings:{},ranking:{}}),U.push(E),w(E,R)}let D=Gi({event:g}).flightProfile;for(let P of(D==null?void 0:D.flights)??[]){let E=P.drawId;if(T(E))continue;let R=P.drawEntries.map(Ut);w(E,R)}for(let P of U){let E=u[y].draws[P].ratings;for(let R of Object.keys(E)){let N=E[R];if(!N.length)continue;let A=(m=yB(N))==null?void 0:m.toFixed(2);u[y].draws[P].ratingsStats[R]={avg:parseFloat((f(N)/N.length).toFixed(2)),median:A?parseFloat(A):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return je({eventScaleValues:u,events:l,...X})}function Ck({tournamentRecord:t,drawDefinition:e,context:i,event:r}){var o;if(!t)return{error:ge};if(!r)return{error:vi};let n=Ce(r);i&&Object.assign(n,i);let a=e&&((o=n.drawDefinitions)==null?void 0:o.find(({drawId:s})=>e.drawId===s));return je({drawDefinition:a,event:n})}function ype(t){var m,h;let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=Upe(t),n=Spe({...t,policyDefinitions:r,appliedPolicies:i}),a=wpe(t),o=Tpe({...t,consideredEntries:a,appliedPolicies:i});if(o!=null&&o.error)return ee({result:o,stack:e});let s=Dpe({...t,consideredEntries:a}),l=bpe({...t,appliedPolicies:i,policyDefinitions:r,drawSize:s});if(l.error)return ee({result:l,stack:e});let u=l.drawType;if(isNaN(s)&&u!==_a)return ee({result:{error:Ny},stack:e});let c=(r==null?void 0:r[vs])??(i==null?void 0:i[vs]),d=t.seedingProfile??((h=(m=c==null?void 0:c.seedingProfile)==null?void 0:m.drawTypes)==null?void 0:h[u??""])??(c==null?void 0:c.seedingProfile);t.seedingProfile&&(r[vs]||(r[vs]={...r1[vs]}),r[vs].seedingProfile=d);let p=Ppe({...t,drawType:u});return p!=null&&p.error?ee({result:p,stack:e}):{drawSize:s,drawType:u,enforceGender:n,seedingProfile:d,appliedPolicies:i,policyDefinitions:r}}function bpe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??Rb({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),o=F3({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return o.error?o:{drawType:o.drawType}}function lY(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...ds,ib].includes(e.entryStatus))}function wpe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||lY(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Oe)}function Upe(t){let{tournamentRecord:e,event:i}=t,r=$t({tournamentRecord:e,event:i}).appliedPolicies??{},n=Ce(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function Spe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var r,n,a,o;return t??((n=(r=e==null?void 0:e[kr])==null?void 0:r.participants)==null?void 0:n.enforceGender)??((o=(a=i==null?void 0:i[kr])==null?void 0:a.participants)==null?void 0:o.enforceGender)}function Tpe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:o,event:s}=t;return s&&o&&ZT({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:o,event:s})}function Dpe(t){return!t.drawSize&&t.consideredEntries.length&&![_a,$y,xg,es,Hl].includes(t.drawType??"")&&Pg(t.consideredEntries.length)||t.drawSize&&et(t.drawSize)||!1}function Ppe(t){var o,s;let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:r,drawType:n}=t,a=!r&&e&&lD({tournamentRecord:e,categoryType:(o=i==null?void 0:i.category)==null?void 0:o.categoryType,categoryName:(s=i==null?void 0:i.category)==null?void 0:s.categoryName});return a!=null&&a.length&&!a.includes(n)?{error:pN}:{...X}}function xb(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:o}=Mi({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=lY(r==null?void 0:r.entries)??[],l=ype({...t,participantMap:o,participants:a,eventEntries:s});if(l.error)return ee({result:l,stack:n});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:m,seedingProfile:h}=l,f=r==null?void 0:r.eventType,g=t.matchUpType??f,v=Sde({...t,enforceGender:m,eventType:f,matchUpType:g});if(v.error)return ee({result:v,stack:n});let{matchUpFormat:y,tieFormat:I}=v;if(t.drawId&&typeof t.drawId!="string")return ee({result:{error:se},stack:n});let b=Qde({...t,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:y,seedingProfile:h,participants:a,eventEntries:s,matchUpType:g,tieFormat:I,drawSize:d,drawType:p,event:r});if(b.error)return ee({result:b,stack:n});let{existingDrawDefinition:S,positioningReports:w,drawDefinition:U,structureId:T,conflicts:D,entries:P}=b;if(!U)return ee({result:{error:se},stack:n});let E=Zde({...t,existingDrawDefinition:S,positioningReports:w,appliedPolicies:u,drawDefinition:U,seedingProfile:h,participants:a,structureId:T,entries:P,params:t,stack:n});if(E.error)return E;let{qualifyingConflicts:R}=E;return U.drawName=t.drawName??(p&&Zr(p)),d&&typeof e=="object"&&d>=4&&ZA({...e,drawDefinition:U,matchUpType:g}),{existingDrawDefinition:!!S,qualifyingConflicts:R,positioningReports:w,drawDefinition:U,structureId:T,...X,conflicts:D}}function uY({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Xe,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:s},l)=>({[s]:l+1})));n=n||t.scaleName;let o=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:a[s],eventType:t.eventType,scaleType:Ml,scaleName:n,scaleDate:o}],participantId:s}))}}function Rpe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:o,event:s,stage:l,sortDescending:u,scaleSortMethod:c}){let d=yD({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:o,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:m,stageEntries:h}=d;if(!h||!m)return{error:se};let f=gh({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=uY({scaleAttributes:r,scaledEntries:f,stageEntries:h,seedsCount:m,scaleName:n});return{scaleItemsWithParticipantIds:g}}var cY={};bt(cY,{addDrawEntries:()=>YA,addEventEntries:()=>Ks,addEventEntryPairs:()=>fY,destroyPairEntries:()=>pq,destroyPairEntry:()=>QA,getEntriesAndSeedsCount:()=>yD,getMaxEntryPosition:()=>hk,modifyEntriesStatus:()=>RS,modifyEventEntries:()=>gY,mutate:()=>dY,promoteAlternate:()=>mY,promoteAlternates:()=>Nk,query:()=>iY,removeDrawEntries:()=>hY,removeEventEntries:()=>mb,setEntryPosition:()=>Mk,setEntryPositions:()=>pY});var dY={};bt(dY,{addDrawEntries:()=>YA,addEventEntries:()=>Ks,addEventEntryPairs:()=>fY,destroyPairEntries:()=>pq,destroyPairEntry:()=>QA,modifyEntriesStatus:()=>RS,modifyEventEntries:()=>gY,promoteAlternate:()=>mY,promoteAlternates:()=>Nk,removeDrawEntries:()=>hY,removeEventEntries:()=>mb,setEntryPosition:()=>Mk,setEntryPositions:()=>pY});function Mk({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let o="setEntryPositions";if(!t)return{error:ge};if(!i)return ee({result:{error:mr},stack:o});if(r!==void 0&&!Number.isSafeInteger(r))return{error:se,entryPosition:r};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let s=l=>{l.entries.forEach(u=>{u.entryPosition===r&&u.participantId!==i&&(u.entryPosition+=.1)})};return n||(a!=null&&a.entries&&(s(a),a.entries=Ss({entries:a.entries})),e!=null&&e.entries&&(s(e),e.entries=Ss({entries:e.entries}))),{...X}}function pY({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:ge};if(!Array.isArray(e))return{error:se};for(let n of e){let{participantId:a,entryPosition:o}=n,s=Mk({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:o,event:r});if(s.error)return s}return r!=null&&r.entries&&(r.entries=Ss({entries:r.entries})),i!=null&&i.entries&&(i.entries=Ss({entries:i.entries})),{...X}}function mY(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:se,participantId:e}:Nk({...t,participantIds:[e].filter(Boolean)})}function Nk({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Oe,eventId:a,event:o}){if(!t)return{error:ge};if(!Array.isArray(i))return{error:se,participantIds:i};if(!o)return{error:vi};let s="promoteAlternates";if(o){let l=lV({element:o,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=lV({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?ee({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...X},stack:s}):l}return{...X}}function lV({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===Go),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),o=n.reduce((d,p)=>{let{entryPosition:m}=p;return isNaN(m)&&d||(!d||m<d.entryPosition)&&p||d},void 0),s=a.length?a:[o].filter(Boolean);if(!(s!=null&&s.length))return{error:oH};let l=s.filter(({entryStatus:d})=>d!==Go);if(l.length)return{error:wC,invalidEntryStatus:l};let u=s.filter(({entryStage:d})=>d&&d!==r);if(u.length)return{error:$ne,invalidStage:u};let c=e&&s.filter(d=>d.stageSequence!==e);if(c!=null&&c.length)return{error:Bne,invalidStageSequence:c};for(let d of s){d.entryStatus=sa;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(h=>{h.entryStatus===Go&&h.entryPosition>p&&(h.entryPosition=h.entryPosition-1)});let m=Math.max(...i.entries.filter(h=>h.entryStatus===sa&&!isNaN(h.entryPosition)).map(({entryPosition:h})=>et(h||0)),0);d.entryPosition=m||0}return{...X}}function hY({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){var c;if(!a)return{error:vi};if(!r)return{error:$s};if(!(e!=null&&e.length))return{error:jc};let o=Ip({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(Rn(o,e))return{error:Ng};let s=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:l}=Gi({event:a}),u=(c=l==null?void 0:l.flights)==null?void 0:c.find(d=>d.drawId===r);return u!=null&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(s),t&&(u.drawEntries=Ss({entries:u.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(s),t&&(i.entries=Ss({entries:i.entries}))),{...X}}function ll(t){var f,g,v,y,I;let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:o}=t,s=t.tournamentId?(f=t.tournamentRecords)==null?void 0:f[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((g=t.tournamentRecords)==null?void 0:g[t.activeTournamentId]));if(!s)return{error:ge};if(!o)return ee({result:{error:Km},stack:e});o.participantId||(o.participantId=Gt()),s.participants||(s.participants=[]);let{participantId:l,individualParticipantIds:u}=o;if(s.participants.reduce((b,S)=>S.participantId===l||b,!1))return{error:tH};let{participantType:c,participantRole:d}=o;if(!c||!Object.keys(Jv).includes(c))return{error:Cs,participantType:c};if(!d)return{error:eH};let p=s.participants||[],m=p.filter(b=>b.participantType===St).map(b=>b.participantId);if(c!==St&&o.person)return{error:se,person:o.person};if(u&&!Array.isArray(u))return{error:se,individualParticipantIds:u};if(c===ft){if(o.person)return{error:se,person:o.person};if(o.individualParticipantIds){if(o.individualParticipantIds.length!==2&&!a)return ee({info:"PAIR must be 2 individualParticipantIds",result:{error:Ia},stack:e});{let w=p.filter(U=>U.participantType===St).map(U=>U.participantId);if(!Array.isArray(o.individualParticipantIds))return ee({result:{error:Ia},stack:e});if(!o.individualParticipantIds.reduce((U,T)=>w.includes(T)&&U,!0))return ee({result:{error:Ia},stack:e})}}else return ee({result:{error:jc},stack:e});let b=p.filter(w=>w.participantType===ft).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),S=o.participantType===ft&&b.find(w=>Vi(w.individualParticipantIds,o.individualParticipantIds).length===2);if(S&&!i)return{...X,existingParticipant:!0,participant:r&&Ce(S.participant)};if(!o.participantName){let w=p.filter(T=>{var D;return(D=o.individualParticipantIds)==null?void 0:D.includes(T.participantId)}),U=w.map(T=>{var D;return(D=T.person)==null?void 0:D.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(U+="/Unknown"),o.participantName=U}}else if(c===St){if(!((v=o.person)!=null&&v.standardFamilyName)||!((y=o.person)!=null&&y.standardGivenName))return{error:aH};if(!o.participantName){let b=`${o.person.standardFamilyName.toUpperCase()}, ${o.person.standardGivenName}`;o.participantName=b}}else if(c&&[Kt,qa].includes(c)){if(u||(o.individualParticipantIds=[]),(I=o.individualParticipantIds)==null?void 0:I.length)for(let b of o.individualParticipantIds){if(typeof b!="string")return ee({result:{participantId:b,error:se},stack:e});if(!m.includes(b))return ee({result:{participantId:b,error:zi},stack:e})}}else return{error:Cs};s.participants.push(o),n||lt({payload:{tournamentId:s.tournamentId,participants:[o]},topic:Dc});let h={participant:r&&Ce(o),...X};return je(h)}function ns({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:ge};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=Gt())});let a=r.filter(d=>!n.includes(d.participantId)),o=r.filter(d=>n.includes(d.participantId)),s=a.filter(d=>d.participantType===St),l=a.filter(d=>d.participantType!==St),u=s.concat(...l),c=[];if(u.length){for(let p of u){let m=ll({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(m.error)return m;m.success&&!m.existingParticipant&&c.push(m.participant)}c.length&&lt({topic:Dc,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&Ce(c),addedCount:c.length,...X};return o.length&&Object.assign(d,{notAdded:o,info:q0}),je(d)}else return{info:"No new participants to add",addedCount:0,...X}}function fY(t){let e=ze(t,[{[wr]:!0,[Hc]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=Go,participantIdPairs:n=[],entryStage:a=Oe,tournamentRecord:o,drawDefinition:s,event:l,uuids:u}=t;if(l.eventType!==Zt)return{error:Vl};let c=[],d=new Map;for(let b of o.participants??[]){let{participantType:S,participantId:w,person:U,individualParticipantIds:T}=b;S===St&&(U!=null&&U.sex)?d.set(w,U.sex):S===ft&&T&&c.push(T)}let p=n.filter(b=>{if(b.length!==2)return!0;if(!l.gender||l.gender===Ms)return!1;if(!d.has(b[0])||!d.has(b[1]))return!0;let S=b.map(U=>d.get(U)),w=l.gender===Xt&&(S[0]!==Xt||S[1]!==Xt)||l.gender===mi&&(S[0]!==mi||S[1]!==mi);return l.gender===Bn&&(S.sort(_T),(S[0]!==mi||S[1]!==Xt)&&(w=!0)),w});if(p.length)return{error:Ia,invalidParticipantIdPairs:p};let m=n.map(b=>({participantId:(u==null?void 0:u.pop())??Gt(),participantRole:Qr,individualParticipantIds:b,participantType:ft})),h=i?m:m.filter(b=>!c.find(S=>Vi(S,b.individualParticipantIds).length===2)),f,g=[];if(h){let b=ns({allowDuplicateParticipantIdPairs:i,participants:h,returnParticipants:!0,tournamentRecord:o});if(b.error)return b;g=b.participants||[],f=b.info}let v=n.map(b=>{let S=g.find(U=>Vi(U.individualParticipantIds,b).length===2);if(S)return S;let{participant:w}=rs({tournamentRecord:o,participantIds:b});return w}).map(b=>b.participantId),y=Ks({participantIds:v,tournamentRecord:o,drawDefinition:s,entryStatus:r,entryStage:a,event:l});h.length&&lt({payload:{participants:h},topic:Dc});let I=h.map(Ut);return{...y,info:f,newParticipantIds:I}}function gY({entryStatus:t=sa,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Oe,tournamentRecord:n,event:a}){if(!n)return{error:ge};if(!a)return{error:vi};let o=n.participants??[],s=o.filter(f=>f.participantType===St).map(f=>f.participantId),l=e.concat(...i).flat(1/0).filter(f=>!s.includes(f));if(l.length)return{error:Ia,invalidParticipantIds:l};let u=i.filter(f=>f.length!==2);if(u.length)return{error:Ia,invalidParticipantIdPairs:u};let c=o.filter(f=>f.participantType===ft).map(f=>f.individualParticipantIds),d=i.filter(f=>!c.find(g=>Vi(g,f).length===2)).map(f=>({participantType:ft,participantRole:Qr,individualParticipantIds:f})),p=ns({participants:d,tournamentRecord:n});if(p.error)return p;let m=i.map(f=>{let{participant:g}=rs({tournamentRecord:n,participantIds:f});return g}).map(f=>({participantId:f,entryStatus:t,entryStage:r})),h=e.map(f=>({entryStatus:Uo,participantId:f,entryStage:r}));return a.entries=(a.entries??[]).filter(f=>f.entryStage===r),a.entries=a.entries.concat(...m,...h),{...X}}var vY={};bt(vY,{addDrawDefinition:()=>Fb,addEvent:()=>Xg,addFlight:()=>RD,assignSeedPositions:()=>CY,attachFlightProfile:()=>_k,categoryCanContain:()=>Ly,deleteDrawDefinitions:()=>TD,deleteEvents:()=>NY,deleteFlightAndFlightDraw:()=>RY,deleteFlightProfileAndFlightDraws:()=>UY,generate:()=>IY,generateEventsFromTieFormat:()=>yY,getCategoryAgeDetails:()=>wm,getEvent:()=>Ck,getEventProperties:()=>Rk,getEventStructures:()=>jT,getEventTimeItem:()=>Ky,getEvents:()=>Ek,getFlightProfile:()=>Gi,getScaledEntries:()=>gh,modifyEvent:()=>AY,modifyEventMatchUpFormatTiming:()=>SY,modifyPairAssignment:()=>EY,mutate:()=>bY,query:()=>sY,refreshEventDrawOrder:()=>Lk,removeEventMatchUpFormatTiming:()=>DD,removeScaleValues:()=>$k,removeSeeding:()=>MY,setEventDates:()=>xk,setEventDisplay:()=>PD,setEventEndDate:()=>kk,setEventStartDate:()=>Ok,updateDrawIdsOrder:()=>Fk,validateCategory:()=>EI});var IY={};bt(IY,{generateEventsFromTieFormat:()=>yY});function Epe({tournamentId:t,event:e}){return e?(lt({payload:{tournamentId:t,event:e},key:e.eventId,topic:dW}),{...X}):{error:vi}}var Cpe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},Mpe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},Npe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},Ape={COLLEGE_D3:Cpe,COLLEGE_DEFAULT:Mpe,COLLEGE_JUCO:Npe,DOMINANT_DUO:az,DOMINANT_DUO_MIXED:tz,LAVER_CUP:cz,TEAM_DOUBLES_3_AGGREGATION:JH,TIME_TENNIS_DUAL:iz,TIME_TENNIS_PRO_CIRCUIT:ez,USTA_BREWER_CUP:rz,USTA_OZAKI_CUP:nz,USTA_COLLEGE:oz,USTA_GOLD_TEAM_CHALLENGE:KH,USTA_INTERSECTIONAL:ZH,USTA_LEVEL_1:sz,USTA_SECTION_BATTLE:QH,USTA_SOUTHERN_LEVEL_5:XH,USTA_TOC:dz,USTA_WTT_ITT:lz,USTA_ZONAL:uz};function Xg({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){var s,l,u,c;if(!e)return{error:ge};if(e.events||(e.events=[]),!r)return{error:vi};let{startDate:n,endDate:a}=e;if(!i&&((s=r.entries)!=null&&s.length||(l=r.drawDefinitions)!=null&&l.length)){let d=je({drawDefinitions:!!((u=r.drawDefinitions)!=null&&u.length),entries:!!((c=r.entries)!=null&&c.length)});return{info:"entries/drawDefinitions cannot exist",error:se,context:d}}let o={eventType:Um,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===Ta){if(r.tieFormat){let d=Hn({tieFormat:r.tieFormat});if(d.error)return d}else if(r.tieFormatName){if(!Ape[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:se};let d=wu({isMock:e==null?void 0:e.isMock,namedFormat:r.tieFormatName,event:r});o.tieFormat=d}}if(o.eventId||(o.eventId=Gt()),e.events.reduce((d,p)=>d||p.eventId===o.eventId,void 0))return{error:FG};{let d=o;if(e.events.push(d),!t){let{topics:p}=yo();if(p.includes(ST)){let f=iu({event:r}).matchUps??[];Pc({tournamentId:e==null?void 0:e.tournamentId,eventId:r.eventId,matchUps:f})}let{drawDefinitions:m,...h}=r;for(let f of m||[])qy({drawDefinition:f});Epe({tournamentId:e==null?void 0:e.tournamentId,event:h})}return{...X,event:o}}}function yY(t){var o,s,l,u;let e=ze(t,[{[Lf]:{[pT]:!0,[_z]:!0}},{[wr]:!0}]);if(e.error)return e;let i=t.tieFormat||wu({namedFormat:t.tieFormatName}),r=t.uuids||[YH(i.collectionDefinitions.length)],n={[Xt]:[],[mi]:[]};if(t.addEntriesFromTeams){let c=(s=(o=t.tournamentRecord.participants)==null?void 0:o.filter(d=>d.participantType===Vn))==null?void 0:s.flatMap(d=>d.individualParticipantIds??[]);for(let d of t.tournamentRecord.participants??[])if(c!=null&&c.includes(d.participantId)){let p=(l=d.person)==null?void 0:l.sex;p&&[Xt,mi].includes(p)&&n[p].push(d.participantId)}}let a=[];for(let c of i.collectionDefinitions??[]){let d=((u=r==null?void 0:r.pop())==null?void 0:u.toString())||Gt(),p=c.matchUpType,m=c.gender,h={matchUpFormat:c.matchUpFormat,eventName:c.collectionName,category:c.category,gender:m,eventType:p,eventId:d};if(t.addEntriesFromTeams){let f=p===Uu?Uo:t.entryStatus||sa,g=m===Bn?[...n[Xt],...n[mi]]:n[m]??[];if(g.length){let v=Ks({participantIds:g,entryStatus:f,event:h});if(v.error)return v}}if(a.push(h),t.addEvents!==!1){let f=Xg({internalUse:!0,tournamentRecord:t.tournamentRecord,event:h});if(f.error)return f}}return{...X,events:a}}var bY={};bt(bY,{addDrawDefinition:()=>Fb,addEvent:()=>Xg,addFlight:()=>RD,assignSeedPositions:()=>CY,attachFlightProfile:()=>_k,deleteDrawDefinitions:()=>TD,deleteEvents:()=>NY,deleteFlightAndFlightDraw:()=>RY,deleteFlightProfileAndFlightDraws:()=>UY,modifyEvent:()=>AY,modifyEventMatchUpFormatTiming:()=>SY,modifyPairAssignment:()=>EY,refreshEventDrawOrder:()=>Lk,removeEventMatchUpFormatTiming:()=>DD,removeScaleValues:()=>$k,removeSeeding:()=>MY,setEventDates:()=>xk,setEventDisplay:()=>PD,setEventEndDate:()=>kk,setEventStartDate:()=>Ok,updateDrawIdsOrder:()=>Fk,validateCategory:()=>EI});function Qg({removePriorValues:t=!0,status:e=Ya,statusObject:i,event:r}){if(!Nt(i))return{error:se};let n=To({event:r,status:e}),a=`${Kc}.${Jc}`,o={itemValue:{[e]:{...n,...i}},itemType:a};return fh({timeItem:o,removePriorValues:t,event:r})}function Zg(t){var S,w,U,T,D,P,E;let e=ze(t,[{[wr]:!0,[Hc]:!0},{eventDataParams:!1,[Jn]:ta}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=Ya,event:o,drawIdsToRemove:s,drawIdsToAdd:l}=t,{appliedPolicies:u}=$t({tournamentRecord:n,event:o}),c={...u,...t.policyDefinitions},d=((S=o==null?void 0:o.drawDefinitions)==null?void 0:S.map(({drawId:R})=>R))??[],p=t.drawDetails?Object.keys(t.drawDetails):[],m=p.length?[]:t.drawIds,h=(l??[]).concat(...s??[],...m??[],...p),f=h.filter(R=>!d.includes(R));if(f.length)return ee({result:{error:Fa},context:{invalidDrawIds:f}});let g=To({event:o,status:a}),v=Object.keys((g==null?void 0:g.drawDetails)||{}).filter(R=>d.includes(R)).reduce((R,N)=>(R[N]=g.drawDetails[N],R),{});for(let R of d)if((!h.length||h.includes(R))&&(s!=null&&s.includes(R)||m!=null&&m.length&&!m.includes(R)?v[R]={...v[R],publishingDetail:{published:!1}}:(l!=null&&l.includes(R)||m!=null&&m.includes(R)||!(m!=null&&m.length))&&(v[R]={...v[R],publishingDetail:{published:!0}})),(w=t.drawDetails)==null?void 0:w[R]){let N=t.drawDetails[R],A=N.structureDetails??v[R].structureDetails,M=N.stageDetails??v[R].stageDetails??{},{structureIdsToRemove:C=[],structureIdsToAdd:O=[],publishingDetail:k={},stagesToRemove:x=[],stagesToAdd:F=[]}=N;if((O||F)&&(k.published=!0),v[R]={publishingDetail:k,structureDetails:A,stageDetails:M},O.length||C.length){let _=(((T=(U=o==null?void 0:o.drawDefinitions)==null?void 0:U.find(B=>B.drawId===R))==null?void 0:T.structures)??[]).map(({structureId:B})=>B),L=(O??[]).concat(C??[]).filter(B=>!_.includes(B));if(L.length)return ee({result:{error:Ci},context:{invalidStructureIds:L}});A=A??{};for(let B of _)C.includes(B)?A[B]={published:!1}:A[B]={published:!0};v[R].structureDetails=A}let $=(((P=(D=o==null?void 0:o.drawDefinitions)==null?void 0:D.find(_=>_.drawId===R))==null?void 0:P.structures)??[]).map(({stage:_})=>_);if(F.length){for(let _ of F)M[_]={published:!0};for(let _ of $)M[_]||(M[_]={published:!1})}if(F.length||x.length){for(let _ of x)M[_]={published:!1};for(let _ of $)M[_]||(M[_]={published:!0})}(F.length||x.length)&&(v[R].stageDetails=M)}Qg({statusObject:{drawDetails:v},removePriorValues:r,status:a,event:o});let{topics:y}=yo(),I=y.includes(AC),b=I||t.returnEventData?(E=mD({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:c,event:o}))==null?void 0:E.eventData:void 0;return I&&lt({payload:{eventData:b,tournamentId:n.tournamentId},topic:AC}),{...X,eventData:b}}var wY="deleteDrawDefinitions",a1="autoSchedulingAudit",VU="deleteEvents",Ope={AUTO_SCHEDULING_AUDIT:a1,DELETE_EVENTS:VU,DELETE_DRAW_DEFINITIONS:wY};function TD(t){var T,D,P,E,R;if(!t.tournamentRecord)return{error:ge};let e="deleteDrawDefinitions",i=t.drawIds??[],r=t.event,{autoPublish:n=!0,tournamentRecord:a,auditData:o,eventId:s,force:l}=t,{appliedPolicies:u}=$t({tournamentRecord:a,event:r}),c={...u,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!r){let N=Wn({tournamentRecord:a,eventId:s,drawId:d});if(N.error)return N;r=N.event}let p=[],m=[],h=[];if(!(r!=null&&r.drawDefinitions))return ee({info:"event has no drawDefinition",result:{...X},stack:e});let f=r.drawDefinitions.map(({drawId:N})=>N);if(i.length||(i=f),i=i.filter(N=>f.includes(N)),!i.length)return ee({info:"nothing to do; no matching drawIds in event.",result:{...X},stack:e});let g=Ce(Gi({event:r}).flightProfile,!1,!0),v=({participantId:N,drawPosition:A,qualifier:M,bye:C})=>({bye:C,qualifier:M,drawPosition:A,participantId:N}),y=l??((D=(T=u==null?void 0:u[Ns])==null?void 0:T.allowDeletionWithScoresPresent)==null?void 0:D.drawDefinitions),I=To({event:r})??{},b=I.drawIds??(I.drawDetails&&Object.keys(I.drawDetails))??[],S,w=[],U=r.drawDefinitions.filter(N=>{var A,M,C,O,k,x,F,$;if(i.includes(N.drawId)){let _=((A=Sn({event:r,drawDefinition:N}))==null?void 0:A.matchUps)??[];if(_.some(({score:re})=>Ir({score:re}))&&!y)return w.push(N.drawId),!0;let{drawId:L,drawType:B,drawName:V}=N,G=(M=g==null?void 0:g.flights)==null?void 0:M.find(re=>re.drawId===N.drawId);G&&(G.drawEntries=(C=G.drawEntries)==null?void 0:C.filter(re=>ds.includes(re.entryStatus))),b.includes(L)&&(b=b.filter(re=>re!==L),S=!0);let j=(k=(O=is({stageSequence:1,drawDefinition:N,stage:Oe}))==null?void 0:O.structures)==null?void 0:k[0],z=(F=(x=j?BI({structureId:j.structureId,tournamentRecord:a,drawDefinition:N}):void 0)==null?void 0:x.positionAssignments)==null?void 0:F.map(v),W=($=is({stage:Ke,drawDefinition:N}))==null?void 0:$.structures,q=W!=null&&W.length?W.map(re=>{var H;let J=re.stageSequence;return{positionAssignments:(H=BI({structureId:re.structureId,tournamentRecord:a,drawDefinition:N}))==null?void 0:H.positionAssignments.map(v),stageSequence:J}}):void 0,Y={action:wY,payload:{drawDefinitions:[N],eventId:s??(r==null?void 0:r.eventId),auditData:o}};h.push(Y),p.push(je({tournamentId:a.tournamentId,eventId:s??(r==null?void 0:r.eventId),qualifyingPositionAssignments:q,positionAssignments:z,auditData:o,drawType:B,drawName:V,drawId:L})),_==null||_.forEach(({matchUpId:re})=>m.push(re))}return!i.includes(N.drawId)});if(w.length&&!l)return ee({context:{drawIdsWithScoresPresent:w},result:{error:Z0},stack:e});if(r.drawDefinitions=U,g&&Wc({event:r,extension:{name:ts,value:g}}),Ab({tournamentRecord:a}),S){let N={};for(let M of b)N[M]=((P=I.drawDetails)==null?void 0:P[M])??{published:!0};let A=Qg({statusObject:{drawDetails:N},event:r});if(A.error)return{error:A.error}}if(h.length)if(eT(gu)){let N=a.tournamentId;lt({topic:gu,payload:{tournamentId:N,detail:h}});let A=(((R=(E=wo({element:r,itemType:Pd}))==null?void 0:E.timeItem)==null?void 0:R.itemValue)||0)+1;bl({element:r,timeItem:{itemType:Pd,itemValue:A},removePriorValues:!0})}else kpe({appliedPolicies:u,event:r,deletedDrawsDetail:p,auditData:o});if(m.length&&Wu({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:m}),i.forEach(N=>Aoe({drawId:N})),n&&S){let N=Zg({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:c,tournamentRecord:a,event:r});if(N.error)return{...X,info:N.error}}return{...X}}function kpe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){var s;if(((s=t==null?void 0:t.audit)==null?void 0:s[Pd])===!1)return;let{extension:n}=vt({name:Pd,element:e}),a={...r,deletedDrawsDetail:i},o={value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(a):[a],name:Pd};Lt({element:e,extension:o})}function UY({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){var o;if(!e)return{error:ge};if(!r)return{error:vi};let{flightProfile:a}=Gi({event:r});if(a){let s=(o=a.flights)==null?void 0:o.map(({drawId:u})=>u).filter(Boolean),l=TD({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return l.error?l:IT({event:r,name:ts})}return{...X}}function Ak(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,o=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(o).length)return{error:Oi};let s=Object.keys(o).filter(u=>!n||n===u);if(n&&!s.includes(n))return{error:se};let l;for(let u of s){let c=o[u],{event:d}=Wn({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=xpe({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...X}:{error:co}}function xpe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:ge};if(r&&!Array.isArray(r))return{error:se};if(e&&!Array.isArray(e))return{error:se};let a=Pu;if(n){let{extension:o}=vt({element:n,name:a}),s=(o==null?void 0:o.value)||{},l=uV({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});Lt({element:n,extension:{name:a,value:l}})}else{let{extension:o}=vt({element:t,name:a}),s=(o==null?void 0:o.value)||{},l=uV({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});Lt({extension:{name:a,value:l},element:t})}return{...X}}function uV(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let o=(n==null?void 0:n.length)&&i.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==r)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let s=(a==null?void 0:a.length)&&e.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==r)}:l}).filter(({matchUpFormatCodes:l,averageTimes:u})=>(l==null?void 0:l.length)||u).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:(o==null?void 0:o.length)&&o||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function SY(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:o,event:s}=t;if(!e)return{error:ge};if(!Sa({matchUpFormat:n}))return{error:se};if(!s)return{error:vi};let{averageTimes:l=[],recoveryTimes:u=[]}=bD({tournamentRecord:e,matchUpFormat:n,event:s}),c=s.category,d=(c==null?void 0:c.categoryName)||(c==null?void 0:c.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},m={categoryNames:[d],minutes:{}},h=I=>{var b,S;if((b=I.categoryTypes)!=null&&b.includes(a)&&console.log("encountered:",{categoryType:a}),!((S=I.categoryNames)!=null&&S.includes(d)&&(I.categoryNames=I.categoryNames.filter(w=>w!==d),p={minutes:I.minutes,categoryNames:[d]},!I.categoryNames.length)))return I},f=r&&!isNaN(et(r)),g=i&&!isNaN(et(i)),v=l.map(h).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length}),y=u.map(h).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length});return f&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||ii]:r}),v.push(p)),g&&(Object.assign(m.minutes,{[(s==null?void 0:s.eventType)||ii]:i}),y.push(m)),!f&&!g?{error:se}:Ak({averageTimes:f&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:n,eventId:o,event:s})}function DD(t){if(t.event)return cV({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=ze(t,[{[mn]:!0,[Gz]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=Wn({tournamentRecord:n,eventId:r});if(a)return cV({event:a})}}return{error:co}}function cV({event:t}){return IT({event:t,name:Pu})}var Fpe="MON",Lpe="TUE",_pe="WED",$pe="THU",Bpe="FRI",Vpe="SAT",jpe="SUN",TY={MON:Fpe,TUE:Lpe,WED:_pe,THU:$pe,FRI:Bpe,SAT:Vpe,SUN:jpe};function DY(t){return!Array.isArray(t)||ct(t).length!==t.length?!1:t.every(e=>Object.keys(TY).includes(e))}function Ok({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:ge};if(!e)return{error:vi};if(!il.test(i))return{error:Ar};let r=PY(t);if(r.error)return r;let{tournamentStartDate:n,tournamentEndDate:a}=r,o=new Date(mt(i)).getTime();if(!n||!a||o<n||o>a)return{error:Ar};let s=e.endDate&&new Date(mt(e.endDate)).getTime();return s&&o>s&&(e.endDate=i),e.startDate=i,{...X}}function kk(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:ge};if(!i)return{error:vi};if(!il.test(r))return{error:Ar};let n=PY(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:o}=n,s=new Date(mt(r)).getTime();if(!a||!o||s<a||s>o)return{error:Ar};let l=i.startDate&&new Date(mt(i.startDate)).getTime();return l&&s<l&&(i.startDate=r),i.endDate=r,{...X}}function xk(t){var l;let e=ze(t,[{tournamentRecord:!0,event:!0},{[Kr]:u=>il.test(u),[$a]:Ar,startDate:!1,endDate:!1},{[Kr]:u=>u.filter(Boolean).every(c=>il.test(c)),[$a]:Ar,activeDates:!1},{[Kr]:DY,weekdays:!1}]);if(e.error)return e;let{tournamentRecord:i,weekdays:r,event:n,startDate:a,endDate:o}=t,s=(l=t.activeDates)==null?void 0:l.filter(Boolean);if(a&&o){let u=new Date(mt(a)).getTime(),c=new Date(mt(o)).getTime();if(u>c)return{error:se}}if(s){let u=a||i.startDate,c=o||i.endDate,d=!u||s.every(m=>new Date(m)>=new Date(u)),p=!c||s.every(m=>new Date(m)<=new Date(c));if(!d||!p)return{error:Ar}}if(a){let u=Ok({tournamentRecord:i,event:n,startDate:a});if(u.error)return u}if(o){let u=kk({tournamentRecord:i,event:n,endDate:o});if(u.error)return u}return s&&(n.activeDates=s),r&&(n.weekdays=r),{...X}}function PY(t){let{startDate:e,endDate:i}=t;return!il.test(e)||!il.test(i)?ee({result:{error:JG},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(mt(e)).getTime(),tournamentEndDate:new Date(mt(i)).getTime()}}function Fk({event:t,orderedDrawIdsMap:e}){var n,a;if(typeof t!="object")return{error:vi};if(!e)return{error:Xe,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:se,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(o=>!isNaN(o)))return{error:se,info:"drawOrder must be numeric"};if(ct(i).length!==i.length)return{error:se,info:"drawOrder values must be unique"};if((n=t.drawDefinitions)!=null&&n.length){let o=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&Vi(o,s).length!==o.length)return{error:se,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:r}=Gi({event:t});return(a=r==null?void 0:r.flights)==null||a.forEach(o=>{o.flightNumber=e[o.drawId]}),{...X}}function Lk({tournamentRecord:t,event:e}){var n;if(!t)return{error:ge};if(!e)return{error:vi};let{flightProfile:i}=Gi({event:e}),r=(i==null?void 0:i.flights)&&Object.assign({},...i.flights.sort((a,o)=>a.flightNumber-o.flightNumber).map((a,o)=>({[a.drawId]:o+1})))||((n=e.drawDefinitions)==null?void 0:n.length)&&Object.assign({},...e.drawDefinitions.sort((a,o)=>a.drawOrder-o.drawOrder).map((a,o)=>({[a.drawId]:o+1})))||void 0;return r?Fk({event:e,orderedDrawIdsMap:r}):{...X}}function RY({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){var s,l;if(!e)return{error:ge};if(!r)return{error:$s};if(!n)return{error:vi};let{flightProfile:o}=Gi({event:n});if(o&&((s=o.flights)!=null&&s.find(u=>u.drawId===r))){let u=o.flights.filter(d=>d.drawId!==r),c={name:ts,value:{...o,flights:u}};Wc({event:n,extension:c})}if((l=n.drawDefinitions)!=null&&l.find(u=>u.drawId===r)){let u=TD({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(u.error)return u}return Lk({tournamentRecord:e,event:n})}function EY(t){var g,v;let e=ze(t,[{[Hc]:!0,[wr]:!0,[nA]:!1},{replacementIndividualParticipantId:!0,[Kr]:y=>Di(y),existingIndividualParticipantId:!0,[jo]:mr,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:r,tournamentRecord:n,drawDefinition:a,participantId:o,event:s,uuids:l}=t;if(e.error)return e;if((s==null?void 0:s.eventType)!==po)return{error:Vl};if(!(((g=s==null?void 0:s.entries)==null?void 0:g.filter(({entryStatus:y})=>[Uo,fp].includes(y)).map(({participantId:y})=>y))||[]).includes(i))return{error:Es};let u=(n.participants||[]).find(y=>y.participantId===o);if((u==null?void 0:u.participantType)!==ft)return{error:Ym,participant:u};let c=u.individualParticipantIds,d=[i,...c.filter(y=>y!==r)],{participant:p}=rs({participantIds:d,tournamentRecord:n}),m;if(p)m=p.participantId;else{let y={participantId:l==null?void 0:l.pop(),participantRole:Qr,individualParticipantIds:d,participantType:ft},I=ll({participant:y,returnParticipant:!0,tournamentRecord:n});if(I.error)return I;m=I.participant.participantId}let{flightProfile:h}=Gi({event:s});if(a){let y=(v=h==null?void 0:h.flights)==null?void 0:v.find(({drawId:I})=>I===a.drawId);y&&(y.drawEntries=y.drawEntries.map(I=>I.participantId===o?{...I,participantId:m}:I)),a.entries=a.entries.map(I=>I.participantId===o?{...I,participantId:m}:I);for(let I of a.structures||[])if(I.structures){I.positionAssignments=void 0;for(let b of I.structures)b.positionAssignments=b.positionAssignments.map(S=>S.participantId===o?{...S,participantId:m}:S)}else I.positionAssignments&&(I.positionAssignments=I.positionAssignments.map(b=>b.participantId===o?{...b,participantId:m}:b))}s.entries=s.entries.map(y=>y.participantId===o&&{...y,participantId:m}||y.participantId===i&&{...y,participantId:r}||y);let f=n.events.some(({entries:y,eventId:I,drawDefinitions:b})=>s.eventId===I?b.some(({drawId:S,entries:w})=>S===(a==null?void 0:a.drawId)?!1:w==null?void 0:w.find(U=>U.participantId===o)):y==null?void 0:y.find(S=>S.participantId===o));if(!f){let y=ph({addIndividualParticipantsToEvents:!1,participantIds:[o],tournamentRecord:n});if(y.error)return y}return{...X,participantOtherEntries:f,newPairParticipantId:m}}function Fb(t){var R,N,A,M,C,O,k,x,F,$,_,L;let{flight:e,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:o,tournamentRecord:s,drawDefinition:l,event:u}=t;if(!l)return{error:Le};if(!u)return{error:vi};u.drawDefinitions||(u.drawDefinitions=[]);let{drawId:c,drawName:d,entries:p}=l,{entries:m}=u,h=0;if(n!==void 0&&n!==u.drawDefinitions.length)return{error:se,info:"drawDefintions count mismatch"};let{flightProfile:f}=Gi({event:u}),g=e&&((R=f==null?void 0:f.flights)==null?void 0:R.find(B=>B.flightNumber===e.flightNumber)),v=(M=(A=(N=f==null?void 0:f.links)==null?void 0:N.find(B=>{var V;return((V=B==null?void 0:B.target)==null?void 0:V.drawId)===c}))==null?void 0:A.source)==null?void 0:M.drawId;if(v&&!u.drawDefinitions.find(B=>B.drawId===v))return ee({result:{error:Le},info:{sourceDrawId:v}});if(g&&g.drawId!==l.drawId)return ee({result:{error:Xp},info:{relevantFlight:g}});let y=p==null?void 0:p.every(({participantId:B,entryStatus:V})=>{let G=g==null?void 0:g.drawEntries.find(j=>j.participantId===B);return!V||(G==null?void 0:G.entryStatus)===V}),I=!o||m&&(p==null?void 0:p.every(({participantId:B,entryStatus:V,entryStage:G})=>{var j;return((j=m.find(z=>z.participantId===B&&(!z.entryStage||z.entryStage===G)))==null?void 0:j.entryStatus)===V}));if(g&&!y)return ee({result:{error:Xp},context:{drawEntriesPresentInFlight:y,matchingEventEntries:I,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&(p==null||p.filter(Boolean).forEach(B=>{if(B!=null&&B.entryStatus&&ds.includes(B==null?void 0:B.entryStatus)){let V=m==null?void 0:m.filter(Boolean).find(G=>G.participantId===B.participantId);V&&B.entryStatus&&(V==null?void 0:V.entryStatus)!==B.entryStatus&&(V.entryStatus=B.entryStatus,h+=1)}})),m&&!I)return ee({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:I,eventEntries:m},error:Xp}});let b=((O=(C=f==null?void 0:f.flights)==null?void 0:C.map(({flightNumber:B})=>!isNaN(B)&&et(B)))==null?void 0:O.filter(Boolean))||[],S=((k=u.drawDefinitions.map(({drawOrder:B})=>B&&et(B)))==null?void 0:k.filter(Boolean))||[],w=Math.max(0,...S,...b)+1,U=(x=f==null?void 0:f.flights)==null?void 0:x.find(B=>B.drawId===c),T;if(U){U.drawName=l.drawName,T={name:ts,value:{...f,flights:f.flights}};let B=U.flightNumber;B&&!S.includes(B)?w=B:U.flightNumber=w}else{let B=(f==null?void 0:f.flights)||[];B.push({manuallyAdded:!0,flightNumber:w,drawEntries:p,drawName:d,drawId:c}),T={name:ts,value:{...f||{},flights:B}}}Wc({event:u,extension:T}),Object.assign(l,{drawOrder:w});let D=u.drawDefinitions.find(B=>B.drawId===c),P=s==null?void 0:s.tournamentId,E=u.eventId;if(D){if(!a)return{error:PG};let B=(($=(F=Sn({drawDefinition:D}))==null?void 0:F.matchUps)==null?void 0:$.map(Dr))??[],V=(_=Sn({drawDefinition:l}))==null?void 0:_.matchUps;if(!i){B!=null&&B.length&&Wu({matchUpIds:B,action:"modifyDrawDefinition",tournamentId:P,eventId:E}),V!=null&&V.length&&Pc({matchUps:V,tournamentId:P,eventId:E}),u.drawDefinitions=u.drawDefinitions.map(j=>j.drawId===c?l:j);let G=(L=l.structures)==null?void 0:L.map(({structureId:j})=>j);li({drawDefinition:l,tournamentId:P,structureIds:G,eventId:E})}}else if(u.drawDefinitions.push(l),!i){let{matchUps:B}=Sn({drawDefinition:l,event:u});B&&Pc({tournamentId:s==null?void 0:s.tournamentId,matchUps:B}),qy({drawDefinition:l,tournamentId:P,eventId:E})}return{...X,modifiedEventEntryStatusCount:h}}function CY(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:u}=t,c=0;if(!(s!=null&&s.length))return{error:gN};if(!r)return{error:ge};if(!l)return{error:$s};let d=ho({provisionalPositioning:e,drawDefinition:n,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:m}=d,h=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:y}=v;m&&y<=m&&(!i||h[y])&&(h[y]=v)});let f=Object.values(h),g=f.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==fG(g).length)return{error:RG};for(let v of f){let y=zg({...v,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,event:u});if(y!=null&&y.error)return y;y!=null&&y.success&&c++}return c?{...X,modifications:c}:{error:Og}}function _k({deleteExisting:t,event:e,flightProfile:i}){var a;let r="attachFlightProfile";if(!i)return ee({result:{error:Xe},stack:r});if(!e)return ee({result:{error:vi},stack:r});let{flightProfile:n}=Gi({event:e});return n&&!t?ee({result:{error:ON},stack:r}):(a=e.drawDefinitions)!=null&&a.length?ee({result:{error:SG},stack:r}):(Wc({event:e,extension:{name:ts,value:i}}),{flightProfile:Ce(i,!1,!0),...X})}function Gpe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var s;if(!t)return{error:ge};if(!i)return{error:jc};if(!e)return{error:Xe,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=e,o=[$W,r,n,a].join(".");return(s=t.participants)==null||s.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(u=>u&&(u==null?void 0:u.itemType)!==o))}),{...X}}function $k({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:o}){var u;if(!a)return{error:vi};if(r&&!Array.isArray(r))return ee({result:{error:se},info:Bd("entryStatus"),stack:"removeScaleValues"});let s=a.entries;if(n){let{flightProfile:c}=Gi({event:a}),d=(u=c==null?void 0:c.flights)==null?void 0:u.find(p=>p.drawId===n);d?s=d.drawEntries:s=i==null?void 0:i.entries}let l=(s||[]).filter(c=>(!o||!c.entryStage||c.entryStage===o)&&(!r||r.includes(c.entryStatus))).map(Ut);return Gpe({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function PD({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=Ya,event:n}){if(!e)return ee({result:{error:ge}});if(!n)return ee({result:{error:vi}});if(!Nt(i))return ee({result:{error:Xe}});if(Nt(i.draws))for(let o of Object.keys(i.draws)){let s=i.draws[o].scheduleDetails??[];if(s.length){let l=[];for(let u of s){let c=l.find(d=>Sne(d.attributes,u.attributes));c!=null&&c.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[o].scheduleDetails=l}}let a=Qg({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...X}}function MY({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:o}){var l,u;if(!t)return{error:ge};if(!a)return{error:vi};r=r||((l=a.category)==null?void 0:l.categoryName)||((u=a.category)==null?void 0:u.ageCategoryCode);let s={eventType:a.eventType,scaleType:Ml,scaleName:r};return $k({tournamentRecord:t,scaleAttributes:s,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:o})}function NY(t){let e=ze(t,[{[wr]:!0},{eventIds:!0,[Jn]:cn}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],o=[],s=[],l=[];if(r.events=(r.events||[]).filter(u=>{if(n.includes(u.eventId)){let p={action:VU,payload:{events:[u]}};a.push(p),o.push({tournamentId:r.tournamentId,eventName:u.eventName,eventType:u.eventType,category:u.category,eventId:u.eventId,gender:u.gender})}let c=u.eventType===po?(u.entries||[]).map(({entryStatus:p,participantId:m})=>p!==Uo&&m).filter(Boolean):[],d=n.includes(u.eventId);return d?l.push(...c):s.push(...c),!d}),i){let u=l.filter(c=>!s.includes(c));r.participants=r.participants.filter(({participantId:c})=>!u.includes(c))}if(Ab({tournamentRecord:r}),a.length)if(eT(gu)){let u=r.tournamentId;lt({topic:gu,payload:{type:VU,tournamentId:u,detail:a}})}else Db({tournamentRecord:r,timeItem:{itemValue:o,itemType:VU}});return{...X}}function AY(t){var f,g,v;let e=ze(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:ta}]);if(e.error)return e;let{eventUpdates:i,event:r}=t,n="modifyEvent",a=Wpe(t),o=qpe({enteredParticipants:a}),{enteredParticipantGenders:s,enteredParticipantTypes:l}=o,u=(g=(f=Gi({event:r}))==null?void 0:f.flightProfile)==null?void 0:g.flights,c=!((v=r.drawDefinitions)!=null&&v.length)&&!(u!=null&&u.length),d=Ype({noFlightsNoDraws:c,enteredParticipantGenders:s,eventUpdates:i,stack:n});if(d.error)return d;let p=Kpe({enteredParticipantTypes:l,eventUpdates:i,stack:n});if(p.error)return p;let m=Hpe({...t,...o,enteredParticipants:a,stack:n});if(m.error)return m;let h=zpe({...t,stack:n});return h.error?h:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{...X})}function Hpe(t){var r,n,a,o,s,l;let e=(r=t.eventUpdates)==null?void 0:r.category;if(!e)return{...X};let i=EI({category:e});if(i.error)return i;if(t.event.eventType===lr){let u=((a=(n=t.event)==null?void 0:n.drawDefinitions)==null?void 0:a.map(p=>js(p)))??[],c=js(t.event),d=(((o=iu(t))==null?void 0:o.matchUps)??[]).map(p=>js(p))??[];if(![c,...u,...d].filter(Boolean).every(p=>p.collectionDefinitions.every(m=>!m.category||Ly({category:t.eventUpdates.category,childCategory:m.category}))))return ee({result:{error:UI},stack:t.stack})}if((s=t.enteredParticipants)!=null&&s.length){let u=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,c=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,d=t.enteredParticipants.map(h=>h.participantType===St?h:h.individualParticpants??[]).flat(),p=wm({category:e,consideredDate:u}),m=wm({category:e,consideredDate:c});if(p!=null&&p.ageMinDate||p!=null&&p.ageMaxDate||m!=null&&m.ageMinDate||m!=null&&m.ageMaxDate)for(let h of d){let f=(l=h.person)==null?void 0:l.birthDate;if(!f)return ee({result:{error:WG},stack:t.stack});let g=new Date(f).getTime();if(p.ageMinDate||p.ageMaxDate){let v=new Date(p.ageMinDate).getTime(),y=new Date(p.ageMaxDate).getTime();if(g<v||g>y)return ee({result:{error:bC},stack:t.stack})}if(m.ageMin||m.ageMax){let v=new Date(m.ageMinDate).getTime(),y=new Date(m.ageMaxDate).getTime();if(g<v||g>y)return ee({result:{error:bC},stack:t.stack})}}}return{...X}}function zpe(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=xk({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:r});if(a.error)return ee({result:a,stack:n})}return{...X}}function Wpe(t){var n;let{tournamentRecord:e,event:i}=t,r=((n=i==null?void 0:i.entries)==null?void 0:n.filter(({entryStatus:a})=>{let o=a;return[...ds,Go].includes(o)}).map(({participantId:a})=>a))??[];return r?Mi({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function qpe({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{var s,l;let o=(s=a.person)!=null&&s.sex?[a.person.sex]:((l=a.individualParticpants)==null?void 0:l.map(u=>{var c;return(c=u.person)==null?void 0:c.sex}))||[];return e.push(...o),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=ct(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function Ype({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||i.gender===Ms||e.length===1&&e[0]===i.gender||t&&i.gender===Bn;return i.gender&&!n?ee({context:{gender:i.gender,validGender:n},result:{error:Yv},stack:r}):{...X}}function Kpe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(lr)&&[lr]||t.includes(St)&&[rl]||t.includes(ft)&&[po]||[po,rl,lr]).includes(e.eventType??"");return e.eventType&&!r?ee({context:{participantType:e.eventType,validEventType:r},result:{error:Vl},stack:i}):{...X}}function RD({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){var m,h,f;let o="addFlight";if(!n)return ee({result:{error:vi},stack:o});if(!i)return ee({result:{error:Xe},stack:o});if(e!=null&&e.length){let g=(n.entries??[]).map(Ut),v=e.map(Ut);if(Vi(v,g).length!==v.length)return ee({result:{error:se},stack:o})}let s=(m=Gi({event:n}))==null?void 0:m.flightProfile,l=((f=(h=s==null?void 0:s.flights)==null?void 0:h.map(({flightNumber:g})=>!isNaN(g)&&et(g)))==null?void 0:f.filter(Boolean))||[],u=Math.max(0,...l)+1,c={drawId:r||Gt(),flightNumber:u,drawEntries:e,drawName:i};if(a&&(c.stage=a),t&&(c.qualifyingPositions=t),((s==null?void 0:s.flights)||[]).find(({drawId:g})=>g===c.drawId))return ee({result:{error:DH},stack:o});let d=((s==null?void 0:s.flights)||[]).concat(c),p={name:ts,value:{...s||{},flights:d}};return Wc({event:n,extension:p})}var OY={};bt(OY,{drawMatic:()=>XO,garman:()=>BY,generateAdHocMatchUps:()=>eD,generateAdHocRounds:()=>JO,generateAndPopulatePlayoffStructures:()=>PO,generateCourts:()=>Bk,generateDrawDefinition:()=>xb,generateDrawMaticRound:()=>BO,generateDrawStructuresAndLinks:()=>LO,generateDrawTypeAndModifyDrawDefinition:()=>_O,generateFlightProfile:()=>Qpe,generateLineUps:()=>$Y,generateQualifyingStructure:()=>vO,generateSeedingScaleItems:()=>uY,generateStatCrew:()=>Zpe,generateVoluntaryConsolation:()=>H3,roundRobinGroups:()=>tle});var Jpe="splitLevelBased",kY="splitWaterfall",xY="splitShuttle",Xpe={SPLIT_LEVEL_BASED:Jpe,SPLIT_WATERFALL:kY,SPLIT_SHUTTLE:xY};function Qpe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:m}=t;if(!p)return{error:vi};let h=p.entries??[],{flightProfile:f}=Gi({event:p});if(f&&i&&!o)return{error:ON};let g=t.scaledEntries??gh({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:s,event:p,stage:m}).scaledEntries,v=g.map(Ut),y=wn(h.filter(({participantId:P})=>!v.includes(P)).filter(P=>(!m||!P.entryStage||P.entryStage===m)&&(!P.entryStatus||gp.includes(P.entryStatus)))),I=g.concat(...y),b=I.length,S=Math.ceil(b/u),w=Rr(I,S);c===kY?w=pC(I,u):c===xY&&(w=pC(I,u,!0));function U(P){return(P||[]).map(({participantId:E,scaleValue:R})=>{let N=h.find(A=>A.participantId===E);return N!=null&&N.scaleValue&&R&&(N.scaleValue=R),N}).sort((E,R)=>E.scaleValue-R.scaleValue).map((E,R)=>(E.scaleValue&&(E.seedNumber=R+1),E))}let T=Te(0,u).map(P=>{let E=P+1;return{flightNumber:E,drawId:(d==null?void 0:d.pop())??Gt(),drawEntries:U(w[P]),drawName:(l==null?void 0:l.length)&&l[P]||`${e} ${E}`}}),D={scaleAttributes:n,splitMethod:c,flights:T};if(i){let P=_k({flightProfile:D,deleteExisting:o,event:p});return{splitEntries:La()&&w||void 0,...P}}else return{flightProfile:D,...X}}function FY({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(o=>typeof o=="object"&&Object.keys(o).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return LY({tagName:e,attributes:n,childArrays:i,childObjects:r})}function LY(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,o=m=>{let h=Object.keys(m)[0],f=m[h];return{key:h,value:f}},s=r==null?void 0:r.map(({key:m,value:h})=>LY({tagName:m,childObjects:h.map(o)})).join(`\r
`),l=n==null?void 0:n.map(({key:m,value:h})=>FY({tagName:m,json:h??[]})).join(`\r
`),u=i==null?void 0:i.map(({key:m,value:h})=>`${m}="${h}"`).join(" "),c=u?` ${u}`:"";if(e==="childArray")return l;let d=l!=null&&l.length?`${a}${l}${a}`:"",p=s!=null&&s.length?`${a}${s}${a}`:"";return`<${e}${c}>${d}${p}</${e}>`}function Zpe(t){var I,b,S;let e=ze(t,[{[wr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:r,tournamentId:n,tournamentName:a}=i,{participantMap:o,matchUps:s,mappedMatchUps:l}=Mi({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),u=i.participants.filter(w=>w.participantType===Kt),c=(s==null?void 0:s.filter(w=>w.matchUpType===Kt))??[],d=(c==null?void 0:c.reduce((w,U)=>{let T=(U==null?void 0:U.tieMatchUps)??[];return T&&[...w,...T]},[]))??[],p=(s==null?void 0:s.filter(w=>w.matchUpType===ii))??[],m=(s==null?void 0:s.filter(w=>w.matchUpType===Zt))??[],h=d.length===p.length+m.length,f=c.length===1&&h,g={mappedMatchUps:l,participantMap:o,tournamentName:a,tournamentId:n,tournament:h?"N":"Y",startDate:r},v=[],y=[];if(f){let w=c[0],{json:U,xml:T}=dV({teamParticipants:u,teamMatchUp:w,...g,doubles:m,singles:p});y.push(U),v.push(T)}else for(let w of c){let U=(I=w==null?void 0:w.sides)==null?void 0:I.map(({participant:E})=>E==null?void 0:E.participantId).filter(Boolean);if((U==null?void 0:U.length)!==2)continue;let T=U.map(E=>{var R;return E&&((R=o==null?void 0:o[E])==null?void 0:R.participant)}),{xml:D,json:P}=dV({doubles:(b=w.tieMatchUps)==null?void 0:b.filter(E=>E.matchUpType===Zt),singles:(S=w.tieMatchUps)==null?void 0:S.filter(E=>E.matchUpType===ii),teamParticipants:T,teamMatchUp:w,...g});y.push(P),v.push(D)}return{json:y,xml:v,...X}}function dV({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:o,startDate:s,doubles:l,singles:u}){var b,S,w,U;let c=t==null?void 0:t.find(T=>{var D;return(D=T.participantRoleResponsibilities)==null?void 0:D.includes("Home")}),d=t==null?void 0:t.filter(T=>T.participantId!==(c==null?void 0:c.participantId)),p=Vo(s,"/","MDY"),m=(c==null?void 0:c.participantName)||((b=d==null?void 0:d[1])==null?void 0:b.participantName),h=(c==null?void 0:c.participantId)||((S=d==null?void 0:d[1])==null?void 0:S.participantId),f=(w=d==null?void 0:d[0])==null?void 0:w.participantName,g=(U=d==null?void 0:d[0])==null?void 0:U.participantId,v={},y=t.map(T=>({team:{...ime({teamParticipant:T,teamMatchUp:a,uniValues:v,participantMap:i,mappedMatchUps:e,homeid:h})}})),I=je({venue:{tournamentname:o?r:void 0,neutralgame:c?"N":"Y",gameid:n,officials:{},tournament:o,rules:{},homename:m,visname:f,homeid:h,visid:g,date:p},childArray:y,singles_matches:u==null?void 0:u.map(T=>pV({matchUp:T,homeid:h,uniValues:v})),doubles_matches:l==null?void 0:l.map(T=>pV({matchUp:T,homeid:h,uniValues:v}))});return{json:I,xml:FY({json:I,tagName:"tngame"})}}function eme({homeid:t,uniValues:e,participant:i}){var f,g,v,y,I,b,S,w,U,T,D,P,E,R,N;if(!i)return{};let r=((f=i.individualParticipants)==null?void 0:f.length)===2,n=r?ct((g=i.individualParticipants)==null?void 0:g.map(A=>{var M,C;return(C=(M=A.teams)==null?void 0:M[0])==null?void 0:C.participantId})):[],a=r?ct((v=i.individualParticipants)==null?void 0:v.map(A=>{var M,C;return(C=(M=A.teams)==null?void 0:M[0])==null?void 0:C.teamId})):[],o=!r&&((I=(y=i.teams)==null?void 0:y[0])==null?void 0:I.participantId)||(n==null?void 0:n.length)===1&&n[0]||void 0,s=!r&&((S=(b=i.teams)==null?void 0:b[0])==null?void 0:S.teamId)||(a==null?void 0:a.length)===1&&a[0]||o,l=r?void 0:i.participantName,u=(U=(w=i.individualParticipants)==null?void 0:w[0])==null?void 0:U.participantName,c=(D=(T=i.individualParticipants)==null?void 0:T[1])==null?void 0:D.participantName,d=t&&(o===t?"H":"V")||"",p=r?void 0:e[o][i.participantId],m=e[o][(E=(P=i.individualParticipants)==null?void 0:P[0])==null?void 0:E.participantId],h=e[o][(N=(R=i.individualParticipants)==null?void 0:R[1])==null?void 0:N.participantId];return je({vh:d,uni:p,uni_1:m,uni_2:h,team:s,name:l,name_1:u,name_2:c})}function tme({sets:t,sideNumber:e}){return Object.assign({},...(t==null?void 0:t.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s}=i,l=`set_${r}`,u=`tie_${r}`,c=e===1?n:a,d=e===1?o:s;return{[l]:c,[u]:d}}))??[])}function ime({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){var b,S,w,U,T,D,P,E,R,N,A,M,C,O;let{participantId:o,participantName:s}=t,l=n&&(o===n?"H":"V")||"",u=(b=i==null?void 0:i[o])==null?void 0:b.matchUps,c=u&&Object.keys(u),d=(w=(S=e==null?void 0:e.sides)==null?void 0:S.find(({participant:k})=>k.participantId===o))==null?void 0:w.sideNumber,p=((D=(T=(U=e==null?void 0:e.score)==null?void 0:U.sets)==null?void 0:T[0])==null?void 0:D[`side${d}Score`])??0;a[o]={};let m={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},h=[],f=[],g=0;for(let k of c??[]){let x=r==null?void 0:r[k],F=(P=x.sides.find(({participant:_})=>_.participantId===o))==null?void 0:P.sideNumber,$=((N=(R=(E=x.score)==null?void 0:E.sets)==null?void 0:R[0])==null?void 0:N[`side${F}Score`])??0;g+=$;for(let _ of x.tieMatchUps??[]){let{matchUpType:L,winningSide:B}=_,V=B&&(B===F?"w":"l")||"";V&&(m[L][V]+=1);let G=V==="w"?"1":"0",j=V==="l"?"1":"0";if(L===ii){let z=f.length+1;f.push({singles_pair:{pair:z,won:G,lost:j,tied:"0"}})}else if(L===Zt){let z=h.length+1;h.push({doubles_pair:{pair:z,won:G,lost:j,tied:"0"}})}}}let v=[{singles:{childArray:f,won:m.SINGLES.w,lost:m.SINGLES.l}},{doubles:{childArray:h,won:m.DOUBLES.w,lost:m.DOUBLES.l}}],y=[],I=1;for(let k of t.individualParticipantIds){let x=i==null?void 0:i[k];if(x){let{participant:F,counters:$}=x,_={won:((A=$==null?void 0:$.DOUBLES)==null?void 0:A.wins)||0,lost:((M=$==null?void 0:$.DOUBLES)==null?void 0:M.losses)||0},L={won:((C=$==null?void 0:$.SINGLES)==null?void 0:C.wins)||0,lost:((O=$==null?void 0:$.SINGLES)==null?void 0:O.losses)||0},{participantName:B,participantId:V}=F;a[o][V]=I,y.push({player:{name:B,uni:I,singles:L,doubles:_}})}I+=1}return{vh:l,id:o,name:s,score:p||g,totals:v,childArray:y}}function pV({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:o}=t??{},s=o==null?void 0:o.map(l=>{var p;let{sideNumber:u,participant:c}=l,d=tme({sets:(p=t.score)==null?void 0:p.sets,sideNumber:u});return{[a===ii?"singles_score":"doubles_score"]:{...eme({homeid:e,uniValues:i,participant:c}),...d}}});return{[a===ii?"singles_match":"doubles_match"]:{match:r,order:n,childArray:s}}}var rme="ASC",_Y="ASC",nme="DESC",o1="DESC",ame={ASC:rme,ASCENDING:_Y,DESC:nme,DESCENDING:o1};function $Y(t){var E,R,N,A,M;let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:o,attach:s,event:l}=t;if((l==null?void 0:l.eventType)!==Ta)return{error:Vl};if(!r)return{error:ge};if(!e&&!n)return{error:Fa};if(e=e??((E=vn({drawDefinition:n,event:l}))==null?void 0:E.tieFormat),Hn({tieFormat:e}).error)return{error:Cl};if(typeof a!="object"&&!i)return{error:se,context:{scaleAccessor:a}};let u={},c=((n==null?void 0:n.entries)??(l==null?void 0:l.entries)??[]).filter(C=>(C==null?void 0:C.entryStatus)===sa).map(Ut),{participants:d=[]}=Mi({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=d.filter(({participantId:C})=>c.includes(C)),m=C=>C===Uc?"rankings":"ratings",h=((R=l==null?void 0:l.category)==null?void 0:R.categoryName)??((N=l==null?void 0:l.category)==null?void 0:N.ageCategoryCode),{scaleName:f=h,scaleType:g=Uc,sortOrder:v,accessor:y}=a||{},I=m(g),b=(C,O)=>{var x,F,$;let k=(x=C[I])==null?void 0:x[O];if(!k&&i&&(k=(F=C[I])==null?void 0:F[Jp]),Array.isArray(k)){let _=($=k.find(L=>L.scaleName===f))==null?void 0:$.scaleValue;if(_i(_))return _;if(y&&typeof _=="object")return _[y]}return 0},S=(C,O,k)=>{let x=v===o1?O:C,F=v===o1?C:O;return b(x,k)-b(F,k)},w=(C,O)=>S(C,O,Jp),U=(C,O)=>S(C,O,Md),T=[],D=(e==null?void 0:e.collectionDefinitions)??[];for(let C of p){let O=((A=C.individualParticipants)==null?void 0:A.sort(w))??[],k=o?O:((M=C.individualParticipants)==null?void 0:M.sort(U))??[],x={};for(let $ of D){let _=[],{collectionId:L,matchUpCount:B,matchUpType:V,gender:G}=$,j=Yi(Jp)(V);Te(0,B).forEach(z=>{let W=j?O:k??[],q=z+1,Y=[];Te(0,j?1:2).forEach(re=>{var H;let J=(H=W==null?void 0:W.find(Z=>{var ie;let K=G&&([Xt,mi].includes(G)&&G||G===Bn&&[Xt,mi][re]);return(!K||K===((ie=Z.person)==null?void 0:ie.sex))&&!_.includes(Z.participantId)}))==null?void 0:H.participantId;J&&(Y.push(J),_.push(J),x[J]||(x[J]=[]),x[J].push({collectionPosition:q,collectionId:L}))}),j||T.push(Y)})}let F=Object.keys(x).map($=>({collectionAssignments:x[$],participantId:$}));u[C.participantId]=F}let P=[];for(let C of T){let{participant:O}=rs({tournamentParticipants:d,participantIds:C});if(!O){let k={individualParticipantIds:C,participantRole:Qr,participantType:ft};P.push(k)}}if(s){for(;P.length;)ll({participant:P.pop(),tournamentRecord:r});Lt({element:n,extension:{name:Du,value:u}})}return{...X,lineUps:u,participantsToAdd:P}}function Bk(t){if(!t)return{error:Xe};let e=ze(t,[{dates:!1,[Kr]:o=>Array.isArray(o)&&o.every(ya)},{uuids:!1,[Kr]:o=>Array.isArray(o)&&o.every(Di)},{startTime:!1,endTime:!1,[Kr]:jN},{idPrefix:!1,namePrefix:!1,[Kr]:Di},{count:!0,[Kr]:_i}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&Mf(i,r)||[],a=Te(1,t.count+1).map(o=>{var s,l;return je({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${o}`)??Gt(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${o}`),dateAvailability:n.map(u=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:u}))})});return{...X,courts:a}}var BY={};bt(BY,{default:()=>lme,garman:()=>GY});function Lb({court:t,date:e}){let i=e&&t.dateAvailability.find(n=>jl(n.date,e)),r=t.dateAvailability.find(n=>!n.date);return i||r}function ev(t){let e=ze(t,[{courtDate:!0,_ofType:ta}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=rr(r.startTime);(r.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>gS(s.startTime).localeCompare(gS(l.startTime))).forEach(s=>{let l={startTime:wi(a.toISOString()),endTime:s.startTime};rr(s.startTime)>a&&n.push(l),rr(s.endTime)>a&&(a=rr(s.endTime))});let o={startTime:wi(a.toISOString()),endTime:r.endTime};return rr(r.endTime)>a&&n.push(o),{timeSlots:n}}function ome({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=o=>{var l;let{timeSlots:s}=ev({includeBookingTypes:e,courtDate:o});return!!((l=s==null?void 0:s.filter(a))!=null&&l.length)};function a(o){let s=rr(o.startTime),l=rr(o.endTime);return s>i||l<r?!1:Fy(i,l)>=t}return{enoughTime:n}}function VY(t){let e=ze(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:cn}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,o=t.courts,s=rr(n),l=HN(s,i),{enoughTime:u}=ome({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((o==null?void 0:o.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=Lb({date:a,court:c});return!!(d&&u(d))}))||[]).length,...X}}function ED(t){var p;let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=t,{bookings:o=[]}=t;if(!Array.isArray(a)||!a.length)return{error:se,courts:a};if(!Array.isArray(o))return{error:pS};if(!ya(n))return{error:Ar};i&&(Array.isArray(i)?i.includes(n)&&(o=[]):o=[]);let{courtBookings:s,unassignedBookings:l}=o.reduce((m,h)=>{let{courtId:f}=h;return f?m.courtBookings[f]?m.courtBookings[f].push(h):m.courtBookings[f]=[h]:m.unassignedBookings.push(h),m},{courtBookings:{},unassignedBookings:[]}),u=a.map((m,h)=>{let{courtId:f,courtName:g}=m,v=s[f]||[],y=Lb({date:n,court:m})||{},{bookings:I=[],startTime:b,endTime:S,date:w}=y,U=[e[h]&&{startTime:b,endTime:e[h]},...Ce(I,!1,!0),...v].filter(Boolean);return{courtId:f,courtName:g,dateAvailability:{bookings:U,startTime:b,endTime:S,date:w}}});l.sort((m,h)=>Ot(m.startTime)-Ot(h.startTime));let c=()=>u.map(m=>{let h=m.dateAvailability,{timeSlots:f=[]}=ev({courtDate:h});return{courtName:m.courtName,courtId:m.courtId,timeSlots:f}}).flat(),d=[];for(let m of l){let{startTime:h,endTime:f,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=m,I=Ot(h),b=Ot(f),S=c().reduce((w,{courtId:U,courtName:T,timeSlots:D})=>{let P;return D.find(({startTime:E,endTime:R})=>{P=Ot(E)-I;let N=I>=Ot(E);return b<=Ot(R)&&w.startDifference!==0&&((P===0||P+r>=0)&&(w.startDifference===void 0||P<w.startDifference)||N)})?{courtName:T,courtId:U,startDifference:P}:w},{});if(S.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:h,endTime:f};d.push(w),(p=u.find(({courtId:U})=>U===S.courtId))==null||p.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:m})}return{virtualCourts:u.map(({courtId:m,courtName:h,dateAvailability:f})=>({dateAvailability:[f],courtName:h,courtId:m})),assignedBookings:d}}function CD({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function jY(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return Te(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function Kf({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,o)=>{let s=Lb({date:t,court:o}),l=n&&((s==null?void 0:s[n])||o[n]);return l&&(!a||e&&Ot(l)<Ot(a)||i&&Ot(l)>Ot(a))?l:a},void 0)}function sme({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||Kf({courts:r,scheduleDate:n,startTime:!0}),i=i||Kf({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let o=rr(e),s=rr(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let u=Lb({court:l,date:n}),{timeSlots:c}=ev({courtDate:u});c==null||c.forEach(d=>{let p=rr(d.startTime),m=rr(d.endTime);if(p>s||p<o||m<o)return!1;if(Fy(p,m)>=t){let h=wi(p.toISOString());(!a||h<a)&&(a=h)}})}}return{firstTimeSlotStartTime:a}}function Vk(t){let e=ze(t,[{courts:!0,_ofType:cn}]);if(e.error)return e;let{date:i=VN(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:o}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||CD({averageMatchUpMinutes:u}),i=mt(i),r=wi(r),n=wi(n);let m=0,h=0,f=0,g=0,v=0;!o&&d&&(o=jY({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:y}=ED({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:I}=sme({averageMinutes:u,courts:y,startTime:r,endTime:n,date:i});s&&I&&(r=I??r);let b=Ot(r),S=Ot(n)-b,w=Math.floor(S/a),U=Te(0,w+1).map(T=>{let D=b+T*a,P=Pae(D),E=VY({courts:y??[],averageMatchUpMinutes:u,periodStart:P,date:i});if(E.error)return{error:E.error};let{availableToScheduleCount:R=0}=E,N=R>h?R-h:0;v+=T?R:0;let A=T?v/T:R,M=a*A/u,C=T?M*(T-1)+A:A,O=R?h&&C-m||N:0;m=C,h=R,f+=O;let k=et(f)-g;return g+=k,{periodStart:P,add:k,availableToScheduleCount:R,newCourts:N,totalMatchUps:g}});return{scheduleTimes:U.reduce((T,D)=>{let P=Te(0,D.add).map(()=>({scheduleTime:D.periodStart}));return T.concat(...P)},[]).flat(),timingProfile:U,totalMatchUps:g}}var GY={getCourtsAvailableAtPeriodStart:VY,generateTimeSlots:ev,getScheduleTimes:Vk,courtGenerator:jY},lme=GY,HY={};bt(HY,{isValid:()=>Sa,isValidMatchUpFormat:()=>Sa,parse:()=>kn,stringify:()=>aT});var zY={};bt(zY,{allCompetitionMatchUps:()=>As,allDrawMatchUps:()=>Sn,allEventMatchUps:()=>iu,allTournamentMatchUps:()=>Vr,analyzeMatchUp:()=>HI,applyLineUps:()=>h4,assignMatchUpSideParticipant:()=>qY,assignTieMatchUpParticipantId:()=>VS,bulkMatchUpStatusUpdate:()=>c4,calculateWinCriteria:()=>Ih,checkInParticipant:()=>Gk,checkMatchUpIsComplete:()=>Rd,checkOutParticipant:()=>jk,competitionScheduleMatchUps:()=>kb,disableTieAutoCalc:()=>s4,drawMatchUps:()=>Dk,enableTieAutoCalc:()=>n4,eventMatchUps:()=>wD,filterMatchUps:()=>uu,findMatchUp:()=>uk,getAllDrawMatchUps:()=>hr,getAllStructureMatchUps:()=>Wt,getCheckedInParticipantIds:()=>sh,getCompetitionMatchUps:()=>GI,getEventMatchUpFormatTiming:()=>gk,getHomeParticipantId:()=>bk,getMatchUpCompetitiveProfile:()=>nb,getMatchUpContextIds:()=>wk,getMatchUpDailyLimits:()=>SD,getMatchUpDailyLimitsUpdate:()=>vk,getMatchUpDependencies:()=>ps,getMatchUpFormat:()=>Uk,getMatchUpFormatTiming:()=>ab,getMatchUpFormatTimingUpdate:()=>fk,getMatchUpScheduleDetails:()=>xT,getMatchUpType:()=>FT,getMatchUpsStats:()=>Sk,getModifiedMatchUpFormatTiming:()=>bD,getParticipantResults:()=>Ub,getPredictiveAccuracy:()=>yk,getRoundMatchUps:()=>En,getRounds:()=>Tk,isValidMatchUpFormat:()=>Sa,matchUpActions:()=>QT,mutate:()=>WY,participantScheduledMatchUps:()=>Ik,query:()=>rY,removeDelegatedOutcome:()=>a4,removeMatchUpSideParticipant:()=>Wk,removeTieMatchUpParticipantId:()=>KY,replaceTieMatchUpParticipantId:()=>zk,resetAdHocMatchUps:()=>p4,resetMatchUpLineUps:()=>Zk,resetScorecard:()=>tx,resetTieFormat:()=>ex,setDelegatedOutcome:()=>d4,setMatchUpFormat:()=>l4,setMatchUpStatus:()=>$b,setOrderOfFinish:()=>m4,substituteParticipant:()=>o4,tallyParticipantResults:()=>Yg,toggleParticipantCheckInState:()=>MD,tournamentMatchUps:()=>UD,updateTieMatchUpScore:()=>Ku,validMatchUp:()=>MT,validMatchUps:()=>So});var WY={};bt(WY,{applyLineUps:()=>h4,assignMatchUpSideParticipant:()=>qY,assignTieMatchUpParticipantId:()=>VS,bulkMatchUpStatusUpdate:()=>c4,checkInParticipant:()=>Gk,checkOutParticipant:()=>jk,disableTieAutoCalc:()=>s4,enableTieAutoCalc:()=>n4,findMatchUp:()=>uk,removeDelegatedOutcome:()=>a4,removeMatchUpSideParticipant:()=>Wk,removeTieMatchUpParticipantId:()=>KY,replaceTieMatchUpParticipantId:()=>zk,resetAdHocMatchUps:()=>p4,resetMatchUpLineUps:()=>Zk,resetScorecard:()=>tx,resetTieFormat:()=>ex,setDelegatedOutcome:()=>d4,setMatchUpFormat:()=>l4,setMatchUpStatus:()=>$b,setOrderOfFinish:()=>m4,substituteParticipant:()=>o4,toggleParticipantCheckInState:()=>MD,updateTieMatchUpScore:()=>Ku});function qY({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){var u,c;if(i&&typeof i!="string")return{error:Es};if(!e)return{error:Le};if(!n)return{error:yn};let o=r===void 0;if(o&&(r=1),![1,2].includes(r))return ee({result:{error:se,context:{sideNumber:r}}});let{matchUp:s,structure:l}=Ui({drawDefinition:e,matchUpId:n,event:a});if(!s)return{error:pn};if(!(!(l!=null&&l.structures)&&!(e.drawType&&e.drawType!==_a)&&!((u=l==null?void 0:l.matchUps)!=null&&u.find(({roundPosition:d})=>!!d))))return{error:pN};if(!i&&((c=s==null?void 0:s.score)!=null&&c.scoreStringSide1||vr.includes(s==null?void 0:s.matchUpstatus)||s!=null&&s.matchUpStatus&&[tr,dr].includes(s.matchUpStatus)))return{error:z0,info:"matchUp has completed status or score"};if(s){if(s.sides=[1,2].map(d=>{var m;let p=((m=s.sides)==null?void 0:m.find(h=>h.sideNumber===d))??{sideNumber:d};return r===d?{...p,participantId:i}:p}),o)for(let d of s.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);Rt({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:s})}return{...X,sidesSwapped:o}}function Pa({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=Ui({drawDefinition:r,event:s,matchUpId:a});if(!l)return{error:pn};let u=bl({removePriorValues:t,element:l,duplicateValues:i,timeItem:o});return n||Rt({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),u}function jk(t){var y;let e=[{[wr]:!0},{[Fn]:!0},{[zl]:!0},{[Il]:!0}],i=ze(t,e);if(i.error)return i;let r=Jg(t,[{[Fg]:eu,attr:{[mT]:!0}}]);if(r.error)return r;let{tournamentRecord:n,drawDefinition:a,participantId:o,matchUpId:s}=t,l=(y=r==null?void 0:r.matchUp)==null?void 0:y.matchUp,{matchUpStatus:u,score:c}=l??{};if(u&&hA.includes(u)||u&&vr.includes(u)||Ir({score:c}))return{error:MG};let d=sh({matchUp:l});if(d!=null&&d.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:m}=d??{};if(!(m!=null&&m.includes(o)))return{error:Es};if(!(p!=null&&p.includes(o)))return{error:nH};let h=OW({matchUp:l});if(h!=null&&h.error)return h;let{sideParticipantIds:f,nestedIndividualParticipantIds:g}=h??{},v=f==null?void 0:f.indexOf(o);return v!==void 0&&[0,1].includes(v)&&((g==null?void 0:g[v])??[]).forEach(I=>{Pa({drawDefinition:a,matchUpId:s,timeItem:{itemType:DS,itemValue:I}})}),Pa({tournamentRecord:n,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:DS}}),{...X,checkedOut:!0}}function Gk(t){var p;let e=[{[wr]:!0},{[Fn]:!0},{[zl]:!0},{[Il]:!0}],i=ze(t,e);if(i[jo])return i;let r=Jg(t,[{[Fg]:eu,attr:{[mT]:!0}}]);if(r[jo])return r;let{tournamentRecord:n,drawDefinition:a,participantId:o,matchUpId:s}=t,l=sh({matchUp:(p=r==null?void 0:r.matchUp)==null?void 0:p.matchUp});if(l!=null&&l.error)return l;let{checkedInParticipantIds:u,allRelevantParticipantIds:c}=l??{};if(!(c!=null&&c.includes(o)))return{[jo]:Es};let d={...X,checkedIn:!0};return u!=null&&u.includes(o)||Pa({tournamentRecord:n,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:TS}}),d}function MD(t){var u,c;let e=ze(t,[{[zl]:!0,[Fn]:!0,[Il]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,r=t.tournamentRecord??(i&&((u=t.tournamentRecords)==null?void 0:u[i]));if(!r)return{error:ge};let n=(c=Jg(t,[{[Fg]:eu,attr:{[mT]:!0},[jo]:pn}]).matchUp)==null?void 0:c.matchUp;if(!n)return{error:pn};let{checkedInParticipantIds:a=[]}=sh({matchUp:n}),{participantId:o,matchUpId:s,drawDefinition:l}=t;return o&&a.includes(o)?jk({tournamentRecord:r,drawDefinition:l,participantId:o,matchUpId:s,matchUp:n}):Gk({tournamentRecord:r,drawDefinition:l,participantId:o,matchUpId:s,matchUp:n})}function Hk({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){var w,U;if(!t)return{error:ge};if(!e)return{error:$s};if(!r)return{error:co};let n=sn({drawDefinition:e}),{matchUp:a}=Ui({matchUpId:i,drawDefinition:e,matchUpsMap:n});if(!a)return{error:pn};let{matchUp:o,structure:s}=Ui({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:n,event:r});if(!o)return{error:pn};let{collectionPosition:l,drawPositions:u,collectionId:c,matchUpTieId:d,matchUpType:p}=o;if(p&&!$0([ii,Zt],p))return{error:oa};let{positionAssignments:m}=oi({structure:s}),h=m==null?void 0:m.filter(T=>u==null?void 0:u.includes(T.drawPosition)),{matchUp:f}=Ui({matchUpId:d,drawDefinition:e,matchUpsMap:n}),g=((w=f==null?void 0:f.sides)==null?void 0:w.map(Ut))??[],v=(h==null?void 0:h.map(Ut))??[],y=[...g,...v],{participants:I}=Mi({tournamentRecord:t,participantFilters:{participantTypes:[Kt],participantIds:y}}),{matchUp:b}=Ui({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:n}),S=(U=vn({matchUp:f,drawDefinition:e,structure:s,event:r}))==null?void 0:U.tieFormat;return{inContextDualMatchUp:b,inContextTieMatchUp:o,relevantAssignments:h,collectionPosition:l,teamParticipants:I,collectionId:c,matchUpType:p,dualMatchUp:f,tieMatchUp:a,tieFormat:S,structure:s,...X}}function zk(t){var k,x,F,$,_,L,B,V,G,j,z,W,q,Y,re,J;let e=Hk(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:o,substitution:s,event:l}=t;if(!r||!a)return ee({result:{error:mr},stack:i});if(r===a)return{...X};let{inContextDualMatchUp:u,inContextTieMatchUp:c,collectionPosition:d,collectionId:p,dualMatchUp:m,tieMatchUp:h,tieFormat:f}=e,g=c==null?void 0:c.matchUpType,v=(k=c==null?void 0:c.sides)==null?void 0:k.find(H=>{var Z,K,ie;return((Z=H.participant)==null?void 0:Z.participantId)===r||((ie=(K=H.participant)==null?void 0:K.individualParticipantIds)==null?void 0:ie.includes(r))});if(!v)return{error:zi};let y=((x=Mi({tournamentRecord:n,participantFilters:{participantIds:[r,a]}}))==null?void 0:x.participants)??[];if(y.length!==2)return ee({result:{error:mr},stack:i});if(y[0].participantType!==y[1].participantType)return ee({result:{error:Cs},stack:i});let{appliedPolicies:I}=$t({tournamentRecord:n,drawDefinition:o,event:l}),b=((F=t.policyDefinitions)==null?void 0:F[kr])??(I==null?void 0:I[kr])??Hg[kr],S=y.find(({participantId:H})=>H===a);if((t.enforceGender??(($=b==null?void 0:b.participants)==null?void 0:$.enforceGender))!==!1&&[Xt,mi].includes(c==null?void 0:c.gender)&&(c==null?void 0:c.gender)!==((_=S==null?void 0:S.person)==null?void 0:_.sex))return{error:Ym,info:"Gender mismatch"};let w=(L=b==null?void 0:b.processCodes)==null?void 0:L.substitution;Tb({tournamentId:n.tournamentId,eventId:l.eventId,inContextDualMatchUp:u,drawDefinition:o,dualMatchUp:m});let U=(B=m==null?void 0:m.sides)==null?void 0:B.find(({sideNumber:H})=>H===v.sideNumber);if(!U)return ee({result:{sideNumber:v.sideNumber,existingParticipantId:r,error:$r},stack:i});if((G=(V=c==null?void 0:c.sides)==null?void 0:V.flatMap(H=>{var Z,K;return((Z=H.participant)==null?void 0:Z.individualParticipantIds)||((K=H.participant)==null?void 0:K.participantId)||[]}))!=null&&G.includes(a))return ee({result:{error:q0},stack:i});let T=(z=(j=u==null?void 0:u.sides)==null?void 0:j.find(({sideNumber:H})=>H===v.sideNumber))==null?void 0:z.participantId,D=U.lineUp,P=D==null?void 0:D.find(({participantId:H})=>a===H),E=D==null?void 0:D.reduce((H,Z)=>Z.substitutionOrder>H?Z.substitutionOrder:H,0),R=(D==null?void 0:D.map(H=>{var K;let Z=Ce(H,!1,!0);if(![r,a].includes(Z.participantId))return Z;if(!s&&[r,a].includes(Z.participantId)&&(Z.collectionAssignments=(K=Z.collectionAssignments)==null?void 0:K.filter(ie=>!(ie.collectionPosition===d&&ie.collectionId===p))),s&&r===Z.participantId&&(Z.collectionAssignments=Z.collectionAssignments.map(ie=>ie.collectionPosition===d&&ie.collectionId===p&&ie.substitutionOrder===void 0?{...ie,substitutionOrder:E}:ie)),Z.participantId===a){Z.collectionAssignments||(Z.collectionAssignments=[]);let ie={collectionId:p,collectionPosition:d};s&&(ie.previousParticipantId=r,ie.substitutionOrder=(E??0)+1),Z.collectionAssignments.push(ie)}return Z}))??[];if(!P){let H={collectionId:p,collectionPosition:d};s&&(H.substitutionOrder=(E??0)+1,H.previousParticipantId=r);let Z={collectionAssignments:[H],participantId:a};R.push(Z)}let N=g===Zt,{assignedParticipantIds:A}=PS({lineUp:D,collectionPosition:d,collectionId:p}),{assignedParticipantIds:M}=PS({lineUp:R,collectionPosition:d,collectionId:p});if(U.lineUp=R,T&&f){let H=hh({participantId:T,lineUp:R,drawDefinition:o,tieFormat:f});if(H.error)return ee({result:H,stack:i})}else console.log("team participantId not found");let C,O;if(N){let{tournamentRecord:H}=t,Z=rs({participantIds:M,tournamentRecord:H});if(!Z.participant){let ie=ll({returnParticipant:!0,pairOverride:!0,tournamentRecord:H,participant:{participantRole:Qr,individualParticipantIds:M,participantType:ft}});if(ie.error)return ee({result:ie,stack:i});C=(W=ie.participant)==null?void 0:W.participantId}Z=rs({participantIds:A,tournamentRecord:H});let K=(q=Z.participant)==null?void 0:q.participantId;K&&ph({participantIds:[K],tournamentRecord:H}).success&&(O=K)}if(s||((Y=v.substitutions)==null?void 0:Y.length)===1){if(s)w&&h&&(h.processCodes=ct([...(h==null?void 0:h.processCodes)??[],...w]));else for(let H of w||[]){let Z=(re=h==null?void 0:h.processCodes)==null?void 0:re.lastIndexOf(H);Z!==void 0&&((J=h==null?void 0:h.processCodes)==null||J.splice(Z,1))}h&&Rt({tournamentId:n==null?void 0:n.tournamentId,matchUp:h,context:i,drawDefinition:o})}return m&&Rt({tournamentId:n==null?void 0:n.tournamentId,matchUp:m,context:i,drawDefinition:o}),{...X,modifiedLineUp:R,participantRemoved:O,participantAdded:C}}function YY({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){var u;if(!a||!t||!Array.isArray(n))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:se};let o=(i==null?void 0:i.lineUp)||((u=_d({participantId:e,drawDefinition:r}))==null?void 0:u.lineUp),s=[],l=[];return{modifiedLineUp:(o==null?void 0:o.map(c=>{var p;if(!n.includes(c.participantId))return c;let d=(p=c.collectionAssignments)==null?void 0:p.filter(m=>{let h=m.collectionId===a&&m.collectionPosition===t;return h&&(m.previousParticipantId&&s.push(m.previousParticipantId),l.push({participantId:c.participantId,...m})),!h});return{participantId:c.participantId,collectionAssignments:d}}).filter(Boolean))||[],assignmentsRemoved:l,previousParticipantIds:s}}function ume({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var a,o;let r=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===lr&&((l=s==null?void 0:s.entries)==null?void 0:l.some(u=>u.participantId===e))}),n=s=>!t.includes(s.participantId);for(let s of r){s.entries=(s.entries||[]).filter(n);let{flightProfile:l}=Gi({event:s});(a=l==null?void 0:l.flights)==null||a.forEach(u=>{u.drawEntries=(u.drawEntries||[]).filter(n)}),(o=s==null?void 0:s.drawDefinitions)==null||o.forEach(u=>{u.entries=(u.entries||[]).filter(n)})}return{...X}}function ND({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return ee({result:{error:ge},stack:n});if(!e||!t)return ee({result:{error:Xe},stack:n});let a=r.participants??[],o=a.find(d=>d.participantId===e);if(!o)return ee({result:{error:zi},stack:n});if(o!=null&&o.participantType&&![Kt,qa].includes(o.participantType))return ee({context:{participantType:o.participantType},result:{error:Cs},stack:n});let s=t.filter(d=>{var p;return((p=a.find(m=>m.participantId===d))==null?void 0:p.participantType)!==St});if(s.length)return ee({result:{error:Ia,invalidParticipantIds:s},stack:n});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&$T({individualParticipantIds:u,tournamentRecord:r}),o.individualParticipantIds=o.individualParticipantIds.concat(...u));let{topics:c}=yo();if(c.includes(nn)){let d=a.find(({participantId:p})=>p===e);lt({topic:nn,payload:{participants:[d]}})}return ume({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:Ce(o,!1,!0),added:u.length,...X}}function AD(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:o}=t;if(!n)return{error:ge};if(!o)return{error:Km};if(!o.participantId)return ll({tournamentRecord:n,participant:o});let{participant:s}=Yc({participantId:o.participantId,tournamentRecord:n});if(!s)return ll({tournamentRecord:n,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:m,onlineResources:h,contacts:f,person:g}=o;if(m&&s.participantType!==m)return{error:QG};let v={};if(f&&(v.contacts=f),h&&(v.onlineResources=h),c&&Di(c)&&(v.participantOtherName=c),d&&Di(d)&&(v.participantName=d),Array.isArray(u)){let{participants:y}=Mi({participantFilters:{participantTypes:[St]},tournamentRecord:n}),I=y==null?void 0:y.map(Ut);if(I){let b=u.filter(S=>Di(S)&&I.includes(S));([qa,fi].includes(m||s.participantType)||m===ft&&(b.length===2||a))&&(v.individualParticipantIds=b),s.participantType===Jv.PAIR&&e&&(v.participantName=cme({individualParticipants:y,newValues:v}))}}return Object.keys(JA).includes(p)&&(v.participantRole=p),Object.keys(Jv).includes(m)&&(v.participantType=m),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===Jv.INDIVIDUAL&&g&&dme({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,je(v)),i&&ND({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),lt({topic:nn,payload:{tournamentId:n.tournamentId,participants:[s]}}),{participant:Ce(s),...X}}function cme({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function dme({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:l,birthdate:u,tennisId:c,sex:d}=r;d&&Object.keys(rT).includes(d)&&(n.sex=d);let p;if(Di(l)&&(n.personId=l),s&&Di(s)&&(pme(s)||s==="")&&(n.nationalityCode=s),a&&typeof Di(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),o&&typeof Di(o)&&o.length>1&&(n.standardGivenName=o,p=!0),p&&t){let m=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=m}u&&ya(u)&&(n.birthdate=u),c&&Di(c)&&(n.tennisId=c),Object.assign(e.person,n)}function pme(t){return Zp.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function VS(t){var F,$,_,L,B,V,G,j,z,W,q,Y,re,J,H,Z,K,ie,ae,oe;let e=Hk(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",r=t.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:o,event:s}=t;if(!o)return ee({result:{error:mr},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return ee({result:{error:UN},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:u,relevantAssignments:c,collectionPosition:d,teamParticipants:p,collectionId:m,matchUpType:h,dualMatchUp:f,tieFormat:g}=e;if(($=(F=u==null?void 0:u.sides)==null?void 0:F.flatMap(ne=>{var de,ye;return((de=ne.participant)==null?void 0:de.individualParticipantIds)||((ye=ne.participant)==null?void 0:ye.participantId)||[]}))!=null&&$.includes(o))return ee({result:{...X},stack:i});r=r??(t.sideNumber?(L=(_=l==null?void 0:l.sides)==null?void 0:_.find(ne=>ne.sideNumber===t.sideNumber))==null?void 0:L.participantId:void 0);let v=(V=(B=Mi({participantFilters:{participantIds:[o]},tournamentRecord:n}))==null?void 0:B.participants)==null?void 0:V[0];if(!v)return ee({result:{error:zi},stack:i});let{appliedPolicies:y}=$t({tournamentRecord:n,drawDefinition:a,event:s}),I=((G=t.policyDefinitions)==null?void 0:G[kr])??(y==null?void 0:y[kr])??Hg[kr];if((t.enforceGender??((j=I==null?void 0:I.participants)==null?void 0:j.enforceGender))!==!1&&[Xt,mi].includes(u==null?void 0:u.gender)&&(u==null?void 0:u.gender)!==((z=v.person)==null?void 0:z.sex))return{error:Ym,info:"Gender mismatch"};let{individualParticipantIds:b,participantType:S}=v;if(Yi(ii)(h)&&S!==St)return{error:Cs};let w=S===St?[o]:b,U=r&&(p==null?void 0:p.find(({participantId:ne})=>ne===r))||(p==null?void 0:p.find(({individualParticipantIds:ne})=>Rn(w,ne)));if(!U)return{error:NN};if(r||(r=U.participantId),!r)return{error:zi};let T=(W=c==null?void 0:c.find(ne=>ne.participantId===(U==null?void 0:U.participantId)))==null?void 0:W.drawPosition,D=(Y=(q=f==null?void 0:f.sides)==null?void 0:q.find(ne=>ne.participantId===r))==null?void 0:Y.sideNumber,P=(J=(re=u==null?void 0:u.sides)==null?void 0:re.find(ne=>T&&ne.drawPosition===T))==null?void 0:J.sideNumber,E=D??P??t.sideNumber;if(!g)return{error:Mg};if(!((H=g.collectionDefinitions)!=null&&H.find(ne=>ne.collectionId===m)))return{error:GG};Tb({tournamentId:n.tournamentId,eventId:s.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:f});let R=(Z=f==null?void 0:f.sides)==null?void 0:Z.find(ne=>ne.sideNumber===E),N=(K=u==null?void 0:u.sides)==null?void 0:K.find(ne=>ne.sideNumber===E),A=(oe=(ae=(R==null?void 0:R.lineUp)??((ie=_d({participantId:r,drawDefinition:a}))==null?void 0:ie.lineUp))==null?void 0:ae.filter(ne=>{var de;return(de=ne.collectionAssignments)==null?void 0:de.find(ye=>ye.collectionPosition===d&&ye.collectionId===m&&!ye.previousParticipantId)}))==null?void 0:oe.map(ne=>ne==null?void 0:ne.participantId),M=(A==null?void 0:A.length)>1&&A||(S===ft?v.individualParticipantIds:[o]),C=YY({collectionPosition:d,teamParticipantId:r,dualMatchUpSide:R,drawDefinition:a,participantIds:M,collectionId:m});if(C.error)return ee({result:C,stack:i});let{modifiedLineUp:O}=C,k;if(h===Zt){if(S!==ft){let ne=wE({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:o,collectionId:m,tieFormat:g});if(ne!=null&&ne.error)return ee({result:ne,stack:i});if(ne=x({side:N}),ne.error)return ne;k=ne.deletedParticipantId,R&&(R.lineUp=O),f&&Rt({tournamentId:n==null?void 0:n.tournamentId,matchUp:f,context:i,drawDefinition:a})}else if(S===ft)for(let ne of M)wE({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:ne,collectionId:m,tieFormat:g})}else{let ne=wE({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:o,collectionId:m,tieFormat:g});if(ne!=null&&ne.error)return ne}if(R&&(R.lineUp=O),f&&Rt({tournamentId:n==null?void 0:n.tournamentId,matchUp:f,context:i,drawDefinition:a}),k){let{error:ne}=ph({participantIds:[k],tournamentRecord:n});ne&&console.log("cleanup")}return{...X,modifiedLineUp:O};function x({side:ne}){let de;if(ne.participant){let ye=ne.participant.individualParticipantIds||[];if(ye.filter(Boolean).length===1){let{participant:ce}=rs({participantIds:ye,tournamentRecord:n});ye.push(o);let{participant:ke}=rs({participantIds:ye,tournamentRecord:n});if(!ke&&ce){ce.individualParticipantIds=ye;let we=AD({pairOverride:!0,tournamentRecord:n,participant:ce});if(we.error)return we}else de=ce==null?void 0:ce.participantId}}else{let ye=ll({participant:{individualParticipantIds:[o],participantRole:Qr,participantType:ft},pairOverride:!0,tournamentRecord:n});if(ye.error)return ye}return{...X,deletedParticipantId:de}}}function wE({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:o}){var c,d;let s=(c=_d({participantId:e,drawDefinition:i}))==null?void 0:c.lineUp,l=(d=r||s)==null?void 0:d.find(p=>(p==null?void 0:p.participantId)===n),u={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(u);else{let p={collectionAssignments:[u],participantId:n};r.push(p)}return hh({participantId:e,lineUp:r,drawDefinition:i,tieFormat:o})}function KY(t){var E,R,N,A,M,C,O,k,x,F,$,_,L,B,V,G,j,z,W,q,Y,re,J;let{tournamentRecord:e,drawDefinition:i,participantId:r,event:n}=t,a="removeTieMatchUpParticiapantId";if(!r)return ee({result:{error:mr},stack:a});let o=Hk(t);if(o.error)return o;let{appliedPolicies:s}=$t({tournamentRecord:e,drawDefinition:i,event:n}),l=(N=(R=((E=t.policyDefinitions)==null?void 0:E[kr])??(s==null?void 0:s[kr])??Hg[kr])==null?void 0:R.processCodes)==null?void 0:N.substitution,{inContextDualMatchUp:u,inContextTieMatchUp:c,relevantAssignments:d,collectionPosition:p,teamParticipants:m,collectionId:h,matchUpType:f,dualMatchUp:g,tieMatchUp:v,tieFormat:y}=o;if(!g)return ee({result:{error:aa},stack:a});let I=(A=c==null?void 0:c.sides)==null?void 0:A.find(H=>{var Z,K,ie;return((Z=H.participant)==null?void 0:Z.participantId)===r||((ie=(K=H.participant)==null?void 0:K.individualParticipantIds)==null?void 0:ie.includes(r))});if(!I)return ee({result:{error:zi},stack:a});let b=((M=t.policyDefinitions)==null?void 0:M[Ns])??(s==null?void 0:s[Ns]);if(!((C=I.substitutions)!=null&&C.length)&&(Ir({score:c==null?void 0:c.score})||c!=null&&c.winningSide)&&(b==null?void 0:b.requireParticipantsForScoring)!==!1)return ee({result:{error:PH},stack:a});let S=(k=(O=u==null?void 0:u.sides)==null?void 0:O.find(({sideNumber:H})=>H===I.sideNumber))==null?void 0:k.participantId;if(!S)return ee({result:{error:zi},stack:a});let w=(F=(x=Mi({participantFilters:{participantIds:[r]},tournamentRecord:e}))==null?void 0:x.participants)==null?void 0:F[0];if(!w)return ee({result:{error:zi},stack:a});if(f===ii&&w.participantType===ft)return ee({result:{error:Ym},stack:a});let U=w.participantType===St?[r]:w.individualParticipantIds;Tb({tournamentId:e.tournamentId,eventId:n.eventId,inContextDualMatchUp:u,drawDefinition:i,dualMatchUp:g});let T=($=g.sides)==null?void 0:$.find(({sideNumber:H})=>H===I.sideNumber);if(!T&&(((_=g.sides)==null?void 0:_.filter(({lineUp:H})=>!H).length)||0)<2){let H=m==null?void 0:m.map(({participantId:Z})=>{var K;return{drawPosition:(K=d==null?void 0:d.find(ie=>ie.participantId===Z))==null?void 0:K.drawPosition,teamParticipantId:Z}});T=(L=g.sides)==null?void 0:L.find(Z=>{var K;return((K=H==null?void 0:H.find(({drawPosition:ie})=>ie===Z.drawPosition))==null?void 0:K.teamParticipantId)===S})}if(!T)return ee({result:{error:zi,context:{participantId:r}}});let{modifiedLineUp:D,previousParticipantIds:P}=YY({collectionPosition:p,teamParticipantId:S,dualMatchUpSide:T,participantIds:U,drawDefinition:i,collectionId:h});if(T.lineUp=D,S&&y&&hh({participantId:S,lineUp:D,drawDefinition:i,tieFormat:y}),f===Zt&&w.participantType===St){let H=(B=c==null?void 0:c.sides)==null?void 0:B.find(ie=>ie.sideNumber===(T==null?void 0:T.sideNumber)),{participantId:Z}=H??{},K=Z&&((G=(V=Mi({participantFilters:{participantIds:[Z]},tournamentRecord:e,withDraws:!0}))==null?void 0:V.participants)==null?void 0:G[0]);if(K){let ie=((j=K==null?void 0:K.individualParticipantIds)==null?void 0:j.filter(ae=>ae!==r))??[];if(P&&ie.push(...P),ie.length>2)return ee({result:{error:Ia},stack:a});if((z=K.draws)!=null&&z.length){if(ie.length===1){let{participant:ae}=rs({participantIds:ie,tournamentRecord:e});if(!ae){let oe=ll({participant:{participantRole:Qr,individualParticipantIds:ie,participantType:ft},pairOverride:!0,tournamentRecord:e});if(oe.error)return ee({result:oe,stack:a})}}}else if(ie.length){K.individualParticipantIds=ie;let ae=AD({participant:K,pairOverride:!0,tournamentRecord:e});if(ae.error)return ee({result:ae,stack:a})}else{let ae=ph({participantIds:[Z],tournamentRecord:e});ae.error&&console.log("cleanup",{result:ae})}}else return ee({result:{error:zi},stack:a})}if(((W=I.substitutions)==null?void 0:W.length)===1&&!((re=(Y=(q=c==null?void 0:c.sides)==null?void 0:q.find(H=>H.sideNumber!==I.sideNumber))==null?void 0:Y.substitutions)!=null&&re.length)&&((J=v==null?void 0:v.processCodes)!=null&&J.length)){for(let H of l||[]){let Z=v.processCodes.lastIndexOf(H);v.processCodes.splice(Z,1)}Rt({tournamentId:e==null?void 0:e.tournamentId,matchUp:v,context:a,drawDefinition:i})}return Rt({tournamentId:e==null?void 0:e.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...X,modifiedLineUp:D}}function Wk(t){var l,u;let e=ze(t,[{[wr]:!0,[Fn]:!0,[Il]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=t;if(r&&![1,2].includes(r))return{error:se,sideNumber:r};let{matchUp:o,structure:s}=Ui({drawDefinition:i,matchUpId:n,event:a});return o?zn({structure:s})?((l=o.sides)==null||l.forEach(c=>{(!r||c.sideNumber===r)&&delete c.participantId}),Rt({tournamentId:(u=t.tournamentRecord)==null?void 0:u.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:o}),{...X}):{error:pN}:{error:pn}}function mme({matchUpStatuses:t=[Vt,zt,Mt],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){var c;let n=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),a=(c=n==null?void 0:n.drawPositions)==null?void 0:c.find(d=>d!==i),o=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(a)}).map(d=>d.matchUpStatus),s=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),l=Rn(o||[],t),u=Rn(s||[],t);return{sourceMatchUp:n,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:o,loserHadMatchUpStatus:u,loserMatchUpStatuses:s}}function hme({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=it({drawDefinition:a,structureId:o});if((d==null?void 0:d.structureType)===xn)return{...X};u=u??sn({drawDefinition:a});let p=((u==null?void 0:u.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:m}=Em({drawPosition:i,matchUps:p}),h=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==m&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:f}=oi({drawDefinition:a,structureId:o});for(let g of h??[])fme({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:f,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:s,matchUpsMap:u,matchUp:g,event:c});return{...X}}function fme({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:u,event:c}){var m,h,f;let d="removeSubsequentDrawPosition";if(s){let g=(h=(m=t.find(({matchUpId:y})=>u.matchUpId===y).sides)==null?void 0:m.find(y=>y.drawPosition===r))==null?void 0:h.sideNumber,v=(f=u.sides)==null?void 0:f.find(y=>y.sideNumber===g);v&&delete v.lineUp}u.drawPositions=(u.drawPositions||[]).map(g=>g===r?void 0:g).filter(Boolean);let p=e.filter(({drawPosition:g})=>{var v;return(v=u.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return u.matchUpStatus=p&&Vt||[Mt,zt].includes(u.matchUpStatus)&&u.matchUpStatus||Xi,[zt,Mt].includes(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&yq({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),Rt({tournamentId:n==null?void 0:n.tournamentId,eventId:c==null?void 0:c.eventId,context:`${d}-${r}`,drawDefinition:o,matchUp:u}),{...X}}function tv(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,m=zn({structure:c}),{drawPositions:h,winningSide:f}=l.matchUp||{};if(!m&&!h)return{error:My};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:I,winnerMatchUp:b,byeMatchUp:S}}=l,w=Js({...t,matchUpStatus:a||Xi,removeWinningSide:!0});if(w.error)return w;let U;if(p){let{matchUpTieId:O,matchUpsMap:k}=t;if(U=Ku({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:k,event:d}),!e&&!U.removeWinningSide)return{...X}}if(m)return{...X};let{matchUps:T}=Wt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:o,structure:c}),{positionAssignments:D}=Er({structure:c}),P=f-1,E=1-P,R=h[P],N=h[E],{winnerParticipantId:A,loserParticipantId:M}=(D==null?void 0:D.reduce((O,k)=>(k.drawPosition===N&&(O.loserParticipantId=k.participantId),k.drawPosition===R&&(O.winnerParticipantId=k.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},C=T.filter(O=>{var k;return(k=O.drawPositions)==null?void 0:k.includes(N)});if(b&&JY({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:A,tournamentRecord:r,winnerTargetLink:v,drawDefinition:n,winnerMatchUp:b,dualMatchUp:s,matchUpsMap:o}),I){let{winnerHadMatchUpStatus:O}=mme({drawPositionMatchUps:C,loserDrawPosition:N,sourceMatchUps:T}),k=g.linkCondition===nl;if(O&&k){let F=Math.min(...I.drawPositions);s1({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:F,matchUpsMap:o,event:d})}let x=gme({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:M,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:I,dualMatchUp:s,matchUpsMap:o,event:d});if(x.error)return x}if(S){let O=Math.min(...S.drawPositions);s1({sourceMatchUpId:u,targetLink:y,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:o,event:d})}return{...X,...U&&{tieMatchUpResult:U}}}function JY({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){var f,g;let{structureId:p,roundNumber:m}=l,h="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=it({drawDefinition:s,structureId:v});if(!y)return{error:Ci};let{positionAssignments:I}=Er({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(D=>D.participantId!==r);let b=(f=I==null?void 0:I.find(D=>D.participantId===r))==null?void 0:f.drawPosition,{matchUps:S}=Wt({drawDefinition:s,structure:y,event:d}),w=S.map(D=>D.drawPositions).flat(1/0).filter(Boolean),U=Ua(w);if((b?U[b]:void 0)===1)I==null||I.forEach(D=>{D.participantId===r&&delete D.participantId});else{let D=S.filter(({drawPositions:P})=>P.includes(b));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:D,winnerTargetLink:a})}let T=(g=u==null?void 0:u.drawMatchUps)==null?void 0:g.find(({matchUpId:D})=>D===l.matchUpId);T&&Rt({tournamentId:n==null?void 0:n.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:T,context:h,drawDefinition:s})}return m&&hme({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:c,matchUpsMap:u,roundNumber:m,structureId:p}),{...X}}function gme({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:u}){var f,g,v;let c="removeDirectedLoser",d=r.target.structureId,{structure:p}=it({drawDefinition:a,structureId:d});if(!p)return{error:Ci};let{positionAssignments:m}=Er({structure:p}),h=(f=m==null?void 0:m.find(y=>y.participantId===e))==null?void 0:f.drawPosition;if(m==null||m.forEach(y=>{y.participantId===e&&delete y.participantId}),p.seedAssignments=(p.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=o==null?void 0:o.sides.reduce((S,w,U)=>w.drawPosition===h?U:S,void 0),I=(g=s==null?void 0:s.drawMatchUps)==null?void 0:g.find(({matchUpId:S})=>S===o.matchUpId),b=(v=I==null?void 0:I.sides)==null?void 0:v[y];b&&(delete b.lineUp,Rt({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:I,context:c,drawDefinition:a}))}return{...X}}function s1({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:o}){let s=a.target.structureId,l="removeDirectedBye";Oa({color:"brightyellow",method:l,drawPosition:r});let u=cb({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:s,event:o});return ee({result:u,stack:l})}function vme(t){var l,u;let{matchUpFormat:e,score:i}=t,r=(l=i==null?void 0:i.sets)==null?void 0:l.length,n=e&&kn(e),{setFormat:a,finalSetFormat:o,bestOf:s}=n??{};return((u=s&&r===s&&o||a)==null?void 0:u.timed)||!1}function Ime({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){var s;let n="attemptToSetMatchUpStatusBYE";if(r!=null&&r.winningSide)return ee({result:{error:Cg},context:{matchUpStatus:Vt},stack:n});let{positionAssignments:a}=Er({structure:i}),o=a==null?void 0:a.filter(l=>l.bye).map(l=>l.drawPosition);return(s=r.drawPositions)!=null&&s.some(l=>o==null?void 0:o.includes(l))?(r.matchUpStatus=Vt,r.matchUpStatusCodes=[],Rt({tournamentId:t==null?void 0:t.tournamentId,context:n,drawDefinition:e,matchUp:r}),{...X}):ee({result:{error:jG},info:"matchUp does not include BYE",stack:n})}function tI(t){var g,v;let{tournamentRecord:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:o,event:s}=t,l="doubleExitAdvancement";if(o.structureType===xn)return ee({result:{...X},stack:l});let{matchUp:u,targetMatchUps:c,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:m,loserTargetDrawPosition:h}=c,f=[zt,Mt].includes(p==null?void 0:p.matchUpStatus)&&!((g=p.sides)!=null&&g.map(y=>y.participantId??y.participant).filter(Boolean).length);if(p&&p.matchUpStatus!==Vt){let{loserTargetLink:y}=d;if((v=i==null?void 0:i.progression)!=null&&v.doubleExitPropagateBye){let I=XY({loserTargetDrawPosition:h,tournamentRecord:e,loserTargetLink:y,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:s});if(I.error)return ee({result:I,stack:l})}else if(!f){let{feedRound:I,drawPositions:b,matchUpId:S}=p,w=I?2:2-b.indexOf(h),U=mV({...t,targetMatchUp:p,walkoverWinningSide:w,tournamentRecord:e,sourceMatchUp:u,matchUpId:S});if(U.error)return ee({result:U,stack:l})}}if(m){let y=mV({...t,matchUpId:m.matchUpId,targetMatchUp:m,tournamentRecord:e,sourceMatchUp:u});if(y.error)return ee({result:y,stack:l})}return ee({result:{...X},stack:l})}function mV(t){var V,G,j;let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:o}=t,s=r.structures.find(({structureId:z})=>z===a.structureId),l=t.matchUpStatus===dr?dr:tr,u=t.matchUpStatus===dr?Mt:zt,c="conditionallyAdvanceDrawPosition",d=o.drawMatchUps.find(z=>z.matchUpId===a.matchUpId);if(!d)return{error:aa};let p=(n==null?void 0:n.drawPositions)||[],m=(V=d.drawPositions)==null?void 0:V.filter(Boolean),h=(n==null?void 0:n.structureId)===a.structureId;if(h&&Rn(p,m)&&(m=m.filter(z=>!p.includes(z))),h&&m.length>1)return ee({result:{error:Ef},stack:c});let{pairedPreviousMatchUpIsDoubleExit:f,pairedPreviousMatchUp:g}=vq(t),v=Cn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:y,targetLinks:I}=v,{loserTargetDrawPosition:b,winnerMatchUp:S,loserMatchUp:w}=y;if(w){let{loserTargetLink:z}=I,W=XY({loserTargetDrawPosition:b,loserMatchUp:w,tournamentRecord:i,loserTargetLink:z,drawDefinition:r,matchUpsMap:o});if(W.error)return ee({result:W,stack:c})}let U=((G=d.drawPositions)==null?void 0:G.filter(Boolean))||[],T=U.length===1,D=t.walkoverWinningSide||T&&FU({drawPosition:U[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,P=[zt,Mt].includes(d.matchUpStatus)&&!U.length,E=d.finishingRound===1,R=P&&!E?l:u,N=e.find(z=>z.matchUpId===g.matchUpId),A=[],M;n&&((n==null?void 0:n.structureId)===(N==null?void 0:N.structureId)?n.roundPosition<(g==null?void 0:g.roundPosition)?M=1:M=2:a.feedRound?n.structureId===a.structureId?M=2:M=1:D&&(M=3-D));let C=t.matchUpStatus,O=g==null?void 0:g.matchUpStatus;M===1?A=[{matchUpStatus:hU(C),previousMatchUpStatus:C,sideNumber:1},{matchUpStatus:hU(O),previousMatchUpStatus:O,sideNumber:2}]:M===2&&(A=[{matchUpStatus:hU(O),previousMatchUpStatus:O,sideNumber:1},{matchUpStatus:hU(C),previousMatchUpStatus:C,sideNumber:2}]),A.length&&(A=A.map(z=>je(z)));let k=Js({...t,winningSide:D,matchUp:d,matchUpStatusCodes:A,context:c,matchUpStatus:R});if(k.error)return ee({result:k,stack:c});if(P)return tI({...t,matchUpStatus:R,targetData:v});if(!S)return ee({result:{...X},stack:c});let x=m.length===2?m[D-1]:m[0],{positionAssignments:F}=oi({structure:s}),$=F==null?void 0:F.find(z=>z.drawPosition===x),_=o.drawMatchUps.find(z=>z.matchUpId===S.matchUpId),L=(j=_==null?void 0:_.drawPositions)==null?void 0:j.filter(Boolean),B=L.length===1;if(x){if($!=null&&$.bye){let z=Cn({matchUpId:_.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(B){let W=L.filter(Boolean)[0],q=FU({drawPosition:W,matchUpId:_.matchUpId,inContextDrawMatchUps:e}),Y=Js({appliedPolicies:t.appliedPolicies,matchUpId:_.matchUpId,matchUp:_,matchUpStatus:u,matchUpStatusCodes:[],removeScore:!0,context:c,drawDefinition:r,winningSide:q});return Y.error?ee({result:Y,stack:c}):zA({drawPositionToAdvance:W,matchUpId:_.matchUpId,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:o})}else if([zt,Mt].includes(S.matchUpStatus)){let W=tI({...t,matchUpId:_.matchUpId,matchUpStatus:R,targetData:z});if(W.error)return ee({result:W,stack:c})}return ee({result:{...X},stack:c})}return Hf({matchUpId:S.matchUpId,drawPosition:x,inContextDrawMatchUps:e,drawDefinition:r})}else if(f){if(!_)return{error:aa};if(B){let q=L[0],Y=FU({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:q});console.log("existing drawPosition is winningSide",{walkoverWinningSide:Y})}let z=[zt,Mt].includes(_.matchUpStatus)?u:l,W=Js({matchUpId:_.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:_,matchUpStatusCodes:[],removeScore:!0,context:c,drawDefinition:r,matchUpStatus:z});if(W.error)return ee({result:W,stack:c});if(z===l){let q=tI({...t,matchUpId:a.matchUpId,matchUpStatus:z,targetData:v});if(q.error)return q}}return ee({result:{...X},stack:c})}function XY(t){var u;let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:o}=t,s=(u=r==null?void 0:r.target)==null?void 0:u.structureId,{structure:l}=it({drawDefinition:n,structureId:s});return l?Ka({drawPosition:e,tournamentRecord:i,drawDefinition:n,structureId:s,matchUpsMap:a,event:o}):{error:lp}}function hU(t){return t===tr?zt:t===dr?Mt:t}function yme(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,o=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=r===Vt,u=a.winningSide,c=[tr,dr].includes(r),d=lb({matchUpStatus:r}),p=_C({matchUpStatus:r}),m=!d&&!p,h=t.matchUpTieId||u&&d&&!c,f=u&&c,g=()=>Js({...t,removeScore:[zu,zt].includes(r),matchUpStatus:r||Xi});return m&&{error:IC}||h&&l1(t)||f&&bme(t)||u&&tv(t)||p&&g()||l&&Ime({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:IC}||c&&wme(t)||o&&l1(t)||ee({result:{error:Cg},stack:s})}function bme(t){let e=tv(t);return e.error?e:tI(t)}function wme(t){let e=l1({...t,removeScore:!0});return e.error?e:tI(t)}function l1(t){var n;let e="scoreModification";if(t.isCollectionMatchUp&&((n=t.dualMatchUp)!=null&&n.winningSide)&&!t.projectedWinningSide){let a=tv(t);if(a.error)return ee({result:a,stack:e})}let i=!!t.matchUp.collectionId,r=Js({...t,context:e});if(i){let{matchUpTieId:a,drawDefinition:o,matchUpsMap:s}=t,l=Ku({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:o,matchUpsMap:s});if(l.error)return ee({result:l,stack:e});Object.assign(r,{tieMatchUpResult:l})}return ee({result:r,stack:e})}function Ume({drawDefinition:t,structure:e,matchUp:i}){var l,u,c,d;let{drawPositions:r}=i,{positionAssignments:n}=oi({drawDefinition:t,structure:e}),a=(l=n==null?void 0:n.filter(({drawPosition:p})=>r==null?void 0:r.includes(p)))==null?void 0:l.map(p=>{var h;let{extension:m}=vt({element:p,name:Tc});return(h=m==null?void 0:m.value)==null?void 0:h.groupOrder}),{containerStructures:o}=Bg({drawDefinition:t}),s=o[e.structureId];return{structureIds:(d=(c=(u=Vg({drawDefinition:t,structureId:s}))==null?void 0:u.links)==null?void 0:c.source)==null?void 0:d.filter(p=>{var m;return Rn(a,((m=p.source)==null?void 0:m.finishingPositions)||[])}).map(p=>p.source.structureId)}}function QY({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===kd&&Cc({drawDefinition:t,structure:e})){let{structureIds:n}=Ume({drawDefinition:t,structure:e,matchUp:i});n!=null&&n.length&&r.push(...n)}return{connectedStructureIds:r}}function Sme(t){var s,l,u;let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,o=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(o.target.feedProfile===xo){let c=r.sides.find(({sideNumber:p})=>p!==a).participantId,d=i.find(p=>p.structureId===o.target.structureId&&p.roundNumber===o.target.roundNumber&&p.sides.some(({participantId:m})=>m===c));if((d==null?void 0:d.matchUpStatus)===Xi){let p=Cn({matchUpId:d.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!jd({inContextDrawMatchUps:i,drawDefinition:n,targetData:p})){let{structure:m}=it({structureId:d.structureId,drawDefinition:n}),h=oi({structure:m}).positionAssignments;for(let f of h||[])if(f.participantId===c){let g=r.sides.find(({sideNumber:v})=>v===a).participantId;if(f.participantId=g,m==null?void 0:m.positionAssignments)m.positionAssignments=h;else if(m!=null&&m.structures){let v=Object.assign({},...(h||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of m.structures)(l=y.positionAssignments)==null||l.forEach(I=>I.participantId=v[I.drawPosition])}Rc({tournamentId:(u=t.tournamentRecord)==null?void 0:u.tournamentId,event:t.event,drawDefinition:n,structure:m}),e=!0}}}}return{...X,qualifierReplaced:e}}function Tme(t){var s,l,u,c,d;let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,o=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(o.target.feedProfile===xo){let p=(l=r.sides.find(({sideNumber:f})=>f===a))==null?void 0:l.participantId,m=i.filter(f=>f.structureId===o.target.structureId&&f.roundNumber===o.target.roundNumber&&f.sides.some(({participantId:g,qualifier:v})=>v&&!g)),h=ma(m);if((h==null?void 0:h.matchUpStatus)===Xi){let f=Cn({matchUpId:h.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!jd({inContextDrawMatchUps:i,drawDefinition:n,targetData:f})){let g=(u=h.sides.find(I=>I.qualifier&&!I.participantId))==null?void 0:u.drawPosition,{structure:v}=it({structureId:h.structureId,drawDefinition:n});if(!v)return{error:Ci};let y=oi({structure:v}).positionAssignments;for(let I of y||[])if(I.drawPosition===g&&!I.participantId){if(I.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let b=Object.assign({},...(y||[]).map(S=>({[S.drawPosition]:S.participantId})));for(let S of v.structures)(c=S.positionAssignments)==null||c.forEach(w=>w.participantId=b[w.drawPosition])}Rc({tournamentId:(d=t.tournamentRecord)==null?void 0:d.tournamentId,event:t.event,drawDefinition:n,structure:v}),e=!0}}}}return{...X,qualifierPlaced:e}}function Dme(t){var m,h;let e="attemptToSetWinningSide",i,{appliedPolicies:r,disableAutoCalc:n,drawDefinition:a,dualMatchUp:o,winningSide:s,structure:l,matchUp:u}=t;if(o!=null&&o._disableAutoCalc&&n!==!1)return TO(t);if(u.winningSide&&u.winningSide!==s){let{connectedStructureIds:f}=QY({drawDefinition:a,structure:l,matchUp:u});f.length&&(console.log({connectedStructureIds:f}),i=!0);let g=tv(t);if(g.error)return g}let c=p3(t);if(c.error)return ee({result:c,stack:e});let d,p;return t.qualifierChanging&&((m=r==null?void 0:r[OI])!=null&&m.autoReplaceQualifiers)&&(d=Sme(t).qualifierReplaced),t.qualifierAdvancing&&((h=r==null?void 0:r[OI])!=null&&h.autoPlaceQualifiers)&&(p=Tme(t).qualifierPlaced),ee({result:je({...X,...c,connectedStructures:i,qualifierReplaced:d,qualifierPlaced:p}),stack:e})}var jU={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function ZY(t){var g,v,y,I;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:o}=t,{matchUpId:s}=o,{iteration:l=0}=t;l+=1;let u="removeDoubleExit";Oa({color:"brightyellow",method:u,matchUpId:s,iteration:l,keyColors:jU});let{targetMatchUps:{loserMatchUp:c,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:m}}=a;if(d&&d.matchUpStatus!==Vt){let{stage:b,roundNumber:S,roundPosition:w,structureName:U}=d;Oa({winner:"winner",roundPosition:w,structureName:U,roundNumber:S,keyColors:jU,stage:b}),hV({...t,targetMatchUp:d,sourceMatchUp:o,iteration:l})}let h=(c==null?void 0:c.matchUpStatus)===Vt&&((c==null?void 0:c.feedRound)||(c==null?void 0:c.roundNumber)===1),f=((v=(g=a==null?void 0:a.targetLinks)==null?void 0:g.loserTargetLink)==null?void 0:v.linkCondition)===nl;if(h&&f){let b=e.filter(({roundNumber:U,structureId:T})=>T===o.structureId&&U===1),S=b.map(({roundPosition:U})=>U),w=Rr(S.sort(),2).find(U=>U.includes(o.roundPosition));if(((y=b.filter(({roundPosition:U})=>w.includes(U)))==null?void 0:y.map(({matchUpStatus:U})=>U)).every(U=>[dr,tr].includes(U)))return ee({result:{...X},stack:u})}if(c&&(c.matchUpStatus!==Vt||h)){let b=e.find(({matchUpId:E})=>E===c.matchUpId),{structure:S}=it({drawDefinition:r,structureId:b.structureId}),{stage:w,roundNumber:U,roundPosition:T,feedRound:D,structureName:P}=c;if(Oa({loser:"loser",roundPosition:T,structureName:P,roundNumber:U,keyColors:jU,feedRound:D,stage:w}),((I=i==null?void 0:i.progression)==null?void 0:I.doubleExitPropagateBye)||h)s1({drawPosition:p,targetLink:m,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:n});else{let E=hV({...t,targetMatchUp:c,structure:S,iteration:l});if(E.error)return ee({result:E,stack:u})}}return ee({result:{...X},stack:u})}function hV(t){var b,S,w,U,T,D;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:o,structure:s,iteration:l}=t,u="conditionallyRemoveDrawPosition";Oa({method:u,structureName:s==null?void 0:s.structureName,iteration:l});let c=Cn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:d}}=c,p=o==null?void 0:o.drawMatchUps.find(P=>P.matchUpId===a.matchUpId),m=[],h,f,g;if(a.feedRound)g=(S=(b=d==null?void 0:d.drawPositions)==null?void 0:b.filter(Boolean))==null?void 0:S.find(P=>a.drawPositions.includes(P));else if(!n)g=(w=Vi((a==null?void 0:a.drawPositions)||[],(d==null?void 0:d.drawPositions)||[]))==null?void 0:w[0];else if(f=(U=Iq({structureId:s.structureId,matchUp:n,matchUpsMap:o}))==null?void 0:U.pairedPreviousMatchUp,h=[tr,dr].includes(f==null?void 0:f.matchUpStatus),m=((T=f==null?void 0:f.drawPositions)==null?void 0:T.filter(Boolean))||[],[...vr,Vt].includes(f==null?void 0:f.matchUpStatus)||(f==null?void 0:f.winningSide)){let P=n.drawPositions||[],E=(D=a.drawPositions)==null?void 0:D.filter(Boolean);Rn(P,E)&&(E=E==null?void 0:E.filter(R=>!P.includes(R))),g=P.concat(m).find(R=>E==null?void 0:E.includes(R))}if(d&&g){let{stage:P,roundNumber:E,roundPosition:R,structureName:N}=d;Oa({method:"removeDirectedWinner",drawPositionToRemove:g,color:"brightgreen",roundPosition:R,structureName:N,roundNumber:E,keyColors:jU,stage:P}),JY({winningDrawPosition:g,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:o})}let v=ZY({targetData:c,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:o,structure:s,iteration:l});if(v.error)return ee({result:v,stack:u});let y=Pme({pairedPreviousDoubleExit:h,noContextTargetMatchUp:p}),I=!h;return v=Js({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],context:u,matchUpStatus:y,removeScore:I,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),v.error?ee({result:v,stack:u}):{...X}}function Pme({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===Vt?Vt:t?[dr,Mt].includes(e==null?void 0:e.matchUpStatus)?Mt:zt:Xi}function Rme(t){var o,s,l,u,c;let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=t,a=(o=t.targetData.targetLinks)==null?void 0:o.winnerTargetLink;if(a.target.feedProfile===xo){let d=(l=(s=r.sides)==null?void 0:s.find(({sideNumber:m})=>m===r.winningSide))==null?void 0:l.participantId,p=i.find(m=>{var h;return m.structureId===a.target.structureId&&m.roundNumber===a.target.roundNumber&&((h=m.sides)==null?void 0:h.some(({participantId:f})=>f===d))});if(p&&p.matchUpStatus===Xi){let m=Cn({matchUpId:p.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!jd({inContextDrawMatchUps:i,drawDefinition:n,targetData:m})){let{structure:h}=it({structureId:p.structureId,drawDefinition:n}),f=oi({structure:h}).positionAssignments;for(let g of f||[])if(g.participantId===d){if(g.participantId=void 0,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(h==null?void 0:h.structures)||[])(u=y.positionAssignments)==null||u.forEach(I=>I.participantId=v[I.drawPosition])}Rc({tournamentId:(c=t.tournamentRecord)==null?void 0:c.tournamentId,event:t.event,drawDefinition:n,structure:h}),e=!0}}}}return{qualifierRemoved:e}}function Eme(t){var f;let{matchUp:e,matchUpStatus:i,score:r,winningSide:n}=t,a="noDownStreamDependencies";if([tr,dr].includes(e==null?void 0:e.matchUpStatus)&&![tr,dr].includes(i)){let g=ZY(t);if(g.error)return ee({result:g,stack:a})}let o=i===tr,s=Ir({score:r})&&!o&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!n),l=((f=t==null?void 0:t.inContextMatchUp)==null?void 0:f.collectionId)&&vme(t.inContextMatchUp),u=t.removeScore||!l&&![mo,Ba].includes(i||mo),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!n&&!Ir({score:r}),d=i&&i!==Xi,p=g=>{var T,D;let v,{structure:y,drawDefinition:I,dualMatchUp:b,disableAutoCalc:S}=t;if(b!=null&&b._disableAutoCalc&&S!==!1)return TO({...t,removeWinningSide:c});let{connectedStructureIds:w}=QY({drawDefinition:I,structure:y,matchUp:e});w.length&&(console.log({connectedStructureIds:w}),v=!0),Object.assign(t,{removeScore:g});let U=tv(t);if(U.error)return U;if(t.removingQualifier&&((D=(T=t.appliedPolicies)==null?void 0:T[OI])!=null&&D.autoRemoveQualifiers)){let P=Rme(t);return{...X,connectedStructures:v,...P}}return{...X,connectedStructures:v}};if(c&&n&&t.isCollectionMatchUp)return fV(t);let m=[zu,Ba].includes(i)&&t.dualWinningSideChange,h=(n||m)&&Dme(t)||s&&p(u)||d&&yme(t)||c&&p(u)||e&&fV({...t,removeScore:!0})||{...X};return ee({result:h,stack:a})}function fV(t){var r;let e="ndd:scoreModification";if(t.isCollectionMatchUp&&((r=t.dualMatchUp)!=null&&r.winningSide)&&!t.projectedWinningSide&&!t.autoCalcDisabled){let n=tv(t);if(n.error)return n}let i=Js({...t,context:e});if(t.isCollectionMatchUp){let{matchUpTieId:n,drawDefinition:a,event:o,matchUpsMap:s}=t,{removeWinningSide:l}=Ku({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,drawDefinition:a,matchUpsMap:s,event:o});l&&console.log("REMOVE WINNING SIDE")}return ee({result:i,stack:e})}function qk(t){var c,d,p;let e=ze(t,[{[wr]:!0,[Fn]:!0,[Il]:!0},{homeParticipantId:!0,[jo]:mr}]);if(e.error)return e;let i=Jg(t,[{[Fg]:eu,attr:{[mT]:!0}}]);if(i.error)return i;let r=(p=(d=(c=i==null?void 0:i.matchUp)==null?void 0:c.matchUp)==null?void 0:d.sides)==null?void 0:p.map(m=>m==null?void 0:m.participantId);if(t.homeParticipantId&&!(r!=null&&r.includes(t.homeParticipantId)))return{error:Es};let{disableNotice:n,homeParticipantId:a,removePriorValues:o,tournamentRecord:s,drawDefinition:l,matchUpId:u}=t;return Pa({duplicateValues:!1,removePriorValues:o,tournamentRecord:s,drawDefinition:l,disableNotice:n,matchUpId:u,timeItem:{itemType:_A,itemValue:a}})}function e4({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=vp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:AT});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function Qc(t){var m;let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:o,scheduledTime:s,matchUpId:l}=t;if(!l)return ee({result:{error:yn},stack:e});if(!kg(s))return ee({result:{error:Ao},stack:e});if(!i){let h=Ui({drawDefinition:a,matchUpId:l});if(h.error)return ee({result:h,stack:e});i=h.matchUp}let u=mt(s),c=lh({matchUp:i}).scheduledDate,d=u&&!c;if((m=e4({matchUp:i}).timeModifiers||[])!=null&&m.length){let h=t4({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(h!=null&&h.error)return ee({result:h,stack:e})}let p=Zm(s,!0,d);return Pa({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:o,matchUpId:l,timeItem:{itemType:oh,itemValue:p}})}function t4({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return ee({result:{error:yn},stack:s});if(n!==void 0&&!Array.isArray(n))return ee({info:Bd("timeModifiers"),result:{error:se},stack:s});if(!o){let d=Ui({drawDefinition:i,matchUpId:a});if(d.error)return ee({result:d,stack:s});o=d.matchUp}let l=e4({matchUp:o}).timeModifiers||[],u=n.filter(d=>!l.includes(d));if(n.length&&!u.length)return{...X};if(u.some(d=>kC.includes(d))){l=l.filter(p=>!kC.includes(p));let d=Qc({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return ee({result:d,stack:s})}let c=n!=null&&n.length?[...u,...l]:void 0;return Pa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:AT,itemValue:c}})}function OD({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:yn};let o=t&&il.test(t);if(t&&!o)return{error:Ar};let s={itemValue:mt(t),itemType:ah};return Pa({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s})}function kD({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtIds:s}){var c,d;if(!i&&!e)return{error:ge};if(!o)return{error:yn};let l=Ui({drawDefinition:r,matchUpId:o});if(l.error)return l;if(((c=l==null?void 0:l.matchUp)==null?void 0:c.matchUpType)!==xa)return{error:oa};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:se,context:{courtIds:s}};let u;if(s){let p=e||i&&{[i.tournamentId]:i},m=Ju({tournamentRecords:p});if(m.error)return m;let h=(d=m.courts)==null?void 0:d.filter(f=>s.includes(f.courtId));if((h==null?void 0:h.length)!==s.length)return{error:se,context:{courtIds:s}};u=h==null?void 0:h.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return Pa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:Wl,itemDate:a,itemValue:u}})}function iv({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:o}){if(!i)return{error:ge};if(!a)return{error:yn};if(o){let s=tu({tournamentRecords:e,tournamentRecord:i,venueId:o});if(s.error)return s}return Pa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:nh,itemValue:o}})}function yh({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!e)return{error:ge};if(!o)return{error:yn};if(s){let u=uh({tournamentRecords:e,tournamentRecord:i,courtId:s});if(u.error)return u;let c=(l=u.venue)==null?void 0:l.venueId;iv({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,venueId:c})}return Pa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:Ec,itemDate:a,itemValue:s}})}function zs(t,e){let i=zH.test(t)?t:wi(t),r=mt(t)||mt(e)||Vo(new Date);return new Date(`${r}T${i}`).getTime()}function xD(t){var M;let e="addMatchUpScheduleItems",i=ze(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[Jn]:ta}],e);if(i.error)return i;let{matchUpDependencies:r,inContextMatchUps:n}=t,{errorOnAnachronism:a=!1,checkChronology:o=!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,disableNotice:d,drawMatchUps:p,matchUpId:m,schedule:h,event:f}=t,g,v;if(p)g=p.find(C=>C.matchUpId===m);else{let C=Ui({drawDefinition:c,event:f,matchUpId:m});if(C.error)return C;g=C.matchUp}let{endTime:y,courtId:I,courtIds:b,courtOrder:S,resumeTime:w,homeParticipantId:U,scheduledDate:T,scheduledTime:D,startTime:P,stopTime:E,timeModifiers:R,venueId:N}=h;o&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=ps({drawDefinition:c}));let A=(M=r==null?void 0:r[m])==null?void 0:M.matchUpIds;if(h.scheduledDate&&o&&A){let C=n==null?void 0:n.filter(O=>{var k,x;return(((k=O.schedule)==null?void 0:k.scheduledDate)||mt((x=O.schedule)==null?void 0:x.scheduledTime))&&A.includes(O.matchUpId)}).map(({schedule:O})=>{let k=hS(O);return new Date(k).getTime()});if(C!=null&&C.length){let O=hS(h),k=new Date(O).getTime();if(Math.max(...C)>=k){if(a)return ee({result:{error:fC},stack:e});v=fC}}}if(T!==void 0){let C=OD({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,scheduledDate:T,matchUpId:m});if(C!=null&&C.error)return ee({result:C,stack:e,context:{scheduledDate:T}})}if(D!==void 0){let C=Qc({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,scheduledTime:D,matchUpId:m,matchUp:g});if(C!=null&&C.error)return ee({result:C,stack:e,context:{scheduledTime:D}})}if(P!==void 0){let C=Kk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m,startTime:P,event:f});if(C!=null&&C.error)return ee({result:C,stack:e,context:{startTime:P}})}if(E!==void 0){let C=Xk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m,stopTime:E,event:f});if(C!=null&&C.error)return ee({result:C,stack:e,context:{stopTime:E}})}if(w!==void 0){let C=Qk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,resumeTime:w,matchUpId:m,event:f});if(C!=null&&C.error)return ee({result:C,stack:e,context:{resumeTime:w}})}if(y!==void 0){let C=Jk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m,endTime:y,event:f});if(C!=null&&C.error)return ee({result:C,stack:e,context:{endTime:y}})}if(b!==void 0){let C=kD({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m,courtIds:b});if(C!=null&&C.error)return ee({result:C,stack:e,context:{courtIds:b}})}if(I!==void 0&&T!==void 0){let C=yh({courtDayDate:T,disableNotice:!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,matchUpId:m,courtId:I});if(C!=null&&C.error)return ee({result:C,stack:e,context:{courtId:I}})}if(N!==void 0){let C=iv({disableNotice:!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,matchUpId:m,venueId:N});if(C!=null&&C.error)return ee({result:C,stack:e,context:{venueId:N}})}if(S!==void 0&&ot(S)){let C=Yk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,courtOrder:S,matchUpId:m});if(C!=null&&C.error)return ee({result:C,stack:e,context:{courtOrder:S}})}if(R!==void 0){let C=t4({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,timeModifiers:R,matchUpId:m,matchUp:g});if(C!=null&&C.error)return ee({result:C,stack:e,context:{timeModifiers:R}})}return Di(U)&&qk({disableNotice:!0,homeParticipantId:U,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m}),d||Rt({tournamentId:u==null?void 0:u.tournamentId,eventId:f==null?void 0:f.eventId,context:e,drawDefinition:c,matchUp:g}),v?{...X,warnings:[v]}:{...X}}function Yk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:yn};if(n&&!ot(n))return{error:se,info:"courtOrder must be numeric"};let o=n&&et(n);return Pa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:NT,itemValue:o}})}function i4({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:o}){if(!o)return{error:yn};if(!n)return{error:mr};if(e){let l=Mi({tournamentRecord:e,participantFilters:{participantTypes:[St],participantRoles:[KA]}}).participants??[];if(!Sc({tournamentParticipants:l,participantId:n}))return{error:zi}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(s.itemSubTypes=[a]),Pa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:o,timeItem:s})}function Kk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:o}){if(!n)return{error:yn};if(!kg(a))return{error:Ao};let{matchUp:s}=Ui({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=lh({matchUp:s}),u=((s==null?void 0:s.timeItems)??[]).filter(c=>[vu,Nl,Cu].includes(c==null?void 0:c.itemType)).map(c=>zs(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||zs(a,l)<u){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==Is));let c=Zm(a,!0,!0);return Pa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:Is,itemValue:c}})}else return{error:gH}}function Jk({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:o,event:s}){if(!a)return{error:yn};if(!kg(o))return{error:Ao};let{matchUp:l}=Ui({drawDefinition:r,event:s,matchUpId:a}),{scheduledDate:u}=lh({matchUp:l}),c=((l==null?void 0:l.timeItems)??[]).filter(d=>[Is,Nl,vu].includes(d==null?void 0:d.itemType)).map(d=>zs(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||zs(o,u)>c){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Cu));let d=Zm(o,!0,!0);return Pa({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Cu,itemValue:d}})}else return{error:hH}}function Xk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:o}){if(!n)return{error:yn};if(!kg(a))return{error:Ao};let{matchUp:s}=Ui({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=lh({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,f)=>f.itemType===Cu||h,void 0))return{error:RN};let c=u.filter(h=>[Is,Nl,vu].includes(h==null?void 0:h.itemType)).sort((h,f)=>zs(h.itemValue,l)-zs(f.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===vu,m=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>zs(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(zs(a,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:Zm(a,!0,!0),itemType:vu};return Pa({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:h})}else return{error:fH}}function Qk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:o}){if(!a)return{error:yn};if(!kg(n))return{error:Ao};let{matchUp:s}=Ui({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=lh({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,f)=>f.itemType===Cu||h,void 0))return{error:RN};let c=u.filter(h=>[Is,Nl,vu].includes(h==null?void 0:h.itemType)).sort((h,f)=>zs(h.itemValue,l)-zs(f.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===Nl,m=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>zs(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(zs(n,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:Zm(n,!0,!0),itemType:Nl};return Pa({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:h})}else return{error:Vne}}function Cme({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:o,matchUp:s,event:l,score:u}){var p;let c=Ce(n,void 0,!0);for(let m of(c==null?void 0:c.tieMatchUps)||[])m.matchUpId===s.matchUpId&&(m.winningSide=r,m.score=u,!Ir({score:u})&&!e?Object.assign(m,{...qT}):e&&(m.matchUpStatus=e));a=a??((p=vn({matchUp:s,structure:o,drawDefinition:t,event:l}))==null?void 0:p.tieFormat);let{winningSide:d}=Sb({matchUp:c,drawDefinition:t,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:d}}function Mme(t){var S;let{tournamentRecord:e,inContextMatchUp:i,structure:r,drawDefinition:n}=t,a=i.roundNumber,o=i.sides.find(w=>w.sideNumber===i.winningSide),s=i.sides.find(w=>w.sideNumber!==i.winningSide),{drawPosition:l,participantId:u}=o,{drawPosition:c,participantId:d}=s,p="swapWinnerLoser",{matchUps:m}=Wt(t),h=m.filter(({drawPositions:w,roundNumber:U})=>(w==null?void 0:w.includes(l))&&U>a);La({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:h}),h.forEach(w=>{var U,T;w.drawPositions=((U=w.drawPositions)==null?void 0:U.map(D=>D===l?c:D))||[],Rt({tournamentId:e==null?void 0:e.tournamentId,eventId:(T=t.event)==null?void 0:T.eventId,context:p,drawDefinition:n,matchUp:w})});let{stage:f,stageSequence:g}=r,v=n.structures.filter(({stage:w,stageSequence:U})=>w===f&&U>g).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:y,winnerTargetLink:I}}=t.targetData,b=[y==null?void 0:y.target.structureId,(S=I==null?void 0:I.target)==null?void 0:S.structureId].filter(Boolean);return n.structures.filter(({stage:w,structureId:U})=>w!==f&&b.includes(U)).forEach(({stage:w,stageSequence:U,structureId:T})=>{v.includes(T)||v.push(T),n.structures.filter(({stage:D,stageSequence:P})=>D===w&&P>U).forEach(({structureId:D})=>{v.includes(D)||v.push(D)})}),n.structures.filter(({structureId:w})=>v.includes(w)).forEach(w=>{let{positionAssignments:U}=oi({structure:w}),T=U==null?void 0:U.find(({participantId:P})=>P===u),D=U==null?void 0:U.find(({participantId:P})=>P===d);T&&(T.participantId=d),D&&(D.participantId=u)}),Js({...t,context:p})}function _b(t){var $,_,L;let e="setMatchUpStatus";t.matchUpStatus&&[zt,tr].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,tournamentRecords:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpStatus:u,winningSide:c,matchUpId:d,event:p,score:m}=t;if(!l)return{error:Le};if(u&&[zu,mo,Ba,Xi].includes(u)&&c)return{error:se,winningSide:c,matchUpStatus:u};if(![void 0,...aW].includes(u))return ee({result:{error:Cg},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let h=sn({drawDefinition:l}),{matchUps:f}=hr({nextMatchUps:!0,tournamentRecord:a,inContext:!0,drawDefinition:l,matchUpsMap:h,event:p}),g=h.drawMatchUps.find(B=>B.matchUpId===d),v=f==null?void 0:f.find(B=>B.matchUpId===d);if(!g||!f)return{error:pn};if((g.winningSide||c)&&u===Vt)return{context:"Cannot have Bye with winningSide",error:RU,matchUpStatus:u};let y=v==null?void 0:v.structureId,{structure:I}=it({drawDefinition:l,structureId:y}),b=Yi(fi)(g.matchUpType),S=($=v==null?void 0:v.drawPositions)==null?void 0:$.filter(Boolean),w=v==null?void 0:v.matchUpTieId,U=Cn({matchUpId:w||d,inContextDrawMatchUps:f,drawDefinition:l});Object.assign(t,{inContextDrawMatchUps:f,inContextMatchUp:v,matchUpTieId:w,matchUpsMap:h,targetData:U,structure:I,matchUp:g});let T=jd(t),D;if(b){if(o)Lt({extension:{name:Pm,value:!0},element:g});else if(s){let B=g.winningSide,{winningSide:V,scoreStringSide1:G,scoreStringSide2:j,set:z}=Sb({drawDefinition:l,matchUpsMap:h,structure:I,matchUp:g,event:p}),W={scoreStringSide1:G,scoreStringSide2:j,sets:z?[z]:[]};if(D=V!==B,T&&D)return ee({stack:"winningSideWithDownstreamDependencies",result:{error:W0},context:{winningSide:c,matchUp:g}});Un({name:Pm,element:g}),Object.assign(t,{winningSide:V,dualWinningSideChange:D,projectedWinningSide:V,score:W})}Tb({tournamentId:a==null?void 0:a.tournamentId,inContextDualMatchUp:v,eventId:p==null?void 0:p.eventId,dualMatchUp:g,drawDefinition:l})}if(b&&u&&[th].includes(u))return{info:"Not supported for matchUpType: TEAM",error:se};if(m&&!b&&!r){let B=g.matchUpFormat??(I==null?void 0:I.matchUpFormat)??(l==null?void 0:l.matchUpFormat)??(p==null?void 0:p.matchUpFormat),V=YO({existingMatchUpStatus:g.matchUpStatus,matchUpFormat:B,matchUpStatus:u,winningSide:c,score:m});if(V.error)return V}let P=((_=$t({policyTypes:[OI,Ns],tournamentRecord:a,drawDefinition:l,event:p}))==null?void 0:_.appliedPolicies)??{};Nt(t.policyDefinitions)&&Object.assign(P,t.policyDefinitions);let E=Ame({assignedDrawPositions:S,inContextMatchUp:v,appliedPolicies:P,drawDefinition:l,matchUpStatus:u,structure:I,matchUp:g});if(E!=null&&E.error)return E;let R=(v==null?void 0:v.stage)===Ke&&v.finishingRound===1,N=R&&c,A=R&&g.winningSide&&!c&&(!t.matchUpStatus||t.matchUpStatus&&_C({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!Ir({outcome:t.outcome})),M=N&&c!==g.winningSide&&g.winningSide;if(Object.assign(t,{qualifierAdvancing:N,qualifierChanging:M,removingQualifier:A,appliedPolicies:P}),w){let{matchUp:B}=Ui({matchUpId:w,inContext:!0,drawDefinition:l,matchUpsMap:h,event:p});if(B){let V=(L=vn({matchUp:B,drawDefinition:l,structure:I,event:p}))==null?void 0:L.tieFormat,{projectedWinningSide:G}=Cme({drawDefinition:l,matchUpStatus:u,dualMatchUp:B,matchUpsMap:h,winningSide:c,tieFormat:V,structure:I,matchUp:g,event:p,score:m}),j=B.winningSide;D=G!==j;let z=B._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:D,projectedWinningSide:G,autoCalcDisabled:z,matchUpTieId:w,dualMatchUp:B,tieFormat:V})}}let C=lb({matchUpStatus:u});if(!w){if(T&&!c&&(u&&_C({matchUpStatus:u})||u&&[tr,dr].includes(u)))return{error:RU,activeDownstream:T,winningSide:c};if(c&&c===g.winningSide&&u&&!C)return{context:"winningSide must include directing matchUpStatus",error:RU,directingMatchUpStatus:C,matchUpStatus:u}}let{schedule:O}=t;if(O){let B=xD({disableNotice:!0,tournamentRecords:n,tournamentRecord:a,drawDefinition:l,matchUpId:d,schedule:O});if(B.error)return B}let k=!b&&!D&&c&&g.winningSide&&g.winningSide!==c;if(i&&k&&g.roundPosition)return Mme(t);let x=c&&!w||t.projectedWinningSide;Oa({activeDownstream:T,matchUpWinner:x,method:e,winningSide:c});let F=!T&&Eme(t)||x&&Nme(t)||(C||t.autoCalcDisabled)&&r4(t)||{error:TH};return ee({result:F,stack:e})}function Nme(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?r4(t):ee({stack:"winningSideWithDownstreamDependencies",result:{error:W0},context:{winningSide:i,matchUp:e}})}function r4(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!Ir({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&Xi||t.winningSide&&qi||mo:t.matchUpStatus||qi,o=t.removeScore||[zu,zt].includes(a)&&![mo,Ba].includes(a),s=Js({...t,matchUpStatus:a,removeWinningSide:n,context:"sms",removeScore:o});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=Ku({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:r});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function Ame({assignedDrawPositions:t,inContextMatchUp:e,appliedPolicies:i,drawDefinition:r,matchUpStatus:n,structure:a,matchUp:o}){var c,d;if(((c=i==null?void 0:i[Ns])==null?void 0:c.requireParticipantsForScoring)===!1)return{...X};let s=(d=e==null?void 0:e.sides)==null?void 0:d.map(p=>p.participantId).filter(Boolean).length,l=o!=null&&o.sides?[]:oi({structureId:a==null?void 0:a.structureId,drawDefinition:r}).positionAssignments,u=s&&s===2||o.collectionId&&zn({structure:a})&&s&&s>=1||(t==null?void 0:t.length)===2&&(l==null?void 0:l.filter(p=>t.includes(p.drawPosition)).every(p=>p.participantId));return n&&nW.includes(n)&&!u?ee({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:n,requiredParticipants:u},result:{error:Cg}}):{...X}}function n4({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:Le};let{matchUp:n}=Ui({drawDefinition:e,matchUpId:i,event:r});return(n==null?void 0:n.matchUpType)!==xa?{error:oa}:_b({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function a4({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:Le};if(!i)return{error:yn};let{matchUp:r}=Ui({drawDefinition:t,event:e,matchUpId:i});return r?Un({name:yT,element:r}):{error:pn}}function Ome({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:o}){var m,h,f,g,v;let s="substituteParticipant";if(!r)return{error:Le};if(!a)return{error:yn};if(!e||!t)return ee({result:{error:mr},stack:s});let{matchUp:l}=Ui({drawDefinition:r,matchUpId:a,event:o});if(!l)return{error:pn};if(!l.collectionId)return ee({result:{error:oa},stack:s});let u=sn({drawDefinition:r}),{matchUps:c}=hr({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:r,matchUpsMap:u}),d=c==null?void 0:c.find(y=>y.matchUpId===a),p=(h=(m=c==null?void 0:c.find(y=>y.matchUpId===(d==null?void 0:d.matchUpTieId)))==null?void 0:m.sides)==null?void 0:h.find(y=>y.participant.individualParticipants.some(({participantId:I})=>I===e));return!p||n&&p.sideNumber!==n?{error:Es}:(v=(g=(f=p.participant)==null?void 0:f.individualParticipants)==null?void 0:g.map(Ut).filter(y=>y!==e))!=null&&v.includes(t)?zk({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:o}):ee({result:{error:Es},stack:s})}function o4(t){return Ome(t)}function s4({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:Le};let{matchUp:r}=Ui({drawDefinition:t,matchUpId:e,event:i});return Lt({extension:{name:Pm,value:!0},element:r})}function l4(t){let e="setMatchUpFormat",i=ze(t,[{tournamentRecord:!0},{[Kr]:S=>Sa({matchUpFormat:S}),[$a]:Ay,matchUpFormat:!0}]);if(i.error)return ee({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:m,event:h,force:f}=t;if(a&&!Array.isArray(a))return ee({result:{error:se,scheduledDates:a},stack:e});if(u&&!$0([rl,po],u))return ee({result:{error:Vl},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],I=t.drawIds||m&&[m].filter(Boolean)||[];if((l||v!=null&&v.length)&&!n)return ee({result:{error:Le},stack:e});if(m&&c&&n){let S=QO({tournamentRecord:r,drawDefinition:n,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:c});if(S.error)return S;g+=1}let b=S=>{let w=[];for(let U of S.structures||[]){if(Array.isArray(p)&&!p.includes(U.stage)||Array.isArray(o)&&!o.includes(U.stageSequence)||v!=null&&v.length&&!v.includes(U.structureId))continue;v!=null&&v.length&&U.matchUpFormat!==s&&(U.matchUpFormat=s,w.push(U.structureId),g+=1);let T=((f||a)&&Wt({matchUpFilters:{matchUpStatuses:[Xi]},structure:U}).matchUps)??[],D=(a&&Wt({matchUpFilters:{matchUpStatuses:[Xi]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:U}).matchUps)??[];if(T!=null&&T.length){let P=D?D.map(Dr):T.map(Dr);for(let E of T)P.includes(E.matchUpId)&&(E.matchUpFormat=a!=null&&a.length?s:void 0,Rt({tournamentId:r==null?void 0:r.tournamentId,eventId:h==null?void 0:h.eventId,context:e,drawDefinition:S,matchUp:E}))}}return!w.length&&S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1),w};for(let S of(r==null?void 0:r.events)||[])if(!(y!=null&&y.length&&!y.includes(S.eventId)||u&&u!==S.eventType||u===lr))if(Array.isArray(o)||Array.isArray(p)||v!=null&&v.length||I!=null&&I.length)for(let w of S.drawDefinitions||[]){if(Array.isArray(I)&&!I.includes(w.drawId))continue;let U=b(w);li({structureIds:U,drawDefinition:w})}else S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1);return g?{...X,modificationsCount:g}:{...X,info:Og}}function Zk({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){var l,u;if(!i)return{error:Le};let a=(l=Ui({drawDefinition:i,matchUpId:r}))==null?void 0:l.matchUp;if(!(a!=null&&a.tieMatchUps))return{error:oa};let o=(u=Ui({inContext:!0,drawDefinition:i,matchUpId:r,event:n}))==null?void 0:u.matchUp,s=0;return((a==null?void 0:a.sides)||[]).forEach(c=>{c.lineUp&&delete c.lineUp}),((o==null?void 0:o.sides)||[]).forEach(c=>{if(s+=1,t===!1){let d=o==null?void 0:o.tieFormat,p=c.participantId;d&&p&&hh({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}Rt({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:n==null?void 0:n.eventId,drawDefinition:i,matchUp:a})}),{...X,modificationsCount:s}}function u4(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}=t;if(!n)return{sets:[]};let a=n.sets||[],o=Ol({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:a}),s=Ol({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:a}),l=Ol({matchUpFormat:e,matchUpStatus:i,winningSide:r,sets:a}),u=o===l?s:o;return r&&(o=r===1?l:u,s=r===2?l:u),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function $b(t){var v,y;let e=ze(t,[{[Il]:!0,[Fn]:!0}]);if(e.error)return e;let i=bo(t);if(!t.drawDefinition){let I=t.tournamentRecord??(t.tournamentId&&i[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=I);let b=Wn({eventId:t.eventId,drawId:t.drawId,tournamentRecord:I});if(b.error)return b;b.drawDefinition&&(t.drawDefinition=b.drawDefinition),t.event=b.event}let{disableScoreValidation:r,policyDefinitions:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpId:u,schedule:c,event:d,notes:p}=t,m=t.matchUpFormat||((v=t.outcome)==null?void 0:v.matchUpFormat),{policy:h}=hp({policyType:Ns,tournamentRecord:a,event:d}),f=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(h==null?void 0:h.allowChangePropagation)!==void 0&&h.allowChangePropagation||void 0,{outcome:g}=t;if(g!=null&&g.winningSide&&![1,2].includes(g.winningSide))return{error:H0};if(m){let I=QO({tournamentRecord:a,drawDefinition:l,matchUpFormat:m,matchUpId:u,event:d});if(I.error)return I}if((y=g==null?void 0:g.score)!=null&&y.sets&&!g.score.scoreStringSide1){let{score:I}=u4(g);g.score=I,g.score.sets=g.score.sets.filter(b=>b.side1Score||b.side2Score||b.side1TiebreakScore||b.side2TiebreakScore)}return _b({matchUpStatusCodes:g==null?void 0:g.matchUpStatusCodes,matchUpStatus:g==null?void 0:g.matchUpStatus,winningSide:g==null?void 0:g.winningSide,allowChangePropagation:f,disableScoreValidation:r,score:g==null?void 0:g.score,tournamentRecords:i,policyDefinitions:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpFormat:m,matchUpId:u,schedule:c,event:d,notes:p})}function c4(t){if(!(t!=null&&t.outcomes))return{error:Xe};if(!Array.isArray(t.outcomes))return{error:Xe,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:ge};let o=i.filter(s=>s.tournamentId===n);if(o.length){let s=kme({outcomes:o,tournamentRecord:a});if(s.error)return s}}return{...X}}function kme(t){var o;let{tournamentRecords:e,tournamentRecord:i,outcomes:r,policyDefinitions:n}=t,a={};r.forEach(s=>{let{eventId:l}=s;a[l]||(a[l]=[]),a[l].push(s)});for(let s of Object.keys(a)){let{event:l}=Wn({tournamentRecord:i,eventId:s});for(let u of a[s]){let{drawId:c}=u,d=(o=l==null?void 0:l.drawDefinitions)==null?void 0:o.find(p=>p.drawId===c);if(d&&c){let{matchUpFormat:p,matchUpId:m}=u,h=$b({schedule:u==null?void 0:u.schedule,tournamentRecords:e,policyDefinitions:n,tournamentRecord:i,drawDefinition:d,matchUpFormat:p,matchUpId:m,outcome:u,drawId:c,event:l});if(h.error)return h}}}return{...X}}function xme({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){var n,a;if(!r&&!t)return{error:Le};if(!i)return{error:Xe,info:"missing outcome"};if(!r&&!e)return{error:aa};if(!r){let o=Ui({drawDefinition:t,matchUpId:e});if(o.error)return o;r=o.matchUp}return typeof i!="object"||!((n=i.score)!=null&&n.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:se}:Lt({element:r,extension:{name:yT,value:i}})}function d4(t){return xme(t)}function ex(t){var f,g;let e="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=t,a=ze(t,[{[wr]:!0,[Il]:!0}],e);if(a.error)return a;let o=Jg(t,[{[Fg]:eu}]);if(o[jo])return o;let s=(f=t.tournamentRecord)==null?void 0:f.tournamentId,{matchUp:l,structure:u}=(o==null?void 0:o.matchUp)??{};if(!(l!=null&&l.tieMatchUps))return ee({result:{error:oa},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...X};let c=(g=vn({structure:u,drawDefinition:i,event:r}))==null?void 0:g.tieFormat;if(!c)return ee({result:{error:$r},info:"No inherited tieFormat",stack:e});let d=[],p=[],m=[],h=[];for(let v of c.collectionDefinitions){let{matchUpCount:y,collectionId:I}=v;p.push(I);let b=(l.tieMatchUps||[]).filter(S=>S.collectionId===I);if(b.length>y)b.sort((S,w)=>(S.matchUpStatus===Xi?1:0)-(w.matchUpStatus===Xi?1:0)),m.push(...b.slice(0,y)),d.push(...b.slice(3).map(Dr));else if(m.push(...b),b.length<y){let S=y-b.length,w=wb({collectionDefinition:v,matchUpsLimit:S,matchUp:l,uuids:n});h.push(...w)}}for(let v of(l==null?void 0:l.tieMatchUps)||[])v.collectionId&&!p.includes(v.collectionId)&&d.push(v.matchUpId);return h.length&&(m.push(...h),Pc({eventId:r==null?void 0:r.eventId,matchUps:h,drawDefinition:i,tournamentId:s})),d.length&&Wu({matchUpIds:d,eventId:r==null?void 0:r.eventId,drawDefinition:i,tournamentId:s}),l&&(l.tieMatchUps=m,l.tieFormatId=void 0,l.tieFormat=void 0,Rt({structureId:u==null?void 0:u.structureId,eventId:r==null?void 0:r.eventId,context:e,drawDefinition:i,tournamentId:s,matchUp:l})),{...X,newMatchUps:h,deletedMatchUpIds:d}}function tx(t){var f,g,v;let{tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}=t,a="resetScorecard";if(!i)return ee({result:{error:Le},stack:a});if(!r)return ee({result:{error:yn},stack:a});if(!Di(r))return ee({result:{error:se,matchUpId:r},stack:a});let o=sn({drawDefinition:i}),{matchUps:s}=hr({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:o}),l=o.drawMatchUps.find(y=>y.matchUpId===r),u=s==null?void 0:s.find(y=>y.matchUpId===r);if(!l||!s)return{error:pn};if(l.matchUpType!==Ta)return{error:oa};let c=Cn({inContextDrawMatchUps:s,drawDefinition:i,matchUpId:r}),d=u==null?void 0:u.structureId,{structure:p}=it({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:s,inContextMatchUp:u,matchUpsMap:o,targetData:c,structure:p,matchUp:l}),jd(t))return{error:W0};if((f=l.tieMatchUps)!=null&&f.length)for(let y of l.tieMatchUps){let I=_b({matchUpId:y.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:n});if(I.error)return ee({result:I,stack:a})}let m=(g=$t({tournamentRecord:e,drawDefinition:i,event:n}))==null?void 0:g.appliedPolicies,h=Ku({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:m,drawDefinition:i,matchUpsMap:o,matchUpId:r});if(h.error)return ee({result:h,stack:a});if(t.tiebreakReset&&!h.tieFormatRemoved){let y=(v=vn({drawDefinition:i,structure:p,event:n}))==null?void 0:v.tieFormat;if(l.tieFormat&&y){let{matchUpCountDifference:I,descendantDifferences:b,ancestorDifferences:S,valueDifference:w}=Mu({descendant:l.tieFormat,ancestor:y});if(b.collectionIds.length===1&&!S.collectionIds.length&&!S.groupsCount&&I===1&&w===1){let U=ex({tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n});if(U.error)return U}}}return{...X}}function p4(t){let e=ze(t,[{[Fn]:!0,[Hc]:!0},{[Lf]:{[jy]:!1,roundNumbers:!1},[zz]:"At least one must be provided",[Jn]:cn}]);if(e.error)return e;let i=y3(t);if(i.error)return i;let{matchUpIds:r}=i,n=Yi(Ta)(t.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=t;for(let l of r){if(n){let c=tx({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(c.error||t.removeAssignments&&Zk({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return c}let u=_b({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(u.error)return u;if(t.removeAssignments){let c=Wk({...t,matchUpId:l});if(c.error)return c}}return{...X}}function Fme({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){var y;if(!e)return{error:Le};let r="setOrderOfFinish";if(!Array.isArray(i))return ee({info:Bd("finishingOrder"),result:{error:se},stack:r});let{completedMatchUps:n,matchUpsMap:a}=jg({inContext:!0,drawDefinition:e}),o=(n==null?void 0:n.map(Dr))??[],s=i.map(Dr),{matchUpTypes:l,roundNumbers:u,structureIds:c,matchUpTieIds:d}=(n??[]).filter(({matchUpId:I})=>s.includes(I)).reduce((I,b)=>{let{matchUpTieId:S,matchUpType:w,roundNumber:U,structureId:T}=b;return I.matchUpTypes.includes(w)||I.matchUpTypes.push(w),I.roundNumbers.includes(U)||I.roundNumbers.push(U),I.structureIds.includes(T)||I.structureIds.push(T),I.matchUpTieIds.includes(S)||I.matchUpTieIds.push(S),I},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||u.length>1||c.length>1)return ee({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:se},stack:r});let p,m,h={},f=[],g=[];if(!i.every(({orderOfFinish:I,matchUpId:b})=>(f.push(b),I&&g.push(I),h[b]=I,p=o.includes(b),m=I===void 0||ot(I)&&Math.floor(I)>0,p&&m)))return ee({result:{error:p?se:Cg},info:!p&&"matchUps must be completed"||!m&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let v=n==null?void 0:n.filter(I=>I.structureId===c[0]&&I.roundNumber===u[0]&&I.matchUpType===l[0]&&I.matchUpTieId===d[0]&&!f.includes(I.matchUpId));for(let I of v??[]){let{orderOfFinish:b}=I||{};if(b){if(!ot(b))return ee({context:{orderOfFinish:b,matchUp:I},result:{error:se},stack:r});g.push(b)}}if(fG(g).length!==g.length||Math.max(...g)>g.length)return ee({info:"Values not unique or greater than expected number of values",result:{error:se},stack:r});if(c.length){let I=LT({matchUpFilters:{matchUpIds:s},structureId:c[0],drawDefinition:e,matchUpsMap:a});if(I.error)return ee({result:I,stack:r});(y=I.completedMatchUps)==null||y.forEach(b=>{b.orderOfFinish=h[b.matchUpId],Rt({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:b})})}return{...X}}function m4(t){return Fme(t)}function h4(t){var v,y,I,b;let{tournamentRecord:e,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=t,o="applyLineUps",s=ze(t,[{[wr]:!0,[Fn]:!0,[Il]:!0},{lineUps:!0,[Jn]:cn}],o);if(s.error)return s;let l=e.participants||[],u=Ui({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:r});if(u.error)return u;if(!u.matchUp)return{error:pn};let{matchUp:c,structure:d}=u,{drawPositions:p,matchUpType:m}=c;if(m!==fi)return{error:oa};if(!(p!=null&&p.length))return{error:My};let h=(v=vn({matchUp:c,drawDefinition:i,structure:d,event:a}))==null?void 0:v.tieFormat,f={};for(let S of n){if(!Array.isArray(S))return{error:se,lineUp:S};let w={},U=[];for(let R of S){if(typeof R!="object")return{error:se,lineUpAssignment:R};let{participantId:N,collectionAssignments:A=[]}=R;if(!Array.isArray(A))return{error:se,collectionAssignments:A};let M=l.find(O=>O.participantId===N);if(!M)return{error:zi};if(M.participantType!==St)return{error:Cs};let C=(I=(y=c.sides)==null?void 0:y.find(O=>{var k,x;return(x=(k=O.participant)==null?void 0:k.individualParticipantIds)==null?void 0:x.includes(N)}))==null?void 0:I.sideNumber;C&&U.push(C);for(let O of A){if(typeof O!="object")return{error:se,collectionAssignment:O};let{collectionId:k,collectionPosition:x}=O,F=(b=h==null?void 0:h.collectionDefinitions)==null?void 0:b.find(L=>L.collectionId===k);if(!F)return{error:se,collectionId:k};let $=`${k}-${x}`;w[$]||(w[$]=[]);let _=w[$].length;if(Yi(ii)(F.matchUpType)&&_||F.matchUpType===Zt&&_>1)return{info:"Excessive collectionPosition assignments",error:se};w[$].push(N)}}let T=Object.values(w);for(let R of T)if(R.length===2){let{participant:N}=rs({tournamentParticipants:l,participantIds:R});if(!N){let A=ll({participant:{participantType:ft,participantRole:Qr,individualParticipantIds:R},pairOverride:!0,tournamentRecord:e});if(A.error)return A}}let D=Ua(U),P=(D[1]||0)>(D[2]||0)&&1||(D[2]||0)>(D[1]||0)&&2||void 0,E=Object.keys(f).map(R=>parseInt(R));P&&!E.includes(P)&&(f[P]=S)}if(!Object.keys(f).length)return{error:AN};if(u=Ui({drawDefinition:i,matchUpId:r}),u.error)return u;if(!u.matchUp)return{error:pn};let{matchUp:g}=u;g.sides||(g.sides=[]);for(let S of[1,2]){let w=g.sides.find(T=>T.sideNumber===S),U=f[S];if(U)w?w.lineUp=U:g.sides.push({lineUp:U,sideNumber:S});else continue}return Rt({tournamentId:e==null?void 0:e.tournamentId,context:o,drawDefinition:i,matchUp:g}),{...X}}var ix={};bt(ix,{anonymizeTournamentRecord:()=>F4,generate:()=>f4,generateEventWithDraw:()=>BD,generateOutcome:()=>cx,generateOutcomeFromScoreString:()=>rx,generateParticipants:()=>rv,generateTournamentRecord:()=>k4,modifyTournamentRecord:()=>L4,mutate:()=>x4});var f4={};bt(f4,{generateEventWithDraw:()=>BD,generateOutcome:()=>cx,generateOutcomeFromScoreString:()=>rx,generateParticipants:()=>rv,generateTournamentRecord:()=>k4});function rx(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n}=t;if(!n)return{outcome:{...qT,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:se,winningSide:r};let a=n&&_S({scoreString:n}),o={},s=Ol({sets:a,matchUpFormat:e}),l=Ol({sets:a,reversed:!0,matchUpFormat:e});return r===2?(o.scoreStringSide1=l,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=l),o.sets=_S({scoreString:o.scoreStringSide1}),je({outcome:{matchUpStatus:i,winningSide:r,score:o}})}function nx({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){var a;let n=(((a=e==null?void 0:e[r.matchUpId])==null?void 0:a.matchUpIds)||[]).filter(o=>i.includes(o)).filter(o=>!t[o]);return{dependenciesScheduled:!(n!=null&&n.length),remainingDependencies:n}}function Bb({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function Lme({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function zI({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var h,f;let u=wi((h=l==null?void 0:l.schedule)==null?void 0:h.endTime),c=u?ra(u,et(o)):ra(s,et(r)+et(o)),d=i&&(u?ra(wi(u),i):ra(s,et(r)+et(i))),p=((f=a==null?void 0:a[l.matchUpId])==null?void 0:f.participantIds)||[],m=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(g=>{Bb({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&d||c;m.includes(g)?Lme({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),Yf({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:c,matchUp:l})}function g4({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){var c,d,p,m,h;let a,o=(d=(c=n.minutesMap)==null?void 0:c[r])==null?void 0:d.recoveryMinutes,s=(((m=(p=n.minutesMap)==null?void 0:p[r])==null?void 0:m.averageMinutes)||0)+(o||0),l=ra(i,s),u=((h=e==null?void 0:e[r])==null?void 0:h.dependentMatchUpIds)||[];if(u.length){let f=u.reduce((g,v)=>{let y=t[v];if(!y)return g;let I={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||Ot(y)<Ot(g.scheduleTime)?I:g},{});f.scheduleTime&&Ot(l)>Ot(f.scheduleTime)&&(a=f)}return{scheduledDependent:a}}function _me(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>{var n;return i===Zt&&(((n=r==null?void 0:r.participant)==null?void 0:n.individualParticipants)||[])||(r==null?void 0:r.participant)&&[r.participant]||[]}).flat()}var Vb="DO_NOT_SCHEDULE",$me={DO_NOT_SCHEDULE:Vb};function ax({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:o}){let s=_me(o).map(({person:m})=>m==null?void 0:m.personId);if(i){let m=((o==null?void 0:o.potentialParticipants)||[]).flat().map(({person:h})=>h==null?void 0:h.personId);s.push(...m)}let l=s.map(m=>{var h;return(h=r[m])==null?void 0:h.map(f=>({...f,personId:m}))}).filter(Boolean).flat().filter(m=>m.requestType===Vb&&jl(a,m.date)),u=[],c=o==null?void 0:o.matchUpId,d=rr(wi(n),mt(a)),p=wi(HN(d,t).toISOString());for(let m of l){let{requestId:h,startTime:f,endTime:g}=m;(n>f&&n<g||p>f&&p<g)&&(u.push({matchUpId:c,request:m,scheduleTime:n}),e[h]?(e[h].scheduleTimes.includes(n)||e[h].scheduleTimes.push(n),e[h].matchUpIds.includes(c)||e[h].matchUpIds.push(c)):e[h]={request:m,scheduleTimes:[n],matchUpIds:[c]})}return{conflicts:u}}function u1({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=RT(i),o=(t[i.matchUpId]||[]).filter(s=>!Rn(s,a)).flat();[...a,...o].forEach(s=>{if(Bb({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[Ho]?l[Ho]+=r:r>0&&(l[Ho]=r),o.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function Bme({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){var f,g;let p=[];i||(n=d==null?void 0:d.filter(v=>{let y=v.schedule||{},I=v.matchUpStatus===Vt;return I&&p.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!I&&Ob({schedule:y})&&(!u||v.schedule.scheduledDate===u)}),i=n.map(Dr));let m=Array.isArray(l)?l.includes(u):l,h=m?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of h){u1({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(f=v.schedule)==null?void 0:f.scheduledTime;if(y){o[v.matchUpId]=y;let I=(g=c==null?void 0:c[v.matchUpId])==null?void 0:g.recoveryMinutes;zI({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:r,recoveryMinutes:I,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:m}}function FD({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:o,matchUps:s}){if(typeof r!="object")return{error:Oi};if(!So(s)&&!Array.isArray(i))return{error:Gu};a=a??CD({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:m}=Jy({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:m}}})).flat()),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return Ob({schedule:p})&&(!o||d.schedule.scheduledDate===o)}));let c=i==null?void 0:i.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!==Vt);return{bookings:c==null?void 0:c.map(({eventId:d,schedule:p,matchUpFormat:m})=>{let{event:h,scheduleTiming:f}=l[d],g=h==null?void 0:h.eventType,v={...f,defaultTiming:u,matchUpFormat:m},{averageMinutes:y,recoveryMinutes:I}=OT({timingDetails:v,eventType:g}),{courtId:b,venueId:S}=p,w=wi(p.scheduledTime),U=ra(w,y);return{recoveryMinutes:I,averageMinutes:y,periodLength:a,startTime:w,courtId:b,endTime:U,venueId:S}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function Vme({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),typeof a!="object"||!Object.keys(a).length)return{error:Oi};s=s??CD({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:m,venues:h}=Ju({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),f=(m==null?void 0:m.filter(S=>!c||c.includes(S.venueId)))??[];u=u??Kf({courts:f,scheduleDate:l,startTime:!0}),p=p??Kf({courts:f,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=FD({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:c,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:s,startTime:u,bookings:g,endTime:p,courts:f},{scheduleTimes:I}=Vk(y),b=(c==null?void 0:c.length)===1&&c[0]||(h==null?void 0:h.length)===1&&h[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(Da("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:I,venueId:b}}function jme({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,o,s,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(n=n.concat(u.matchUpIds)),u.hash!==l&&!i&&(l=u.hash,r.push({averageMinutes:s,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:n}),n=u.matchUpIds),s=i?e:u.averageMinutes,o=u.recoveryMinutes,a=u.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:o,averageMinutes:s}),{groupedRounds:r}}function v4({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:m,venues:h}){var I;let f={},g=[],v=[],y=[];for(let b of h){let{rounds:S=[],venueId:w}=b,{scheduledRoundsDetails:U,greatestAverageMinutes:T,orderedMatchUpIds:D,minutesMap:P}=Nb({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:u,matchUps:p,rounds:S});y.push(...D??[]);let{groupedRounds:E}=jme({scheduledRoundsDetails:U,greatestAverageMinutes:T,garmanSinglePass:!0}),R,N=[];d&&({scheduleTimes:N,dateScheduledMatchUpIds:R}=Vme({averageMatchUpMinutes:(I=E[0])==null?void 0:I.averageMinutes,scheduleDate:mt(c),venueIds:[b.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:u,matchUps:p}));let A=Bme({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:R,greatestAverageMinutes:T,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:c,minutesMap:P,matchUps:p});({dateScheduledMatchUpIds:R}=A);let M=A,{byeScheduledMatchUpDetails:C,clearDate:O}=A;C!=null&&C.length&&v.push(...C);let{matchUpsToSchedule:k,matchUpMap:x}=hD({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:R,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:D,clearDate:O,matchUps:p}),F=m.filter($=>$.venueId===w);f[w]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:T,scheduledRoundsDetails:U,dateScheduledMatchUps:M,matchUpsToSchedule:k,scheduleTimes:N,groupedRounds:E,venueCourts:F,minutesMap:P,matchUpMap:x},s||g.push(...R)}return{allDateScheduledByeMatchUpDetails:v,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:f,allDateMatchUpIds:y}}function Gme(t,e){let i=Ot(t.scheduleTime),r=Ot(t.timeAfterRecovery),n=Ot(e.scheduleTime),a=Ot(e.timeAfterRecovery),o=i===n||r===a,s=i>n&&i<a,l=n>i&&n<r,u=r>n&&r<a,c=a>i&&a<r;return je({hasOverlap:o||s||u||l||c,startAisContained:s,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function ox({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){var p,m,h,f,g;let o=(((p=i==null?void 0:i[n.matchUpId])==null?void 0:p.participantIds)||[]).flat(),s=((h=(m=a==null?void 0:a.minutesMap)==null?void 0:m[n.matchUpId])==null?void 0:h.averageMinutes)||0,l=((g=(f=a==null?void 0:a.minutesMap)==null?void 0:f[n.matchUpId])==null?void 0:g.recoveryMinutes)||0,u=o.every(v=>{var S;Bb({individualParticipantProfiles:t,participantId:v});let y=t[v];if(!y.timeAfterRecovery)return!0;let I=wi((S=n==null?void 0:n.schedule)==null?void 0:S.endTime),b=I?ra(I,et(l)):ra(r,et(s)+et(l));return![...Object.keys(y.potentialBookings).filter(w=>w!==n.drawId).map(w=>y.potentialBookings[w]).flat(),...y.bookings].find(w=>Gme({scheduleTime:r,timeAfterRecovery:b},w).hasOverlap)}),c=e[n.matchUpId],d=(c?Fy(rr(c),rr(r),!1):0)>=0;return{enoughTime:u&&d}}function I4({autoSchedulingAudit:t,tournamentRecords:e}){var o;lt({topic:gu,payload:t});let i=s=>s?Object.values(s).reduce((l,u)=>l+u.length||0,0):0,r=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((u,c)=>u+c.rounds.length,0),0),n={scheduledDatesCount:(o=t.scheduledDates)==null?void 0:o.length,noTimeMatchUpIdsCount:i(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:i(t==null?void 0:t.requestConflicts),profileRoundsCount:r},a={itemType:a1,itemValue:n};for(let s of Object.values(e)){let l=s.tournamentId;eT(gu)?lt({payload:{type:a1,tournamentId:l,detail:n},topic:gu}):Db({tournamentRecord:s,timeItem:a})}}function sx({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=RT(r),{matchUpId:a,matchUpType:o}=r,s=(r.roundPosition&&t[a]||[]).flat(),l=ct(n.concat(...s));return l.forEach(u=>{Bb({individualParticipantProfiles:e,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=e[u];if(c)return[o,Ho].find(d=>{var h;let p=((h=c.counters)==null?void 0:h[d])||0,m=i[d]||0;return p&&m&&p>=m})}),relevantParticipantIds:l}}function WI({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:u,schedule:c}){var g,v,y;if(!s)return{error:ge};if(!l&&(!u||!Array.isArray(u)))return{error:Wm};if(!l&&(!c||typeof c!="object"))return{error:IH};let d,p=[],m=0;if(r&&!n){let I=ps({tournamentRecords:o,tournamentRecord:s});n=I.matchUpDependencies,d=I.matchUps}d||(d=((g=Vr({tournamentRecord:s}))==null?void 0:g.matchUps)??[]);let h=d.reduce((I,b)=>{let{matchUpId:S,drawId:w,matchUpStatus:U}=b;return(e||U!==Vt)&&(t||!vr.includes(U))&&(I[w]?I[w].push(S):I[w]=[S]),I},{}),f=l==null?void 0:l.map(I=>I.matchUpId);for(let I of Object.keys(h)){let{drawDefinition:b}=Xc({tournamentRecord:s,drawId:I});if(!b)continue;let S=h[I].filter(U=>(u==null?void 0:u.includes(U))??(f==null?void 0:f.includes(U))),w=Sn({inContext:!1,drawDefinition:b}).matchUps;for(let U of S){let T=((v=l==null?void 0:l.find(P=>P.matchUpId===U))==null?void 0:v.schedule)||c,D=xD({schedule:T,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:o,tournamentRecord:s,checkChronology:r,drawDefinition:b,drawMatchUps:w,matchUpId:U});if((y=D==null?void 0:D.warnings)!=null&&y.length&&p.push(...D.warnings),D!=null&&D.success&&(m+=1),D.error)return D}}return p.length?{...X,scheduled:m,warnings:p}:{...X,scheduled:m}}function jb(t){var h;let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:o,checkChronology:s,matchUpDetails:l,schedule:u}=t;if(t.matchUpIds&&!n)return WI(t);let c=ze(t,[{[mn]:!0},{[Lf]:{matchUpContextIds:!1,matchUpDetails:!1},[$a]:se,[Jn]:cn}]);if(c.error)return c;if((!l||n)&&!u)return{error:Xe,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:m}=ps({tournamentRecords:o});for(let f of Object.values(o)){let{tournamentId:g}=f,v=n==null?void 0:n.filter(I=>I.tournamentId===g).map(Dr),y=l==null?void 0:l.filter(I=>(I==null?void 0:I.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let I=WI({matchUpDetails:y,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:m,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:o,tournamentRecord:f,checkChronology:s,matchUpIds:v,schedule:u});if((h=I.warnings)!=null&&h.length&&d.push(...I.warnings),I.scheduled&&(p+=I.scheduled),I.error)return I}}return d.length?{...X,scheduled:p,warnings:d}:{...X,scheduled:p}}function Hme({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:m,courts:h,dryRun:f}){var R,N,A,M,C,O,k;let g={},v={},y={},I={},b={},S={},w={},U={},T={},D={};for(let x of n){let F=mt(x==null?void 0:x.scheduleDate),$=(x==null?void 0:x.venues)||[],_={},L={},B=(J,H)=>{J.forEach(Z=>{let K=L[Z].counters;K[H]?K[H]+=1:K[H]=1,K[Ho]?K[Ho]+=1:K[Ho]=1})};y[F]={},I[F]={},g[F]={},v[F]={},w[F]=[],U[F]=[],T[F]=[],D[F]=[];let V={};m.forEach(J=>{var H;(H=J.schedule)!=null&&H.scheduledDate&&jl(F,mt(J.schedule.scheduledDate))&&Yf({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:V,matchUp:J})});let{allDateScheduledByeMatchUpDetails:G,venueScheduledRoundDetails:j,allDateMatchUpIds:z}=v4({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:V,matchUpScheduleTimes:S,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:F,matchUps:m,courts:h,venues:$}),W=10,q=0,Y,re=10;for(;!Y;){for(let{venueId:J}of $){let H=0,Z=j[J];for(;Z.courtsCount&&((R=Z.scheduleTimes)!=null&&R.length)&&((N=Z.matchUpsToSchedule)!=null&&N.length)&&H<=Z.courtsCount;){let{scheduleTime:K,attempts:ie=0}=Z.scheduleTimes.shift(),ae=Z.matchUpsToSchedule.find(oe=>{var Fe,Se;let{matchUpId:ne,matchUpType:de}=oe,{participantIdsAtLimit:ye,relevantParticipantIds:ce}=sx({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpDailyLimits:s,matchUp:oe});if(ye.length)return U[F].includes(ne)||U[F].push(ne),!1;let{scheduledDependent:ke}=g4({matchUpScheduleTimes:S,matchUpDependencies:o,scheduleTime:K,matchUpId:ne,details:Z});if(ke)return!1;let{dependenciesScheduled:we,remainingDependencies:Ze}=nx({matchUpScheduleTimes:S,matchUpDependencies:o,allDateMatchUpIds:z,matchUp:oe});if(!we)return I[F][ne]||(I[F][ne]=[]),I[F][ne].push({scheduleTime:K,remainingDependencies:Ze}),!1;let{enoughTime:pt}=ox({individualParticipantProfiles:L,matchUpNotBeforeTimes:V,matchUpDependencies:o,scheduleTime:K,details:Z,matchUp:oe});if(!pt)return y[F][ne]||(y[F][ne]=[]),y[F][ne].push({scheduleTime:K}),!1;let he=Z.greatestAverageMinutes,{conflicts:fe}=ax({potentials:e,averageMatchUpMinutes:he,requestConflicts:D,personRequests:d,scheduleTime:K,scheduleDate:F,matchUp:oe});if(fe!=null&&fe.length)return b[F]||(b[F]=[]),b[F].push(...fe),!1;B(ce,de);let pe=(Se=(Fe=Z.minutesMap)==null?void 0:Fe[ne])==null?void 0:Se.recoveryMinutes;return zI({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpNotBeforeTimes:V,averageMatchUpMinutes:he,matchUpDependencies:o,recoveryMinutes:pe,scheduleTime:K,matchUp:oe}),S[ne]=K,!0});Z.matchUpsToSchedule=Z.matchUpsToSchedule.filter(({matchUpId:oe})=>oe!==(ae==null?void 0:ae.matchUpId)),ae?H+=1:(v[F][J]||(v[F][J]=[]),v[F][J].push({scheduleTime:K,attempts:ie+1}))}(A=Z.matchUpsToSchedule)!=null&&A.length&&(v[F][J]=(M=v[F][J])==null?void 0:M.filter(K=>{let ie=K.attempts<W;return ie&&Z.scheduleTimes.push(K),!ie})),(!((C=Z.scheduleTimes)!=null&&C.length)||!((O=Z.matchUpsToSchedule)!=null&&O.length))&&(Z.complete=!0)}q+=1,Y=$.every(({venueId:J})=>j[J].complete)||q===re}for(let{venueId:J}of $){let H=j[J].matchUpMap;Object.keys(H).forEach(Z=>{let K=u[Z];K&&Object.keys(H[Z]).forEach(ie=>{let{drawDefinition:ae}=Xc({tournamentRecord:K,drawId:ie});ae&&H[Z][ie].forEach(({matchUpId:oe})=>{let ne=S[oe];if(ne){let de=ne.split(":").map(oo).join(":"),ye=`${mt(F)}T${de}`;f?w[F].push(oe):(Qc({drawDefinition:ae,scheduledTime:ye,matchUpId:oe}).success&&w[F].push(oe),J&&iv({tournamentRecord:K,drawDefinition:ae,matchUpId:oe,venueId:J}))}})})}),T[F]=j[J].matchUpsToSchedule.map(Dr),g[F][J]=j[J].scheduleTimes.sort((Z,K)=>Ot(Z.scheduleTime)-Ot(K.scheduleTime))}!f&&(G!=null&&G.length)&&jb({matchUpDetails:G,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let J of x.venues)for(let H of J.rounds){let Z=(((k=H.matchUps)==null?void 0:k.map(({matchUpId:ie})=>ie))||[]).filter(ie=>w[F].includes(ie));H.canScheduledMatchUpIds=Z;let K=Math.round(Z.length/H.matchUpsCount*1e4)/100;(K===1/0||isNaN(K))&&(K=0),H.possibleToSchedulePct=K,H.matchUpsCount===Z.length&&(H.possibleToSchedule=!0)}}let P=n.map(({scheduleDate:x})=>x),E={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:w,schedulingProfile:c,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:P};return I4({tournamentRecords:u,autoSchedulingAudit:E}),{...X,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:v,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:S,overLimitMatchUpIds:U,scheduledMatchUpIds:w,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:P}}function gV({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Xe,stack:"getEarliestCourtTime"};let a=Kf({scheduleDate:n,courts:[r],startTime:!0}),o=Kf({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||o;let s=Lb({court:r,date:n}),{timeSlots:l}=ev({courtDate:s}),u=rr(e),c=rr(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let m=rr(p.startTime),h=rr(p.endTime);if(m>c||h<u)return d;let f=u>m?u:m;if(Fy(f,h)>=t){let g=wi(f.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:o}}function zme({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:m=[],courts:h,dryRun:f}){var E,R;let g={},v={},y={},I={},b={},S={},w={},U={},T={};for(let N of n??[]){let A=mt(N==null?void 0:N.scheduleDate),M=(N==null?void 0:N.venues)||[],C={},O={},k=(J,H)=>{J.forEach(Z=>{let K=O[Z].counters;K[H]?K[H]+=1:K[H]=1,K[Ho]?K[Ho]+=1:K[Ho]=1})};g[A]={},v[A]={},S[A]=[],w[A]=[],U[A]=[],T[A]=[];let x={};m==null||m.forEach(J=>{var H;(H=J.schedule)!=null&&H.scheduledDate&&jl(A,mt(J.schedule.scheduledDate))&&Yf({matchUpPotentialParticipantIds:C,matchUpNotBeforeTimes:x,matchUp:J})});let{allDateScheduledByeMatchUpDetails:F,allDateScheduledMatchUpIds:$,venueScheduledRoundDetails:_,allDateMatchUpIds:L}=v4({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:x,matchUpScheduleTimes:b,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:A,matchUps:m,courts:h,venues:M}),B=m==null?void 0:m.filter(({matchUpId:J})=>$.includes(J)),{bookings:V}=FD({dateScheduledMatchUps:B,tournamentRecords:u,scheduleDate:A,periodLength:c}),{virtualCourts:G}=ED({scheduleDate:A,periodLength:c,bookings:V,courts:h}),j=G==null?void 0:G.reduce((J,H)=>{let{earliestCourtTime:Z,courtEndTime:K}=gV({date:A,averageMinutes:0,court:H});return(!J.startTime||rr(Z)<rr(J.startTime))&&(J.startTime=Z),(!J.endTime||rr(K)>rr(J.endTime))&&(J.endTime=K),J},{}),z=j.startTime,W=({courtId:J,booking:H})=>{var Z;return(Z=G==null?void 0:G.find(K=>K.courtId===J))==null?void 0:Z.dateAvailability[0].bookings.push(H)},q=10,Y=0,re;for(;!re;){for(let{venueId:J}of M){let H=_[J],Z=H.matchUpsToSchedule.length,K=[],ie=[],ae,oe=0;for(;!ae;){for(let ne of H.matchUpsToSchedule){if(ie.length===H.courtsCount||K.length===H.courtsCount){ae=!0;break}let{matchUpId:de,matchUpType:ye}=ne,{participantIdsAtLimit:ce,relevantParticipantIds:ke}=sx({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,matchUpDailyLimits:s,matchUp:ne});if(ce.length){w[A].includes(de)||w[A].push(de);continue}let{dependenciesScheduled:we,remainingDependencies:Ze}=nx({matchUpScheduleTimes:b,matchUpDependencies:o,allDateMatchUpIds:L,matchUp:ne});if(!we){v[A][de]||(v[A][de]=[]),v[A][de].push({remainingDependencies:Ze});continue}let pt=[],he=G==null?void 0:G.reduce((fe,pe)=>{var $e,Ee,Be,xe;if(ie.includes(pe.courtId))return fe;let{earliestCourtTime:Fe}=gV({averageMinutes:H.greatestAverageMinutes,startTime:z,date:A,court:pe});if(fe.scheduleTime&&Ot(Fe)>=Ot(fe.scheduleTime))return fe;let{scheduledDependent:Se}=g4({matchUpScheduleTimes:b,matchUpDependencies:o,scheduleTime:Fe,matchUpId:de,details:H});if(Se)return fe;let{enoughTime:He}=ox({individualParticipantProfiles:O,matchUpNotBeforeTimes:x,matchUpDependencies:o,scheduleTime:Fe,details:H,matchUp:ne});if(!He)return g[A][de]||(g[A][de]=[]),g[A][de].includes(Fe)||g[A][de].push(Fe),fe;let ue=((Ee=($e=H.minutesMap)==null?void 0:$e[de])==null?void 0:Ee.averageMinutes)||H.greatestAverageMinutes,{conflicts:me}=ax({potentials:e,averageMatchUpMinutes:ue,requestConflicts:T,personRequests:p,scheduleTime:Fe,scheduleDate:A,matchUp:ne});if(me!=null&&me.length)return pt.push(...me),!1;k(ke,ye);let Ue=(xe=(Be=H.minutesMap)==null?void 0:Be[de])==null?void 0:xe.recoveryMinutes;return zI({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,matchUpNotBeforeTimes:x,averageMatchUpMinutes:ue,matchUpDependencies:o,recoveryMinutes:Ue,scheduleTime:Fe,matchUp:ne}),(!fe.scheduleTime||Ot(Fe)<Ot(fe.scheduleTime))&&(fe.averageMatchUpMinutes=ue,fe.recoveryMinutes=Ue,fe.scheduleTime=Fe,fe.courtName=pe.courtName,fe.courtId=pe.courtId),fe},{});if(he.scheduleTime){let{averageMatchUpMinutes:fe,recoveryMinutes:pe,scheduleTime:Fe,courtId:Se}=he;b[de]=Fe,I[de]=Se,K.push(de),ie.push(Se);let He=Fe,ue=ra(He,fe);W({courtId:Se,booking:{averageMatchUpMinutes:fe,recoveryMinutes:pe,periodLength:c,matchUpId:de,startTime:He,courtId:Se,endTime:ue,venueId:J}}),H.matchUpsToSchedule=H.matchUpsToSchedule.filter(me=>me.matchUpId!==de)}else pt!=null&&pt.length&&(y[A]||(y[A]=[]),y[A].push(...pt))}(ie.length===H.courtsCount||K.length===H.courtsCount||!H.matchUpsToSchedule.length)&&(ae=!0),H.matchUpsToSchedule.length&&K<H.courtsCount&&(rr(z)<rr(j.endTime)?z=ra(z,c):(ae=!0,H.complete=!0)),oe+=1,!ae&&oe>=Z&&(ae=!0)}(E=H.matchUpsToSchedule)!=null&&E.length||(H.complete=!0)}Y+=1,re=M.every(({venueId:J})=>_[J].complete)||Y===q}for(let{venueId:J}of M){let H=_[J].matchUpMap;Object.keys(H).forEach(Z=>{let K=u[Z];K&&Object.keys(H[Z]).forEach(ie=>{let{drawDefinition:ae}=Xc({tournamentRecord:K,drawId:ie});ae&&H[Z][ie].forEach(({matchUpId:oe})=>{let ne=b[oe],de=I[oe];if(ne){let ye=ne.split(":").map(oo).join(":"),ce=`${mt(A)}T${ye}`;f||(Qc({drawDefinition:ae,scheduledTime:ce,matchUpId:oe}),yh({courtDayDate:A,tournamentRecords:u,tournamentRecord:K,drawDefinition:ae,matchUpId:oe,courtId:de})),S[A].push(oe)}})})}),U[A]=_[J].matchUpsToSchedule.map(Dr)}!f&&(F!=null&&F.length)&&jb({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let J of N.venues)for(let H of J.rounds){let Z=(R=(H.matchUps??[]).map(({matchUpId:ie})=>ie))==null?void 0:R.filter(ie=>S[A].includes(ie));H.canScheduledMatchUpIds=Z;let K=Math.round(((Z==null?void 0:Z.length)||0)/H.matchUpsCount*1e4)/100;(K===1/0||isNaN(K))&&(K=void 0),H.possibleToSchedulePct=K,H.matchUpsCount===(Z==null?void 0:Z.length)&&(H.possibleToSchedule=!0)}}let D=(n??[]).map(({scheduleDate:N})=>N),P={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:S,schedulingProfile:d,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:D};return I4({tournamentRecords:u,autoSchedulingAudit:P}),{...X,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:v,matchUpScheduleTimes:b,overLimitMatchUpIds:w,scheduledMatchUpIds:S,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:D}}function LD(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=vr,scheduledDates:r,venueIds:n}=t,a=bo(t),o=Nt(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(o!=null&&o.length))return{error:Oi};let s=0;for(let l of o){let u=a[l],c=Wme({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:r,venueIds:n});if(c.error)return c;s+=c.clearedScheduleCount??0}return{...X,clearedScheduleCount:s}}function Wme({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=vr,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:ge};if(!Array.isArray(e)||!Array.isArray(n))return{error:se};n.length&&t.push("venueId");let a=Vr({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],o={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&Ob({schedule:c,scheduleAttributes:t})&&(!(n!=null&&n.length)||n.includes(c.venueId))&&(o[d]||(o[d]=[]),o[d].push(p))});let s=i.tournamentId,l=0;for(let u in o){let{event:c,drawDefinition:d}=Wn({tournamentRecord:i,drawId:u}),p=Sn({drawDefinition:d,matchUpFilters:{matchUpIds:o[u]}}).matchUps??[];for(let m of p){let h=!1;m.timeItems=(m.timeItems??[]).filter(f=>{let g=(f==null?void 0:f.itemType)&&![Wl,Ec,nh,NT,ah,oh].includes(f==null?void 0:f.itemType);return g||(h=!0),g}),h&&(Rt({context:"clear schedules",eventId:c==null?void 0:c.eventId,drawDefinition:d,tournamentId:s,matchUp:m}),l+=1)}}return{...X,clearedScheduleCount:l}}function _D(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:u}=t,c=ze(t,[{[mn]:!0},{[Kr]:D=>!D||Array.isArray(D)&&D.every(ya),[$z]:!1,[Jn]:cn}]);if(c.error)return c;let d=Xu({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...X};let{modifications:p,issues:m=[],schedulingProfile:h=[]}=d,f=Object.assign({},...Object.values(a).map(D=>Bg({tournamentRecord:D}).containedStructures)),g=n.map(D=>{if(ya(D))return mt(D)}).filter(Boolean),v=h.map(D=>D.scheduleDate).map(D=>ya(D)&&mt(D)).filter(D=>D&&(!n.length||g.includes(D)));if(!v.length)return{error:YG};if(r&&!l){let D=Array.isArray(r)?r:[];LD({tournamentRecords:a,scheduledDates:D})}let y=Ju({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:I}=As({matchUpFilters:{matchUpTypes:[ii,Zt]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:b}=ps({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:I}),{matchUpDailyLimits:S}=SD({tournamentRecords:a}),{personRequests:w}=wp({requestType:Vb,tournamentRecords:a}),U=h.filter(D=>{let P=mt(D==null?void 0:D.scheduleDate);return v.includes(P)}).sort((D,P)=>new Date(D.scheduleDate).getTime()-new Date(P.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:m,dateSchedulingProfiles:U,containedStructureIds:f,matchUpDependencies:b,matchUpDailyLimits:S,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:h,personRequests:w,periodLength:o,useGarman:s,matchUps:I,dryRun:l,courts:y};return u?zme(T):Hme(T)}function $D(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};return n.tournamentId||(n.tournamentId=Gt()),n.startDate&&!Nd(n.startDate)&&!mS.test(n.startDate)?{error:Ar}:n.endDate&&!Nd(n.endDate)&&!mS.test(n.endDate)?{error:Ar}:(n.extensions&&(n.extensions=n.extensions.filter(al)),{...n})}function lx({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:o}){var h,f;if(!i)return{error:ge};let s={},l=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===St&&v===Qr),u=0;for(let g of l){let v=a&&((h=em({element:g,accessor:a}))==null?void 0:h.value)||r&&((f=g.person)==null?void 0:f[r])||e&&g[e];if(v){if(!Object.keys(s).includes(v)){s[v]={participantName:(n==null?void 0:n[u])??v,participantId:(o==null?void 0:o.pop())??Gt(),individualParticipantIds:[],participantRole:Qr,participantType:Kt};let y={value:r??e,name:CC};Lt({element:s[v],extension:y}),u+=1}s[v].individualParticipantIds.push(g.participantId)}}let c=Object.keys(s),d=(i.participants??[]).map(g=>{if(g.participantType!==Kt||g.participantRole!==Qr)return;let{extension:v}=vt({name:CC,element:g}),y=v==null?void 0:v.value;if(c.includes(y))return g.participantId}).filter(Boolean),p=0,m=[];return Object.keys(s).forEach(g=>{let v=s[g],{participantId:y}=v;d.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),m.push(v),p++)}),t&&p?(lt({payload:{tournamentId:i.tournamentId,participants:m},topic:Dc}),{...X,participantsAdded:p}):m.length?{...X,newParticipants:m}:{error:Lne}}var qme=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],Yme=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function y4({count:t=1,participantsCount:e=32}={}){let i=wn(Yme),r=i.slice(0,t);return{cities:Te(0,e).map(n=>n<Math.min(t,i.length)?r[n]:ma(r))}}function b4({count:t=1,participantsCount:e=32}={}){let i=wn(qme),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:Te(0,e).map(n=>n<Math.min(t,i.length)?r[n]:ma(r))}}function w4({count:t=1,participantsCount:e=32}={}){let i=Te(0,t).map(()=>Te(0,5).map(()=>ro(0,9)).join(""));return{postalCodes:Te(0,e).map(r=>r<t?i[r]:ma(i))}}function jS({idPrefix:t,participantType:e,index:i,uuids:r}){let n=Di(e)?e[0]:"X";return t?`${t}-${n}-${i}`:(r==null?void 0:r.pop())||Gt()}function U4(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r==null?void 0:r[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:n}}var Kme={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function UE(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![Xt,mi].includes(i))return{personData:[],error:se};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:o}=Kme,s=Zp.map(({iso:f})=>f).filter(Boolean),l=Math.ceil(r/n.length),u=Math.ceil(r/a.length),c=Math.ceil(r/o.length),d=Te(0,l).flatMap(()=>{let f=Ce(n,!1,!0);return Te(0,n.length).map(()=>ga(f))}),p=Te(0,u).flatMap(()=>{let f=Ce(a,!1,!0);return Te(0,a.length).map(()=>ga(f))}),m=Te(0,c).flatMap(()=>{let f=Ce(o,!1,!0);return Te(0,o.length).map(()=>ga(f))}),h={};for(let f=0;f<r;f++){let g=d.pop(),v=i||ma([Xt,mi]),y=v===Xt?m.pop():p.pop(),I=ma(s);h[`${y}${g}`]={nationalityCode:I,sex:v,firstName:y,lastName:g}}return{personData:Object.values(h).slice(0,e)}}function S4(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:o,category:s,sex:l}=t||{};if(isNaN(e))return{error:se};let u=(a==null?void 0:a[Xt])||l===Xt&&e||0,c=(a==null?void 0:a[mi])||l===mi&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&UE({count:u,sex:Xt}).personData||[],m=c&&UE({count:c,sex:mi}).personData||[],h=[...p,...m,...d&&UE({count:d}).personData||[]],f=h.filter(T=>!l||u&&c||T.sex===l),g=[];if(Array.isArray(o)){let T=o.filter(D=>typeof D.firstName!="string"||typeof D.lastName!="string"||D.sex&&![Xt,mi].includes(D.sex)||D.nationalityCode&&(typeof D.nationalityCode!="string"||D.nationalityCode.length>3||!Zp.find(({iso:P,ioc:E})=>[P,E].includes(D.nationalityCode)))?!1:(D.nationalityCode&&g.push(D.nationalityCode),!0));if(T.length)f=T;else return{error:se}}let v=o?f:wn(f);if(v.length<e){let{maleFirstNames:T,maleLastNames:D,femaleFirstNames:P,femaleLastNames:E,nationalityCodes:R}=h.reduce((N,A)=>{let{firstName:M,lastName:C,nationalityCode:O}=A;return A.sex===Xt?(N.maleFirstNames.includes(M)||N.maleFirstNames.push(M),N.maleLastNames.includes(C)||N.maleLastNames.push(C)):(N.femaleFirstNames.includes(M)||N.femaleFirstNames.push(M),N.femaleLastNames.includes(C)||N.femaleLastNames.push(C)),N.nationalityCodes.includes(O)||N.nationalityCodes.push(O),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Te(0,e-v.length).forEach(()=>{let N=l||ma([Xt,mi]),A=ma(R),M=ma(N===Xt?T:P),C=ma(N===Xt?D:E),O={firstName:M,lastName:C,sex:N,nationalityCode:A};v.push(O)})}let{ageMinDate:y,ageMaxDate:I}=wm({consideredDate:r,category:s}),b=et((y==null?void 0:y.slice(0,4))||0)||et((I==null?void 0:I.slice(0,4))||0)-3,S=et((I==null?void 0:I.slice(0,4))||0)||et((y==null?void 0:y.slice(0,4))||0)+3,w=(y||I)&&[b,S],U=v.slice(0,e).map((T,D)=>{let[P,E]=w||[],R=w&&ga(Te(P,E)),N=ga(Te(0,365)),A=R&&Nae(R,N);return Object.assign(je({extensions:i||[{name:"regionCode",value:D+1}],birthDate:A,isMock:n}),T)});return{persons:U.length&&U||v[0],nationalityCodes:g}}var Jme=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function GS({nameRoot:t="TEAM",count:e=1}={}){let i=wn(Jme).slice(0,e);return i.length<e&&Te(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function rv(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=Nr,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:o,categories:s,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:m,teamSize:h=8,personIds:f,idPrefix:g,uuids:v,personExtensions:y,addressProps:I,gendersCount:b,matchUpType:S,personData:w,sex:U,inContext:T,withISO2:D,withIOC:P,scaleAllParticipants:E}=t,R=m===ft||S===Md,N=m===Kt||S===Kt;i&&(!Array.isArray(i)||!i.every(ce=>_i(ce))||i.length!==2)&&(i=void 0),e=E?p:e;let A=1e3,M=e&&e>A?e:A;i=i||[1,M],i[1]+=1;let C=p*(R&&2||N&&(h??8)||1),O=S4({count:C,personExtensions:y,consideredDate:o,gendersCount:b,personData:w,category:l,sex:U});if(O.error)return O;let{nationalityCodes:k,persons:x}=O,F={},$={},_={},L={},B=ce=>{Object.assign(F,ce.doublesRankings),Object.assign($,ce.singlesRankings),Object.assign(L,ce.doublesRatings),Object.assign(_,ce.singlesRatings)};if(Nt(l)){let ce=vV({scaledParticipantsCount:e,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:l});B(ce)}Array.isArray(s)&&s.forEach(ce=>{let ke=vV({scaledParticipantsCount:e,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:ce});B(ke)});let V=Zp.filter(ce=>c==="IOC"&&ce.ioc||ce.iso);function G(ce){let ke=Math.ceil(C/ce);return n&&ke>n?Math.ceil(C/n):ce}let{postalCodesProfile:j,postalCodesCount:z,statesProfile:W,citiesProfile:q,citiesCount:Y,statesCount:re}=I||{},J=ce=>Object.keys(ce).map(ke=>Te(0,W[ke]).map(()=>ke)).flat(),H=q&&J(q)||(I==null?void 0:I.cities)||y4({count:Y||C,participantsCount:C}).cities,Z=W&&J(W)||(I==null?void 0:I.states)||b4({count:re||C,participantsCount:C}).states,K=j&&J(j)||(I==null?void 0:I.postalCodes)||w4({count:z||C,participantsCount:C}).postalCodes,ie={cities:H,states:Z,postalCodes:K},ae=G(u),oe=ae?wn(V).slice(0,u):d&&V.filter(ce=>d.includes(ce.iso))||V,ne=wn(Te(0,Math.ceil(C/(ae||1))).map(()=>oe).flat(1/0)),de=GS({count:p}).names;return{participants:Te(0,p).map(ce=>{let ke=R&&2||N&&(h??8)||1,we=Te(0,ke).map(pe=>{let Fe=ce*ke+pe;return ye(Fe)}),Ze=we.map(pe=>pe.participantId),pt=we.map(pe=>pe.person.standardFamilyName).join("/"),he=R?ft:Kt,fe={participantId:jS({participantType:he,index:ce,idPrefix:g,uuids:v}),participantName:R?pt:de[ce],participantRole:Qr,individualParticipantIds:Ze,participantType:he};return T&&(fe.individualParticipants=we),R||N?[fe,...we]:we}).flat(),...X};function ye(ce){let ke=x[ce],{nationalityCode:we,participantExtensions:Ze,participantTimeItems:pt,extensions:he,firstName:fe,birthDate:pe,lastName:Fe,personId:Se,sex:He}=ke||{},ue=fe||"GivenName",me=Fe||"FamilyName",Ue=`${ue} ${me}`,$e=ne[ce],Ee=(k==null?void 0:k.length)&&we||$e&&(c==="IOC"?$e.ioc||$e.iso:$e.iso||$e.ioc)||we;ne!=null&&ne.length&&!Ee&&!we&&console.log("%c Invalid Nationality Code",{participantIndex:ce,country:$e});let Be=U4({...ie,participantIndex:ce,nationalityCode:Ee}),xe=je({participantId:jS({participantType:St,index:ce,idPrefix:g,uuids:v}),extensions:Ze,timeItems:pt,participantRole:Qr,participantType:St,participantName:Ue,person:{personId:Se||(f==null?void 0:f.length)&&f[ce]||Gt(),birthDate:ya(pe)?pe:void 0,addresses:[Be],standardFamilyName:me,standardGivenName:ue,nationalityCode:Ee,extensions:he,sex:He}});if(P&&Ee){let Pe=Zp.find(({iso:at})=>at===Ee);Pe!=null&&Pe.ioc&&(xe.person.iocNationalityCode=Pe.ioc),Pe!=null&&Pe.label&&(xe.person.countryName=Pe.label)}if(D&&Ee){let Pe=Zp.find(({iso:at})=>at===Ee);Pe!=null&&Pe.iso2&&(xe.person.iso2NationalityCode=Pe.iso2),Pe!=null&&Pe.label&&(xe.person.countryName=Pe.label)}let qe=Pe=>{var be,Ct,Re,Ye;let at=Pe.categoryName||Pe.ratingType||Pe.ageCategoryCode,di=(be=$[at])==null?void 0:be[ce],Ae=(Ct=F[at])==null?void 0:Ct[ce];fU({scaleValue:di,eventType:Um,scaleType:Uc,participant:xe,category:Pe}),fU({scaleValue:Ae,eventType:Uu,scaleType:Uc,participant:xe,category:Pe});let yt=(Re=_[at])==null?void 0:Re[ce],yi=(Ye=L[at])==null?void 0:Ye[ce];fU({scaleValue:yt,eventType:Um,scaleType:vc,participant:xe,category:Pe}),fU({scaleValue:yi,eventType:Uu,scaleType:vc,participant:xe,category:Pe})};return Array.isArray(s)?s.forEach(Pe=>qe(Pe)):l&&qe(l),xe}}function fU({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,o=[xd,r,i,a].join("."),s={itemValue:t,itemType:o};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function vV(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,o=e.rankingRange||t.rankingRange||[1,1e3],s={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:m}=e,h=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!m){let[f,g]=o||[];if(l[h]=wn(Te(f,g)).slice(0,i||ro(20,30)),[ft,Kt].includes(n)){let[v,y]=o||[];s[h]=wn(Te(v,y)).slice(0,i||ro(20,30))}}if(m&&r[m]){let{ratingMax:f,ratingMin:g,ratingAttributes:v}=e,y={...r[m],...v||{}},{attributes:I={},decimalsCount:b,accessors:S,range:w,step:U}=y,T=N=>{let A={},M=Object.keys(N||{});for(let C of M){let O=N[C];if(typeof O=="object"&&O.generator){let{range:k}=O,[x,F]=k.slice().sort();A[C]=ro(x,F)}else A[C]=O}return A},D=w[0]>w[1]?2:.7,[P,E]=w.slice().sort(),R=Te(0,2e3).map(()=>mG(P,E,D,U,b)).filter(N=>(!f||N<=f)&&(!g||N>=g)).slice(0,i||ro(20,30)).map(N=>S?Object.assign({},...S.map(A=>({[A]:N})),T(I)):N);u[h]=[...a,...R],[ft,Kt].includes(n)&&(c[h]=[...a,...R])}return{singlesRankings:l,doublesRankings:s,singlesRatings:u,doublesRatings:c}}function ux(t){var m,h;let{alternatesCount:e=0,tieFormatName:i,drawSize:r}=t,n=0,a=0,o=0,s=0,l={},u={[Xt]:0,[mi]:0,[Bn]:0,[Ud]:0,[Ms]:0};(h=(m=Nt(t.tieFormat)?t.tieFormat:wu({namedFormat:i}))==null?void 0:m.collectionDefinitions)==null||h.filter(Boolean).forEach(f=>{let{category:g,collectionId:v,matchUpType:y,matchUpCount:I,gender:b}=f;if([Xt,mi].includes(b)){let S=I*(y===Zt?2:1);u[b]<S&&(u[b]=S)}else b===Bn&&(u[Xt]<I&&(u[Xt]=I),u[mi]<I&&(u[mi]=I));if(g){let S=JSON.stringify(g);l[S]=g}if(v||(f.collectionId=Gt()),Yi(Zt)(y)){let S=I;s+=I,n=Math.max(n,S)}if(Yi(ii)(y)){let S=I;o+=I,a=Math.max(a,S)}});let c=Object.keys(l).length?Math.max(o,s*2):Math.max(a,n*2),d=n*(r+e),p=a*(r+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:c,genders:u}}function Xme({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=St}=t||{},a=r||0,o={[mi]:0,[Bn]:0,[Ud]:0,[Xt]:0,[Ms]:0},s=0,l=0,u=0,c=0,d=0,p=({alternatesCount:h=0,uniqueParticipants:f,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:I,category:b,gender:S,stage:w})=>{let U=y===po,T=y===lr,D=!!(f||w===Ke||b||S);if(T){c=Math.max(c,v+h),I=typeof I=="object"?I:wu({namedFormat:g});let{teamSize:P,maxDoublesDraw:E,maxSinglesDraw:R,genders:N}=ux({alternatesCount:h,tieFormatName:g,tieFormat:I,drawSize:v});u=Math.max(u,P),l=Math.max(l,R),D||(s=Math.max(s,E)),Object.keys(N).forEach(A=>o[A]+=N[A])}else if(U)if(D){let P=(v+h)*2;d+=P,S&&(o[S]+=P)}else v+h&&v+h>s&&(s=v+h);else if(D){let P=v+h;S&&(o[S]+=P),d+=P}else v&&v>l&&(l=v+h)};if(e==null||e.forEach(h=>{let{tieFormatName:f,tieFormat:g,drawProfiles:v,eventType:y,category:I,gender:b}=h;if(v)for(let S of v){let{tieFormatName:w,tieFormat:U}=S;p({...S,tieFormatName:w||f,tieFormat:U||g,eventType:y,category:I,gender:b})}}),Array.isArray(i))for(let h of i)p(h);let m=Math.max(c*u,s*2,l);return s&&(n=ft),(r||a)<m&&(r=m),r&&s&&[ft,lr].includes(n)&&(l&&Math.floor(l/2)>s?r=Math.floor(l/2):(!l||s*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:c,largestTeamSize:u,participantType:n,gendersCount:o}}function T4({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if((t==null?void 0:t.participantsCount)===0)return{addedCount:0,...X};let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=Xme({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t==null?void 0:t.teamKey,p=rv({consideredDate:n,...t,participantsCount:o,participantType:s,gendersCount:c,uuids:a}).participants,m=0,h=ns({tournamentRecord:e,participants:p});if(h.error)return h;if(m+=h.addedCount,d){let y=lx({tournamentRecord:e,...d});if(y.error)return y}let f=p.filter(({participantType:y})=>y===St).map(Ut),g=t!=null&&t.idPrefix?`${Kt}-${t.idPrefix}`:void 0,v=Te(0,l).map(y=>{let I=f.slice(y*u,(y+1)*u),b=jS({index:y,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:Qr,individualParticipantIds:I,participantType:Kt,participantId:b}});return h=ns({participants:v,tournamentRecord:e}),h.error?h:(m+=h.addedCount,{addedCount:m,...X})}function D4({drawProfiles:t,category:e,gender:i}){let r={},n=t==null?void 0:t.reduce((o,s)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=Oe,drawSize:p=0}=s||{};Object.keys(o).includes(d)||(o[d]=0);let m=(u||p)-l;return c||i||e||d===Ke?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=m):o[d]=Math.max(o[d],m),o},{}),a=Object.keys(r);return a.forEach(o=>n[o]+=r[o]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function P4({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Oe]||0,a=e[Ke]||0;return{stageParticipants:{QUALIFYING:r==null?void 0:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(0,a),MAIN:r==null?void 0:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(a,a+n)}}}var Qme={[zt]:2,[tr]:1,[dr]:1,[hn]:1,[Mt]:4};function cx(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=Qme,matchUpFormat:n=fu,pointsPerMinute:a=1,sideWeight:o=4}=t;if(!Sa({matchUpFormat:n}))return{error:vN};if(typeof r!="object")return{error:se};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(o))return{error:se};let s=Object.keys(r).filter(P=>Object.keys(uW).includes(P)&&P!==qi);if(Object.keys(s).reduce((P,E)=>P+r[E],0)>100)return{error:se,matchUpStatusProfile:r};let l=s.reduce((P,E)=>(P.pointer=P.pointer+r[E],P.valueMap.push([P.pointer,E]),P),{pointer:0,valueMap:[]}),u=ro(1,100),c=(l.valueMap.find(P=>u<=P[0])??[100,qi])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([zt,Mt].includes(c)){i=i||ro(1,2);let P={score:d,matchUpStatus:c,winningSide:i};if(!(c===Mt&&ro(1,100)>100-e))return{outcome:P}}else if([tr,dr].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=kn(n),{bestOf:m=1,exactly:h,setFormat:f,finalSetFormat:g}=p??{},v=[],y=ro(0,1),I=i?[i-1]:[...Te(0,o).map(()=>y),1-y],b=[hn,Mt,mo,qc].includes(c)&&(ga(Te(1,h||m))||1),S,w=Te(1,(h??m)+1);for(let P of w){let E=P===(h??m),{set:R,incomplete:N,winningSideNumber:A}=Zme({setFormat:E&&g||f,incomplete:b===P,pointsPerMinute:a,matchUpStatus:c,weightedRange:I,setNumber:P});if(v.push(R),N){S=A;break}if(HI({matchUp:{score:{sets:v},matchUpFormat:n}}).calculatedWinningSide)break}let U=HI({matchUp:{score:{sets:v},matchUpFormat:n,winningSide:i}}),T=S?i||S:U.calculatedWinningSide,{score:D}=u4({winningSide:T,score:{sets:v},matchUpStatus:c});return{outcome:{winningSide:T,matchUpStatus:c,score:D}}}function Zme({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let o={setNumber:a},{setTo:s,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=n,m=ro(0,t.length-1),h=t[m],f;if(d){let g=p*e,v=Math.round(g*.2),y=g+ga([1,-1])*v,I=hne(y,2),b=[I,y-I];h&&b.reverse(),f=t[m]+1;let S=b[0]>b[1]&&1||b[1]>b[0]&&2||0;if(r){let[T,D]=b;return Object.assign(o,{side1Score:T,side2Score:D}),vr.includes(i)?{set:o,incomplete:r,winningSideNumber:f}:{set:o,incomplete:r}}S||(b[ro(0,1)]+=1),S=b[0]>b[1]?1:2,S!==f&&b.reverse();let[w,U]=b;return Object.assign(o,{side1Score:w,side2Score:U,winningSide:f}),{set:o}}else{if(r)return o.side1Score=ro(0,u),o.side2Score=ro(0,u),vr.includes(i)&&(f=t[m]+1),{set:o,incomplete:r,winningSideNumber:f};{let g=Te(1,s+1).map(U=>Te(0,s+2-U).map(()=>U)).flat(),v=g[ro(0,g.length-1)],y=s&&KO({isSide1:!0,tiebreakAt:u,lowValue:v,setTo:s}),I=!y,b=t.length===1&&t[m]+1;if(!I){b?(y[0]>y[1]?1:2)!==b&&y.reverse():h&&y.reverse();let[U,T]=y;Object.assign(o,{side1Score:U,side2Score:T})}let S=jI({matchUpScoringFormat:{setFormat:n},setObject:o}),w;if(S.hasTiebreakCondition||I){let{NoAD:U,tiebreakTo:T}=l||c||{},D=Te(1,T+1).map(R=>Te(0,T+2-R).map(()=>R)).flat(),P=D[ro(0,D.length-1)],E=sD({isSide1:!0,tiebreakNoAd:U,tiebreakTo:T,lowValue:P});if(E)if(I){let R=E[0]>E[1]?1:2;b?R!==b&&E.reverse():h&&E.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=E,w=E[0]>E[1]&&1||E[1]>E[0]&&2||void 0}else S.leadingSide===2?[o.side1TiebreakScore,o.side2TiebreakScore]=E:[o.side2TiebreakScore,o.side1TiebreakScore]=E}o.winningSide=S.winningSide||S.leadingSide||b||w}}return{set:o}}function HS(t){var v,y,I;let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:o,event:s}=t;if(!o)return{error:Le};let l=t.matchUpFormat||o.matchUpFormat||(s==null?void 0:s.matchUpFormat),u=o.structures.slice().sort(ih),c=0,{matchUps:d,matchUpsMap:p}=hr({matchUpFilters:{matchUpTypes:[fi],roundNumbers:[1]},contextFilters:{stages:[Oe,Ke]},inContext:!0,drawDefinition:o});if(d!=null&&d.length){let b=((v=s==null?void 0:s.category)==null?void 0:v.ageCategoryCode)||((y=s==null?void 0:s.category)==null?void 0:y.categoryName);if(b){let S=$Y({singlesOnly:!0,tournamentRecord:n,drawDefinition:o,scaleAccessor:{scaleName:b,sortOrder:_Y,scaleType:Uc},event:s});if(S.error)return S;let{lineUps:w,participantsToAdd:U}=S;ns({tournamentRecord:n,participants:U}),Lt({element:o,extension:{name:Du,value:w}})}else{let S=(I=d[0])==null?void 0:I.structureId,{positionAssignments:w}=oi({drawDefinition:o,structureId:S});if(w!=null&&w.length){let{participants:U}=Mi({participantFilters:{participantTypes:[fi]},tournamentRecord:n}),T=D=>{let P=D.tieMatchUps.filter(Yi(ii)),E=D.tieMatchUps.filter(Yi(Zt));P.forEach((R,N)=>{let A=R.matchUpId;R.sides.forEach(M=>{var k;let{drawPosition:C}=M,O=U==null?void 0:U.find(x=>{var $;let{participantId:F}=x;return(($=w.find(_=>_.participantId===F))==null?void 0:$.drawPosition)===C});if(O){let x=(k=O.individualParticipantIds)==null?void 0:k[N];x&&VS({teamParticipantId:O.participantId,participantId:x,tournamentRecord:n,drawDefinition:o,tieMatchUpId:A,event:s})}})}),E.forEach((R,N)=>{let A=R.matchUpId;R.sides.forEach(M=>{var k,x;let{drawPosition:C}=M,O=U==null?void 0:U.find(F=>{var _;let{participantId:$}=F;return((_=w.find(L=>L.participantId===$))==null?void 0:_.drawPosition)===C});O&&((x=(k=O.individualParticipantIds)==null?void 0:k.slice(N*2,N*2+2))==null||x.forEach(F=>{VS({teamParticipantId:O.participantId,participantId:F,tournamentRecord:n,drawDefinition:o,tieMatchUpId:A,event:s})}))})})};d.forEach(T)}}}let m=typeof i=="string"&&i,h=m&&qi,f=u.length===2&&u[0].finishingPosition===kd&&Vi(u.map(({stage:b})=>b),[Oe,$i]).length===2,g=u.map(({structureId:b})=>b);for(let b of g){if(c>=a)break;let S=o.structures.find(T=>T.structureId===b),w=Wt({contextFilters:{matchUpTypes:[Zt,ii]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:S,event:s}).matchUps;w.length;let U=w.filter(({winningSide:T})=>!T).sort(ch).map(Dr);for(let T of U){if(!isNaN(a)&&c>=a)break;let{matchUps:D}=Wt({matchUpFilters:{matchUpTypes:[Zt,ii]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:S,event:s}),P=D.find(R=>R.matchUpId===T),E=[tr,dr].includes(P.matchUpStatus);if(P!=null&&P.readyToScore&&!E){let R=ehe({matchUpStatusProfile:e,tournamentRecord:n,drawDefinition:o,targetMatchUp:P,matchUpFormat:l,matchUpStatus:h,scoreString:m,winningSide:!r&&1,event:s});if(R!=null&&R.error)return R;c+=1}}f&&S.finishingPosition===kd&&t.completeRoundRobinPlayoffs&&Wg({structureId:S.structureId,applyPositioning:!0,drawDefinition:o})}return{...X,completedCount:c}}function R4(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus===Vt)return;let{matchUpId:d}=a||{},{outcome:p}=rx({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),$b({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function ehe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:u,event:c}=t;if(l||a)return R4(t);let{matchUpId:d}=s||{},{outcome:p}=cx({matchUpStatusProfile:e,matchUpFormat:o,winningSide:u});return $b({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function E4({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:o}){var f,g,v,y;let s=Gi({event:o}).flightProfile,{eventName:l,eventType:u,category:c}=o,{startDate:d}=r,p=[],m=(c==null?void 0:c.categoryName)||(c==null?void 0:c.ageCategoryCode)||(c==null?void 0:c.ratingType),h=(f=o.drawDefinitions)==null?void 0:f.map(({drawId:I})=>I);if(Array.isArray(s==null?void 0:s.flights))for(let[I,b]of s.flights.entries()){let{drawId:S,stage:w,drawName:U,drawEntries:T}=b;p.push(b.drawId);let D=n[I],{seedsCount:P,generate:E=!0}=D||{};if(E){let R=T.filter(Da(zl)).map(Da(zl)),N=m||l;if(r&&P&&P<=R.length&&Te(1,P+1).forEach((k,x)=>{let F={scaleValue:k,scaleName:N,scaleType:Ml,eventType:u,scaleDate:d},$=R[x];Cb({tournamentRecord:r,participantId:$,scaleItem:F})}),h==null?void 0:h.includes(S))break;let A=xb({...D,matchUpType:u,seedingScaleName:N,tournamentRecord:r,drawEntries:T,drawName:U,drawId:S,isMock:a,event:o,stage:w});if(A.error)return{error:A.error,drawIds:[]};let{drawDefinition:M}=A;if(!M)return{error:Fa};let C=(g=n[I])==null?void 0:g.drawExtensions;if(Array.isArray(C)&&C.filter(al).forEach(k=>Lt({element:M,extension:k})),A=Fb({suppressNotifications:!0,tournamentRecord:r,drawDefinition:M,event:o}),A.error)return{error:A.error,drawIds:[]};if(D!=null&&D.withPlayoffs){let k=(v=M.structures)==null?void 0:v[0].structureId,x=KT({idPrefix:D.idPrefix,...D.withPlayoffs,tournamentRecord:r,drawDefinition:M,structureId:k,isMock:a,event:o});if(x!=null&&x.error)return x}let O=D==null?void 0:D.completionGoal;if((D==null?void 0:D.automated)!==!1&&(e||O)){let k=D==null?void 0:D.matchUpFormat,x=HS({completeAllMatchUps:!O&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:O,drawDefinition:M,matchUpFormat:k,event:o});if(x.error)return{error:x.error,drawIds:[]};let F=x.completedCount;if((D==null?void 0:D.drawType)===Hl){let $=(y=M.structures)==null?void 0:y.find(B=>B.stage===Oe);if(!$)return{error:Ci};let _=Wg({structureId:$.structureId,tournamentRecord:r,drawDefinition:M,event:o});if(_.error)return{error:_.error,drawIds:[]};let L=O?O-(F??0):void 0;if(_=HS({completeAllMatchUps:!O&&e,completionGoal:O?L:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:M,matchUpFormat:k,event:o}),_.error)return{error:_.error,drawIds:[]}}}}}return{...X,drawIds:p}}function C4(t){var w,U;let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:o,event:s,uuids:l}=t,{category:u,gender:c,eventType:d}=s,p=Yi(rl)(d)&&St||Yi(po)(d)&&ft||d,m=i[Oe]||0,h=i[Ke]||0,f=(w=a.drawProfiles)!=null&&w.length?m+h:((U=a.participantsProfile)==null?void 0:U.participantsCount)??0,g=[Xt,mi].includes(c)?c:void 0,v=e!=null&&e.idPrefix?`E-${o}-${e==null?void 0:e.idPrefix}`:void 0,{participants:y}=rv({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n==null?void 0:n.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:f,ratingsParameters:r,category:u,idPrefix:v,sex:g}),I=ns({tournamentRecord:n,participants:y});if(I.error)return I;let b=y==null?void 0:y.filter(({participantType:T})=>T===p),S=y==null?void 0:y.map(Ut);return{uniqueDrawParticipants:b,uniqueParticipantIds:S}}function the({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=Ys,qualifyingPositions:o=0,stage:s=Oe,drawSize:l=0,drawName:u,drawId:c}=r,d=l-o,p=i.slice(0,d).map(Ut);if(p.length){let f=Ks({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:n});if(f.error)return f}let m=p.map(f=>({entryStatus:sa,entryStage:s,participantId:f})),h=RD({drawName:u||a,qualifyingPositions:o,drawEntries:m,drawId:c,event:n,stage:s});return h.error?h:{...X}}function M4({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:o,event:s}){let l=0;for(let u of n){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=Oe,drawSize:m=0}=u,h=m-c,f=d||o||a||p===Ke,g=f?t.slice(l,l+h):i[p||Oe]||[];f&&(l+=h);let v=the({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:u,event:s});if(v.error)return v}return{...X}}function N4(t){var W;let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,publish:p,isMock:m,uuids:h}=t,f=c.gender,g=c.eventName,{eventType:v=rl,policyDefinitions:y,drawProfiles:I=[],eventExtensions:b,surfaceCategory:S,tieFormatName:w,processCodes:U,discipline:T,eventLevel:D,timeItems:P,ballType:E,category:R}=c,N=c.eventId||Gt(),A=c.tieFormat||(v===lr?wu({namedFormat:w,event:{eventId:N,category:R,gender:f},hydrateCollections:o,isMock:m}):void 0),M=u.participants;for(let q of I)!f&&q.gender&&(f=q==null?void 0:q.gender);let{stageParticipantsCount:C,uniqueParticipantsCount:O,uniqueParticipantStages:k}=D4({drawProfiles:I,category:R,gender:f}),x=Yi(rl)(v)&&St||Yi(po)(v)&&ft||v,{uniqueDrawParticipants:F=[],uniqueParticipantIds:$=[]}=k?C4({event:{eventType:v,category:R,gender:f},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,uuids:h}):{},{eventAttributes:_}=c;typeof _!="object"&&(_={});let L=(R==null?void 0:R.categoryName)||(R==null?void 0:R.ageCategoryCode)||(R==null?void 0:R.ratingType);g=g||L||"Generated Event";let B={..._,surfaceCategory:S,processCodes:U,discipline:T,eventLevel:D,eventName:g,eventType:v,tieFormat:A,ballType:E,category:R,eventId:N,gender:f};if(b!=null&&b.length&&Array.isArray(b)){let q=b.filter(al);q!=null&&q.length&&Object.assign(B,{extensions:q})}if(Array.isArray(P)&&P.forEach(q=>fh({event:j,timeItem:q})),typeof y=="object")for(let q of Object.keys(y))Vd({policyDefinitions:{[q]:y[q]},event:B});B.category&&(B.category.categoryName=L);let V,G=Xg({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:B});if(G.error)return G;let j=G==null?void 0:G.event,{stageParticipants:z}=P4({allUniqueParticipantIds:e,stageParticipantsCount:C,eventParticipantType:x,targetParticipants:M});if(I!=null&&I.length){let q=M4({uniqueDrawParticipants:F,autoEntryPositions:a,stageParticipants:z,tournamentRecord:u,drawProfiles:I,category:R,gender:f,event:j});if(q.error)return q;let Y=E4({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:s,tournamentRecord:u,drawProfiles:I,isMock:m,event:j});if(Y.error)return Y;V=Y.drawIds}else if((W=c==null?void 0:c.participantsProfile)!=null&&W.participantsCount){let q=F.map(Ut);if(q.length){let Y=Ks({participantIds:q,autoEntryPositions:a,tournamentRecord:u,entryStage:Oe,event:j});if(Y.error)return Y}}return p&&Zg({tournamentRecord:u,event:j}),{drawIds:V,eventId:N,uniqueParticipantIds:$}}function dx({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!ya(e))return{error:Ar};let n="addSchedulingProfileRound",{extension:a}=vt({name:Rm,tournamentRecords:t,discover:!0}),o=(a==null?void 0:a.value)||[],s=o.find(p=>jl(e,p.scheduleDate));if(!s){let{startDate:p,endDate:m}=cD({tournamentRecords:t}),h=new Date(e);if(p&&h<new Date(p)||m&&h>new Date(m))return{error:Ar};s={scheduleDate:e,venues:[]},o.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(m=>!u.includes(m)).sort().map(m=>Nt(p[m])?c(p[m]):p[m]).flat().join("|");if(l.rounds.find(p=>c(p)===c(r)))return ee({result:{error:kG},stack:n});l.rounds.push(r);let d=Kg({tournamentRecords:t,schedulingProfile:o});return d.error?d:{...X}}function ihe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:se};let i=Bg({tournamentRecord:e}).containedStructures,r=Vr({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let o of t){let{scheduleDate:s,venues:l=[]}=o;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:m,winnerFinishingPositionRange:h,roundSegment:f}=p,g=r.filter(v=>{var b;let y=(h==null?void 0:h.indexOf("-"))>0&&h.split("-").map(S=>+S),I=(b=v.finishingPositionRange)==null?void 0:b.winner;return v.drawId===m&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!I||!y||Vi(I,y).length===2||ct(I).length===ct(y).length&&Vi(I,y).length===ct(I).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:I,structureName:b,roundName:S}=g,w=g.structureId;y&&!h&&(w=Object.keys(i).find(D=>i[D].includes(w))??w);let U={tournamentId:n,structureId:w,roundNumber:y,roundSegment:f,eventId:v,drawId:m},T=dx({tournamentRecords:{[n]:e},round:U,scheduleDate:s,venueId:d});if(T.error)return T;a.push({structureName:b,roundName:S,drawName:I,...U})}}}}return{scheduledRounds:a}}function BD(t){var we,Ze,pt;let e=ze(t,[{drawProfile:!0,_ofType:ta}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,isMock:d=!0,drawProfile:p,startDate:m,drawIndex:h,uuids:f}=t,g=Ce(p,!1,!0),{excessParticipantAlternates:v=!0,matchUpFormat:y=fu,drawType:I=Ys,tournamentAlternates:b=0,alternatesCount:S=0,qualifyingPositions:w,qualifyingProfiles:U,generate:T=!0,eventExtensions:D,drawExtensions:P,completionGoal:E,tieFormatName:R,buildTeams:N,seedsCount:A,timeItems:M,drawName:C,category:O,idPrefix:k,publish:x,gender:F,stage:$}=g,_=g.drawSize||(g.ignoreDefaults?void 0:32),L=g.eventId||Gt(),B=p.eventType||p.matchUpType||rl,V=B===po?ft:St,G=Nt(p.tieFormat)&&p.tieFormat||B===Kt&&wu({event:{eventId:L,category:O,gender:F},namedFormat:R,hydrateCollections:s,isMock:d})||void 0,j=(O==null?void 0:O.categoryName)||(O==null?void 0:O.ageCategoryCode)||(O==null?void 0:O.ratingType),z=p.eventName||j||`Generated ${B}`,W=(c==null?void 0:c.participants)||[],q=((U==null?void 0:U.map(he=>he.structureProfiles||[]).flat().reduce((he,fe)=>{let pe=!fe.participantsCount||fe.participantsCount>fe.drawSize?fe.drawSize:fe.participantsCount||0;return he+pe},0))||0)*(V===ft?2:1),Y=(!p.participantsCount||p.participantsCount>_?_:p.participantsCount)||0,re={eventName:z,eventType:B,tieFormat:G,category:O,eventId:L,gender:F};Array.isArray(M)&&M.forEach(he=>fh({event:re,timeItem:he}));let{eventAttributes:J}=p;if(typeof J!="object"&&(J={}),Object.assign(re,J),(D==null?void 0:D.length)&&Array.isArray(D)){let he=D.filter(al);he!=null&&he.length&&Object.assign(re,{extensions:he})}let H=[];if((r==null?void 0:r.participantsCount)===0||p.uniqueParticipants||q||!c||F||O){let he=(Y||0)+S+q,fe=he,pe={[Xt]:0,[mi]:0},Fe,Se;B===Kt&&({teamSize:Fe,genders:Se}=ux({alternatesCount:S,tieFormatName:R,tieFormat:G,drawSize:_}),Object.keys(Se).forEach(me=>{[Xt,mi].includes(me)&&Se[me]&&(pe[me]=_*Se[me])}),fe=Fe*((_||0)+q));let He=r!=null&&r.idPrefix?`D-${h}-${r==null?void 0:r.idPrefix}`:void 0,ue=rv({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:fe,consideredDate:c==null?void 0:c.startDate,sex:F||(r==null?void 0:r.sex),rankingRange:p.rankingRange,uuids:p.uuids||f,ratingsParameters:u,participantType:V,gendersCount:pe,idPrefix:He,category:O}).participants;if(re.category&&(re.category.categoryName=j),c){let me=ns({participants:ue,tournamentRecord:c});if(me.error)return me}if(ue.forEach(({participantId:me})=>H.push(me)),W=ue,B===Kt){let me=Se[Xt]?ue.filter(({participantType:Ae,person:yt})=>Ae===St&&(yt==null?void 0:yt.sex)===Xt).map(Ut):[],Ue=Se[mi]?ue.filter(({participantType:Ae,person:yt})=>Ae===St&&(yt==null?void 0:yt.sex)===mi).map(Ut):[],$e=ue.filter(({participantType:Ae})=>Ae===St).map(Ut).filter(Ae=>!me.includes(Ae)&&!Ue.includes(Ae)),Ee=[...g.teamNames??[],...GS({count:he}).names],Be=Fe-(Se[Xt]+Se[mi]),xe=0,qe=0,Pe=0,at=Te(0,he).map(Ae=>{let yt=Ue.slice(xe,xe+Se[mi]),yi=me.slice(qe,qe+Se[Xt]),be=$e.slice(Pe,Pe+Be);xe+=Se[mi],qe+=Se[Xt],Pe+=Be;let Ct=N!==!1?[...yt,...yi,...be]:[];return{participantName:Ee[Ae]||`Team ${Ae+1}`,participantOtherName:`TM${Ae+1}`,participantRole:Qr,individualParticipantIds:Ct,participantType:Kt,participantId:Gt()}}),di=ns({participants:at,tournamentRecord:c});if(!di.success)return di;W=at}}let Z=he=>{let{participantType:fe}=he;return Yi(rl)(B)&&fe===St||Yi(po)(B)&&fe===ft?!0:B===Kt&&fe===Kt},K=he=>{var fe,pe;return!p.gender||((fe=he.person)==null?void 0:fe.sex)===p.gender?!0:(pe=he.individualParticipantIds)==null?void 0:pe.some(Fe=>{let Se=W.find(He=>He.participantId===Fe);return Se&&K(Se)})},ie=W.filter(Z).filter(K).filter(({participantId:he})=>!i.includes(he)),ae=ie.slice(0,Y).map(he=>he.participantId);if(d&&(ae!=null&&ae.length)){let he=Ks({autoEntryPositions:o,entryStage:$,tournamentRecord:c,participantIds:ae,event:re});if(he.error)return he}let oe=q?ie.slice(Y,Y+q).map(he=>he.participantId):0;if(d&&(oe!=null&&oe.length)){let he=0,fe=1,pe=(Se,He)=>Se.stageSequence-He.stageSequence,Fe=(Se,He)=>Se.roundTarget-He.roundTarget;for(let Se of U.sort(Fe)){fe=Se.roundTarget||fe;let He=1,ue;for(let me of Se.structureProfiles.sort(pe)){let Ue=(me.drawSize||sN(me.participantsCount))-(ue||0),$e=oe.slice(he,he+Ue),Ee=Ks({entryStage:Ke,entryStageSequence:He,autoEntryPositions:o,tournamentRecord:c,participantIds:$e,roundTarget:fe,event:re});if(Ee.error)return Ee;ue=me.qualifyingPositions,he+=Ue,He+=1}fe+=1}}let ne=v&&((we=c==null?void 0:c.participants)==null?void 0:we.filter(({participantId:he})=>!ae.includes(he)).filter(Z).filter(K).slice(0,S||_-Y||b).map(he=>he.participantId));if(d&&(ne!=null&&ne.length)){let he=Ks({participantIds:ne,autoEntryPositions:!1,entryStatus:Go,tournamentRecord:c,event:re});if(he.error)return he.error}let de=j||z;c&&A&&A<=ae.length&&Te(1,A+1).forEach((he,fe)=>{let pe={scaleName:de,scaleDate:m,scaleType:BA,scaleValue:he,eventType:B},Fe=ae[fe];Cb({tournamentRecord:c,participantId:Fe,scaleItem:pe})});let ye=xb({...Ce(p,!1,!0),tournamentRecord:c,seedingScaleName:de,matchUpFormat:y,eventId:L,isMock:d,event:re});if(ye.error)return ye;if(!ye.drawDefinition)return{error:Fa};let{drawDefinition:ce}=ye,ke=ce.drawId;if(Array.isArray(P)&&P.filter(al).forEach(he=>Lt({element:ce,extension:he})),T){if(Fb({drawDefinition:ce,event:re,suppressNotifications:!0}),p.withPlayoffs){let fe=(Ze=ce.structures)==null?void 0:Ze[0].structureId,pe=KT({...p.withPlayoffs,tournamentRecord:c,drawDefinition:ce,structureId:fe,idPrefix:k,isMock:d,event:re});if(pe!=null&&pe.error)return pe}let he=p.automated===!1;if(d&&!he){let fe=pe=>{var He;let Fe=HS({completeAllMatchUps:pe.completeAllMatchUps,completionGoal:pe.completionGoal,matchUpStatusProfile:n,randomWinningSide:l,tournamentRecord:c,drawDefinition:ce,matchUpFormat:y,event:re});if(Fe.error)return Fe;let Se=Fe.completedCount;if(I===Hl){let ue=(He=ce.structures)==null?void 0:He.find($e=>$e.stage===Oe);if(!ue)return{error:Ci};Wg({structureId:ue.structureId,tournamentRecord:c,drawDefinition:ce,event:re});let me=E?E-(Se??0):void 0,Ue=HS({completionGoal:E?me:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawDefinition:ce,matchUpFormat:y,event:re});if(Ue.error)return Ue}};if(E&&fe({completionGoal:E}),p.outcomes){let{matchUps:pe}=Sn({inContext:!0,drawDefinition:ce,event:re});for(let Fe of p.outcomes){let{matchUpStatus:Se=qi,matchUpStatusCodes:He,stageSequence:ue=1,matchUpIndex:me=0,structureOrder:Ue,matchUpFormat:$e,drawPositions:Ee,roundPosition:Be,stage:xe=Oe,roundNumber:qe,winningSide:Pe,scoreString:at}=Fe,di=(pe==null?void 0:pe.reduce((be,Ct)=>{let{structureId:Re,matchUpId:Ye}=Ct;return be[Re]?be[Re].push(Ye):be[Re]=[Ye],be},{}))??[],Ae=Object.assign({},...Object.keys(di).map((be,Ct)=>({[be]:Ct+1}))),yt=(pt=pe==null?void 0:pe.filter(be=>(!xe||be.stage===xe)&&(!ue||be.stageSequence===ue)&&(!qe||be.roundNumber===qe)&&(!Be||be.roundPosition===Be)&&(!Ue||Ae[be.structureId]===Ue)&&(!Ee||Vi(Ee,be.drawPositions).length===2)))==null?void 0:pt[me],yi=R4({matchUpStatusCodes:He,tournamentRecord:c,drawDefinition:ce,targetMatchUp:yt,matchUpFormat:$e,matchUpStatus:Se,scoreString:at,winningSide:Pe});if(yi!=null&&yi.error)return yi}}a&&fe({completeAllMatchUps:a})}x&&Zg({tournamentRecord:c,event:re})}else{let he=RD({drawEntries:ce.entries,drawName:C||I,qualifyingPositions:w,drawId:ke,event:re,stage:$});if(he.error)return he}return{...X,event:je(re),uniqueParticipantIds:H,targetParticipants:W,drawDefinition:ce,eventId:L,drawId:ke}}var A4=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),rhe=A4;function zS(t){return parseInt(t)}function IV({startTime:t="",endTime:e=""}={}){if(!t||!e||!Sd.test(t)||!Sd.test(e))return!1;let[i,r]=t.split(":").map(zS),[n,a]=e.split(":").map(zS);return n<i?!1:!(i===n&&a<r)}function nhe(t,e){let[i,r]=t.startTime.split(":").map(zS),[n,a]=e.startTime.split(":").map(zS);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function O4({dateAvailability:t}){if(!t)return{error:KG};if(!Array.isArray(t))return{error:EU};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:EU};let{date:n,startTime:a,endTime:o,bookings:s=[]}=r;if(!a||!o)return{error:EU};if(n&&!il.test(n))return{error:Ar,dateAvailability:{date:n},info:e};if(!Sd.test(a))return{error:Ao,dateAvailability:{startTime:a},info:i};if(!Sd.test(o))return{error:Ao,dateAvailability:{endTime:o},info:i};if(a===o)return{error:Ao,dateAvailability:{startTime:a,endTime:o},info:"startTime and endTime are equivalent"};if(!IV({startTime:a,endTime:o}))return{error:Ao,dateAvailability:{startTime:a,endTime:o},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:pS};for(let l of s){if(typeof l!="object")return{error:pS};let{startTime:u,endTime:c}=l;if(!Sd.test(u))return{error:Ao,booking:{startTime:u},info:i};if(!Sd.test(c))return{error:Ao,booking:{endTime:c},info:i};if(u===c)return{error:Ao,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!IV({startTime:u,endTime:c}))return{error:Ao,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function VD({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=tu({tournamentRecord:t,venueId:i});if(!a)return{error:Jm};a.courts||(a.courts=[]);let o={...A4(),venueId:i,courtId:r};if(o.courtId||(o.courtId=Gt()),a.courts.some(s=>s.courtId===o.courtId))return{error:pH};{let s=((n==null?void 0:n.dateAvailability)||[]).map(c=>{var d;return{...c,date:mt(c.date),startTime:wi(c.startTime),endTime:wi(c.endTime),bookings:(d=c.bookings)==null?void 0:d.map(({startTime:p,endTime:m,bookingType:h})=>({startTime:wi(p),endTime:wi(m),bookingType:h}))}}),l=Object.keys(o);for(let c of l)if(n!=null&&n[c])if(c==="dateAvailability"){let d=O4({dateAvailability:s});if(!d.valid&&d.error)return d;o.dateAvailability=s}else o[c]=n[c];let u=o;return a.courts.push(u),e||lt({payload:{venue:a,tournamentId:t.tournamentId},topic:pp,key:a.venueId}),{...X,court:Ce(o),venueId:i}}}function px(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:Gc};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let o of Object.values(r)){let{venue:s}=tu({tournamentRecord:o,venueId:i});if(s){let l=ahe({...t,tournamentRecord:o});for(let u of(l==null?void 0:l.courts)??[])n.push(u==null?void 0:u.courtId);if(l.error)return l;a=!0}}return a?{...X,courtIds:n}:{error:Jm}}function ahe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:Gc};let m=tu({tournamentRecord:r,venueId:d});if(m.error)return m;let{venue:h}=m;if(!_i(o)||!n)return{error:dH};o=o??n.length;let f=Te(0,o).map(g=>{let v=a==null?void 0:a[g],y=v?p.map(I=>({date:Vo(I),startTime:s,endTime:u,...v})):e;return v&&s&&u&&y.push({startTime:s,endTime:u}),{courtName:n[g]||i&&(h==null?void 0:h.venueAbbreviation)&&`${h==null?void 0:h.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||c&&`${c}-${v+1}`;return VD({disableNotice:!0,tournamentRecord:r,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return f.length!==o?ee({info:"not all courts could be generated",result:{error:se}}):(h&&lt({payload:{venue:h,tournamentId:r.tournamentId},topic:pp,key:h.venueId}),{...X,courts:Ce(f)})}function mx({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,o=[];for(let[s,l]of i.entries()){let{venueAbbreviation:u,venueId:c=(r==null?void 0:r.pop())??Gt(),dateAvailability:d,startTime:p="07:00",endTime:m="19:00",courtTimings:h,courtsCount:f,courtNames:g,venueName:v,idPrefix:y,courtIds:I}=l,b={venueName:v||`Venue ${s+1}`,venueAbbreviation:u,venueId:c},S=ob({tournamentRecord:t,venue:b});if(S.error){if(e)continue;return S}o.push(c);let w=Mf(n,a),U=!Array.isArray(d)&&[{startTime:p,endTime:m}].concat(w.map(T=>({date:Vo(T),startTime:p,endTime:m})));if(f||g){let T=px({dateAvailability:d||U,tournamentRecord:t,courtTimings:h,courtsCount:f,courtNames:g,startTime:p,idPrefix:y,courtIds:I,endTime:m,venueId:c,dates:w});if(T.error)return T}}return o}function ohe(t){var c,d,p;let{tournamentRecord:e,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:o,uuids:s}=t,l=0;for(let m of i){let h=[],{tieFormatName:f=IS,teamProfiles:g=[],teamsCount:v=0,category:y,idPrefix:I,gender:b}=m,S=m.leagueName??m.eventName??`League ${l+1}`,w=m.leagueId??m.eventId??(s==null?void 0:s.pop())??Gt();r.push(w);let U=Nt(m.tieFormat)&&m.tieFormat||wu({event:{eventId:w,category:y,gender:b},namedFormat:f,isMock:t.isMock})||void 0;if(!U)return{error:Mg};let T=Math.max(v,g.length),D=Te(0,T),{genders:P,teamSize:E}=ux({tieFormat:U,drawSize:T}),R={[mi]:0,[Bn]:0,[Ud]:0,[Xt]:0,[Ms]:0};Object.keys(P).forEach(A=>R[A]+=P[A]);for(let A of D){let M=((c=g==null?void 0:g[A])==null?void 0:c.teamName)??`Team ${A+1}`,C=((d=g==null?void 0:g[A])==null?void 0:d.teamId)||(s==null?void 0:s.pop())||Gt(),O=m.startDate??t.startDate,k=rv({...m==null?void 0:m.participantsProfile,participantsCount:E,consideredDate:O,gendersCount:R,category:y,gender:b,uuids:s}).participants,x=k.map(V=>V.participantId),F=Kt,$=C??jS({participantType:F,idPrefix:I,index:A,uuids:s});h.push({participantId:$,entryStatus:sa,entryStage:Oe});let _=((p=g==null?void 0:g[A])==null?void 0:p.venueIds)??[],L={participantId:$,participantRole:Qr,participantName:M,individualParticipantIds:x,participantType:F,homeVenueIds:_};_.forEach(V=>!n.includes(V)&&n.push(V)),o.push(...x),o.push($);let B=ns({participants:[L,...k],tournamentRecord:e});if(B.error)return B}let N={eventName:S,entries:h,eventType:Kt,tieFormat:U,category:y,eventId:w,gender:b};if(e.events||(e.events=[]),e.events.push(N),h.length){let A=(_i(m.roundsCount)&&m.roundsCount)??m.roundsCount===qae?(T-1)*2:T-1,M=xb({automated:m.automated,tournamentRecord:e,drawType:_a,roundsCount:A,drawSize:T,event:N});if(M.error)return M;let{drawDefinition:C}=M;if(C){let O=C==null?void 0:C.drawId;Fb({drawDefinition:C,event:N,suppressNotifications:!0}),a.push(O)}}l++}let u=n.map(m=>({venueId:m}));mx({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:u,uuids:s})}var she=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function k4(t){var y,I,b;let{startDate:e,endDate:i}=t??{},{tournamentName:r=ga(she),ratingsParameters:n=Nr,tournamentExtensions:a,policyDefinitions:o,schedulingProfile:s,venueProfiles:l,uuids:u}=t??{},c=(t==null?void 0:t.isMock)===!1?void 0:!0;if(e&&!ya(e)||i&&!ya(i))return{error:Ar};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:se};if(!e){let S=new Date;e=Vo(i??S),i=Vo(S.setDate(S.getDate()+7))}if(!i){let S=new Date(e);i=Vo(S.setDate(S.getDate()+7))}let d=$D({...t.tournamentAttributes??{},tournamentName:r,startDate:e,endDate:i,isMock:c}),p=l!=null&&l.length?mx({tournamentRecord:d,venueProfiles:l,uuids:u}):[];if(a!=null&&a.length&&Array.isArray(a)){let S=a.filter(w=>al({extension:w}));S!=null&&S.length&&Object.assign(d,{extensions:S,isMock:c})}if(typeof o=="object")for(let S of Object.keys(o))Vd({policyDefinitions:{[S]:o[S]},tournamentRecord:d});if(!((y=t==null?void 0:t.leagueProfiles)!=null&&y.length)||(I=t.eventProfiles)!=null&&I.length||(b=t.drawProfiles)!=null&&b.length||t.participantsProfile){let S=T4({tournamentRecord:d,...t});if(!S.success)return S}let m=[],h=[],f=[];if(t.leagueProfiles){let S=ohe({allUniqueParticipantIds:m,tournamentRecord:d,...t,eventIds:h,venueIds:p,drawIds:f});if(S!=null&&S.error)return S}if(t.drawProfiles){let S=lhe({allUniqueParticipantIds:m,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:f});if(S!=null&&S.error)return S}if(t.eventProfiles){let S=uhe({allUniqueParticipantIds:m,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:f});if(S!=null&&S.error)return S}let{scheduledRounds:g=void 0,schedulerResult:v={}}=s?che({...t,tournamentRecord:d}):{};return LN(),je({...X,tournamentRecord:d,scheduledRounds:g,schedulerResult:v,eventIds:h,venueIds:p,drawIds:f})}function lhe(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,o=0;for(let s of i){let l=BD({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:s,drawIndex:o,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if((s==null?void 0:s.addEvent)!==!1){if(l=Xg({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),n.push(c)}p!=null&&p.length&&r.push(...p),o+=1}}function uhe(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let o of e){let s=N4({...t,eventIndex:a,eventProfile:o});if(s.error)return s;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=s;u&&n.push(...u),r.push(l),c!=null&&c.length&&i.push(...c),a+=1}}function che(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,o=ihe({schedulingProfile:e,tournamentRecord:i});if(o.error)return o;let s=o.scheduledRounds;if(r){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:_D({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:n}),scheduledRounds:s}}return{scheduledRounds:s}}var x4={};bt(x4,{anonymizeTournamentRecord:()=>F4,modifyTournamentRecord:()=>L4});function F4({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){var k,x,F,$,_;if(!i)return{error:ge};let o=Array.isArray(t)?CB.concat(...t):CB,s=L=>{var B;return Array.isArray(t)?(B=L==null?void 0:L.extensions)==null?void 0:B.filter(V=>o.includes(V.name)):L==null?void 0:L.extensions},l={};i.extensions=s(i);let u=a||Gt();l[i.tournamentId]=u,i.tournamentId=u,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${Vo(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let L of i.participants||[]){L.extensions=s(L),L.onlineResources=[];let B=Gt();l[L.participantId]=B,L.participantId=B}for(let L of i.participants||[])Array.isArray(L.individualParticipantIds)&&(L.individualParticipantIds=L.individualParticipantIds.map(B=>l[B]));let c=0;for(let L of i.venues||[]){L.venueAbbreviation=`V${c}`,L.extensions=s(L),L.venueName=`Venue #${c}`,L.onlineResources=[],L.addresses=[];let B=Gt();l[L.venueId]=B,L.isMock=!0,c+=1;let V=0;for(let G of L.courts||[])G.courtName=`V${c}C${V}`,G.extensions=s(G),G.onlineResources=[],G.isMock=!0,V+=1}let d=1;for(let L of i.events||[]){L.extensions=s(L),L.onlineResources=[],L.isMock=!0;let B=Gt();l[L.eventId]=B,L.eventId=B;let V=((k=L.category)==null?void 0:k.categoryName)||((x=L.category)==null?void 0:x.ageCategoryCode)||((F=L.category)==null?void 0:F.ratingType)||L.gender;if(L.eventName=`Event ${d} ${V}`,Array.isArray(L.entries))for(let j of L.entries)j.participantId=l[j.participantId];for(let j of L.drawDefinitions||[]){j.extensions=s(j);let z=Gt();if(l[j.drawId]=z,j.drawId=z,j.isMock=!0,Array.isArray(j.entries))for(let q of j.entries)q.participantId=l[q.participantId];let W=q=>{q.extensions=s(q);let Y=Gt();l[q.structureId]=Y,q.structureId=Y;for(let re of q.positionAssignments||[])re.participantId&&(re.participantId=l[re.participantId]);for(let re of q.seedAssignments||[])re.participantId&&(re.participantId=l[re.participantId]);for(let re of q.matchUps||[]){re.isMock=!0;for(let J of re.sides||[])J.lineUp&&(J.lineUp=J.lineUp.map(({participantId:H,collectionAssignments:Z})=>({participantId:l[H],collectionAssignments:Z})))}};for(let q of j.structures||[])if(W(q),Array.isArray(q.structures))for(let Y of q.structures)W(Y);for(let q of j.links||[])q.source.structureId=l[q.source.structureId],q.target.structureId=l[q.target.structureId]}let{extension:G}=vt({name:ts,element:L});Array.isArray(($=G==null?void 0:G.value)==null?void 0:$.flights)&&((_=G==null?void 0:G.value.flights)==null||_.forEach(j=>{if(j.drawId=l[j.drawId],Array.isArray(j.drawEntries))for(let z of j.drawEntries)z.participantId=l[z.participantId]})),d+=1}let p=i.startDate||Vo(new Date),m=(i.participants||[]).filter(({participantType:L})=>L===St),h=m.reduce((L,B)=>{var G;let V=(G=B.person)==null?void 0:G.sex;return[Xt,mi].includes(V)?L[V]+=1:L[Ud]+=1,L},{[Xt]:0,[mi]:0,[Ud]:0}),f=Object.assign({},...Object.keys(h).map(L=>{var B;return{[L]:((B=S4({category:{ageCategoryCode:"O18"},count:h[L],addressProps:{citiesCount:10},personExtensions:[],consideredDate:p,sex:L}))==null?void 0:B.persons)||[]}})),g={[Xt]:0,[mi]:0,[Ud]:0},v=m.length,y=m.reduce((L,B)=>{var W,q;let V=((q=(W=B.person)==null?void 0:W.addresses)==null?void 0:q[0])||{},{city:G,state:j,postalCode:z}=V;return L.cities.includes(G)||L.cities.push(G),L.states.includes(j)||L.states.push(j),L.postalCodes.includes(z)||L.postalCodes.push(z),L},{cities:[],postalCodes:[],states:[]}),I=y.postalCodes.length,b=y.cities.length,S=y.states.length,{cities:w}=y4({count:b||v,participantsCount:v}),{states:U}=b4({count:S||v,participantsCount:v}),{postalCodes:T}=w4({count:I||v,participantsCount:v}),D={cities:w,states:U,postalCodes:T};m.forEach((L,B)=>{var q,Y;let V=L==null?void 0:L.person,G=(V==null?void 0:V.sex)||Ud,j=(q=mt(V==null?void 0:V.birthDate))==null?void 0:q.split("-")[0],z=g[G],W=f[G][z];if(g[G]+=1,j){let[,re,J]=((Y=W==null?void 0:W.birthDate)==null?void 0:Y.split("-"))||[],H=[j,re,J].join("-");W.birthDate=H}if(V!=null&&V.addresses){let re=U4({...D,participantIndex:B,nationalityCode:W.nationalityCode});W.addresses=[re]}W.personId=(n==null?void 0:n[B])||Gt(),e?(W.standardFamilyName=W.lastName,W.standardGivenName=W.firstName,L.participantName=`${W.standardGivenName} ${W.standardFamilyName}`):(W.standardFamilyName=V==null?void 0:V.standardFamilyName,W.standardGivenName=V==null?void 0:V.standardGivenName),delete W.firstName,delete W.lastName,W.extensions=s(V),L.person=W,l[V==null?void 0:V.personId]=W.personId}),(i.participants||[]).filter(({participantType:L})=>L===ft).forEach(L=>{let{individualParticipantIds:B}=L;L.participantName=dhe({individualParticipantIds:B,individualParticipants:m})});let P=(i.participants||[]).filter(({participantType:L})=>L===Kt),E=P.length,R=GS({count:E}).names;P.forEach((L,B)=>{L.participantName=R[B]});let N=(i.participants||[]).filter(({participantType:L})=>L===qa),A=N.length,M=GS({count:A,nameRoot:"Group"}).names;N.forEach((L,B)=>{L.participantName=M[B]});let{extension:C}=vt({element:i,name:Rm});Array.isArray(C==null?void 0:C.value)&&(C==null||C.value.forEach(L=>{L.tournamentId=l[L.tournamentId],L.structureId=l[L.structureId],L.eventId=l[L.eventId],L.drawId=l[L.drawId]}));let{extension:O}=vt({element:i,name:_g});return Array.isArray(O==null?void 0:O.value)&&(O==null||O.value.forEach(L=>{L.personId=l[L.personId]})),{...X}}function dhe({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function L4(t){var D,P,E;let{ratingsParameters:e=Nr,participantsProfile:i={},matchUpStatusProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,schedulingProfile:l,tournamentRecord:u,autoSchedule:c,eventProfiles:d,periodLength:p,venueProfiles:m,drawProfiles:h,isMock:f,uuids:g}=t;if(!u)return{error:ge};let v=[],y=[],I=[];d==null||d.forEach(R=>{var A;let N=(A=u.events)==null?void 0:A.find((M,C)=>R.eventIndex!==void 0&&C===R.eventIndex||R.eventName&&M.eventName===R.eventName||R.eventId&&M.eventId===R.eventId);N!=null&&N.gender&&(R.gender=N.gender)});let b=((D=u.participants)==null?void 0:D.length)||void 0;b&&(i!=null&&i.idPrefix)&&(i.idPrefix=`${i.idPrefix}-${b}`);let S=T4({startDate:u.startDate,participantsProfile:i,tournamentRecord:u,eventProfiles:d,drawProfiles:h,uuids:g});if(!S.success)return S;if(d){let R=((P=u.events)==null?void 0:P.length)||0;for(let N of d){let{ratingsParameters:A}=N,M=(E=u.events)==null?void 0:E.find((C,O)=>N.eventIndex!==void 0&&O===N.eventIndex||N.eventName&&C.eventName===N.eventName||N.eventId&&C.eventId===N.eventId);if(M){let{gender:C,category:O,eventType:k}=M,{drawProfiles:x,publish:F}=N,$=Yi(rl)(k)&&St||Yi(po)(k)&&ft||k;if(x){let{stageParticipantsCount:_,uniqueParticipantsCount:L,uniqueParticipantStages:B}=D4({drawProfiles:x,category:O,gender:C}),{uniqueDrawParticipants:V=[],uniqueParticipantIds:G=[]}=B?C4({event:{eventType:k,category:O,gender:C},uniqueParticipantsCount:L,participantsProfile:i,ratingsParameters:A,tournamentRecord:u,eventProfile:N,uuids:g}):{};v.push(...G);let{stageParticipants:j}=P4({targetParticipants:u.participants||[],allUniqueParticipantIds:v,stageParticipantsCount:_,eventParticipantType:$}),z=M4({uniqueDrawParticipants:V,autoEntryPositions:a,stageParticipants:j,tournamentRecord:u,drawProfiles:x,category:O,gender:C,event:M});if(z.error||(z=E4({matchUpStatusProfile:r,completeAllMatchUps:n,randomWinningSide:s,tournamentRecord:u,drawProfiles:x,isMock:f,event:M}),z.error))return z;I.push(...z.drawIds)}F&&Zg({tournamentRecord:u,event:M})}else{let C=N4({startDate:u.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:a,randomWinningSide:s,ratingsParameters:A,tournamentRecord:u,eventProfile:N,eventIndex:R,uuids:g});if(C.error)return C;let{eventId:O,drawIds:k,uniqueParticipantIds:x}=C;k&&I.push(...k),y.push(O),x!=null&&x.length&&v.push(...x),R+=1}}}if(h){let R=(u.events||[]).map(N=>{var A;return((A=N.drawDefinitions)==null?void 0:A.map(()=>1))||[]}).flat().reduce((N,A)=>N+A,0);for(let N of h){let A=BD({startDate:u.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:e,tournamentRecord:u,drawProfile:N,drawIndex:R,uuids:g});if(A.error)return A;let{drawId:M,eventId:C,event:O,uniqueParticipantIds:k}=A;if(A=Xg({tournamentRecord:u,event:O,internalUse:!0}),A.error)return A;M&&I.push(M),y.push(C),k!=null&&k.length&&v.push(...k),R+=1}}let w=m!=null&&m.length?mx({tournamentRecord:u,venueProfiles:m}):[],U,T={};if(l!=null&&l.length){let R={[u.tournamentId]:u},N=Kg({tournamentRecords:R,schedulingProfile:l});if(N.error)return N;if(c){let{tournamentId:A}=u,M={[A]:u};T=_D({tournamentRecords:M,periodLength:p})}}return{totalParticipantsCount:u.participants.length,scheduledRounds:U,schedulerResult:T,...X,eventIds:y,venueIds:w,drawIds:I}}var _4={};bt(_4,{addDynamicRatings:()=>$O,addIndividualParticipantIds:()=>ND,addParticipant:()=>ll,addParticipants:()=>ns,addPenalty:()=>a5,addPersonRequests:()=>H4,addPersons:()=>o5,createGroupParticipant:()=>J4,createTeamsFromParticipantAttributes:()=>lx,deleteParticipants:()=>ph,filterParticipants:()=>pb,findParticipant:()=>K4,getCompetitionParticipants:()=>ZO,getPairedParticipant:()=>rs,getParticipantEventDetails:()=>ek,getParticipantMembership:()=>tk,getParticipantScaleItem:()=>Wf,getParticipantSchedules:()=>ik,getParticipantSignInStatus:()=>rk,getParticipantTimeItem:()=>AA,getParticipants:()=>Mi,getScaleValues:()=>Lg,mergeParticipants:()=>n5,modifyIndividualParticipantIds:()=>z4,modifyParticipant:()=>AD,modifyParticipantName:()=>X4,modifyParticipantOtherName:()=>q4,modifyParticipantsSignInStatus:()=>W4,modifyPenalty:()=>i5,modifyPersonRequests:()=>j4,mutate:()=>$4,participantScaleItem:()=>Al,query:()=>G6,regenerateParticipantNames:()=>Y4,removeIndividualParticipantIds:()=>XA,removeParticipantIdsFromAllTeams:()=>$T,removePenalty:()=>e5,removePersonRequests:()=>G4,removeRatings:()=>Z4,scaledTeamAssignment:()=>Q4,setParticipantScaleItem:()=>Cb,setParticipantScaleItems:()=>_3,validateLineUp:()=>VT});var $4={};bt($4,{addDynamicRatings:()=>$O,addIndividualParticipantIds:()=>ND,addParticipant:()=>ll,addParticipants:()=>ns,addPenalty:()=>a5,addPersonRequests:()=>H4,addPersons:()=>o5,createGroupParticipant:()=>J4,createTeamsFromParticipantAttributes:()=>lx,deleteParticipants:()=>ph,findParticipant:()=>K4,mergeParticipants:()=>n5,modifyIndividualParticipantIds:()=>z4,modifyParticipant:()=>AD,modifyParticipantName:()=>X4,modifyParticipantOtherName:()=>q4,modifyParticipantsSignInStatus:()=>W4,modifyPenalty:()=>i5,modifyPersonRequests:()=>j4,regenerateParticipantNames:()=>Y4,removeIndividualParticipantIds:()=>XA,removeParticipantIdsFromAllTeams:()=>$T,removePenalty:()=>e5,removePersonRequests:()=>G4,removeRatings:()=>Z4,scaledTeamAssignment:()=>Q4,setParticipantScaleItem:()=>Cb,setParticipantScaleItems:()=>_3});function B4(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function V4({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:o,endTime:s}=n;return n.requestType===Vb&&(a=mt(a),o=wi(o),s=wi(s),a&&o&&s)?{date:a,startTime:o,endTime:s,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=B4(),t[e].push(n);return{mergeCount:r.length}}function hx(t){let{tournamentRecords:e,personRequests:i}=t,r=ze(t,[{[mn]:!0}]);if(r.error)return r;if(!i)return{...X};let n=Object.values(e);for(let a of n){let o=a.participants??[],s=[];for(let l of Object.keys(i))if(Sc({tournamentParticipants:o,personId:l})){let u=i[l];u.length&&s.push({personId:l,requests:u})}Object.keys(s).length&&Lt({element:a,extension:{value:s,name:_g}})}return{...X}}function j4(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=ze(t,[{[mn]:!0},{requests:!0,[Jn]:cn,[$a]:se}]);if(n.error)return n;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:o}=wp({tournamentRecords:e}),s=u=>{o&&(o[u]=o[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(r&&(o!=null&&o[r]))s(r);else if(o)for(let u of Object.keys(o))s(u);let l=i.filter(u=>!u.requestId);return l.length&&V4({personRequests:o,personId:r,requests:l}),hx({tournamentRecords:e,personRequests:o})}function G4(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,o=ze(t,[{[mn]:!0}]);if(o.error)return o;let{personRequests:s}=wp({tournamentRecords:e}),l=c=>{var d;s&&(s[c]=s[c].filter(p=>(!i||p.requestType!==i)&&(!r||p.requestId!==r)&&(!a||p.date!==a)),(d=s==null?void 0:s[c])!=null&&d.length||delete s[c])},u=!i&&!r&&!n&&!a;if(!u){if(n&&(s!=null&&s[n]))l(n);else if(s)for(let c of Object.keys(s))l(c)}return u||!s||!Object.keys(s).length?Un({name:_g,tournamentRecords:e,discover:!0}):hx({tournamentRecords:e,personRequests:s})}function H4(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=ze(t,[{[mn]:!0,[eoe]:!0},{requests:!0,[Jn]:cn,[$a]:se}]);if(n.error)return n;let{personRequests:a}=wp({tournamentRecords:e}),{mergeCount:o}=V4({personRequests:a,personId:i,requests:r});return o&&a?hx({tournamentRecords:e,personRequests:a}):{error:se}}function z4({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return ee({result:{error:ge},stack:r});if(!e||!t)return ee({result:{error:Xe},stack:r});let n=i.participants||[],a=n.find(m=>m.participantId===e);if(!a)return ee({result:{error:zi},stack:r});if(![Kt,qa].includes(a.participantType))return ee({result:{error:Cs},context:{participantType:a.participantType},stack:r});let o=t.filter(m=>{var h;return((h=n.find(f=>f.participantId===m))==null?void 0:h.participantType)!==St});if(o.length)return ee({result:{error:Ia,invalidParticipantIds:o},stack:r});let s=a.individualParticipantIds||[],l=t.filter(m=>!s.includes(m)),u=s.filter(m=>!t.includes(m)),c=ND({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return ee({result:c,stack:r});let d=XA({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return ee({result:d,stack:r});let{topics:p}=yo();if(p.includes(nn)){let m=n.find(({participantId:h})=>h===e);lt({topic:nn,payload:{tournamentId:i.tournamentId,participants:[m]}})}return{...c,...d}}function W4({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:ge};if(!Array.isArray(e))return{error:Xe};if(![FI,yW].includes(i))return{error:se,signInState:i};let r=t.participants||[];if(!r.length)return{error:Oy};let n=r.map(Ut),a=e.filter(u=>!n.includes(u));if(a.length)return{error:se,context:{invalidParticipantIds:a}};let o=[],s=new Date().toISOString();for(let u of r){let{participantId:c}=u;if(e.includes(c)){let d=RO({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:Yy,itemValue:i,createdAt:s}});if(d.error)return d;o.push(u)}}let{topics:l}=yo();return o.length&&l.includes(nn)&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:o}}),{...X}}function q4({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:ge};if(!e)return{error:mr};let{participant:r}=Yc({tournamentRecord:t,participantId:e});if(!r)return{error:zi};r.participantOtherName=i;let{topics:n}=yo();return n.includes(nn)&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...X}}function yV({personFormat:t,person:e}){let i=f=>f.replace(/\W/g,""),r=f=>/^[a-z]*$/.test(i(f)),n=f=>/^[A-Z]*$/.test(i(f)),a=f=>/^[LAST]{4}/.test(i(f)),o=f=>f.toLowerCase().indexOf("l")<f.toLowerCase().indexOf("f"),s=f=>f.indexOf(",")>=0,l=f=>f.toLowerCase().indexOf("f.")>=0,u=f=>f.toLowerCase().indexOf("f")<0,c=f=>f.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=BC((e==null?void 0:e.standardGivenName)??""),m=BC((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${m}`;l(t)&&!s(t)&&!o(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),m=m.toLowerCase()):n(t)?(p=p.toUpperCase(),m=m.toUpperCase()):a(t)&&(m=m.toUpperCase());let h=`${p}${d}${m}`;return u(t)?h=m:o(t)&&(s(t)?h=`${m},${d}${p}`:h=`${m}${d}${p}`),h}function phe({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,o=r&&i[r];if(r!==Vn&&o){let{personFormat:s,doublesJoiner:l}=o;r===St&&(e.participantName=yV({person:a,personFormat:s})),r===ft&&(e.participantName=n==null?void 0:n.map(u=>{var d;let c=(d=t[u])==null?void 0:d.person;return yV({person:c,personFormat:s})}).filter(Boolean).join(l??"/"))}}function Y4({tournamentRecord:t,formats:e}){if(!t)return{error:ge};if(!Nt(e))return{error:Xe};let i=t.participants??[],r=yG(i,"participantId");for(let n of i)phe({participant:n,participantMap:r,formats:e});return{...X}}function K4(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,o=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Xe,stack:"publicFindParticipant"};let s,l;for(let u of Object.values(o)){l=u.tournamentId;let c=u.participants||[];if(s=Sc({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),s)break}return{participant:s,tournamentId:l,...X}}function J4({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=sq,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:ge};if(!a)return{error:Xe,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:se};let o=(Mi({participantFilters:{participantTypes:[St]},tournamentRecord:r}).participants??[]).map(c=>c.participantId);for(let c of t)if(!o.includes(c))return{error:Cs,participantId:c};let s=je({participantId:n||Gt(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:qa,participantRole:i}),l=ll({participant:s,tournamentRecord:r});if(l.error)return l;let{topics:u}=yo();return u.includes(Dc)&&lt({topic:Dc,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...X,participant:Ce(s)}}function X4({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:ge};if(!i)return{error:mr};if(!e)return{error:Xe,info:"Missing participantName"};let{participant:r}=Yc({tournamentRecord:t,participantId:i});if(!r)return{error:zi};r.participantName=e;let{topics:n}=yo();return n.includes(nn)&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...X}}function Q4({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:u,eventId:c,event:d}){var v,y,I,b,S;if(!o)return{error:ge};if(!Array.isArray(a)&&!ot(u)&&!c||!ot(r)||n&&!Array.isArray(n)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:se};if(!s&&!n.length||!n&&!(e&&s))return{error:Xe,info:"Missing scaling details"};if(c&&!a){if((d==null?void 0:d.eventType)!==Ta)return{error:Vl};a=(v=d==null?void 0:d.entries)==null?void 0:v.filter(({entryStatus:w})=>w===sa).map(Ut)}if(!(a!=null&&a.length)&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Xe};let p=e??n.map(({participantId:w})=>w);i&&(a==null||a.reverse(),r+=1),r>((a==null?void 0:a.length)||0)-1&&(r=0);let m=(a==null?void 0:a.slice(r).concat(...a.slice(0,r)))??[],h=[];for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(m.includes(U)){if(T!==Vn)return{error:Cs,participant:w};h.push(w)}}if(u&&h.length<u){let w=u-((h==null?void 0:h.length)||0),U=l??"Team",T=Te(0,w).map(R=>({participantName:`${U} ${R+1}`,participantType:Vn,participantRole:Qr})),{participants:D=[]}=ns({participants:T,returnParticipants:!0,tournamentRecord:o}),P=D.map(Ut),E=((y=o.participants)==null?void 0:y.filter(({participantId:R})=>P.includes(R)))??[];h.push(...E)}if(!h.length)return{error:NN};if(t)for(let w of h)w.individualParticipantIds=[];else{let w=h.map(U=>U).flat();e!=null&&e.length?p=p.filter(U=>!w.includes(U)):n=n==null?void 0:n.filter(({participantId:U})=>!w.includes(U))}if(!(e!=null&&e.length)&&!(n!=null&&n.length))return{error:K0,info:"Nothing to be done"};if(!n.length){for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(!p.includes(U))continue;if(T!==St)return{error:Cs,participant:w};let D=(I=Al({scaleAttributes:s,participant:w}))==null?void 0:I.scaleItem,P=s!=null&&s.accessor?(b=D==null?void 0:D.scaleValue)==null?void 0:b[s==null?void 0:s.accessor]:D==null?void 0:D.scaleValue,E={participantId:U,scaleValue:P};n.push(E)}if(!n.length)return{error:zi}}n.sort((w,U)=>s!=null&&s.sortOrder?((U==null?void 0:U.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((U==null?void 0:U.scaleValue)||1/0));for(let w of n)if(!w.participantId)return{error:se,scaledParticipant:w};let f=0;for(;f<n.length;){for(let w of h){if(f+1>n.length)break;let U=n[f];w.individualParticipantIds.push(U.participantId),f++}h.reverse()}let g=h.map(Ut);for(let w of o.events??[]){if(w.eventType!==Ta)continue;let U=(w.entries??[]).filter(T=>g.includes(T.participantId));for(let T of U){let D=T.participantId,P=(S=h.find(R=>R.participantId===D))==null?void 0:S.individualParticipantIds;w.entries=(w.entries??[]).filter(R=>!P.includes(R.participantId)),(w.drawDefinitions??[]).forEach(R=>{R.entries=(R.entries??[]).filter(N=>!P.includes(N.participantId))});let{flightProfile:E}=Gi({event:w});((E==null?void 0:E.flights)||[]).forEach(R=>{R.drawEntries=(R.drawEntries||[]).filter(N=>!P.includes(N.participantId))})}}return{...X,scaledParticipants:n}}function Z4(t){let e=ze(t,[{[wr]:!0,[iA]:!0},{ratingType:!1,[Kr]:o=>Nr[o]}]);if(e.error)return e;let i=`${t.ratingType}.${oA}`,r=t.asDynamic?i:t.ratingType,n=[xd,vc,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let o of a)o.timeItems&&(o.timeItems=o.timeItems.filter(s=>s.itemType!==n));return{...X}}function e5(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Oi};for(let i of Object.values(e)){let r=mhe({...t,tournamentRecord:i});if(r.error&&r.error!==Cf)return r}return{...X}}function mhe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:ge};if(!e)return{error:PN};let i=(t==null?void 0:t.participants)??[],r=[],n=!1,a;return i.forEach(o=>{let s=!1;o.penalties=(o.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,n||(a=l,n=!0)),s&&r.push(o),l.penaltyId!==e))}),a&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...X,penalty:a}:{error:Cf}}var hhe=({penaltyId:t=Gt()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),t5=hhe;function i5(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Oi};for(let i of Object.values(e)){let r=fhe({...t,tournamentRecord:i});if(r.error&&r.error!==Cf||r.success)return r}return{error:Cf}}function fhe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:ge};if(!e)return{error:se,modifications:e};if(!i)return{error:PN};let r=(t==null?void 0:t.participants)??[],n=Object.keys(t5()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:J0};let o,s=[];return r.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),o||(o=c)),c)),u&&s.push(l)}),o&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:s}}),o?{...X,penalty:o}:{error:Cf}}function r5(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:ct(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=ct(t[n].map(o=>JSON.stringify(o)).concat(e[n].map(o=>JSON.stringify(o)))).map(o=>JSON.parse(o));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=r5(t[n],e[n],i):r[n]=e[n];return r},{})}function n5({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:ge};e.participants||(e.participants=[]);let r=t.filter(Da(zl)).map(u=>({[u.participantId]:u})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(u=>{if(n[u.participantId]){let c=r5(u,n[u.participantId],i);return a.push(c),c}return u});let o=e.participants.map(Da(zl))||[],s=t.filter(({participantId:u})=>!o.includes(u)),{topics:l}=yo();return s.length&&(e.participants=e.participants.concat(...s),l.includes(Dc)&&lt({topic:Dc,payload:{participants:s}})),a.length&&l.includes(nn)&&lt({topic:nn,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...X}}function a5(t){var a;let{tournamentRecord:e,participantIds:i}=t,r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n;for(let o of Object.values(r)){let s=(a=Mi({tournamentRecord:o}).participants??[])==null?void 0:a.map(Ut).filter(l=>i.includes(l));s.length&&(n=ghe({...t,penaltyId:t.penaltyId??n,tournamentRecord:o,participantIds:s}).penaltyId)}return n?{...X,penaltyId:n}:{error:zi}}function ghe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:u}){if(!e)return{error:ge};if(!i)return{error:mr};if(!n)return{error:cH};let c=((e==null?void 0:e.participants)??[]).filter(m=>i.includes(m.participantId));if(!c.length)return{error:zi};let d=new Date().toISOString(),p=Object.assign(t5({penaltyId:o}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:s,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(m=>Lt({element:p,extension:m})),c.forEach(m=>{m.penalties||(m.penalties=[]),m.penalties.push(p)}),lt({topic:nn,payload:{tournamentId:e.tournamentId,participants:c}}),{...X,penaltyId:p.penaltyId}}function o5({participantRole:t=Qr,tournamentRecord:e,persons:i}){var h;if(!e)return{error:ge};if(!Array.isArray(i))return{error:se};if(!Object.keys(JA).includes(t))return{error:ZG};let r=(e.participants||[]).map(({person:f})=>f==null?void 0:f.personId).filter(Boolean),n=[],a=i.filter(f=>f&&(!f.personId||!r.includes(f.personId))).map(f=>(f.personId||(f.personId=Gt()),n.push(f.personId),f)),o=(f,g)=>Object.assign({},...Object.keys(f).filter(v=>!g.includes(v)).map(v=>({[v]:f[v]}))),s=a.map(f=>je({extensions:f.participantExtensions,timeItems:f.participantTimeItems,participantType:St,participantRole:t,person:o(f,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,u=0,c=ns({participants:s,tournamentRecord:e});if(c.error)return c;u=c.addedCount||0;let d=[],p=((h=Mi({participantFilters:{participantTypes:[St]},tournamentRecord:e}))==null?void 0:h.participants)??[];if(t===Qr&&i.filter(({pairedPersons:f})=>f).forEach(({personId:f,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[f,v.personId].map(I=>Sc({tournamentParticipants:p,personId:I})).filter(Boolean);if(y.length===2){let I=y.map(Ut);d.push(je({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:Qr,individualParticipantIds:I,participantType:ft}))}})}),d.length){if(c=ns({participants:d,tournamentRecord:e}),c.error)return c;l=c.addedCount||0}let m=u+l;return{...X,addedCount:m,newPersonIds:n}}var s5={};bt(s5,{bulkUpdatePublishedEventIds:()=>dk,getAllEventData:()=>pk,getCourtInfo:()=>kT,getDrawData:()=>pD,getEventData:()=>mD,getEventPublishStatus:()=>To,getPublishState:()=>dh,getTournamentPublishStatus:()=>db,getVenueData:()=>jf,mutate:()=>l5,publishEvent:()=>Zg,publishEventSeeding:()=>u5,publishOrderOfPlay:()=>h5,publishParticipants:()=>m5,query:()=>K6,setEventDisplay:()=>PD,unPublishEvent:()=>f5,unPublishEventSeeding:()=>c5,unPublishOrderOfPlay:()=>p5,unPublishParticipants:()=>d5});var l5={};bt(l5,{publishEvent:()=>Zg,publishEventSeeding:()=>u5,publishOrderOfPlay:()=>h5,publishParticipants:()=>m5,setEventDisplay:()=>PD,unPublishEvent:()=>f5,unPublishEventSeeding:()=>c5,unPublishOrderOfPlay:()=>p5,unPublishParticipants:()=>d5});function u5({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=Ya,drawIds:a=[],event:o}){var d,p,m,h;if(!r)return{error:ge};if(!o)return{error:vi};let s=To({event:o,status:n}),l=(((d=s==null?void 0:s.seeding)==null?void 0:d.seedingScaleNames)||i)&&{...(p=s==null?void 0:s.seeding)==null?void 0:p.seedingScaleNames,...i},u=(((m=s==null?void 0:s.seeding)==null?void 0:m.stageSeedingScaleNames)||e)&&{...(h=s==null?void 0:s.seeding)==null?void 0:h.stageSeedingScaleNames,...e},c=je({stageSeedingScaleNames:u,seedingScaleNames:l,published:!0,drawIds:a});return Qg({statusObject:{seeding:c},removePriorValues:t,status:n,event:o}),lt({topic:hW,payload:{tournamentId:r.tournamentId,eventId:o.eventId,drawIds:a}}),{...X}}function c5({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=Ya,drawIds:n,stages:a,event:o}){var l,u;if(!i)return{error:ge};if(!o)return{error:vi};let s=To({event:o});if(s){let c=s.seeding;if(Array.isArray(a)&&c.stageSeedingScaleNames)for(let d of a)c.stageSeedingScaleNames[d]&&delete c.stageSeedingScaleNames[d];Array.isArray(e)&&(c!=null&&c.seedingScaleNames)&&(c.seedingScaleNames=c.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(n)&&(c!=null&&c.drawIds)&&(c.drawIds=c.drawIds.filter(d=>!n.includes(d))),(!Object.values(c.stageSeedingScaleNames??{}).length&&!((l=c.seedingScaleNames)!=null&&l.length)&&!((u=c.drawIds)!=null&&u.length)||!a&&!e&&!(n!=null&&n.length))&&(delete c.stageSeedingScaleNames,delete c.seedingScaleNames,delete c.drawIds,c.published=!1),Qg({statusObject:{seeding:c},removePriorValues:t,status:r,event:o})}return lt({topic:EA,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...X}}function d5(t){let e=bo(t);if(!Object.keys(e).length)return{error:Oi};for(let i of Object.values(e)){let r=vhe({tournamentRecord:i,...t});if(r.error)return r}return{...X}}function vhe({removePriorValues:t=!0,tournamentRecord:e,status:i=Ya}){if(!e)return{error:ge};let r=`${Kc}.${Jc}`,{timeItem:n}=wo({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].participants,bl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),lt({payload:{tournamentId:e.tournamentId},topic:Coe}),{...X}}function p5(t){let e=bo(t);if(!Object.keys(e).length)return{error:Oi};for(let i of Object.values(e)){let r=Ihe({tournamentRecord:i,...t});if(r.error)return r}return{...X}}function Ihe({removePriorValues:t=!0,tournamentRecord:e,status:i=Ya}){if(!e)return{error:ge};let r=`${Kc}.${Jc}`,{timeItem:n}=wo({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,bl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),lt({topic:CA,payload:{tournamentId:e.tournamentId}}),{...X}}function m5(t){let e=bo(t);if(!Object.keys(e).length)return{error:Oi};for(let i of Object.values(e)){let r=yhe({tournamentRecord:i,...t});if(r.error)return r}return{...X}}function yhe({removePriorValues:t,tournamentRecord:e,status:i=Ya}){if(!e)return{error:ge};let r=`${Kc}.${Jc}`,{timeItem:n}=wo({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i].participants={published:!0},bl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),lt({payload:{tournamentId:e.tournamentId},topic:gW}),{...X}}function h5(t){let e=bo(t);if(!Object.keys(e).length)return{error:Oi};for(let i of Object.values(e)){let r=bhe({tournamentRecord:i,...t});if(r.error)return r}return{...X}}function bhe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=Ya,eventIds:n=[]}){if(!i)return{error:ge};let a=`${Kc}.${Jc}`,{timeItem:o}=wo({element:i,itemType:a}),s=(o==null?void 0:o.itemValue)||{[r]:{}};return s[r].orderOfPlay={published:!0,scheduledDates:t,eventIds:n},bl({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:e}),lt({topic:fW,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...X}}function f5({removePriorValues:t=!0,tournamentRecord:e,status:i=Ya,event:r}){if(!e)return{error:ge};if(!r)return{error:vi};let n=`${Kc}.${Jc}`,{timeItem:a}=Ky({itemType:n,event:r}),o=(a==null?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,fh({event:r,timeItem:{itemValue:o,itemType:n},removePriorValues:t}),Qg({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),lt({topic:RA,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...X}}var g5={};bt(g5,{getEntryStatusReports:()=>Uhe,getParticipantStats:()=>whe,getStructureReports:()=>The,getVenuesReport:()=>Phe});function whe({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:o,matchUps:s}){var U,T,D,P,E;if(!n)return{error:ge};if(s&&!Array.isArray(s))return{error:oa};if(s=s??Vr({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(s!=null&&s.length))return{error:Gu};let l=[];e&&l.push(e),r&&l.push(r);let u=l.length?{participantIds:l}:{participantTypes:[Vn]},c=Mi({participantFilters:u,tournamentRecord:n}).participants??[];if(!c.every(({participantType:R})=>R===Vn))return{error:Ia};l.length||l.push(...c.map(Ut));let d=new Map,p=new Map,m=new Map,h=new Map,f=(R,N="")=>p.get(R)||p.set(R,{participantName:N,participantId:R,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(R);for(let R of c){let{participantId:N,individualParticipantIds:A}=R;h.set(N,A??[]),f(N,R.participantName)}if(r&&!h.get(r))return ee({result:{error:zi},context:{teamParticipantId:r}});if(e&&!h.get(e))return ee({result:{error:zi},context:{opponentParticipantId:e}});let g=[],v=R=>{let N=[[],[]];for(let M of R){let C=M.participant;if(C!=null&&C.participantName){d.set(C.participantId,{participantName:C.participantName,ratings:C.ratings});let O=p.get(C.participantId);O&&(O.participantName=C.participantName)}}let A=({side:M,individualParticipantIds:C})=>{var O,k,x,F,$;return M.participantId&&(!(C!=null&&C.length)||C.includes(M.participantId))&&[M.participantId]||((k=(O=M.participant)==null?void 0:O.individualParticipantIds)==null?void 0:k.length)&&(!(C!=null&&C.length)||Vi(C,(x=M.participant)==null?void 0:x.individualParticipantIds).length===(($=(F=M.participant)==null?void 0:F.individualParticipantIds)==null?void 0:$.length))&&M.participant.individualParticipantIds};if(h.size){let M=(C,O)=>{for(let k of R){if(!k.participant)continue;let x=A({individualParticipantIds:O,side:k});if(x!=null&&x.length){let F=k.sideNumber;if(!F)continue;let $=[C];i&&$.push(...x),N[F-1]=$;let _=p.get(C);for(let L of x.filter(Boolean))_&&!_.competitorIds.includes(L)&&_.competitorIds.push(L)}}};if(r)(!e||R.every(C=>C.participant&&(A({individualParticipantIds:h.get(r),side:C})||A({individualParticipantIds:h.get(e),side:C}))))&&M(r,h.get(r));else for(let[C,O]of h)M(C,O)}else if(i)for(let M of R){if(!M.participant)continue;let C=A({individualParticipantIds:[],side:M}),O=M.sideNumber;O&&(N[O-1]=C)}return N};for(let R of s){if(!Nt(R))return{error:oa};let{matchUpStatus:N,matchUpFormat:A,matchUpType:M,winningSide:C,score:O,sides:k}=R;if(!k||!O||M===xa||N===Vt)continue;let x=v(k);if(!x.filter(Boolean).length)continue;let F=t&&C&&((U=nb({matchUp:R}))==null?void 0:U.competitiveness);g.push(R);let $=bO({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:C,score:O}),_=t3({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:C,score:O}),{pointsTally:L,tiebreaksTally:B}=i3({matchUpFormat:A,score:O});x.forEach((V,G)=>{var j;for(let z of V){let W=(j=d.get(z))==null?void 0:j.participantName,q=f(z,W);if(q){let Y=(K,ie)=>ie.forEach((ae,oe)=>q[K][oe]+=ae),re=G?[...B].reverse():B,J=G?[...L].reverse():L,H=G?[..._].reverse():_,Z=G?[...$].reverse():$;if(Y("tiebreaks",re),Y("points",J),Y("games",H),Y("sets",Z),C){let K=C-1===G?0:1;q.matchUps[K]+=1}if(F){let K=F.toLowerCase();q.competitiveness[K]||(q.competitiveness[K]=[0,0]),q.competitiveness[K][G]+=1}if(N){let K=N.toLowerCase();q.matchUpStatuses[K]||(q.matchUpStatuses[K]=0),q.matchUpStatuses[K]+=1}}}})}let y=["tiebreaks","matchUps","points","games","sets"],I=["competitive","routine","decisive"],b=new Map,S=(R,N)=>(R??0)+(N??0);for(let[R,N]of p.entries()){for(let A of y){let M=N[A].reduce(S);if(M){let C=N[A][0]/M,O=`${A}Ratio`,k=parseFloat(C.toFixed(2));N[O]=k,m.set(R,!0),b.has(O)||b.set(O,[]),(T=b.get(O))==null||T.push(k)}}for(let A of I){let M=(P=(D=N.competitiveness)==null?void 0:D[A])==null?void 0:P.reduce(S);if(M){let C=N.competitiveness[A][0]/M,O=`${A}Ratio`,k=parseFloat(C.toFixed(2));N[O]=k}}}if(!r){let R=(N,A)=>A-N;for(let N of p.values())for(let A of y){let M=`${A}Ratio`;if(typeof N[M]=="number"){let C=(E=b.get(M))==null?void 0:E.sort(R).indexOf(N[M]);if(typeof C=="number"&&C>=0){let O=`${A}Rank`;N[O]=C+1}}}}let w={relevantMatchUps:g,...X};return r?(w.teamStats=p.get(r),e&&(w.opponentStats=p.get(e))):w.participatingTeamsCount=m.size,w.allParticipantStats=[...p.values()],w}function WS({participant:t,eventType:e}){var u,c,d,p,m,h;let i=(u=t==null?void 0:t.person)==null?void 0:u.personId,r=(d=(c=t==null?void 0:t.person)==null?void 0:c.personOtherIds)==null?void 0:d[0],n=(p=t==null?void 0:t.person)==null?void 0:p.tennisId,a=(h=(m=t==null?void 0:t.ratings)==null?void 0:m[e])==null?void 0:h.find(({scaleName:f})=>f===yO),o=a==null?void 0:a.scaleValue,{wtnRating:s,confidence:l}=o||{};return{timeStamp:a==null?void 0:a.scaleDate,personOtherId:r,confidence:l,wtnRating:s,personId:i,tennisId:n}}function Uhe({tournamentRecord:t}){if(!t)return{error:ge};let e=t.tournamentId,{participantMap:i}=Mi({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(Vr({matchUpFilters:{matchUpTypes:[Jp,Md]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:m,matchUpType:h})=>m==null?void 0:m.flatMap(f=>{var g,v;return h===Md?(g=f==null?void 0:f.participant)==null?void 0:g.individualParticipantIds:((v=f==null?void 0:f.participant)==null?void 0:v.participantId)||f.participantId}).filter(Boolean)).filter(Boolean),n=[],a={},o={},s={},l=0,u=({id:m,entry:h,eventId:f,eventType:g})=>{var P;let{qualifyingSeeding:v,mainSeeding:y,entryStatus:I,entryStage:b,drawId:S}=h;a[m]||(a[m]=[]);let{participant:w,events:U}=(i==null?void 0:i[m])??{},T=WS({participant:w,eventType:g}),D=(P=U==null?void 0:U[f])==null?void 0:P.ranking;I===hO&&n.push(m),a[m].push({participantType:w==null?void 0:w.participantType,participantId:m,tournamentId:e,eventType:g,eventId:f,drawId:S,entryStatus:I,entryStage:b,...T,ranking:D,mainSeeding:y,qualifyingSeeding:v})};for(let m of t.events??[]){let h={},f=U=>{h[U]||(h[U]={count:0}),h[U].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=m,I=g.flatMap(U=>{let{drawId:T,entries:D}=U;l+=1;let P=({stage:A,stageSequence:M})=>A===Oe&&M===1||A===Ke,E=(U.structures??[]).filter(P).flatMap(({positionAssignments:A})=>A).filter(Boolean).map(({participantId:A})=>A),R=({participantId:A})=>E.includes(A),N=A=>{var x,F,$,_,L,B,V,G;let{participantId:M,entryStatus:C,entryStage:O}=A;f(C);let k=(_=($=(F=(x=i==null?void 0:i[M])==null?void 0:x.draws)==null?void 0:F[T])==null?void 0:$.seedAssignments)==null?void 0:_[Oe];return{qualifyingSeeding:(G=(V=(B=(L=i==null?void 0:i[M])==null?void 0:L.draws)==null?void 0:B[T])==null?void 0:V.seedAssignments)==null?void 0:G[Ke],participantId:M,mainSeeding:k,entryStatus:C,entryStage:O,drawId:T}};return D==null?void 0:D.filter(R).map(N)}),b=U=>{var P;let T=U.participantId,D=(P=i==null?void 0:i[T].participant.individualParticipantIds)==null?void 0:P.filter(E=>r.includes(E));return T&&{[T]:{individualParticipantIds:D}}};v===Uu?(()=>{let U=Object.assign({},...I.map(b).filter(Boolean)),T=D=>{U[D.participantId].individualParticipantIds.forEach(P=>{u({id:P,eventType:v,eventId:y,entry:D})})};I.forEach(T)})():I.forEach(U=>{u({id:U==null?void 0:U.participantId,eventType:v,eventId:y,entry:U})});let S=Object.values(h).reduce((U,T)=>U+T.count,0);Object.keys(h).forEach(U=>{h[U].pct=h[U].count/S*100}),s[y]={tournamentId:e,eventId:y,entries:I,entryStatuses:h};let w=Object.assign({},...ds.flatMap(U=>{var T,D;return[{[U+"_count"]:(T=h[U])==null?void 0:T.count},{[U+"_pct"]:(D=h[U])==null?void 0:D.pct}]}));o[y]={tournamentId:e,eventId:y,...w}}let c=Object.values(i??{}).filter(({participant:{participantType:m,participantRole:h}})=>m===St&&h===Qr),d=c.filter(({participant:m})=>!r.includes(m.participantId)).map(({participant:m})=>m.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function She({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=h=>{let f=h==null?void 0:h.matchUpFormat;f&&(n[f]||(n[f]=0),n[f]+=1)},o=e.filter(h=>i?h.eventId===i:h.drawId===r).reduce((h,f)=>(a(f),(f.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>h[g.participantId]=g),h),{}),s=Object.values(o),l=s.map(h=>WS({participant:h,eventType:t})).filter(({wtnRating:h})=>h),u=(s.length-l.length)/s.length*100,c=l.reduce((h,f)=>{let{wtnRating:g,confidence:v}=f;return h.totalWTN+=g,h.totalConfidence+=v,h},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?c.totalWTN/l.length:0,p=l!=null&&l.length?c.totalConfidence/l.length:0,m=Object.values(n).reduce((h,f)=>h+(f||0),0);return{matchUpFormatCounts:n,matchUpsCount:m,avgConfidence:p,pctNoRating:u,avgWTN:d}}function The(t){var h;let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:r}=t;if(!e)return{error:Rf};let n=[],a={},o={},s=[],l=Object.assign({},...(i??[]).map(({name:f,label:g,accessor:v})=>{var b,S,w;let y=(S=(b=vt({element:e,name:f}))==null?void 0:b.extension)==null?void 0:S.value,I=v?(w=em({element:y,accessor:v}))==null?void 0:w.value:y;return{[g||f]:I}})),u=e==null?void 0:e.tournamentId,c=Vr({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],d=f=>{var g,v,y;return(y=(v=(g=wo({itemType:gA,itemSubTypes:[Ml],element:{timeItems:f}}))==null?void 0:g.timeItem)==null?void 0:v.itemValue)==null?void 0:y.scaleBasis},p=({positionManipulations:f})=>{f==null||f.forEach(g=>{let{structureId:v,name:y}=g,I=g.drawPositions||[g.drawPosition];a[v]||(a[v]=[]),a[v].push(`${y}: ${I.join("/")}`)})},m=(h=e==null?void 0:e.events)==null?void 0:h.flatMap(({timeItems:f,drawDefinitions:g=[],extensions:v,eventType:y,eventName:I,eventId:b,category:S})=>{var A,M,C,O;let w=(C=(M=(A=v==null?void 0:v.find(k=>k.name===ts))==null?void 0:A.value)==null?void 0:M.flights)==null?void 0:C.map(k=>({[k.drawId]:k.flightNumber})),U=w&&Object.assign({},...w),T=v==null?void 0:v.find(k=>k.name===Pd),D=f==null?void 0:f.find(k=>k.itemType===Pd),P=((O=T==null?void 0:T.value)==null?void 0:O.length)||(D==null?void 0:D.itemValue)||0,E=Object.values(U??{}),R=U&&Math.min(...E),N=d(f);return o[b]={seedingBasis:N?JSON.stringify(N):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:P,tournamentId:u,eventId:b},g.filter(k=>!r||!w||U[k.drawId]===R).flatMap(k=>{let{matchUpFormat:x,tieFormat:F,timeItems:$,extensions:_,structures:L,drawName:B,drawType:V,drawId:G}=k,{matchUpFormatCounts:j,matchUpsCount:z,avgConfidence:W,pctNoRating:q,avgWTN:Y}=She({eventType:y,matchUps:c,drawId:G}),re=d($)||N,J=Dhe({extensions:_}),H=(J==null?void 0:J.length)||0;return p({positionManipulations:J}),o[b].totalPositionManipulations+=H,o[b].generatedDrawsCount+=1,H>o[b].maxPositionManipulations&&(o[b].maxPositionManipulations=H),L==null?void 0:L.filter(Z=>Z.stageSequence===1&&[Ke,Oe,rn,$i].includes(Z.stage)).map(Z=>{var Ae,yt,yi;let K=[Oe,$i].includes(Z.stage)?c.find(be=>be.structureId===Z.structureId&&be.finishingRound===1&&be.winningSide):void 0;Z.stage===Oe&&n.push({eventName:I,drawName:B,structureId:Z.structureId});let ie=(yt=(Ae=K==null?void 0:K.sides)==null?void 0:Ae.find(be=>be.sideNumber===K.winningSide))==null?void 0:yt.participant,ae=(ie==null?void 0:ie.participantType)===Vn&&ie.participantId,oe=(ie==null?void 0:ie.participantType)===ft?ie.individualParticipants:[],ne=WS({participant:(oe==null?void 0:oe[0])||ie,eventType:y}),{personId:de,personOtherId:ye,tennisId:ce,confidence:ke,wtnRating:we}=ne||{},Ze=WS({participant:oe==null?void 0:oe[1],eventType:y}),{personId:pt,personOtherId:he,tennisId:fe,confidence:pe,wtnRating:Fe}=Ze||{},{ageCategoryCode:Se,categoryName:He,subType:ue}=S??{},me=Z.matchUpFormat||x,Ue=(j[me]||0)/z*100,{tieFormatName:$e,tieFormatDesc:Ee}=$S(F),{tieFormatName:Be,tieFormatDesc:xe}=$S(Z.tieFormat),qe=Ee===xe,Pe=!qe&&Be,at=Z.tieFormat&&!qe&&xe,di=((yi=J==null?void 0:J.filter(be=>be.structureId===Z.structureId))==null?void 0:yi.length)||0;return{...l,tournamentId:u,eventId:b,structureId:Z.structureId,drawId:G,eventType:y,category:ue,categoryName:He,ageCategoryCode:Se,flightNumber:U==null?void 0:U[G],drawType:V,stage:Z.stage,seedingBasis:re?JSON.stringify(re):void 0,winningPersonId:de,winningPersonOtherId:ye,winningPersonTennisId:ce,winningPersonWTNrating:we,winningPersonWTNconfidence:ke,winningPerson2Id:pt,winningPerson2OtherId:he,winningPerson2TennisId:fe,winningPerson2WTNrating:Fe,winningPerson2WTNconfidence:pe,winningTeamId:ae,positionManipulations:di,pctNoRating:q,matchUpFormat:me,pctInitialMatchUpFormat:Ue,matchUpsCount:z,drawTieFormatName:$e,drawTieFormatDesc:Ee,tieFormatName:Pe,tieFormatDesc:at,avgConfidence:W,avgWTN:Y}})})});return n.forEach(({eventName:f,drawName:g,structureId:v})=>{var y;(y=a[v])!=null&&y.length&&s.push({eventName:f,drawName:g,actions:a[v]})}),{eventStructureReports:Object.values(o),structureReports:m,flightReports:s}}function Dhe({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:r})=>r===bf))==null?void 0:e.value)==null?void 0:i.slice(1)}function Phe({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){var c,d;if(!Array.isArray(n))return{error:se,dates:n};if(!Array.isArray(r))return{error:se,venueIds:r};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:Oi};if(!n.every(ya))return{error:Ar};let a=Ju({tournamentRecords:e,ignoreDisabled:t,dates:n});if(a.error)return a;let o=(c=a==null?void 0:a.venues)==null?void 0:c.filter(({venueId:p})=>!(r!=null&&r.length)||r.includes(p)),s=(d=a.courts)==null?void 0:d.reduce((p,m)=>{var h;return(h=m.dateAvailability)==null||h.forEach(f=>{let g=f.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!n.length||n.includes(p)),l={venueIds:o==null?void 0:o.map(({venueId:p})=>p)},{matchUps:u}=As({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:o==null?void 0:o.map(p=>Rhe(s,p,u))}}function Rhe(t,e,i){let{venueId:r,courts:n,venueName:a}=e,o={};return t.forEach(s=>{var m;let l=0,u=0,c=0;for(let h of n){let f=h.dateAvailability.find(v=>v.date===s),g=(m=f&&ev({courtDate:f}).timeSlots)==null?void 0:m.reduce((v,y)=>{let{startTime:I,endTime:b}=y,S=Ot(b)-Ot(I);return v+S},0);g&&(c+=1),l+=g}let d=i.filter(({schedule:h})=>h.venueId===r&&jl(s,h.scheduledDate));d.forEach(({schedule:h})=>{let f=wi(h.scheduledTime),g=ra(f,h.averageMinutes),v=Ot(g)-Ot(f);u+=v});let p=l?(u/l*100).toFixed(2):"100";o[s]={scheduledMatchUpsCount:d.length,availableCourts:c,availableMinutes:l,scheduledMinutes:u,percentUtilization:p}}),{venueId:r,venueName:a,venueReport:o}}var fx={};bt(fx,{addMatchUpCourtOrder:()=>Yk,addMatchUpEndTime:()=>Jk,addMatchUpOfficial:()=>i4,addMatchUpResumeTime:()=>Qk,addMatchUpScheduleItems:()=>xD,addMatchUpScheduledDate:()=>OD,addMatchUpScheduledTime:()=>Qc,addMatchUpStartTime:()=>Kk,addMatchUpStopTime:()=>Xk,addSchedulingProfileRound:()=>dx,allocateTeamMatchUpCourts:()=>kD,assignMatchUpCourt:()=>yh,assignMatchUpVenue:()=>iv,bulkRescheduleMatchUps:()=>T5,bulkScheduleMatchUps:()=>jb,bulkScheduleTournamentMatchUps:()=>WI,bulkUpdateCourtAssignments:()=>b5,calculateScheduleTimes:()=>gx,clearMatchUpSchedule:()=>P5,clearScheduledMatchUps:()=>LD,courtGridRows:()=>ID,findMatchUpFormatTiming:()=>fD,findVenue:()=>tu,generateBookings:()=>FD,generateVirtualCourts:()=>ED,getMatchUpsToSchedule:()=>hD,getPersonRequests:()=>wp,getProfileRounds:()=>vD,getScheduledRoundsDetails:()=>Nb,getSchedulingProfile:()=>Xu,getSchedulingProfileIssues:()=>mk,matchUpScheduleChange:()=>D5,modifyMatchUpFormatTiming:()=>Ak,mutate:()=>v5,proAutoSchedule:()=>y5,proConflicts:()=>U5,publicFindCourt:()=>jA,query:()=>eY,removeEventMatchUpFormatTiming:()=>DD,removeMatchUpCourtAssignment:()=>I5,reorderUpcomingMatchUps:()=>S5,scheduleMatchUps:()=>w5,scheduleProfileRounds:()=>_D,setMatchUpDailyLimits:()=>R5,setMatchUpHomeParticipantId:()=>qk,setSchedulingProfile:()=>Kg,toggleParticipantCheckInState:()=>MD,validateSchedulingProfile:()=>gD});var v5={};bt(v5,{addMatchUpCourtOrder:()=>Yk,addMatchUpEndTime:()=>Jk,addMatchUpOfficial:()=>i4,addMatchUpResumeTime:()=>Qk,addMatchUpScheduleItems:()=>xD,addMatchUpScheduledDate:()=>OD,addMatchUpScheduledTime:()=>Qc,addMatchUpStartTime:()=>Kk,addMatchUpStopTime:()=>Xk,addSchedulingProfileRound:()=>dx,allocateTeamMatchUpCourts:()=>kD,assignMatchUpCourt:()=>yh,assignMatchUpVenue:()=>iv,bulkRescheduleMatchUps:()=>T5,bulkScheduleMatchUps:()=>jb,bulkScheduleTournamentMatchUps:()=>WI,bulkUpdateCourtAssignments:()=>b5,calculateScheduleTimes:()=>gx,clearMatchUpSchedule:()=>P5,clearScheduledMatchUps:()=>LD,findMatchUpFormatTiming:()=>fD,generateBookings:()=>FD,generateVirtualCourts:()=>ED,matchUpScheduleChange:()=>D5,modifyMatchUpFormatTiming:()=>Ak,proAutoSchedule:()=>y5,proConflicts:()=>U5,removeEventMatchUpFormatTiming:()=>DD,removeMatchUpCourtAssignment:()=>I5,reorderUpcomingMatchUps:()=>S5,scheduleMatchUps:()=>w5,scheduleProfileRounds:()=>_D,setMatchUpDailyLimits:()=>R5,setMatchUpHomeParticipantId:()=>qk,setSchedulingProfile:()=>Kg,toggleParticipantCheckInState:()=>MD,validateSchedulingProfile:()=>gD});function gx({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:Oi};o=o??CD({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=Ju({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),m=d==null?void 0:d.filter(P=>!u||u.includes(P.venueId));l||(l=m==null?void 0:m.reduce((P,E)=>{var N,A;let R=((A=(N=E.dateAvailability)==null?void 0:N.find(M=>!M.date||jl(s,M.date)))==null?void 0:A.startTime)??E.startTime;return R&&(!P||Ot(R)<Ot(P))?R:P},void 0)),c||(c=m==null?void 0:m.reduce((P,E)=>{var N,A;let R=((A=(N=E.dateAvailability)==null?void 0:N.find(M=>!M.date||jl(s,M.date)))==null?void 0:A.endTime)??E.endTime;return R&&(!P||Ot(R)>Ot(P))?R:P},void 0));let h=Object.values(a),f=Object.assign({},...h.map(P=>(P.events??[]).map(E=>{let{scheduleTiming:R}=Jy({tournamentRecord:P,event:E});return{[E.eventId]:{event:E,scheduleTiming:R}}})).flat()),g=kb({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:u}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],I=[];I.push(...v),I.push(...y);let b={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},S=I==null?void 0:I.map(({eventId:P,schedule:E,matchUpFormat:R})=>{let{event:N,scheduleTiming:A}=f[P],M=N==null?void 0:N.eventType,C={...A,defaultTiming:b,matchUpFormat:R},{averageMinutes:O,recoveryMinutes:k}=OT({eventType:M,timingDetails:C}),{courtId:x,venueId:F}=E,$=wi(E.scheduledTime),_=ra($,O);return{recoveryMinutes:k,averageMinutes:O,periodLength:o,startTime:$,endTime:_,courtId:x,venueId:F}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:s,clearScheduleDates:n,periodLength:o,startTime:l,endTime:c,bookings:S,courts:m},{scheduleTimes:U}=Vk(w),T=(u==null?void 0:u.length)===1&&u[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,D=I.map(Dr);return{venueId:T,scheduleTimes:U,dateScheduledMatchUpIds:D}}function I5(t){var m;let e=ze(t,[{[mn]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:o,courtId:s,drawId:l}=t,u=r[n];if(!u)return{error:ge};let{drawDefinition:c,event:d}=Xc({tournamentRecord:u,drawId:l});if(!c)return{error:Le};let p=Ui({drawDefinition:c,event:d,matchUpId:o});if(p.error)return p;if(((m=p==null?void 0:p.matchUp)==null?void 0:m.matchUpType)===xa){let{itemValue:h}=vp({timeItems:p.matchUp.timeItems??[],itemType:Wl}),f=s&&h.filter(g=>g.courtId!==s);return Pa({duplicateValues:!1,removePriorValues:i,tournamentRecord:u,drawDefinition:c,matchUpId:o,timeItem:{itemType:Wl,itemValue:f}})}else return yh({tournamentRecord:u,drawDefinition:c,courtDayDate:a,courtId:"",matchUpId:o})}function y5({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:r}){if(!So(r))return{error:se};if(r.some(({hasContext:m})=>!m))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Y0};let n=kb({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(n.error)return n;let{rows:a}=n,o=[],s=m=>[(m.sides||[]).map(h=>{var f;return[h.participantId,(f=h.participant)==null?void 0:f.individualParticipantIds]}),(m.potentialParticipants||[]).flat().map(h=>[h.participantId,h.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((m,h)=>{let f=[],g=[];Object.values(h).forEach(y=>{if(Nt(y)&&(y.matchUpId&&(f.push(y.matchUpId),o.push(y)),y.sides)){let I=s(y);g.push(...I)}});let v=Object.values(h).filter(y=>Nt(y)&&!y.matchUpId);return m.concat({matchUpIds:f,availableCourts:v,rowId:h.rowId,participantIds:g})},[]);r.filter(({matchUpStatus:m})=>m&&m!==Vt&&(t||!vr.includes(m))).sort(ch);let u=ps({matchUps:r.concat(o),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,c=[],d=[];for(;r.length&&l.length;){let m=l.shift(),h=[];for(;r.length&&m.availableCourts.length;){let f=r.concat(h).map(T=>T.matchUpId),g=r.shift(),v=g==null?void 0:g.matchUpId,y=v&&u[v].matchUpIds.concat(u[v].dependentMatchUpIds),I=v&&f.some(T=>u[v].matchUpIds.includes(T)),b=v&&d.some(T=>u[v].dependentMatchUpIds.includes(T)),S=m.matchUpIds.some(T=>y.includes(T)),w=s(g),U=m.participantIds.some(T=>w.includes(T));if(g&&!S&&!I&&!U&&!b){let T=m.availableCourts.shift();Object.assign(g.schedule,T.schedule),Object.assign(T,g),c.push(g),m.participantIds.push(...w),m.matchUpIds.push(v)}else g&&h.push(g)}r.push(...h),d.push(...m.matchUpIds)}let p=c.map(({matchUpId:m,tournamentId:h,schedule:f,drawId:g})=>({tournamentId:h,matchUpId:m,drawId:g,schedule:{...f,scheduledDate:i}}));return n=jb({tournamentRecords:e,matchUpDetails:p}),{...n,scheduled:c,notScheduled:r}}function b5(t){let{courtDayDate:e}=t,i=ze(t,[{courtAssignments:!0,[Jn]:cn,[$a]:Xe},{[mn]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,o)=>{let{tournamentId:s}=o;return a[s]||(a[s]=[]),a[s].push(o),a},{}),n;return Object.keys(r).every(a=>{let o=t[mn][a];if(!o)return n={error:ge},!1;let s=r[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(s).every(l=>{let{drawDefinition:u}=Wn({tournamentRecord:o,drawId:l});return u?(s[l].every(c=>{let{matchUpId:d,courtId:p}=c,m=yh({tournamentRecord:o,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(m.success)return m==null?void 0:m.success;n={error:bH}}),!0):(n={error:Le},!1)})}),n||X}function w5(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:m=30,scheduleDate:h,matchUpIds:f,venueIds:g,startTime:v,endTime:y,dryRun:I}=t,b=ze(t,[{[mn]:!0,[jy]:!0},{[Kr]:ya,[$a]:Ar,[Xae]:!0},{[Kr]:V=>!V||!isNaN(V),[toe]:!1,[$a]:se,[ioe]:!1,[roe]:!1}]);if(b.error)return b;let S=t.competitionMatchUps??As({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??ps({includeParticipantDependencies:!0,matchUps:S,tournamentRecords:e}).matchUpDependencies;S.forEach(V=>{var G;(G=V.schedule)!=null&&G.scheduledDate&&jl(h,mt(V.schedule.scheduledDate))&&Yf({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:V})});let U=f.map(V=>S.find(G=>G.matchUpId===V)).filter(Boolean),{venueId:T,scheduleTimes:D,dateScheduledMatchUpIds:P}=gx({tournamentRecords:e,remainingScheduleTimes:d,startTime:wi(v),endTime:wi(y),scheduleDate:mt(h),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:m,venueIds:g}),E={},R=[],N={},A={},M={};S.filter(({matchUpId:V})=>P==null?void 0:P.includes(V)).forEach(V=>{var j;u1({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:V,value:1});let G=(j=V.schedule)==null?void 0:j.scheduledTime;if(G){N[V.matchUpId]=G;let z=a==null?void 0:a[V.matchUpId];zI({recoveryMinutes:z||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:G,matchUp:V})}});let C=U.filter(V=>{let G=P==null?void 0:P.includes(V.matchUpId),j=[Vt,Mt,qi,Ba,hn,zt].includes(V==null?void 0:V.matchUpStatus);return!G&&!V.winningSide&&!j}),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:x}=C.reduce((V,G)=>{let{drawId:j,tournamentId:z,matchUpType:W}=G,{participantIdsAtLimit:q,relevantParticipantIds:Y}=sx({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:u,matchUp:G});return q!=null&&q.length?(V.overLimitMatchUpIds.push(G.matchUpId),V.participantIdsAtLimit.push(...q),V):(Y.forEach(re=>{Bb({individualParticipantProfiles:s,participantId:re});let J=s[re].counters;J[W]?J[W]+=1:J[W]=1,J[Ho]?J[Ho]+=1:J[Ho]=1}),V.matchUpMap[z]||(V.matchUpMap[z]={}),V.matchUpMap[z][j]?V.matchUpMap[z][j].push(G):V.matchUpMap[z][j]=[G],Yf({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:G}),V)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});C=C.filter(({matchUpId:V})=>!k.includes(V));let F=0,$=(D==null?void 0:D.length)??0,{personRequests:_}=wp({tournamentRecords:e,requestType:Vb});for(;D!=null&&D.length&&C.length&&F<=$;){F++;let{scheduleTime:V}=D.shift(),G=C.find(j=>{let{matchUpId:z}=j,{dependenciesScheduled:W,remainingDependencies:q}=nx({matchUpScheduleTimes:N,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:j});if(!W)return M[z]||(M[z]=[]),M[z].push({scheduleTime:V,remainingDependencies:q}),!1;let{enoughTime:Y}=ox({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:V,matchUp:j});if(!Y)return A[z]||(A[z]=[]),A[z].push({scheduleTime:V}),!1;let{conflicts:re}=ax({potentials:c,averageMatchUpMinutes:r,requestConflicts:E,personRequests:_,scheduleTime:V,scheduleDate:h,matchUp:j});if(re!=null&&re.length)return!1;let J=a==null?void 0:a[j.matchUpId];return zI({recoveryMinutes:J||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:V,matchUp:j}),N[j.matchUpId]=V,!0});C=C.filter(({matchUpId:j})=>j!==(G==null?void 0:G.matchUpId)),G||R.push(V)}C.forEach(V=>{u1({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:V})});let L=[];Object.keys(O).forEach(V=>{let G=e[V];G&&Object.keys(O[V]).forEach(j=>{let{drawDefinition:z}=Xc({tournamentRecord:G,drawId:j});z&&O[V][j].forEach(({matchUpId:W})=>{let q=N[W];if(q){let Y=q.split(":").map(oo).join(":"),re=`${mt(h)}T${Y}`;I?L.push(W):(Qc({drawDefinition:z,matchUpId:W,scheduledTime:re}).success&&L.push(W),T&&iv({tournamentRecords:e,tournamentRecord:G,drawDefinition:z,matchUpId:W,venueId:T}))}})})});let B=pA(C);return{...X,requestConflicts:Object.values(E),remainingScheduleTimes:D==null?void 0:D.map(({scheduleTime:V})=>V),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:x,skippedScheduleTimes:R,overLimitMatchUpIds:k,scheduledMatchUpIds:L,noTimeMatchUpIds:B,recoveryTimeDeferred:A,dependencyDeferred:M}}function U5({tournamentRecords:t,matchUps:e}){if(!So(e))return{error:Gu};if(e.some(({matchUpId:m,hasContext:h})=>m&&!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Y0};let i=Math.max(...e.map(({schedule:m})=>(m==null?void 0:m.courtOrder)||1).map(m=>et(m))),r=Te(1,i+1).map(m=>e.filter(h=>{var f;return et((f=h.schedule)==null?void 0:f.courtOrder)===m})),n={},a={},o={};r.flat().filter(Boolean).sort(ch).forEach(({schedule:m})=>delete m[xU]);let s=ct(e.map(({drawId:m})=>m)),l=ps({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,u=r.map((m,h)=>m.reduce((f,g)=>{if(!g.matchUpId)return f;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:I,schedule:b,sides:S,potentialParticipants:w}=g,U=b==null?void 0:b.courtId;n[v]=h,a[U]=[],f.matchUpIds.push(v),o[v]=g;let T=l[v].matchUpIds;T.length&&f.sourceMatchUpIds.push(...T);let D=(S==null?void 0:S.map(E=>{var R;return[(R=E.participant)==null?void 0:R.individualParticipantIds,E.participantId]}).flat().filter(Boolean))??[],P=(w==null?void 0:w.flat().map(({individualParticipantIds:E,participantId:R})=>[E,R]).flat().filter(Boolean))||[];return f.participantIds.push(...P,...D),y&&f.targetMatchUpIds.push(y),I&&f.targetMatchUpIds.push(I),f},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),c=(m,h)=>l[m].sources.reduce((f,g,v)=>g.includes(h)&&v+1||f,0),d=u.map(()=>[]),p=(m,h,f,g)=>{if(!o[m].schedule[xU]){o[m].schedule[xU]=h,o[m].schedule[zW]=g,d[n[m]].push({matchUpId:m,issueType:f,issueIds:g,issue:h});let v=o[m].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:m,issue:h,issueType:f,issueIds:g})}};return u.forEach((m,h)=>{let f=h?u[h-1]:void 0,g=u.slice(h+1),v={},y=Ua(m.participantIds),I=Object.keys(y).filter(w=>y[w]>1),b=m.matchUpIds.filter(w=>l[w].participantIds.some(U=>I.includes(U)));b.forEach(w=>{v[w]||(v[w]={}),v[w][dd]||(v[w][dd]=b.filter(U=>U!==w))});let S=f&&m.participantIds.filter(w=>f.participantIds.includes(w));S&&S.forEach(w=>{let U=m.matchUpIds.concat(f.matchUpIds).filter(T=>l[T].participantIds.includes(w));U.forEach(T=>{v[T]||(v[T]={}),v[T][pd]||(v[T][pd]=U.filter(D=>D!==T))})}),m.matchUpIds.forEach(w=>{var D,P,E,R;let U=l[w].matchUpIds;for(let N of g){let A=N.matchUpIds.filter(M=>U.includes(M));A!=null&&A.length&&(A.forEach(M=>p(M,FC,lc,[w])),p(w,FC,lc,A))}if((D=v[w])!=null&&D[dd]&&p(w,dd,xC,v[w][dd]),m.sourceMatchUpIds.includes(w)){let N=m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w));p(w,dd,lc,N),m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w)).forEach(A=>p(A,dd,lc,[w]))}let T=(P=f==null?void 0:f.matchUpIds)==null?void 0:P.filter(N=>c(w,N)>1);if(T!=null&&T.length&&(p(w,LC,lc,T),T.forEach(N=>p(N,LC,lc,[w]))),(E=v[w])!=null&&E[pd]&&p(w,pd,xC,v[w][pd]),(R=f==null?void 0:f.targetMatchUpIds)==null?void 0:R.includes(w)){let N=o[w].schedule.courtId,A=U.filter(M=>f.matchUpIds.includes(M));A.some(M=>o[M].schedule.courtId===N)||(A.forEach(M=>p(M,pd,lc,[w])),p(w,pd,lc,A))}})}),{courtIssues:a,rowIssues:d}}function S5(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return ee({result:{error:Oi},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return ee({result:{error:Xe},stack:e});let a=r==null?void 0:r.length;if(!a)return{...X};let o=0;return r.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,m=u+(n?-1:1);m<0&&(m=a-1),m===a&&(m=0);let h=r[m].schedule.scheduledTime,f=s({tournamentId:c,scheduledTime:h,matchUpId:p,drawId:d});if(f.success)o++;else return f}),o===a?X:ee({result:{error:yH},stack:e});function s({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:m}=Xc({tournamentRecord:p,drawId:d});return m?Qc({drawDefinition:m,scheduledTime:u,matchUpId:c}):{error:Fa}}}function T5(t){var l,u;let{scheduleChange:e,matchUpIds:i,dryRun:r}=t;if(!i||!Array.isArray(i))return{error:Wm};if(typeof e!="object")return{error:se};let n=bo(t),a=[],o=[];for(let c of Object.values(n)){let d=Ehe({tournamentRecord:c,scheduleChange:e,matchUpIds:i,dryRun:r});if(d.error)return d;Array.isArray(d.notRescheduled)&&o.push(...d.notRescheduled);let p=pA(d.notRescheduled),m=[];(l=d.rescheduled)==null||l.forEach(h=>{let{matchUpId:f}=h;p.includes(f)&&m.push(f),a.push(h)}),m.length&&(o=((u=d==null?void 0:d.notRescheduled)==null?void 0:u.filter(({matchUpId:h})=>!m.includes(h)))||[])}let s=!!(a.length&&!o.length);return{...X,rescheduled:a,notRescheduled:o,allRescheduled:s}}function Ehe({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){var b;if(!t)return{error:ge};if(!i||!Array.isArray(i))return{error:Wm};if(typeof e!="object")return{error:se};let n=[],a=[],{minutesChange:o,daysChange:s}=e;if(!o&&!s)return{...X};if(o&&isNaN(o))return{error:se};if(s&&isNaN(s))return{error:se};let{matchUps:l}=Vr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:S})=>!vr.includes(S),c=l==null?void 0:l.filter(S=>Ob({schedule:S.schedule})).filter(S=>u({matchUpStatus:S.matchUpStatus}));if(!(c!=null&&c.length))return{...X};let{tournamentInfo:d}=vh({tournamentRecord:t}),{startDate:p,endDate:m}=d,h=c==null?void 0:c.reduce((S,w)=>{let{matchUpId:U,drawId:T}=w;return S[T]?S[T].push(U):S[T]=[U],S},{}),f=1440;for(let S of Object.keys(h)){let w=Xc({tournamentRecord:t,drawId:S});if(w.error)return w;let U=w.drawDefinition,T=h[S].filter(D=>i.includes(D));for(let D of T)if(D&&U){let P=(b=c.find(C=>C.matchUpId===D))==null?void 0:b.schedule,{scheduledTime:E,scheduledDate:R}=P,N,A,M;if(!N&&s&&R){let C=mt(R);M=zv(C,s),N=new Date(M)<new Date(p)||new Date(M)>new Date(m)}if(o&&E){let C=mt(E),O=Ot(wi(E))+o;if(N=O<0||O>f,!N){let k=ra(E,o),x=C&&M||R===C&&C;A=x?`${x}T${k}`:k}}if(N)a.push(D);else{if(!r){if(A){let C=Qc({scheduledTime:A,drawDefinition:U,matchUpId:D});if(C.error)return C}if(M){let C=OD({scheduledDate:M,drawDefinition:U,matchUpId:D});if(C.error)return C}}(A||M)&&n.push(D)}}}let g=Vr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],v=g.filter(({matchUpId:S})=>n.includes(S)),y=g.filter(({matchUpId:S})=>a.includes(S)),I=v.length&&!y.length;return{...X,rescheduled:v,notRescheduled:y,allRescheduled:I}}function D5(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Oi};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=r||{},{drawId:d,matchUpId:p,tournamentId:m}=n||{};if(!u&&!p)return ee({result:{error:Xe},stack:e});let{matchUps:h}=As({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),f=h==null?void 0:h.find(({matchUpId:b})=>b===u),g=h==null?void 0:h.find(({matchUpId:b})=>b===p),v=0;if(o&&u&&!p){let b=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b!=null&&b.success&&v++,b.error)return ee({result:b,stack:e})}else if(a&&o&&u&&p){let b=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b.success&&v++,b.error)return ee({result:b,stack:e,info:"source"});let S=y({tournamentId:m,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:s});if(S.success&&v++,S.error)return ee({result:S,stack:e,info:"target"})}else return{error:Xe};return v?X:ee({result:{error:Og},stack:e});function y(b){let{tournamentRecords:S,tournamentId:w,matchUp:U,drawId:T}=b,D=S[w],{drawDefinition:P}=Xc({tournamentRecord:D,drawId:T});return U.matchUpType===fi?I({...b,tournamentRecord:D,drawDefinition:P}):yh({...b,tournamentRecord:D,drawDefinition:P})}function I({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,sourceCourtId:T,courtDayDate:D,matchUpId:P,matchUp:E,courtId:R}){let N=[R].concat(E.schedule.allocatedCourts.map(({courtId:A})=>A).filter(A=>A!==T));return kD({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,courtDayDate:D,matchUpId:P,courtIds:N})}}function P5({scheduleAttributes:t=[Wl,Ec,nh,ah,oh,Is,Cu,Nl,vu],tournamentRecord:e,drawDefinition:i,matchUpId:r}){var s,l;let n="clearMatchUpSchedule",a=i?(s=Sn({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:s[0]:(l=Vr({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:l[0];if(!a)return{error:pn};let o=(a.timeItems??[]).filter(u=>(u==null?void 0:u.itemType)&&!t.includes(u==null?void 0:u.itemType));return a.timeItems=o,Rt({tournamentId:e.tournamentId,context:n,drawDefinition:i,matchUp:a}),{...X}}function R5(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:Oi};if(typeof r!="object")return{error:Hu};let a=Object.keys(n).filter(o=>!i||i===o);if(i&&!a.includes(i))return{error:se};for(let o of a){let s=n[o],l=Lt({extension:{name:zy,value:{dailyLimits:r}},element:s});if(l.error)return l}return{...X}}var E5={};bt(E5,{addCollectionDefinition:()=>yx,addCollectionGroup:()=>k5,aggregateTieFormats:()=>F5,compareTieFormats:()=>Mu,getTieFormat:()=>ck,modifyCollectionDefinition:()=>vx,modifyTieFormat:()=>x5,mutate:()=>C5,orderCollectionDefinitions:()=>A5,query:()=>q6,removeCollectionDefinition:()=>Ix,removeCollectionGroup:()=>N5,tieFormatGenderValidityCheck:()=>nT,validateCollectionDefinition:()=>_y});var C5={};bt(C5,{addCollectionDefinition:()=>yx,addCollectionGroup:()=>k5,aggregateTieFormats:()=>F5,modifyCollectionDefinition:()=>vx,modifyTieFormat:()=>x5,orderCollectionDefinitions:()=>A5,removeCollectionDefinition:()=>Ix,removeCollectionGroup:()=>N5});function Hd({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:o}){var u;let s="getTieFormat",l;if(e=(r==null?void 0:r.structureId)??e,i=(n==null?void 0:n.matchUpId)??i,(i||e)&&!t)return{error:Le};if(a&&o)l=js(o);else if(i){if(t&&(!n||!r)){let c=Ui({drawDefinition:t,matchUpId:i});if(c.error)return c;if(((u=c.matchUp)==null?void 0:u.matchUpType)!==xa)return ee({result:{error:oa},stack:s});r||(r=c.structure),n||(n=c.matchUp)}l=Xv({item:n,drawDefinition:t,structure:r,event:o})||Xv({item:r,drawDefinition:t,structure:r,event:o})||js(t)||js(o)}else if(t&&e){if(!r){let c=it({drawDefinition:t,structureId:e});if(c.error)return c;r=c==null?void 0:c.structure}l=Xv({item:r,drawDefinition:t,structure:r,event:o})||js(t)||js(o)}else l=js(t)||js(o);return l?{...X,structure:r,tieFormat:l,matchUp:n}:ee({result:{error:Mg},stack:s})}function qS({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![vr].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==cs&&!Ir(t))}function SE({from:t,to:e}){let i=Object.keys(t),r=Vi(i,Object.keys(e)).length===i.length,n=i.filter(o=>t[o]!==e[o]).map(o=>({countChange:e[o]-t[o],collectionId:o})),a=i.every(o=>t[o]===e[o]);return{equivalent:r&&a,matchUpsCountChanges:n}}function Che({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:o,event:s,uuids:l}){var w,U,T,D;let u="updateTieFormat",c=e==null?void 0:e.tournamentId,d=0,p=0,m=0,h=0,f=n==null?void 0:n.collectionDefinitions.reduce((P,E)=>(P[E.collectionId]=(P[E.collectionId]||0)+E.matchUpCount,P),{}),g=({tieFormat:P})=>{let E=P==null?void 0:P.collectionDefinitions.reduce((R,N)=>(R[N.collectionId]=(R[N.collectionId]||0)+N.matchUpCount,R),{});return SE({from:E,to:f}).equivalent},v=(w=Hd({drawDefinition:i}))==null?void 0:w.tieFormat,y=(U=Hd({event:s}))==null?void 0:U.tieFormat;if(s&&a){for(let P of s.drawDefinitions??[])I({drawDefinition:P});s.tieFormat=qr(n),h+=1}else if(o){if(!o.tieMatchUps)return ee({result:{error:oa},stack:u});let P=Ua((T=o.tieMatchUps)==null?void 0:T.map(({collectionId:M})=>M)),E=SE({to:f,from:P}),{changes:R,changesArePossible:N,cannotChangeReaon:A}=bV({matchUp:o,check:E});if(E.equivalent)if(qS({matchUp:o,updateInProgressMatchUps:t}))o.tieFormat=qr(n),h+=1;else return ee({result:{error:SN},info:"matchUp is IN_PROGRESS or COMPLETE",stack:u});else if(N)S({tieFormat:n,matchUp:o,changes:R,uuids:l});else return ee({context:{collectionMap:f,matchUpMap:P},result:{error:Cl},info:A||"specified changes not possible",stack:u});p+=1,Rt({eventId:s==null?void 0:s.eventId,context:u,drawDefinition:i,tournamentId:c,matchUp:o})}else if(r){let P=(D=b({inheritedTieFormat:v??y,structure:r}))==null?void 0:D.modifiedMatchUpsCount;P&&(p+=P,d+=1,h+=1);let E=!r.tieFormat||Mu({ancestor:r.tieFormat,descendant:n}).different;E&&(r.tieFormat=qr(n),d+=1,h+=1),(P||E)&&i&&li({structureIds:[r.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)I({drawDefinition:i}),i.tieFormat=qr(n),h+=1;else return{error:Le};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:m,modifiedCount:h,...X,tieFormat:n};function I({drawDefinition:P}){var N;let E=P.structures||[],R=[];for(let A of E){if(A.tieFormat)continue;let M=(N=b({inheritedTieFormat:y,structure:A}))==null?void 0:N.modifiedMatchUpsCount;if(M){d+=1,p+=M;let C=A.structureId;R.push(C)}}return li({structureIds:R,eventId:s==null?void 0:s.eventId,drawDefinition:P}),R.length}function b({inheritedTieFormat:P,structure:E}){var A,M;let R=0,N=((A=Wt({matchUpFilters:{matchUpTypes:[fi]},structure:E}))==null?void 0:A.matchUps)||[];for(let C of N){let O=qS({matchUp:C,updateInProgressMatchUps:t}),k=!1,x=Ua((M=C.tieMatchUps)==null?void 0:M.map(({collectionId:$})=>$)),F=SE({from:x,to:f});if(F.equivalent)C.tieFormat&&g(C)&&O&&(C.tieFormat=qr(n),k=!0);else{let{changes:$,changesArePossible:_}=bV({matchUp:C,check:F});if(_&&!C.tieFormat)S({changes:$,matchUp:C,tieFormat:n,uuids:l});else if(P)(!C.tieFormat||Mu({ancestor:P,descendant:C.tieFormat}).different)&&(C.tieFormat=P,k=!0);else return ee({result:{error:Mg},stack:u})}k&&(R+=1,Rt({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:u,eventId:a,matchUp:C}))}return{modifiedMatchUpsCount:R}}function S({uuids:P,matchUp:E,tieFormat:R,changes:N}){E.tieFormat=qr(R);let A=[],M=[];return N.forEach(C=>{if(C.countChange>0){let O=Math.max(0,...E.tieMatchUps.filter(F=>F.collectionId===C.collectionId).map(Da("collectionPosition"))),k=R.collectionDefinitions.find(F=>F.collectionId===C.collectionId),x=wb({matchUpsLimit:C.countChange,collectionPositionOffset:O,collectionDefinition:k,matchUp:E,uuids:P});M.push(...Ce(x,!1,!0)),m+=M.length,E.tieMatchUps.push(...x)}else{let O=C.toBePlayedTieMatchUpIds.slice(0,Math.abs(C.countChange));console.log("remove",O.length),A.push(...O),E.tieMatchUps=E.tieMatchUps.filter(({matchUpId:k})=>!O.includes(k))}}),M.length&&Pc({matchUps:M,drawDefinition:i,tournamentId:c,eventId:a}),A.length&&Wu({matchUpIds:A,action:"updateTieFormat",drawDefinition:i,tournamentId:c,eventId:a}),{matchUpIdsRemoved:A,matchUpsAdded:M}}}function bV({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let o=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===Xi).map(Da("matchUpId")),s=o.length+a>=0||a>0;return!s&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:o,collectionId:n,countChange:a}),s}),changes:r,cannotChangeReaon:i}}function jD({appliedPolicies:t,drawDefinition:e,auditData:i}){var a;if(!((a=t==null?void 0:t.audit)!=null&&a[Kv]))return;let{extension:r}=vt({name:Kv,element:e}),n={value:Array.isArray(r==null?void 0:r.value)?r==null?void 0:r.value.concat(i):[i],name:Kv};Lt({element:e,extension:n})}function vx({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:m,gender:h,event:f,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b}){let S="modifyCollectionDefinition";if(o&&!Sa({matchUpFormat:o}))return ee({result:{error:se},context:{matchUpFormat:o},stack:S});if(r&&typeof r!="string")return ee({result:{error:se},context:{collectionName:r},stack:S});if(h&&!Object.values(rT).includes(h))return ee({result:{error:se},context:{gender:h},stack:S});if(p&&typeof p!="object")return ee({result:{error:se},context:{category:p},stack:S});let w={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b};if(!Object.values(w).filter(Boolean).length&&!i&&!r&&!o&&!s&&!u)return ee({result:{error:Xe},stack:S});if(Object.values(w).filter(Boolean).length>1)return ee({info:"Only one value assignment allowed per collectionDefinition",result:{error:se},stack:S});let U=Hd({drawDefinition:a,structureId:c,matchUpId:d,eventId:m,event:f});if(U.error)return ee({result:U,stack:S});let{matchUp:T,structure:D,tieFormat:P}=U,E=qr(P),R=P==null?void 0:P.collectionDefinitions.find(L=>L.collectionId===l),N=E==null?void 0:E.collectionDefinitions.find(L=>L.collectionId===l);if(!R)return ee({info:"source collectionDefinition",result:{error:$r},context:{collectionId:l},stack:S});let A=v??y??I??b;if(g!=null&&g.length){let L=wG({matchUpCount:s??(R==null?void 0:R.matchUpCount)??0,collectionValueProfiles:g});if(L.errors)return ee({result:{error:se},info:L.errors,stack:S})}else if(A&&!ot(A))return ee({result:{error:se},info:"value is not an integer",context:{value:A},stack:S});let M=(L,B)=>Vi(Object.keys(L),Object.keys(B)).length===Object.keys(L).length&&Vi(Object.values(L),Object.values(B)).length===Object.values(L).length,C=g&&(!R.collectionValueProfiles||!M(R.collectionValueProfiles,g)),O=ot(v)&&R.collectionValue!==v||ot(y)&&R.matchUpValue!==y||ot(I)&&R.scoreValue!==I||ot(b)&&R.setValue!==b||C,k=[];if(O&&(N.collectionValueProfiles=void 0,N.collectionValue=void 0,N.matchUpValue=void 0,N.scoreValue=void 0,N.setValue=void 0,Object.assign(N,w),k.push({collectionId:l,...je(w)})),(ot(I)||ot(b))&&N.collectionGroupNumber){let L=N.collectionGroupNumber;E.collectionDefinitions=E.collectionDefinitions.map(B=>{let{collectionGroupNumber:V,...G}=B;return V===L?G:B}),E.collectionGroups=E.collectionGroups.filter(({groupNumber:B})=>B!==L),k.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:x,valueGoal:F}=Ih(E),$=je({aggregateValue:x,valueGoal:F});if(($.aggregateValue!==(P==null?void 0:P.winCriteria.aggregateValue)||$.valueGoal!==(P==null?void 0:P.winCriteria.valueGoal))&&(E.winCriteria=$,k.push({collectionId:l,winCriteria:$})),ot(i)&&R.collectionOrder!==i&&(N.collectionOrder=i,k.push({collectionId:l,collectionOrder:i})),r&&R.collectionName!==r&&(N.collectionName=r,k.push({collectionId:l,collectionName:r})),o&&R.matchUpFormat!==o&&(N.matchUpFormat=o,k.push({collectionId:l,matchUpFormat:o})),ot(s)&&R.matchUpCount!==s&&(N.matchUpCount=s,k.push({collectionId:l,matchUpCount:s})),u&&R.matchUpType!==u)return ee({result:{error:X0},context:{matchUpType:u},stack:S});p&&R.category!==p&&(N.category=p,k.push({collectionId:l,category:p})),h&&R.gender!==h&&(N.gender=h,k.push({collectionId:l,gender:h}));let _=je(E);if(U=Hn({tieFormat:_}),U.error)return ee({result:U,stack:S});if(!k.length)return ee({result:{...X,modifications:k}});if((P==null?void 0:P.tieFormatName)!==n?(_.tieFormatName=n,k.push({tieFormatName:n})):k.length&&(delete _.tieFormatName,k.push("tieFormatName removed: modifications without new tieFormatName")),U=Che({tieFormat:_,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:D,eventId:m,matchUp:T,event:f}),!U.error){let{appliedPolicies:L}=$t({tournamentRecord:e}),B=je({collectionDefinition:N,drawId:a==null?void 0:a.drawId,action:S,structureId:c,matchUpId:d,eventId:m});jD({appliedPolicies:L,drawDefinition:a,auditData:B})}return ee({result:{...U,modifications:k},stack:S})}function Mhe({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){var s,l;let o=[];return n&&a?o=[a]:i&&r?o=((s=Wt({matchUpFilters:{matchUpTypes:[fi]},structure:r}))==null?void 0:s.matchUps)??[]:e&&(o=((l=Sn({matchUpFilters:{matchUpTypes:[fi]},drawDefinition:e}))==null?void 0:l.matchUps)??[]),{targetMatchUps:o.filter(u=>!u.winningSide&&u.matchUpStatus!==qi&&(t||u.matchUpStatus!==cs&&!Ir(u)))}}function Nhe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let o of r){let s=!!o.tieFormat;s&&(o.tieFormat=qr(n));let l;if(t){let u=$t({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=Ku({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}s&&!l&&Rt({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:o,drawDefinition:i})}return{...X}}function M5({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:m,valueGoal:h}=Ih(l);l.winCriteria=je({aggregateValue:m,valueGoal:h}),(e&&e!==h||m&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:f}=Mhe({updateInProgressMatchUps:t,drawDefinition:a,structureId:o,structure:s,matchUpId:u,matchUp:c});Nhe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:f,drawDefinition:a,tieFormat:l,event:p});let g=je(l),v=Hn({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:Le};return li({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...X}}function N5({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:u}){if(!e)return{error:Xe};if(isNaN(e))return{error:se};let c="removeCollectionGroup",d=s?void 0:Hd({drawDefinition:r,structureId:a,matchUpId:o,eventId:l,event:u});if(d!=null&&d.error)return ee({result:d,stack:c});let p=d==null?void 0:d.structure;s=s??(d==null?void 0:d.matchUp);let m=d==null?void 0:d.tieFormat,h=m==null?void 0:m.winCriteria.valueGoal,f=m==null?void 0:m.winCriteria.aggregateValue,g=qr(m);if(d=Hn({tieFormat:g}),d.error)return ee({result:d,stack:c});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(y=>{let{collectionGroupNumber:I,...b}=y;return I!==e?y:(v.push(y.collectionId),b)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:y})=>y!==e),d=M5({updateInProgressMatchUps:t,originalValueGoal:h,wasAggregateValue:f,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:o,matchUp:s,eventId:l,event:u}),!d.error){let{appliedPolicies:y}=$t({tournamentRecord:i}),I=je({drawId:r==null?void 0:r.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:o,eventId:l});jD({appliedPolicies:y,drawDefinition:r,auditData:I})}return ee({result:{...d,modifiedCollectionIds:v},stack:c})}function Jf({tieFormat:t,orderMap:e}){var r;let i=qr(t);return i.collectionDefinitions.forEach(n=>{let a=e[n.collectionId];a&&(n.collectionOrder=a)}),(r=i.collectionDefinitions)==null||r.sort((n,a)=>Pf(n.collectionOrder)-Pf(a.collectionOrder)),i}function A5({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:o,event:s}){if(typeof n!="object"||!Object.values(n).every(l=>ot(l)))return ee({result:{error:se},context:{orderMap:n}});if(a&&(s!=null&&s.tieFormat))wV({tournamentRecord:t,event:s,orderMap:n});else if(r){let l=e&&Ui({drawDefinition:e,matchUpId:r});if(l!=null&&l.error)return l;if(o=l.matchUp,!o)return{error:aa};o!=null&&o.tieFormat&&(o.tieFormat=Jf({tieFormat:o.tieFormat,orderMap:n}),Rt({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:o}))}else if(i){let l=it({drawDefinition:e,structureId:i});if(l.error)return l;let u=l.structure;if(u!=null&&u.tieFormat)u.tieFormat=Jf({tieFormat:u.tieFormat,orderMap:n}),O5({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:n}),li({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)c1({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else if(s!=null&&s.tieFormat)wV({structureIds:[i],tournamentRecord:t,orderMap:n,event:s});else return{error:$r}}else if(e!=null&&e.tieFormat)c1({tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else return{error:$r};return{...X}}function wV({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=Jf({tieFormat:r.tieFormat,orderMap:i});e!=null&&e.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])c1({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function c1({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??(n==null?void 0:n.tieFormat),o=Jf({tieFormat:a,orderMap:r});i!=null&&i.length||(e.tieFormat=o);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=Jf({tieFormat:l.tieFormat??e.tieFormat??(n==null?void 0:n.tieFormat),orderMap:r})),O5({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),s.push(l.structureId));li({drawDefinition:e,structureIds:s})}function O5({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){var o;let a=(o=Wt({matchUpFilters:{matchUpTypes:[fi]},structure:i}))==null?void 0:o.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=Jf({tieFormat:s.tieFormat,orderMap:r}),Rt({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function Ix({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:u,event:c}){var E,R,N,A,M;let d="removeCollectionDefinition",p=u?void 0:Hd({drawDefinition:r,structureId:o,matchUpId:s,eventId:l,event:c});if(p!=null&&p.error)return ee({result:p,stack:d});let m=p==null?void 0:p.structure;u=u??(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,f=qr(h);if(p=Hn({tieFormat:f}),p.error)return ee({result:p,stack:d});let g=(E=f==null?void 0:f.collectionDefinitions)==null?void 0:E.find(C=>C.collectionId===a);if(!g)return ee({result:{error:$r,collectionId:a}});f.collectionDefinitions=f.collectionDefinitions.filter(C=>C.collectionId!==a),g.collectionGroupNumber&&(f.collectionDefinitions=f.collectionDefinitions.map(C=>{let{collectionGroupNumber:O,...k}=C;return k}),f.collectionGroups=f.collectionGroups.filter(({groupNumber:C})=>C!==g.collectionGroupNumber));let{aggregateValue:v,valueGoal:y}=Ih(f);f.winCriteria=je({aggregateValue:v,valueGoal:y});let I=h==null?void 0:h.winCriteria.valueGoal,b=h==null?void 0:h.winCriteria.aggregateValue;(I&&I!==y||v&&!b)&&(n?f.tieFormatName=n:delete f.tieFormatName);let S=[];s&&u?S=[u]:o&&m?S=((R=Wt({matchUpFilters:{matchUpTypes:[fi]},structure:m}))==null?void 0:R.matchUps)??[]:r?S=((N=Sn({matchUpFilters:{matchUpTypes:[fi]},drawDefinition:r}))==null?void 0:N.matchUps)??[]:c&&(S=((A=iu({matchUpFilters:{matchUpTypes:[fi]},drawDefinition:r}))==null?void 0:A.matchUps)??[]);let w=(S||[]).filter(C=>{var x,F,$;let O=(F=(x=C.tieMatchUps)==null?void 0:x.filter(_=>_.collectionId===a))==null?void 0:F.some(Ir),k=e&&C.tieFormat?($=Mu({descendant:C.tieFormat,ancestor:f}))==null?void 0:$.different:!1;return t&&!O||!C.winningSide&&C.matchUpStatus!==qi&&(t||C.matchUpStatus!==cs&&!Ir(C)&&!k)});if(!w.length)return{error:Og};let{appliedPolicies:U}=$t({tournamentRecord:i});if(s&&u&&t){let C=(M=u.tieMatchUps)==null?void 0:M.filter(O=>O.collectionId===a);for(let O of C??[]){let k=_b({matchUpId:O.matchUpId,tieMatchUpId:u==null?void 0:u.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(k.error||(k=Ui({drawDefinition:r,matchUpId:s}),k.error))return k;u=k==null?void 0:k.matchUp}}let T=[];for(let C of w){for(let O of(C==null?void 0:C.sides)??[])O.lineUp=(O.lineUp??[]).map(k=>({participantId:k.participantId,collectionAssignments:((k==null?void 0:k.collectionAssignments)??[]).filter(x=>x.collectionId!==a)}));if(C.tieMatchUps=(C.tieMatchUps??[]).filter(O=>{let k=O.collectionId===a;return k&&T.push(O.matchUpId),!k}),C.tieFormat&&(C.tieFormat=qr(f)),t){let O=Ku({matchUpId:C.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(O.error)return O}Rt({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,drawDefinition:r,context:d,matchUp:C})}T.length&&Wu({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:T,eventId:c==null?void 0:c.eventId,drawDefinition:r});let D=je(f);if(p=Hn({tieFormat:D}),p.error)return ee({result:p,stack:d});if(l&&c)c.tieFormat=D;else if(s&&u)u.tieFormat=D;else if(m)m.tieFormat=D;else if(r)r.tieFormat=D;else if(!u||!r)return{error:Le};li({drawDefinition:r,eventId:c==null?void 0:c.eventId});let P=je({drawId:r==null?void 0:r.drawId,action:d,collectionId:a,structureId:o,matchUpId:s,eventId:l});return jD({appliedPolicies:U,drawDefinition:r,auditData:P}),{tieFormat:D,deletedMatchUpIds:T,targetMatchUps:w,...X}}function k5({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(n))return ee({result:{error:Xe},stack:d});let p=l?void 0:Hd({drawDefinition:r,structureId:o,matchUpId:s,eventId:u,event:c});if(p!=null&&p.error)return ee({result:p,stack:d});let m=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,f=h==null?void 0:h.winCriteria.valueGoal,g=qr(h);if(p=Hn({tieFormat:g}),p.error)return ee({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:I,collectionGroupNumber:b}=y;if(b&&n.includes(I))return ee({info:"collectionIds cannot be part of other collectionGroups",result:{error:se},stack:d})}let v=(g.collectionGroups||[]).reduce((y,I)=>I.groupNumber>y?I.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>n.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],M5({updateInProgressMatchUps:t,originalValueGoal:f,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:o,structure:m,tieFormat:g,matchUpId:s,matchUp:l,eventId:u,event:c})}function yx({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:m,uuids:h,event:f}){var F,$;let g="addCollectionDefinition",v=$t({tournamentRecord:r,drawDefinition:s,event:f}).appliedPolicies??{},y=(n==null?void 0:n[kr])??(v==null?void 0:v[kr]);a=a??((F=y==null?void 0:y.participants)==null?void 0:F.enforceCategory);let I=(u??(($=y==null?void 0:y.participants)==null?void 0:$.enforceGender))!==!1,b=!!((i??(f==null?void 0:f.category))&&a!==!1),S=!!((o??(f==null?void 0:f.gender))&&I),w=_y({referenceCategory:i??(f==null?void 0:f.category),collectionDefinition:e,referenceGender:o,checkCategory:b,checkGender:S,event:f});if(w.error)return ee({result:w,stack:g});let U=p!=null&&p.tieFormat?void 0:Hd({drawDefinition:s,structureId:c,matchUpId:d,eventId:m,event:f});if(U!=null&&U.error)return ee({result:{error:U.error},stack:g});let T=U==null?void 0:U.structure;p=p??(U==null?void 0:U.matchUp);let D=(p==null?void 0:p.tieFormat)??(U==null?void 0:U.tieFormat),P=qr(D);if(U=Hn({tieFormat:P}),U==null?void 0:U.error)return ee({result:{error:U.error},stack:g});if(!e.collectionId)e.collectionId=Gt();else if(P.collectionDefinitions.map(({collectionId:_})=>_).includes(e.collectionId))return ee({context:{collectionId:e.collectionId},result:{error:SH}});P.collectionDefinitions.push(e),P.collectionDefinitions.sort((_,L)=>(_.collectionOrder||0)-(L.collectionOrder||0)).forEach((_,L)=>_.collectionOrder=L+1);let{aggregateValue:E,valueGoal:R}=Ih(P);P.winCriteria=je({aggregateValue:E,valueGoal:R});let N=D==null?void 0:D.winCriteria.valueGoal,A=D==null?void 0:D.winCriteria.aggregateValue;(N&&N!==R||E&&!A)&&(l?P.tieFormatName=l:delete P.tieFormatName);let M=[],C=[],O=[],k=je(P);if(U=Hn({tieFormat:k}),U==null?void 0:U.error)return ee({result:{error:U.error},stack:g});if(m&&f){f.tieFormat=k;for(let _ of f.drawDefinitions??[])if(!_.tieFormat)for(let L of _.structures??[]){if(L.tieFormat)continue;let B=TE({updateInProgressMatchUps:t,collectionDefinition:e,structure:L,uuids:h});C.push(...B.newMatchUps),O.push(...B.targetMatchUps),M.push(L.structureId)}gU({modifiedMatchUps:O,eventId:f==null?void 0:f.eventId,modifiedStructureIds:M,tournamentRecord:r,drawDefinition:s,addedMatchUps:C,stack:g})}else if(c&&T){T.tieFormat=k;let _=TE({updateInProgressMatchUps:t,collectionDefinition:e,structure:T,uuids:h});C.push(..._.newMatchUps),O=_.targetMatchUps,gU({modifiedMatchUps:O,eventId:f==null?void 0:f.eventId,modifiedStructureIds:M,tournamentRecord:r,drawDefinition:s,addedMatchUps:C,stack:g})}else if(d&&p){if(!qS({matchUp:p,updateInProgressMatchUps:t}))return ee({result:{error:SN},stack:g});p.tieFormat=k;let _=wb({collectionDefinition:e,matchUp:p,uuids:h});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(..._),C.push(..._),gU({modifiedMatchUps:[p],eventId:f==null?void 0:f.eventId,modifiedStructureIds:M,tournamentRecord:r,drawDefinition:s,addedMatchUps:C,stack:g})}else if(s){s.tieFormat=k;for(let _ of s.structures??[]){let L=TE({updateInProgressMatchUps:t,collectionDefinition:e,structure:_,uuids:h});M.push(_.structureId),C.push(...L.newMatchUps),O.push(...L.targetMatchUps)}gU({modifiedMatchUps:O,eventId:f==null?void 0:f.eventId,tournamentRecord:r,drawDefinition:s,addedMatchUps:C,stack:g})}else return{error:Le};let x=je({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:g,structureId:c,matchUpId:d,eventId:m});return jD({appliedPolicies:v,drawDefinition:s,auditData:x}),{tieFormat:k,targetMatchUps:O,addedMatchUps:C,...X}}function TE({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){var o;let n=[],a=((o=Wt({matchUpFilters:{matchUpTypes:[fi]},structure:i}))==null?void 0:o.matchUps).filter(s=>qS({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let l=wb({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),n.push(...l)}return{newMatchUps:n,targetMatchUps:a}}function gU({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:o}){Pc({tournamentId:e==null?void 0:e.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i==null||i.forEach(s=>{Rt({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:r,context:o,matchUp:s,eventId:a})}),li({structureIds:t,drawDefinition:r,eventId:a})}function x5({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!Hn({tieFormat:i}).valid)return ee({result:{error:Cl},info:"falied validation",stack:d});let p=Hd({drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:c});if(p.error)return ee({result:p,stack:d});let{matchUp:m,tieFormat:h}=p,f=qr(h),g=Mu({descendant:i,ancestor:f,considerations:n});if(g.invalid)return ee({context:{invalid:g.invalid},result:{error:Cl},stack:d});if(!(g!=null&&g.different))return ee({result:{...X},info:"Nothing to do",stack:d});let v=f.collectionDefinitions.map(({collectionId:D})=>D),y=i.collectionDefinitions.map(({collectionId:D})=>D),I=v.filter(D=>!y.includes(D)),b=i.collectionDefinitions.filter(({collectionId:D})=>!v.includes(D)),S=b.map(Da("collectionId")),w=[],U,T=i.tieFormatName;for(let D of i.collectionDefinitions){if(S.includes(D.collectionId))continue;let P=vx({updateInProgressMatchUps:t,...D,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:c});if(P.modifications&&w.push(...P.modifications),P.error)return ee({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of b){let P=yx({updateInProgressMatchUps:t,collectionDefinition:D,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:o,matchUpId:s,matchUp:m,eventId:l,uuids:u,event:c});if(P.error)return ee({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of I){let P=Ix({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:D,structureId:o,matchUpId:s,eventId:l,matchUp:m,event:c});if(P.error)return ee({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}return(h==null?void 0:h.tieFormatName)!==T?(U.tieFormatName=T,w.push({tieFormatName:T})):(w.length||S.length||I.length)&&(delete U.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),U.collectionDefinitions=U.collectionDefinitions.sort((D,P)=>Pf(D.collectionOrder)-Pf(P.collectionOrder)).map((D,P)=>({...D,collectionOrder:P+1})),{processedTieFormat:qr(U),modifications:w,...X}}function F5({tournamentRecord:t}){if(!t)return{error:ge};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=c=>{if(!c.tieFormat)return;let d;for(let p of r)Mu({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)c.tieFormatId=d,delete c.tieFormat;else{let p=Ce(c.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=Gt()),c.tieFormatId=p.tieFormatId,delete c.tieFormat,r.push(p),e+=1}},a=i.eventType;n({tieFormat:i.tieFormat,eventType:a});for(let c of i.drawDefinitions??[]){n({tieFormat:c.tieFormat,eventType:a});for(let d of c.structures??[])n({tieFormat:d.tieFormat,eventType:a})}let o=(c,d)=>{var m;let p=(m=l.matchUps)==null?void 0:m.find(h=>h.matchUpId===c);p&&(p.tieFormatId=d,delete p.tieFormat,Rt({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:p}))},s=c=>{let d=Ce(c.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Gt()),r.push(d),e+=1,o(c.matchUpId,d.tieFormatId)},l=iu({matchUpFilters:{matchUpTypes:[xa]},event:i}),u=l.matchUps??[];for(let c of u){let d;for(let p of r)c.tieFormat&&Mu({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?o(c.matchUpId,d):s(c)}r.length&&(i.tieFormats=r)}return{...X,addedCount:e}}var L5={};bt(L5,{addDrawDefinitionExtension:()=>vT,addEventExtension:()=>Wc,addEventTimeItem:()=>fh,addExtension:()=>Lt,addNotes:()=>WT,addOnlineResource:()=>H5,addParticipantExtension:()=>qz,addParticipantTimeItem:()=>RO,addTimeItem:()=>bl,addTournamentExtension:()=>lA,addTournamentTimeItem:()=>Db,analyzeDraws:()=>Pb,analyzeTournament:()=>lk,copyTournamentRecord:()=>$5,createTournamentRecord:()=>$D,generate:()=>_5,getAggregateTeamResults:()=>sk,getAllowedDrawTypes:()=>lD,getAllowedMatchUpFormats:()=>nk,getAppliedPolicies:()=>$t,getCompetitionDateRange:()=>cD,getCompetitionPenalties:()=>ak,getPolicyDefinitions:()=>qu,getTournamentInfo:()=>vh,getTournamentPenalties:()=>uD,getTournamentPersons:()=>ok,getTournamentPoints:()=>dD,getTournamentStructures:()=>lO,getTournamentTimeItem:()=>CT,mutate:()=>B5,query:()=>H6,removeDrawDefinitionExtension:()=>Yz,removeEventExtension:()=>IT,removeExtension:()=>Un,removeNotes:()=>SO,removeOnlineResource:()=>G5,removeParticipantExtension:()=>Kz,removeTournamentExtension:()=>uA,setTournamentCategories:()=>q5,setTournamentDates:()=>GD,setTournamentEndDate:()=>K5,setTournamentName:()=>z5,setTournamentNotes:()=>W5,setTournamentStartDate:()=>Y5,setTournamentStatus:()=>j5});var _5={};bt(_5,{copyTournamentRecord:()=>$5,createTournamentRecord:()=>$D});function $5(t){var p,m;let e=ze(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord,n=24*60*60*1e3,a=(i&&r?new Date(mt(r)).getTime()-new Date(mt(i)).getTime():0)/n,o=t.endDate||GN(t.startDate,a),s=h=>h==null?void 0:h.filter(({itemType:f})=>{var g;return(g=t.itemTypeList)==null?void 0:g.includes(f)}),l=h=>h==null?void 0:h.filter(({name:f})=>{var g;return(g=t.extensionList)==null?void 0:g.includes(f)}),u=h=>{let{timeItems:f,extensions:g,...v}=h;return Ce({...v,timeItems:s(f),extensions:l(g)},!1,!0)},c=h=>{let{drawDefinitions:f,timeItems:g,extensions:v,startDate:y,endDate:I,...b}=h;return Ce({extensions:l(v),timeItems:s(g),startDate:t.startDate,endDate:o,...b},!1,!0)},d={participants:t.copyParticipants?((p=t.tournamentRecord.participants)==null?void 0:p.map(u))??[]:[],parentOrganisation:Ce({...t.tournamentRecord.parentOrganisation},!1,!0),venues:Ce(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:s(t.tournamentRecord.timeItems),events:((m=t.tournamentRecord.events)==null?void 0:m.map(c))??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:Gt(),endDate:o};return{...X,tournamentRecord:d}}var B5={};bt(B5,{addDrawDefinitionExtension:()=>vT,addEventExtension:()=>Wc,addEventTimeItem:()=>fh,addExtension:()=>Lt,addNotes:()=>WT,addOnlineResource:()=>H5,addParticipantExtension:()=>qz,addParticipantTimeItem:()=>RO,addTimeItem:()=>bl,addTournamentExtension:()=>lA,addTournamentTimeItem:()=>Db,removeDrawDefinitionExtension:()=>Yz,removeEventExtension:()=>IT,removeExtension:()=>Un,removeNotes:()=>SO,removeOnlineResource:()=>G5,removeParticipantExtension:()=>Kz,removeTournamentExtension:()=>uA,setTournamentCategories:()=>q5,setTournamentDates:()=>GD,setTournamentEndDate:()=>K5,setTournamentName:()=>z5,setTournamentNotes:()=>W5,setTournamentStartDate:()=>Y5,setTournamentStatus:()=>j5});var Ahe="ABANDONED",Ohe="ACTIVE",khe="CANCELLED",xhe="COMPLETED",Fhe="IN_PROGRESS",V5={ABANDONED:Ahe,ACTIVE:Ohe,CANCELLED:khe,COMPLETED:xhe,IN_PROGRESS:Fhe};function j5({tournamentRecord:t,status:e}){return t?e&&!Object.keys(V5).includes(e)?{error:se,info:"Unknown status"}:(t.tournamentStatus=e,{...X}):{error:ge}}function G5(t){var u,c,d;let e=ze(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:o,courtId:s,venueId:l}=t;if(n){if(((u=i.parentOrganisation)==null?void 0:u.parentOrganisationId)!==n)return ee({result:{error:$r}});Xh({element:i.parentOrganisation,onlineResource:r})}else if(a||o){let p=(i.participants??[]).find(m=>{var h;return o&&((h=m.person)==null?void 0:h.personId)===o||m.participantId===a});if(!p)return ee(o?{result:{error:$r}}:{result:{error:zi}});if(o){if(((c=p.person)==null?void 0:c.personId)!==o)return ee({result:{error:Ym}});Xh({element:p.person,onlineResource:r})}else Xh({element:p,onlineResource:r})}else if(s){let p=(d=(i.venues??[]).filter(m=>!l||m.venueId===l).flatMap(m=>(m.courts??[]).filter(h=>h.courtId===s)))==null?void 0:d[0];if(!p)return ee({result:{error:Ag}});Xh({element:p,onlineResource:r})}else if(l){let p=(i.venues??[]).find(m=>m.venueId===l);if(!p)return ee({result:{error:Jm}});Xh({element:p,onlineResource:r})}else Xh({element:i,onlineResource:r}),lt({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:dp});return{...X}}function Xh({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!((r==null?void 0:r[Nf])===e[Nf]&&(r==null?void 0:r[Af])===e[Af]&&(r==null?void 0:r[Of])===e[Of]));t.onlineResources=i}function H5(t){var u,c,d;let e=ze(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:o,courtId:s,venueId:l}=t;if(n){if(((u=i.parentOrganisation)==null?void 0:u.parentOrganisationId)!==n)return ee({result:{error:$r}});Qh({element:i.parentOrganisation,onlineResource:r})}else if(a||o){let p=(i.participants??[]).find(m=>{var h;return o&&((h=m.person)==null?void 0:h.personId)===o||m.participantId===a});if(!p)return ee(o?{result:{error:$r}}:{result:{error:zi}});if(o){if(((c=p.person)==null?void 0:c.personId)!==o)return ee({result:{error:Ym}});Qh({element:p.person,onlineResource:r})}else Qh({element:p,onlineResource:r})}else if(s){let p=(d=(i.venues??[]).filter(m=>!l||m.venueId===l).flatMap(m=>(m.courts??[]).filter(h=>h.courtId===s)))==null?void 0:d[0];if(!p)return ee({result:{error:Ag}});Qh({element:p,onlineResource:r})}else if(l){let p=(i.venues??[]).find(m=>m.venueId===l);if(!p)return ee({result:{error:Jm}});Qh({element:p,onlineResource:r})}else Qh({element:i,onlineResource:r}),lt({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:dp});return{...X}}function Qh({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>(r==null?void 0:r[Nf])!==e[Nf]&&(r==null?void 0:r[Af])!==e[Af]&&(r==null?void 0:r[Of])!==e[Of]);return i.push(e),t.onlineResources=i,{...X}}function z5({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:ge};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&lt({topic:dp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...X}}function W5({tournamentRecord:t,notes:e}){if(!t)return{error:ge};let i=e?WT({element:t,notes:e}):SO({element:t});return i.error?i:(lt({topic:dp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...X})}function q5({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,lt({topic:dp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...X}):{error:ge}}function Lhe({tournamentRecord:t}){var a,o;if(!t)return{error:ge};let{startDate:e,endDate:i}=t,r=Mf(e,i),n=[];for(let s of t.venues||[])(a=s==null?void 0:s.courts)!=null&&a.length&&n.push(...s.courts);for(let s of n){let{startTime:l,endTime:u}=(s.dateAvailability??[]).reduce((p,m)=>{let h=Ot(p.startTime),f=Ot(p.endTime);return m.startTime&&Ot(m.startTime)<h&&(p.startTime=m.startTime),m.endTime&&Ot(m.endTime)>f&&(p.endTime=m.endTime),p},{startTime:"08:00",endTime:"18:00"}),c=r.map(p=>{var m;return((m=s.dateAvailability)==null?void 0:m.find(h=>h.date===p))??{date:p,startTime:l,endTime:u}}),d=(o=s.dateAvailability)==null?void 0:o.find(p=>!p.date);d&&c.unshift(d),s.dateAvailability=c}return{...X}}function GD(t){var m,h;let{tournamentRecord:e,startDate:i,endDate:r,weekdays:n}=t,a=(m=t.activeDates)==null?void 0:m.filter(Boolean),o=ze(t,[{tournamentRecord:!0},{[Kr]:f=>il.test(f),[$a]:Ar,startDate:!1,endDate:!1},{[Kr]:f=>f.filter(Boolean).every(g=>il.test(g)),[$a]:Ar,activeDates:!1},{[Kr]:DY,weekdays:!1}]);if(o.error)return o;if(r&&i&&new Date(r)<new Date(i))return{error:se};if(r&&i&&new Date(i)>new Date(r))return{error:se};if(a!=null&&a.length){let f=i||e.startDate,g=r||e.endDate,v=!f||a.every(I=>new Date(I)>=new Date(f)),y=!g||a.every(I=>new Date(I)<=new Date(g));if(!v||!y)return{error:Ar}}let s;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||r&&e.endDate&&new Date(r)<new Date(e.endDate))&&(s=!0);let l=Mf(e.startDate,e.endDate);i&&(e.startDate=i),r&&(e.endDate=r);let u=Mf(e.startDate,e.endDate),c=l.filter(f=>!u.includes(f)),d=u.filter(f=>!l.includes(f));for(let f of e.events??[])i&&f.startDate&&new Date(f.startDate)<new Date(i)&&(f.startDate=i),r&&f.startDate&&new Date(f.startDate)>new Date(r)&&(f.startDate=i??r),r&&f.endDate&&new Date(f.endDate)>new Date(r)&&(f.endDate=r),i&&f.endDate&&new Date(f.endDate)<new Date(i)&&(f.endDate=r??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),r&&e.startDate&&new Date(r)<new Date(e.startDate)&&(e.startDate=r),a&&(e.activeDates=a),n&&(e.weekdays=n);let p=s&&((h=_he({tournamentRecord:e}))==null?void 0:h.unscheduledMatchUpIds);return Lhe({tournamentRecord:e}),lt({payload:je({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:n,endDate:r}),topic:dp}),{...X,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:c}}function Y5({tournamentRecord:t,startDate:e}){return e?GD({tournamentRecord:t,startDate:e}):{error:Ar}}function K5({tournamentRecord:t,endDate:e}){return e?GD({tournamentRecord:t,endDate:e}):{error:Ar}}function _he({tournamentRecord:t}){let e=Vr({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let o of e){let{schedule:s,matchUpId:l}=o;if(s&&s.scheduledDate){let u=new Date(s.scheduledDate);(i&&u<i||r&&u>r)&&(a.push(l),n.includes(s.scheduledDate)||n.push(s.scheduledDate))}}return n.length&&!LD({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:TG}:{unscheduledMatchUpIds:a}}var J5={};bt(J5,{addCourt:()=>VD,addCourts:()=>px,addVenue:()=>ob,deleteCourt:()=>a7,deleteVenue:()=>Sx,deleteVenues:()=>e7,disableCourts:()=>t7,disableVenues:()=>i7,enableCourts:()=>r7,enableVenues:()=>n7,generate:()=>X5,generateCourts:()=>Bk,getCompetitionVenues:()=>Mb,getCourts:()=>Pk,getVenuesAndCourts:()=>Ju,modifyCourt:()=>Tx,modifyCourtAvailability:()=>wx,modifyVenue:()=>o7,mutate:()=>Q5,publicFindVenue:()=>VA,query:()=>oY});var X5={};bt(X5,{generateCourts:()=>Bk});var Q5={};bt(Q5,{addCourt:()=>VD,addCourts:()=>px,addVenue:()=>ob,deleteCourt:()=>a7,deleteVenue:()=>Sx,deleteVenues:()=>e7,disableCourts:()=>t7,disableVenues:()=>i7,enableCourts:()=>r7,enableVenues:()=>n7,modifyCourt:()=>Tx,modifyCourtAvailability:()=>wx,modifyVenue:()=>o7});function bx(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:ge};if(!(t!=null&&t.courtId))return{error:qm};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:o}=Xu({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:s}=Vr({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{var h,f,g;let m=(f=(h=p.schedule)==null?void 0:h.allocatedCourts)==null?void 0:f.map(({courtId:v})=>v);return((g=p.schedule)==null?void 0:g.courtId)===c||(m==null?void 0:m.includes(c))});return BS({matchUps:d,schedulingProfile:o})}}function $he({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:ge};if(!r)return{error:Gc};let{schedulingProfile:n}=Xu({tournamentRecord:e}),{matchUps:a}=Vr({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:o({matchUps:a,venueId:r})};function o({matchUps:s,venueId:l}){let u=s.filter(c=>{var p,m,h;let d=(m=(p=c.schedule)==null?void 0:p.allocatedCourts)==null?void 0:m.map(({venueId:f})=>f);return((h=c.schedule)==null?void 0:h.venueId)===l||(d==null?void 0:d.includes(l))});return BS({matchUps:u,schedulingProfile:n})}}function wx({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){var m,h,f;if(!t)return{error:ge};if(!n)return{error:qm};let o=O4({dateAvailability:e});if(o.error)return o;let{updatedDateAvailability:s,totalMergeCount:l}=Bhe(e);e=s;let u=uh({tournamentRecord:t,courtId:n});if(u.error)return u;let{court:c,venue:d}=u,{matchUps:p}=bx({tournamentRecord:t,venueMatchUps:r,courtId:n});if(p!=null&&p.length){let g=(m=$t({tournamentRecord:t}))==null?void 0:m.appliedPolicies,v=a??((f=(h=g==null?void 0:g[zc])==null?void 0:h.allowDeletionWithScoresPresent)==null?void 0:f.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return c&&(c.dateAvailability=e,!i&&d&&lt({payload:{venue:d,tournamentId:t.tournamentId},topic:pp,key:d.venueId})),{...X,totalMergeCount:l}}function Bhe(t){let e=0,i=t.reduce((n,a)=>{let{date:o,startTime:s,endTime:l,bookings:u}=a;return n[o]||(n[o]=[]),n[o].push({startTime:s,endTime:l,bookings:u}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(nhe);let{mergedAvailability:a,mergeCount:o}=Vhe(i[n]);r.push(...a.map(s=>({date:n,...s}))),e+=o}),{updatedDateAvailability:r,totalMergeCount:e}}function Vhe(t){let e,i,r,n=t.length,a=0,o=[];for(;t.length&&n;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(n-=1,!e)e=u,r=d,i=c;else if(Fy(rr(i),rr(u),!1)>0){let p={startTime:e,endTime:i};r!=null&&r.length&&(p.bookings=r),o.push(p),e=u,r=d,i=c}else d&&(r?r.push(d):r=d),i=c,a+=1}let s={startTime:e,endTime:i};return r!=null&&r.length&&(s.bookings=r),o.push(s),{mergedAvailability:o,mergeCount:a}}function Ux({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:EH,info:e}}function Z5({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:yn};if(!e&&!r)return{error:$s};let a;if(!e){if(!t)return{error:ge};({drawDefinition:e}=Wn({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=Ui({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:ge};let o=Vr({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=u3({matchUps:o,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(o=>[Ec,Wl].includes(o.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:o})=>![Ec,Wl].includes(o)),Rt({tournamentId:t==null?void 0:t.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...X}):{error:pn}}function Sx(t){var l,u,c;if(typeof(t==null?void 0:t.venueId)!="string")return{error:Gc};let{tournamentRecord:e,venueId:i,force:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(n).length)return{error:ge};let a=As({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],o=(l=$t({tournamentRecord:e}))==null?void 0:l.appliedPolicies,s=r??((c=(u=o==null?void 0:o[zc])==null?void 0:u.allowDeletionWithScoresPresent)==null?void 0:c.venues);if(!a.length||s)for(let d of Object.values(n)){for(let m of a){let h=Z5({matchUpId:m.matchUpId,drawId:m.drawId,tournamentRecord:d});if(h.error)return h}let p;d.venues=(d.venues??[]).filter(m=>(m==null?void 0:m.venueId)!==i?!0:(p=!0,!1)),p&&lt({payload:{venueId:i,tournamentId:d.tournamentId},topic:bA,key:i})}else return Ux({matchUpsCount:a.length});return Ab({tournamentRecords:n}),{...X}}function e7({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:ge};if(!Array.isArray(e))return{error:se};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,o=Sx({tournamentRecord:t,venueId:a,force:i});if(o.error)return o}}return{...X}}function t7(t){let{courtIds:e,dates:i}=t,r=bo(t),n=[{[mn]:!0,[fT]:!0}],a=ze(t,n);if(a.error)return a;for(let o of Object.values(r))jhe({tournamentRecord:o,courtIds:e,dates:i});return{...X}}function jhe({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>Lt({extension:{value:r,name:Us},creationTime:!1,element:a});for(let a of t.venues||[])for(let o of a.courts||[])if(e!=null&&e.includes(o.courtId)){let s=n(o);if(s.error)return s}return{...X}}function i7(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[mn]:!0,[gT]:!0}],a=ze(t,n);if(a.error)return a;let o=Object.keys(e).filter(s=>!i||s===i);for(let s of o){let l=e[s];Ghe({tournamentRecord:l,venueIds:r})}return{...X}}function Ghe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let r=Lt({creationTime:!1,element:i,extension:{name:Us,value:!0}});if(r.error)return r}return{...X}}function r7(t){let e=bo(t),i=[{[mn]:!0}];!t.enableAll&&i.push({[fT]:!0});let r=ze(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:o}=t;for(let s of Object.values(e))Hhe({tournamentRecord:s,courtIds:a,enableAll:n,dates:o});return{...X}}function Hhe({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(r)){let{extension:o}=vt({element:a,name:Us});if(o){let s=o.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!r.includes(l))),Lt({extension:{name:Us,value:s},creationTime:!1,element:a})}}else Un({element:a,name:Us});return{...X}}function n7(t){let e=bo(t),i=[{[mn]:!0}];!t.enableAll&&i.push({[gT]:!0});let r=ze(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let o of Object.values(e))for(let s of o.venues||[])(a||n!=null&&n.includes(s.venueId))&&Un({element:s,name:Us});return{...X}}function a7(t){let{courtId:e,disableNotice:i,force:r}=t,n=bo(t),a=ze(t,[{[mn]:!0,[jz]:!0}]);if(a.error)return a;let o,s;for(let l of Object.values(n)){if(s=zhe({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),s.error&&s.error!==Ag)return s;s.success&&(o=!0)}return o?{...X}:s}function zhe({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){var u,c,d;let n=uh({tournamentRecord:t,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:o}=bx({tournamentRecord:t,courtId:i}),s=(u=$t({tournamentRecord:t}))==null?void 0:u.appliedPolicies,l=r??((d=(c=s==null?void 0:s[zc])==null?void 0:c.allowDeletionWithScoresPresent)==null?void 0:d.courts);if(!(o!=null&&o.length)||l){for(let p of o??[]){let m=Z5({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(m.error)return m}a&&(a.courts=(a.courts??[]).filter(p=>p.courtId!==i),e||lt({payload:{venue:a,tournamentId:t.tournamentId},topic:pp,key:a.venueId}))}else return Ux({matchUpsCount:o.length});return{...X}}function Tx(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,o=bo(t);if(!Object.keys(o).length)return{error:Oi};let s,l;for(let u of Object.values(o)){let c=Whe({tournamentRecord:u,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(c!=null&&c.error)return c;s=!0}return s?{...X}:l}function Whe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:ge};if(!n)return{error:qm};if(!r||typeof r!="object")return{error:Hu};let o=uh({tournamentRecord:t,courtId:n});if(o.error)return o;let{venue:s,court:l}=o,u=Object.keys(rhe()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>u.includes(p)).length)return{error:J0};let c=u.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(r).filter(p=>c.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=wx({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||lt({payload:{venue:s,tournamentId:t.tournamentId},topic:pp,key:s==null?void 0:s.venueId}),{...X,court:Ce(l)}}var qhe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),Yhe=qhe;function o7(t){let{modifications:e,venueId:i,force:r}=t,n=bo(t);if(!Object.keys(n).length)return{error:Oi};if(typeof i!="string")return{error:Gc};let a,o;for(let s of Object.values(n)){let l=Khe({tournamentRecord:s,modifications:e,venueId:i,force:r});if(l.success&&(o=!0),l.error&&(a=l.error),l.error&&l.error!==Jm)return l}return Ab({tournamentRecords:n}),o?{...X}:{error:a}}function Khe({tournamentRecord:t,modifications:e,venueId:i,force:r}){var g,v,y,I,b,S,w,U;if(!t)return{error:ge};if(!e||typeof e!="object")return{error:Hu};if(!i)return{error:Gc};let n=(g=$t({tournamentRecord:t}))==null?void 0:g.appliedPolicies,a=r??((y=(v=n==null?void 0:n[zc])==null?void 0:v.allowDeletionWithScoresPresent)==null?void 0:y.venues),{matchUps:o}=$he({tournamentRecord:t,venueId:i}),s=tu({tournamentRecord:t,venueId:i});if(s.error)return s;let l=s.venue,u=Object.keys(Yhe()).filter(T=>T!=="venueId");if(!Object.keys(e).filter(T=>u.includes(T)).length)return{error:J0};let c=u.filter(T=>!["courts","onlineResources"].includes(T)),d=Object.keys(e).filter(T=>c.includes(T));l&&d.forEach(T=>Object.assign(l,{[T]:e[T]}));let p=((I=l==null?void 0:l.courts)==null?void 0:I.map(T=>T.courtId))??[],m=((b=e.courts)==null?void 0:b.map(T=>T.courtId))||[],h=m.length?p.filter(T=>!m.includes(T)):(e==null?void 0:e.courts)&&p,f=[];if(h!=null&&h.length){let T=(w=(S=l==null?void 0:l.courts)==null?void 0:S.filter(D=>h.includes(D.courtId)))==null?void 0:w.map(D=>{var E;let P=bx({courtId:D.courtId,tournamentRecord:t,venueMatchUps:o});for(let R of P.matchUps??[])f.push({matchUpId:R.matchUpId,drawId:R.drawId});return((E=P.matchUps)==null?void 0:E.length)??0}).reduce((D,P)=>D+P);if(l&&(!T||a))l.courts=(U=l.courts)==null?void 0:U.filter(D=>m.includes(D.courtId)),WI({schedule:{courtId:"",scheduledDate:""},matchUpDetails:f,removePriorValues:!0,tournamentRecord:t});else return Ux({matchUpsCount:T})}if(e.courts)for(let T of e.courts){let{courtId:D}=T||{},P=Tx({modifications:T,disableNotice:!0,tournamentRecord:t,venueMatchUps:o,courtId:D,force:r});if(P.error===Ag&&(P=VD({disableNotice:!0,tournamentRecord:t,venueId:i,court:T})),P.error)return P}return Ab({tournamentRecord:t}),l&&lt({payload:{venue:l,tournamentId:t.tournamentId},topic:pp,key:l==null?void 0:l.venueId}),{...X,venue:Ce(l)}}var HD={};bt(HD,{JSON2CSV:()=>ife,UUID:()=>Gt,UUIDS:()=>YH,allNumeric:()=>vG,attributeFilter:()=>Tm,chunkArray:()=>Rr,chunkByNth:()=>pC,chunkSizeProfile:()=>gG,constantToString:()=>Zr,countValues:()=>vne,createMap:()=>yG,dateTime:()=>qH,definedAttributes:()=>je,dehydrateMatchUps:()=>Qhe,extractAttributes:()=>KW,flattenJSON:()=>Dx,generateDateRange:()=>Mf,generateHashCode:()=>Dne,generateRange:()=>Te,generateTimeCode:()=>B4,groupValues:()=>hG,hasAttributeValues:()=>Tne,instanceCount:()=>Ua,intersection:()=>Vi,isConvertableInteger:()=>ot,isNumeric:()=>_i,isOdd:()=>pG,isPowerOf2:()=>Rs,makeDeepCopy:()=>Ce,matchUpScheduleSort:()=>Xhe,matchUpSort:()=>ch,nearestPowerOf2:()=>lN,nextPowerOf2:()=>Pg,noNulls:()=>gne,noNumeric:()=>IG,numericSort:()=>sr,occurrences:()=>yne,overlap:()=>Rn,randomMember:()=>ma,randomPop:()=>ga,shuffleArray:()=>wn,structureSort:()=>ih,subSort:()=>bne,undefinedToNull:()=>mC,unique:()=>ct,visualizeScheduledMatchUps:()=>Jhe});function Jhe({scheduledMatchUps:t,showGlobalLog:e}){Lse();let i=t==null?void 0:t.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:o}=t.find(s=>s.structureId===n);return{[n]:`${a} ${o}`}})};i==null||i.forEach(n=>{var s;Oa({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let a=t.filter(l=>l.structureId===n),o=((s=En({matchUps:a}))==null?void 0:s.roundMatchUps)||[];Object.keys(o).forEach(l=>{Oa({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),o[l].forEach(({matchUpId:u,schedule:c})=>{let d=wi(c.scheduledTime);Oa({matchUpId:u,time:d,date:c.scheduledDate,venue:c.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&Fse()}var{extractTime:UV,timeStringMinutes:SV}=qH;function Xhe(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=SV(UV(i.scheduledTime)),a=SV(UV(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function Qhe({tournamentRecord:t}){if(!t)return{error:ge};if(typeof t!="object"||!t.tournamentId)return{error:se};let{matchUps:e}=Vr({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=Zhe({tournamentRecord:t});tfe(e,i)}return{...X}}function Zhe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var efe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function tfe(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,o=e[r]||e[n]||e[a],s=i.matchUpFormat===o?void 0:i.matchUpFormat;for(let l of Object.keys(i))efe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function ife(t,e){if(e&&typeof e!="object")return{error:se};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:m='"',columnJoiner:h=",",rowJoiner:f=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof h!="string"||typeof f!="string"||typeof g!="string"||typeof m!="string")return{error:se};i=Object.assign({},...Object.keys(i).reverse().map(A=>({[A]:Array.isArray(i[A])?i[A]:[typeof i[A]=="string"&&i[A]].filter(Boolean)})));let v=t.filter(Boolean).map(A=>Dx(A,g)),y=Object.values(i).flat();r&&l.push(...y);let I=v.reduce((A,M)=>Object.keys(M).every(C=>!A.includes(C)&&A.push(C)||!0)&&A,[]).filter(A=>!(l!=null&&l.length)||l.includes(A)),b=Object.assign({},...Object.keys(i).reverse().map(A=>i[A].map(M=>({[M]:A})).flat()).flat()),S=(A,M)=>e!=null&&e.sortOrder?e.sortOrder.includes(A)&&e.sortOrder.includes(M)&&e.sortOrder.indexOf(A)-e.sortOrder.indexOf(M)||!e.sortOrder.includes(M)&&-1:0,w=I.reduce((A,M)=>{let C=b[M];return C?A.includes(C)||A.push(C):A.push(M),A},[]).sort(S);Object.keys(c).forEach(A=>!w.includes(A)&&w.unshift(A)),Object.keys(i).forEach(A=>!w.includes(A)&&w.unshift(A)),typeof p=="object"&&Object.keys(p).forEach(A=>!w.includes(A)&&w.unshift(A));let U=w.map(A=>c[A]||A);if(s)return[U];let T=A=>`${m}${A}${m}`,D=[],P=A=>Object.values(w.reduce((M,C,O)=>{var _;let k=i[C],x=(k!=null&&k.length?A[k.find(L=>A[L])]:A[C])||(p==null?void 0:p[C])||"",F=((_=d[C])==null?void 0:_[x])||x,$=ha(u[C])?u[C](F):F;return M[C]=T($),$&&(D[O]=(D[O]||0)+1),M},{})),E=v.map(P),R=o&&[...D].map((A,M)=>!A&&M).filter(_i).reverse();if(R){let A=M=>M.filter((C,O)=>!R.includes(O));E=E.map(A),U=A(U)}let N=E.map(A=>A.join(h));return a?N.map(A=>{let M=A.split(h);return Object.assign({},...M.map((C,O)=>({[U[O]]:C})))}):n?[U.map(T).join(h),...N].join(f):N.join(f)}function Dx(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,Dx(t[n],e,i.concat(n))),{})}var{FACTORY:TV}=Xz;function rfe({tournamentRecord:t,value:e}){let{extension:i}=vt({element:t,name:TV}),r={name:TV,value:{...i==null?void 0:i.value,...e}};Lt({element:t,extension:r})}function s7({timeStamp:t}){let e=Qm(),i=LN();return i&&Object.values(e).forEach(r=>{rfe({tournamentRecord:r,value:{version:_0(),timeStamp:t}})}),i}function l7({engineType:t,methodName:e,elapsed:i,params:r,result:n}){var d,p;let a=La();if(typeof a!="object")return;let o={method:e},s=(n==null?void 0:n.error)&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&((d=a.params)==null?void 0:d.includes(e)),u=a.params&&!Array.isArray(a.params)||l,c=Array.isArray(a.exclude)&&a.exclude.includes(e);!c&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(o.elapsed=i),!c&&(s||u)&&(o.params=r),!c&&(s||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&((p=a.result)!=null&&p.includes(e)))&&(o.result=n),Object.keys(o).length>1&&$H(o,t)}function Px({methodName:t,params:e,start:i}){let r={error:Q0,methodName:t},n=i?Date.now()-i:0;return l7({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function nfe(t,e){var a;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:ge};let i=e.drawId||((a=e.matchUp)==null?void 0:a.drawId);if(i){let{event:o,drawDefinition:s,tournamentId:l}=Wn({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),o&&(e.event=o)}if(e.eventId&&!e.event){let{event:o,tournamentId:s}=Wn({eventId:e.eventId,tournamentRecords:t});if(!o)return{error:co};e.tournamentId=s,e.event=o}let r=e.tournamentId??Xm();if(!r&&e)return e;let n=t[r];return r&&!n?{error:ge}:(n&&(e.tournamentRecord=n),e)}function Rx(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),o=Xm();i&&(i.activeTournamentId=o);let s=(i==null?void 0:i.tournamentRecord)||$N(o),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||Qm(),u=i?Ce(i,void 0,!0):void 0,c=i?nfe(l,i):void 0;if(c!=null&&c.error)return c;let d=afe({params:c,tournamentRecords:l,tournamentRecord:s,methodName:r,method:e}),p=Date.now()-a;return l7({result:d,methodName:r,elapsed:p,params:u,engineType:n}),d}function afe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(La())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return iT({engineName:"engine",methodName:r,params:i,err:a})}}function zD(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=yo();for(let o of[...a].sort(ofe)){let s=FH({topic:o});s!=null&&s.length&&TC({topic:o,notices:s})}e&&n&&a.includes(NC)&&TC({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:NC})}var DV={[EA]:5,[RA]:5,[CA]:5,[PA]:5,[DA]:5,[SA]:5,[pW]:5,[mW]:5,[TA]:1,[TT]:1,[nn]:5,[pp]:5,[UA]:4,[yA]:4,[bA]:4,[wA]:4,[ST]:3,[fA]:2};function ofe(t,e){return(DV[e]||0)-(DV[t]||0)}function sfe({convertExtensions:t,removeExtensions:e}){let i=Qm();return{tournamentId:Xm(),tournamentRecords:Ce(i,t,!1,e)}}function lfe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=(t==null?void 0:t.tournamentId)??Xm();if(typeof r!="string")return{};let n=$N(r);return{tournamentRecord:Ce(n,e,!1,i)}}function ufe(){var r;let t=Qm(),{extension:e}=vt({name:Fd,tournamentRecords:t,discover:!0}),i=((r=e==null?void 0:e.value)==null?void 0:r.tournamentIds)||[];return Object.keys(t).forEach(n=>{i.includes(n)||delete t[n]}),tT(t)}function PV(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Hu}:t!=null&&t.tournamentId?LH(e?Ce(t):t):{error:se}}function qI(t,e=!0){if(typeof t!="object")return{error:Hu};if(DI(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:gC};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},DI(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:gC};return tT(e?Ce(t):t)}function cfe(t,e,i,r,n,a){let o=BH(i,r,n,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(l=>ha(s[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:s[l],...u});if(La())return c();try{return c()}catch(d){iT({engineName:"engine",methodName:l,params:u,err:d})}}}),{...X,...t}}function Zh(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function u7(t,e){t.importMethods=(i,r,n,a)=>cfe(t,e,i,r,n,a),t.getTournament=i=>lfe(i),t.getState=i=>sfe({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>_0(),t.reset=()=>(tT({}),Zh(t)),t.devContext=i=>(SI(i),Zh(t)),t.getDevContext=i=>La(i),t.newTournamentRecord=(i={})=>{let r=$D(i),n=r.tournamentId;return r.error?r:(PV(r),DI(n),{...X,tournamentId:n})},t.setState=(i,r,n)=>{TI(r,n);let a=qI(i,r);return Zh(t,a)},t.setTournamentId=i=>DI(i),t.getTournamentId=()=>Xm(),t.setTournamentRecord=(i,r,n)=>{TI(r,n);let a=PV(i,r);return Zh(t,a)},t.removeTournamentRecord=i=>{let r=_H(i);return Zh(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=ufe();return Zh(t,i)}}function dfe(t,e,i){if(!Array.isArray(e))return{error:se,message:"directives must be an array"};let r=xH(),n=Date.now(),a=i&&Ce(Qm(),!1,!0),o=[];for(let u of e){if(typeof u!="object")return{error:se,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:se,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!r[c])return Px({methodName:c,start:n,params:p});if(d){let h=o[o.length-1],f=Object.keys(d);for(let g of f)h[g]&&(p[g]=h[g])}let m=Rx(t,r[c],p,c,"sync");if(m!=null&&m.error)return a&&qI(a),{...m,rolledBack:!!a};o.push({...m,methodName:c})}let s=Date.now(),l=s7({timeStamp:s});return zD({directives:e,mutationStatus:l,timeStamp:s}),ky(),{success:o.every(u=>u.success),results:o}}function RV(t,e){if(!Nt(e))return{error:se,message:"args must be an object"};let i=Object.values(e).filter(ha).length;if(i>1)return{message:"there must be only one arg with typeof function",error:se};let r=i?Object.keys(e).find(m=>ha(e[m])):Di(e.method)&&e.method;if(!r)return{error:Q0};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&Ce(Qm(),!1,!0),l=n||t[r]||xN()[r];if(!l)return Px({methodName:r,params:o});let u=Rx(t,l,o,r,"sync")??{};u!=null&&u.error&&s&&qI(s);let c=Date.now(),d=s7({timeStamp:c}),p=(u==null?void 0:u.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&zD({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:c}),(p||!(u!=null&&u.success)||o!=null&&o.doNotNotify)&&ky(),u}var pfe=(()=>{let t={executionQueue:(e,i)=>dfe(t,e,i),execute:e=>RV(t,e)};return u7(t,RV),t})(),Ex=pfe;function EV(t,e){if(!Nt(e))return{error:se,message:"args must be an object"};let i=Object.values(e).filter(ha).length;if(i>1)return{message:"there must be only one arg with typeof function",error:se};let r=i?Object.keys(e).find(l=>ha(e[l])):Di(e.method)&&e.method;if(!r)return{error:Q0};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=n||t[r]||xN()[r];return s?Rx(t,s,o,r,"ask"):Px({methodName:r,params:o})}(()=>{let t={execute:e=>EV(t,e)};return u7(t,EV),t})();var am={},fc;function CV(t,e=!0){if(!t)return{error:Xe};if(typeof t!="object")return{error:Hu};if(t.matchUpId)fc=t.matchUpId,am[fc]=e?Ce(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(am[i.matchUpId]=e?Ce(i):i,fc||(fc=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(am[i.matchUpId]=e?Ce(i):i,fc||(fc=i.matchUpId));return e?Ce(t):t}function mfe(){return am[fc]}function hfe(){return Object.values(am)}function ffe(){fc=void 0,am={}}function gfe(t){return Ce(am[fc],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}(()=>{let t={getState:n=>gfe(n),version:()=>_0(),reset:()=>(ffe(),{...X}),drawId:void 0,error:void 0,success:!1,devContext:n=>(SI(n),t),setState:(n,a,o)=>{TI(a,o);let s=CV(n);return e(s)}};function e(n){return n!=null&&n.error?(t.error=n.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=n.drawId),t}return i([VO]),t;function i(n){n.forEach(a=>{Object.keys(a).forEach(o=>{t[o]=s=>{if(La())return r({params:s,governor:a,methodName:o});try{return r({params:s,governor:a,methodName:o})}catch(l){iT({engineName:"matchUpEngine",methodName:o,params:s,err:l})}}})})}function r({params:n,governor:a,methodName:o}){t.error=void 0,t.success=!1;let s=(n==null?void 0:n.matchUp)||mfe(),l=(n==null?void 0:n.matchUps)||hfe(),u=(n==null?void 0:n.rollbackOnError)&&Ce(s,!1,!0);n={...n,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let c=a[o](n);if(c!=null&&c.error)return u&&CV(u),{...c,rolledBack:!!u};let d=(c==null?void 0:c.success)&&(n==null?void 0:n.delayNotify)!==!0&&(n==null?void 0:n.doNotNotify)!==!0;return d&&zD(),(d||!(c!=null&&c.success)||n!=null&&n.doNotNotify)&&ky(),c}})();var DE=!1;(()=>{let t={version:()=>_0(),setDeepCopy:(r,n)=>(TI(r,n),t),devContext:r=>(SI(r),DE=!0,t)};return i([ix]),t;function e(r,n){let a=r({...n});return a!=null&&a.error||zD(),ky(),DE&&(SI(!1),DE=!1),a}function i(r){r.forEach(n=>{Object.keys(n).forEach(a=>{t[a]=o=>{if(La()){let s=e(n[a],o);return!(s!=null&&s.error)&&(o!=null&&o.setState)&&(s!=null&&s.tournamentRecord)&&qI(s.tournamentRecord),s}else try{let s=e(n[a],o);return!(s!=null&&s.error)&&(o!=null&&o.setState)&&(s!=null&&s.tournamentRecord)&&qI(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(o),method:a,error:l})}}})})}})();Ex.importMethods(lG,!0,1);var vfe=Ex,Ife={getTournamentPoints:dD},yfe=Ife,bfe={calculateNewRatings:V3,generateDynamicRatings:j3},wfe=bfe,Ufe={...yfe,...wfe};Ex.importMethods(Ufe);var c7={};bt(c7,{activeMatchUpStatuses:()=>hA,auditConstants:()=>Ope,completedMatchUpStatuses:()=>vr,directingMatchUpStatuses:()=>oW,displayConstants:()=>spe,drawDefinitionConstants:()=>cT,entryStatusConstants:()=>Voe,errorConditionConstants:()=>jne,eventConstants:()=>Mz,extensionConstants:()=>Xz,flightConstants:()=>Xpe,genderConstants:()=>rT,keyValueConstants:()=>Ace,matchUpActionConstants:()=>Hue,matchUpStatusConstants:()=>uW,matchUpTypes:()=>pne,nonDirectingMatchUpStatuses:()=>sW,particicipantsRequiredMatchUpStatuses:()=>nW,participantConstants:()=>bW,participantRoles:()=>JA,participantTypes:()=>Jv,penaltyConstants:()=>Bfe,policyConstants:()=>goe,positionActionConstants:()=>iue,ratingConstants:()=>vue,recoveryTimeRequiredMatchUpStatuses:()=>Eoe,requestConstants:()=>$me,resourceContants:()=>xae,resultConstants:()=>Pne,scaleConstants:()=>poe,scheduleConstants:()=>mse,sortingConstants:()=>ame,surfaceConstants:()=>Wfe,tieFormatConstants:()=>Lae,timeItemConstants:()=>cse,topicConstants:()=>Moe,tournamentConstants:()=>V5,upcomingMatchUpStatuses:()=>lW,validMatchUpStatuses:()=>aW,venueConstants:()=>Kfe,weekdayConstants:()=>TY});var Sfe="Coaching",Tfe="Ball Abuse",Dfe="Racket Abuse",Pfe="Verbal Abuse",Rfe="INELIGIBILITY",Efe="Physical Abuse",Cfe="Unsportmanlike Conduct",Mfe="Dress Code Violation",Nfe="Equipment Violation",Afe="Leaving the court",Ofe="Failure to complete",kfe="No Show",xfe="Other",Ffe="REFUSAL_TO_PLAY",Lfe="PROHIBITED_SUBSTANCE",_fe="Puncuality",$fe="Failure to sign in",Bfe={COACHING:Sfe,BALL_ABUSE:Tfe,RACKET_ABUSE:Dfe,VERBAL_ABUSE:Pfe,PHYSICAL_ABUSE:Efe,INELIGIBILITY:Rfe,UNSPORTSMANLIKE_CONDUCT:Cfe,PROHIBITED_SUBSTANCE:Lfe,DRESS_CODE_VIOLATION:Mfe,EQUIMENT_VIOLATION:Nfe,LEAVING_THE_COURT:Afe,REFUSAL_TO_PLAY:Ffe,FAILURE_TO_COMPLETE:Ofe,NO_SHOW:kfe,OTHER:xfe,PUNCTUALITY:_fe,FAILUIRE_TO_SIGN_IN:$fe},Vfe="CLAY",jfe="HARD",Gfe="GRASS",Hfe="CARPET",zfe="ARTIFICIAL",Wfe={CLAY:Vfe,HARD:jfe,GRASS:Gfe,CARPET:Hfe,ARTIFICIAL:zfe},qfe="INDOOR",Yfe="OUTDOOR",Kfe={INDOOR:qfe,OUTDOOR:Yfe};const{AFTER_REST:Jfe,FOLLOWED_BY:Xfe,NEXT_AVAILABLE:Qfe,NOT_BEFORE:Zfe,TO_BE_ANNOUNCED:ege}=c7.timeItemConstants,d1="overlay",Zi="center",MV="header",Nm="right",zd="left",NV="top",p1="",vU="flex",Hs="none",tge="buttonBar",AV="roundsColumns",ige=8,OV="roundsStats",kV="roundsTable",rge={[Jfe]:"After rest",[Xfe]:"Followed by",[ege]:"TBA",[Qfe]:"Next available",[Zfe]:"NB"};function cu(t){return typeof t=="function"}function m1(t){return typeof t=="object"&&!Array.isArray(t)}const PE="font-medium";function om(t){var y;const{target:e,button:i,stateChange:r}=t;let n=0;const a=()=>(n+=1,`Item${n}`),o=document.createElement("div");i.class&&o.classList.add(i.class),o.classList.add("dropdown"),i.id&&(o.id=i.id),i.align===Nm?(o.classList.add("is-right"),o.style.marginLeft="1em"):o.style.marginRight="1em";const s=I=>I.classList.contains("is-active"),l=()=>{s(o)&&o.classList.remove("is-active")},u=I=>{s(I)?I.classList.remove("is-active"):I.classList.add("is-active")};o.onmouseleave=l,o.onclick=()=>u(o);const c=document.createElement("div");c.classList.add("dropdown-trigger");const d=document.createElement("button");d.className="button font-medium",i.intent&&d.classList.add(i.intent),d.setAttribute("aria-haspopup","true");const p=document.createElement("span");cu(i.onClick)&&(p.onclick=i.onClick),p.style.marginRight="1em",p.innerHTML=i.label,d.appendChild(p);const m=document.createElement("span");cu(i.onClick)&&(m.onclick=i.onClick),m.innerHTML=`
      <span class="icon is-small font-medium">
        ⌄
      </span>
  `,m.style.height="2em",d.appendChild(m),c.appendChild(d),o.appendChild(c);const h=document.createElement("div");h.classList.add("dropdown-menu"),h.style.zIndex="99998";const f=document.createElement("div");f.classList.add("dropdown-content");const g=()=>{const I=h.querySelectorAll(".dropdown-item");for(const b of Array.from(I))b.classList.remove("is-active")},v=I=>{const b=document.createElement("a");b.className=PE;const S=I.disabled?"0.4":"1";return b.style.textDecoration="none",b.style.opacity=S,I.color&&(b.style.color=I.color),b.classList.add("dropdown-item"),I.isActive&&b.classList.add("is-active"),I.value&&b.setAttribute("value",I.value),I.class&&b.classList.add(I.class),b.onclick=w=>{if(I.disabled)return;I.value&&(d.value=I.value,o.setAttribute("value",I.value)),w.stopPropagation(),cu(I.onClick)&&(cu(r)&&r(),I.onClick(w)),I.close&&l();const U=s(b);g(),U?p.innerHTML=i.label:(i.selection&&u(b),i.modifyLabel&&I.modifyLabel!==!1&&(p.innerHTML=`${i.append?i.label+": ":""}${(I==null?void 0:I.label)||a()}`))},b.innerHTML=(I==null?void 0:I.label)||a(),b};for(const I of i.options||[])if(I.heading){const b=document.createElement("div");b.style.fontWeight="bold",b.classList.add("dropdown-item"),b.classList.add(PE),b.innerHTML=I.heading,f.appendChild(b)}else if(I.divider){const b=document.createElement("hr");b.classList.add("dropdown-divider"),b.classList.add(PE),f.appendChild(b)}else I.hide||f.appendChild(v(I));return(y=i.options)!=null&&y.length&&(i.options[0].value&&o.setAttribute("value",i.options[0].value),h.appendChild(f)),o.appendChild(h),e&&e.appendChild(o),o}function nge(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}class Ja{constructor(e){this.table=e}reloadData(e,i,r){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,r)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,r){return this.table.deprecationAdvisor.check(e,i,r)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class xr{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,r){var n=e?i.split(e):[i],a=n.length,o;for(let s=0;s<a&&(r=r[n[s]],o=r,!!r);s++);return o}static deepClone(e,i,r=[]){var n={}.__proto__,a=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var o in e){let s=e[o],l,u;s!=null&&typeof s=="object"&&(s.__proto__===n||s.__proto__===a)&&(l=r.findIndex(c=>c.subject===s),l>-1?i[o]=r[l].copy:(u=Object.assign(Array.isArray(s)?[]:{},s),r.unshift({subject:s,copy:u}),i[o]=this.deepClone(s,u,r)))}return i}}let age=class d7 extends Ja{constructor(e,i,r){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=r,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),r=i?e.touches[0].pageX:e.pageX,n=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let a=xr.elOffset(this.container);r-=a.left,n-=a.top}return{x:r,y:n}}elementPositionCoords(e,i="right"){var r=xr.elOffset(e),n,a,o;switch(this.container!==document.body&&(n=xr.elOffset(this.container),r.left-=n.left,r.top-=n.top),i){case"right":a=r.left+e.offsetWidth,o=r.top-1;break;case"bottom":a=r.left,o=r.top+e.offsetHeight;break;case"left":a=r.left,o=r.top-1;break;case"top":a=r.left,o=r.top;break;case"center":a=r.left+e.offsetWidth/2,o=r.top+e.offsetHeight/2;break}return{x:a,y:o,offset:r}}show(e,i){var r,n,a,o,s;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(a=e,s=this.elementPositionCoords(e,i),o=s.offset,r=s.x,n=s.y):typeof e=="number"?(o={top:0,left:0},r=e,n=i):(s=this.containerEventCoords(e),r=s.x,n=s.y,this.reversedX=!1),this.element.style.top=n+"px",this.element.style.left=r+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(r,n,a,o,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,r,n,a){var o=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;(e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",r?this.element.style.right=this.container.offsetWidth-n.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0);let s=Math.max(this.container.offsetHeight,o?this.container.scrollHeight:0);if(i+this.element.offsetHeight>s)if(r)switch(a){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-r.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+r.offsetHeight+1+"px"}else this.element.style.height=s+"px"}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new d7(this.table,e,this),this.childPopup}};class ci extends Ja{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...r)=>(this.table.initGuard(e),i(...r)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,r){return this.table.componentFunctionBinder.bind(e,i,r)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,r;if(this._handler&&(r=this.table.rowManager.displayPipeline.findIndex(n=>n.handler===this._handler),r>-1&&(i=r)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new age(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}}var oge={rownum:function(t,e,i,r,n,a){return a.getPosition()}};const gf=class gf extends ci{constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="accessor"+(n.charAt(0).toUpperCase()+n.slice(1)),o;e.definition[a]&&(o=this.lookupAccessor(e.definition[a]),o&&(i=!0,r[a]={accessor:o,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.accessor=r)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":gf.accessors[e]?i=gf.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var r="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),n=e.getComponent(),a=xr.deepClone(e.data||{});return this.table.columnManager.traverse(function(o){var s,l,u,c;o.modules.accessor&&(l=o.modules.accessor[r]||o.modules.accessor.accessor||!1,l&&(s=o.getFieldValue(a),s!="undefined"&&(c=o.getComponent(),u=typeof l.params=="function"?l.params(s,a,i,c,n):l.params,o.setFieldValue(a,l.accessor(s,a,i,u,c,n)))))}),a}};Ve(gf,"moduleName","accessor"),Ve(gf,"accessors",oge);let h1=gf;var sge={method:"GET"};function f1(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(f1(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(f1(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}function lge(t){var e=f1(t),i=[];return e.forEach(function(r){i.push(encodeURIComponent(r.key)+"="+encodeURIComponent(r.value))}),i.join("&")}function p7(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+lge(i)),t}function uge(t,e,i){var r;return new Promise((n,a)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(r=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],r){for(var o in r.headers)e.headers||(e.headers={}),typeof e.headers[o]>"u"&&(e.headers[o]=r.headers[o]);e.body=r.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(s=>{s.ok?s.json().then(l=>{n(l)}).catch(l=>{a(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+s.status,s.statusText),a(s))}).catch(s=>{console.error("Ajax Load Error - Connection Error: ",s),a(s)})):(console.warn("Ajax Load Error - No URL Set"),n([]))})}function g1(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(g1(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(g1(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}var cge={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var r=g1(i),n=new FormData;return r.forEach(function(a){n.append(a.key,a.value)}),n}}};const Rl=class Rl extends ci{constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=Rl.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||Rl.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||Rl.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,r,n){var a=this.table.options.ajaxParams;return a&&(typeof a=="function"&&(a=a.call(this.table)),n=Object.assign(Object.assign({},a),n)),n}requestDataCheck(e,i,r,n){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,r,n,a){var o;return!a&&this.requestDataCheck(e)?(e&&this.setUrl(e),o=this.generateConfig(r),this.sendRequest(this.url,i,o)):a}setDefaultConfig(e={}){this.config=Object.assign({},Rl.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,r){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,r,i).then(n=>(this.table.options.ajaxResponse&&(n=this.table.options.ajaxResponse.call(this.table,e,i,n)),n)):Promise.reject()}};Ve(Rl,"moduleName","ajax"),Ve(Rl,"defaultConfig",sge),Ve(Rl,"defaultURLGenerator",p7),Ve(Rl,"defaultLoaderPromise",uge),Ve(Rl,"contentTypeFormatters",cge);let v1=Rl;var dge={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)}},pge={table:function(t){var e=[],i=!0,r=this.table.columnManager.columns,n=[],a=[];return t=t.split(`
`),t.forEach(function(o){e.push(o.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(o){var s=r.find(function(l){return o&&l.definition.title&&o.trim()&&l.definition.title.trim()===o.trim()});s?n.push(s):i=!1}),i||(i=!0,n=[],e[0].forEach(function(o){var s=r.find(function(l){return o&&l.field&&o.trim()&&l.field.trim()===o.trim()});s?n.push(s):i=!1}),i||(n=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(o){var s={};o.forEach(function(l,u){n[u]&&(s[n[u].field]=l)}),a.push(s)}),a):!1}},mge={copyToClipboard:["ctrl + 67","meta + 67"]},hge={copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}},fge={keybindings:{bindings:mge,actions:hge}};const vd=class vd extends ci{constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,r,n;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(n=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),r=this.table.modules.export.generateHTMLTable(n),i=r?this.generatePlainContent(n):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),r=this.table.options.clipboardCopyFormatter("html",r))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),r&&e.clipboardData.setData("text/html",r)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),r&&e.originalEvent.clipboardData.setData("text/html",r)),this.dispatchExternal("clipboardCopied",i,r),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(r=>{var n=[];r.columns.forEach(a=>{var o="";if(a)if(r.type==="group"&&(a.value=a.component.getKey()),a.value===null)o="";else switch(typeof a.value){case"object":o=JSON.stringify(a.value);break;case"undefined":o="";break;default:o=a.value}n.push(o)}),i.push(n.join("	"))}),i.join(`
`)}copy(e,i){var r,n;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),r=window.getSelection(),r.toString()&&i&&(this.customSelection=r.toString()),r.removeAllRanges(),r.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(n=document.body.createTextRange(),n.moveToElementText(this.table.element),n.select()),document.execCommand("copy"),r&&r.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=vd.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=vd.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,r,n;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),r=this.pasteParser.call(this,i),r?(e.preventDefault(),this.table.modExists("mutator")&&(r=this.mutateData(r)),n=this.pasteAction.call(this,r),this.dispatchExternal("clipboardPasted",i,r,n)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(r=>{i.push(this.table.modules.mutator.transformRow(r,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,r=this.confirm("clipboard-paste",[e]);return(r||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}};Ve(vd,"moduleName","clipboard"),Ve(vd,"moduleExtensions",fge),Ve(vd,"pasteActions",dge),Ve(vd,"pasteParsers",pge);let I1=vd;class gge{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class m7{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,r)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class Gb extends Ja{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var e=this.element,i=this.column.getField(),r={top:"flex-start",bottom:"flex-end",middle:"center"},n={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=r[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=n[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var a=this.column.definition.cssClass.split(" ");a.forEach(o=>{e.classList.add(o)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,r){var n=this.setValueProcessData(e,i,r);n&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,r){var n=!1;return(this.value!==e||r)&&(n=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),n&&this.dispatch("cell-value-changed",this),n}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new m7(this)),this.component}}class h7{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._column.table.componentFunctionBinder.handle("column",i._column,r)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var r=this._column.table.columnManager.findColumn(e);r?this._column.table.columnManager.moveColumn(this._column,r,i):console.warn("Move Error - No matching column found:",r)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var f7={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};const zp=class zp extends Ja{constructor(e,i,r){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=r,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((n,a)=>{var o=new zp(n,this);this.attachColumn(o)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.isRowHeader&&e.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(zp.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{zp.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(r=>{this.element.classList.add(r)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var r=document.createElement("input");r.classList.add("tabulator-title-editor"),r.addEventListener("click",n=>{n.stopPropagation(),r.focus()}),r.addEventListener("mousedown",n=>{n.stopPropagation()}),r.addEventListener("change",()=>{e.title=r.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(r),e.field?this.langBind("columns|"+e.field,n=>{r.value=n||e.title||"&nbsp;"}):r.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,n=>{this._formatColumnHeaderTitle(i,n||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var r=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof r){case"object":r instanceof Node?e.appendChild(r):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",r));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=r}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,r=this.fieldStructure,n=r.length,a;for(let o=0;o<n&&(i=i[r[o]],a=i,!!i);o++);return a}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var r=e,n=this.fieldStructure,a=n.length;for(let o=0;o<a;o++)if(o==a-1)r[n[o]]=i;else{if(!r[n[o]])if(typeof i<"u")r[n[o]]={};else break;r=r[n[o]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var r=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=r+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=r-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(n){n.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(r){i.push(r.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.table.initialized&&(this.element.style.width=e+"px"),this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(n){n.delete()}),this.dispatch("column-delete",this);var r=this.cells.length;for(let n=0;n<r;n++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new Gb(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(n=>{n.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(n=>{var a=n.getWidth();a>i&&(i=a)}),i)){var r=i+1;this.maxInitialWidth&&!e&&(r=Math.min(r,this.maxInitialWidth)),this.setWidthActual(r)}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(r=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>r.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new h7(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof zp?this.parent.getComponent():!1}};Ve(zp,"defaultOptionList",f7);let sm=zp;class WD{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class no extends Ja{constructor(e,i,r="row"){super(i.table),this.parent=i,this.data={},this.type=r,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,r=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(r=this.calcMinHeight(),i=this.calcMaxHeight(),e?this.height=Math.max(i,r):this.height=this.manualHeight?this.height:Math.max(i,r)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var e=0;return this.cells.forEach(function(i){var r=i.getHeight();r>e&&(e=r)}),e}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&xr.elVisible(this.element),r={},n;return new Promise((a,o)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(r=Object.assign(r,this.data),r=Object.assign(r,e)),n=this.chain("row-data-changing",[this,r,e],null,e);for(let s in n)this.data[s]=n[s];this.dispatch("row-data-save-after",this);for(let s in e)this.table.columnManager.getColumnsByFieldRoot(s).forEach(u=>{let c=this.getCell(u.getField());if(c){let d=u.getFieldValue(n);c.getValue()!==d&&(c.setValueProcessData(d),i&&c.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),a()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(r){return r.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var r=this.table.rowManager.findRow(e);r?(this.table.rowManager.moveRowActual(this,r,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new WD(this)),this.component}}var vge={avg:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:2;return t.length&&(r=t.reduce(function(a,o){return Number(a)+Number(o)}),r=r/t.length,r=n!==!1?r.toFixed(n):r),parseFloat(r).toString()},max:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a>r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},min:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a<r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},sum:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(a){a=Number(a),r+=isNaN(a)?0:Number(a)}),n!==!1?r.toFixed(n):r},concat:function(t,e,i){var r=0;return t.length&&(r=t.reduce(function(n,a){return String(n)+String(a)})),r},count:function(t,e,i){var r=0;return t.length&&t.forEach(function(n){n&&r++}),r},unique:function(t,e,i){var r=t.filter((n,a)=>(t||n===0)&&t.indexOf(n)===a);return r.length}};const Id=class Id extends ci{constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new sm({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,r={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":Id.calculations[i.topCalc]?r.topCalc=Id.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":r.topCalc=i.topCalc;break}r.topCalc&&(e.modules.columnCalcs=r,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":Id.calculations[i.bottomCalc]?r.botCalc=Id.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":r.botCalc=i.bottomCalc;break}r.botCalc&&(e.modules.columnCalcs=r,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,r;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),r=this.generateRow("top",i),this.topRow=r;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(r.getElement()),r.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),r=this.generateRow("bottom",i),this.botRow=r;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(r.getElement()),r.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,r;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),r=this.generateRowData("bottom",i),e.calcs.bottom.updateData(r),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),r=this.generateRowData("top",i),e.calcs.top.updateData(r),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[],r=this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs,n=this.table.modules.dataTree;return e.forEach(a=>{var o;i.push(a.getData()),r&&((o=a.modules.dataTree)!=null&&o.open)&&this.rowsToData(n.getFilteredTreeChildren(a)).forEach(s=>{i.push(a)})}),i}generateRow(e,i){var r=this.generateRowData(e,i),n;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),n=new no(r,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),n.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),n.component=!1,n.getComponent=()=>(n.component||(n.component=new gge(n)),n.component),n.generateCells=()=>{var a=[];this.table.columnManager.columnsByIndex.forEach(o=>{this.genColumn.setField(o.getField()),this.genColumn.hozAlign=o.hozAlign,o.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter(o.definition[e+"CalcFormatter"]),params:o.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=o.definition.cssClass;var s=new Gb(this.genColumn,n);s.getElement(),s.column=o,s.setWidth(),o.cells.push(s),a.push(s),o.visible||s.hide()}),n.cells=a},n}generateRowData(e,i){var r={},n=e=="top"?this.topCalcs:this.botCalcs,a=e=="top"?"topCalc":"botCalc",o,s;return n.forEach(function(l){var u=[];l.modules.columnCalcs&&l.modules.columnCalcs[a]&&(i.forEach(function(c){u.push(l.getFieldValue(c))}),s=a+"Params",o=typeof l.modules.columnCalcs[s]=="function"?l.modules.columnCalcs[s](u,i):l.modules.columnCalcs[s],l.setFieldValue(r,l.modules.columnCalcs[a](u,i,o)))}),r}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(r=>{e[r.getKey()]=this.getGroupResults(r)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),r=e.getSubGroups(),n={},a={};return r.forEach(o=>{n[o.getKey()]=this.getGroupResults(o)}),a={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:n},a}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}};Ve(Id,"moduleName","columnCalcs"),Ve(Id,"calculations",vge);let y1=Id;class g7 extends ci{constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(r,n){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(r,n){return i.dataTreeStartExpanded[n]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(r=>{this.reinitializeRowChildren(r)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,r){this.redrawNeeded(r)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],r=Array.isArray(i),n=r||!r&&typeof i=="object"&&i!==null;!n&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!n&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:n?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&n?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&n?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:n}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(r){r.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],r=i.getElement(),n=e.modules.dataTree;n.branchEl&&(n.branchEl.parentNode&&n.branchEl.parentNode.removeChild(n.branchEl),n.branchEl=!1),n.controlEl&&(n.controlEl.parentNode&&n.controlEl.parentNode.removeChild(n.controlEl),n.controlEl=!1),this.generateControlElement(e,r),e.getElement().classList.add("tabulator-tree-level-"+n.index),n.index&&(this.branchEl?(n.branchEl=this.branchEl.cloneNode(!0),r.insertBefore(n.branchEl,r.firstChild),this.table.rtl?n.branchEl.style.marginRight=(n.branchEl.offsetWidth+n.branchEl.style.marginLeft)*(n.index-1)+n.index*this.indent+"px":n.branchEl.style.marginLeft=(n.branchEl.offsetWidth+n.branchEl.style.marginRight)*(n.index-1)+n.index*this.indent+"px"):this.table.rtl?r.style.paddingRight=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-right"))+n.index*this.indent+"px":r.style.paddingLeft=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-left"))+n.index*this.indent+"px")}generateControlElement(e,i){var r=e.modules.dataTree,n=r.controlEl;i=i||e.getCells()[0].getElement(),r.children!==!1&&(r.open?(r.controlEl=this.collapseEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.collapseRow(e)})):(r.controlEl=this.expandEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.expandRow(e)})),r.controlEl.addEventListener("mousedown",a=>{a.stopPropagation()}),n&&n.parentNode===i?n.parentNode.replaceChild(r.controlEl,n):i.insertBefore(r.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((r,n)=>{var a,o;i.push(r),r instanceof no&&(r.create(),a=r.modules.dataTree,!a.index&&a.children!==!1&&(o=this.getChildren(r,!1,!0),o.forEach(s=>{s.create(),i.push(s)})))}),i}getChildren(e,i,r){var n=e.modules.dataTree,a=[],o=[];return n.children!==!1&&(n.open||i)&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?a=this.table.modules.filter.filter(n.children):a=n.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(a,r),a.forEach(s=>{o.push(s);var l=this.getChildren(s,!1,!0);l.forEach(u=>{o.push(u)})})),o}generateChildren(e){var i=[],r=e.getData()[this.field];return Array.isArray(r)||(r=[r]),r.forEach(n=>{var a=new no(n||{},this.table.rowManager);a.create(),a.modules.dataTree.index=e.modules.dataTree.index+1,a.modules.dataTree.parent=e,a.modules.dataTree.children&&(a.modules.dataTree.open=this.startOpen(a.getComponent(),a.modules.dataTree.index)),i.push(a)}),i}expandRow(e,i){var r=e.modules.dataTree;r.children!==!1&&(r.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,r=[],n;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?n=this.table.modules.filter.filter(i.children):n=i.children,n.forEach(a=>{a instanceof no&&r.push(a)})),r}rowDelete(e){var i=e.modules.dataTree.parent,r;i&&(r=this.findChildIndex(e,i),r!==!1&&i.data[this.field].splice(r,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,r,n){var a=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof n<"u"&&(a=this.findChildIndex(n,e),a!==!1&&e.data[this.field].splice(r?a:a+1,0,i)),a===!1&&(r?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var r=!1;return typeof e=="object"?e instanceof no?r=e.data:e instanceof WD?r=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(r=i.modules.dataTree.children.find(n=>n instanceof no?n.element===e:!1),r&&(r=r.data)):e===null&&(r=!1):typeof e>"u"?r=!1:r=i.data[this.field].find(n=>n.data[this.table.options.index]==e),r&&(Array.isArray(i.data[this.field])&&(r=i.data[this.field].indexOf(r)),r==-1&&(r=!1)),r}getTreeChildren(e,i,r){var n=e.modules.dataTree,a=[];return n&&n.children&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),n.children.forEach(o=>{o instanceof no&&(a.push(i?o.getComponent():o),r&&this.getTreeChildren(o,i,r).forEach(s=>{a.push(s)}))})),a}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}Ve(g7,"moduleName","dataTree");function Ige(t,e={},i){var r=e.delimiter?e.delimiter:",",n=[],a=[];t.forEach(o=>{var s=[];switch(o.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":o.columns.forEach((l,u)=>{l&&l.depth===1&&(a[u]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":o.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}s.push('"'+String(l.value).split('"').join('""')+'"')}}),n.push(s.join(r));break}}),a.length&&n.unshift(a.join(r)),n=n.join(`
`),e.bom&&(n="\uFEFF"+n),i(n,"text/csv")}function yge(t,e,i){var r=[];t.forEach(n=>{var a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(o=>{o&&(a[o.component.getTitleDownload()||o.component.getField()]=o.value)}),r.push(a);break}}),r=JSON.stringify(r,null,"	"),i(r,"application/json")}function bge(t,e={},i){var r=[],n=[],a={},o=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},s=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},u=e.title?e.title:"";l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(p=>{switch(p.type){case"header":r.push(c(p));break;case"group":n.push(c(p,o));break;case"calc":n.push(c(p,s));break;case"row":n.push(c(p));break}});function c(p,m){var h=[];return p.columns.forEach(f=>{var g;if(f){switch(typeof f.value){case"object":f.value=f.value!==null?JSON.stringify(f.value):"";break;case"undefined":f.value="";break}g={content:f.value,colSpan:f.width,rowSpan:f.height},m&&(g.styles=m),h.push(g)}}),h}var d=new jspdf.jsPDF(l);e.autoTable&&(typeof e.autoTable=="function"?a=e.autoTable(d)||{}:a=e.autoTable),u&&(a.didDrawPage=function(p){d.text(u,40,30)}),a.head=r,a.body=n,d.autoTable(a),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function wge(t,e,i){var r=this,n=e.sheetName||"Sheet1",a=XLSX.utils.book_new(),o=new Ja(this),s="compress"in e?e.compress:!0,l=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:s},u;l.type="binary",a.SheetNames=[],a.Sheets={};function c(){var m=[],h=[],f={},g={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((v,y)=>v+(y&&y.width?y.width:1),0):0,r:t.length}};return t.forEach((v,y)=>{var I=[];v.columns.forEach(function(b,S){b?(I.push(!(b.value instanceof Date)&&typeof b.value=="object"?JSON.stringify(b.value):b.value),(b.width>1||b.height>-1)&&(b.height>1||b.width>1)&&h.push({s:{r:y,c:S},e:{r:y+b.height-1,c:S+b.width-1}})):I.push("")}),m.push(I)}),XLSX.utils.sheet_add_aoa(f,m),f["!ref"]=XLSX.utils.encode_range(g),h.length&&(f["!merges"]=h),f}if(e.sheetOnly){i(c());return}if(e.sheets)for(var d in e.sheets)e.sheets[d]===!0?(a.SheetNames.push(d),a.Sheets[d]=c()):(a.SheetNames.push(d),o.commsSend(e.sheets[d],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:r.active,intercept:function(m){a.Sheets[d]=m}}));else a.SheetNames.push(n),a.Sheets[n]=c();e.documentProcessing&&(a=e.documentProcessing(a));function p(m){for(var h=new ArrayBuffer(m.length),f=new Uint8Array(h),g=0;g!=m.length;++g)f[g]=m.charCodeAt(g)&255;return h}u=XLSX.write(a,l),i(p(u),"application/octet-stream")}function Uge(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function Sge(t,e,i){const r=[];t.forEach(n=>{const a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(o=>{o&&(a[o.component.getTitleDownload()||o.component.getField()]=o.value)}),r.push(JSON.stringify(a));break}}),i(r.join(`
`),"application/x-ndjson")}var Tge={csv:Ige,json:yge,jsonLines:Sge,pdf:bge,xlsx:wge,html:Uge};const vf=class vf extends ci{constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,r){return new Blob([i],{type:r})}),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){}downloadToTab(e,i,r,n){this.download(e,i,r,n,!0)}download(e,i,r,n,a){var o=!1;function s(u,c){a?a===!0?this.triggerDownload(u,c,e,i,!0):a(u):this.triggerDownload(u,c,e,i)}if(typeof e=="function"?o=e:vf.downloaders[e]?o=vf.downloaders[e]:console.warn("Download Error - No such download type found: ",e),o){var l=this.generateExportList(n);o.call(this.table,l,r||{},s.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),r=this.table.options.groupHeaderDownload;return r&&!Array.isArray(r)&&(r=[r]),i.forEach(n=>{var a;n.type==="group"&&(a=n.columns[0],r&&r[n.indent]&&(a.value=r[n.indent](a.value,n.component._group.getRowCount(),n.component._group.getData(),n.component)))}),i}triggerDownload(e,i,r,n,a){var o=document.createElement("a"),s=this.table.options.downloadEncoder(e,i);s&&(a?window.open(window.URL.createObjectURL(s)):(n=n||"Tabulator."+(typeof r=="function"?"txt":r),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(s,n):(o.setAttribute("href",window.URL.createObjectURL(s)),o.setAttribute("download",n),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,r){switch(i){case"intercept":this.download(r.type,"",r.options,r.active,r.intercept);break}}};Ve(vf,"moduleName","download"),Ve(vf,"downloaders",Tge);let b1=vf;function qD(t,e){var i=e.mask,r=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",n=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",a=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function o(s){var l=i[s];typeof l<"u"&&l!==a&&l!==r&&l!==n&&(t.value=t.value+""+l,o(s+1))}t.addEventListener("keydown",s=>{var l=t.value.length,u=s.key;if(s.keyCode>46&&!s.ctrlKey&&!s.metaKey){if(l>=i.length)return s.preventDefault(),s.stopPropagation(),!1;switch(i[l]){case r:if(u.toUpperCase()==u.toLowerCase())return s.preventDefault(),s.stopPropagation(),!1;break;case n:if(isNaN(u))return s.preventDefault(),s.stopPropagation(),!1;break;case a:break;default:if(u!==i[l])return s.preventDefault(),s.stopPropagation(),!1}}}),t.addEventListener("keyup",s=>{s.keyCode>46&&e.maskAutoFill&&o(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&o(t.value.length)}function Dge(t,e,i,r,n){var a=t.getValue(),o=document.createElement("input");if(o.setAttribute("type",n.search?"search":"text"),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+n.elementAttributes["+"+l])):o.setAttribute(l,n.elementAttributes[l]);o.value=typeof a<"u"?a:"",e(function(){t.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%",n.selectContents&&o.select())});function s(l){(a===null||typeof a>"u")&&o.value!==""||o.value!==a?i(o.value)&&(a=o.value):r()}return o.addEventListener("change",s),o.addEventListener("blur",s),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:r();break;case 35:case 36:l.stopPropagation();break}}),n.mask&&qD(o,n),o}function Pge(t,e,i,r,n){var a=t.getValue(),o=n.verticalNavigation||"hybrid",s=String(a!==null&&typeof a<"u"?a:""),l=document.createElement("textarea"),u=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+n.elementAttributes["+"+d])):l.setAttribute(d,n.elementAttributes[d]);l.value=s,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),n.selectContents&&l.select())});function c(d){(a===null||typeof a>"u")&&l.value!==""||l.value!==a?(i(l.value)&&(a=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):r()}return l.addEventListener("change",c),l.addEventListener("blur",c),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=u&&(u=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&n.shiftEnterSubmit&&c();break;case 27:r();break;case 38:(o=="editor"||o=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(o=="editor"||o=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),n.mask&&qD(l,n),l}function Rge(t,e,i,r,n){var a=t.getValue(),o=n.verticalNavigation||"editor",s=document.createElement("input");if(s.setAttribute("type","number"),typeof n.max<"u"&&s.setAttribute("max",n.max),typeof n.min<"u"&&s.setAttribute("min",n.min),typeof n.step<"u"&&s.setAttribute("step",n.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let c in n.elementAttributes)c.charAt(0)=="+"?(c=c.slice(1),s.setAttribute(c,s.getAttribute(c)+n.elementAttributes["+"+c])):s.setAttribute(c,n.elementAttributes[c]);s.value=a;var l=function(c){u()};e(function(){t.getType()==="cell"&&(s.removeEventListener("blur",l),s.focus({preventScroll:!0}),s.style.height="100%",s.addEventListener("blur",l),n.selectContents&&s.select())});function u(){var c=s.value;!isNaN(c)&&c!==""&&(c=Number(c)),c!==a?i(c)&&(a=c):r()}return s.addEventListener("keydown",function(c){switch(c.keyCode){case 13:u();break;case 27:r();break;case 38:case 40:o=="editor"&&(c.stopImmediatePropagation(),c.stopPropagation());break;case 35:case 36:c.stopPropagation();break}}),n.mask&&qD(s,n),s}function Ege(t,e,i,r,n){var a=t.getValue(),o=document.createElement("input");if(o.setAttribute("type","range"),typeof n.max<"u"&&o.setAttribute("max",n.max),typeof n.min<"u"&&o.setAttribute("min",n.min),typeof n.step<"u"&&o.setAttribute("step",n.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+n.elementAttributes["+"+l])):o.setAttribute(l,n.elementAttributes[l]);o.value=a,e(function(){t.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%")});function s(){var l=o.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=a?i(l)&&(a=l):r()}return o.addEventListener("blur",function(l){s()}),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:r();break}}),o}function Cge(t,e,i,r,n){var a=n.format,o=n.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l=t.getValue(),u=document.createElement("input");function c(p){var m;return s.isDateTime(p)?m=p:a==="iso"?m=s.fromISO(String(p)):m=s.fromFormat(String(p),a),m.toFormat("yyyy-MM-dd")}if(u.type="date",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.max&&u.setAttribute("max",a?c(n.max):n.max),n.min&&u.setAttribute("min",a?c(n.min):n.min),n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+n.elementAttributes["+"+p])):u.setAttribute(p,n.elementAttributes[p]);l=typeof l<"u"?l:"",a&&(s?l=c(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=l,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select())});function d(){var p=u.value,m;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&a)switch(m=s.fromFormat(String(p),"yyyy-MM-dd"),a){case!0:p=m;break;case"iso":p=m.toISO();break;default:p=m.toFormat(a)}i(p)&&(l=u.value)}else r()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function Mge(t,e,i,r,n){var a=n.format,o=n.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l,u=t.getValue(),c=document.createElement("input");if(c.type="time",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(s?(s.isDateTime(u)?l=u:a==="iso"?l=s.fromISO(String(u)):l=s.fromFormat(String(u),a),u=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()=="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,m;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(m=s.fromFormat(String(p),"hh:mm"),a){case!0:p=m;break;case"iso":p=m.toISO();break;default:p=m.toFormat(a)}i(p)&&(u=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function Nge(t,e,i,r,n){var a=n.format,o=n.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l,u=t.getValue(),c=document.createElement("input");if(c.type="datetime-local",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(s?(s.isDateTime(u)?l=u:a==="iso"?l=s.fromISO(String(u)):l=s.fromFormat(String(u),a),u=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,m;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(m=s.fromISO(String(p)),a){case!0:p=m;break;case"iso":p=m.toISO();break;default:p=m.toFormat(a)}i(p)&&(u=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}let Age=class{constructor(e,i,r,n,a,o){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(o),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:n,cancel:a},this._deprecatedOptionsCheck(),this._initializeValue(),r(this._onRendered.bind(this))}_deprecatedOptionsCheck(){}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(r){r.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let r in e)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,i.getAttribute(r)+e["+"+r])):i.setAttribute(r,e[r]);return this.params.mask&&qD(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],r;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",r=Object.keys(e).filter(n=>i.includes(n)).length,r?r>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var r=this.displayItems.find(n=>typeof n.label<"u"&&n.label.toLowerCase().startsWith(this.filterTerm));r&&this._focusItem(r),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],r=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(n=>this.listIteration===r?this._parseList(n):Promise.reject(r))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var r=this.params.filterRemote?{term:i}:{};return e=p7(e,{},r),fetch(e).then(n=>n.ok?n.json().catch(a=>(console.warn("List Ajax Load Error - Invalid JSON returned",a),Promise.reject(a))):(console.error("List Ajax Load Error - Connection Error: "+n.status,n.statusText),Promise.reject(n))).catch(n=>(console.error("List Ajax Load Error - Connection Error: ",n),Promise.reject(n)))}_uniqueColumnValues(e){var i={},r=this.table.getData(this.params.valuesLookup),n;return e?n=this.table.columnManager.getColumnByField(e):n=this.cell.getColumn()._getSelf(),n?r.forEach(a=>{var o=n.getFieldValue(a);o!==null&&typeof o<"u"&&o!==""&&(i[o]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([r,n])=>({label:n,value:r}))),e.forEach(r=>{typeof r!="object"&&(r={label:r,value:r}),this._parseListItem(r,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,r){var n={};e.options?n=this._parseListGroup(e,r+1):(n={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:r,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(n,!0)),i.push(n)}_parseListGroup(e,i){var r={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(n=>{this._parseListItem(n,r.options,i)}),r}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((r,n)=>e(r.label,n.label,r.value,n.value,r.original,n.original)),i.forEach(r=>{r.group&&this._sortGroup(e,r.options)})}_defaultSortFunction(e,i){var r,n,a,o,s=0,l,u=/(\d+)|(\D+)/g,c=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(r=String(e).toLowerCase(),n=String(i).toLowerCase(),r===n)return 0;if(!(c.test(r)&&c.test(n)))return r>n?1:-1;for(r=r.match(u),n=n.match(u),l=r.length>n.length?n.length:r.length;s<l;)if(a=r[s],o=n[s++],a!==o)return isFinite(a)&&isFinite(o)?(a.charAt(0)==="0"&&(a="."+a),o.charAt(0)==="0"&&(o="."+o),a-o):a>o?1:-1;return r.length>n.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(r=>{this._filterItem(e,i,r)})):this.filtered=!1,this.data}_filterItem(e,i,r){var n=!1;return r.group?(r.options.forEach(a=>{this._filterItem(e,i,a)&&(n=!0)}),r.visible=n):r.visible=e(i,r.label,r.value,r.original),r.visible}_defaultFilterFunc(e,i,r,n){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(r).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,r;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,r=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,r instanceof HTMLElement?i.appendChild(r):i.innerHTML=r,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let n in e.elementAttributes)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,this.input.getAttribute(n)+e.elementAttributes["+"+n])):i.setAttribute(n,e.elementAttributes[n]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(n=>{this._buildItem(n)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var r;this.typing=!1,this.params.multiselect?(r=this.currentItems.indexOf(e),r>-1?(this.currentItems.splice(r,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(n=>n.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,r;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(n=>n.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(r=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,r===null||typeof r>"u"||r===""?i=r:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}};function Oge(t,e,i,r,n){var a=new Age(this,t,e,i,r,n);return a.input}function kge(t,e,i,r,n){var a=this,o=t.getElement(),s=t.getValue(),l=o.getElementsByTagName("svg").length||5,u=o.getElementsByTagName("svg")[0]?o.getElementsByTagName("svg")[0].getAttribute("width"):14,c=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function m(v){c.forEach(function(y,I){I<v?(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-active"):y.classList.replace("tabulator-star-inactive","tabulator-star-active"),y.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-inactive"):y.classList.replace("tabulator-star-active","tabulator-star-inactive"),y.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function h(v){var y=document.createElement("span"),I=p.cloneNode(!0);c.push(I),y.addEventListener("mouseenter",function(b){b.stopPropagation(),b.stopImmediatePropagation(),m(v)}),y.addEventListener("mousemove",function(b){b.stopPropagation(),b.stopImmediatePropagation()}),y.addEventListener("click",function(b){b.stopPropagation(),b.stopImmediatePropagation(),i(v),o.blur()}),y.appendChild(I),d.appendChild(y)}function f(v){s=v,m(v)}if(o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",u),p.setAttribute("height",u),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",n.elementAttributes&&typeof n.elementAttributes=="object")for(let v in n.elementAttributes)v.charAt(0)=="+"?(v=v.slice(1),d.setAttribute(v,d.getAttribute(v)+n.elementAttributes["+"+v])):d.setAttribute(v,n.elementAttributes[v]);for(var g=1;g<=l;g++)h(g);return s=Math.min(parseInt(s),l),m(s),d.addEventListener("mousemove",function(v){m(0)}),d.addEventListener("click",function(v){i(0)}),o.addEventListener("blur",function(v){r()}),o.addEventListener("keydown",function(v){switch(v.keyCode){case 39:f(s+1);break;case 37:f(s-1);break;case 13:i(s);break;case 27:r();break}}),d}function xge(t,e,i,r,n){var a=t.getElement(),o=typeof n.max>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("max")||100:n.max,s=typeof n.min>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("min")||0:n.min,l=(o-s)/100,u=t.getValue()||0,c=document.createElement("div"),d=document.createElement("div"),p,m;function h(){var f=window.getComputedStyle(a,null),g=l*Math.round(d.offsetWidth/((a.clientWidth-parseInt(f.getPropertyValue("padding-left"))-parseInt(f.getPropertyValue("padding-right")))/100))+s;i(g),a.setAttribute("aria-valuenow",g),a.setAttribute("aria-label",u)}if(c.style.position="absolute",c.style.right="0",c.style.top="0",c.style.bottom="0",c.style.width="5px",c.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",n.elementAttributes&&typeof n.elementAttributes=="object")for(let f in n.elementAttributes)f.charAt(0)=="+"?(f=f.slice(1),d.setAttribute(f,d.getAttribute(f)+n.elementAttributes["+"+f])):d.setAttribute(f,n.elementAttributes[f]);return a.style.padding="4px 4px",u=Math.min(parseFloat(u),o),u=Math.max(parseFloat(u),s),u=Math.round((u-s)/l),d.style.width=u+"%",a.setAttribute("aria-valuemin",s),a.setAttribute("aria-valuemax",o),d.appendChild(c),c.addEventListener("mousedown",function(f){p=f.screenX,m=d.offsetWidth}),c.addEventListener("mouseover",function(){c.style.cursor="ew-resize"}),a.addEventListener("mousemove",function(f){p&&(d.style.width=m+f.screenX-p+"px")}),a.addEventListener("mouseup",function(f){p&&(f.stopPropagation(),f.stopImmediatePropagation(),p=!1,m=!1,h())}),a.addEventListener("keydown",function(f){switch(f.keyCode){case 39:f.preventDefault(),d.style.width=d.clientWidth+a.clientWidth/100+"px";break;case 37:f.preventDefault(),d.style.width=d.clientWidth-a.clientWidth/100+"px";break;case 9:case 13:h();break;case 27:r();break}}),a.addEventListener("blur",function(){r()}),d}function Fge(t,e,i,r,n){var a=t.getValue(),o=document.createElement("input"),s=n.tristate,l=typeof n.indeterminateValue>"u"?null:n.indeterminateValue,u=!1,c=Object.keys(n).includes("trueValue"),d=Object.keys(n).includes("falseValue");if(o.setAttribute("type","checkbox"),o.style.marginTop="5px",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let m in n.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),o.setAttribute(m,o.getAttribute(m)+n.elementAttributes["+"+m])):o.setAttribute(m,n.elementAttributes[m]);o.value=a,s&&(typeof a>"u"||a===l||a==="")&&(u=!0,o.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&o.focus({preventScroll:!0})}),o.checked=c?a===n.trueValue:a===!0||a==="true"||a==="True"||a===1;function p(m){var h=o.checked;return c&&h?h=n.trueValue:d&&!h&&(h=n.falseValue),s?m?u?l:h:o.checked&&!u?(o.checked=!1,o.indeterminate=!0,u=!0,l):(u=!1,h):h}return o.addEventListener("change",function(m){i(p())}),o.addEventListener("blur",function(m){i(p(!0))}),o.addEventListener("keydown",function(m){m.keyCode==13&&i(p()),m.keyCode==27&&r()}),o}var Lge={input:Dge,textarea:Pge,number:Rge,range:Ege,date:Cge,time:Mge,datetime:Nge,list:Oge,star:kge,progress:xge,tickCross:Fge};const gI=class gI extends ci{constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.convertEmptyValues=!1,this.editors=gI.editors,this.registerTableOption("editTriggerEvent","focus"),this.registerTableOption("editorEmptyValue"),this.registerTableOption("editorEmptyValueFunc",this.emptyValueCheck.bind(this)),this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("editorEmptyValue"),this.registerColumnOption("editorEmptyValueFunc"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0)),Object.keys(this.table.options).includes("editorEmptyValue")&&(this.convertEmptyValues=!0)}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,r=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||r&&(i.getElement().firstChild.blur(),this.invalidEdit||(r===!0?r=this.table.addRow({}):typeof r=="function"?r=this.table.addRow(r(i.row.getComponent())):r=this.table.addRow(Object.assign({},r)),r.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateLeft(),r)return!0;if(n=this.table.rowManager.prevDisplayRow(e.row,!0),n&&(r=this.findPrevEditableCell(n,n.cells.length),r))return r.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateRight(),r)return!0;if(n=this.table.rowManager.nextDisplayRow(e.row,!0),n&&(r=this.findNextEditableCell(n,-1),r))return r.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findPrevEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findNextEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.prevDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.nextDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var r=!1;if(i<e.cells.length-1)for(var n=i+1;n<e.cells.length;n++){let a=e.cells[n];if(a.column.modules.edit&&xr.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}findPrevEditableCell(e,i){var r=!1;if(i>0)for(var n=i-1;n>=0;n--){let a=e.cells[n];if(a.column.modules.edit&&xr.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i=Object.keys(e.definition).includes("editorEmptyValue"),r={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{},convertEmptyValues:i,editorEmptyValue:e.definition.editorEmptyValue,editorEmptyValueFunc:e.definition.editorEmptyValueFunc};switch(typeof e.definition.editor){case"string":this.editors[e.definition.editor]?r.editor=this.editors[e.definition.editor]:console.warn("Editor Error - No such editor found: ",e.definition.editor);break;case"function":r.editor=e.definition.editor;break;case"boolean":e.definition.editor===!0&&(typeof e.definition.formatter!="function"?this.editors[e.definition.formatter]?r.editor=this.editors[e.definition.formatter]:r.editor=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",e.definition.formatter));break}r.editor&&(e.modules.edit=r)}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,r;if(this.invalidEdit=!1,i){for(this.currentCell=!1,r=i.getElement(),this.dispatch("edit-editor-clear",i,e),r.classList.remove("tabulator-editing");r.firstChild;)r.removeChild(r.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,r=e.getElement(!0);this.updateCellClass(e),r.setAttribute("tabindex",0),r.addEventListener("mousedown",function(n){n.button===2?n.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&r.addEventListener("dblclick",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&r.addEventListener("click",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),this.options("editTriggerEvent")==="focus"&&r.addEventListener("focus",function(n){i.recursionBlock||i.edit(e,n,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,r=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,n=e.row.getElement();n.offsetTop<i?this.table.rowManager.element.scrollTop-=i-n.offsetTop:n.offsetTop+n.offsetHeight>r&&(this.table.rowManager.element.scrollTop+=n.offsetTop+n.offsetHeight-r);var a=this.table.rowManager.element.scrollLeft,o=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,s=e.getElement();this.table.modExists("frozenColumns")&&(a+=parseInt(this.table.modules.frozenColumns.leftMargin||0),o-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(a-=parseInt(this.table.columnManager.renderer.vDomPadLeft),o-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),s.offsetLeft<a?this.table.rowManager.element.scrollLeft-=a-s.offsetLeft:s.offsetLeft+s.offsetWidth>o&&(this.table.rowManager.element.scrollLeft+=s.offsetLeft+s.offsetWidth-o)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,r){var n=this,a=!0,o=function(){},s=e.getElement(),l=!1,u,c,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(v){if(n.currentCell===e&&!l){var y=n.chain("edit-success",[e,v],!0,!0);return y===!0||n.table.options.validationMode==="highlight"?(l=!0,n.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,n.editedCells.indexOf(e)==-1&&n.editedCells.push(e),v=n.transformEmptyValues(v,e),e.setValue(v,!0),y===!0):(l=!0,n.invalidEdit=!0,n.focusCellNoEvent(e,!0),o(),setTimeout(()=>{l=!1},10),!1)}}function m(){n.currentCell===e&&!l&&n.cancelEdit()}function h(v){o=v}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(s),!1;if(i&&i.stopPropagation(),a=this.allowEdit(e),a||r){if(n.cancelEdit(),n.currentCell=e,this.focusScrollAdjust(e),c=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,c)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,c),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",c),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(c):e.column.modules.edit.params,u=e.column.modules.edit.editor.call(n,c,h,p,m,d),this.currentCell&&u!==!1)if(u instanceof Node){for(s.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");s.firstChild;)s.removeChild(s.firstChild);s.appendChild(u),o();for(var f=s.children,g=0;g<f.length;g++)f[g].addEventListener("click",function(v){v.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",u),this.blur(s),!1;else return this.blur(s),!1;return!0}else return this.mouseClick=!1,this.blur(s),!1}emptyValueCheck(e){return e===""||e===null||typeof e>"u"}transformEmptyValues(e,i){var r=i.column.modules.edit,n=r.convertEmptyValues||this.convertEmptyValues,a;return n&&(a=r.editorEmptyValueFunc||this.options("editorEmptyValueFunc"),a&&a(e)&&(e=r.convertEmptyValues?r.editorEmptyValue:this.options("editorEmptyValue"))),e}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}};Ve(gI,"moduleName","edit"),Ve(gI,"editors",Lge);let w1=gI;class xV{constructor(e,i,r,n){this.type=e,this.columns=i,this.component=r||!1,this.indent=n||0}}class RE{constructor(e,i,r,n,a){this.value=e,this.component=i||!1,this.width=r,this.height=n,this.depth=a}}var _ge={},$ge={visible:function(){return this.rowManager.getVisibleRows(!1,!0)},all:function(){return this.rowManager.rows},selected:function(){return this.modules.selectRow.selectedRows},active:function(){return this.options.pagination?this.rowManager.getDisplayRows(this.rowManager.displayRows.length-2):this.rowManager.getDisplayRows()}};const yd=class yd extends ci{constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.colVisPropAttach="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,r,n){var a,o,s,l;return this.cloneTableStyle=i,this.config=e||{},this.colVisProp=n,this.colVisPropAttach=this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1),l=yd.columnLookups[r],l&&(s=l.call(this.table),s=s.filter(u=>this.columnVisCheck(u))),a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(s)):[],s&&(s=s.map(u=>u.getComponent())),o=this.bodyToExportRows(this.rowLookup(r),s),a.concat(o)}generateTable(e,i,r,n){var a=this.generateExportList(e,i,r,n);return this.generateTableElement(a)}rowLookup(e){var i=[],r;return typeof e=="function"?e.call(this.table).forEach(n=>{n=this.table.rowManager.findRow(n),n&&i.push(n)}):(r=yd.rowLookups[e]||yd.rowLookups.active,i=r.call(this.table)),Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(r=>{var n=this.processColumnGroup(r);n&&i.push(n)}),i}processColumnGroup(e){var i=e.columns,r=0,n=e.definition["title"+this.colVisPropAttach]||e.definition.title,a={title:n,column:e,depth:1};if(i.length){if(a.subGroups=[],a.width=0,i.forEach(o=>{var s=this.processColumnGroup(o);s&&(a.width+=s.width,a.subGroups.push(s),s.depth>r&&(r=s.depth))}),a.depth+=r,!a.width)return!1}else if(this.columnVisCheck(e))a.width=1;else return!1;return a}columnVisCheck(e){var i=e.definition[this.colVisProp];return this.config.rowHeaders===!1&&e.isRowHeader?!1:(typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i===!1||i===!0?i:e.visible&&e.field)}headersToExportRows(e){var i=[],r=0,n=[];function a(o,s){var l=r-s;if(typeof i[s]>"u"&&(i[s]=[]),o.height=o.subGroups?1:l-o.depth+1,i[s].push(o),o.height>1)for(let u=1;u<o.height;u++)typeof i[s+u]>"u"&&(i[s+u]=[]),i[s+u].push(!1);if(o.width>1)for(let u=1;u<o.width;u++)i[s].push(!1);o.subGroups&&o.subGroups.forEach(function(u){a(u,s+1)})}return e.forEach(function(o){o.depth>r&&(r=o.depth)}),e.forEach(function(o){a(o,0)}),i.forEach(o=>{var s=[];o.forEach(l=>{if(l){let u=typeof l.title>"u"?"":l.title;s.push(new RE(u,l.column.getComponent(),l.width,l.height,l.depth))}else s.push(null)}),n.push(new xV("header",s))}),n}bodyToExportRows(e,i=[]){var r=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(n=>{this.columnVisCheck(n)&&i.push(n.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(n=>{switch(n.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&n.modules.dataTree.parent)}return!0}),e.forEach((n,a)=>{var o=n.getData(this.colVisProp),s=[],l=0;switch(n.type){case"group":l=n.level,s.push(new RE(n.key,n.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(u=>{s.push(new RE(u._column.getFieldValue(o),u,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=n.modules.dataTree.index);break}r.push(new xV(n.type,s,n.getComponent(),l))}),r}generateTableElement(e){var i=document.createElement("table"),r=document.createElement("thead"),n=document.createElement("tbody"),a=this.lookupTableStyles(),o=this.table.options["rowFormatter"+this.colVisPropAttach],s={};return s.rowFormatter=o!==null?o:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(s.treeElementField=this.table.modules.dataTree.elementField),s.groupHeader=this.table.options["groupHeader"+this.colVisPropAttach],s.groupHeader&&!Array.isArray(s.groupHeader)&&(s.groupHeader=[s.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),r,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,u)=>{let c;switch(l.type){case"header":r.appendChild(this.generateHeaderElement(l,s,a));break;case"group":n.appendChild(this.generateGroupElement(l,s,a));break;case"calc":n.appendChild(this.generateCalcElement(l,s,a));break;case"row":c=this.generateRowElement(l,s,a),this.mapElementStyles(u%2&&a.evenRow?a.evenRow:a.oddRow,c,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n.appendChild(c);break}}),r.innerHTML&&i.appendChild(r),i.appendChild(n),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.styleRowHeader=e.firstRow.getElementsByClassName("tabulator-row-header")[0],e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,r){var n=document.createElement("tr");return e.columns.forEach(a=>{if(a){var o=document.createElement("th"),s=a.component._column.definition.cssClass?a.component._column.definition.cssClass.split(" "):[];o.colSpan=a.width,o.rowSpan=a.height,o.innerHTML=a.value,this.cloneTableStyle&&(o.style.boxSizing="border-box"),s.forEach(function(l){o.classList.add(l)}),this.mapElementStyles(a.component.getElement(),o,["text-align","border-left","border-right","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(a.component._column.contentElement,o,["padding-top","padding-left","padding-right","padding-bottom"]),a.component._column.visible?this.mapElementStyles(a.component.getElement(),o,["width"]):a.component._column.definition.width&&(o.style.width=a.component._column.definition.width+"px"),a.component._column.parent&&a.component._column.parent.isGroup?this.mapElementStyles(a.component._column.parent.groupElement,o,["border-top"]):this.mapElementStyles(a.component.getElement(),o,["border-top"]),a.component._column.isGroup?this.mapElementStyles(a.component.getElement(),o,["border-bottom"]):this.mapElementStyles(this.table.columnManager.getElement(),o,["border-bottom"]),n.appendChild(o)}}),n}generateGroupElement(e,i,r){var n=document.createElement("tr"),a=document.createElement("td"),o=e.columns[0];return n.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?o.value=i.groupHeader[e.indent](o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(o.value=e.component._group.generator(o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),a.colSpan=o.width,a.innerHTML=o.value,n.classList.add("tabulator-print-table-group"),n.classList.add("tabulator-group-level-"+e.indent),o.component.isVisible()&&n.classList.add("tabulator-group-visible"),this.mapElementStyles(r.firstGroup,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(r.firstGroup,a,["padding-top","padding-left","padding-right","padding-bottom"]),n.appendChild(a),n}generateCalcElement(e,i,r){var n=this.generateRowElement(e,i,r);return n.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(r.calcRow,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n}generateRowElement(e,i,r){var n=document.createElement("tr");if(n.classList.add("tabulator-print-table-row"),e.columns.forEach((a,o)=>{if(a){var s=document.createElement("td"),l=a.component._column,u=this.table,c=u.columnManager.findColumnIndex(l),d=a.value,p,m,h={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return s},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return u},getComponent:function(){return h},column:l},f=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(f.forEach(function(g){s.classList.add(g)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(h,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?s.appendChild(d):s.innerHTML=d,m=["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"],l.isRowHeader?(p=r.styleRowHeader,m.push("background-color")):p=r.styleCells&&r.styleCells[c]?r.styleCells[c]:r.firstCell,p&&(this.mapElementStyles(p,s,m),l.definition.align&&(s.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&o==0)&&(e.component._row.modules.dataTree.controlEl&&s.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),s.firstChild),e.component._row.modules.dataTree.branchEl&&s.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),s.firstChild)),n.appendChild(s),h.modules.format&&h.modules.format.renderedCallback&&h.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let a=Object.assign(e.component);a.getElement=function(){return n},i.rowFormatter(e.component)}return n}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,r,n){var a=this.generateExportList(r||this.table.options.htmlOutputConfig,i,e,n||"htmlOutput");return this.generateHTMLTable(a)}mapElementStyles(e,i,r){if(this.cloneTableStyle&&e&&i){var n={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var a=window.getComputedStyle(e);r.forEach(function(o){i.style[n[o]]||(i.style[n[o]]=a.getPropertyValue(o))})}}}};Ve(yd,"moduleName","export"),Ve(yd,"columnLookups",_ge),Ve(yd,"rowLookups",$ge);let U1=yd;var Bge={"=":function(t,e,i,r){return e==t},"<":function(t,e,i,r){return e<t},"<=":function(t,e,i,r){return e<=t},">":function(t,e,i,r){return e>t},">=":function(t,e,i,r){return e>=t},"!=":function(t,e,i,r){return e!=t},regex:function(t,e,i,r){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,r){var n=t.toLowerCase().split(typeof r.separator>"u"?" ":r.separator),a=String(e===null||typeof e>"u"?"":e).toLowerCase(),o=[];return n.forEach(s=>{a.includes(s)&&o.push(!0)}),r.matchAll?o.length===n.length:!!o.length},starts:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,r){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};const mc=class mc extends ci{constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,r,n){return n.filter=this.getFilters(!0,!0),n}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,r,n){this.setFilter(e,i,r,n),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,r,n){this.addFilter(e,i,r,n),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var r=this.table.columnManager.findColumn(e);if(r)this.setHeaderFilterValue(r,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,r){this.removeFilter(e,i,r),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,r){return this.search("rows",e,i,r)}searchData(e,i,r){return this.search("data",e,i,r)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var r=this,n=e.getField();function a(o){var s=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",u="",c;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==o){if(e.modules.filter.prevSuccess=o,e.modules.filter.emptyFunc(o))delete r.headerFilters[n];else{switch(e.modules.filter.value=o,typeof e.definition.headerFilterFunc){case"string":mc.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,c=function(d){var p=e.definition.headerFilterFuncParams||{},m=e.getFieldValue(d);return p=typeof p=="function"?p(o,m,d):p,mc.filters[e.definition.headerFilterFunc](o,m,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":c=function(d){var p=e.definition.headerFilterFuncParams||{},m=e.getFieldValue(d);return p=typeof p=="function"?p(o,m,d):p,e.definition.headerFilterFunc(o,m,d,p)},l=c;break}if(!c)switch(s){case"partial":c=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(o).toLowerCase())>-1:!1},l="like";break;default:c=function(d){return e.getFieldValue(d)==o},l="="}r.headerFilters[n]={value:o,func:c,type:l}}e.modules.filter.value=o,u=JSON.stringify(r.headerFilters),r.prevHeaderFilterChangeCheck!==u&&(r.prevHeaderFilterChangeCheck=u,r.trackChanges(),r.refreshFilter())}return!0}e.modules.filter={success:a,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,r){var n=this,a=e.modules.filter.success,o=e.getField(),s,l,u,c,d,p,m,h;e.modules.filter.value=i;function f(){}function g(v){h=v}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),o){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(v){return!v&&v!==0},s=document.createElement("div"),s.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":n.table.modules.edit.editors[e.definition.headerFilter]?(l=n.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&n.table.modules.edit.editors[e.definition.formatter]?(l=n.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):l=n.table.modules.edit.editors.input;break}if(l){if(c={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return s},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},m=e.definition.headerFilterParams||{},m=typeof m=="function"?m.call(n.table,c):m,u=l.call(this.table.modules.edit,c,g,a,f,m),!u){console.warn("Filter Error - Cannot add filter to "+o+" column, editor returned a value of false");return}if(!(u instanceof Node)){console.warn("Filter Error - Cannot add filter to "+o+" column, editor should return an instance of Node, the editor returned:",u);return}n.langBind("headerFilters|columns|"+e.definition.field,function(v){u.setAttribute("placeholder",typeof v<"u"&&v?v:e.definition.headerFilterPlaceholder||n.langText("headerFilters|default"))}),u.addEventListener("click",function(v){v.stopPropagation(),u.focus()}),u.addEventListener("focus",v=>{var y=this.table.columnManager.contentsElement.scrollLeft,I=this.table.rowManager.element.scrollLeft;y!==I&&(this.table.rowManager.scrollHorizontal(y),this.table.columnManager.scrollHorizontal(y))}),d=!1,p=function(v){d&&clearTimeout(d),d=setTimeout(function(){a(u.value)},n.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=u,e.modules.filter.attrType=u.hasAttribute("type")?u.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=u.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(u.addEventListener("keyup",p),u.addEventListener("search",p),e.modules.filter.attrType=="number"&&u.addEventListener("change",function(v){a(u.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&u.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&u.addEventListener("mousedown",function(v){v.stopPropagation()})),s.appendChild(u),e.contentElement.appendChild(s),r||n.headerFilterColumns.push(e),h&&h()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,r,n){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),this.addFilter(e)}addFilter(e,i,r,n){var a=!1;Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),e.forEach(o=>{o=this.findFilter(o),o&&(this.filterList.push(o),a=!0)}),a&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var r=!1;return typeof e.field=="function"?r=function(n){return e.field(n,e.type||{})}:mc.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?r=function(n){return mc.filters[e.type](e.value,i.getFieldValue(n),n,e.params||{})}:r=function(n){return mc.filters[e.type](e.value,n[e.field],n,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=r,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(r=>{r=this.findFilter(r),r&&i.push(r)}),i.length?i:!1}getFilters(e,i){var r=[];return e&&(r=this.getHeaderFilters()),i&&r.forEach(function(n){typeof n.type=="function"&&(n.type="function")}),r=r.concat(this.filtersToArray(this.filterList,i)),r}filtersToArray(e,i){var r=[];return e.forEach(n=>{var a;Array.isArray(n)?r.push(this.filtersToArray(n,i)):(a={field:n.field,type:n.type,value:n.value},i&&typeof a.type=="function"&&(a.type="function"),r.push(a))}),r}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,r){Array.isArray(e)||(e=[{field:e,type:i,value:r}]),e.forEach(n=>{var a=-1;typeof n.field=="object"?a=this.filterList.findIndex(o=>n===o):a=this.filterList.findIndex(o=>n.field===o.field&&n.type===o.type&&n.value===o.value),a>-1?this.filterList.splice(a,1):console.warn("Filter Error - No matching filter type found, ignoring: ",n.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,r,n){var a=[],o=[];return Array.isArray(i)||(i=[{field:i,type:r,value:n}]),i.forEach(s=>{s=this.findFilter(s),s&&o.push(s)}),this.table.rowManager.rows.forEach(s=>{var l=!0;o.forEach(u=>{this.filterRecurse(u,s.getData())||(l=!1)}),l&&a.push(e==="data"?s.getData("data"):s.getComponent())}),a}filter(e,i){var r=[],n=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(a=>{this.filterRow(a)&&r.push(a)}):r=e.slice(0),this.subscribedExternal("dataFiltered")&&(r.forEach(a=>{n.push(a.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),n)),r}filterRow(e,i){var r=!0,n=e.getData();this.filterList.forEach(o=>{this.filterRecurse(o,n)||(r=!1)});for(var a in this.headerFilters)this.headerFilters[a].func(n)||(r=!1);return r}filterRecurse(e,i){var r=!1;return Array.isArray(e)?e.forEach(n=>{this.filterRecurse(n,i)&&(r=!0)}):r=e.func(i),r}};Ve(mc,"moduleName","filter"),Ve(mc,"filters",Bge);let S1=mc;function Vge(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function jge(t,e,i){return t.getValue()}function Gge(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function Hge(t,e,i){var r=parseFloat(t.getValue()),n="",a,o,s,l,u,c=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",m=e.symbol||"",h=!!e.symbolAfter,f=typeof e.precision<"u"?e.precision:2;if(isNaN(r))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(r<0&&(r=Math.abs(r),n=p),a=f!==!1?r.toFixed(f):r,a=String(a).split("."),o=a[0],s=a.length>1?c+a[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(o);)o=o.replace(l,"$1"+d+"$2");return u=o+s,n===!0?(u="("+u+")",h?u+m:m+u):h?n+u+m:n+m+u}function zge(t,e,i){var r=t.getValue(),n=e.urlPrefix||"",a=e.download,o=r,s=document.createElement("a"),l;function u(c,d){var p=c.shift(),m=d[p];return c.length&&typeof m=="object"?u(c,m):m}if(e.labelField&&(l=t.getData(),o=u(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":o=e.label;break;case"function":o=e.label(t);break}if(o){if(e.urlField&&(l=t.getData(),r=xr.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":r=e.url;break;case"function":r=e.url(t);break}return s.setAttribute("href",n+r),e.target&&s.setAttribute("target",e.target),e.download&&(typeof a=="function"?a=a(t):a=a===!0?"":a,s.setAttribute("download",a)),s.innerHTML=this.emptyToSpace(this.sanitizeHTML(o)),s}else return"&nbsp;"}function Wge(t,e,i){var r=document.createElement("img"),n=t.getValue();switch(e.urlPrefix&&(n=e.urlPrefix+t.getValue()),e.urlSuffix&&(n=n+e.urlSuffix),r.setAttribute("src",n),typeof e.height){case"number":r.style.height=e.height+"px";break;case"string":r.style.height=e.height;break}switch(typeof e.width){case"number":r.style.width=e.width+"px";break;case"string":r.style.width=e.width;break}return r.addEventListener("load",function(){t.getRow().normalizeHeight()}),r}function qge(t,e,i){var r=t.getValue(),n=t.getElement(),a=e.allowEmpty,o=e.allowTruthy,s=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',u=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return s&&r===e.trueValue||!s&&(o&&r||r===!0||r==="true"||r==="True"||r===1||r==="1")?(n.setAttribute("aria-checked",!0),l||""):a&&(r==="null"||r===""||r===null||typeof r>"u")?(n.setAttribute("aria-checked","mixed"),""):(n.setAttribute("aria-checked",!1),u||"")}function Yge(t,e,i){var r=window.DateTime||luxon.DateTime,n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=e.outputFormat||"dd/MM/yyyy HH:mm:ss",o=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=t.getValue();if(typeof r<"u"){var l;return r.isDateTime(s)?l=s:n==="iso"?l=r.fromISO(String(s)):l=r.fromFormat(String(s),n),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(a)):o===!0||!s?s:typeof o=="function"?o(s):o}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function Kge(t,e,i){var r=window.DateTime||luxon.DateTime,n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=typeof e.suffix<"u"?e.suffix:!1,s=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,u=typeof e.date<"u"?e.date:r.now(),c=t.getValue();if(typeof r<"u"){var d;return r.isDateTime(c)?d=c:n==="iso"?d=r.fromISO(String(c)):d=r.fromFormat(String(c),n),d.isValid?l?d.diff(u,s).toHuman()+(o?" "+o:""):parseInt(d.diff(u,s)[s])+(o?" "+o:""):a===!0?c:typeof a=="function"?a(c):a}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function Jge(t,e,i){var r=t.getValue();return typeof e[r]>"u"?(console.warn("Missing display value for "+r),r):e[r]}function Xge(t,e,i){var r=t.getValue(),n=t.getElement(),a=e&&e.stars?e.stars:5,o=document.createElement("span"),s=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',u='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';o.style.verticalAlign="middle",s.setAttribute("width","14"),s.setAttribute("height","14"),s.setAttribute("viewBox","0 0 512 512"),s.setAttribute("xml:space","preserve"),s.style.padding="0 1px",r=r&&!isNaN(r)?parseInt(r):0,r=Math.max(0,Math.min(r,a));for(var c=1;c<=a;c++){var d=s.cloneNode(!0);d.innerHTML=c<=r?l:u,o.appendChild(d)}return n.style.whiteSpace="nowrap",n.style.overflow="hidden",n.style.textOverflow="ellipsis",n.setAttribute("aria-label",r),o}function Qge(t,e,i){var r=this.sanitizeHTML(t.getValue())||0,n=document.createElement("span"),a=e&&e.max?e.max:100,o=e&&e.min?e.min:0,s=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",u,c;if(!(isNaN(r)||typeof t.getValue()>"u")){switch(n.classList.add("tabulator-traffic-light"),c=parseFloat(r)<=a?parseFloat(r):a,c=parseFloat(c)>=o?parseFloat(c):o,u=(a-o)/100,c=Math.round((c-o)/u),typeof s){case"string":l=s;break;case"function":l=s(r);break;case"object":if(Array.isArray(s)){var d=100/s.length,p=Math.floor(c/d);p=Math.min(p,s.length-1),p=Math.max(p,0),l=s[p];break}}return n.style.backgroundColor=l,n}}function Zge(t,e={},i){var r=this.sanitizeHTML(t.getValue())||0,n=t.getElement(),a=e.max?e.max:100,o=e.min?e.min:0,s=e.legendAlign?e.legendAlign:"center",l,u,c,d,p;switch(u=parseFloat(r)<=a?parseFloat(r):a,u=parseFloat(u)>=o?parseFloat(u):o,l=(a-o)/100,u=Math.round((u-o)/l),typeof e.color){case"string":c=e.color;break;case"function":c=e.color(r);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,v=Math.floor(u/g);v=Math.min(v,e.color.length-1),v=Math.max(v,0),c=e.color[v];break}default:c="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(r);break;case"boolean":d=r;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(r);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,v=Math.floor(u/g);v=Math.min(v,e.legendColor.length-1),v=Math.max(v,0),p=e.legendColor[v]}break;default:p="#000"}n.style.minWidth="30px",n.style.position="relative",n.setAttribute("aria-label",u);var m=document.createElement("div");m.style.display="inline-block",m.style.width=u+"%",m.style.backgroundColor=c,m.style.height="100%",m.setAttribute("data-max",a),m.setAttribute("data-min",o);var h=document.createElement("div");if(h.style.position="relative",h.style.width="100%",h.style.height="100%",d){var f=document.createElement("div");f.style.position="absolute",f.style.top=0,f.style.left=0,f.style.textAlign=s,f.style.width="100%",f.style.color=p,f.innerHTML=d}return i(function(){if(!(t instanceof m7)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",n.appendChild(g),n=g}n.appendChild(h),h.appendChild(m),d&&h.appendChild(f)}),""}function eve(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function tve(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function ive(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function rve(t,e,i){var r=t.getValue(),n=e.size||15,a=n+"px",o,s,l=e.hasOwnProperty("onValue")?e.onValue:!0,u=e.hasOwnProperty("offValue")?e.offValue:!1,c=e.onTruthy?r:r===l;return o=document.createElement("div"),o.classList.add("tabulator-toggle"),c?(o.classList.add("tabulator-toggle-on"),o.style.flexDirection="row-reverse",e.onColor&&(o.style.background=e.onColor)):e.offColor&&(o.style.background=e.offColor),o.style.width=2.5*n+"px",o.style.borderRadius=a,e.clickable&&o.addEventListener("click",d=>{t.setValue(c?u:l)}),s=document.createElement("div"),s.classList.add("tabulator-toggle-switch"),s.style.height=a,s.style.width=a,s.style.borderRadius=a,o.appendChild(s),o}function nve(t,e,i){var r=document.createElement("span"),n=t.getRow(),a=t.getTable();return n.watchPosition(o=>{e.relativeToPage&&(o+=a.modules.page.getPageSize()*(a.modules.page.getPage()-1)),r.innerText=o}),r}function ave(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}var ove={plaintext:Vge,html:jge,textarea:Gge,money:Hge,link:zge,image:Wge,tickCross:qge,datetime:Yge,datetimediff:Kge,lookup:Jge,star:Xge,traffic:Qge,progress:Zge,color:eve,buttonTick:tve,buttonCross:ive,toggle:rve,rownum:nve,handle:ave};const Vs=class Vs extends ci{constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupFormatter(e,"HtmlOutput"))}lookupFormatter(e,i){var r={params:e.definition["formatter"+i+"Params"]||{}},n=e.definition["formatter"+i];switch(typeof n){case"string":Vs.formatters[n]?r.formatter=Vs.formatters[n]:(console.warn("Formatter Error - No such formatter found: ",n),r.formatter=Vs.formatters.plaintext);break;case"function":r.formatter=n;break;default:r.formatter=Vs.formatters.plaintext;break}return r}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,r){var n,a,o,s;return e.definition.titleFormatter?(n=this.getFormatter(e.definition.titleFormatter),o=l=>{e.titleFormatterRendered=l},s={getValue:function(){return i},getElement:function(){return r},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},a=e.definition.titleFormatterParams||{},a=typeof a=="function"?a():a,n.call(this,s,a,o)):i}formatValue(e){var i=e.getComponent(),r=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function n(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,r,n)}formatExportValue(e,i){var r=e.column.modules.format[i],n;if(r){let a=function(o){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=o,e.modules.format.rendered=!1};return n=typeof r.params=="function"?r.params(e.getComponent()):r.params,r.formatter.call(this,e.getComponent(),n,a)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(r){return i[r]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}getFormatter(e){switch(typeof e){case"string":Vs.formatters[e]?e=Vs.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),e=Vs.formatters.plaintext);break;case"function":break;default:e=Vs.formatters.plaintext;break}return e}};Ve(Vs,"moduleName","format"),Ve(Vs,"formatters",ove);let T1=Vs;class v7 extends ci{constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],r=0,n=0;this.leftColumns.forEach((a,o)=>{if(a.modules.frozen.marginValue=r,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(r+=a.getWidth()),o==this.leftColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup){var s=this.getColGroupParentElement(a);i.includes(s)||(this.layoutElement(s,a),i.push(s)),s.classList.toggle("tabulator-frozen-left",a.modules.frozen.edge&&a.modules.frozen.position==="left"),s.classList.toggle("tabulator-frozen-right",a.modules.frozen.edge&&a.modules.frozen.position==="right")}else this.layoutElement(a.getElement(),a);e&&a.cells.forEach(l=>{this.layoutElement(l.getElement(!0),a)})}),this.rightColumns.forEach((a,o)=>{a.modules.frozen.marginValue=n,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(n+=a.getWidth()),o==this.rightColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup?this.layoutElement(this.getColGroupParentElement(a),a):this.layoutElement(a.getElement(),a),e&&a.cells.forEach(s=>{this.layoutElement(s.getElement(!0),a)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));i.forEach(r=>{r.deinitialize()}),e.forEach(r=>{r.type==="row"&&this.layoutRow(r)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)}),this.rightColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)})}layoutElement(e,i){var r;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?r=i.modules.frozen.position==="left"?"right":"left":r=i.modules.frozen.position,e.style[r]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}getFrozenColumns(){return this.leftColumns.concat(this.rightColumns)}_calcSpace(e,i){var r=0;for(let n=0;n<i;n++)e[n].visible&&(r+=e[n].getWidth());return r}}Ve(v7,"moduleName","frozenColumns");class I7 extends ci{constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,r=typeof i;r==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):r==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(r=>{i.push(r)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(r){var n=i.indexOf(r);n>-1&&i.splice(n,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var r=e.getElement();r.parentNode&&r.parentNode.removeChild(r),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,r)=>{this.table.rowManager.styleRow(i,r)})}}Ve(I7,"moduleName","frozenRows");class sve{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,r)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class pf{constructor(e,i,r,n,a,o,s){this.groupManager=e,this.parent=i,this.key=n,this.level=r,this.field=a,this.hasSubGroups=r<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=s,this.rows=[],this.groups=[],this.groupList=[],this.generator=o,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=s?s.visible:typeof e.startOpen[r]<"u"?e.startOpen[r]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var r=i+"_"+e,n=new pf(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[r]:!1);this.groups[r]=n,this.groupList.push(n)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var r=this.groupManager.groupIDLookups[i].func(e.getData()),n=i+"_"+r;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[n]&&this.groups[n].addRow(e):(this.groups[n]||this._createGroup(r,i),this.groups[n].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,r){var n=this.conformRowData({});e.updateData(n);var a=this.rows.indexOf(i);a>-1?r?this.rows.splice(a+1,0,e):this.rows.splice(a,0,e):r?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),r=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(r.parentNode&&r.parentNode.removeChild(r),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var r=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(n=>{r.push(n.getData(i||"data"))}),r}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(r=>{r.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var r=i.getHeadersAndRows();r.forEach(n=>{var a=n.getElement();e.parentNode.insertBefore(a,e.nextSibling),n.initialize(),e=a})}):this.rows.forEach(i=>{var r=i.getElement();e.parentNode.insertBefore(r,e.nextSibling),i.initialize(),e=r}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(r){var n=r.getRowGroup(e);n&&(i=n)}):this.rows.find(function(r){return r===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getRows(e,i){var r=[];return i&&this.groupList.length?this.groupList.forEach(n=>{r=r.concat(n.getRows(e,i))}):this.rows.forEach(function(n){r.push(e?n.getComponent():n)}),r}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(r){e.push(r.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,xr.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new sve(this)),this.component}}class y7 extends ci{constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,r=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(r)&&e.length>r.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(a,o)=>{this.headerGenerator[0]=(s,l,u)=>(typeof s>"u"?"":s)+"<span>("+l+" "+(l===1?a:o.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var n=this.table.columnManager.getRealColumns();n.forEach(a=>{a.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),a.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((a,o)=>{var s,l;typeof a=="function"?s=a:(l=this.table.columnManager.getColumnByField(a),l?s=function(u){return l.getFieldValue(u)}:s=function(u){return u[a]}),this.groupIDLookups.push({field:typeof a=="function"?!1:a,func:s,values:this.allowedValues?this.allowedValues[o]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(a=>{}),this.startOpen=i),r&&(this.headerGenerator=Array.isArray(r)?r:[r])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var r=this.getGroups(!1)[0];i.push(r.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(r=>r.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,r){if(this.table.options.groupBy){this.assignRowToGroup(e);var n=e.modules.group.rows;return n.length>1&&(!i||i&&n.indexOf(i)==-1?r?n[0]!==e&&(i=n[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):n[n.length-1]!==e&&(i=n[n.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,r){if(this.table.options.groupBy){!r&&i instanceof pf&&(i=this.table.rowManager.prevDisplayRow(e)||i);var n=i instanceof pf?i:i.modules.group,a=e instanceof pf?e:e.modules.group;n===a?this.table.rowManager.moveRowInArray(n.rows,e,i,r):(a&&a.removeRow(e),n.insertRow(e,i,r))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(r=>{r.groupList.length?i=i.concat(this.getChildGroups(r)):i.push(r)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(r=>{var n={};n.level=0,n.rowCount=0,n.headerContent="";var a=[];r.hasSubGroups?(a=this.pullGroupListData(r.groupList),n.level=r.level,n.rowCount=a.length-r.groupList.length,n.headerContent=r.generator(r.key,n.rowCount,r.rows,r),i.push(n),i=i.concat(a)):(n.level=r.level,n.headerContent=r.generator(r.key,r.rows.length,r.rows,r),n.rowCount=r.getRows().length,i.push(n),r.getRows().forEach(o=>{i.push(o.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(r=>{var n=r.getRowGroup(e);n&&(i=n)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(r=>{this.createGroup(r,0,i)}),e.forEach(r=>{this.assignRowToExistingGroup(r,i)})):e.forEach(r=>{this.assignRowToGroup(r,i)}),Object.values(i).forEach(r=>{r.wipe(!0)})}createGroup(e,i,r){var n=i+"_"+e,a;r=r||[],a=new pf(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],r[n]),this.groups[n]=a,this.groupList.push(a)}assignRowToExistingGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n="0_"+r;this.groups[n]&&this.groups[n].addRow(e)}assignRowToGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n=!this.groups["0_"+r];return n&&this.createGroup(r,0,i),this.groups["0_"+r].addRow(e),!n}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,r=i.getPath(),n=this.getExpectedPath(e),a;a=r.length==n.length&&r.every((o,s)=>o===n[s]),a||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],r=e.getData();return this.groupIDLookups.forEach(n=>{i.push(n.func(r))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(r=>{i=i.concat(r.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((r,n)=>{this.table.rowManager.styleRow(r,n),e.appendChild(r.getElement()),r.initialize(!0),r.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}Ve(y7,"moduleName","groupRows");var lve={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},uve={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},cve={undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"]},dve={undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))}},pve={keybindings:{bindings:cve,actions:dve}};const bd=class bd extends ci{constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,r){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:r})}rowAdded(e,i,r,n){this.action("rowAdd",e,{data:i,pos:r,index:n})}rowDeleted(e){var i,r;this.table.options.groupBy?(r=e.getComponent().getGroup()._getSelf().rows,i=r.indexOf(e),i&&(i=r[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,r){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:r}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(r){return r.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return bd.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return bd.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(r){if(r.component instanceof no)r.component===e&&(r.component=i);else if(r.component instanceof Gb&&r.component.row===e){var n=r.component.column.getField();n&&(r.component=i.getCell(n))}})}};Ve(bd,"moduleName","history"),Ve(bd,"moduleExtensions",pve),Ve(bd,"undoers",lve),Ve(bd,"redoers",uve);let D1=bd;class b7 extends ci{constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,r=e.getElementsByTagName("th"),n=e.getElementsByTagName("tbody")[0],a=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),n=n?n.getElementsByTagName("tr"):[],this._extractOptions(e,i),r.length?this._extractHeaders(r,n):this._generateBlankHeaders(r,n);for(var o=0;o<n.length;o++){var s=n[o],l=s.getElementsByTagName("td"),u={};this.hasIndex||(u[i.index]=o);for(var c=0;c<l.length;c++){var d=l[c];typeof this.fieldIndex[c]<"u"&&(u[this.fieldIndex[c]]=d.innerHTML)}a.push(u)}i.data=a,this.dispatchExternal("htmlImported")}_extractOptions(e,i,r){var n=e.attributes,a=Object.keys(r||i),o={};a.forEach(c=>{o[c.toLowerCase()]=c});for(var s in n){var l=n[s],u;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(u=l.name.replace("tabulator-",""),typeof o[u]<"u"&&(i[o[u]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(r=>r.title===e);return i||!1}_extractHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a=!1,o=this._findCol(n.textContent),s;o?a=!0:o={title:n.textContent.trim()},o.field||(o.field=n.textContent.trim().toLowerCase().replaceAll(" ","_")),s=n.getAttribute("width"),s&&!o.width&&(o.width=s),this._extractOptions(n,o,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[r]=o.field,o.field==this.table.options.index&&(this.hasIndex=!0),a||this.table.options.columns.push(o)}}_generateBlankHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a={title:"",field:"col"+r};this.fieldIndex[r]=a.field;var o=n.getAttribute("width");o&&(a.width=o),this.table.options.columns.push(a)}}}Ve(b7,"moduleName","htmlTableImport");function mve(t){var e=[],i=0,r=0,n=!1;for(let a=0;a<t.length;a++){let o=t[a],s=t[a+1];if(e[i]||(e[i]=[]),e[i][r]||(e[i][r]=""),o=='"'&&n&&s=='"'){e[i][r]+=o,a++;continue}if(o=='"'){n=!n;continue}if(o==","&&!n){r++;continue}if(o=="\r"&&s==`
`&&!n){r=0,i++,a++;continue}if((o=="\r"||o==`
`)&&!n){r=0,i++;continue}e[i][r]+=o}return e}function hve(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function fve(t){return t}function gve(t,e){var i=XLSX.read(t),r=i.Sheets[i.SheetNames[0]];return XLSX.utils.sheet_to_json(r,{})}var vve={csv:mve,json:hve,array:fve,xlsx:gve};const vI=class vI extends ci{constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,r,n,a){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(o=>(console.error("Import Error:",o||"Unable to import data"),Promise.reject(o)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=vI.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i,r){var n=this.lookupImporter(e);if(n)return this.pickFile(i,r).then(this.importData.bind(this,n)).then(this.structureData.bind(this)).then(this.setData.bind(this)).catch(a=>(this.dispatch("import-error",a),this.dispatchExternal("importError",a),console.error("Import Error:",a||"Unable to import file"),Promise.reject(a)))}pickFile(e,i){return new Promise((r,n)=>{var a=document.createElement("input");a.type="file",a.accept=e,a.addEventListener("change",o=>{var s=a.files[0],l=new FileReader;switch(this.dispatch("import-importing",a.files),this.dispatchExternal("importImporting",a.files),i||this.table.options.importReader){case"buffer":l.readAsArrayBuffer(s);break;case"binary":l.readAsBinaryString(s);break;case"url":l.readAsDataURL(s);break;case"text":default:l.readAsText(s)}l.onload=u=>{r(l.result)},l.onerror=u=>{console.warn("File Load Error - Unable to read file"),n()}}),this.dispatch("import-choose"),this.dispatchExternal("importChoose"),a.click()})}importData(e,i){var r=e.call(this.table,i);return r instanceof Promise?r:r?Promise.resolve(r):Promise.reject()}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}structureArrayToObject(e){var i=e.shift(),r=e.map(n=>{var a={};return i.forEach((o,s)=>{a[o]=n[s]}),a});return r}structureArrayToColumns(e){var i=[],r=this.table.getColumns();return r[0]&&e[0][0]&&r[0].getDefinition().title===e[0][0]&&e.shift(),e.forEach(n=>{var a={};n.forEach((o,s)=>{var l=r[s];l&&(a[l.getField()]=o)}),i.push(a)}),i}setData(e){return this.dispatch("import-imported",e),this.dispatchExternal("importImported",e),this.table.setData(e)}};Ve(vI,"moduleName","import"),Ve(vI,"importers",vve);let P1=vI;class w7 extends ci{constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let r in i)i[r]=null})}cellContentsSelectionFixer(e,i){var r;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(r=document.body.createTextRange(),r.moveToElementText(i.getElement()),r.select()):window.getSelection&&(r=document.createRange(),r.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(r))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,r=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let n in this.eventMap)this.eventMap[n]===r&&this.subscribers[n]&&(i=!1);i&&(this.unsubscribe(r+"-touchstart",this.touchSubscribers[r+"-touchstart"]),this.unsubscribe(r+"-touchend",this.touchSubscribers[r+"-touchend"]),delete this.touchSubscribers[r+"-touchstart"],delete this.touchSubscribers[r+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let r in this.eventMap)i[r]&&(this.subscriptionChanged(r,!0),this.columnSubscribers[r]||(this.columnSubscribers[r]=[]),this.columnSubscribers[r].push(e))}handle(e,i,r){this.dispatchEvent(e,i,r)}handleTouch(e,i,r,n){var a=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":a.tap=!0,clearTimeout(a.tapHold),a.tapHold=setTimeout(()=>{clearTimeout(a.tapHold),a.tapHold=null,a.tap=null,clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"TapHold",r,n)},1e3);break;case"end":a.tap&&(a.tap=null,this.dispatchEvent(e+"Tap",r,n)),a.tapDbl?(clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"DblTap",r,n)):a.tapDbl=setTimeout(()=>{clearTimeout(a.tapDbl),a.tapDbl=null},300),clearTimeout(a.tapHold),a.tapHold=null;break}}dispatchEvent(e,i,r){var n=r.getComponent(),a;this.columnSubscribers[e]&&(r instanceof Gb?a=r.column.definition[e]:r instanceof sm&&(a=r.definition[e]),a&&a(i,n)),this.dispatchExternal(e,i,n)}}Ve(w7,"moduleName","interaction");var Ive={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35},yve={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,r=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=r?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)}};const wd=class wd extends ci{constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,wd.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)wd.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(r=>{var n=Array.isArray(r)?r:[r];n.forEach(a=>{this.mapBinding(i,a)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var r={action:wd.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},n=i.toString().toLowerCase().split(" ").join("").split("+");n.forEach(a=>{switch(a){case"ctrl":r.ctrl=!0;break;case"shift":r.shift=!0;break;case"meta":r.meta=!0;break;default:a=isNaN(a)?a.toUpperCase().charCodeAt(0):parseInt(a),r.keys.push(a),this.watchKeys[a]||(this.watchKeys[a]=[]),this.watchKeys[a].push(r)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];n&&(e.pressedKeys.push(r),n.forEach(function(a){e.checkBinding(i,a)}))},this.keydownBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];if(n){var a=e.pressedKeys.indexOf(r);a>-1&&e.pressedKeys.splice(a,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var r=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(n=>{var a=this.pressedKeys.indexOf(n);a==-1&&(r=!1)}),r&&i.action.call(this,e),!0):!1}};Ve(wd,"moduleName","keybindings"),Ve(wd,"bindings",Ive),Ve(wd,"actions",yve);let R1=wd;class U7 extends ci{constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadMenuEvent(r.column.definition[e],i,r)}loadMenuTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadMenuEvent(r.definition[e],i,r)}loadMenuEvent(e,i,r){r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent()):e,this.loadMenu(i,r,e)}loadMenu(e,i,r,n,a){var o=!(e instanceof MouseEvent),s=document.createElement("div"),l;if(s.classList.add("tabulator-menu"),o||e.preventDefault(),!(!r||!r.length)){if(n)l=a.child(s);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(s)}r.forEach(u=>{var c=document.createElement("div"),d=u.label,p=u.disabled;u.separator?c.classList.add("tabulator-menu-separator"):(c.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?c.appendChild(d):c.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(c.classList.add("tabulator-menu-item-disabled"),c.addEventListener("click",m=>{m.stopPropagation()})):u.menu&&u.menu.length?c.addEventListener("click",m=>{m.stopPropagation(),this.loadMenu(m,i,u.menu,c,l)}):u.action&&c.addEventListener("click",m=>{u.action(m,i.getComponent())}),u.menu&&u.menu.length&&c.classList.add("tabulator-menu-item-submenu")),s.appendChild(c)}),s.addEventListener("click",u=>{this.rootPopup&&this.rootPopup.hide()}),l.show(n||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",r,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",r,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}Ve(U7,"moduleName","menu");class S7 extends ci{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,r={},n;!e.modules.frozen&&!e.isGroup&&!e.isRowHeader&&(n=e.getElement(),r.mousemove=(function(a){e.parent===i.moving.parent&&((i.touchMove?a.touches[0].pageX:a.pageX)-xr.elOffset(n).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n),i.moveColumn(e,!1)))}).bind(i),n.addEventListener("mousedown",function(a){i.touchMove=!1,a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=r}bindTouchEvents(e){var i=e.getElement(),r=!1,n,a,o,s,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextColumn(),o=n?n.getWidth()/2:0,a=e.prevColumn(),s=a?a.getWidth()/2:0,l=0,u=0,r=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",c=>{var d,p;this.moving&&(this.moveHover(c),r||(r=c.touches[0].pageX),d=c.touches[0].pageX-r,d>0?n&&d-l>o&&(p=n,p!==e&&(r=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):a&&-d-u>s&&(p=a,p!==e&&(r=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(n=p.nextColumn(),l=o,o=n?n.getWidth()/2:0,a=p.prevColumn(),u=s,s=a?a.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(c)})}startMove(e,i){var r=i.getElement(),n=this.table.columnManager.getContentsElement(),a=this.table.columnManager.getHeadersElement();this.table.modules.selectRange&&this.table.modules.selectRange.columnSelection&&this.table.modules.selectRange.mousedown&&this.table.modules.selectRange.selecting==="column"||(this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-xr.elOffset(r).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),n.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=n.clientHeight-a.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e),this.dispatch("column-moving",e,this.moving))}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var r=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(n,a){var o=n.getElement(!0);o.parentNode&&r[a]&&o.parentNode.insertBefore(r[a].getElement(),o.nextSibling)}):e.getCells().forEach(function(n,a){var o=n.getElement(!0);o.parentNode&&r[a]&&o.parentNode.insertBefore(r[a].getElement(),o)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),r=i.scrollLeft,n=(this.touchMove?e.touches[0].pageX:e.pageX)-xr.elOffset(i).left+r,a;this.hoverElement.style.left=n-this.startX+"px",n-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.max(0,r-5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1))),r+i.clientWidth-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.min(i.clientWidth,r+5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1)))}}Ve(S7,"moduleName","moveColumn");var bve={delete:function(t,e,i){t.delete()}},wve={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};const Wp=class Wp extends ci{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,r={};r.mouseup=(function(n){i.tableRowDrop(n,e)}).bind(i),r.mousemove=(function(n){var a;n.pageY-xr.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a=e.getElement(),a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a=e.getElement(),a.previousSibling&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=r}initializeRow(e){var i=this,r={},n;r.mouseup=(function(a){i.tableRowDrop(a,e)}).bind(i),r.mousemove=(function(a){var o=e.getElement();a.pageY-xr.elOffset(o).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(o.parentNode.insertBefore(i.placeholderElement,o.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(o.parentNode.insertBefore(i.placeholderElement,o),i.moveRow(e,!1))}).bind(i),this.hasHandle||(n=e.getElement(),n.addEventListener("mousedown",function(a){a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=r}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,r=e.getElement(!0);r.addEventListener("mousedown",function(n){n.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(n,e.row)},i.checkPeriod))}),r.addEventListener("mouseup",function(n){n.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,r)}}bindTouchEvents(e,i){var r=!1,n,a,o,s,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextRow(),o=n?n.getHeight()/2:0,a=e.prevRow(),s=a?a.getHeight()/2:0,l=0,u=0,r=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",c=>{var d,p;this.moving&&(c.preventDefault(),this.moveHover(c),r||(r=c.touches[0].pageY),d=c.touches[0].pageY-r,d>0?n&&d-l>o&&(p=n,p!==e&&(r=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):a&&-d-u>s&&(p=a,p!==e&&(r=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(n=p.nextRow(),l=o,o=n?n.getHeight()/2:0,a=p.prevRow(),u=s,s=a?a.getHeight()/2:0))}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(c),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var r=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r)),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var r=this.touchMove?e.touches[0].pageX:e.pageX,n=this.touchMove?e.touches[0].pageY:e.pageY,a,o;a=i.getElement(),this.connection?(o=a.getBoundingClientRect(),this.startX=o.left-r+window.pageXOffset,this.startY=o.top-n+window.pageYOffset):this.startY=n-a.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),r=i.scrollTop,n=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+r;this.hoverElement.style.top=Math.min(n-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,r){this.dispatchExternal("movableRowsElementDrop",e,i,r?r.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(r=>{typeof r=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(r))):this.connectionElements.push(r)}),this.connectionElements.forEach(r=>{var n=a=>{this.elementRowDrop(a,r,this.moving)};r.addEventListener("mouseup",n),r.tabulatorElementDropEvent=n,r.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(r=>{r.type==="row"&&r.modules.moveRow&&r.modules.moveRow.mouseup&&r.getElement().addEventListener("mouseup",r.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,r){var n=!1;if(r){switch(typeof this.table.options.movableRowsSender){case"string":n=Wp.senders[this.table.options.movableRowsSender];break;case"function":n=this.table.options.movableRowsSender;break}n?n.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var r=!1,n=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":r=Wp.receivers[this.table.options.movableRowsReceiver];break;case"function":r=this.table.options.movableRowsReceiver;break}r?n=r.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),n?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:n})}commsReceived(e,i,r){switch(i){case"connect":return this.connect(e,r.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,r.row,r.success)}}};Ve(Wp,"moduleName","moveRow"),Ve(Wp,"senders",bve),Ve(Wp,"receivers",wve);let E1=Wp;var Uve={};const If=class If extends ci{constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,r){return this.transformRow(i,"data",r)}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="mutator"+(n.charAt(0).toUpperCase()+n.slice(1)),o;e.definition[a]&&(o=this.lookupMutator(e.definition[a]),o&&(i=!0,r[a]={mutator:o,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.mutate=r)}lookupMutator(e){var i=!1;switch(typeof e){case"string":If.mutators[e]?i=If.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,r){var n="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),a;return this.enabled&&this.table.columnManager.traverse(o=>{var s,l,u;o.modules.mutate&&(s=o.modules.mutate[n]||o.modules.mutate.mutator||!1,s&&(a=o.getFieldValue(typeof r<"u"?r:e),(i=="data"&&!r||typeof a<"u")&&(u=o.getComponent(),l=typeof s.params=="function"?s.params(a,e,i,u):s.params,o.setFieldValue(e,s.mutator(a,e,i,l,u)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var r=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,n={};if(r)return n=Object.assign(n,e.row.getData()),e.column.setFieldValue(n,i),r.mutator(i,n,"edit",r.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(r=>{var n=e.row.getCell(r);n&&n.setValue(n.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}};Ve(If,"moduleName","mutator"),Ve(If,"mutators",Uve);let C1=If;function Sve(t,e,i,r,n){var a=document.createElement("span"),o=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{o.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{c.innerHTML=d}),r?(s.innerHTML=" "+e+"-"+Math.min(e+t-1,r)+" ",u.innerHTML=" "+r+" ",a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(u),a.appendChild(c)):(s.innerHTML=" 0 ",a.appendChild(o),a.appendChild(s),a.appendChild(c)),a}function Tve(t,e,i,r,n){var a=document.createElement("span"),o=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{o.innerHTML=d}),s.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),u.innerHTML=" "+n+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{c.innerHTML=d}),a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(u),a.appendChild(c),a}var Dve={rows:Sve,pages:Tve};const II=class II extends ci{constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var r=this.table.rowManager,n=r.getDisplayRows(),a;return i?n.length?a=n[0]:r.activeRows.length&&(a=r.activeRows[r.activeRows.length-1],i=!1):n.length&&(a=n[n.length-1],i=!(n.length<this.size)),{index:a,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,r,n){return this.initialLoad||(this.progressiveLoad&&!r||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),n.page=this.page,this.size&&(n.size=this.size),n}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var r,n,a;!i&&!this.table.dataLoader.loading&&(r=this.table.rowManager.getElement(),n=r.scrollHeight-r.clientHeight-e,a=this.table.options.progressiveLoadScrollMargin||r.clientHeight*2,n<a&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var r=document.createElement("option");r.value=i,i===!0?this.langBind("pagination|all",function(n){r.innerHTML=n}):r.innerHTML=i,this.pageSizeSelect.appendChild(r)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=II.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,r;e||(this.langBind("pagination|first",n=>{this.firstBut.innerHTML=n}),this.langBind("pagination|first_title",n=>{this.firstBut.setAttribute("aria-label",n),this.firstBut.setAttribute("title",n)}),this.langBind("pagination|prev",n=>{this.prevBut.innerHTML=n}),this.langBind("pagination|prev_title",n=>{this.prevBut.setAttribute("aria-label",n),this.prevBut.setAttribute("title",n)}),this.langBind("pagination|next",n=>{this.nextBut.innerHTML=n}),this.langBind("pagination|next_title",n=>{this.nextBut.setAttribute("aria-label",n),this.nextBut.setAttribute("title",n)}),this.langBind("pagination|last",n=>{this.lastBut.innerHTML=n}),this.langBind("pagination|last_title",n=>{this.lastBut.setAttribute("aria-label",n),this.lastBut.setAttribute("title",n)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",n=>{this.pageSizeSelect.setAttribute("aria-label",n),this.pageSizeSelect.setAttribute("title",n),i.innerHTML=n}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",n=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(r=document.querySelector(this.table.options.paginationCounterElement),r?r.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),r=i.indexOf(e);if(r>-1){var n=this.size===!0?1:Math.ceil((r+1)/this.size);return this.setPage(n)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,r){var n;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,r=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),n=this.pageCounter.call(this,i,r,this.page,e,this.max),typeof n){case"object":if(n instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(n)}else this.pageCounterElement.innerHTML="",n!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",n);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=n}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),r=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),n=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let a=r;a<=n;a++)a>0&&a<=this.max&&this.pagesElement.appendChild(this._generatePageButton(a));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",r=>{i.setAttribute("aria-label",r+" "+e),i.setAttribute("title",r+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",r=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,r,n,a,o,s=e.filter(l=>l.type==="row");if(this.mode=="local"){r=[],this.setMaxRows(e.length),this.size===!0?(n=0,a=e.length):(n=this.size*(this.page-1),a=n+parseInt(this.size)),this._setPageButtons();for(let l=n;l<a;l++){let u=e[l];u&&(r.push(u),u.type==="row"&&(o||(o=u),i++))}return this._setPageCounter(s.length,i,o?s.indexOf(o)+1:0),r}else return this._setPageButtons(),this._setPageCounter(s.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else this.dispatchExternal("pageLoaded",this.getPage());else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}};Ve(II,"moduleName","page"),Ve(II,"pageCounters",Dve);let M1=II;var Pve={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,r=t+"-"+e,n=i.indexOf(r+"="),a,o;return n>-1&&(i=i.slice(n),a=i.indexOf(";"),a>-1&&(i=i.slice(0,a)),o=i.replace(r+"=","")),o?JSON.parse(o):!1}},Rve={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var r=new Date;r.setDate(r.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+r.toUTCString()}};const No=class No extends ci{constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,r;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:No.readers[this.table.options.persistenceReaderFunc]?this.readFunc=No.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):No.readers[this.mode]?this.readFunc=No.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:No.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=No.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):No.writers[this.mode]?this.writeFunc=No.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(r=this.retrieveData("page"),r&&(typeof r.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=r.paginationSize),typeof r.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=r.paginationInitialPage))),this.config.group&&(r=this.retrieveData("group"),r&&(typeof r.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=r.groupBy),typeof r.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=r.groupStartOpen),typeof r.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=r.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,r;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(r=this.load("headerFilter"),r&&(this.table.options.initialHeaderFilter=r))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,r;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),r=this.config.columns===!0?Object.keys(i):this.config.columns,r.forEach(n=>{var a=Object.getOwnPropertyDescriptor(i,n),o=i[n];a&&Object.defineProperty(i,n,{set:s=>{o=s,this.defWatcherBlock||this.save("columns"),a.set&&a.set(s)},get:()=>(a.get&&a.get(),o)})}),this.defWatcherBlock=!1)}load(e,i){var r=this.retrieveData(e);return i&&(r=r?this.mergeDefinition(i,r):i),r}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,r){var n=[];return i=i||[],i.forEach((a,o)=>{var s=this._findColumn(e,a),l;s&&(r?l=Object.keys(a):this.config.columns===!0||this.config.columns==null?(l=Object.keys(s),l.push("width")):l=this.config.columns,l.forEach(u=>{u!=="columns"&&typeof a[u]<"u"&&(s[u]=a[u])}),s.columns&&(s.columns=this.mergeDefinition(s.columns,a.columns)),n.push(s))}),e.forEach((a,o)=>{var s=this._findColumn(i,a);s||(n.length>o?n.splice(o,0,a):n.push(a))}),n}_findColumn(e,i){var r=i.columns?"group":i.field?"field":"object";return e.find(function(n){switch(r){case"group":return n.title===i.title&&n.columns.length===i.columns.length;case"field":return n.field===i.field;case"object":return n===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],r=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(n=>{var a={},o=n.getDefinition(),s;n.isGroup?(a.title=o.title,a.columns=this.parseColumns(n.getColumns())):(a.field=n.getField(),this.config.columns===!0||this.config.columns==null?(s=Object.keys(o),s.push("width"),s.push("visible")):s=this.config.columns,s.forEach(l=>{switch(l){case"width":a.width=n.getWidth();break;case"visible":a.visible=n.visible;break;default:typeof o[l]!="function"&&r.indexOf(l)===-1&&(a[l]=o[l])}})),i.push(a)}),i}};Ve(No,"moduleName","persistence"),Ve(No,"moduleInitOrder",-10),Ve(No,"readers",Pve),Ve(No,"writers",Rve);let N1=No;class T7 extends ci{constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,r){this.loadPopupEvent(i,null,e,r)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadPopupEvent(r.column.definition[e],i,r)}loadPopupTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadPopupEvent(r.definition[e],i,r)}loadPopupEvent(e,i,r,n){var a;function o(s){a=s}r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent(),o):e,this.loadPopup(i,r,e,a,n)}loadPopup(e,i,r,n,a){var o=!(e instanceof MouseEvent),s,l;r instanceof HTMLElement?s=r:(s=document.createElement("div"),s.innerHTML=r),s.classList.add("tabulator-popup"),s.addEventListener("click",u=>{u.stopPropagation()}),o||e.preventDefault(),l=this.popup(s),typeof n=="function"&&l.renderCallback(n),e?l.show(e):l.show(i.getElement(),a||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}}Ve(T7,"moduleName","popup");class D7 extends ci{constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,r){var n=window.scrollX,a=window.scrollY,o=document.createElement("div"),s=document.createElement("div"),l=this.table.modules.export.generateTable(typeof r<"u"?r:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),u,c;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(o.classList.add("tabulator-print-header"),u=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof u=="string"?o.innerHTML=u:o.appendChild(u),this.element.appendChild(o)),this.element.appendChild(l),this.table.options.printFooter&&(s.classList.add("tabulator-print-footer"),c=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof c=="string"?s.innerHTML=c:s.appendChild(c),this.element.appendChild(s)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(n,a),this.manualBlock=!1}}Ve(D7,"moduleName","print");class P7 extends ci{constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,r;this.currentVersion++,r=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-push"),n.forEach(o=>{i.table.rowManager.addRowActual(o,!1)}),a=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),a}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-unshift"),n.forEach(o=>{i.table.rowManager.addRowActual(o,!0)}),a=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),a}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-shift"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[0]),n&&n.deleteActual()),a=i.origFuncs.shift.call(e),i.unblock("data-shift")),a}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-pop"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),n&&n.deleteActual()),a=i.origFuncs.pop.call(e),i.unblock("data-pop")),a}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a=n[0]<0?e.length+n[0]:n[0],o=n[1],s=n[2]?n.slice(2):!1,l,u;if(!i.blocked&&r===i.currentVersion){if(i.block("data-splice"),s&&(l=e[a]?i.table.rowManager.getRowFromDataObject(e[a]):!1,l?s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(s=s.slice().reverse(),s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),o!==0){var c=e.slice(a,typeof n[1]>"u"?n[1]:a+o);c.forEach((d,p)=>{var m=i.table.rowManager.getRowFromDataObject(d);m&&m.deleteActual(p!==c.length-1)})}(s||o!==0)&&i.table.rowManager.reRenderInPosition(),u=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return u}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var r in i)this.watchKey(e,i,r);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,r=e.getData()[this.table.options.dataTreeChildField],n={};r&&(n.push=r.push,Object.defineProperty(r,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var a=n.push.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-push")}return a}}),n.unshift=r.unshift,Object.defineProperty(r,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var a=n.unshift.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return a}}),n.shift=r.shift,Object.defineProperty(r,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var a=n.shift.call(r);this.rebuildTree(e),i.unblock("tree-shift")}return a}}),n.pop=r.pop,Object.defineProperty(r,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var a=n.pop.call(r);this.rebuildTree(e),i.unblock("tree-pop")}return a}}),n.splice=r.splice,Object.defineProperty(r,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var a=n.splice.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return a}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,r){var n=this,a=Object.getOwnPropertyDescriptor(i,r),o=i[r],s=this.currentVersion;Object.defineProperty(i,r,{set:l=>{if(o=l,!n.blocked&&s===n.currentVersion){n.block("key");var u={};u[r]=l,e.updateData(u),n.unblock("key")}a.set&&a.set(l)},get:()=>(a.get&&a.get(),o)})}unwatchRow(e){var i=e.getData();for(var r in i)Object.defineProperty(i,r,{value:i[r]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}Ve(P7,"moduleName","reactiveData");class R7 extends ci{constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1),this.registerTableOption("resizableColumnGuide",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(r=>{r.modules.resize&&r.modules.resize.handleEl&&(i&&(r.modules.resize.handleEl.style[e.modules.frozen.position]=i,r.modules.resize.handleEl.style["z-index"]=11),r.element.after(r.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,r,n){var a=this,o=!1,s=r.definition.resizable,l={},u=r.getLastColumn();if(e==="header"&&(o=r.definition.formatter=="textarea"||r.definition.variableHeight,l={variableHeight:o}),(s===!0||s==e)&&this._checkResizability(u)){var c=document.createElement("span");c.className="tabulator-col-resize-handle",c.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){a.startColumn=r,a.initialNextColumn=a.nextColumn=u.nextColumn(),a._mouseDown(p,u,c)};c.addEventListener("mousedown",d),c.addEventListener("touchstart",d,{passive:!0}),c.addEventListener("dblclick",p=>{var m=u.getWidth();p.stopPropagation(),u.reinitializeWidth(!0),m!==u.getWidth()&&(a.dispatch("column-resized",u),a.dispatchExternal("columnResized",u.getComponent()))}),r.modules.frozen&&(c.style.position="sticky",c.style[r.modules.frozen.position]=this.frozenColumnOffset(r)),l.handleEl=c,n.parentNode&&r.visible&&n.after(c)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}resize(e,i){var r=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n=r-this.startX,a=r-this.latestX,o,s;if(this.latestX=r,this.table.rtl&&(n=-n,a=-a),o=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(this.startWidth+n),s=i.width==i.minWidth||i.width==i.maxWidth,a<0&&(this.nextColumn=this.initialNextColumn),this.table.options.resizableColumnFit&&this.nextColumn&&!(o&&s)){let l=this.nextColumn.getWidth();a>0&&l<=this.nextColumn.minWidth&&(this.nextColumn=this.nextColumn.nextColumn()),this.nextColumn&&this.nextColumn.setWidth(this.nextColumn.getWidth()-a)}this.table.columnManager.rerenderColumns(!0),!this.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}calcGuidePosition(e,i,r){var n=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,a=r.getBoundingClientRect().x-this.table.element.getBoundingClientRect().x,o=this.table.element.getBoundingClientRect().x,s=i.element.getBoundingClientRect().left-o,l=n-this.startX,u=Math.max(a+l,s+i.minWidth);return i.maxWidth&&(u=Math.min(u,s+i.maxWidth)),u}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,r){var n=this,a;this.dispatchExternal("columnResizing",i.getComponent()),n.table.options.resizableColumnGuide&&(a=document.createElement("span"),a.classList.add("tabulator-col-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.left=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function o(l){n.table.options.resizableColumnGuide?a.style.left=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function s(l){n.table.options.resizableColumnGuide&&(n.resize(l,i),a.remove()),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!1),n.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",s),document.body.removeEventListener("mousemove",o),r.removeEventListener("touchmove",o),r.removeEventListener("touchend",s),n.table.element.classList.remove("tabulator-block-select"),n.startWidth!==i.getWidth()&&(n.table.columnManager.verticalAlignHeaders(),n.dispatch("column-resized",i),n.dispatchExternal("columnResized",i.getComponent()))}e.stopPropagation(),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!0),n.startX=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n.latestX=n.startX,n.startWidth=i.getWidth(),document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",s),r.addEventListener("touchmove",o,{passive:!0}),r.addEventListener("touchend",s)}}Ve(R7,"moduleName","resizeColumns");class E7 extends ci{constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1),this.registerTableOption("resizableRowGuide",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,r=e.getElement(),n=document.createElement("div");n.className="tabulator-row-resize-handle";var a=document.createElement("div");a.className="tabulator-row-resize-handle prev",n.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){i.startRow=e,i._mouseDown(l,e,n)};n.addEventListener("mousedown",o),n.addEventListener("touchstart",o,{passive:!0}),a.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){var u=i.table.rowManager.prevDisplayRow(e);u&&(i.startRow=u,i._mouseDown(l,u,a))};a.addEventListener("mousedown",s),a.addEventListener("touchstart",s,{passive:!0}),r.appendChild(n),r.appendChild(a)}resize(e,i){i.setHeight(this.startHeight+((typeof e.screenY>"u"?e.touches[0].screenY:e.screenY)-this.startY))}calcGuidePosition(e,i,r){var n=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,a=r.getBoundingClientRect().y-this.table.element.getBoundingClientRect().y,o=this.table.element.getBoundingClientRect().y,s=i.element.getBoundingClientRect().top-o,l=n-this.startY;return Math.max(a+l,s)}_mouseDown(e,i,r){var n=this,a;n.dispatchExternal("rowResizing",i.getComponent()),n.table.options.resizableRowGuide&&(a=document.createElement("span"),a.classList.add("tabulator-row-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.top=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function o(l){n.table.options.resizableRowGuide?a.style.top=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function s(l){n.table.options.resizableRowGuide&&(n.resize(l,i),a.remove()),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",o),r.removeEventListener("touchmove",o),r.removeEventListener("touchend",s),n.table.element.classList.remove("tabulator-block-select"),n.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),n.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,n.startHeight=i.getHeight(),document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",s),r.addEventListener("touchmove",o,{passive:!0}),r.addEventListener("touchend",s)}}Ve(E7,"moduleName","resizeRows");class C7 extends ci{constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.tableHeight!=n||this.tableWidth!=a)&&(this.tableHeight=n,this.tableWidth=a,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.containerHeight!=n||this.containerWidth!=a)&&(this.containerHeight=n,this.containerWidth=a,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}Ve(C7,"moduleName","resizeTable");function Eve(t,e,i){var r=document.createElement("div"),n=t.getRow()._row.modules.responsiveLayout;r.classList.add("tabulator-responsive-collapse-toggle"),r.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function a(o){var s=n.element;n.open=o,s&&(n.open?(r.classList.add("open"),s.style.display=""):(r.classList.remove("open"),s.style.display="none"))}return r.addEventListener("click",function(o){o.stopImmediatePropagation(),a(!n.open),t.getTable().rowManager.adjustTableSize()}),a(n.open),r}var Cve={format:{formatters:{responsiveCollapse:Eve}}};class A1 extends ci{constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.collapseFormatter&&(this.collapseFormatter=this.collapseFormatter.bind(this.table)),this.table.columnManager.columnsByIndex.forEach((i,r)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=r,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,r)=>{var n=r.modules.responsive.order-i.modules.responsive.order;return n||r.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),r=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(r<0){let n=this.columns[this.index];n?(this.hideColumn(n),this.index++):e=!1}else{let n=this.columns[this.index-1];n&&r>0&&r>=n.getWidth()?(this.showColumn(n),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,r;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);r=this.collapseFormatter(this.generateCollapsedRowData(e)),r&&i.appendChild(r),e.calcHeight(!0)}}generateCollapsedRowData(e){var i=e.getData(),r=[],n;return this.hiddenColumns.forEach(a=>{var o=a.getFieldValue(i);if(a.definition.title&&a.field)if(a.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let s=function(l){l()};n={value:!1,data:{},getValue:function(){return o},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return a.getComponent()},getTable:()=>this.table},r.push({field:a.field,title:a.definition.title,value:a.modules.format.formatter.call(this.table.modules.format,n,a.modules.format.params,s)})}else r.push({field:a.field,title:a.definition.title,value:o})}),r}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(r=>{var n=document.createElement("tr"),a=document.createElement("td"),o=document.createElement("td"),s,l=document.createElement("strong");a.appendChild(l),this.modules.localize.bind("columns|"+r.field,function(u){l.innerHTML=u||r.title}),r.value instanceof Node?(s=document.createElement("div"),s.appendChild(r.value),o.appendChild(s)):o.innerHTML=r.value,n.appendChild(a),n.appendChild(o),i.appendChild(n)}),Object.keys(e).length?i:""}}Ve(A1,"moduleName","responsiveLayout"),Ve(A1,"moduleExtensions",Cve);function Mve(t,e,i){var r=document.createElement("input"),n=!1;if(r.type="checkbox",r.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(r.addEventListener("click",o=>{o.stopPropagation()}),typeof t.getRow=="function"){var a=t.getRow();a instanceof WD?(r.addEventListener("change",o=>{this.table.options.selectableRowsRangeMode==="click"&&n?n=!1:a.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&r.addEventListener("click",o=>{n=!0,this.table.modules.selectRow.handleComplexRowClick(a._row,o)}),r.checked=a.isSelected&&a.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(a,r)):r=""}else r.addEventListener("change",o=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(r);return r}var Nve={format:{formatters:{rowSelection:Mve}}};class O1 extends ci{constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,r){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,r=i.checkRowSelectability(e),n=e.getElement(),a=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",a)};e.modules.select={selected:!1},n.classList.toggle("tabulator-selectable",r),n.classList.toggle("tabulator-unselectable",!r),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?n.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(n.addEventListener("click",function(o){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),n.addEventListener("mousedown",function(o){if(o.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",a),document.body.addEventListener("keyup",a),i.toggleRow(e),!1}),n.addEventListener("mouseenter",function(o){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),n.addEventListener("mouseout",function(o){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var r=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),n=this.table.rowManager.getDisplayRowIndex(e),a=r<=n?r:n,o=r>=n?r:n,s=this.table.rowManager.getDisplayRows().slice(0),l=s.splice(a,o-a+1);i.ctrlKey||i.metaKey?(l.forEach(u=>{u!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(u):this.toggleRow(u))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],r,n;switch(typeof e){case"undefined":r=this.table.rowManager.rows;break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(a=>{n=this._selectRow(a,!0,!0),n&&i.push(n)}),this._rowSelectionChanged(!1,i)):r&&this._selectRow(r,!1,!0)}_selectRow(e,i,r){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!r&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var n=this.table.rowManager.findRow(e);if(n){if(this.selectedRows.indexOf(n)==-1)return n.getElement().classList.add("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!0,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!0),this.selectedRows.push(n),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!0),this.dispatchExternal("rowSelected",n.getComponent()),this._rowSelectionChanged(i,n),n}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var r=[],n,a;switch(typeof e){case"undefined":n=Object.assign([],this.selectedRows);break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(o=>{a=this._deselectRow(o,!0,!0),a&&r.push(a)}),this._rowSelectionChanged(i,[],r)):n&&this._deselectRow(n,i,!0)}_deselectRow(e,i){var r=this,n=r.table.rowManager.findRow(e),a,o;if(n){if(a=r.selectedRows.findIndex(function(s){return s==n}),a>-1)return o=n.getElement(),o&&o.classList.remove("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!1,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!1),r.selectedRows.splice(a,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!1),this.dispatchExternal("rowDeselected",n.getComponent()),r._rowSelectionChanged(i,void 0,n),n}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],r=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(n=>n.getComponent()),Array.isArray(r)||(r=[r]),r=r.map(n=>n.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,r))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var r=this.table.modules.dataTree.getChildren(e,!0,!0);if(i)for(let n of r)this._selectRow(n,!0);else for(let n of r)this._deselectRow(n,!0)}}Ve(O1,"moduleName","selectRow"),Ve(O1,"moduleExtensions",Nve);class Ave{constructor(e){return this._range=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._range.table.componentFunctionBinder.handle("range",i._range,r)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0,!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}class Ove extends Ja{constructor(e,i,r,n){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(r,n)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,r){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(r)}setStartBound(e){var i,r;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,r=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,r))}setEndBound(e){var i=this._getTableRows().length,r,n,a;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(r=e.row.position-1,n=e.column.getPosition()-1,a=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(r,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&a?this.setEnd(r,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,n):this.setEnd(r,n))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,r=this.table.columnManager.renderer.leftCol,n=this.table.columnManager.renderer.rightCol,a,o,s,l,u,c,d,p,m,h;this.table.options.renderHorizontal==="virtual"&&this.rangeManager.rowHeader&&(n+=1),e==null&&(e=0),i==null&&(i=1/0),r==null&&(r=0),n==null&&(n=1/0),this.overlaps(r,e,n,i)&&(a=Math.max(this.top,e),o=Math.min(this.bottom,i),s=Math.max(this.left,r),l=Math.min(this.right,n),u=this.rangeManager.getCell(a,s),c=this.rangeManager.getCell(o,l),d=u.getElement(),p=c.getElement(),m=u.row.getElement(),h=c.row.getElement(),this.element.classList.add("tabulator-range-active"),this.table.rtl?(this.element.style.right=m.offsetWidth-d.offsetLeft-d.offsetWidth+"px",this.element.style.width=d.offsetLeft+d.offsetWidth-p.offsetLeft+"px"):(this.element.style.left=m.offsetLeft+d.offsetLeft+"px",this.element.style.width=p.offsetLeft+p.offsetWidth-d.offsetLeft+"px"),this.element.style.top=m.offsetTop+"px",this.element.style.height=h.offsetTop+h.offsetHeight-m.offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,r,n){return!(this.left>r||e>this.right||this.top>n||i>this.bottom)}getData(){var e=[],i=this.getRows(),r=this.getColumns();return i.forEach(n=>{var a=n.getData(),o={};r.forEach(s=>{o[s.field]=a[s.field]}),e.push(o)}),e}getCells(e,i){var r=[],n=this.getRows(),a=this.getColumns();return e?r=n.map(o=>{var s=[];return o.getCells().forEach(l=>{a.includes(l.column)&&s.push(i?l.getComponent():l)}),s}):n.forEach(o=>{o.getCells().forEach(s=>{a.includes(s.column)&&r.push(i?s.getComponent():s)})}),r}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(r=>{r.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),r={start:null,end:null};return i.length?(r.start=i[0],r.end=i[i.length-1]):console.warn("No bounds defined on range"),r}getComponent(){return this.component||(this.component=new Ave(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}}var kve={rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},xve={rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)}},Fve={range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,r=!1,n,a,o,s,l;return l=t.length,i&&(n=i.getBounds(),a=n.start,n.start===n.end&&(r=!0),a&&(e=this.table.rowManager.activeRows.slice(),o=e.indexOf(a.row),r?s=t.length:s=e.indexOf(n.end.row)-o+1,o>-1&&(this.table.blockRedraw(),e=e.slice(o,o+s),e.forEach((u,c)=>{u.updateData(t[c%l])}),this.table.restoreRedraw()))),e}},Lve={range:function(t){var e=[],i=[],r=this.table.modules.selectRange.activeRange,n=!1,a,o,s,l,u;return r&&(a=r.getBounds(),o=a.start,a.start===a.end&&(n=!0),o&&(t=t.split(`
`),t.forEach(function(c){e.push(c.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),u=l.indexOf(o.column),u>-1)))?(n?s=e[0].length:s=l.indexOf(a.end.column)-u+1,l=l.slice(u,u+s),e.forEach(c=>{var d={},p=c.length;l.forEach(function(m,h){d[m.field]=c[h%p]}),i.push(d)}),i):!1}},_ve={range:function(){var t=this.modules.selectRange.selectedColumns();return this.columnManager.rowHeader&&t.unshift(this.columnManager.rowHeader),t}},$ve={range:function(){return this.modules.selectRange.selectedRows()}},Bve={keybindings:{bindings:kve,actions:xve},clipboard:{pasteActions:Fve,pasteParsers:Lve},export:{columnLookups:_ve,rowLookups:$ve}};class GU extends ci{constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()),this.options("columns").findIndex(e=>e.frozen)>0&&console.warn("Having frozen column in arbitrary position with selectRange option may result in unpredictable behavior."),this.options("columns").filter(e=>e.frozen)>1&&console.warn("Having multiple frozen columns with selectRange option may result in unpredictable behavior."))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-moving",this.handleColumnMoving.bind(this)),this.subscribe("column-moved",this.handleColumnMoved.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){var e;this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior"))),this.table.modules.frozenColumns&&this.table.modules.frozenColumns.active&&(e=this.table.modules.frozenColumns.getFrozenColumns(),(e.length>1||e.length===1&&e[0]!==this.rowHeader)&&console.warn("Using frozen columns that are not the range header in combination with the selectRange option may result in unpredictable behavior"))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(r=>r.occupiesRow(e.row)):i=this.ranges.filter(r=>r.occupies(e)),i.map(r=>r.getComponent())}rowGetRanges(e){var i=this.ranges.filter(r=>r.occupiesRow(e));return i.map(r=>r.getComponent())}colGetRanges(e){var i=this.ranges.filter(r=>r.occupiesColumn(e));return i.map(r=>r.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;this.restoreFocus();try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(r=>r.occupiesColumn(e)),i&&this.ranges.forEach(r=>{var n=r.getColumns(!0);n.forEach(a=>{a!==e&&a.setWidth(e.width)})}))}handleColumnMoving(e,i){this.resetRanges().setBounds(i),this.overlay.style.visibility="hidden"}handleColumnMoved(e,i,r){this.activeRange.setBounds(e),this.layoutElement()}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||this.table.options.movableColumns&&this.selecting==="column"&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),r=this.ranges.findIndex(n=>n.occupies(e));i.classList.toggle("tabulator-range-selected",r!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=r}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e),i.preventDefault()}keyNavigateRange(e,i,r,n){this.navigate(r,n,i),e.preventDefault()}navigate(e,i,r){var n=!1,a,o,s,l,u,c;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(d=>d===this.activeRange?(d.setEnd(d.start.row,d.start.col),!0):(d.destroy(),!1))),a=this.activeRange,o=i?a.end:a.start,s=o.row,l=o.col,e)switch(r){case"left":l=this.findJumpCellLeft(a.start.row,o.col);break;case"right":l=this.findJumpCellRight(a.start.row,o.col);break;case"up":s=this.findJumpCellUp(o.row,a.start.col);break;case"down":s=this.findJumpCellDown(o.row,a.start.col);break}else{if(i&&(this.selecting==="row"&&(r==="left"||r==="right")||this.selecting==="column"&&(r==="up"||r==="down")))return;switch(r){case"left":l=Math.max(l-1,0);break;case"right":l=Math.min(l+1,this.getTableColumns().length-1);break;case"up":s=Math.max(s-1,0);break;case"down":s=Math.min(s+1,this.getTableRows().length-1);break}}if(this.rowHeader&&l===0&&(l=1),n=l!==o.col||s!==o.row,i||a.setStart(s,l),a.setEnd(s,l),i||(this.selecting="cell"),n)return u=this.getRowByRangePos(a.end.row),c=this.getColumnByRangePos(a.end.col),(r==="left"||r==="right")&&c.getElement().parentNode===null?c.getComponent().scrollTo(void 0,!1):(r==="up"||r==="down")&&u.getElement().parentNode===null?u.getComponent().scrollTo(void 0,!1):this.autoScroll(a,u.getElement(),c.getElement()),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpRow(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(o){return o.getData()[e.getField()]})}findJumpCol(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(o){return e.getData()[o.getField()]})}findJumpItem(e,i,r,n){var a;for(let o of r){let s=n(o);if(e){if(a=o,s)break}else if(i){if(a=o,s)break}else if(s)a=o;else break}return a}findJumpCellLeft(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),o=n[i-1]?this.isEmpty(r.getData()[n[i-1].getField()]):!1,s=this.rowHeader?n.slice(1,i):n.slice(0,i),l=this.findJumpCol(r,s,!0,a,o);return l?l.getPosition()-1:i}findJumpCellRight(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),o=n[i+1]?this.isEmpty(r.getData()[n[i+1].getField()]):!1,s=this.findJumpCol(r,n.slice(i+1,n.length),!1,a,o);return s?s.getPosition()-1:i}findJumpCellUp(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),o=n[e-1]?this.isEmpty(n[e-1].getData()[r.getField()]):!1,s=this.findJumpRow(r,n.slice(0,e),!0,a,o);return s?s.position-1:e}findJumpCellDown(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),o=n[e+1]?this.isEmpty(n[e+1].getData()[r.getField()]):!1,s=this.findJumpRow(r,n.slice(e+1,n.length),!1,a,o);return s?s.position-1:e}newSelection(e,i){var r;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){r=this.resetRanges(),this.selecting="all";var n,a=this.getCell(-1,-1);this.rowHeader?n=this.getCell(0,1):n=this.getCell(0,0),r.setBounds(n,a);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,r){var n=this.table.rowManager.element,a,o,s,l,u;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof r>"u"&&(r=this.getColumnByRangePos(e.end.col).getElement()),this.rowHeader&&(a=this.rowHeader.getElement()),o={left:r.offsetLeft,right:r.offsetLeft+r.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},s={left:n.scrollLeft,right:Math.ceil(n.scrollLeft+n.clientWidth),top:n.scrollTop,bottom:n.scrollTop+n.offsetHeight-this.table.rowManager.scrollbarWidth},a&&(s.left+=a.offsetWidth),l=s.left<o.left&&o.left<s.right&&s.left<o.right&&o.right<s.right,u=s.top<o.top&&o.top<s.bottom&&s.top<o.bottom&&o.bottom<s.bottom,l||(o.left<s.left?(n.scrollLeft=o.left,a&&(n.scrollLeft-=a.offsetWidth)):o.right>s.right&&(n.scrollLeft=o.right-n.clientWidth)),u||(o.top<s.top?n.scrollTop=o.top:o.bottom>s.bottom&&(n.scrollTop=o.bottom-n.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(r=>{r.type==="row"&&(this.layoutRow(r),r.cells.forEach(n=>this.renderCell(n)))}),this.getTableColumns().forEach(r=>{this.layoutColumn(r)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesRow(e));this.selecting==="row"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutColumn(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesColumn(e));this.selecting==="column"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutRanges(){var e,i,r;this.table.initialized&&(e=this.getActiveCell(),e&&(i=e.getElement(),r=e.row.getElement(),this.table.rtl?this.activeRangeCellElement.style.right=r.offsetWidth-i.offsetLeft-i.offsetWidth+"px":this.activeRangeCellElement.style.left=r.offsetLeft+i.offsetLeft+"px",this.activeRangeCellElement.style.top=r.offsetTop+"px",this.activeRangeCellElement.style.width=i.offsetWidth+"px",this.activeRangeCellElement.style.height=r.offsetHeight+"px",this.ranges.forEach(n=>n.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var r;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),r=this.table.rowManager.getRowFromPosition(e+1),r?r.getCells(!1,!0).filter(n=>n.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var r;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),r=new Ove(this.table,this,e,i),this.activeRange=r,this.ranges.push(r),this.rangeContainer.appendChild(r.element),r}resetRanges(){var e,i,r;return this.ranges.forEach(n=>n.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(r=this.table.rowManager.activeRows[0].cells.filter(n=>n.column.visible),i=r[this.rowHeader?1:0],i&&(e.setBounds(i),this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}isEmpty(e){return e==null||e===""}}Ve(GU,"moduleName","selectRange"),Ve(GU,"moduleInitOrder",1),Ve(GU,"moduleExtensions",Bve);function Vve(t,e,i,r,n,a,o){var s=o.alignEmptyValues,l=o.decimalSeparator,u=o.thousandSeparator,c=0;if(t=String(t),e=String(e),u&&(t=t.split(u).join(""),e=e.split(u).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))c=isNaN(e)?0:-1;else if(isNaN(e))c=1;else return t-e;return(s==="top"&&a==="desc"||s==="bottom"&&a==="asc")&&(c*=-1),c}function jve(t,e,i,r,n,a,o){var s=o.alignEmptyValues,l=0,u;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof o.locale){case"boolean":o.locale&&(u=this.langLocale());break;case"string":u=o.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),u)}return(s==="top"&&a==="desc"||s==="bottom"&&a==="asc")&&(l*=-1),l}function Cx(t,e,i,r,n,a,o){var s=window.DateTime||luxon.DateTime,l=o.format||"dd/MM/yyyy HH:mm:ss",u=o.alignEmptyValues,c=0;if(typeof s<"u"){if(s.isDateTime(t)||(l==="iso"?t=s.fromISO(String(t)):t=s.fromFormat(String(t),l)),s.isDateTime(e)||(l==="iso"?e=s.fromISO(String(e)):e=s.fromFormat(String(e),l)),!t.isValid)c=e.isValid?-1:0;else if(!e.isValid)c=1;else return t-e;return(u==="top"&&a==="desc"||u==="bottom"&&a==="asc")&&(c*=-1),c}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function Gve(t,e,i,r,n,a,o){return o.format||(o.format="dd/MM/yyyy"),Cx.call(this,t,e,i,r,n,a,o)}function Hve(t,e,i,r,n,a,o){return o.format||(o.format="HH:mm"),Cx.call(this,t,e,i,r,n,a,o)}function zve(t,e,i,r,n,a,o){var s=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return s-l}function Wve(t,e,i,r,n,a,o){var s=o.type||"length",l=o.alignEmptyValues,u=0;function c(d){var p;switch(s){case"length":p=d.length;break;case"sum":p=d.reduce(function(m,h){return m+h});break;case"max":p=Math.max.apply(null,d);break;case"min":p=Math.min.apply(null,d);break;case"avg":p=d.reduce(function(m,h){return m+h})/d.length;break}return p}if(!Array.isArray(t))u=Array.isArray(e)?-1:0;else if(!Array.isArray(e))u=1;else return c(e)-c(t);return(l==="top"&&a==="desc"||l==="bottom"&&a==="asc")&&(u*=-1),u}function qve(t,e,i,r,n,a,o){var s=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return s-l}function Yve(t,e,i,r,n,a,o){var s,l,u,c,d=0,p,m=/(\d+)|(\D+)/g,h=/\d/,f=o.alignEmptyValues,g=0;if(!t&&t!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(s=String(t).toLowerCase(),l=String(e).toLowerCase(),s===l)return 0;if(!(h.test(s)&&h.test(l)))return s>l?1:-1;for(s=s.match(m),l=l.match(m),p=s.length>l.length?l.length:s.length;d<p;)if(u=s[d],c=l[d++],u!==c)return isFinite(u)&&isFinite(c)?(u.charAt(0)==="0"&&(u="."+u),c.charAt(0)==="0"&&(c="."+c),u-c):u>c?1:-1;return s.length>l.length}return(f==="top"&&a==="desc"||f==="bottom"&&a==="asc")&&(g*=-1),g}var Kve={number:Vve,string:jve,date:Gve,time:Hve,datetime:Cx,boolean:zve,array:Wve,exists:qve,alphanum:Yve};const qp=class qp extends ci{constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,r,n){var a=this.getSort();return a.forEach(o=>{delete o.column}),n.sort=a,n}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,r,n;switch(typeof e.definition.sorter){case"string":qp.sorters[e.definition.sorter]?i=qp.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(r=e.getElement(),r.classList.add("tabulator-sortable"),n=document.createElement("div"),n.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":n.classList.add("tabulator-col-sorter-element");break;case"header":r.classList.add("tabulator-col-sorter-element");break;default:r.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":n.appendChild(this.table.options.headerSortElement);break;default:n.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(n),e.modules.sort.element=n,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&n.addEventListener("mousedown",a=>{a.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?n:r).addEventListener("click",a=>{var o="",s=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?o=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?o=e.modules.sort.dir=="asc"?"desc":"asc":o="none";else switch(e.modules.sort.dir){case"asc":o="desc";break;case"desc":o="asc";break;default:o=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(a.shiftKey||a.ctrlKey)?(s=this.getSort(),l=s.findIndex(u=>u.field===e.getField()),l>-1?(s[l].dir=o,l=s.splice(l,1)[0],o!="none"&&s.push(l)):o!="none"&&s.push({column:e,dir:o}),this.setSort(s)):o=="none"?this.clear():this.setSort(e,o),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(r){r.column&&i.push({column:r.column.getComponent(),field:r.column.getField(),dir:r.dir})}),i}setSort(e,i){var r=this,n=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(a){var o;o=r.table.columnManager.findColumn(a.column),o?(a.column=o,n.push(a),r.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",a.column)}),r.sortList=n,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],r="string",n,a;if(i&&(i=i.getData(),n=e.getField(),n))switch(a=e.getFieldValue(i),typeof a){case"undefined":r="string";break;case"boolean":r="boolean";break;default:!isNaN(a)&&a!==""?r="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(r="alphanum");break}return qp.sorters[r]}sort(e,i){var r=this,n=this.table.options.sortOrderReverse?r.sortList.slice().reverse():r.sortList,a=[],o=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",r.getSort()),i||r.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(n.forEach(function(s,l){var u;s.column&&(u=s.column.modules.sort,u&&(u.sorter||(u.sorter=r.findSorter(s.column)),s.params=typeof u.params=="function"?u.params(s.column.getComponent(),s.dir):u.params,a.push(s)),i||r.setColumnHeader(s.column,s.dir))}),a.length&&r._sortItems(e,a)):i||n.forEach(function(s,l){r.setColumnHeader(s.column,s.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(s=>{o.push(s.getComponent())}),this.dispatchExternal("dataSorted",r.getSort(),o)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var r=e.modules.sort.element,n;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;r.firstChild;)r.removeChild(r.firstChild);n=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof n=="object"?r.appendChild(n):r.innerHTML=n}}_sortItems(e,i){var r=i.length-1;e.sort((n,a)=>{for(var o,s=r;s>=0;s--){let l=i[s];if(o=this._sortRow(n,a,l.column,l.dir,l.params),o!==0)break}return o})}_sortRow(e,i,r,n,a){var o,s,l=n=="asc"?e:i,u=n=="asc"?i:e;return e=r.getFieldValue(l.getData()),i=r.getFieldValue(u.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",o=l.getComponent(),s=u.getComponent(),r.modules.sort.sorter.call(this,e,i,o,s,r.getComponent(),n,a)}};Ve(qp,"moduleName","sort"),Ve(qp,"sorters",Kve);let k1=qp;class Jve{constructor(e,i){this.columnCount=e,this.rowCount=i,this.columnString=[],this.columns=[],this.rows=[]}genColumns(e){var i=Math.max(this.columnCount,Math.max(...e.map(r=>r.length)));this.columnString=[],this.columns=[];for(let r=1;r<=i;r++)this.incrementChar(this.columnString.length-1),this.columns.push(this.columnString.join(""));return this.columns}genRows(e){var i=Math.max(this.rowCount,e.length);this.rows=[];for(let r=1;r<=i;r++)this.rows.push(r);return this.rows}incrementChar(e){let i=this.columnString[e];i?i!=="Z"?this.columnString[e]=String.fromCharCode(this.columnString[e].charCodeAt(0)+1):(this.columnString[e]="A",e?this.incrementChar(e-1):this.columnString.push("A")):this.columnString.push("A")}setRowCount(e){this.rowCount=e}setColumnCount(e){this.columnCount=e}}class M7{constructor(e){return this._sheet=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._sheet.table.componentFunctionBinder.handle("sheet",i._sheet,r)}})}getTitle(){return this._sheet.title}getKey(){return this._sheet.key}getDefinition(){return this._sheet.getDefinition()}getData(){return this._sheet.getData()}setData(e){return this._sheet.setData(e)}clear(){return this._sheet.clear()}remove(){return this._sheet.remove()}active(){return this._sheet.active()}setTitle(e){return this._sheet.setTitle(e)}setRows(e){return this._sheet.setRows(e)}setColumns(e){return this._sheet.setColumns(e)}}class FV extends Ja{constructor(e,i){super(e.table),this.spreadsheetManager=e,this.definition=i,this.title=this.definition.title||"",this.key=this.definition.key||this.definition.title,this.rowCount=this.definition.rows,this.columnCount=this.definition.columns,this.data=this.definition.data||[],this.element=null,this.isActive=!1,this.grid=new Jve(this.columnCount,this.rowCount),this.defaultColumnDefinition={width:100,headerHozAlign:"center",headerSort:!1},this.columnDefinition=Object.assign(this.defaultColumnDefinition,this.options("spreadsheetColumnDefinition")),this.columnDefs=[],this.rowDefs=[],this.columnFields=[],this.columns=[],this.rows=[],this.scrollTop=null,this.scrollLeft=null,this.initialize(),this.dispatchExternal("sheetAdded",this.getComponent())}initialize(){this.initializeElement(),this.initializeColumns(),this.initializeRows()}reinitialize(){this.initializeColumns(),this.initializeRows()}initializeElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tab"),this.element.innerText=this.title,this.element.addEventListener("click",()=>{this.spreadsheetManager.loadSheet(this)})}initializeColumns(){this.grid.setColumnCount(this.columnCount),this.columnFields=this.grid.genColumns(this.data),this.columnDefs=[],this.columnFields.forEach(e=>{var i=Object.assign({},this.columnDefinition);i.field=e,i.title=e,this.columnDefs.push(i)})}initializeRows(){var e;this.grid.setRowCount(this.rowCount),e=this.grid.genRows(this.data),this.rowDefs=[],e.forEach((i,r)=>{var n={_id:i},a=this.data[r];a&&a.forEach((o,s)=>{var l=this.columnFields[s];l&&(n[l]=o)}),this.rowDefs.push(n)})}unload(){this.isActive=!1,this.scrollTop=this.table.rowManager.scrollTop,this.scrollLeft=this.table.rowManager.scrollLeft,this.data=this.getData(!0),this.element.classList.remove("tabulator-spreadsheet-tab-active")}load(){var e=!this.isActive;this.isActive=!0,this.table.blockRedraw(),this.table.setData([]),this.table.setColumns(this.columnDefs),this.table.setData(this.rowDefs),this.table.restoreRedraw(),e&&this.scrollTop!==null&&(this.table.rowManager.element.scrollLeft=this.scrollLeft,this.table.rowManager.element.scrollTop=this.scrollTop),this.element.classList.add("tabulator-spreadsheet-tab-active"),this.dispatchExternal("sheetLoaded",this.getComponent())}getComponent(){return new M7(this)}getDefinition(){return{title:this.title,key:this.key,rows:this.rowCount,columns:this.columnCount,data:this.getData()}}getData(e){var i=[],r,n,a;return this.rowDefs.forEach(o=>{var s=[];this.columnFields.forEach(l=>{s.push(o[l])}),i.push(s)}),!e&&!this.options("spreadsheetOutputFull")&&(r=i.map(o=>o.findLastIndex(s=>typeof s<"u")+1),n=Math.max(...r),a=r.findLastIndex(o=>o>0)+1,i=i.slice(0,a),i=i.map(o=>o.slice(0,n))),i}setData(e){this.data=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}clear(){this.setData([])}setTitle(e){this.title=e,this.element.innerText=e,this.dispatchExternal("sheetUpdated",this.getComponent())}setRows(e){this.rowCount=e,this.initializeRows(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}setColumns(e){this.columnCount=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}remove(){this.spreadsheetManager.removeSheet(this)}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchExternal("sheetRemoved",this.getComponent())}active(){this.spreadsheetManager.loadSheet(this)}}class N7 extends ci{constructor(e){super(e),this.sheets=[],this.element=null,this.registerTableOption("spreadsheet",!1),this.registerTableOption("spreadsheetRows",50),this.registerTableOption("spreadsheetColumns",50),this.registerTableOption("spreadsheetColumnDefinition",{}),this.registerTableOption("spreadsheetOutputFull",!1),this.registerTableOption("spreadsheetData",!1),this.registerTableOption("spreadsheetSheets",!1),this.registerTableOption("spreadsheetSheetTabs",!1),this.registerTableOption("spreadsheetSheetTabsElement",!1),this.registerTableFunction("setSheets",this.setSheets.bind(this)),this.registerTableFunction("addSheet",this.addSheet.bind(this)),this.registerTableFunction("getSheets",this.getSheets.bind(this)),this.registerTableFunction("getSheetDefinitions",this.getSheetDefinitions.bind(this)),this.registerTableFunction("setSheetData",this.setSheetData.bind(this)),this.registerTableFunction("getSheet",this.getSheet.bind(this)),this.registerTableFunction("getSheetData",this.getSheetData.bind(this)),this.registerTableFunction("clearSheet",this.clearSheet.bind(this)),this.registerTableFunction("removeSheet",this.removeSheetFunc.bind(this)),this.registerTableFunction("activeSheet",this.activeSheetFunc.bind(this))}initialize(){this.options("spreadsheet")&&(this.subscribe("table-initialized",this.tableInitialized.bind(this)),this.subscribe("data-loaded",this.loadRemoteData.bind(this)),this.table.options.index="_id",this.options("spreadsheetData")&&this.options("spreadsheetSheets")&&(console.warn("You cannot use spreadsheetData and spreadsheetSheets at the same time, ignoring spreadsheetData"),this.table.options.spreadsheetData=!1),this.compatibilityCheck(),this.options("spreadsheetSheetTabs")&&this.initializeTabset())}compatibilityCheck(){this.options("data")&&console.warn("Do not use the data option when working with spreadsheets, use either spreadsheetData or spreadsheetSheets to pass data into the table"),this.options("pagination")&&console.warn("The spreadsheet module is not compatible with the pagination module"),this.options("groupBy")&&console.warn("The spreadsheet module is not compatible with the row grouping module"),this.options("responsiveCollapse")&&console.warn("The spreadsheet module is not compatible with the responsive collapse module")}initializeTabset(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tabs");var e=this.options("spreadsheetSheetTabsElement");e&&!(e instanceof HTMLElement)&&(e=document.querySelector(e),e||console.warn("Unable to find element matching spreadsheetSheetTabsElement selector:",this.options("spreadsheetSheetTabsElement"))),e?e.appendChild(this.element):this.footerAppend(this.element)}tableInitialized(){this.sheets.length?this.loadSheet(this.sheets[0]):this.options("spreadsheetSheets")?this.loadSheets(this.options("spreadsheetSheets")):this.options("spreadsheetData")&&this.loadData(this.options("spreadsheetData"))}loadRemoteData(e,i,r){return console.log("data",e,i,r),Array.isArray(e)?(this.table.dataLoader.clearAlert(),this.dispatchExternal("dataLoaded",e),!e.length||Array.isArray(e[0])?this.loadData(e):this.loadSheets(e)):console.error(`Spreadsheet Loading Error - Unable to process remote data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e),!1}loadData(e){var i={data:e};this.loadSheet(this.newSheet(i))}destroySheets(){this.sheets.forEach(e=>{e.destroy()}),this.sheets=[],this.activeSheet=null}loadSheets(e){Array.isArray(e)||(e=[]),this.destroySheets(),e.forEach(i=>{this.newSheet(i)}),this.loadSheet(this.sheets[0])}loadSheet(e){this.activeSheet!==e&&(this.activeSheet&&this.activeSheet.unload(),this.activeSheet=e,e.load())}newSheet(e={}){var i;return e.rows||(e.rows=this.options("spreadsheetRows")),e.columns||(e.columns=this.options("spreadsheetColumns")),i=new FV(this,e),this.sheets.push(i),this.element&&this.element.appendChild(i.element),i}removeSheet(e){var i=this.sheets.indexOf(e),r;this.sheets.length>1?i>-1&&(this.sheets.splice(i,1),e.destroy(),this.activeSheet===e&&(r=this.sheets[i-1]||this.sheets[0],r?this.loadSheet(r):this.activeSheet=null)):console.warn("Unable to remove sheet, at least one sheet must be active")}lookupSheet(e){return e?e instanceof FV?e:e instanceof M7?e._sheet:this.sheets.find(i=>i.key===e)||!1:this.activeSheet}setSheets(e){return this.loadSheets(e),this.getSheets()}addSheet(e){return this.newSheet(e).getComponent()}getSheetDefinitions(){return this.sheets.map(e=>e.getDefinition())}getSheets(){return this.sheets.map(e=>e.getComponent())}getSheet(e){var i=this.lookupSheet(e);return i?i.getComponent():!1}setSheetData(e,i){e&&!i&&(i=e,e=!1);var r=this.lookupSheet(e);return r?r.setData(i):!1}getSheetData(e){var i=this.lookupSheet(e);return i?i.getData():!1}clearSheet(e){var i=this.lookupSheet(e);return i?i.clear():!1}removeSheetFunc(e){var i=this.lookupSheet(e);i&&this.removeSheet(i)}activeSheetFunc(e){var i=this.lookupSheet(e);return i?this.loadSheet(i):!1}}Ve(N7,"moduleName","spreadsheet");class A7 extends ci{constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,r){var n=e==="tooltip"?r.column.definition.tooltip:r.definition.headerTooltip;n&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,r,n),this.table.options.tooltipDelay))}mouseoutCheck(e,i,r){this.popupInstance||this.clearPopup()}clearPopup(e,i,r){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,r){var n,a,o;function s(l){a=l}typeof r=="function"&&(r=r(e,i.getComponent(),s)),r instanceof HTMLElement?n=r:(n=document.createElement("div"),r===!0&&(i instanceof Gb?r=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{n.innerHTML=r=l||i.definition.title}):r=i.definition.title),n.innerHTML=r),(r||r===0||r===!1)&&(n.classList.add("tabulator-tooltip"),n.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(n),typeof a=="function"&&this.popupInstance.renderCallback(a),o=this.popupInstance.containerEventCoords(e),this.popupInstance.show(o.x+15,o.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}}Ve(A7,"moduleName","tooltip");var Xve={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(/^[a-z0-9]+$/i);return r.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(i);return r.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=!0,n=t.getData(),a=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(o){var s=o.getData();s!==n&&e==a.getFieldValue(s)&&(r=!1)}),r},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};const yI=class yI extends ci{constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,r){var n=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return n!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,n)}),n}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(r=>{r=r.getComponent();var n=r.validate();n!==!0&&(i=i.concat(n))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,r=[],n;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(a=>{n=i._extractValidator(a),n&&r.push(n)}):(n=this._extractValidator(e.definition.validator),n&&r.push(n)),e.modules.validate=r.length?r:!1)}_extractValidator(e){var i,r,n;switch(typeof e){case"string":return n=e.indexOf(":"),n>-1?(i=e.substring(0,n),r=e.substring(n+1)):i=e,this._buildValidator(i,r);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var r=typeof e=="function"?e:yI.validators[e];return r?{type:typeof e=="function"?"function":e,func:r,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,r){var n=this,a=[],o=this.invalidCells.indexOf(i);return e&&e.forEach(s=>{s.func.call(n,i.getComponent(),r,s.params)||a.push({type:s.type,parameters:s.params})}),i.modules.validate||(i.modules.validate={}),a.length?(i.modules.validate.invalid=a,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),o==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),o>-1&&this.invalidCells.splice(o,1)),a.length?a:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}};Ve(yI,"moduleName","validate"),Ve(yI,"validators",Xve);let x1=yI;var EE=Object.freeze({__proto__:null,AccessorModule:h1,AjaxModule:v1,ClipboardModule:I1,ColumnCalcsModule:y1,DataTreeModule:g7,DownloadModule:b1,EditModule:w1,ExportModule:U1,FilterModule:S1,FormatModule:T1,FrozenColumnsModule:v7,FrozenRowsModule:I7,GroupRowsModule:y7,HistoryModule:D1,HtmlTableImportModule:b7,ImportModule:P1,InteractionModule:w7,KeybindingsModule:R1,MenuModule:U7,MoveColumnsModule:S7,MoveRowsModule:E1,MutatorModule:C1,PageModule:M1,PersistenceModule:N1,PopupModule:T7,PrintModule:D7,ReactiveDataModule:P7,ResizeColumnsModule:R7,ResizeRowsModule:E7,ResizeTableModule:C7,ResponsiveLayoutModule:A1,SelectRangeModule:GU,SelectRowModule:O1,SortModule:k1,SpreadsheetModule:N7,TooltipModule:A7,ValidateModule:x1}),Qve={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{}};class O7{constructor(e,i,r={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},r)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var r=Object.assign({},this.registeredDefaults),n=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(r,e);for(let a in i)r.hasOwnProperty(a)||(n&&console.warn("Invalid "+this.msgType+" option:",a),r[a]=i.key);for(let a in r)a in i?r[a]=i[a]:Array.isArray(r[a])?r[a]=Object.assign([],r[a]):typeof r[a]=="object"&&r[a]!==null?r[a]=Object.assign({},r[a]):typeof r[a]>"u"&&delete r[a];return r}}class YD extends Ja{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,r){var n=this.rows().indexOf(e),a=e.getElement(),o=0;return new Promise((s,l)=>{if(n>-1){if(typeof r>"u"&&(r=this.table.options.scrollToRowIfVisible),!r&&xr.elVisible(a)&&(o=xr.elOffset(a).top-xr.elOffset(this.elementVertical).top,o>0&&o<this.elementVertical.clientHeight-a.offsetHeight))return s(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(a.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-a.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-a.offsetTop)+a.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+a.offsetHeight;break;case"top":this.elementVertical.scrollTop=a.offsetTop;break}s()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class Zve extends YD{constructor(e){super(e)}renderRowCells(e,i){const r=document.createDocumentFragment();e.cells.forEach(n=>{r.appendChild(n.getElement())}),e.element.appendChild(r),i||e.cells.forEach(n=>{n.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class eIe extends YD{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var r=i.getWidth();r>e&&(e=r)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var r={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},n=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(a=>{var o={},s;a.visible&&(a.modules.frozen||(s=a.getWidth(),o.leftPos=n,o.rightPos=n+s,o.width=s,this.isFitData&&(o.fitDataCheck=a.modules.vdomHoz?a.modules.vdomHoz.fitDataCheck:!0),n+s>this.vDomScrollPosLeft&&n<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=n),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=s),this.columns.push(a),a.modules.vdomHoz=o,n+=s))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(r))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(r=>{i.appendChild(r.getElement())}),e.element.appendChild(i),e.cells.forEach(r=>{r.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++)this.columns[i].reinitializeWidth()}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,r;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(n=>{!n.definition.width&&n.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){r=i.getElement(),i.generateCells(),this.tableElement.appendChild(r);for(let n=0;n<i.cells.length;n++){let a=i.cells[n];r.appendChild(a.getElement()),a.column.reinitializeWidth()}r.parentNode.removeChild(r),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((r,n)=>{r!==this.columns[n]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));e.forEach(r=>{this.reinitializeRow(r,!0)}),i.forEach(r=>{r.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,r){for(let n=e;n<i;n++){let a=this.columns[n];a.modules.vdomHoz.leftPos+=r,a.modules.vdomHoz.rightPos+=r}}addColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol+1];r&&r.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);n.getElement().insertBefore(a.getElement(),n.getCell(this.columns[this.rightCol]).getElement().nextSibling),a.cellRendered()}}),this.fitDataColActualWidthCheck(r),this.rightCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=r.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol-1];if(r)if(r.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(a=>{if(a.type!=="group"){var o=a.getCell(r);a.getElement().insertBefore(o.getElement(),a.getCell(this.columns[this.leftCol]).getElement()),o.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(a=>{a.type!=="group"&&(a.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=r.getWidth();let n=this.fitDataColActualWidthCheck(r);n&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+n,this.vDomPadRight-=n)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol];r&&r.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(o){console.warn("Could not removeColRight",o.message)}}}),this.vDomPadRight+=r.getWidth(),this.rightCol--,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol];r&&r.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(o){console.warn("Could not removeColLeft",o.message)}}}),this.vDomPadLeft+=r.getWidth(),this.leftCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,r;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),r=i-e.modules.vdomHoz.width,r&&(e.modules.vdomHoz.rightPos+=r,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,r)),e.modules.vdomHoz.fitDataCheck=!1),r}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let r=e.getCell(i);e.getElement().appendChild(r.getElement()),r.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var r=e.getElement();r.firstChild;)r.removeChild(r.firstChild);this.initializeRow(e)}}}class tIe extends Ja{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new O7(this.table,"column definition",f7),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:eIe,basic:Zve};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],r={},n=this.table.options.autoColumns==="full"?e:[e[0]],a=this.table.options.autoColumnsDefinitions;if(e&&e.length){if(n.forEach(o=>{Object.keys(o).forEach((s,l)=>{let u=o[s],c;r[s]?r[s]!==!0&&typeof u<"u"&&(r[s].sorter=this.calculateSorterFromValue(u),r[s]=!0):(c={field:s,title:s,sorter:this.calculateSorterFromValue(u)},i.splice(l,0,c),r[s]=typeof u>"u"?c:!0)})}),a)switch(typeof a){case"function":this.table.options.columns=a.call(this.table,i);break;case"object":Array.isArray(a)?i.forEach(o=>{var s=a.find(l=>l.field===o.field);s&&Object.assign(o,s)}):i.forEach(o=>{a[o.field]&&Object.assign(o,a[o.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}calculateSorterFromValue(e){var i;switch(typeof e){case"undefined":i="string";break;case"boolean":i="boolean";break;case"number":i="number";break;case"object":Array.isArray(e)?i="array":i="string";break;default:!isNaN(e)&&e!==""?i="number":e.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?i="alphanum":i="string";break}return i}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.dispatchExternal("columnsLoading"),this.table.options.rowHeader&&(this.rowHeader=new sm(this.table.options.rowHeader===!0?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),e.forEach((r,n)=>{this._addColumn(r)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.subscribedExternal("columnsLoaded")&&this.dispatchExternal("columnsLoaded",this.getComponents()),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,r){var n=new sm(e,this),a=n.getElement(),o=r&&this.findColumnIndex(r);if(i&&this.rowHeader&&(!r||r===this.rowHeader)&&(i=!1,r=this.rowHeader,o=0),r&&o>-1){var s=r.getTopColumn(),l=this.columns.indexOf(s),u=s.getElement();i?(this.columns.splice(l,0,n),u.parentNode.insertBefore(a,u)):(this.columns.splice(l+1,0,n),u.parentNode.insertBefore(a,u.nextSibling))}else i?(this.columns.unshift(n),this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)):(this.columns.push(n),this.headersElement.appendChild(n.getElement()));return n.columnRendered(),n}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var r=i.getHeight();r>e&&(e=r)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof sm)return e;if(e instanceof h7)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}),i.find(n=>n.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(r=>{var n=this.table.options.nestedFieldSeparator?r.split(this.table.options.nestedFieldSeparator)[0]:r;n===e&&i.push(this.columnsByField[r])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,r)=>{e(i,r)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(r=>{(!e||e&&r.visible)&&i.push(r.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],r=e?this.columns:this.columnsByIndex;return r.forEach(n=>{i.push(n.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,r){i.element.parentNode.insertBefore(e.element,i.element),r&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,r),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,r){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,r):this._moveColumnInArray(this.columns,e,i,r),this._moveColumnInArray(this.columnsByIndex,e,i,r,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,r),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,r,n,a){var o=e.indexOf(i),s,l=[];o>-1&&(e.splice(o,1),s=e.indexOf(r),s>-1?n&&(s=s+1):s=o,e.splice(s,0,i),a&&(l=this.chain("column-moving-rows",[i,r,n],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(u){if(u.cells.length){var c=u.cells.splice(o,1)[0];u.cells.splice(s,0,c)}})))}scrollToColumn(e,i,r){var n=0,a=e.getLeftOffset(),o=0,s=e.getElement();return new Promise((l,u)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof r>"u"&&(r=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":o=-this.element.clientWidth/2;break;case"right":o=s.clientWidth-this.headersElement.clientWidth;break}if(!r&&a>0&&a+s.offsetWidth<this.element.clientWidth)return!1;n=a+o,n=Math.max(Math.min(n,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(n),this.scrollHorizontal(n),l()}else console.warn("Scroll Error - Column not visible"),u("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(r=>{i.push(r.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(r){var n,a,o;r.visible&&(n=r.definition.width||0,a=parseInt(r.minWidth),typeof n=="string"?n.indexOf("%")>-1?o=e/100*parseInt(n):o=parseInt(n):o=n,i+=o>a?o:a)}),i}addColumn(e,i,r){return new Promise((n,a)=>{var o=this._addColumn(e,i,r);this._reIndexColumns(),this.dispatch("column-add",e,i,r),this.layoutMode()!="fitColumns"&&o.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),n(o)})}deregisterColumn(e){var i=e.getField(),r;i&&delete this.columnsByField[i],r=this.columnsByIndex.indexOf(e),r>-1&&this.columnsByIndex.splice(r,1),r=this.columns.indexOf(e),r>-1&&this.columns.splice(r,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){xr.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class iIe extends YD{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,r=document.createDocumentFragment(),n=this.rows();n.forEach((a,o)=>{this.styleRow(a,o),a.initialize(!1,!0),a.type!=="group"&&(i=!1),r.appendChild(a.getElement())}),e.appendChild(r),n.forEach(a=>{a.rendered(),a.heightInitialized||a.calcHeight(!0)}),n.forEach(a=>{a.heightInitialized||a.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=xr.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=xr.elOffset(i).top-xr.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class rIe extends YD{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,r=!1,n=!1,a=this.table.rowManager.scrollLeft,o=this.rows(),s=this.vDomTop;s<=this.vDomBottom;s++)if(o[s]){var l=i-o[s].getElement().offsetTop;if(n===!1||Math.abs(l)<n)n=l,r=s;else break}o.forEach(u=>{u.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(r===!1?this.rows.length-1:r,!0,n||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(a)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var r=e-this.vDomScrollPosTop,n=e-this.vDomScrollPosBottom,a=this.vDomWindowBuffer*2,o=this.rows();if(this.scrollTop=e,-r>a||n>a){var s=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*o.length)),this.scrollColumns(s)}else i?(r<0&&this._addTopRow(o,-r),n<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(o,-n):this.vDomScrollPosBottom=this.scrollTop)):(n>=0&&this._addBottomRow(o,n),r>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(o,r):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,r=this.elementVertical.clientHeight+i,n=!1,a=0,o=0,s=this.rows();if(e)a=this.vDomTop,o=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(s[l])if(n)if(r-s[l].getElement().offsetTop>=0)o=l;else break;else if(i-s[l].getElement().offsetTop>=0)a=l;else if(n=!0,r-s[l].getElement().offsetTop>=0)o=l;else break;return s.slice(a,o+1)}_virtualRenderFill(e,i,r){var n=this.tableElement,a=this.elementVertical,o=0,s=0,l=0,u=0,c=0,d=0,p=this.rows(),m=p.length,h=0,f,g,v=[],y=0,I=0,b=this.table.rowManager.fixedHeight,S=this.elementVertical.clientHeight,w=this.table.options.rowHeight,U=!0;if(e=e||0,r=r||0,!e)this.clear();else{for(;n.firstChild;)n.removeChild(n.firstChild);u=(m-e+1)*this.vDomRowHeight,u<S&&(e-=Math.ceil((S-u)/this.vDomRowHeight),e<0&&(e=0)),o=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=o}if(m&&xr.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,b||this.table.options.maxHeight?(w&&(I=S/w+this.vDomWindowBuffer/w),I=Math.max(this.vDomWindowMinTotalRows,Math.ceil(I))):I=m;(I==m||s<=S+this.vDomWindowBuffer||y<this.vDomWindowMinTotalRows)&&this.vDomBottom<m-1;){for(v=[],g=document.createDocumentFragment(),d=0;d<I&&this.vDomBottom<m-1;)h=this.vDomBottom+1,f=p[h],this.styleRow(f,h),f.initialize(!1,!0),!f.heightInitialized&&!this.table.options.rowHeight&&f.clearCellHeight(),g.appendChild(f.getElement()),v.push(f),this.vDomBottom++,d++;if(!v.length)break;n.appendChild(g),v.forEach(T=>{T.rendered(),T.heightInitialized||T.calcHeight(!0)}),v.forEach(T=>{T.heightInitialized||T.setCellHeight()}),v.forEach(T=>{l=T.getHeight(),y<o?c+=l:s+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),y++}),U=this.table.rowManager.adjustTableSize(),S=this.elementVertical.clientHeight,U&&(b||this.table.options.maxHeight)&&(w=s/y,I=Math.max(this.vDomWindowMinTotalRows,Math.ceil(S/w+this.vDomWindowBuffer/w)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+r:this.scrollTop-c,this.vDomBottomPad=this.vDomBottom==m-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-s-c,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((s+c)/y),this.vDomBottomPad=this.vDomRowHeight*(m-this.vDomBottom-1),this.vDomScrollHeight=c+s+this.vDomBottomPad-S),n.style.paddingTop=this.vDomTopPad+"px",n.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+c+r-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-S:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-S),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-S),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,a.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var r=this.tableElement,n=[],a=0,o=this.vDomTop-1,s=0,l=!0;l;)if(this.vDomTop){let u=e[o],c,d;u&&s<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,o),r.insertBefore(u.getElement(),r.firstChild),(!u.initialized||!u.heightInitialized)&&n.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomTop--,o--,s++):l=!1):l=!1}else l=!1;for(let u of n)u.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomTopPad-=a,this.vDomTopPad<0&&(this.vDomTopPad=o*this.vDomRowHeight),o<1&&(this.vDomTopPad=0),r.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=a)}_removeTopRow(e,i){for(var r=[],n=0,a=0,o=!0;o;){let s=e[this.vDomTop],l;s&&a<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,n+=l,r.push(s),a++):o=!1):o=!1}for(let s of r){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomTopPad+=n,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?n:n+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var r=this.tableElement,n=[],a=0,o=this.vDomBottom+1,s=0,l=!0;l;){let u=e[o],c,d;u&&s<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,o),r.appendChild(u.getElement()),(!u.initialized||!u.heightInitialized)&&n.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomBottom++,o++,s++):l=!1):l=!1}for(let u of n)u.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomBottomPad-=a,(this.vDomBottomPad<0||o==e.length-1)&&(this.vDomBottomPad=0),r.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=a)}_removeBottomRow(e,i){for(var r=[],n=0,a=0,o=!0;o;){let s=e[this.vDomBottom],l;s&&a<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,n+=l,r.push(s),a++):o=!1):o=!1}for(let s of r){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomBottomPad+=n,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=n)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class nIe extends Ja{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let r=document.createElement("div");r.classList.add("tabulator-placeholder-contents"),r.innerHTML=e,i.appendChild(r),this.placeholderContents=r}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,r=this.element.scrollTop,n=this.scrollTop>r;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=r&&(this.scrollTop=r,this.renderer.scrollRows(r,n),this.dispatch("scroll-vertical",r,n),this.dispatchExternal("scrollVertical",r,n))})}findRow(e){if(typeof e=="object"){if(e instanceof no)return e;if(e instanceof WD)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(r=>r.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(r=>r.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(r=>r.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.type==="row"&&i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,r){return this.renderer.scrollToRowPosition(e,i,r)}setData(e,i,r){return new Promise((n,a)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&r&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),n()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((r,n)=>{if(r&&typeof r=="object"){var a=new no(r,this);this.rows.push(a)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",r)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var r=this.rows.indexOf(e),n=this.activeRows.indexOf(e);n>-1&&this.activeRows.splice(n,1),r>-1&&this.rows.splice(r,1),this.setActiveRows(this.activeRows),this.displayRowIterator(a=>{var o=a.indexOf(e);o>-1&&a.splice(o,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,r,n){var a=this.addRowActual(e,i,r,n);return a}addRows(e,i,r,n){var a=[];return new Promise((o,s)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof r>"u"&&i||typeof r<"u"&&!i)&&e.reverse(),e.forEach((l,u)=>{var c=this.addRow(l,i,r,!0);a.push(c),this.dispatch("row-added",c,l,i,r)}),this.refreshActiveData(n?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),o(a)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,r,n){var a=e instanceof no?e:new no(e||{},this),o=this.findAddRowPos(i),s=-1,l,u;return r||(u=this.chain("row-adding-position",[a,o],null,{index:r,top:o}),r=u.index,o=u.top),typeof r<"u"&&(r=this.findRow(r)),r=this.chain("row-adding-index",[a,r,o],null,r),r&&(s=this.rows.indexOf(r)),r&&s>-1?(l=this.activeRows.indexOf(r),this.displayRowIterator(function(c){var d=c.indexOf(r);d>-1&&c.splice(o?d:d+1,0,a)}),l>-1&&this.activeRows.splice(o?l:l+1,0,a),this.rows.splice(o?s:s+1,0,a)):o?(this.displayRowIterator(function(c){c.unshift(a)}),this.activeRows.unshift(a),this.rows.unshift(a)):(this.displayRowIterator(function(c){c.push(a)}),this.activeRows.push(a),this.rows.push(a)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",a.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),n||this.reRenderInPosition(),a}moveRow(e,i,r){this.dispatch("row-move",e,i,r),this.moveRowActual(e,i,r),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,r),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,r){this.moveRowInArray(this.rows,e,i,r),this.moveRowInArray(this.activeRows,e,i,r),this.displayRowIterator(n=>{this.moveRowInArray(n,e,i,r)}),this.dispatch("row-moving",e,i,r)}moveRowInArray(e,i,r,n){var a,o,s,l;if(i!==r&&(a=e.indexOf(i),a>-1&&(e.splice(a,1),o=e.indexOf(r),o>-1?n?e.splice(o+1,0,i):e.splice(o,0,i):e.splice(a,0,i)),e===this.getDisplayRows())){s=a<o?a:o,l=o>a?o:a+1;for(let u=s;u<=l;u++)e[u]&&this.styleRow(e[u],u)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r!==!1&&r<this.displayRowsCount-1&&(n=this.getDisplayRows()[r+1]),n&&(!(n instanceof no)||n.type!="row")?this.nextDisplayRow(n,i):n}prevDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r&&(n=this.getDisplayRows()[r-1]),i&&n&&(!(n instanceof no)||n.type!="row")?this.prevDisplayRow(n,i):n}findRowIndex(e,i){var r;return e=this.findRow(e),e&&(r=i.indexOf(e),r>-1)?r:!1}getData(e,i){var r=[],n=this.getRows(e);return n.forEach(function(a){a.type=="row"&&r.push(a.getData(i||"data"))}),r}getComponents(e){var i=[],r=this.getRows(e);return r.forEach(function(n){i.push(n.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,r){var n=this.table,a="",o=0,s=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(o=this.dataPipeline.findIndex(l=>l.handler===e),o>-1)a="dataPipeline",i&&(o==this.dataPipeline.length-1?a="display":o++);else if(o=this.displayPipeline.findIndex(l=>l.handler===e),o>-1)a="displayPipeline",i&&(o==this.displayPipeline.length-1?a="end":o++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else a=e||"all",o=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===a&&o<this.redrawBlockRestoreConfig.index||s.indexOf(a)<s.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:r,stage:a,index:o});return}else xr.elVisible(this.element)?r?this.reRenderInPosition(this.refreshPipelines.bind(this,e,a,o,r)):(this.refreshPipelines(e,a,o,r),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),n.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,a,o,r),this.dispatch("data-refreshed")}}refreshPipelines(e,i,r,n){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let a=r;a<this.dataPipeline.length;a++){let o=this.dataPipeline[a].handler(this.activeRowsPipeline[a].slice(0));this.activeRowsPipeline[a+1]=o||this.activeRowsPipeline[a].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":r=0,this.resetDisplayRows();case"displayPipeline":for(let a=r;a<this.displayPipeline.length;a++){let o=this.displayPipeline[a].handler((a?this.getDisplayRows(a-1):this.activeRows).slice(0),n);this.setDisplayRows(o||this.getDisplayRows(a-1).slice(0),a)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(r=>{r.type==="row"&&(r.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var r=Object.assign([],this.renderer.visibleRows(!i));return e&&(r=this.chain("rows-visible",[i],r,r)),r}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:rIe,basic:iIe};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}normalizeHeight(){this.activeRows.forEach(function(e){e.normalizeHeight()})}adjustTableSize(){let e=this.element.clientHeight,i,r=!1;if(this.renderer.verticalFillMode==="fill"){let n=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const a="calc(100% - "+n+"px)";this.element.style.minHeight=i||"calc(100% - "+n+"px)",this.element.style.height=a,this.element.style.maxHeight=a}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-n+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(r=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),r}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class aIe extends Ja{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){if(this.table.options.footerElement)switch(typeof this.table.options.footerElement){case"string":this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement;break}}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class oIe extends Ja{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,r){this.pseudoTrackers[e].target!==r&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=r,this.dispatch(e+"-mouseenter",i,r))}pseudoMouseLeave(e,i){var r=Object.keys(this.pseudoTrackers),n={row:["cell"],cell:["row"]};r=r.filter(a=>{var o=n[e];return a!==e&&(!o||o&&!o.includes(a))}),r.forEach(a=>{var o=this.pseudoTrackers[a].target;this.pseudoTrackers[a].target&&(this.dispatch(a+"-mouseleave",i,o),this.pseudoTrackers[a].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let r of i)for(let n of e){let a=r+"-"+n;this.subscriptionChange(a,this.subscriptionChanged.bind(this,r,n))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,r){var n=this.listeners[i].components,a=n.indexOf(e),o=!1;r?a===-1&&(n.push(e),o=!0):this.subscribed(e+"-"+i)||a>-1&&(n.splice(a,1),o=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),o&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var r=i.composedPath&&i.composedPath()||i.path,n=this.findTargets(r);n=this.bindComponents(e,n),this.triggerEvents(e,i,n),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(n).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let r=Object.keys(this.componentMap);for(let n of e){let a=n.classList?[...n.classList]:[];if(a.filter(l=>this.abortClasses.includes(l)).length)break;let s=a.filter(l=>r.includes(l));for(let l of s)i[this.componentMap[l]]||(i[this.componentMap[l]]=n)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var r=Object.keys(i).reverse(),n=this.listeners[e],a={},o={};for(let s of r){let l,u=i[s],c=this.previousTargets[s];if(c&&c.target===u)l=c.component;else switch(s){case"row":case"group":(n.components.includes("row")||n.components.includes("cell")||n.components.includes("group"))&&(l=this.table.rowManager.getVisibleRows(!0).find(p=>p.getElement()===u),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[s]=!1));break;case"column":n.components.includes("column")&&(l=this.table.columnManager.findColumn(u));break;case"cell":n.components.includes("cell")&&(a.row instanceof no?l=a.row.findCell(u):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}l&&(a[s]=l,o[s]={target:u,component:l})}return this.previousTargets=o,a}triggerEvents(e,i,r){var n=this.listeners[e];for(let a in r)r[a]&&n.components.includes(a)&&this.dispatch(a+"-"+e,i,r[a])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class sIe{constructor(e){this.table=e,this.bindings={}}bind(e,i,r){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,r):this.bindings[e][i]=r}handle(e,i,r){if(this.bindings[e]&&this.bindings[e][r]&&typeof this.bindings[e][r].bind=="function")return this.bindings[e][r].bind(null,i);r!=="then"&&typeof r=="string"&&!r.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+r+" function, have you checked that you have the correct Tabulator module installed?")}}class lIe extends Ja{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,r,n,a,o){var s=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,r,a])){this.loading=!0,a||this.alertLoader(),i=this.chain("data-params",[e,r,a],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,r,a],!1,Promise.resolve([]));return l.then(u=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(u)&&typeof u=="object"&&(u=this.mapParams(u,this.objectInvert(this.table.options.dataReceiveParams)));var c=this.chain("data-loaded",[u],null,u);s==this.requestOrder?(this.clearAlert(),c!==!1&&(this.dispatchExternal("dataLoaded",c),this.table.rowManager.setData(c,n,typeof o>"u"?!n:o))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(u=>{console.error("Data Load Error: ",u),this.dispatchExternal("dataLoadError",u),a||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,n,typeof o>"u"?!n:o),Promise.resolve()}mapParams(e,i){var r={};for(let n in e)r[i.hasOwnProperty(n)?i[n]:n]=e[n];return r}objectInvert(e){var i={};for(let r in e)i[e[r]]=r;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class uIe{constructor(e,i,r){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=r?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=r}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e])if(i)if(r=this.events[e].findIndex(n=>n===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),r;return this.events[i]&&this.events[i].forEach((n,a)=>{let o=n.apply(this.table,e);a||(r=o)}),r}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class cIe{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,r=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:r}),this.events[e].sort((n,a)=>n.priority-a.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e]){if(i)if(r=this.events[e].findIndex(n=>n.callback===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,r,n){var a=r;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((o,s)=>{a=o.callback.apply(this,i.concat([a]))}),a):typeof n=="function"?n():n}_confirm(e,i){var r=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((n,a)=>{n.callback.apply(this,i)&&(r=!0)}),r}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(r=>{r.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class dIe extends Ja{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,r){var n="";return typeof this.options(e)<"u"?(n="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(n=n+", Please use the %c"+i+"%c option instead",this._warnUser(n,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),r&&(this.table.options[i]=this.table.options[e])):this._warnUser(n,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}function pIe(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function LV(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function mIe(t,e){var i=0,r=this.table.rowManager.element.clientWidth,n=0,a=!1;t.forEach((o,s)=>{o.widthFixed||o.reinitializeWidth(),(this.table.options.responsiveLayout?o.modules.responsive.visible:o.visible)&&(a=o),o.visible&&(i+=o.getWidth())}),a?(n=r-i+a.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(a.setWidth(0),this.table.modules.responsiveLayout.update()),n>0?a.setWidth(n):a.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function hIe(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,r=0,n=0,a=0,o=0,s=[],l=[],u=0,c=0,d=0;function p(h){var f;return typeof h=="string"?h.indexOf("%")>-1?f=i/100*parseInt(h):f=parseInt(h):f=h,f}function m(h,f,g,v){var y=[],I=0,b=0,S=0,w=a,U=0,T=0,D=[];function P(R){return g*(R.column.definition.widthGrow||1)}function E(R){return p(R.width)-g*(R.column.definition.widthShrink||0)}return h.forEach(function(R,N){var A=v?E(R):P(R);R.column.minWidth>=A?y.push(R):R.column.maxWidth&&R.column.maxWidth<A?(R.width=R.column.maxWidth,f-=R.column.maxWidth,w-=v?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1,w&&(g=Math.floor(f/w))):(D.push(R),T+=v?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1)}),y.length?(y.forEach(function(R){I+=v?R.width-R.column.minWidth:R.column.minWidth,R.width=R.column.minWidth}),b=f-I,S=T?Math.floor(b/T):b,U=m(D,b,S,v)):(U=T?f-Math.floor(f/T)*T:f,D.forEach(function(R){R.width=v?E(R):P(R)})),U}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(h){var f,g,v;h.visible&&(f=h.definition.width,g=parseInt(h.minWidth),f?(v=p(f),r+=v>g?v:g,h.definition.widthShrink&&(l.push({column:h,width:v>g?v:g}),u+=h.definition.widthShrink)):(s.push({column:h,width:0}),a+=h.definition.widthGrow||1))}),n=i-r,o=Math.floor(n/a),d=m(s,n,o,!1),s.length&&d>0&&(s[s.length-1].width+=d),s.forEach(function(h){n-=h.width}),c=Math.abs(d)+n,c>0&&u&&(d=m(l,c,Math.floor(c/u),!0)),d&&l.length&&(l[l.length-1].width-=d),s.forEach(function(h){h.column.setWidth(h.width)}),l.forEach(function(h){h.column.setWidth(h.width)})}var fIe={fitData:pIe,fitDataFill:LV,fitDataTable:LV,fitDataStretch:mIe,fitColumns:hIe};const yf=class yf extends ci{constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;yf.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){this.dispatch("layout-refreshing"),yf.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),this.dispatch("layout-refreshed")}};Ve(yf,"moduleName","layout"),Ve(yf,"modes",fIe);let F1=yf;var gIe={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};const bI=class bI extends ci{constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=xr.deepClone(bI.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let r in i)e[r]&&typeof e[r]=="object"?this._setLangProp(e[r],i[r]):e[r]=i[r]}setLocale(e){e=e||"default";function i(r,n){for(var a in r)typeof r[a]=="object"?(n[a]||(n[a]={}),i(r[a],n[a])):n[a]=r[a]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let r=e.split("-")[0];this.langList[r]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,r),e=r):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=xr.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var r=i?e+"|"+i:e,n=r.split("|"),a=this._getLangElement(n,this.locale);return a||""}_getLangElement(e,i){var r=this.lang;return e.forEach(function(n){var a;r&&(a=r[n],typeof a<"u"?r=a:r=!1)}),r}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}};Ve(bI,"moduleName","localize"),Ve(bI,"langs",gIe);let L1=bI;class k7 extends ci{constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],r;return r=this.table.constructor.registry.lookupTable(e),r.forEach(n=>{this.table!==n&&i.push(n)}),i}send(e,i,r,n){var a=this.getConnections(e);a.forEach(o=>{o.tableComms(this.table.element,i,r,n)}),!a.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,r,n){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,r,n);console.warn("Inter-table Comms Error - no such module:",i)}}Ve(k7,"moduleName","comms");var vIe=Object.freeze({__proto__:null,CommsModule:k7,LayoutModule:F1,LocalizeModule:L1});const gs=class gs{static findTable(e){var i=gs.registry.lookupTable(e,!0);return Array.isArray(i)&&!i.length?!1:i}};Ve(gs,"registry",{tables:[],register(e){gs.registry.tables.push(e)},deregister(e){var i=gs.registry.tables.indexOf(e);i>-1&&gs.registry.tables.splice(i,1)},lookupTable(e,i){var r=[],n,a;if(typeof e=="string"){if(n=document.querySelectorAll(e),n.length)for(var o=0;o<n.length;o++)a=gs.registry.matchElement(n[o]),a&&r.push(a)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof gs?(a=gs.registry.matchElement(e),a&&r.push(a)):Array.isArray(e)?e.forEach(function(s){r=r.concat(gs.registry.lookupTable(s))}):i||console.warn("Table Connection Error - Invalid Selector",e);return r},matchElement(e){return gs.registry.tables.find(function(i){return e instanceof gs?i===e:i.element===e})}});let _1=gs;const or=class or extends _1{constructor(){super()}static initializeModuleBinder(e){or.modulesRegistered||(or.modulesRegistered=!0,or._registerModules(vIe,!0),e&&or._registerModules(e))}static _extendModule(e,i,r){if(or.moduleBindings[e]){var n=or.moduleBindings[e][i];if(n)if(typeof r=="object")for(let a in r)n[a]=r[a];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",i)}else console.warn("Module Error - module does not exist:",e)}static _registerModules(e,i){var r=Object.values(e);i&&r.forEach(n=>{n.prototype.moduleCore=!0}),or._registerModule(r)}static _registerModule(e){Array.isArray(e)||(e=[e]),e.forEach(i=>{or._registerModuleBinding(i),or._registerModuleExtensions(i)})}static _registerModuleBinding(e){e.moduleName?or.moduleBindings[e.moduleName]=e:console.error("Unable to bind module, no moduleName defined",e.moduleName)}static _registerModuleExtensions(e){var i=e.moduleExtensions;if(e.moduleExtensions)for(let r in i){let n=i[r];if(or.moduleBindings[r])for(let a in n)or._extendModule(r,a,n[a]);else{or.moduleExtensions[r]||(or.moduleExtensions[r]={});for(let a in n)or.moduleExtensions[r][a]||(or.moduleExtensions[r][a]={}),Object.assign(or.moduleExtensions[r][a],n[a])}}or._extendModuleFromQueue(e)}static _extendModuleFromQueue(e){var i=or.moduleExtensions[e.moduleName];if(i)for(let r in i)or._extendModule(e.moduleName,r,i[r])}_bindModules(){var e=[],i=[],r=[];this.modules={};for(var n in or.moduleBindings){let a=or.moduleBindings[n],o=new a(this);this.modules[n]=o,a.prototype.moduleCore?this.modulesCore.push(o):a.moduleInitOrder?a.moduleInitOrder<0?e.push(o):i.push(o):r.push(o)}e.sort((a,o)=>a.moduleInitOrder>o.moduleInitOrder?1:-1),i.sort((a,o)=>a.moduleInitOrder>o.moduleInitOrder?1:-1),this.modulesRegular=e.concat(r.concat(i))}};Ve(or,"moduleBindings",{}),Ve(or,"moduleExtensions",{}),Ve(or,"modulesRegistered",!1),Ve(or,"defaultModules",!1);let $1=or;class IIe extends Ja{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}const hc=class hc extends $1{static extendModule(){hc.initializeModuleBinder(),hc._extendModule(...arguments)}static registerModule(){hc.initializeModuleBinder(),hc._registerModule(...arguments)}constructor(e,i,r){super(),hc.initializeModuleBinder(r),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new sIe(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new dIe(this),this.optionsList=new O7(this,"table constructor"),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new tIe(this),this.rowManager=new nIe(this),this.footerManager=new aIe(this),this.dataLoader=new lIe(this),this.alertManager=new IIe(this),this._bindModules(),this.options=this.optionsList.generate(hc.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new uIe(this,this.options,this.options.debugEventsExternal),this.eventBus=new cIe(this.options.debugEventsInternal),this.interactionMonitor=new oIe(this),this.dataLoader.initialize(),this.footerManager.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,r;if(e.tagName==="TABLE"){this.originalElement=this.element,r=document.createElement("div");var n=e.attributes;for(var a in n)typeof n[a]=="object"&&r.setAttribute(n[a].name,n[a].value);e.parentNode.replaceChild(r,e),this.element=e=r}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(r=>{r.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(r=>{r.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var e=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var r,n;return this.options.debugInitialization&&!this.initialized&&(e||(r=new Error().stack.split(`
`),n=r[0]=="Error"?r[2]:r[1],n[0]==" "?e=n.trim().split(" ")[1].split(".")[1]:e=n.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,r){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,r,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,r){return this.initGuard(),this.dataLoader.load(e,i,r,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((r,n)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var o=this.rowManager.findRow(a[this.options.index]);o?(i++,o.updateData(a).then(()=>{i--,i||r()}).catch(s=>{n("Update Error - Unable to update row",a,s)})):n("Update Error - Unable to find row",a)}):(console.warn("Update Error - No data provided"),n("Update Error - No data provided"))})}addData(e,i,r){return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,r).then(o=>{var s=[];o.forEach(function(l){s.push(l.getComponent())}),n(s)}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}updateOrAddData(e){var i=[],r=0;return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(o=>{var s=this.rowManager.findRow(o[this.options.index]);r++,s?s.updateData(o).then(()=>{r--,i.push(s.getComponent()),r||n(i)}):this.rowManager.addRows(o).then(l=>{r--,i.push(l[0].getComponent()),r||n(i)})}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let r of e){let n=this.rowManager.findRow(r,!0);if(n)i.push(n);else return console.error("Delete Error - No matching row found:",r),Promise.reject("Delete Error - No matching row found")}return i.sort((r,n)=>this.rowManager.rows.indexOf(r)>this.rowManager.rows.indexOf(n)?1:-1),i.forEach(r=>{r.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,r){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,r,!0).then(n=>n[0].getComponent())}updateOrAddRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>r.getComponent()):this.rowManager.addRows(i).then(n=>n[0].getComponent())}updateRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>Promise.resolve(r.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,r){var n=this.rowManager.findRow(e);return n?this.rowManager.scrollToRow(n,i,r):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,r){var n=this.rowManager.findRow(e);this.initGuard(),n?n.moveToRow(i,r):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,r){var n=this.columnManager.findColumn(r);return this.initGuard(),this.columnManager.addColumn(e,i,n).then(a=>a.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var r=this.columnManager.findColumn(e);return this.initGuard(),r?r.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,r){var n=this.columnManager.findColumn(e),a=this.columnManager.findColumn(i);this.initGuard(),n?a?this.columnManager.moveColumn(n,a,r):console.warn("Move Error - No matching column found:",a):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,r){return new Promise((n,a)=>{var o=this.columnManager.findColumn(e);return o?this.columnManager.scrollToColumn(o,i,r):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}};Ve(hc,"defaultOptions",Qve);let B1=hc;var Bv=B1;class yIe extends Bv{static extendModule(){Bv.initializeModuleBinder(EE),Bv._extendModule(...arguments)}static registerModule(){Bv.initializeModuleBinder(EE),Bv._registerModule(...arguments)}constructor(e,i,r){super(e,i,EE)}}var Hb=yIe;function KD({anchorId:t}){const e=Hb.findTable(`#${t}`)[0];e&&e.destroy()}function bIe(t,e){return t?HD.dateTime.convertTime(t,e):""}function x7(t){var R;const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const r=t.getValue(),{potentialParticipants:n,eventName:a="",roundName:o="",schedule:s={},winningSide:l,matchUpId:u,sides:c}=r||{},{courtOrder:d="",scheduledTime:p="",courtId:m="",timeModifiers:h,venueId:f=""}=s;if(e.setAttribute("courtOrder",d),e.setAttribute("courtId",m),e.setAttribute("venueId",f),e.className="schedule-cell dragdrop",e.ondragover=N=>N.preventDefault(),u&&(e.draggable=!0,e.id=u,l&&e.classList.add("matchup-complete")),!u)return e;const g=`${a} ${o}`,v=N=>{var A,M;return((M=(A=N.person)==null?void 0:A.standardFamilyName)==null?void 0:M.toUpperCase())||N.participantName},y=n==null?void 0:n.map(N=>N==null?void 0:N.map(A=>`<span class='potential nowrap'>${v(A)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),I=N=>{var M,C;const A=(C=(M=c==null?void 0:c.find(O=>N===O.sideNumber))==null?void 0:M.participant)==null?void 0:C.participantName;if(A)return l===N?`<span style='font-weight: bold'>${A}</span>`:A},b=I(1)||(y==null?void 0:y.shift())||"Unkown",S=I(2)||(y==null?void 0:y.shift())||"Unknown";e.id=u;const w=document.createElement("div");w.className="header flexrow",w.innerHTML=((h==null?void 0:h[0])&&rge[h[0]]+"&nbsp;"||"")+bIe(p,!1),e.appendChild(w);const U=document.createElement("div");U.className="catround",U.innerHTML=g,e.appendChild(U);const T=document.createElement("div");T.className="scheduled_teams";const D=document.createElement("div");D.className="scheduled_team",D.style.fontSize="1em",D.innerHTML=b,T.appendChild(D);const P=document.createElement("div");P.className="divider",P.innerHTML="vs.",T.appendChild(P);const E=document.createElement("div");if(E.className="scheduled_team",E.style.fontSize="1em",E.innerHTML=S,T.appendChild(E),l){const N=document.createElement("div");N.innerHTML=((R=r.score)==null?void 0:R.scoreStringSide1)||"",T.appendChild(N)}return e.appendChild(T),e}function wIe({count:t}){return t>0?HD.generateRange(0,t).map(()=>({headerHozAlign:Zi,formatter:x7,headerSort:!1,resizable:!1,minWidth:150})):[]}function UIe(){function t(e){e.getElement().style.backgroundColor="white";const i=document.createElement("span"),r=e.getRow().getData();return i.innerHTML=r.rowNumber,i}return{formatter:t,headerSort:!1,resizable:!1,hozAlign:Zi,frozen:!0,width:55}}function SIe({courtsData:t,courtPrefix:e}){const i=ige-(t==null?void 0:t.length)||0,r=i<=0?1:i,n=wIe({count:r}),a=UIe(),o=(s,l)=>({field:`${e}${l}`,title:s.courtName,headerHozAlign:Zi,formatter:x7,headerSort:!1,resizable:!1,hozAlign:Zi,minWidth:150});return[a].concat(t==null?void 0:t.map(o),n)}var TIe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function DIe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var F7={exports:{}};(function(t,e){(function(i,r){t.exports=r()})(TIe,function(){var i=1e3,r=6e4,n=36e5,a="millisecond",o="second",s="minute",l="hour",u="day",c="week",d="month",p="quarter",m="year",h="date",f="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(A){var M=["th","st","nd","rd"],C=A%100;return"["+A+(M[(C-20)%10]||M[C]||M[0])+"]"}},I=function(A,M,C){var O=String(A);return!O||O.length>=M?A:""+Array(M+1-O.length).join(C)+A},b={s:I,z:function(A){var M=-A.utcOffset(),C=Math.abs(M),O=Math.floor(C/60),k=C%60;return(M<=0?"+":"-")+I(O,2,"0")+":"+I(k,2,"0")},m:function A(M,C){if(M.date()<C.date())return-A(C,M);var O=12*(C.year()-M.year())+(C.month()-M.month()),k=M.clone().add(O,d),x=C-k<0,F=M.clone().add(O+(x?-1:1),d);return+(-(O+(C-k)/(x?k-F:F-k))||0)},a:function(A){return A<0?Math.ceil(A)||0:Math.floor(A)},p:function(A){return{M:d,y:m,w:c,d:u,D:h,h:l,m:s,s:o,ms:a,Q:p}[A]||String(A||"").toLowerCase().replace(/s$/,"")},u:function(A){return A===void 0}},S="en",w={};w[S]=y;var U="$isDayjsObject",T=function(A){return A instanceof R||!(!A||!A[U])},D=function A(M,C,O){var k;if(!M)return S;if(typeof M=="string"){var x=M.toLowerCase();w[x]&&(k=x),C&&(w[x]=C,k=x);var F=M.split("-");if(!k&&F.length>1)return A(F[0])}else{var $=M.name;w[$]=M,k=$}return!O&&k&&(S=k),k||!O&&S},P=function(A,M){if(T(A))return A.clone();var C=typeof M=="object"?M:{};return C.date=A,C.args=arguments,new R(C)},E=b;E.l=D,E.i=T,E.w=function(A,M){return P(A,{locale:M.$L,utc:M.$u,x:M.$x,$offset:M.$offset})};var R=function(){function A(C){this.$L=D(C.locale,null,!0),this.parse(C),this.$x=this.$x||C.x||{},this[U]=!0}var M=A.prototype;return M.parse=function(C){this.$d=function(O){var k=O.date,x=O.utc;if(k===null)return new Date(NaN);if(E.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var F=k.match(g);if(F){var $=F[2]-1||0,_=(F[7]||"0").substring(0,3);return x?new Date(Date.UTC(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)):new Date(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)}}return new Date(k)}(C),this.init()},M.init=function(){var C=this.$d;this.$y=C.getFullYear(),this.$M=C.getMonth(),this.$D=C.getDate(),this.$W=C.getDay(),this.$H=C.getHours(),this.$m=C.getMinutes(),this.$s=C.getSeconds(),this.$ms=C.getMilliseconds()},M.$utils=function(){return E},M.isValid=function(){return this.$d.toString()!==f},M.isSame=function(C,O){var k=P(C);return this.startOf(O)<=k&&k<=this.endOf(O)},M.isAfter=function(C,O){return P(C)<this.startOf(O)},M.isBefore=function(C,O){return this.endOf(O)<P(C)},M.$g=function(C,O,k){return E.u(C)?this[O]:this.set(k,C)},M.unix=function(){return Math.floor(this.valueOf()/1e3)},M.valueOf=function(){return this.$d.getTime()},M.startOf=function(C,O){var k=this,x=!!E.u(O)||O,F=E.p(C),$=function(W,q){var Y=E.w(k.$u?Date.UTC(k.$y,q,W):new Date(k.$y,q,W),k);return x?Y:Y.endOf(u)},_=function(W,q){return E.w(k.toDate()[W].apply(k.toDate("s"),(x?[0,0,0,0]:[23,59,59,999]).slice(q)),k)},L=this.$W,B=this.$M,V=this.$D,G="set"+(this.$u?"UTC":"");switch(F){case m:return x?$(1,0):$(31,11);case d:return x?$(1,B):$(0,B+1);case c:var j=this.$locale().weekStart||0,z=(L<j?L+7:L)-j;return $(x?V-z:V+(6-z),B);case u:case h:return _(G+"Hours",0);case l:return _(G+"Minutes",1);case s:return _(G+"Seconds",2);case o:return _(G+"Milliseconds",3);default:return this.clone()}},M.endOf=function(C){return this.startOf(C,!1)},M.$set=function(C,O){var k,x=E.p(C),F="set"+(this.$u?"UTC":""),$=(k={},k[u]=F+"Date",k[h]=F+"Date",k[d]=F+"Month",k[m]=F+"FullYear",k[l]=F+"Hours",k[s]=F+"Minutes",k[o]=F+"Seconds",k[a]=F+"Milliseconds",k)[x],_=x===u?this.$D+(O-this.$W):O;if(x===d||x===m){var L=this.clone().set(h,1);L.$d[$](_),L.init(),this.$d=L.set(h,Math.min(this.$D,L.daysInMonth())).$d}else $&&this.$d[$](_);return this.init(),this},M.set=function(C,O){return this.clone().$set(C,O)},M.get=function(C){return this[E.p(C)]()},M.add=function(C,O){var k,x=this;C=Number(C);var F=E.p(O),$=function(B){var V=P(x);return E.w(V.date(V.date()+Math.round(B*C)),x)};if(F===d)return this.set(d,this.$M+C);if(F===m)return this.set(m,this.$y+C);if(F===u)return $(1);if(F===c)return $(7);var _=(k={},k[s]=r,k[l]=n,k[o]=i,k)[F]||1,L=this.$d.getTime()+C*_;return E.w(L,this)},M.subtract=function(C,O){return this.add(-1*C,O)},M.format=function(C){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||f;var x=C||"YYYY-MM-DDTHH:mm:ssZ",F=E.z(this),$=this.$H,_=this.$m,L=this.$M,B=k.weekdays,V=k.months,G=k.meridiem,j=function(q,Y,re,J){return q&&(q[Y]||q(O,x))||re[Y].slice(0,J)},z=function(q){return E.s($%12||12,q,"0")},W=G||function(q,Y,re){var J=q<12?"AM":"PM";return re?J.toLowerCase():J};return x.replace(v,function(q,Y){return Y||function(re){switch(re){case"YY":return String(O.$y).slice(-2);case"YYYY":return E.s(O.$y,4,"0");case"M":return L+1;case"MM":return E.s(L+1,2,"0");case"MMM":return j(k.monthsShort,L,V,3);case"MMMM":return j(V,L);case"D":return O.$D;case"DD":return E.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return j(k.weekdaysMin,O.$W,B,2);case"ddd":return j(k.weekdaysShort,O.$W,B,3);case"dddd":return B[O.$W];case"H":return String($);case"HH":return E.s($,2,"0");case"h":return z(1);case"hh":return z(2);case"a":return W($,_,!0);case"A":return W($,_,!1);case"m":return String(_);case"mm":return E.s(_,2,"0");case"s":return String(O.$s);case"ss":return E.s(O.$s,2,"0");case"SSS":return E.s(O.$ms,3,"0");case"Z":return F}return null}(q)||F.replace(":","")})},M.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},M.diff=function(C,O,k){var x,F=this,$=E.p(O),_=P(C),L=(_.utcOffset()-this.utcOffset())*r,B=this-_,V=function(){return E.m(F,_)};switch($){case m:x=V()/12;break;case d:x=V();break;case p:x=V()/3;break;case c:x=(B-L)/6048e5;break;case u:x=(B-L)/864e5;break;case l:x=B/n;break;case s:x=B/r;break;case o:x=B/i;break;default:x=B}return k?x:E.a(x)},M.daysInMonth=function(){return this.endOf(d).$D},M.$locale=function(){return w[this.$L]},M.locale=function(C,O){if(!C)return this.$L;var k=this.clone(),x=D(C,O,!0);return x&&(k.$L=x),k},M.clone=function(){return E.w(this.$d,this)},M.toDate=function(){return new Date(this.valueOf())},M.toJSON=function(){return this.isValid()?this.toISOString():null},M.toISOString=function(){return this.$d.toISOString()},M.toString=function(){return this.$d.toUTCString()},A}(),N=R.prototype;return P.prototype=N,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",u],["$M",d],["$y",m],["$D",h]].forEach(function(A){N[A[1]]=function(M){return this.$g(M,A[0],A[1])}}),P.extend=function(A,M){return A.$i||(A(M,R,P),A.$i=!0),P},P.locale=D,P.isDayjs=T,P.unix=function(A){return P(1e3*A)},P.en=w[S],P.Ls=w,P.p={},P})})(F7);var PIe=F7.exports;const RIe=DIe(PIe);function EIe(t){const{dateMatchUps:e=[],completedMatchUps:i=[],groupInfo:r,mappedParticipants:n}=(t==null?void 0:t.data)??{},a=e.concat(...i),o=a.reduce((S,w)=>{var T;const U=(T=w==null?void 0:w.schedule)==null?void 0:T.scheduledDate;return U&&!S.includes(U)&&S.push(U),S},[]),s=o[0];let l;const u=S=>{var w;for(const U of S.sides||[])U.participantId&&(U.participant=n[U.participantId],(w=U.participant)!=null&&w.individualParticipantIds&&(U.participant.individualParticipants=U.participant.individualParticipantIds.map(T=>n[T])))},c=({scheduledDate:S})=>{var P;const w=(P=t==null?void 0:t.data)==null?void 0:P.courtsData.map(E=>{const{matchUps:R,...N}=E;return R.forEach(u),{...N,matchUps:R.filter(A=>{var M;return((M=A.schedule)==null?void 0:M.scheduledDate)===S})}}),U="C|",T=fx.courtGridRows({courtsData:w,courtPrefix:U,minRowsCount:10}).rows,D=SIe({courtsData:w,courtPrefix:U});return T==null||T.forEach((E,R)=>{E.rowId=`rowId-${R+1}`,E.rowNumber=R+1}),{rows:T,columns:D,courtsCount:(w==null?void 0:w.length)??0,courtsData:w,groupInfo:r}},d=({scheduledDate:S})=>{const{rows:w}=c({scheduledDate:S});l==null||l.replaceData(w),l.matchUps=a},p=S=>RIe(S).format("dddd MMM D"),m=o.map(S=>({onClick:()=>d({scheduledDate:S}),label:p(S),value:S,close:!0})),h={label:p(s),options:m,id:"dateSelector",modifyLabel:!0,selection:!0},f=document.getElementById("scheduleHeader");nge(f);const g=om({button:h});f.appendChild(g),KD({anchorId:"tournamentSchedule"});const v=document.getElementById("tournamentSchedule"),{rows:y=[],columns:I=[],courtsCount:b}=c({scheduledDate:s});return l=new Hb(v,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:y,columns:I}),{table:l,courtsCount:b}}function CIe(){return"tmxToken"}function L7(t,e){return function(){return t.apply(e,arguments)}}const{toString:MIe}=Object.prototype,{getPrototypeOf:Mx}=Object,JD=(t=>e=>{const i=MIe.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),ru=t=>(t=t.toLowerCase(),e=>JD(e)===t),XD=t=>e=>typeof e===t,{isArray:nv}=Array,YI=XD("undefined");function NIe(t){return t!==null&&!YI(t)&&t.constructor!==null&&!YI(t.constructor)&&Ts(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const _7=ru("ArrayBuffer");function AIe(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&_7(t.buffer),e}const OIe=XD("string"),Ts=XD("function"),$7=XD("number"),QD=t=>t!==null&&typeof t=="object",kIe=t=>t===!0||t===!1,HU=t=>{if(JD(t)!=="object")return!1;const e=Mx(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},xIe=ru("Date"),FIe=ru("File"),LIe=ru("Blob"),_Ie=ru("FileList"),$Ie=t=>QD(t)&&Ts(t.pipe),BIe=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Ts(t.append)&&((e=JD(t))==="formdata"||e==="object"&&Ts(t.toString)&&t.toString()==="[object FormData]"))},VIe=ru("URLSearchParams"),[jIe,GIe,HIe,zIe]=["ReadableStream","Request","Response","Headers"].map(ru),WIe=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function zb(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let r,n;if(typeof t!="object"&&(t=[t]),nv(t))for(r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else{const a=i?Object.getOwnPropertyNames(t):Object.keys(t),o=a.length;let s;for(r=0;r<o;r++)s=a[r],e.call(null,t[s],s,t)}}function B7(t,e){e=e.toLowerCase();const i=Object.keys(t);let r=i.length,n;for(;r-- >0;)if(n=i[r],e===n.toLowerCase())return n;return null}const Yp=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,V7=t=>!YI(t)&&t!==Yp;function V1(){const{caseless:t}=V7(this)&&this||{},e={},i=(r,n)=>{const a=t&&B7(e,n)||n;HU(e[a])&&HU(r)?e[a]=V1(e[a],r):HU(r)?e[a]=V1({},r):nv(r)?e[a]=r.slice():e[a]=r};for(let r=0,n=arguments.length;r<n;r++)arguments[r]&&zb(arguments[r],i);return e}const qIe=(t,e,i,{allOwnKeys:r}={})=>(zb(e,(n,a)=>{i&&Ts(n)?t[a]=L7(n,i):t[a]=n},{allOwnKeys:r}),t),YIe=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),KIe=(t,e,i,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},JIe=(t,e,i,r)=>{let n,a,o;const s={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),a=n.length;a-- >0;)o=n[a],(!r||r(o,t,e))&&!s[o]&&(e[o]=t[o],s[o]=!0);t=i!==!1&&Mx(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},XIe=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const r=t.indexOf(e,i);return r!==-1&&r===i},QIe=t=>{if(!t)return null;if(nv(t))return t;let e=t.length;if(!$7(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},ZIe=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&Mx(Uint8Array)),eye=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let n;for(;(n=r.next())&&!n.done;){const a=n.value;e.call(t,a[0],a[1])}},tye=(t,e)=>{let i;const r=[];for(;(i=t.exec(e))!==null;)r.push(i);return r},iye=ru("HTMLFormElement"),rye=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,r,n){return r.toUpperCase()+n}),_V=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),nye=ru("RegExp"),j7=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),r={};zb(i,(n,a)=>{let o;(o=e(n,a,t))!==!1&&(r[a]=o||n)}),Object.defineProperties(t,r)},aye=t=>{j7(t,(e,i)=>{if(Ts(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const r=t[i];if(Ts(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},oye=(t,e)=>{const i={},r=n=>{n.forEach(a=>{i[a]=!0})};return nv(t)?r(t):r(String(t).split(e)),i},sye=()=>{},lye=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,CE="abcdefghijklmnopqrstuvwxyz",$V="0123456789",G7={DIGIT:$V,ALPHA:CE,ALPHA_DIGIT:CE+CE.toUpperCase()+$V},uye=(t=16,e=G7.ALPHA_DIGIT)=>{let i="";const{length:r}=e;for(;t--;)i+=e[Math.random()*r|0];return i};function cye(t){return!!(t&&Ts(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const dye=t=>{const e=new Array(10),i=(r,n)=>{if(QD(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[n]=r;const a=nv(r)?[]:{};return zb(r,(o,s)=>{const l=i(o,n+1);!YI(l)&&(a[s]=l)}),e[n]=void 0,a}}return r};return i(t,0)},pye=ru("AsyncFunction"),mye=t=>t&&(QD(t)||Ts(t))&&Ts(t.then)&&Ts(t.catch),H7=((t,e)=>t?setImmediate:e?((i,r)=>(Yp.addEventListener("message",({source:n,data:a})=>{n===Yp&&a===i&&r.length&&r.shift()()},!1),n=>{r.push(n),Yp.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",Ts(Yp.postMessage)),hye=typeof queueMicrotask<"u"?queueMicrotask.bind(Yp):typeof process<"u"&&process.nextTick||H7,Ie={isArray:nv,isArrayBuffer:_7,isBuffer:NIe,isFormData:BIe,isArrayBufferView:AIe,isString:OIe,isNumber:$7,isBoolean:kIe,isObject:QD,isPlainObject:HU,isReadableStream:jIe,isRequest:GIe,isResponse:HIe,isHeaders:zIe,isUndefined:YI,isDate:xIe,isFile:FIe,isBlob:LIe,isRegExp:nye,isFunction:Ts,isStream:$Ie,isURLSearchParams:VIe,isTypedArray:ZIe,isFileList:_Ie,forEach:zb,merge:V1,extend:qIe,trim:WIe,stripBOM:YIe,inherits:KIe,toFlatObject:JIe,kindOf:JD,kindOfTest:ru,endsWith:XIe,toArray:QIe,forEachEntry:eye,matchAll:tye,isHTMLForm:iye,hasOwnProperty:_V,hasOwnProp:_V,reduceDescriptors:j7,freezeMethods:aye,toObjectSet:oye,toCamelCase:rye,noop:sye,toFiniteNumber:lye,findKey:B7,global:Yp,isContextDefined:V7,ALPHABET:G7,generateString:uye,isSpecCompliantForm:cye,toJSONObject:dye,isAsyncFn:pye,isThenable:mye,setImmediate:H7,asap:hye};function ti(t,e,i,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),r&&(this.request=r),n&&(this.response=n,this.status=n.status?n.status:null)}Ie.inherits(ti,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ie.toJSONObject(this.config),code:this.code,status:this.status}}});const z7=ti.prototype,W7={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{W7[t]={value:t}});Object.defineProperties(ti,W7);Object.defineProperty(z7,"isAxiosError",{value:!0});ti.from=(t,e,i,r,n,a)=>{const o=Object.create(z7);return Ie.toFlatObject(t,o,function(l){return l!==Error.prototype},s=>s!=="isAxiosError"),ti.call(o,t.message,e,i,r,n),o.cause=t,o.name=t.name,a&&Object.assign(o,a),o};const fye=null;function j1(t){return Ie.isPlainObject(t)||Ie.isArray(t)}function q7(t){return Ie.endsWith(t,"[]")?t.slice(0,-2):t}function BV(t,e,i){return t?t.concat(e).map(function(n,a){return n=q7(n),!i&&a?"["+n+"]":n}).join(i?".":""):e}function gye(t){return Ie.isArray(t)&&!t.some(j1)}const vye=Ie.toFlatObject(Ie,{},null,function(e){return/^is[A-Z]/.test(e)});function ZD(t,e,i){if(!Ie.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=Ie.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(f,g){return!Ie.isUndefined(g[f])});const r=i.metaTokens,n=i.visitor||c,a=i.dots,o=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&Ie.isSpecCompliantForm(e);if(!Ie.isFunction(n))throw new TypeError("visitor must be a function");function u(h){if(h===null)return"";if(Ie.isDate(h))return h.toISOString();if(!l&&Ie.isBlob(h))throw new ti("Blob is not supported. Use a Buffer instead.");return Ie.isArrayBuffer(h)||Ie.isTypedArray(h)?l&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function c(h,f,g){let v=h;if(h&&!g&&typeof h=="object"){if(Ie.endsWith(f,"{}"))f=r?f:f.slice(0,-2),h=JSON.stringify(h);else if(Ie.isArray(h)&&gye(h)||(Ie.isFileList(h)||Ie.endsWith(f,"[]"))&&(v=Ie.toArray(h)))return f=q7(f),v.forEach(function(I,b){!(Ie.isUndefined(I)||I===null)&&e.append(o===!0?BV([f],b,a):o===null?f:f+"[]",u(I))}),!1}return j1(h)?!0:(e.append(BV(g,f,a),u(h)),!1)}const d=[],p=Object.assign(vye,{defaultVisitor:c,convertValue:u,isVisitable:j1});function m(h,f){if(!Ie.isUndefined(h)){if(d.indexOf(h)!==-1)throw Error("Circular reference detected in "+f.join("."));d.push(h),Ie.forEach(h,function(v,y){(!(Ie.isUndefined(v)||v===null)&&n.call(e,v,Ie.isString(y)?y.trim():y,f,p))===!0&&m(v,f?f.concat(y):[y])}),d.pop()}}if(!Ie.isObject(t))throw new TypeError("data must be an object");return m(t),e}function VV(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function Nx(t,e){this._pairs=[],t&&ZD(t,this,e)}const Y7=Nx.prototype;Y7.append=function(e,i){this._pairs.push([e,i])};Y7.toString=function(e){const i=e?function(r){return e.call(this,r,VV)}:VV;return this._pairs.map(function(n){return i(n[0])+"="+i(n[1])},"").join("&")};function Iye(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function K7(t,e,i){if(!e)return t;const r=i&&i.encode||Iye,n=i&&i.serialize;let a;if(n?a=n(e,i):a=Ie.isURLSearchParams(e)?e.toString():new Nx(e,i).toString(r),a){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class jV{constructor(){this.handlers=[]}use(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ie.forEach(this.handlers,function(r){r!==null&&e(r)})}}const J7={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},yye=typeof URLSearchParams<"u"?URLSearchParams:Nx,bye=typeof FormData<"u"?FormData:null,wye=typeof Blob<"u"?Blob:null,Uye={isBrowser:!0,classes:{URLSearchParams:yye,FormData:bye,Blob:wye},protocols:["http","https","file","blob","url","data"]},Ax=typeof window<"u"&&typeof document<"u",G1=typeof navigator=="object"&&navigator||void 0,Sye=Ax&&(!G1||["ReactNative","NativeScript","NS"].indexOf(G1.product)<0),Tye=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Dye=Ax&&window.location.href||"http://localhost",Pye=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ax,hasStandardBrowserEnv:Sye,hasStandardBrowserWebWorkerEnv:Tye,navigator:G1,origin:Dye},Symbol.toStringTag,{value:"Module"})),zo={...Pye,...Uye};function Rye(t,e){return ZD(t,new zo.classes.URLSearchParams,Object.assign({visitor:function(i,r,n,a){return zo.isNode&&Ie.isBuffer(i)?(this.append(r,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function Eye(t){return Ie.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Cye(t){const e={},i=Object.keys(t);let r;const n=i.length;let a;for(r=0;r<n;r++)a=i[r],e[a]=t[a];return e}function X7(t){function e(i,r,n,a){let o=i[a++];if(o==="__proto__")return!0;const s=Number.isFinite(+o),l=a>=i.length;return o=!o&&Ie.isArray(n)?n.length:o,l?(Ie.hasOwnProp(n,o)?n[o]=[n[o],r]:n[o]=r,!s):((!n[o]||!Ie.isObject(n[o]))&&(n[o]=[]),e(i,r,n[o],a)&&Ie.isArray(n[o])&&(n[o]=Cye(n[o])),!s)}if(Ie.isFormData(t)&&Ie.isFunction(t.entries)){const i={};return Ie.forEachEntry(t,(r,n)=>{e(Eye(r),n,i,0)}),i}return null}function Mye(t,e,i){if(Ie.isString(t))try{return(e||JSON.parse)(t),Ie.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(t)}const Wb={transitional:J7,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const r=i.getContentType()||"",n=r.indexOf("application/json")>-1,a=Ie.isObject(e);if(a&&Ie.isHTMLForm(e)&&(e=new FormData(e)),Ie.isFormData(e))return n?JSON.stringify(X7(e)):e;if(Ie.isArrayBuffer(e)||Ie.isBuffer(e)||Ie.isStream(e)||Ie.isFile(e)||Ie.isBlob(e)||Ie.isReadableStream(e))return e;if(Ie.isArrayBufferView(e))return e.buffer;if(Ie.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Rye(e,this.formSerializer).toString();if((s=Ie.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return ZD(s?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||n?(i.setContentType("application/json",!1),Mye(e)):e}],transformResponse:[function(e){const i=this.transitional||Wb.transitional,r=i&&i.forcedJSONParsing,n=this.responseType==="json";if(Ie.isResponse(e)||Ie.isReadableStream(e))return e;if(e&&Ie.isString(e)&&(r&&!this.responseType||n)){const o=!(i&&i.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(s){if(o)throw s.name==="SyntaxError"?ti.from(s,ti.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:zo.classes.FormData,Blob:zo.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ie.forEach(["delete","get","head","post","put","patch"],t=>{Wb.headers[t]={}});const Nye=Ie.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Aye=t=>{const e={};let i,r,n;return t&&t.split(`
`).forEach(function(o){n=o.indexOf(":"),i=o.substring(0,n).trim().toLowerCase(),r=o.substring(n+1).trim(),!(!i||e[i]&&Nye[i])&&(i==="set-cookie"?e[i]?e[i].push(r):e[i]=[r]:e[i]=e[i]?e[i]+", "+r:r)}),e},GV=Symbol("internals");function Vv(t){return t&&String(t).trim().toLowerCase()}function zU(t){return t===!1||t==null?t:Ie.isArray(t)?t.map(zU):String(t)}function Oye(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=i.exec(t);)e[r[1]]=r[2];return e}const kye=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function ME(t,e,i,r,n){if(Ie.isFunction(r))return r.call(this,e,i);if(n&&(e=i),!!Ie.isString(e)){if(Ie.isString(r))return e.indexOf(r)!==-1;if(Ie.isRegExp(r))return r.test(e)}}function xye(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,r)=>i.toUpperCase()+r)}function Fye(t,e){const i=Ie.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+i,{value:function(n,a,o){return this[r].call(this,e,n,a,o)},configurable:!0})})}class Wo{constructor(e){e&&this.set(e)}set(e,i,r){const n=this;function a(s,l,u){const c=Vv(l);if(!c)throw new Error("header name must be a non-empty string");const d=Ie.findKey(n,c);(!d||n[d]===void 0||u===!0||u===void 0&&n[d]!==!1)&&(n[d||l]=zU(s))}const o=(s,l)=>Ie.forEach(s,(u,c)=>a(u,c,l));if(Ie.isPlainObject(e)||e instanceof this.constructor)o(e,i);else if(Ie.isString(e)&&(e=e.trim())&&!kye(e))o(Aye(e),i);else if(Ie.isHeaders(e))for(const[s,l]of e.entries())a(l,s,r);else e!=null&&a(i,e,r);return this}get(e,i){if(e=Vv(e),e){const r=Ie.findKey(this,e);if(r){const n=this[r];if(!i)return n;if(i===!0)return Oye(n);if(Ie.isFunction(i))return i.call(this,n,r);if(Ie.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=Vv(e),e){const r=Ie.findKey(this,e);return!!(r&&this[r]!==void 0&&(!i||ME(this,this[r],r,i)))}return!1}delete(e,i){const r=this;let n=!1;function a(o){if(o=Vv(o),o){const s=Ie.findKey(r,o);s&&(!i||ME(r,r[s],s,i))&&(delete r[s],n=!0)}}return Ie.isArray(e)?e.forEach(a):a(e),n}clear(e){const i=Object.keys(this);let r=i.length,n=!1;for(;r--;){const a=i[r];(!e||ME(this,this[a],a,e,!0))&&(delete this[a],n=!0)}return n}normalize(e){const i=this,r={};return Ie.forEach(this,(n,a)=>{const o=Ie.findKey(r,a);if(o){i[o]=zU(n),delete i[a];return}const s=e?xye(a):String(a).trim();s!==a&&delete i[a],i[s]=zU(n),r[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return Ie.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=e&&Ie.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const r=new this(e);return i.forEach(n=>r.set(n)),r}static accessor(e){const r=(this[GV]=this[GV]={accessors:{}}).accessors,n=this.prototype;function a(o){const s=Vv(o);r[s]||(Fye(n,o),r[s]=!0)}return Ie.isArray(e)?e.forEach(a):a(e),this}}Wo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ie.reduceDescriptors(Wo.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[i]=r}}});Ie.freezeMethods(Wo);function NE(t,e){const i=this||Wb,r=e||i,n=Wo.from(r.headers);let a=r.data;return Ie.forEach(t,function(s){a=s.call(i,a,n.normalize(),e?e.status:void 0)}),n.normalize(),a}function Q7(t){return!!(t&&t.__CANCEL__)}function av(t,e,i){ti.call(this,t??"canceled",ti.ERR_CANCELED,e,i),this.name="CanceledError"}Ie.inherits(av,ti,{__CANCEL__:!0});function Z7(t,e,i){const r=i.config.validateStatus;!i.status||!r||r(i.status)?t(i):e(new ti("Request failed with status code "+i.status,[ti.ERR_BAD_REQUEST,ti.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function Lye(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function _ye(t,e){t=t||10;const i=new Array(t),r=new Array(t);let n=0,a=0,o;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=r[a];o||(o=u),i[n]=l,r[n]=u;let d=a,p=0;for(;d!==n;)p+=i[d++],d=d%t;if(n=(n+1)%t,n===a&&(a=(a+1)%t),u-o<e)return;const m=c&&u-c;return m?Math.round(p*1e3/m):void 0}}function $ye(t,e){let i=0,r=1e3/e,n,a;const o=(u,c=Date.now())=>{i=c,n=null,a&&(clearTimeout(a),a=null),t.apply(null,u)};return[(...u)=>{const c=Date.now(),d=c-i;d>=r?o(u,c):(n=u,a||(a=setTimeout(()=>{a=null,o(n)},r-d)))},()=>n&&o(n)]}const YS=(t,e,i=3)=>{let r=0;const n=_ye(50,250);return $ye(a=>{const o=a.loaded,s=a.lengthComputable?a.total:void 0,l=o-r,u=n(l),c=o<=s;r=o;const d={loaded:o,total:s,progress:s?o/s:void 0,bytes:l,rate:u||void 0,estimated:u&&s&&c?(s-o)/u:void 0,event:a,lengthComputable:s!=null,[e?"download":"upload"]:!0};t(d)},i)},HV=(t,e)=>{const i=t!=null;return[r=>e[0]({lengthComputable:i,total:t,loaded:r}),e[1]]},zV=t=>(...e)=>Ie.asap(()=>t(...e)),Bye=zo.hasStandardBrowserEnv?function(){const e=zo.navigator&&/(msie|trident)/i.test(zo.navigator.userAgent),i=document.createElement("a");let r;function n(a){let o=a;return e&&(i.setAttribute("href",o),o=i.href),i.setAttribute("href",o),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return r=n(window.location.href),function(o){const s=Ie.isString(o)?n(o):o;return s.protocol===r.protocol&&s.host===r.host}}():function(){return function(){return!0}}(),Vye=zo.hasStandardBrowserEnv?{write(t,e,i,r,n,a){const o=[t+"="+encodeURIComponent(e)];Ie.isNumber(i)&&o.push("expires="+new Date(i).toGMTString()),Ie.isString(r)&&o.push("path="+r),Ie.isString(n)&&o.push("domain="+n),a===!0&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function jye(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Gye(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function eK(t,e){return t&&!jye(e)?Gye(t,e):e}const WV=t=>t instanceof Wo?{...t}:t;function Am(t,e){e=e||{};const i={};function r(u,c,d){return Ie.isPlainObject(u)&&Ie.isPlainObject(c)?Ie.merge.call({caseless:d},u,c):Ie.isPlainObject(c)?Ie.merge({},c):Ie.isArray(c)?c.slice():c}function n(u,c,d){if(Ie.isUndefined(c)){if(!Ie.isUndefined(u))return r(void 0,u,d)}else return r(u,c,d)}function a(u,c){if(!Ie.isUndefined(c))return r(void 0,c)}function o(u,c){if(Ie.isUndefined(c)){if(!Ie.isUndefined(u))return r(void 0,u)}else return r(void 0,c)}function s(u,c,d){if(d in e)return r(u,c);if(d in t)return r(void 0,u)}const l={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(u,c)=>n(WV(u),WV(c),!0)};return Ie.forEach(Object.keys(Object.assign({},t,e)),function(c){const d=l[c]||n,p=d(t[c],e[c],c);Ie.isUndefined(p)&&d!==s||(i[c]=p)}),i}const tK=t=>{const e=Am({},t);let{data:i,withXSRFToken:r,xsrfHeaderName:n,xsrfCookieName:a,headers:o,auth:s}=e;e.headers=o=Wo.from(o),e.url=K7(eK(e.baseURL,e.url),t.params,t.paramsSerializer),s&&o.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):"")));let l;if(Ie.isFormData(i)){if(zo.hasStandardBrowserEnv||zo.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((l=o.getContentType())!==!1){const[u,...c]=l?l.split(";").map(d=>d.trim()).filter(Boolean):[];o.setContentType([u||"multipart/form-data",...c].join("; "))}}if(zo.hasStandardBrowserEnv&&(r&&Ie.isFunction(r)&&(r=r(e)),r||r!==!1&&Bye(e.url))){const u=n&&a&&Vye.read(a);u&&o.set(n,u)}return e},Hye=typeof XMLHttpRequest<"u",zye=Hye&&function(t){return new Promise(function(i,r){const n=tK(t);let a=n.data;const o=Wo.from(n.headers).normalize();let{responseType:s,onUploadProgress:l,onDownloadProgress:u}=n,c,d,p,m,h;function f(){m&&m(),h&&h(),n.cancelToken&&n.cancelToken.unsubscribe(c),n.signal&&n.signal.removeEventListener("abort",c)}let g=new XMLHttpRequest;g.open(n.method.toUpperCase(),n.url,!0),g.timeout=n.timeout;function v(){if(!g)return;const I=Wo.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),S={data:!s||s==="text"||s==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:I,config:t,request:g};Z7(function(U){i(U),f()},function(U){r(U),f()},S),g=null}"onloadend"in g?g.onloadend=v:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(v)},g.onabort=function(){g&&(r(new ti("Request aborted",ti.ECONNABORTED,t,g)),g=null)},g.onerror=function(){r(new ti("Network Error",ti.ERR_NETWORK,t,g)),g=null},g.ontimeout=function(){let b=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const S=n.transitional||J7;n.timeoutErrorMessage&&(b=n.timeoutErrorMessage),r(new ti(b,S.clarifyTimeoutError?ti.ETIMEDOUT:ti.ECONNABORTED,t,g)),g=null},a===void 0&&o.setContentType(null),"setRequestHeader"in g&&Ie.forEach(o.toJSON(),function(b,S){g.setRequestHeader(S,b)}),Ie.isUndefined(n.withCredentials)||(g.withCredentials=!!n.withCredentials),s&&s!=="json"&&(g.responseType=n.responseType),u&&([p,h]=YS(u,!0),g.addEventListener("progress",p)),l&&g.upload&&([d,m]=YS(l),g.upload.addEventListener("progress",d),g.upload.addEventListener("loadend",m)),(n.cancelToken||n.signal)&&(c=I=>{g&&(r(!I||I.type?new av(null,t,g):I),g.abort(),g=null)},n.cancelToken&&n.cancelToken.subscribe(c),n.signal&&(n.signal.aborted?c():n.signal.addEventListener("abort",c)));const y=Lye(n.url);if(y&&zo.protocols.indexOf(y)===-1){r(new ti("Unsupported protocol "+y+":",ti.ERR_BAD_REQUEST,t));return}g.send(a||null)})},Wye=(t,e)=>{const{length:i}=t=t?t.filter(Boolean):[];if(e||i){let r=new AbortController,n;const a=function(u){if(!n){n=!0,s();const c=u instanceof Error?u:this.reason;r.abort(c instanceof ti?c:new av(c instanceof Error?c.message:c))}};let o=e&&setTimeout(()=>{o=null,a(new ti(`timeout ${e} of ms exceeded`,ti.ETIMEDOUT))},e);const s=()=>{t&&(o&&clearTimeout(o),o=null,t.forEach(u=>{u.unsubscribe?u.unsubscribe(a):u.removeEventListener("abort",a)}),t=null)};t.forEach(u=>u.addEventListener("abort",a));const{signal:l}=r;return l.unsubscribe=()=>Ie.asap(s),l}},qye=function*(t,e){let i=t.byteLength;if(!e||i<e){yield t;return}let r=0,n;for(;r<i;)n=r+e,yield t.slice(r,n),r=n},Yye=async function*(t,e){for await(const i of Kye(t))yield*qye(i,e)},Kye=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:i,value:r}=await e.read();if(i)break;yield r}}finally{await e.cancel()}},qV=(t,e,i,r)=>{const n=Yye(t,e);let a=0,o,s=l=>{o||(o=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:u,value:c}=await n.next();if(u){s(),l.close();return}let d=c.byteLength;if(i){let p=a+=d;i(p)}l.enqueue(new Uint8Array(c))}catch(u){throw s(u),u}},cancel(l){return s(l),n.return()}},{highWaterMark:2})},eP=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",iK=eP&&typeof ReadableStream=="function",Jye=eP&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),rK=(t,...e)=>{try{return!!t(...e)}catch{return!1}},Xye=iK&&rK(()=>{let t=!1;const e=new Request(zo.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),YV=64*1024,H1=iK&&rK(()=>Ie.isReadableStream(new Response("").body)),KS={stream:H1&&(t=>t.body)};eP&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!KS[e]&&(KS[e]=Ie.isFunction(t[e])?i=>i[e]():(i,r)=>{throw new ti(`Response type '${e}' is not supported`,ti.ERR_NOT_SUPPORT,r)})})})(new Response);const Qye=async t=>{if(t==null)return 0;if(Ie.isBlob(t))return t.size;if(Ie.isSpecCompliantForm(t))return(await new Request(zo.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(Ie.isArrayBufferView(t)||Ie.isArrayBuffer(t))return t.byteLength;if(Ie.isURLSearchParams(t)&&(t=t+""),Ie.isString(t))return(await Jye(t)).byteLength},Zye=async(t,e)=>{const i=Ie.toFiniteNumber(t.getContentLength());return i??Qye(e)},ebe=eP&&(async t=>{let{url:e,method:i,data:r,signal:n,cancelToken:a,timeout:o,onDownloadProgress:s,onUploadProgress:l,responseType:u,headers:c,withCredentials:d="same-origin",fetchOptions:p}=tK(t);u=u?(u+"").toLowerCase():"text";let m=Wye([n,a&&a.toAbortSignal()],o),h;const f=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(l&&Xye&&i!=="get"&&i!=="head"&&(g=await Zye(c,r))!==0){let S=new Request(e,{method:"POST",body:r,duplex:"half"}),w;if(Ie.isFormData(r)&&(w=S.headers.get("content-type"))&&c.setContentType(w),S.body){const[U,T]=HV(g,YS(zV(l)));r=qV(S.body,YV,U,T)}}Ie.isString(d)||(d=d?"include":"omit");const v="credentials"in Request.prototype;h=new Request(e,{...p,signal:m,method:i.toUpperCase(),headers:c.normalize().toJSON(),body:r,duplex:"half",credentials:v?d:void 0});let y=await fetch(h);const I=H1&&(u==="stream"||u==="response");if(H1&&(s||I&&f)){const S={};["status","statusText","headers"].forEach(D=>{S[D]=y[D]});const w=Ie.toFiniteNumber(y.headers.get("content-length")),[U,T]=s&&HV(w,YS(zV(s),!0))||[];y=new Response(qV(y.body,YV,U,()=>{T&&T(),f&&f()}),S)}u=u||"text";let b=await KS[Ie.findKey(KS,u)||"text"](y,t);return!I&&f&&f(),await new Promise((S,w)=>{Z7(S,w,{data:b,headers:Wo.from(y.headers),status:y.status,statusText:y.statusText,config:t,request:h})})}catch(v){throw f&&f(),v&&v.name==="TypeError"&&/fetch/i.test(v.message)?Object.assign(new ti("Network Error",ti.ERR_NETWORK,t,h),{cause:v.cause||v}):ti.from(v,v&&v.code,t,h)}}),z1={http:fye,xhr:zye,fetch:ebe};Ie.forEach(z1,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const KV=t=>`- ${t}`,tbe=t=>Ie.isFunction(t)||t===null||t===!1,nK={getAdapter:t=>{t=Ie.isArray(t)?t:[t];const{length:e}=t;let i,r;const n={};for(let a=0;a<e;a++){i=t[a];let o;if(r=i,!tbe(i)&&(r=z1[(o=String(i)).toLowerCase()],r===void 0))throw new ti(`Unknown adapter '${o}'`);if(r)break;n[o||"#"+a]=r}if(!r){const a=Object.entries(n).map(([s,l])=>`adapter ${s} `+(l===!1?"is not supported by the environment":"is not available in the build"));let o=e?a.length>1?`since :
`+a.map(KV).join(`
`):" "+KV(a[0]):"as no adapter specified";throw new ti("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return r},adapters:z1};function AE(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new av(null,t)}function JV(t){return AE(t),t.headers=Wo.from(t.headers),t.data=NE.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),nK.getAdapter(t.adapter||Wb.adapter)(t).then(function(r){return AE(t),r.data=NE.call(t,t.transformResponse,r),r.headers=Wo.from(r.headers),r},function(r){return Q7(r)||(AE(t),r&&r.response&&(r.response.data=NE.call(t,t.transformResponse,r.response),r.response.headers=Wo.from(r.response.headers))),Promise.reject(r)})}const aK="1.7.7",Ox={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Ox[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const XV={};Ox.transitional=function(e,i,r){function n(a,o){return"[Axios v"+aK+"] Transitional option '"+a+"'"+o+(r?". "+r:"")}return(a,o,s)=>{if(e===!1)throw new ti(n(o," has been removed"+(i?" in "+i:"")),ti.ERR_DEPRECATED);return i&&!XV[o]&&(XV[o]=!0,console.warn(n(o," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(a,o,s):!0}};function ibe(t,e,i){if(typeof t!="object")throw new ti("options must be an object",ti.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let n=r.length;for(;n-- >0;){const a=r[n],o=e[a];if(o){const s=t[a],l=s===void 0||o(s,a,t);if(l!==!0)throw new ti("option "+a+" must be "+l,ti.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new ti("Unknown option "+a,ti.ERR_BAD_OPTION)}}const W1={assertOptions:ibe,validators:Ox},cd=W1.validators;class lm{constructor(e){this.defaults=e,this.interceptors={request:new jV,response:new jV}}async request(e,i){try{return await this._request(e,i)}catch(r){if(r instanceof Error){let n;Error.captureStackTrace?Error.captureStackTrace(n={}):n=new Error;const a=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=Am(this.defaults,i);const{transitional:r,paramsSerializer:n,headers:a}=i;r!==void 0&&W1.assertOptions(r,{silentJSONParsing:cd.transitional(cd.boolean),forcedJSONParsing:cd.transitional(cd.boolean),clarifyTimeoutError:cd.transitional(cd.boolean)},!1),n!=null&&(Ie.isFunction(n)?i.paramsSerializer={serialize:n}:W1.assertOptions(n,{encode:cd.function,serialize:cd.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let o=a&&Ie.merge(a.common,a[i.method]);a&&Ie.forEach(["delete","get","head","post","put","patch","common"],h=>{delete a[h]}),i.headers=Wo.concat(o,a);const s=[];let l=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(i)===!1||(l=l&&f.synchronous,s.unshift(f.fulfilled,f.rejected))});const u=[];this.interceptors.response.forEach(function(f){u.push(f.fulfilled,f.rejected)});let c,d=0,p;if(!l){const h=[JV.bind(this),void 0];for(h.unshift.apply(h,s),h.push.apply(h,u),p=h.length,c=Promise.resolve(i);d<p;)c=c.then(h[d++],h[d++]);return c}p=s.length;let m=i;for(d=0;d<p;){const h=s[d++],f=s[d++];try{m=h(m)}catch(g){f.call(this,g);break}}try{c=JV.call(this,m)}catch(h){return Promise.reject(h)}for(d=0,p=u.length;d<p;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=Am(this.defaults,e);const i=eK(e.baseURL,e.url);return K7(i,e.params,e.paramsSerializer)}}Ie.forEach(["delete","get","head","options"],function(e){lm.prototype[e]=function(i,r){return this.request(Am(r||{},{method:e,url:i,data:(r||{}).data}))}});Ie.forEach(["post","put","patch"],function(e){function i(r){return function(a,o,s){return this.request(Am(s||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}lm.prototype[e]=i(),lm.prototype[e+"Form"]=i(!0)});class kx{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const r=this;this.promise.then(n=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](n);r._listeners=null}),this.promise.then=n=>{let a;const o=new Promise(s=>{r.subscribe(s),a=s}).then(n);return o.cancel=function(){r.unsubscribe(a)},o},e(function(a,o,s){r.reason||(r.reason=new av(a,o,s),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=r=>{e.abort(r)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new kx(function(n){e=n}),cancel:e}}}function rbe(t){return function(i){return t.apply(null,i)}}function nbe(t){return Ie.isObject(t)&&t.isAxiosError===!0}const q1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(q1).forEach(([t,e])=>{q1[e]=t});function oK(t){const e=new lm(t),i=L7(lm.prototype.request,e);return Ie.extend(i,lm.prototype,e,{allOwnKeys:!0}),Ie.extend(i,e,null,{allOwnKeys:!0}),i.create=function(n){return oK(Am(t,n))},i}const Mn=oK(Wb);Mn.Axios=lm;Mn.CanceledError=av;Mn.CancelToken=kx;Mn.isCancel=Q7;Mn.VERSION=aK;Mn.toFormData=ZD;Mn.AxiosError=ti;Mn.Cancel=Mn.CanceledError;Mn.all=function(e){return Promise.all(e)};Mn.spread=rbe;Mn.isAxiosError=nbe;Mn.mergeConfig=Am;Mn.AxiosHeaders=Wo;Mn.formToJSON=t=>X7(Ie.isHTMLForm(t)?new FormData(t):t);Mn.getAdapter=nK.getAdapter;Mn.HttpStatusCode=q1;Mn.default=Mn;const sK=CIe();window.location.host.includes("localhost")||window.location.hostname;var nG;const abe=((nG=window.dev)==null?void 0:nG.baseURL)||"http://localhost:3123",qb=Mn.create({baseURL:abe});qb.interceptors.request.use(t=>{const e=localStorage.getItem(sK);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));qb.interceptors.response.use(t=>t,t=>{var e;if(t.message==="Network Error"&&console.log("network error"),t.response){((e=t.response)==null?void 0:e.status)===401&&lK();const i=t.response.data.message||t.response.data.error||t.response.data;console.log({message:i})}});const obe=()=>{const t=localStorage.getItem(sK);qb.defaults.headers.common.Authorization=`Bearer ${t}`},lK=()=>{qb.defaults.headers.common.Authorization=void 0},ov={...qb,addAuthorization:obe,removeAuthorization:lK},xx="Missing tournamentId";async function uK(t){if(!(t!=null&&t.tournamentId))throw new Error(xx);return await ov.post("/factory/tournamentinfo",t)}async function Y1({providerAbbr:t}){if(!t)throw new Error("missing provicerAbbr");return await ov.post("/provider/calendar",{providerAbbr:t})}async function cK(t){if(!(t!=null&&t.tournamentId))throw new Error(xx);if(!(t!=null&&t.eventId))throw new Error("missing eventId");return await ov.post("/factory/eventdata",t)}async function sbe(t){if(!(t!=null&&t.tournamentId))throw new Error(xx);return Object.assign(t,{courtCompletedMatchUps:!0,withCourtGridRows:!0,usePublishState:!0,minCourtGridRows:10,nextMatchUps:!0}),await ov.post("/factory/scheduledmatchUps",{params:t})}async function lbe(){return await ov.get("/factory/version")}function iI(t){return`tournament_${t.toLowerCase()}`}function Fx(t){return`tab_tournament_${t.toLowerCase()}`}const Om={},K1=["Info","Events","Schedule","Matches","Players","Stats"];function J1(t){t==="Schedule"&&sbe({tournamentId:Om.tournamentId,hydrateParticipants:!1}).then(i=>{EIe({data:i==null?void 0:i.data})}),Om.tab=t,K1.forEach(e=>{const i=document.getElementById(iI(e));i.style.display=e===t?"block":"none"})}function OE(t){const e=document.getElementById(Fx(t));e.style.display="block"}function kE(t){const e=document.getElementById(Fx(t));e.style.display=Hs}const ube=()=>{const t=document.createElement("div");t.className="container";const e=document.createElement("section");e.className="hero";const i=document.createElement("div");i.className="hero-body",i.id="tournament-hero";const r=document.createElement("div");r.className="columns";const n=document.createElement("div");n.className="column is-one-quarter has-text-centered",n.id=sG,r.appendChild(n);const a=document.createElement("div");a.className="column has-text-centered",a.id=aG,r.appendChild(a),i.appendChild(r),e.appendChild(i),t.appendChild(e);const o=document.createElement("div"),s=document.createElement("div");t.appendChild(o),t.appendChild(s),K1.forEach(u=>{const c=document.createElement("section");c.className="section is-fluid is-centered",c.style.display="none",c.style.width="100%",c.id=iI(u),s.appendChild(c)}),o.className="tabs is-centered";const l=document.createElement("ul");return K1.forEach(u=>{const c=document.createElement("li");c.id=Fx(u),c.style.display="none",c.className="menu";const d=document.createElement("a");d.textContent=u,d.onclick=()=>J1(u),c.appendChild(d),l.appendChild(c)}),o.appendChild(l),t};function cbe(){const t=document.createElement("div");t.className="main noselect";const e=document.createElement("nav");e.className="navbar";const i=document.createElement("div");i.className="navbar-brand";const r=document.createElement("div");r.onclick=()=>window.history.back(),r.className="navbar-item",r.innerHTML="<<",r.id="back",i.appendChild(r),e.appendChild(i),t.appendChild(e);const n=document.createElement("div");n.style.display="none",n.id=Ey;const a=document.createElement("div");a.style.display="none",a.id=oN;const o=document.createElement("div");o.className="controlBar flexcol flexgrow flexcenter",o.id=oG,a.appendChild(o);const s=document.createElement("div");s.className="flexcol flexgrow flexcenter box",s.id=dC,a.appendChild(s);const l=document.createElement("div");return l.style.backgroundColor="white",l.style.display="none",l.id=L0,l.appendChild(ube()),t.appendChild(a),t.appendChild(l),t.appendChild(n),t}function dbe(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML)){const i=e;i.style.fontWeight="bold",i.style.color="#ed0c76"}}function pbe(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML)){const i=e;i.style.fontWeight="",i.style.color=""}}const QV=function(){let t,e={elapsed:1e5,held:void 0,touched:void 0,holdTime:800,holdAction:void 0,holdActions:{}};const i={};let r={};const n=(d,p)=>d.filter(m=>p.indexOf(m)!==-1).filter((m,h,f)=>f.indexOf(m)===h);e.reset=()=>(r={},e),e.register=(d,p,m,h)=>(typeof m=="function"&&(r[p]||(r[p]={},i[p]=[]),r[p][d]={fx:m,delay:h},i[p]=Object.keys(r[p])),e),e.deRegister=(d,p)=>(r[p]&&(delete r[p][d],i[p]=Object.keys(r[p])),e),e.call=(d,p,...m)=>{var h,f;return(f=(h=r==null?void 0:r[p])==null?void 0:h[d])==null?void 0:f.fx(...m)},e.trigger=(d,p,m,h)=>r[p][d].fx(m,h,p),e.list=()=>console.log(r);const a="ontouchstart"in document.documentElement?"touchstart":"click";document.addEventListener(a,d=>s({evt:d,evnt:"tap"})),document.addEventListener("change",d=>s({evt:d,evnt:"change"})),document.addEventListener("click",d=>s({evt:d,evnt:"click"})),document.addEventListener("mouseover",d=>s({evt:d,evnt:"mouseover",stopPropagation:!1})),document.addEventListener("mouseout",d=>s({evt:d,evnt:"mouseout",stopPropagation:!1})),document.addEventListener("keyup",d=>s({evt:d,evnt:"keyup",stopPropagation:!1}));let o=0;function s({evt:d,evnt:p,stopPropagation:m=!0}){m&&d.stopPropagation();const h={x:d.clientX,y:d.clientY,pageX:d.pageX,pageY:d.pageY};let f=Array.from(d.target.classList),g=f.length&&i[p]?n(f,i[p]):[];if(g.length){let v=new Date().getTime();e.elapsed=v-o,o=v,g.forEach(y=>{l({cls:y,evt:d,evnt:p,mouse:h})})}}function l({cls:d,evt:p,evnt:m,mouse:h}){let f=p.target;r[m][d].fx(f,h,m,p)}document.addEventListener("touchstart",d=>{e.touched=d.target,e.coords=[d.touches[0].clientX,d.touches[0].clientY],e.touched&&(t=setTimeout(function(){c()},e.holdTime))},!1),document.addEventListener("touchend",function(){u()},!1),document.addEventListener("touchmove",function(d){e.touched!==d.target&&u()},!1);function u(){clearTimeout(t)}function c(){typeof e.holdAction=="function"&&(e.held=e.touched,e.holdAction(e.held,e.coords))}return function(){let d=!1,p,m="";function h(){clearTimeout(p),d=!0,m!=="can-touch"&&(m="can-touch",document.documentElement.classList.add(m)),p=setTimeout(function(){d=!1},500)}function f(){!d&&m==="can-touch"&&(d=!1,m="",document.documentElement.classList.remove("can-touch"))}document.addEventListener("touchstart",h,!1),document.addEventListener("mouseover",f,!1)}(),e}();function WU(t){cne.forEach(e=>{const i=document.querySelector(`#${e}`);i&&(i.style.display=e===t?"block":"none")})}function mbe(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=i=>r=>i(r).then(n=>console.log(n.data),n=>console.log(n));hbe({...{getServerFactoryVersion:i=>t(lbe)(i),getProviderCalendar:i=>t(Y1)(i),getTournamentInfo:i=>t(uK)(i),getEventData:i=>t(cK(i))},baseApi:ov,context:Om})}function hbe(t){if(typeof(window==null?void 0:window.dev)=="object")try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch{console.log("production environment")}}function fbe(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.onunhandledrejection=t=>{t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?console.warn("popup blocked"):console.warn("Unhandled rejection:",e&&(e.stack||e))}}const gbe="@VERSION@",xE=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function FE(t,e,i,r){t.addEventListener?t.addEventListener(e,i,r):t.attachEvent&&t.attachEvent("on".concat(e),i)}function jv(t,e,i,r){t.removeEventListener?t.removeEventListener(e,i,r):t.detachEvent&&t.detachEvent("on".concat(e),i)}function dK(t,e){const i=e.slice(0,e.length-1);for(let r=0;r<i.length;r++)i[r]=t[i[r].toLowerCase()];return i}function pK(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function vbe(t,e){const i=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let n=!0;for(let a=0;a<i.length;a++)r.indexOf(i[a])===-1&&(n=!1);return n}const KI={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":xE?173:189,"=":xE?61:187,";":xE?59:186,"'":222,"[":219,"]":221,"\\":220},Nu={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},X1={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},pa={16:!1,18:!1,17:!1,91:!1},Xr={};for(let t=1;t<20;t++)KI["f".concat(t)]=111+t;let Sr=[],rI=null,mK="all";const pc=new Map,Yb=t=>KI[t.toLowerCase()]||Nu[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),Ibe=t=>Object.keys(KI).find(e=>KI[e]===t),ybe=t=>Object.keys(Nu).find(e=>Nu[e]===t);function hK(t){mK=t||"all"}function JI(){return mK||"all"}function bbe(){return Sr.slice(0)}function wbe(){return Sr.map(t=>Ibe(t)||ybe(t)||String.fromCharCode(t))}function Ube(){const t=[];return Object.keys(Xr).forEach(e=>{Xr[e].forEach(i=>{let{key:r,scope:n,mods:a,shortcut:o}=i;t.push({scope:n,shortcut:o,mods:a,keys:r.split("+").map(s=>Yb(s))})})}),t}function Sbe(t){const e=t.target||t.srcElement,{tagName:i}=e;let r=!0;const n=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(n||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(r=!1),r}function Tbe(t){return typeof t=="string"&&(t=Yb(t)),Sr.indexOf(t)!==-1}function Dbe(t,e){let i,r;t||(t=JI());for(const n in Xr)if(Object.prototype.hasOwnProperty.call(Xr,n))for(i=Xr[n],r=0;r<i.length;)i[r].scope===t?i.splice(r,1).forEach(o=>{let{element:s}=o;return Lx(s)}):r++;JI()===t&&hK(e||"all")}function Pbe(t){let e=t.keyCode||t.which||t.charCode;const i=Sr.indexOf(e);if(i>=0&&Sr.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&Sr.splice(0,Sr.length),(e===93||e===224)&&(e=91),e in pa){pa[e]=!1;for(const r in Nu)Nu[r]===e&&(du[r]=!1)}}function fK(t){if(typeof t>"u")Object.keys(Xr).forEach(n=>{Array.isArray(Xr[n])&&Xr[n].forEach(a=>IU(a)),delete Xr[n]}),Lx(null);else if(Array.isArray(t))t.forEach(n=>{n.key&&IU(n)});else if(typeof t=="object")t.key&&IU(t);else if(typeof t=="string"){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];let[n,a]=i;typeof n=="function"&&(a=n,n=""),IU({key:t,scope:n,method:a,splitKey:"+"})}}const IU=t=>{let{key:e,scope:i,method:r,splitKey:n="+"}=t;pK(e).forEach(o=>{const s=o.split(n),l=s.length,u=s[l-1],c=u==="*"?"*":Yb(u);if(!Xr[c])return;i||(i=JI());const d=l>1?dK(Nu,s):[],p=[];Xr[c]=Xr[c].filter(m=>{const f=(r?m.method===r:!0)&&m.scope===i&&vbe(m.mods,d);return f&&p.push(m.element),!f}),p.forEach(m=>Lx(m))})};function ZV(t,e,i,r){if(e.element!==r)return;let n;if(e.scope===i||e.scope==="all"){n=e.mods.length>0;for(const a in pa)Object.prototype.hasOwnProperty.call(pa,a)&&(!pa[a]&&e.mods.indexOf(+a)>-1||pa[a]&&e.mods.indexOf(+a)===-1)&&(n=!1);(e.mods.length===0&&!pa[16]&&!pa[18]&&!pa[17]&&!pa[91]||n||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Sr),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function e2(t,e){const i=Xr["*"];let r=t.keyCode||t.which||t.charCode;if(!du.filter.call(this,t))return;if((r===93||r===224)&&(r=91),Sr.indexOf(r)===-1&&r!==229&&Sr.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(s=>{const l=X1[s];t[s]&&Sr.indexOf(l)===-1?Sr.push(l):!t[s]&&Sr.indexOf(l)>-1?Sr.splice(Sr.indexOf(l),1):s==="metaKey"&&t[s]&&Sr.length===3&&(t.ctrlKey||t.shiftKey||t.altKey||(Sr=Sr.slice(Sr.indexOf(l))))}),r in pa){pa[r]=!0;for(const s in Nu)Nu[s]===r&&(du[s]=!0);if(!i)return}for(const s in pa)Object.prototype.hasOwnProperty.call(pa,s)&&(pa[s]=t[X1[s]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Sr.indexOf(17)===-1&&Sr.push(17),Sr.indexOf(18)===-1&&Sr.push(18),pa[17]=!0,pa[18]=!0);const n=JI();if(i)for(let s=0;s<i.length;s++)i[s].scope===n&&(t.type==="keydown"&&i[s].keydown||t.type==="keyup"&&i[s].keyup)&&ZV(t,i[s],n,e);if(!(r in Xr))return;const a=Xr[r],o=a.length;for(let s=0;s<o;s++)if((t.type==="keydown"&&a[s].keydown||t.type==="keyup"&&a[s].keyup)&&a[s].key){const l=a[s],{splitKey:u}=l,c=l.key.split(u),d=[];for(let p=0;p<c.length;p++)d.push(Yb(c[p]));d.sort().join("")===Sr.sort().join("")&&ZV(t,l,n,e)}}function du(t,e,i){Sr=[];const r=pK(t);let n=[],a="all",o=document,s=0,l=!1,u=!0,c="+",d=!1,p=!1;for(i===void 0&&typeof e=="function"&&(i=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(a=e.scope),e.element&&(o=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(u=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(c=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(a=e),p&&fK(t,a);s<r.length;s++)t=r[s].split(c),n=[],t.length>1&&(n=dK(Nu,t)),t=t[t.length-1],t=t==="*"?"*":Yb(t),t in Xr||(Xr[t]=[]),Xr[t].push({keyup:l,keydown:u,scope:a,mods:n,shortcut:r[s],method:i,key:r[s],splitKey:c,element:o});if(typeof o<"u"&&window){if(!pc.has(o)){const m=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return e2(f,o)},h=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;e2(f,o),Pbe(f)};pc.set(o,{keydownListener:m,keyupListenr:h,capture:d}),FE(o,"keydown",m,d),FE(o,"keyup",h,d)}if(!rI){const m=()=>{Sr=[]};rI={listener:m,capture:d},FE(window,"focus",m,d)}}}function Rbe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(Xr).forEach(i=>{Xr[i].filter(n=>n.scope===e&&n.shortcut===t).forEach(n=>{n&&n.method&&n.method()})})}function Lx(t){const e=Object.values(Xr).flat();if(e.findIndex(r=>{let{element:n}=r;return n===t})<0){const{keydownListener:r,keyupListenr:n,capture:a}=pc.get(t)||{};r&&n&&(jv(t,"keyup",n,a),jv(t,"keydown",r,a),pc.delete(t))}if((e.length<=0||pc.size<=0)&&(Object.keys(pc).forEach(n=>{const{keydownListener:a,keyupListenr:o,capture:s}=pc.get(n)||{};a&&o&&(jv(n,"keyup",o,s),jv(n,"keydown",a,s),pc.delete(n))}),pc.clear(),Object.keys(Xr).forEach(n=>delete Xr[n]),rI)){const{listener:n,capture:a}=rI;jv(window,"focus",n,a),rI=null}}const LE={getPressedKeyString:wbe,setScope:hK,getScope:JI,deleteScope:Dbe,getPressedKeyCodes:bbe,getAllKeyCodes:Ube,isPressed:Tbe,filter:Sbe,trigger:Rbe,unbind:fK,keyMap:KI,modifier:Nu,modifierMap:X1};for(const t in LE)Object.prototype.hasOwnProperty.call(LE,t)&&(du[t]=LE[t]);if(typeof window<"u"){const t=window.hotkeys;du.noConflict=e=>(e&&window.hotkeys===du&&(window.hotkeys=t),du),window.hotkeys=du}const yU=[];function Ebe(){console.log(`%cversion: ${gbe}`,"color: lightblue"),du("shift+1,shift+3,esc,/",(t,e)=>{t.preventDefault();const r=du.shift?e.key.split(e.splitKey)[1]:e.key;r==="/"&&yU.splice(0,yU.length),yU.push(r),yU.join("")==="esc13"&&mbe()}),WU(Ey),fbe(),QV.register("tmx-tm","mouseover",dbe),QV.register("tmx-tm","mouseout",pbe)}const Cbe=t=>{let e;const i=Array.isArray(t)?t:[t];return r=>{if(e&&i.forEach(n=>n.removeFilter(e)),r){const n=r==null?void 0:r.toLowerCase();e=a=>{var o;return(o=a.searchText)==null?void 0:o.includes(n)},i.forEach(a=>a.addFilter(e))}else e=void 0}},gK=t=>(e,i)=>{const r=e.getDefinition();return t.includes(r.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"};function Mbe(t,e,i,r){const n=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${n})</span>`}function Nbe(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}var t2,ar="colors",io="sizes",nt="space",Abe={gap:nt,gridGap:nt,columnGap:nt,gridColumnGap:nt,rowGap:nt,gridRowGap:nt,inset:nt,insetBlock:nt,insetBlockEnd:nt,insetBlockStart:nt,insetInline:nt,insetInlineEnd:nt,insetInlineStart:nt,margin:nt,marginTop:nt,marginRight:nt,marginBottom:nt,marginLeft:nt,marginBlock:nt,marginBlockEnd:nt,marginBlockStart:nt,marginInline:nt,marginInlineEnd:nt,marginInlineStart:nt,padding:nt,paddingTop:nt,paddingRight:nt,paddingBottom:nt,paddingLeft:nt,paddingBlock:nt,paddingBlockEnd:nt,paddingBlockStart:nt,paddingInline:nt,paddingInlineEnd:nt,paddingInlineStart:nt,top:nt,right:nt,bottom:nt,left:nt,scrollMargin:nt,scrollMarginTop:nt,scrollMarginRight:nt,scrollMarginBottom:nt,scrollMarginLeft:nt,scrollMarginX:nt,scrollMarginY:nt,scrollMarginBlock:nt,scrollMarginBlockEnd:nt,scrollMarginBlockStart:nt,scrollMarginInline:nt,scrollMarginInlineEnd:nt,scrollMarginInlineStart:nt,scrollPadding:nt,scrollPaddingTop:nt,scrollPaddingRight:nt,scrollPaddingBottom:nt,scrollPaddingLeft:nt,scrollPaddingX:nt,scrollPaddingY:nt,scrollPaddingBlock:nt,scrollPaddingBlockEnd:nt,scrollPaddingBlockStart:nt,scrollPaddingInline:nt,scrollPaddingInlineEnd:nt,scrollPaddingInlineStart:nt,fontSize:"fontSizes",background:ar,backgroundColor:ar,backgroundImage:ar,borderImage:ar,border:ar,borderBlock:ar,borderBlockEnd:ar,borderBlockStart:ar,borderBottom:ar,borderBottomColor:ar,borderColor:ar,borderInline:ar,borderInlineEnd:ar,borderInlineStart:ar,borderLeft:ar,borderLeftColor:ar,borderRight:ar,borderRightColor:ar,borderTop:ar,borderTopColor:ar,caretColor:ar,color:ar,columnRuleColor:ar,fill:ar,outline:ar,outlineColor:ar,stroke:ar,textDecorationColor:ar,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:io,minBlockSize:io,maxBlockSize:io,inlineSize:io,minInlineSize:io,maxInlineSize:io,width:io,minWidth:io,maxWidth:io,height:io,minHeight:io,maxHeight:io,flexBasis:io,gridTemplateColumns:io,gridTemplateRows:io,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},Obe=(t,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,Kb=()=>{const t=Object.create(null);return(e,i,...r)=>{const n=(a=>JSON.stringify(a,Obe))(e);return n in t?t[n]:t[n]=i(e,...r)}},qU=Symbol.for("sxs.internal"),_x=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),i2=t=>{for(const e in t)return!0;return!1},{hasOwnProperty:kbe}=Object.prototype,Q1=t=>t.includes("-")?t:t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),xbe=/\s+(?![^()]*\))/,ef=t=>e=>t(...typeof e=="string"?String(e).split(xbe):[e]),r2={appearance:t=>({WebkitAppearance:t,appearance:t}),backfaceVisibility:t=>({WebkitBackfaceVisibility:t,backfaceVisibility:t}),backdropFilter:t=>({WebkitBackdropFilter:t,backdropFilter:t}),backgroundClip:t=>({WebkitBackgroundClip:t,backgroundClip:t}),boxDecorationBreak:t=>({WebkitBoxDecorationBreak:t,boxDecorationBreak:t}),clipPath:t=>({WebkitClipPath:t,clipPath:t}),content:t=>({content:t.includes('"')||t.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(t)?t:`"${t}"`}),hyphens:t=>({WebkitHyphens:t,hyphens:t}),maskImage:t=>({WebkitMaskImage:t,maskImage:t}),maskSize:t=>({WebkitMaskSize:t,maskSize:t}),tabSize:t=>({MozTabSize:t,tabSize:t}),textSizeAdjust:t=>({WebkitTextSizeAdjust:t,textSizeAdjust:t}),userSelect:t=>({WebkitUserSelect:t,userSelect:t}),marginBlock:ef((t,e)=>({marginBlockStart:t,marginBlockEnd:e||t})),marginInline:ef((t,e)=>({marginInlineStart:t,marginInlineEnd:e||t})),maxSize:ef((t,e)=>({maxBlockSize:t,maxInlineSize:e||t})),minSize:ef((t,e)=>({minBlockSize:t,minInlineSize:e||t})),paddingBlock:ef((t,e)=>({paddingBlockStart:t,paddingBlockEnd:e||t})),paddingInline:ef((t,e)=>({paddingInlineStart:t,paddingInlineEnd:e||t}))},_E=/([\d.]+)([^]*)/,Fbe=(t,e)=>t.length?t.reduce((i,r)=>(i.push(...e.map(n=>n.includes("&")?n.replace(/&/g,/[ +>|~]/.test(r)&&/&.*&/.test(n)?`:is(${r})`:r):r+" "+n)),i),[]):e,Lbe=(t,e)=>t in _be&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(i,r,n,a)=>r+(n==="stretch"?`-moz-available${a};${Q1(t)}:${r}-webkit-fill-available`:`-moz-fit-content${a};${Q1(t)}:${r}fit-content`)+a):String(e),_be={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},Nc=t=>t?t+"-":"",vK=(t,e,i)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(r,n,a,o,s)=>o=="$"==!!a?r:(n||o=="--"?"calc(":"")+"var(--"+(o==="$"?Nc(e)+(s.includes("$")?"":Nc(i))+s.replace(/\$/g,"-"):s)+")"+(n||o=="--"?"*"+(n||"")+(a||"1")+")":"")),$be=/\s*,\s*(?![^()]*\))/,Bbe=Object.prototype.toString,mf=(t,e,i,r,n)=>{let a,o,s;const l=(u,c,d)=>{let p,m;const h=f=>{for(p in f){const y=p.charCodeAt(0)===64,I=y&&Array.isArray(f[p])?f[p]:[f[p]];for(m of I){const b=/[A-Z]/.test(v=p)?v:v.replace(/-[^]/g,w=>w[1].toUpperCase()),S=typeof m=="object"&&m&&m.toString===Bbe&&(!r.utils[b]||!c.length);if(b in r.utils&&!S){const w=r.utils[b];if(w!==o){o=w,h(w(m)),o=null;continue}}else if(b in r2){const w=r2[b];if(w!==s){s=w,h(w(m)),s=null;continue}}if(y&&(g=p.slice(1)in r.media?"@media "+r.media[p.slice(1)]:p,p=g.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(w,U,T,D,P,E)=>{const R=_E.test(U),N=.0625*(R?-1:1),[A,M]=R?[D,U]:[U,D];return"("+(T[0]==="="?"":T[0]===">"===R?"max-":"min-")+A+":"+(T[0]!=="="&&T.length===1?M.replace(_E,(C,O,k)=>Number(O)+N*(T===">"?1:-1)+k):M)+(P?") and ("+(P[0]===">"?"min-":"max-")+A+":"+(P.length===1?E.replace(_E,(C,O,k)=>Number(O)+N*(P===">"?-1:1)+k):E):"")+")"})),S){const w=y?d.concat(p):[...d],U=y?[...c]:Fbe(c,p.split($be));a!==void 0&&n(n2(...a)),a=void 0,l(m,U,w)}else a===void 0&&(a=[[],c,d]),p=y||p.charCodeAt(0)!==36?p:`--${Nc(r.prefix)}${p.slice(1).replace(/\$/g,"-")}`,m=S?m:typeof m=="number"?m&&b in Vbe?String(m)+"px":String(m):vK(Lbe(b,m??""),r.prefix,r.themeMap[b]),a[0].push(`${y?`${p} `:`${Q1(p)}:`}${m}`)}}var g,v};h(u),a!==void 0&&n(n2(...a)),a=void 0};l(t,e,i)},n2=(t,e,i)=>`${i.map(r=>`${r}{`).join("")}${e.length?`${e.join(",")}{`:""}${t.join(";")}${e.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,Vbe={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},a2=t=>String.fromCharCode(t+(t>25?39:97)),um=t=>(e=>{let i,r="";for(i=Math.abs(e);i>52;i=i/52|0)r=a2(i%52)+r;return a2(i%52)+r})(((e,i)=>{let r=i.length;for(;r;)e=33*e^i.charCodeAt(--r);return e})(5381,JSON.stringify(t))>>>0),Wv=["themed","global","styled","onevar","resonevar","allvar","inline"],jbe=t=>{if(t.href&&!t.href.startsWith(location.origin))return!1;try{return!!t.cssRules}catch{return!1}},Gbe=t=>{let e;const i=()=>{const{cssRules:n}=e.sheet;return[].map.call(n,(a,o)=>{const{cssText:s}=a;let l="";if(s.startsWith("--sxs"))return"";if(n[o-1]&&(l=n[o-1].cssText).startsWith("--sxs")){if(!a.cssRules.length)return"";for(const u in e.rules)if(e.rules[u].group===a)return`--sxs{--sxs:${[...e.rules[u].cache].join(" ")}}${s}`;return a.cssRules.length?`${l}${s}`:""}return s}).join("")},r=()=>{if(e){const{rules:s,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const u in s)delete s[u]}const n=Object(t).styleSheets||[];for(const s of n)if(jbe(s)){for(let l=0,u=s.cssRules;u[l];++l){const c=Object(u[l]);if(c.type!==1)continue;const d=Object(u[l+1]);if(d.type!==4)continue;++l;const{cssText:p}=c;if(!p.startsWith("--sxs"))continue;const m=p.slice(14,-3).trim().split(/\s+/),h=Wv[m[0]];h&&(e||(e={sheet:s,reset:r,rules:{},toString:i}),e.rules[h]={group:d,index:l,cache:new Set(m)})}if(e)break}if(!e){const s=(l,u)=>({type:u,cssRules:[],insertRule(c,d){this.cssRules.splice(d,0,s(c,{import:3,undefined:1}[(c.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,c=>c.cssText).join("")}}`:l}});e={sheet:t?(t.head||t).appendChild(document.createElement("style")).sheet:s("","text/css"),rules:{},reset:r,toString:i}}const{sheet:a,rules:o}=e;for(let s=Wv.length-1;s>=0;--s){const l=Wv[s];if(!o[l]){const u=Wv[s+1],c=o[u]?o[u].index:a.cssRules.length;a.insertRule("@media{}",c),a.insertRule(`--sxs{--sxs:${s}}`,c),o[l]={group:a.cssRules[c+1],index:c,cache:new Set([s])}}Hbe(o[l])}};return r(),e},Hbe=t=>{const e=t.group;let i=e.cssRules.length;t.apply=r=>{try{e.insertRule(r,i),++i}catch{}}},Gv=Symbol(),zbe=Kb(),Wbe=(t,e)=>zbe(t,()=>(...i)=>{let r={type:null,composers:new Set};for(const n of i)if(n!=null)if(n[qU]){r.type==null&&(r.type=n[qU].type);for(const a of n[qU].composers)r.composers.add(a)}else n.constructor!==Object||n.$$typeof?r.type==null&&(r.type=n):r.composers.add(qbe(n,t));return r.type==null&&(r.type="span"),r.composers.size||r.composers.add(["PJLV",{},[],[],{},[]]),Ybe(t,r,e)}),qbe=({variants:t,compoundVariants:e,defaultVariants:i,...r},n)=>{const a=`${Nc(n.prefix)}c-${um(r)}`,o=[],s=[],l=Object.create(null),u=[];for(const p in i)l[p]=String(i[p]);if(typeof t=="object"&&t)for(const p in t){c=l,d=p,kbe.call(c,d)||(l[p]="undefined");const m=t[p];for(const h in m){const f={[p]:String(h)};String(h)==="undefined"&&u.push(p);const g=m[h],v=[f,g,!i2(g)];o.push(v)}}var c,d;if(typeof e=="object"&&e)for(const p of e){let{css:m,...h}=p;m=typeof m=="object"&&m||{};for(const g in h)h[g]=String(h[g]);const f=[h,m,!i2(m)];s.push(f)}return[a,r,o,s,l,u]},Ybe=(t,e,i)=>{const[r,n,a,o]=Kbe(e.composers),s=typeof e.type=="function"||e.type.$$typeof?(d=>{function p(){for(let m=0;m<p[Gv].length;m++){const[h,f]=p[Gv][m];d.rules[h].apply(f)}return p[Gv]=[],null}return p[Gv]=[],p.rules={},Wv.forEach(m=>p.rules[m]={apply:h=>p[Gv].push([m,h])}),p})(i):null,l=(s||i).rules,u=`.${r}${n.length>1?`:where(.${n.slice(1).join(".")})`:""}`,c=d=>{d=typeof d=="object"&&d||Jbe;const{css:p,...m}=d,h={};for(const v in a)if(delete m[v],v in d){let y=d[v];typeof y=="object"&&y?h[v]={"@initial":a[v],...y}:(y=String(y),h[v]=y!=="undefined"||o.has(v)?y:a[v])}else h[v]=a[v];const f=new Set([...n]);for(const[v,y,I,b]of e.composers){i.rules.styled.cache.has(v)||(i.rules.styled.cache.add(v),mf(y,[`.${v}`],[],t,U=>{l.styled.apply(U)}));const S=o2(I,h,t.media),w=o2(b,h,t.media,!0);for(const U of S)if(U!==void 0)for(const[T,D,P]of U){const E=`${v}-${um(D)}-${T}`;f.add(E);const R=(P?i.rules.resonevar:i.rules.onevar).cache,N=P?l.resonevar:l.onevar;R.has(E)||(R.add(E),mf(D,[`.${E}`],[],t,A=>{N.apply(A)}))}for(const U of w)if(U!==void 0)for(const[T,D]of U){const P=`${v}-${um(D)}-${T}`;f.add(P),i.rules.allvar.cache.has(P)||(i.rules.allvar.cache.add(P),mf(D,[`.${P}`],[],t,E=>{l.allvar.apply(E)}))}}if(typeof p=="object"&&p){const v=`${r}-i${um(p)}-css`;f.add(v),i.rules.inline.cache.has(v)||(i.rules.inline.cache.add(v),mf(p,[`.${v}`],[],t,y=>{l.inline.apply(y)}))}for(const v of String(d.className||"").trim().split(/\s+/))v&&f.add(v);const g=m.className=[...f].join(" ");return{type:e.type,className:g,selector:u,props:m,toString:()=>g,deferredInjector:s}};return _x(c,{className:r,selector:u,[qU]:e,toString:()=>(i.rules.styled.cache.has(r)||c(),r)})},Kbe=t=>{let e="";const i=[],r={},n=[];for(const[a,,,,o,s]of t){e===""&&(e=a),i.push(a),n.push(...s);for(const l in o){const u=o[l];(r[l]===void 0||u!=="undefined"||s.includes(u))&&(r[l]=u)}}return[e,i,r,new Set(n)]},o2=(t,e,i,r)=>{const n=[];e:for(let[a,o,s]of t){if(s)continue;let l,u=0,c=!1;for(l in a){const d=a[l];let p=e[l];if(p!==d){if(typeof p!="object"||!p)continue e;{let m,h,f=0;for(const g in p){if(d===String(p[g])){if(g!=="@initial"){const v=g.slice(1);(h=h||[]).push(v in i?i[v]:g.replace(/^@media ?/,"")),c=!0}u+=f,m=!0}++f}if(h&&h.length&&(o={["@media "+h.join(", ")]:o}),!m)continue e}}}(n[u]=n[u]||[]).push([r?"cv":`${l}-${a[l]}`,o,c])}return n},Jbe={},Xbe=Kb(),Qbe=(t,e)=>Xbe(t,()=>(...i)=>{const r=()=>{for(let n of i){n=typeof n=="object"&&n||{};let a=um(n);if(!e.rules.global.cache.has(a)){if(e.rules.global.cache.add(a),"@import"in n){let o=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let s of[].concat(n["@import"]))s=s.includes('"')||s.includes("'")?s:`"${s}"`,e.sheet.insertRule(`@import ${s};`,o++);delete n["@import"]}mf(n,[],[],t,o=>{e.rules.global.apply(o)})}}return""};return _x(r,{toString:r})}),Zbe=Kb(),ewe=(t,e)=>Zbe(t,()=>i=>{const r=`${Nc(t.prefix)}k-${um(i)}`,n=()=>{if(!e.rules.global.cache.has(r)){e.rules.global.cache.add(r);const a=[];mf(i,[],[],t,s=>a.push(s));const o=`@keyframes ${r}{${a.join("")}}`;e.rules.global.apply(o)}return r};return _x(n,{get name(){return n()},toString:n})}),twe=class{constructor(t,e,i,r){this.token=t==null?"":String(t),this.value=e==null?"":String(e),this.scale=i==null?"":String(i),this.prefix=r==null?"":String(r)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+Nc(this.prefix)+Nc(this.scale)+this.token}toString(){return this.computedValue}},iwe=Kb(),rwe=(t,e)=>iwe(t,()=>(i,r)=>{r=typeof i=="object"&&i||Object(r);const n=`.${i=(i=typeof i=="string"?i:"")||`${Nc(t.prefix)}t-${um(r)}`}`,a={},o=[];for(const l in r){a[l]={};for(const u in r[l]){const c=`--${Nc(t.prefix)}${l}-${u}`,d=vK(String(r[l][u]),t.prefix,l);a[l][u]=new twe(u,d,l,t.prefix),o.push(`${c}:${d}`)}}const s=()=>{if(o.length&&!e.rules.themed.cache.has(i)){e.rules.themed.cache.add(i);const l=`${r===t.theme?":root,":""}.${i}{${o.join(";")}}`;e.rules.themed.apply(l)}return i};return{...a,get className(){return s()},selector:n,toString:s}}),nwe=Kb(),IK=t=>{let e=!1;const i=nwe(t,r=>{e=!0;const n="prefix"in(r=typeof r=="object"&&r||{})?String(r.prefix):"",a=typeof r.media=="object"&&r.media||{},o=typeof r.root=="object"?r.root||null:globalThis.document||null,s=typeof r.theme=="object"&&r.theme||{},l={prefix:n,media:a,theme:s,themeMap:typeof r.themeMap=="object"&&r.themeMap||{...Abe},utils:typeof r.utils=="object"&&r.utils||{}},u=Gbe(o),c={css:Wbe(l,u),globalCss:Qbe(l,u),keyframes:ewe(l,u),createTheme:rwe(l,u),reset(){u.reset(),c.theme.toString()},theme:{},sheet:u,config:l,prefix:n,getCssText:u.toString,toString:u.toString};return String(c.theme=c.createTheme(s)),c});return e||i.reset(),i},awe=()=>t2||(t2=IK()),Yt=(...t)=>awe().css(...t);function owe({variant:t}){return Yt({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:t})}const swe=Yt({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),lwe=Yt({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),uwe=Yt({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});function cwe({drawPosition:t,sideNumber:e}){return Yt({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:e,css:t&&{"&:before":{backgroundColor:"$backgroundColor",content:`${t}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}function dwe({winnerChevron:t,isDoubles:e}){const i=(e?.4:.3)*2;return Yt({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:t?"winner":void 0})}const $x=Yt({fontSize:"smaller",color:"gray"});var pwe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yK(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var bK={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var a="",o=0;o<arguments.length;o++){var s=arguments[o];s&&(a=n(a,r(s)))}return a}function r(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return i.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var o="";for(var s in a)e.call(a,s)&&a[s]&&(o=n(o,s));return o}function n(a,o){return o?a?a+" "+o:a+o:a}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(bK);var mwe=bK.exports;const Up=yK(mwe);function hwe({individualParticipant:t,className:e}){var i,r;const{city:n,state:a,countryCode:o}=((r=(i=t==null?void 0:t.person)==null?void 0:i.addresses)==null?void 0:r[0])||{},s=[n,a,o].filter(Boolean).join(", ")||" ",l=document.createElement("div");return l.className=Up($x(),e),l.innerHTML=s,l}const fwe=Yt({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),gwe=Yt({display:"block"}),vwe=Yt({position:"fixed",right:0,left:0}),Iwe=Yt({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),ywe=Yt({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),bwe=Yt({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),wwe=Yt({fontWeight:"600",fontSize:"20px"}),s2=Yt({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),l2="Nothing to see here";function ws(t){return typeof t=="function"}function YU(t){return typeof t=="string"}function u2(t){return Array.isArray(t)}function $E(t){return typeof t=="object"&&!Array.isArray(t)}function Uwe(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const c2=(()=>{const t=vwe(),e={},i=".5";let r=[],n,a=[],o=[],s;const l=f=>{{const g=o.pop();g&&document.body.removeChild(g)}},u=()=>{s&&(s.style.opacity=0,s.style.display="none")},c=f=>{const g=o.length;if(f&&e[g]===!1)return;const v=a.pop(),y=r.pop();ws(v)&&v({content:y}),document.body.classList.remove(t),document.body.style.top=null,window.scrollTo({top:n,behavior:"instant"}),u(),l()},d=()=>{s=document.createElement("div"),s.className=fwe(),s.id="cmdl-backdrop",s.onclick=()=>c(!0),document.body.appendChild(s)},p=({config:f})=>{n=window.scrollY,document.body.classList.add(t),document.body.style.top=`-${n}px`,s||d(),s.style.display="",(f==null?void 0:f.backdrop)!==!1&&(s.style.backgroundColor="rgba(0, 0, 0, 0.2)",s.style.transition="opacity 0.15s linear",s.style.opacity=1)},m=({config:f,attr:g,attrs:v,unit:y="em",value:I})=>{var b;let S;return YU(g)?S=Z1({element:f,attr:g}):u2(v)&&(S=(b=v.map(w=>Z1({element:f,attr:w})).filter(Boolean))==null?void 0:b[0]),S!==void 0&&(I=S),isNaN(I)?I:`${I}${y}`},h=({buttons:f,config:g,modalNumber:v})=>{var y,I;const b=document.createElement("div");b.className=s2(),b.style.padding=m({config:g,attrs:["footer.padding","padding"],value:i});const S={label:((y=g==null?void 0:g.dictionary)==null?void 0:y.close)||"Close",onClick:c2.close,intent:"is-info"};for(const w of f){if(w.hide)continue;const U={...S};$E(w)&&Object.assign(U,w);const T=document.createElement("button");U.disabled!==void 0&&(T.disabled=U.disabled),U.id&&(T.id=U.id),T.className=((I=U==null?void 0:U.footer)==null?void 0:I.className)||"button font-medium",T.classList.add(U.intent),T.style="margin-right: .5em;",T.innerHTML=U.label||U.text,T.onclick=D=>{D.stopPropagation(),ws(U.onClick)&&U.onClick({e:D,content:r[v]}),U.close!==!1&&(ws(U.close)&&U.close(),c2.close())},b.appendChild(T)}return b};return{close:c,open:({title:f="",content:g,buttons:v,footer:y,config:I,onClose:b}={})=>{p({config:I}),a.push(b);const S=o.length+1;e[S]=I==null?void 0:I.clickAway;const w=document.createElement("section"),U=`cmdl-${S}`;w.className=gwe(),w.role="dialog",w.tabIndex=-1,w.id=U;const T=document.createElement("div");T.className=Iwe(),T.style.maxWidth=`${(I==null?void 0:I.maxWidth)||450}px`,T.onclick=()=>c(!0);const D=document.createElement("div");D.className=ywe(),D.onclick=k=>k.stopPropagation();const P=document.createElement("div"),E=document.createElement("div");P.appendChild(E),D.appendChild(P);const R=({title:k,config:x})=>{P.className=k?bwe():"",P.style.padding=m({config:x,attrs:["title.padding","padding"],value:i}),E.className=k?wwe():"",E.innerHTML=k};f&&R({title:f});const N=document.createElement("div");D.appendChild(N);const A=({content:k,config:x})=>{N.style.fontSize=m({config:x,attr:"fontSize",value:"15px"}),N.style.position="relative",N.style.padding=m({config:x,attrs:["content.padding","padding"],value:i}),ws(k)?r[S]=k(N):$E(k)?N.appendChild(k):YU(k)?N.innerHTML=k:N.innerHTML=l2};if(A({content:g,config:I}),u2(v))y=h({buttons:v,config:I,modalNumber:S}),D.appendChild(y);else if(y){const k=document.createElement("div");k.className=s2(),k.style.padding=m({config:I,attrs:["footer.padding","padding"]}),$E(y)?k.appendChild(y):YU(y)?k.innerHTML=y:k.innerHTML=l2,D.appendChild(k)}T.appendChild(D),w.appendChild(T),document.body.appendChild(w),o.push(w);const M=({content:k,config:x})=>{r[S]=void 0,Uwe(N),A({content:k,config:x})},C=({buttons:k,config:x})=>{D.removeChild(y),y=h({buttons:k,config:x,modalNumber:S}),D.appendChild(y)},O=({onClose:k})=>{a.length=0,a.push(k)};return{setContent:M,setButtons:C,update:({content:k,buttons:x,title:F,config:$,onClose:_})=>{I=$||I,k&&M({content:k,config:I}),x&&C({buttons:x,config:I}),_&&O({onClose:_}),F&&R({title:F,config:I})}}}}})();function Z1({element:t,attr:e}){if(!YU(e))return;const i=e.split(".");for(const r of i)if(t=t==null?void 0:t[r],!t)return;return t}function Swe({individualParticipant:t,attribute:e,className:i}){const r=t==null?void 0:t.person,n=Z1({element:r,attr:e});if(!n)return;const a=document.createElement("div");return a.className=Up($x(),i),a.innerHTML=n,a}function Twe({individualParticipant:t,className:e}){var i;const r=(i=t==null?void 0:t.teams)==null?void 0:i[0],n=(r==null?void 0:r.participantName)||" ",a=document.createElement("div");return a.className=Up($x(),e),a.classList.add("tmx-tm"),a.setAttribute("id",r==null?void 0:r.participantId),a.innerHTML=n,a}function Dwe(t){var e,i,r,n;const a=(i=(e=t==null?void 0:t.composition)==null?void 0:e.configuration)==null?void 0:i.participantDetail;if(a==="TEAM")return Twe(t);if(((n=(r=t==null?void 0:t.composition)==null?void 0:r.configuration)==null?void 0:n.showAddress)??a==="ADDRESS")return hwe(t);if(a){const o=Swe({...t,attribute:a});if(o)return o}return document.createElement("div")}const Pwe=Yt({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});function Rwe({className:t,composition:e,side:i}){const r=(i==null?void 0:i.seedValue)==="~"?"":(i==null?void 0:i.seedValue)!==void 0&&i.seedValue||(i==null?void 0:i.seedNumber);if(!r)return"";const n=(e==null?void 0:e.configuration)||{},{bracketedSeeds:a}=n,o=typeof a=="boolean"&&["(",")"]||a==="square"&&["[","]"]||["",""],s=`${o[0]}${r}${o[1]}`,l=n.seedingElement==="sup"?"sup":"span",u=document.createElement(l);return u.className=t,u.innerHTML=s,u}const Ewe=Yt({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});function Cwe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n}){var a,o,s,l,u,c,d;const p=e==null?void 0:e.configuration,m=((a=p==null?void 0:p.scaleAttributes)==null?void 0:a.eventType)||(r==null?void 0:r.matchUpType)||"SINGLES",h=t==null?void 0:t.rankings,f=t==null?void 0:t.ratings,g=p==null?void 0:p.scaleAttributes,v=g==null?void 0:g.scaleType,y=g==null?void 0:g.scaleName,I=g==null?void 0:g.accessor,b=v==="RATING"?f:h,S=(s=(o=b==null?void 0:b.SINGLES)==null?void 0:o.find(N=>(N==null?void 0:N.scaleName)===y))==null?void 0:s.scaleValue,w=(u=(l=b==null?void 0:b.DOUBLES)==null?void 0:l.find(N=>(N==null?void 0:N.scaleName)===y))==null?void 0:u.scaleValue,U=S&&I?S[I]:S||"",T=w&&I?w[I]:w||"",D=m==="SINGLES"?U:T,P=(c=p==null?void 0:p.scaleAttributes)==null?void 0:c.fallback,E=!n&&(D||P&&(U||T)),R=document.createElement("span");return E&&(R.className=Up(i,Ewe({color:(d=p==null?void 0:p.scaleAttributes)==null?void 0:d.scaleColor}))),R.innerHTML=E||"",R}var Mwe=Object.defineProperty,wt=(t,e)=>{for(var i in e)Mwe(t,i,{get:e[i],enumerable:!0})};function tP(){return"2.2.9"}var wK={};wt(wK,{competitionGovernor:()=>UK,drawsGovernor:()=>gJ,entriesGovernor:()=>Ree,eventGovernor:()=>kee,generationGovernor:()=>Xee,matchUpFormatGovernor:()=>lte,matchUpGovernor:()=>ute,mocksGovernor:()=>F$,participantGovernor:()=>iie,policyGovernor:()=>ZZ,publishingGovernor:()=>Die,queryGovernor:()=>nee,reportGovernor:()=>kie,scheduleGovernor:()=>xie,scoreGovernor:()=>w_,tieFormatGovernor:()=>qie,tournamentGovernor:()=>ire,venueGovernor:()=>fre});var UK={};wt(UK,{getLinkedTournamentIds:()=>pw,getTournamentIds:()=>cw,linkTournaments:()=>pJ,mutate:()=>SK,query:()=>fJ,unlinkTournament:()=>hJ,unlinkTournaments:()=>mJ});var SK={};wt(SK,{linkTournaments:()=>pJ,unlinkTournament:()=>hJ,unlinkTournaments:()=>mJ});var cm="SINGLES",ri="SINGLES",Wd="DOUBLES",ei="DOUBLES",Va="TEAM",gi="TEAM",Nwe={SINGLES_MATCHUP:cm,SINGLES:ri,DOUBLES_MATCHUP:Wd,DOUBLES:ei,TEAM_MATCHUP:Va,TEAM:gi},TK={[ri]:[ri,"S"],[ei]:[ei,"D"],[gi]:[gi,"T"],S:[ri,"S"],D:[ei,"D"],T:[gi,"T"]};function ur(t,e){return(t??0)-(e??0)}function tt(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function Os(t){return isNaN(t)?!1:t&&(t&t-1)===0}function d2(t){if(!t.length)return;let e=[...t].sort(ur),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function Awe(t){if(!Os(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function Bx(t){return isNaN(t)?0:t%2&&t+1||t}function Vx(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function xi(t){return!isNaN(parseFloat(t))}function DK(t){let e=tt(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function sv(t){if(isNaN(t))return!1;for(;!Os(t);)t++;return t}function ao(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function st(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function Owe(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function kwe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function PK(t,e,i,r,n=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=PK(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),r&&(s=kwe(s,r)),parseFloat(s.toFixed(n))}function JS(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function dt(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function xwe(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function Tn(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function Xf(t){return st(t)?t:1/0}function Ra(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function Fwe(t){return RK(Ra(t))}function RK(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function Lwe(t,e,i){return i.indexOf(t)===e}function EK(t){return t.filter(Lwe)}function va(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function $o(t){let e=Math.floor(Math.random()*t.length);return t[e]}function De(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function Xs(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function ji(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function p2(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function Nn(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function _we(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function $we(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function Cr(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function CK(t,[e,...i]){return t.length?[t.slice(0,e),...CK(t.slice(e),[...i,e])]:[]}function Bwe(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function MK(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function NK(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function eM(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let o=i?!!(Math.floor(a/e)%2):!1,s=a%e,l=o?e-1-s:s;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function Vwe(t,e=1){if(!Array.isArray(t)||!t.every(st))return[];let i=Math.min(...t,e),r=Math.max(...t);return De(i,r+1).filter(n=>!t.includes(n))}function fa(t){return typeof t=="function"}function Pi(t){return typeof t=="string"}function At(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function jwe(t,e){if(!At(t)||!At(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function AK(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(At).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var Gwe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function tM(t,e){if(t===void 0)return null;if(!At(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>tM(a))}:{[n]:e?r(t[n]):tM(t[n])}))}function iM(t){return Array.isArray(t)?t.length+t.map(iM).reduce((e,i)=>e+i,0):At(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>iM(t[e])).reduce((e,i)=>e+i,0):0}function Hwe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=iM(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function iP(t,e){return!Array.isArray(t)||!Pi(e)?!1:ji(t,TK[e]).length}var Q={success:!0},OK="error",zwe={SUCCESS:Q,ERROR:OK};function kK({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:o}=n;if(typeof a!="number"||typeof o!="number"||o>e||o<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==dt(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...Q}}var Wwe={};wt(Wwe,{addNotice:()=>ut,callListener:()=>pM,createInstanceState:()=>RUe,cycleMutationStatus:()=>gF,deepCopyEnabled:()=>fF,deleteNotice:()=>vF,deleteNotices:()=>tw,disableNotifications:()=>z9,enableNotifications:()=>XU,getDevContext:()=>Ga,getMethods:()=>Y9,getNotices:()=>K9,getProvider:()=>mM,getTopics:()=>Do,getTournamentId:()=>Dh,getTournamentRecord:()=>IF,getTournamentRecords:()=>Ph,globalLog:()=>Q9,handleCaughtError:()=>yP,hasTopic:()=>vP,removeTournamentRecord:()=>X9,setDeepCopy:()=>ey,setDevContext:()=>ZI,setGlobalLog:()=>H9,setGlobalMethods:()=>W9,setGlobalSubscriptions:()=>CUe,setMethods:()=>q9,setStateMethods:()=>Z9,setStateProvider:()=>PUe,setSubscriptions:()=>MUe,setTournamentId:()=>ty,setTournamentRecord:()=>J9,setTournamentRecords:()=>IP,timeKeeper:()=>EUe});var rM={message:"Chronological error; time violation.",code:"ANACHRONISM"},XI={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},xK={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},nM={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},ki={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},ve={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},Jb={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},Qf={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},dm={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},_e={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},FK={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},ja={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Sp={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},jx={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},Gx={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},Zf={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},LK={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},_K={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},qwe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},Hx={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},Xb={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},rP={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},Ywe={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},lv={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},uv={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},zx={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},nP={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},Wx={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},Qb={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Bs={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},$K={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},BK={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},VK={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},jK={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},GK={message:"Invalid action",code:"ERR_INVALID_ACTION"},aM={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},HK={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},zK={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},WK={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},qx={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},qK={message:"Existing round",code:"ERR_EXISTING_ROUND"},Kwe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},Xa={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Ni={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},Yx={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Tp={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},YK={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},ql={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Ii={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},fo={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},KK={message:"Event exists",code:"ERR_EXISTING_EVENT"},JK={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},XK={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},Kx={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},QK={message:"Missing stage",code:"ERR_MISSING_STAGE"},Dp={message:"Invalid stage",code:"ERR_INVALID_STAGE"},ZK={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},e9={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},t9={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},oM={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},Zb={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},KU={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},cv={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},xl={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},Jx={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},Xx={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},i9={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},dv={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},bn={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},bh={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},fn={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Qu={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},la={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},ua={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},Qx={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},aP={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},Jwe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},r9={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},Zx={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},n9={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},eF={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},Xwe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},eg={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},Qwe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},tF={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},Zwe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},oP={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},eUe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},tUe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},wh={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Qe={message:"Missing value",code:"ERR_MISSING_VALUE"},a9={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},o9={message:"Missing date",code:"ERR_MISSING_DATE"},s9={message:"No valid dates",code:"ERR_NO_VALID_DATES"},XS={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},JU={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},l9={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Fr={message:"Invalid Date",code:"ERR_INVALID_DATE"},Oo={message:"Invalid time",code:"ERR_INVALID_TIME"},u9={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},sM={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},c9={message:"Invalid score",code:"ERR_INVALID_SCORE"},sP={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},iUe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},iF={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},d9={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},lP={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},lM={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},uP={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Uh={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},ks={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},ba={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},p9={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},xs={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},m9={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},Sh={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},ew={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},fr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Wi={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},h9={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},rUe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},f9={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Zc={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},g9={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},v9={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},I9={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},pv={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},cP={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},rF={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},uM={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},y9={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},nUe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},aUe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},b9={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},w9={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},cM={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},U9={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},nF={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},S9={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},aF={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},tg={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},T9={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},mv={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},D9={message:"Court exists",code:"ERR_EXISTING_COURT"},P9={message:"Venue exists",code:"ERR_EXISTING_VENUE"},Th={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},ed={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},R9={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},oF={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},E9={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},C9={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},oUe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},sF={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},M9={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},lF={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},uF={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},dP={message:"Missing context",code:"ERR_MISSING_CONTEXT"},N9={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},km={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},A9={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},hv={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},O9={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},pP={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},k9={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},x9={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Zu={message:"Invalid object",code:"ERR_INVALID_OBJECT"},nI={message:"Invalid gender",code:"ERR_INVALID_GENDER"},QI={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},le={message:"Invalid values",code:"ERR_INVALID_VALUES"},F9={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},cF={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},L9={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},mP={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},dF={message:"Value unchanged",code:"ABORT_UNCHANGED"},jr={message:"Not found",code:"ERR_NOT_FOUND"},hP={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},_9={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},pF={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},$9={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},B9={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},dM={message:"Existing stage",code:"ERR_EXISTING_STAGE"},mF={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},fP={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},V9={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},gP={message:"Scores present",code:"ERR_SCORES_PRESENT"},sUe={ANACHRONISM:rM,CANNOT_CHANGE_WINNING_SIDE:uP,CANNOT_MODIFY_TIEFORMAT:iF,CANNOT_MODIFY_PARTICIPANT_TYPE:d9,CANNOT_REMOVE_MAIN_STRUCTURE:xK,CANNOT_REMOVE_PARTICIPANTS:lP,CATEGORY_MISMATCH:lM,COURT_EXISTS:D9,COURT_NOT_FOUND:mv,DRAW_DEFINITION_NOT_FOUND:ja,DRAW_ID_EXISTS:$K,DRAW_POSITION_ACTIVE:rP,DRAW_POSITION_ASSIGNED:Zf,DRAW_POSITION_NOT_CLEARED:_K,DRAW_POSITION_NOT_FOUND:qwe,DRAW_SIZE_MISMATCH:Wx,DUPLICATE_ENTRY:XI,DUPLICATE_VALUE:F9,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:w9,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:b9,EVENT_EXISTS:KK,EVENT_NOT_FOUND:fo,EXISTING_DRAW_DEFINITIONS:FK,EXISTING_END_TIME:oF,EXISTING_FLIGHT:_9,EXISTING_MATCHUP_ID:B9,EXISTING_OUTCOME:$9,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:pv,EXISTING_PARTICIPANT:cP,EXISTING_POLICY_TYPE:eF,EXISTING_PROFILE:pF,EXISTING_ROUND:qK,EXISTING_STAGE:dM,EXISTING_STRUCTURE:mF,INCOMPATIBLE_MATCHUP_STATUS:KU,INCOMPLETE_SOURCE_STRUCTURE:jx,INSUFFICIENT_DRAW_POSITIONS:nF,INVALID_ACTION:GK,INVALID_ASSIGNMENT:aM,INVALID_BOOKINGS:XS,INVALID_CATEGORY:QI,INVALID_COLLECTION_DEFINITION:x9,INVALID_CONFIGURATION:k9,INVALID_DATE_AVAILABILITY:JU,INVALID_DATE:Fr,INVALID_DRAW_DEFINITION:dm,INVALID_DRAW_POSITION_FOR_SEEDING:Gx,INVALID_DRAW_POSITION:lv,INVALID_DRAW_SIZE:nP,INVALID_END_TIME:R9,INVALID_ENTRIES:XK,INVALID_EVENT_TYPE:ql,INVALID_GAME_SCORES:sM,INVALID_GENDER:nI,INVALID_MATCHUP_FORMAT:Jx,INVALID_MATCHUP_STATUS:cv,INVALID_MATCHUP_STATUS_BYE:t9,INVALID_MATCHUP:ua,INVALID_OBJECT:Zu,INVALID_PARTICIPANT_ID:ks,INVALID_PARTICIPANT_IDS:ba,INVALID_PARTICIPANT_ROLE:p9,INVALID_PARTICIPANT_SEEDING:BK,INVALID_PARTICIPANT_TYPE:xs,INVALID_PARTICIPANT:Uh,INVALID_POLICY_DEFINITION:n9,INVALID_RECORDS:nM,INVALID_SCALE_ITEM:km,INVALID_SEED_NUMBER:zK,INVALID_SEED_POSITION:WK,INVALID_SET_NUMBER:Zwe,INVALID_SIDE_NUMBER:tF,INVALID_SCORE:c9,INVALID_STAGE:Dp,INVALID_START_TIME:C9,INVALID_STRUCTURE:Sp,INVALID_STOP_TIME:E9,INVALID_TIE_FORMAT:xl,INVALID_TIME:Oo,INVALID_TIME_ITEM:sF,INVALID_TOURNAMENT_DATES:u9,INVALID_TOURNAMENT_RECORD:Jb,INVALID_VALUES:le,INVALID_WINNING_SIDE:sP,MATCHUP_NOT_FOUND:fn,METHOD_NOT_FOUND:fP,MISSING_ASSIGNMENTS:Kx,MISSING_ASYNC_STATE_PROVIDER:M9,MISSING_AVOIDANCE_POLICY:r9,MISSING_BIRTH_DATE:a9,MISSING_COLLECTION_DEFINITION:i9,MISSING_COURT_ID:wh,MISSING_COURTS_INFO:T9,MISSING_DATE_AVAILABILITY:l9,MISSING_DATE:o9,MISSING_DRAW_DEFINITION:_e,MISSING_DRAW_ID:Bs,MISSING_DRAW_POSITION:uv,MISSING_DRAW_POSITIONS:Xb,MISSING_DRAW_SIZE:Qb,MISSING_ENTRIES:JK,MISSING_EVENT:Ii,MISSING_MATCHUP_FORMAT:Xx,MISSING_MATCHUP_ID:bn,MISSING_MATCHUP_IDS:bh,MISSING_MATCHUP:la,MISSING_MATCHUPS:Qu,MISSING_PARTICIPANT_COUNT:g9,MISSING_PARTICIPANT_ID:fr,MISSING_PARTICIPANT_IDS:Zc,MISSING_PARTICIPANT_ROLE:m9,MISSING_PARTICIPANT:Sh,MISSING_PARTICIPANTS:ew,MISSING_PENALTY_ID:aF,MISSING_PENALTY_TYPE:S9,MISSING_PERSON_DETAILS:I9,MISSING_POLICY_ATTRIBUTES:Zx,MISSING_POLICY_DEFINITION:aP,MISSING_POLICY_TYPE:Qx,MISSING_POSITION_ASSIGNMENTS:e9,MISSING_ROUND_NUMBER:Kwe,MISSING_SCHEDULE:N9,MISSING_SCORING_POLICY:Qwe,MISSING_SEED_ASSIGNMENTS:HK,MISSING_SEEDCOUNT_THRESHOLDS:jK,MISSING_SEEDING_POLICY:Jwe,MISSING_SET_NUMBER:eUe,MISSING_SET_OBJECT:oP,MISSING_SIDE_NUMBER:tUe,MISSING_STAGE:QK,MISSING_STRUCTURE_ID:Xa,MISSING_STRUCTURE:Tp,MISSING_STRUCTURES:Yx,MISSING_TARGET_LINK:qx,MISSING_TIE_FORMAT:dv,MISSING_TIME_ITEM:lF,MISSING_TIME_ITEMS:uF,MISSING_TOURNAMENT_ID:Qf,MISSING_TOURNAMENT_RECORD:ve,MISSING_TOURNAMENT_RECORDS:ki,MISSING_VALUE:Qe,MISSING_VENUE_ID:ed,MODIFICATIONS_FAILED:A9,NO_CANDIDATES:pP,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:U9,NO_MODIFICATIONS_APPLIED:hv,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:cM,NO_PARTICIPANT_REMOVED:f9,NO_VALID_ACTIONS:L9,NO_VALID_ATTRIBUTES:mP,NO_VALID_DATES:s9,NOT_FOUND:jr,NOT_IMPLEMENTED:hP,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:rF,PARTICIPANT_ID_EXISTS:h9,PARTICIPANT_NOT_CHECKED_IN:v9,PARTICIPANT_NOT_FOUND:Wi,PARTICIPANT_PAIR_EXISTS:rUe,PENALTY_NOT_FOUND:tg,POLICY_NOT_ATTACHED:Xwe,POLICY_NOT_FOUND:eg,SCHEDULE_NOT_CLEARED:LK,SCHEDULED_MATCHUPS:V9,SCORES_PRESENT:gP,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:VK,STAGE_SEQUENCE_LIMIT:ZK,STRUCTURE_NOT_FOUND:Ni,TEAM_NOT_FOUND:cF,UNABLE_TO_ASSIGN_COURT:O9,UNLINKED_STRUCTURES:YK,UNRECOGNIZED_DRAW_TYPE:Hx,UNRECOGNIZED_MATCHUP_FORMAT:Zb,UNRECOGNIZED_MATCHUP_STATUS:oM,VALUE_UNCHANGED:dF,VENUE_EXISTS:P9},Ei={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},j9={addNotice:yUe,callListener:TUe,cycleMutationStatus:IUe,deleteNotice:UUe,deleteNotices:wUe,disableNotifications:lUe,enableNotifications:uUe,getMethods:hF,getNotices:bUe,getTopics:SUe,getTournamentId:G9,getTournamentRecord:cUe,getTournamentRecords:dUe,removeTournamentRecord:fUe,setMethods:vUe,setSubscriptions:gUe,setTournamentId:mUe,setTournamentRecord:pUe,setTournamentRecords:hUe,handleCaughtError:DUe};function lUe(){Ei.disableNotifications=!0}function uUe(){Ei.disableNotifications=!1}function G9(){return Ei.tournamentId}function cUe(t){return Ei.tournamentRecords[t]}function dUe(){return Ei.tournamentRecords}function pUe(t){let e=t==null?void 0:t.tournamentId;return e?(Ei.tournamentRecords[e]=t,{success:!0}):{error:Jb}}function mUe(t){return t?Ei.tournamentRecords[t]?(Ei.tournamentId=t,{success:!0}):{error:ve}:(Ei.tournamentId=void 0,{success:!0})}function hUe(t){Ei.tournamentRecords=t;let e=Object.keys(t);e.length===1?Ei.tournamentId=e[0]:e.length||(Ei.tournamentId=void 0)}function fUe(t){if(typeof t!="string")return{error:le};if(!Ei.tournamentRecords[t])return{error:jr};delete Ei.tournamentRecords[t];let e=Object.keys(Ei.tournamentRecords);return e.length===1?Ei.tournamentId=e[0]:e.length||(Ei.tournamentId=void 0),{success:!0}}function gUe(t){return typeof t.subscriptions!="object"?{error:le}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?Ei.subscriptions[e]=t.subscriptions[e]:delete Ei.subscriptions[e]}),{...Q})}function vUe(t){return typeof t!="object"?{error:le}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(Ei.methods[e]=t[e])}),{...Q})}function IUe(){let t=Ei.modified;return Ei.modified=!1,t}function yUe({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(Ei.disableNotifications||(Ei.modified=!0),!(Ei.disableNotifications||!Ei.subscriptions[t]&&!r)))return i&&(Ei.notices=Ei.notices.filter(n=>!(n.topic===t&&n.key===i))),Ei.notices.push({topic:t,payload:e,key:i}),{...Q}}function hF(){return Ei.methods??{}}function bUe({topic:t}){return Ei.notices.filter(e=>e.topic===t).map(e=>e.payload)}function wUe(){Ei.notices=[]}function UUe({topic:t,key:e}){Ei.notices=Ei.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function SUe(){return{topics:Object.keys(Ei.subscriptions)}}function TUe({topic:t,notices:e},i){let r=Ei.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i==null?void 0:i[t];n&&typeof n=="function"&&n(e)}function DUe({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:G9(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var ai={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Gr=j9,m2=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function PUe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(ji(Object.keys(t),m2).length!==m2.length)throw new Error("Global state provider is missing required methods");return Gr=t,{success:!0}}function RUe(){if(Gr.createInstanceState){try{Gr.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:M9}}function Ga(t){return!t||typeof t!="object"?ai.devContext??!1:typeof ai.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=ai.devContext)==null?void 0:i[e])===t[e]})&&ai.devContext}function EUe(t="reset",e="default"){var i,r;let n=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(ai.timers).filter(a=>a!=="default"||ai.timers[a].startTime).map(a=>{let o=ai.timers[a],s=o.state==="stopped"?0:(n-((o==null?void 0:o.startTime)??0))/1e3,l=o.elapsedTime+s;return{state:ai.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=ai.timers[e].state==="stopped"?0:(n-(((i=ai.timers[e])==null?void 0:i.startTime)??0))/1e3,o=ai.timers[e].elapsedTime+a;return{state:ai.timers[e].state,elapsedTime:o.toFixed(2),timer:e}}}if(!ai.timers[e]||t==="reset"){if(e==="allTimers")return ai.timers={default:{elapsedTime:0}},!0;ai.timers[e]={startTime:n,state:"active",elapsedTime:0}}return ai.timers[e].elapsedTime||(ai.timers[e].elapsedTime=0),t==="stop"&&ai.timers[e].state!=="stopped"&&(ai.timers[e].state="stopped")&&(ai.timers[e].elapsedTime+=(n-(((r=ai.timers[e])==null?void 0:r.startTime)??0))/1e3),t==="start"&&(ai.timers[e].startTime=n)&&(ai.timers[e].state="active"),ai.timers[e]}function H9(t){fa(t)?ai.globalLog=t:delete ai.globalLog}function ZI(t){ai.devContext=t}function z9(){Gr.disableNotifications()}function XU(){Gr.enableNotifications()}function ey(t,e){typeof t=="boolean"&&(ai.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(ai.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(ai.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(ai.deepCopyAttributes.stringify=e.stringify),e.threshold&&(ai.deepCopyAttributes.threshold=e.threshold))}function fF(){return{enabled:ai.deepCopy,...ai.deepCopyAttributes}}function CUe(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{ai.globalSubscriptions[e]=t.subscriptions[e]}),{...Q}):{error:Qe,info:"missing subscriptions"}}function MUe(t){return t!=null&&t.subscriptions?Gr.setSubscriptions({subscriptions:t.subscriptions}):{error:Qe,info:"missing subscriptions"}}function W9(t){return t?typeof t!="object"?{error:le}:(Object.keys(t).forEach(e=>{fa(t[e])&&(ai.globalMethods[e]=t[e])}),{...Q}):{error:Qe,info:"missing method declarations"}}function q9(t){return t?typeof t!="object"?{error:le}:Gr.setMethods(t):{error:Qe,info:"missing method declarations"}}function gF(){return Gr.cycleMutationStatus()}function ut(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=ai.globalSubscriptions[t.topic];return Gr.addNotice(t,e)}function Y9(){return{...ai.globalMethods,...Gr.getMethods()}}function K9(t){return Gr.getNotices(t)}function vF({key:t,topic:e}){return Gr.deleteNotice({key:t,topic:e})}function tw(){return Gr.deleteNotices()}function Do(){return Gr.getTopics()}function vP(t){var e,i;return(i=(e=Do())==null?void 0:e.topics)==null?void 0:i.includes(t)}async function pM(t){return Gr.callListener(t,ai.globalSubscriptions)}function Dh(){return Gr.getTournamentId()}function IF(t){return Gr.getTournamentRecord(t)}function Ph(){return Gr.getTournamentRecords()}function J9(t){return Gr.setTournamentRecord(t)}function IP(t){return Gr.setTournamentRecords(t)}function ty(t){return Gr.setTournamentId(t)}function X9(t){return Gr.removeTournamentRecord(t)}function mM(){return Gr}function yP({engineName:t,methodName:e,params:i,err:r}){let n=fa(Gr.handleCaughtError)&&Gr.handleCaughtError||j9.handleCaughtError,{tournamentRecord:a,...o}=i;return n({params:o,engineName:t,methodName:e,err:r})}function Q9(t,e){if(ai.globalLog)try{ai.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),H9()}else console.log(e,t)}function Z9(t,e,i,r){if(!At(t))return{error:le};xi||(i=1);let n=Array.isArray(e)?e:[],a={},o=(s,l=0)=>{Object.keys(s).forEach(u=>{fa(s[u])?a[u]=s[u]:At(s[u])&&(e===!0||n!=null&&n.includes(u))&&(i===void 0||l<i)&&o(s[u],l+1)})};return o(t),r?W9(a):q9(a),{methods:a}}function NUe(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function Ge(t,e,i,r){var n;if(typeof t!="object"||t===null)return t;(n=fF())!=null&&n.enabled||(r=!0);let a=["",void 0,null];e&&a.push(!1);let o=NUe(t,a,i);return Object.assign({},...o.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(l=>Ge(l))}:{[s]:r?t[s]:Ge(t[s])}))}function te({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,Ge(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...Q}),e??{success:!0}}var Fs="ANY",Qt="MALE",jn="MIXED",Td="OTHER",hi="FEMALE",yF={ANY:Fs,MALE:Qt,FEMALE:hi,MIXED:jn,OTHER:Td},AUe="MIXED events can not contain mixed singles or { gender: ANY } collections",OUe="events with { gender: ANY } can not contain MIXED singles collections";function bP(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&[Qt,hi].includes(i)&&i!==n?te({result:{valid:!1,error:nI},context:{gender:n},stack:e}):i===jn&&(n===Fs||n===jn&&r!==ei)?te({result:{error:nI,valid:!1},info:AUe,stack:e}):i===Fs&&n===jn&&r!==ei?te({result:{error:nI,valid:!1},info:OUe,stack:e}):{valid:!0}}var kUe="normal",h2="timed",xUe="final",bF="NOAD",QU="SET",FUe={S:kUe,F:xUe};function wP(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&t!=null&&t.setFormat)return LUe(t,e)}function iy(t){return!isNaN(Number(t))&&Number(t)}function e8(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function LUe(t,e){var i;let r=iy(t.bestOf)||void 0,n=iy(t.exactly)||void 0,a=r||n;if((i=t.setFormat)!=null&&i.timed&&t.simplified&&a===1)return e8(t.setFormat);let o=a&&`${QU}${a}`||"",s=f2(t.setFormat,e),l=s&&`S:${s}`||"",u=f2(t.finalSetFormat,e),c=a&&a>1&&u&&s!==u&&`F:${u}`||"";if(o&&s)return[o,l,c].filter(d=>d).join("-")}function f2(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return e8(t);if(t.tiebreakSet)return g2(t.tiebreakSet);let i=iy(t.setTo);if(i){let r=t.NoAD&&bF||"",n=g2(t.tiebreakFormat),a=n&&`/${n}`||"",o=iy(t.tiebreakAt),s=o&&(o!==i||e)&&`@${o}`||"";if(n!==!1)return`${i}${r}${a}${s}`}}}function g2(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&iy(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?bF:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Ln(t){if(Pi(t)){let e=t.startsWith("T")&&h2||t.startsWith(QU)&&QU||"";if(e===h2){let i=i8(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e===QU)return _Ue(t)}}function _Ue(t){let e=t.split("-"),i=iw(e[0].slice(3)),r=i===1||i%2!==0?i:void 0,n=i!==1&&i%2===0?i:void 0,a=e&&v2(e[1]),o=e&&v2(e[2]),s=a&&a.timed||o&&o.timed,l=r&&r<6||s&&n,u=!e[2]||o,c=a,d=Ge({setFormat:a,exactly:n,bestOf:r});if(o&&(d.finalSetFormat=o),l&&c&&u)return d}function v2(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=FUe[e[0]],r=e[1];if(i&&r){if(r.startsWith("TB")){let h=I2(r);return h===!1?!1:typeof h=="object"?{tiebreakSet:h}:void 0}if(r.startsWith("T"))return i8(r);let n=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=n&&r8(n[2])||!1,o=!(n!=null&&n[2])||a,s=n?iw(n[1]):void 0,l=t8(r),u=l!==!1,c=u&&l||s,d=I2(r.split("/")[1]),p=d!==!1,m={setTo:s};return a&&(m.NoAD=!0),d?(m.tiebreakFormat=d,m.tiebreakAt=c):m.noTiebreak=!0,s&&o&&p&&u&&m||!1}}}function t8(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?iw(i[1]):i[1])||!1}function I2(t){if(t)if(t.startsWith("TB")){let e=t8(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),r=i==null?void 0:i[1],n=i&&r8(i[2]),a=!(i!=null&&i[2])||n,o=iw(r);if(o&&a){let s={tiebreakTo:o};return e&&typeof e=="string"&&!st(e)&&(s.modifier=e),n&&(s.NoAD=!0),s}else return!1}else return!1}function i8(t){var e;let i=t.slice(1),r=i.match(/^(\d+)(@?[A-Za-z]*)/),n=iw(r==null?void 0:r[1]);if(!n)return;let a={timed:!0,minutes:n},o=r==null?void 0:r[2],s=[void 0,"P","G"].includes(o);if(o&&!s){let l=(e=i.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:e[3];return l?(a.modifier=l,a):void 0}return o&&(a.based=r[2]),a}function r8(t){return t&&t.indexOf(bF)>=0}function iw(t){return isNaN(Number(t))?0:Number(t)}function Ea({matchUpFormat:t}){if(!Pi(t)||t==="")return!1;let e=Ln(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),r=i==null?void 0:i[1],n=i==null?void 0:i[2],a=i==null?void 0:i[3],o=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o==null?void 0:o[1],l=o==null?void 0:o[2],u=o==null?void 0:o[3];return wP(e,!!(i&&n&&r===a||o&&l&&s===u))===t}var QS=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,n8=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,ul=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Dd=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function ZS(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=ht(t.scheduledTime)),!e)return;let i=Si(t.scheduledTime),r=ht(e);return r&&i&&(r+=`T${i}`),r}function $Ue(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function fv(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Dd.test(Rh(t,!0,!0)))}function wa(t){return qd(t)||QS.test(t)}function BUe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return VUe(i,{displaySeconds:!1})}function VUe(t,e){let i=parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e!=null&&e.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(lo).join(":")}var wF=t=>{let e=ry(t)||qd(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${lo(r)}-${lo(e.getUTCDate())}`};function jUe(t){let e=ry(t)||qd(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function qo(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),o=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,o].join(e):i==="MDY"?[n,a,o].join(e):i==="YDM"?[o,a,n].join(e):i==="DYM"?[a,o,n].join(e):i==="MYD"?[n,o,a].join(e):[o,n,a].join(e)}function e0(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function GUe(t){return e0(t).getTime()}function ry(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function ig(t,e){if(!wa(t)||!wa(e))return[];let i=ht(t)+"T00:00",r=ht(e)+"T00:00",n=new Date(i),a=new Date(r),o=ry(a)&&ry(n)&&u(n,a),s=[],l=0;if(o){let c=n,d=c.getTime();for(;d<=a.getTime()&&l<300;)l+=1,s.push(new Date(c)),d=c.setDate(c.getDate()+1)}return s.map(c=>qo(c));function u(c,d){return c<=d}}var HUe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function qd(t){return typeof t!="string"?!1:HUe.test(t)}function UF(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!isNaN(parseInt(r)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function kt(t){let e=Si(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>parseInt(n));return i*60+r}function zUe(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[lo(e),lo(i)].join(":")}function t0(t){return UF(t)?t.split(":").slice(0,2).map(lo).join(":"):void 0}function Si(t){return qd(t)&&t.indexOf("T")>0?t0(t.split("T").reverse()[0]):t0(t)}function ht(t){return qd(t)||ul.test(t)?t.split("T")[0]:void 0}function qv(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),ht(i.toISOString())}function i0(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function WUe(t){let e=i0(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(lo).join(":")}function qUe(t){var e;let i=i0(t);if(!(typeof i=="object"&&!Object.keys(i).length))return i.ampm?t:(i.hours>12?(i.hours-=12,i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),((e=i.hours)==null?void 0:e[0])==="0"&&(i.hours=i.hours.slice(1)),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}function Rh(t,e,i){let r=ht(t),n=Si(t),a=r?n:t;return t?e&&(r&&i&&t||WUe(a))||qUe(a):void 0}function a8(t,e){let i=i0(t),r=i0(e);if(parseInt(i.hours)<parseInt(r.hours))return-1;if(parseInt(i.hours)>parseInt(r.hours))return 1;if(i.hours===r.hours){if(parseInt(i.minutes)<parseInt(r.minutes))return-1;if(parseInt(i.minutes)>parseInt(r.minutes))return 1}return 0}function SF(t,e=7){let i=ht(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return qo(n)}function YUe(t){return SF(t)}function KUe(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),qo(n,i)}function JUe(t,e,i){let r=new Date(t,0);return qo(new Date(r.setDate(e)),i)}function nr(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(lo),n=e0(e).setHours(i,r,0,0);return e0(n)}function rw(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function na(t,e){let i=Si(t);if(!i)return"00:00";let r=isNaN(e)?0:e;return Si(TF(nr(i),r).toISOString())}function TF(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function lo(t){return t.toString()[1]?t:"0"+t}function Yl(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var o8={addDays:SF,addWeek:YUe,addMinutesToTimeString:na,convertTime:Rh,getIsoDateString:ZS,getUTCdateString:wF,DateHHMM:BUe,extractDate:ht,extractTime:Si,formatDate:qo,getDateByWeek:KUe,isISODateString:qd,isDate:ry,isTimeString:UF,offsetDate:e0,offsetTime:GUe,sameDay:Yl,timeStringMinutes:kt,timeToDate:nr,timeUTC:jUe,validTimeValue:fv,validDateString:QS,timeValidation:Dd,dateValidation:ul},XUe=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),QUe=t=>t.filter(Boolean).every(xi);function xm(t){let e=t.category;if(typeof e!="object")return{error:QI};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o}=e,s=e.categoryName,l;if(!XUe([i,r,n,s],"string")||!QUe([a,o]))return{error:QI};let u=t.consideredDate??ht(new Date().toLocaleDateString("sv"));if(!wa(u))return{error:Fr};let[c]=u.split("-").slice(0,3).map(x=>parseInt(x)),d=qv(u,-1),[p,m]=d.split("-").slice(1,3).map(x=>parseInt(x)),h=`${lo(p)}-${lo(m)}`,f=qv(u,1),[g,v]=f.split("-").slice(1,3).map(x=>parseInt(x)),y=`${lo(g)}-${lo(v)}`,I=o&&qv(u,-1*365*o),b=a&&qv(u,-1*365*a),S=[],w=x=>!S.includes(x)&&S.push(x);i=i??s;let U=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,D=i==null?void 0:i.includes("-"),P=D&&(i==null?void 0:i.match(T)),E=i==null?void 0:i.match(U),R=(x,F)=>`${x}-${F}`,N=x=>{let F=c-x,$=R(F,y);e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x-1&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=x-1)},A=x=>{let F=c-x-1,$=R(F,y);e.ageMin&&e.ageMin>x&&w(`Invalid submitted ageMin: ${o}`),e.ageMax&&e.ageMax>x&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=x)},M=x=>{let F=c-x,$=R(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x+1&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=x+1)},C=x=>{let F=c-x-1,$=R(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=x)},O=x=>{let[F,$,_]=(x.match(U)||[]).slice(1),L=parseInt($);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(L)):F==="O"&&M(L),_==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),A(L)):_==="O"&&C(L),r=r??I,n=n??b};if(P){if(r=void 0,n=void 0,a=void 0,o=void 0,e.ageMin){let $=c-e.ageMin;r=R($,h)}if(e.ageMax){let $=c-e.ageMax-1;n=R($,y)}let[x,F]=((i==null?void 0:i.match(T))??[]).slice(1).map($=>parseInt($));x<=F?(o=x,a=F,l=!0):w(`Invalid combined age range ${i}`)}else D?i==null||i.split("-").forEach(O):E?O(i):(o&&M(o),a&&A(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),o=void 0);let k=Ge({consideredDate:u,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o});return S.length&&(k.errors=S),k}function ny({category:t}){if(!At(t))return{error:le};let e=xm({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!xi(i)?te({result:{error:le},context:{ratingMax:i}}):r&&!xi(r)?te({result:{error:le},context:{ratingMin:r}}):{...e}}function nw({childCategory:t,withDetails:e,category:i}){let r=ny({category:i}),n=ny({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),o=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),s=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),u=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=Ge({invalidRatingRange:u,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:o,invalidAgeMin:a,valid:!u&&!s&&!l&&!c&&!o&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function aw({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:o}){a=a??(o==null?void 0:o.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),te({result:{errors:l,error:Zu},stack:s});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:m,matchUpFormat:h,matchUpValue:f,matchUpType:g,scoreValue:v,setValue:y,category:I,gender:b}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof m!="number"&&l.push(`matchUpCount is not type number: ${m}`),g&&!iP([ri,ei],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(u!=null&&u.length)].concat([f,d,v,y].map(st)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),f&&typeof f!="number"&&l.push(`matchUpValue is not type number: ${f}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&m){let S=kK({collectionValueProfiles:u,matchUpCount:m});S.errors&&l.push(...S.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),h&&!Ea({matchUpFormat:h})&&l.push(`Invalid matchUpFormat: ${h}`),r){let S=bP({referenceGender:a,matchUpType:g,gender:b});if(S.error)return te({context:{referenceGender:a,gender:b},result:S,stack:s})}if(t&&n&&I){let S=nw({category:n,childCategory:I});if(!S.valid)return te({result:{error:QI},context:S,stack:s})}return l.length?te({result:{errors:l,error:x9},stack:s}):{valid:!0}}function qn(t){var e,i,r,n;let a=!!((t==null?void 0:t.enforceCategory)!==!1&&t!=null&&t.category),o=!!((t==null?void 0:t.enforceGender)!==!1&&t!=null&&t.gender),s=t==null?void 0:t.checkCollectionIds,l=t==null?void 0:t.tieFormat,u=t==null?void 0:t.event,c="validateTieFormat",d=[],p=ZUe({...t,stack:c});if(p!=null&&p.error)return p;let m,h=l.collectionDefinitions.every(I=>{let{setValue:b,scoreValue:S,collectionValue:w}=I;(b||S)&&!w&&(m=!0);let{valid:U,errors:T}=aw({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:I,checkCollectionIds:s,checkCategory:a,checkGender:o,event:u});return U?!0:(Array.isArray(T)&&d.push(...T),!1)}),f=typeof((e=l.winCriteria)==null?void 0:e.valueGoal)=="number"&&((i=l.winCriteria)==null?void 0:i.valueGoal)>0&&!m||((r=l.winCriteria)==null?void 0:r.aggregateValue);if(!(f||(n=l.winCriteria)!=null&&n.aggregateValue))return m?d.push("aggregateValue is required"):d.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),te({context:{tieFormat:l,errors:d,aggregateValueImperative:m},result:{error:xl},stack:c});let g=l.collectionDefinitions.map(({collectionId:I})=>I),v=!s||g.length===dt(g).length,y=h&&f&&v;return y?{valid:y,errors:d}:te({result:{error:xl},context:{tieFormat:l,errors:d},stack:c})}function ZUe(t){let{tieFormat:e,stack:i}=t;return!t||!e||!At(e)?te({result:{error:xl},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):At(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...Q}:te({result:{error:xl},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):te({result:{error:xl},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var rg="resourceSubType",ng="resourceType",ag="identifier",eSe={RESOURCE_SUB_TYPE:rg,RESOURCE_TYPE:ng,IDENTIFIER:ag};function Me(t,e,i,r,n=0){if(mM().makeDeepCopy)return mM().makeDeepCopy(t,e,i,r);let a=fF(),{stringify:o,toJSON:s,ignore:l,modulate:u}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||fa(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&n>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(m=>!i||!l||Array.isArray(l)&&!l.includes(m)||fa(l)&&!l(m)),p=(m,h)=>{c[m]=fa(h==null?void 0:h.toString)?h.toString():JSON.stringify(h)};for(let m of d){let h=t[m],f=fa(u)?u(h):void 0;if(f!==void 0)c[m]=f;else if(e&&m==="extensions"&&Array.isArray(h)){let g=DF(h);Object.assign(c,...g)}else r&&m==="extensions"?c[m]=[]:Array.isArray(o)&&o.includes(m)?p(m,h):Array.isArray(s)&&s.includes(m)&&fa(h==null?void 0:h.toJSON)?c[m]=h.toJSON():h===null?c[m]=void 0:$Ue(h)?c[m]=new Date(h).toISOString():c[m]=Me(h,e,i,r,n+1)}return c}function DF(t){return t==null?void 0:t.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function s8(t=1,e){return De(0,t).map(()=>Ht(e))}function Ht(t){let e=[];for(let s=0;s<256;s++)e[s]=(s<16?"0":"")+s.toString(16);let i=Math.random()*4294967295|0,r=Math.random()*4294967295|0,n=Math.random()*4294967295|0,a=Math.random()*4294967295|0,o=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${o.replace(/-/g,"")}`:o}var l8={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},u8={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},c8={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},d8={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},p8={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},m8={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},h8={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},f8={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},g8={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},v8={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Yo="SET3-S:6/TB7",tSe="SET3-S:6NOAD",I8="SET3-S:6/TB7-F:TB10",iSe="SET3-S:4/TB7",rSe="SET3-S:4/TB5@3",nSe="SET1-S:T20",aSe="SET1-S:8/TB7",oSe="SET1-S:8/TB7@7",sSe={FORMAT_STANDARD:Yo,FORMAT_STANDARD_NOAD:tSe,FORMAT_ATP_DOUBLES:I8,FORMAT_SHORT_SETS:iSe,FORMAT_FAST4:rSe,FORMAT_PRO_SET:aSe,FORMAT_COLLEGE_PRO_SET:oSe,TIMED20:nSe},y8={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},b8={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},w8={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},U8={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},S8={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},T8={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},D8={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},r0="COLLEGE_DEFAULT",hM="COLLEGE_JUCO",fM="COLLEGE_D3",P8="DOMINANT_DUO",R8="DOMINANT_DUO_MIXED",E8="LAVER_CUP",C8="TEAM_DOUBLES_3_AGGREGATION",M8="TIME_TENNIS_DUAL",N8="TIME_TENNIS_PRO_CIRCUIT",A8="USTA_BREWER_CUP",O8="USTA_OZAKI_CUP",k8="USTA_COLLEGE",x8="USTA_GOLD_TEAM_CHALLENGE",F8="USTA_LEVEL_1",L8="USTA_INTERSECTIONAL",_8="USTA_SECTION_BATTLE",$8="USTA_SOUTHERN_LEVEL_5",B8="USTA_TOC",V8="USTA_WTT_ITT",j8="USTA_ZONAL",lSe={COLLEGE_D3:fM,COLLEGE_DEFAULT:r0,COLLEGE_JUCO:hM,DOMINANT_DUO:P8,DOMINANT_DUO_MIXED:R8,LAVER_CUP:E8,TEAM_DOUBLES_3_AGGREGATION:C8,TIME_TENNIS_DUAL:M8,TIME_TENNIS_PRO_CIRCUIT:N8,USTA_BREWER_CUP:A8,USTA_OZAKI_CUP:O8,USTA_COLLEGE:k8,USTA_GOLD_TEAM_CHALLENGE:x8,USTA_INTERSECTIONAL:L8,USTA_LEVEL_1:F8,USTA_SECTION_BATTLE:_8,USTA_SOUTHERN_LEVEL_5:$8,USTA_TOC:B8,USTA_WTT_ITT:V8,USTA_ZONAL:j8},G8="STANDARD",y2={[G8]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[fM]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Yo,matchUpCount:6,matchUpValue:1},tieFormatName:fM,valueGoal:5},[r0]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:Yo,matchUpCount:6,matchUpValue:1},tieFormatName:r0,valueGoal:4},[hM]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Yo,matchUpCount:6,matchUpValue:1},tieFormatName:hM,valueGoal:5},[E8]:T8,[P8]:y8,[R8]:h8,[C8]:u8,[M8]:f8,[N8]:m8,[A8]:g8,[O8]:v8,[k8]:b8,[x8]:l8,[L8]:p8,[F8]:w8,[_8]:d8,[$8]:c8,[V8]:U8,[B8]:D8,[j8]:S8},uSe=t=>{let e=t!=null&&t.namedFormat&&Object.keys(y2).includes(t.namedFormat)?t.namedFormat:G8,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],r,{category:n,gender:a}=(t==null?void 0:t.event)??{},o=Me(y2[e],!1,!0),s=l=>{var u,c;if(!(t!=null&&t.isMock)&&!((u=t==null?void 0:t.event)!=null&&u.isMock)||!t.event)return(i==null?void 0:i.pop())??Ht();let d=(c=t==null?void 0:t.event)==null?void 0:c.eventId;return i.pop()??`${d}-COL-${l+1}`};return o.hydrate?(r={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:I8,collectionName:"Doubles",matchUpType:ei,...o.doubles},{collectionId:s(1),matchUpFormat:Yo,collectionName:"Singles",matchUpType:ri,...o.singles}]},o.tieFormatName&&(r.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((l,u)=>l.collectionId=s(u)),r=o),t!=null&&t.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},Au=uSe,cl="SINGLES",Fm="SINGLES",go="DOUBLES",Ou="DOUBLES",cr="TEAM",Ca="TEAM",cSe="AGE",dSe="RATING",pSe="BOTH",mSe={AGE:cSe,BOTH:pSe,DOUBLES:go,DOUBLES_EVENT:Ou,RATING:dSe,SINGLES:cl,SINGLES_EVENT:Fm,TEAM_EVENT:Ca,TEAM:cr},Ne="MAIN",Je="QUALIFYING",an="CONSOLATION",Lr="VOLUNTARY_CONSOLATION",Bi="PLAY_OFF",UP=[Ne,Je,an,Bi,Lr],Lm={[Je]:1,[Ne]:2,[Bi]:3,[an]:3,[Lr]:4},H8="finishingPositions",z8="aggregateEventStructures",W8={[Ne]:1,[Bi]:2,[an]:3,[Je]:4,[Lr]:5},hSe={[Bi]:1,[Ne]:2,[an]:3,[Je]:4,[Lr]:5},SP="CLUSTER",fSe="SEPARATE",Yd="WATERFALL",TP="ITEM",_n="CONTAINER",ys="DRAW",DP="RANDOM",Bo="TOP_DOWN",Kd="BOTTOM_UP",ku="POSITION",xu="WINNER",Kl="LOSER",dl="FIRST_MATCHUP",Ha="AD_HOC",gSe="AD_HOC",gv="FEED_IN",og="COMPASS",sg="OLYMPIC",vSe="SINGLE_ELIMINATION",Qs="SINGLE_ELIMINATION",ow="DOUBLE_ELIMINATION",lg="FIRST_MATCH_LOSER_CONSOLATION",sw="FIRST_ROUND_LOSER_CONSOLATION",Pp="LUCKY_DRAW",PP="CURTIS_CONSOLATION",ISe="CURTIS_CONSOLATION",PF="FEED_IN_CHAMPIONSHIP_TO_SF",ay="FEED_IN_CHAMPIONSHIP_TO_SF",RF="FEED_IN_CHAMPIONSHIP_TO_QF",oy="FEED_IN_CHAMPIONSHIP_TO_QF",EF="FEED_IN_CHAMPIONSHIP_TO_R16",sy="FEED_IN_CHAMPIONSHIP_TO_R16",q8="MODIFIED_FEED_IN_CHAMPIONSHIP",ly="MODIFIED_FEED_IN_CHAMPIONSHIP",lw="FEED_IN_CHAMPIONSHIP",ySe="DOUBLE_ROUND_ROBIN",as="ROUND_ROBIN",Jl="ROUND_ROBIN_WITH_PLAYOFF",Y8="DECIDER",K8="BACKDRAW",CF={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},MF={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Jd="WIN_RATIO",Eh="ROUND_OUTCOME",J8=[og,PP,oy,sy,ay,lw,RF,EF,PF,lg,sw,Pp,ly,sg,Bi,Jl],bSe=[Ha,og,PP,ow,oy,sy,ay,lw,gv,lg,sw,Pp,ly,sg,Bi,as,Jl,Qs],X8={MAIN:Ne,QUALIFYING:Je,CONSOLATION:an,ITEM:TP,CONTAINER:_n,FIRST_MATCHUP:dl,WINNER:xu,LOSER:Kl,AD_HOC:Ha,FEED_IN:gv,FLEX_ROUNDS:gSe,COMPASS:og,PLAY_OFF:Bi,OLYMPIC:sg,KNOCKOUT:vSe,SINGLE_ELIMINATION:Qs,DOUBLE_ELIMINATION:ow,CURTIS:PP,FICSF:PF,FICQF:RF,FICR16:EF,MFIC:q8,VOLUNTARY_CONSOLATION:Lr,FIRST_MATCH_LOSER_CONSOLATION:lg,FIRST_ROUND_LOSER_CONSOLATION:sw,MODIFIED_FEED_IN_CHAMPIONSHIP:ly,FEED_IN_CHAMPIONSHIP_TO_R16:sy,FEED_IN_CHAMPIONSHIP_TO_QF:oy,FEED_IN_CHAMPIONSHIP_TO_SF:ay,FEED_IN_CHAMPIONSHIP:lw,LUCKY_DRAW:Pp,ROUND_ROBIN_WITH_PLAYOFF:Jl,ROUND_ROBIN:as,DECIDER:Y8,BACKDRAW:K8,COMPASS_ATTRIBUTES:CF,OLYMPIC_ATTRIBUTES:MF,DRAW:ys,RANDOM:DP,TOP_DOWN:Bo,BOTTOM_UP:Kd,WATERFALL:Yd,WIN_RATIO:Jd,ROUND_OUTCOME:Eh,MULTI_STRUCTURE_DRAWS:J8,generatedDrawTypes:bSe,stageOrder:Lm,finishOrder:W8,AGGREGATE_EVENT_STRUCTURES:z8,FINISHING_POSITIONS:H8},wSe=X8,gn="tournamentRecords",NF="policyDefinitions",Ur="tournamentRecord",AF="onlineResource",$n="drawDefinition",Q8="tieFormatName",OF="matchUpFormat",Xl="participantId",Z8="scheduleDates",USe="tournamentId",SSe="scheduleDate",TSe="roundNumber",RP="structureId",kF="participant",uw="matchUpIds",eJ="entryStage",DSe="policyType",tJ="structures",xF="eventType",wl="matchUpId",EP="tieFormat",CP="inContext",MP="structure",NP="courtIds",PSe="personId",AP="venueIds",FF="matchUps",iJ="courtId",rJ="eventId",nu="matchUp",nJ="drawId",Ko="error",td="event",vv="param",LF="uuids",RSe="averageMatchUpMinutes",ESe="recoveryMinutes",CSe="periodLength",MSe="number",ia="object",dn="array",Jr="_validate",aJ="_message",za="_invalid",Xn="_ofType",_F="_anyOf",ug="_oneOf",b2={[AF]:t=>ji(Object.keys(t),[rg,ng,ag]).length===3,[Q8]:t=>t&&Au({namedFormat:t}),[LF]:t=>!t||Array.isArray(t)&&t.every(Pi),[EP]:t=>!qn({tieFormat:t}).error,[xF]:t=>[cl,go,cr].includes(t),[eJ]:t=>UP.includes(t)},NSe={[gn]:ki,[Ur]:ve,[NF]:aP,[$n]:_e,[Xl]:fr,[OF]:Xx,[USe]:Qf,[RP]:Xa,[uw]:bh,[kF]:Sh,[AF]:Zu,[xF]:ql,[tJ]:Yx,[wl]:bn,[EP]:xl,[MP]:Tp,[iJ]:wh,[FF]:Qu,[rJ]:fo,[nu]:la,[NP]:Qe,[AP]:Qe,[nJ]:Bs,[td]:Ii},ASe={[gn]:ia,[NF]:ia,[Ur]:ia,[$n]:ia,[AF]:ia,[Z8]:dn,[kF]:ia,[uw]:dn,[tJ]:dn,[EP]:ia,[MP]:ia,[NP]:dn,[AP]:dn,[FF]:dn,[nu]:ia,[td]:ia,[LF]:dn};function We(t,e,i){if(!t&&!At(t))return{error:le};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:le};let{paramError:r,errorParam:n}=xSe(t,e);if(!r)return{valid:!0};let a=r[Jr]&&(r[Ko]||r[za])||(t==null?void 0:t[n])===void 0&&(r[Ko]||r[za]||NSe[n]||le)||le,o=n??(r[ug]&&Object.keys(r[ug]).join(", "));return te({info:{param:o,message:r[aJ]},result:{error:a},stack:i})}function oJ(t,e){let i=Object.keys(t),r=Object.keys(e);return ji(i,r)}function OSe(t,e){if(!e)return;let i=oJ(t,e);return i.length!==1?{error:le}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function kSe(t,e){if(!e)return;let i=oJ(t,e).filter(r=>t[r]);return i.length<1?{error:le}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function xSe(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:o,_validate:s,_info:l,...u})=>{let c=a&&OSe(t,a);if(c!=null&&c.error)return c.error;c&&Object.assign(u,c);let d=o&&kSe(t,o);if(d!=null&&d.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(h=>typeof u[h]=="boolean"),m=p.find(h=>{let f=s&&!fa(s),g=t[h]!==void 0&&!s&&FSe(t,h,n),v=u[h]&&[void 0,null].includes(t[h]),y=f||g||v||s&&t[h]!==void 0&&!LSe(t[h],s)||b2[h]&&!b2[h](t[h]);return y&&(i=h,r=l),y});return!p.length||m}),errorParam:i,paramInfo:r}}function FSe(t,e,i){return i=i||ASe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function LSe(t,e){return fa(e)?e(t):!0}var $F="DYNAMIC",Ac="RANKING",yc="RATING",Xd="SCALE",Fl="SEEDING",_Se={RANKING:Ac,RATING:yc,SCALE:Xd,SEEDING:Fl};function Iv(t){var e;let i=We(t,[{[kF]:!0}]);if(i.error)return i;let r=(e=t.participant.timeItems)==null?void 0:e.filter(({itemType:a})=>(a==null?void 0:a.startsWith(Xd))&&[Ac,yc,Fl].includes(a.split(".")[1])),n={ratings:{},rankings:{},seedings:{}};if(r!=null&&r.length){let a=s=>r.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,u)=>new Date(l.createdAt||void 0).getTime()-new Date(u.createdAt||void 0).getTime()).pop(),o=dt(r.map(({itemType:s})=>s));for(let s of o){let l=a(s);if(l){let[,u,c,d,p]=l.itemType.split("."),m=p?`${d}.${p}`:d,h=u===Fl&&"seedings"||u===Ac&&"rankings"||"ratings";n[h][c]||(n[h][c]=[]),n[h][c].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:m})}}}return{...Q,...n}}function _m(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,o,s){if(!a||!o)return;let l=Object.keys(a),u=Object.keys(o),c=Object.assign({},...u.filter(m=>m.indexOf("||")).map(m=>m.split("||").map(h=>({[h]:m}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let m of l)if(d.indexOf(m)>=0||p){let h=c[m]||m,f=o[h]||p,g=a[m];if(typeof f=="object"&&typeof g!="function"&&!Array.isArray(f))if(Array.isArray(g)){let v=g.map(y=>{let I={};return n(y,f,I)!==!1?I:void 0}).filter(Boolean);s[m]=v}else g&&(s[m]={},n(g,f,s[m]));else{let v=a[m];if(Array.isArray(f)&&!f.includes(v))return!1;(o[m]||p&&o[m]!==!1)&&(s[m]=v)}}}}var gM="voluntaryConsolation",pu="competitiveBands",BF="roundRobinTally",Fu="positionActions",_r="matchUpActions",ZU="rankingPoints",cg="roundNaming",yv="participant",uy="progression",id="scheduling",cy="avoidance",$Se="participant",BSe="display",vo="scoring",ko="seeding",dg="feedIn",VSe="audit",n0="draws",jSe={POLICY_TYPE_VOLUNTARY_CONSOLATION:gM,POLICY_TYPE_COMPETITIVE_BANDS:pu,POLICY_TYPE_ROUND_ROBIN_TALLY:BF,POLICY_TYPE_POSITION_ACTIONS:Fu,POLICY_TYPE_MATCHUP_ACTIONS:_r,POLICY_TYPE_RANKING_POINTS:ZU,POLICY_TYPE_ROUND_NAMING:cg,POLICY_TYPE_PARTICIPANT:yv,POLICY_TYPE_PROGRESSION:uy,POLICY_TYPE_SCHEDULING:id,POLICY_TYPE_AVOIDANCE:cy,POLICY_TYPE_DISPLAY:BSe,POLICY_TYPE_PRIVACY:$Se,POLICY_TYPE_FEED_IN:dg,POLICY_TYPE_SCORING:vo,POLICY_TYPE_SEEDING:ko,POLICY_TYPE_AUDIT:VSe,POLICY_TYPE_DRAWS:n0};function Oc({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let o=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),s=Me(o,!1,n);if(s){let l=e==null?void 0:e[yv];if(i!=null&&i.withScaleValues){let{ratings:u,rankings:c}=Iv({participant:s});s.rankings=c,s.ratings=u}if(l!=null&&l.participant)return _m({template:l.participant,source:s})}return s}var GSe="element required",HSe="missing name";function Dn(t){if(!t||typeof t!="object")return{error:Qe};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:le};if(!(t!=null&&t.name))return{error:Qe,info:HSe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=Dn({element:i,name:t.name});if(r.error)return te({result:r,stack:"removeExtension"})}return{...Q}}return{error:Qe,info:GSe}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...Q}):{...Q,info:jr}}function pl({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function _t(t){if(typeof t!="object")return{error:Qe};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return te({result:{error:le},stack:e});if(!pl({extension:t.extension}))return te({result:{error:le,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=_t({extension:t.extension,element:r});if(n.error)return te({result:n,stack:e})}return{...Q}}else return te({result:{error:Qe},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...Q}}function VF(t){return!t||typeof t!="object"?{error:Qe}:t.tournamentRecord?_t({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:ve}}function OP(t){return!t||typeof t!="object"?{error:Qe}:t.drawDefinition?_t({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:ja}}function rd(t){return!t||typeof t!="object"?{error:Qe}:t.event?_t({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:fo}}function sJ(t){var e;if(!t||typeof t!="object")return{error:Qe};if(!t.participantId)return{error:fr};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],r=Oc({participantId:t.participantId,tournamentParticipants:i});return r?_t({creationTime:t.creationTime,extension:t.extension,element:r}):{error:Wi}}function jF(t){return!t||typeof t!="object"?{error:Qe}:t.tournamentRecord?Dn({element:t.tournamentRecord,name:t.name}):{error:ve}}function lJ(t){return!t||typeof t!="object"?{error:Qe}:t.drawDefinition?Dn({element:t.drawDefinition,name:t.name}):{error:ja}}function kP(t){return!t||typeof t!="object"?{error:Qe}:t!=null&&t.event?Dn({element:t.event,name:t.name}):{error:fo}}function uJ(t){var e;if(!t||typeof t!="object")return{error:Qe};if(!t.participantId)return{error:fr};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],r=Oc({participantId:t.participantId,tournamentParticipants:i});return r?Dn({element:r,name:t.name}):{error:Wi}}function cw({tournamentRecords:t}){return{tournamentIds:At(t)?Object.keys(t):[],...Q}}var zSe="extensionQueries";function It({discover:t,element:e,name:i,...r}){var n;if(!e||!i){if(t&&r){let o=Object.keys(r).filter(u=>typeof t=="boolean"||Array.isArray(t)&&t.includes(u)).find(u=>{var c;return Array.isArray((c=r[u])==null?void 0:c.extensions)?r[u].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=o&&r[o];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(u=>{var c;return(c=u.extensions)==null?void 0:c.length}));let l=(n=s==null?void 0:s.extensions)==null?void 0:n.find(u=>(u==null?void 0:u.name)===i);return{extension:l,info:l?void 0:jr}}return te({result:{error:Qe},stack:zSe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let a=e.extensions.find(o=>(o==null?void 0:o.name)===i);return{extension:a,info:a?void 0:jr}}var WSe="activeSuspension",dy="appliedPolicies",cJ="context",xP="delegatedOutcome",Ds="disabled",$m="disableAutoCalc",FP="disableLinks",a0="display",Ed="drawDeletions",qSe="drawProfile",o0="entryProfile",YSe="eventProfile",KSe="eventWithdrawalRequests",JSe="factory",os="flightProfile",vM="groupingAttribute",Lu="lineUps",Qd="linkedTournamentsIds",LP="matchUpHistory",GF="participantRepresentatives",bv="personRequests",Sf="positionActions",XSe="rankingPoints",QSe="registration",Ul="roundTarget",dw="scheduleLimits",_u="scheduleTiming",Bm="schedulingProfile",ZSe="statusDetail",pg="subOrder",kc="tally",aI="tieFormatModification",dJ={ACTIVE_SUSPENSION:WSe,APPLIED_POLICIES:dy,CONTEXT:cJ,DELEGATED_OUTCOME:xP,DISABLED:Ds,DISABLE_LINKS:FP,DISABLE_AUTO_CALC:$m,DISPLAY:a0,DRAW_DELETIONS:Ed,DRAW_PROFILE:qSe,ENTRY_PROFILE:o0,EVENT_PROFILE:YSe,EVENT_WITHDRAWAL_REQUESTS:KSe,FLIGHT_PROFILE:os,GROUPING_ATTRIBUTE:vM,LINEUPS:Lu,LINKED_TOURNAMENTS:Qd,MATCHUP_HISTORY:LP,PARTICIPANT_REPRESENTATIVES:GF,PERSON_REQUESTS:bv,POSITION_ACTIONS:Sf,RANKING_POINTS:XSe,REGISTRATION:QSe,ROUND_TARGET:Ul,SCHEDULE_LIMITS:dw,SCHEDULE_TIMING:_u,SCHEDULING_PROFILE:Bm,STATUS_DETAIL:ZSe,SUB_ORDER:pg,TALLY:kc,TIE_FORMAT_MODIFICATIONS:aI,FACTORY:JSe},w2=[xP,Ds,$m,FP,os,Lu,Qd,LP,GF,bv,Ul,dw,_u,Bm,pg,kc,aI];function pJ({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let e=cw({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?_t({tournamentRecords:t,discover:!0,extension:{name:Qd,value:{tournamentIds:i}}}):{...Q}}function mJ({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let e=Dn({name:Qd,tournamentRecords:t,discover:!0});return te({result:e,stack:"unlinkTournaments"})}function hJ({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:le};if(!e)return{error:Qf};let i=cw({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:Qf};let n;return r.every(a=>{var o;let s=t[a],{extension:l}=It({element:s,name:Qd});if(!l)return!0;let u=((o=l==null?void 0:l.value)==null?void 0:o.tournamentIds)||[];if(!(u!=null&&u.length)||u.length===1&&u.includes(e)||a===e){let p=jF({name:Qd,tournamentRecord:s});return p.error&&(n=p.error),p.success}let c=u.filter(p=>p!==e);l.value={tournamentIds:c};let d=VF({tournamentRecord:s,extension:l});return d.error&&(n=d.error),d.success}),n?{error:n}:{...Q}}var fJ={};wt(fJ,{getLinkedTournamentIds:()=>pw,getTournamentIds:()=>cw});function pw({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:ki}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var i;let r=t[e],n=r==null?void 0:r.tournamentId,{extension:a}=It({element:r,name:Qd}),o=(((i=a==null?void 0:a.value)==null?void 0:i.tournamentIds)||[]).filter(s=>s!==n);return{[e]:o}}))}}var gJ={};wt(gJ,{adHocPositionSwap:()=>oQ,addAdHocMatchUps:()=>dR,addDrawDefinitionTimeItem:()=>zL,addFinishingRounds:()=>Rw,addGoesTo:()=>tp,addPlayoffStructures:()=>cR,addQualifyingStructure:()=>aQ,addVoluntaryConsolationStage:()=>ZX,addVoluntaryConsolationStructure:()=>OL,allPlayoffPositionsFilled:()=>GL,alternateDrawPositionAssignment:()=>jX,assignDrawPosition:()=>AQ,assignDrawPositionBye:()=>eo,attachConsolationStructures:()=>EQ,attachPlayoffStructures:()=>l_,attachQualifyingStructure:()=>HL,attachStructures:()=>uR,autoSeeding:()=>QEe,automatedPlayoffPositioning:()=>Ev,automatedPositioning:()=>Lw,checkValidEntries:()=>hR,deleteAdHocMatchUps:()=>kQ,drawMatic:()=>N_,findDrawDefinition:()=>m_,generateAdHocMatchUps:()=>fR,generateAdHocRounds:()=>M_,generateAndPopulatePlayoffStructures:()=>o_,generateDrawDefinition:()=>tU,generateDrawMaticRound:()=>b_,generateDrawStructuresAndLinks:()=>v_,generateDrawTypeAndModifyDrawDefinition:()=>I_,generateQualifyingStructure:()=>XL,generateVoluntaryConsolation:()=>aZ,getAssignedParticipantIds:()=>kp,getAvailableMatchUpsCount:()=>pR,getAvailablePlayoffProfiles:()=>$w,getDrawDefinitionTimeItem:()=>cL,getDrawParticipantRepresentativeIds:()=>d_,getDrawStructures:()=>ss,getDrawTypeCoercion:()=>qw,getEligibleVoluntaryConsolationParticipants:()=>c_,getMatchUpsMap:()=>ln,getParticipantIdFinishingPositions:()=>p_,getPositionAssignments:()=>Iy,getPositionsPlayedOff:()=>Cv,getSeedingThresholds:()=>LL,getSeedsCount:()=>Yw,getStructureSeedAssignments:()=>Io,getTeamLineUp:()=>ep,getValidGroupSizes:()=>xw,isAdHoc:()=>Yn,isCompletedStructure:()=>$c,isValidForQualifying:()=>g_,luckyLoserDrawPositionAssignment:()=>xX,modifyDrawDefinition:()=>CQ,modifyDrawName:()=>u_,modifySeedAssignment:()=>GX,mutate:()=>vJ,positionActions:()=>f_,pruneDrawDefinition:()=>NQ,qualifierDrawPositionAssignment:()=>VX,query:()=>LQ,removeDrawPositionAssignment:()=>gy,removeRoundMatchUps:()=>xQ,removeSeededParticipant:()=>nQ,removeStructure:()=>XX,renameStructures:()=>JX,resetDrawDefinition:()=>MQ,resetVoluntaryConsolationStructure:()=>OJ,setDrawParticipantRepresentativeIds:()=>IJ,setPositionAssignments:()=>$X,setStructureOrder:()=>YX,setSubOrder:()=>FQ,shiftAdHocRounds:()=>_X,swapAdHocRounds:()=>BX,swapDrawPositionAssignments:()=>iQ,updateTeamLineUp:()=>jh,withdrawParticipantAtDrawPosition:()=>RX});var vJ={};wt(vJ,{adHocPositionSwap:()=>oQ,addAdHocMatchUps:()=>dR,addDrawDefinitionTimeItem:()=>zL,addPlayoffStructures:()=>cR,addQualifyingStructure:()=>aQ,addVoluntaryConsolationStage:()=>ZX,addVoluntaryConsolationStructure:()=>OL,alternateDrawPositionAssignment:()=>jX,assignDrawPosition:()=>AQ,assignDrawPositionBye:()=>eo,attachConsolationStructures:()=>EQ,attachPlayoffStructures:()=>l_,attachQualifyingStructure:()=>HL,attachStructures:()=>uR,automatedPlayoffPositioning:()=>Ev,automatedPositioning:()=>Lw,deleteAdHocMatchUps:()=>kQ,luckyLoserDrawPositionAssignment:()=>xX,modifyDrawDefinition:()=>CQ,modifyDrawName:()=>u_,modifySeedAssignment:()=>GX,pruneDrawDefinition:()=>NQ,qualifierDrawPositionAssignment:()=>VX,removeDrawPositionAssignment:()=>gy,removeRoundMatchUps:()=>xQ,removeSeededParticipant:()=>nQ,removeStructure:()=>XX,renameStructures:()=>JX,resetDrawDefinition:()=>MQ,resetVoluntaryConsolationStructure:()=>OJ,setDrawParticipantRepresentativeIds:()=>IJ,setPositionAssignments:()=>$X,setStructureOrder:()=>YX,setSubOrder:()=>FQ,shiftAdHocRounds:()=>_X,swapAdHocRounds:()=>BX,swapDrawPositionAssignments:()=>iQ,updateTeamLineUp:()=>jh,withdrawParticipantAtDrawPosition:()=>RX});var HF=t=>e=>t[e],zF=(t=[])=>t.map(Pr).filter(Boolean),IM=(t=[])=>t.map(Tt).filter(Boolean),Tt=(t={})=>HF(t)("participantId"),Pr=(t={})=>HF(t)("matchUpId"),py=(t={})=>HF(t)("drawId");function IJ({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:ja};if(!Array.isArray(t))return{error:le};let i=IM((e==null?void 0:e.entries)||[]);return t.length&&ji(t,i).length<t.length?{error:le}:OP({drawDefinition:e,extension:{name:GF,value:t}})}var ca="ABANDONED",Ch="AWAITING_RESULT",jt="BYE",Sl="CANCELLED",Ki="COMPLETED",wv="DEAD_RUBBER",Pt="DEFAULTED",pr="DOUBLE_DEFAULT",ir="DOUBLE_WALKOVER",ms="IN_PROGRESS",Ma="INCOMPLETE",WF="NOT_PLAYED",zr="RETIRED",nd="SUSPENDED",Qi="TO_BE_PLAYED",Ft="WALKOVER",e0e=[Ch,Ki,Pt,ms,Ma,zr,nd],yJ=[Ch,Ki,Pt,ir,pr,ms,Ma,zr,nd,Ft],bJ=[ca,Ch,jt,Sl,Ki,wv,Pt,ir,pr,ms,Ma,WF,zr,nd,Qi,Ft],wJ=[jt,ir,pr,Ki,Pt,zr,Ft],UJ=[ca,Ch,Sl,wv,ms,Ma,WF,nd,Qi,void 0],yr=[Sl,ca,Ki,wv,Pt,ir,pr,zr,Ft],qF=[ca,Ki,Pt,ir,pr,ms,zr,Ft],SJ=[ms,Ma,nd,Qi],TJ={ABANDONED:ca,AWAITING_RESULT:Ch,BYE:jt,CANCELLED:Sl,COMPLETED:Ki,DEAD_RUBBER:wv,DEFAULTED:Pt,DOUBLE_WALKOVER:ir,DOUBLE_DEFAULT:pr,IN_PROGRESS:ms,INCOMPLETE:Ma,NOT_PLAYED:WF,RETIRED:zr,SUSPENDED:nd,TO_BE_PLAYED:Qi,WALKOVER:Ft};function Mh(t,e,i){var r,n;let a=m=>{var h,f;return(f=(h=It({element:m,name:Ul}))==null?void 0:h.extension)==null?void 0:f.value},o=i==null?void 0:i.deprioritizeCompleted,s=(i==null?void 0:i.mode)===z8&&hSe,l=(i==null?void 0:i.mode)===H8&&W8,u=l||s||Lm,c=m=>(m==null?void 0:m.stage)===Ne&&(m==null?void 0:m.stageSequence)===1,d=m=>c(m)?-1:u[m==null?void 0:m.stage],p=m=>m==null?void 0:m.matchUps.every(({matchUpStatus:h})=>yr.includes(h)?1:-1);return o&&p(t)-p(e)||s&&d(t)-d(e)||((t==null?void 0:t.stage)&&u[t.stage]||0)-((e==null?void 0:e.stage)&&u[e.stage]||0)||(a(t)||0)-(a(e)||0)||!l&&!s&&(((r=e==null?void 0:e.positionAssignments)==null?void 0:r.length)??1/0)-(((n=t==null?void 0:t.positionAssignments)==null?void 0:n.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(s0(t)||0)-(s0(e)||0)}function s0(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var r;let n=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).reduce((a,o)=>a+o,0);return!e||n<e?n:e},void 0)}function rt(t){let e=We(t,[{[$n]:!0,[RP]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=ss({drawDefinition:i}),a=n==null?void 0:n.map(l=>l.structures?[...l.structures].concat(l):l).flat(),o=a==null?void 0:a.find(l=>l.structureId===r);if(!o)return{error:Ni};let s=o.structureType===TP?a==null?void 0:a.find(l=>{var u;return(u=l.structures)==null?void 0:u.some(c=>c.structureId===r)}):void 0;return{structure:o,containingStructure:s}}function ss({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:o,stage:s}){var l;let u=!e&&_e||!(e!=null&&e.structures)&&Yx||void 0;if(u)return{error:u,structures:[],stageStructures:{}};let c=f=>{var g,v;let y=(v=(g=It({element:f,name:Ul}))==null?void 0:g.extension)==null?void 0:v.value;return!n||n===y},d=((l=e==null?void 0:e.structures)==null?void 0:l.filter(m).filter(h).filter(c).sort((f,g)=>Mh(f,g,a)))??[],p=t?Object.assign({},...UP.map(f=>{let g=d==null?void 0:d.filter(v=>v.stage===f);return(g==null?void 0:g.length)&&{[f]:g}}).filter(Boolean)):{};return{structures:d,stageStructures:p};function m(f){return!s&&!Array.isArray(o)||s&&f.stage===s||Array.isArray(o)&&o.includes(f.stage)}function h(f){return!r&&!Array.isArray(i)||r&&f.stageSequence===r||Array.isArray(i)&&i.includes(f.stageSequence)}}function DJ({drawDefinition:t}){if(!t)return{error:_e};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=si({structure:i}),a=(n==null?void 0:n.map(Tt).filter(Boolean))??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function si({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:_e};if({structure:i,error:r}=rt({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>si({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=e9,{positionAssignments:n,error:r}}function Mr({drawDefinition:t,structureId:e,structure:i}){var r;let n=((r=si({drawDefinition:t,structureId:e,structure:i}))==null?void 0:r.positionAssignments)||[],a=n==null?void 0:n.filter(c=>c.participantId??c.bye??c.qualifier),o=n&&(n==null?void 0:n.length)===(a==null?void 0:a.length),s=n==null?void 0:n.filter(c=>!c.participantId&&!c.bye&&!c.qualifier),l=n==null?void 0:n.filter(c=>!c.participantId&&c.bye),u=n==null?void 0:n.filter(c=>!c.participantId&&c.qualifier);return{allPositionsAssigned:o,positionAssignments:n,unassignedPositions:s,assignedPositions:a,qualifierPositions:u,byePositions:l}}var YF="addDrawDefinition",_P="addMatchUps",xc="addParticipants",KF="addScaleItems",PJ="addEvent",JF="addVenue",Iu="audit",XF="dataIssue",QF="deleteParticipants",ZF="deleteVenue",eL="deletedDrawIds",tL="deletedMatchUpIds",iL="modifyDrawDefinition",RJ="modifyDrawEntries",EJ="modifyEventEntries",rL="modifyMatchUp",on="modifyParticipants",nL="modifyPositionAssignments",aL="modifySeedAssignments",Rp="modifyTournamentDetail",Ep="modifyVenue",yM="mutations",bM="publishEvent",CJ="publishEventSeeding",MJ="publishOrderOfPlay",NJ="publishParticipants",oL="unPublishEvent",sL="unPublishEventSeeding",lL="unPublishOrderOfPlay",t0e="unPublishParticipants",$P="updateInContextMatchUp",i0e={ADD_DRAW_DEFINITION:YF,ADD_MATCHUPS:_P,ADD_PARTICIPANTS:xc,ADD_SCALE_ITEMS:KF,ADD_EVENT:PJ,ADD_VENUE:JF,AUDIT:Iu,DATA_ISSUE:XF,DELETE_PARTICIPANTS:QF,DELETE_VENUE:ZF,DELETED_DRAW_IDS:eL,DELETED_MATCHUP_IDS:tL,MODIFY_DRAW_DEFINITION:iL,MODIFY_DRAW_ENTRIES:RJ,MODIFY_EVENT_ENTRIES:EJ,MODIFY_MATCHUP:rL,MODIFY_PARTICIPANTS:on,MODIFY_POSITION_ASSIGNMENTS:nL,MODIFY_SEED_ASSIGNMENTS:aL,MODIFY_TOURNAMENT_DETAIL:Rp,MODIFY_VENUE:Ep,MUTATIONS:yM,PUBLISH_EVENT_SEEDING:CJ,PUBLISH_EVENT:bM,PUBLISH_ORDER_OF_PLAY:MJ,PUBLISH_PARTICIPANTS:NJ,UNPUBLISH_EVENT_SEEDING:sL,UNPUBLISH_EVENT:oL,UNPUBLISH_ORDER_OF_PLAY:lL,UPDATE_INCONTEXT_MATCHUP:$P};function BP(t,e){var i;if(!t)return{error:_e};let r=Date.now();t.updatedAt&&r===new Date(t.updatedAt).getTime()&&(r+=1);let n=new Date(r).toISOString(),a=e==null?void 0:e.filter(Boolean);return t.updatedAt=n,(i=t.structures)==null||i.filter(Boolean).forEach(o=>{(!(a!=null&&a.length)||a!=null&&a.includes(o.structureId))&&(o.updatedAt=n)}),{...Q}}function Fc({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&BP(t),ut({payload:{matchUps:i,tournamentId:e,eventId:r},topic:_P}),{...Q}}function ec({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&BP(t),ut({topic:tL,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)vF({key:a});return{...Q}}function Et({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&ui({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),ut({topic:rL,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...Q}):(console.log(la),{error:la})}function r0e({tournamentId:t,inContextMatchUp:e}){return e?(ut({payload:{inContextMatchUp:e,tournamentId:t},topic:$P,key:e.matchUpId}),{...Q}):{error:la}}function mw({tournamentId:t,eventId:e,drawDefinition:i}){return i?(BP(i),ut({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:YF,key:i.drawId}),{...Q}):(console.log(_e),{error:_e})}function n0e({tournamentId:t,eventId:e,drawId:i}){return ut({payload:{drawId:i,tournamentId:t,eventId:e},topic:eL,key:i}),vF({key:i}),{...Q}}function ui({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(BP(t,i),ut({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:iL,key:t.drawId}),{...Q}):{error:_e}}function AJ({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:_e};if(!i)return{error:Tp};let n=i.seedAssignments,a=i.structureId,o=t.drawId;return ut({payload:{tournamentId:e,eventId:r,drawId:o,structureId:a,seedAssignments:n},topic:aL,key:t.drawId}),ui({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...Q}}function Lc({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:_e};if(!i)return{error:Tp};let n=si({structure:i}),a=i.structureId,o=t.drawId,s=r==null?void 0:r.eventId;return ut({topic:nL,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:s,drawId:o},key:a}),ui({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:s}),{...Q}}function OJ({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){var n,a;if(!e)return{error:_e};let o=(n=e.structures)==null?void 0:n.find(l=>l.stage===Lr);if(!o)return{error:Ni};let s=((a=o.matchUps)==null?void 0:a.map(({matchUpId:l})=>l))||[];return o.positionAssignments=[],o.seedAssignments=[],o.matchUps=[],ec({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:s,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==Lr)),ui({tournamentId:t==null?void 0:t.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:e,structureIds:[o.structureId]}),{...Q}}function uL({drawPositions:t,structure:e}){var i;if([Je,Ne].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:r}=si({structure:e});(i=r==null?void 0:r.filter(({drawPosition:n})=>t==null?void 0:t.includes(n)))==null||i.forEach(n=>{_t({element:n,extension:{name:FP,value:!0}})})}function VP(t){var e,i;let{appliedPolicies:r,positionAction:n,drawDefinition:a}=t;if(((e=r==null?void 0:r.audit)==null?void 0:e[Sf])===!1)return;let{extension:o}=It({name:Sf,element:a}),s=Array.isArray(o==null?void 0:o.value)?(o==null?void 0:o.value)??[]:[];if(!(s!=null&&s.length)){let u=a.structures.find(c=>c.stage===Ne);if(u){let c=(i=si({structure:u}).positionAssignments)==null?void 0:i.map(({drawPosition:d,participantId:p,bye:m,qualifier:h})=>({drawPosition:d,participantId:p,qualifier:h,bye:m}));s.push({name:"initialMainAssignments",initialAssignments:c})}}let l={value:s.concat(n),name:Sf};_t({element:a,extension:l})}function Uv({tournamentRecord:t,drawDefinition:e,event:i}){var r;let n=((r=(t==null?void 0:t.events)||i&&[i])==null?void 0:r.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],a={},o={},s=n.map(l=>{var u;return(u=l==null?void 0:l.structures)==null?void 0:u.filter(c=>c==null?void 0:c.structures)}).flat().filter(Boolean);for(let l of s){let{structures:u,structureId:c}=l??{};u&&c&&(a[c]=u==null?void 0:u.map(d=>d.structureId))&&u.forEach(d=>o[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:a,containerStructures:o}}function jP(t){var e;let{sides:i,matchUpType:r}=t||{},n=(e=t.potentialParticipants)!=null&&e.length?t.potentialParticipants.flat().map(o=>r===ei?(o==null?void 0:o.individualParticipantIds)||[]:o.participantId).flat():[],a=(i||[]).map(o=>{var s;return r===ei&&(((s=o==null?void 0:o.participant)==null?void 0:s.individualParticipantIds)||[])||(o==null?void 0:o.participantId)&&[o.participantId]||[]}).flat();return{individualParticipantIds:a.concat(n).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:n}}function Po(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var hw="SIGN_IN_STATUS",kJ="SIGNED_OUT",my="SIGNED_IN",Gn="TEAM",Dt="INDIVIDUAL",Qa="GROUP",gt="PAIR",Jt="TEAM",oI={TEAM_PARTICIPANT:Gn,INDIVIDUAL:Dt,GROUP:Qa,TEAM:Jt,PAIR:gt},a0e={INDIVIDUAL:Dt,GROUP:Qa,PAIR:gt,TEAM:Jt,SIGN_IN_STATUS:hw,SIGNED_OUT:kJ,SIGNED_IN:my};function GP({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?Me(e,t==null?void 0:t.convertExtensions,!0):e,a=n.filter(l=>l.participantType===Jt),o=n.filter(l=>l.participantType===Qa),s=n.filter(l=>l.participantType===gt);return n.forEach(l=>{if(l.participantType===Dt){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{var p;d===u&&!((p=l.teamParticipantIds)!=null&&p.includes(c.participantId))&&(l.teamParticipantIds.push(c.participantId),r.get(c.participantId)||r.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),s.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),o.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}function xJ(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function o0e(t){let e=Object.assign({},...bc.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return xJ(e[t])}var bc=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function FJ({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n==null?void 0:n.map(({person:s})=>s)].flat().filter(Boolean);function o(s){let{nationalityCode:l}=s||{};if(l){let u=bc.find(({iso:c})=>c===l);i&&u!=null&&u.ioc&&!s.iocNationalityCode&&(s.iocNationalityCode=u.ioc),e&&u!=null&&u.iso2&&!s.iso2NationalityCode&&(s.iso2NationalityCode=u.iso2),u!=null&&u.label&&!s.countryName&&(s.countryName=u.label)}}a.forEach(o)}function s0e({participantMap:t,template:e}){var i;let r=Object.values(t);for(let n of r){let a=n.participant;if((i=a.individualParticipantIds)!=null&&i.length){a.individualParticipants=[];for(let o of a.individualParticipantIds){let s=t[o].participant;a.individualParticipants.push(e?_m({template:e,source:s}):s)}}}}function ad(t){var e;let{tournamentRecord:i,participantId:r}=t,n=t.tournamentRecords||i&&{[i.tournamentId]:i}||{};for(let a of Object.values(n)){let o=(e=a.participants)==null?void 0:e.find(s=>s.participantId===r);if(o)return{participant:o,tournamentId:a.tournamentId}}return{error:Wi}}function LJ(t){let{tournamentRecord:e,participantId:i}=t;if(i){let r=ad({tournamentRecord:e,participantId:i});return r.participant??r}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Qe}}function Ro(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=LJ(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:le,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:uF};let a=n.timeItems.filter(s=>(s==null?void 0:s.itemType)===r).filter(s=>!(i!=null&&i.length)||i.some(l=>{var u;return(u=s==null?void 0:s.itemSubTypes)==null?void 0:u.includes(l)})).sort((s,l)=>{let u=new Date(s.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),o=Me(a.pop(),!1,!0);if(o){let s={timeItem:o,...Q};return e&&Object.assign(s,{previousItems:a}),s}else return{info:jr}}function cL({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:Bs};if(!e.timeItems)return{info:jr};let{timeItem:n,previousItems:a,info:o}=Ro({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function fw({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:Ii};if(!r.timeItems)return{info:jr};let{timeItem:n,previousItems:a,info:o}=Ro({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:o}}function HP({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:ve};if(!e.timeItems)return{info:jr};let{timeItem:n,previousItems:a,info:o}=Ro({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function dL({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:ve};if(!i)return{error:fr};let a=ad({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:o}=a;if(!(o!=null&&o.timeItems))return{info:jr};let{timeItem:s,previousItems:l,info:u}=Ro({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return s&&{timeItem:s,previousItems:l}||{info:u}}var l0e={[Qa]:"groupParticipantIds",[gt]:"pairParticipantIds",[Jt]:"teamParticipantIds"},u0e={[Qa]:"groups",[Jt]:"teams"};function _J({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,withGroupings:a,internalUse:o,withISO2:s,withIOC:l}){let u=[],c={};for(let p of i.participants??[]){let m=p==null?void 0:p.participantId;m&&p0e({participantMap:c,participantId:m})}for(let p of i.participants??[]){let m=Me(p,e,o),{participantId:h,individualParticipantIds:f,participantType:g}=m;if(!c[h]){u.push(h);continue}if(Object.assign(c[h].participant,m),f){let v=d0e({individualParticipantIds:f,participantCopy:m,participantMap:c,participantType:g,participantId:h});v.missingParticipantIds.length&&u.push(...v.missingParticipantIds)}if(r&&(c[h].participant.signedIn=c0e(m)),n){let{ratings:v,rankings:y,seedings:I}=Iv({participant:m});c[h].participant.seedings=I,c[h].participant.rankings=y,c[h].participant.ratings=v}(l||s)&&FJ({participant:c[h].participant,withISO2:s,withIOC:l})}if(t){let p=At(t)?t:void 0;s0e({participantMap:c,template:p})}let d;return a&&(d=GP({participants:Object.values(c).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:u,participantMap:c,groupInfo:d}}function c0e(t){let{timeItem:e}=Ro({itemType:hw,element:t});return(e==null?void 0:e.itemValue)===my}function d0e({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){var a;let o=[];for(let s of t){let l=(a=i[s])==null?void 0:a.participant;if(!l){o.push(s);continue}if(l[l0e[r]].push(n),[Jt,Qa].includes(r)){let{participantRoleResponsibilities:u,participantOtherName:c,participantName:d,participantId:p,teamId:m}=e,h=u0e[r];l[h].push({participantRoleResponsibilities:u,participantOtherName:c,participantName:d,participantId:p,teamId:m})}if(r===gt){let u=t.find(c=>c!==s);i[s].pairIdMap[n]=u,i[s].pairIdMap[u]=n}}return{missingParticipantIds:o}}function p0e({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[ri]:{...i},[ei]:{...i},[Jt]:{...i},...i}}}function Cp({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){if(e)return _J({...t,...r,tournamentRecord:i});let a=Me(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&a.forEach(s=>FJ({participant:s,...t}));let o;if((n||t!=null&&t.withGroupings)&&a!=null&&a.length&&({participantsWithGroupings:a,groupInfo:o}=GP({participantsProfile:t,deepCopy:!1,participants:a})),(t==null?void 0:t.withScaleValues)&&(a==null?void 0:a.length))for(let s of a){let{ratings:l,rankings:u}=Iv({participant:s});s.rankings=u,s.ratings=l}return{participants:a,groupInfo:o}}function Bt({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:Qx};let o={};return i&&s(i),a&&s(a),r&&s(r),n&&s(n),{appliedPolicies:o,...Q};function s(l){var u,c;let d=(c=(u=l==null?void 0:l.extensions)==null?void 0:u.find(p=>p.name===dy))==null?void 0:c.value;if(d)for(let p of Object.keys(d))(t?e.includes(p):!e.length||e.includes(p))&&(o[p]=Me(d[p],!1,!0))}}function tc({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:Qx};let{appliedPolicies:a}=Bt({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),o={};for(let s of t){let l=a==null?void 0:a[s];l&&(o[s]=l)}return Object.keys(o).length?{policyDefinitions:o}:{info:eg.message}}var $J="WALKOVER",U2="RETIRED",pL="COMPETITIVE",hy="ROUTINE",fy="DECISIVE",eS="winRatio",m0e={[pu]:{policyName:"Competitive Bands Default",profileBands:{[fy]:20,[hy]:50}}},mL=m0e;function ic({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let o=tc({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[pu])??(o==null?void 0:o[pu])??mL[pu];a.policies[pu]=s}return a}function Mp({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:ve};let{appliedPolicies:a}=Bt({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a!=null&&a[i]?{policy:a[i]}:{info:eg==null?void 0:eg.message}}function gw({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){var n,a,o,s,l,u;e=e??((n=r==null?void 0:r.category)==null?void 0:n.categoryName)??((a=r==null?void 0:r.category)==null?void 0:a.ageCategoryCode),i=i??((o=r==null?void 0:r.category)==null?void 0:o.categoryType)??((s=r==null?void 0:r.category)==null?void 0:s.subType);let{policy:c}=Mp({policyType:id,tournamentRecord:t,event:r}),d=(l=t?It({element:t,name:_u}).extension:void 0)==null?void 0:l.value,p=(u=r&&It({name:_u,element:r}).extension)==null?void 0:u.value;return{scheduleTiming:{tournamentScheduling:d,eventScheduling:p,categoryName:e,categoryType:i,policy:c}}}function hL({drawDefinition:t,attributes:e}){let{extension:i}=It({element:t,name:o0}),r=(i==null?void 0:i.value)||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:o0,value:r},OP({drawDefinition:t,extension:i}),{entryProfile:r}}function vw({drawDefinition:t}){let{extension:e}=It({element:t,name:o0});return{entryProfile:(e==null?void 0:e.value)||{}}}var Jo="ALTERNATE",Iw="CONFIRMED",da="DIRECT_ACCEPTANCE",yw="FEED_IN",bw="JUNIOR_EXEMPT",$u="LUCKY_LOSER",ww="ORGANISER_ACCEPTANCE",Uw="QUALIFIER",h0e="REGISTERED",Sw="SPECIAL_EXEMPT",Eo="UNGROUPED",Np="UNPAIRED",mg="WILDCARD",Ql="WITHDRAWN",tS=[Iw,da,bw,ww,Sw],BJ=[yw,$u,Uw],Ap=[Iw,da,yw,bw,ww,Sw,mg],hs=[Iw,da,bw,$u,Uw,ww,Sw,mg],VJ=[Jo,Iw,da,yw,bw,$u,ww,Uw,h0e,Sw,Eo,Np,mg,Ql],f0e={ALTERNATE:Jo,CONFIRMED:Iw,DIRECT_ACCEPTANCE:da,DIRECT_ENTRY_STATUSES:Ap,DRAW_SPECIFIC_STATUSES:BJ,EQUIVALENT_ACCEPTANCE_STATUSES:tS,FEED_IN:yw,JUNIOR_EXEMPT:bw,LUCKY_LOSER:$u,ORGANISER_ACCEPTANCE:ww,QUALIFIER:Uw,SPECIAL_EXEMPT:Sw,STRUCTURE_SELECTED_STATUSES:hs,UNGROUPED:Eo,UNPAIRED:Np,VALID_ENTRY_STATUSES:VJ,WILDCARD:mg,WITHDRAWN:Ql};function fL({stage:t,drawDefinition:e}){let{entryProfile:i}=vw({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&UP.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return hL({drawDefinition:e,attributes:n}),!0}return r}function g0e({stage:t,drawDefinition:e}){var i;let{entryProfile:r}=vw({drawDefinition:e});return((i=r[t])==null?void 0:i.alternates)||0}function v0e({stage:t,drawDefinition:e}){var i;let{entryProfile:r}=vw({drawDefinition:e});return((i=r[t])==null?void 0:i.wildcardsCount)||0}function wM({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function Nh({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:o,stages:s,stage:l}){var u;let c=((u=i.entries)==null?void 0:u.reduce((d,p)=>{var m,h;let f=(h=(m=It({name:Ul,element:p}))==null?void 0:m.extension)==null?void 0:h.value,g=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),v=!n||p.entryStatus&&n.includes(p.entryStatus),y=p.entryStageSequence??1;return g&&(!r||y===r)&&v&&(!o||!f||o===f)?d.concat(p):d},[]))??[];if(a&&l===Bi){let{playoffEntries:d,error:p}=I0e({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:c).filter(m=>!e||m.placementGroup===e)}return c}function I0e({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===ku&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:o}=n.source,{structure:s}=rt({drawDefinition:e,structureId:o});(s==null?void 0:s.structureType)===_n&&(s.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(f=>{var g;let{participantId:v}=f,y=(g=It({element:f,name:kc}).extension)==null?void 0:g.value;return y&&v?{[v]:y}:void 0}).filter(Boolean)),m=Object.keys(p).reduce((f,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return f.includes(y)||f.push(y),f},[]).length===Object.keys(p).length,h=Object.keys(p).filter(f=>{let g=p[f],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||m)&&h.forEach(f=>{let g=p[f],{groupOrder:v,provisionalOrder:y,GEMscore:I}=g,b=v||t&&y,S=[...a??[]].sort(ur).indexOf(b)+1;r.push({entryStage:Bi,entryStatus:yw,placementGroup:S,groupingValue:d,participantId:f,GEMscore:I})})})}return{playoffEntries:r}}function y0e({stage:t,drawDefinition:e}){return Ap.reduce((i,r)=>(wM({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function Io({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){var a;let o,s=[];n||({structure:n,error:o}=rt({drawDefinition:i,structureId:r}));let l=si({structure:n}).positionAssignments;if(o||!n)return{seedAssignments:[],error:Ni};r||(r=n.structureId);let{stage:u,stageSequence:c}=n,d=u===Bi&&i&&Nh({provisionalPositioning:t,drawDefinition:i,stageSequence:c,structureId:r,stage:u}),p=d?d.filter(f=>f.placementGroup===1).sort((f,g)=>f.GEMscore<g.GEMscore&&1||f.GEMscore>g.GEMscore&&-1||0).map((f,g)=>{let v=g+1;return{participantId:f.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],m=p==null?void 0:p.slice(0,e?p.length:l.length/2);m.length?s=m:n.seedAssignments?s=n.seedAssignments:o=HK;let h=n.seedLimit??((a=n==null?void 0:n.positionAssignments)==null?void 0:a.length);return{seedAssignments:s,stageSequence:c,seedLimit:h,stage:u,error:o}}function Gs(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function sI({item:t,drawDefinition:e,structure:i,event:r}){var n,a,o;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((n=e.tieFormats)==null?void 0:n.find(s=>t.tieFormatId===s.tieFormatId))||(r.tieFormat?r.tieFormat:(a=r.tieFormats)==null?void 0:a.find(s=>t.tieFormatId===s.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(o=e.tieFormats)==null?void 0:o.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function In({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:sI({item:i,drawDefinition:t,structure:e,event:r})||sI({item:e,drawDefinition:t,structure:e,event:r})||Gs(t)||Gs(r)}}function b0e({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function ln({drawDefinition:t,structure:e}){let i={},r=[];return((t==null?void 0:t.structures)??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:o,structures:s}=n,l=Array.isArray(s);if(l)l&&s.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=o;i[a]={matchUps:u,itemStructureIds:[]},u==null||u.forEach(c=>{r.push(c),c.tieMatchUps&&r.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function Zd({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=(e==null?void 0:e.mappedMatchUps)??t;let n=t[i],a=((n==null?void 0:n.itemStructureIds)||[]).map(o=>{let{matchUps:s,structureName:l}=t[o];return r?s.map(u=>Object.assign(Me(u,!0,!0),{containerStructureId:i,structureId:o,structureName:l})):s}).flat();return((n==null?void 0:n.matchUps)||[]).concat(...a)}function jJ({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=Cr(t,t.length/e).map(n=>n.reduce((a,o)=>a+o)),r=i.slice().sort(ur);return i.map(n=>r.indexOf(n)+1)}function zP(t){if(!At(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>st(a)||a===void 0||a===null);return r&&n}function Co(t){return Array.isArray(t)?t.every(zP):!1}function An({matchUps:t=[],interpolate:e}){var i;if(!Co(t))return{roundMatchUps:[],error:le};let r=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?tt(m.roundNumber):m.roundNumber;return!m.roundNumber||p.includes(h)?p:p.concat(h)},[]).sort(ur).map(p=>{let m=t.filter(g=>g.roundNumber===p),h=m.find(({matchUpType:g})=>g===gi)?m.filter(({matchUpType:g})=>g===gi):m,f=g=>g.sort((v,y)=>ur(v.roundPosition,y.roundPosition));return{[p]:f(h)}}),n=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?tt(m.roundNumber):m.roundNumber;return p[h]||(p[h]=Ge({abbreviatedRoundName:m.abbreviatedRoundName,finishingRound:m.finishingRound,roundName:m.roundName})),p},{}),a=Object.assign({},...r);if(e){let p=Math.max(...Object.keys(a).map(h=>tt(h)).filter(h=>!isNaN(h))),m=(i=a[p])==null?void 0:i.length;if(m>1&&Os(m)){let h=p+1,f=h+m/2;De(h,f).forEach((g,v)=>{a[g]=De(0,m/(2+v*2)).map(()=>({}))})}}let o=0,s=Object.assign({},...Object.keys(a).map(p=>{var m,h,f;let g=(m=a[p])==null?void 0:m.length,v=(f=(h=a[p])==null?void 0:h.filter(I=>{var b;return!yr.includes(I.matchUpStatus)&&!((b=I.score)!=null&&b.scoreStringSide1)}))==null?void 0:f.length,y=g&&g===v;return o=Math.max(o,g),{[p]:{matchUpsCount:g,inactiveCount:v,inactiveRound:y}}})),l=0,u=0,c=Object.keys(a).map(p=>tt(p)).filter(p=>!isNaN(p));c.forEach(p=>{var m,h,f,g,v;let y=a[p].sort((b,S)=>b.roundPosition-S.roundPosition),I=y.map(b=>(b==null?void 0:b.drawPositions)||[]).flat();if(s[p].roundNumber=p,s[p].roundFactor=s[p].matchUpsCount?o/s[p].matchUpsCount:1,s[p].finishingRound=(m=n[p])==null?void 0:m.finishingRound,s[p].roundName=(h=n[p])==null?void 0:h.roundName,s[p].abbreviatedRoundName=(f=n[p])==null?void 0:f.abbreviatedRoundName,s[p].finishingPositionRange=(v=(g=a[p])==null?void 0:g[0])==null?void 0:v.finishingPositionRange,p===1||!s[p-1]){let b=I.sort(ur),S=Cr(b,2);s[p].drawPositions=b,s[p].pairedDrawPositions=S}else{let b=s[p-1],S=b.drawPositions,w=b.matchUpsCount/s[p].matchUpsCount,U=Cr(S,w),T=y.map(D=>{let{roundPosition:P}=D,E=[...D.drawPositions||[],void 0,void 0].slice(0,2);if(!P)return E;let R=(E==null?void 0:E.filter(Boolean))||[];if(!(R!=null&&R.length))return[void 0,void 0];if(p<3&&(R==null?void 0:R.length)===2)return E==null?void 0:E.slice().sort(ur);let N=ji(S,R).length!==(R==null?void 0:R.length);if(R!=null&&R.length&&N)return(R==null?void 0:R.length)===1?[R[0],void 0]:E==null?void 0:E.slice().sort(ur);let A=(P-1)*2;return U.slice(A,A+2).map(M=>R==null?void 0:R.find(C=>M.includes(C)))});s[p].drawPositions=T==null?void 0:T.flat(),s[p].pairedDrawPositions=T}s[p+1]&&s[p+1].matchUpsCount===s[p].matchUpsCount&&(s[p+1].feedRound=!0,s[p+1].feedRoundIndex=u,s[p].preFeedRound=!0,u+=1),s[p]&&!s[p].feedRound&&(s[p].roundIndex=l,l+=1)});let d=!!Object.values(s).find(({matchUpsCount:p})=>!Os(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:d,maxMatchUpsCount:o,roundMatchUps:a,roundNumbers:c,roundProfile:s,...Q}}function iS(t){if(!Array.isArray(t))return"";let e=t.filter(xi);return e.length?dt([Math.min(...e),Math.max(...e)]).join("-"):""}function w0e({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:_e};if(!e)return{error:Xa};let{structure:r}=rt({drawDefinition:t,structureId:e});if((r==null?void 0:r.stage)!==an)return{error:Dp,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=(n==null?void 0:n.filter(d=>d.target.structureId===e))||[],o=(a==null?void 0:a.reduce((d,p)=>{let{structureId:m}=p.source;return d.includes(m)?d:d.concat(m)},[]))||[],s=Object.assign({},...o.map(d=>{let p=Zd({structureId:d,matchUpsMap:i}),m=An({matchUps:p}).roundProfile;return{[d]:m}})),l=Zd({matchUpsMap:i,structureId:e}),{roundProfile:u}=An({matchUps:l}),c={};return a==null||a.forEach(d=>{var p,m,h;let{structureId:f,roundNumber:g}=d.source,{feedProfile:v,groupedOrder:y,positionInterleave:I,roundNumber:b}=d.target,S=s[f],w=(p=S[1])==null?void 0:p.drawPositions,U=(m=S[g])==null?void 0:m.matchUpsCount;if(!U)return;let T=U?w.length/U:0,D=w.length/T,P=w.slice(),E=jJ({roundPositionsCount:D,groupedOrder:y}),R=(E==null?void 0:E.length)||1;if(R<=D){let M=w.length/R,C=Cr(P,M);v===Kd&&C.forEach(O=>O.reverse()),P=(E==null?void 0:E.length)&&(E==null?void 0:E.map(O=>C[O-1]).flat())||P}let N=Cr(P,T);if(I){let M=De(0,I.interleave).map(()=>{}),C=De(0,I.offset).map(()=>{});N=N.map(k=>[k,...M]),N.unshift(C),N=N.flat(1);let O=N.length-I.offset;N=N.slice(0,O)}c[b]||(c[b]={});let A=(h=u==null?void 0:u[b])!=null&&h.feedRound?2:1;N.forEach((M,C)=>{let O=1+C*A;c[b][O]||(c[b][O]=iS(M))})}),{sourceDrawPositionRanges:c}}function GJ({drawDefinition:t}){if(typeof t!="object")return{error:dm};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((o,s)=>{let{stage:l}=s;return o[l]?o[l].push(s):o[l]=[s],o},{});for(let o of Object.keys(n)){let s=n[o].find(({stageSequence:u})=>u===1);if(!s)continue;let{structureId:l}=s;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:o})}return{exitProfiles:e};function a({exitProfiles:o,exitProfile:s,structureId:l,targetRound:u,aggregator:c,stage:d}){o[l]||(o[l]=[]),s==="0"&&[an,Bi].includes(d)||o[l].push(s);let p=r.filter(m=>m.source.structureId===l&&m.source.roundNumber>=u);for(let m of p){let h=m.source.roundNumber,f=m.target.roundNumber,g=m.target.structureId,v=i.find(I=>I.structureId===g).stage,y=[v,g,f,h].join("|");if(c[y])return;c[y]=!0,a({exitProfile:`${s}-${h}`,structureId:g,exitProfiles:o,targetRound:f,aggregator:c,stage:v})}}}function U0e({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){var n;if(!t)return{error:_e};if(!i)return{error:Xa};if(!e){let s=Zd({matchUpsMap:r,structureId:i});if({roundProfile:e}=An({matchUps:s}),!e)return{error:Qe}}let a=(Math.min(...((n=e==null?void 0:e[1])==null?void 0:n.drawPositions)??[])||1)-1,o=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(o||[]).map(s=>{var l,u;let c=(l=e==null?void 0:e[s])==null?void 0:l.matchUpsCount,d=((u=e==null?void 0:e[1])==null?void 0:u.drawPositions)??[],p=Cr(d,d.length/c),m=p.map(iS),h=p.map(I=>I.map(b=>b-a)).map(iS),f=o.map(I=>{var b;if(I>s)return;let S=((b=e==null?void 0:e[I])==null?void 0:b.drawPositions)??[];return Cr(S,S.length/c)}).filter(Boolean),g=De(0,c).map(I=>f.map(b=>b[I]).flat().filter(Boolean).sort(ur)).map(I=>dt(I)),v=g.map(I=>Bwe(I).map(iS).join(", ")),y=Object.assign({},...De(0,c).map(I=>({[I+1]:{firstRoundDrawPositionsRange:m[I],firstRoundOffsetDrawPositionsRange:h[I],possibleDrawPositions:g[I],drawPositionsRange:v[I]}})));return{[s]:y}}))}}function gL({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){var n;if(!i)return!1;r=r??i.matchUps??[],t=t??An({matchUps:r}).roundsNotPowerOf2;let a=!!((n=i.positionAssignments)!=null&&n.find(({drawPosition:o})=>o))||!!(r!=null&&r.find(({drawPositions:o})=>o==null?void 0:o.length));return(!(e!=null&&e.drawType)||e.drawType!==Pp)&&!(i!=null&&i.structures)&&t&&a}function Yn({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(n=>n==null?void 0:n.roundPosition)),r=!!(e!=null&&e.find(n=>{var a;return(a=n==null?void 0:n.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==Lr&&(!e.length||!i&&!r)}var vL={[cg]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Ne]:"",[Bi]:"P",[Je]:"Q",[an]:"C"}}},S0e=vL;function T0e({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){var n,a,o;let{roundProfile:s,roundMatchUps:l}=An({matchUps:r}),{structureAbbreviation:u,stage:c}=i,d=Yn({structure:i}),p=gL({structure:i}),m=i.structures,h={},f=vL[cg],g=i.stage===Je,v=g?Math.max(...((e==null?void 0:e.structures)??[]).filter(M=>M.stage===Je).map(({stageSequence:M})=>M??1),0):0,y=(i.stageSequence??1)<v?i.stageSequence??1:"",I=y&&(((n=t==null?void 0:t.affixes)==null?void 0:n.preQualifying)||f.affixes.preQualifying)||"",b=(t==null?void 0:t.roundNamingMap)||f.roundNamingMap||{},S=(t==null?void 0:t.abbreviatedRoundNamingMap)||f.abbreviatedRoundNamingMap||{},w=((a=t==null?void 0:t.affixes)==null?void 0:a.preFeedRound)||f.affixes.preFeedRound,U=((o=t==null?void 0:t.affixes)==null?void 0:o.roundNumber)||f.affixes.roundNumber,T=((t==null?void 0:t.namingConventions)||f.namingConventions).round,D=c&&c!==Ne?c[0]:"",P=(t==null?void 0:t.stageConstants)||f.stageConstants,E=c&&(P==null?void 0:P[c])||D,R=`${I}${E}${y}`,N=s?Object.keys(s):[],A=g&&P!=null&&P[Je]?`${P==null?void 0:P[Je]}-`:"";if(m||d||p)Object.assign(h,...N.map(M=>{let C=`${A}${T} ${M}`,O=`${U}${M}`;return{[M]:{roundName:C,abbreviatedRoundName:O}}}));else{let M=g&&((t==null?void 0:t.qualifyingFinishMap)||(f==null?void 0:f.qualifyingFinishMap)||{});Object.assign(h,...N.map(C=>{if(!(s!=null&&s[C]))return;let{matchUpsCount:O,preFeedRound:k}=s[C],x=O*2,F=(M==null?void 0:M[s==null?void 0:s[C].finishingRound])||M&&`${U}${x}`||b[O]||`${U}${x}`,$=k?`-${w}`:"",_=`${F}${$}`,L=[R,u,_].filter(Boolean).join("-"),B=`${S[O]||`${U}${x}`}${$}`,V=[R,u,B].filter(Boolean).join("-");return{[C]:{abbreviatedRoundName:V,roundName:L}}}))}return{roundNamingProfile:h,roundProfile:s,roundMatchUps:l}}var D0e=(t,e)=>(t||0)+(e||0);function HJ(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&$J||i<=e[fy]&&fy||i<=e[hy]&&hy||pL}function zJ({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(D0e)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function P0e(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function WJ(t){return t.map(P0e).sort().map(e=>parseFloat(e.toFixed(2)))}function Tw({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:la};let{score:r,winningSide:n}=i;if(!n)return{error:le};let a=!e&&t&&Mp({policyType:pu,tournamentRecord:t}).policy,o=e||(a==null?void 0:a.profileBands)||mL[pu].profileBands,s=zJ({score:r}),l=WJ([s]),u=HJ(l,o),c=Array.isArray(l)?l[0]:l;return{...Q,competitiveness:u,pctSpread:c}}function qJ({matchUp:t}){var e,i,r;if(!t)return{error:la};if(t&&!t.sides)return{error:ua};if(t&&!t.hasContext)return{error:dP};let n=(e=t.sides??[])==null?void 0:e.map(u=>u==null?void 0:u.participantId).filter(Boolean),a=((i=t.sides)==null?void 0:i.filter(u=>{var c;return((c=u.participant)==null?void 0:c.participantType)===Dt}).map(u=>u.participantId).filter(Boolean))??[],o=(((r=t.sides??[])==null?void 0:r.map(u=>{var c;return(c=u.participant)==null?void 0:c.individualParticipants}).filter(Boolean))??[]).map(u=>(u??[]).map(c=>c==null?void 0:c.participantId).filter(Boolean)),s=[...a,...o.flat()].filter(Boolean)??[],l=dt(s.concat(n)).filter(Boolean)??[];return{nestedIndividualParticipantIds:o,allRelevantParticipantIds:l,individualParticipantIds:s,sideParticipantIds:n,...Q}}var l0="CHECK_IN",u0="CHECK_OUT",R0e="SCHEDULE",Ah="SCHEDULE.ASSIGNMENT.VENUE",Zl="SCHEDULE.ALLOCATION.COURTS",_c="SCHEDULE.ASSIGNMENT.COURT",WP="SCHEDULE.COURT.ORDER",Oh="SCHEDULE.DATE",E0e="COMPLETED.DATE",IL="HOME_PARTICIPANT_ID",yL="SCHEDULE.ASSIGN.OFFICIAL",kh="SCHEDULE.TIME.SCHEDULED",bs="SCHEDULE.TIME.START",yu="SCHEDULE.TIME.STOP",Ll="SCHEDULE.TIME.RESUME",Bu="SCHEDULE.TIME.END",qP="SCHEDULE.TIME.MODIFIERS",YJ="TO_BE_ANNOUNCED",KJ="NEXT_AVAILABLE",JJ="FOLLOWED_BY",XJ="AFTER_REST",QJ="RAIN_DELAY",C0e="NOT_BEFORE",UM=[YJ,KJ,JJ,XJ,QJ],M0e="ELIGIBILITY",N0e="REGISTRATION",A0e="SUSPENSION",O0e="MEDICAL",k0e="PENALTY",ZJ="SCALE",eX="RATING",tX="RANKING",bL="SEEDING",od="PUBLISH",Za="PUBLIC",sd="STATUS",x0e="MODIFICATION",F0e="RETRIEVAL",L0e="other",_0e={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:UM,AFTER_REST:XJ,ALLOCATE_COURTS:Zl,ASSIGN_COURT:_c,ASSIGN_OFFICIAL:yL,ASSIGN_VENUE:Ah,CHECK_IN:l0,CHECK_OUT:u0,COMPLETED_DATE:E0e,COURT_ORDER:WP,ELIGIBILITY:M0e,END_TIME:Bu,FOLLOWED_BY:JJ,MEDICAL:O0e,MODIFICATION:x0e,NEXT_AVAILABLE:KJ,NOT_BEFORE:C0e,OTHER:L0e,PENALTY:k0e,PUBLIC:Za,PUBLISH:od,RANKING:tX,RATING:eX,RAIN_DELAY:QJ,REGISTRATION:N0e,RESUME_TIME:Ll,RETRIEVAL:F0e,SCALE:ZJ,SCHEDULE:R0e,SCHEDULED_DATE:Oh,SCHEDULED_TIME:kh,SEEDING:bL,START_TIME:bs,STATUS:sd,STOP_TIME:yu,SUSPENSION:A0e,TIME_MODIFIERS:qP,TO_BE_ANNOUNCED:YJ};function xh({matchUp:t}){if(!t)return{error:la};if(!t.hasContext)return{error:dP};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:ua};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=qJ({matchUp:t}),n=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[l0,u0].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(s=>s.itemValue).filter(s=>n.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===l0);e==null||e.forEach((s,l)=>{let u=r==null?void 0:r[l],c=(s==null?void 0:s.length)&&s.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),r==null||r.forEach((s,l)=>{a.includes(s)&&((e==null?void 0:e[l])??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let o=r==null?void 0:r.reduce((s,l)=>a.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...Q}}var Ji=t=>e=>{let i=At(e)&&(e==null?void 0:e.matchUpType)||Pi(e)&&e;return i&&TK[t].includes(i)};function lI(t){var e;let{matchUpAverageTimes:i,matchUpFormat:r}=t||{},n=(i==null?void 0:i.map(({matchUpFormatCodes:o})=>o==null?void 0:o.filter(s=>s===r)).flat().filter(Boolean).sort((o,s)=>((o==null?void 0:o.length)||0)-((s==null?void 0:s.length)||0)))||[],a=n.includes(r)?r:n[0];return(e=i==null?void 0:i.find(({matchUpFormatCodes:o,averageTimes:s})=>(o==null?void 0:o.find(l=>a===l))&&s))==null?void 0:e.averageTimes}function uI(t){var e;let{matchUpRecoveryTimes:i,averageMinutes:r,matchUpFormat:n}=t||{};return(e=i==null?void 0:i.find(({matchUpFormatCodes:a,averageTimes:o,recoveryTimes:s})=>{if(o&&r){let{greaterThan:l=0,lessThan:u=360}=o;if(r>l&&r<u)return!0}return(a==null?void 0:a.find(l=>l===n))&&s}))==null?void 0:e.recoveryTimes}function iX({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>{var o,s;return(((o=a.categoryNames)==null?void 0:o.length)||0)-(((s=n.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:n,categoryNames:a})=>!(a!=null&&a.length)&&!(n!=null&&n.length)||(a==null?void 0:a.includes(e))||(n==null?void 0:n.includes(i)))).find(Boolean)}function $0e({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:o,policy:s}){var l;let u=(e==null?void 0:e.matchUpRecoveryTimes)&&uI({...e,averageMinutes:i,matchUpFormat:n}),c=(t==null?void 0:t.matchUpRecoveryTimes)&&uI({...t,averageMinutes:i,matchUpFormat:n}),d=(s==null?void 0:s.matchUpRecoveryTimes)&&uI({...s,averageMinutes:i,matchUpFormat:n}),p=[u,c,d,(l=s==null?void 0:s.defaultTimes)==null?void 0:l.recoveryTimes,r==null?void 0:r.recoveryTimes];return iX({categoryName:a,categoryType:o,timesBlockArray:p})}function B0e({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:o}){var s;let l=(a==null?void 0:a.matchUpAverageTimes)&&lI({...a,matchUpFormat:t}),u=(n==null?void 0:n.matchUpAverageTimes)&&lI({...n,matchUpFormat:t}),c=(o==null?void 0:o.matchUpAverageTimes)&&lI({...o,matchUpFormat:t}),d=[l,u,c,(s=o==null?void 0:o.defaultTimes)==null?void 0:s.averageTimes,r==null?void 0:r.averageTimes];return iX({categoryName:e,categoryType:i,timesBlockArray:d})}var rX="DOUBLES_SINGLES",nX="SINGLES_DOUBLES",Xo="total",SM="participantConflict",cc="matchUpConflict",aX="ISSUE_IDS",md="CONFLICT",hd="WARNING",TM="ERROR",DM="ISSUE",rS="STATE",V0e={SINGLES_DOUBLES:nX,DOUBLES_SINGLES:rX,TOTAL:Xo,CONFLICT_MATCHUP_ORDER:cc,CONFLICT_PARTICIPANTS:SM,SCHEDULE_ISSUE_IDS:aX,SCHEDULE_CONFLICT:md,SCHEDULE_WARNING:hd,SCHEDULE_ERROR:TM,SCHEDULE_ISSUE:DM,SCHEDULE_STATE:rS};function Dw({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:s}){if(!i)return{error:ve};o=o??(s==null?void 0:s.eventType)??Fm;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=gw({tournamentRecord:i,categoryName:n,categoryType:a,event:s}),c={...u,matchUpFormat:r,categoryType:a,defaultTiming:l};return YP({eventType:o,timingDetails:c})}function YP({timingDetails:t,eventType:e}){let i=B0e(t),r=Object.keys((i==null?void 0:i.minutes)||{}),n=(i==null?void 0:i.minutes)&&((r==null?void 0:r.includes(e))&&i.minutes[e]||i.minutes.default),a=$0e({...t,averageMinutes:n}),o=Object.keys((a==null?void 0:a.minutes)||{}),s=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),l=Ji(Fm)(e)?nX:rX,u=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(l))&&a.minutes[l]||s);return{averageMinutes:n,recoveryMinutes:s,typeChangeRecoveryMinutes:u}}function BE(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Op({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>BE(n)-BE(a)).pop(),r=i&&BE(i);return{itemValue:i==null?void 0:i.itemValue,timeStamp:r}}function oX({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Op({timeItems:(i==null?void 0:i.timeItems)||[],itemType:kh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function Fh({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Op({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Oh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function Vp(t){if(n8.test(t)){let e=wF();return new Date(`${e}T${t}`)}else return new Date(t)}function j0e({matchUp:t}){if(!t)return{error:la};if(!t.timeItems)return{error:uF};let e=t.timeItems.filter(r=>[bs,yu,Ll,Bu].includes(r==null?void 0:r.itemType)).sort((r,n)=>Vp(r.itemValue).getTime()-Vp(n.itemValue).getTime()),i=e.reduce((r,n)=>{var a,o;let s,l=(a=n==null?void 0:n.itemType)==null?void 0:a.split("."),u=`SCHEDULE.TIME.${((o=n==null?void 0:n.itemType)==null?void 0:o.startsWith("SCHEDULE.TIME"))&&l[2]}`;switch(u){case bs:s=0;break;case Bu:if(r.lastValue&&[bs,Ll].includes(r.lastType)){let c=Vp(n.itemValue).getTime()-Vp(r.lastValue).getTime();s=r.milliseconds+c}else s=r.milliseconds;break;case yu:if([bs,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let c=Vp(n.itemValue).getTime()-Vp(r.lastValue).getTime();s=r.milliseconds+c}else s=r.milliseconds;break;default:s=r.milliseconds;break}return{milliseconds:s,lastType:u,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([bs,Ll].includes(i.lastType)){let r=new Date().getTime()-Vp(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:G0e(i.milliseconds),relevantTimeItems:e}}function G0e(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function H0e({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],r=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{startTime:(e=i.reduce((n,a)=>{let o=a.itemType===bs&&a;return o&&(!n||r(o)<r(n))?o:n},void 0))==null?void 0:e.itemValue}}function Pw(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:le};let n=Po(t);i.venueId||(i.venueId=Ht());let a;for(let o of Object.values(n)){let s=z0e({disableNotice:!0,tournamentRecord:o,context:r,venue:i});if(s!=null&&s.error)return s;a=s.venue}return e||ut({topic:JF,payload:{venue:i}}),Ge({...Q,venue:a})}function z0e({tournamentRecord:t,disableNotice:e,context:i,venue:r}){return t?r?(t.venues||(t.venues=[]),r.venueId||(r.venueId=Ht()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0)?{error:P9}:(i&&_t({element:r,extension:{value:i,name:cJ}}),t.venues.push(r),e||ut({payload:{venue:r,tournamentId:t.tournamentId},topic:JF}),{...Q,venue:Me(r)})):{error:Qe,info:"missing venue"}:{error:ve}}function au({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:ve};if(!i)return{error:ed};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(pw({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let o=t[a],s=au({tournamentRecord:o,venueId:i});if(s.success&&s.venue)return Pw({tournamentRecord:e,venue:s.venue}),{...Q,venue:r}}}return r?{...Q,venue:r}:{error:Th}}function wL({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=au({tournamentRecords:i,tournamentRecord:r,venueId:n});return Me(a,t,!0)}function Lh({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:ve};if(!i)return{error:wh};let r="findCourt",n,a;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(s=>{s.courtId===i&&(n=s,a=o)})}),n)return{...Q,court:n,venue:a};if(t){let o=(pw({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of o){let l=t[s],u=Lh({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&Pw({tournamentRecord:e,venue:u.venue}),{...Q,court:n,venue:a}}}return te({result:{error:mv},stack:r})}function UL(t){return Me(Lh(t),!1,!0)}function KP({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:ve};if(!i)return{error:wh};let r=Lh({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f})=>({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f}))(r.court);return{...Q,courtInfo:Me(n,!1,e)}}function hg(t){var e;let i=We(t,[{[Ur]:!0},{venueId:!0,[Ko]:ed}]);if(i.error)return i;let{tournamentRecord:r,venueId:n}=t,a=au({tournamentRecord:r,venueId:n});if(a.error)return a;let o=(((e=a.venue)==null?void 0:e.courts)??[]).map(u=>(({courtInfo:c})=>({...c}))(KP({courtId:u.courtId,internalUse:!0,tournamentRecord:r}))),s=a.venue&&(({venueId:u,venueName:c,venueAbbreviation:d})=>({venueAbbreviation:d,venueName:c,venueId:u}))(a.venue),l=s&&{...s,courtsInfo:o};return{...Q,venueData:Me(l,!1,!0)}}function W0e({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],r=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{endTime:(e=i.reduce((n,a)=>{let o=a.itemType===Bu&&a;return o&&(!n||r(o)>r(n))?o:n},void 0))==null?void 0:e.itemValue}}function Hi({event:t,eventId:e}){var i,r;if(!t)return{error:Ii};let n=(i=It({name:os,element:t}))==null?void 0:i.extension,a=e?Me(n==null?void 0:n.value,!1,!0):n==null?void 0:n.value;return e&&((r=t.drawDefinitions)==null||r.forEach(o=>{var s;(s=a==null?void 0:a.flights)==null||s.forEach(l=>{l.drawId===o.drawId&&Object.assign(l,{drawDefinition:o})})})),{flightProfile:a}}function Kn(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},o=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(o).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(r){let u,c=s.find(d=>{var p,m,h;let f=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===r);if(f)u=f,l=a[d.eventId].tournamentId;else{let g=(h=(m=d&&((p=Hi({event:d}))==null?void 0:p.flightProfile))==null?void 0:m.flights)==null?void 0:h.find(v=>v.drawId===r);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:r}}return f});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=s.find(c=>(c==null?void 0:c.eventId)===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...te({result:{error:fo},stack:n})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...te({result:{error:ja},context:{drawId:r,eventId:i},stack:n})}}function JP(t){var e,i,r,n,a,o,s,l,u,c;let d=t.event,p=t.matchUpType,{scheduleVisibilityFilters:m,afterRecoveryTimes:h,tournamentRecord:f,usePublishState:g,scheduleTiming:v,matchUpFormat:y,publishStatus:I,matchUp:b}=t;if(!b)return{error:la};if(h&&!b.matchUpType&&!t.matchUpType&&(d||f)&&b.drawId){let M=t.drawDefinition||((e=d==null?void 0:d.drawDefinitions)==null?void 0:e.find(O=>O.drawId===b.drawId));!M&&f&&({drawDefinition:M,event:d}=Kn({drawId:b.drawId,tournamentRecord:f}));let C=b.structureId&&((i=M==null?void 0:M.structures)==null?void 0:i.find(({structureId:O})=>O===b.structureId));p=t.matchUpType||(C==null?void 0:C.matchUpType)||(M==null?void 0:M.matchUpType)||(d==null?void 0:d.eventType)!==cr&&(d==null?void 0:d.eventType)}let{milliseconds:S,time:w}=j0e({matchUp:b}),{startTime:U}=H0e({matchUp:b}),{endTime:T}=W0e({matchUp:b}),D,{eventIds:P,drawIds:E}=m??{};if((!P||P.includes(b.eventId))&&(!E||E.includes(b.drawId))){let M=ne=>ne.createdAt?new Date(ne.createdAt).getTime():0,C=new Map,O=((r=b.timeItems)==null?void 0:r.toSorted((ne,de)=>M(ne)-M(de)))??[];for(let ne of O)C.set(ne.itemType,ne.itemValue);let k=C.get(IL),x=C.get(Zl),F=C.get(kh),$=C.get(qP),_=C.get(Oh),L=C.get(yL),B=C.get(WP),V=C.get(Ah),G=C.get(_c),j,z,W,q,Y,re=b.matchUpType??p;if(v&&F&&h&&re){let ne={matchUpFormat:b.matchUpFormat??y,...v};({averageMinutes:z=0,recoveryMinutes:W=0,typeChangeRecoveryMinutes:q=0}=YP({timingDetails:ne,eventType:re})),(z||W)&&(j=T?na(Si(T),W):na(F,z+W)),q&&(Y=T?na(Si(T),q):na(F,z+q))}!_&&F&&(_=ht(F));let J=ZS({scheduledDate:_,scheduledTime:F}),H={},Z=((n=f&&V&&hg({tournamentRecord:f,venueId:V}))==null?void 0:n.venueData)||{};V&&(H[V]=Z);let{venueName:K,venueAbbreviation:ie,courtsInfo:ae}=Z,oe=(a=G&&(ae==null?void 0:ae.find(ne=>ne.courtId===G)))==null?void 0:a.courtName;for(let ne of x||[]){if(!f)break;ne.venueId&&!H[ne.venueid]&&(H[ne.venueId]=(o=hg({venueId:ne.venueId,tournamentRecord:f}))==null?void 0:o.venueData);let de=H[ne.venueId];ne.venueName=de==null?void 0:de.venueName;let ye=(s=de==null?void 0:de.courtsInfo)==null?void 0:s.find(ce=>ce.courtId===ne.courtId);ne.courtName=ye==null?void 0:ye.courtName}D=Ge({typeChangeTimeAfterRecovery:Y,timeAfterRecovery:j,scheduledDate:_,scheduledTime:F,isoDateString:J,homeParticipantId:k,venueAbbreviation:ie,allocatedCourts:x,timeModifiers:$,venueName:K,venueId:V,courtOrder:B,courtName:oe,courtId:G,official:L,typeChangeRecoveryMinutes:q,recoveryMinutes:W,averageMinutes:z,milliseconds:S,startTime:U,endTime:T,time:w})}else D=Ge({milliseconds:S,startTime:U,endTime:T,time:w});let{scheduledDate:R}=Fh({matchUp:b}),{scheduledTime:N}=oX({matchUp:b});if(g&&(l=I==null?void 0:I.displaySettings)!=null&&l.draws){let M=I.displaySettings.draws,C=(u=(M==null?void 0:M[b.drawId])??(M==null?void 0:M.default))==null?void 0:u.scheduleDetails;if(C){let O=(c=C.find(k=>{var x;return R&&((x=k.dates)==null?void 0:x.includes(R))})??C.find(k=>{var x;return!((x=k.dates)!=null&&x.length)}))==null?void 0:c.attributes;if(O){let k=Object.assign({},...Object.keys(D).map(x=>({[x]:!0})),O);D=_m({source:D,template:k})}}}let A=b.matchUpStatus&&yr.includes(b.matchUpStatus)&&(ht(T)||ht(R)||ht(N))||void 0;return{schedule:D,endDate:A}}function q0e({drawPositions:t,roundProfile:e,roundNumber:i}){var r;let n=[void 0,void 0];if(NK(t))return{orderedDrawPositions:n,displayOrder:n};let a=e==null?void 0:e[i],o=((r=a==null?void 0:a.pairedDrawPositions)==null?void 0:r.find(l=>Nn(l||[],t.filter(Boolean))))??n,s=a==null?void 0:a.feedRound;if(MK(t)){let l=[...t].sort(ur);return{orderedDrawPositions:l.length===2?l:o,displayOrder:s?l:o}}if(s){let l=[t.find(u=>!isNaN(tt(u))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:o,displayOrder:o}}function c0({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=s=>s===void 0?-1:s,o=i.map(s=>{let{collectionAssignments:l,participantId:u}=s,c=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((s,l)=>a(s.substitutionOrder)-a(l.substitutionOrder));for(let s of o){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=s;r.includes(l)||(u&&n.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),r=r.filter(d=>d!==u),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function ls({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:ve};if(!Array.isArray(i)||i.length>2)return{error:ba};if(!i.length)return te({result:{error:Zc},stack:r});t=t??(e==null?void 0:e.participants)??[];let n=t.filter(s=>s.participantType===gt&&ji(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),a=n[0];if(!a)return te({result:{error:Wi},stack:r});let o=Me(n.slice(1),!1,!0);return{participant:Me(a),duplicatedPairParticipants:o,...Q}}function ep({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:_e};if(typeof e!="string")return{error:fr};let{extension:i}=It({element:t,name:Lu});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function Y0e({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:m})=>{var h,f,g,v;let{assignedParticipantIds:y,substitutions:I}=c0({collectionPosition:i,collectionId:o,lineUp:p});if(l===ei){if((y==null?void 0:y.length)<=2){let b=(f=(h=n==null?void 0:n[y[0]])==null?void 0:h.pairIdMap)==null?void 0:f[y[1]],S=(v=b&&((g=n[b])==null?void 0:g.participant)||ls({participantIds:y,tournamentParticipants:t}).participant)==null?void 0:v.participantId;return{[d]:{participantId:S,teamParticipant:m,substitutions:I}}}else if((y==null?void 0:y.length)>2)return{[d]:{teamParticipant:m,substitutions:I}}}else{let b=y==null?void 0:y[0];return b&&{[d]:{participantId:b,teamParticipant:m,substitutions:I}}}};if(!(r!=null&&r.length)){let d=(s==null?void 0:s.map(p=>{var m;let{teamParticipant:h,sideNumber:f}=p,g=p.lineUp||((m=ep({participantId:h.teamParticipantId,drawDefinition:a}))==null?void 0:m.lineUp);return u({attribute:f,lineUp:g,teamParticipant:h})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=(r==null?void 0:r.map(d=>{var p,m,h;let f=(p=e.find(I=>I.drawPosition===d))==null?void 0:p.participantId,g=s==null?void 0:s.find(I=>(I==null?void 0:I.drawPosition)===d),v=(g==null?void 0:g.teamParticipant)||f&&((m=n==null?void 0:n[f])==null?void 0:m.participant)||(t==null?void 0:t.find(({participantId:I})=>I===f)),y=(g==null?void 0:g.lineUp)||((h=ep({participantId:f,drawDefinition:a}))==null?void 0:h.lineUp);return u({attribute:d,lineUp:y,teamParticipant:v})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function XP(t){var e,i,r;let n=We(t,[{[nu]:!0}]);if(n.error)return n;let a=t==null?void 0:t.matchUp,o=a==null?void 0:a.matchUpType;if(!o&&(e=a==null?void 0:a.sides)!=null&&e.length){let s=(r=(i=a.sides.find(({participant:l})=>l))==null?void 0:i.participant)==null?void 0:r.participantType;o=s===Dt&&ri||s===gt&&ei||s===Jt&&Jt||void 0}return{matchUpType:o}}function K0e({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:o,sideNumber:s}){var l,u,c,d;let p=i.find(v=>v.drawPosition&&v.drawPosition===a),m=a&&t,h=s&&e,f=m?(l=m[a])==null?void 0:l.participantId:p==null?void 0:p.participantId,g=p?J0e({displaySideNumber:r,seedAssignments:n,participantId:f,assignment:p,sideNumber:s}):{...h==null?void 0:h[s]};if(o&&(s===1?Object.assign(g,{participantFed:!0}):Object.assign(g,{participantAdvanced:!0})),a&&m){let v=(u=m[a])==null?void 0:u.teamParticipant,y=(c=m[a])==null?void 0:c.participant,I=(d=m[a])==null?void 0:d.substitutions;y&&(g.participant=y),I&&(g.substitutions=I),v&&(g.teamParticipant=v)}return g}function J0e({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let o=X0e({seedAssignments:e,participantId:i});Object.assign(a,o,{participantId:i}),o!=null&&o.seedNumber&&(o==null?void 0:o.seedValue)===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function X0e({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}function sX({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:o,initialRoundOfPlay:s,additionalContext:l,roundNamingProfile:u,tournamentRecord:c,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:m,seedAssignments:h,usePublishState:f,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:I,drawDefinition:b,publishStatus:S,scoringActive:w,matchUpTieId:U,isRoundRobin:T,roundProfile:D,sideLineUps:P,structure:E,context:R,matchUp:N,event:A}){var M,C,O,k,x,F,$,_,L,B,V,G,j,z,W;l=l??{};let q=(M=In({drawDefinition:b,structure:E,matchUp:N,event:A}))==null?void 0:M.tieFormat,{roundOffset:Y,structureId:re,structureName:J,stage:H,stageSequence:Z}=E,{drawId:K,drawName:ie,drawType:ae}=b??{},oe=q==null?void 0:q.collectionDefinitions,ne=N.collectionId&&(oe==null?void 0:oe.find(be=>be.collectionId===N.collectionId)),de=N.collectionId?ne==null?void 0:ne.matchUpFormat:N.matchUpFormat??(E==null?void 0:E.matchUpFormat)??(b==null?void 0:b.matchUpFormat)??(A==null?void 0:A.matchUpFormat),ye=N.matchUpType||(ne==null?void 0:ne.matchUpType)||(E==null?void 0:E.matchUpType)||(b==null?void 0:b.matchUpType)||!Ji(cr)(A==null?void 0:A.eventType)&&(A==null?void 0:A.eventType),ce=m?jt:N.matchUpStatus,{schedule:ke,endDate:we}=JP({scheduleVisibilityFilters:t,afterRecoveryTimes:o,tournamentRecord:c,usePublishState:f,scheduleTiming:y,drawDefinition:b,matchUpFormat:de,publishStatus:S,matchUpType:ye,matchUp:N,event:A}),Ze=d??N.drawPositions??[],{collectionPosition:pt,collectionId:he,roundPosition:fe}=N,pe=N.roundNumber??l.roundNumber,Fe=he?Y0e({tournamentParticipants:i,positionAssignments:r,collectionPosition:pt,participantMap:g,drawDefinition:b,drawPositions:Ze,collectionId:he,sideLineUps:P,matchUpType:ye}):void 0,Se=((C=u==null?void 0:u[pe])==null?void 0:C.roundName)||l.roundName,He=((O=u==null?void 0:u[pe])==null?void 0:O.abbreviatedRoundName)||l.abbreviatedRoundName,ue=(k=D==null?void 0:D[pe])==null?void 0:k.feedRound,me=(x=D==null?void 0:D[pe])==null?void 0:x.preFeedRound,Ue=(F=D==null?void 0:D[pe])==null?void 0:F.roundFactor,$e=n==null?void 0:n[pe],Ee=fe?$e==null?void 0:$e[fe]:void 0,Be=e==null?void 0:e[pe],xe=ne!=null&&ne.category?{...(R==null?void 0:R.category)||{},...ne.category}:(R==null?void 0:R.category)??(A==null?void 0:A.category),qe=(($=N.processCodes)==null?void 0:$.length)&&N.processCodes||((_=ne==null?void 0:ne.processCodes)==null?void 0:_.length)&&(ne==null?void 0:ne.processCodes)||((L=E==null?void 0:E.processCodes)==null?void 0:L.length)&&(E==null?void 0:E.processCodes)||((B=b==null?void 0:b.processCodes)==null?void 0:B.length)&&(b==null?void 0:b.processCodes)||((V=A==null?void 0:A.processCodes)==null?void 0:V.length)&&(A==null?void 0:A.processCodes)||(c==null?void 0:c.processCodes),Pe=(I==null?void 0:I.withCompetitiveness)&&Tw({...v,matchUp:N}),at=N.finishingPositionRange??l.finishingPositionRange,di=be=>Ge(be,void 0,!0),Ae={...di(R),...di({matchUpFormat:N.matchUpType===cr?void 0:de,tieFormat:N.matchUpType!==cr?void 0:q,gender:(ne==null?void 0:ne.gender)??(A==null?void 0:A.gender),roundOfPlay:H!==Je&&st(s)&&s+(pe||0),endDate:N.endDate??we,discipline:A==null?void 0:A.discipline,category:xe,finishingPositionRange:at,abbreviatedRoundName:He,drawPositionsRange:Ee,competitiveProfile:Pe,structureName:J,stageSequence:Z,drawPositions:Ze,matchUpStatus:ce,processCodes:qe,isRoundRobin:T,matchUpTieId:U,preFeedRound:me,matchUpType:ye,roundFactor:Ue,roundOffset:Y,structureId:re,roundNumber:pe,feedRound:ue,roundName:Se,drawName:ie,drawType:ae,schedule:ke,drawId:K,stage:H}),...Me(di(N),!0,!0)};if(de&&(G=N.score)!=null&&G.scoreStringSide1){let be=Ln(de),{bestOf:Ct,finalSetFormat:Re,setFormat:Ye}=be??{};(Re!=null&&Re.tiebreakSet||Ye!=null&&Ye.tiebreakSet||Ye!=null&&Ye.timed)&&(Ae.score.sets=Ae.score.sets.sort((xt,Fi)=>xt.setNumber-Fi.setNumber).map((xt,Fi)=>(Fi+1===Ct?(Re!=null&&Re.tiebreakSet||Re!=null&&Re.timed)&&(xt.tiebreakSet=!0):(Ye!=null&&Ye.tiebreakSet||Ye!=null&&Ye.timed)&&(xt.tiebreakSet=!0),xt)))}if(Array.isArray(Ze)){let{orderedDrawPositions:be,displayOrder:Ct}=q0e({drawPositions:Ze,roundProfile:D,roundNumber:pe}),Re=(j=D==null?void 0:D[pe])==null?void 0:j.feedRound,Ye=Ct[0]!==be[0],xt=be.concat(void 0,void 0).slice(0,2).map((Fi,bi)=>{var pi;let Li=bi+1,un=Ye?3-Li:Li,er=K0e({...Fe,positionAssignments:r,displaySideNumber:un,seedAssignments:h,drawPosition:Fi,isFeedRound:Re,sideNumber:Li}),Qn=(pi=N.sides)==null?void 0:pi.find(lE=>lE.sideNumber===Li),to=fe?(fe-1)*2+bi+1:void 0,$p=to?Be==null?void 0:Be[to]:void 0;return di({sourceDrawPositionRange:$p,...Qn,...er})});Object.assign(Ae,Me({sides:xt},!0,!0))}if(i&&Ae.sides){let be=p==null?void 0:p[yv],Ct=Re=>{var Ye;let xt=(Ye=g==null?void 0:g[Re])==null?void 0:Ye.participant;return xt&&_m({template:be==null?void 0:be.participant,source:xt})};if(Ae.sides.filter(Boolean).forEach(Re=>{var Ye,xt,Fi,bi;if(Re.participantId){let pi=Me(Ct(Re.participantId)||(i?Oc({policyDefinitions:p,participantId:Re.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:I}):void 0),void 0,!0);if(pi){let Li,un;if(b!=null&&b.entries){let er=b.entries.find(to=>to.participantId===Re.participantId),Qn=(Ye=A==null?void 0:A.entries)==null?void 0:Ye.find(to=>to.participantId===Re.participantId);Li=(er==null?void 0:er.entryStatus)||(Qn==null?void 0:Qn.entryStatus),pi.entryStatus=Li,er!=null&&er.entryStage&&(un=er.entryStage,pi.entryStage=un)}a!==!1?Object.assign(Re,{participant:pi}):Object.assign(Re,{participant:{entryStage:un,entryStatus:Li}})}}if((Fi=(xt=Re==null?void 0:Re.participant)==null?void 0:xt.individualParticipantIds)!=null&&Fi.length&&!((bi=Re.participant.individualParticipants)!=null&&bi.length)){let pi=Re.participant.individualParticipantIds.map(Li=>Ct(Li)||(i?Oc({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:I,participantId:Li}):void 0));a!==!1&&Object.assign(Re.participant,{individualParticipants:pi})}}),!Ae.matchUpType){let{matchUpType:Re}=XP({matchUp:Ae});Re&&Object.assign(Ae,{matchUpType:Re})}if(I!=null&&I.inferGender&&(!Ae.gender||Ae.gender===jn)&&((z=Ae.sides)==null?void 0:z.length)===2&&Ae.matchUpType!==cr){let Re=Ae.sides.map(Ye=>{var xt,Fi,bi,pi;if(Ji(ri)(Ae.matchUpType))return(Fi=(xt=Ye.participant)==null?void 0:xt.person)==null?void 0:Fi.sex;if(((pi=(bi=Ye.participant)==null?void 0:bi.individualParticipants)==null?void 0:pi.length)===2){let Li=dt(Ye.participant.individualParticipants.map(un=>{var er;return(er=un.person)==null?void 0:er.sex})).filter(Boolean);if(Li.length===1)return Li[0]}});if(Re.filter(Boolean).length===2&&dt(Re).length===1){let Ye=Re[0];Ae.inferredGender=Ye}}}if(Ae.tieMatchUps){let be=Ae.matchUpStatus===jt,Ct=(W=Ae.sides)==null?void 0:W.map(({participant:Re,drawPosition:Ye,sideNumber:xt,lineUp:Fi})=>{let bi=(Re==null?void 0:Re.participantType)===cr&&Re;return{teamParticipant:bi&&Ge({participantRoleResponsibilities:bi.participantRoleResponsibilities,participantOtherName:bi.participanOthertName,participantName:bi.participantName,participantId:bi.participantId,teamId:bi.teamId}),drawPosition:Ye,sideNumber:xt,lineUp:Fi}});Ae.tieMatchUps=Ae.tieMatchUps.map(Re=>{let Ye=Ae.matchUpId,xt={finishingPositionRange:Ae.finishingPositionRange,abbreviatedRoundName:He,roundNumber:pe,roundName:Se};return sX({tieDrawPositions:Ze,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:Ct,drawPositionsRanges:n,initialRoundOfPlay:s,roundNamingProfile:u,additionalContext:xt,appliedPolicies:p,isCollectionBye:be,usePublishState:f,publishStatus:S,matchUpTieId:Ye,isRoundRobin:T,roundProfile:D,matchUp:Re,event:A,tournamentParticipants:i,positionAssignments:r,tournamentRecord:c,seedAssignments:h,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:I,drawDefinition:b,scoringActive:w,structure:E,context:R})})}let yt=Ae.sides&&Ae.sides.filter(be=>be==null?void 0:be.participantId).length===2,yi=!Ae.winningSide;if(Object.assign(Ae,{readyToScore:w&&yt&&yi,hasContext:!0}),yt){let{allParticipantsCheckedIn:be,checkedInParticipantIds:Ct}=xh({matchUp:Ae});Object.assign(Ae,{allParticipantsCheckedIn:be,checkedInParticipantIds:Ct})}return Array.isArray(I==null?void 0:I.exclude)&&(I==null||I.exclude.forEach(be=>delete Ae[be])),Ae}function Q0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Op({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Zl});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:Me(r,!1,!0)}:e}function Z0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Op({timeItems:(i==null?void 0:i.timeItems)||[],itemType:_c});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function eTe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Op({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Ah});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function mu(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:o,matchUpFormats:s,roundPositions:l,matchUpFormat:u,collectionIds:c,isMatchUpTie:d,roundNumbers:p,matchUpIds:m,roundNames:h,filterMatchUpTypes:f=!0,filterMatchUpIds:g=!0,stageSequences:v,scheduledDates:y,scheduledDate:I,participantIds:b,processContext:S,tournamentIds:w,matchUpTypes:U,structureIds:T,readyToScore:D,courtIds:P,eventIds:E,venueIds:R,drawIds:N,stages:A}=t,M=Array.isArray(b)?b.filter(Boolean):[],C=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],k=Array.isArray(A)?A.filter(Boolean):[],x=Array.isArray(v)?v.filter(Boolean):[],F=Array.isArray(c)?c.filter(Boolean):[],$=Array.isArray(h)?h.filter(Boolean):[],_=Array.isArray(p)?p.filter(Boolean):[],L=Array.isArray(l)?l.filter(Boolean):[],B=Array.isArray(m)&&g?m.filter(Boolean):[],V=Array.isArray(U)&&f?U.filter(Boolean):[],G=Array.isArray(P)?P.filter(Boolean):[],j=Array.isArray(R)?R.filter(Boolean):[],z=Array.isArray(s)&&s.filter(Boolean)||typeof u=="string"&&[u]||[],W=Array.isArray(y)&&y.filter(Boolean)||typeof I=="string"&&I.length&&[I]||[],q=Array.isArray(w)?w.filter(Boolean):[],Y=Array.isArray(E)?E.filter(Boolean):[],re=Array.isArray(N)?N.filter(Boolean):[],J=Array.isArray(T)?T.filter(Boolean):[];return e.filter(H=>{var Z;if(D&&!Ji(Va)(H)&&!H.readyToScore||H.winningSide&&o&&![1,2].includes(H.winningSide)||d!==void 0&&(d&&!H.tieMatchUps||!d&&H.tieMatchUps)||n!==void 0&&(n&&!H.collectionId||!n&&H.collectionId)||k.length&&!k.includes(H.stage)||x.length&&!x.includes(H.stageSequence)||F.length&&(!H.collectionId||!F.includes(H.collectionId))||$.length&&(!H.roundName||!$.includes(H.roundName))||_.length&&(!H.roundNumber||!_.includes(H.roundNumber))||L.length&&(!H.roundPosition||!L.includes(H.roundPosition))||C.length&&(!H.matchUpStatus||!C.includes(H.matchUpStatus))||O.length&&H.matchUpStatus&&O.includes(H.matchUpStatus)||B.length&&!B.includes(H.matchUpId)||V.length&&(!H.matchUpType||!iP(V,H.matchUpType))||z.length&&(!H.matchUpFormat||!z.includes(H.matchUpFormat)))return!1;if(W!=null&&W.length){let{scheduledTime:K}=oX({matchUp:H}),{scheduledDate:ie}=Fh({matchUp:H}),ae=ht(K)||ie;if(!W.find(oe=>Yl(oe,ae)))return!1}if(G.length){let{courtId:K}=Z0e({matchUp:H}),{allocatedCourts:ie}=Q0e({matchUp:H}),ae=ie==null?void 0:ie.map(({courtId:oe})=>oe);if(!G.filter(Boolean).includes(K)||ae!=null&&ae.includes(K))return!1}if(j.length){let{venueId:K}=eTe({matchUp:H});if(!j.filter(Boolean).includes(K))return!1}if(S){if(q.length&&!q.includes(H.tournamentId)||Y.length&&!Y.includes(H.eventId)||re.length&&!re.includes(H.drawId)||J.length&&!J.includes(H.structureId))return!1;let K=((Z=H.sides)==null?void 0:Z.map(({participantId:ie})=>ie).filter(Boolean))??[];if(r&&K.length<r||M.length&&!M.some(ie=>K.includes(ie)))return!1}return!0})}function qt(t){var e,i,r,n,a,o,s;let{provisionalPositioning:l,tournamentRecord:u,contextFilters:c,matchUpFilters:d,contextProfile:p,drawDefinition:m,context:h={},structure:f,inContext:g,event:v}=t,{seedAssignments:y,contextContent:I,exitProfiles:b,matchUpsMap:S}=t,w={},U={};if(!f)return{collectionPositionMatchUps:w,error:Tp,roundMatchUps:U,matchUps:[]};let T=Array.isArray(d==null?void 0:d.eventIds)?d==null?void 0:d.eventIds.filter(Boolean):[],D=Array.isArray(d==null?void 0:d.structureIds)?d==null?void 0:d.structureIds.filter(Boolean):[],P=Array.isArray(d==null?void 0:d.drawIds)?d==null?void 0:d.drawIds.filter(Boolean):[],E=!(h!=null&&h.eventId)||!(T!=null&&T.length)&&!((e=c==null?void 0:c.eventIds)!=null&&e.filter(Boolean).length)||(T==null?void 0:T.includes(h.eventId))||((i=c==null?void 0:c.eventIds)==null?void 0:i.includes(h.eventId)),R=!(D!=null&&D.length)||D.includes(f.structureId),N=!m||!(P!=null&&P.length)||P.includes(m.drawId);if(!E||!R||!N)return{collectionPositionMatchUps:w,roundMatchUps:U,matchUps:[]};p&&!I&&(I=ic({tournamentRecord:u,contextProfile:p,drawDefinition:m}));let{appliedPolicies:A}=Bt({drawDefinition:m}),M={...t.tournamentAppliedPolicies,...A,...t.policyDefinitions},C=(r=M==null?void 0:M.scoring)==null?void 0:r.structures,O=f.stage&&((n=C==null?void 0:C.stage)==null?void 0:n[f.stage]),k=f.stageSequence&&((a=O==null?void 0:O.stageSequence)==null?void 0:a[f.stageSequence]),x=((o=M==null?void 0:M.scoring)==null?void 0:o.requireAllPositionsAssigned)||(O==null?void 0:O.requireAllPositionsAssigned)||(k==null?void 0:k.requireAllPositionsAssigned);S||(S=ln({drawDefinition:m,structure:f}));let{positionAssignments:F,allPositionsAssigned:$}=Mr({structure:f}),_=!x||$,{seedAssignments:L}=Io({provisionalPositioning:l,drawDefinition:m,structure:f});y=y??L;let{structureId:B}=f;b=b||m&&GJ({drawDefinition:m}).exitProfiles;let V=b==null?void 0:b[B],G=(V==null?void 0:V.length)&&(V[0].split("-").map(J=>parseInt(J)).reduce((J,H)=>J+H)||0),j=!!f.structures,z=Zd({matchUpsMap:S,structureId:B,inContext:g}),W=M==null?void 0:M[cg],q=T0e({roundNamingPolicy:W,drawDefinition:m,structure:f,matchUps:z}),{roundNamingProfile:Y,roundProfile:re}=q;if(U=(q==null?void 0:q.roundMatchUps)??[],d&&(z=mu({matchUps:z,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),g){let{sourceDrawPositionRanges:J}=w0e({drawDefinition:m,matchUpsMap:S,structureId:B}),H=m?U0e({drawDefinition:m,roundProfile:re,matchUpsMap:S,structureId:B}).drawPositionsRanges:void 0,Z=t.tournamentParticipants,K=t.participantMap;!(Z!=null&&Z.length)&&!K&&u&&({participants:Z=[],participantMap:K}=Cp({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:u,contextProfile:p,inContext:g})),z=z.map(ie=>sX({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:J,tournamentParticipants:Z,positionAssignments:F,drawPositionsRanges:H,initialRoundOfPlay:G,roundNamingProfile:Y,tournamentRecord:u,appliedPolicies:M,seedAssignments:y,contextContent:I,participantMap:K,contextProfile:p,drawDefinition:m,scoringActive:_,isRoundRobin:j,roundProfile:re,structure:f,context:h,matchUp:ie,event:v})),(z==null?void 0:z.filter(ie=>Array.isArray(ie.tieMatchUps))).forEach(ie=>{let ae=ie.tieMatchUps;z=z.concat(...ae)}),c&&(z=mu({processContext:!0,...c,matchUps:z}))}else(z==null?void 0:z.filter(J=>Array.isArray(J.tieMatchUps))).forEach(J=>{let H=J.tieMatchUps;z=z.concat(...H)});return d&&(z=mu({matchUps:z,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(z=mu({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:z})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||g)&&(U=An({matchUps:z}).roundMatchUps??[]),(s=In({drawDefinition:m,structure:f,event:v}))!=null&&s.tieFormat&&({collectionPositionMatchUps:w}=b0e({matchUps:z})),{collectionPositionMatchUps:w,roundMatchUps:U,isRoundRobin:j,roundProfile:re,matchUpsMap:S,matchUps:z}}function Cd({matchUp:t}){return t?yr.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function QP({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:m,publishStatus:h,contextProfile:f,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structureId:I,inContext:b,structure:S,context:w,event:U}){!S&&I&&({structure:S}=rt({drawDefinition:g,structureId:I}));let T=qt({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:m,publishStatus:h,contextProfile:f,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structure:S,inContext:b,context:w,event:U}),D=[],P=[],E=[],R=[],N=[];if(T.error)return T;let{matchUps:A}=T,{assignedPositions:M}=Mr({structure:S}),C=M==null?void 0:M.filter(k=>k.participantId).map(k=>k.drawPosition),O;return A.filter(k=>{var x;let F=((x=u==null?void 0:u.matchUpTypes)==null?void 0:x.length)===1&&u.matchUpTypes[0]===gi;return!(k.matchUpType!==gi&&F)}).forEach(k=>{var x,F,$,_;if(k.matchUpStatus===ca){D.push(k);return}k.matchUpType===gi&&(O=!0);let L=k.collectionId,B=L&&((x=k.sides)==null?void 0:x.every(q=>q.participantId)),V=!L&&((F=k.drawPositions)==null?void 0:F.filter(Boolean).length)===2,G=!L&&(($=k.drawPositions)==null?void 0:$.every(q=>C==null?void 0:C.includes(q))),j=M==null?void 0:M.filter(q=>q.bye).map(q=>q.drawPosition),z=!L&&((_=k.drawPositions)==null?void 0:_.find(q=>j==null?void 0:j.includes(q))),W=SJ.includes(k.matchUpStatus)&&(B||V&&(!t||G));return z?N.push(k):Cd({matchUp:k})?P.push(k):W?E.push(k):R.push(k)}),{includesTeamMatchUps:O,abandonedMatchUps:D,completedMatchUps:P,upcomingMatchUps:E,pendingMatchUps:R,byeMatchUps:N,structure:S}}function tTe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:_e};if(!i)return{error:Xa};let{links:r}=Sv({drawDefinition:t,structureId:i}),n=r.source.reduce((o,s)=>!s.source.roundNumber||s.source.roundNumber===e?o.concat(s):o,[]),a=r.target.reduce((o,s)=>!s.target.roundNumber||s.target.roundNumber===e?o.concat(s):o,[]);return{links:{source:n,target:a}}}function VE({finishingPositions:t,linkCondition:e,linkType:i,source:r}){var n;let a=r.find(o=>{var s,l;let u=!((s=o.source)!=null&&s.finishingPositions)||!t||Nn(t,(l=o.source)==null?void 0:l.finishingPositions);return e===o.linkCondition&&u&&o.linkType===i});return[xu,Kl].includes(a==null?void 0:a.linkType)&&!((n=a==null?void 0:a.source)!=null&&n.roundNumber)?te({result:{error:le},stack:"getTargetLink",context:a}):a}function Sv({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>{var a,o;return((a=n.source)==null?void 0:a.structureId)===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),((o=n.target)==null?void 0:o.structureId)===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r},{source:[],target:[]})}:{error:Xa}:{error:_e}}function iTe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(o=>o.roundNumber===i&&!o.matchUpTieId),a=t.filter(o=>o.roundNumber===i+1&&!o.matchUpTieId);if(a.length){let o;return a.length===n.length?o=a.find(s=>s.roundPosition===r):a.length===n.length/2&&(o=a.find(s=>s.roundPosition===Math.ceil(r/2))),{matchUp:o}}return{message:"no progression found"}}function jE({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){var a;if(!n)return{error:qx};let{target:{structureId:o,feedProfile:s,groupedOrder:l,roundNumber:u,positionInterleave:c}}=n,{structure:d}=rt({drawDefinition:r,structureId:o}),{positionAssignments:p}=si({structure:d}),m=(e==null?void 0:e.filter(P=>P.structureId===(d==null?void 0:d.structureId))).filter(P=>P.roundNumber===u&&!P.matchUpTieId),h=m.length,f=De(1,h+1),g=h/t,v=Math.ceil(g*i),y=1-i%2;if(c!=null&&c.interleave&&g!==.5){let P=c.offset+(i-1)*c.interleave,E=i+P;v=Math.ceil(E/2),y=1-E%2}let I=f,b=f[v-1],S=jJ({roundPositionsCount:f.length,groupedOrder:l}),w=(S==null?void 0:S.length)||1;if(w<=f.length){let P=h/w,E=Cr(f,P);s===Kd&&E.forEach(R=>R.reverse()),I=(S==null?void 0:S.length)&&(S==null?void 0:S.map(R=>E[R-1]).flat())||I}s===Bo?b=I[v-1]:s===Kd?((!(S!=null&&S.length)||w>f.length)&&(v=m.length+1-v),b=I[v-1]):s===DP&&Ga()&&console.log(hP,{feedProfile:s});let U=b&&m.reduce((P,E)=>E.roundPosition===b?E:P,void 0),T;U!=null&&U.feedRound?(y=0,T=Math.min(...(U.drawPositions||[]).filter(Boolean))):T=((a=U==null?void 0:U.drawPositions)==null?void 0:a.length)===2&&(U==null?void 0:U.drawPositions[y]);let D=p==null?void 0:p.find(({drawPosition:P})=>P===T);if(D){let{extension:P}=It({element:D,name:FP});if(P!=null&&P.value)return{disabledDrawPosition:T}}return{matchUp:U,targetDrawPosition:T,matchUpDrawPositionIndex:y}}function On({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(s=>s.matchUpId===n));let{structure:o}=rt({structureId:a==null?void 0:a.structureId,drawDefinition:r});return(o==null?void 0:o.finishingPosition)===Eh?rTe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:o,matchUp:a}):nTe({matchUp:a})}function rTe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){var a,o,s;let{winnerMatchUpId:l,loserMatchUpId:u}=n,{links:c}=tTe({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),d=c==null?void 0:c.source,p=VE({source:d,linkType:xu}),m=VE({linkCondition:dl,linkType:Kl,source:d}),h=VE({source:d,linkType:Kl}),f=m&&h;h||(h=m);let g=(a=p==null?void 0:p.target)==null?void 0:a.feedProfile,v=(o=h==null?void 0:h.target)==null?void 0:o.feedProfile,y=(s=m==null?void 0:m.target)==null?void 0:s.feedProfile,I,b,S,w,U,T,D,P,E,R;if(e&&(l||u)&&(D=l&&g!==ys&&t.find(({matchUpId:M})=>M===l),w=u&&v!==ys&&t.find(({matchUpId:M})=>M===u),D||w))return{matchUp:n,targetLinks:{loserTargetLink:h,winnerTargetLink:p},targetMatchUps:{loserMatchUp:w,winnerMatchUp:D}};let{roundPosition:N}=n;R=R||t.filter(M=>M.structureId===r.structureId);let A=R.reduce((M,C)=>C.roundNumber===n.roundNumber&&!C.matchUpTieId?M+1:M,0);return h&&!w&&v!==ys&&({matchUpDrawPositionIndex:T,targetDrawPosition:U,matchUp:w}=jE({targetLink:h,sourceRoundMatchUpCount:A,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),f&&y!==ys&&({matchUpDrawPositionIndex:S,targetDrawPosition:b,matchUp:I}=jE({targetLink:m,sourceRoundMatchUpCount:A,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),p&&!D&&g!==ys&&({matchUpDrawPositionIndex:E,targetDrawPosition:P,matchUp:D}=jE({targetLink:p,sourceRoundMatchUpCount:A,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),D||(R=R||t.filter(M=>M.structureId===r.structureId),{matchUp:D}=iTe({structureMatchUps:R,matchUp:n})),Ge({matchUp:n,targetLinks:{loserTargetLink:h,winnerTargetLink:p,byeTargetLink:m},targetMatchUps:{winnerMatchUpDrawPositionIndex:E,loserMatchUpDrawPositionIndex:T,byeMatchUpDrawPositionIndex:S,winnerTargetDrawPosition:P,loserTargetDrawPosition:U,byeTargetDrawPosition:b,winnerMatchUp:D,loserMatchUp:w,byeMatchUp:I},targetMatchUpIds:!!(l||u)})}function nTe({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function aTe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{var n,a,o,s,l,u;let{matchUpId:c,structureId:d,drawPositions:p=[]}=r,{structure:m}=rt({drawDefinition:t,structureId:d});if((m==null?void 0:m.finishingPosition)===Jd){let{roundNumber:h}=r,f=h&&tt(h)+1,g=m.matchUps??[],{roundMatchUps:v}=An({matchUps:g});if(f&&v!=null&&v[f]){let y=[...p].sort(ur).map((I,b)=>{let S=v[f].find(w=>{var U;return(U=w.drawPositions)==null?void 0:U.includes(I)});return{matchUpId:S==null?void 0:S.matchUpId,roundNumber:f,schedule:S==null?void 0:S.schedule,sideNumber:b+1,structureName:m.structureName}});Object.assign(r,{sidesTo:y})}}else{let h=On({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:c}),{winnerMatchUp:f}=h.targetMatchUps,{loserMatchUp:g}=h.targetMatchUps;!r.winnerMatchUpId&&f&&(r.winnerMatchUpId=f.matchUpId),!r.loserMatchUpId&&g&&(r.loserMatchUpId=g.matchUpId);let v=GE({upcomingMatchUp:f}),y=GE({upcomingMatchUp:g});if(r.matchUpStatus!==jt&&(g==null?void 0:g.matchUpStatus)===jt){let{matchUp:b}=lX({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=b&&GE({upcomingMatchUp:b})||y}let I=(n=r.schedule)==null?void 0:n.timeAfterRecovery;if(I&&((a=v==null?void 0:v.schedule)!=null&&a.scheduledTime&&kt(v.schedule.scheduledTime)<kt(I)&&(i[v.matchUpId]=r.matchUpId,v.schedule.scheduleConflict=r.matchUpId),(o=y==null?void 0:y.schedule)!=null&&o.scheduledTime&&kt(y.schedule.scheduledTime)<kt(I)&&(i[y.matchUpId]=r.matchUpId,y.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:v,loserTo:y}),(s=r.drawPositions)==null?void 0:s.filter(Boolean).length){let b=((u=(l=h.targetLinks)==null?void 0:l.loserTargetLink)==null?void 0:u.linkCondition)===dl,S=oTe(r);if(S.length){let w=IM(f==null?void 0:f.sides),U=IM(g==null?void 0:g.sides),T=S.find(({participantId:P})=>w.includes(P))?[]:S,D=S.find(({participantId:P})=>U.includes(P))?[]:S;g&&b&&D.length<2&&D.push({bye:!0,tbd:!0}),T!=null&&T.length&&f&&(!h.targetMatchUpIds&&f&&(f=e.find(({matchUpId:P})=>P===f.matchUpId)),f.potentialParticipants||(f.potentialParticipants=[]),f.potentialParticipants.push(T)),D!=null&&D.length&&g&&(h.targetMatchUpIds||(f=e.find(({matchUpId:P})=>P===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(D))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function oTe(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:r,qualifier:n})=>i||r&&{participantId:r}||n&&{qualifier:n}).filter(Boolean))||[]}function lX({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var r;let{matchUpId:n,matchUpStatus:a,structureId:o}=t||{};if(!t||!o||(t==null?void 0:t.matchUpStatus)===Qi)return{matchUp:t};if(a===jt){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((r=On({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:n}))==null?void 0:r.targetMatchUps)||{},lX({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function GE(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o}))(t.upcomingMatchUp)}function gr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=Tv(t);if(i.error)return te({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:o,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...o??[],...s??[]),matchUpsMap:l}}function Tv(t){if(!(t!=null&&t.drawDefinition))return{error:_e};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:m,scheduleTiming:h,participantMap:f,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:I,inContext:b,context:S,event:w}=t,U=[],T=[],D=[],P=[],E=[];v&&!i&&(i=ic({policyDefinitions:u,tournamentRecord:c,contextProfile:v,event:w}));let R;!(e!=null&&e.length)&&c&&(e=c==null?void 0:c.participants,(b||s!=null&&s.withGroupings)&&e!=null&&e.length&&({participantsWithGroupings:e,groupInfo:R}=GP({participants:e,participantsProfile:s})));let{structures:N}=ss({drawDefinition:y});if(!N)return{error:Ni};r||(r=ln({drawDefinition:y}));let A=y&&GJ({drawDefinition:y}).exitProfiles;N.forEach(O=>{let{byeMatchUps:k=[],pendingMatchUps:x=[],upcomingMatchUps:F=[],completedMatchUps:$=[],abandonedMatchUps:_=[]}=QP({matchUpFilters:I?void 0:m,contextFilters:I?void 0:p,inContext:b||I||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:f,scheduleTiming:h,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:A,matchUpsMap:r,structure:O,context:S,event:w});U=U.concat(..._),T=T.concat(...$),D=D.concat(...F),P=P.concat(...x),E=E.concat(...k)});let M=O=>(!m&&!I&&!p||(m&&(O=mu({matchUps:O,...m})),p&&(O=mu({matchUps:O,...p,processContext:!0}))),O),C={abandonedMatchUps:M(U),completedMatchUps:M(T),upcomingMatchUps:M(D),pendingMatchUps:M(P),byeMatchUps:M(E),matchUpsMap:r,...Q,groupInfo:R};if(I){let O=typeof I=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:k,completed:x,upcoming:F,pending:$,bye:_}=O,L=[].concat(...k&&U||[],...x&&T||[],...F&&D||[],...$&&P||[],..._&&E||[]);aTe({inContextDrawMatchUps:L,drawDefinition:y})}return C}function ou(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:m,contextProfile:h,nextMatchUps:f,inContext:g,context:v,event:y}=t;if(!y)return{error:Ii};let{eventId:I,eventName:b,endDate:S,eventType:w,category:U,gender:T,matchUpFormat:D}=y??{},P={...v,...Ge({indoorOutDoor:y.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),surfaceCategory:y.surfaceCategory??(c==null?void 0:c.surfaceCategory),endDate:y.endDate??(c==null?void 0:c.endDate),tournamentId:c==null?void 0:c.tournamentId,matchUpFormat:D,eventName:b,eventType:w,category:U,eventId:I,gender:T})};S&&(P.endDate=S),h&&!i&&(i=ic({policyDefinitions:l,tournamentRecord:c,contextProfile:h,event:y}));let E;if(!(e!=null&&e.length)&&!r&&c){let A=Cp({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:h,inContext:g});r=A.participantMap,e=A.participants??[],E=A.groupInfo}let R=y.drawDefinitions??[],N=gw({tournamentRecord:c,event:y}).scheduleTiming;return{matchUps:R.flatMap(A=>{let{matchUps:M}=gr({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:P,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextFilters:p,contextProfile:h,drawDefinition:A,contextContent:i,matchUpFilters:m,participantMap:r,scheduleTiming:N,nextMatchUps:f,inContext:g,event:y});return M??[]}),groupInfo:E}}function Hr(t){let e=We(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:ve};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,usePublishState:d,contextProfile:p,matchUpFilters:m,contextFilters:h,nextMatchUps:f,context:g}=t,v=t.tournamentId??u.tournamentId,y=(u==null?void 0:u.events)??[];r||({participants:r,participantMap:i}=Cp({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,contextProfile:p,inContext:c}));let{appliedPolicies:I}=Bt({tournamentRecord:u}),b={...g,tournamentId:v,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},S=ic({policyDefinitions:l,tournamentRecord:u,contextProfile:p});return{matchUps:y.flatMap(w=>{var U;return b.eventDrawsCount=((U=w.drawDefinitions)==null?void 0:U.length)??0,ou({context:b,scheduleVisibilityFilters:n,tournamentAppliedPolicies:I,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:S,contextFilters:h,contextProfile:p,matchUpFilters:m,participantMap:i,nextMatchUps:f,participants:r,inContext:c,event:w}).matchUps??[]}).concat(...u.matchUps??[])}}function Ls({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:o,contextFilters:s,nextMatchUps:l,inContext:u}){if(typeof r!="object"||!Object.keys(r).length)return{error:ki};let c=Object.keys(r).map(d=>{let p=r[d];return Hr({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:p,usePublishState:a,matchUpFilters:o,contextFilters:s,nextMatchUps:l,inContext:u}).matchUps??[]}).flat();return{...Q,matchUps:c}}function _h(t,e){return sTe(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function sTe(t,e){return(Lm[t==null?void 0:t.stage]||0)-(Lm[e==null?void 0:e.stage]||0)}function Pn(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:m,drawDefinition:h,nextMatchUps:f,inContext:g,context:v,event:y}=t,{eventId:I,eventName:b,endDate:S,eventType:w,category:U,gender:T,matchUpFormat:D}=y??{},P={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(c==null?void 0:c.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(c==null?void 0:c.indoorOutdoor),matchUpFormat:D,eventType:w,eventName:b,category:U,eventId:I,endDate:S,gender:T},E;return!(e!=null&&e.length)&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:E}=Cp({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:m,inContext:g})),m&&!r&&(r=ic({policyDefinitions:l,tournamentRecord:c,contextProfile:m,drawDefinition:h,event:y})),{...gr({context:P,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,drawDefinition:h,contextContent:r,contextFilters:p,contextProfile:m,matchUpFilters:d,participantMap:i,nextMatchUps:f,inContext:g,event:y}),groupInfo:E}}function pm({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Me(t),r=e.split("."),n=[],a;s({targetElement:i,attributes:r});let o={value:a};return n.length&&(o.values=n),o;function s({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,m]of u.entries())if(l!=null&&l[m]){let h=u.slice(p+1);h.length?Array.isArray(l[m])?l[m].forEach(f=>s({targetElement:f,attributes:h})):(l=l[m],d({targetElement:l,index:p})):(a||(a=l[m]),n.includes(l[m])||n.push(l[m]))}function d({targetElement:p,index:m}){if(p&&m===u.length-1&&["string","number"].includes(typeof p)){let h=c?p.slice(0,c):p;a?n.includes(h)||n.push(h):(a=h,n.push(h))}}}}var uX=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(r=>{var n;return{[r]:(n=pm({element:e,accessor:r}))==null?void 0:n.value}})||typeof t=="object"&&Object.keys(t).map(r=>{var n;return{[r]:(n=pm({element:e,accessor:r}))==null?void 0:n.value}})||((i=typeof t=="string"&&pm({element:e,accessor:t}))==null?void 0:i.value)},Na=uX;function Rw({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:o,fmlc:s}){var l;if(!Co(a))return[];let{roundProfile:u,roundNumbers:c=[]}=An({interpolate:!0,matchUps:a});r=r??Math.max(...c,0);let d=n?r-n:0,p=d&&((l=u==null?void 0:u[r-d])==null?void 0:l.matchUpsCount),m=u&&Object.values(u).map(Na("matchUpsCount")),h=(v,y)=>{let I=Math.min(...v);p&&y&&I===1&&(I=p);let b=Math.max(...v);return e&&b>e&&(b=e),[I,b]},f=u&&Object.assign({},...c.map(v=>{let y=(r??0)+1-v-d,I=u[v].matchUpsCount,b={finishingPositionRange:{},finishingRound:y},S=m==null?void 0:m.slice(v-1).reduce((N,A)=>N+(A||0),0),w=s&&v!==1,U=1+t+(w?i??0:0),T=1,D=De(U,o?U+I*2:S+U+T),P=S+T-I,E=h(D.slice(P)),R=h(D.slice(0,P),!0);return b.finishingPositionRange={loser:E,winner:R},{[v]:b}})),g=Ga({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&f[v.roundNumber];g&&!y&&console.log({roundFinishingData:f,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),a}function tp({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var r;if(!e)return{error:_e};let n={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=gr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((r=e==null?void 0:e.structures)==null?void 0:r.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];Rw({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:o,structureId:s}=a,l=On({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:o}),{winnerMatchUp:u,loserMatchUp:c}=l.targetMatchUps,d=u==null?void 0:u.matchUpId,p=c==null?void 0:c.matchUpId,m=Zd({matchUpsMap:i,structureId:s}).find(h=>h.matchUpId===o);if(m&&(d&&(n.winnerMatchUpIds[m.matchUpId]=d,Object.assign(m,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(n.loserMatchUpIds[m.matchUpId]=p,a.loserMatchUpId=p,m.loserMatchUpId=p,a.finishingPositionRange))){let h=c.finishingPositionRange&&[...a.finishingPositionRange.loser,...c.finishingPositionRange.loser],f=h&&[Math.min(...h),Math.max(...h)];a.finishingPositionRange.loser=f,m.finishingPositionRange.loser=f}}),{inContextDrawMatchUps:t,goesToMap:n}}function fs(t){var e;let i=Po(t),r=t.matchUps??[],n=t.drawIds??[],{includeParticipantDependencies:a,tournamentRecord:o,drawDefinition:s}=t;if(!Array.isArray(r))return{error:Qu};if(!Array.isArray(n))return{error:Bs};let l=(e=t.matchUpIds)!=null&&e.length?t.matchUpIds:r.map(I=>I.matchUpId);if(!Array.isArray(l))return{error:bh};let u={},c={},d={},p={};o&&!Object.keys(i).length&&(i={[o.tournamentId]:o});let m=Object.values(i),h=m.reduce((I,b)=>I.concat(b.events??[]).map(S=>(S.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:I})=>I===ku),f=r;if(h.length){f=Ls({nextMatchUps:!0,tournamentRecords:i}).matchUps;let I=h.reduce((b,S)=>{var w,U;let T=(w=S.source)==null?void 0:w.structureId,D=(U=S.target)==null?void 0:U.structureId;return T&&D&&(d[D]=T),T&&!b.includes(T)&&b.push(T),b},[]);for(let b of I)u[b]=[];for(let b of f??[]){let S=b.containerStructureId||b.structureId;I.includes(S)&&u[S].push(b.matchUpId)}}let g=I=>{c[I]||(c[I]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},p[I]=[])},v=(I,b)=>{c[I].matchUpIds.forEach(S=>{c[b].matchUpIds.push(S)}),c[b].matchUpIds.push(I),c[I].dependentMatchUpIds.push(b),a&&c[I].participantIds.forEach(S=>c[b].participantIds.push(S))},y=I=>{let b=Object.keys(u).length;for(let S of I||[]){let{matchUpId:w,winnerMatchUpId:U,loserMatchUpId:T}=S;if(!l.length||l.includes(w)){if(g(w),a){let{individualParticipantIds:E}=jP(S);c[w].participantIds=E}U&&(g(U),v(w,U),p[U].push(w)),T&&(g(T),v(w,T),p[T].push(w)),c[w].sources.push(p[w]);let D=p[w].map(E=>c[E].sources[0]).flat(),P=p[w].map(E=>c[E].sources[1]).flat();if(c[w].sources.push(D,P),b){let E=S.containerStructureId||S.structureId,R=d[E];if(u[R])for(let N of u[R])g(N),v(N,w),p[N].push(w)}}}};if(s)tp({drawDefinition:s}),f!=null&&f.length||(f=Pn({drawDefinition:s}).matchUps),y(f);else{if(f!=null&&f.length||(f=Ls({nextMatchUps:!0,tournamentRecords:i}).matchUps),!n.length){let I=m!=null&&m.length?m.map(({events:b=[]})=>b.map(({drawDefinitions:S=[]})=>S.map(({drawId:w})=>w))).flat(1/0):[];I&&(n=I)}for(let I of n){let b=f==null?void 0:f.filter(S=>S.drawId===I).sort(_h);if(!(b!=null&&b.find(({roundPosition:S})=>!S))){let S=b==null?void 0:b.find(({tournamentId:U})=>U),{drawDefinition:w}=Kn({tournamentRecord:i[S==null?void 0:S.tournamentId],drawId:I});w&&tp({drawDefinition:w})}y(b)}}return{positionDependencies:u,matchUpDependencies:c,sourceMatchUpIds:p,matchUps:f,...Q}}function br(t){var e,i;let r=t==null?void 0:t.matchUp,n=(t==null?void 0:t.score)||(r==null?void 0:r.score),a=(e=n==null?void 0:n.sets)==null?void 0:e[0],{side1Score:o,side2Score:s,side1TiebreakScore:l,side2TiebreakScore:u,side1PointScore:c,side2PointScore:d}=a||{},p=o||s||l||u||c||d;return!!(((i=n==null?void 0:n.sets)==null?void 0:i.length)>1||p)}function Ew({matchUpStatus:t}){return wJ.includes(t)}function lTe({matchUpStatus:t}){return qF.includes(t)}function PM({matchUpStatus:t}){return UJ.includes(t)}function SL({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){var a;let o=r==null?void 0:r.find(({participantId:l})=>l),s=(a=i==null?void 0:i.filter(SL))==null?void 0:a.length;return br({score:n})||s||e&&o||t&&lTe({matchUpStatus:t})&&![Pt,Ft,ms].includes(t)}function Cw(t){var e;let{drawDefinition:i,findContainer:r,structureId:n,event:a}=t,o=t.structure,s={isCollectionMatchUp:!1},{containedStructures:l}=Uv({drawDefinition:i}),u=n?l[n]||[]:[];if(!o){let T=rt({drawDefinition:i,structureId:n});if(T.error)return T;o=r?T.containingStructure??T.structure:T.structure}if(Yn({structure:o}))return{structure:o,isAdHoc:!0,error:lv};let{matchUps:c}=gr({inContext:!0,matchUpFilters:s,drawDefinition:i,event:a}),d=c==null?void 0:c.filter(T=>T.structureId===n||u.includes(T.structureId)),{matchUpDependencies:p}=fs({drawIds:[i.drawId],matchUps:c,drawDefinition:i}),m=[],h=[],f={},g=[];for(let T of c??[]){if(T.structureId===n||u.includes(T.structureId)){h.push(...T.drawPositions??[]);let D=T.roundNumber;for(let P of(T.drawPositions??[]).filter(Boolean))(!f[P]||D&&f[P]>D)&&(f[P]=D)}SL(T)&&(g.push(T),m.push(T.matchUpId,...((e=p==null?void 0:p[T==null?void 0:T.matchUpId])==null?void 0:e.matchUpIds)||[]))}let v=dt(h.filter(Boolean)).sort(ur),y=dt(m),I=dt(d==null?void 0:d.map(({matchUpId:T,drawPositions:D})=>y.includes(T)?D:[]).flat().filter(Boolean)).sort(ur),{positionAssignments:b}=si({drawDefinition:i,structure:o}),S=b==null?void 0:b.filter(T=>T.bye).map(T=>T.drawPosition),w=b==null?void 0:b.filter(T=>T.qualifier).map(T=>T.drawPosition),U=(v==null?void 0:v.filter(T=>!I.includes(T)))||[];return{allDrawPositions:v,inContextStructureMatchUps:d,drawPositionInitialRounds:f,activeDependentMatchUpIds:y,qualifyingDrawPositions:w,inactiveDrawPositions:U,positionAssignments:b,activeDrawPositions:I,byeDrawPositions:S,activeMatchUps:g,structure:o}}function Vm({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(ur)[0]}}var sc={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},TL=[];function ka(t,e){Pi(t)&&(t={method:t}),(e||Ga())&&TL.push(t)}function uTe(t){return TL.slice()}function cTe(t){let e=uTe().map(i=>{let{color:r,keyColors:n,method:a,newline:o}=i,s=Object.keys(sc).includes(r)?sc[r]:sc.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=n&&Object.keys(n).includes(c)&&sc[n[c]]?sc[n[c]]:sc.brightwhite;return`${sc.white}${c}: ${d}${i[c]}`}).join(", "),u=(a==null?void 0:a.length)<15?"		":"	";return[o?`
`:"",s,a,u,sc.white,l,sc.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function dTe(){TL.length=0}function eo({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUpsMap:a,structureId:o,structure:s,event:l}){var u,c,d;if(!r)return{error:_e};if(s||({structure:s}=rt({drawDefinition:r,structureId:o})),!s)return{error:Ni};o||({structureId:o}=s);let p="assignDrawPositionBye";ka({method:p,color:"cyan",drawPosition:n}),a||(a=ln({drawDefinition:r}));let{positionAssignments:m}=si({structure:s}),{activeDrawPositions:h}=Cw({drawDefinition:r,structureId:o});if((u=m==null?void 0:m.find(R=>R.drawPosition===n))!=null&&u.bye)return{...Q};if(h!=null&&h.includes(n))return{error:rP};let f=m==null?void 0:m.find(R=>R.drawPosition===n);if(!f)return{error:lv};let{filled:g,containsBye:v,assignedParticipantId:y}=pTe(f);if(v)return{...Q};if(g&&!v)return te({result:{error:Zf},stack:p});let I=Bt({tournamentRecord:i,drawDefinition:r,event:l}).appliedPolicies??{},b=gr({inContext:!0,drawDefinition:r,matchUpsMap:a}).matchUps??[],S={isCollectionMatchUp:!1},{matchUps:w}=qt({provisionalPositioning:t,drawDefinition:r,matchUpFilters:S,matchUpsMap:a,structure:s});if(m==null||m.forEach(R=>{R.drawPosition===n&&(R.bye=!0)}),s.structureType===_n)return mTe({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:w}),Lc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),S2({assignedParticipantId:y,isPositionAction:e,appliedPolicies:I,drawDefinition:r,drawPosition:n,structureId:o,stack:p});let{roundProfile:U,roundMatchUps:T}=An({matchUps:w}),D=(c=U&&Object.keys(U).map(R=>parseInt(R)).reverse())==null?void 0:c.find(R=>{var N;return(N=U==null?void 0:U[R].drawPositions)==null?void 0:N.includes(n)}),P=D?T==null?void 0:T[D].find(({drawPositions:R})=>R==null?void 0:R.includes(n)):void 0;P&&cX({tournamentRecord:i,drawDefinition:r,matchUp:P,event:l});let E=(d=P==null?void 0:P.drawPositions)==null?void 0:d.find(R=>R!==n);if(P&&E){let R=DL({sourceDrawPositions:P.drawPositions,matchUpId:P.matchUpId,inContextDrawMatchUps:b,drawPositionToAdvance:E,tournamentRecord:i,drawDefinition:r,matchUpsMap:a});if(R.error)return R}return Lc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),S2({assignedParticipantId:y,isPositionAction:e,appliedPolicies:I,drawDefinition:r,drawPosition:n,structureId:o,stack:p})}function S2({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:o}){return e&&VP({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:o}}),te({result:{...Q},stack:o})}function pTe(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:r,filled:e||i||r}}function cX({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:jt,score:void 0,winningSide:void 0}),Et({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(n==null?void 0:n.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function mTe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{var o;(o=a.drawPositions)!=null&&o.includes(i)&&cX({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function DL({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:o,event:s}){var l,u;ka({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let c=a.drawMatchUps.find(S=>S.matchUpId===o),d=(l=e.find(S=>S.matchUpId===o))==null?void 0:l.structureId,{structure:p}=rt({drawDefinition:n,structureId:d}),{positionAssignments:m}=si({structure:p}),h=m==null?void 0:m.filter(S=>S.bye).map(S=>S.drawPosition),f=(u=c==null?void 0:c.drawPositions)==null?void 0:u.find(S=>S!==t),g=f&&(h==null?void 0:h.includes(f)),{targetLinks:{loserTargetLink:v},targetMatchUps:{loserMatchUp:y,winnerMatchUp:I,loserTargetDrawPosition:b}}=On({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:o});if(I&&I.structureId===(p==null?void 0:p.structureId)&&hTe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:I,matchUpsMap:a,event:s}),y&&g&&y.structureId!==(p==null?void 0:p.structureId)){let{roundNumber:S}=y;if(S===1){let w=eo({structureId:v.target.structureId,drawPosition:b,tournamentRecord:r,drawDefinition:n,event:s});if(w.error)return w}else dX({loserTargetDrawPosition:b,tournamentRecord:r,loserTargetLink:v,drawDefinition:n,loserMatchUp:y,matchUpsMap:a,event:s})}return{...Q}}function hTe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:o,event:s}){var l,u,c,d,p,m;let h="advanceWinner",f=o.drawMatchUps.find(F=>F.matchUpId===a.matchUpId),g=(l=e.find(F=>F.matchUpId===a.matchUpId))==null?void 0:l.structureId,{structure:v}=rt({drawDefinition:n,structureId:g}),{positionAssignments:y}=si({structure:v}),I=(u=y==null?void 0:y.find(({drawPosition:F})=>F===t))==null?void 0:u.bye,b=(c=f.drawPositions)==null?void 0:c.filter(Boolean),S=y==null?void 0:y.filter(F=>b==null?void 0:b.includes(F.drawPosition)),w=y==null?void 0:y.find(({drawPosition:F})=>F===t),U=i==null?void 0:i.find(F=>F!==t),T=(d=U&&(S==null?void 0:S.find(({drawPosition:F})=>F===U)))==null?void 0:d.bye,D=I&&T;if(D&&console.log({isByeAdvancedBye:D}),(b==null?void 0:b.length)>1&&I&&!T)return te({result:{error:Zf},stack:h});let P=b==null?void 0:b.find(F=>F!==t),E=D,R=[...(f.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),N=R.map(F=>!F&&!E||F===t?(E=!0,t):F).sort(ur);if(!E)return console.log("@@@@@@@",{advancingAssignmentIsBye:w,drawPositionToAdvance:t,existingAssignments:S}),te({result:{error:Zf},stack:h});let A=(p=y==null?void 0:y.find(({drawPosition:F})=>F===P))==null?void 0:p.bye,M=(m=y==null?void 0:y.find(({drawPosition:F})=>F===t))==null?void 0:m.bye;Object.assign(f,{matchUpStatus:M||A?jt:Qi,score:void 0,winningSide:void 0,drawPositions:N});let C=f.drawPositions.find(F=>!R.includes(F));ka({method:h,color:"brightyellow",changedDrawPosition:C,pairedDrawPositionIsBye:A,drawPositionIsBye:M}),Et({tournamentId:r==null?void 0:r.tournamentId,matchUp:f,eventId:s==null?void 0:s.eventId,context:h,drawDefinition:n});let{targetLinks:{loserTargetLink:O},targetMatchUps:{loserMatchUp:k,loserTargetDrawPosition:x}}=On({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(A||M){let F=A?t:P;if(F)DL({drawPositionToAdvance:F,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:o});else if(M&&O&&k)if(k.feedRound)dX({loserTargetDrawPosition:x,tournamentRecord:r,loserTargetLink:O,drawDefinition:n,loserMatchUp:k,matchUpsMap:o});else{let $=1-a.roundPosition%2,_=k.drawPositions[$],L=eo({structureId:O.target.structureId,drawPosition:_,tournamentRecord:r,drawDefinition:n,event:s});if(L.error)return L}}}function dX({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){let{roundNumber:s}=n;ka({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[n.structureId].matchUps,{initialRoundNumber:u}=Vm({drawPosition:t,matchUps:l});if(u===s){let c=eo({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:o});if(c.error)return c}}function pX({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:o}=qt({drawDefinition:i,matchUpsMap:r,structure:n,event:a});o.forEach(s=>{let l=t.filter(({drawPosition:u})=>{var c;return(c=s.drawPositions)==null?void 0:c.includes(u)}).filter(u=>u.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?jt:Qi}),Et({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:s}))})}function Mw(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=t,{structure:u}=rt({drawDefinition:a,structureId:o}),c=(Mr({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(c&&i&&!r&&(r=c==null?void 0:c.drawPosition),!r)return{error:uv};i||(i=c==null?void 0:c.participantId);let{activeDrawPositions:d}=Cw({drawDefinition:a,structureId:o});return d.includes(r)?{error:rP}:(e||({matchUps:e}=gr({inContext:!0,drawDefinition:a,matchUpsMap:s})),RM({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:o,drawPosition:r,matchUpsMap:s,event:l}).drawPositionCleared?(Lc({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:u,event:l}),{...Q,participantId:i}):{error:_K})}function RM({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:o}){var s,l;let{structure:u}=rt({drawDefinition:i,structureId:a});if(!u)return{error:Ni};let c=Mr({drawDefinition:i,structure:u}).positionAssignments||[],d=c.some(I=>{if(I.drawPosition===r)return delete I.participantId,delete I.qualifier,delete I.bye,!0});if(u.structureType===_n)return pX({positionAssignments:c,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:u}),{drawPositionCleared:d,...Q};let p={isCollectionMatchUp:!1},{matchUps:m}=qt({drawDefinition:i,matchUpFilters:p,matchUpsMap:n,structure:u,event:o}),{roundProfile:h,roundMatchUps:f}=An({matchUps:m}),g=(s=h&&Object.keys(h))==null?void 0:s.map(I=>tt(I)),v=r,y=(l=g==null?void 0:g.map(I=>{var b,S,w,U;let T=(S=(b=h==null?void 0:h[I])==null?void 0:b.pairedDrawPositions)==null?void 0:S.find(C=>C.includes(v)),D=T==null?void 0:T.find(C=>C!==v),P=c.find(C=>C.drawPosition===D),E=h==null?void 0:h[I+1],R=P==null?void 0:P.bye,N=(w=E==null?void 0:E.pairedDrawPositions)==null?void 0:w.find(C=>C.includes(D)),A=R&&N&&E&&((U=E.drawPositions)==null?void 0:U.includes(D)),M=T&&{pairedDrawPositionByeAdvancedPair:!A&&N,pairedDrawPosition:D,targetDrawPosition:v,relevantPair:T,roundNumber:I};return A&&(v=D),M}).filter(I=>I==null?void 0:I.targetDrawPosition))==null?void 0:l.reduce((I,b)=>{let{roundNumber:S,relevantPair:w,targetDrawPosition:U,pairedDrawPosition:T,pairedDrawPositionByeAdvancedPair:D}=b,P={roundNumber:S,targetDrawPosition:U,relevantPair:w},E=D&&{roundNumber:S+1,targetDrawPosition:T,relevantPair:D,subsequentRoundRemoval:!0},R=[P,E].filter(Boolean);return I.concat(...R)},[]);return y==null||y.forEach(({roundNumber:I,targetDrawPosition:b,relevantPair:S})=>{let w=f==null?void 0:f[I].find(U=>{var T;return Nn((T=U.drawPositions)==null?void 0:T.filter(Boolean),S.filter(Boolean))});w&&(fTe({inContextDrawMatchUps:t,targetDrawPosition:b,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:I,matchUpsMap:n}),mX({inContextDrawMatchUps:t,positionAssignments:c,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:r,matchUpsMap:n,structure:u,event:o}))}),{tasks:y,drawPositionCleared:d,positionAssignments:c}}function fTe({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:o}){let{structure:s}=rt({drawDefinition:r,structureId:o});if(!s)return{error:Ni};if(s.structureType===_n)return;n=n||ln({drawDefinition:r});let l=((n==null?void 0:n.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:u}=Vm({drawPosition:e,matchUps:l}),c=l==null?void 0:l.filter(p=>{var m;return p.roundNumber>=a&&p.roundNumber!==u&&((m=p.drawPositions)==null?void 0:m.includes(e))}),d=si({drawDefinition:r,structureId:o}).positionAssignments??[];return c==null||c.forEach(p=>mX({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:s})),{...Q}}function mX({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var u,c,d,p,m;let h="removeDrawPosition",f=(u=n.drawPositions)==null?void 0:u.slice(),g=n.matchUpStatus,v=n.winningSide;o=o??ln({drawDefinition:r});let y=o.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:I}=Vm({drawPosition:a,matchUps:y});if(n.roundNumber&&I&&n.roundNumber>I){let R=(n.drawPositions??[]).map(N=>N===a?void 0:N);n.drawPositions=R}if(n.matchUpType===gi){let R=(((c=t==null?void 0:t.find(N=>N.matchUpId===n.matchUpId))==null?void 0:c.sides)??[]).reduce((N,A,M)=>A.drawPosition===a?M:N,void 0);R!==void 0&&(p=(d=n.sides)==null?void 0:d[R])!=null&&p.lineUp&&((m=n.sides)==null||delete m[R].lineUp,Et({tournamentId:i==null?void 0:i.tournamentId,context:`${h}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:n,drawDefinition:r}))}let b=On({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:S},targetMatchUps:{loserMatchUp:w,winnerMatchUp:U,loserMatchUpDrawPositionIndex:T}}=b,D=e.filter(({drawPosition:R})=>{var N;return(N=n.drawPositions)==null?void 0:N.includes(R)}).filter(R=>R.bye).length,P=D&&jt||n.matchUpStatus&&[Pt,Ft].includes(n.matchUpStatus)&&n.matcHUpStatus||Qi;n.matchUpStatus=P,n.matchUpStatus&&[Ft,Pt].includes(n.matchUpStatus)&&(n.winningSide=void 0);let E=f==null?void 0:f.find(R=>{var N;return!((N=n.drawPositions)!=null&&N.includes(R))});if(f!=null&&f.includes(a)&&g===n.matchUpStatus&&v===n.winningSide||(E&&ka({method:h,color:"brightyellow",removedDrawPosition:E}),Et({tournamentId:i==null?void 0:i.tournamentId,context:`${h}-${a}`,eventId:l==null?void 0:l.eventId,matchUp:n,drawDefinition:r})),w&&w.structureId!==b.matchUp.structureId&&!D){let{drawPositions:R,roundNumber:N}=w;if(N===1){let A=R[T];RM({structureId:w.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o})}else{let A=Math.min(...R.filter(Boolean)),M=gTe({loserMatchUpDrawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:w,matchUpsMap:o,event:l});if(M.error)return te({result:M,stack:h});let C=((o==null?void 0:o.mappedMatchUps)||{})[w.structureId].matchUps,{initialRoundNumber:O}=Vm({drawPosition:A,matchUps:C});O===1&&(ka({method:h,color:"brightyellow",loserMatchUpDrawPosition:A}),RM({structureId:w.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o}))}}return U&&U.structureId!==b.matchUp.structureId&&S.target.feedProfile,{...Q}}function gTe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){var s;let{structure:l}=rt({structureId:n.structureId,drawDefinition:r}),{positionAssignments:u}=si({structure:l});if((s=u==null?void 0:u.find(c=>c.drawPosition===t))!=null&&s.bye){let c=Mw({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:o});if(c.error)return c}return{...Q}}function kp({drawDefinition:t,stages:e}){if(!t)return{error:_e};let i=((t==null?void 0:t.structures)??[]).filter(n=>!(e!=null&&e.length)||n.stage&&e.includes(n.stage)),r=dt(i.map(n=>{let{positionAssignments:a}=si({structure:n});return a?a.map(Tt):[]}).flat().filter(Boolean));return{...Q,assignedParticipantIds:r}}function Ps(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:o}=n,s=`_${a||Ne}${o||""}`;return r[s]||(r[s]=[]),r[s].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let o=a+1;return{...n,entryPosition:o}})).flat()}function gd(t){return[Np,Eo].includes(t)}function d0({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:u,stage:c,event:d}){var p,m,h,f,g,v,y,I,b,S,w,U;if(!n||!Array.isArray(n))return{error:ks,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:Ii};if(a&&!VJ.includes(a))return{error:uM};if(o&&!UP.includes(o))return{error:Dp};let T="modifyEntriesStatus",D=[];if(!a&&!s)return te({result:{error:Qe},info:"Missing entryStatus",stack:T});if(s&&!pl({extension:s,requiredAttributes:["name"]}))return te({result:{error:le},info:"Invalid extension",context:{extension:s},stack:T});let P=[];(p=d==null?void 0:d.drawDefinitions)==null||p.forEach($=>{let _=kp({stages:c&&[c],drawDefinition:$}).assignedParticipantIds??[];P.push(..._)});let E=(i==null?void 0:i.participants)??[];if(!n.every($=>{var _;let L=(_=Oc({tournamentParticipants:E,participantId:$}))==null?void 0:_.participantType;return!(L&&[gt,Gn].includes(L)&&gd(a))&&!(a&&d!=null&&d.eventType&&L===Dt&&[go,Ca].includes(d.eventType)&&[Jo,...tS].includes(a))}))return{error:uM};let R=d&&Hi({event:d}).flightProfile,N=(m=R==null?void 0:R.flights)==null?void 0:m.find($=>$.drawId===u),A=$=>{let _=($||[]).filter(B=>!c||!B.entryStage||c===B.entryStage).filter(({participantId:B})=>n.includes(B)),L=B=>a&&P.includes(B.participantId)&&!(tS.includes(B.entryStatus)&&tS.includes(a));return _.every(B=>L(B)&&!e?!1:(a&&(B.entryStatus=a,delete B.entryPosition),o&&(B.entryStage=o,delete B.entryPosition),s&&(s.value?_t({element:B,extension:s}):Dn({element:B,name:s.name})),!0))?{...Q}:{error:pv}},M=({flight:$,drawDefinition:_})=>{d&&(d.entries=Ps({entries:d.entries??[]})),$&&($.drawEntries=Ps({entries:$.drawEntries})),_&&(_.entries=Ps({entries:_.entries}))},C=$=>{let{flight:_,drawDefinition:L}=$,B="updateDrawEntries";if(_){let V=A(_.drawEntries);if(V.error)return te({result:V,stack:B})}if(L){let V=A(L.entries);if(V.error)return te({result:V,stack:B});D.includes(L.drawId)||D.push(L.drawId)}return{...Q}},O=((h=d==null?void 0:d.entries)==null?void 0:h.find(({entryPosition:$})=>$))??(((f=N==null?void 0:N.drawEntries)==null?void 0:f.find(({entryPosition:$})=>$))||((g=r==null?void 0:r.entries)==null?void 0:g.find(({entryPosition:$})=>$)));if(t&&!O&&M({flight:N,drawDefinition:r}),N||r){let $=C({flight:N,drawDefinition:r});if($.error)return te({result:$,stack:T})}let k=((v=d==null?void 0:d.drawDefinitions)==null?void 0:v.map(({drawId:$})=>$))??[],x=((y=R==null?void 0:R.flights)==null?void 0:y.filter($=>!k.includes($.drawId)))||[];for(let $ of x){let _=$&&C({flight:$});if(_!=null&&_.error)return te({result:_,stack:T})}let F=((I=R==null?void 0:R.flights)==null?void 0:I.length)===1&&(((b=d==null?void 0:d.drawDefinitions)==null?void 0:b.length)??0)<=((S=R==null?void 0:R.flights)==null?void 0:S.length);if(!N&&!r&&a&&BJ.includes(a))return{error:w9};if(!N&&!r||a===Ql||l&&F){let $=A(d==null?void 0:d.entries);if($!=null&&$.error)return te({result:$,stack:T});let _;if(a===Ql&&((w=R==null?void 0:R.flights)==null||w.every(L=>{let B=A(L.drawEntries);return B.error?(_=B.error,!1):(L.drawEntries=L.drawEntries.filter(({participantId:V})=>!n.includes(V)),!0)}),(U=d==null?void 0:d.drawDefinitions)==null||U.every(L=>{var B;let V=A(L.entries);return V.error?(_=V.error,!1):(L.entries=(B=L.entries)==null?void 0:B.filter(({participantId:G})=>!n.includes(G)),!0)})),_)return te({result:{error:_},stack:T})}t&&M({flight:N,drawDefinition:r});for(let $ of(d==null?void 0:d.drawDefinitions)??[])D.length&&!D.includes($.drawId)||ui({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:$});return{...Q}}function _l({requireTimeStamp:t,scaleAttributes:e,participant:i}){var r,n;if(!i)return{error:Sh};if(!At(e))return{error:le};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=e,u=[Xd,o,s,l].join("."),c=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===u).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(c){let[d,p,m,h]=((r=c.itemType)==null?void 0:r.split("."))??[];if(d!==Xd)return{error:km};let f=((n=a&&pm({element:c.itemValue,accessor:a}))==null?void 0:n.value)||c.itemValue,g={eventType:m,scaleDate:c.itemDate,scaleValue:f,scaleName:h,scaleType:p};return{...Q,scaleItem:g}}}return{...Q,scaleItem:void 0}}function vTe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){var a,o,s;let l={},u=m=>[Xd,Fl,n.eventType,m].join("."),c=Object.assign({},...(r.timeItems||[]).filter(({itemType:m})=>m.split(".")[1]===Fl).map(({itemType:m,itemValue:h})=>({[m]:h}))),d=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(u),p=ji(Object.keys(c),d);if((!e||!Object.keys(c).length&&!((a=t==null?void 0:t.drawIds)!=null&&a.length)||p.length)&&p.length){if(t!=null&&t.stageSeedingScaleNames){let m=Object.keys(t.stageSeedingScaleNames).map(f=>{let g=u(t.stageSeedingScaleNames[f]),v=c[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);l.seedAssignments=h}else if(p){let m=p.map(h=>c[h]);l.seedValue=m.pop()}}else if(!e&&typeof i=="object"){let m=Object.keys(i).map(f=>{let g=u(i[f]),v=c[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);l.seedAssignments=h}else{let{categoryName:m,ageCategoryCode:h}=n.category||{},f=[h,n.eventId,m].filter(Boolean),g;for(let v of f){let y={eventType:n.eventType,scaleType:Fl,scaleName:v},I=_l({scaleAttributes:y,participant:r});if(I.scaleItem){g=I.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((s=(o=t==null?void 0:t.published)==null?void 0:o.drawIds)!=null&&s.length))){let v=g.scaleValue;l.seedValue=v}}return l}function ITe({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...DF(d??[])):{},m=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:o,eventId:a});i.events[a]=Ge(m,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function hX(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||r===jt||e[i].scheduleItems.push({...c,scheduledDate:ht(c==null?void 0:c.scheduledDate),scheduledTime:Si(c==null?void 0:c.scheduledTime),checkScoreHasValue:br({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,drawId:d})}function Nw(t){var e,i,r;let n=We(t,[{[Ur]:!0}]);if(n.error)return n;let{tournamentRecord:a,status:o=Za}=t,s=`${od}.${sd}`;return Me((r=(i=(e=HP({tournamentRecord:a,itemType:s}))==null?void 0:e.timeItem)==null?void 0:i.itemValue)==null?void 0:r[o],!1,!0)}function yTe(t){let{tournamentId:e}=t??{};return!!e}function Mo({event:t,status:e=Za}){var i,r,n;let a=`${od}.${sd}`;return(n=(r=(i=fw({itemType:a,event:t}))==null?void 0:i.timeItem)==null?void 0:r.itemValue)==null?void 0:n[e]}function PL({drawDetails:t,drawId:e}){var i,r;return(r=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:r.published}function $h(t){var e,i,r,n,a,o,s,l,u;let{tournamentRecord:c,drawDefinition:d,eventIds:p,eventId:m,drawIds:h,drawId:f,event:g}=t??{};if(c&&!yTe(c))return{error:le};if(m&&!g)return{error:fo};if(Array.isArray(p)&&p!=null&&p.length){let b={};for(let S of p){if(!Pi(S))return{error:le};let w=(e=Kn({tournamentRecord:c,eventId:S}))==null?void 0:e.event;if(!w)return{error:fo};let U=HE({event:w});b[S]=U}return{...Q,publishState:b}}if(g){let b=HE({event:g}),S={};if(f)return d?{publishState:{status:{published:!!((i=b.status.publishedDrawIds)!=null&&i.includes(f)),drawDetail:(r=b.status.drawDetails)==null?void 0:r[f]},...Q}}:{error:ja};if(Array.isArray(h)&&h!=null&&h.length){let w=((n=g.drawDefinitions)==null?void 0:n.map(py))??[];for(let U of h){if(!Pi(U))return{error:le};if(!w.includes(U))return{error:ja};S[U]={status:{published:!!b.status.publishedDrawIds.includes(U),drawDetail:(a=b.status.drawDetails)==null?void 0:a[U]}}}}else S=b;return{...Q,publishState:S}}let v=[],y=!1,I={};for(let b of(c==null?void 0:c.events)??[]){let S=HE({event:b});I[b.eventId]=S,S.status.published&&(v.push(b.eventId),y=!0);for(let{drawId:w}of b.drawDefinitions??[]){let U=(s=(o=S.status)==null?void 0:o.publishedDrawIds)==null?void 0:s.includes(w);U&&(I[w]={status:{published:U}})}}if(c){let b=Nw({tournamentRecord:c});I.tournament=b??{},((l=b==null?void 0:b.orderOfPlay)!=null&&l.published||(u=b==null?void 0:b.participants)!=null&&u.published)&&(y=!0),I.tournament.status={published:y,publishedEventIds:v}}return{...Q,publishState:I}}function HE({event:t}){var e;let i=Mo({event:t});if(!i)return{status:{published:!1}};let r={published:void 0,seedingScaleNames:[],drawIds:[]};i.seeding&&Object.assign(r,i.seeding);let n=i.drawDetails??{};for(let l of((e=t.drawDefinitions)==null?void 0:e.map(py))||[])n[l]||(n[l]={publishingDetail:{published:!1}});let a=n&&Object.keys(n).length&&Object.keys(n).filter(l=>PL({drawDetails:n,drawId:l})),o=a!=null&&a.length?a:i.drawIds??[];if(o!=null&&o.length&&!(a!=null&&a.length))for(let l of o)n[l]={publishingDetail:{published:!0}};let s=(o==null?void 0:o.length)>0;return{status:{publishedDrawIds:o,publishedSeeding:r,drawDetails:n,published:s}}}function ZP(t,e){return(t||"").localeCompare(e||"")}function bTe({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:r,matchUpStatus:n,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:u,drawId:c,stage:d}){let p=e[a],m=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:c});let h=p.structureParticipation[l],{winner:f,loser:g}=t,v=r?f:g;r&&(h.winCount+=1,n===Ft&&(h.walkoverWinCount+=1),n===Pt&&(h.defaultWinCount+=1)),v&&(!h.finishingPositionRange||m(v)<m(h.finishingPositionRange))&&(h.finishingPositionRange=v),i&&((!h.finishingRound||i<h.finishingRound)&&(h.finishingMatchUpId=u,h.finishingRound=i,h.roundNumber=s),i===1&&(h.participantWon=r))}function T2(t){var e,i,r,n,a,o,s,l,u,c;let{withScheduleItems:d,scheduleAnalysis:p,withTeamMatchUps:m,participantMap:h,withOpponents:f,withMatchUps:g,withEvents:v,withDraws:y,finishingPositionRange:I,finishingRound:b,matchUpStatus:S,stageSequence:w,roundNumber:U,structureId:T,score:D,stage:P,withRankingProfile:E,tieWinningSide:R,roundPosition:N,matchUpTieId:A,matchUpSides:M,collectionId:C,matchUpType:O,winningSide:k,matchUpId:x,schedule:F,eventId:$,drawId:_,sides:L}=t,B=f&&(L==null?void 0:L.length)===2&&Object.assign({},...L.map(({sideNumber:V},G)=>{let j=L[1-G].participantId;return V&&{[V]:j}}).filter(Boolean));for(let V of L){let{participantId:G,sideNumber:j,bye:z}=V;if(z)continue;let W=k===j,q=J=>{var H,Z;let K=(H=h[J])==null?void 0:H.participant,ie=K==null?void 0:K.participantType,ae=[{participantId:J,participantType:ie}];if(ie!==Gn)for(let oe of(K==null?void 0:K.individualParticipantIds)||[]){let ne=(Z=h[oe])==null?void 0:Z.participant;ae.push({participantType:ne==null?void 0:ne.participantType,participantId:oe})}return ae},Y=(J,H)=>{if(g){if(h[J].matchUps[x]={participantWon:W,matchUpType:O,structureId:T,sideNumber:j,matchUpId:x,eventId:$,drawId:_,stage:P},f){let Z=q(H);h[J].matchUps[x].opponentParticipantInfo=Z}C&&(h[J].matchUps[x].collectionId=C)}f&&H&&(h[J].opponents[H]={participantId:H,matchUpId:x,eventId:$,drawId:_}),E&&bTe({finishingPositionRange:I,participantMap:h,participantWon:W,finishingRound:b,matchUpStatus:S,participantId:J,stageSequence:w,roundNumber:U,structureId:T,matchUpId:x,drawId:_,stage:P}),(p||d)&&hX({participantMap:h,participantId:J,matchUpStatus:S,roundPosition:N,matchUpType:O,roundNumber:U,structureId:T,matchUpId:x,schedule:F,drawId:_,score:D})},re=({participant:J,partnerParticipantId:H})=>{var Z,K,ie;let ae=(oe,ne)=>{oe&&(oe.partnerParticipantIds||(oe.partnerParticipantIds=[]),oe.partnerParticipantIds.includes(ne)||oe.partnerParticipantIds.push(ne))};y&&ae((Z=J==null?void 0:J.draws)==null?void 0:Z[_],H),v&&ae((K=J==null?void 0:J.events)==null?void 0:K[$],H),g&&ae((ie=J==null?void 0:J.matchUps)==null?void 0:ie[x],H)};if(G&&h[G]){let J=B==null?void 0:B[j];Y(G,J);let H=((e=h[G])==null?void 0:e.participant.participantType)===gt,Z=((i=h[G])==null?void 0:i.participant.individualParticipantIds)||[];if(A){if(m){let K=ie=>h[ie].matchUps[A]={participantWon:R===j,matchUpId:A,matchUpType:gi,sideNumber:j};K(G),Z.forEach(K)}if(y&&!h[G].draws[_]){let K=(n=(r=M.find(oe=>oe.sideNumber===j))==null?void 0:r.participant)==null?void 0:n.participantId,ie=(s=(o=(a=h[K])==null?void 0:a.draws)==null?void 0:o[_])==null?void 0:s.entryStatus,ae=oe=>h[oe].draws[_]={entryStatus:ie,eventId:$,drawId:_};ae(G),Z.forEach(ae)}}if(H&&(Z.forEach(K=>h[K]&&Y(K,J)),Z.forEach((K,ie)=>{let ae=Z[1-ie],oe=h[K];oe&&re({participant:oe,partnerParticipantId:ae})}),v&&M)){let K=(u=(l=M.find(ie=>ie.sideNumber===j))==null?void 0:l.participant)==null?void 0:u.participantId;if(K){let ie=(c=h[K])==null?void 0:c.events[$];ie?(h[G].events[$]={...ie},Z.forEach(ae=>h[ae].events[$]={...ie})):console.log("Missing teamEntry",{eventId:$,teamParticipantId:K})}}if(k){let K=ie=>{W?(h[ie].counters[O].wins+=1,h[ie].counters.wins+=1,S===Ft&&(h[ie].counters[O].walkoverWins+=1,h[ie].counters.walkoverWins+=1),S===Pt&&(h[ie].counters[O].defaultWins+=1,h[ie].counters.defaultWins+=1)):(h[ie].counters[O].losses+=1,h[ie].counters.losses+=1,S===Ft&&(h[ie].counters[O].walkovers+=1,h[ie].counters.walkovers+=1),S===Pt&&(h[ie].counters[O].defaults+=1,h[ie].counters.defaults+=1))};K(G),Z.forEach(K)}}}}function wTe(t){var e,i,r,n,a,o,s;let{participantFilters:l,convertExtensions:u,policyDefinitions:c,tournamentRecord:d,usePublishState:p,contextFilters:m,matchUpFilters:h,participantMap:f,contextProfile:g,withPotentialMatchUps:v,withRankingProfile:y,withScheduleItems:I,scheduleAnalysis:b,withTeamMatchUps:S,withStatistics:w,withOpponents:U,withMatchUps:T,withSeeding:D,withEvents:P,withDraws:E}=t,R=l==null?void 0:l.participantIds,N=_=>{var L,B;let V=[_];return(B=(L=f[_])==null?void 0:L.participant.individualParticipantIds)==null||B.forEach(G=>V.push(G)),V.some(G=>!(R!=null&&R.length)||R.includes(G))?V:[]},A={withMatchUps:T||y,withEvents:P||y,withDraws:E||y,withPotentialMatchUps:v,withRankingProfile:y,withScheduleItems:I,scheduleAnalysis:b,withTeamMatchUps:S,withStatistics:w,participantMap:f,withOpponents:U,withSeeding:D},M=[],C={},O=[],k={},x={},F={},$=({eventType:_,scaleNames:L,participantId:B})=>{var V,G,j,z,W;return(W=(z=(j=(G=(V=f[B])==null?void 0:V.participant)==null?void 0:G.rankings)==null?void 0:j[_])==null?void 0:z.find(q=>L.includes(q.scaleName)))==null?void 0:W.scaleValue};for(let _ of(d==null?void 0:d.events)||[]){if(l!=null&&l.eventIds&&!l.eventIds.includes(_.eventId))continue;let{drawDefinitions:L=[],extensions:B=[],eventType:V,eventName:G,category:j,entries:z,eventId:W,gender:q}=_,{flightProfile:Y}=Hi({event:_}),re=(Y==null?void 0:Y.flights)??[],J=$h({event:_}).publishState;J&&(k[W]=J);let H=(e=J==null?void 0:J.status)==null?void 0:e.publishedSeeding;if(P||D||y){let K=u?Object.assign({},...DF(B??[])):{};x[W]={...K,eventName:G,eventType:V,category:j,eventId:W,gender:q};let ie=[j==null?void 0:j.categoryName,j==null?void 0:j.ageCategoryCode].filter(Boolean);for(let ae of z){let{participantId:oe}=ae;if(!oe||!f[oe])continue;let ne=$({eventType:V,scaleNames:ie,participantId:oe}),de,ye;if(D){let ke=f[oe].participant;({seedAssignments:de,seedValue:ye}=vTe({publishedSeeding:H,usePublishState:p,withSeeding:D,participant:ke,event:_}))}let ce=ke=>{var we,Ze;if((Ze=(we=f[ke])==null?void 0:we.events)!=null&&Ze[W])return;let pt=f[ke];ITe({convertExtensions:u,seedAssignments:de,participant:pt,withSeeding:D,seedValue:ye,eventId:W,ranking:ne,entry:ae})};ce(oe),(f[oe].participant.individualParticipantIds||[]).forEach(ce)}}let Z=(i=k==null?void 0:k[W])==null?void 0:i.publishedSeeding;if(E||y||D){let K=ae=>ae?Object.assign({},...ae.map(({participantId:oe,seedValue:ne,seedNumber:de})=>({[oe]:{seedValue:ne,seedNumber:de}}))):void 0,ie=dt([...L.map(py),...re.map(py)]);for(let ae of ie){let oe=L.find(qe=>qe.drawId===ae),ne=[j==null?void 0:j.categoryName,j==null?void 0:j.ageCategoryCode].filter(Boolean),{structures:de=[],drawOrder:ye,drawName:ce,drawType:ke}=oe??{},we=re==null?void 0:re.find(qe=>qe.drawId===ae),Ze=(oe==null?void 0:oe.entries)||(we==null?void 0:we.drawEntries),pt=we==null?void 0:we.flightNumber,he=((oe==null?void 0:oe.structures)||[]).sort((qe,Pe)=>Mh(qe,Pe)).map(({structureId:qe,structures:Pe})=>[qe,...(Pe||[]).map(({structureId:at})=>at)]).flat(1/0),fe,pe,Fe,Se,He=0,ue=de.filter(({stage:qe,stageSequence:Pe})=>qe===Ne&&Pe===1||qe===Je).flatMap(qe=>{let{positionAssignments:Pe}=si({structure:qe}),{seedAssignments:at,stageSequence:di,stage:Ae}=qe;return Ae===Ne?(He=(Pe==null?void 0:Pe.length)??0,Fe=Pe,Se=at):di===1&&(fe=Pe,pe=at),Pe}).map(({participantId:qe})=>qe).filter(Boolean),me=K(Se),Ue=K(pe),$e=oe?Ze.filter(({participantId:qe})=>ue.includes(qe)):Ze,Ee=!p||(Z==null?void 0:Z.published)&&(((r=Z==null?void 0:Z.drawIds)==null?void 0:r.length)===0||((n=Z==null?void 0:Z.drawIds)==null?void 0:n.includes(ae)));for(let qe of $e){if(!f[qe.participantId])continue;let{entryStatus:Pe,entryStage:at,entryPosition:di,participantId:Ae}=qe,yt=$({participantId:Ae,scaleNames:ne,eventType:V}),yi=be=>{var Ct,Re,Ye,xt,Fi;if(!f[be]||(Ct=f[be].draws)!=null&&Ct[ae])return;let bi=D&&Ee,pi=bi?{}:void 0,Li=bi?((Re=me==null?void 0:me[Ae])==null?void 0:Re.seedValue)||((Ye=me==null?void 0:me[Ae])==null?void 0:Ye.seedNumber):void 0,un=Li?me==null?void 0:me[Ae]:void 0,er=bi?((xt=Ue==null?void 0:Ue[Ae])==null?void 0:xt.seedValue)||((Fi=Ue==null?void 0:Ue[Ae])==null?void 0:Fi.seedNumber):void 0,Qn=er?Ue==null?void 0:Ue[Ae]:void 0;pi&&Li&&(pi[Ne]=un),pi&&er&&(pi[Je]=Qn);let to=Li||er;to&&(f[be].participant.seedings[V]||(f[be].participant.seedings[V]=[]),un&&f[be].participant.seedings[V].push({...un,scaleName:ae}),Qn&&f[be].participant.seedings[V].push({...Qn,scaleName:ae}),pi&&(f[be].events[W].seedAssignments||(f[be].events[W].seedAssignments={}),Object.keys(pi).forEach($p=>f[be].events[W].seedAssignments[$p]=pi[$p]))),(E||y)&&(f[be].draws[ae]=Ge({seedAssignments:pi,entryPosition:di,entryStatus:Pe,entryStage:at,seedValue:to,eventId:W,ranking:yt,drawId:ae},!1,!1,!0))};[Eo,Np].includes(Pe)||(yi(Ae),(a=f[Ae].participant.individualParticipantIds||[])==null||a.forEach(yi))}let Be=((oe==null?void 0:oe.structures)??[]).reduce((qe,Pe)=>(qe.includes(Pe.stage)||qe.push(Pe.stage),qe),[]),xe=((oe==null?void 0:oe.links)??[]).length;F[ae]={qualifyingPositionAssignments:fe,qualifyingSeedAssignments:pe,mainPositionAssignments:Fe,qualifyingSeedingMap:Ue,mainSeedAssignments:Se,orderedStructureIds:he,mainSeedingMap:me,flightNumber:pt,linksCount:xe,drawOrder:ye,drawName:ce,drawType:ke,drawSize:He,drawId:ae,stages:Be}}}if(y||b||S||w||U||T||E){let K=!!b||v,ie=((o=ou({afterRecoveryTimes:!!b,policyDefinitions:c,tournamentRecord:d,inContext:!0,participantMap:f,contextFilters:m,matchUpFilters:h,contextProfile:g,nextMatchUps:K,event:_}))==null?void 0:o.matchUps)??[];for(let ae of ie){let{finishingPositionRange:oe,potentialParticipants:ne,tieMatchUps:de=[],sides:ye=[],winningSide:ce,matchUpType:ke,matchUpId:we,eventId:Ze,drawId:pt,collectionId:he,stageSequence:fe,finishingRound:pe,matchUpStatus:Fe,roundPosition:Se,roundNumber:He,structureId:ue,schedule:me,score:Ue,stage:$e}=ae;C[we]=ae;let Ee={finishingPositionRange:oe,finishingRound:pe,stageSequence:fe,roundPosition:Se,collectionId:he,roundNumber:He,structureId:ue,schedule:me,eventId:Ze,drawId:pt,score:Ue,stage:$e};T2({...Ee,...A,matchUpStatus:Fe,winningSide:ce,matchUpType:ke,matchUpId:we,sides:ye});for(let Be of de){let{winningSide:xe,sides:qe=[],matchUpId:Pe,matchUpStatus:at,matchUpType:di}=Be;T2({...Ee,...A,winningSide:xe,tieWinningSide:ce,matchUpTieId:we,matchUpId:Pe,sides:qe,matchUpSides:ye,matchUpStatus:at,matchUpType:di})}Array.isArray(ne)&&(K||b||I)&&((s=ne.flat().map(Tt).filter(Boolean))==null||s.forEach(Be=>{var xe;(xe=N(Be))==null||xe.forEach(qe=>{f[qe]&&(f[qe].potentialMatchUps[we]=Ge({tournamentId:d==null?void 0:d.tournamentId,matchUpId:we,eventId:Ze,drawId:pt}))}),(b||I)&&hX({potential:!0,participantMap:f,participantId:Be,matchUpStatus:Fe,roundPosition:Se,structureId:ue,matchUpType:ke,roundNumber:He,matchUpId:we,schedule:me,drawId:pt,score:Ue})}))}O.push(...ie)}}if(w||y||b){let _=Object.values(f);for(let L of _){let{wins:B,losses:V,[ri]:{wins:G,losses:j},[ei]:{wins:z,losses:W}}=L.counters,q=(Y,re,J)=>{let H=re+J,Z=re,K=H&&Z/H;L.statistics[Y]={denominator:H,numerator:Z,statValue:K,statCode:Y}};if(w&&(q(eS,B,V),q(`${eS}.${ri}`,G,j),q(`${eS}.${ei}`,z,W)),y){let Y=(re=[])=>Math.abs(re[0]-re[1]);for(let re of Object.keys(L.draws)){let{orderedStructureIds:J=[],flightNumber:H}=F[re]||{};if(L.structureParticipation&&J.length){let Z,K=0,ie=J.map(ae=>{let oe=L.structureParticipation[ae];if(!oe)return;Z||(Z=oe==null?void 0:oe.finishingPositionRange),Y(Z)>Y(oe==null?void 0:oe.finishingPositionRange)&&(Z=oe==null?void 0:oe.finishingPositionRange);let ne=oe.stage!==Je;return ne&&(K+=1),Ge({...oe,participationOrder:ne?K:void 0,flightNumber:H})}).filter(Boolean);L.draws[re]&&(L.draws[re].finishingPositionRange=Z,L.draws[re].structureParticipation=ie)}}}if(b){let Y=At(b)?b.scheduledMinutesDifference:0,re=L.scheduleItems||[],J=L.potentialMatchUps||{},H=re.reduce((K,ie)=>{let{scheduledDate:ae,scheduledTime:oe}=ie;return K[ae]||(K[ae]=[]),oe&&K[ae].push(ie),K},{});Object.values(H).forEach(K=>K.sort(a8));for(let K of re){let{typeChangeTimeAfterRecovery:ie,timeAfterRecovery:ae,scheduledDate:oe,scheduledTime:ne}=K,de=H[oe],ye=kt(ne);for(let ce of de){if(ce.matchUpId===K.matchUpId||[Ft,Pt].includes(ce.matchUpStatus)&&!ce.checkScoreHasValue)continue;let ke=K.matchUpType!==ce.matchUpType&&ie||ae,we=K.drawId===ce.drawId,Ze=J[K.matchUpId]&&J[ce.matchUpId],pt=kt(ce.scheduledTime),he=Math.abs(pt-ye),fe=pt>=ye;if((Y&&!isNaN(Y)?he<=Y:fe&&kt(ce.scheduledTime)<kt(ke))&&!(Ze&&we)&&fe){let pe=[K.matchUpId,ce.matchUpId].sort(ZP).join("|");L.scheduleConflicts[pe]={priorScheduledMatchUpId:K.matchUpId,matchUpIdWithConflict:ce.matchUpId}}}}let Z=L.participant.participantId;Object.keys(L.scheduleConflicts).length&&M.push(Z),f[Z].scheduleConflicts=L.scheduleConflicts}}}return{participantIdsWithConflicts:M,eventsPublishStatuses:k,derivedEventInfo:x,derivedDrawInfo:F,mappedMatchUps:C,participantMap:f,matchUps:O}}function Aw({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var r;if(!Object.keys(t).length)return i;let{accessorValues:n,drawEntryStatuses:a,positionedParticipants:o,eventEntryStatuses:s,participantRoles:l,participantRoleResponsibilities:u,participantTypes:c,participantIds:d,signInStatus:p,enableOrFiltering:m,eventIds:h,genders:f}=t,g=Pl(h)&&((r=e==null?void 0:e.events)==null?void 0:r.filter(S=>h==null?void 0:h.includes(S.eventId)))||(e==null?void 0:e.events)||[],v=a&&UTe({drawEntryStatuses:a,tournamentEvents:g}),y=s&&STe({eventEntryStatuses:s,tournamentEvents:g}),I=o!==void 0&&[!0,!1].includes(o)&&g.reduce((S,w)=>S.concat(...(w.drawDefinitions||[]).map(U=>DJ({drawDefinition:U}).allPositionedParticipantIds).filter(Boolean)),[]),b=S=>n==null?void 0:n.reduce((w,U)=>{let{accessor:T,value:D}=U,{values:P}=pm({element:S,accessor:T});return w&&(P==null?void 0:P.includes(D))},!0);if(i=i==null?void 0:i.filter(S=>{var w,U;let T=(U=(w=Ro({element:S,itemType:hw}))==null?void 0:w.timeItem)==null?void 0:U.itemValue,{participantRoleResponsibilities:D,participantType:P,participantRole:E,participantId:R,person:N}=S,A=Array.isArray(f)&&(f==null?void 0:f.length)&&(N==null?void 0:N.sex)&&f.includes(N.sex);return m?f&&A||o&&I.includes(R)||o===!1&&!I.includes(R)||(v==null?void 0:v.includes(R))||(y==null?void 0:y.includes(R))||(d==null?void 0:d.includes(R))||p&&T===p||c&&P&&Pl(c)&&c.includes(P)||l&&E&&Pl(l)&&l.includes(E)||u&&Pl(D)&&Pl(u)&&u.find(M=>D==null?void 0:D.includes(M))||(n==null?void 0:n.length)&&Pl(n)&&b(S):(!f||A)&&(o===void 0||o&&I.includes(R)||o===!1&&!I.includes(R))&&(!v||v.includes(R))&&(!y||y.includes(R))&&(!d||d.includes(R))&&(!p||T===p)&&(!c||P&&Pl(c)&&c.includes(P))&&(!l||E&&Pl(l)&&l.includes(E))&&(!u||Pl(D)&&Pl(u)&&u.find(M=>D==null?void 0:D.includes(M)))&&(!(n!=null&&n.length)||Pl(n)&&b(S))}),g.length&&h){let S=g.filter(w=>h.includes(w.eventId)).map(w=>{let U=(w.entries||[]).map(D=>D.participantId);if(Ji(cl)(w.eventType))return U;let T=((e==null?void 0:e.participants)??[]).filter(D=>U.includes(D.participantId)).map(D=>D.individualParticipantIds).flat(1);return U.concat(...T)}).flat(1);i=i==null?void 0:i.filter(w=>S.includes(w.participantId))}return i}function Pl(t){return t&&Array.isArray(t)&&t.length}function UTe({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return dt(e.reduce((r,n)=>{var a,o;let{flightProfile:s}=Hi({event:n}),l=((a=s==null?void 0:s.flights)==null?void 0:a.map(({drawEntries:c})=>Array.isArray(c)?c.filter(i).map(Tt):[]).flat())||[],u=((o=n.drawDefinitions)==null?void 0:o.map(({entries:c})=>c?c.filter(i).map(Tt):[]))||[];return r.concat(...l,...u)},[]))}function STe({eventEntryStatuses:t,tournamentEvents:e}){return dt(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Tt);return i.concat(...n)},[]))}function Ai(t){var e;let{withIndividualParticipants:i,participantFilters:r={},withPotentialMatchUps:n,withRankingProfile:a,convertExtensions:o,policyDefinitions:s,withScheduleItems:l,tournamentRecord:u,scheduleAnalysis:c,withSignInStatus:d,withTeamMatchUps:p,withScaleValues:m,usePublishState:h,withStatistics:f,contextFilters:g,matchUpFilters:v,contextProfile:y,withOpponents:I,withMatchUps:b,internalUse:S,withSeeding:w,withEvents:U,withDraws:T,withISO2:D,withIOC:P}=t;if(!u)return{error:ve};(b||a)&&fs({tournamentRecord:u});let E=_J({convertExtensions:o,tournamentRecord:u,withSignInStatus:d,withScaleValues:m,internalUse:S,withISO2:D,withIOC:P}),{participantMap:R}=E,N=wTe({withMatchUps:b??a,withEvents:U??a,withDraws:T??a,withPotentialMatchUps:n,participantFilters:r,withRankingProfile:a,convertExtensions:o,withScheduleItems:l,policyDefinitions:s,tournamentRecord:u,scheduleAnalysis:c,withTeamMatchUps:p,usePublishState:h,withStatistics:f,contextFilters:g,matchUpFilters:v,participantMap:R,withOpponents:I,contextProfile:y,withSeeding:w}),{participantIdsWithConflicts:A,eventsPublishStatuses:M,derivedEventInfo:C,derivedDrawInfo:O,mappedMatchUps:k}=N,x=N.matchUps;R=N.participantMap;let F=c??n,$=({potentialMatchUps:j,scheduleConflicts:z,scheduleItems:W,participant:q,statistics:Y,opponents:re,matchUps:J,events:H,draws:Z})=>{let K=Object.values(Z),ie=Object.values(re);return I&&(K==null||K.forEach(ae=>{ae.opponents=ie.filter(oe=>oe.drawId===ae.drawId)})),Ge({...q,scheduleConflicts:c?Object.values(z):void 0,draws:T||a?K:void 0,events:U||a?Object.values(H):void 0,matchUps:b||a?Object.values(J):void 0,opponents:I?ie:void 0,potentialMatchUps:F?Object.values(j):void 0,statistics:f?Object.values(Y):void 0,scheduleItems:l?W:void 0},!1,!1,!0)},_=new Map;for(let j of Object.keys(R))_.set(j,$(R[j]));let L=[..._.values()],B=(e=s==null?void 0:s[yv])==null?void 0:e.participant,V=Aw({participants:L,participantFilters:r,tournamentRecord:u});if(i){let j=At(i)?i:void 0;for(let z of V)for(let W of z.individualParticipantIds??[]){z.individualParticipants||(z.individualParticipants=[]);let q=_.get(W),Y=j?_m({template:j,source:q}):q;z.individualParticipants.push(Y)}}let G=B?V.map(j=>_m({source:j,template:B})):V;return{participantMap:t.returnParticipantMap!==!1?R:void 0,mappedMatchUps:t.returnMatchUps!==!1?k:void 0,matchUps:t.returnMatchUps!==!1?x:void 0,missingParticipantIds:E.missingParticipantIds,participantIdsWithConflicts:A,eventsPublishStatuses:M,derivedEventInfo:C,derivedDrawInfo:O,participants:G,...Q}}function mm({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){var n;if(!e)return{error:_e};let a=(n=e.entries)==null?void 0:n.find(o=>o.participantId===t&&(!i||i===o.entryStatus)&&(!r||r===o.entryStage));return t&&a}function Dv(t){var e,i,r,n,a,o,s,l,u;let{provisionalPositioning:c,drawDefinition:d,stageSequence:p,structureId:m,stage:h}=t;if(!d)return{error:_e};let{entryProfile:f}=vw({drawDefinition:d}),g=h&&p&&((r=(i=(e=f==null?void 0:f[h])==null?void 0:e.stageSequence)==null?void 0:i[p])==null?void 0:r.qualifiersCount)||h&&((n=f==null?void 0:f[h])==null?void 0:n.qualifiersCount)||0,v={};if(!m)return{qualifiersCount:g,roundQualifiersCounts:v};let{structure:y}=rt({drawDefinition:d,structureId:m}),I=(a=d.links)==null?void 0:a.filter(w=>{var U;return((U=w==null?void 0:w.target)==null?void 0:U.structureId)===(y==null?void 0:y.structureId)}),b=0;if(I!=null&&I.length)for(let w of I){let U=(o=rt({structureId:w.source.structureId,drawDefinition:d}))==null?void 0:o.structure;if((U==null?void 0:U.stage)===Je){let T=w.source.roundNumber,D=w.target.roundNumber,P=0;if(U.structureType===_n){let E=((s=U.structures)==null?void 0:s.length)??0,R=((l=w.source.finishingPositions)==null?void 0:l.length)??0;P=E*R}else P=((u=qt({matchUpFilters:{roundNumbers:[T]},structure:U,afterRecoveryTimes:!1,provisionalPositioning:c,inContext:!1}).matchUps)==null?void 0:u.length)||0;v[D]||(v[D]=0),v[D]+=P,b+=P}}let S=Object.keys(v);if(S.length<=1){let w=S[0]||1;v[w]=Math.max(v[w]||0,g)}return b=Math.max(b,g),{qualifiersCount:b,roundQualifiersCounts:v}}function p0({stage:t,drawDefinition:e}){var i;let{entryProfile:r}=vw({drawDefinition:e});return((i=r==null?void 0:r[t])==null?void 0:i.drawSize)||0}function TTe(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=p0({stage:n,drawDefinition:i}),{qualifiersCount:o}=Dv({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-o}function fX({stage:t,drawDefinition:e}){return!!(t===Lr||fL({stage:t,drawDefinition:e})&&p0({stage:t,drawDefinition:e}))}function gX({entryStatus:t=da,drawDefinition:e,stageSequence:i,stage:r}){if(t===Jo)return g0e({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...Q}:{error:b9};let n=TTe({drawDefinition:e,stageSequence:i,stage:r}),a=v0e({drawDefinition:e,stage:r}),o=wM({entryStatus:mg,drawDefinition:e,stage:r}),s=wM({entryStatus:da,drawDefinition:e,stage:r}),l=o+s,u=l>=n,c=n-l;return r!==Lr&&u?{error:cM}:t===mg?o<a?{...Q}:{error:cM}:{positionsAvailable:c,...Q}}function RL(t){let e=We(t,[{[$n]:!0,[eJ]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=da,entryStageSequence:n,entryStage:a=Ne,ignoreStageSpace:o,drawDefinition:s,entryPosition:l,participant:u,roundTarget:c,extensions:d,extension:p,drawType:m,event:h}=t,f="addDrawEntry";if(m!==Ha&&!fX({stage:a,drawDefinition:s}))return te({result:{error:Dp},stack:f});let g=gX({stageSequence:n,stage:a,drawDefinition:s,entryStatus:r});if(!o&&!g.success&&(!m||m!==Ha))return{error:g.error};if(p&&!pl({extension:p}))return te({result:{error:le},info:"Invalid extension",context:{extension:p},stack:f});let v=t.participantId||(u==null?void 0:u.participantId);if(!v)return te({result:{error:fr},stack:f});let y=r===$u&&mm({participantId:v,drawDefinition:s,entryStatus:r}),I=a===Lr&&mm({participantId:v,drawDefinition:s,entryStage:a}),b=mm({participantId:v,drawDefinition:s}),S=r!==$u&&a!==Lr&&b;if(S)return i?(ut({payload:{drawId:s.drawId,eventId:h==null?void 0:h.eventId,error:XI,participantId:v},topic:XF}),{...Q}):te({result:{error:XI},context:{participantId:v},stack:f});if(y||I)return te({context:{invalidEntry:S,invalidLuckyLoser:y,invalidVoluntaryConsolation:I},result:{error:cP},stack:f});let w=Ge({entryStageSequence:n,participantId:v,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&_t({element:w,extension:p}),c&&_t({extension:{name:"roundEntry",value:c},element:w}),s.entries||(s.entries=[]),s.entries.push(w),ui({drawDefinition:s}),{...Q}}function DTe(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=da,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:o,drawDefinition:s,stageSequence:l,stage:u=Ne,roundTarget:c,extension:d,event:p}=t;if(!u)return{error:QK};if(!s)return{error:_e};if(!Array.isArray(o))return{error:ba};if(!fX({stage:u,drawDefinition:s}))return{error:Dp};if(d&&!pl({extension:d}))return te({result:{error:le},info:"Invalid extension",context:{extension:d},stack:e});let m=gX({drawDefinition:s,stageSequence:l,entryStatus:r,stage:u});if(!a&&!m.success)return{error:m.error};let h=m.positionsAvailable??0;if(!a&&u!==Lr&&h<o.length)return{error:rF};let f=[],g=s.drawId,v=p==null?void 0:p.eventId,y=o.reduce((I,b)=>{let S=r===$u&&mm({participantId:b,drawDefinition:s,entryStatus:r}),w=u===Lr&&mm({entryStage:u,drawDefinition:s,participantId:b}),U=mm({participantId:b,drawDefinition:s});return r!==$u&&u!==Lr&&U&&(f.push(b),i&&ut({payload:{error:XI,participantId:b,eventId:v,drawId:g},topic:XF})),S||w?I.concat(b):I},[]);return f.length&&!i?te({context:{eventId:v,drawId:g,duplicateEntries:f},result:{error:XI},stack:e}):(o.filter(I=>I&&!y.includes(I)).forEach(I=>{let b={entryStageSequence:l,entryStage:u,participantId:I,entryStatus:r};d&&_t({element:b,extension:d}),c&&_t({extension:{name:Ul,value:c},element:b}),s.entries||(s.entries=[]),s.entries.push(b)}),n&&(s.entries=Ps({entries:s.entries})),ui({drawDefinition:s}),y!=null&&y.length||f!=null&&f.length?{info:"some participantIds could not be added",participantIdsNotAdded:y,duplicateEntries:f,...Q}:{...Q})}function EL({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,entryStage:l,extension:u,drawId:c,event:d}){if(!(n!=null&&n.length))return{error:Zc};if(!d)return{error:fo};if(!c)return{error:Bs};let p=(d.entries||[]).map(Tt);if(n.filter(f=>!p.includes(f)).length)return{error:JK};if(a){let f=DTe({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,extension:u});if(f.error)return f}let{flightProfile:m}=Hi({event:d}),h=m==null?void 0:m.flights.find(f=>f.drawId===c);return h!=null&&h.drawEntries&&(n.forEach(f=>{let g=o===$u&&zE({participantId:f,entryStatus:o,flight:h}),v=l===Lr&&zE({participantId:f,entryStage:l,flight:h});!(o!==$u&&l!==Lr&&zE({flight:h,participantId:f}))&&!g&&!v&&h.drawEntries.push({participantId:f,entryStatus:o,entryStage:l})}),e&&(h.drawEntries=Ps({entries:h.drawEntries}))),{...Q}}function zE({participantId:t,entryStatus:e,entryStage:i,flight:r}){var n;let a=(n=r.drawEntries)==null?void 0:n.find(o=>o.participantId===t&&(!e||e===o.entryStatus)&&(!i||i===o.entryStage));return t&&a}function Ow({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){var a,o,s,l;let u="removeEventEntries";if(!(n!=null&&n.eventId))return{error:Ii};if(!Array.isArray(e)||e.some(f=>!Pi(f)))return te({result:{error:ks},stack:u});let c=(n.drawDefinitions??[]).flatMap(f=>kp({drawDefinition:f}).assignedParticipantIds??[]),d=((i==null?void 0:i.length)&&((a=n.entries)==null?void 0:a.filter(f=>f.entryStatus&&i.includes(f.entryStatus)))||[]).map(Tt).filter(f=>!c.includes(f)),p=(r&&((o=n.entries)==null?void 0:o.filter(f=>f.entryStage&&f.entryStage===r))||[]).map(Tt).filter(f=>!c.includes(f));if(e.length?e=e.filter(f=>(!(i!=null&&i.length)||d.includes(f))&&(!r||p.includes(f))):d.length&&p.length?e=ji(d,p):d.length?e=d:p.length&&(e=p),(e==null?void 0:e.length)&&c.some(f=>e.includes(f)))return te({result:{error:pv},stack:u});if(!(e!=null&&e.length))return{...Q,participantIdsRemoved:[]};let m=[];n.entries=(n.entries??[]).filter(f=>{let g=!e.includes(f==null?void 0:f.participantId);return g||m.push(f.participantId),g}),t&&(n.entries=Ps({entries:n.entries}));let{flightProfile:h}=Hi({event:n});return(s=h==null?void 0:h.flights)==null||s.forEach(f=>{f.drawEntries=(f.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(l=n.drawDefinitions)==null||l.forEach(f=>{f.entries=(f.entries??[]).filter(g=>!e.includes(g.participantId))}),{...Q,participantIdsRemoved:m}}var vX={[_r]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},Pv=vX;function Zs(t){var e,i;let{suppressDuplicateEntries:r=!0,entryStatus:n=da,autoEntryPositions:a=!0,enforceGender:o=!0,entryStageSequence:s,policyDefinitions:l,entryStage:u=Ne,tournamentRecord:c,ignoreStageSpace:d,drawDefinition:p,roundTarget:m,extensions:h,extension:f,drawId:g,event:v}=t,y="addEventEntries";if(!Array.isArray(t.participantIds))return te({result:{error:ba},stack:y});let I=dt(t.participantIds??[]);if(!v)return{error:Ii};if(!(I!=null&&I.length))return te({result:{error:Zc},stack:y});if(!(v!=null&&v.eventId))return{error:fo};let b=Bt({tournamentRecord:c,event:v}).appliedPolicies??{},S=(l==null?void 0:l[_r])??(b==null?void 0:b[_r])??Pv[_r],w=(o??((e=S==null?void 0:S.participants)==null?void 0:e.enforceGender))!==!1,U=[],T=[];if(h&&(!Array.isArray(h)||!h.every(O=>pl({extension:O})))||f&&!pl({extension:f}))return te({context:Ge({extension:f,extensions:h}),result:{error:le},info:"Invalid extension(s)",stack:y});let D=!!c,P=[],E,R=((i=c==null?void 0:c.participants)==null?void 0:i.filter(O=>{var k,x,F;if(!I.includes(O.participantId))return!1;let $=Ji(ri)(v.eventType)&&O.participantType===Dt&&!gd(n),_=v.eventType===ei&&O.participantType===gt;return $&&(!v.gender||!w||[jn,Fs].includes(v.gender)||v.gender===((k=O.person)==null?void 0:k.sex))||_&&!gd(n)||v.eventType===ei&&O.participantType===Dt&&gd(n)?!0:$&&v.gender&&w&&![jn,Fs].includes(v.gender)&&v.gender!==((x=O.person)==null?void 0:x.sex)?(P.push({participantId:O.participantId,sex:(F=O.person)==null?void 0:F.sex}),!1):v.eventType===Jt&&(O.participantType===Jt||gd(n)&&O.participantType===Dt)}).map(O=>O.participantId))??[],N=I.filter(O=>!D||R.includes(O));v.entries||(v.entries=[]);let A=v.entries.map(O=>{var k;return O.participantId||((k=O.participant)==null?void 0:k.participantId)});if(N.forEach(O=>{var k;if(!A.includes(O)){let x=Ge({participantId:O,entryStatus:n,entryStage:u,extensions:h});f&&_t({element:x,extension:f}),m&&_t({extension:{name:Ul,value:m},element:x}),s&&(x.entryStageSequence=s),U.push(x.participantId),(k=v.entries)==null||k.push(x)}}),g&&!gd(u)){let O=EL({participantIds:N,suppressDuplicateEntries:r,autoEntryPositions:a,entryStageSequence:s,ignoreStageSpace:d,drawDefinition:p,entryStatus:n,roundTarget:m,entryStage:u,extension:f,drawId:g,event:v});O.error&&(E=O.error)}if(v.eventType&&[Ou,Ca].includes(v.eventType)){let O=(v.entries||[]).map($=>$.participantId),k=(v.entries||[]).filter($=>gd($.entryStatus)).map($=>$.participantId),x=((c==null?void 0:c.participants)??[]).filter($=>O.includes($.participantId)&&$.participantType&&[gt,Jt].includes($.participantType)).map($=>$.individualParticipantIds).flat(1/0),F=k.filter($=>x.includes($));F.length&&(T.push(...F),Ow({participantIds:F,autoEntryPositions:!1,event:v}))}if(N.length!==I.length)return te({context:{mismatchedGender:P,gender:v.gender},result:{error:ba},stack:y});a&&(v.entries=Ps({entries:v.entries||[]}));let M=U.length,C=T.length;return te({result:{...Q,addedEntriesCount:M,removedEntriesCount:C},stack:y,info:E})}var IX="ADMINISTRATION",PTe="CAPTAIN",RTe="COACH",en="COMPETITOR",yX="MEDIA",bX="MEDICAL",CL="OFFICIAL",wX="OTHER",UX="SECURITY",ML={ADMINISTRATION:IX,CAPTAIN:PTe,COACH:RTe,COMPETITOR:en,MEDIA:yX,MEDICAL:bX,OFFICIAL:CL,OTHER:wX,SECURITY:UX};function NL({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return te({result:{error:ve},stack:a});if(!i||!e)return te({result:{error:Qe},stack:a});let o=(r.participants??[]).find(c=>c.participantId===i);if(!o)return te({result:{error:Wi},stack:a});if(![Jt,Qa].includes(o.participantType))return te({result:{participantType:o.participantType,error:xs},stack:a});let s=SX({individualParticipantIds:e,groupingParticipant:o,tournamentRecord:r,suppressErrors:n}),{removed:l,error:u}=s;if(u)return te({result:s,stack:a});if(t)for(let c of r.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(m=>!d.includes(m));Zs({participantIds:p,entryStatus:Eo,tournamentRecord:r,event:c})}}return l&&ut({topic:on,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...Q,...s}}function SX({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){var o,s;let l=[];if(!e)return{removed:l};let u=[],c=[];a||({participants:a,mappedMatchUps:n}=Ai({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let d=(s=(o=a==null?void 0:a.find(({participantId:h})=>h===e.participantId))==null?void 0:o.events)==null?void 0:s.map(({eventId:h})=>h),p=(e.individualParticipantIds??[]).filter(h=>{var f;let g=t==null?void 0:t.includes(h),v=g&&((f=a==null?void 0:a.find(I=>I.participantId===h))==null?void 0:f.matchUps.filter(({eventId:I})=>d.includes(I)).map(({matchUpId:I})=>n==null?void 0:n[I]).filter(({winningSide:I,score:b})=>I||br({score:b}))),y=g&&!(v!=null&&v.length);if(g&&!y&&c.push(h),y){l.push(h);for(let I of i.events??[])for(let b of I.drawDefinitions??[]){let{extension:S}=It({element:b,name:Lu}),w=S==null?void 0:S.value[e.participantId];S&&w&&(S.value[e.participantId]=w.filter(T=>T.participantId!==h),_t({element:b,extension:S}),mw({drawDefinition:b}));let U=Pn({drawDefinition:b,inContext:!1}).matchUps??[];for(let T of U){let D=T.sides??[];for(let P of D){let E=P.lineUp??[];E.find(R=>R.participantId===h)&&(P.lineUp=E.filter(R=>R.participantId!==h),Et({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:b,matchUp:T}))}}}}else u.push(h);return!y});e.individualParticipantIds=p;let m={groupingParticipantId:e.participantId,cannotRemove:c,notRemoved:u,removed:l};return c.length&&!r&&{...m,cannotRemove:c,error:lP}||m}function eR({participantRole:t=en,individualParticipantIds:e=[],groupingTypes:i=[Gn,Qa],tournamentRecord:r}){if(!r)return{error:ve};let n=r.participants??[],{participants:a,mappedMatchUps:o}=Ai({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),s=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=SX({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:o,participants:a});u&&s++}),s?Q:{error:f9}}function Bh(t){var e,i;let r=We(t,[{[Ur]:!0},{participantIds:!0,[Xn]:dn,[Ko]:Zc}]);if(r.error)return r;let{addIndividualParticipantsToEvents:n,tournamentRecord:a,participantIds:o}=t,s=((e=a.participants)==null?void 0:e.length)||0;if(!s)return{...Q};let l=(i=a.events||[])==null?void 0:i.filter(({eventType:g})=>g===cr).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),u=Ai({participantFilters:{participantIds:o},tournamentRecord:a,withDraws:!0}).participants??[],c=g=>{let v=(Hr({matchUpFilters:{drawIds:g,matchUpTypes:[ei]},tournamentRecord:a}).matchUps??[]).flatMap(({sides:y})=>y==null?void 0:y.map(({participantId:I})=>I||[])).filter(Boolean);return ji(v,o)},d=l!=null&&l.length?c(l):[],p=u.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(l!=null&&l.length)||!(l!=null&&l.includes(y.drawId)))&&y.positionAssignments).length});if(d!=null&&d.length||p.length)return{error:pv};let m={},h={};for(let g of a.events||[]){let v=Ow({participantIds:o,event:g});if(v.error)return v;m[g.eventId]=v.participantIdsRemoved}a.participants=(a.participants??[]).filter(g=>{var v,y;let I=o.includes(g.participantId)||g.participantType===gt&&((v=g.individualParticipantIds)==null?void 0:v.some(b=>o.includes(b)));if(!I&&g.participantType===cr&&(y=g.individualParticipantIds)!=null&&y.some(b=>o.includes(b))&&(g.individualParticipantIds=g.individualParticipantIds.filter(b=>!o.includes(b))),I&&n&&g.participantType&&[gt,Jt].includes(g.participantType))for(let b of g.individualParticipantIds||[])o.includes(b)||(h[g.participantId]||(h[g.participantId]=[]),h[g.participantId].push(b));return!I});let f=s-a.participants.length;if(eR({individualParticipantIds:o,tournamentRecord:a}),n)for(let g of a.events||[]){let v=m[g.eventId].map(y=>h[y]||[]).flat();Zs({participantIds:v,entryStatus:Eo,tournamentRecord:a,event:g})}return f&&ut({payload:{participantIds:o,tournamentId:a.tournamentId},topic:QF}),f?{...Q,participantsRemovedCount:f}:{error:lP}}function TX({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){var o;let s=n.entries??[];if(r){let{flightProfile:u}=Hi({event:n}),c=(o=u==null?void 0:u.flights)==null?void 0:o.find(d=>d.drawId===r);c?s=c.drawEntries:e.entries&&(s=e==null?void 0:e.entries)}let l=s.filter(u=>(!(i!=null&&i.length)||!u.entryStatus||i.includes(u.entryStatus))&&(!a||!u.entryStage||u.entryStage===a)&&(!t||u.entryStatus&&hs.includes(u.entryStatus)));return{entries:s,stageEntries:l}}function DX({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:o}){var s;let l="destroyGroupEntry";if(!e)return{error:ve};if(!r)return te({result:{error:fr},stack:l});if(!o)return{error:Ii};if(!o.eventType||![Ou,Ca].includes(o.eventType))return te({result:{error:ql},stack:l});let u=e.participants??[],c=u.find(y=>y.participantId===r);if(!c)return te({result:{error:Wi},stack:l});if(!c.participantType||![gt,Gn].includes(c.participantType)||c.participantType===Gn&&o.eventType!==Ca||c.participantType===gt&&o.eventType!==Ou)return{error:xs};let d=(o.entries??[]).find(y=>y.participantId===r);if(!d)return{error:y9};let{stageEntries:p}=TX({selected:!1,drawDefinition:i,drawId:n,event:o,stage:a}),m=p.map(Tt),h=u.filter(({participantId:y})=>m.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),f=(s=c.individualParticipantIds)==null?void 0:s.filter(y=>Xs(y,h).length===1),g=Ow({participantIds:[r],event:o});if(g.error||f!=null&&f.length&&(g=Zs({participantIds:f,entryStatus:Eo,entryStage:d.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:o}),g.error))return g;let v;return t&&Bh({participantIds:[r],tournamentRecord:e}).success&&(v=!0),{...Q,participantRemoved:v}}function AL({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return DX({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function PX(t){if(!t.tournamentRecord)return{error:ve};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let o=DX({participantId:a,...i});o.success&&(r+=1),o.error&&n.push(o.error)}return r?{destroyedCount:r,...Q}:{error:n}}function gy(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:o,drawId:s}=t,l="removeDrawPositionAssignment",u=Mw(t);if(u.error)return te({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:m}=t,h=Bt({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([Jo,Ql].includes(a)&&c){let{tournamentRecord:g}=t,{participant:v}=ad({tournamentRecord:g,participantId:c}),{participantType:y,individualParticipantIds:I}=v??{};if(n&&y===gt){let b=AL({tournamentRecord:g,drawDefinition:r,participantId:c,event:p});if(b.error)return te({result:b,stack:l});I&&d0({participantIds:I,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:s,event:p})}else d0({participantIds:[c],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:s,event:p})}if(i){let g=eo({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:m,matchUpsMap:o,event:p});if(g.error)return te({result:g,stack:l})}let{structure:f}=rt({drawDefinition:r,structureId:m});return uL({structure:f,drawPositions:[d]}),VP({appliedPolicies:h,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:m}}),u}function RX(t){return Object.assign(t,{entryStatus:Ql}),gy(t)}function EM(t){return Pi(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function tn(t){return Pi(t)?EM(t.replace(/_/g," ")):""}var wc=({finishingPosition:t=Eh,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:r=[],stageSequence:n=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:u,matchUpType:c,matchUps:d=[],structureId:p,roundOffset:m,roundLimit:h,stageOrder:f,structures:g,stage:v})=>{let y={structureId:p??Ht(),structureAbbreviation:i,finishingPosition:t,seedAssignments:r,matchUpFormat:s,stageSequence:n,structureName:u};a&&(y.structureOrder=a),l&&(y.structureType=l),o&&(typeof o=="string"?y.seedingProfile=o:typeof o=="object"&&typeof o.positioning=="string"&&(y.seedingProfile=o.positioning)),c&&(y.matchUpType=c),m&&(y.roundOffset=m),f&&(y.stageOrder=f),h&&(y.roundLimit=h),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let I=d.flatMap(({drawPositions:b})=>b).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=dt(I).sort((b,S)=>b-S).map(b=>({drawPosition:b}))),y},uo=wc;function OL({structureName:t=tn(Lr),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:_e};let a=uo({stage:Lr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),ui({drawDefinition:i,structureIds:[a.structureId]}),{...Q}}function kL({drawPositions:t}){if(!(t!=null&&t.length))return{error:Xb};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=dt(i.map(tR)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function tR(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(ur).join("|")}function EX({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,m)=>m),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),o=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{n[p].push([a[v],o[v]])});let m=a.shift(),h=a.pop(),f=o.shift();a=[m,f,...a].filter(Boolean),o=[...o,h].filter(Boolean)});let s=a.shift(),l=a.pop(),u=o.shift();a=[s,u,...a].filter(Boolean),o=[...o,l].filter(Boolean);let c=d=>d[0].reduce((p,m)=>p+m);return[...n].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(m=>m<=t)).map(p=>{let m=p.map(h=>h+e);return tR(m)}))}function ETe({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Qe}}var CTe={getRoundRobinGroupMatchUps:kL,determineRoundNumber:ETe,drawPositionsHash:tR,groupRounds:EX};function kw(t){var e;let{groupNameBase:i="Group",playoffAttributes:r,stageSequence:n=1,structureOptions:a,appliedPolicies:o,seedingProfile:s,stage:l=Ne,matchUpType:u,roundTarget:c,structureId:d,groupNames:p,drawSize:m,idPrefix:h,isMock:f,uuids:g}=t,v=t.structureName??((e=r==null?void 0:r[0])==null?void 0:e.name)??tn(Ne),{groupCount:y,groupSize:I}=MTe({structureOptions:a,appliedPolicies:o,drawSize:m}),b=Jd,S,w=De(1,y+1).map(T=>{let D=NTe({groupSize:I,structureOrder:T,matchUpType:u,drawSize:m,idPrefix:h,isMock:f});S=Array.isArray(D)?Math.max(...D.map(({roundNumber:E})=>E??0)):0;let P=(p==null?void 0:p[T-1])??`${i} ${T}`;return wc({structureId:g==null?void 0:g.pop(),structureType:TP,finishingPosition:b,structureOrder:T,structureName:P,matchUps:D})}),U=wc({structureId:d??(g==null?void 0:g.pop()),structureType:_n,finishingPosition:b,seedingProfile:s,structureName:v,stageSequence:n,structures:w,stage:l});return c&&_t({extension:{name:Ul,value:c},element:U}),{structures:[U],maxRoundNumber:S,groupCount:y,links:[],groupSize:I,...Q}}function MTe({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e==null?void 0:e.groupSize,n=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=xw({groupSizeLimit:n,drawSize:i}),o=a&&Math.max(...a);r&&a!=null&&a.includes(r)||(r&&r>4||!(a!=null&&a.includes(4))?r=o:r=4);let s=Math.ceil(i/r);return{groupSize:r,groupCount:s}}function xw(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=De(3,e+1).filter(n=>{let a=Math.ceil(i/n),o=a*n-i,s=Math.ceil(i/a),l=Math.ceil(o/a);return(!o||o<n)&&s===n&&s>=3&&l<2});return{...Q,validGroupSizes:r}}function NTe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:o}){let s=(t-1)*i,l=De(1+s,i+1+s),u=kL({drawPositions:l}).uniqueMatchUpGroupings??[],c=EX({groupSize:i,drawPositionOffset:s});return u.map(p).sort((m,h)=>(m.roundNumber??1/0)-(h.roundNumber??1/0));function d(m){return c.reduce((h,f,g)=>f.includes(m)?g+1:h,void 0)}function p(m){let h=tR(m),f=d(h),g=[1,r],v=ATe({structureOrder:t,drawPositions:m,roundNumber:f,idPrefix:n,uuids:o}),y={matchUpStatus:f?Qi:jt,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:m,roundNumber:f,matchUpId:v};return a&&(y.isMock=!0),y}}function ATe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:(n==null?void 0:n.pop())||Ht()}function xL(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!st(i))return{seedBlocks:void 0,...te({result:{error:le},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=sv(i);if(e){let m=Math.min(e,n),h=[],f=1;for(De(0,m).forEach(()=>{h.push([f]),f++});f<n;){let g=De(f,f+m);f+=m,h.push(g)}return{...Q,seedBlocks:h}}let a=De(1,n+1),o=[],s=n/2;for(;s>1;){let m=Cr(a,s),h=m.length;m.forEach((f,g)=>{let v,y=g<h/2,I=g%2===0,b=f[0],S=f[f.length-1];r&&h>4?h===8?v=y?S:b:v=I?b:S:v=y?b:S,Nn(f,o)||o.push(v)}),s=s/2}let l=a.filter(m=>!o.includes(m));for(;l.length;)l.length%2===0?o.push(l.pop()):o.push(l.shift());let u=De(0,20).map(m=>Math.pow(2,m));u.unshift(1);let c=u.indexOf(n),d=0,p=[];return De(0,c).forEach(m=>{p.push(o.slice(d,d+u[m])),d+=u[m]}),{...Q,seedBlocks:p}}function FL({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!st(e))return{seedGroups:void 0,...te({result:{error:le},context:{drawSize:e},stack:i})};if(t){if(!st(t))return{seedGroups:void 0,...te({context:{roundRobinGroupsCount:t},result:{error:le},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:De(0,n).map(()=>{let a=De(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=xL({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function LL({roundRobinGroupsCount:t,participantsCount:e}){var i;if(t){let{validGroupSizes:a}=xw({drawSize:e});if(!((i=a==null?void 0:a.map(o=>Math.ceil(e/o)))!=null&&i.includes(t)))return te({context:{roundRobinGroupsCount:t},result:{error:le}})}let{seedGroups:r}=FL({drawSize:e,roundRobinGroupsCount:t}),n=(r==null?void 0:r.map(a=>Math.min(...a)))||[];return{...Q,seedingThresholds:n}}function fg(t){if(!t)return 1/0;if(st(t))return tt(t);let e=t.split("-")[0];return st(e)?tt(e):1/0}function OTe({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(ur),e.reverse(),e}function kTe({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function xTe({positioning:t,size:e}){let i=OTe({size:e}),r=[],n=[],a=p=>p[0],o=p=>p[p.length-1],s=(p,m)=>(t&&[SP,Yd].includes(t)&&m%2?o(p):a(p))||a(p),l=(p,m)=>{if(p.every(h=>!n.includes(h))){let h=s(p,m);return n.push(h),h}},u=p=>{let m=p.filter(h=>!n.includes(h));if(m.length)return n.push(...m),m},c=(p,m)=>{let h=s(p,m);if(!n.includes(h))return n.push(h),h},d=De(1,e+1);for(let p of i)if(p===1){let m=Cr(d,2),h=m.map(l).filter(Boolean);h.length&&r.push(h);let f=m.flatMap(u).filter(Boolean);f.length&&r.push(f)}else{let m=Cr(d,p).map(c).filter(Boolean);m.length&&r.push(m)}return{divisions:i,divisionGroupings:r}}function Vh({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:o}){var s;let l=[];if(!o)return{error:Tp};let{matchUps:u,roundMatchUps:c}=qt({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:d}=Io({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:o}),{positionAssignments:p}=Mr({structure:o}),m=p==null?void 0:p.length,h=(d==null?void 0:d.length)??0,f=[],g=Object.keys(c).map(O=>parseInt(O)).sort((O,k)=>O-k).map(O=>{let k=c[O].map(F=>F.drawPositions).flat(1/0).filter(Boolean),x=k.filter(F=>!f.includes(F));return f=f.concat(...k),x}).filter(O=>O.length).reverse(),v=g.pop()??[],y=v&&Math.min(...v)-1||0;r=r??((s=i==null?void 0:i.seeding)==null?void 0:s.seedingProfile);let I=(v==null?void 0:v.length)||0,b=g.filter(O=>O.filter(k=>k<=h).length),{stage:S,structureType:w,roundLimit:U}=o,T=w===_n,D=!T&&(g==null?void 0:g.length),P=!T&&S===Je&&U,E=b.flat(1/0),R=D?E==null?void 0:E.length:0,N=a?m:h,A=gL({drawDefinition:n,structure:o,matchUps:u}),M=A?0:!D&&N||N&&E.length<N&&N-E.length||0;if(P){let O=o!=null&&o.matchUps?o.matchUps.filter(({roundNumber:x})=>x===o.roundLimit).length:0,k=v.length/O;if(!D){let x=Fw(r),F=Cr(v,k),$=1,_=De(0,F[0].length).map(()=>{let L=De($,$+F.length);return $+=F.length,L});({validSeedBlocks:l}=CX({drawPositionBlocks:F,nonRandom:r==null?void 0:r.nonRandom,positioning:x,seedGroups:_}))}}else T?{validSeedBlocks:l}=FTe({nonRandom:r==null?void 0:r.nonRandom,seedingProfile:r,structure:o}):D?l=b.map(O=>({seedNumbers:O,drawPositions:O})):A&&Cr(v,2).map((O,k)=>({drawPositions:[O[0]],seedNumbers:[k+1]})).forEach(O=>l.push(O));if(!T&&!A&&!P){let{blocks:O}=LTe({drawPositionOffset:y,seedNumberOffset:R,seedCountGoal:M,seedingProfile:r,baseDrawSize:I});O.forEach(k=>l.push(k))}let C=l.flatMap(O=>O.drawPositions).reduce((O,k)=>(v==null?void 0:v.includes(k))&&O,!0);return!A&&!D&&!T&&!C?{error:WK,validSeedBlocks:[],isContainer:T,isFeedIn:D}:{isLuckyStructure:A,validSeedBlocks:l,isContainer:T,isFeedIn:D}}function FTe({seedingProfile:t,structure:e,nonRandom:i}){var r;let n=e.structures||[],a=n.length,o=(r=si({structure:e}))==null?void 0:r.positionAssignments,s=Fw(t),l=(o==null?void 0:o.length)??0,{seedGroups:u}=FL({roundRobinGroupsCount:a,drawSize:l}),c=n.map(d=>{var p;return(p=si({structure:d}).positionAssignments)==null?void 0:p.map(m=>m.drawPosition)});return CX({drawPositionBlocks:c,positioning:s,seedGroups:u,nonRandom:i})}function CX({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=xTe({size:i.length,positioning:e}),o=[];return i.forEach((s,l)=>{let u=kTe({blockPattern:a,index:l});s.forEach((c,d)=>{let p=l%2?t.length-d-1:d,m=t[p].slice().filter((f,g)=>u.includes(g+1)&&f);e!==Yd?m=r?m:Tn(m):l%2&&m.reverse();let h=m.find(f=>!o.includes(f));h&&(o.push(h),n.push({drawPositions:[h],seedNumbers:[c]}))})}),{validSeedBlocks:n}}function LTe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:o}=t,s=1,l=[],{seedBlocks:u}=xL({cluster:Fw(n)===SP,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let d of u){if(s+1>a)break;let p=d.map(h=>h+e),m=c(s+1,d.length).map(h=>+h+r);s+=d.length,l.push({drawPositions:p,seedNumbers:m})}return{blocks:l};function c(d,p){return Array.from(new Array(p),(m,h)=>h+d)}}function m0({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){var o,s,l,u,c,d;let{structure:p}=rt({drawDefinition:e,structureId:n});t||(t=Bt({drawDefinition:e}).appliedPolicies);let m=i==null?void 0:i.validSeedBlocks;return!m&&p&&(m=(o=Vh({appliedPolicies:t,drawDefinition:e,structure:p}))==null?void 0:o.validSeedBlocks),(l=(s=t==null?void 0:t.seeding)==null?void 0:s.validSeedPositions)!=null&&l.ignore?!0:(c=(u=t==null?void 0:t.seeding)==null?void 0:u.validSeedPositions)!=null&&c.strict?(((d=m.find(h=>h.seedNumbers.includes(a)))==null?void 0:d.drawPositions)||[]).includes(r):[].concat(...m.map(h=>h.drawPositions)).includes(r)}function MX(t){var e,i,r;let{provisionalPositioning:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,structureId:l,randomize:u}=t,{structure:c}=rt({drawDefinition:a,structureId:l}),{seedAssignments:d}=Io({returnAllProxies:t.returnAllProxies,provisionalPositioning:n,drawDefinition:a,structure:c}),{positionAssignments:p}=Mr({structure:c}),m=(e=p==null?void 0:p.filter(M=>M.participantId??M.bye??M.qualifier))==null?void 0:e.map(M=>M.drawPosition).filter(Boolean),{appliedPolicies:h}=Bt({drawDefinition:a}),f=((s==null?void 0:s.validSeedBlocks)||c&&((i=Vh({returnAllProxies:t.returnAllProxies,provisionalPositioning:n,appliedPolicies:h,drawDefinition:a,seedingProfile:o,structure:c}))==null?void 0:i.validSeedBlocks)||[]).filter(M=>M.drawPositions.filter(C=>!(m!=null&&m.includes(C))).length)[0],g=d==null?void 0:d.map(M=>M.participantId).filter(Boolean),v=p==null?void 0:p.map(M=>M.participantId).filter(Boolean),y=g==null?void 0:g.filter(M=>v==null?void 0:v.includes(M)),I=g==null?void 0:g.filter(M=>!(v!=null&&v.includes(M))),b=d==null?void 0:d.filter(M=>I==null?void 0:I.includes(M.participantId)),S=d==null?void 0:d.filter(M=>!M.participantId),w=(b!=null&&b.length&&b.length>0?b.length:(S==null?void 0:S.length)??0)&&(f==null?void 0:f.drawPositions.filter(M=>!(m!=null&&m.includes(M))))||[],U=u?Tn(w):w,T=[],D=U.map(()=>{var M;let C=(M=A(b,T))==null?void 0:M.participantId;return C&&T.push(C),C}).filter(Boolean),P=d==null?void 0:d.filter(M=>y==null?void 0:y.includes(M.participantId)).map(M=>M.seedNumber),E=((f==null?void 0:f.seedNumbers)||[]).filter(M=>!(P!=null&&P.includes(M))),R=d==null?void 0:d.filter(M=>E.includes(M.seedNumber)).map(M=>M.participantId),N=(r=h==null?void 0:h.seeding)==null?void 0:r.duplicateSeedNumbers;return{nextSeedBlock:f,unplacedSeedParticipantIds:N===void 0||N?D:R,unplacedSeedNumbers:E,unfilledPositions:U,unplacedSeedAssignments:b};function A(M,C){let O=M.filter(F=>!C.includes(F.participantId)),k=Math.min(...O.map(F=>fg(F.seedValue))),x=O.filter(F=>fg(F.seedValue)===k);return Tn(x).pop()}}function Fw(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function Rv({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:u,event:c}){var d,p,m;let h="assignSeed",{structure:f}=rt({drawDefinition:i,structureId:o}),{positionAssignments:g}=Mr({structure:f}),v=Io({provisionalPositioning:t,drawDefinition:i,structure:f}).seedAssignments,y=v.map(T=>T.seedNumber),I=mm({drawDefinition:i,participantId:n});if(n&&!I)return te({result:{error:ks},context:{participantId:n},stack:h});let b=c?(p=(d=Hi({event:c}).flightProfile)==null?void 0:d.flights)==null?void 0:p.length:0,S=b&&b>1,w=(m=g==null?void 0:g.find(T=>T.participantId===n))==null?void 0:m.drawPosition;if(w&&!m0({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s}))return te({result:{error:Gx},context:{assignedDrawPosition:w},info:"invalid seed position",stack:h});y.includes(s)||v.push({seedNumber:s,seedValue:l});let U;return v.forEach(T=>{T.participantId===n&&T.seedNumber!==s&&(T.participantId=void 0),T.seedNumber===s&&(T.participantId=n,!(r!=null&&r.groupSeedingThreshold)&&!S&&(T.seedValue=l??s),U=!0)}),U?(AJ({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:f,eventId:u}),{...Q}):te({result:{error:zK},stack:h})}function _L({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:o}){var s,l,u,c;let d=(l=(s=t==null?void 0:t.sides)==null?void 0:s[e])==null?void 0:l.sideNumber,p=d&&((u=a.sides)==null?void 0:u.find(g=>g.sideNumber===d)),{extension:m}=It({element:n,name:Lu}),h=(m==null?void 0:m.value)||{},f=Me(h[i],!1,!0);if(p)(c=a==null?void 0:a.sides)==null||c.forEach(g=>{g.sideNumber===d&&(g.lineUp=f)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(I=>I.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===d);g&&(g.lineUp=f)}Et({tournamentId:r==null?void 0:r.tournamentId,context:"updateSidLineUp",eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUp:a})}function NX(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,o=i.roundNumber>1&&i.roundNumber-1,s=Zd({structureId:r.structureId,matchUpsMap:n});!e&&a&&(e=s.find(({drawPositions:h,roundNumber:f})=>f===o&&(h==null?void 0:h.includes(a))));let l=e==null?void 0:e.roundPosition,u=l%2?1:-1,c=l+u,d=o&&s.find(({roundNumber:h,roundPosition:f})=>h===o&&f===c),p=d==null?void 0:d.matchUpStatus,m=[ir,pr].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:m}}function _Te({drawPosition:t,drawPositions:e}){let i=!1,r=!!(e!=null&&e.includes(t));return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(ur).filter(Boolean),positionAdded:i,positionAssigned:r}}function AX({structureId:t,matchUpsMap:e,matchUp:i}){let r=i==null?void 0:i.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:Zd({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:s})=>o===(i==null?void 0:i.roundNumber)&&s===a)}}function OX({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:o}=AX({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:r});if(a&&o){let s=o==null?void 0:o.matchUpId,l=t.find(c=>c.matchUpId===s),u=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(c=>{let d=Pi(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function nS({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,o)=>{var s;return(s=a.drawPositions)!=null&&s.includes(e)?o+1:n},void 0)}function gg({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:u}){var c,d,p,m;let h="assignMatchUpDrawPosition";s||(s=ln({drawDefinition:n})),t||(t=gr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[]);let f=t.find(C=>C.matchUpId===l),g=f==null?void 0:f.structureId,v=(c=n==null?void 0:n.structures)==null?void 0:c.find(C=>C.structureId===g);if(!v)return{error:Ni};let y=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(C=>C.matchUpId===l),I=(y==null?void 0:y.drawPositions)??[],{positionAdded:b,positionAssigned:S,updatedDrawPositions:w}=_Te({drawPositions:I,drawPosition:o}),{positionAssignments:U}=si({drawDefinition:n,structure:v}),T=(p=U==null?void 0:U.filter(C=>w.includes(C.drawPosition)))==null?void 0:p.find(({bye:C})=>C),D=(y==null?void 0:y.matchUpStatus)&&[Ft,Pt].includes(y.matchUpStatus)&&w.filter(Boolean).length<2;if(a=T&&jt||a||D&&y.matchUpStatus||(y==null?void 0:y.matchUpStatus)&&[ir,pr].includes(y.matchUpStatus)&&y.matchUpStatus||Qi,y&&b){t=gr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[];let C=D&&nS({inContextDrawMatchUps:t,drawPosition:o,matchUpId:l})||void 0;y!=null&&y.matchUpStatusCodes&&OX({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:s,matchUp:y}),Object.assign(y,{drawPositions:w,winningSide:C,matchUpStatus:a}),Et({tournamentId:i==null?void 0:i.tournamentId,eventId:f==null?void 0:f.eventId,context:h,drawDefinition:n,matchUp:y})}let P=On({inContextDrawMatchUps:t,inContextMatchUp:f,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:E,loserMatchUp:R,loserTargetDrawPosition:N},targetLinks:{loserTargetLink:A}}=P,M=Zd({structureId:v.structureId,matchUpsMap:s});if(S&&T){if(E)if([jt,ir,pr].includes(a)){let C=gg({matchUpId:E.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(C.error)return C}else{let{structureId:C}=E;C!==v.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(E&&f&&!f.feedRound){let{pairedPreviousMatchUpIsDoubleExit:C}=NX({targetMatchUp:y,drawPosition:o,matchUpsMap:s,structure:v});if(C){let O=gg({matchUpId:E.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(O.error)return O}}if((y==null?void 0:y.matchUpType)===gi){let C=t==null?void 0:t.find(({matchUpId:x})=>x===y.matchUpId),O=((C==null?void 0:C.sides)??[]).reduce((x,F,$)=>F.drawPosition===o?$:x,void 0),k=(m=U==null?void 0:U.find(x=>x.drawPosition===o))==null?void 0:m.participantId;k&&O!==void 0&&_L({inContextTargetMatchUp:C,drawPositionSideIndex:O,teamParticipantId:k,tournamentRecord:i,drawDefinition:n,matchUp:y})}if((A==null?void 0:A.linkCondition)===dl&&w.filter(Boolean).length===2&&!T&&M.filter(({drawPositions:C,roundNumber:O})=>O===1&&Nn(C,w)).every(({matchUpStatus:C})=>[Ki,zr].includes(C))&&R){let{structureId:C}=R,O=eo({drawPosition:N,tournamentRecord:i,drawDefinition:n,structureId:C,matchUpsMap:s,event:u});if(O.error)return O}return S?{...Q}:te({result:{error:Zf},context:{drawPosition:o},stack:h})}function kX({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){var a,o,s,l;let u=((s=(o=(a=Uv({drawDefinition:e}))==null?void 0:a.containedStructures)==null?void 0:o[n.structureId])==null?void 0:s.map(({structureId:h})=>h))||[];u.push(n==null?void 0:n.structureId);let c=(i==null?void 0:i.map(({drawPosition:h})=>h))||[],d=(t==null?void 0:t.filter(h=>u.includes(h.structureId)&&ji(h.drawPositions??[],c).length))??[],p=d.map(({matchUpId:h})=>h),m=((l=r==null?void 0:r.drawMatchUps)==null?void 0:l.filter(h=>p.includes(h.matchUpId)))??[];return{drawPositions:c,matchUps:m,targetMatchUps:d}}function $L({lineUp:t}){if(!Array.isArray(t))return;let e={};return dt(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:o}=c0({collectionPosition:a,collectionId:r,lineUp:t});o.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function ip(t){return`${t} must be an array`}function iR({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(ip("lineUp")),{valid:!1,errors:i,error:le};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:o,collectionAssignments:s}=a;return o?typeof o!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(ip("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=dt(t.map(Tt)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?le:void 0}}function jh({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:_e};if(typeof e!="string")return{error:fr};let n=iR({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=It({element:t,name:Lu}),o=(a==null?void 0:a.value)||{};return o[e]=$L({lineUp:r}),_t({element:t,extension:{name:Lu,value:o}}),mw({drawDefinition:t}),{...Q}}function BL({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:o,event:s}){if(!r)return{error:_e};let{drawPositions:l,matchUps:u,targetMatchUps:c}=kX({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:o});for(let d of c)d.matchUpType===Va&&(d.sides??[]).forEach((p,m)=>{var h;if(p!=null&&p.drawPosition&&l!=null&&l.includes(p.drawPosition)){let f=u.find(({matchUpId:g})=>g===d.matchUpId);if((h=f==null?void 0:f.sides)!=null&&h[m]){if(delete f.sides[m].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&jh({drawDefinition:r,participantId:v,lineUp:[],tieFormat:g})}Et({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:r,matchUp:f})}}});return{...Q}}function ml({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){var m,h,f,g,v;let y="assignDrawPosition";if(!s&&!i)return te({result:{error:fr},stack:y});c=c??ln({drawDefinition:a}),e||({matchUps:e}=gr({inContext:!0,drawDefinition:a,matchUpsMap:c}));let I=rt({drawDefinition:a,structureId:d});if(I.error)return te({result:I,stack:y});let{structure:b}=I;if(!b)return{error:Ni};if(Yn({structure:b}))return te({result:{error:ua},stack:y});let{seedAssignments:S}=Io({provisionalPositioning:t,drawDefinition:a,structure:b}),w=(m=S==null?void 0:S.find(M=>M.participantId===s))==null?void 0:m.seedNumber,{appliedPolicies:U}=Bt({tournamentRecord:n,drawDefinition:a,structure:b,event:p});if(w&&!m0({seedNumber:w,appliedPolicies:U,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return te({result:{error:Gx},context:{drawPosition:u},stack:y});let T=Mr({structure:b}).positionAssignments||[],D=T==null?void 0:T.find(M=>M.drawPosition===u);if(!D)return te({result:{error:lv},context:{drawPosition:u},stack:y});if(T!=null&&T.map(Tt).includes(s))return te({result:{error:pv},context:{drawPosition:u},stack:y});let{containsParticipant:P,containsBye:E}=A(D);if(E){let M=Mw({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(M.error)return te({result:M,stack:y})}if(P&&D.participantId!==s){let{activeDrawPositions:M}=Cw({drawDefinition:a,structureId:d});if(M.includes(u))return te({result:{error:rP},stack:y});BL({assignments:[D],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:b})}if(D.participantId=s,i&&(D.qualifier=!0),b.stage===Ne&&(!b.stageSequence||b.stageSequence>1)||b.stage&&[an,Bi].includes(b.stage)){let M=b.stage===Je?Je:Ne,C=(((f=(h=a.structures)==null?void 0:h.find(O=>(O==null?void 0:O.stage)===M&&(O==null?void 0:O.stageSequence)===1))==null?void 0:f.seedAssignments)??[]).find(O=>O.participantId===s);if(C!=null&&C.participantId){let{participantId:O,seedNumber:k,seedValue:x}=C;Rv({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:O,seedNumber:k,seedValue:x,structureId:d,event:p})}}if(b.structureType!==_n)$Te({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:b,event:p});else{pX({positionAssignments:T,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:b});let{drawPositions:M,matchUps:C,targetMatchUps:O}=kX({assignments:[D],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:b});if(M&&(C==null?void 0:C.length)===1&&C[0].matchUpType===gi){let k=((O==null?void 0:O[0].sides)??[]).reduce((x,F,$)=>M!=null&&M.includes(F.drawPosition)?$:x,void 0);_L({inContextTargetMatchUp:O[0],teamParticipantId:s,matchUp:C[0],drawPositionSideIndex:k,tournamentRecord:n,drawDefinition:a})}}let R=(g=a.entries)==null?void 0:g.find(M=>M.participantId===s),N=(v=p==null?void 0:p.entries)==null?void 0:v.find(M=>M.participantId===s);return!R&&N&&RL({entryStatus:N.entryStatus,entryStage:b.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:s,event:p}),Lc({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:b,event:p}),{positionAssignments:T,...Q};function A(M){let C=M.bye,O=M.qualifier,k=M.participantId;return{containsBye:C,containsQualifier:O,containsParticipant:k,filled:C||O||k}}}function $Te({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=qt({provisionalPositioning:t,matchUpFilters:u,drawDefinition:n,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:d}=An({matchUps:c}),{initialRoundNumber:p}=Vm({drawPosition:a,matchUps:c}),m=p&&(d==null?void 0:d[p].find(h=>{var f;return(f=h.drawPositions)==null?void 0:f.includes(a)}));if(m){let h=gg({matchUpId:m.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o});if(h.error)return te({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:h})}return{...Q}}function VL(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:_e};let d=Bt({tournamentRecord:n,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:m}=t;m||(m=ln({drawDefinition:a}),Object.assign(t,{matchUpsMap:m})),p||({matchUps:p}=gr({inContext:!0,drawDefinition:a,matchUpsMap:m}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:h}=si({drawDefinition:a,structureId:l}),f=h==null?void 0:h.find(b=>b.drawPosition===s);if(f!=null&&f.participantId){let b=f.participantId,S=ml({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:u});return S.success?I({appliedPolicies:d,removedParticipantId:b}):te({result:S,stack:c})}let g=Mw({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:m,event:u});if(g.error)return te({result:g,stack:c});let v=g.participantId,y=ml({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:u});if(!y.success)return te({result:y,stack:c});return I({appliedPolicies:d,removedParticipantId:v});function I({appliedPolicies:b,removedParticipantId:S}){let{structure:w}=rt({drawDefinition:a,structureId:l});uL({drawPositions:[s],structure:w});let U={[e]:o,name:r,drawPosition:s,structureId:l};return VP({appliedPolicies:b,drawDefinition:a,positionAction:U}),te({context:{removedParticipantId:S},result:{...Q},stack:c})}}function BTe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return VL({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function xX(t){return BTe(t)}function FX({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let o of i.matchUps)e[o.matchUpId]&&(o.roundNumber=e[o.matchUpId],Et({tournamentId:r==null?void 0:r.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:n,matchUp:o}))}function LX(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=We(t,i);if(r.error)return r;let n=rt(t);if(n.error)return n;let a=n.structure;if(!Yn({structure:a}))return te({result:{error:Sp,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=An({matchUps:a==null?void 0:a.matchUps});return s!=null&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Qu}}function _X(t){var e;let i=LX(t,[{targetRoundNumber:!0,roundNumber:!0,[Xn]:MSe}]);if(i.error)return i;let{structure:r,roundMatchUps:n,roundNumbers:a}=i,{targetRoundNumber:o,roundNumber:s}=t;if(!(a!=null&&a.includes(s))||!(a!=null&&a.includes(o)))return te({result:{error:le},info:"roundNumbers must be valid rounds"});let l=o>s,u=l?De(s+1,o+1):De(o,s),c={};return u.forEach(d=>((n==null?void 0:n[d])??[]).forEach(({matchUpId:p})=>{c[p]=d-(l?1:-1)})),(e=n==null?void 0:n[s])==null||e.forEach(({matchUpId:d})=>c[d]=o),FX({params:t,modMap:c,structure:r}),{...Q}}function $X({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){var a;if(!r)return{error:_e};if(!Array.isArray(t))return{error:le};let o="setPositionAssignments";for(let l of t){let{structureId:u,positionAssignments:c}=l;if(!c)continue;let d=rt({drawDefinition:r,structureId:u});if(d.error)return d;let p=d.structure;if(!p)return{error:Ni};let m=(a=si({structure:p}).positionAssignments)==null?void 0:a.map(({drawPosition:v})=>v),h=c==null?void 0:c.map(({drawPosition:v})=>v);if(ji(m,h).length!==(m==null?void 0:m.length))return te({result:{error:le},info:"drawPositions do not match",stack:o});let f=ln({drawDefinition:r}),{matchUps:g}=gr({inContext:!0,drawDefinition:r,matchUpsMap:f});for(let v of c||[]){let{drawPosition:y,participantId:I,bye:b,qualifier:S}=v;if(b){let w=eo({tournamentRecord:i,drawDefinition:r,drawPosition:y,matchUpsMap:f,structureId:u,structure:p,event:n});if(w!=null&&w.error)return w}else if(S)c.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(I){let w=ml({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:r,participantId:I,drawPosition:y,matchUpsMap:f,structureId:u,event:n});if(w!=null&&w.error)return w}}Lc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:p,event:n})}let s=t.map(({structureId:l})=>l);return ui({tournamentId:i==null?void 0:i.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:r,structureIds:s}),{...Q}}function BX(t){let e=LX(t,[{roundNumbers:!0,[Xn]:dn,[Jr]:o=>o.length===2&&o.every(xi)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(o=>n==null?void 0:n.includes(o)))return te({result:{error:le,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((o,s)=>((r==null?void 0:r[o])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-s]})),FX({params:t,modMap:a,structure:i}),{...Q}}function VTe({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return VL({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function VX(t){return VTe(t)}function jX({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return VL({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function GX({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:o}){if(!i)return{error:_e};if(!n)return{error:Xa};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===r);if(e&&!s)return{error:ks};let{structure:l}=rt({drawDefinition:i,structureId:n});if(!l)return{error:Ni};if(!(!t||xi(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>xi(p)&&tt(p)>0)))return{error:le};let{seedAssignments:u}=Io({drawDefinition:i,structure:l}),c=u==null?void 0:u.map(p=>p.seedNumber),d=u==null?void 0:u.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(m=>parseInt(m)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return AJ({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:i,structure:l}),{...Q}}function HX({drawDefinition:t,structureId:e}){if(!t)return{error:_e};let{structure:i}=rt({drawDefinition:t,structureId:e}),r=((t==null?void 0:t.links)||[]).filter(n=>{var a;return((a=n.source)==null?void 0:a.structureId)===e}).map(n=>{var a;return(a=n.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(n=>r.includes(n.structureId)),structure:i}}function rR({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:o}){if(!a)return{error:Ii};let s={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=ss({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:r,stages:n,stage:o});if(l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function jL({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:o}){if(!e)return{error:ve};let s={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=rR({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:u,stage:o});if(c&&l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function $c(t){if(!(t!=null&&t.drawDefinition))return!1;let e=QP(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r==null?void 0:r.filter(({matchUpType:o})=>o===gi),n=n==null?void 0:n.filter(({matchUpType:o})=>o===gi),a=a==null?void 0:a.filter(({matchUpType:o})=>o===gi)),!!(r!=null&&r.length&&!(n!=null&&n.length)&&!(a!=null&&a.length))}function GL(t){var e,i;let{drawDefinition:r,structureId:n}=t;if(!r)return{error:_e};let{playoffStructures:a}=HX({drawDefinition:r,structureId:n});if(!(a!=null&&a.length))return!1;let o=((i=(e=r==null?void 0:r.entries)==null?void 0:e.filter(l=>(l==null?void 0:l.entryStatus)&&hs.includes(l.entryStatus)))==null?void 0:i.length)??0,s=0;return(a||[]).reduce((l,u)=>{var c;return!!((c=si({structure:u}).positionAssignments??[])!=null&&c.filter(d=>(d.participantId&&s++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!a.length)||s===o}function CM({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i!=null&&i[n]){let o=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(s=>{let l=CM({accessors:o,significantCharacters:t,value:s});r.push(...l)});else if(i=i[n],o.length){let s=CM({accessors:o,significantCharacters:t,value:i});r.push(...s)}else a({value:i})}function a({value:o}){if(o&&["string","number"].includes(typeof o)){let s=t?o.slice(0,t):o;r.push(s)}}return r}function jTe({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:Zx};if(!Array.isArray(r))return{error:ew};let n={};return t.forEach(a=>{let o=r.find(l=>l.participantId===a),{values:s}=zX({policyAttributes:e,idCollections:i,participants:r,participant:o});s&&s.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function zX({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:Zx};if(!r)return{error:Sh};let n=[];return t.forEach(a=>{let{directive:o,groupings:s,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");n.push(...CM({significantCharacters:u,value:r,accessors:c}))}else if(o){let c=a==null?void 0:a.includeIds,d=((e==null?void 0:e[o])||[]).filter(p=>!c||c.includes(p));d!=null&&d.length&&i!=null&&i.length&&d.forEach(p=>{var m;let h=i.find(f=>f.participantId===p);if((m=h==null?void 0:h.individualParticipantIds)!=null&&m.includes(r.participantId)){let f=h==null?void 0:h.participantId;n.push(f)}})}else s&&Object.keys(s).forEach(c=>{s[c].includes(r.participantId)&&n.push(c)})}),{values:dt(n)}}function D2({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let o=n[a.participantId],{values:s}=zX({participants:e,policyAttributes:i,idCollections:r,participant:o});return{...a,values:s}})}function WX({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r==null?void 0:r.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,o=t?t[a]||[]:[],s=!!i.some(l=>o.includes(l));return{[n]:{participantGroups:o,includesGroupsToAvoid:s}}}))}function GTe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=WX(t);return i.map(a=>{let o=e.filter(u=>a.includes(u)),s=n(o),l=o.filter(u=>!s.includes(u)).filter(u=>{var c;let d=P2(u);return!((c=r[d])!=null&&c.includesGroupsToAvoid)});return{unassigned:o,unpaired:s,pairedNoConflict:l}});function n(a){return a.filter(s=>!o(s));function o(s){let l=P2(s);return!a.includes(l)}}}function HTe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=WX(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),o=a.length===n.length?a:[],s=n.filter(l=>{var u;return(u=r[l])==null?void 0:u.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:o,pairedNoConflict:s?[]:a,conflictsCount:s}})}function P2(t){return Number(t%2?t+1:t-1)}function zTe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function WTe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let o=r.map(s=>a?HTe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):GTe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:u}}else{let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length);return{unassigned:s,unpaired:l,pairedNoConflict:u}}}function qX({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function qTe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){var a;let o=Object.assign({},...Object.keys(r).map(c=>[c,r[c].filter(d=>e.includes(d))]).filter(c=>c[1].length).map(([c,d])=>({[c]:d}))),s=Object.keys(o).reduce((c,d)=>o[d].length>c?o[d].length:c,0),l=Object.keys(o).filter(c=>o[c].length===s),u=$o(i?l:Object.keys(o));return n=t&&(a=o[n])!=null&&a.length?n:u,{participantId:n&&o[n]?$o(o[n]):$o(e),groupKey:n}}function YTe({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function KTe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:o,groupKey:s}){let l=n.reduce((T,D)=>D.length>T?D.length:T,0)<=2,u=qX({positionAssignments:t,participantIds:e}),c=YTe({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=qTe({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:o,groupKey:s}),m=zTe({participantId:d,allGroups:o}),h=WTe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:m,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:c}),{unassigned:f,unpaired:g,pairedNoConflict:v}=h,y=(v==null?void 0:v.length)&&v[0],I=(g==null?void 0:g.length)&&g[0],b=a&&y?y:I,S=a?I:y,w=(b==null?void 0:b.length)&&b||(S==null?void 0:S.length)&&S,U;if(w!=null&&w.length){let T=va(w);U=va(T)}else{let T=va(f[0]);U=va(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:U}}function h0({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(s=>s.drawPosition),a=kL({drawPositions:n}).uniqueMatchUpGroupings??[],o=Object.assign({},...r.map(s=>({[s.drawPosition]:s})));a.forEach(s=>{Nn(o[s[0]].values||[],o[s[1]].values||[])&&(i.push(s),r.conflict=!0)})}):e.forEach(r=>{var n,a;Nn(((n=r[0])==null?void 0:n.values)||[],((a=r[1])==null?void 0:a.values)||[])&&(i.push(r),r.conflict=!0)}),i}function JTe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.map(a=>{let o=a.map(s=>s.drawPosition);return a.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(u=>!(o!=null&&o.includes(u))).filter(u=>{let c=i.find(f=>f.includes(u)).find(f=>f!==u),d=t.find(f=>f.drawPosition===c),p=h0({isRoundRobin:n,groupedParticipants:[[s,d]]}),m=[t.find(f=>f.drawPosition===u),d],h=h0({isRoundRobin:n,groupedParticipants:[m]});return!p.length&&!h.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function R2(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(I=>I==null?void 0:I.length).filter(Boolean)),p=d>2,m=Me(e,!1,!0).filter(I=>!I.qualifier),h=e.filter(I=>!I.participantId&&(!I.bye||(n==null?void 0:n.includes(I.drawPosition)))).map(I=>I.drawPosition);De(0,r).forEach(()=>{let{newGroupKey:I,selectedParticipantId:b,targetDrawPosition:S}=KTe({...t,candidatePositionAssignments:m,allGroups:l,groupKey:c});c=I,m.forEach(w=>{w.drawPosition===S&&(w.participantId=b)})});let f=D2({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Cr(f,d),v=h0({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let I=JTe({positionedParticipants:f,potentialDrawPositions:h,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(I.length){let b=XTe({candidatePositionAssignments:m,swapOptions:I});b.error&&console.log({result:b}),f=D2({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Cr(f,d),v=h0({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return m.forEach(I=>{if(I.bye&&I.participantId){let b=aM;u.push(b)}if(I.qualifier&&I.participantId){let b=aM;u.push(b)}}),{positionAssignments:m,conflicts:v.length,groupedParticipants:g,errors:u}}function XTe({candidatePositionAssignments:t,swapOptions:e}){let i=va(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=va(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===r),o=t.find(u=>u.drawPosition===n)??{},s={participantId:o==null?void 0:o.participantId,qualifier:o==null?void 0:o.qualifier,bye:o==null?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...Q}}function QTe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){var m;if(!c)return{error:r9};let{candidatesCount:h=1,policyAttributes:f,targetDivisions:g}=c,{roundsToSeparate:v}=c,y="randomUnseededSeparation",{structure:I}=rt({drawDefinition:a,structureId:u}),{matchUps:b}=qt({provisionalPositioning:t,matchUpsMap:l,structure:I,event:p});if(g&&Os(g)&&!v){let _=Awe(g)||0,L=b.reduce((B,V)=>V.roundNumber>B?V.roundNumber:B,0);v=L<_?1:L-_+1}let{positionAssignments:S}=Mr({structure:I}),w=GP({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,U=S==null?void 0:S.filter(_=>!_.participantId),T=S==null?void 0:S.map(_=>_.drawPosition),D=(I==null?void 0:I.structureType)===_n,P=D?{structure:I,matchUps:b,allDrawPositions:T,roundsToSeparate:v}:{matchUps:b,allDrawPositions:T,roundsToSeparate:v},{drawPositionGroups:E,drawPositionChunks:R}=D?ZTe(P):eDe(P),N={groupParticipants:s.filter(_=>_.participantType===Qa).map(_=>_.participantId),teamParticipants:s.filter(_=>_.participantType===Jt).map(_=>_.participantId),pairParticipants:s.filter(_=>_.participantType===gt).map(_=>_.participantId)},A=jTe({targetParticipantIds:e,policyAttributes:f,idCollections:N,participants:s});if(A.error)return te({result:A,stack:y});let M=Object.assign({},...e.map(_=>{let L=Object.keys(A).filter(B=>(A[B]??[]).includes(_));return{[_]:L}})),C=qX({participantIds:e,positionAssignments:S});if(C.length>((U==null?void 0:U.length)||0))return{error:nF};let O,k=C.length,x=De(0,h).map(()=>R2({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:k,pairedPriority:!1,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:R,drawPositionGroups:E,policyAttributes:f,idCollections:N,allGroups:A,drawSize:d}));if(O=x.reduce((_,L)=>!_||(L.conflicts||0)<(_.conflicts||0)?L:_,void 0),!O||O.conflicts){let _=De(0,h).map(()=>R2({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:k,pairedPriority:!0,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:R,drawPositionGroups:E,policyAttributes:f,idCollections:N,allGroups:A,drawSize:d}));O=x.concat(..._).filter(L=>{var B;return!((B=L.errors)!=null&&B.length)}).reduce((L,B)=>!L||(B.conflicts||0)<(L.conflicts||0)?B:L,void 0)}if(!O)return{error:pP};let F=(((m=si({structure:I}))==null?void 0:m.positionAssignments)??[]).filter(_=>_.participantId).map(_=>_.participantId),$=O.positionAssignments.filter(_=>!F.includes(_.participantId));for(let _ of $)if(_.bye){let L=eo({tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,..._});if(L.error)return te({result:L,stack:y})}else if(_.participantId){let L=ml({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,..._});if(L.error)return te({result:L,stack:y,context:{assignment:_}})}return{...Q}}function ZTe(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function eDe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),n=r.flat().sort(ur),a=Math.max(...n),o=t.filter(c=>c>a),s=n.length,l=De(s===2?1:2,s).filter(c=>c===Vx(c)),u=l.slice(0,e||l.length).reverse().map(c=>Cr(n,c));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:r,drawPositionChunks:u}}function tDe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){var m,h;let f="positionUnseededParticipants";c||({structure:c}=rt({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:g}=Mr({structure:c}),{seedAssignments:v}=Io({provisionalPositioning:t,drawDefinition:a,structure:c}),y=v==null?void 0:v.map(E=>E.participantId).filter(Boolean),{stage:I,stageSequence:b}=c,S=I===Je?(h=(m=It({element:c,name:Ul}))==null?void 0:m.extension)==null?void 0:h.value:void 0,w=Nh({provisionalPositioning:t,drawDefinition:a,stageSequence:b,entryStatuses:Ap,structureId:u,roundTarget:S,stage:I}),U=w.filter(E=>!(y!=null&&y.includes(E.participantId))).map(E=>E.participantId),T=g==null?void 0:g.filter(E=>!E.participantId&&!E.bye&&!E.qualifier).map(E=>E.drawPosition);if(!r&&U.length>((T==null?void 0:T.length)||0))return te({result:{error:nF},context:{unseededParticipantsCount:U.length,unfilledDrawPositionsCount:T==null?void 0:T.length},stack:f});let{appliedPolicies:D}=Bt({tournamentRecord:n,drawDefinition:a,event:p}),P=D==null?void 0:D[cy];if(c.stage===Bi){let E=w.reduce((R,N)=>(R[N.groupingValue]||(R[N.groupingValue]=[]),R[N.groupingValue].push(N.participantId),R),{});Object.keys(E).length&&(P||(P={policyName:"Playoff Avoidance"}),P.policyAttributes||(P.policyAttributes=[]),P.policyAttributes.push({groupings:E}))}return P&&s?QTe({provisionalPositioning:t,unseededParticipantIds:U,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:P,drawSize:d,entries:w}):iDe({provisionalPositioning:t,unseededParticipantIds:U,inContextDrawMatchUps:e,unfilledDrawPositions:T,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function iDe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?Tn(r):r.reverse();for(let m of e){let h=p.pop();if(!n||h){let f=ml({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:m,drawPosition:h,matchUpsMap:l,structureId:u,event:d});if(f!=null&&f.error&&console.log("!!!!!",{result:f}),f==null?void 0:f.error)return te({result:f,stack:"randomUnseededDistribution"})}}return{...Q}}function rDe(t){let e=t.structure??rt(t).structure,i="positionQualifiers",r=[];if(e.stage===an)return te({result:{error:Dp},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:o}=nDe(t);for(let s of Object.keys(n)){let l=a==null?void 0:a.filter(u=>o[s].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(n[s]>(l||0))return te({result:{error:U9},context:{unfilledDrawPositions:l},stack:i});De(0,n[s]).forEach(()=>{let u=va(l);r.push(u),a==null||a.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...Q,qualifierDrawPositions:r}}function nDe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=rt({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=Mr({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:o,roundQualifiersCounts:s}=Dv({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(s?Object.keys(s):[]).map(f=>tt(f)),{matchUps:u}=qt({structure:e}),{roundProfile:c}=An({matchUps:u}),d=Object.assign({},...l.filter(f=>c==null?void 0:c[f]).map(f=>{var g,v;return{[f]:((v=(g=c==null?void 0:c[f])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=r==null?void 0:r.filter(f=>f.qualifier).map(f=>f.drawPosition),m=o-((p==null?void 0:p.length)??0),h=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(f=>{let g=r==null?void 0:r.filter(v=>{var y,I;return v.qualifier&&((I=(y=d[f])==null?void 0:y.drawPositions)==null?void 0:I.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[f]:((s==null?void 0:s[f])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:m,placedQualifiersCount:h,roundQualifiersCounts:s,positionAssignments:r,roundDrawPositions:d,qualifiersCount:o}}function E2({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:m}){let h=[],f=[],g=0;if(p||({structure:p}=rt({drawDefinition:a,structureId:c})),c||(c=p==null?void 0:p.structureId),r||(r=Bt({drawDefinition:a}).appliedPolicies),!n){let v=p&&Vh({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:o,structure:p});v!=null&&v.error&&f.push(v.error),n=v==null?void 0:v.validSeedBlocks}return u=u??(n==null?void 0:n.length)??0,De(0,u).forEach(()=>{if(g<(u||0)){let v=aDe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:c,matchUpsMap:d,event:m});v!=null&&v.success&&(g++,h.push(...v.seedPositions??[])),v.error&&f.push({seedPositionError:v.error})}}),f.length?{error:f}:{...Q,seedPositions:h}}function aDe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=MX({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:s,event:u}),{appliedPolicies:p}=Bt({drawDefinition:r}),{avoidance:m}=p??{};m&&o&&(c==null?void 0:c.length)>2;let h=[];for(let f of c){let g=d.pop();if(!g)return{error:uv};h.push(g);let v=ml({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:f,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:s,event:u});if(!v.success)return v}return{...Q,seedPositions:h}}function oDe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=Mr({structure:i}),{seedAssignments:n}=Io({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(o=>o.participantId).map(o=>({[o.participantId]:o})));return r==null?void 0:r.map(o=>a[o.participantId]?{...o,seedNumber:a[o.participantId].seedNumber,seedValue:a[o.participantId].seedValue}:"").filter(Boolean)}function sDe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>{if(i-r.length>a.drawPositions.length)r.push(...a.drawPositions);else{let o=MM(Cr(a.drawPositions,2)),s,l=t[r.length];for(;s=aS(o,l);)r.push(s),l=t[r.length]}});let n=r.map(a=>Array.isArray(a)?Tn(a):a).flat(1/0);return DK(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function aS(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return aS(e?n:t[Math.round(Math.random())],e)}return i<r?aS(t[1],e):aS(t[0],e)}function MM(t){let e=Math.floor(t.length/2);return t.length>2?[MM(t.slice(0,e)),MM(t.slice(e))]:t}function lDe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:o,structure:s}){var l;a||(a=Vh({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:s}));let{isFeedIn:u,isLuckyStructure:c,isContainer:d}=a,{validSeedBlocks:p}=a;(l=i==null?void 0:i.seeding)!=null&&l.containerByesIgnoreSeeding&&(p=[]);let m=oDe({provisionalPositioning:t,drawDefinition:r,structure:s})??[],h=dt([].concat(...e.map(S=>S.drawPositions))),f=m.filter(S=>h.includes(S.drawPosition)),g=(S,w)=>fg(S.seedValue)-fg(w.seedValue),v=p.reduce((S,w)=>{let U=f.filter(T=>{var D;return(D=w.drawPositions)==null?void 0:D.includes(T.drawPosition)}).sort(g);return S.concat(...U)},[]).map(S=>S.drawPosition),y=sDe({orderedSortedFirstRoundSeededDrawPositions:v,validSeedBlocks:p,byesToPlace:o}),I=C2({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,o),b=C2({orderedSeedDrawPositions:y,relevantMatchUps:e}).slice(0,o);return{strictSeedOrderByePositions:I,blockSeedOrderByePositions:b,isLuckyStructure:c,positionedSeeds:m,isContainer:d,isFeedIn:u}}function C2({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r==null?void 0:r.sort((n,a)=>n-a)).filter(r=>(r==null?void 0:r[0])+1===(r==null?void 0:r[1]));return t.map(r=>i.find(n=>n==null?void 0:n.includes(r))).filter(Boolean).map(r=>r==null?void 0:r.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function uDe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:o,isFeedIn:s}){var l,u;let c=(l=r==null?void 0:r.seeding)==null?void 0:l.seedingProfile,d=o.stage===Je,{positionAssignments:p}=Mr({structure:o}),m=p==null?void 0:p.filter(O=>O.participantId).map(O=>O.drawPosition),h={isCollectionMatchUp:!1},{matchUps:f,roundMatchUps:g}=qt({provisionalPositioning:t,matchUpFilters:h,structure:o}),v=(g==null?void 0:g[1])||[],y=o.structureType===_n?f:v,I=dt([].concat(...y.map(O=>O.drawPositions))),b=Math.min(...I)-1,S=m==null?void 0:m.filter(O=>I.includes(O)),w=O=>{let k=Math.ceil(O.length/2),x=[O.slice(0,k),O.slice(k)],F=x.map(z=>[].concat(...z.flat(1/0)).length),$=Math.min(...F.flat(1/0)),_=Math.max(...F.flat(1/0)),L=F.indexOf(_),B=$!==_,V=Tn(x),[G,j]=!$||B?[x[L],x[1-L]]:[V[0],V[1]];return{greaterHalf:G,lesserHalf:j}},U=O=>{let{greaterHalf:k,lesserHalf:x}=w(O),{greaterHalf:F,lesserHalf:$}=w(k),_=Tn(F.flat(1/0)).pop(),L=F.flat().filter(B=>B!==_);return{newlyFilteredChunks:[...x,...$,L],drawPosition:_}},T=O=>!e.includes(O),D=O=>!(S!=null&&S.includes(O)),P=O=>{let k=Cr(O.sort(ur),Math.ceil(O.length/4)).map($=>$.filter(D)),x=[].concat(...k.flat(1/0)).length,F=[];for(let $=0;$<x;$++){let{newlyFilteredChunks:_,drawPosition:L}=U(k);F.push(L),k=_}return F},{validSeedBlocks:E}=Vh({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:o}),R=E==null?void 0:E.map(O=>{var k;return(k=O.drawPositions)==null?void 0:k.map(x=>x+b)}),N;if(s){let O=I.length,{seedBlocks:k}=xL({cluster:Fw(c)===SP,participantsCount:O});N=k.map(x=>x.map(F=>F+b)).map(P).filter(x=>x.length)}else d?N=R==null?void 0:R.map(O=>O.filter(D)):N=R==null?void 0:R.map(P).filter(O=>O.length);let A=y.map(O=>O.drawPositions).map(O=>O==null?void 0:O.sort((k,x)=>k-x)).filter(O=>(O==null?void 0:O[0])+1===(O==null?void 0:O[1])),M=O=>A.reduce((k,x)=>x.includes(O)?x.reduce((F,$)=>$!==O?$:F,void 0):k,void 0),C=N.map(O=>O.map(M)).flat(1/0).filter(D).filter(T).filter(Boolean);if(d&&!o.structures){let O=a%4,k=C.slice(0,O),x=(u=g[o.roundLimit])==null?void 0:u.length,F=Cr(C.slice(O),x).map(Tn).flat();C=k.concat(F)}return{unseededByePositions:C}}function cDe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){var a;let o={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:l}=qt({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:o,matchUpsMap:i,structure:r,event:n}),u=(l==null?void 0:l[1])||[],c=(r==null?void 0:r.structureType)===_n,d=c?s:u,p=c?((a=r==null?void 0:r.structures)==null?void 0:a.length)||0:s.length,{structureId:m,stage:h,stageSequence:f}=r,g=Nh({entryStatuses:hs,provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:m,stage:h}),{qualifiersCount:v}=Dv({provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:m,stage:h}),y=g.length+v,{positionAssignments:I,unassignedPositions:b}=Mr({structure:r}),S=b==null?void 0:b.map(E=>E.drawPosition),w=I==null?void 0:I.filter(E=>E.bye).length,U=I==null?void 0:I.filter(E=>E.bye).map(E=>E.drawPosition),T=d.map(E=>E.drawPositions).filter(E=>E==null?void 0:E.reduce((R,N)=>!(U!=null&&U.includes(N))&&R,!0)).flat(1/0).filter(E=>S==null?void 0:S.includes(E)),D=I==null?void 0:I.length,P=D?D-y:0;return P>p&&r.stageSequence===1&&r.stage!==an&&(P=p),{placedByes:w,byesCount:P,relevantMatchUps:d,placedByePositions:U,roundMatchUps:l,positionsToAvoidDoubleBye:T}}function M2({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:u,seedsOnly:c,event:d}){var p;l||({structure:l}=rt({drawDefinition:r,structureId:s})),s||(s=l==null?void 0:l.structureId);let m=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===Je),{byesCount:h,placedByes:f,relevantMatchUps:g}=cDe({provisionalPositioning:t,drawDefinition:r,matchUpsMap:o,structure:l,event:d}),v=h-(f||0);if(v<=0)return{...Q};let{strictSeedOrderByePositions:y,blockSeedOrderByePositions:I,isLuckyStructure:b,isFeedIn:S}=lDe({provisionalPositioning:t,relevantMatchUps:g,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:v,structure:l}),w=(l==null?void 0:l.structureType)&&[_n,TP].includes(l.structureType)&&((p=i==null?void 0:i.seeding)==null?void 0:p.containerByesIgnoreSeeding),U=m&&I!=null&&I.length?I:y,{unseededByePositions:T}=uDe({provisionalPositioning:t,seedOrderByePositions:U,isLuckyStructure:b,appliedPolicies:i,drawDefinition:r,seedLimit:u,structure:l,isFeedIn:S}),D=N=>N%2,P=(N,A)=>(N||[]).every(M=>D(M)?A!==M+1:A!==M-1),E=[].concat(...U);if(!c)for(;T.length;){let N=T.find(A=>P(E,A));N?(E.push(N),T=T.filter(A=>A!==N)):(E.push(...T),T=[])}w&&(E=Tn(E),Ga({ignoreSeededByes:w})&&console.log({byePositions:E}));let R=E.slice(0,v);for(let N of R){let A=eo({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:d});if(A!=null&&A.error)return A}return{...Q,unseededByePositions:T,byeDrawPositions:R}}function Lw(t){var e,i,r,n;let{drawDefinition:a}=t,{applyPositioning:o=!0,provisionalPositioning:s,multipleStructures:l,placeByes:u=!0,tournamentRecord:c,placementGroup:d,seedingProfile:p,structureId:m,seedLimit:h,seedsOnly:f,drawType:g,drawSize:v,event:y}=t,I=[];o||(z9(),a=Me(a,!1,!0));let b=x=>(o||XU(),te({result:x,stack:"automatedPositioning"})),S=x=>(o||XU(),x),w=rt({drawDefinition:a,structureId:m});if(w.error)return b(w);let U=w.structure;if(!U)return{error:Ni};let T=t.appliedPolicies||((e=Bt({drawDefinition:a,structure:U,event:y}))==null?void 0:e.appliedPolicies),{qualifiersCount:D}=Dv({stageSequence:U.stageSequence,provisionalPositioning:s,stage:U.stage,drawDefinition:a,structureId:m}),P=Ap;if(!((i=Nh({stageSequence:U.stageSequence,provisionalPositioning:s,stage:U.stage,placementGroup:d,drawDefinition:a,entryStatuses:P,structureId:m}))!=null&&i.length)&&!D)return S({...Q});let E=t.matchUpsMap??ln({drawDefinition:a}),R=t.inContextDrawMatchUps??((r=gr({inContext:!0,drawDefinition:a,matchUpsMap:E}))==null?void 0:r.matchUps),N=[],A=Vh({provisionalPositioning:s,appliedPolicies:T,drawDefinition:a,seedingProfile:p,structure:U});if(A.error)return A;let{validSeedBlocks:M}=A;I.push({validSeedBlocks:M});let C=t.participants||(c?(n=Ai({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:c}))==null?void 0:n.participants:[]);if(Fw(U.seedingProfile||p)===Yd){let x=u?M2({provisionalPositioning:s,tournamentRecord:c,appliedPolicies:T,drawDefinition:a,seedBlockInfo:A,matchUpsMap:E,structure:U,seedLimit:h,seedsOnly:f,event:y}):void 0;if(x!=null&&x.error)return b(x);N=x.unseededByePositions,I.push({action:"positionByes",unseededByePositions:N});let F=U.seedingProfile?{positioning:U.seedingProfile}:p;if(x=E2({seedingProfile:F,provisionalPositioning:s,inContextDrawMatchUps:R,tournamentRecord:c,appliedPolicies:T,validSeedBlocks:M,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:E,structure:U,event:y}),x.error)return b(x);I.push({seedPositions:x.seedPositions,action:"positionSeedBlocks"})}else{if(g!==Pp){let F=U.seedingProfile?{positioning:U.seedingProfile}:p,$=E2({seedingProfile:F,provisionalPositioning:s,inContextDrawMatchUps:R,tournamentRecord:c,appliedPolicies:T,validSeedBlocks:M,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:E,structure:U,event:y});if($.error)return b($);I.push({action:"positionSeedBlocks",seedPositions:$.seedPositions})}let x=u?M2({provisionalPositioning:s,tournamentRecord:c,appliedPolicies:T,drawDefinition:a,seedBlockInfo:A,matchUpsMap:E,structure:U,seedLimit:h,seedsOnly:f,event:y}):void 0;if(x!=null&&x.error)return b(x);N=x==null?void 0:x.unseededByePositions,I.push({action:"positionByes",byeDrawPositions:x==null?void 0:x.byeDrawPositions,unseededByePositions:N})}let O={};if(!f){let x=rDe({inContextDrawMatchUps:R,tournamentRecord:c,appliedPolicies:T,validSeedBlocks:M,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:E,structure:U});if(x.error||(x.conflicts&&(O.qualifierConflicts=x.conflicts),I.push({action:"positionQualifiers",qualifierDrawPositions:x.qualifierDrawPositions}),x=tDe({provisionalPositioning:s,inContextDrawMatchUps:R,unseededByePositions:N,multipleStructures:l,tournamentRecord:c,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:E,structureId:m,structure:U,drawSize:v,event:y}),x.error))return b(x);x.conflicts&&(O.unseededConflicts=x.conflicts),I.push({action:"positionUnseededParticipants"})}let{positionAssignments:k}=si({drawDefinition:a,structure:U});return ui({drawDefinition:a,structureIds:[m]}),o||XU(),{positionAssignments:k,conflicts:O,...Q,positioningReport:I}}function Ev(t){var e;let{applyPositioning:i=!0,provisionalPositioning:r,tournamentRecord:n,drawDefinition:a,seedingProfile:o,structureId:s,placeByes:l,seedsOnly:u}=t;if(!a)return{error:ja};if(!$c({drawDefinition:a,structureId:s})&&!r)return{error:jx};let c=(e=HX({drawDefinition:a,structureId:s}).playoffStructures)==null?void 0:e.sort((m,h)=>s0(m)-s0(h)),d=[],p=[];if(c)for(let m of c){let{structureId:h}=m,f=Lw({structureId:h,provisionalPositioning:r,applyPositioning:i,tournamentRecord:n,drawDefinition:a,seedingProfile:o,placeByes:l,seedsOnly:u});if(f.error)return f;f.positionAssignments&&d.push({positionAssignments:f.positionAssignments,structureId:h}),f.positioningReport&&p.push(f.positioningReport)}return{...Q,structurePositionAssignments:d,positioningReports:p}}function YX({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>st(i)))&&te({result:{error:le},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>Xf(i.structureOrder)-Xf(r.structureOrder)),{...Q}):{error:_e}}function nR({drawDefinition:t}){var e,i,r,n,a,o,s;let l=t.structures??[],u=t.links??[],c=new Map,d=U=>{let T=c.get(U)||c.set(U,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&c.get(U);if(T&&!(T!=null&&T.stage)){let D=l.find(P=>P.structureId===U);T.stage=D==null?void 0:D.stage}return T},p={},m={},h=u.map(U=>{let T=U.source.structureId,D=U.target.structureId,P=d(T),E=d(D);return[Kd,Bo,DP,Yd].includes(U.target.feedProfile)?(P==null||P.targets.push(D),E==null||E.sources.push(T)):U.target.feedProfile===ys&&(E==null||E.drawSources.push(T),P==null||P.drawTargets.push(D)),m[D]=m[D]||U.target.feedProfile===ys,p[D]=dt([...p[D]||[],T]).filter(Boolean),[U.source.structureId,U.target.structureId]});for(let U of c.keys()){let T=c.get(U);if(T){let D=T.targets??[];for(;D.length;){let P=D.pop(),E=P&&c[P];(e=E==null?void 0:E.targets)!=null&&e.length?D.push(...E.targets):E&&(T.rootStage=E.stage)}if(T.rootStage||(T.rootStage=T.stage),!((i=T.targets)!=null&&i.length)){let P=T.sources??[];for(;P.length;){let E=P.pop(),R=E&&c[E];if((r=R==null?void 0:R.sources)!=null&&r.length){for(let N of R.sources)(n=T.progeny)!=null&&n.includes(N)||(a=T.progeny)==null||a.push(N);P.push(...R.sources)}}}}}let f=0;for(let U of c.keys()){let T=c.get(U);if(T&&T.rootStage===Je){let D=[(o=T.drawTargets)==null?void 0:o[0]],P=0;for(;D.length;){P+=1;let E=D.pop(),R=E?c.get(E):void 0;(s=R==null?void 0:R.drawTargets)!=null&&s.length&&D.push(R.drawTargets[0])}T.distanceFromMain=P,P>f&&(f=P)}}let g=h.length;De(0,Math.ceil(g/2)).forEach(()=>{h=De(0,g).map(U=>{let T=h[U],D=h.reduce((P,E)=>Nn(T,E)?P.concat(...E):P,[])||[];return dt(T.concat(...D))})});let v=h[0],y=(U,T)=>ji(U,T).length===U.length,I=h.slice(1).reduce((U,T)=>U&&y(T,v),!0),b=[v].filter(Boolean),S=[v].filter(Boolean);l.forEach(U=>{let{structureId:T,stage:D}=U;b.find(P=>P.includes(T))||(b.push([T]),D!==Lr&&S.push([T]))});let w=I&&S.length===1;return!(u!=null&&u.length)&&l.length===1&&d(l[0].structureId),{structureProfiles:Object.fromEntries(c),allStructuresLinked:w,maxQualifyingDepth:f,sourceStructureIds:p,hasDrawFeedProfile:m,structureGroups:b}}function KX({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=nR({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...Q}}function HL(t){let e=We(t,[{[Ur]:!0,[$n]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return dDe({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function dDe(t){var e;let i=We(t,[{[$n]:!0,[MP]:!0},{link:!0,[Xn]:ia,[OK]:qx}]);if(i.error)return i;let{drawDefinition:r,tournamentId:n,structure:a,eventId:o,link:s}=t,l=s.target.structureId,u=rt({drawDefinition:r,structureId:l});if(u.error)return te({stack:"attachQualifyingStructure",context:{targetStructureId:l},result:u});r.structures||(r.structures=[]),r.links||(r.links=[]),r.structures.push(a),r.links.push(s),KX({drawDefinition:r});let c=((e=qt({structure:a}))==null?void 0:e.matchUps)||[];return Fc({drawDefinition:r,tournamentId:n,matchUps:c,eventId:o}),ui({drawDefinition:r,structureIds:[a.structureId]}),{...Q}}function JX({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:le};if(!t)return{error:_e};let i=Object.assign({},...e.map(r=>{if(!At(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Qe};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let o=i[a.structureId];o&&(a.structureName=o)}}return{...Q}}function zL({drawDefinition:t,timeItem:e}){if(!t)return{error:ja};if(!e)return{error:lF};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:sF};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),mw({drawDefinition:t}),{...Q}}function XX(t){var e;let{tournamentRecord:i,drawDefinition:r,structureId:n,event:a}=t,o=We(t,[{drawDefinition:!0,structureId:!0}]);if(o.error)return o;let s=r.structures??[],l=s.find(y=>y.structureId===n);if(!l)return{error:Ni};let u=s.find(({stage:y,stageSequence:I})=>y===Ne&&I===1),c=n===(u==null?void 0:u.structureId),d=s.filter(({stage:y})=>y===Je).map(Na("structureId"));if(c&&!d.length)return{error:xK};let p=d.includes(n),m=pDe({isQualifyingStructure:p,structure:l,...t});if(m!=null&&m.error)return m;let{structureIdsToRemove:h,relatedStructureIdsMap:f}=hDe({qualifyingStructureIds:d,isQualifyingStructure:p,isMainStageSequence1:c,mainStageSequence1:u,drawDefinition:r,structureId:n}),{removedMatchUpIds:g,removedStructureIds:v}=fDe({relatedStructureIdsMap:f,qualifyingStructureIds:d,isMainStageSequence1:c,mainStageSequence1:u,drawDefinition:r,structureIdsToRemove:h,structureId:n});if(mDe({removedMatchUpIds:g,drawDefinition:r}),c){let y=(e=u.matchUps??[])==null?void 0:e.map(Na("matchUpId"));g.push(...y),u.positionAssignments=[],u.seedAssignments=[],u.matchUps=[],u.extensions&&(u.extensions=[])}return p&&KX({drawDefinition:r}),ec({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:g,action:"removeStructure",eventId:a==null?void 0:a.eventId,drawDefinition:r}),ui({drawDefinition:r,eventId:a==null?void 0:a.eventId}),{...Q,removedMatchUpIds:g,removedStructureIds:v}}function pDe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:o}){var s,l,u,c,d,p;let m=[r];if(t){let h=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},f=(s=h(r))==null?void 0:s.source.structureId;for(;f;)m.push(f),f=(l=h(f))==null?void 0:l.source.structureId}if((u=gr({matchUpFilters:{structureIds:m},drawDefinition:i}).matchUps)!=null&&u.some(({score:h})=>br({score:h}))){let h=(c=Bt({tournamentRecord:e,drawDefinition:i,structure:n,event:a}))==null?void 0:c.appliedPolicies;if(!(o??((p=(d=h==null?void 0:h[vo])==null?void 0:d.allowDeletionWithScoresPresent)==null?void 0:p.structures)))return{error:gP}}return{...Q}}function mDe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=gr({drawDefinition:e});i==null||i.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function hDe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let o=(n.structures??[]).map(Na("structureId")),s=c=>{var d;return((d=n.links)==null?void 0:d.map(p=>p.source.structureId===c&&p.target.structureId!==(r==null?void 0:r.structureId)&&p.target.structureId).filter(Boolean))??[]},l=c=>{var d;return((d=n.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===c&&p.source.structureId).filter(Boolean))??[]},u=new Map;return o.forEach(c=>u.set(c,e?l(c):s(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function fDe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;a!=null&&a.length;){let u=a.pop();l.push(...IDe({idBeingRemoved:u,drawDefinition:n}));let c=vDe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:n,structureId:o});s.push(...c.removedStructureIds);let d=gDe({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:u,structureId:o});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function gDe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){var n;return t&&((n=e.get(t))==null?void 0:n.filter(a=>a!==(i==null?void 0:i.structureId)||r===i.structureId))}function vDe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){var a;let o=[];return r.links=((a=r.links)==null?void 0:a.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&o.push(i),s.structureId!==i))),{removedStructureIds:o}}function IDe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=rt({structureId:t,drawDefinition:e}),r=qt({structure:i}).matchUps;return zF(r)}function f0({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:_e};if(!fL({drawDefinition:e,stage:r}))return{error:Dp};let n=y0e({drawDefinition:e,stage:r}),{qualifiersCount:a}=Dv({drawDefinition:e,stageSequence:t,stage:r}),o=n+a;if(i<o)return{error:Wx};let{entryProfile:s}=hL({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return ui({drawDefinition:e}),{...Q,entryProfile:s}}function QX({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?fL({drawDefinition:e,stage:i})?i!==Ne?{error:Wx,info:"qualifiersCount can only be set for main stage"}:(hL({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),ui({drawDefinition:e}),{...Q}):{error:Dp}:{error:_e}}function yDe({drawDefinition:t,drawSize:e}){if(!t)return{error:_e};let i=f0({stage:Lr,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(ui({drawDefinition:t}),{...Q})}function ZX(t){return yDe(t)}var bDe="qualifierDrawPositionAssignment",wDe="withdrawParticipantAtDrawPosition",UDe="alternateDrawPositionAssignment",SDe="luckyLoserDrawPositionAssignment",N2="removeDrawPositionAssignment",eQ="swapDrawPositionAssignments",TDe="modifyPairAssignment",DDe="adHocPositionSwap",PDe="modifyParticipantOtherName",A2="assignDrawPosition",RDe="removeSeededParticipant",EDe="assignDrawPositionBye",CDe="modifySeedAssignment",tQ="addPenalty",WL="MODIFY_PAIR",aR="QUALIFIER",qL="ALTERNATE",YL="WITHDRAW",jm="ASSIGN",NM="REMOVE",KL="LUCKY",cI="REMOVE_SEED",oR="SWAP",vy="NICKNAME",hm="SEED_VALUE",Gm="PENALTY",g0="BYE",MDe={MODIFY_PAIR_ASSIGNMENT:WL,QUALIFYING_PARTICIPANT:aR,ALTERNATE_PARTICIPANT:qL,WITHDRAW_PARTICIPANT:YL,ASSIGN_PARTICIPANT:jm,LUCKY_PARTICIPANT:KL,REMOVE_ASSIGNMENT:NM,SWAP_PARTICIPANTS:oR,ADD_NICKNAME:vy,REMOVE_SEED:cI,ADD_PENALTY:Gm,ASSIGN_BYE:g0,SEED_VALUE:hm};function iQ({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:_e};if(!r)return{error:Xa};if((i==null?void 0:i.length)!==2)return{error:le,drawPositions:i};let a=ln({drawDefinition:e}),{matchUps:o}=gr({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:s}=rt({drawDefinition:e,structureId:r});if(!s)return{error:Ni};let l=Bt({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},u;if(s.structureType===_n?u=ODe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}):u=NDe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}),u.error)return u;if(uL({structure:s,drawPositions:i}),VP({appliedPolicies:l,drawDefinition:e,positionAction:{name:eQ,drawPositions:i,structureId:r}}),Lc({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:n}),n.eventType===Ca){let c=qt({matchUpFilters:{matchUpTypes:[Va]},inContext:!0,structure:s}).matchUps.filter(p=>{var m;return(m=p.drawPositions)==null?void 0:m.some(h=>i.includes(h))}),d=qt({matchUpFilters:{matchUpTypes:[Va]},structure:s}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(m=>{var h;let f=m==null?void 0:m.drawPosition;if(i.includes(f)){let g=m.participantId,v=d.find(({matchUpId:I})=>I===p.matchUpId),y=(h=p==null?void 0:p.sides)==null?void 0:h.reduce((I,b,S)=>b.drawPosition===f?S:I,void 0);_L({inContextTargetMatchUp:p,drawPositionSideIndex:y,teamParticipantId:g,tournamentRecord:t,drawDefinition:e,matchUp:v,event:n})}})})}return ui({drawDefinition:e,structureIds:[r]}),{...Q}}function NDe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){let s=a==null?void 0:a.positionAssignments.filter(u=>r==null?void 0:r.includes(u.drawPosition));if(!s)return{error:le,structure:a,info:"Missing positionAssignments"};if(s.filter(({bye:u})=>u).length===2)return{...Q};if(s.filter(({qualifier:u})=>u).length===2)return{...Q};let l=s.some(({qualifier:u})=>u);return s.some(({bye:u})=>u)&&!l?rQ({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o}):ADe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o})}function rQ({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=r.find(({bye:h})=>h),l=r.find(({participantId:h})=>h),u=s.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,m=gy({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return m.error||(m=gy({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),m.error)||(eo({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:o}),m=ml({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:n,event:o}),m.error)?m:{...Q}}function ADe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=Object.assign({},...r.map((l,u)=>{let{drawPosition:c}=l,d={...r[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>s[l.drawPosition]||l),BL({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:o}),{...Q}}function ODe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){var s;let l=(s=a.structures)==null?void 0:s.reduce((c,d)=>{let p=d==null?void 0:d.positionAssignments.filter(m=>r==null?void 0:r.includes(m.drawPosition));return p&&c.push(...p),c},[]);if(l.filter(({bye:c})=>c).length===2)return{...Q};if(l.filter(({qualifier:c})=>c).length===2)return{...Q};BL({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:l,structure:a,event:o});let u=l.some(({qualifier:c})=>c);if(l.some(({bye:c})=>c)&&!u)rQ({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:l,matchUpsMap:n,structure:a,event:o});else{let c=Me(l,!1,!0);l.forEach((d,p)=>{let m=c[1-p].participantId;d.qualifier=c[1-p].qualifier,d.participantId=m})}return{...Q}}function nQ({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){var n;let a="removeSeededParticipant";if(!t)return{error:ve};if(!e)return{error:_e};let o=(e.structures??[]).find(s=>s.structureId===r);return o?!o.stage||![Ne,Je].includes(o.stage)||o.stage===Ne&&o.stageSequence!==1?te({result:{error:Sp},stack:a}):(n=o.seedAssignments)!=null&&n.find(s=>s.participantId===i)?{...Q}:te({info:"participant not seeded",result:{error:jr},context:{participantId:i}}):te({result:{error:Ni},stack:a})}function _w({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=xu}){return!r||!n?{error:Xa}:{link:Ge({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:ys,roundNumber:t,structureId:n}})}}function JL({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:(r==null?void 0:r.pop())||Ht()}function v0({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:o,nodes:s}){let l=0,u=[],c=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let m=s==null?void 0:s[l],h=s==null?void 0:s[l+1];d&&(m.roundNumber=d),h&&d&&(h.roundNumber=d);let f=JL({roundPosition:c,roundNumber:i,idPrefix:n,uuids:o}),g={roundPosition:c,children:[m,h],matchUpId:f};u.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:Qi,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),r.push(v),c++,l+=2}return{roundNodes:u,matchUps:r}}function hl({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:u}){if(isNaN(s)||s<2||r&&s<=r)return{matchUps:[],roundsCount:0};if(r&&(!Os(s)||s%r)){let g=r;for(;g<s;)g=2*g;s=g}let c=r&&!(s%2)&&(!isNaN(r)||i&&!isNaN(i))&&(s/r===Math.round(s/r)||i&&s/i===Math.round(s/i));if(!Os(s)&&!c)return{matchUps:[],roundsCount:0};let d=De(1,s+1).map(g=>({drawPosition:g})),p,m=[],h=1;for({roundNodes:p,matchUps:m}=v0({matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,nodes:d,uuids:u}),h++,a=a??i;p.length>1;)r&&p.length===r&&(a=h-1),{roundNodes:p,matchUps:m}=v0({nodes:p,matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,uuids:u}),h++;let f=h-1;return m=Rw({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:f,roundLimit:a,matchUps:m}),a?m=m.filter(g=>a&&(g.roundNumber??0)<=a):a=h-1,{drawSize:s,matchUps:m,roundsCount:f,roundLimit:a}}function XL(t){var e,i,r,n,a,o;let s="generateQualifyingStructure";if(!t.drawDefinition)return te({result:{error:_e},stack:s});if(t.drawSize&&!st(t.drawSize)||t.participantsCount&&!st(t.participantsCount)||t.qualifyingPositions&&!st(t.qualifyingPositions))return te({result:{error:le},stack:s});let l=t.drawSize??Bx(t.participantsCount),{qualifyingRoundNumber:u,qualifyingPositions:c,targetStructureId:d,structureOptions:p,appliedPolicies:m,drawDefinition:h,matchUpFormat:f,structureName:g,structureId:v,roundTarget:y,drawType:I,idPrefix:b,isMock:S,uuids:w}=t;if(!t.drawSize)return te({result:{error:Qb},context:{drawSize:l},stack:s});if(c&&c>=t.drawSize)return te({result:{error:le},context:{drawSize:l,qualifyingPositions:c},stack:s});let U,T,D,P,E=0,R,N=1,{structureProfiles:A}=nR({drawDefinition:h}),M=A[d];if(!M)return te({result:{error:Ni},context:{targetStructureId:d},stack:s});let C=h.matchUpType,O=y?`${y}-`:"",k=M.stage===Je,x=((i=(e=m==null?void 0:m[cg])==null?void 0:e.namingConventions)==null?void 0:i.pre)??((n=(r=S0e[cg])==null?void 0:r.namingConventions)==null?void 0:n.pre),F=k&&x?`${x}-`:"",$=g??(O?`${F}${tn(Je)} ${O}`:`${F}${tn(Je)}`);if(I===as){let{maxRoundNumber:B,structures:V,groupCount:G}=kw({structureName:g??$,structureId:v??(w==null?void 0:w.pop()),stage:Je,structureOptions:p,appliedPolicies:m,stageSequence:N,matchUpType:C,roundTarget:y,idPrefix:b,drawSize:l,isMock:S,uuids:w});E=G,U=B,D=V[0],R=[1]}else({drawSize:l,matchUps:P,roundLimit:U,roundsCount:T}=hl({qualifyingRoundNumber:u,qualifyingPositions:c,matchUpType:C,idPrefix:b,drawSize:l,isMock:S,uuids:w})),U||(U=T),D=uo({structureName:g??$,structureId:v??(w==null?void 0:w.pop()),qualifyingRoundNumber:U,stage:Je,matchUpFormat:f,stageSequence:N,matchUpType:C,roundLimit:U,matchUps:P}),y&&_t({extension:{name:Ul,value:y},element:D}),E=(a=P==null?void 0:P.filter(B=>B.roundNumber===U))==null?void 0:a.length;let _=I===as?ku:xu,L=D&&U&&((o=_w({sourceStructureId:D.structureId,sourceRoundNumber:U,targetStructureId:d,finishingPositions:R,linkType:_}))==null?void 0:o.link);return{qualifyingDrawPositionsCount:l,qualifiersCount:E,...Q,structure:D,link:L}}function aQ(t){if(!t.tournamentRecord)return{error:ve};let e=kDe(t);return e.error,e}function kDe(t){if(!t.drawDefinition)return{error:_e};if(!t.targetStructureId)return{error:Xa};let e=XL(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:le}:HL({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function oQ(t){var e;let i=We(t,[{[$n]:!0,[RP]:!0,[wl]:!0},{[TSe]:!0,[Jr]:p=>Number.isInteger(p)&&p>0},{[Jr]:p=>Array.isArray(p)&&p.length===2&&p.every(Pi),[za]:ba,participantIds:!0}]);if(i.error)return i;let{drawDefinition:r,structureId:n,tournamentRecord:a,event:o}=t,{structure:s}=rt({drawDefinition:r,structureId:n});if(!s)return{error:Ni};if(!Yn({structure:s}))return{error:Sp};let l=p=>{var m;return(m=p.sides)==null?void 0:m.map(h=>h.participantId).some(h=>t.participantIds.includes(h))},u=p=>p.roundNumber===t.roundNumber,c=p=>!br(p),d=((s==null?void 0:s.matchUps)??[]).filter(u).filter(c).filter(l);if(d.length!==2)return{error:ba};for(let p of d){let m=(e=p==null?void 0:p.sides)==null?void 0:e.find(h=>t.participantIds.includes(h==null?void 0:h.participantId));if(m){let h=t.participantIds.find(f=>f!==(m==null?void 0:m.participantId));m.participantId=h,Et({tournamentId:a==null?void 0:a.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUp:p})}}return ui({drawDefinition:r,structureIds:[n]}),{...Q}}function xDe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:o,uuids:s,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=De(0,c).map(f=>d?d+f:void 0),m=[];for(let f=0;f<c;f++){let g=p.shift(),v={drawPosition:g,fed:u+1,feed:!0},y=l[f];y.roundNumber=i-1;let I=JL({roundPosition:y.roundPosition,roundNumber:i,idPrefix:n,uuids:s}),b={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Qi,roundNumber:i,matchUpId:I};t&&(b.matchUpType=r),o&&(b.isMock=!0),a.push(b);let S={children:[y,v]};m.push(S)}let h=e?e-c:void 0;return{roundNodes:m,matchUps:a,drawPosition:h}}function Bc(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:m,uuids:h,fmlc:f}=t;a=a??A(e);let g=FDe({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((M,C)=>M+C,0);else if(e){let M=e-a;i=g.filter(C=>C<=M?(M-=C,!0):!1),y=i.reduce((C,O)=>C+O,0),r=i.length}else n>=v?r=0:u&&(r=v-u,n=0),i=g.filter((M,C)=>u&&!r||r&&C>=n+r||C<n?0:M),y=i.reduce((M,C)=>M+C,0),r=i.length;let I=[...g,...i].sort((M,C)=>C-M),b=I.length,S=[...(l??[]).map(M=>M-1),...(o??[]).map(M=>b-M)].map(M=>I[M]).reduce((M,C)=>M+C,0);y=y-S;let w=0,U=[],T,D=1,P=De(0,a).map((M,C)=>({drawPosition:C+1+y})),E=y+1;for(let M of g){if({roundNodes:T,matchUps:U}=v0({matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:m,nodes:P,uuids:h}),D++,i.includes(M)){let C=Ra(i)[M],O=De(0,C),k=b+1-D,x=(o==null?void 0:o.includes(k))??(l==null?void 0:l.includes(D));O.forEach(()=>{({roundNodes:T,matchUps:U,drawPosition:E}=xDe({drawPosition:!x&&E||void 0,nodes:T,matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:m,uuids:h,fed:w})),D++,w+=1})}P=T}b!==D-1&&console.log("ERROR");let R=a-y;U=Rw({finishingPositionOffset:c?R:s,positionsFed:y,roundsCount:b,matchUps:U,fmlc:f});let N=T!=null&&T.length?T[0]:T;return N&&(N.roundNumber=D-1,N.matchUps=U),{draw:N,matchUps:U,roundsCount:b};function A(M){let C=Vx(M);return C>M?C/2:C}}function FDe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return De(0,e).reverse().map(i=>Math.pow(2,i))}function Tf(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:m,sequenceLimit:h,stage:f=Ne,drawSize:g,idPrefix:v,isMock:y,uuids:I}=t;if(!(!o||!u||o!=null&&o[l])||g<2||h&&s>h)return{};let b=[],S=[],w=[],U=t.matchUpType??(p==null?void 0:p.matchUpType),T=e+1,D=e+g,P=`${T}-${D}`,E=o==null?void 0:o[l],R=r&&`${r} `||"",N=(o==null?void 0:o[P])??(n==null?void 0:n[P]),A=t.structureName||(N==null?void 0:N.name)||(E==null?void 0:E.name)&&(i?`${R}${E==null?void 0:E.name}`:E.name)||`${R}${P}`,M=(N==null?void 0:N.abbreviation)??(E==null?void 0:E.abbreviation),C=t.structureId??(E==null?void 0:E.structureId)??(I==null?void 0:I.pop()),O={idPrefix:v&&`${v}-${A}-RP`,finishingPositionOffset:e,matchUpType:U,drawSize:g,isMock:y,uuids:I},{matchUps:k}=m?Bc(O):hl(O),x=uo({structureAbbreviation:M,stageSequence:s,structureName:A,matchUpType:U,roundOffset:d,structureId:C,matchUps:k,stage:f});b.push(...k),S.push(x);let F=Math.ceil(Math.log(g)/Math.log(2)),$=c?Math.min(c-d,F):(!a||T<a)&&F||0;return g>2&&De(1,$+1).forEach(L=>_(L)),{structureId:x.structureId,matchUps:b,structureName:A,structures:S,links:w,...Q};function _(L){let B=g/Math.pow(2,L);if(B<2)return;let V=g/Math.pow(2,L)+e;if(a&&V+1>a)return;let{structures:G,structureId:j,matchUps:z,links:W}=Tf({finishingPositionOffset:V,exitProfile:`${l}-${L}`,roundOffset:d+L,stageSequence:s+1,drawSize:B,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:h,matchUpType:U,idPrefix:v,uuids:I,stage:f});if(x.structureId&&j){let q={linkType:Kl,source:{roundNumber:L,structureId:x.structureId},target:{roundNumber:1,feedProfile:Bo,structureId:j}};W&&x&&W.push(q),W!=null&&W.length&&w.push(...W)}return G!=null&&G.length&&S.push(...G),z!=null&&z.length&&b.push(...z),{structureId:j,childLinks:W,structures:S}}}function QL({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=rt({drawDefinition:t,structureId:i});if(r.error)return te({result:r});let{matchUps:n}=qt({structure:r.structure,matchUpsMap:e});return{...An({matchUps:n}),matchUps:n,matchUpsMap:e}}function O2({finishingPositions:t,drawDefinition:e,structureId:i}){var r;let{roundProfile:n}=QL({drawDefinition:e,structureId:i});return(r=n&&Object.keys(n))==null?void 0:r.reduce((a,o)=>(sQ(n==null?void 0:n[o]).forEach(s=>{t.forEach(l=>{LDe({position:l,rangeDefinition:s})&&(a[l]={roundNumber:o})})}),a),{})}function LDe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return De(i,(r||i)+1).includes(t)}function sQ(t){var e,i;return[dt(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),dt(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function _De(t){return sQ(t).map(e=>De(e[0],e[1]&&e[1]+1||e[0]+1))}function Cv({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:le,context:{structureIds:e}};if(!t)return{error:_e};e=e??(t.structures??[]).filter(a=>a.stage!==Je).map(({structureId:a})=>a);let r=e.map(a=>{var o;let{roundProfile:s}=QL({drawDefinition:t,matchUpsMap:i,structureId:a});return(o=s&&Object.values(s))==null?void 0:o.map(_De).flat()}).flat(),n=r.filter(a=>(a==null?void 0:a.length)===1).sort(ur).flat();return{positionsNotPlayedOff:dt(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function lQ({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:_e};if(!r)return{error:Xa};if(!e)return{error:Qe,info:"missing playoffPositions"};let n=Cv({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,o=e.filter(v=>!a.includes(v)),s=O2({finishingPositions:o,drawDefinition:i,structureId:r}),l=Object.values(s).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>tt(v)).filter(v=>!t.includes(v)),u=O2({finishingPositions:a,drawDefinition:i,structureId:r}),c=u?Object.values(u):[],d=u?c.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>tt(v)):[],p=l.filter(v=>!d.includes(v)).sort(ur),{roundProfile:m}=QL({drawDefinition:i,structureId:r}),h=p.map(v=>{let y=m==null?void 0:m[v].finishingPositionRange.loser,[I,b]=y??[0,0];return De(I,(b||I)+1)}).flat().sort(ur),{playoffRoundsRanges:f}=$De({playoffSourceRounds:p,roundProfile:m}),g=[...p,...d];return{playoffPositionsReturned:h,playedOffSourceRounds:d,playoffRoundsRanges:f,playoffSourceRounds:p,sourceRounds:g,roundProfile:m}}function $De({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,o=De(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:o,roundNumber:i}})}}function $w({drawDefinition:t,structureId:e}){if(!t)return{error:_e};let{matchUps:i,matchUpsMap:r}=Pn({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=Cv({drawDefinition:t,matchUpsMap:r}),{structures:o}=ss({drawDefinition:t}),s=o.filter(u=>!e&&u.stage!==Lr||u.structureId===e),l={};for(let u of s){let c=u==null?void 0:u.structureId,d=BDe({playoffPositions:n,drawDefinition:t,structure:u,matchUps:i}),{error:p,...m}=d;if(p)return d;l[c]={structureId:c,...m}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function BDe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){var n,a,o,s,l,u,c,d,p;let m=i==null?void 0:i.structureId,{links:h}=Sv({drawDefinition:e,structureId:m});if(i.structureType===_n||i.structures){let w=(a=(n=si({structure:i}))==null?void 0:n.positionAssignments)==null?void 0:a.length,U=i.structures.length,T=(w??0)/U,D=((o=h.source)==null?void 0:o.flatMap(({source:x})=>(x==null?void 0:x.finishingPositions)||[]))||[],P=De(1,T+1).filter(x=>!D.includes(x)),E=((l=(s=r.find(x=>x.containerStructureId===m&&x.finishingPositionRange))==null?void 0:s.finishingPositionRange)==null?void 0:l.winner)||[0,1],R=h==null?void 0:h.source.map(({target:x})=>x.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:A=[]}=Cv({structureIds:R,drawDefinition:e}),M=[...N,...A],C=De(E[0],E[1]+1).filter(x=>!M.includes(x)),O=Cr(C,C.length/P.length),k=P.map((x,F)=>{let $=O[F],_=[Math.min(...$||[]),Math.max(...$||[])].join("-");return{finishingPosition:x,finishingPositions:$,finishingPositionRange:_}});return{positionsNotPlayedOff:C,playoffFinishingPositionRanges:k,finishingPositionsAvailable:P,finishingPositionsPlayedOff:D,positionsPlayedOff:N,groupCount:U,groupSize:T}}let f=((u=h==null?void 0:h.source)==null?void 0:u.filter(w=>w.linkCondition!==dl).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],g=((c=h==null?void 0:h.source)==null?void 0:c.filter(w=>w.linkCondition===dl).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],v=lQ({excludeRoundNumbers:f,playoffPositions:t,drawDefinition:e,structureId:m}),y=v!=null&&v.playoffSourceRounds?[...(v==null?void 0:v.playoffSourceRounds)||[]]:void 0,I=[...(v==null?void 0:v.playoffRoundsRanges)||[]],{roundProfile:b,error:S}=v;for(let w of g){let U=h==null?void 0:h.source.find(R=>R.source.roundNumber===w),T=U==null?void 0:U.target.roundNumber,D=U==null?void 0:U.target.structureId,P=r.filter(({roundNumber:R,structureId:N})=>N===D&&R===T),E=P.filter(({sides:R})=>R.find(N=>N.participantFed&&!N.participantId)).length;if(y&&E===P.length){y.push(w);let R=(p=(d=b==null?void 0:b[w])==null?void 0:d.finishingPositionRange)==null?void 0:p.loser;if(R){let N=Math.min(...R),A=N+E,M=De(N,A),C={finishingPositionRange:[N,A-1].join("-"),finishingPositions:M,roundNumber:w};I.push(C)}}}return y&&y.sort(ur),I.sort((w,U)=>w.roundNumber-U.roundNumber),{playoffRounds:y,playoffRoundsRanges:I,error:S}}function VDe({playoffGroups:t,drawDefinition:e,structureId:i}){var r,n;if(!e)return{error:_e};if(!Pi(i)||!Array.isArray(t))return{error:le};let a=t.map(({finishingPositions:o})=>o).flat();return{positionRangeMap:(n=(r=$w({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:r.filter(o=>a.includes(o.finishingPosition)))==null?void 0:n.reduce((o,s)=>(o[s.finishingPosition]=s,o),{})}}function uQ(t){var e,i;let{finishingPositionOffset:r=0,playoffAttributes:n,stageSequence:a=1,staggeredEntry:o,structureName:s,stage:l=Ne,matchUpType:u,structureId:c,idPrefix:d,drawSize:p,isMock:m,uuids:h}=t,f={finishingPositionOffset:r,matchUpType:u,drawSize:p,idPrefix:d,isMock:m,uuids:h},{matchUps:g}=o?Bc(f):hl(f),v=uo({structureName:s||((e=n==null?void 0:n[0])==null?void 0:e.name)||tn(Ne),structureId:c||(h==null?void 0:h.pop()),stageSequence:a,matchUpType:u,matchUps:g,stage:l}),y=[v],I=[];if(p>2){let b=p/2,{matchUps:S}=hl({finishingPositionOffset:r+b,idPrefix:d&&`${d}-c`,drawSize:b,matchUpType:u,isMock:m}),w=tn(an),U=((i=n==null?void 0:n["0-1"])==null?void 0:i.name)??t.consolationStructureName??(s?`${s} ${w}`:w),T=uo({structureName:U,matchUps:S,structureId:h==null?void 0:h.pop(),stage:an,stageSequence:1,matchUpType:u});y.push(T);let D={linkType:Kl,source:{roundNumber:1,structureId:v.structureId},target:{roundNumber:1,feedProfile:Bo,structureId:T.structureId}};I.push(D)}return{...Q,structures:y,links:I}}function cQ({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let o=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),s=(n==null?void 0:n.roundGroupedOrder)||[],l=n==null?void 0:n.roundFeedProfiles;return De(1+e,r+1+e).map(u=>{let c=l!=null&&l[u-1]?l[u-1]:u%2&&Bo||Kd,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:Kl,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},m=s[u-1];return m&&(p.target.groupedOrder=m),Ga()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=dl,p.target.feedProfile=Bo),o.includes(d)?p:void 0}).filter(Boolean)}function dQ(t){var e,i;let{playoffStructureNameBase:r,finishingPositionOffset:n,stageSequence:a=1,playoffAttributes:o,structureNameMap:s,staggeredEntry:l,stage:u=Ne,matchUpType:c,structureId:d,drawSize:p,idPrefix:m,isMock:h,uuids:f}=t,g={finishingPositionOffset:n,matchUpType:c,drawSize:p,idPrefix:m,isMock:h,uuids:f},{matchUps:v,roundsCount:y}=l?Bc(g):hl(g),I=t.structureName??((e=o==null?void 0:o[0])==null?void 0:e.name)??tn(Ne),b=wc({structureId:d||(f==null?void 0:f.pop()),structureName:I,stageSequence:a,matchUpType:c,matchUps:v,stage:u}),S=[b],w=[];if(p>2){let U=[0,2].slice(0,p/16).map((T,D)=>{let P=D+1,{consolationStructure:E}=jDe({idPrefix:m&&`${m}-c${D}`,structureId:f==null?void 0:f.pop(),playoffStructureNameBase:r,playoffAttributes:o,structureNameMap:s,stageSequence:P,roundOffset:T,matchUpType:c,drawSize:p,isMock:h,index:D,uuids:f});S.push(E);let R=cQ({consolationStructure:E,roundsCount:2,mainStructure:b,roundOffset:T});return{consolationStructure:E,links:R}}).map(T=>T.links).flat();if(w.push(...U),p>=4&&p<=16||p>32){let{matchUps:T}=hl({idPrefix:m&&`${m}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:c,isMock:h}),D=((i=o==null?void 0:o["3-4"])==null?void 0:i.name)??tn(Bi),P=(s==null?void 0:s[D])||D,E=r?`${r} ${P}`:P,R=wc({structureId:f==null?void 0:f.pop(),matchUps:T,stageSequence:2,stage:Bi,structureName:E,matchUpType:c}),N={linkType:Kl,source:{roundNumber:y-1,structureId:b.structureId},target:{structureId:R.structureId,feedProfile:Bo,roundNumber:1}};S.push(R),w.push(N)}}return{structures:S,links:w,...Q}}function jDe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:u,index:c,uuids:d}){var p,m;let h=l/(2*Math.pow(2,n)),{matchUps:f,roundsCount:g}=Bc({finishingPositionOffset:h,baseDrawSize:h,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:u,uuids:d}),v=c===0&&((p=i==null?void 0:i["0-1"])==null?void 0:p.name)||c===1&&((m=i==null?void 0:i["0-3"])==null?void 0:m.name)||`${tn(an)} ${c+1}`,y=(r==null?void 0:r[v])||v,I=t?`${t} ${y}`:y;return{consolationStructure:wc({matchUps:f,stage:an,structureName:I,stageSequence:e,matchUpType:a,structureId:o}),consolationRoundsCount:g}}function Gp(t){var e,i,r,n;let{finishingPositionOffset:a,stageSequence:o=1,playoffAttributes:s,feedsFromFinal:l,staggeredEntry:u,structureName:c,stage:d=Ne,structureId:p,matchUpType:m,skipRounds:h,feedRounds:f,idPrefix:g,drawSize:v,isMock:y,uuids:I,fmlc:b}=t,S=t.feedPolicy||((e=t.policyDefinitions)==null?void 0:e[dg])||((i=t.appliedPolicies)==null?void 0:i[dg]),w={finishingPositionOffset:a,matchUpType:m,skipRounds:h,drawSize:v,idPrefix:g,isMock:y,uuids:I},{matchUps:U}=u?Bc(w):hl(w),T=uo({structureName:c||((r=s==null?void 0:s[0])==null?void 0:r.name)||tn(Ne),structureId:p||(I==null?void 0:I.pop()),stageSequence:o,matchUpType:m,matchUps:U,stage:d}),D=[T],P=[],E=v/2,{matchUps:R,roundsCount:N}=Bc({finishingPositionOffset:E,idPrefix:g&&`${g}-c`,isConsolation:!0,feedsFromFinal:l,baseDrawSize:E,matchUpType:m,feedRounds:f,skipRounds:h,isMock:y,uuids:I,fmlc:b});if(v>2){let A=((n=s==null?void 0:s["0-1"])==null?void 0:n.name)??tn(an),M=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${A}`:A,C=uo({matchUps:R,structureId:I==null?void 0:I.pop(),stage:an,stageSequence:1,structureName:M,matchUpType:m});D.push(C);let O=cQ({consolationStructure:C,mainStructure:T,roundsCount:N,feedPolicy:S,fmlc:b});P.push(...O)}return{...Q,structures:D,links:P}}function pQ({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:m}){var h,f,g,v,y,I;u=u||(n==null?void 0:n[dg]);let b="processPlayoffGroups",S=0,w=[],U=[],T=[],{error:D,positionRangeMap:P}=VDe({structureId:r,drawDefinition:o,playoffGroups:s});if(D)return te({result:{error:D},stack:b});if(!(!P||s!=null&&s.every(E=>{let{finishingPositions:R=[]}=E;if(!R.length)return!1;let N=[...R].sort(ur).map((A,M)=>(R[M+1]||A)-A).every(A=>A<2);return(!t||N)&&R.every(A=>P[A])})))return te({context:{validFinishingPositions:Object.values(P)},result:{error:le},stack:b});for(let E of s){let R=E.finishingPositions,N=P&&R.map($=>{var _;return(_=P[$])==null?void 0:_.finishingPositions}).flat(),A=c*R.length,M=sv(A),C=M===2&&Qs||E.drawType||Qs;N&&(S=Math.min(...N)-1);let O=N&&`${Math.min(...N)}-${Math.max(...N)}`,k=E.structureName||O&&((f=(h=E.playoffAttributes)==null?void 0:h[O])==null?void 0:f.name)||((v=(g=E.playoffAttributes)==null?void 0:g[0])==null?void 0:v.name),x={addNameBaseToAttributeName:E.addNameBaseToAttributeName,playoffStructureNameBase:E.playoffStructureNameBase,finishingPositionNaming:E.finishingPositionNaming,finishingPositionLimit:E.finishingPositionLimit,structureId:E.structureId??(m==null?void 0:m.pop()),playoffAttributes:E.playoffAttributes,structureNameMap:E.structureNameMap,sequenceLimit:E.sequenceLimit,structureName:k,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:S,stage:Bi,stageSequence:a,matchUpType:l,drawSize:M,isMock:p,uuids:m},F=({playoffStructures:$,playoffLinks:_})=>{let[L]=$,B=bU({playoffStructureId:L.structureId,finishingPositions:R,sourceStructureId:r});T.push(B),T.push(..._),U.push(...$),w.push({structureId:L.structureId,finishingPositions:R}),S+=A};if(C===Qs){let{matchUps:$}=hl({finishingPositionLimit:S+A,idPrefix:d&&`${d}-po`,finishingPositionOffset:S,matchUpType:l,drawSize:M,isMock:p,uuids:m}),_=uo({structureId:E.structureId??(m==null?void 0:m.pop()),matchUpFormat:e,stage:Bi,structureName:k,stageSequence:a,matchUps:$});U.push(_);let L=bU({playoffStructureId:_.structureId,finishingPositions:R,sourceStructureId:r});T.push(L),S+=A,w.push({structureId:_.structureId,finishingPositions:R})}else if([og,sg,Bi].includes(C)){let $={playoffAttributes:E.playoffAttributes??i,playoffStructureNameBase:E.playoffStructureNameBase,structureId:E.structureId??(m==null?void 0:m.pop()),structureName:E.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:S,stage:Bi,roundOffset:0,stageSequence:a,drawSize:M,isMock:p,uuids:m};C===og?Object.assign($,{playoffAttributes:(E==null?void 0:E.playoffAttributes)??i??CF,roundOffsetLimit:3}):C===sg&&Object.assign($,{playoffAttributes:(E==null?void 0:E.playoffAttributes)??i??MF,roundOffsetLimit:2});let _=Tf($);if(_.error)return _;if((y=_.links)!=null&&y.length&&T.push(..._.links),(I=_.structures)!=null&&I.length&&U.push(..._.structures),U.sort(Mh),_.structureId){let L=bU({playoffStructureId:_.structureId,finishingPositions:R,sourceStructureId:r});T.push(L),w.push({structureId:_.structureId,finishingPositions:R})}S+=A}else if([lg,lw,sy,oy,ay,ly].includes(C)){let $=[m==null?void 0:m.pop(),m==null?void 0:m.pop()],_={playoffStructureNameBase:E.playoffStructureNameBase,structureId:E.structureId??(m==null?void 0:m.pop()),playoffAttributes:E.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:S,uuids:$,stage:Bi,structureName:k,matchUpType:l,feedPolicy:u,drawSize:M,isMock:p},L={[lg]:{fmlc:!0,feedRounds:1},[ly]:{feedRounds:1},[sy]:{feedsFromFinal:3},[oy]:{feedsFromFinal:2},[ay]:{feedsFromFinal:1}};Object.assign(_,L[C]||{});let{structures:B,links:V}=Gp(_),[G]=B,j=bU({playoffStructureId:G.structureId,finishingPositions:R,sourceStructureId:r});T.push(j),T.push(...V),U.push(...B),w.push({structureId:G.structureId,finishingPositions:R}),S+=A}else if([as].includes(C)){let{structures:$,links:_}=kw({...x,structureOptions:E.structureOptions||{groupSize:4}});F({playoffStructures:$,playoffLinks:_})}else if([sw].includes(C)){let{structures:$,links:_}=uQ(x);F({playoffStructures:$,playoffLinks:_})}else if([ISe].includes(C)){let{structures:$,links:_}=dQ(x);F({playoffStructures:$,playoffLinks:_})}else if([Ha].includes(C)){let $=uo({structureId:E.structureId??(m==null?void 0:m.pop()),structureName:E.structureName,finishingPosition:eS,stage:Bi,stageSequence:a,matchUps:[]});F({playoffStructures:[$],playoffLinks:[]})}}return{finishingPositionTargets:w,positionRangeMap:P,structures:U,links:T}}function bU({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:ku,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:ys,roundNumber:1}}}function Bw({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>Vw({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function Vw({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:u}=e||{},c=i??o??0,d=p=>{if(!n&&!(r!=null&&r.isMock))return(a==null?void 0:a.pop())??Ht();let m=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${r==null?void 0:r.matchUpId}-${m}-TMU-${p+1}`};return De(0,c).map(p=>{let m=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Qi,collectionPosition:m,collectionId:l,processCodes:u,matchUpType:s,isMock:n}})}function GDe(t){var e,i,r;let n="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return te({result:{error:Qe},info:"playoffGroups required",stack:n});let{sourceStructureId:a,requireSequential:o,tournamentRecord:s,drawDefinition:l,playoffGroups:u,groupCount:c,groupSize:d,event:p}=t,m=pQ({requireSequential:o,sourceStructureId:a,playoffGroups:u,groupCount:c,groupSize:d,...t});if(m.error)return te({result:m,stack:n});let{structures:h=[],links:f=[],finishingPositionTargets:g,positionRangeMap:v}=m,y=g==null?void 0:g.map(({finishingPositions:E})=>E).flat().map(E=>v[E].finishingPositions).flat();l.structures.push(...h),l.links.push(...f);let{matchUps:I,matchUpsMap:b}=gr({inContext:!0,drawDefinition:l}),S=h.map(({structureId:E})=>E),w=I==null?void 0:I.filter(({structureId:E})=>S.includes(E)).map(Pr),U=(e=b==null?void 0:b.drawMatchUps)==null?void 0:e.filter(({matchUpId:E})=>w==null?void 0:w.includes(E));if(U!=null&&U.length){let E=(i=In({drawDefinition:l,event:p}))==null?void 0:i.tieFormat;E&&U.forEach(R=>{let{tieMatchUps:N}=Bw({isMock:t.isMock,tieFormat:E,matchUp:R});Object.assign(R,{tieMatchUps:N,matchUpType:Va})})}let{positionAssignments:T}=si({structureId:a,drawDefinition:l}),D={};T==null||T.forEach(E=>{var R,N,A;let M=(A=(N=(R=It({element:E,name:kc}))==null?void 0:R.extension)==null?void 0:N.value)==null?void 0:A.groupOrder;M&&(D[M]||(D[M]=[]),D[M].push(E.participantId))});let P=Ev({provisionalPositioning:t.provisionalPositioning,structureId:a,applyPositioning:!0,event:t.event,tournamentRecord:s,drawDefinition:l});return P.error&&((r=P.error)==null?void 0:r.code)!==jx.code?te({result:P,stack:n}):{structures:h,links:f,positionsPlayedOff:y,drawDefinition:l,...Q}}function hf({value:t,sourceRange:e,targetRange:i}){let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),o=Math.max(...i);return(t-r)*(o-a)/(n-r)+a}var Lo="ELO",mQ="NTRP",HDe="TRN",hQ="UTR",ZL="WTN",zDe={ELO:Lo,NTRP:mQ,TRN:HDe,UTR:hQ,WTN:ZL},WDe={[Lo]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[mQ]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[hQ]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[ZL]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Tr=WDe;function qDe({sourceRatingType:t,sourceRating:e}){let i=Tr[t].range,r=i[0]>i[1],n=Tr[Lo].range;return hf({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function YDe({targetRatingType:t,sourceRating:e}){let i=Tr[t].decimalsCount||0,r=Tr[t].range,n=r[0]>r[1],a=Math.max(...r),o=Tr[Lo].range,s=hf({targetRange:r,sourceRange:o,value:e}),l=parseFloat(s.toFixed(i));return n?a-l:l}function k2(t){var e;let i=We(t,[{ratings:!0,[Xn]:ia}]);if(i.error)return i;let r=t.matchUpType&&[ri,ei].includes(t.matchUpType)?t.matchUpType:ri,n=Object.keys(Tr),a=t.targetRatingType&&n.includes(t.targetRatingType)?t.targetRatingType:Lo,o=t.ratings[r]?t.ratings[r].reduce((p,m)=>p.includes(m.scaleName)?p:p.concat(m.scaleName),[]):[];if(!o)return{error:jr};let s=((e=t.ratings[r])==null?void 0:e.find(p=>p.scaleName===a))??t.ratings[r][0];if(o[0]===a)return s;let l=s.scaleName,u=Tr[s.scaleName].accessor,c=u?s.scaleValue[u]:s.scaleValue,d=qDe({sourceRatingType:l,sourceRating:c});return{convertedRating:YDe({targetRatingType:a,sourceRating:d}),sourceRating:c}}function KDe({participantResults:t,sides:e,score:i}){var r,n;let a=e.find(({sideNumber:u})=>u===1),o=e.find(({sideNumber:u})=>u===2),s=(r=a==null?void 0:a.participant)==null?void 0:r.ratings,l=(n=o==null?void 0:o.participant)==null?void 0:n.ratings;if(s!=null&&s[ri]&&l!=null&&l[ri]){let u=Lo,{convertedRating:c}=k2({ratings:s,targetRatingType:u}),{convertedRating:d}=k2({ratings:l,targetRatingType:u}),{side1pressure:p,side2pressure:m}=JDe({side1ConvertedRating:c,side2ConvertedRating:d,score:i});p&&t[a==null?void 0:a.participantId].pressureScores.push(p),m&&t[o==null?void 0:o.participantId].pressureScores.push(m);let h=Math.max(...Tr[Lo].range),f=JS((d-c)/h),g=JS((c-d)/h);t[a==null?void 0:a.participantId].ratingVariation.push(f),t[o==null?void 0:o.participantId].ratingVariation.push(g)}}function JDe({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){var r,n;let a=t>e?t:e,o=t>e?e:t,s=Math.abs(t-e),l=Tr[Lo].range,u=Math.max(...l),c=(u-a)*0,d=(a+c)/u*s,p=(r=i==null?void 0:i.sets)==null?void 0:r.reduce((b,S)=>b+((S==null?void 0:S.side1Score)??0),0),m=(n=i==null?void 0:i.sets)==null?void 0:n.reduce((b,S)=>b+(S.side2Score??0),0),h=t>e?2:1,f=(p||0)*(o+(h===1?d:0)),g=(m||0)*(o+(h===2?d:0)),v=f+g,y=v?JS(f/v):0,I=v?JS(g/v):0;return{side1pressure:y,side2pressure:I}}function e_({winningSide:t,matchUpFormat:e=Yo,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],o=n==null?void 0:n.sets,s=typeof t=="number"&&t-1,l=Ln(e),u=t_((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===Pt&&r!=null&&r.setsCreditForDefaults||i===Ft&&r!=null&&r.setsCreditForWalkovers))a[s]=u;else for(let c of o||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof s=="number"&&i===zr&&(+a[1-s]===u&&(a[1-s]-=1),r!=null&&r.setsCreditForRetirements&&(a[s]=u)),a}function fQ({matchUpFormat:t=Yo,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){var a,o;let{sets:s}=n||{};if(!s)return[0,0];let l=typeof e=="number"&&e-1,u=Ln(t),c=(u==null?void 0:u.bestOf)??1,d=t_(c),p=((a=u==null?void 0:u.setFormat)==null?void 0:a.tiebreakAt)||0,m=[[],[]];if(typeof l=="number"&&(i===Pt&&r!=null&&r.gamesCreditForDefaults||i===Ft&&r!=null&&r.gamesCreditForWalkovers)){let h=((o=u==null?void 0:u.setFormat)==null?void 0:o.setTo)||0,f=d*h;m[l].push(f)}else s.forEach((h,f)=>{var g;let v=(h.setNumber||f+1)>d&&u!=null&&u.finalSetFormat?"finalSetFormat":"setFormat",y=(g=u==null?void 0:u[v])==null?void 0:g.based,I=u==null?void 0:u[v].tiebreakSet,{side1Score:b,side2Score:S}=h;x2(y)&&(m[0].push(tt(b||0)),m[1].push(tt(S||0))),I&&h.winningSide&&(r==null?void 0:r.gamesCreditForTiebreakSets)!==!1&&m[h.winningSide-1].push(1)});if(i===zr&&typeof l=="number"){let h=s.length>d&&u!=null&&u.finalSetFormat?"finalSetFormat":"setFormat",f=u==null?void 0:u[h];if(x2(f.based)){let g=(f==null?void 0:f.setTo)||0,v=I=>{if(!(!u||I===""))return+I===p-1||+I===p?tt(p||0)+1:+I<p?g:p},y=e_({winningSide:e,score:{sets:s},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(m.map(I=>I[l]<=I[1-l]).reduce((I,b)=>I+(b?1:0),0)>y[1-l]){let I=m[l].length,b=v(m[1-l][I-1]);b&&(m[l][I-1]=b)}d>m[l].length&&r!=null&&r.gamesCreditForRetirements&&m[l].push(g)}}return[m[0].reduce((h,f)=>h+f,0),m[1].reduce((h,f)=>h+f,0)]}function gQ({matchUpFormat:t,score:e}){var i;let r=t?Ln(t):void 0,n=(r==null?void 0:r.bestOf)??1,a=t_(n),o=[0,0],s=[0,0];return(i=e==null?void 0:e.sets)==null||i.forEach((l,u)=>{var c;let d=(l.setNumber||u+1)>a&&r!=null&&r.finalSetFormat?"finalSetFormat":"setFormat",p=(c=r==null?void 0:r[d])==null?void 0:c.based;if(vQ(p)){let{side1Score:m,side2Score:h}=l;m&&(s[0]+=tt(m||0)),h&&(s[1]+=tt(h||0))}else l.side1TiebreakScore&&(s[0]+=tt(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(s[1]+=tt(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(o[l.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:o}}function t_(t){return t&&Math.ceil(t/2)||1}function vQ(t){return t==="P"}function x2(t){return!vQ(t)}function XDe({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:r,totalSets:n}){var a;let o=e&&Ln(e)||{},s=o.bestOf,l=s&&Math.ceil(s/2)||1,u=(a=o.setFormat)==null?void 0:a.setTo;Object.keys(t).forEach(c=>{let d=t[c].setsWon,p=t[c].setsLost,m=i!=null&&i.groupTotalSetsPlayed?n:r*(l||0)||d+p,h=Math.round(d/m*1e3)/1e3;(h===1/0||isNaN(h))&&(h=m);let f=t[c].tieMatchUpsWon,g=t[c].tieMatchUpsLost,v=f+g,y=Math.round(f/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=f);let I=t[c].matchUpsWon,b=t[c].matchUpsLost,S=I+b,w=Math.round(I/S*1e3)/1e3;(w===1/0||isNaN(w))&&(w=I);let U=t[c].gamesWon||0,T=t[c].gamesLost||0,D=(r||0)*(l||0)*(u||0),P=Math.max(D,U+T),E=Math.round(U/P*1e3)/1e3;(E===1/0||isNaN(E))&&(E=0);let R=t[c].pointsWon+t[c].pointsLost,N=Math.round(t[c].pointsWon/R*1e3)/1e3;(N===1/0||isNaN(N))&&(N=0),t[c].setsWon=d,t[c].setsLost=p,t[c].setsPct=h,t[c].tieMatchUpsWon=f,t[c].tieMatchUpsPct=y,t[c].matchUpsPct=w,t[c].gamesWon=U,t[c].gamesLost=T,t[c].gamesPct=E,t[c].pointsPct=N,t[c].result=`${t[c].matchUpsWon}/${t[c].matchUpsLost}`})}function jw({participantIds:t,pressureRating:e,matchUpFormat:i,tallyPolicy:r,perPlayer:n,matchUps:a}){var o,s,l,u,c,d,p;let m={},h=(r==null?void 0:r.excludeMatchUpStatuses)||[],f=a==null?void 0:a.filter(v=>(v.tieMatchUps||!h.includes(v.matchUpStatus))&&(!(t!=null&&t.length)||ji(t,[ff(v,0),ff(v,1)]).length===2)),g=(o=f==null?void 0:f.flatMap(({score:v,tieMatchUps:y})=>{var I;return y?y.filter(({matchUpStatus:b})=>!h.includes(b)).flatMap(({score:b})=>{var S;return((S=b==null?void 0:b.sets)==null?void 0:S.length)??0}):((I=v==null?void 0:v.sets)==null?void 0:I.length)??0}))==null?void 0:o.reduce((v,y)=>v+y,0);for(let v of f??[]){let{matchUpStatus:y,tieMatchUps:I,tieFormat:b,score:S,winningSide:w,sides:U}=v,T=b&&v._disableAutoCalc&&b.collectionDefinitions.every(({scoreValue:N})=>N),D=w&&QDe(v),P=w&&ZDe(v);if(!D&&!P)if(y&&yr.includes(y)){let N=ff(v,0),A=ff(v,1);N&&(dc(m,N),m[N].matchUpsCancelled+=1),A&&(dc(m,A),m[A].matchUpsCancelled+=1)}else if(I!=null&&I.length){n=0;for(let N of I){if(N.winningSide){let A=(s=U==null?void 0:U.find(({sideNumber:C})=>C===N.winningSide))==null?void 0:s.participantId,M=(l=U==null?void 0:U.find(({sideNumber:C})=>C===N.winningSide))==null?void 0:l.participantId;A&&M&&(dc(m,A),dc(m,M),m[A].tieMatchUpsWon+=1,m[M].tieMatchUpsLost+=1,Ji(ri)(N.matchUpType)?(m[A].tieSinglesWon+=1,m[M].tieSinglesLost+=1):Ji(ei)(N.matchUpType)&&(m[A].tieDoublesWon+=1,m[M].tieDoublesLost+=1))}F2({score:N.score,manualGamesOverride:T,participantResults:m,sides:U})}}else F2({manualGamesOverride:T,participantResults:m,score:S,sides:U});else if(dc(m,D),dc(m,P),I==null?void 0:I.length){n=0;for(let N of I){let{matchUpType:A}=N,M=Ji(ei)(A),C=Ji(ri)(A);N.winningSide&&(N.winningSide===w?(D&&(m[D].tieMatchUpsWon+=1,C&&(m[D].tieSinglesWon+=1),M&&(m[D].tieDoublesWon+=1)),P&&(m[P].tieMatchUpsLost+=1,C&&(m[P].tieSinglesLost+=1),M&&(m[P].tieDoublesLost+=1))):N.winningSide!==w&&(P&&(m[P].tieMatchUpsWon+=1,C&&(m[P].tieSinglesWon+=1),M&&(m[P].tieDoublesWon+=1)),D&&(m[D].tieMatchUpsLost+=1,C&&(m[D].tieSinglesLost+=1),M&&(m[D].tieDoublesLost+=1)))),L2({matchUpFormat:N.matchUpFormat,matchUpStatus:N.matchUpStatus,matchUpType:N.matchUpType,score:N.score,sides:N.sides,winningParticipantId:D,losingParticipantId:P,manualGamesOverride:T,participantResults:m,isTieMatchUp:!0,pressureRating:e,tallyPolicy:r,winningSide:w})}IQ({winningParticipantId:D,losingParticipantId:P,participantResults:m,matchUpStatus:y})}else L2({matchUpFormat:v.matchUpFormat??i,matchUpType:v.matchUpType,isTieMatchUp:void 0,winningParticipantId:D,manualGamesOverride:T,losingParticipantId:P,participantResults:m,pressureRating:e,matchUpStatus:y,tallyPolicy:r,winningSide:w,score:S,sides:U});let E=(u=S==null?void 0:S.sets)==null?void 0:u.reduce((N,A)=>N+((A==null?void 0:A.side1Score)??0),0),R=(c=S==null?void 0:S.sets)==null?void 0:c.reduce((N,A)=>N+(A.side2Score??0),0);if(T){let N=(d=U==null?void 0:U.find(({sideNumber:M})=>M===1))==null?void 0:d.participantId,A=(p=U==null?void 0:U.find(({sideNumber:M})=>M===2))==null?void 0:p.participantId;dc(m,N),dc(m,A),N&&(m[N].gamesWon+=E,m[N].gamesLost+=R),A&&(m[A].gamesWon+=R,m[A].gamesLost+=E)}}return XDe({participantResults:m,matchUpFormat:i,tallyPolicy:r,perPlayer:n,totalSets:g}),{participantResults:m}}function QDe(t){let e=t.winningSide-1;return ff(t,e)}function ZDe(t){let e=1-(t.winningSide-1);return ff(t,e)}function ff(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function dc(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function F2({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],o=[0,0];for(let l of n||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(o[u-1]+=1),a[0].push(tt(c||0)),a[1].push(tt(d||0))}let s=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];r.forEach((l,u)=>{let{participantId:c}=l;c&&(dc(e,c),e[c].setsWon+=o[u],e[c].setsLost+=o[1-u],t||(e[c].gamesWon+=s[u],e[c].gamesLost+=s[1-u]))})}function L2({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:o,isTieMatchUp:s,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let m=c&&c-1,h=1-m;n&&l===ri&&KDe({participantResults:r,sides:p,score:d}),s||IQ({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:o});let f=e_({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=fQ({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:v}=gQ({score:d,matchUpFormat:a});t&&(r[t].setsWon+=f[m],r[t].setsLost+=f[h],e||(r[t].gamesWon+=g[m],r[t].gamesLost+=g[h]),r[t].pointsWon+=v[m],r[t].pointsLost+=v[h]),i&&(r[i].setsWon+=f[h],r[i].setsLost+=f[m],e||(r[i].gamesWon+=g[h],r[i].gamesLost+=g[m]),r[i].pointsWon+=v[h],r[i].pointsLost+=v[m])}function IQ({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===Ft&&(i[e].walkovers+=1),r===Pt&&(i[e].defaults+=1),r===zr&&(i[e].retirements+=1),[Pt,zr,Ft].includes(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function ePe({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(o=>{o.participantId&&o.participant&&(r[o.participantId]=o.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,o)=>{var s,l;if((s=a.excludedDirectives)!=null&&s.length){let u=a.excludedDirectives.map(({attribute:p})=>p).join(", "),c=`${u.length} directives were excluded due to participants limit}`;n.push(c);let d=`Excluded: ${u}`;n.push(d)}else{let u=(f,g)=>parseFloat(a.reversed?f:g)-parseFloat(a.reversed?g:f),c=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=f=>{f.groups&&Object.keys(f.groups).sort(u).forEach(g=>{let v=f.groups[g].map(I=>r[I]).join(", "),y=`${g} ${f.attribute}: ${v}`;n.push(y)})},p=a.reversed?" in reverse order":"",m=a.groups?"grouped":"separated",h=`Step ${o+1}: ${c} particiants were ${m}${p} by ${a.attribute}`;if(n.push(h),a.idsFilter){let f=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;n.push(f)}d(a)}n.push("----------------------")}),n.push("Final Order:"),e.forEach(a=>{let{participantId:o,resolved:s}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[o]} => resolved: ${!!s}`)}),n.join(`\r
`)}function yQ({participantResults:t,participantIds:e,attribute:i}){return bQ({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:o}=n,s=o==null?void 0:o[i];return!isNaN(s)&&a&&(r[s]?r[s].push(a):r[s]=[a]),r},{})}function bQ(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var tPe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],WE={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function _2(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!iPe(t))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n==null?void 0:n.groupOrderKey)?n.groupOrderKey:"matchUpsWon",s=yQ({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l=Object.keys(s).map(g=>parseFloat(g)).sort((g,v)=>v-g).map(g=>s[g]).map(g=>{let v=wQ({participantIds:g,...t});return a.push(...v.report??[]),v.order}).map((g,v)=>g.map(y=>y.resolved?y:{...y,subGroup:[v].concat(...y.subGroup??[])})).flat(),u,c=0,d=1,p;l.forEach((g,v)=>{var y;v&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let I=parseInt(((y=g.subGroup)==null?void 0:y.join(""))||0);g.resolved?(g.position=v+1,d=g.position):(u&&I>u&&(d+=c,c=0),g.position=d,c+=1),u=I});let m=l.map(({position:g})=>g),h=Ra(m);return l.forEach(g=>{let{participantId:v,position:y}=g||{},I=i[v];g.GEMscore=f(I);let b=h[y];(g==null?void 0:g.position)!==void 0&&(b>1&&(g.ties=b,r&&(g.subOrder=r[v])),g.rankOrder=y,g.groupOrder=y+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function f(g){return(Array.isArray(n==null?void 0:n.GEMscore)?Object.keys(WE).filter(v=>n.GEMscore.includes(v)):Object.keys(WE)).map(v=>(g[v]||0)*Math.pow(10,WE[v].toFixed(3))).reduce((v,y)=>v+y,0)}}function iPe({participantResults:t,participantsCount:e}){let i=bQ({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function rPe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:r,attribute:n,idsFilter:a,matchUps:o,reversed:s}){let{participantResults:l}=jw({participantIds:a&&e,matchUpFormat:i,tallyPolicy:r,matchUps:o}),u=yQ({participantResults:l,participantIds:e,attribute:n}),c=[{attribute:n,reversed:s,groups:u,idsFilter:a}],d;return Object.keys(u).length>1&&e.length&&(d=Object.keys(u).map(p=>parseFloat(p)).sort((p,m)=>s?p-m:m-p).map(p=>u[p]).map(p=>{let m=wQ({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:r,matchUps:o});return c.push(...m.report??[]),m.order}).map((p,m)=>p.map(h=>h.resolved?h:{...h,subGroup:[m].concat(...h.subGroup??[])})).flat()),{order:d,report:c}}function wQ({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let o=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(n!=null&&n.headToHead)||!n.headToHead.disabled&&!e)){let c=nPe({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:c,headToHeadWinner:d,report:s}}}let u=((n==null?void 0:n.tallyDirectives)||tPe).filter(c=>{let d=!(xi(c.maxParticipants)&&(i==null?void 0:i.length)>c.maxParticipants);return d||o.push(c),d});return o.length&&s.push({excludedDirectives:o,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,disableHeadToHead:m})=>(l=rPe({disableHeadToHead:m,participantIds:i,matchUpFormat:r,tallyPolicy:n,attribute:c,idsFilter:p,matchUps:a,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(c=>({participantId:c})),report:s}}function nPe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function Mv({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:o}){if(!(n!=null&&n.length)||!Co(n))return{error:Qu};let s=dt(n.map(({structureId:b})=>b));if(s.length!==1)return te({result:{error:le,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:s}});let l=n.filter(b=>b&&b.matchUpStatus!==jt),u=l.length&&dt(l.map(({drawPositions:b})=>b).flat()).length,c=l.filter(b=>Cd({matchUp:b})).length===l.length;c||(o=0);let d=n.every(({matchUpType:b,tieMatchUps:S})=>b===gi&&(S==null?void 0:S.every(w=>Cd({matchUp:w})))),p=t==null?void 0:t[BF],m=n.filter(b=>Cd({matchUp:b})||b.matchUpType===gi),{participantResults:h}=jw({matchUps:m,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:o}),f,g,{groupOrder:v,report:y}=_2({matchUps:m,participantResults:h,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a});if(i&&aPe({participantResults:h}),c&&v)f=y,g=v,v.forEach(b=>{let{participantId:S,groupOrder:w,rankOrder:U,subOrder:T,ties:D,GEMscore:P}=b,E=h[S];Object.assign(E,{groupOrder:w,rankOrder:U,GEMscore:P,subOrder:T,ties:D})});else{let{groupOrder:b,report:S}=_2({requireCompletion:!1,participantResults:h,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});f=S,g=b,b&&b.forEach(w=>{let{participantId:U,groupOrder:T,GEMscore:D}=w,P=h[U];Object.assign(P,{provisionalOrder:T,GEMscore:D})})}let I={completedTieMatchUps:d,readableReport:"",participantResults:h,bracketComplete:c,order:[],report:f};if((c||d)&&(I.order=g),e||Ga({tally:!0})){let b=ePe({matchUps:n,report:f,order:g});Ga({tally:!0})&&console.log(b),I.readableReport=b}return I}function aPe({participantResults:t}){let e=n=>n.reduce((a,o)=>a+parseFloat(o),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:o}=a,s=o!=null&&o.length?i(o):0;return{participantId:n,averagePressure:s}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function UQ({positionAssignments:t}){let e=(t||[]).filter(Na(Xl)).map(n=>{let{extension:a}=It({element:n,name:pg}),o=tt(a==null?void 0:a.value),s=!isNaN(o)&&o;return s&&{participantId:n.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=Ra(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function i_({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!Co(n))return{error:le};if(!t)return{error:le};let{policyDefinitions:o}=tc({policyTypes:[BF],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:s}=UQ({positionAssignments:t}),l=n.length?Mv({policyDefinitions:o,matchUpFormat:r,subOrderMap:s,matchUps:n}):void 0;if(l!=null&&l.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(m=>{let{participantId:h}=m;if(p.includes(h)){let f={value:u[h],name:kc};_t({element:m,extension:f}),u[h].ties||Dn({element:m,name:pg})}else Dn({element:m,name:kc}),Dn({element:m,name:pg})}),ui({drawDefinition:i}),{...Q,participantResults:u,bracketComplete:c,report:d}}function SQ({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function Ti(t){let e=We(t,[{[$n]:!0,[wl]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:o,matchUpId:s,inContext:l,context:u,event:c}=t,{structures:d=[]}=ss({drawDefinition:a}),p=t.contextContent||n&&ic({contextProfile:n,drawDefinition:a});for(let m of d){let{matchUps:h}=qt({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:o,inContext:l,structure:m,context:u,event:c}),{matchUp:f}=SQ({matchUps:h,matchUpId:s});if(f)return{matchUp:f,structure:m}}return{error:fn}}function sR(t){var e;return!At(t)||!t.notes?{error:Qe}:At(t.element)?!Pi(t.notes)&&!((e=t.notes)!=null&&e.testing)?{error:le}:(Object.assign(t.element,{notes:t.notes}),{...Q}):{error:le}}function r_(t){return At(t)?At(t.element)?(t.element.notes&&delete t.element.notes,{...Q}):{error:le}:{error:Qe}}var lR={matchUpStatus:Qi,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function el(t){var e,i,r,n,a,o,s,l;let u="modifyMatchUpScore",c=t.matchUpFormat,d=t.matchUp,p,{matchUpStatusCodes:m,tournamentRecord:h,drawDefinition:f,matchUpStatus:g,removeScore:v,winningSide:y,matchUpId:I,event:b,notes:S,score:w}=t,U=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(e=Bt({policyTypes:[vo],tournamentRecord:h,drawDefinition:f,structure:p,event:b}))==null?void 0:e.appliedPolicies,T=d.matchUpType===gi;if(T&&f){if(I&&d.matchUpId!==I){let M=Ti({drawDefinition:f,matchUpId:I,event:b});if(!M.matchUp)return{error:fn};({matchUp:d,structure:p}=M)}}else d.matchUpId!==I&&console.log("!!!!!");g&&[Ft,ir].includes(g)||v?Object.assign(d,{...lR}):w&&(d.score=w);let D=g&&(d==null?void 0:d.matchUpStatus)===Pt&&g!==Pt;g&&(d.matchUpStatus=g),c&&(d.matchUpFormat=c),m&&(d.matchUpStatusCodes=m),y&&(d.winningSide=y),t.removeWinningSide&&(d.winningSide=void 0),!p&&f&&({structure:p}=Ti({drawDefinition:f,matchUpId:I,event:b})),g&&!d.winningSide&&br(d)&&!yr.includes(g)&&![Ch,nd,Ma].includes(g)&&(d.matchUpStatus=ms);let P;if((D&&(i=d==null?void 0:d.processCodes)!=null&&i.length||g===Pt)&&(P=(n=(r=U==null?void 0:U[vo])==null?void 0:r.processCodes)==null?void 0:n.incompleteAssignmentsOnDefault),!d.collectionId){let M=(p==null?void 0:p.structureType)===_n,C=Yn({structure:p});if(gL({drawDefinition:f,structure:p})||C||M){let O=F=>{c=T?"SET1-S:T100":c??d.matchUpFormat??(F==null?void 0:F.matchUpFormat)??(f==null?void 0:f.matchUpFormat)??(b==null?void 0:b.matchUpFormat);let $=T?{matchUpTypes:[gi]}:void 0,{matchUps:_}=qt({afterRecoveryTimes:!1,tournamentRecord:h,inContext:!0,matchUpFilters:$,drawDefinition:f,structure:F,event:b});return C&&(F.positionAssignments=dt(_.flatMap(L=>(L.sides??[]).map(B=>B.participantId)).filter(Boolean)).map(L=>({participantId:L}))),i_({positionAssignments:F.positionAssignments,tournamentRecord:h,drawDefinition:f,matchUpFormat:c,matchUps:_,event:b})},k=M&&p.structures.find(F=>F==null?void 0:F.matchUps.find($=>$.matchUpId===I)),x=O(k||p);if(x.error)return te({result:x,stack:u})}}if(S){let M=sR({element:d,notes:S});if(M.error)return te({result:M,stack:u})}let E=h==null?void 0:h.tournamentId,R=Do().topics.includes($P),N=(R||P)&&ln({drawDefinition:f}),A=N&&((a=gr({matchUpFilters:{matchUpIds:[I]},nextMatchUps:!0,tournamentRecord:h,inContext:!0,drawDefinition:f,matchUpsMap:N}).matchUps)==null?void 0:a[0]);if(R&&A&&r0e({tournamentId:E,inContextMatchUp:A}),Array.isArray(P)&&A&&!((o=A.sides)!=null&&o.every(({participantId:M})=>M)))if(g===Pt)d.processCodes=dt([...d.processCodes??[],...P]);else for(let M of P||[]){let C=M&&((s=d==null?void 0:d.processCodes)==null?void 0:s.lastIndexOf(M));(l=d==null?void 0:d.processCodes)==null||l.splice(C,1)}return Et({eventId:b==null?void 0:b.eventId,context:u,drawDefinition:f,tournamentId:E,matchUp:d}),{...Q}}function n_(t){var e,i,r,n;let{matchUpStatusCodes:a,matchUpStatus:o,structure:s,matchUp:l,dualMatchUp:u,inContextMatchUp:c,autoCalcDisabled:d}=t,p=Ew({matchUpStatus:o})||[Sl,ca].includes(o)&&u||d,m=((e=l==null?void 0:l.sides)==null?void 0:e.map(y=>y.participantId).filter(Boolean).length)||((i=c==null?void 0:c.sides)==null?void 0:i.map(y=>y.participantId).filter(Boolean).length),h="attemptToModifyScore";if(!(Yn({structure:s})&&m===1||o===Pt&&m||oPe({structure:s,matchUp:l,inContextMatchUp:c})||((n=(r=t.appliedPolicies)==null?void 0:r[vo])==null?void 0:n.requireParticipantsForScoring)===!1))return te({result:{error:Kx},stack:h});let f=[Ft].includes(o),g=p?o:t.winningSide&&Ki||Ma,v=el({...t,matchUpStatusCodes:p&&a||[],matchUpStatus:g,context:h,removeScore:f});return te({result:v,stack:h})}function oPe({structure:t,matchUp:e,inContextMatchUp:i}){var r;let{drawPositions:n}=e,{positionAssignments:a}=Mr({structure:t}),o=a==null?void 0:a.filter(l=>(n==null?void 0:n.includes(l.drawPosition))&&l.participantId),s=(r=i==null?void 0:i.sides)==null?void 0:r.every(l=>l.participantId);return(o==null?void 0:o.length)===2||s}function TQ({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>st(r==null?void 0:r.groupValue)&&(r==null?void 0:r.groupNumber)).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>tt(r));return{groupValueGroups:e,groupValueNumbers:i}}function sPe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(y=>y.collectionId===t.collectionId),o=[0,0],s=[0,0],l=a.every(y=>yr.includes(y.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:m,scoreValue:h,setValue:f}=t,g=c&&e.includes(c),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),st(p)?a.forEach(y=>{y.winningSide&&(o[y.winningSide-1]+=p)}):st(f)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(S=>{S.winningSide&&(o[S.winningSide-1]+=f)})}):st(h)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(S=>{let{side1TiebreakScore:w=0,side2TiebreakScore:U=0,side1Score:T=0,side2Score:D=0}=S;(y.matchUpStatus===Ki||y.winningSide||S.winningSide)&&(T||D?(o[0]+=T,o[1]+=D):(w||U)&&S.winningSide&&(o[S.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(y=>{if(y.winningSide){let I=y.collectionPosition,b=lPe({collectionDefinition:t,collectionPosition:I});st(b)&&(o[y.winningSide-1]+=b)}}),st(d)){let y;if(m!=null&&m.aggregateValue)l&&(st(p||f||h)&&o[0]!==o[1]?y=o[0]>o[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(m!=null&&m.valueGoal)y=o.reduce((I,b,S)=>b>=m.valueGoal?S+1:I,0);else{let I=Math.floor(t.matchUpCount/2)+1;y=v.reduce((b,S,w)=>S>=I?w+1:b,0)}y&&(g?i[c].values[y-1]+=d:s[y-1]+=d)}else g?(i[c].values[0]+=o[0]||0,i[c].values[1]+=o[1]||0):s=o;g?(i[c].sideWins[0]+=v[0]||0,i[c].sideWins[1]+=v[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):s.forEach((y,I)=>r[I]+=y||0)}function lPe({collectionDefinition:t,collectionPosition:e}){var i,r;return(r=(i=t.collectionValueProfiles||[])==null?void 0:i.find(n=>n.collectionPosition===e))==null?void 0:r.matchUpValue}function Gw(t){var e,i,r,n,a;let{sideAdjustments:o=[0,0],separator:s="-",drawDefinition:l,matchUpsMap:u,structure:c,matchUp:d,event:p}=t;if(!Array.isArray(o)||o.length!==2||isNaN(o.reduce((D,P)=>D+P)))return{error:le};if(!d)return{error:la};let m=((e=In({matchUp:d,drawDefinition:l,structure:c,event:p}))==null?void 0:e.tieFormat)||(t==null?void 0:t.tieFormat);if(!m)return{error:dv};let h=qn({tieFormat:m});if(h.error)return h;let f=(m==null?void 0:m.collectionDefinitions)||[],g=(d==null?void 0:d.tieMatchUps)??[],v=[0,0],{groupValueGroups:y,groupValueNumbers:I}=TQ(m);for(let D of f)sPe({collectionDefinition:D,groupValueNumbers:I,groupValueGroups:y,sideTieValues:v,tieMatchUps:g});for(let D of I){let P=y[D],{allGroupMatchUpsCompleted:E,matchUpCount:R,winCriteria:N,groupValue:A,sideWins:M,values:C}=P,O;if(N!=null&&N.aggregateValue)E&&C[0]!==C[1]&&(O=C[0]>C[1]?1:2);else if(N!=null&&N.valueGoal)O=C.reduce((k,x,F)=>x>=N.valueGoal?F+1:k,void 0);else{let k=Math.floor(R/2)+1;O=M.reduce((x,F,$)=>F>=k?$+1:x,void 0)}O&&(v[O-1]+=A||0)}let b=v.map((D,P)=>(D||0)+o[P]),S={side1Score:b[0],side2Score:b[1],winningSide:void 0},w=b.join(s),U=b.slice().reverse().join(s),T;if(m!=null&&m.winCriteria){let{valueGoal:D,aggregateValue:P,tallyDirectives:E}=m.winCriteria;if(D?T=(i=b.map((R,N)=>({sideNumber:N+1,points:R})).find(({points:R})=>R>=D))==null?void 0:i.sideNumber:P&&g.every(R=>R.matchUpStatus&&yr.includes(R.matchUpStatus)||R.winningSide)&&b[0]!==b[1]&&(T=b[0]>b[1]?1:2),!T&&E){let R=d.matchUpId,N=d.hasContext?d:((r=u==null?void 0:u.drawMatchUps)==null?void 0:r[R])||l&&((n=Ti({inContext:!0,drawDefinition:l,matchUpId:R}))==null?void 0:n.matchUp);if(N){let{completedTieMatchUps:A,order:M}=Mv({matchUps:[N]});if(A&&M!=null&&M.length){let C=M[0].participantId;T=(a=N.sides.find(({participantId:O})=>O===C))==null?void 0:a.sideNumber}}}}return T&&(S.winningSide=T),{scoreStringSide1:w,scoreStringSide2:U,winningSide:T,set:S}}function Hw({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){var a,o;if(r){t||(t=(a=Ti({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:s}=It({element:e,name:Lu}),l=Me((s==null?void 0:s.value)||{},!1,!0),u=({displaySideNumber:c,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:c});r.sides=(o=t==null?void 0:t.sides)==null?void 0:o.map(c=>{var d;let p=c.participantId,m=p&&l[p]||void 0,{lineUp:h,...f}=((d=r.sides)==null?void 0:d.find(({sideNumber:v})=>v===c.sideNumber))??{},g=h!=null&&h.length?h:m;return{...u(c),...f,lineUp:g}}),Et({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function Yr(t){if(t)return Me(t,!1,!0)}function a_(t){let e=We(t,[{[gn]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:s})=>s),o=n.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...o),i.eventIds.push(...a),i.drawIds.push(...o),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function DQ({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=a_({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&(r==null?void 0:r[n].includes(e))||i&&(r==null?void 0:r[n].includes(i)))}function rc(t){var e,i,r,n;let{exitWhenNoValues:a,drawDefinition:o,matchUpStatus:s,removeScore:l,matchUpsMap:u,matchUpId:c,event:d}=t,p=t.tournamentRecords||t.tournamentRecord&&{[(e=t.tournamentRecord)==null?void 0:e.tournamentId]:t.tournamentRecord}||{},m=t.tournamentId||((i=t.tournamentRecord)==null?void 0:i.tournamentId);p&&DQ({tournamentRecords:p,...t});let h=m&&p[m];if(!h)return{error:ve};let f=Ti({drawDefinition:o,event:d,matchUpId:c});if(f.error)return f;if(!f.matchUp)return{error:fn};let{matchUp:g,structure:v}=f;if(!g.tieMatchUps)return{error:ua};Hw({tournamentId:h==null?void 0:h.tournamentId,eventId:d==null?void 0:d.eventId,dualMatchUp:g,drawDefinition:o});let{extension:y}=It({name:$m,element:g});if(y!=null&&y.value)if(l)Dn({element:g,name:$m});else return{...Q,score:g.score};let I=(r=In({drawDefinition:o,structure:v,matchUp:g,event:d}))==null?void 0:r.tieFormat;g.tieFormat=Yr(I);let b=Gw({drawDefinition:o,matchUpsMap:u,structure:v,matchUp:g,event:d}),{winningSide:S,set:w,scoreStringSide1:U,scoreStringSide2:T}=b,D=(w==null?void 0:w.side1Score)||(w==null?void 0:w.side2Score);if(a&&!g.score&&!D)return{...Q};let P={scoreStringSide1:U,scoreStringSide2:T,sets:w?[w]:[]},E=S&&[1,2].includes(S),R=E&&Ki||SL({matchUpStatus:s??g.matchUpStatus,tieMatchUps:g.tieMatchUps,winningSide:g.winningSide,score:P})&&ms||Qi,N=!!(g.winningSide&&!E),A=g.tieMatchUps.find(({score:C,winningSide:O,matchUpStatus:k})=>{var x;return((x=C==null?void 0:C.sets)==null?void 0:x.length)&&(C.sets[0].side1Score||C.sets[0].side2Score)||k&&yr.includes(k)||O}),M;if(g.tieFormat&&!E&&!A){let C=(n=In({drawDefinition:o,structure:v,event:d}))==null?void 0:n.tieFormat;C&&JSON.stringify(I)===JSON.stringify(C)&&(g.tieFormatId=void 0,g.tieFormat=void 0,M=!0)}return el({appliedPolicies:t.appliedPolicies,matchUpStatus:R,score:P,removeWinningSide:N,tournamentRecord:h,drawDefinition:o,removeScore:l,winningSide:S,matchUpId:c,matchUp:g,event:d}),{...Q,score:P,removeWinningSide:N,tieFormatRemoved:M,winningSide:S}}function uPe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){var m,h,f,g,v;let y="directWinner";if(o){let I=u.drawPositions||[],b=I[t],S=o.source.structureId,w=rt({structureId:S,drawDefinition:l});if(w.error)return w;let{structure:U}=w,{positionAssignments:T}=Mr({structureId:S,drawDefinition:l}),D=(m=T==null?void 0:T.find(M=>M.drawPosition===n))==null?void 0:m.participantId,P=o.target.structureId,{positionAssignments:E}=Mr({structureId:P,drawDefinition:l}),R=(h=E==null?void 0:E.find(M=>M.participantId===D))==null?void 0:h.drawPosition,N=E==null?void 0:E.filter(M=>{let C=I.includes(M.drawPosition),O=!M.participantId&&!M.bye&&!M.qualifier;return C&&O}).map(M=>M.drawPosition),A=N==null?void 0:N.includes(b);if(D&&o.target.roundNumber===1&&A)ml({drawPosition:b,participantId:D,structureId:P,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(D&&N!=null&&N.length){let M=N.pop();M&&ml({participantId:D,structureId:P,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:M,matchUpsMap:d,event:p})}else if(R){let M=gg({drawPosition:R,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(M.error)return te({result:M,stack:y})}else if((U==null?void 0:U.stage)!==Je){let M="winner target position unavaiallble";return console.log(M),{error:M}}if(U!=null&&U.seedAssignments&&U.structureId!==P){let M=U.seedAssignments.find(({participantId:O})=>O===D),C=M==null?void 0:M.participantId;M&&C&&Rv({eventId:u==null?void 0:u.eventId,structureId:P,...M,tournamentRecord:a,drawDefinition:l,participantId:C})}}else{let I=gg({matchUpId:u.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(I.error)return I}if(c&&i){let I=(f=c.sides)==null?void 0:f.find(b=>b.sideNumber===i);if(I!=null&&I.lineUp){let b=c.roundPosition,S=u.roundPosition,w=b===S&&b!==1||Math.floor(b/2)===S?2:1,U=(g=d==null?void 0:d.drawMatchUps)==null?void 0:g.find(({matchUpId:P})=>P===u.matchUpId),T=[1,2].map(P=>{var E;return{...((E=U.sides)==null?void 0:E.find(R=>R.sideNumber===P))||{},sideNumber:P}});U.sides=T;let D=U.sides.find(P=>P.sideNumber===w);if(D){let P=(v=I.lineUp)==null?void 0:v.filter(E=>E==null?void 0:E.participantId);D.lineUp=$L({lineUp:P}),Et({tournamentId:a==null?void 0:a.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:U,context:y,drawDefinition:l})}}}return{...Q}}function cPe(t){var e,i,r;let{loserMatchUpDrawPositionIndex:n,inContextDrawMatchUps:a,projectedWinningSide:o,sourceMatchUpStatus:s,loserDrawPosition:l,tournamentRecord:u,loserTargetLink:c,drawDefinition:d,loserMatchUp:p,dualMatchUp:m,matchUpsMap:h,event:f}=t,g="directLoser",v=c.linkCondition,y=p.drawPositions||[],I=v===dl&&p.roundNumber===2&&Math.min(...y.filter(Boolean)),b=I||y[n],S=I||y[1-n],w=c.source.structureId,{structure:U}=rt({structureId:w,drawDefinition:d}),{matchUps:T}=qt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:d,structure:U,event:f}),D=T.filter(L=>{var B;return(B=L.drawPositions)==null?void 0:B.includes(l)}).filter(L=>{let B=L.sides.find(G=>G.drawPosition===l),V=L.matchUpStatus===Ft||L.matchUpStatus===Pt&&!br(L);return(B==null?void 0:B.sideNumber)===L.winningSide&&!V}),P=v===dl&&D.length===0,{positionAssignments:E}=Mr({structureId:w,drawDefinition:d}),R=(e=E==null?void 0:E.find(L=>L.drawPosition===l))==null?void 0:e.participantId,N=c.target.structureId,{positionAssignments:A}=Mr({structureId:N,drawDefinition:d}),M=A==null?void 0:A.filter(({drawPosition:L})=>y.includes(L));if(M!=null&&M.some(L=>L.participantId===R))return{...Q};let C=M==null?void 0:M.filter(L=>{let B=y.includes(L.drawPosition),V=!L.participantId&&!L.bye&&!L.qualifier;return B&&V}).map(L=>L.drawPosition),O=C==null?void 0:C.includes(b),k=c.target.roundNumber>1&&(C==null?void 0:C.length),x=c.target.roundNumber===1&&O;if(I){let L=F();if(L.error)return te({result:L,stack:g})}else if(x){let L=_();if(L.error)return te({result:L,stack:g})}else if(R&&k){C.sort(ur);let L=C[0],B=ml({participantId:R,structureId:N,drawPosition:L,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:u,drawDefinition:d,matchUpsMap:h,event:f});if(B.error)return te({result:B,stack:g})}else return te({context:{loserDrawPosition:l,loserTargetLink:c,targetDrawPositionIsUnfilled:O},result:{error:O?lv:Ywe},stack:g});if(U!=null&&U.seedAssignments&&U.structureId!==N){let L=U.seedAssignments.find(({participantId:V})=>V===R),B=L==null?void 0:L.participantId;L&&B&&Rv({eventId:p==null?void 0:p.eventId,structureId:N,...L,tournamentRecord:u,drawDefinition:d,participantId:B})}if(m&&o){let L=(i=m.sides)==null?void 0:i.find(B=>B.sideNumber===3-o);if(L!=null&&L.lineUp){let{roundNumber:B,eventId:V}=p,{roundPosition:G}=m,j=B===1?2-G%2:1,z=(r=h==null?void 0:h.drawMatchUps)==null?void 0:r.find(({matchUpId:Y})=>Y===p.matchUpId),W=[1,2].map(Y=>{var re;return{...((re=z.sides)==null?void 0:re.find(J=>J.sideNumber===Y))||{},sideNumber:Y}});z.sides=W;let q=z.sides.find(Y=>Y.sideNumber===j);q&&(q.lineUp=$L({lineUp:L.lineUp}),Et({tournamentId:u==null?void 0:u.tournamentId,matchUp:z,context:g,drawDefinition:d,eventId:V}))}}return{...Q};function F(){let L="loserLinkFedFMLC";return te(P?{result:_(),stack:L}:{result:$(),stack:L})}function $(){let L=eo({drawPosition:S,structureId:N,tournamentRecord:u,drawDefinition:d,event:f});return te({result:L,stack:"assignLoserPositionBye"})}function _(){let L=R?ml({drawPosition:b,participantId:R,structureId:N,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:u,drawDefinition:d,matchUpsMap:h,event:f}):{error:fr};return te({result:L,stack:"assignLoserDrawPosition"})}}function PQ(t){var e;let i="directParticipants",r=n_(t);if(r.error)return te({result:r,stack:i});let n=Ew({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:a,projectedWinningSide:o,inContextDrawMatchUps:s,tournamentRecord:l,drawDefinition:u,matchUpStatus:c,dualMatchUp:d,matchUpsMap:p,winningSide:m,targetData:h,matchUpId:f,structure:g,matchUp:v,event:y}=t,I=!!v.collectionId,b=Yn({structure:g}),S=v.drawPositions,w;if(I){let{matchUpTieId:U,matchUpsMap:T}=t,D=rc({appliedPolicies:t.appliedPolicies,matchUpId:U,tournamentRecord:l,drawDefinition:u,matchUpsMap:T,event:y});if(w=D&&{tieMatchUpResult:D},S=(e=s.find(({matchUpId:P})=>P===U))==null?void 0:e.drawPositions,!a)return te({result:{...Q,...w},stack:i})}if(b)return te({result:{...Q,...w},stack:i});if(S){let U=o?o-1:m-1,T=1-U,D=S[U],P=S[T],{targetLinks:{loserTargetLink:E,winnerTargetLink:R,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:A,loserMatchUpDrawPositionIndex:M,winnerMatchUp:C,loserMatchUp:O,byeMatchUp:k}}=h;if(C){let x=uPe({sourceMatchUpStatus:n&&c||Ki,winnerMatchUpDrawPositionIndex:A,sourceMatchUpId:f,inContextDrawMatchUps:s,projectedWinningSide:o,winningDrawPosition:D,tournamentRecord:l,winnerTargetLink:R,drawDefinition:u,winnerMatchUp:C,dualMatchUp:d,matchUpsMap:p,event:y});if(x.error)return te({result:x,stack:i})}if(O){let x=cPe({sourceMatchUpStatus:n&&c||Ki,loserMatchUpDrawPositionIndex:M,sourceMatchUpId:f,inContextDrawMatchUps:s,projectedWinningSide:o,loserDrawPosition:P,tournamentRecord:l,loserTargetLink:E,drawDefinition:u,loserMatchUp:O,winningSide:m,matchUpsMap:p,dualMatchUp:d,event:y});if(x.error)return te({result:x,stack:i})}if(k){let x=k.drawPositions||[],F=Math.min(...x.filter(Boolean)),$=N.target.structureId,_=eo({drawPosition:F,structureId:$,tournamentRecord:l,drawDefinition:u,event:y});if(_.error)return te({result:_,stack:i})}}else return te({result:{error:Xb},stack:i});return te({result:{...Q,...w},stack:i})}function o_(t){var e,i,r,n;let a="genPlayoffStructure";if(!t.drawDefinition)return te({result:{error:_e},stack:a});let o=$w(t);if(o.error)return te({result:o,stack:a});let{structureId:s,addNameBaseToAttributeName:l,playoffStructureNameBase:u,finishingPositionNaming:c,finishingPositionLimit:d,playoffAttributes:p,playoffPositions:m,roundOffsetLimit:h,tournamentRecord:f,exitProfileLimit:g,roundProfiles:v,roundNumbers:y,idPrefix:I,isMock:b,event:S,uuids:w}=t,U=Me(t.drawDefinition,!1,!0),{structure:T}=rt({structureId:s,drawDefinition:U});if(!T)return te({result:{error:Ni},stack:a});if(T.structureType===_n||T.structures)return GDe({sourceStructureId:T.structureId,...t,...o,drawDefinition:U});let{playoffRoundsRanges:D,playoffRounds:P}=o,{playoffPositionsReturned:E,error:R,playoffSourceRounds:N,playoffRoundsRanges:A}=lQ(t);if(R)return te({result:{error:R},stack:a});let M=(v==null?void 0:v.length)&&Object.assign({},...v),C=y||typeof v=="object"&&v.map(Y=>Object.keys(Y)).flat(),O=Array.isArray(C)&&C.map(Y=>!isNaN(Y)&&tt(Y)).filter(Boolean);if(O){if(!Array.isArray(O))return te({result:{error:le},context:{validRoundNumbers:O},stack:a});O.forEach(Y=>{if(!(P!=null&&P.includes(Y)))return te({result:{error:le},context:{roundNumber:Y},stack:a})})}m&&m.forEach(Y=>{if(!(E!=null&&E.includes(Y)))return te({result:{error:le},context:{playoffPosition:Y},stack:a})});let k=O||N,x=O?D:A,F=[],$=[];for(let Y of k??[]){let re=x==null?void 0:x.find(ne=>ne.roundNumber===Y);if(!re)return te({result:{error:le},context:{roundNumber:Y},stack:a});let J=re.finishingPositions.length,H=Math.min(...re.finishingPositions)-1,Z=2,K=Y&&(M==null?void 0:M[Y])&&Z+M[Y]-1,ie=Tf({exitProfile:`0-${Y}`,addNameBaseToAttributeName:l,playoffStructureNameBase:u,finishingPositionOffset:H,playoffAttributes:p,exitProfileLimit:g,stage:Bi,roundOffset:0,drawDefinition:U,sequenceLimit:K,stageSequence:Z,drawSize:J,idPrefix:I,isMock:b,uuids:w,finishingPositionNaming:c,finishingPositionLimit:d,roundOffsetLimit:h});if(ie.error)return te({result:ie,stack:a});let{structures:ae,links:oe}=ie;if(ae!=null&&ae.length&&F.push(...ae),oe!=null&&oe.length&&$.push(...oe),ie.structureId&&Y){let ne={linkType:Kl,source:{structureId:s,roundNumber:Y},target:{structureId:ie.structureId,feedProfile:Bo,roundNumber:1}};$.push(ne)}}if(!F.length)return te({result:{error:le},info:"No structures generated",stack:a});U.structures.push(...F),U.links.push(...$);let{matchUps:_,matchUpsMap:L}=gr({inContext:!0,drawDefinition:U}),B=F.map(({structureId:Y})=>Y),V=_==null?void 0:_.filter(({structureId:Y})=>B.includes(Y)).map(Pr),G=(e=L==null?void 0:L.drawMatchUps)==null?void 0:e.filter(({matchUpId:Y})=>V==null?void 0:V.includes(Y));if(G!=null&&G.length){let Y=(i=In({drawDefinition:U,event:S}))==null?void 0:i.tieFormat;Y&&G.forEach(re=>{let{tieMatchUps:J}=Bw({matchUp:re,tieFormat:Y,isMock:b});Object.assign(re,{tieMatchUps:J,matchUpType:gi})})}(r=_==null?void 0:_.filter(Y=>Cd({matchUp:Y})&&Y.structureId===s))==null||r.forEach(Y=>{let{matchUpId:re,score:J,winningSide:H}=Y,Z=On({inContextDrawMatchUps:_,drawDefinition:U,matchUpId:re}),K=PQ({inContextDrawMatchUps:_,tournamentRecord:f,drawDefinition:U,matchUpsMap:L,winningSide:H,targetData:Z,matchUpId:re,structure:T,matchUp:Y,score:J,event:S});K.error&&console.log(K.error)}),(n=_==null?void 0:_.filter(Y=>Y.matchUpStatus===jt&&Y.structureId===s))==null||n.forEach(Y=>{let{matchUpId:re}=Y,J=On({inContextDrawMatchUps:_,drawDefinition:U,matchUpId:re}),{targetLinks:{loserTargetLink:H},targetMatchUps:{loserMatchUpDrawPositionIndex:Z,loserMatchUp:K}}=J;if(H&&K){let ie=H.target.structureId,ae=K.drawPositions[Z],oe=eo({drawPosition:ae,structureId:ie,tournamentRecord:f,drawDefinition:U,event:S});oe.error&&console.log(oe.error)}});let j=[],z=tp({inContextDrawMatchUps:_,drawDefinition:U,matchUpsMap:L}).goesToMap,{structure:W}=rt({drawDefinition:t.drawDefinition,structureId:s}),{matchUps:q}=qt({structure:W});return q.forEach(Y=>{var re,J;let H=z==null?void 0:z.loserMatchUpIds[Y.matchUpId];if(H&&Y.loserMatchUpId!==H){Y.loserMatchUpId=H;let K={tournamentId:f==null?void 0:f.tournamentId,eventId:(re=t.event)==null?void 0:re.eventId,context:a,matchUp:Y};j.push(K)}let Z=z==null?void 0:z.winnerMatchUpIds[Y.matchUpId];if(Z&&Y.winnerMatchUpId!==Z){Y.winnerMatchUpId=Z;let K={tournamentId:f==null?void 0:f.tournamentId,eventId:(J=t.event)==null?void 0:J.eventId,context:a,matchUp:Y};j.push(K)}}),{structures:F,matchUpModifications:j,links:$,drawDefinition:U,...Q}}function RQ({element:t}){if(!t)return{error:le};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:le};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function Tl(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:lF};let a=LJ(t);if(a.error)return a;if(!(At(n)&&Pi(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:sF};if(!a.timeItems)a.timeItems=[];else if(dPe({element:a,duplicateValues:e,timeItem:n}))return{...Q};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let o=new Date().toISOString();Object.assign(n,{createdAt:o})}return r&&(a.timeItems=a.timeItems.filter(({itemType:o})=>n.itemType!==o)),r&&!n.itemValue||a.timeItems.push(n),{...Q}}function dPe({element:t,duplicateValues:e,timeItem:i}){var r;let{itemType:n,itemSubTypes:a,itemValue:o}=i,s=n&&((r=Ro({itemSubTypes:a,itemType:n,element:t}))==null?void 0:r.timeItem);return s&&JSON.stringify(s==null?void 0:s.itemValue)===JSON.stringify(o)&&!e}function s_({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:ve};if(!n)return{error:fr};let o=ad({tournamentRecord:i,participantId:n});return o.error?o:Tl({element:o.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function zw(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:ve};let o=Tl({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(o.error)return o;let s=RQ({element:i});return ut({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:s},topic:Rp}),o}function Gh(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?Tl({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:fo}}function EQ(t){return uR({...t,itemType:"attachConsolationStructures"})}function l_(t){return uR({...t,itemType:"attachPlayoffStructures"})}function uR({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:o}){var s,l,u;let c="attachStructures";if(!r)return{error:_e};if(!Array.isArray(n)||!Array.isArray(a))return te({result:{error:le},stack:c});let d=I=>{var b;return[I.source.structureId,I.source.roundNumber||((b=I.source.finishingPositions)==null?void 0:b.join("|")),I.target.roundNumber].join("|")},p=(s=r.links)==null?void 0:s.map(d);if(a.some(I=>{let b=d(I);return p==null?void 0:p.includes(b)}))return te({result:{error:mF},info:"playoff structure exists",stack:c});a.length&&((l=r.links)==null||l.push(...a));let m=n.map(({structureId:I})=>I),h=(u=r.structures)==null?void 0:u.map(({structureId:I})=>I);r.structures=(r.structures??[]).map(I=>m.includes(I.structureId)?n.find(({structureId:b})=>b===I.structureId):I);let f=n==null?void 0:n.filter(({structureId:I})=>!(h!=null&&h.includes(I)));f.length&&r.structures.push(...f),tp({drawDefinition:r});let g=n.map(I=>{var b;return((b=qt({structure:I}))==null?void 0:b.matchUps)||[]}).flat();Fc({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUps:g});let v=n.map(({structureId:I})=>I);if(ui({drawDefinition:r,structureIds:v}),e==null?void 0:e.length){let I={};e.forEach(S=>{var w;let U=(w=S.matchUp)==null?void 0:w.matchUpId;U&&(I[U]=S)});let b=S=>{S.matchUps.forEach(w=>{if(I[w.matchUpId]){let{tieMatchUps:U,...T}=I[w.matchUpId].matchUp;if(Object.assign(w,T),U==null?void 0:U.length){let D={};U.forEach(P=>I[P.matchUpId]=P),w.tieMatchUps.forEach(P=>Object.assign(P,D[P.matchUpId]))}I[w.matchUpId].matchUp=w,Et(I[w.matchUpId])}})};r.structures.forEach(S=>{if(h!=null&&h.includes(S.structureId))if(S.structures)for(let w of S.structures)b(w);else b(S)})}let y=f.map(Na("structureId"));if(i){let I={itemValue:{structureIds:v,drawId:r.drawId},itemType:t};Tl({element:i,timeItem:I})}return{...Q,addedStructureIds:y}}function cR(t){var e,i;let{structures:r,links:n,matchUpModifications:a,error:o}=o_(t);if(o)return{error:o};let s=t.drawDefinition;return l_({tournamentId:(e=t.tournamentRecord)==null?void 0:e.tournamentId,eventId:((i=t.event)==null?void 0:i.eventId)||t.eventId,matchUpModifications:a,drawDefinition:s,structures:r,links:n})}function rp(t){let e=We(t,[{_anyOf:{[gn]:!1,[Ur]:!1,[$n]:!1,[td]:!1},[NF]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=$2(t,r);if(n.error)return n;i.push(...(n==null?void 0:n.applied)??[]),t.drawDefinition&&ui({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ve};for(let a of n){let o=t.tournamentRecords[a],s=$2(t,o);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:ve};return i.length?{...Q,applied:i}:{error:eF}}function $2(t,e){let i=Bt(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:aP};for(let a of n)if(!i[a]||t.allowReplacement){let o=t.policyDefinitions[a];if(!o)continue;if(!At(o))return{error:le};let{policyName:s,...l}=o;if(!l||!Object.keys(l).length||s&&!Pi(s))return{error:le};i[a]=t.policyDefinitions[a],r.push(a)}return r!=null&&r.length?{..._t({element:e,extension:{name:dy,value:i}}),applied:r}:{applied:r,error:eF}}function u_({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){var o;if(!r||typeof r!="string")return te({result:{error:le},context:{drawName:r}});i||(i=Hi({event:a}).flightProfile);let s=(o=i==null?void 0:i.flights)==null?void 0:o.find(l=>l.drawId===n);if(s){s.drawName=r;let l={name:os,value:{...i,flights:i.flights}};rd({event:a,extension:l})}return e&&(e.drawName=r,ui({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!s&&!e?{error:_e}:{...Q,flight:s}}function CQ({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){var a;if(!At(i))return{error:le};let o=Hi({event:n}).flightProfile,s=i.drawName&&u_({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:o,drawId:r,event:n});if(s!=null&&s.error)return s==null?void 0:s.error;let l=(s==null?void 0:s.flight)||((a=o==null?void 0:o.flights)==null?void 0:a.find(u=>u.drawId===r));if(!l&&!e)return{error:_e};if(l){let u={name:os,value:{...o,flights:o.flights}};rd({event:n,extension:u})}return e&&(i.policyDefinitions&&rp({policyDefinitions:i.policyDefinitions,drawDefinition:e}),ui({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...Q}}function MQ({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var r,n;if(!i)return{error:_e};let a=ln({drawDefinition:i}),o=l=>{var u;return(u=a==null?void 0:a.drawMatchUps)==null?void 0:u.find(c=>c.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:u,stage:c,stageSequence:d}=l;u&&(d!==1||![Je,Ne].includes(c))&&(l.positionAssignments=u.map(h=>(delete h.participantId,h)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:m}=qt({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:a,structure:l});for(let h of p){let{matchUpId:f,roundNumber:g}=h,v=h.sides||[],y=o(f);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==jt&&Object.assign(y,lR),g&&g>1&&((r=y.drawPositions)==null?void 0:r.length)&&!m){let I=v==null?void 0:v.map(({drawPosition:S,participantFed:w})=>!w&&S).filter(Boolean),b=y.drawPositions.map(S=>I.includes(S)?void 0:S);y.drawPositions=b}e?delete y.timeItems:(n=y.timeItems)!=null&&n.length&&(y.timeItems=y.timeItems.filter(I=>I.itemType&&![Zl,_c,Ah,yL,Oh,kh].includes(I.itemType))),Et({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}i.extensions=i.extensions.filter(l=>l.name!==Sf);let s=(i.structures||[]).map(({structureId:l})=>l);return ui({drawDefinition:i,structureIds:s}),{...Q}}function Ww({tournamentRecord:t}){var e;if(!t)return{error:ve};let i={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},r={};return((e=t.events)==null?void 0:e.map(n=>{let a=n.eventId;return r[a]=n,((n==null?void 0:n.drawDefinitions)||[]).map(o=>({drawDefinition:o,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:n,eventId:a})=>{let o=0,s=0,l=0,{allStructuresLinked:u}=nR({drawDefinition:n}),c=r[a],d=((n==null?void 0:n.structures)||[]).map(b=>{let{stage:S,stageSequence:w,structureId:U}=b,T=Lm[S],{inContextStructureMatchUps:D}=Cw({drawDefinition:n,structure:b,event:c}),P=D==null?void 0:D.filter(({winningSide:L})=>L),E=P.filter(Boolean).length||0;s+=E,l+=D.length-s;let R=Math.max(P.filter(({roundNumber:L})=>L===1).map(({roundPosition:L})=>L)),{positionAssignments:N}=si({structure:b}),A=N==null?void 0:N.filter(({participantId:L})=>L);o+=(A==null?void 0:A.length)??0;let M=((N==null?void 0:N.length)??0)-((A==null?void 0:A.length)??0),{roundMatchUps:C,roundProfile:O,roundNumbers:k,maxMatchUpsCount:x}=An({matchUps:D}),F=O&&Object.keys(O).filter(L=>!O[L].inactiveRound).map(L=>parseInt(L)),$=O&&Object.keys(O).filter(L=>O[L].inactiveRound).map(L=>parseInt(L)),_=O&&Object.values(O).every(L=>L.inactiveRound);return{positionsAssignedCount:(A==null?void 0:A.length)??0,maxWinningSideFirstRoundPosition:R,unassignedPositionsCount:M,inactiveStructure:_,maxMatchUpsCount:x,inactiveRounds:$,roundMatchUps:C,activeRounds:F,roundNumbers:k,roundProfile:O,structureId:U,stageSequence:w,orderNumber:T,stage:S}}),p=d.find(b=>b.orderNumber===2&&b.stageSequence===1),m=d.filter(({inactiveStructure:b})=>!b).length,{links:h}=Sv({structureId:p.structureId,drawDefinition:n}),f=tt(p.activeRounds[0])===1&&p.activeRounds.length===1&&m===1,g=d==null?void 0:d.every(({inactiveStructure:b})=>b),v=!h.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=n.drawId;o&&!s&&i.positionsNoOutcomes.push(y),g&&i.inactive.push(y),f&&i.matchPlay.push(y),v&&i.canBePruned.push(y);let I={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:o,allStructuresLinked:u,structuresData:d,inactiveDraw:g,isMatchPlay:f,drawId:y};i.drawAnalysis[y]=I}),{...Q,drawsAnalysis:i}}function NQ({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){var n;if(!e)return{error:ve};if(!i)return{error:_e};let a=[],{drawsAnalysis:o}=Ww({tournamentRecord:e});if(o.canBePruned.includes(r)){let s=o.matchPlay.includes(r),l=o.drawAnalysis[r],{structures:[u]}=ss({stageSequence:1,drawDefinition:i,stage:Ne}),c=l.structuresData.find(({structureId:h})=>u.structureId===h),d=(u.matchUps??[]).sort((h,f)=>h.roundPosition-f.roundPosition);a=d.filter(({roundNumber:h})=>!c.inactiveRounds.includes(h));let p=a.map(Pr),m=d.map(Pr).filter(h=>!p.includes(h));if(s){let h=a.filter(({roundNumber:I})=>!c.inactiveRounds.includes(I)).filter(({winningSide:I})=>I),f=h.map(Pr),g=p.filter(I=>!f.includes(I));m.push(...g);let v=h.flatMap(I=>I.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((I,b)=>({[I]:b+1})));if(h.forEach(I=>{t?I.drawPositions=I.drawPositions.map(b=>y[b]):delete I.drawPositions}),t){let I=(n=u==null?void 0:u.positionAssignments)==null?void 0:n.filter(b=>v.includes(b.drawPosition)).map(b=>(b.drawPosition=y[b.drawPosition],b));u.positionAssignments=I}else u.positionAssignments=[];u.matchUps=h,a=h}ec({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:m,drawDefinition:i}),ui({drawDefinition:i})}return{...Q,matchUps:a}}function AQ({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:o,bye:s}){if(!e)return{error:_e};if(!r)return{error:uv};if(!n)return{error:Xa};if(s){let l=eo({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:o});if(l.error)return l}else{if(a)return{error:hP};{let l=ml({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,event:o});if(l.error)return l}}return{...Q}}function OQ(t){var e,i,r,n,a;let o=t.matchUpIds??[],{drawDefinition:s}=t,l=t.structureId??((i=(e=s==null?void 0:s.structures)==null?void 0:e.find(m=>{var h;return(h=m.matchUps)==null?void 0:h.some(({matchUpId:f})=>o.includes(f))}))==null?void 0:i.structureId)??((n=(r=s==null?void 0:s.structures)==null?void 0:r[0])==null?void 0:n.structureId);if(!l)return{error:Ni};let u=(a=s.structures)==null?void 0:a.find(m=>m.structureId===l);if(!u)return{error:Ni};let c=u==null?void 0:u.matchUps,d=c==null?void 0:c.find(m=>!!m.roundPosition);if(u.structures||d||u.finishingPosition===Eh)return{error:Sp};let p=c.filter(({roundNumber:m})=>{var h;return(h=t.roundNumbers)==null?void 0:h.includes(m)}).map(Pr);return o=o.filter(m=>!p.includes(m)),t.roundNumbers&&!o.length&&(o=p),{existingMatchUps:c,matchUpIds:o,structureId:l,structure:u}}function kQ(t){let e=We(t,[{[$n]:!0},{[ug]:{[uw]:!1,roundNumbers:!1},[za]:le,[Xn]:dn}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:o,event:s}=t,l=OQ(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,m=[],h=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:I})=>{if(I&&!n)return!1;if(I||br({score:y})){if(!I&&!i)return!1;m.push(v)}else if(!r)return!1;return p==null?void 0:p.includes(v)}))??[],f=h.map(Pr),g=h.map(({tieMatchUps:v})=>v==null?void 0:v.map(Pr)).filter(Boolean).flat();if(f.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:I})=>!f.includes(I)),ec({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...f],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:o});let v=dt(u.matchUps.map(Na("roundNumber"))),y=Vwe(v);if(y.length){y.reverse();for(let I of y)u.matchUps.forEach(b=>{b.roundNumber&&b.roundNumber>I&&(b.roundNumber-=1,Et({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:b}))})}if(m.length){u.positionAssignments=dt(u.matchUps.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U}));let I=(u==null?void 0:u.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(s==null?void 0:s.matchUpFormat),b=l.existingMatchUps.some(U=>U.matchUpType===Va)?{matchUpTypes:[Va]}:void 0,{matchUps:S}=qt({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:b,structure:u,event:s});Yn({structure:u})&&(u.positionAssignments=dt(S.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U})));let w=i_({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:I,matchUps:S,event:s});w.error&&console.log(w)}ui({structureIds:[c],eventId:s==null?void 0:s.eventId,drawDefinition:o})}return!f.length&&p.length?{error:gP}:{...Q,deletedMatchUpsCount:[...f,...g].length}}function xQ({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:ve};if(!i)return{error:_e};if(!n)return te({result:{error:Qe},info:"roundNumber required"});let o=rt({drawDefinition:i,structureId:r});if(o.error)return o;let s=o.structure;return s!=null&&s.structures?{error:Sp}:Yn({structure:s})?pPe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:s}):(console.log("not implemented"),{...Q})}function pPe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let o=(n==null?void 0:n.matchUps)??[],s=[],l=[],u=!1;if(o.reduce((c,d)=>{let p=d==null?void 0:d.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(ur).includes(r)){let c=o.filter(d=>{let p=d.roundNumber===r&&(!yr.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map(Pr))),!p});l.length&&(ec({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===r)||(c.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Et({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),n.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...Q}}function dR(t){var e,i,r,n,a,o;let{suppressNotifications:s,tournamentRecord:l,drawDefinition:u,matchUps:c,event:d}=t;if(typeof u!="object")return{error:_e};let p=t==null?void 0:t.structureId;if(!p&&((e=u.structures)==null?void 0:e.length)===1&&(p=(r=(i=u.structures)==null?void 0:i[0])==null?void 0:r.structureId),typeof p!="string")return{error:Xa};if(!Co(c))return{error:le,info:ip("matchUps")};let m=(n=u.structures)==null?void 0:n.find(y=>y.structureId===p);if(!m)return{error:Ni};let h=(m==null?void 0:m.matchUps).find(y=>!!y.roundPosition);if(m.structures||h||m.finishingPosition===Eh)return{error:Sp};let f=((o=(a=Hr({tournamentRecord:l,inContext:!1}))==null?void 0:a.matchUps)==null?void 0:o.map(Pr))??[],g=c.map(Pr);if(Nn(f,g))return{error:B9,info:"One or more matchUpIds already present in tournamentRecord"};m.matchUps.push(...c);let v=c.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return s||(Fc({tournamentId:l==null?void 0:l.tournamentId,matchUps:[...v,...c],eventId:d==null?void 0:d.eventId,drawDefinition:u}),ui({drawDefinition:u,structureIds:[p]})),{...Q}}function FQ({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){var o;if(!e)return{error:_e};if(!r)return{error:Xa};if(!i)return{error:uv};let{structure:s}=rt({drawDefinition:e,structureId:r});if(!s)return{error:Ni};let l=s;s.structures&&s.structureType===_n&&(l=(o=s.structures)==null?void 0:o.find(h=>{var f;return(f=h.positionAssignments)==null?void 0:f.find(g=>g.drawPosition===i)}));let u=l==null?void 0:l.positionAssignments,c=u==null?void 0:u.find(h=>h.drawPosition===i);c&&_t({element:c,extension:{name:pg,value:n}});let d=((a==null?void 0:a.eventType)===gi||e.matchUpType===gi||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(s==null?void 0:s.tieFormat)))&&{matchUpTypes:[gi]},{matchUps:p}=qt({structure:l,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:d,event:a}),m=(s==null?void 0:s.matchUpFormat)??e.matchUpFormat;return i_({positionAssignments:u,tournamentRecord:t,drawDefinition:e,matchUpFormat:m,matchUps:p,event:a}),ui({drawDefinition:e,structureIds:[r]}),{...Q}}var LQ={};wt(LQ,{addGoesTo:()=>tp,allPlayoffPositionsFilled:()=>GL,checkValidEntries:()=>hR,findDrawDefinition:()=>m_,getAssignedParticipantIds:()=>kp,getAvailableMatchUpsCount:()=>pR,getAvailablePlayoffProfiles:()=>$w,getDrawDefinitionTimeItem:()=>cL,getDrawParticipantRepresentativeIds:()=>d_,getDrawStructures:()=>ss,getDrawTypeCoercion:()=>qw,getEligibleVoluntaryConsolationParticipants:()=>c_,getMatchUpsMap:()=>ln,getParticipantIdFinishingPositions:()=>p_,getPositionAssignments:()=>Iy,getPositionsPlayedOff:()=>Cv,getSeedingThresholds:()=>LL,getSeedsCount:()=>Yw,getStructureSeedAssignments:()=>Io,getTeamLineUp:()=>ep,getValidGroupSizes:()=>xw,isAdHoc:()=>Yn,isCompletedStructure:()=>$c,isValidForQualifying:()=>g_,positionActions:()=>f_});function c_({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:m}){var h,f,g,v,y;if(!s)return{error:_e};let I=[Ne,Bi];i&&I.push(Je);let b=m!=null&&m.eventType?{matchUpTypes:[m.eventType]}:void 0,S=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,w=e&&m?((h=ou({contextFilters:{stages:I},matchUpFilters:b,tournamentRecord:o,inContext:!0,event:m}))==null?void 0:h.matchUps)??[]:((f=Pn({contextFilters:{stages:I},matchUpFilters:S,tournamentRecord:o,inContext:!0,drawDefinition:s}))==null?void 0:f.matchUps)??[],U=Nh({stage:Lr,drawDefinition:s}).map(({participantId:_})=>_),T={},D={},P={},E={};n||(n=tc({policyTypes:[gM],tournamentRecord:o,drawDefinition:s,event:m}).policyDefinitions);let R=n==null?void 0:n[gM];t=t.length&&t||(R==null?void 0:R.excludedMatchUpStatuses)||[],e=e??(R==null?void 0:R.includeEventParticipants),d=d??(R==null?void 0:R.allEntries),r=r??(R==null?void 0:R.finishingRoundLimit),a=a??(R==null?void 0:R.roundNumberLimit),l=l??(R==null?void 0:R.matchUpsLimit),u===void 0&&(u=(R==null?void 0:R.requirePlay)!==void 0?R.requirePlay:!0),c===void 0&&(c=(R==null?void 0:R.requireLoss)!==void 0?R.requireLoss:!0),p=p??(R==null?void 0:R.winsLimit);for(let _ of w){if(u&&_.winningSide&&![1,2].includes(_.winningSide)&&_.matchUpStatus!==ir||_.finishingRound&&r&&_.finishingRound>=r||_.finishingRound&&a&&_.finishingRound<=a)continue;let L=(g=_.sides)==null?void 0:g.find(({sideNumber:V})=>_.winningSide&&V===3-_.winningSide),B=(v=_.sides)==null?void 0:v.find(({sideNumber:V})=>_.winningSide&&V===_.winningSide);if((y=_.sides)==null||y.forEach(V=>{var G;let j=(G=V==null?void 0:V.participant)==null?void 0:G.participantId;j&&(P[j]=V.participant,_.matchUpStatus===ir&&!u&&(D[j]=V.participant,T[j]||(T[j]=0),(!_.matchUpStatus||!t.includes(_.matchUpStatus))&&(T[j]+=1)))}),L==null?void 0:L.participant){let V=L.participant.participantId;D[V]=L.participant,T[V]||(T[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(T[V]+=1)}if(B!=null&&B.participant){let V=B.participant.participantId;E[V]||(E[V]=0),E[V]+=1,T[V]||(T[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(T[V]+=1)}}let N=(o==null?void 0:o.participants)&&!u&&!c&&d,A=N?((e&&m?m.entries:s.entries)??[]).filter(_=>![Ql,Eo].includes(_.entryStatus)).map(({participantId:_})=>_):[],M=Object.keys(D),C=N?((o==null?void 0:o.participants)??[]).filter(({participantId:_})=>A.includes(_)):c&&Object.values(D)||Object.values(P),O=_=>!c||M.includes(_),k=_=>!u||(T[_]||0)>=0,x=_=>!p||(E[_]||0)<=p,F=_=>!l||T[_]<=l,$=_=>!U.includes(_);return{eligibleParticipants:C.filter(_=>O(_.participantId)&&k(_.participantId)&&x(_.participantId)&&F(_.participantId)&&$(_.participantId)).map(_=>{var L;return{..._,individualParticipants:(L=_.individualParticipantIds)==null?void 0:L.map(B=>{var V;return(V=o==null?void 0:o.participants)==null?void 0:V.find(G=>G.participantId===B)})}}),losingParticipantIds:M,...Q}}function pR(t){var e,i,r,n,a,o,s,l;let u=We(t,[{drawDefinition:!0}]);if(u.error)return u;let{drawDefinition:c,roundNumber:d}=t,p=t.structureId??(((e=c.structures)==null?void 0:e.length)===1&&((r=(i=c.structures)==null?void 0:i[0])==null?void 0:r.structureId));if(typeof p!="string")return{error:Xa};let m=(n=c.structures)==null?void 0:n.find(w=>w.structureId===p);if(!m)return{error:Ni};let h,f=(a=m.matchUps??[])==null?void 0:a.reduce((w,U)=>(U.roundPosition&&(h=!0),((U==null?void 0:U.roundNumber)||0)>w?U.roundNumber:w),0);if(m.structures||h||m.finishingPosition===Eh)return{error:Sp};let g=((o=c==null?void 0:c.entries)==null?void 0:o.filter(w=>{let U=w.entryStatus;return hs.includes(U)}))??[],v=Math.floor((g==null?void 0:g.length)/2)||1,y=d??f??1,I=((l=(s=m.matchUps)==null?void 0:s.filter(w=>w.roundNumber===y))==null?void 0:l.length)??0,b=v-I,S=b>0?b:0;return{...Q,availableMatchUpsCount:S,lastRoundNumber:f,roundMatchUpsCount:v}}function d_({drawDefinition:t}){var e;let i=It({name:"participantRepresentatives",element:t});return i.error?i:{representativeParticipantIds:((e=i.extension)==null?void 0:e.value)||[]}}function mPe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:_e};let r=gr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=Me(r.matchUps,!1,!0),a=dt(n.reduce((s,l)=>s.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),o=Object.assign({},...a.map(s=>{let l=n.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:a,participantIdMatchUps:o}}function p_({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:_e};let{participantIds:r,participantIdMatchUps:n}=mPe({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(r==null?void 0:r.map(o=>{let s=n[o].filter(d=>[Ki,jt].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(h=>h.bye),m=d.sides.find(h=>h.participantId===o).sideNumber;return(d.winningSide||t&&p&&m)===m?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),u=d=>Math.abs(d[0]-d[1]),c=l.reduce((d,p)=>d&&u(d)<u(p)?d:p,void 0);return{[o]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:c}}}))||[];return Object.assign({},...a)}function ld({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:ve};if(!r)return{error:Bs};if(!e&&t){if(typeof i!="string"&&(i=DQ({tournamentRecords:t,drawId:r}),!i))return{error:Qf};if(e=t[i],!e)return{error:ve}}let n=e&&Kn({tournamentRecord:e,drawId:r});return n!=null&&n.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...Q}:te({result:{error:ja},stack:"findDrawDefinition"})}function m_(t){let{drawDefinition:e,error:i}=ld(t);return i?{error:i}:{drawDefinition:Me(e)}}function AM({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=Sv({drawDefinition:i,structureId:r})||{},o=((a==null?void 0:a.target)||[]).filter(({linkType:s})=>s===n).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:u}=rt({structureId:l,drawDefinition:i});if(!(e&&(u==null?void 0:u.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:o.map(({source:s})=>s.structureId),relevantLinks:o}}function hPe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){var o;let s=((o=a==null?void 0:a.entries)==null?void 0:o.filter(({entryStatus:l})=>[Eo,Np].includes(l)).map(({participantId:l})=>l))||[];if(s.length){let l=r.individualParticipantIds,u=e?t.filter(({participantId:d})=>s.includes(d)):void 0,c=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:Ge({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:TDe,availableIndividualParticipantIds:s,availableIndividualParticipants:u,existingIndividualParticipantIds:l,existingIndividualParticipants:c,type:WL},!1,!1,!0)}}return{}}function np(t){var e,i,r,n,a;let{inContextDrawMatchUps:o,targetData:s,drawDefinition:l,relevantLink:u}=t;if((u==null?void 0:u.linkCondition)===dl&&((e=s==null?void 0:s.matchUp)==null?void 0:e.matchUpStatus)===jt)return!1;let{targetMatchUps:{loserMatchUp:c,winnerMatchUp:d},targetLinks:p}=s,m=c&&On({matchUpId:c.matchUpId,inContextDrawMatchUps:o,drawDefinition:l}),h=(i=m==null?void 0:m.targetMatchUps)==null?void 0:i.loserMatchUp,f=(r=m==null?void 0:m.targetMatchUps)==null?void 0:r.loserMatchUpDrawPositionIndex,g=(n=h==null?void 0:h.sides[f])==null?void 0:n.participant,v=[Pt,Ft].includes(c==null?void 0:c.matchUpStatus)&&!g,y=((a=d==null?void 0:d.drawPositions)==null?void 0:a.filter(Boolean).length)||0;if(c!=null&&c.winningSide&&!v||d!=null&&d.winningSide&&y===2&&(!d.feedRound||![Ft,Pt].includes(d==null?void 0:d.matchUpStatus)))return!0;let I=d&&On({matchUpId:d.matchUpId,inContextDrawMatchUps:o,drawDefinition:l}),b=m&&np({relevantLink:p==null?void 0:p.loserTargetLink,targetData:m,inContextDrawMatchUps:o,drawDefinition:l});return!!(I&&np({targetData:I,inContextDrawMatchUps:o,drawDefinition:l})||b)}var _Q={[Fu]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Je,Ne],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[vy,Gm,aR,hm],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},oS="positionAction",OM="matchUpAction";function $Q({actionType:t=oS,appliedPolicies:e,drawDefinition:i,structure:r}){var n,a;let o=t===oS&&Fu||t===OM&&_r,s=t===oS&&_Q||t===OM&&vX,l=o&&((e==null?void 0:e[o])||(s==null?void 0:s[o])),u=((a=(n=i.links)==null?void 0:n.filter(m=>{var h;return((h=m==null?void 0:m.target)==null?void 0:h.structureId)===(r==null?void 0:r.structureId)}))==null?void 0:a.map(({target:m})=>m.feedProfile))??[],{enabledStructures:c,disabledStructures:d}=l||{},p=d==null?void 0:d.find(m=>{let{stages:h,stageSequences:f,structureTypes:g,feedProfiles:v}=m;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>u.includes(y)))&&(!(h!=null&&h.length)||Array.isArray(h)&&(h==null?void 0:h.includes(r==null?void 0:r.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(r==null?void 0:r.structureType)))&&(!(f!=null&&f.length)||Array.isArray(f)&&f.includes(r==null?void 0:r.stageSequence))});return{enabledStructures:c,actionsDisabled:p,actionsPolicy:l}}function B2({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function BQ({enabledStructures:t,drawDefinition:e,structure:i}){var r,n;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:a,stageSequence:o,structureType:s}=i||{},l=((n=(r=e.links)==null?void 0:r.filter(u=>{var c;return((c=u==null?void 0:u.target)==null?void 0:c.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:n.map(({target:u})=>u.feedProfile))||[];return{policyActions:t.find(u=>{let{stages:c,stageSequences:d,structureTypes:p,feedProfiles:m}=u||{},h=!(c!=null&&c.length)||Array.isArray(c)&&c.includes(a),f=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(o),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(s),v=!(m!=null&&m.length)||Array.isArray(m)&&m.some(y=>l.includes(y));return f&&g&&v&&u&&h})}}function ea({action:t,policyActions:e}){var i;let r=!(e!=null&&e.enabledActions)||((i=e==null?void 0:e.disabledActions)==null?void 0:i.length)&&e.disabledActions.includes(t);return r?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!r}var VQ="replaceTieMatchUpParticipantId",jQ="assignTieMatchUpParticipantId",kM="removeTieMatchUpParticipantId",V2="assignMatchUpSideParticipant",fPe="removeMatchUpSideParticipant",GQ="substituteParticipant",xM="REMOVE_SUBSTITUTION",HQ="REPLACE_PARTICIPANT",h_="REMOVE_PARTICIPANT",FM="setMatchUpStatus",LM="SUBSTITUTION",zQ="SCHEDULE",gPe="PENALTY",_M="REFEREE",WQ="STATUS",$M="START",qQ="SCORE",BM="END",vPe={REPLACE_TEAM_POSITION_METHOD:VQ,ASSIGN_TEAM_POSITION_METHOD:jQ,REMOVE_TEAM_POSITION_METHOD:kM,REPLACE_PARTICIPANT:HQ,SUBSTITUTION_METHOD:GQ,REMOVE_SUBSTITUTION:xM,REMOVE_PARTICIPANT:h_,SCHEDULE_METHOD:FM,SUBSTITUTION:LM,SCHEDULE:zQ,PENALTY:gPe,REFEREE:_M,STATUS:WQ,SCORE:qQ,START:$M,END:BM};function IPe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){var m,h,f,g,v,y,I,b,S,w,U,T,D,P,E;let R=[],N=(m=n.sides)==null?void 0:m.find(W=>W.participant),A=n.gender===jn&&n.sideNumber&&((h=n.sides)==null?void 0:h.filter(W=>W.particiapntId).length)===1&&((g=(f=N==null?void 0:N.participant)==null?void 0:f.person)==null?void 0:g.sex),M=n.matchUpType,C=(o??((v=r==null?void 0:r.participants)==null?void 0:v.enforceGender))!==!1?n.gender:void 0,O=(I=(y=n.sides)==null?void 0:y.flatMap(W=>{var q;return((q=W.participant)==null?void 0:q.individualParticipants)||W.participant}).filter(Boolean))==null?void 0:I.map(Tt),k=(b=n.sides)==null?void 0:b.filter(W=>!l||W.sideNumber===l).flatMap(W=>{var q;return((q=W.participant)==null?void 0:q.individualParticipants)||W.participant}).filter(Boolean),x=k==null?void 0:k.map(Tt),F=(w=(S=e==null?void 0:e.find(W=>W.matchUpId===n.matchUpTieId))==null?void 0:S.sides)==null?void 0:w.map(W=>{var q,Y;return(Y=(q=W==null?void 0:W.participant)==null?void 0:q.individualParticipants)==null?void 0:Y.filter(({participantId:re,person:J})=>!(x!=null&&x.includes(re))&&(!C||C===Fs||J.sex===C||C===jn&&!A||A&&J.sex!==A))}),$=l?F==null?void 0:F[l-1]:F==null?void 0:F.map((W,q)=>({participants:W,sideNumber:q+1})),_=l?(U=F==null?void 0:F[l-1])==null?void 0:U.map(Tt):F==null?void 0:F.map((W,q)=>({participants:W==null?void 0:W.map(Tt),sideNumber:q+1})),L=l&&(Ji(cm)(M)&&!(x!=null&&x.length)||Ji(Wd)(M)&&((x==null?void 0:x.length)??0)<2)||!l&&(Ji(cm)(M)&&((x==null?void 0:x.length)??0)<2||Ji(Wd)(M)&&((x==null?void 0:x.length)??0)<4),B=_==null?void 0:_.filter(W=>!(O!=null&&O.includes(W))),V=$==null?void 0:$.filter(({participantId:W})=>B.includes(W));if(L&&B!=null&&B.length&&R.push({availableParticipantIds:B,method:jQ,availableParticipants:V,type:jm,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),x!=null&&x.length&&(!br(c)||(T=p==null?void 0:p.substitutions)!=null&&T.length)&&R.push({method:kM,type:h_,existingParticipantIds:x,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),V!=null&&V.length&&(!l&&x!=null&&x.length||l&&p!=null&&p.participant)&&R.push({availableParticipantIds:B,method:VQ,availableParticipants:V,type:HQ,existingParticipantIds:x,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),ea({policyActions:a,action:xM})&&((D=p==null?void 0:p.substitutions)==null?void 0:D.length)){let W=((P=p.participant)==null?void 0:P.participantType)===Dt&&[p.participantId]||((E=p.participant)==null?void 0:E.participantType)===gt&&p.participant.individualParticipantIds||[],q=p.substitutions.map(Y=>Y.participantId).filter(Y=>W.includes(Y));(!s||q.includes(s))&&R.push({method:kM,type:xM,substitutedParticipantIds:q,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let G=t==null?void 0:t[_r],j=G==null?void 0:G.substituteWithoutScore,z=G==null?void 0:G.substituteAfterCompleted;if(ea({policyActions:a,action:LM})&&i.length===2&&(!l&&x!=null&&x.length||l&&p!=null&&p.participant)&&(j||br(c))&&(z||c.matchUpStatus&&!yr.includes(c.matchUpStatus))&&k!=null&&k.length&&$.length){let W=k.map(Tt);R.push({info:"list of team players available for substitution",method:GQ,availableParticipantIds:_,existingParticipantIds:W,availableParticipants:$,existingParticipants:k,type:LM,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return R}function yPe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:u,structure:c,drawId:d,event:p}){var m,h,f,g,v;if(i.includes(s))return{};let y=(m=l.find(R=>R.type===jm))==null?void 0:m.availableParticipantIds,I=(h=a==null?void 0:a[Fu])==null?void 0:h.otherFlightEntries,b=(f=a==null?void 0:a[Fu])==null?void 0:f.restrictQualifyingAlternates,S=(o.entries??[]).filter(({entryStage:R})=>!b||(c.stage===Je?R===Je:R!==Je)).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:R})=>R).filter(Boolean),{allPositionedParticipantIds:w}=DJ({drawDefinition:o}),U=r.map(R=>R.participantId).filter(Boolean),T=S.filter(R=>c.stage&&[Je,Ne,Bi].includes(c.stage)?!(w!=null&&w.includes(R)):!U.includes(R)),D=((p==null?void 0:p.entries)??[]).filter(R=>R.entryStatus===Jo&&YQ({restrictQualifyingAlternates:b,structure:c,entry:R})&&(c.stage&&[Je,Ne,Bi].includes(c.stage)?!(w!=null&&w.includes(R.participantId)):!U.includes(R.participantId))).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(R=>R.participantId),P=dt(T.concat(D));if(I){let R=(v=(g=p?Hi({event:p}).flightProfile:void 0)==null?void 0:g.flights)==null?void 0:v.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(A=>A.participantId&&![Ql,Eo,Np].includes(A.entryStatus)&&!S.includes(A.participantId)).map(({participantId:A})=>A)).flat().filter(Boolean);R!=null&&R.length&&P.push(...R)}y!=null&&y.length&&(P=P.filter(R=>!y.includes(R)));let E=n?t==null?void 0:t.filter(R=>P.includes(R.participantId)):void 0;return E==null||E.forEach(R=>{let N=(o.entries??[]).find(A=>A.participantId===R.participantId);R.entryPosition=N==null?void 0:N.entryPosition}),E==null||E.sort((R,N)=>(R.entryPosition||1/0)-(N.entryPosition||1/0)),P.length?{validAlternatesAction:Ge({payload:{drawId:d,structureId:u,drawPosition:s},willDisableLinks:e,method:UDe,availableAlternatesParticipantIds:P,type:qL,availableAlternates:E})}:{}}function YQ({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===Je&&!t||i.entryStage===Ne&&r===an)return!0}function bPe({eventEntries:t,structure:e}){let i=n=>n.entryStatus===Jo&&YQ({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(Tt)}function wPe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:u,drawId:c,event:d}){var p,m,h,f,g,v,y;let I=[],b=(l==null?void 0:l.matchUps)??[],S=(m=(p=u.sides)==null?void 0:p.find(M=>M.sideNumber===o))==null?void 0:m.participantId,w=b.filter(({roundNumber:M})=>M===u.roundNumber),U=((h=n==null?void 0:n.entries)==null?void 0:h.filter(({entryStatus:M})=>M&&Ap.includes(M)).map(Tt))??[],T=w.map(M=>(M.sides??[]).flatMap(Tt)).flat().filter(Boolean),D=U.filter(M=>!i.includes(M)&&(!t||!T.includes(M))),P=e==null?void 0:e.filter(M=>D==null?void 0:D.includes(M.participantId)).map(M=>Me(M,void 0,!0));P==null||P.forEach(M=>{let C=(n.entries??[]).find(O=>O.participantId===M.participantId);M.entryPosition=C==null?void 0:C.entryPosition}),D.length&&I.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:V2,type:jm,availableParticipantIds:D,participantsAvailable:P});let E=(d==null?void 0:d.entries)??[],R=bPe({eventEntries:E,structure:l}),N=dt(U.concat(R));if(r){let M=(g=(f=d?Hi({event:d}):void 0)==null?void 0:f.flights)==null?void 0:g.filter(C=>C.drawId!==c).flatMap(C=>C.drawEntries.filter(O=>O.participantId&&![Ql,Eo,Np].includes(O.entryStatus)).map(({participantId:O})=>O)).filter(Boolean);M!=null&&M.length&&N.push(...M)}N=N.filter(M=>!i.includes(M)&&!D.includes(M)&&(!t||!T.includes(M)));let A=e==null?void 0:e.filter(M=>N.includes(M.participantId)).map(M=>Me(M,void 0,!0));if(A==null||A.forEach(M=>{let C=(n.entries??[]).find(O=>O.participantId===M.participantId);M.entryPosition=C==null?void 0:C.entryPosition}),A==null||A.sort((M,C)=>(M.entryPosition||1/0)-(C.entryPosition||1/0)),N.length&&I.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:N,participantsAvailable:A,method:V2,type:Jo}),!br(u)&&o&&S){I.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:fPe,type:h_});let M=L=>L.sides.map(Tt),C=({matchUpId:L})=>L!==u.matchUpId,O=L=>!br(L),k=(y=(v=u.sides)==null?void 0:v.find(L=>L.sideNumber!==o))==null?void 0:y.participantId,x=b.filter(({roundNumber:L})=>L!==u.roundNumber).filter(C).map(M),F=[k,...x.filter(L=>L.includes(S)).flat()].filter(Boolean),$=L=>!F.flat().includes(L),_=w.filter(O).filter(C).map(M).flat().filter($);if(_.length){let L=e==null?void 0:e.filter(B=>_.includes(B.participantId)).map(B=>Me(B,void 0,!0));I.push({payload:{participantIds:[S],roundNumber:u.roundNumber,structureId:a,sideNumber:o,matchUpId:s,drawId:c},swappableParticipantIds:_,method:DDe,type:oR,swappableParticipants:L})}}return I}function mR(t){var e,i,r,n,a,o,s,l,u;if(!t)return{error:le};let{drawDefinition:c,event:d}=t,{restrictAdHocRoundParticipants:p=!0,policyDefinitions:m,enforceGender:h,participantId:f,sideNumber:g,matchUpId:v}=t,y=t.tournamentRecord??(t.tournamentId&&Pi(t.tournamentId)&&((e=t.tournamentRecords)==null?void 0:e[t.tournamentId]));if(!y)return{error:ve};if(!v||!Pi(v))return{error:bn};if(g&&![1,2].includes(g))return te({result:{error:le},context:{sideNumber:g}});if(!c){let ae=(Hr({tournamentRecord:y}).matchUps??[]).find(ne=>ne.matchUpId===v);d=((y==null?void 0:y.events)??[]).find(ne=>ne.eventId===(ae==null?void 0:ae.eventId));let oe=((d==null?void 0:d.drawDefinitions)??[]).find(ne=>ne.drawId===(ae==null?void 0:ae.drawId));oe&&(c=oe)}if(!c)return{error:_e};let I=Ai({withIndividualParticipants:!0,tournamentRecord:y}).participants,{drawId:b}=c,{matchUp:S,structure:w}=Ti({drawDefinition:c,matchUpId:v,event:d});if(!S)return{error:fn};let U=Bt({tournamentRecord:y,drawDefinition:c,structure:w,event:d}).appliedPolicies??{};Object.assign(U,m??{});let T=(i=U==null?void 0:U[Fu])==null?void 0:i.otherFlightEntries,D=(U==null?void 0:U[_r])??Pv[_r],{enabledStructures:P}=$Q({actionType:OM,appliedPolicies:U,drawDefinition:c,structure:w}),{policyActions:E}=BQ({enabledStructures:P,drawDefinition:c,structure:w}),R=t.matchUpsMap??ln({drawDefinition:c}),N=t.inContextDrawMatchUps??gr({tournamentParticipants:I,inContext:!0,drawDefinition:c,matchUpsMap:R,event:d}).matchUps,A=N==null?void 0:N.find(ae=>ae.matchUpId===v),M=g&&((r=A==null?void 0:A.sides)==null?void 0:r.find(ae=>ae.sideNumber===g)),C=((n=A==null?void 0:A.sides)==null?void 0:n.map(ae=>{var oe;return ae.participantId||((oe=ae.participant)==null?void 0:oe.participantid)}).filter(Boolean))??[],{assignedPositions:O,allPositionsAssigned:k}=Mr({structure:w}),{structureId:x}=w??{},F=[];if(!x)return{validActions:F};let $=Yn({structure:w}),_=S.collectionId;if($&&!_){let ae=wPe({restrictAdHocRoundParticipants:p,tournamentParticipants:I,matchUpParticipantIds:C,otherFlightEntries:T,drawDefinition:c,structureId:x,sideNumber:g,matchUpId:v,structure:w,matchUp:S,drawId:b,event:d});F.push(...ae)}let L=$c({drawDefinition:c,structure:w}),B=O==null?void 0:O.filter(ae=>ae.participantId).map(ae=>ae.drawPosition),V=O==null?void 0:O.filter(ae=>ae.bye).map(ae=>ae.drawPosition),G=S.matchUpStatus===jt||!_&&((a=S.drawPositions)==null?void 0:a.reduce((ae,oe)=>(V==null?void 0:V.includes(oe))||ae,!1));if(G)return{validActions:F,isByeMatchUp:G};ea({policyActions:E,action:_M})&&F.push({type:_M,payload:{matchUpId:v}});let j=!Ew({matchUpStatus:S.matchUpStatus}),z=(o=U==null?void 0:U.scoring)==null?void 0:o.structures,W=(w==null?void 0:w.stage)&&(z==null?void 0:z.stage)&&(z==null?void 0:z.stage[w.stage]),q=(w==null?void 0:w.stageSequence)&&(W==null?void 0:W.stageSequence)&&W.stageSequence[w.stageSequence],Y=!((s=U==null?void 0:U.scoring)!=null&&s.requireAllPositionsAssigned||W!=null&&W.requireAllPositionsAssigned||q!=null&&q.requireAllPositionsAssigned)||k,re=S.sides&&S.sides.filter(ae=>ae==null?void 0:ae.participantId).length===2,J=S.matchUpStatus&&[ir,pr].includes(S.matchUpStatus),H=On({inContextDrawMatchUps:N,drawDefinition:c,matchUpId:v}),Z=np({inContextDrawMatchUps:N,drawDefinition:c,targetData:H}),K=(((l=A==null?void 0:A.drawPositions)==null?void 0:l.length)===2&&A.drawPositions.every(ae=>B==null?void 0:B.includes(ae))&&((u=A==null?void 0:A.sides)==null?void 0:u.length)===2&&A.sides.every(({participantId:ae})=>ae)||re)&&!(J&&Z),ie={method:tQ,type:Gm,payload:{drawId:b,matchUpId:v,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(j&&F.push({payload:{drawId:b,matchUpId:v,schedule:{}},method:FM,type:zQ}),ea({policyActions:E,action:Gm})&&(M!=null&&M.participant||!g&&C!=null&&C.length)&&F.push(ie),j&&K&&F.push({type:WQ}),Y&&K){let{matchUpId:ae,matchUpFormat:oe}=S,ne={drawId:b,matchUpId:ae,matchUpFormat:oe,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};F.push({info:"set outcome and winningSide",method:FM,type:qQ,payload:ne}),ea({policyActions:E,action:$M})&&F.push({type:$M}),ea({policyActions:E,action:BM})&&F.push({type:BM})}if(_&&A){let ae=IPe({specifiedPolicyDefinitions:m,inContextDrawMatchUps:N,matchUpParticipantIds:C,matchUpActionsPolicy:D,inContextMatchUp:A,policyActions:E,enforceGender:h,participantId:f,sideNumber:g,matchUpId:v,matchUp:S,drawId:b,side:M});F.push(...ae)}return{structureIsComplete:L,validActions:F,isDoubleExit:J,...Q}}function UPe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:u,drawId:c,event:d}){var p,m,h,f,g,v,y;if(n.includes(s)||r&&!e)return{};let{sourceStructureIds:I,targetStructureIds:b}=((p=o.links)==null?void 0:p.reduce((T,D)=>{var P,E;let R=(P=D.source)==null?void 0:P.structureId,N=(E=D.target)==null?void 0:E.structureId;return T.sourceStructureIds.includes(R)||T.sourceStructureIds.push(R),T.targetStructureIds.includes(N)||T.targetStructureIds.push(N),T},{sourceStructureIds:[],targetStructureIds:[]}))||{},S=[],w=((m=o.links)==null?void 0:m.filter(T=>{var D;return((D=T.target)==null?void 0:D.structureId)===u.structureId}))??[];for(let T of w){let D=(h=T==null?void 0:T.source)==null?void 0:h.structureId,{structure:P}=rt({structureId:D,drawDefinition:o}),E=(P==null?void 0:P.finishingPosition)===Eh&&((I==null?void 0:I.length)!==1||(b==null?void 0:b.length)!==1),R={};if(E){let{matchUps:M}=qt({drawDefinition:o,structure:u,event:d}),{initialRoundNumber:C}=Vm({drawPosition:s,matchUps:M}),O=(v=(g=(f=o.links)==null?void 0:f.find(k=>{var x;return((x=k.target)==null?void 0:x.structureId)===(u==null?void 0:u.structureId)&&k.target.roundNumber===C}))==null?void 0:g.source)==null?void 0:v.roundNumber;R.roundNumbers=[O]}let{completedMatchUps:N}=QP({structureId:D,inContext:!0,matchUpFilters:R,drawDefinition:o}),A=a.map(M=>M.participantId).filter(Boolean);(y=N==null?void 0:N.filter(({matchUpType:M,winningSide:C})=>C&&((d==null?void 0:d.eventType)!==cr||M===cr)).map(({winningSide:M,sides:C})=>M&&(C==null?void 0:C[1-(M-1)])).map(Tt).filter(M=>M&&!A.includes(M)))==null||y.forEach(M=>{S.includes(M)||S.push(M)})}let U=t==null?void 0:t.filter(T=>S==null?void 0:S.includes(T.participantId));return U==null||U.forEach(T=>{let D=(o.entries??[]).find(P=>P.participantId===T.participantId);T.entryPosition=D==null?void 0:D.entryPosition}),S!=null&&S.length?{validLuckyLosersAction:{type:KL,method:SDe,availableLuckyLosers:U,availableLuckyLoserParticipantIds:S,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:s}}}:{}}function SPe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:m,event:h}){var f,g,v;let{drawId:y}=u,I=[],b,S,w=[],U=(g=(f=l==null?void 0:l[ko])==null?void 0:f.validSeedPositions)==null?void 0:g.ignore;if(U||({unplacedSeedParticipantIds:b,unplacedSeedAssignments:S,unfilledPositions:w}=MX({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:m,event:h})),w!=null&&w.length||(w=o.filter(T=>!T.participantId&&!T.bye&&!T.qualifier).map(T=>T.drawPosition)),d||I.push({payload:{drawId:y,structureId:m,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:EDe,type:g0}),a&&U){let T=o.map(N=>N.participantId).filter(Boolean),D={structureIds:t},{completedMatchUps:P}=Tv({inContext:!0,matchUpFilters:D,drawDefinition:u}),E=dt((v=(P??[]).filter(({matchUpType:N})=>(h==null?void 0:h.eventType)!==cr||N===cr))==null?void 0:v.map(({sides:N})=>N==null?void 0:N.map(Tt)).flat().filter(N=>N&&!T.includes(N))),R=s?n==null?void 0:n.filter(N=>E==null?void 0:E.includes(N.participantId)).map(N=>Me(N,void 0,!0)):void 0;return R==null||R.forEach(N=>{let A=(u.entries??[]).find(M=>M.participantId===N.participantId);N.entryPosition=A==null?void 0:A.entryPosition}),R!=null&&R.length&&I.push(Ge({payload:{drawId:y,structureId:m,drawPosition:p},willDisableLinks:i,method:A2,type:jm,availableParticipantIds:E,participantsAvailable:R})),{validAssignmentActions:I}}if(w.includes(p)||d){let T;if(S!=null&&S.length){let P=S.filter(E=>b==null?void 0:b.includes(E.participantId));P.sort(TPe),T=P.map(E=>E.participantId)}else T=e;let D=s?n==null?void 0:n.filter(P=>T.includes(P.participantId)).map(P=>Me(P,void 0,!0)):void 0;D!=null&&D.length&&I.push(Ge({payload:{drawId:y,structureId:m,drawPosition:p},willDisableLinks:i,method:A2,type:jm,availableParticipantIds:T,participantsAvailable:D}))}return{validAssignmentActions:I}}function TPe(t,e){return t.bye||fg(t.seedValue)<fg(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function DPe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var u,c,d;let p=[],m=[],h=[],f=[],g=i.map(T=>T.participantId).filter(Boolean),v=n==null?void 0:n[Fu],y=!(v!=null&&v.disableRoundRestrictions)&&t[o],I=v==null?void 0:v.requireCompletedStructures,{sourceStructureIds:b,relevantLinks:S}=AM({targetRoundNumber:y,linkType:xu,drawDefinition:a,structureId:s})||{};b!=null&&b.length&&f.push(...b);let{sourceStructureIds:w,relevantLinks:U}=AM({targetRoundNumber:y,linkType:ku,drawDefinition:a,structureId:s})||{};w!=null&&w.length&&f.push(...w);for(let T of S){let D=(u=a.structures)==null?void 0:u.find(E=>E.structureId===T.source.structureId);if((D==null?void 0:D.stage)!==Je)continue;let P=$c({structureId:T.source.structureId,drawDefinition:a});if(!I||P){let E=D.qualifyingRoundNumber,{matchUps:R}=qt({matchUpFilters:{roundNumbers:[E],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:D});for(let N of R){let A=N.sides.find(C=>(C==null?void 0:C.sideNumber)===N.winningSide),M=N.matchUpStatus===jt&&((c=N.sides)==null?void 0:c.find(({participantId:C})=>C));if(A||M){let{participantId:C,participant:O}=A||M||{};C&&!g.includes(C)&&(O&&r&&p.push(O),m.push(C))}}}}for(let T of U){let D=(d=a.structures)==null?void 0:d.find(E=>E.structureId===T.source.structureId);if((D==null?void 0:D.stage)!==Je)continue;let P=$c({structureId:T.source.structureId,drawDefinition:a});if(!I||P){let{positionAssignments:E}=si({structure:D}),R=(E==null?void 0:E.map(N=>{var A;let M=N.participantId,C=(A=It({element:N,name:kc}).extension)==null?void 0:A.value;return C?{participantId:M,groupOrder:C==null?void 0:C.groupOrder}:{}}).filter(({groupOrder:N,participantId:A})=>N===1&&!g.includes(A)).map(({participantId:N})=>N))??[];if(R&&m.push(...R),r){let N=e.filter(({participantId:A})=>R.includes(A));p.push(...N)}}}return m.length&&h.push(Ge({qualifyingParticipants:r?p:void 0,method:bDe,type:aR,qualifyingParticipantIds:m,payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l}})),{validAssignmentActions:h,sourceStructureIds:f}}function PPe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:m,event:h}){if(n.includes(c))return{};let f=P=>!t||P.participantId||P.qualifier||P.bye,g=r==null?void 0:r.filter(P=>P!==c&&!(u&&s.includes(P))),v=(a==null?void 0:a.filter(P=>f(P)&&(g==null?void 0:g.includes(P.drawPosition))))??[],y=v.map(({drawPosition:P})=>P),{matchUps:I}=qt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:h}),b=I.filter(({drawPositions:P})=>Nn(P,y)),S=Object.assign({},...b.map(P=>{var E;return(E=P.sides)==null?void 0:E.filter(({sourceDrawPositionRange:R})=>R).map(({drawPosition:R,sourceDrawPositionRange:N})=>({[R]:N}))}).flat()),w=v.map(P=>P.participantId).filter(Boolean),U=(i??[]).filter(P=>w.includes(P.participantId)),T=Object.assign({},...U.map(P=>({[P.participantId]:P}))),D=v.map(P=>{let E=T==null?void 0:T[P.participantId],R=S[P.drawPosition];return Ge({...P,participant:o?Me(E,!1,!0):void 0,sourceDrawPositionRange:R})});return D.length?{validSwapAction:{payload:{drawId:m,structureId:d,drawPositions:[c]},willDisableLinks:e,method:eQ,type:oR,availableAssignments:D}}:{}}function f_(t){var e;let i=We(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(i.error)return i;let{policyDefinitions:r,returnParticipants:n=!0,provisionalPositioning:a,tournamentRecord:o,drawDefinition:s,drawPosition:l,event:u}=t,c=t.tournamentParticipants??(o&&Ai({withIndividualParticipants:!0,tournamentRecord:o}).participants)??[],d=rt({structureId:t.structureId,drawDefinition:s});if(d.error)return d;let p=d.containingStructure||d.structure;if(!p)return{error:Ni};let m=p.structureId;if(d=Cw({drawDefinition:s,structureId:m}),l===void 0&&!d.isAdHoc)return{error:uv};if(d.isAdHoc)return mR(t);if(d.error)return d;let{drawPositionInitialRounds:h,inactiveDrawPositions:f,activeDrawPositions:g,byeDrawPositions:v}=d,y=Bt({tournamentRecord:o,drawDefinition:s,structure:p,event:u}).appliedPolicies??{};Object.assign(y,r??{});let{actionsPolicy:I,enabledStructures:b,actionsDisabled:S}=$Q({actionType:oS,appliedPolicies:y,drawDefinition:s,structure:p}),w=(I==null?void 0:I.activePositionOverrides)||[],{sourceStructureIds:U}=AM({finishingPosition:Jd,targetRoundNumber:1,linkType:ku,drawDefinition:s,structureId:m})||{},T;U!=null&&U.length&&(T=U.every(W=>$c({structureId:W,drawDefinition:s})));let D=U.length,P=U.length&&!T,{policyActions:E}=BQ({enabledStructures:b,drawDefinition:s,structure:p}),R=![Je,Ne].includes(p.stage)||p.stageSequence!==1,{drawId:N}=s,A=[],{assignedPositions:M,positionAssignments:C}=Mr({structure:p}),O=M==null?void 0:M.find(W=>W.drawPosition===l),k=!!O;if(!((e=C==null?void 0:C.map(W=>W.drawPosition))!=null&&e.includes(l)))return{error:lv};let{stage:x,stageSequence:F}=p,$=[x];x===an&&$.push(Ne),x===Ne&&$.push(an);let _=Nh({entryStatuses:Ap,provisionalPositioning:a,drawDefinition:s,stageSequence:F,structureId:m,stages:$}),L=kp({drawDefinition:s,stages:$}).assignedParticipantIds??[],B=_.filter(W=>!L.includes(W.participantId)).map(W=>W.participantId),V=v.includes(l),G=g.includes(l);if(S)return{info:"Actions Disabled for structure",isActiveDrawPosition:G,isDrawPosition:!0,hasPositionAssigned:k,validActions:[],isByePosition:V};if(ea({policyActions:E,action:jm})&&!G&&C&&!P&&(!O||V)){let{validAssignmentActions:W}=SPe({positionSourceStructureIds:U,unassignedParticipantIds:B,possiblyDisablingAction:R,isWinRatioFedStructure:D,tournamentParticipants:c,positionAssignments:C,returnParticipants:n,appliedPolicies:y,drawDefinition:s,isByePosition:V,drawPosition:l,structureId:m,event:u});W==null||W.forEach(q=>A.push(q))}if(ea({policyActions:E,action:aR})&&!G){let{validAssignmentActions:W}=DPe({drawPositionInitialRounds:h,tournamentParticipants:c,positionAssignments:C,returnParticipants:n,appliedPolicies:y,drawDefinition:s,drawPosition:l,structureId:m,drawId:N});W==null||W.forEach(q=>A.push(q))}let{participantId:j}=O||{},z=j&&c.find(W=>W.participantId===j);if(O){ea({policyActions:E,action:NM})&&!G&&(A.push({type:NM,method:N2,payload:{drawId:N,structureId:m,drawPosition:l},willDisableLinks:R}),V||A.push({type:YL,method:wDe,payload:{drawId:N,structureId:m,drawPosition:l},willDisableLinks:R}),ea({policyActions:E,action:g0})&&!V&&A.push({type:g0,method:N2,payload:{drawId:N,structureId:m,drawPosition:l,replaceWithBye:!0},willDisableLinks:R}));let W=p.stage===Je||p.stage===Ne&&p.stageSequence===1;if(!V&&B2({activePositionOverrides:w,activeDrawPositions:g,action:hm})&&ea({policyActions:E,action:hm})&&m0({drawDefinition:s,structureId:m,drawPosition:l})&&W){let{seedAssignments:q}=Io({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:Y,seedValue:re}=(q==null?void 0:q.find(J=>J.participantId===j))??{};A.push({type:hm,method:CDe,participant:z,seedNumber:Y,payload:{drawId:N,structureId:m,participantId:j,seedValue:re}})}if(!V&&B2({activePositionOverrides:w,activeDrawPositions:g,action:cI})&&ea({policyActions:E,action:cI})&&m0({drawDefinition:s,structureId:m,drawPosition:l})&&W){let{seedAssignments:q}=Io({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:Y}=(q==null?void 0:q.find(re=>re.participantId===j))??{};A.push({method:RDe,type:cI,participant:z,seedNumber:Y,payload:{participantId:j,structureId:m,drawId:N}})}if(!V&&j){if(ea({policyActions:E,action:Gm})){let q={type:Gm,method:tQ,participant:z,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:N}};A.push(q)}if(ea({policyActions:E,action:vy})){let q={type:vy,method:PDe,participant:z,payload:{participantId:j,otherName:void 0}};A.push(q)}}if(ea({policyActions:E,action:oR})){let{validSwapAction:q}=PPe({possiblyDisablingAction:R,tournamentParticipants:c,inactiveDrawPositions:f,activeDrawPositions:g,positionAssignments:C,returnParticipants:n,byeDrawPositions:v,drawDefinition:s,isByePosition:V,drawPosition:l,structureId:m,structure:p,drawId:N});q&&A.push(q)}}if(ea({policyActions:E,action:qL})&&!P){let{validAlternatesAction:W}=yPe({possiblyDisablingAction:R,tournamentParticipants:c,positionAssignments:C,activeDrawPositions:g,returnParticipants:n,appliedPolicies:y,drawDefinition:s,drawPosition:l,validActions:A,structureId:m,structure:p,drawId:N,event:u});W&&A.push(W)}if(ea({policyActions:E,action:KL})&&!P&&!G&&C){let{validLuckyLosersAction:W}=UPe({sourceStructuresComplete:T,possiblyDisablingAction:R,isWinRatioFedStructure:D,tournamentParticipants:c,activeDrawPositions:g,positionAssignments:C,drawDefinition:s,drawPosition:l,structureId:m,structure:p,drawId:N});W&&A.push(W)}if((z==null?void 0:z.participantType)===gt&&ea({policyActions:E,action:WL})){let{validModifyAssignedPairAction:W}=hPe({tournamentParticipants:c,returnParticipants:n,drawPosition:l,participant:z,drawId:N,event:u});W&&A.push(W)}return{isActiveDrawPosition:G,isDrawPosition:!0,hasPositionAssigned:k,isByePosition:V,validActions:A,...Q}}function qw({policyDefinitions:t,appliedPolicies:e,drawType:i}){var r,n;let a=(r=t==null?void 0:t[n0])==null?void 0:r.drawTypeCoercion,o=(n=e==null?void 0:e[n0])==null?void 0:n.drawTypeCoercion;return(typeof a=="boolean"?a:void 0)??(i&&(a==null?void 0:a[i]))??(typeof o=="boolean"?o:void 0)??(i&&(o==null?void 0:o[i]))??!0}function Iy({tournamentRecord:t,drawDefinition:e,stage:i=Ne,structureId:r,structure:n}){var a;if(!t)return{error:ve};if(!n&&!e)return{error:_e};if(!n&&!r&&((a=e==null?void 0:e.structures)==null?void 0:a.filter(l=>l.stage===i).length)===1&&(n=e.structures.find(l=>l.stage===i)),!n&&!r)return{error:Xa};let{error:o,positionAssignments:s}=si({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:s??[],structureId:n==null?void 0:n.structureId,error:o}}function g_({structureId:t,drawDefinition:e}){if(!e)return{error:_e};if(!Pi(t))return{error:le};let i=Sv({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!ji([Kd,Bo,DP,Yd],r).length;return{...Q,valid:n}}function KQ({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:le};let i=sv(t);return i?{drawSize:i}:te({result:{error:le},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function Yw(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:o,event:s}=t||{},l="getSeedsCount",u=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let h=tc({tournamentRecord:a,drawDefinition:o,event:s});if(h.error)return te({result:h,stack:l});i=h.policyDefinitions}let c=st(u);if(u&&!c)return te({result:{error:le},context:{participantsCount:u},stack:l});if(n&&!c)return te({result:{error:g9},stack:l});if(isNaN(r))if(u)({drawSize:r}=KQ({participantsCount:u}));else return te({result:{error:Qb},stack:l});let d=n&&u||r;if(d&&d>r)return{error:rF};let p=i==null?void 0:i[ko];if(!p)return{error:n9};let m=p.seedsCountThresholds;return m?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:m.filter(h=>e?h.drawSize<=r:r===h.drawSize).reduce((h,f)=>u&&u>=f.minimumParticipantCount?f.seedsCount:h,0)}):{error:jK}}function hR({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:o,event:s}){var l;if((!o||!n)&&i&&({participants:o,participantMap:n}=Ai({tournamentRecord:i})),!o)return{error:ew};if(!Array.isArray(o))return{error:le};if(!s)return{error:Ii};let u=(e==null?void 0:e[_r])??(r==null?void 0:r[_r])??Pv[_r],c=(a??((l=u==null?void 0:u.participants)==null?void 0:l.enforceGender))!==!1,{eventType:d,gender:p}=s,m=d===Ou,h=d===Ca&&Jt||m&&gt||Dt,f=Object.assign({},...(t??s.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),g=Object.keys(f),v=o.filter(y=>g.includes(y.participantId)).filter(y=>{let I=RPe({participant:y,participantType:h,eventType:d,entryStatusMap:f}),b=EPe({genderEnforced:c,participantMap:n,eventGender:p,participant:y,isDoubles:m,mismatch:I});return I||!b});if(v.length){let y=v.map(I=>I.participantId);return{error:XK,invalidParticipantIds:y}}return{...Q,valid:!0}}function RPe({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[Ou,Ca].includes(i)&&t.participantType===Dt&&(gd(n)||n===Ql);return t.participantType!==e&&!a}function EPe(t){var e,i,r;let{participant:n,participantMap:a,eventGender:o,mismatch:s,isDoubles:l,genderEnforced:u}=t,c=!s&&l&&dt(((e=n==null?void 0:n.individualParticipantIds)==null?void 0:e.map(h=>{var f,g,v;return(v=(g=(f=a==null?void 0:a[h])==null?void 0:f.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],d=!o||!(c!=null&&c.length)||Fs===o||[Qt,hi].includes(o)&&c[0]===o||jn===o&&(c.length===1&&((i=n.individualParticipantIds)==null?void 0:i.length)===1||c.length===2),p=(r=n==null?void 0:n.person)==null?void 0:r.sex,m=!(n!=null&&n.person)||!o||[Fs,jn].includes(o)||[Qt,hi].includes(o)&&p===o;return!u||d&&m}function JQ({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:r,uuids:n}){var a;let o="generateQualifyingSTructures",s=[],l=[],u=[],c=(g,v)=>g.stageSequence-v.stageSequence,d=(g,v)=>g.roundTarget-v.roundTarget,p=0,m=0,h,f=1;for(let g of t.sort(d)){let v=g.structureProfiles||[];f=g.roundTarget||f;let y=1,I=0,b,S,w;for(let U of(v||[]).sort(c)){let T=Bx(U.drawSize||U.participantsCount),{qualifyingRoundNumber:D,structureOptions:P,matchUpFormat:E,structureName:R,structureId:N,drawType:A}=U,M=U.matchUpType,C=U.qualifyingPositions||CPe({drawSize:T,qualifyingRoundNumber:D}),O,k,x;if(!st(T))return te({result:{error:Qb},stack:o});let F=t.length>1?`${f}-`:"",$=v.length>1||F?y:"",_=R||(F||$?`${tn(Je)} ${F}${$}`:tn(Je));if(A===as){let{structures:L,groupCount:B,maxRoundNumber:V}=kw({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),stage:Je,structureOptions:P,appliedPolicies:e,stageSequence:y,matchUpType:M,roundTarget:f,drawSize:T,idPrefix:i,isMock:r,uuids:n});I=B,O=V,k=L[0],h=[1]}else({drawSize:T,matchUps:x,roundLimit:O}=hl({qualifyingRoundNumber:D,qualifyingPositions:C,matchUpType:M,drawSize:T,idPrefix:i,isMock:r,uuids:n})),k=uo({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),qualifyingRoundNumber:O,stage:Je,matchUpFormat:E,stageSequence:y,matchUpType:M,roundLimit:O,matchUps:x}),f&&_t({extension:{name:Ul,value:f},element:k}),I=((a=x==null?void 0:x.filter(L=>L.roundNumber===O))==null?void 0:a.length)||0;if(y>1){let{link:L}=_w({sourceStructureId:S,sourceRoundNumber:b,targetStructureId:k.structureId,finishingPositions:w===ku?[1]:void 0,linkType:w});u.push(L),p+=(T||0)-I}else p+=T||0;w=A===as?ku:xu,S=k.structureId,b=O,l.push(k),y+=1}m+=I,s.push({qualifiersCount:I,finalQualifyingRoundNumber:b,finalQualifyingStructureId:S,finishingPositions:h,roundTarget:f,linkType:w}),f+=1}return{qualifiersCount:m,qualifyingDrawPositionsCount:p,qualifyingDetails:s,structures:l,...Q,links:u}}function CPe({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function XQ(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=tt(t.drawSize),n=e&&t.drawType!==Ha&&(typeof e=="boolean"||e<=2)&&r===2&&Qs||t.drawType||Qs,a=J8.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=Qs;else if(r<4&&i)return{...te({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:nP},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function MPe(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:tn(Ne),...t,stage:Ne},{structures:a,groupCount:o,groupSize:s}=kw(n);if(o<1)return{error:k9};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:tn(Bi)}],[u]=a,{structures:c,links:d}=pQ({sourceStructureId:u.structureId,requireSequential:r,drawDefinition:e,playoffGroups:l,groupCount:o,groupSize:s,...t});return c&&a.push(...c),{...Q,structures:a,links:d}}function NPe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),n=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),o=r.map((u,c)=>{let d=r.indexOf(u)%2?Bo:Kd,p=1+c;return{linkType:Kl,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),s={linkType:xu,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Bo,roundNumber:n,structureId:t.structureId}},l=[{linkType:xu,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Bo,roundNumber:1,structureId:i.structureId}},{linkType:Kl,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Bo,roundNumber:1,structureId:i.structureId}}];return[...o,s,...l]}function APe({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let o=[],{matchUps:s}=Bc({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=wc({structureName:t||tn(Ne),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:Ne,matchUpType:e,matchUps:s});o.push(l);let u=r/2,{matchUps:c}=Bc({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=wc({structureName:tn(K8),matchUps:c,structureId:a==null?void 0:a.pop(),stage:an,stageSequence:2,matchUpType:e});o.push(d);let{matchUps:p}=hl({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),m=wc({structureName:tn(Y8),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:Bi,matchUpType:e});o.push(m);let h=NPe({mainStructure:l,consolationStructure:d,deciderStructure:m});return{structures:o,links:h,...Q}}function OPe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:o,isMock:s,uuids:l}=t;if(!st(o)||o<2)return{matchUps:[],roundsCount:0};if(Os(o))return hl(t);let u=kPe(o),c=u.shift(),d=De(1,((c==null?void 0:c.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],m=1;({matchUps:p}=v0({roundNumber:m,matchUpType:n,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:l})),m++;let h=t.roundLimit||e;for(let g of u){let v=g.participantsCount/2,y=De(1,v+1);r&&v===r&&(h=m-1);let I=y.map(b=>{let S=JL({roundPosition:b,roundNumber:m,idPrefix:a,uuids:l});return{roundPosition:b,roundNumber:m,matchUpId:S}});p.push(...I),m++}let f=m-1;return p=Rw({finishingPositionOffset:i,lucky:!0,roundsCount:f,roundLimit:h,matchUps:p}),h&&(p=p.filter(g=>g.roundNumber<=h)),{matchUps:p,roundsCount:f,roundLimit:h}}function kPe(t){let e=tt(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),o=a===1,s=!!(!o&&a%2);i=!o&&s?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:s})}return n}function QQ(t){var e,i;let{playoffAttributes:r,stageSequence:n=1,stage:a=Ne,matchUpType:o,drawSize:s,uuids:l}=t,u=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,c=t.structureId||u()||(l==null?void 0:l.pop()),d=t.appliedPolicies??Bt(t),p=((e=t.policyDefinitions)==null?void 0:e[dg])||(d==null?void 0:d[dg]);t.skipRounds=t.skipRounds||s<=4&&(p!=null&&p.feedFromMainFinal?0:1)||0;let m=t.structureName??((i=r==null?void 0:r[0])==null?void 0:i.name)??tn(Ne),h=()=>{let{matchUps:f}=hl(t);return{structures:[uo({stageSequence:n,structureName:m,matchUpType:o,structureId:c,matchUps:f,stage:a})],links:[],...Q}};return{generators:{[Ha]:()=>({structures:[uo({finishingPosition:Jd,stageSequence:n,structureName:m,matchUps:[],matchUpType:o,structureId:c,stage:a})],links:[],...Q}),[Pp]:()=>{let{matchUps:f}=OPe(t);return{structures:[uo({stageSequence:n,structureName:m,matchUpType:o,structureId:c,matchUps:f,stage:a})],links:[],...Q}},[Qs]:()=>h(),[ow]:()=>APe(t),[og]:()=>Tf({...t,roundOffsetLimit:3,playoffAttributes:r??CF}),[sg]:()=>Tf({...t,roundOffsetLimit:2,playoffAttributes:r??MF}),[Bi]:()=>Tf(t),[gv]:()=>{let{matchUps:f}=Bc({drawSize:s,uuids:l,matchUpType:o});return{structures:[uo({stageSequence:n,structureName:m,matchUpType:o,structureId:c,stage:Ne,matchUps:f})],links:[],...Q}},[sw]:()=>uQ(t),[lg]:()=>Gp({...t,feedRounds:1,fmlc:!0}),[q8]:()=>Gp({...t,feedRounds:1}),[PF]:()=>Gp({...t,feedsFromFinal:1}),[RF]:()=>Gp({...t,feedsFromFinal:2}),[EF]:()=>Gp({...t,feedsFromFinal:3}),[lw]:()=>Gp(t),[PP]:()=>dQ(t),[as]:()=>kw(t),[Jl]:()=>MPe(t)}}}function v_(t){var e,i,r,n,a;let{enforceMinimumDrawSize:o=!0,overwriteExisting:s,appliedPolicies:l,staggeredEntry:u,drawDefinition:c,tieFormat:d,isMock:p,uuids:m}=t||{},h=tt(t.drawSize),f=t.drawTypeCoercion??qw({appliedPolicies:l,drawType:t.drawType}),g="generateDrawStructuresAndLinks",v=XQ({drawType:t.drawType,enforceMinimumDrawSize:o,drawTypeCoercion:f,drawSize:h});if(v.error)return v;let y=v.drawType,I=[],b=[],S=(t==null?void 0:t.matchUpType)??ri,w=(e=c==null?void 0:c.structures)==null?void 0:e.filter(({stage:j})=>j===Je);w&&I.push(...w);let U=w==null?void 0:w.map(({structureId:j})=>j),T=(i=c==null?void 0:c.structures)==null?void 0:i.find(({stage:j,stageSequence:z})=>j===Ne&&z===1),D=(r=c==null?void 0:c.links)==null?void 0:r.filter(j=>j.target.structureId===(T==null?void 0:T.structureId)&&(U==null?void 0:U.includes(j.source.structureId))),P=(j,z)=>{var W;if(j.linkType===ku&&z!=null&&z.structures){let q=j.source.finishingPositions||[];return z.structures.length*q.length}else if(j.linkType===xu&&(W=z==null?void 0:z.matchUps)!=null&&W.length){let q=j.source.roundNumber;return z.matchUps.filter(({roundNumber:Y})=>Y===q).length}},E=w==null?void 0:w.map(j=>{var z,W,q;let Y=D==null?void 0:D.find(K=>K.target.structureId===j.structureId),re=((W=(z=si({structure:j}))==null?void 0:z.positionAssignments)==null?void 0:W.length)??0;if(!Y)return re;let J=Y==null?void 0:Y.source.structureId,H=(q=c.structures)==null?void 0:q.find(K=>K.structureId===J),Z=P(Y,H)||0;return re-Z}).filter(Boolean).reduce((j,z)=>j+z,0),R=D==null?void 0:D.map(j=>{let z=j.source.structureId,W=w==null?void 0:w.find(q=>q.structureId===z);return P(j,W)}).filter(Boolean).reduce((j,z)=>j+z,0),N=!!(T&&!((n=T==null?void 0:T.matchUps)!=null&&n.length));if(w!=null&&w.length&&!N)return{error:dM};let A=!(w!=null&&w.length)&&t.qualifyingProfiles,M=(A==null?void 0:A.length)&&JQ({idPrefix:t.idPrefix,qualifyingProfiles:A,appliedPolicies:l,isMock:p,uuids:m});if(M!=null&&M.error)return M;let{qualifyingDrawPositionsCount:C,qualifyingDetails:O,qualifiersCount:k}=M||{qualifyingDrawPositionsCount:E,qualifiersCount:R};C&&(M!=null&&M.structures&&I.push(...M.structures),M!=null&&M.links&&b.push(...M.links)),Object.assign(t,Ge({drawSize:h,matchUpType:S,tieFormat:d}));let x=y!==Ha&&(!h||h<2||!u&&![gv,Pp].includes(y)&&([Jl,as].includes(y)&&h<3||![as,Jl].includes(y)&&!Os(h)));if(x&&!C)return te({context:{drawSize:h,invalidDrawSize:x},result:{error:nP},stack:g});let{generators:F,error:$}=QQ(t);if($)return{error:$};let _=F[y];if(!_)return{error:Hx};let L=_==null?void 0:_();if(L.error)return L;let{structures:B,links:V}=L;if(B!=null&&B.length){let j=B.find(({stage:z,stageSequence:W})=>z===Ne&&W===1);if(T&&j){if(N){let z=j.structureId;if(j.structureId=T.structureId,V==null?void 0:V.length)for(let W of V)W.source.structureId===z&&(W.source.structureId=T.structureId),W.target.structureId===z&&(W.target.structureId=T.structureId)}else if(!s)return{error:dM}}I.push(...B)}I.sort(Mh),V!=null&&V.length&&b.push(...V);let G=L.structures.find(({stage:j,stageSequence:z})=>j===Ne&&z===1);for(let j of O||[]){let{finalQualifyingRoundNumber:z,finalQualifyingStructureId:W,roundTarget:q,finishingPositions:Y,linkType:re}=j,J=G&&((a=_w({targetStructureId:G.structureId,sourceStructureId:W,sourceRoundNumber:z,finishingPositions:Y,targetEntryRound:q,linkType:re}))==null?void 0:a.link);if(J!=null&&J.error)return J;J&&b.push(J)}return D&&b.push(...D),{...Q,qualifyingResult:{qualifyingDrawPositionsCount:C,qualifiersCount:k},structures:I,links:b}}function I_(t){var e,i;let{modifyOriginal:r=!0,stageSequence:n=1,isMock:a}=t||{},o="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return te({result:{error:_e},stack:o});let s=r?t.drawDefinition:Me(t.drawDefinition,!1,!0),{tieFormat:l,matchUpType:u}=t;if(l){let S=qn({tieFormat:l});if(S.error)return S}l=Yr(l??((e=In({drawDefinition:s}))==null?void 0:e.tieFormat)),u=u??(s.matchUpType||ri),t.tieFormat=l,t.matchUpType=u;let c=p0({drawDefinition:s,stage:Ne});t.drawSize=t.drawSize??c,!c&&t.drawSize&&f0({drawSize:t.drawSize,drawDefinition:s,stageSequence:n,stage:Ne});let d=ln({drawDefinition:s}).drawMatchUps.map(Pr),p=v_(t);if(p.error)return te({result:p,stack:o});let{structures:m,links:h,qualifyingResult:f}=p;s.structures=m,s.links=h;let g=Math.max(t.qualifiersCount??0,(f==null?void 0:f.qualifiersCount)||0);if(f!=null&&f.qualifyingDrawPositionsCount&&!p0({stage:Je,drawDefinition:s})){let S=f0({drawSize:f.qualifyingDrawPositionsCount,stage:Je,drawDefinition:s});if(S.error)return S}if(g){let S=QX({qualifiersCount:g,drawDefinition:s,stage:Ne});if(S.error)return S}let v=t.drawSize??c;Object.assign(t,Ge({drawSize:v,matchUpType:u,tieFormat:l}));let{matchUps:y,matchUpsMap:I}=gr({drawDefinition:s});l&&(y==null||y.forEach(S=>{if(!d.includes(S.matchUpId)){let{tieMatchUps:w}=Bw({tieFormat:l,matchUp:S,isMock:a});Object.assign(S,{tieMatchUps:w,matchUpType:u})}}));let{inContextDrawMatchUps:b}=tp({drawDefinition:s,matchUpsMap:I});return ui({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,drawDefinition:s}),{inContextDrawMatchUps:b,drawDefinition:s,matchUpsMap:I,...Q,structures:m,matchUps:y,links:h}}function Kw(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,o;if(!eZ({scaleItem:n}))return{error:km};if(r&&Array.isArray(i.participants)&&(o=i.participants.find(s=>s.participantId===r),o)){if(o.participantType===Gn&&(n==null?void 0:n.eventType)!==Ca)return{error:km};let s=tZ({removePriorValues:e,participant:o,scaleItem:n});if(s.error)return s;a=!s.valueChanged;let{topics:l}=Do();l.includes(on)&&ut({topic:on,payload:{tournamentId:i.tournamentId,participants:[o]}})}return a&&{...Q,info:dF,existingValue:n==null?void 0:n.scaleValue}||o&&{...Q,newValue:n==null?void 0:n.scaleValue}||{error:Wi}}function ZQ(t){var e;let{scaleItemsWithParticipantIds:i=[],removePriorValues:r,tournamentRecord:n,auditData:a,context:o}=t;if(!n)return{error:ve};if(!n.participants)return{error:ew};let s=0,l={},u=[];for(let p of i){let m=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let h of p.scaleItems)if(eZ({scaleItem:h}))Array.isArray(l[m])||(l[m]=[]),l[m].push(h);else return{error:km}}for(let p of n.participants){let{participantId:m}=p||{};if(Array.isArray(l[m]))for(let h of l[m]){if(p.participantType===Gn&&(h==null?void 0:h.eventType)!==Ca)return te({context:{participantId:m,scaleItem:h,participantType:p.participantType},info:"Invalid participantType for eventType",result:{error:km}});tZ({participant:p,scaleItem:h,removePriorValues:r}),u.push(p),s++}}let c=s?void 0:hv,{topics:d}=Do();if(d.includes(on)&&s&&ut({topic:on,payload:{tournamentId:n.tournamentId,participants:u}}),o){let{eventId:p,drawId:m,...h}=o,f=((e=h.scaleAttributes)==null?void 0:e.scaleType)&&[h.scaleAttributes.scaleType];if(Object.keys(h).length){let g={itemType:KF,itemValue:h};if(f&&(g.itemSubTypes=f),m||p){let{drawDefinition:v,event:y}=Kn({tournamentRecord:n,eventId:p,drawId:m});m&&zL({drawDefinition:v,timeItem:g}),p&&Gh({event:y,timeItem:g})}else zw({tournamentRecord:n,timeItem:g})}}return a&&d.includes(Iu)&&ut({topic:Iu,payload:a}),Ge({...Q,modificationsApplied:s,info:c})}function eZ({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e==null?void 0:e.includes(r)).length===i.length}function tZ({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:Sh};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(u=>r.includes(u)&&i[u]).length!==n.length)return{error:km};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:o}=_l({scaleAttributes:i,participant:e}),s=u=>[void 0,null,""].includes(u),l=!(s(o==null?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o==null?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[Xd,u,c,d].join("."),m=Ge({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(m.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(h=>h.itemType!==p)),e.timeItems.push(m)}return{...Q,valueChanged:l,newValue:i.scaleValue}}function y_(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=We(t,[{[Ur]:!0},{modifiedScaleValues:!0,[Xn]:ia}]);if(n.error)return n;for(let a in i){let o=Kw({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(o.error)return o}return{...Q}}function vg(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:fr};let{participant:a,tournamentId:o}=ad({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{..._l({participant:a,scaleAttributes:i}),tournamentId:o}:{error:Wi}}var xPe=(t=0)=>250/Math.pow(t+5,.4),FPe=()=>1;function LPe(t=3,e=2){let i=t/e;return isNaN(i)?lf.kDefault():i}var lf={nSpread:400,diffThreshold:.125,kCalc:xPe,kMultiplier:LPe,kDefault:FPe};function iZ(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=Tr,winnerCountables:n=1,loserCountables:a=0,ratingType:o=Lo,maxCountables:s,countables:l}=t||{},u=r==null?void 0:r[o];if(!u)return{error:Qe};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,m=d?c.slice().reverse():c,h=(C,O)=>parseFloat(O)>=Math.min(...C)&&parseFloat(O)<=Math.max(...C);(!h(c,e)||!h(c,i))&&(h(c,e)||(e=u.defaultInitialization),h(c,i)||(i=u.defaultInitialization));let f=hf({targetRange:Tr[Lo].range,sourceRange:m,value:d?c[0]-e:e}),g=hf({targetRange:Tr[Lo].range,sourceRange:m,value:d?c[0]-i:i}),v=(C,O)=>1/(1+Math.pow(10,(O-C)/lf.nSpread)),y=v(f,g),I=v(g,f),b=lf.kCalc(n),S=lf.kCalc(a),w=lf.kMultiplier(s,l),U=f+w*b*(1-y),T=g+w*S*(0-I),D=hf({sourceRange:Tr[Lo].range,value:U,targetRange:m}),P=hf({sourceRange:Tr[Lo].range,value:T,targetRange:m}),E=d?c[0]-D:D,R=parseFloat(E.toFixed(p)),N=d?c[0]-P:P,A=parseFloat(N.toFixed(p)),M=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(D>P&&M>lf.diffThreshold||R<0||A<0)&&(R=e,A=i),{newWinnerRating:R,newLoserRating:A}}var _Pe=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function rZ(t){var e,i;let r=We(t,[{[Ur]:!0},{matchUpIds:!0,[Xn]:dn,[Ko]:bh},{ratingType:!1,[Jr]:b=>Tr[b]}]);if(r.error)return r;let{updateParticipantRatings:n,removePriorValues:a=!0,tournamentRecord:o,ratingType:s=Lo,refreshDynamic:l,considerGames:u,drawDefinition:c,matchUpIds:d,asDynamic:p}=t,m=Tr[s],{accessor:h}=m,f={},g=(t.matchUps||l&&Pn({drawDefinition:c,tournamentRecord:o,inContext:!0,matchUpFilters:{matchUpStatuses:yr}}).matchUps||Hr({matchUpFilters:{matchUpIds:d,matchUpStatuses:yr},tournamentRecord:o,inContext:!0}).matchUps)??[],v=`${s}.${$F}`,y=p?v:s;g.sort(_h);for(let b of g){let{endDate:S,matchUpFormat:w,score:U,sides:T,winningSide:D}=b,P=b.matchUpType,E={eventType:P,scaleName:s,scaleType:yc},R={scaleName:v,eventType:P,scaleType:yc},N=Object.assign({},...(T??[]).map(_=>{let{sideNumber:L,participant:B}=_;return L&&{[L]:[B==null?void 0:B.participantId,...(B==null?void 0:B.individualParticipantIds)??[]].filter(Boolean).flat()}})),A=Object.assign({},...Object.values(N).flat().map(_=>{let L=f[_],B=!l||L?vg({scaleAttributes:R,tournamentRecord:o,participantId:_}).scaleItem:void 0,V=vg({tournamentRecord:o,scaleAttributes:E,participantId:_}).scaleItem,G=h?{[h]:void 0}:void 0;return _&&{[_]:B??V??{scaleName:y,eventType:P,scaleDate:S,scaleType:yc,scaleValue:G}}})),M=w?Ln(w):{},C=(M==null?void 0:M.bestOf)||1,O=(M==null?void 0:M.setsTo)||1,k=u?C&O:C,x=(U==null?void 0:U.sets)&&_Pe(U.sets)||D===1&&[1,0]||[0,1],F=D?N[D]:[],$=D?N[3-D]:[];for(let _ of F){let L=(e=A[_])==null?void 0:e.scaleValue,B=typeof L=="object"?L[h]:L;for(let V of $){let G=(i=A[V])==null?void 0:i.scaleValue,j=typeof G=="object"?G[h]:G,z=D?x[D]:[0,0],W=D?x[3-D]:[0,0],{newWinnerRating:q,newLoserRating:Y}=iZ({winnerCountables:z,loserCountables:W,maxCountables:k,winnerRating:B,loserRating:j,ratingType:s}),re=h?{...L,[h]:q}:q,J=h?{...G,[h]:Y}:Y;A[_].scaleValue=re,A[V].scaleValue=J,A[_].scaleName=y,A[V].scaleName=y}}Object.assign(f,A),n&&y_({tournamentRecord:o,modifiedScaleValues:f,removePriorValues:a})}let I=g.map(({matchUpId:b})=>b);return{...Q,modifiedScaleValues:f,outputScaleName:y,processedMatchUpIds:I}}function fR(t){var e;let{matchUpIds:i=[],drawDefinition:r,roundNumber:n,newRound:a,isMock:o,event:s}=t;if(typeof r!="object")return{error:_e};let{participantIdPairings:l,matchUpsCount:u}=t,c=pR(t);if(c.error)return te({result:c});let{lastRoundNumber:d,availableMatchUpsCount:p=0,roundMatchUpsCount:m=0}=c;if(!u)a?u=m:p>0&&(u=p);else if(u>m&&t.restrictMatchUpsCount!==!1)return te({result:{error:le,info:"matchUpsCount error",context:{roundMatchUpsCount:m}}});if(l&&!Array.isArray(l)||u&&!st(u)||i&&!Array.isArray(i)||!l&&!u)return{error:le,info:"matchUpsCount or pairings error"};if(u&&t.restrictMatchUpsCount!==!1&&u>32)return{error:le,info:"matchUpsCount must be less than 33"};if(n&&!t.ignoreLastRoundNumber&&n-1>(d||0))return{error:le,info:"roundNumber error"};let h=n??(a&&(d??0)+1||d||1);l=l??De(0,u).map(()=>({participantIds:[void 0,void 0]}));let f=v=>{if(!t.idPrefix)return;let y=r.drawId,I=t.idPrefix??"ah";return`${y}-${I}-${h}-${v}`},g=l==null?void 0:l.map((v,y)=>{let I=(v==null?void 0:v.participantIds)??[void 0,void 0];I.push(void 0,void 0);let b=I.slice(0,2).map((w,U)=>Ge({sideNumber:U+1,participantId:w})),S=i[y]??f(y)??Ht();return{roundNumber:h,matchUpStatus:Qi,matchUpId:S,sides:b}});if(g!=null&&g.length){let v=(e=In({drawDefinition:r,event:s}))==null?void 0:e.tieFormat;v&&g.forEach(y=>{let{tieMatchUps:I}=Bw({tieFormat:v,matchUp:y,isMock:o});Object.assign(y,{tieMatchUps:I,matchUpType:gi})})}return{roundNumber:h,matchUpsCount:(g==null?void 0:g.length)??0,matchUps:g,...Q}}function $Pe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),o=Object.keys(i),s=[],l=j2({actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),u=[qE(l)];s.push(l);let c=l.value,d=l,p=1,m=0,h=o.length,f;do h-=1,f=o.length*i[o[0]].length;while(f>t&&h>5);let g=[];o.forEach(y=>{i[y].slice(0,h).forEach(I=>{m+=1;let b=fm(y,I.opponent);if(!g.includes(b)){let S=j2({stipulated:[[y,I.opponent]],actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!u.includes(qE(S))){u.push(qE(S)),s.push(S);let{maxDelta:w,value:U}=S;w<d.maxDelta&&(d=S),(U<c||U===c&&Math.round(Math.random()))&&(c=U),g.push(b),p+=1}}}),s=s.filter(I=>Math.abs(I.value-c)<5)}),s.sort((y,I)=>y.maxDiff-I.maxDiff);let v=va(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:m,candidate:v}}function qE(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function j2({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let o=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,m]=d,h=fm(p,m),f=i[h];s.push({participantIds:d,value:f}),l+=i[h]}),Cr(t,a).map(d=>Tn(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((m,h)=>o.includes(h)||m,!1)){o.push(...p);let m=d.value;l+=m,s.push({participantIds:p,value:m})}}),s.sort((d,p)=>d.value-p.value);let u=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=fm(m,h),g=r[f];return g>d?g:d},0),c=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=fm(m,h),g=n[f];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:u,maxDiff:c}}function fm(t,e){return[t,e].sort(ZP).join("|")}function nZ({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let o=fm(a,n);i.includes(o)||i.push(o)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function BPe({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(Tt);if(r.length===2){let[n,a]=r,o=fm(n,a);e.includes(o)||e.push(o)}}return{encounters:e}}function VPe({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(o=>r(n,o));i[n]=a.sort((o,s)=>o.value-s.value)}function r(n,a){let o=fm(n,a);return{opponent:a,value:e[o]}}return{pairingValues:i}}var jPe=0;function GPe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){var a;let o=((a=Tr[r])==null?void 0:a.defaultInitialization)??jPe;return n.split("|").map(s=>{var l;if(i===go){let u=(l=t==null?void 0:t.find(c=>c.participantId===s))==null?void 0:l.individualParticipantIds;return u?u==null?void 0:u.map(c=>e[c]||o):o*2}else return e[s]||o})}function HPe(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:o,deltaObjects:s,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;n.forEach(I=>{let b=GPe({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:I}),S=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?S:S*-1)||0,U=Math.abs(b[0]-b[1])+w,T=Math.abs(b[0]-b[1]);s[I]=T,l[I]||(l[I]=0),l[I]+=U?Math.pow(U,2):0});let p=n.map(I=>({pairing:I,value:l[I]})).sort((I,b)=>I.value-b.value),{pairingValues:m}=VPe({possiblePairings:r,valueObjects:l}),{candidate:h,candidatesCount:f,deltaCandidate:g,iterations:v}=$Pe({valueSortedPairings:p,maxIterations:a,pairingValues:m,deltaObjects:s,valueObjects:l}),{participantIdPairings:y}=o?g:h;return{participantIdPairings:y,candidatesCount:f,deltaCandidate:g,iterations:v,candidate:h}}var zPe=100,WPe=100,qPe=4e3;function b_(t){var e,i;let{encounterValue:r=zPe,sameTeamValue:n=WPe,maxIterations:a=qPe,updateParticipantRatings:o,generateMatchUps:s=!0,ignoreLastRoundNumber:l,iterationMatchUps:u,tournamentRecord:c,dynamicRatings:d,refreshDynamic:p,participantIds:m,drawDefinition:h,roundNumber:f,structureId:g,matchUpIds:v,eventType:y,scaleName:I,idPrefix:b,isMock:S,salted:w,event:U}=t;if(!h)return{error:_e};if(!t.structure&&!g)return{error:Ni};let T=t.structure||rt({drawDefinition:h,structureId:g}).structure;if(!At(T))return{error:Tp};if(!(m!=null&&m.length))return{error:Zc};let D=[...u??[],...(T==null?void 0:T.matchUps)??[]],{encounters:P}=BPe({matchUps:D}),E=(c==null?void 0:c.participants)??[],R={};if(d){let z=dt(T!=null&&T.matchUps?T.matchUps.map(({roundNumber:q})=>q):[]),W=Math.max(...z,0);if(W){let q=(e=T==null?void 0:T.matchUps)==null?void 0:e.filter(({roundNumber:re})=>re===W).map(({matchUpId:re})=>re),Y=rZ({ratingType:I??((i=U==null?void 0:U.category)==null?void 0:i.ratingType),updateParticipantRatings:o,tournamentRecord:c,asDynamic:!0,refreshDynamic:p,drawDefinition:h,matchUpIds:q});if(Y.error)return Y;Y.modifiedScaleValues&&(R=Y.modifiedScaleValues)}}let{valueObjects:N}=YPe({tournamentParticipants:E,encounterValue:r,sameTeamValue:n,encounters:P}),{uniquePairings:A,possiblePairings:M,deltaObjects:C}=nZ({participantIds:m}),O=Object.values(R).length?R:t.adHocRatings,k={tournamentParticipants:E,possiblePairings:M,participantIds:m,uniquePairings:A,drawDefinition:h,maxIterations:a,adHocRatings:O,deltaObjects:C,valueObjects:N,eventType:y,scaleName:I,structure:T,salted:w},{candidatesCount:x,participantIdPairings:F,deltaCandidate:$,iterations:_,candidate:L}=HPe(k);if(!x)return{error:pP};let B,V;if(s){let z=fR({structureId:T==null?void 0:T.structureId,ignoreLastRoundNumber:l,participantIdPairings:F,newRound:!0,drawDefinition:h,roundNumber:f,matchUpIds:v,idPrefix:b,isMock:S,event:U});if(z.error)return z;B=z.roundNumber,V=z.matchUps}let{maxDelta:G,maxDiff:j}=L;return{roundNumber:B,participantIdPairings:F,modifiedScaleValues:R,candidatesCount:x,deltaCandidate:$,...Q,iterations:_,matchUps:V,maxDelta:G,maxDiff:j}}function YPe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let o of t)n[o]||(n[o]=0),n[o]+=i;let a=e==null?void 0:e.filter(({participantType:o})=>o===Jt);if(a)for(let o of a){let s=o.individualParticipantIds??[],{uniquePairings:l}=nZ({participantIds:s});for(let u of l)n[u]||(n[u]=0),n[u]+=r}return{valueObjects:n}}function aZ(t){var e,i,r,n;let{drawType:a=Qs,attachConsolation:o=!0,applyPositioning:s=!0,tournamentRecord:l,staggeredEntry:u,automated:c,placeByes:d,isMock:p,event:m}=t,h=t==null?void 0:t.drawDefinition;if(!h)return{error:_e};let f=Lr,g=Nh({stageSequence:1,drawDefinition:h,stage:f}),v=[as,ow,Jl].includes(a)?g.length:sv(g.length);if(!u&&a===gv&&g.length<2||a===as&&g.length<3)return{error:nP};let{tieFormat:y,matchUpType:I}=t;if(y){let M=qn({tieFormat:y});if(M.error)return M}y=Yr(y??((e=In({drawDefinition:h}))==null?void 0:e.tieFormat)),I=I??h.matchUpType;let{structures:b}=ss({stageSequence:1,drawDefinition:h,stage:f});if(b.length>1)return{error:ZK};if((r=(i=b==null?void 0:b[0])==null?void 0:i.matchUps)!=null&&r.length)return{error:mF};let S=(n=b==null?void 0:b[0])==null?void 0:n.structureId;Object.assign(t,Ge({structureName:t.structureName??tn(Lr),structureId:S,matchUpType:I,tieFormat:y,drawSize:v,stage:f}));let w=QQ(t);if(w.error)return w;let U=w.generators[a];if(!U)return{error:Hx};let T=U==null?void 0:U();if(T.error)return T;let{structures:D,links:P}=T,E=D.map(M=>qt({structure:M}).matchUps).flat();y&&E.forEach(M=>{let{tieMatchUps:C}=Bw({matchUp:M,tieFormat:y,isMock:p});Object.assign(M,{tieMatchUps:C,matchUpType:I})}),(!s||!o)&&(h=Me(h,!1,!0)),h.links||(h.links=[]),P.length&&h.links.push(...P);let R=D.map(({structureId:M})=>M);h.structures||(h.structures=[]);let N=h.structures.map(({structureId:M})=>M);h.structures=h.structures.map(M=>R.includes(M.structureId)?D.find(({structureId:C})=>C===M.structureId):M);let A=D.filter(({structureId:M})=>!N.includes(M));return A.length&&h.structures.push(...A),c&&Lw({seedingProfile:t.seedingProfile,applyPositioning:s,tournamentRecord:l,drawDefinition:h,structureId:S,placeByes:d,drawSize:v,event:m}),o&&ui({drawDefinition:h}),{links:P,structures:D,...Q}}var w_={};wt(w_,{addGame:()=>mZ,addPoint:()=>pZ,addSet:()=>fZ,addShot:()=>hZ,analyzeScore:()=>R_,analyzeSet:()=>by,calculateHistoryScore:()=>uZ,checkScoreHasValue:()=>br,checkSetIsComplete:()=>IR,clearHistory:()=>dZ,generate:()=>oZ,generateScoreString:()=>$l,generateTieMatchUpScore:()=>Gw,getSetComplement:()=>C_,getTiebreakComplement:()=>UR,helpers:()=>yZ,isValidMatchUpFormat:()=>Ea,keyValueScore:()=>zZ,mutate:()=>lZ,parseMatchUpFormat:()=>Ln,parseScoreString:()=>w0,query:()=>JZ,redo:()=>gZ,reverseScore:()=>sZ,setServingSide:()=>cZ,stringifyMatchUpFormat:()=>wP,tidyScore:()=>KZ,umo:()=>IZ,undo:()=>vZ,validateScore:()=>E_,validateTieFormat:()=>qn});var oZ={};wt(oZ,{generateScoreString:()=>$l,generateTieMatchUpScore:()=>Gw,reverseScore:()=>sZ});function $l(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:r,reversed:n=!1,matchUpStatus:a,matchUpFormat:o,autoComplete:s,winningSide:l,sets:u}=t;if(!u)return{error:Qe,info:"missing sets"};let c=o&&Ln(o),{bestOf:d,finalSetFormat:p,setFormat:m}=c??{},h=n||!(!e||!l||l===1),f=r?KPe({matchUpStatus:a}):"",g=(u==null?void 0:u.sort(JPe).map(v).filter(Boolean).join(" "))||"";if(!f)return g;if(l===2)return`${f} ${g}`;return`${g} ${f}`;function v(y){let I=d&&y.setNumber===d&&p?p:m,b=L=>xi(L==null?void 0:L.side1Score)||xi(L==null?void 0:L.side2Score),S=(L=>xi(L==null?void 0:L.side1TiebreakScore)||xi(L==null?void 0:L.side2TiebreakScore))(y),w=(I==null?void 0:I.tiebreakSet)||!b(y)&&S,{side1Score:U,side2Score:T,side1TiebreakScore:D,side2TiebreakScore:P}=y,E=D||(xi(D)||S&&s?0:""),R=P||(xi(P)||S&&s?0:"");if(w)return`[${(h?[R,E]:[E,R]).join("-")}]`;let N=S?Math.min(E,R):"",A=N===E?1:2,M=xi(N)?`(${N})`:"",C=U||(xi(U)||s?0:""),O=T||(xi(T)||s?0:""),k=L=>!i&&A===L?M:"",x=`${C}${k(1)}`,F=`${O}${k(2)}`,$=i&&S?`(${N})`:"",_=h?`${[F,x].join("-")}${$}`:`${[x,F].join("-")}${$}`;return["-"," "].includes(_)&&(_=""),_}}function KPe({matchUpStatus:t}){let e={[zr]:"RET",[Ft]:"WO",[pr]:"DF/DF",[ir]:"WO/WO",[nd]:"SUS",[ca]:"ABN",[Pt]:"DEF",[wv]:"DR"};return t&&e[t]||""}function JPe(t,e){return t.setNumber-e.setNumber}function sZ(t){if(!(t!=null&&t.score))return{error:Qe};let{sets:e}=t.score,i=e.map(o=>{let{side1TiebreakScore:s,side2TiebreakScore:l,winningSide:u,side1Score:c,side2Score:d,setNumber:p}=o;return Ge({winningSide:u?3-u:void 0,side1TiebreakScore:l,side2TiebreakScore:s,side1Score:d,side2Score:c,setNumber:p})}),r=t==null?void 0:t.setTBlast,n=$l({setTBlast:r,sets:i}),a=$l({sets:i,reversed:!0,setTBlast:r});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:a},...Q}}var lZ={};wt(lZ,{addGame:()=>mZ,addPoint:()=>pZ,addSet:()=>fZ,addShot:()=>hZ,calculateHistoryScore:()=>uZ,clearHistory:()=>dZ,redo:()=>gZ,setServingSide:()=>cZ,umo:()=>IZ,undo:()=>vZ});function xp({matchUp:t}){let{extension:e}=It({name:LP,element:t});if(!e)return{error:jr};let{history:i=[],undoHistory:r=[]}=e.value;return{history:i,undoHistory:r,...Q}}function uZ(t){var e,i;if(!t)return{error:Qe};let{matchUp:r,updateScore:n}=t;if(!r)return{error:la};let a=((e=xp({matchUp:r}))==null?void 0:e.history)||[];if(!Array.isArray(a))return{error:le,info:"history is not an array"};let{matchUpFormat:o}=r;if(!o)return{error:Xx};if(!Ea({matchUpFormat:o}))return{error:Jx};let s=Ln(o),{bestOf:l,finalSetFormat:u,setFormat:c}=s,d=["0","15","30","40","A","G"],p={sets:[]},m=[],h,f=[0,0],g=1,v=0,y,I=0,b=R=>[1,2].includes(R),S=()=>(v+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:v,games:[]}),w=()=>({winningSide:void 0,points:[]}),U=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),T=U(),D=w(),P=S(),E=0;for(let R of a){E+=1,y=p.sets.length+1===l;let N=y&&u?u:c,{tiebreakAt:A,setTo:M,NoAD:C,tiebbreakFormat:O}=N,k=P.side1Score===A&&P.side1Score===P.side2Score,x=!!N.tiebreakSet,F=x?N.tiebreakSet:O,{tiebreakTo:$,NoAD:_}=F||{},L=()=>{h=void 0,f=[0,0],g=3-g,P.side1TiebreakScore="",P.side2TiebreakScore="",P.side1PointScore="",P.side2PointScore="",I=0},B=j=>{P.winningSide=j;let{s:z,...W}=P;p.sets.push(W),T=U(),D=w(),P=S(),L()},V=j=>{D.winningSide=j;let{g:z,...W}=D;P.games.push(W),T=U(),D=w(),L();let q=`side${j}Score`;P[q]+=1},G=j=>{T.winningSide=j;let{p:z,...W}=T;D.points.push(W),T=U(),I=0;let q=()=>f.reduce((re,J)=>re+J)%4/4>.5?g:3-g,Y=j-1;if(k||x){f[Y]+=1,h=q(),P[`side${j}TiebreakScore`]=f[Y],P[`side${3-j}TiebreakScore`]=f[1-Y];let re=_?1:2;if(f[Y]>=$&&f[Y]>=f[1-Y]+re)return V(j),{gameCompleted:!0}}else if(f[1-Y]===4&&f[Y]===3?f[1-Y]-=1:f[Y]+=1,P.side1PointScore=d[f[0]],P.side2PointScore=d[f[1]],f[Y]===5||f[Y]===4&&f[1-Y]<3||C&&f[Y]===4)return V(j),{gameCompleted:!0}};if(b(R.srv)&&(g=R.srv),["p","s","g","o"].includes(R.u)&&m.push(R.u),R.shotOutcome&&(T.shots.push(R),R.shotType==="SERVE"&&["OUT","NET"].includes(R.shotOutcome)&&(I+=1),I===2)){let j=3-g;G(j)}if(b(R.p)||st(R.pointNumber)){let j=R.winningSide||R.p;if((i=G(j))!=null&&i.gameCompleted)continue}if(b(R.g)||st(R.gameNumber)){let j=R.winningSide||R.g;D.winningSide=j;let z=`side${j}Score`,W=`side${3-j}Score`;if(m.length&&(m.includes("p"),m=[]),V(j),P[z]===M&&P[z]-P[W]>=(C?1:2)&&(B(j),y))break}if(b(R.s)||st(R.setNumber)){let j=R.winningSide||R.s;if(B(j),m.length&&(m.includes("p"),m.includes("g"),m=[]),y)break}}return E!==a.length&&console.log({error:"Match completed with excess history"}),(P.side1Score||P.side2Score||P.games.length||P.side1TiebreakScore||P.side2TiebreakScore)&&p.sets.push(P),p.scoreStringSide1=$l({...p,matchUpFormat:o}),p.scoreStringSide2=$l({...p,matchUpFormat:o,reversed:!0}),g=h||g,n&&(r.score=p),{...Q,servingSide:g,score:p}}function Fp({undoHistory:t,history:e,matchUp:i}){return _t({element:i,extension:{value:{history:e,undoHistory:t},name:LP}})}function cZ({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:tF};let{history:i=[]}=xp({matchUp:t});return i.push({srv:e}),Fp({matchUp:t,history:i})}function dZ({matchUp:t}){return Fp({matchUp:t})}function pZ({matchUp:t,point:e}){if(!e||!t)return{error:Qe};if(typeof e!="object")return{error:le,context:{point:e}};let{history:i=[]}=xp({matchUp:t});return i.push(e),Fp({matchUp:t,history:i})}function mZ({matchUp:t,game:e}){if(typeof e!="object")return{error:le,context:{game:e}};let{history:i=[]}=xp({matchUp:t});return i.push(e),Fp({matchUp:t,history:i})}function hZ({matchUp:t,shot:e}){if(typeof e!="object")return{error:Qe};let{history:i=[]}=xp({matchUp:t});return i.push(e),Fp({matchUp:t,history:i})}function fZ({matchUp:t,set:e}){if(typeof e!="object")return{error:Qe};let{history:i=[]}=xp({matchUp:t});return i.push(e),Fp({matchUp:t,history:i})}function gZ({matchUp:t}){let{history:e=[],undoHistory:i=[]}=xp({matchUp:t});return i.length&&e.push(i.pop()),Fp({matchUp:t,history:e,undoHistory:i})}function vZ({matchUp:t}){let{history:e=[],undoHistory:i=[]}=xp({matchUp:t});return i.push(e.pop()),Fp({matchUp:t,history:e,undoHistory:i})}var IZ={},yZ={};wt(yZ,{keyValueScore:()=>zZ,parseMatchUpFormat:()=>Ln,stringifyMatchUpFormat:()=>wP,tidyScore:()=>KZ});var gm=" ",VM="DEF",XPe="COMPLETED",bZ="WO",QPe="WO/WO",wZ="ABN",UZ="SUS",SZ="RET",TZ="INT",DZ=[SZ,VM,bZ,QPe,wZ,UZ,TZ],jM="DEFAULTED",PZ="WALKOVER",RZ="ABANDONED",EZ="SUSPENDED",CZ="RETIRED",MZ="INTERRUPTED",ZPe=[CZ,jM,PZ],eRe="Enter Score",Hm="()",ap="[]",U_=["up","left","shift+tab"],S_=["enter","down","tab","right"],I0="backspace",NZ="r",AZ="s",OZ="a",kZ="d",xZ="w",FZ="i",gR=[NZ,kZ,xZ,OZ,AZ,FZ],vR="space",YE=["[","("],y0=[...U_,...S_,vR,"]"],LZ="-",tRe="/",vm=LZ,Bl=LZ,_Z=[tRe],iRe=0,rRe=["=","+","num_1","num_2","shift+=","shift+-"],T_=["0","1","2","3","4","5","6","7","8","9"].concat(gR),$Z=T_.map(t=>`shift+${t}`),BZ=[vm,I0].concat(y0,_Z),VZ=[T_,$Z,BZ].join(","),nRe=[VZ,U_,S_,rRe].join(","),aRe={OUTCOMEKEYS:gR,SIDE1KEYS:T_,SIDE2KEYS:$Z,MODIFIERS:BZ,PROMPT:eRe,MOVEUP:U_,MOVEDOWN:S_,HOTKEYS:nRe};function tf({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=jZ({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==gm?gm:"";return t+r+i}else return i+gm+t}function jZ({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of DZ){let r=t==null?void 0:t.indexOf(i);r===0?t=t.slice(i.length+1).trim()+gm:r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function GM({analysis:t,scoreString:e,sets:i,lowSide:r}){var n,a,o;let s,l;if(!e)return{scoreString:e,sets:i};let{scoreString:u,removed:c}=jZ({scoreString:e});if(e=u,c)return{scoreString:e,sets:i,outcomeRemoved:!0};let d=i[i.length-1]||{},p=Object.values(d).filter(y=>y!==void 0).length;d.setNumber&&p===1&&(i=i.slice(0,i.length-1),d=i[i.length-1]||{});let{tiebreakSet:m}=t.setFormat,{tiebreakTo:h,NoAD:f}=m||{},{isTiebreakEntry:g}=Df({brackets:ap,scoreString:e}),v=sRe(e);if(v>=0){s=e.slice(0,v);let{isTiebreakEntry:y}=Df({brackets:Hm,scoreString:s}),{lastOpenBracketIndex:I,isTiebreakEntry:b}=Df({brackets:ap,scoreString:s}),S=s&&s[s.length-1].trim(),w=s&&!isNaN(S),U=t.isIncompleteSetScore;if(g&&b){let T=s.slice(I+1).split(Bl),D=(T==null?void 0:T.length)>0&&T[0]!==void 0&&!isNaN(parseInt(T[0]))&&parseInt(T[0])||void 0,P=(T==null?void 0:T.length)>1&&T[1]!==void 0&&parseInt(T[1])||void 0,E=[D,P];if(P){let R=r===1?1:0;E[R]=((E==null?void 0:E[1-R])||0)+(f?1:2),(E[R]||0)<h&&(E[R]=h),s=e.slice(0,I+1),s+=E.join(Bl)}else D!==void 0?(s=e.slice(0,I+1),s+=D):(s=e.slice(0,I),U=!0);d.side1TiebreakScore=E[0]||0,d.side2TiebreakScore=E[1]||0}if(s.length||(s=void 0),U){let T=(n=d.side1Score)==null?void 0:n.toString();if(T){let D=T==null?void 0:T.slice(0,T.length-1);d.side1Score=!isNaN(D)&&parseInt(D)||void 0,d.side1Score===void 0&&(d.side2Score=void 0)}t.isTimedSet?(l=d.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let T=(a=d.side2Score)==null?void 0:a.toString(),D=(o=d.side1Score)==null?void 0:o.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(d.side2Score){let P=T==null?void 0:T.slice(0,T.length-1);d.side2Score=!isNaN(P)&&parseInt(P)||void 0}else{let P=D==null?void 0:D.slice(0,D.length-1);d.side1Score=!isNaN(P)&&parseInt(P)||void 0}t.isTimedSet?d.side1Score?(l=i||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i||[],l[i.length-1]=d),l[l.length-1]&&Object.assign(l[l.length-1],{winningSide:void 0})}else y?(l=i||[],Object.assign(l[l.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(g&&!b?l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i,l[i.length-1]=d),g||(l[l.length-1].side2Score=0,l[l.length-1].winningSide=void 0));return{scoreString:s,sets:l}}return{scoreString:e,sets:i}}function Df({brackets:t=Hm,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...Xs(i,n)),o=Math.max(...Xs(r,n));return{isTiebreakEntry:a>o,lastOpenBracketIndex:a}}function oRe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=ap.split(""),a=t.split(""),o=Math.max(...Xs(r,a)),s=Math.max(...Xs(n,a)),l=Math.max(...Xs(Bl,a));return i&&o>s&&l>o}function sRe(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function GZ(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function G2({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){var n;let a=Ln(t),{bestOf:o}=a,s=Math.ceil(o/2),l=((n=r==null?void 0:r.reduce((u,c)=>{let{winningSide:d}=c;return d&&u[d-1]++,u},[0,0]))==null?void 0:n.indexOf(s))+1||void 0;return ZPe.includes(e)&&i&&(l=i),{matchUpWinningSide:l}}function IR({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:o}){var s;if(!o)return{error:Qe,info:"missing set"};e=e||i&&Ln(i);let l=n&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:u,side2Score:c}=o,{setTo:d,tiebreakAt:p}=l,m=u||c,h=yR({set:o}),f=Math.abs(u-c),g=u>=d||c>=d,v=r||u>=d&&c>=d||p&&p<d&&(u===p||c===p),y=t||v&&(h===1&&o.side1TiebreakScore>o.side2TiebreakScore||h===2&&o.side2TiebreakScore>o.side1TiebreakScore),I=!v&&l.NoAD||v||r&&(s=l.tiebreakFormat)!=null&&s.NoAD?1:2,b=f>=I;return!!((a&&m||g&&(b||v)||r)&&(!v||y))}function yR({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function D_({analysis:t,set:e}){let i=yR({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return IR({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function lRe({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];r=tt(r);let{validSide2Score:o,requiresTiebreak:s}=uRe({analysis:t,set:a,value:r});if(o){n=!0,e=(e||"")+r,a.side2Score=r;let l=D_({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,s){let u=Hm.split("")[0];e+=u}else t.isDecidingSet||(e+=gm)}return{sets:i,scoreString:e,updated:n}}function uRe({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:o}=r,{side1Score:s}=e,l,u;return n&&n<a?s===n?l=i<=a:l=i<=n:s===a?o?l=i<a:l=i<=a+1:s===a-1?o?l=i<=a:l=i<=a+1:s===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?u=s===a&&i===n||s===n&&i===a:u=s>=a&&i>=a&&s!==i),{validSide2Score:l,requiresTiebreak:u}}function HZ({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let o;return e===NZ?r?(o=!0,r=tf({scoreString:r,lowSide:t,outcome:SZ}),n=t===2?1:2,a=CZ):(o=!0,r=tf({scoreString:r,lowSide:t,outcome:VM}),n=t===2?1:2,a=jM):e===kZ?(o=!0,r=tf({scoreString:r,lowSide:t,outcome:VM}),n=t===2?1:2,a=jM):e===xZ?(o=!0,i=[],r=bZ,n=t===2?1:2,a=PZ):e===AZ&&r?(o=!0,r=tf({scoreString:r,lowSide:t,outcome:UZ}),a=EZ,n=void 0):e===OZ?(o=!0,r=tf({scoreString:r,lowSide:t,outcome:wZ}),a=RZ,n=void 0):e===FZ&&r&&(o=!0,r=tf({scoreString:r,lowSide:t,outcome:TZ}),a=MZ,n=void 0),{updated:o,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function cRe(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:o,lowSide:s,value:l}=t,u,c;!(e!=null&&e.length)&&l!==I0&&(e=[{setNumber:1}]);let d=e.length-1;if(gR.includes(l)){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;m&&!h?i="missing side2Score":o.finalSetIsComplete||n?i="final set is already complete":o.isIncompleteSetScore?i="incomplete set scoreString":o.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:u}=HZ({lowSide:s,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===I0){if({scoreString:r,sets:e,outcomeRemoved:c}=GM({analysis:o,scoreString:r,sets:e}),(r==null?void 0:r.trim())===""&&(r=r.trim()),r||(e=[]),c){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;if(m&&h){let f=m>h&&1||h>m&&2||void 0;f&&(p.winningSide=f,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,u=!0}else if(o.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===vR){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p,f=m>h&&1||h>m&&2||void 0;f&&!n&&!o.isIncompleteSetScore&&(e[e.length-1].winningSide=f,e.push({setNumber:e.length+1}),r+=" ",u=!0)}else if(l===vm&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&o.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let m=tt((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=tt(m),p=e[d].side1Score.toString(),u=!0}else{let m=tt((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=tt(m),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let m=(e.slice(0,d)||[]).filter(h=>h).map(h=>{let{side1Score:f,side2Score:g}=h;return[f,g].join("-")}).join(" ");m?r=m+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:u}}function dRe({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){var o;let s,l,{tiebreakSet:{tiebreakTo:u,NoAD:c}}=t.setFormat,[d]=ap.split("");if(t.isMatchTiebreakEntry||(r+=d),n[t.setNumber-1]){let{lastOpenBracketIndex:p}=Df({brackets:ap,scoreString:r}),m=(r.slice((p??0)+1)+(e?"":a)).split(Bl);if((((o=m[i-1])==null?void 0:o.length)||0)>=2)l="tiebreak digit limit";else if(e){i===1&&(m[0]=(m[0]||"")+a),i===2&&(m[1]=(m[1]||"")+a);let h=[m[0]||0,m[1]||0].map(v=>tt(v)),f=i===1?1:0;h[f]=h[1-f]+(c?1:2),h[f]<u&&(h[f]=u);let g=n[n.length-1];g.side1TiebreakScore=h[0],g.side2TiebreakScore=h[1],r=r.slice(0,(p??0)+1),r+=h.join(Bl),s=!0}else{let h=[m[0]||0,m[1]||0].map(g=>tt(g)),f=n[n.length-1];f.side1TiebreakScore=h[0],f.side2TiebreakScore=h[1],r+=a,s=!0}}else{let p=GZ({lowValue:tt(a||0),tiebreakTo:u,NoAD:c}),m=[tt(a),p];i===2&&m.reverse();let h={side1TiebreakScore:m[0],side2TiebreakScore:m[1],setNumber:(n==null?void 0:n.length)+1||1};n.push(h),r+=m.join(Bl),s=!0}return{info:l,scoreString:r,sets:n,updated:s}}function pRe({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:o}=(t==null?void 0:t.setFormat)||{},s=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(o&&r===n||r>n)return{scoreString:i};let l=h(),u=[r,l];e===2&&u.reverse();let c=Hm.split("")[0],d=u.join(vm)+(s?c:gm);i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},m=D_({analysis:t,set:p});return p.winningSide=m||void 0,{scoreString:i,set:p};function h(){return s?r+1:r+1===n?r+(o?1:2):n}}function mRe({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){var a,o,s;let l=(((a=n==null?void 0:n.filter(_=>_==null?void 0:_.winningSide))==null?void 0:a.length)||0)+(i?0:1),u=Ln(t),c=l===(u==null?void 0:u.bestOf),d=c&&(u==null?void 0:u.finalSetFormat)||(u==null?void 0:u.setFormat)||{},p=d==null?void 0:d.timed,m=c&&n[(u==null?void 0:u.bestOf)-1],h=m==null?void 0:m.winningSide,{isTiebreakEntry:f}=Df({brackets:Hm,scoreString:e}),{isTiebreakEntry:g}=Df({brackets:ap,scoreString:e}),v=f||g,y=!!d.tiebreakSet,I=(o=e==null?void 0:e[e.length-1])==null?void 0:o.trim(),b=e&&!isNaN(I),S=!v&&I===vm,w=f&&YE.includes(I),U=g&&YE.includes(I),T=g&&I===Bl,D=e==null?void 0:e.split(""),[P]=ap.split(""),E=D&&Math.max(...Xs(P,D)),R=D&&Math.max(...Xs(Bl,D)),N=D&&R>E,A=(s=n[n.length-1])==null?void 0:s.winningSide,M=(n==null?void 0:n.length)&&!A,C=DZ.find(_=>(e==null?void 0:e.indexOf(_))>=0),O=!isNaN(r),k=r===vR,x=y0.includes(r),F=e==null?void 0:e.split("").find(_=>YE.includes(_)),$=x&&g&&!U&&(T||!oRe({scoreString:e}));return{isTiebreakSetValue:y&&O,matchUpScoringFormat:u,setNumber:l,setFormat:d,matchTiebreakHasJoiner:N,isGameScoreEntry:M,isSpace:k,isCloser:x,isTiebreakCloser:x&&F&&v&&b,isDecidingSet:c,isTiebreakSet:y,isTimedSet:p,isNumericEnding:b,isNumericValue:O,hasOpener:F,hasOutcome:C,finalSet:m,finalSetIsComplete:h,lastSetIsComplete:A,isInvalidSetTiebreakValue:k&&v&&w,isInvalidMatchTiebreakValue:$,isTiebreakEntry:v,isSetTiebreakEntry:f,isMatchTiebreakEntry:g,isIncompleteSetScore:S,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:U,isPartialMatchTiebreakValue:T}}function zZ(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:o}=t,{matchUpFormat:s,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!VZ.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:m}=G2({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=m;let h=mRe({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:s});if(_Z.includes(i)&&(i=vm),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&p&&tt(i)===0&&(h.isTiebreakCloser=!0),y0.includes(i)&&h.hasOpener&&(i=""),y0.includes(i)&&(i=vR),h.lastSetIsComplete){let f=(r==null?void 0:r.length)&&r[r.length-1];r&&f!==" "&&(r+=" ")}if(h.isTimedSet)({info:d,sets:n,scoreString:r,updated:c,matchUpStatus:o,winningSide:a}=cRe({analysis:h,lowSide:e,scoreString:r,sets:n,matchUpStatus:o,winningSide:a,value:i}));else if(gR.includes(i))h.finalSetIsComplete||a?d="final set is already complete":!h.isTiebreakEntry&&!h.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:o,winningSide:a,updated:c}=HZ({lowSide:e,sets:n,scoreString:r,matchUpStatus:o,winningSide:a,value:i}):h.isTiebreakEntry||h.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===I0)c=!0,{scoreString:r,sets:n}=GM({analysis:h,scoreString:r,sets:n,lowSide:e}),r||(n=[]),o=void 0,a=void 0;else if(h.hasOutcome)d="has outcome";else if(i===vm&&!h.isMatchTiebreakEntry)(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(c=!0,{scoreString:r,sets:n}=GM({analysis:h,scoreString:r,sets:n,lowSide:e}),o=void 0);else if(i===Bl&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?d="existing joiner":h.isNumericEnding&&(c=!0,r+=Bl);else if([vm,Bl].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:n,scoreString:r,updated:c}=lRe({analysis:h,scoreString:r,sets:n,value:i}));else if(h.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(h.isTiebreakCloser){let f=h.isSetTiebreakEntry?Hm:ap,g=f.split("").reverse()[0],v=f.split("")[0],y=n[n.length-1],{tiebreakFormat:I}=h.setFormat,{tiebreakTo:b,NoAD:S}=I||{},w=yR({set:y});if(!h.isTiebreakSet){let T=parseInt(r.split(v).reverse()[0]),D=GZ({lowValue:T,tiebreakTo:b,NoAD:S});w===1?(y.side1TiebreakScore=D,y.side2TiebreakScore=T):(y.side1TiebreakScore=T,y.side2TiebreakScore=D)}r=(r||"")+g,h.isDecidingSet||(r+=gm);let U=D_({analysis:h,set:y});y.winningSide=U||void 0,c=!0}else if(h.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:c}=dRe({analysis:h,auto:u,lowSide:e,scoreString:r,sets:n,value:i}));else if(h.isSetTiebreakEntry){let[f]=Hm.split(""),g=Math.max(...Xs(f,r.split(""))),v=r.slice(g+1),y=v&&tt(v)===iRe,I=tt(v?v+i:i),{tiebreakFormat:b}=h.setFormat,{tiebreakTo:S,NoAD:w}=b||{};!y&&v.length<2?w&&I>S-1?d="invalid low value for NoAD tiebreak":(c=!0,r=(r||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)d=`invalid key: ${i}`;else if(h.isGameScoreEntry)d="game scoreString entry";else if(h.lastSetIsComplete||!n.length){c=!0;let{scoreString:f,set:g}=pRe({analysis:h,lowSide:e,scoreString:r,value:tt(i)});g&&(g.setNumber=(n==null?void 0:n.length)+1||1),n=(n==null?void 0:n.concat(g).filter(Boolean))||[g],r=f||void 0}else console.log("error: unknown outcome")}if(c){n=n==null?void 0:n.filter(Boolean);let{matchUpWinningSide:f}=G2({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=f,f&&(!o||[Qi,Ma].includes(o))?(o=XPe,n=n.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:I,side2TiebreakScore:b}=g;return v||y||I||b})):r&&!a&&![EZ,RZ,MZ].includes(o)&&(o=void 0),{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}return{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}var bR="\\d+-\\d+",yy="\\d+-\\d+\\(\\d+\\)",P_="\\[\\d+-\\d+\\]",hRe="\\d+-\\d+\\(\\d+-\\d+\\)",fRe=new RegExp(`(${bR}),`,"g"),gRe=new RegExp(`(${yy}),`,"g"),vRe=[bR,yy,P_,hRe],IRe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],yRe=IRe.map(t=>{let e=t.split("").map(i=>vRe[i]).join(" ");return new RegExp(`^${e}$`)});function H2(t){return!t||yRe.some(e=>e.test(t))}function bRe(t){let e="[];",i="()",r=e+i,n=[e[0],i[0]],a=Object.assign({},...r.split("").map(l=>({[l]:0}))),o="",s=t.split("").map(l=>{let u=r.includes(l)&&l,c=n.includes(u);if(c&&u)return a[u]+=1,o=u,l;if(!c&&u&&o&&u!==o){a[o]-=1;let d=e.includes(o)&&e||i.includes(o)&&i||"",p=d.split("").find(m=>m!==o);if(d.includes(u))a[o]||(o="");else return a[u]||(o=""),p}return l}).join("");return t!==s?s:t}function sS(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function wRe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function Ig(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function b0(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function z2(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function URe(t){return t.startsWith("(")&&t.endsWith(")")}function SRe({score:t,applied:e}){t=bRe(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let U=w.replace(")",") ");t=t.replace(w,U)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let w of a||[]){let[U]=w.match(n).slice(1),T=U.replace(/ /g,"");t=t.replace(w,`(${T})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(U,T)})}if(o=/\(\((\d)\)\)/g,o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(U,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(w=>{let U=new RegExp(`(\\d+)${w}(\\d+)`,"g"),T=t.match(U);T&&T.forEach(D=>t=t.replace(D,D.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[U]=w.match(/\((\d+), \)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"&&(t=t.replace(w,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(w=>{let[U]=w.match(/\((\d+)\/\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${U})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(w=>{let[U]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${U},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[U]=w.match(/\(\/(\d+)\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&parseInt(U)<6?t=t.replace(w,`(6-${U})`):t=t.replace(w,`(${U})`)});let p,m,h,f,g,v=()=>{g=Ra(t.split("")),m=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],h=g["["]===g["]"]+1,f=m&&!h};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(URe)?t=w.map(U=>{let T=U.slice(1,U.length-1);return T.length>2?T:U}).join(" "):t=w.join(" ")}v();let I=/[A-Za-z]+/.test(t),b=/\d+/.test(t);if(!I&&!b)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],U=0;for(let T of t.split("").reverse())T===")"&&(U?w.push("("):U+=1),T==="("&&(U-=1),w.push(T);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),f&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),f&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),f){let w="",U=0;for(let T of t.split(""))T==="("&&(U?w+=")":U+=1),T===")"&&(U-=1),w+=T;t=w}v(),h&&!m&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let S=w=>{let U=w.indexOf("("),T=w.indexOf(")");return U>=0&&T>=0&&U<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);S(w)&&(t=w,v())}return{score:t,applied:e}}function wR(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=Xs("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,o)=>o%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function TRe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[fRe,gRe].forEach(i=>{let r=t.match(i);r!=null&&r.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(wR).join(" "),{score:t,applied:e}}function DRe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let m=/^-(\d+)$/;if(m.test(p)){let[h]=p.match(m).slice(1);if(h.length===2)return h.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(sS),a=0,o="";for(let p of n){let m=Xs(p,r).filter(v=>!a||v>a)[0],h=r.slice(a,m-1),f=r[m-1],g=e(f);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((I,b)=>+I-+b));if(y===1){let I=[h.join(" "),[f,p].join("")].join(" ");o+=I,a=m+1}else if(y===0){let I=Math.max(...v);if([4,5,6,7,8,9].includes(I)){let b=[6,4].includes(I)?I+1:I-1,S=[I,b].sort().reverse().join("-"),w=[h.join(" "),[S,p].join("")].join(" ");o+=w,a=m+1}}}}if(n.length&&o.length){let p=r.slice(a).join(" ");return o=[o,p].join(" "),{score:o.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((m,h)=>+m-+h,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let s=r.map(p=>wRe(p)&&"bracket"||Ig(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,m="";return r.forEach((h,f)=>{s[f]==="bracket"&&p==="set"?(h=i(h),m+=h):m+=` ${h}`,p=s[f]}),{score:m.trim()}}r=t.split(" ");let l,u=r.map(p=>{let m=new RegExp(/^(\d+)-(\d+)$/);if(m.test(p)){let[h,f]=p.match(m).slice(1),g=Math.abs([h,f].reduce((y,I)=>+y-+I)),v=Math.max(h,f);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=Xs("tiebreak",u);if(c.length){let p="";r.forEach((m,h)=>{c.includes(h)?p+=`(${m}) `:c.includes(h+1)?p+=`${m}`:p+=`${m} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,m,h]=t.match(d).slice(1),f=Math.max(m,h)>=10;!Ig(p)&&f&&(t=t.replace(d,`${p} [${m}-${h}]`))}return u=[],t=t.split(" ").map(p=>{let m=/^\((.*)\)$/,h=m.test(p),f=new RegExp(P_).test(p)&&"super"||new RegExp(yy).test(p)&&"tiebreak"||new RegExp(bR).test(p)&&"standard"||"unknown";return u.push(f),f==="standard"&&h?p.match(m)[1]:p}).join(" "),{score:t}}function PRe({score:t,applied:e}){for(let T of[".",","," ","/"]){let D=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(D.test(t)){let P=t.match(D).slice(1).map(R=>parseInt(R)),E=Math.abs(P[0]-P[1]);E<=10&&E>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,D,P,E,R,N]=t.match(i).slice(1);t=t.replace(i,`${T}${D}-${P} ${E}-${R}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let o=wR(t);o!==t&&(t=o,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[T,D,P]=t.match(s).slice(1),[E,R]=D.split("");t=`${T}-${E} ${R}-${P}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[T,D]=t.match(u).slice(1),P=T.trim(),E=D.trim();if(l.test(P)&&l.test(E)){let R=P.match(l).slice(1,3).join("-"),N=E.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[T,D]=t.match(c).slice(1),P=T.trim(),E=D.trim();if(l.test(P)&&l.test(E)){let R=P.match(l).slice(1,3).join("-"),N=E.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("singleSetCommaSeparationPattern")}let p=0,m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(t)&&p<3;){let[T,D,P]=t.match(m).slice(1),E=D.split(""),R=`${T}-${E[0]} ${E[1]}-${P}`;t=t.replace(m,R),e.push("noSetSeparationPattern"),p+=1}let h=/(^|\s)7-6\s(\d+)\s/g,f=t.match(h);if(f!=null&&f.length){let T=/(^|\s)7-6\s(\d+)\s/;f.forEach(D=>{let P=D.match(T).slice(2)[0];t=t.replace(D,`7-6(${P}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(T=>{let D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(T=>{let D=" "+T.slice(1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let T=t.match(v)[0],D=T.split("/").map(P=>`(${P})`).join(" ")+" ";t=t.replace(T,D),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let I=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(I.test(t)){let T=t.match(I),D=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),P=t;T.forEach(E=>{let[R,N]=E.match(D).slice(1),A=`${R}-${N}`;P=P.replace(E,A)}),t=P,e.push("slashSetPattern")}let b=/(.*)\s(1\d)\s(\d+)$/;if(b.test(t)){let[T,D,P]=t.match(b).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${D}${P}`,e.push("spaceSeparatedSuperPattern"))}let S=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(S)||[]){let[D,P,E,R]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,A]=P.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${D}${P}(${E})${R}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(w)||[]){let D=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[P,E,R]=T.match(D).slice(1),[N,A]=P.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${P}(${E})${R}`),e.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let T of t.match(U)||[]){let D=/(^|\s)(\d \d)\(/,[P,E]=T.match(D).slice(1);t=t.replace(T,`${P}${E.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function RRe({score:t,matchUpStatus:e}){var i;let r=t==null?void 0:t.split(" ");t=r.map(l=>{if(l.endsWith("]")){let u=l.split("[");if(Ig(u[0]))return u[0]+`(${u[1].slice(0,u[1].length-1)})`}return l}).join(" ");let n=new RegExp(/(\([\d ]+\))/g);if(n.test(t))for(let l of t.match(n)){let u=(i=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:i[1];if(xi(u)&&(u==null?void 0:u[0])>2){if([2,4].includes(u.length))u=u.split("").join("-");else if(u.length===3){let c=u.indexOf("1");u=b0(u.split(""),c)}}t=t.replace(l,`(${u})`)}r=t==null?void 0:t.split(" ");let a=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),o=r.length-1;t=r.map((l,u)=>{let c=[void 0,"","COMPLETED"].includes(e)||u!==o;if(a.test(l)&&c){let[d,p,m]=Array.from(l.match(a)).slice(1),h=Math.min(p,m);return`${d}(${h})`}return l}).join(" "),r=t==null?void 0:t.split(" "),a=new RegExp(/^(\d{2})\((\d+)\)$/),t=r.map(l=>{if(a.test(l)){let[u,c]=Array.from(l.match(a)).slice(1),d=u.split("");return`${d[0]}-${d[1]}(${c})`}return l}).join(" "),r=t==null?void 0:t.split(" "),a=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=r.map(l=>{if(a.test(l)){let[u,c]=Array.from(l.match(a)).slice(1);return Ig(u)?`${u}(${c})`:u}return l}).join(" "),r=t==null?void 0:t.split(" "),a=new RegExp(/^1-0\((\d+)\)$/),t=r.map(l=>{if(a.test(l)){let[u]=l.match(a).slice(1);return`[${u<9?10:parseInt(u)+2}-${u}]`}return l}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let l=t.match(s)[1];t=t.replace(s,`(${l}) `)}return{score:t}}function ERe({score:t,attributes:e,identifier:i}){var r,n,a;if(typeof t!="string")return{score:t,identifier:i};let o=new RegExp(/\([\d,/ ]+\)/g),s=t.match(o);for(let m of s||[]){let h=(n=(r=m.match(/^\((.*)\)$/))==null?void 0:r.slice(1))==null?void 0:n[0],f=t.split(m)[0].split(")").reverse()[0].replace(/\D/g,"");if((h==null?void 0:h.length)===2&&(f==null?void 0:f.length)>=2){let y=f.slice(f.length-2).split("").map(I=>parseInt(I));if(Math.abs(y[0]-y[1])===1)continue}let g=z2(h),v=wR(g);t=t.replace(m,`(${v})`).trim()}let l=new RegExp(/\[[\d,/ ]+\]/g);(a=t.match(l))==null||a.forEach(m=>{let h=z2(m.match(/^\[(.*)\]$/)[1]);t=t.replace(m,`(${h}) `).trim()});let u=[")","]"],c=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&u.some(m=>t.endsWith(m))&&c.some(m=>t.includes(m))){let m="",h=t.split(/[)\]]/).filter(Boolean).map(I=>(I.startsWith(",")&&(I=I.slice(1)),I.trim())),f=h.every(I=>I.includes(",")||sS(I)),g=h.every(I=>I.includes("/")||sS(I)),v=h.every(I=>I.includes("-")||sS(I)),y=f&&","||v&&"-"||g&&"/";if(y){let I;h.forEach(b=>{if(b.startsWith("("))if(I==="set"&&(m+=" "),b.includes(y))m+=b.slice(1).split(y).map(S=>S.trim()).join("-"),I="set";else{let S=b.slice(1);m+=`(${S}) `,I="tiebreak"}else if(b.startsWith("[")){let S=b.slice(1).split(y).map(U=>parseInt(U.trim())),w=Math.min(...S);I==="set"?m+=`(${w}) `:m+=`[${S.join("-")}] `,I="tiebreak"}}),t=m.trim()}}let d=Ra(t.split(""));d["("]===1&&d[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),d["-"]===1&&Ig(t)&&xi(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let p=/\(\)/g;return p.test(t)&&(t=t.replace(p,"").trim()),{score:t}}function WZ({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let s=`${r[0]}-${r[1]}`;return r[2]&&(s+=` (${r[2]})`),n(),r.push(r),s};n();let o=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let s=e.shift(),l=xi(s)&&parseInt(s),u=r[0]!==void 0&&r[1]!==void 0;if(xi(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,o())){i.push(a()),r=[void 0,void 0];continue}if(u&&e.length===1&&xi(e[0])){let c=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=c,i.push(a()),r=[void 0,void 0]}u&&o()}}return{sets:i}}function HM(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=b0(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=b0(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function qZ(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e==null?void 0:e.toString().split(""),a=n==null?void 0:n.every(s=>xi(s)),o=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let s=a?n.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(WZ({score:e}),s.length,e.length===3&&o(s.slice(0,2))===1){let[l,u,c]=s;e=`${l}-${u}(${c})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,u,c]=s;e=`[${l}${u}-${c}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&o(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,u,c,d]=s,p=Math.min(c,d);e=`${l}-${u}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,u,c,d]=s;e=`[${l}${u}-${c}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,u,c,d]=s;e=`${l}${u} ${c}${d}`,i.push("split4")}else if(e.length===5&&o(s.slice(0,2))===1){let[l,u,c,d,p]=s;e=`${l}-${u}(${c}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&o(s.slice(3))===1){let[l,u,c,d,p]=s;e=`${l}-${u} ${c}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&s[4]===1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d} [${p}${m}-${h}]`,i.push("numericTiebreakPattern6")}else if(o(s.slice(0,2))===1&&o(s.slice(3,5))>1&&o(s.slice(5,7))>1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u}(${c}) ${d}-${p} ${m}-${h}`,i.push("numericTiebreakPattern7")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))===1&&o(s.slice(5,7))>1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d}(${p}) ${m}-${h}`,i.push("numericTiebreakPattern8")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&o(s.slice(4,6))===1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d} ${p}-${m}(${h})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=HM(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=Cr(e.split(""),2).map(g=>g.join("")),u=l.map(g=>{let[v,y]=g.split("").map(S=>parseInt(S)),I=Math.abs(v-y),b=v>y?1:2;return I>1&&b||b*-1}),c=u.reduce((g,v)=>g>0&&v>0,1),d=Ra(u),p=u.map(g=>Math.abs(g)),m=Ra(p),h=u[0]<0,f=!h&&u[1]<0;if(u[0]>0&&u[1]>0&&u[0]!==u[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(c)e=l.join(" "),i.push("chunkSplit");else if(s.length===6){if(d[1]===2||d[2]===2)if(!Object.values(m).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,I,b,S]=s,w=u.reduce((U,T,D)=>T<0?D:U,void 0);if(w===0){let U=Math.min(y,I);e=`${g}-${v}(${U}) ${b}-${S}`,i.push("chunkSplitTiebreak1")}else if(w===1){let U=Math.min(b,S);e=`${g}-${v} ${y}-${I}(${U})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${I}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,y,I,b,S,w,U]=s;h||f?s[5]===1&&(h?e=`${g}-${v}(${y}) ${I}-${b} [${S}${w}-${U}]`:e=`${g}-${v} ${y}-${I}(${b}) [${S}${w}-${U}]`):(u[0],u[1])}}}return{score:e,applied:i,matchUpStatus:r}}function YZ(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let u=l.match(n).slice(1).map(d=>parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,o=e[0]>0&&e[0]===e[1],s=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}function CRe({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),o=a.length;t=a.map((c,d)=>{if(new RegExp(yy).test(c)){let m=c.slice(3),h=c.slice(0,3),f=h.split("-");if(!Ig(h)&&!e){let g=Math.max(...f),v=h.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+m}}else if(c.length===2&&xi(c))return c.split("").join("-");c=wR(c);let p=new RegExp(`^${P_}$`).test(c)&&"super"||new RegExp(`^${yy}$`).test(c)&&"tiebreak"||new RegExp(`^${bR}$`).test(c)&&"standard"||"unknown";if(r.push(p),o>1&&p==="standard"&&d<2){let[m,h]=c.split("-"),f=Math.abs(parseInt(m)-parseInt(h)),g=Math.max(m,h),v=Math.min(m,h),y=[parseInt(m),parseInt(h)].indexOf(v);if(g>9&&f>2){let I=g.toString().split(""),b=I.find(S=>parseInt(S)>v||d&&parseInt(S)<=n)??I[0];b&&(c=y?[b,v].join("-"):[v,b].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[m,h]=c.split("-");if(!Math.abs(parseInt(m)-parseInt(h))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:u}=YZ(t);if(u===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function MRe({score:t}){let{setsTied:e,winningSide:i}=YZ(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let s=t.match(r).slice(1)[0],l=s<=8?10:s+2;t=t.replace(r,` [${l}-${s}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(s=>xi(s)))return{score:t};if(o[0]==="76"){let s=o[1].length===2?Math.min(...o[1].split("").map(l=>parseInt(l))):o[1];t=[...n.slice(0,n.length-1),`7-6(${s})`].join(" ")}else{o=o.map(u=>parseInt(u));let s=Math.max(...o),l=Math.abs(o[0]-o[1]);if(s>=10){if(l>2&&o.every(u=>+u>=10)){let u=o.map(c=>c===s?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(o=u)}t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" ")}else n.length===3&&s>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" "))}return{score:t}}function NRe({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function ARe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function ORe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=b0(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=qZ({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function kRe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&HM(t)?{score:HM(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function xRe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function FRe({score:t,profile:e,applied:i}){var r;t=t==null?void 0:t.toString().toLowerCase();let n=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(n.test(t)){let[s]=t.match(n).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let a=(r=e==null?void 0:e.matchUpStatuses)==null?void 0:r.retired,o=["rtd",...Array.isArray(a)?a:[a].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return o?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(o,"").trim(),applied:i}):{score:t}}function LRe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function _Re({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function $Re({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function BRe({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function VRe({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[o,s]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${o}-${s}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>xi(i))&&e.length===4&&(t=e)}return{score:t}}function jRe({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var GRe={handleTiebreakSlashSeparation:BRe,handleSetSlashSeparation:_Re,punctuationAdjustments:SRe,handleGameSeparation:$Re,joinFloatingTiebreak:DRe,handleBracketSpacing:TRe,handleSpaceSeparator:VRe,separateScoreBlocks:ORe,matchKnownPatterns:PRe,removeDanglingBits:LRe,removeErroneous:kRe,handleWalkover:xRe,properTiebreak:RRe,handleNumeric:qZ,handleRetired:FRe,containedSets:ERe,sensibleSets:CRe,stringScore:NRe,superSquare:MRe,setBuilder:WZ,excisions:jRe,replaceOh:ARe},KE={},HRe=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],zRe=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function KZ(t){if(!t.score)return{error:le};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:o,profile:s}=t,l=[],u,c=[],d,p,m=e,h=g=>{g.forEach(v=>{p=GRe[v]({profile:s,identifier:r,matchUpStatus:u,attributes:d,applied:c,score:m});let y=p.score!==m;y&&l.push({method:v,score:p.score}),a&&(o||y||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},v),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),m=p.score})};h(HRe);let f=H2(m);return f||(m=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),h(zRe),f=H2(m),f||(m="")),c.forEach(g=>{KE[g]||(KE[g]=0),KE[g]+=1}),{matchUpStatus:u==null?void 0:u.toUpperCase(),modifications:l,attributes:d,isValid:f,score:m}}var JZ={};wt(JZ,{analyzeScore:()=>R_,analyzeSet:()=>by,checkScoreHasValue:()=>br,checkSetIsComplete:()=>IR,getSetComplement:()=>C_,getTiebreakComplement:()=>UR,isValidMatchUpFormat:()=>Ea,parseScoreString:()=>w0,validateScore:()=>E_,validateTieFormat:()=>qn});function R_({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){var a,o;let s=(n==null?void 0:n.sets)??[],l=((s==null?void 0:s.filter(U=>U==null?void 0:U.winningSide))||[]).reduce((U,T)=>{let{winningSide:D}=T;if(!D)return U;let P=D-1;return U[P]++,U},[0,0]),u=r?r-1:void 0,c=u!==void 0?1-u:void 0,d=u!==void 0&&l[u],p=c!==void 0&&l[c],m=e?Ln(e):void 0,h=Math.max(...l),f=Ra(l)[h],g=((a=m==null?void 0:m.setFormat)==null?void 0:a.timed)||((o=m==null?void 0:m.finalSetFormat)==null?void 0:o.timed),v=m==null?void 0:m.bestOf,y=v&&Math.ceil(v/2)||1,I=i??t,b=I&&[Pt,zr,Ft].includes(I),S=!m||!s.length||s.every((U,T)=>{let D=T+1,P=D===v,E=D===s.length,{side1Score:R,side2Score:N,side1TiebreakScore:A,side2TiebreakScore:M,winningSide:C}=U,O=Math.max(R??0,N??0),k=A??M,{finalSetFormat:x,setFormat:F}=m,$=P&&x||F;if(k){let{tiebreakTo:_,NoAD:L}=($==null?void 0:$.tiebreakFormat)||{},B=Math.max(A??0,M??0);if(L&&B>_||B<_&&C&&(E&&!b||!E))return!1}return $.setTo?!(!$.noTiebreak&&O>$.setTo+1):!0}),w=(!e||h===y)&&f===1&&l.indexOf(h)+1||void 0;return{valid:!!(S&&(r&&d>p&&r===w||r&&b||!r&&!w&&(![Ki,Pt,zr,Ft].includes(I)||g&&I===Ki)))}}function E_({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:le};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=n,l="scoreString must be a string!";if(o!==void 0&&typeof o!="string")return{error:le,info:l};if(s!==void 0&&typeof s!="string")return{error:le,info:l};if(a!==void 0&&!Array.isArray(a))return{error:le,info:ip("sets")};if(a!=null&&a.length){let u=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(u.length!==dt(u).length)return{error:le,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:m,side1TiebreakScore:h,side2TiebreakScore:f,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:I}=d;if(![[p,m],[h,f],[g,v]].filter(b=>b.some(S=>![void 0,null].includes(S))).every(b=>b.every(S=>st(S))))return{error:le,info:"non-numeric values"};if(![I,y].filter(b=>![void 0,null].includes(b)).every(b=>st(b)))return{error:le,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:le,info:"winningSide must be 1 or 2"}}let{valid:c}=R_({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!c)return{error:c9,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var C_=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let o=tt(i);(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),n&&n<r&&o>n&&(o=n);let s;return a&&!n?(o>r&&(s=r),s=o<r?r:r-1):s=o+1<r&&r||n&&n<r&&o===n&&r||!n&&o+2||r+1,[e?o:s,e?s:o]},UR=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let o=WRe({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:o,e?o:a]};function WRe(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function w0({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((r,n)=>i({set:r,setNumber:n+1}));function i({set:r,setNumber:n}){let a=/\(([^)]+)\)/,o=/\[([^)]+)\]/,s=a.exec(r),l=o.exec(r),u=(r==null?void 0:r.startsWith("["))&&l&&l[1].split("-").map(I=>parseInt(I)),c=s&&r.replace(s[0],"")||l&&r.replace(l[0],"")||r,d=!u&&c.split("-").map(I=>parseInt(I)),p=u?u[0]>u[1]&&1||u[0]<u[1]&&2||void 0:d[0]>d[1]&&1||d[0]<d[1]&&2||void 0,m=s?s[1]:void 0,h=(m&&UR({lowValue:m,isSide1:p===2,tiebreakTo:t}))??[],[f,g]=d||[],[v,y]=u||h||[];return{side1Score:f,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:y,winningSide:p,setNumber:n}}}function qRe({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=yR({set:n});return IR({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function by(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:oP};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},o=n||a,s=!!(r&&o&&r===o),l=s&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),u=!!(l!=null&&l.tiebreakSet),c=!!(l!=null&&l.timed),d=!u&&!c,p=!!(r&&o&&r<=o),m=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],h=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],f=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],g=m.filter(k=>k!==void 0).length,v=h.filter(k=>k!==void 0).length,y=f.filter(k=>k!==void 0).length,I=m==null?void 0:m.filter(k=>!isNaN(k)).length,b=f==null?void 0:f.filter(k=>!isNaN(k)).length,{tiebreakAt:S}=l||{},w=S&&m.filter(k=>k>=S).length===2,U=w&&(m[0]>m[1]&&1||m[1]>m[0]&&2||void 0),T=!!(b&&!I),D=!!(e!=null&&e.winningSide),{error:P,result:E}=YRe({sideTiebreakScores:f,sideGameScores:m,setFormat:l,setObject:e}),{error:R,result:N}=KRe({sideTiebreakScores:f,setObject:e,setFormat:l}),A=d&&!T&&E||u&&T&&N||c,M=p&&!(u&&!T)&&!(d&&T)&&(!D||A),C=qRe({isTimedSet:c,matchUpScoringFormat:i,isDecidingSet:s,isTiebreakSet:T,setObject:e}),O={expectTiebreakSet:u,expectTimedSet:c,hasTiebreakCondition:w,isCompletedSet:D,isDecidingSet:s,isTiebreakSet:T,isValidSet:M,isValidSetNumber:p,isValidSetOutcome:A,leadingSide:U,setFormat:l,sideGameScores:m,sideGameScoresCount:g,sidePointScores:h,sidePointScoresCount:v,sideTiebreakScores:f,sideTiebreakScoresCount:y,winningSide:C};return(e==null?void 0:e.winningSide)!==void 0&&(T?(O.isValidTiebreakSetOutcome=N,N||(O.tiebreakSetError=R)):(O.isValidStandardSetOutcome=E,E||(O.standardSetError=P))),O}function YRe({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:oP};let n=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||n||a)return{result:!1,error:le};if((i==null?void 0:i.filter(U=>!isNaN(U)).length)!==2)return{result:!1,error:sM};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:u}=e||{};if(!(o&&i!=null&&i.find(U=>U>=o)))return{result:!1,error:sM};let c=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!c)return{result:!1,error:sP};let d=(t==null?void 0:t.winningSide)-1,p=1-d,m=i[d],h=i[p],f=m-h;if(!(m>h))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(r==null?void 0:r.filter(U=>!isNaN(U)).length)===2,y=r==null?void 0:r[d],I=r==null?void 0:r[p],b=s&&i.filter(U=>U>=s).length===2;if(g){let{NoAD:U,tiebreakTo:T}=l;if(b){if(f>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&r!=null&&r.find(N=>N>=T)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let D=s<o?o:o+1;if(m>D)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!I||y<I)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let P=U?1:2,E=y-I,R=I>=T-1;if(E&&R&&E<P)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(m>o&&!b)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let S=u?1:2,w=h>=o-1;return f&&w&&!b&&f<S?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:f>S&&m>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function KRe({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:oP};let r=!!(e!=null&&e.tiebreakSet),n=!!(e!=null&&e.timed);if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:sP};let{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:l}=o||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=(t==null?void 0:t.winningSide)-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let m=s?1:2,h=d-p,f=p>=l-1;return h&&f&&h<m?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}function JRe(t){var e,i,r;let{existingDrawDefinition:n,hydrateCollections:a,enforceGender:o,tieFormatName:s,matchUpType:l,eventType:u,isMock:c,event:d}=t,{tieFormat:p,matchUpFormat:m}=t;if(l===cr&&u===cr){let h=(i=(e=n==null?void 0:n.structures)==null?void 0:e.find(({stage:f})=>f===Ne))==null?void 0:i.tieFormat;p=p||h||s&&((r=d==null?void 0:d.tieFormat)==null?void 0:r.tieFormatName)===s&&d.tieFormat||s&&Au({namedFormat:s,hydrateCollections:a,isMock:c,event:d})||(d==null?void 0:d.tieFormat)||Au({event:d,isMock:c,hydrateCollections:a}),m=void 0}else m||(p=void 0,d!=null&&d.matchUpFormat||(m=Yo));if(p){let h=qn({gender:d==null?void 0:d.gender,enforceGender:o,tieFormat:p});if(h.error)return h}return{tieFormat:p,matchUpFormat:m}}function XRe(t){var e,i,r,n,a;let o=t.drawDefinition,{existingQualifyingPlaceholderStructureId:s,appliedPolicies:l,drawEntries:u,structureId:c,idPrefix:d,isMock:p,event:m}=t,h=t.qualifyingProfiles,f=h!=null&&h.length?JQ({uuids:t.uuids,qualifyingProfiles:h,appliedPolicies:l,idPrefix:d,isMock:p}):void 0;if(f!=null&&f.error)return f;o.structures=(e=o.structures)==null?void 0:e.filter(({structureId:T})=>T!==s),o.links=(i=o.links)==null?void 0:i.filter(({source:T})=>T.structureId!==s);let{qualifiersCount:g,qualifyingDrawPositionsCount:v,qualifyingDetails:y}=f??{};v&&(f!=null&&f.structures&&((r=o.structures)==null||r.push(...f.structures)),f!=null&&f.links&&((n=o.links)==null||n.push(...f.links)));let I=(a=o.structures)==null?void 0:a.find(({stage:T,stageSequence:D})=>T===Ne&&D===1),{qualifiersCount:b}=Dv({stageSequence:1,drawDefinition:o,structureId:c,stage:Ne}),S=Math.max(g??0,b??0),w=QX({qualifiersCount:S,drawDefinition:o,stage:Ne});if(w.error||(w=f0({drawSize:v,stage:Je,drawDefinition:o}),w.error))return w;QRe({drawDefinition:o,drawEntries:u,event:m});let U=ZRe({mainStructure:I,qualifyingDetails:y,drawDefinition:o});return U.error?U:{drawDefinition:o,structureId:c}}function QRe({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===Je)){let n={...r,entryStage:r.entryStage??Ne,drawDefinition:t,event:i};RL(n)}}function ZRe({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var r;for(let n of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:o,roundTarget:s,finishingPositions:l,linkType:u}=n,c=t&&((r=_w({targetStructureId:t.structureId,sourceStructureId:o,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:s,linkType:u}))==null?void 0:r.link);if(c!=null&&c.error)return c;c&&(i.links||(i.links=[]),i.links.push(c))}return{error:void 0}}function XZ(t){var e,i;let{participantIds:r}=t,n=((i=(e=t.drawDefinition)==null?void 0:e.entries)==null?void 0:i.filter(a=>{let o=a.entryStatus;return!t.restrictEntryStatus||hs.includes(o)}).map(Tt))??[];if(r){let a=r.filter(o=>!(n!=null&&n.includes(o)));if(a!=null&&a.length)return te({result:{error:ks},info:{invalidParticipantIds:a}})}else r=n;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>r.length-1&&(!t.enableDoubleRobin||t.roundsCount>(r.length-1)*2)?{error:le,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:le,info:"roundsCount must be less than 32"}:{participantIds:r}}function M_(t){var e;let i=[],{roundsCount:r=1,drawDefinition:n,matchUpsCount:a,structureId:o,idPrefix:s,isMock:l,event:u}=t,c,d=XZ(t);if(d.error)return d;for(let p of De(1,r+1)){let m=fR({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:n,matchUpsCount:a,structureId:o,roundNumber:c,idPrefix:s,isMock:l,event:u});if(m.error)return te({result:m,info:{iteration:p}});(e=m.matchUps)!=null&&e.length&&i.push(...m.matchUps),c=((m==null?void 0:m.roundNumber)??1)+1}return{matchUps:i}}function eEe(t){var e;let{tournamentRecord:i,participantIds:r,scaleName:n,eventType:a,adHocRatings:o={}}=t,s=t.scaleAccessor??((e=Tr[n])==null?void 0:e.accessor),l=i.participants??[];for(let u of r??[]){let c=l==null?void 0:l.find(p=>p.participantId===u),d=W2({scaleName:`${n}.${$F}`,participant:c,eventType:a});!d&&n&&(d=W2({scaleAccessor:s,participant:c,scaleName:n,eventType:a})),d&&!o[u]&&(o[u]=d)}return o}function W2({scaleType:t=yc,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){var a,o;let s=(o=(a=i&&_l({scaleAttributes:{eventType:n??Fm,scaleType:t,scaleName:r},participant:i}))==null?void 0:a.scaleItem)==null?void 0:o.scaleValue;return e&&At(s)?s[e]:s}function N_(t){var e,i;let r=iEe(t);if(r!=null&&r.error)return r;let n=XZ(t);if(n.error)return n;let a=tEe(t);if(a.error)return a;let o=eEe(t),s=((e=t.tournamentRecord)==null?void 0:e.isMock)??t.isMock,l=t.eventType??((i=t.event)==null?void 0:i.eventType),u=[],c=[],d;for(let p of De(1,(t.roundsCount??1)+1)){let m=b_({...t,participantIds:n.participantIds,structure:a.structure,ignoreLastRoundNumber:!0,iterationMatchUps:u,adHocRatings:o,roundNumber:d,eventType:l,isMock:s});if(m.error)return m;let{matchUps:h,...f}=m;f.modifiedScaleValues&&(o=f.modifiedScaleValues),c.push({...f,iteration:p,matchUpsCount:h==null?void 0:h.length}),d=((f==null?void 0:f.roundNumber)??1)+1,h!=null&&h.length&&u.push(...h)}return{...Q,matchUps:u,roundResults:c}}function tEe(t){var e,i,r;if(t.structureId)return t.structureId;let n=t.drawDefinition,a=(i=(e=n==null?void 0:n.structures)==null?void 0:e.filter(s=>s.stageSequence===1))==null?void 0:i.reduce((s,l)=>{let u=l.stage&&Lm[l.stage];return Yn({structure:l})&&u>(Lm[s==null?void 0:s.stage]||1)?l:s},void 0),o=(r=n==null?void 0:n.structures)==null?void 0:r.find(s=>s.structureId===(a==null?void 0:a.structureId));return o?Yn({structure:o})?{structure:o}:{error:dm}:{error:Ni}}function iEe(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:le,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==Ha?{error:dm}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:le,info:"Missing Entries"}:{error:void 0}}function rEe(t){var e,i;let{tournamentRecord:r,drawDefinition:n,structureId:a,idPrefix:o,isMock:s,event:l}=t,u=(e=l==null?void 0:l.entries)==null?void 0:e.filter(({entryStage:p,entryStatus:m})=>(!p||p===Ne)&&m&&hs.includes(m)),c=u==null?void 0:u.map(Tt),d=u?Math.floor(u.length/2):0;if(t.automated)return nEe({...t,participantIds:c});{let p=M_({roundsCount:t.roundsCount,drawDefinition:n,matchUpsCount:d,idPrefix:o,isMock:s,event:l});if(p.error)return p;(i=p.matchUps)!=null&&i.length&&dR({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:r,drawDefinition:n,structureId:a,event:l})}return{...Q}}function nEe(t){var e,i;let{restrictEntryStatus:r,generateMatchUps:n,structureId:a,matchUpIds:o,scaleName:s,scaleAccessor:l}=t.drawMatic??{},u=N_({...t,eventType:((e=t.drawMatic)==null?void 0:e.eventType)??t.matchUpType,generateMatchUps:n??!0,scaleAccessor:l??t.scaleAccessor,scaleName:s??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:r,structureId:a,matchUpIds:o});return u.error?u:((i=u==null?void 0:u.matchUps)!=null&&i.length&&dR({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:u.matchUps,event:t.event,structureId:a}),{...Q})}function aEe({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:u}){var c,d;r=r??n;let p=rt({drawDefinition:o,structureId:l});if(p.error)return p;let m=p.structure;if(!m)return{error:Ni};let{positionAssignments:h}=Mr({structure:m}),f=(h==null?void 0:h.length)||0;if(u>f)return{error:VK};let g=(c=m.structures)==null?void 0:c.length,v=st(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),y=(d=FL({roundRobinGroupsCount:g,drawSize:f}))==null?void 0:d.seedGroups,{seedsCount:I}=Yw({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:f});return I&&a!=null&&a[ko]&&u>I&&e&&(u=I),m.seedLimit=u,m.seedAssignments=De(1,u+1).map(b=>{let S=y==null?void 0:y.find(T=>T.includes(b)),w=S&&Math.min(...S),U=v&&b>=v?w:b;return{participantId:void 0,seedNumber:b,seedValue:U}}),ui({drawDefinition:o,structureIds:[l]}),{...Q,seedLimit:u}}function Hh({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:o,stage:s}){if(!e)return{error:ve};return a=a??(o==null?void 0:o.entries)??[],{scaledEntries:a.filter(c=>(!s||!c.entryStage||c.entryStage===s)&&(!n||!c.entryStageSequence||c.entryStageSequence===n)&&hs.includes(c.entryStatus)).map(c=>{let{participantId:d}=c,{scaleItem:p}=vg({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...c,...p}}).filter(c=>{let d=c.scaleValue;return!r&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(r||l)};function l(c,d){return t?u(d)-u(c):u(c)-u(d)}function u(c){return parseFloat(c.scaleValue||(t?-1:1e5))}}function QZ(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=ss({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r==null?void 0:r.find(({structureId:m})=>!n.includes(m));if(!a)return te({result:{error:Ni},stack:e});let o=a==null?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:u}=mEe({...t,structureId:o});(t.seededParticipants||t.event||t.seedingScaleName)&&lEe({...t,seedsCount:s,structure:a,structureId:o});let c=t.automated!==!1&&t.drawType!==Ha&&!(t.qualifyingOnly&&t.stage!==Je),d=((r==null?void 0:r.length)||0)>1,p=c?sEe({...t,multipleStructures:d,seedLimit:u,structureId:o}):{};return p!=null&&p.error?te({result:p,stack:e}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function oEe({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{var a,o;let s=(o=(a=It({name:Ul,element:n}))==null?void 0:a.extension)==null?void 0:o.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!s||s===r)&&Ap.includes(n.entryStatus)})}function sEe(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=Lw({...t,seedsOnly:e});if(i.error)return i;let r=i==null?void 0:i.positionAssignments,n=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function lEe(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(Tt);e?uEe({...t,enteredParticipantIds:a}):(n||i)&&cEe({...t,enteredParticipantIds:a})}function uEe(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:u,event:c}=t,d=u?Vh({provisionalPositioning:e,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:u}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,m)=>p.seedNumber<m.seedNumber?-1:p.seedNumber<m.seedNumber?1:0).forEach(p=>{let{participantId:m,seedNumber:h,seedValue:f}=p;Rv({provisionalPositioning:e,tournamentRecord:n,drawDefinition:o,seedingProfile:s,participantId:m,seedBlockInfo:d,structureId:l,seedNumber:h,seedValue:f,event:c})})}function cEe(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:m}=(d==null?void 0:d.category)||{},h=d==null?void 0:d.eventType,f=dEe({...t,ageCategoryCode:m,categoryName:p,eventType:h})||l&&pEe({...t,ageCategoryCode:m,categoryName:p,eventType:h}),g=(f==null?void 0:f.length)??0;g<e&&(e=g),f==null||f.filter(({participantId:v})=>r.includes(v)).slice(0,a||e).forEach((v,y)=>{let I=y+1,{participantId:b,scaleValue:S}=v,w=(n==null?void 0:n[I])||S||I;Rv({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:u,participantId:b,structureId:c,seedNumber:I,seedValue:w,event:d})})}function dEe(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:o}=t,{categoryName:s,ageCategoryCode:l}=(o==null?void 0:o.category)||{},u=o==null?void 0:o.eventType,c={scaleName:i||s||l||o.eventId,scaleType:Fl,eventType:u};return Hh({scaleAttributes:c,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function pEe(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:o,ageCategoryCode:s}=(r==null?void 0:r.category)||{},l=r==null?void 0:r.eventType;return Hh({scaleAttributes:{scaleName:o||s,scaleType:Ac,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function mEe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=oEe(t);e>i.length&&(e=i.length);let{seedLimit:r}=aEe({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function hEe(t){var e;let i=I_({...t,modifyOriginal:!1});if(i.error)return i;let r=i.drawDefinition,{suppressDuplicateEntries:n=!0,ignoreStageSpace:a,appliedPolicies:o,qualifyingOnly:s,seedingProfile:l,participants:u,drawEntries:c,placeByes:d,drawSize:p,drawType:m,entries:h}=t,f=[],g=[],v=fEe({suppressDuplicateEntries:n,ignoreStageSpace:a,drawDefinition:r,drawEntries:c,drawType:m,entries:h});if(v.error)return v;let y=m===Pp?0:tt(t.seedsCount??0),I=QZ({...t,qualifyingOnly:!p||s,appliedPolicies:o,drawDefinition:r,seedingProfile:l,participants:u,stage:Ne,seedsCount:y,placeByes:d,drawSize:p,entries:h});if(I.error&&!I.conflicts)return I;(e=I.positioningReport)!=null&&e.length&&f.push({[Ne]:I.positioningReport});let b=I.structureId;return I.conflicts&&(g=I.conflicts),m===Ha&&t.roundsCount&&rEe({...t,drawDefinition:r,structureId:b}),{drawDefinition:r,positioningReports:f,conflicts:g,structureId:b}}function fEe(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let o of a){if(r&&o.entryStage&&o.entryStage!==Ne)continue;let s={...o,ignoreStageSpace:e??n===Ha,entryStage:o.entryStage??Ne,event:t.event,drawDefinition:i,drawType:n},l=RL(s);if(r&&l.error)return l}return{error:void 0}}var gEe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),vEe=gEe;function IEe(t){let{drawId:e=Ht(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=vEe();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function A_(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:o,event:s}=t,l=We(t,[{[$n]:!0,[OF]:!0}]);if(l.error)return l;if(!Ea({matchUpFormat:n}))return{error:Zb};let u="setMatchUpFormat";if(o){let c=Ti({drawDefinition:r,matchUpId:o,event:s});if(c.error)return c;let d=c.matchUp;if((d==null?void 0:d.matchUpType)===cr)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:ua};d&&(d.matchUpFormat=n,Et({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:u,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===cr)return{error:ql};for(let c of e){let d=rt({drawDefinition:r,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if((s==null?void 0:s.eventType)===cr)return{error:ql};let c=rt({drawDefinition:r,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),ui({drawDefinition:r,structureIds:e}),{...Q}}function yEe({tieFormat:t}){let e=qn({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Ht());return{tieFormat:t}}function bEe({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:r,tieFormat:n,event:a}){if((i||n)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&n&&JSON.stringify(a.tieFormat)===JSON.stringify(n))){if(n){let o=yEe({tieFormat:n});if(o.error)return o;e.tieFormat=o.tieFormat??n}else if(i){let o=A_({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}r&&(e.matchUpType=r)}return{error:void 0}}var ZZ={};wt(ZZ,{attachPolicies:()=>rp,findPolicy:()=>Mp,getAppliedPolicies:()=>Bt,getPolicyDefinitions:()=>tc,mutate:()=>eee,query:()=>iee,removePolicy:()=>tee});var eee={};wt(eee,{attachPolicies:()=>rp,removePolicy:()=>tee});function tee(t){let e=We(t,[{[DSe]:!0,_anyOf:{[gn]:!1,[Ur]:!1,[$n]:!1,[td]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return q2(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ve};for(let a of n){let o=t.tournamentRecords[a],s=q2(t,o);if(s.error)return s;i=!0}}else return{error:ve};return i?{...Q}:{error:eg}}function q2(t,e){let i=Bt(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?_t({element:e,extension:{name:dy,value:i}}):Dn({element:e,name:dy}),{...Q}):{error:eg}}var iee={};wt(iee,{findPolicy:()=>Mp,getAppliedPolicies:()=>Bt,getPolicyDefinitions:()=>tc});var ree={[ko]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Jl]:{positioning:Yd},[as]:{positioning:Yd}},positioning:fSe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},zM=ree;function wEe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return te({info:"policyDefinitions must be an object",result:{error:le},stack:r});let n={[cy]:t==null?void 0:t[cy]};return e?UEe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&rp({drawDefinition:i,policyDefinitions:n}),!(t!=null&&t[ko])&&!(e!=null&&e[ko])&&(rp({policyDefinitions:zM,drawDefinition:i}),t&&Object.assign(t,zM)),{error:void 0}}function UEe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e==null?void 0:e[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(rp({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function SEe(t){var e,i,r,n,a;let{tournamentRecord:o,matchUpFormat:s,appliedPolicies:l,policyDefinitions:u,matchUpType:c,tieFormat:d,drawType:p,stack:m,event:h}=t,f=t.drawId?(e=h==null?void 0:h.drawDefinitions)==null?void 0:e.find(w=>w.drawId===t.drawId):void 0;f&&p!==f.drawType&&(f.drawType=p);let g=f??IEe({processCodes:t.processCodes,drawId:t.drawId,drawType:p}),v=bEe({tournamentRecord:o,drawDefinition:g,matchUpFormat:s,matchUpType:c,tieFormat:d,event:h});if(v.error)return te({result:v,stack:m});let y=wEe({appliedPolicies:l,policyDefinitions:u,drawDefinition:g,stack:m});if(y.error)return y;let I=(r=(i=f==null?void 0:f.structures)==null?void 0:i.find(w=>w.stage===Ne&&w.stageSequence===1))==null?void 0:r.structureId,b=f?(n=f.structures)==null?void 0:n.filter(w=>w.stage===Je):[],S=(b==null?void 0:b.length)===1&&!((a=b[0].matchUps)!=null&&a.length)&&b[0].structureId;return{drawDefinition:g,structureId:I,existingDrawDefinition:f,existingQualifyingPlaceholderStructureId:S}}function TEe(t){var e,i;let r="generateOrGetExisting",n=[],a=[],o=SEe(t);if(o.error)return te({result:o,stack:r});let s=o.existingDrawDefinition,l=o.drawDefinition??{},u=o.structureId,c=t.drawEntries??t.eventEntries??[],d=o.existingQualifyingPlaceholderStructureId&&XRe({...t,...o})||hEe({...t,...o,entries:c});return d.error?te({result:d,stack:r}):((e=d.positioningReports)!=null&&e.length&&n.push(...d.positioningReports??[]),(i=d.conflicts)!=null&&i.length&&a.push(...d.conflicts??[]),l=d.drawDefinition,u=d.structureId,{existingDrawDefinition:s,positioningReports:n,drawDefinition:l,structureId:u,conflicts:a,entries:c})}function DEe(t){var e,i,r;let{qualifyingPlaceholder:n,qualifyingProfiles:a,existingDrawDefinition:o,positioningReports:s,appliedPolicies:l,qualifyingOnly:u,drawDefinition:c,seedingProfile:d,participants:p,structureId:m,entries:h,stack:f}=t,g=n&&!(a!=null&&a.length)&&!o,v=[];if(a){let y=(w,U)=>w.stageSequence-U.stageSequence,I=(w,U)=>w.roundTarget-U.roundTarget,b=[],S=1;a.sort(I);for(let w of a){if(!Array.isArray(w.structureProfiles))return te({info:ip("structureProfiles"),result:{error:Qe},stack:f});S=w.roundTarget||S;let U=((e=w.structureProfiles)==null?void 0:e.sort(y))||[],T=1;for(let D of U){let{qualifyingRoundNumber:P,qualifyingPositions:E,seededParticipants:R,seedingScaleName:N,seedsCount:A=0,seedByRanking:M,placeByes:C,drawSize:O}=D,k=QZ({...t,seedingProfile:D.seedingProfile??d,stageSequence:T,qualifyingRoundNumber:P,preparedStructureIds:b,qualifyingPositions:E,seededParticipants:R,stage:Je,seedingScaleName:N,appliedPolicies:l,drawDefinition:c,qualifyingOnly:u,seedByRanking:M,participants:p,roundTarget:S,seedsCount:A,placeByes:C,drawSize:O,entries:h});if(k.error)return k;k.structureId&&b.push(k.structureId),T+=1,(i=k.conflicts)!=null&&i.length&&v.push(...k.conflicts),(r=k.positioningReport)!=null&&r.length&&s.push({[Je]:k.positioningReport})}S+=1}}else if(m&&g){let y=uo({structureName:tn(Je),stage:Je}),{link:I}=_w({sourceStructureId:y.structureId,targetStructureId:m,sourceRoundNumber:0,linkType:ku});c.structures||(c.structures=[]),c.structures.push(y),c.links||(c.links=[]),c.links.push(I)}return{qualifyingConflicts:v,error:void 0}}var nee={};wt(nee,{addGoesTo:()=>tp,allCompetitionMatchUps:()=>Ls,allDrawMatchUps:()=>Pn,allEventMatchUps:()=>ou,allPlayoffPositionsFilled:()=>GL,allTournamentMatchUps:()=>Hr,analyzeDraws:()=>Ww,analyzeMatchUp:()=>Uy,analyzeTournament:()=>j_,bulkUpdatePublishedEventIds:()=>z_,calculateWinCriteria:()=>Wh,categoryCanContain:()=>nw,checkMatchUpIsComplete:()=>Cd,checkValidEntries:()=>hR,compareTieFormats:()=>Vu,competitionScheduleMatchUps:()=>eU,courtGridRows:()=>OR,credits:()=>PEe,drawMatchUps:()=>a$,eventMatchUps:()=>FR,filterMatchUps:()=>mu,filterParticipants:()=>Aw,findDrawDefinition:()=>m_,findExtension:()=>It,findVenue:()=>au,getAggregateTeamResults:()=>V_,getAllDrawMatchUps:()=>gr,getAllEventData:()=>W_,getAllStructureMatchUps:()=>qt,getAllowedDrawTypes:()=>SR,getAllowedMatchUpFormats:()=>__,getAppliedPolicies:()=>Bt,getAssignedParticipantIds:()=>kp,getAvailableMatchUpsCount:()=>pR,getAvailablePlayoffProfiles:()=>$w,getCategoryAgeDetails:()=>xm,getCheckedInParticipantIds:()=>xh,getCompetitionDateRange:()=>DR,getCompetitionMatchUps:()=>wy,getCompetitionParticipants:()=>O_,getCompetitionPenalties:()=>$_,getCompetitionVenues:()=>Jw,getCourtInfo:()=>KP,getCourts:()=>o$,getDrawData:()=>RR,getDrawDefinitionTimeItem:()=>cL,getDrawParticipantRepresentativeIds:()=>d_,getDrawStructures:()=>ss,getDrawTypeCoercion:()=>qw,getEligibleVoluntaryConsolationParticipants:()=>c_,getEntriesAndSeedsCount:()=>kR,getEvent:()=>u$,getEventData:()=>ER,getEventMatchUpFormatTiming:()=>J_,getEventProperties:()=>s$,getEventPublishStatus:()=>Mo,getEventStructures:()=>rR,getEventTimeItem:()=>fw,getEvents:()=>l$,getFlightProfile:()=>Hi,getHomeParticipantId:()=>e$,getLinkedTournamentIds:()=>pw,getMatchUpCompetitiveProfile:()=>Tw,getMatchUpContextIds:()=>t$,getMatchUpDailyLimits:()=>_R,getMatchUpDailyLimitsUpdate:()=>X_,getMatchUpDependencies:()=>fs,getMatchUpFormat:()=>i$,getMatchUpFormatTiming:()=>Dw,getMatchUpFormatTimingUpdate:()=>K_,getMatchUpScheduleDetails:()=>JP,getMatchUpType:()=>XP,getMatchUpsMap:()=>ln,getMatchUpsStats:()=>r$,getMatchUpsToSchedule:()=>CR,getMaxEntryPosition:()=>Y_,getModifiedMatchUpFormatTiming:()=>xR,getPairedParticipant:()=>ls,getParticipantEventDetails:()=>k_,getParticipantIdFinishingPositions:()=>p_,getParticipantMembership:()=>x_,getParticipantResults:()=>jw,getParticipantScaleItem:()=>vg,getParticipantSchedules:()=>F_,getParticipantSignInStatus:()=>L_,getParticipantTimeItem:()=>dL,getParticipants:()=>Ai,getPersonRequests:()=>Lp,getPolicyDefinitions:()=>tc,getPositionAssignments:()=>Iy,getPositionsPlayedOff:()=>Cv,getPredictiveAccuracy:()=>Z_,getProfileRounds:()=>AR,getPublishState:()=>$h,getRoundMatchUps:()=>An,getRounds:()=>n$,getScaleValues:()=>Iv,getScaledEntries:()=>Hh,getScheduledRoundsDetails:()=>Xw,getSchedulingProfile:()=>ac,getSchedulingProfileIssues:()=>q_,getSeedingThresholds:()=>LL,getSeedsCount:()=>Yw,getStructureSeedAssignments:()=>Io,getTeamLineUp:()=>ep,getTieFormat:()=>H_,getTimeItem:()=>Ro,getTournamentIds:()=>cw,getTournamentInfo:()=>zh,getTournamentPenalties:()=>TR,getTournamentPersons:()=>B_,getTournamentPoints:()=>PR,getTournamentPublishStatus:()=>Nw,getTournamentStructures:()=>jL,getTournamentTimeItem:()=>HP,getValidGroupSizes:()=>xw,getVenueData:()=>hg,getVenuesAndCourts:()=>nc,isAdHoc:()=>Yn,isCompletedStructure:()=>$c,isValidForQualifying:()=>g_,isValidMatchUpFormat:()=>Ea,matchUpActions:()=>mR,participantScaleItem:()=>_l,participantScheduledMatchUps:()=>Q_,positionActions:()=>f_,publicFindCourt:()=>UL,publicFindVenue:()=>wL,tallyParticipantResults:()=>Mv,tieFormatGenderValidityCheck:()=>bP,tournamentMatchUps:()=>LR,validMatchUp:()=>zP,validMatchUps:()=>Co,validateCollectionDefinition:()=>aw,validateLineUp:()=>iR});function PEe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var aee={};wt(aee,{filterParticipants:()=>Aw,getCompetitionParticipants:()=>O_,getPairedParticipant:()=>ls,getParticipantEventDetails:()=>k_,getParticipantMembership:()=>x_,getParticipantScaleItem:()=>vg,getParticipantSchedules:()=>F_,getParticipantSignInStatus:()=>L_,getParticipantTimeItem:()=>dL,getParticipants:()=>Ai,getScaleValues:()=>Iv,participantScaleItem:()=>_l,validateLineUp:()=>iR});function O_(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:ki};let i=[],r={},n={},a={},o=[],s={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:m,matchUps:h,derivedEventInfo:f,derivedDrawInfo:g}=Ai({...t,tournamentRecord:u});Object.assign(s,d),Object.assign(r,p),Object.assign(n,f),Object.assign(a,g),i.push(...m??[]),o.push(...h??[]),c==null||c.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:s,participants:i,...Q,matchUps:o}}function k_({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:fr};let i=[e].concat((t.participants??[]).filter(r=>{var n;return(r==null?void 0:r.participantType)&&[Jt,gt].includes(r.participantType)&&((n=r.individualParticipantIds)==null?void 0:n.includes(e))}).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=((r==null?void 0:r.entries)??[]).map(a=>a.participantId);return Nn(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function x_({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:fr};let{participants:i}=Ai({participantFilters:{participantTypes:[Jt,gt,Qa]},tournamentRecord:t});return(i??[]).filter(r=>{var n;return(n=r.individualParticipantIds)==null?void 0:n.includes(e)}).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function F_({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:ve};if(typeof t!="object")return{error:Zu,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=Hr({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),o=fs({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],s={};for(let l of a){let{sides:u}=l,c,d=(u==null?void 0:u.map(m=>{if(m.participant)return[m.participant].concat(...m.participant.individualParticipants||[]);o[l.matchUpId]&&!c&&(c=(o[l.matchUpId]||[]).map(h=>n[h]).filter(({winningSide:h,bye:f})=>!h&&!f))}).filter(Boolean).flat())??[];for(let m of d){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].matchUps.push(l)}let p=(c==null?void 0:c.map(({sides:m})=>m).flat().map(({participant:m})=>m&&[m].concat(...m.individualParticipants||[])).filter(Boolean).flat())||[];for(let m of p){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...Q}}function L_({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:fr};let{participant:i}=ad({tournamentRecord:t,participantId:e});if(!i)return{error:Wi};let{timeItem:r}=Ro({itemType:hw,element:i});return r&&r.itemValue===my&&my}var oee={};wt(oee,{analyzeDraws:()=>Ww,analyzeTournament:()=>j_,getAggregateTeamResults:()=>V_,getAllowedDrawTypes:()=>SR,getAllowedMatchUpFormats:()=>__,getAppliedPolicies:()=>Bt,getCompetitionDateRange:()=>DR,getCompetitionPenalties:()=>$_,getPolicyDefinitions:()=>tc,getTournamentInfo:()=>zh,getTournamentPenalties:()=>TR,getTournamentPersons:()=>B_,getTournamentPoints:()=>PR,getTournamentStructures:()=>jL,getTournamentTimeItem:()=>HP});function __({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:ve};let{appliedPolicies:n}=Bt({tournamentRecord:t});return(((r=n==null?void 0:n[vo])==null?void 0:r.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function SR({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:ve};let{appliedPolicies:n}=Bt({tournamentRecord:t});return(((r=n==null?void 0:n[n0])==null?void 0:r.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function TR({tournamentRecord:t}){if(!t)return{error:ve};let e=((t==null?void 0:t.participants)??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:o}=a||{};i[o]?i[o].participants.push(n):i[o]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function $_({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let e=[];for(let i of Object.values(t)){let{penalties:r}=TR({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function see({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:m,notes:h})=>({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:m,notes:h}))(t)}}var REe={[yv]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},EEe=REe;function zh(t){var e,i,r,n;let{tournamentRecord:a}=t??{};if(!a)return{error:ve};let o=(({tournamentId:d,tournamentRank:p,tournamentStatus:m,formalName:h,tournamentName:f,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:I,startDate:b,endDate:S,hostCountryCode:w,venues:U,notes:T,updatedAt:D})=>({tournamentId:d,tournamentRank:p,tournamentStatus:m,formalName:h,tournamentName:f,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:I,startDate:b,endDate:S,hostCountryCode:w,venues:U,notes:T,updatedAt:D}))(a),s=((e=Ai({participantFilters:{participantRoles:[IX,CL,yX,bX,UX]},policyDefinitions:EEe,tournamentRecord:a}))==null?void 0:e.participants)??[];s&&(o.tournamentContacts=s);let l=(i=$h({tournamentRecord:a}))==null?void 0:i.publishState,u=((n=(r=l==null?void 0:l.tournament)==null?void 0:r.status)==null?void 0:n.publishedEventIds)||[],c=[];for(let d of a.events??[])if(!(t!=null&&t.usePublishState)||u.includes(d.eventId)){let p=see({event:d}).eventInfo;p&&c.push(p)}return o.timeItemValues=RQ({element:a}),o.publishState=l==null?void 0:l.tournament,o.eventInfo=c,{tournamentInfo:Me(Ge(o),!1,!0),...Q}}function DR({tournamentRecords:t}){if(!At(t))return{error:ki};let e=Object.keys(t??{}).reduce((n,a)=>{let o=t[a],{tournamentInfo:{startDate:s,endDate:l}}=zh({tournamentRecord:o}),u=s&&new Date(ht(s));(!n.startDate||u&&u<n.startDate)&&(n.startDate=u);let c=l&&new Date(ht(l));return(!n.endDate||c&&c>n.endDate)&&(n.endDate=c),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&ht(e.startDate.toISOString()),r=e.endDate&&ht(e.endDate.toISOString());return!i||!r?{error:o9}:{startDate:i,endDate:r}}function B_({tournamentRecord:t,participantFilters:e}){if(!t)return{error:ve};let i=t.participants||[];e&&(i=Aw({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:o}=a.person;r[o]?r[o].participantIds.push(a.participantId):r[o]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function V_(t){var e,i,r,n,a,o,s,l;let u=We(t,[{[Ur]:!0}]);if(u.error)return u;let c=t.finishingPositionRangeBounsPoints||{},d={},p=I=>{var b,S,w;let U=(b=I==null?void 0:I.individualParticipants)==null?void 0:b.map(T=>{var D;return((D=T.teams)==null?void 0:D.length)===1&&T.teams[0]});return((S=I==null?void 0:I.teams)==null?void 0:S.length)===1&&((w=I==null?void 0:I.teams)==null?void 0:w[0])||(U==null?void 0:U[0].participantId)===(U==null?void 0:U[1].participantId)&&(U==null?void 0:U[0])},{matchUps:m,participants:h}=Ai({participantFilters:{participantTypes:[Dt]},withRankingProfile:!0,withStatistics:!0,...t});for(let I of h??[]){if(I.participantType===Gn)continue;((i=(e=I.draws)==null?void 0:e[0])==null?void 0:i.drawId)==="draw-0-3"&&console.log(I.participantType,I.draws[0].finishingPositionRange);let b=p(I);if(b)for(let S of(I==null?void 0:I.draws)??[]){let w=(r=S==null?void 0:S.finishingPositionRange)==null?void 0:r.join("-");if(w&&c!=null&&c[w]){let U=b==null?void 0:b.participantId,T=S==null?void 0:S.drawId,D=`${U}|${T}|${w}`;d[D]=c[w]}}}let f=I=>({teamName:I,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),g=(I,b,S)=>{I[b]===void 0&&(I[b]=0),I[b]+=S},v={},y={};for(let I of m??[]){let{sides:b,matchUpFormat:S}=I,w=S&&Ln(S);if((b==null?void 0:b.length)===2&&(n=w.setFormat)!=null&&n.timed&&(!w.finalSetFormat||(a=w.finalSetFormat)!=null&&a.timed))for(let U of b){let T=p(U.participant),D=T==null?void 0:T.participantId,P=(o=U.participant)==null?void 0:o.participantId,E=T==null?void 0:T.participantName,R=U.sideNumber,N=((s=U.participant)==null?void 0:s.individualParticipantIds)||P&&[P]||[];if(N.forEach(A=>{A&&!v[A]&&(v[A]=f(E))}),D&&R){y[D]||(y[D]=f(E));let A=[...N.map(C=>v[C]),y[D]];I.winningSide&&(R===I.winningSide?A.forEach(C=>g(C,"win",1)):A.forEach(C=>g(C,"loss",1)));let M=((l=I.score)==null?void 0:l.sets)||[];for(let C of M){let O=(C==null?void 0:C[`side${3-R}Score`])||0,k=(C==null?void 0:C[`side${R}Score`])||0,x=k-O;A.forEach(F=>g(F,"pointsPlayed",k+O)),A.forEach(F=>g(F,"points",k)),A.forEach(F=>g(F,"diff",x))}}}}for(let I of Object.keys(d)){let[b]=I.split("|");y[b]&&(y[b].bonus+=d[I],y[b].pointsPct=parseFloat((y[b].points/y[b].pointsPlayed).toFixed(2)),y[b].standingPoints=y[b].win+y[b].bonus)}for(let I of Object.keys(v))v[I].pointsPct=parseFloat((v[I].points/v[I].pointsPlayed).toFixed(2));return{...Q,individualResults:v,teamResults:y}}function CEe(t){var e,i,r,n,a,o,s;let l=((i=(e=t.participants)==null?void 0:e.filter(({participantType:p})=>p===Jt))==null?void 0:i.length)===2,u=((r=t.events)==null?void 0:r.length)===1&&t.events[0],c=((n=u==null?void 0:u.drawDefinitions)==null?void 0:n.length)===1&&u.drawDefinitions[0],d=((s=(o=((a=c==null?void 0:c.structures)==null?void 0:a.length)===1&&c.structures[0])==null?void 0:o.positionAssignments)==null?void 0:s.length)===2;return!!(u.tieFormat&&l&&d)}function j_({tournamentRecord:t}){var e;if(!t)return{error:ve};let{drawsAnalysis:i}=Ww({tournamentRecord:t}),r={isDual:CEe(t),drawsAnalysis:i},n=Ai({tournamentRecord:t});return(e=n.missingParticipantIds)!=null&&e.length&&(r.missingParticipantIds=n.missingParticipantIds),{...Q,analysis:r}}function lee(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function MEe(t){let{participation:e={},awardProfiles:i,startDate:r,eventType:n,drawSize:a,drawType:o,category:s,endDate:l,level:u}=t,{participationOrder:c,flightNumber:d,rankingStage:p}=e,m=h=>!r&&!l||!h.dateRanges?!0:h.dateRanges.some(f=>{let g=!r||!f.startDate||new Date(r)>new Date(f.startDate),v=!l||!f.endDate||new Date(l)<=new Date(f.endDate);return g&&v});return{awardProfile:i.find(h=>{var f,g,v,y,I,b,S,w,U,T;return m(h)&&(!h.maxFlightNumber||d<=h.maxFlightNumber)&&(!((f=h.drawTypes)!=null&&f.length)||((g=h.drawTypes)==null?void 0:g.includes(o)))&&(!((v=h.drawSizes)!=null&&v.length)||h.drawSizes.includes(a))&&(!((y=h.stages)!=null&&y.length)||h.stages.includes(p))&&(!((I=h.levels)!=null&&I.length)||h.levels.includes(u))&&(!h.maxDrawSize||a<=h.maxDrawSize)&&(!h.drawSize||h.drawSize===a)&&(!h.maxLevel||u<=h.maxLevel)&&(!d||!((S=(b=h.flights)==null?void 0:b.flightNumbers)!=null&&S.length)||h.flights.flightNumbers.includes(d))&&(!h.participationOrder||h.participationOrder===c)&&(!((w=h.category)!=null&&w.ageCategoryCodes)||h.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((U=h.eventTypes)!=null&&U.length)||((T=h.eventTypes)==null?void 0:T.includes(n)))})}}function Y2({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){var o,s;let l=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(I=>I.flight===g||I.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},u=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(st(g)?g:0),I=lee(a,g==null?void 0:g.level);return{value:l(v,I)||st(I)&&I||y}},c=0,d,p,m,h,f=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(I=>{var b;return I.drawSize===r||((b=I.drawSizes)==null?void 0:b.includes(r))}),v=i.find(I=>I.drawSize&&I.threshold&&r>I.drawSize),y=i.find(I=>{var b;return!I.drawSize&&!((b=I.drawSizes)!=null&&b.length)});f!==void 0&&(g=g==null?void 0:g[f],v=v==null?void 0:v[f],y=y==null?void 0:y[f]),p=u(g,e).value,m=u(v,e).value,h=u(y,e).value,c=p||m||h,d=p&&g.requireWin||m&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(o=i==null?void 0:i.drawSizes)==null?void 0:o[r],v=i;f!==void 0&&(g=g==null?void 0:g[f],v=v==null?void 0:v[f]),p=u(g,e).value,h=u(v,e).value,c=p||h,d=p?g.requireWin:v==null?void 0:v.requireWin}else st(i)&&f===void 0&&(c=i);return e&&(s=n==null?void 0:n.pct)!=null&&s[e]&&(c=Math.round(c*n.pct[e])),{awardPoints:c,requireWin:d}}function PR({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){var n;if(!i)return{error:ve};let{policyDefinitions:a}=tc({policyTypes:[ZU],tournamentRecord:i}),o=(e==null?void 0:e[ZU])??(a==null?void 0:a[ZU]);if(!o)return{error:aP};let s=o.awardProfiles,l=o.requireWinFirstRound,u=o.requireWinForPoints,{participants:c,derivedEventInfo:d,derivedDrawInfo:p,mappedMatchUps:m}=Ai({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),h=c==null?void 0:c.filter(y=>{var I;return(I=y.draws)==null?void 0:I.length}),f={},g={},v={};for(let y of h??[]){let{participantType:I,participantId:b,person:S,draws:w}=y;for(let U of w){let{drawId:T,structureParticipation:D,eventId:P}=U,E=d[P],R=p[T],N=R==null?void 0:R.drawType,{category:A,eventType:M}=E||{},C=U.startDate||E.startDate||i.startDate,O=U.endDate||E.endDate||i.endDate;if(M===Ca&&b!==Gn)continue;let k;if(s){let x=u,F=0,$=0,_=0,L;for(let B of D){let{finishingPositionRange:V,participationOrder:G,participantWon:j,flightNumber:z,rankingStage:W,winCount:q}=B;F+=q||0;let Y=R==null?void 0:R.drawSize,{awardProfile:re}=MEe({awardProfiles:s,participation:B,eventType:M,startDate:C,category:A,drawSize:Y,drawType:N,endDate:O,level:r});if(re){if(!Y)continue;let J=Array.isArray(V)&&Math.max(...V),H=dt(V||[]).join("-"),Z=J&&W!==Je&&(V==null?void 0:V.includes(Y));re.requireWinForPoints!==void 0&&(x=re.requireWinForPoints),re.requireWinFirstRound!==void 0&&(l=re.requireWinFirstRound);let{finishingPositionPoints:K={},finishingPositionRanges:ie,finishingRound:ae,pointsPerWin:oe,flights:ne}=re,de=Array.isArray(re.perWinPoints)?(n=re.perWinPoints)==null?void 0:n.find(we=>{var Ze;return(Ze=we.participationOrders)==null?void 0:Ze.includes(G)}):re.perWinPoints,ye=K.participationOrders,ce=0,ke;if((!ye||ye.includes(G))&&ie&&J){let we=ie[J];we&&({awardPoints:ce,requireWin:ke}=Y2({flightNumber:z,valueObj:we,drawSize:Y,flights:ne,level:r}))}if(!ce&&ae&&G===1&&J){let we=ae[J];we&&({awardPoints:ce,requireWin:ke}=Y2({participantWon:j,flightNumber:z,valueObj:we,drawSize:Y,flights:ne,level:r}))}if(Z&&l!==void 0&&(x=l),ke!==void 0&&(x=ke),ce>$&&(!x||q)&&($=ce,L=J),!ce&&oe&&q&&(_+=q*oe,L=H),!ce&&q&&de){let we=lee(r,de==null?void 0:de.level);we?_+=q*we:de.value&&(_+=q*de.value)}}if(k=$+_,I===Gn){let J=(y.matchUps||[]).filter(({structureId:H})=>H===B.structureId);for(let{matchUpId:H}of J){let Z=m[H],K=Z.sides.find(ie=>ie.participantId===b).sideNumber;if(Z.winningSice===K)for(let ie of Z.tieMatchUps)ie.winningSide}}}if(_||$){let B={winCount:F,positionPoints:$,rangeAccessor:L,perWinPoints:_,eventType:M,drawId:T,points:k},V=S==null?void 0:S.personId;V?(f[V]||(f[V]=[]),f[V].push(B)):I===gt?(v[b]||(v[b]=[]),v[b].push(B)):I===Gn&&(g[b]||(g[b]=[]),g[b].push(B))}}}}return{participantsWithOutcomes:h,personPoints:f,pairPoints:v,teamPoints:g,...Q}}var uee={};wt(uee,{compareTieFormats:()=>Vu,getTieFormat:()=>H_,tieFormatGenderValidityCheck:()=>bP,validateCollectionDefinition:()=>aw});function U0(t){var e;if(!t)return{};let i=[],r=t.tieFormatName,n=(e=t.collectionDefinitions)==null?void 0:e.map(a=>{let{matchUpType:o,matchUpFormat:s,matchUpCount:l,category:u,gender:c}=a;i.includes(s)||i.push(s);let d=u==null?void 0:u.ageCategoryCode;return[l,o===Wd?"D":"S",d,s,c].join(";")}).join("|");return{tieFormatName:t&&r||"UNNAMED",matchUpFormats:i,tieFormatDesc:n}}function Vu({considerations:t={},descendant:e,ancestor:i}){var r,n;let a={},o={},{matchUpFormats:s,tieFormatDesc:l}=U0(e),{matchUpFormats:u,tieFormatDesc:c}=U0(i),d=dt((s??[]).filter(U=>!(u??[]).includes(U)).concat((u??[]).filter(U=>!(s??[]).includes(U)))),p=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionName:U})=>U).join("|")),m=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")),h=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U}))),f=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U})));a.collectionIds=p2(Object.keys(h),Object.keys(f)),o.collectionIds=p2(Object.keys(f),Object.keys(h)),a.collectionsValue=K2(h),o.collectionsValue=K2(f),a.groupsCount=((r=i==null?void 0:i.collectionGroups)==null?void 0:r.length)??(0-(((n=e==null?void 0:e.collectionGroups)==null?void 0:n.length)??0)||0),o.groupsCount=a.groupsCount?-1*a.groupsCount:0;let g=a.collectionsValue.totalValue-o.collectionsValue.totalValue,v=a.collectionsValue.totalMatchUps-o.collectionsValue.totalMatchUps,y=o.collectionsValue.assignmentValues.length!==a.collectionsValue.assignmentValues.length,I=o.collectionsValue.assignmentValues.some((U,T)=>{let D=a.collectionsValue.assignmentValues[T];return!D||U.valueKey!==D.valueKey||U.value!==D.value?!0:Array.isArray(U.value)?U.value.every((P,E)=>D.value[E]===P):!1}),b=p||m||c!==l||y||I||g!==0,S=[...o.collectionsValue.invalidValues,...a.collectionsValue.invalidValues],w=S.length&&S;return{matchUpFormatDifferences:d,matchUpCountDifference:v,descendantDifferences:a,ancestorDifferences:o,orderDifference:m,valueDifference:g,nameDifference:p,descendantDesc:l,ancestorDesc:c,...Q,different:b,invalid:w}}function K2(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(ZP).reduce((n,a)=>{let o=t[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=o,m={collectionValueProfiles:s,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},h=Object.keys(m).filter(g=>![void 0,null].includes(m[g])&&(!Array.isArray(m[g])||m[g].length>0));h.length!==1&&e.push({collectionId:a});let f=h[0];if(f){let g=f==="collectionValueProfiles"?Object.values(s):m[f];i.push({valueKey:f,value:g})}return r+=u,s!=null&&s.length?n+s.reduce((g,v)=>g+v.value,0):u?st(c)?n+c*u:st(d)?n+d*u:st(p)?n+p*u:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function G_(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=cee(t);return{matchUp:Me(e,!0,!0),error:i}}function cee({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:u,drawId:c,event:d}){var p;if(!i)return{error:ve};if(typeof s!="string")return{error:bn};if(!a||!d){let f=(Hr({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find(g=>g.matchUpId===s);if(!f)return{error:fn};({eventId:u,drawId:c}=f),{event:d,drawDefinition:a}=Kn({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:ja};n&&!r&&(r=ic({tournamentRecord:i,contextProfile:n}));let m={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:u??(d==null?void 0:d.eventId),drawId:c},{participants:h=[]}=Cp({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(o){let f=(Pn({context:l?m:void 0,participants:h,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!f)return{error:fn};let g=(p=a==null?void 0:a.structures)==null?void 0:p.find(v=>v.structureId===f.structureId);return{drawDefinition:a,structure:g,matchUp:f}}else{let{matchUp:f,structure:g}=Ti({context:l?m:void 0,tournamentParticipants:h,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:s,inContext:l,event:d});return{matchUp:f,structure:g,drawDefinition:a}}}function H_({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:o,event:s}){var l,u,c,d,p;if(!t)return{error:ve};if(!o&&!s&&!i&&!r)return te({result:{error:Qe},stack:"getTieFormat"});a&&!s&&(s=(l=t.events)==null?void 0:l.find(y=>y.eventId===a));let m=G_({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:o,event:s});if(r&&m!=null&&m.error)return m;if(!e&&m!=null&&m.drawDefinition&&(e=m==null?void 0:m.drawDefinition),n=n??(m==null?void 0:m.structure),!n&&i&&!r){if(!e)return{error:Bs};let y=rt({drawDefinition:e,structureId:i});if(y.error)return y;n=y.structure}let h=((n==null?void 0:n.tieFormat)||(n==null?void 0:n.tieFormatId))&&((u=In({structure:n,drawDefinition:e,event:s}))==null?void 0:u.tieFormat),f=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((c=In({drawDefinition:e,event:s}))==null?void 0:c.tieFormat),g=(d=In({event:s}))==null?void 0:d.tieFormat,v=(p=In({matchUp:m==null?void 0:m.matchUp,drawDefinition:e,structure:n,event:s}))==null?void 0:p.tieFormat;return{...Q,matchUp:m==null?void 0:m.matchUp,structureDefaultTieFormat:Yr(h),eventDefaultTieFormat:Yr(g),drawDefaultTieFormat:Yr(f),tieFormat:Yr(v),structure:n}}var dee={};wt(dee,{bulkUpdatePublishedEventIds:()=>z_,getAllEventData:()=>W_,getCourtInfo:()=>KP,getDrawData:()=>RR,getEventData:()=>ER,getEventPublishStatus:()=>Mo,getPublishState:()=>$h,getTournamentPublishStatus:()=>Nw,getVenueData:()=>hg});function z_({tournamentRecord:t,outcomes:e}){var i;if(!t)return{error:ve};if(!(e!=null&&e.length))return{error:Qe,info:"Missing outcomes"};let r=e.reduce((a,o)=>{let{drawId:s,eventId:l}=o;return l&&s&&(a[l]?a[l].includes(s)||a[l].push(s):a[l]=[s]),a},{}),n=Object.keys(r);return{publishedEventIds:((i=t.events)==null?void 0:i.filter(a=>n.includes(a.eventId))).filter(a=>{let o=Mo({event:a}),{drawDetails:s,drawIds:l}=o??{},{eventId:u}=a;return r[u].filter(c=>{let d=s?Object.keys(o.drawDetails).filter(p=>PL({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(c))||d.includes(c)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:r}}function pee({dates:t=[],extension:e}){var i;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let r=At(e.value)?(i=e.value)==null?void 0:i.dates:void 0;if(Array.isArray(r))return r!=null&&r.length?!!r.filter(n=>!t.length||t.includes(n)).length:!1}function mee({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){var n;let a={...Me(r,t,!0),venueId:i.venueId},{extension:o}=It({name:Ds,element:r});if(e&&o){let s=At(o.value)?(n=o.value)==null?void 0:n.dates:void 0,l=(o==null?void 0:o.value)===!0?[]:a.dateAvailability.map(u=>{let c=u.date;if(!(!c||s.includes(c)))return u}).filter(Boolean);a.dateAvailability=l}return{inContextCourt:a}}function nc(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},o=[],s=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])if(!(r.length&&!r.includes(p.venueId))){if(i){let{extension:m}=It({name:Ds,element:p});if(m!=null&&m.value)continue}o.includes(p.venueId)||(u.push(Me(p,e,!0)),o.push(p.venueId));for(let m of p.courts??[])if(!s.includes(m.courtId)){if(i){let{extension:f}=It({name:Ds,element:m});if(pee({extension:f,dates:n}))continue}let{inContextCourt:h}=mee({convertExtensions:e,ignoreDisabled:i,venue:p,court:m});l.push(h),s.push(m.courtId)}}}),{courts:l,venues:u,...Q}}function NEe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:ki};let n=Me(e.venues??[],t).filter(o=>{if(!i)return o;let{extension:s}=It({name:Ds,element:o});return!(s!=null&&s.value)&&o}).filter(Boolean),a=n.reduce((o,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(u=>{if(!i&&!(r!=null&&r.length))return u;let{extension:c}=It({name:Ds,element:u});return pee({extension:c,dates:r})}).filter(Boolean).map(u=>{let{inContextCourt:c}=mee({convertExtensions:t,ignoreDisabled:i,venue:s,court:u});return c});return l.length?o.concat(l):o},[]);return{venues:n,courts:a}}function Jw({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:ki}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:o}=NEe({tournamentRecord:a,dates:i});return o==null||o.forEach(s=>{let{venueId:l,courts:u}=s;(!e||u!=null&&u.length)&&!r.venueIds.includes(l)&&(r.venues.push(s),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function W_({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:ve};let i=t.events||[],r=(t==null?void 0:t.participants)||[],{tournamentInfo:n}=zh({tournamentRecord:t}),{venues:a}=nc({tournamentRecord:t}),o=i.map(s=>{let{eventId:l}=s,u=see({event:s}).eventInfo,c=gw({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(m=>{let h=(({drawId:I,drawName:b,matchUpFormat:S,updatedAt:w})=>({matchUpFormat:S,updatedAt:w,drawName:b,drawId:I}))(m),{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=Tv({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:m,event:s});return{drawInfo:h,matchUps:{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=Mo({event:s});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:o}}}function hee({publishStatus:t,drawId:e}){var i,r,n;return t!=null&&t.drawDetails?(n=(r=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:r.publishingDetail)==null?void 0:n.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}var fee="PUBLIC",AEe="ADMIN",OEe={PUBLIC_DISPLAY:fee,ADMIN_DISPLAY:AEe};function RR(t){var e,i,r;let{tournamentParticipants:n=[],includePositionAssignments:a,policyDefinitions:o,tournamentRecord:s,inContext:l=!0,usePublishState:u,status:c=Za,pressureRating:d,refreshResults:p,contextProfile:m,drawDefinition:h,noDeepCopy:f,sortConfig:g,context:v,event:y}=t;if(!h)return{error:_e};let I=(({matchUpFormat:M,updatedAt:C,drawType:O,drawName:k,drawId:x})=>({matchUpFormat:M,updatedAt:C,drawName:k,drawType:O,drawId:x}))(h);I.display=(e=It({element:h,name:a0}).extension)==null?void 0:e.value;let b={},S,{allStructuresLinked:w,sourceStructureIds:U,hasDrawFeedProfile:T,structureGroups:D}=nR({drawDefinition:h});if(!w)return{error:YK};let P=(t==null?void 0:t.publishStatus)??Mo({event:y,status:c}),E=t.eventPublished??!!((r=(i=$h({event:y}).publishState)==null?void 0:i.status)!=null&&r.published),R=!1,N=!1,A=D.map(M=>{let C={},O=M.map(k=>{let{structure:x}=rt({drawDefinition:h,structureId:k}),{seedAssignments:F}=Io({drawDefinition:h,structure:x});return(x==null?void 0:x.stage)===Ne&&x.stageSequence===1&&(S=F),(x==null?void 0:x.stage)===Je&&(b[x.stageSequence??0]=F),x}).sort((k,x)=>Mh(k,x,g)).map(k=>{var x,F;if(!k)return;let $=k==null?void 0:k.structureId,_=[];k.stage&&[Ne,an,Bi].includes(k.stage)&&(_=S),(k==null?void 0:k.stage)===Je&&(_=b[k.stageSequence??0]);let{matchUps:L,roundMatchUps:B,roundProfile:V}=qt({seedAssignments:(x=k==null?void 0:k.seedAssignments)!=null&&x.length?void 0:_,context:{drawId:I.drawId,...v},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:n,policyDefinitions:o,tournamentRecord:s,usePublishState:u,publishStatus:P,contextProfile:m,drawDefinition:h,inContext:l,structure:k,event:y}),{positionAssignments:G}=si({structure:k}),j=G==null?void 0:G.filter(Na(Xl)).map(Y=>{var re,J;let H=(J=(re=It({element:Y,name:kc}))==null?void 0:re.extension)==null?void 0:J.value,{drawPosition:Z,participantId:K}=Y;return N=!0,{participantResult:H,participantId:K,drawPosition:Z}});if(L.length&&(!(j!=null&&j.length)&&t.allParticipantResults||p&&!k.structures)){let{subOrderMap:Y}=UQ({positionAssignments:G}),re=L.some(H=>H.matchUpType===Va)?L.filter(H=>H.matchUpType===Va):L,J=Mv({matchUpFormat:k.matchUpFormat,matchUps:re,policyDefinitions:o,pressureRating:d,subOrderMap:Y});j=G==null?void 0:G.filter(Na(Xl)).map(H=>{var Z;let{drawPosition:K,participantId:ie}=H;return N=!0,{participantResult:ie&&((Z=J==null?void 0:J.participantResults)==null?void 0:Z[ie]),participantId:ie,drawPosition:K}})}let z=k?(({stageSequence:Y,structureName:re,structureType:J,matchUpFormat:H,stage:Z})=>({stageSequence:Y,structureName:re,structureType:J,matchUpFormat:H,stage:Z}))(k):{},W=(F=It({element:k,name:a0}).extension)==null?void 0:F.value;z.display=(W==null?void 0:W[fee])??W,z.sourceStructureIds=U[$],z.hasDrawFeedProfile=T[$],z.positionAssignments=G,z.structureActive=L.reduce((Y,re)=>{var J;let H=[ir,pr,ms,Ki,Sl,Pt,zr,Ft].includes(re.matchUpStatus);return Y||H||!!re.winningSide||!!((J=re.score)!=null&&J.scoreStringSide1)},!1);let q=L.reduce((Y,re)=>Y&&[jt,Ki,zr,Ft,Pt,ca].includes(re.matchUpStatus),!!L.length);return z.structureCompleted=q,C[$]=q,z.structureActive&&(R=!0),{...z,participantResults:j,seedAssignments:_,roundMatchUps:B,roundProfile:V,structureId:$}});return O.forEach(k=>{var x;a||delete k.positionAssignments,k.sourceStructuresComplete=(x=k.sourceStructureIds)==null?void 0:x.every(F=>C[F])}),O}).flat();return I.drawActive=R,I.participantPlacements=N,I.drawGenerated=A==null?void 0:A.reduce((M,C)=>M||!!(C!=null&&C.roundMatchUps),!1),I.drawCompleted=A==null?void 0:A.reduce((M,C)=>M&&C.structureCompleted,!0),I.drawPublished=u?E&&hee({publishStatus:P,drawId:I.drawId}):void 0,{structures:!u||I.drawPublished?f&&A||Me(A,!1,!0):void 0,drawInfo:f?I:Me(I,!1,!0),...Q}}function ER(t){var e,i,r;let{includePositionAssignments:n,participantsProfile:a,policyDefinitions:o,usePublishState:s,status:l=Za,contextProfile:u,sortConfig:c}=t,d=We(t,[{tournamentRecord:!0},{[_F]:{event:!1,eventId:!1}}]);if(d.error)return d;let p=Me(t.tournamentRecord,!1,!0),m=t.event?void 0:Kn({tournamentRecord:p,eventId:t.eventId}).event,h=t.event?Me(t.event,!1,!0):m&&Me(m,!1,!0)||void 0;if(!h)return{error:fo};let{eventId:f}=h,{tournamentId:g,endDate:v}=p,y=Mo({event:h,status:l}),I=$h({event:h}).publishState??{},b=!!((e=I==null?void 0:I.status)!=null&&e.published),{participants:S}=Ai({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:o,...a,tournamentRecord:p}),w=({stage:C,drawId:O})=>{var k,x,F;if(!s)return!0;let $=(x=(k=y==null?void 0:y.drawDetails)==null?void 0:k[O])==null?void 0:x.stageDetails;return!$||!Object.keys($).length?!0:(F=$[C])==null?void 0:F.published},U=({structureId:C,drawId:O})=>{var k,x,F;if(!s)return!0;let $=(x=(k=y==null?void 0:y.drawDetails)==null?void 0:k[O])==null?void 0:x.structureDetails;return!$||!Object.keys($).length?!0:(F=$[C])==null?void 0:F.published},T=({drawId:C})=>s?hee({publishStatus:y,drawId:C}):!0,D=({drawId:C,structure:O})=>{var k,x,F,$;if(!s)return O;let _=($=(F=(x=(k=y==null?void 0:y.drawDetails)==null?void 0:k[C])==null?void 0:x.structureDetails)==null?void 0:F[O.structureId])==null?void 0:$.roundLimit;if(st(_)){let L=De(1,_+1),B={},V={};for(let G of L)O.roundMatchUps[G]&&(B[G]=O.roundMatchUps[G],V[G]=O.roundProfile[G]);O.roundMatchUps=B,O.roundProfile=V}return O},P=h.drawDefinitions||[],E=!s||b?P.filter(T).map(C=>(({drawInfo:O,structures:k})=>({...O,structures:k}))(RR({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:f,tournamentId:g,endDate:v},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:n,tournamentParticipants:S,noDeepCopy:!0,policyDefinitions:o,tournamentRecord:p,usePublishState:s,contextProfile:u,drawDefinition:C,publishStatus:y,sortConfig:c,event:h}))).map(({structures:C,...O})=>{let k=C==null?void 0:C.filter(({stage:x,structureId:F})=>U({structureId:F,drawId:O.drawId})&&w({stage:x,drawId:O.drawId})).map(x=>D({drawId:O.drawId,structure:x}));return{...O,structures:k}}).filter(C=>{var O;return(O=C.structures)==null?void 0:O.length}):void 0,R=(Array.isArray(p.venues)?p.venues:[]).map(C=>(({venueData:O})=>({...O}))(hg({venueId:C.venueId,tournamentRecord:p}))),N=(({eventId:C,eventName:O,eventType:k,eventLevel:x,surfaceCategory:F,matchUpFormat:$,category:_,gender:L,startDate:B,endDate:V,ballType:G,discipline:j})=>({eventId:C,eventName:O,eventType:k,eventLevel:x,surfaceCategory:F,matchUpFormat:$,category:_,gender:L,startDate:B,endDate:V,ballType:G,discipline:j}))(h);N.display=(i=It({element:h,name:a0}).extension)==null?void 0:i.value;let{tournamentInfo:A}=zh({tournamentRecord:p}),M={tournamentInfo:A,venuesData:R,eventInfo:N,drawsData:E};return M.eventInfo.publishState=I,M.eventInfo.published=(r=I==null?void 0:I.status)==null?void 0:r.published,{...Q,eventData:M,participants:S}}var gee={};wt(gee,{courtGridRows:()=>OR,findVenue:()=>au,getMatchUpsToSchedule:()=>CR,getPersonRequests:()=>Lp,getProfileRounds:()=>AR,getScheduledRoundsDetails:()=>Xw,getSchedulingProfile:()=>ac,getSchedulingProfileIssues:()=>q_,publicFindCourt:()=>UL});function yg({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){var n,a,o,s;let{individualParticipantIds:l}=jP(r);i=i??((n=r.schedule)==null?void 0:n.timeAfterRecovery);let u=m=>{t[m]||(t[m]=[]),t[m]=dt(t[m].concat(...l))},c=m=>{i&&(!e[m]||i>e[m])&&(e[m]=i)},d=((a=r.winnerTo)==null?void 0:a.matchUpId)||r.winnerMatchUpId;d&&(i&&c(d),u(d));let p=((o=r.loserTo)==null?void 0:o.matchUpId)||r.loserMatchUpId;p&&(i&&c(p),u(p)),(s=r.sidesTo)!=null&&s.length&&r.sidesTo.forEach(({matchUpId:m})=>{m&&(i&&c(m),u(m))})}function CR(t){let e=We(t,[{[FF]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,orderedMatchUpIds:s,clearDate:l,matchUps:u}=t,c=o?Object.keys(o):[],d=(s??[]).map(m=>u.find(h=>h.matchUpId===m)).filter(Boolean).filter(m=>{let h=!l&&(r.includes(m.matchUpId)||c.includes(m.matchUpId)),f=[jt,Pt,Ki,ca,zr,Ft,ir,pr].includes(m==null?void 0:m.matchUpStatus);return n||!h&&!m.winningSide&&!f}),p=i&&a?d.reduce((m,h)=>{let{drawId:f,tournamentId:g}=h;return m.matchUpMap[g]||(m.matchUpMap[g]={}),m.matchUpMap[g][f]?m.matchUpMap[g][f].push(h):m.matchUpMap[g][f]=[h],yg({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:h}),m},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function MR({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!Ea({matchUpFormat:r}))return{error:Zb};let u=Object.keys(i).filter(d=>!o||d===o),c;return u.forEach(d=>{var p;if(c)return;let m=i[d],h=l?(p=Kn({tournamentRecord:m,eventId:l}))==null?void 0:p.event:void 0;return c=Dw({tournamentRecord:m,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:h}),(c==null?void 0:c.averageMinutes)||(c==null?void 0:c.recoveryMinutes)}),{recoveryMinutes:(c==null?void 0:c.recoveryMinutes)||t,averageMinutes:(c==null?void 0:c.averageMinutes)||e,typeChangeRecoveryMinutes:(c==null?void 0:c.typeChangeRecoveryMinutes)||(c==null?void 0:c.recoveryMinutes)||t}}function Xw(t){let e=We(t,[{[_F]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[Xn]:dn}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:ki};let a={},o=[],s=t.rounds.toSorted((h,f)=>(h.sortOrder??0)-(f.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(h=>Uv({tournamentRecord:h}).containedStructures)),u=t.matchUps??Ls({nextMatchUps:!0,tournamentRecords:n}).matchUps,c=0,d={},p={},m={};return{scheduledRoundsDetails:s.flatMap(h=>{var f;let g=h.periodLength||r,v=[];l!=null&&l[h.structureId]?v.push(...l[h.structureId]):v.push(h.structureId);let y=u?mu({tournamentIds:[h.tournamentId],roundNumbers:[h.roundNumber],matchUpIds:h.matchUpIds,eventIds:[h.eventId],drawIds:[h.drawId],processContext:!0,structureIds:v,matchUps:u}).sort(_h):[],{segmentNumber:I,segmentsCount:b}=h.roundSegment||{};if(st(I)&&Os(y==null?void 0:y.length)&&Os(b)&&I>0&&I<=b&&b<(y==null?void 0:y.length)&&!((f=h.matchUpIds)!=null&&f.length)){let T=y.length/b,D=T*(I-1);y=y.slice(D,D+T)}let S=n[h.tournamentId],w=Kn({drawId:h.drawId,tournamentRecord:S}).event,U=[];for(let T of y){let D=T.matchUpFormat;D&&(a[D]||(a[D]=[],a[D].push(T)),U.push(D))}for(let T of U){let{eventType:D,category:P}=w??{},{categoryName:E,ageCategoryCode:R}=P??{},{typeChangeRecoveryMinutes:N,recoveryMinutes:A,averageMinutes:M,error:C}=MR({categoryName:E??R,categoryType:P==null?void 0:P.categoryType,tournamentId:h.tournamentId,eventId:h.eventId,tournamentRecords:n,matchUpFormat:T,eventType:D});if(C)return{error:C,round:h};let O=y.filter(x=>(i||!yr.includes(x.matchUpStatus))&&x.matchUpStatus!==jt).map(Pr);O.forEach(x=>{m[x]={typeChangeRecoveryMinutes:N,recoveryMinutes:A,averageMinutes:M},d[x]=A,p[x]=M}),o.push(...O),c=Math.max(M||0,c);let k=`${M}|${g}`;return{roundPeriodLength:g,recoveryMinutes:A,averageMinutes:M,matchUpIds:O,hash:k}}}),greatestAverageMinutes:c,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:o,minutesMap:m,...Q}}function vee({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t==null?void 0:t.map(s=>{let l=ht(s==null?void 0:s.scheduleDate);if(!l){n.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let u=((s==null?void 0:s.venues)||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!(e!=null&&e.includes(p))){n.push(`Missing venueId: ${p}`);return}let m=d.filter(h=>{let f=i.includes(h.eventId)&&r.includes(h.drawId);return f||n.push(`Invalid eventId: ${h.eventId} or drawId: ${h.drawId}`),f});if(m.length)return{venueId:p,rounds:m}}).filter(Boolean);return u.length&&l&&{...s,venues:u}}).filter(Boolean),o=n.length;return{updatedSchedulingProfile:a,modifications:o,issues:n}}function NR({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:le};let{venueIds:i,tournamentsMap:r}=xEe({tournamentRecords:t}),n,a,o=e.every(s=>{let{scheduleDate:l,venues:u}=s;return wa(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(m=>{var h,f,g,v;if(!m)return a="empty round",!1;let{roundSegment:y,tournamentId:I,structureId:b,roundNumber:S,eventId:w,drawId:U}=m,T=(v=(g=(f=(h=r==null?void 0:r[I])==null?void 0:h[w])==null?void 0:f[U])==null?void 0:g[b])==null?void 0:v.includes(S);T||(a="Invalid rounds");let{segmentNumber:D,segmentsCount:P}=y||{},E=!y||st(D)&&Os(P)&&D<=P;return E||(a="Invalid segment"),T&&E}):(n=Th,!1):(a="rounds should be an array",!1)}):!1});return!o&&!n&&(n=le),{valid:!!o,error:n,info:a}}function kEe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],o=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:c,courts:d})=>(!r||(d==null?void 0:d.length))&&c),u=e==null?void 0:e.tournamentId;return u&&(n.push(u),i[u]={},((e==null?void 0:e.events)||[]).forEach(c=>{let d=c.eventId;o.push(d),i[u][d]={},(c.drawDefinitions||[]).forEach(p=>{let m=p.drawId;s.push(m),i[u][d][m]={};let{structures:h}=ss({drawDefinition:p});(h||[]).forEach(f=>{var g;let v=f.structureId,{matchUps:y}=qt({structure:f}),{roundMatchUps:I}=An({matchUps:y}),b=I&&Object.keys(I).map(S=>parseInt(S));i[u][d][m][v]=b,a.push(v),(g=f.structures)!=null&&g.length&&f.structures.forEach(S=>{a.push(S.structureId),i[u][d][m][S.structureId]=b})})})})),{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}function xEe(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:m,eventIds:h,drawIds:f}=kEe({tournamentRecord:u});return m.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...h),l.drawIds.push(...f),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:r,eventIds:n,drawIds:a}}function ac({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let{extension:i}=It({element:e,name:Bm,tournamentRecords:t,discover:!0}),r=(i==null?void 0:i.value)||[];if(r.length){let{venueIds:n}=Jw({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:o}=a_({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:u}=vee({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:o});if(l){r=s;let c=Nv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return c.error?c:{schedulingProfile:r,modifications:l,issues:u}}}return{schedulingProfile:r,modifications:0}}function Nv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=NR({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?_t({tournamentRecords:t,discover:!0,extension:{name:Bm,value:i}}):Dn({element:e,name:Bm,tournamentRecords:t,discover:!0})}function Qw(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=ac({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:r}=Jw({tournamentRecords:i}),{eventIds:n,drawIds:a}=a_({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=vee({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return s?{...Nv({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...Q,modifications:s,issues:l}}function q_(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:Jb};if(!Array.isArray(e))return{error:le};if(!e.every(wa))return{error:Fr};let n=[],a=0,o={},{schedulingProfile:s}=ac({tournamentRecords:i});if(!s)return{issues:n,...Q};let{matchUps:l}=Ls({nextMatchUps:!0,tournamentRecords:i});for(let c of s){let{scheduleDate:d,venues:p=[]}=c;if(!(e!=null&&e.length)||e.includes(d)){for(let m of p||[])if(m){let{rounds:h}=m,f=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=Xw({tournamentRecords:i,periodLength:r,matchUps:l,rounds:h}),{matchUpDependencies:y}=fs({tournamentRecords:i,matchUps:l}),I=b=>{let S;return v==null||v.find((w,U)=>{let T=w.matchUpIds.includes(b);return T&&(S=U),T}),S};if(g==null||g.forEach((b,S)=>{var w;let U=g.slice(S+1),T=ji(U,((w=y==null?void 0:y[b])==null?void 0:w.matchUpIds)||[]);T.length&&f.push({matchUpId:b,shouldBeAfter:T})}),f.length){a+=f.length;let b=f.map(({matchUpId:S,shouldBeAfter:w})=>{let U=I(S),T=dt(w.map(I));return o[d]||(o[d]={}),o[d][U]||(o[d][U]=[]),T.forEach(D=>{o[d][U].includes(D)||o[d][U].push(D)}),{matchUpId:S,matchUpRoundIndex:U,earlierRoundIndices:T,shouldBeAfter:w}});n.push(...b)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...n.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:m}=c;return{[d]:{earlierRoundIndices:m,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:o,...Q}}function Lp(t){let{tournamentRecords:e,requestType:i}=t,r=We(t,[{[gn]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:o}=It({element:a,name:bv}),s=(o==null?void 0:o.value)||[];for(let l of s){let{personId:u,requests:c}=l||{};n[u]||(n[u]=[]);for(let d of c)i&&d.requestType!==i||n[u].push(d)}}return{personRequests:n,...Q}}function WM(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:o,eventId:s,drawId:l}=t,u=r?e:o,c=[n,s,l,u,a].join("|");return Ge({structureId:u,roundSegment:i,tournamentId:n,roundNumber:a,eventId:s,drawId:l,id:c})}function J2({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:o,categoryType:s}=n||{},{categoryName:l,ageCategoryCode:u}=o||{},c=Ra(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let m=c[p],h=MR({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:s,eventType:a});if(h.error)return h;let f=h.averageMinutes*m;isNaN(d)||(d+=f)}),{roundMinutes:d}}function FEe(t){return(t||[]).reduce((e,i)=>{var r,n;let a=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).reduce((s,l)=>s+l,0),o=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).join("-")||"";return!e.minFinishingSum||a<e.minFinishingSum?{minFinishingSum:a,winnerFinishingPositionRange:o}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function X2(t){let e=t.length,i=t.filter(({sides:u})=>u==null?void 0:u.some(({bye:c})=>c)).length||0,r=t.filter(({winningSide:u,matchUpStatus:c})=>u||yr.includes(c)).length||0,n=t.filter(({schedule:u,matchUpStatus:c})=>(u==null?void 0:u.scheduledDate)&&(u==null?void 0:u.scheduledTime)&&c!==jt).length||0,a=e-i,o=a===r,s=a-n,l=a-n;return{unscheduledCount:s,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:o,byeCount:i}}function AR({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:Jb};t={[i.tournamentId]:i}}if(e){let a=NR({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=ac({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:jr};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:o})=>a.map(({rounds:s})=>s.map(l=>{var u;let c=WM(l);return(u=c.roundSegment)!=null&&u.segmentsCount&&(n[c.id]=c.roundSegment.segmentsCount),Ge({id:r?c.id:void 0,scheduleDate:o,...c})}))).flat(1/0),segmentedRounds:n}}function OR({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:le};let r=i==null?void 0:i.reduce((o,s)=>{let l=s.matchUps||[],u=Math.max(0,...l.map(c=>c.schedule.courtOrder||0));return u>o?u:o},1),n=e?Math.max(e,r):r,a=De(0,n).map(o=>({matchUps:De(0,i.length).map(s=>{let l=i[s],{courtId:u,venueId:c}=l;return{schedule:{courtOrder:o+1,venueId:c,courtId:u}}})}));return i.forEach((o,s)=>{var l;for(let u of o.matchUps){let c=(l=u.schedule)==null?void 0:l.courtOrder;c&&(a[c-1].matchUps[s]=u)}}),{courtPrefix:t,rows:a.map((o,s)=>Object.assign({rowId:`rowId-${s+1}`},...o.matchUps.map((l,u)=>({[`${t}${u}`]:l}))))}}var Iee={};wt(Iee,{getEntriesAndSeedsCount:()=>kR,getMaxEntryPosition:()=>Y_});function kR({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:Ii};let{entries:o,stageEntries:s}=TX({drawDefinition:e,drawId:r,stage:a,event:n}),l=s.length,{drawSize:u}=KQ({participantsCount:l}),c=Yw({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return te({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:o,seedsCount:d,stageEntries:s}}function Y_(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>tt(n||0)),0)}var yee={};wt(yee,{allCompetitionMatchUps:()=>Ls,allDrawMatchUps:()=>Pn,allEventMatchUps:()=>ou,allTournamentMatchUps:()=>Hr,analyzeMatchUp:()=>Uy,calculateWinCriteria:()=>Wh,checkMatchUpIsComplete:()=>Cd,competitionScheduleMatchUps:()=>eU,drawMatchUps:()=>a$,eventMatchUps:()=>FR,filterMatchUps:()=>mu,getAllDrawMatchUps:()=>gr,getAllStructureMatchUps:()=>qt,getCheckedInParticipantIds:()=>xh,getCompetitionMatchUps:()=>wy,getEventMatchUpFormatTiming:()=>J_,getHomeParticipantId:()=>e$,getMatchUpCompetitiveProfile:()=>Tw,getMatchUpContextIds:()=>t$,getMatchUpDailyLimits:()=>_R,getMatchUpDailyLimitsUpdate:()=>X_,getMatchUpDependencies:()=>fs,getMatchUpFormat:()=>i$,getMatchUpFormatTiming:()=>Dw,getMatchUpFormatTimingUpdate:()=>K_,getMatchUpScheduleDetails:()=>JP,getMatchUpType:()=>XP,getMatchUpsStats:()=>r$,getModifiedMatchUpFormatTiming:()=>xR,getParticipantResults:()=>jw,getPredictiveAccuracy:()=>Z_,getRoundMatchUps:()=>An,getRounds:()=>n$,isValidMatchUpFormat:()=>Ea,matchUpActions:()=>mR,participantScheduledMatchUps:()=>Q_,tallyParticipantResults:()=>Mv,tournamentMatchUps:()=>LR,validMatchUp:()=>zP,validMatchUps:()=>Co});function bee({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let i=[],r;for(let n of Object.values(t)){let{extension:a}=It({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let o=n.events??[];for(let s of o){let{eventId:l}=s,{extension:u}=It({name:e,element:s});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function K_({tournamentRecords:t}){return bee({extensionName:_u,tournamentRecords:t})}var JE="ADULT",XE="JUNIOR",wU="WHEELCHAIR",wee={[id]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[ei]:30,default:60}}]},defaultDailyLimits:{[ri]:2,[ei]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Yo],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[wU],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[JE,wU],minutes:{default:60,[ei]:30}},{categoryTypes:[XE],minutes:{default:60,[ei]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[JE,wU],minutes:{default:30}},{categoryTypes:[XE],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[JE,XE],minutes:{default:30}},{categoryTypes:[wU],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},LEe=wee;function J_({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:Ii};let n=[],a;if(e!=null&&e.length){let d=[];n=e.map(p=>{let m=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(m==null?void 0:m.matchUpFormat)&&Ea({matchUpFormat:m==null?void 0:m.matchUpFormat}))return d.push(m.matchUpFormat),m}).filter(Boolean)}else{let{policy:d}=Mp({policyType:vo,tournamentRecord:t,event:r});if(d!=null&&d.matchUpFormats)n=d==null?void 0:d.matchUpFormats;else{let{extension:p}=It({name:_u,element:r}),m,h;p!=null&&p.value?{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=p.value:{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=LEe[id],n=dt([...(m||[]).map(f=>f.matchUpFormatCodes),...(h||[]).map(f=>f.matchUpFormatCodes)].flat()).map(f=>({matchUpFormat:f})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=r,u=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:Ii};let c=n.map(({matchUpFormat:d,description:p})=>{let m=Dw({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:o,event:r});return{matchUpFormat:d,description:p,...m}});return Ge({eventMatchUpFormatTiming:c,info:a})}function xR(t){let e=We(t,[{[Ur]:!0},{[Jr]:f=>Ea({matchUpFormat:f}),[za]:Zb,[OF]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=It({name:_u,element:n}),o=a==null?void 0:a.value,{extension:s}=It({element:i,name:_u}),l=s==null?void 0:s.value,u=(o==null?void 0:o.matchUpAverageTimes)&&lI({...o,matchUpFormat:r}),c=(l==null?void 0:l.matchUpAverageTimes)&&lI({...l,matchUpFormat:r}),d=[u,c].find(f=>f),p=(o==null?void 0:o.matchUpRecoveryTimes)&&uI({...o,matchUpFormat:r}),m=(l==null?void 0:l.matchUpRecoveryTimes)&&uI({...l,matchUpFormat:r}),h=[p,m].find(f=>f);return{matchUpFormat:r,recoveryTimes:h,averageTimes:d}}function X_({tournamentRecords:t}){return bee({extensionName:dw,tournamentRecords:t})}var Zw=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function Q_({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!Co(e))return{error:Qu};if(!Array.isArray(t))return{error:le};let i=e.filter(Boolean).filter(({schedule:r})=>Zw({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,o=ht(a==null?void 0:a.scheduledDate),s=Si(a==null?void 0:a.scheduledTime);return o&&s&&(r[o]?r[o].push(n):r[o]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>{var o,s;return a8(Si((o=n.schedule)==null?void 0:o.scheduledTime),Si((s=a.schedule)==null?void 0:s.scheduledTime))})}),{...Q,scheduledMatchUps:i}}function _Ee({tournamentRecords:t}){var e;let i={},r=[];for(let n of Object.values(t))for(let a of n.events??[]){let o=Mo({event:a}),s=o==null?void 0:o.drawDetails;At(s)?(Object.assign(i,s),r.push(...Object.keys(s).filter(l=>PL({drawId:l,drawDetails:s})))):(e=o==null?void 0:o.drawIds)!=null&&e.length&&r.push(...o.drawIds)}return{drawIds:r,detailsMap:i}}function S0({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:s,drawId:l,structureId:u,roundNumber:c})=>`${s}|${l}|${u}${c}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let m=r({eventId:l,drawId:u,structureId:c,roundNumber:d});i[m]=p})});let n=[],a={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},u=l.scheduledDate&&ht(l.scheduledDate)||l.scheduledTime&&ht(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(s)}let o=Object.keys(a).sort();for(let s of o){let l=a[s],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},m=p.scheduledTime&&Si(p.scheduledTime)||"noScheduledTime";u[m]||(u[m]=[]),u[m].push(d)}let c=Object.keys(u).sort();for(let d of c){let p=u[d];p.sort((m,h)=>{let f=i[r(m)]||0,g=i[r(h)]||0;return f-g}),n.push(...p)}}return n}function FR(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:m,contextProfile:h,nextMatchUps:f,tournamentId:g,inContext:v,context:y,event:I}=t;if(!I)return{error:Ii};let{eventId:b,eventName:S,endDate:w,eventType:U,category:T,gender:D}=I??{},P={...y,...Ge({surfaceCategory:I.surfaceCategory??(c==null?void 0:c.surfaceCategory),indoorOutDoor:I.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),tournamentId:g??(c==null?void 0:c.tournamentId),endDate:w??(c==null?void 0:c.endDate),eventName:S,eventType:U,category:T,eventId:b,gender:D})},E;!e&&c&&({participants:e,participantMap:r,groupInfo:E}=Cp({participantsProfile:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextProfile:h,inContext:v})),h&&!i&&(i=ic({policyDefinitions:l,tournamentRecord:c,contextProfile:h,event:I}));let R=Mo({event:I});return{...(I.drawDefinitions??[]).reduce((N,A)=>{var M;let C=Tv({hydrateParticipants:t.hydrateParticipants,context:P,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:m,participantMap:r,publishStatus:R,contextProfile:h,drawDefinition:A,nextMatchUps:f,inContext:v,event:I});return(M=Object.keys(C))==null||M.forEach(O=>{Array.isArray(C[O])&&(N[O]||(N[O]=[]),N[O]=N[O].concat(C[O]))}),N},{}),...Q,groupInfo:E}}function LR(t){if(!(t!=null&&t.tournamentRecord))return{error:ve};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,inContext:s=!0,usePublishState:l,contextFilters:u,matchUpFilters:c,contextProfile:d,nextMatchUps:p,context:m}=t,h=t.tournamentId??o.tournamentId,f=(o==null?void 0:o.events)??[],{participants:g,participantMap:v,groupInfo:y}=Cp({participantsProfile:r,policyDefinitions:a,tournamentRecord:o,contextProfile:d,inContext:s});d&&!e&&(e=ic({policyDefinitions:a,tournamentRecord:o,contextProfile:d}));let{appliedPolicies:I}=Bt({tournamentRecord:o}),b=(u==null?void 0:u.eventIds)??[];return{...f.filter(S=>!b.includes(S.eventId)).map(S=>{var w,U,T;let D={eventDrawsCount:((U=(w=Hi({event:S}).flightProfile)==null?void 0:w.flights)==null?void 0:U.length)||((T=S.drawDefinitions)==null?void 0:T.length)||0,...m};return FR({hydrateParticipants:t.hydrateParticipants,context:D,tournamentAppliedPolicies:I,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,contextFilters:u,contextProfile:d,contextContent:e,matchUpFilters:c,participantMap:v,participants:g,tournamentId:h,nextMatchUps:p,inContext:s,event:S})}).reduce((S,w)=>{var U;return(U=w&&Object.keys(w).filter(T=>!["success","matchUpsMap"].includes(T)))==null||U.forEach(T=>{Array.isArray(w[T])&&(S[T]||(S[T]=[]),S[T]=S[T].concat(w[T]),S.matchUpsCount!==void 0?S.matchUpsCount+=w[T].length:S.matchUpsCount=w[T].length)}),S},{matchUpsCount:0}),groupInfo:y,participants:g}}function wy({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,useParticipantMap:n,policyDefinitions:a,usePublishState:o,matchUpFilters:s,contextFilters:l,nextMatchUps:u,inContext:c}){if(typeof r!="object"||!Object.keys(r).length)return{error:ki};let d=Object.keys(r).map(h=>{let f=r[h];return LR({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,useParticipantMap:n,policyDefinitions:a,tournamentRecord:f,usePublishState:o,matchUpFilters:s,contextFilters:l,nextMatchUps:u,inContext:c})}),p={},m={};return{...d.reduce((h,f)=>(Object.keys(f).forEach(g=>{if(g==="groupInfo")Object.assign(m,f[g]);else if(g==="participants")for(let v of f[g]??[])p[v.participantId]=v;else Array.isArray(f[g])&&(h[g]||(h[g]=[]),h[g]=h[g].concat(f[g]))}),h),{}),groupInfo:m,mappedParticipants:p}}function eU(t){var e,i,r,n,a,o,s;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:ki};let{courts:l,venues:u}=nc(t),c=ac(t).schedulingProfile,{sortDateMatchUps:d=!0,courtCompletedMatchUps:p,alwaysReturnCompleted:m,activeTournamentId:h,tournamentRecords:f,withCourtGridRows:g,minCourtGridRows:v,usePublishState:y,status:I=Za,sortCourtsData:b}=t,S=h??Dh()??Object.keys(f)[0],w=y?Nw({tournamentRecord:f[S],status:I}):void 0,U=m?wy({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Ki]},contextFilters:t.contextFilters}).completedMatchUps:[];if(y&&!((e=w==null?void 0:w.orderOfPlay)!=null&&e.published))return{completedMatchUps:U,dateMatchUps:[],courtsData:[],venues:u};let T,D;y&&({drawIds:T,detailsMap:D}=_Ee({tournamentRecords:f})),T!=null&&T.length&&(t.contextFilters||(t.contextFilters={}),(i=t.contextFilters)!=null&&i.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(F=>T.includes(F)):t.contextFilters.drawIds=T),(r=w==null?void 0:w.eventIds)!=null&&r.length&&(t.matchUpFilters||(t.matchUpFilters={}),(n=t.matchUpFilters)!=null&&n.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(F=>w.eventIds.includes(F)):t.matchUpFilters.eventIds=w.eventIds),(a=w==null?void 0:w.scheduledDates)!=null&&a.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(F=>w.scheduledDates.includes(F)):t.matchUpFilters.scheduledDates=w.scheduledDates),m&&(t.matchUpFilters||(t.matchUpFilters={}),(s=(o=t.matchUpFilters)==null?void 0:o.excludeMatchUpStatuses)!=null&&s.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Ki)||t.matchUpFilters.excludeMatchUpStatuses.push(Ki):t.matchUpFilters.excludeMatchUpStatuses=[Ki]);let{completedMatchUps:P,upcomingMatchUps:E,pendingMatchUps:R,groupInfo:N,mappedParticipants:A}=wy({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),M=[...E??[],...R??[]];D&&(!(T!=null&&T.length)||Object.keys(D).length)&&(M=M.filter(F=>{var $,_;let{drawId:L,structureId:B,stage:V}=F;if(!((_=($=D==null?void 0:D[L])==null?void 0:$.publishingDetail)!=null&&_.published))return!1;if(D[L].stageDetails){let G=Object.keys(D[L].stageDetails),j=G.filter(W=>!D[L].stageDetails[W].published),z=G.filter(W=>D[L].stageDetails[W].published);return j.length&&j.includes(V)?!1:z.length&&z.includes(V)?!0:j.length&&!j.includes(V)&&!z.length}if(D[L].structureDetails){let G=Object.keys(D[L].structureDetails),j=G.filter(W=>!D[L].structureDetails[W].published),z=G.filter(W=>D[L].structureDetails[W].published);return j.length&&j.includes(B)?!1:z.length&&z.includes(B)?!0:j.length&&!j.includes(B)&&!z.length}return!0}));let C=d?S0({matchUps:M,schedulingProfile:c}):M,O=l==null?void 0:l.map(F=>{let $=x(F);return{surfaceCategory:(F==null?void 0:F.surfaceCategory)??"",matchUps:$,...F}}),k={completedMatchUps:m?U:P,mappedParticipants:t.hydrateParticipants?void 0:A,dateMatchUps:C,courtsData:O,groupInfo:N,venues:u};if(g){let{rows:F,courtPrefix:$}=OR({minRowsCount:v,courtsData:O});k.courtPrefix=$,k.rows=F}return{...k,...Q};function x({courtId:F}){let $=(p?C.concat(P??[]):C).filter(_=>{var L,B,V;return((L=_.schedule)==null?void 0:L.courtId)===F||((V=(B=_.schedule)==null?void 0:B.allocatedCourts)==null?void 0:V.map(({courtId:G})=>G).includes(F))});return b?S0({matchUps:$,schedulingProfile:c}):$}}function _R({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:o}=$Ee({tournamentRecord:a});r=o}),{matchUpDailyLimits:r}}function $Ee(t){var e;let i=We(t,[{[Ur]:!0}]);if(i.error)return i;let{tournamentRecord:r}=t,{policy:n}=Mp({policyType:id,tournamentRecord:r}),{extension:a}=It({element:r,name:dw}),o=(e=a==null?void 0:a.value)==null?void 0:e.dailyLimits,s=n==null?void 0:n.defaultDailyLimits;return{matchUpDailyLimits:o||s}}function Z_(t){var e,i,r,n;let{matchUps:a}=t,{singlesForDoubles:o,tournamentRecord:s,drawDefinition:l,excludeMargin:u,exclusionRule:c,zoneDoubling:d,matchUpType:p,scaleName:m,eventId:h,zonePct:f,drawId:g,event:v}=t;if(!s&&!a)return{error:ve};if(p&&![ri,ei].includes(p))return{error:le,info:{matchUpType:p}};if(a&&!Co(a))return{error:le,context:{matchUps:a}};let y=Tr[m],I=(y==null?void 0:y.ascending)??t.ascending??!1,b=(y==null?void 0:y.accessor)??t.valueAccessor,S=Array.isArray(y==null?void 0:y.range)?Math.abs(y.range[0]-y.range[1]):0,w=st(f)&&S?(f??0/100)*S:t.zoneMargin??S,U={withScaleValues:!0,withCompetitiveness:!0},T={matchUpTypes:p?[p]:[ri,ei]},D=s==null?void 0:s.participants;(e=a==null?void 0:a[0])!=null&&e.hasContext?g?a=a.filter(k=>k.drawId===g):h&&(a=a.filter(k=>k.eventId===h)):a===void 0&&(a=g&&!l&&[]||!g&&h&&!v&&[]||g&&((i=Pn({inContext:!0,drawDefinition:l,contextFilters:T,contextProfile:U,participants:D}))==null?void 0:i.matchUps)||!g&&h&&((r=ou({inContext:!0,contextFilters:T,contextProfile:U,participants:D,event:v}))==null?void 0:r.matchUps)||((n=Hr({tournamentRecord:s,contextFilters:T,contextProfile:U}))==null?void 0:n.matchUps)||[]),p&&(a=a.filter(k=>k.matchUpType===p));let P=a.filter(({winningSide:k,score:x,sides:F,matchUpStatus:$})=>![zr,Pt,Ft,wv,ca].includes($??"")&&br({score:x})&&(F==null?void 0:F.length)===2&&k),E=VEe({matchUps:P,excludeMargin:u,exclusionRule:c,valueAccessor:b,ascending:I,scaleName:m}),R=!d||Ji(ri)(p)?w:(w||0)*2,N=w?P.map(({competitiveProfile:k,matchUpType:x,score:F,sides:$})=>{let _=Uee({singlesForDoubles:o,valueAccessor:b,matchUpType:x,scaleName:m,sides:$}),L=Math.abs(_[0].value-_[1].value);return{competitiveness:k==null?void 0:k.competitiveness,valuesGap:L,score:F}}).filter(({valuesGap:k})=>k<=R):[],A=BEe({zoneData:N}),M=A&&[].concat(Object.values(A)).flat().length,C=M&&Object.assign({},...Object.keys(A).map(k=>({[k]:Math.round(1e4*A[k].length/M)/100}))),O=P.length-((N==null?void 0:N.length)||0);return{...Q,relevantMatchUps:P,zoneDistribution:C,zoneData:N,accuracy:E,nonZone:O}}function BEe({zoneData:t}){let e={[pL]:[],[hy]:[],[fy]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function Uee({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let o=e==null?void 0:e.range.sort(),s=l=>{let u=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&u>=o[0]&&u<=o[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l==null?void 0:l.individualParticipants;if(c!=null&&c.length){let d=[],p=0;for(let m of c){let{scaleValue:h,value:f}=Q2({singlesForDoubles:t,valueAccessor:i,participant:m,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:v}=s(h);g&&u.push(v),d.push(h),f&&!isNaN(p)?p+=f:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=Q2({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:m,exclusionValue:h}=s(d);return m&&u.push(h),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function Q2({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){var a,o,s,l,u;let c=t?ri:i,d=(o=(a=r==null?void 0:r.rankings)==null?void 0:a[c])==null?void 0:o.find(h=>h.scaleName===n),p=(u=((l=(s=r==null?void 0:r.ratings)==null?void 0:s[c])==null?void 0:l.find(h=>h.scaleName===n))||d)==null?void 0:u.scaleValue,m=e?p==null?void 0:p[e]:p;return{scaleValue:p,value:m}}function VEe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let u of a){let{matchUpType:c,sides:d,score:p,winningSide:m}=u;if(!m)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:Qe};let h=m-1,f=Uee({exclusionRule:e,valueAccessor:i,matchUpType:c,scaleName:n,sides:d});if(e){let S=f.map(({exclusionValues:w})=>w).flat();if(S.length){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:S,winningSide:m,sideValues:f});continue}}if(f.filter(S=>![void 0,"",null].includes(S.value)).length<2){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:m,sideValues:f});continue}let g=f[h].value-f[1-h].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:m,excludeGap:y,sideValues:f,valuesGap:g});continue}let I=r?g:g*-1,b=m===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;I>0?o.affirmative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p}):o.negative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}function Wh({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=TQ({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:o,collectionGroupNumber:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,m=s&&r.includes(s);if(st(p||d))n=!0;else{if(m)continue;if(typeof l=="number"&&st(l))i+=l;else if(Array.isArray(o)&&o!=null&&o.length)for(let h of o)i+=h.matchUpValue;else typeof c=="number"&&st(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...Q}:{valueGoal:Math.floor(i/2)+1,...Q}}function e$(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=We(t,[{[nu]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:o}=Op({timeItems:(r==null?void 0:r.timeItems)||[],itemType:IL});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function t$({matchUps:t,matchUpId:e}){if(!Co(t))return{error:le};let i=t.find(s=>s.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:o}}function Av(t,e){if(!At(t))return{error:le};if(!Array.isArray(e))return{error:le};let i={};for(let{param:r,error:n,attr:a}of e){let o=jEe({params:t,param:r,attr:a,error:n});if(o!=null&&o.error)return o;i[r]=o}return i}function jEe({params:t,param:e,attr:i,error:r}){if(e===MP&&At(t.drawDefinition)&&Pi(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===nu){let n=cee({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:jr,info:{param:e}}}function i$(t){var e,i;let{structureId:r,matchUpId:n,event:a}=t,o=t.drawDefinition,s=We(t,[{[Ur]:!0},{[_F]:{[RP]:!1,[wl]:!1,[nJ]:!1,[td]:!1}}]);if(s[Ko])return s;let l=(e=Av(t,[{[vv]:nu,[Ko]:Qe}]))==null?void 0:e.matchUp;if(n&&l!=null&&l.error)return l;!o&&l!=null&&l.drawDefinition&&(o=l==null?void 0:l.drawDefinition);let u=l==null?void 0:l.structure;if(!u&&r&&!n){if(!o)return{error:Bs};let h=rt({drawDefinition:o,structureId:r});if(h.error)return h;u=h.structure}let c=u==null?void 0:u.matchUpFormat,d=o==null?void 0:o.matchUpFormat,p=a==null?void 0:a.matchUpFormat,m=((i=l==null?void 0:l.matchUp)==null?void 0:i.matchUpFormat)||c||d||p;return{structureDefaultMatchUpFormat:c,eventDefaultMatchUpFormat:p,drawDefaultMatchUpFormat:d,matchUpFormat:m}}function r$({profileBands:t,tournamentRecord:e,matchUps:i}){if(!Co(i))return{error:Qu};let r=!t&&Mp({policyType:pu,tournamentRecord:e}).policy,n=t||(r==null?void 0:r.profileBands)||mL[pu].profileBands,a=i.filter(({winningSide:p})=>p),o=a.map(zJ),s=(p,m)=>{let h=HJ(m,n);return p[h]+=1,p},l=WJ(o).reduce((p,m)=>s(p,m),{[pL]:0,[hy]:0,[fy]:0,[$J]:0}),u=Object.keys(l).reduce((p,m)=>(l[m]||0)+p,0),c=Object.keys(l).map(p=>{let m=parseFloat((l[p]/u).toFixed(4));return{[p]:m*100}}),d=a.filter(({matchUpStatus:p})=>p===U2).length;return c.push({[U2]:parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...Q}}var{stageOrder:Z2}=wSe;function GEe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(Z2[t==null?void 0:t.stage]||0)-(Z2[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function n$({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){var m;if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:le,inContextMatchUps:r};if(o&&!n){if(typeof o!="object")return{error:Jb};n={[o.tournamentId]:o}}let h=typeof n!="object"||!Object.keys(n).length;if((d||u||!r||!a&&(t||i||a||s))&&h)return{error:ki};let f=Object.assign({},...Object.values(n??{}).map(({venues:U=[],tournamentId:T})=>({[T]:U==null?void 0:U.map(({venueId:D})=>D)}))),g=Object.values(n??{}).map(({events:U=[],tournamentId:T,startDate:D,endDate:P})=>U.map(E=>({...E,validVenueIds:f[T],startDate:E.startDate??D,endDate:E.endDate??P}))).flat(),{segmentedRounds:v,profileRounds:y}=n&&(t||i||a||s)&&AR({tournamentRecords:n,schedulingProfile:a})||{},I=t&&Object.assign({},...y.map(U=>({[U.id]:U}))),b=r||n&&((m=Ls({tournamentRecords:n,matchUpFilters:l}))==null?void 0:m.matchUps)||[],S=[],w=b&&Object.values(b.reduce((U,T)=>{var D;let P=WM(T).id,E=v==null?void 0:v[P],R=[...((D=U[P])==null?void 0:D.matchUps)??[],T],{containerStructureId:N,stageSequence:A,structureName:M,tournamentId:C,isRoundRobin:O,matchUpType:k,roundNumber:x,roundOffset:F,structureId:$,eventName:_,roundName:L,drawName:B,eventId:V,drawId:G}=T,j=O?N:$;return{...U,[P]:{id:c?P:void 0,structureId:j,stageSequence:A,segmentsCount:E,structureName:M,tournamentId:C,matchUpType:k,roundNumber:x,roundOffset:F,eventName:_,roundName:L,drawName:B,matchUps:R,eventId:V,drawId:G}}},{})).map(U=>{let{minFinishingSum:T,winnerFinishingPositionRange:D}=FEe(U.matchUps),P=U.segmentsCount;if(P){let k=U.matchUps.length/P;return Cr(U.matchUps.sort((x,F)=>x.roundPosition-F.roundPosition),k).map((x,F)=>{let{unscheduledCount:$,incompleteCount:_,matchUpsCount:L,isScheduled:B,isComplete:V,byeCount:G}=X2(x),j=J2({matchUps:U.matchUps,tournamentRecords:n,events:g,round:U});return Ge({...U,...p,roundSegment:{segmentsCount:P,segmentNumber:F+1},winnerFinishingPositionRange:D,unscheduledCount:$,incompleteCount:_,minFinishingSum:T,matchUpsCount:L,isScheduled:B,roundTiming:j,isComplete:V,byeCount:G,matchUps:x})})}let{unscheduledCount:E,incompleteCount:R,matchUpsCount:N,isScheduled:A,isComplete:M,byeCount:C}=X2(U.matchUps),O=J2({matchUps:U.matchUps,tournamentRecords:n,events:g,round:U});return Ge({...U,...p,winnerFinishingPositionRange:D,unscheduledCount:E,incompleteCount:R,minFinishingSum:T,matchUpsCount:N,isScheduled:A,roundTiming:O,isComplete:M,byeCount:C})}).flat().filter(U=>{if(t){let F=ht(t),$=c?U.id:WM(U).id;if(F&&I[$]&&ht(I[$].scheduleDate)===F)return!1}let{isComplete:T,isScheduled:D}=U,P=!i||!T,E=!e||!D,R=d||u?g==null?void 0:g.find(({eventId:F})=>F===U.eventId):void 0,N=(R==null?void 0:R.startDate)??(o==null?void 0:o.startDate),A=(R==null?void 0:R.endDate)??(o==null?void 0:o.endDate),M=!u||!N||new Date(u)>=new Date(N),C=!u||!A||new Date(u)<=new Date(A),O=M&&C,k=!d||(R==null?void 0:R.validVenueIds.includes(d)),x=P&&E&&k&&O;return x||S.push(U),x}).sort(GEe)||[];return{...Q,rounds:w,excludedRounds:S}}function Uy(t){var e;let{matchUp:i,sideNumber:r,setNumber:n,isTiebreakValue:a,isPointValue:o}=t||{},{matchUpFormat:s}=t||{};if(!i)return{error:la};s=s||(i==null?void 0:i.matchUpFormat);let l=Ln(s),u=!!(i!=null&&i.winningSide),c=(e=i.score)==null?void 0:e.sets,d=c==null?void 0:c.length,p=n&&n-1,m=!!(c!=null&&c.find((G,j)=>G.setNumber===n&&j===p)),h=(c==null?void 0:c.filter(G=>G==null?void 0:G.winningSide))||[],f=(h==null?void 0:h.length)||0,g=n&&(c==null?void 0:c.slice(n))||[],v=!!(d&&n&&g!=null&&g.reduce((G,j)=>(!j||!j.side1Score&&!j.side2Score&&!j.side1TiebreakScore&&!j.side2TiebreakScore&&!j.side1PointScore&&!j.side2PointScore)&&G,!0)),y=n<=d&&c.find(G=>G.setNumber===n),I=y&&by({setObject:y,matchUpScoringFormat:l}),{isCompletedSet:b,sideGameScores:S,sideTiebreakScores:w}=I||{},U=!!(y&&!b&&v||n&&n===d+1&&!u),T=[1,2].includes(r),D=T?r-1:0,P=y&&T&&(!a&&!o&&S[D]!==void 0&&S[D]||a&&w[D]!==void 0&&w[D]),E=!!P,R=h==null?void 0:h.map(G=>by({setObject:G,matchUpScoringFormat:l}).isValidSetOutcome).reduce((G,j)=>G&&j,!0),N=h.reduce((G,j)=>{let{winningSide:z}=j,W=z-1;return G[W]++,G},[0,0]),A=i==null?void 0:i.winningSide,M=A&&A-1,C=1-M,O=N[M],k=N[C],x=Math.max(...N),F=Ra(N)[x],{bestOf:$,exactly:_}=l??{},L=$&&Math.ceil($/2)||_||1,B=x===L&&F===1&&N.indexOf(x)+1||void 0,V=O>k&&A===B;return{completedSetsHaveValidOutcomes:R,validMatchUpWinningSide:V,calculatedWinningSide:B,matchUpScoringFormat:l,validMatchUpOutcome:B&&R&&V,isLastSetWithValues:v,completedSetsCount:f,isCompletedMatchUp:u,isValidSideNumber:T,hasExistingValue:E,existingValue:P,isExistingSet:m,isActiveSet:U,...I}}function a$({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,tournamentId:v,inContext:y,context:I,event:b}){let{eventId:S,eventName:w,endDate:U,eventType:T,category:D,gender:P}=b??{},E={...I,...Ge({surfaceCategory:(b==null?void 0:b.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(b==null?void 0:b.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:U??(b==null?void 0:b.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:w,eventType:T,category:D,eventId:S,gender:P})},R;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:R}=Cp({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:h,inContext:y})),b&&h&&!c&&(c=ic({policyDefinitions:a,tournamentRecord:s,contextProfile:h,drawDefinition:f,event:b})),{...Tv({context:E,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,inContext:y,event:b}),groupInfo:R}}var See={};wt(See,{getCompetitionVenues:()=>Jw,getCourts:()=>o$,getVenuesAndCourts:()=>nc,publicFindVenue:()=>wL});function o$({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=Me(r.courts||[]);return a.forEach(o=>Object.assign(o,{venueId:n})),a}).flat()}:{error:ve}}var Tee={};wt(Tee,{categoryCanContain:()=>nw,getCategoryAgeDetails:()=>xm,getEvent:()=>u$,getEventProperties:()=>s$,getEventStructures:()=>rR,getEventTimeItem:()=>fw,getEvents:()=>l$,getFlightProfile:()=>Hi,getScaledEntries:()=>Hh});function s$({tournamentRecord:t,event:e}){var i,r;if(!t)return{error:ve};if(!e)return{error:Ii};let n=e.entries||[],a=t.participants||[],o=((i=e.category)==null?void 0:i.categoryName)||((r=e.category)==null?void 0:r.ageCategoryCode),{eventType:s}=e,l=n.map(m=>m.participantId),u=a.filter(m=>l.includes(m.participantId)),c,d,p;return{entryScaleAttributes:u.map(m=>{var h,f,g,v,y,I;let{participantId:b,participantName:S,name:w}=m,U={scaleType:bL,eventType:s,scaleName:o},T=(f=(h=_l({participant:m,scaleAttributes:U}))==null?void 0:h.scaleItem)==null?void 0:f.scaleValue;U={scaleType:tX,eventType:s,scaleName:o};let D=(v=(g=_l({participant:m,scaleAttributes:U}))==null?void 0:g.scaleItem)==null?void 0:v.scaleValue;U={scaleType:eX,eventType:s,scaleName:o};let P=(I=(y=_l({participant:m,scaleAttributes:U}))==null?void 0:y.scaleItem)==null?void 0:I.scaleValue;return c=!!(c||T),d=!!(d||D),p=!!(p||P),{participantId:b,participantName:S||w,seed:T,ranking:D,rating:P}}),hasSeededParticipants:c,hasRankedParticipants:d,hasRatedParticipants:p}}function l$({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:o}){var s,l,u,c;if(!t)return{error:ve};let{tournamentId:d}=t,p=(t.events??[]).filter(({eventId:h})=>!n||Array.isArray(n)&&n.includes(h)).map(h=>{var f;let g=(f=h.drawDefinitions)==null?void 0:f.map(py);if(a!=null&&a.length&&!ji(a,g).length)return;let v=Me(h);return r&&Object.assign(v,{tournamentId:d}),o&&Object.assign(v,o),v}).filter(Boolean),m={};if(e){let h=Ai({withScaleValues:!0,tournamentRecord:t}).participantMap,f=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of p){let v=i??g.eventType,y=g.eventId;m[y]||(m[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let I=(g.entries??[]).filter(({entryStatus:P})=>hs.includes(P)).map(Tt),b=P=>{var E,R,N,A,M,C;if((E=P==null?void 0:P.ratings)!=null&&E[v])for(let O of((R=P==null?void 0:P.ratings)==null?void 0:R[v])??[]){let k=O.scaleName;m[y].ratings[k]||(m[y].ratings[k]=[]);let x=(N=Tr[k])==null?void 0:N.accessor;if(x){let F=parseFloat((A=O.scaleValue)==null?void 0:A[x]);F&&m[y].ratings[k].push(F)}}if((M=P==null?void 0:P.rankings)!=null&&M[v])for(let O of((C=P==null?void 0:P.rankings)==null?void 0:C[v])??[]){let k=O.scaleName;m[y].ranking[k]||(m[y].ranking[k]=[]),O.scaleValue&&m[y].ranking[k].push(O.scaleValue)}};for(let P of I){let E=(s=h==null?void 0:h[P])==null?void 0:s.participant;if((E==null?void 0:E.participantType)!==Dt)for(let R of(E==null?void 0:E.individualParticipantIds)??[]){let N=(l=h==null?void 0:h[R])==null?void 0:l.participant;b(N)}else b(E)}let S=m[y].ratings;for(let P of Object.keys(S)){let E=S[P];if(!E.length)continue;let R=(u=d2(E))==null?void 0:u.toFixed(2);m[y].ratingsStats[P]={avg:parseFloat((f(E)/E.length).toFixed(2)),median:R?parseFloat(R):void 0,max:Math.max(...E),min:Math.min(...E)}}let w=(P,E)=>{var R,N;let A=M=>{var C,O,k,x,F,$,_,L,B,V;if((C=m[y].draws)!=null&&C[P]&&(O=M==null?void 0:M.ratings)!=null&&O[v])for(let G of((k=M==null?void 0:M.ratings)==null?void 0:k[v])??[]){let j=G.scaleName;(x=m[y].draws[P])!=null&&x.ratings[j]||(m[y].draws[P].ratings[j]=[]);let z=(F=Tr[j])==null?void 0:F.accessor;if(z){let W=parseFloat(($=G.scaleValue)==null?void 0:$[z]);W&&m[y].draws[P].ratings[j].push(W)}}if((_=m[y].draws)!=null&&_[P]&&(L=M==null?void 0:M.rankings)!=null&&L[v])for(let G of((B=M==null?void 0:M.rankings)==null?void 0:B[v])??[]){let j=G.scaleName;(V=m[y].draws[P])!=null&&V.ranking[j]||(m[y].draws[P].ranking[j]=[]);let z=G.scaleValue;z&&m[y].draws[P].ranking[j].push(z)}};for(let M of E.filter(Boolean)){let C=(R=h==null?void 0:h[M])==null?void 0:R.participant;if((C==null?void 0:C.participantType)!==Dt)for(let O of(C==null?void 0:C.individualParticipantIds)??[]){let k=(N=h==null?void 0:h[O])==null?void 0:N.participant;A(k)}else A(C)}},U=[],T=P=>(a==null?void 0:a.length)&&a.includes(P)||U.includes(P);for(let P of g.drawDefinitions??[]){let E=P.drawId;if(T(E))continue;let R=kp({drawDefinition:P}).assignedParticipantIds??[];m[y].draws[E]||(m[y].draws[E]={ratingsStats:{},ratings:{},ranking:{}}),U.push(E),w(E,R)}let D=Hi({event:g}).flightProfile;for(let P of(D==null?void 0:D.flights)??[]){let E=P.drawId;if(T(E))continue;let R=P.drawEntries.map(Tt);w(E,R)}for(let P of U){let E=m[y].draws[P].ratings;for(let R of Object.keys(E)){let N=E[R];if(!N.length)continue;let A=(c=d2(N))==null?void 0:c.toFixed(2);m[y].draws[P].ratingsStats[R]={avg:parseFloat((f(N)/N.length).toFixed(2)),median:A?parseFloat(A):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return Ge({eventScaleValues:m,events:p,...Q})}function u$({tournamentRecord:t,drawDefinition:e,context:i,event:r}){var n;if(!t)return{error:ve};if(!r)return{error:Ii};let a=Me(r);i&&Object.assign(a,i);let o=e&&((n=a.drawDefinitions)==null?void 0:n.find(({drawId:s})=>e.drawId===s));return Ge({drawDefinition:o,event:a})}function HEe(t){var e,i;let r="validateAndDeriveDrawValues",{appliedPolicies:n,policyDefinitions:a}=qEe(t),o=YEe({...t,policyDefinitions:a,appliedPolicies:n}),s=WEe(t),l=KEe({...t,consideredEntries:s,appliedPolicies:n});if(l!=null&&l.error)return te({result:l,stack:r});let u=JEe({...t,consideredEntries:s}),c=zEe({...t,appliedPolicies:n,policyDefinitions:a,drawSize:u});if(c.error)return te({result:c,stack:r});let d=c.drawType;if(isNaN(u)&&d!==Ha)return te({result:{error:Qb},stack:r});let p=(a==null?void 0:a[ko])??(n==null?void 0:n[ko]),m=t.seedingProfile??((i=(e=p==null?void 0:p.seedingProfile)==null?void 0:e.drawTypes)==null?void 0:i[d??""])??(p==null?void 0:p.seedingProfile);t.seedingProfile&&(a[ko]||(a[ko]={...zM[ko]}),a[ko].seedingProfile=m);let h=XEe({...t,drawType:d});return h!=null&&h.error?te({result:h,stack:r}):{drawSize:u,drawType:d,enforceGender:o,seedingProfile:m,appliedPolicies:n,policyDefinitions:a}}function zEe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??qw({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),o=XQ({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return o.error?o:{drawType:o.drawType}}function Dee(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...hs,Uw].includes(e.entryStatus))}function WEe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||Dee(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Ne)}function qEe(t){let{tournamentRecord:e,event:i}=t,r=Bt({tournamentRecord:e,event:i}).appliedPolicies??{},n=Me(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function YEe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var r,n,a,o;return t??((n=(r=e==null?void 0:e[_r])==null?void 0:r.participants)==null?void 0:n.enforceGender)??((o=(a=i==null?void 0:i[_r])==null?void 0:a.participants)==null?void 0:o.enforceGender)}function KEe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:o,event:s}=t;return s&&o&&hR({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:o,event:s})}function JEe(t){return!t.drawSize&&t.consideredEntries.length&&![Ha,ow,gv,as,Jl].includes(t.drawType??"")&&sv(t.consideredEntries.length)||t.drawSize&&tt(t.drawSize)||!1}function XEe(t){var e,i;let{tournamentRecord:r,event:n,ignoreAllowedDrawTypes:a,drawType:o}=t,s=!a&&r&&SR({tournamentRecord:r,categoryType:(e=n==null?void 0:n.category)==null?void 0:e.categoryType,categoryName:(i=n==null?void 0:n.category)==null?void 0:i.categoryName});return s!=null&&s.length&&!s.includes(o)?{error:zx}:{...Q}}function tU(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:o}=Ai({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=Dee(r==null?void 0:r.entries)??[],l=HEe({...t,participantMap:o,participants:a,eventEntries:s});if(l.error)return te({result:l,stack:n});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:m,seedingProfile:h}=l,f=r==null?void 0:r.eventType,g=t.matchUpType??f,v=JRe({...t,enforceGender:m,eventType:f,matchUpType:g});if(v.error)return te({result:v,stack:n});let{matchUpFormat:y,tieFormat:I}=v;if(t.drawId&&typeof t.drawId!="string")return te({result:{error:le},stack:n});let b=TEe({...t,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:y,seedingProfile:h,participants:a,eventEntries:s,matchUpType:g,tieFormat:I,drawSize:d,drawType:p,event:r});if(b.error)return te({result:b,stack:n});let{existingDrawDefinition:S,positioningReports:w,drawDefinition:U,structureId:T,conflicts:D,entries:P}=b;if(!U)return te({result:{error:le},stack:n});let E=DEe({...t,existingDrawDefinition:S,positioningReports:w,appliedPolicies:u,drawDefinition:U,seedingProfile:h,participants:a,structureId:T,entries:P,params:t,stack:n});if(E.error)return E;let{qualifyingConflicts:R}=E;return U.drawName=t.drawName??(p&&tn(p)),d&&typeof e=="object"&&d>=4&&OL({...e,drawDefinition:U,matchUpType:g}),{existingDrawDefinition:!!S,qualifyingConflicts:R,positioningReports:w,drawDefinition:U,structureId:T,...Q,conflicts:D}}function Pee({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Qe,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:s},l)=>({[s]:l+1})));n=n||t.scaleName;let o=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:a[s],eventType:t.eventType,scaleType:Fl,scaleName:n,scaleDate:o}],participantId:s}))}}function QEe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:o,event:s,stage:l,sortDescending:u,scaleSortMethod:c}){let d=kR({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:o,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:m,stageEntries:h}=d;if(!h||!m)return{error:le};let f=Hh({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=Pee({scaleAttributes:r,scaledEntries:f,stageEntries:h,seedsCount:m,scaleName:n});return{scaleItemsWithParticipantIds:g}}var Ree={};wt(Ree,{addDrawEntries:()=>EL,addEventEntries:()=>Zs,addEventEntryPairs:()=>Aee,destroyPairEntries:()=>PX,destroyPairEntry:()=>AL,getEntriesAndSeedsCount:()=>kR,getMaxEntryPosition:()=>Y_,modifyEntriesStatus:()=>d0,modifyEventEntries:()=>Oee,mutate:()=>Eee,promoteAlternate:()=>Mee,promoteAlternates:()=>d$,query:()=>Iee,removeDrawEntries:()=>Nee,removeEventEntries:()=>Ow,setEntryPosition:()=>c$,setEntryPositions:()=>Cee});var Eee={};wt(Eee,{addDrawEntries:()=>EL,addEventEntries:()=>Zs,addEventEntryPairs:()=>Aee,destroyPairEntries:()=>PX,destroyPairEntry:()=>AL,modifyEntriesStatus:()=>d0,modifyEventEntries:()=>Oee,promoteAlternate:()=>Mee,promoteAlternates:()=>d$,removeDrawEntries:()=>Nee,removeEventEntries:()=>Ow,setEntryPosition:()=>c$,setEntryPositions:()=>Cee});function c$({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let o="setEntryPositions";if(!t)return{error:ve};if(!i)return te({result:{error:fr},stack:o});if(r!==void 0&&!Number.isSafeInteger(r))return{error:le,entryPosition:r};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let s=l=>{l.entries.forEach(u=>{u.entryPosition===r&&u.participantId!==i&&(u.entryPosition+=.1)})};return n||(a!=null&&a.entries&&(s(a),a.entries=Ps({entries:a.entries})),e!=null&&e.entries&&(s(e),e.entries=Ps({entries:e.entries}))),{...Q}}function Cee({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:le};for(let n of e){let{participantId:a,entryPosition:o}=n,s=c$({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:o,event:r});if(s.error)return s}return r!=null&&r.entries&&(r.entries=Ps({entries:r.entries})),i!=null&&i.entries&&(i.entries=Ps({entries:i.entries})),{...Q}}function Mee(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:le,participantId:e}:d$({...t,participantIds:[e].filter(Boolean)})}function d$({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Ne,eventId:a,event:o}){if(!t)return{error:ve};if(!Array.isArray(i))return{error:le,participantIds:i};if(!o)return{error:Ii};let s="promoteAlternates";if(o){let l=ej({element:o,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=ej({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?te({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...Q},stack:s}):l}return{...Q}}function ej({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===Jo),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),o=n.reduce((d,p)=>{let{entryPosition:m}=p;return isNaN(m)&&d||(!d||m<d.entryPosition)&&p||d},void 0),s=a.length?a:[o].filter(Boolean);if(!(s!=null&&s.length))return{error:y9};let l=s.filter(({entryStatus:d})=>d!==Jo);if(l.length)return{error:uM,invalidEntryStatus:l};let u=s.filter(({entryStage:d})=>d&&d!==r);if(u.length)return{error:nUe,invalidStage:u};let c=e&&s.filter(d=>d.stageSequence!==e);if(c!=null&&c.length)return{error:aUe,invalidStageSequence:c};for(let d of s){d.entryStatus=da;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(h=>{h.entryStatus===Jo&&h.entryPosition>p&&(h.entryPosition=h.entryPosition-1)});let m=Math.max(...i.entries.filter(h=>h.entryStatus===da&&!isNaN(h.entryPosition)).map(({entryPosition:h})=>tt(h||0)),0);d.entryPosition=m||0}return{...Q}}function Nee({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){var o;if(!a)return{error:Ii};if(!r)return{error:Bs};if(!(e!=null&&e.length))return{error:Zc};let s=kp({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(Nn(s,e))return{error:pv};let l=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:u}=Hi({event:a}),c=(o=u==null?void 0:u.flights)==null?void 0:o.find(d=>d.drawId===r);return c!=null&&c.drawEntries&&(c.drawEntries=c.drawEntries.filter(l),t&&(c.drawEntries=Ps({entries:c.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(l),t&&(i.entries=Ps({entries:i.entries}))),{...Q}}function fl(t){var e,i,r,n,a;let o="addParticipant",{allowDuplicateParticipantIdPairs:s,returnParticipant:l,disableNotice:u,pairOverride:c,participant:d}=t,p=t.tournamentId?(e=t.tournamentRecords)==null?void 0:e[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((i=t.tournamentRecords)==null?void 0:i[t.activeTournamentId]));if(!p)return{error:ve};if(!d)return te({result:{error:Sh},stack:o});d.participantId||(d.participantId=Ht()),p.participants||(p.participants=[]);let{participantId:m,individualParticipantIds:h}=d;if(p.participants.reduce((b,S)=>S.participantId===m||b,!1))return{error:h9};let{participantType:f,participantRole:g}=d;if(!f||!Object.keys(oI).includes(f))return{error:xs,participantType:f};if(!g)return{error:m9};let v=p.participants||[],y=v.filter(b=>b.participantType===Dt).map(b=>b.participantId);if(f!==Dt&&d.person)return{error:le,person:d.person};if(h&&!Array.isArray(h))return{error:le,individualParticipantIds:h};if(f===gt){if(d.person)return{error:le,person:d.person};if(d.individualParticipantIds){if(d.individualParticipantIds.length!==2&&!c)return te({info:"PAIR must be 2 individualParticipantIds",result:{error:ba},stack:o});{let w=v.filter(U=>U.participantType===Dt).map(U=>U.participantId);if(!Array.isArray(d.individualParticipantIds))return te({result:{error:ba},stack:o});if(!d.individualParticipantIds.reduce((U,T)=>w.includes(T)&&U,!0))return te({result:{error:ba},stack:o})}}else return te({result:{error:Zc},stack:o});let b=v.filter(w=>w.participantType===gt).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),S=d.participantType===gt&&b.find(w=>ji(w.individualParticipantIds,d.individualParticipantIds).length===2);if(S&&!s)return{...Q,existingParticipant:!0,participant:l&&Me(S.participant)};if(!d.participantName){let w=v.filter(T=>{var D;return(D=d.individualParticipantIds)==null?void 0:D.includes(T.participantId)}),U=w.map(T=>{var D;return(D=T.person)==null?void 0:D.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(U+="/Unknown"),d.participantName=U}}else if(f===Dt){if(!((r=d.person)!=null&&r.standardFamilyName)||!((n=d.person)!=null&&n.standardGivenName))return{error:I9};if(!d.participantName){let b=`${d.person.standardFamilyName.toUpperCase()}, ${d.person.standardGivenName}`;d.participantName=b}}else if(f&&[Jt,Qa].includes(f)){if(h||(d.individualParticipantIds=[]),(a=d.individualParticipantIds)==null?void 0:a.length)for(let b of d.individualParticipantIds){if(typeof b!="string")return te({result:{participantId:b,error:le},stack:o});if(!y.includes(b))return te({result:{participantId:b,error:Wi},stack:o})}}else return{error:xs};p.participants.push(d),u||ut({payload:{tournamentId:p.tournamentId,participants:[d]},topic:xc});let I={participant:l&&Me(d),...Q};return Ge(I)}function us({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:ve};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=Ht())});let a=r.filter(d=>!n.includes(d.participantId)),o=r.filter(d=>n.includes(d.participantId)),s=a.filter(d=>d.participantType===Dt),l=a.filter(d=>d.participantType!==Dt),u=s.concat(...l),c=[];if(u.length){for(let p of u){let m=fl({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(m.error)return m;m.success&&!m.existingParticipant&&c.push(m.participant)}c.length&&ut({topic:xc,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&Me(c),addedCount:c.length,...Q};return o.length&&Object.assign(d,{notAdded:o,info:cP}),Ge(d)}else return{info:"No new participants to add",addedCount:0,...Q}}function Aee(t){let e=We(t,[{[Ur]:!0,[td]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=Jo,participantIdPairs:n=[],entryStage:a=Ne,tournamentRecord:o,drawDefinition:s,event:l,uuids:u}=t;if(l.eventType!==ei)return{error:ql};let c=[],d=new Map;for(let b of o.participants??[]){let{participantType:S,participantId:w,person:U,individualParticipantIds:T}=b;S===Dt&&U!=null&&U.sex?d.set(w,U.sex):S===gt&&T&&c.push(T)}let p=n.filter(b=>{if(b.length!==2)return!0;if(!l.gender||l.gender===Fs)return!1;if(!d.has(b[0])||!d.has(b[1]))return!0;let S=b.map(U=>d.get(U)),w=l.gender===Qt&&(S[0]!==Qt||S[1]!==Qt)||l.gender===hi&&(S[0]!==hi||S[1]!==hi);return l.gender===jn&&(S.sort(ZP),(S[0]!==hi||S[1]!==Qt)&&(w=!0)),w});if(p.length)return{error:ba,invalidParticipantIdPairs:p};let m=n.map(b=>({participantId:(u==null?void 0:u.pop())??Ht(),participantRole:en,individualParticipantIds:b,participantType:gt})),h=i?m:m.filter(b=>!c.find(S=>ji(S,b.individualParticipantIds).length===2)),f,g=[];if(h){let b=us({allowDuplicateParticipantIdPairs:i,participants:h,returnParticipants:!0,tournamentRecord:o});if(b.error)return b;g=b.participants||[],f=b.info}let v=n.map(b=>{let S=g.find(U=>ji(U.individualParticipantIds,b).length===2);if(S)return S;let{participant:w}=ls({tournamentRecord:o,participantIds:b});return w}).map(b=>b.participantId),y=Zs({participantIds:v,tournamentRecord:o,drawDefinition:s,entryStatus:r,entryStage:a,event:l});h.length&&ut({payload:{participants:h},topic:xc});let I=h.map(Tt);return{...y,info:f,newParticipantIds:I}}function Oee({entryStatus:t=da,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Ne,tournamentRecord:n,event:a}){if(!n)return{error:ve};if(!a)return{error:Ii};let o=n.participants??[],s=o.filter(f=>f.participantType===Dt).map(f=>f.participantId),l=e.concat(...i).flat(1/0).filter(f=>!s.includes(f));if(l.length)return{error:ba,invalidParticipantIds:l};let u=i.filter(f=>f.length!==2);if(u.length)return{error:ba,invalidParticipantIdPairs:u};let c=o.filter(f=>f.participantType===gt).map(f=>f.individualParticipantIds),d=i.filter(f=>!c.find(g=>ji(g,f).length===2)).map(f=>({participantType:gt,participantRole:en,individualParticipantIds:f})),p=us({participants:d,tournamentRecord:n});if(p.error)return p;let m=i.map(f=>{let{participant:g}=ls({tournamentRecord:n,participantIds:f});return g}).map(f=>({participantId:f,entryStatus:t,entryStage:r})),h=e.map(f=>({entryStatus:Eo,participantId:f,entryStage:r}));return a.entries=(a.entries??[]).filter(f=>f.entryStage===r),a.entries=a.entries.concat(...m,...h),{...Q}}var kee={};wt(kee,{addDrawDefinition:()=>iU,addEvent:()=>Ov,addFlight:()=>jR,assignSeedPositions:()=>qee,attachFlightProfile:()=>I$,categoryCanContain:()=>nw,deleteDrawDefinitions:()=>$R,deleteEvents:()=>Kee,deleteFlightAndFlightDraw:()=>zee,deleteFlightProfileAndFlightDraws:()=>Bee,generate:()=>xee,generateEventsFromTieFormat:()=>Lee,getCategoryAgeDetails:()=>xm,getEvent:()=>u$,getEventProperties:()=>s$,getEventStructures:()=>rR,getEventTimeItem:()=>fw,getEvents:()=>l$,getFlightProfile:()=>Hi,getScaledEntries:()=>Hh,modifyEvent:()=>Jee,modifyEventMatchUpFormatTiming:()=>Vee,modifyPairAssignment:()=>Wee,mutate:()=>_ee,query:()=>Tee,refreshEventDrawOrder:()=>v$,removeEventMatchUpFormatTiming:()=>BR,removeScaleValues:()=>y$,removeSeeding:()=>Yee,setEventDates:()=>f$,setEventDisplay:()=>VR,setEventEndDate:()=>h$,setEventStartDate:()=>m$,updateDrawIdsOrder:()=>g$,validateCategory:()=>ny});var xee={};wt(xee,{generateEventsFromTieFormat:()=>Lee});function ZEe({tournamentId:t,event:e}){return e?(ut({payload:{tournamentId:t,event:e},key:e.eventId,topic:PJ}),{...Q}):{error:Ii}}var eCe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},tCe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},iCe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},Fee={COLLEGE_D3:eCe,COLLEGE_DEFAULT:tCe,COLLEGE_JUCO:iCe,DOMINANT_DUO:y8,DOMINANT_DUO_MIXED:h8,LAVER_CUP:T8,TEAM_DOUBLES_3_AGGREGATION:u8,TIME_TENNIS_DUAL:f8,TIME_TENNIS_PRO_CIRCUIT:m8,USTA_BREWER_CUP:g8,USTA_OZAKI_CUP:v8,USTA_COLLEGE:b8,USTA_GOLD_TEAM_CHALLENGE:l8,USTA_INTERSECTIONAL:p8,USTA_LEVEL_1:w8,USTA_SECTION_BATTLE:d8,USTA_SOUTHERN_LEVEL_5:c8,USTA_TOC:D8,USTA_WTT_ITT:U8,USTA_ZONAL:S8};function Ov({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){var n,a,o,s;if(!e)return{error:ve};if(e.events||(e.events=[]),!r)return{error:Ii};let{startDate:l,endDate:u}=e;if(!i&&((n=r.entries)!=null&&n.length||(a=r.drawDefinitions)!=null&&a.length)){let d=Ge({drawDefinitions:!!((o=r.drawDefinitions)!=null&&o.length),entries:!!((s=r.entries)!=null&&s.length)});return{info:"entries/drawDefinitions cannot exist",error:le,context:d}}let c={eventType:Fm,drawDefinitions:[],entries:[],startDate:l,endDate:u,...r};if(r.eventType===Ca){if(r.tieFormat){let d=qn({tieFormat:r.tieFormat});if(d.error)return d}else if(r.tieFormatName){if(!Fee[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:le};let d=Au({isMock:e==null?void 0:e.isMock,namedFormat:r.tieFormatName,event:r});c.tieFormat=d}}if(c.eventId||(c.eventId=Ht()),e.events.reduce((d,p)=>d||p.eventId===c.eventId,void 0))return{error:KK};{let d=c;if(e.events.push(d),!t){let{topics:p}=Do();if(p.includes(_P)){let f=ou({event:r}).matchUps??[];Fc({tournamentId:e==null?void 0:e.tournamentId,eventId:r.eventId,matchUps:f})}let{drawDefinitions:m,...h}=r;for(let f of m||[])mw({drawDefinition:f});ZEe({tournamentId:e==null?void 0:e.tournamentId,event:h})}return{...Q,event:c}}}function Lee(t){var e,i,r,n;let a=We(t,[{[ug]:{[EP]:!0,[Q8]:!0}},{[Ur]:!0}]);if(a.error)return a;let o=t.tieFormat||Au({namedFormat:t.tieFormatName}),s=t.uuids||[s8(o.collectionDefinitions.length)],l={[Qt]:[],[hi]:[]};if(t.addEntriesFromTeams){let c=(i=(e=t.tournamentRecord.participants)==null?void 0:e.filter(d=>d.participantType===Gn))==null?void 0:i.flatMap(d=>d.individualParticipantIds??[]);for(let d of t.tournamentRecord.participants??[])if(c!=null&&c.includes(d.participantId)){let p=(r=d.person)==null?void 0:r.sex;p&&[Qt,hi].includes(p)&&l[p].push(d.participantId)}}let u=[];for(let c of o.collectionDefinitions??[]){let d=((n=s==null?void 0:s.pop())==null?void 0:n.toString())||Ht(),p=c.matchUpType,m=c.gender,h={matchUpFormat:c.matchUpFormat,eventName:c.collectionName,category:c.category,gender:m,eventType:p,eventId:d};if(t.addEntriesFromTeams){let f=p===Ou?Eo:t.entryStatus||da,g=m===jn?[...l[Qt],...l[hi]]:l[m]??[];if(g.length){let v=Zs({participantIds:g,entryStatus:f,event:h});if(v.error)return v}}if(u.push(h),t.addEvents!==!1){let f=Ov({internalUse:!0,tournamentRecord:t.tournamentRecord,event:h});if(f.error)return f}}return{...Q,events:u}}var _ee={};wt(_ee,{addDrawDefinition:()=>iU,addEvent:()=>Ov,addFlight:()=>jR,assignSeedPositions:()=>qee,attachFlightProfile:()=>I$,deleteDrawDefinitions:()=>$R,deleteEvents:()=>Kee,deleteFlightAndFlightDraw:()=>zee,deleteFlightProfileAndFlightDraws:()=>Bee,modifyEvent:()=>Jee,modifyEventMatchUpFormatTiming:()=>Vee,modifyPairAssignment:()=>Wee,refreshEventDrawOrder:()=>v$,removeEventMatchUpFormatTiming:()=>BR,removeScaleValues:()=>y$,removeSeeding:()=>Yee,setEventDates:()=>f$,setEventDisplay:()=>VR,setEventEndDate:()=>h$,setEventStartDate:()=>m$,updateDrawIdsOrder:()=>g$,validateCategory:()=>ny});function kv({removePriorValues:t=!0,status:e=Za,statusObject:i,event:r}){if(!At(i))return{error:le};let n=Mo({event:r,status:e}),a=`${od}.${sd}`,o={itemValue:{[e]:{...n,...i}},itemType:a};return Gh({timeItem:o,removePriorValues:t,event:r})}function xv(t){var e,i,r,n,a,o,s;let l=We(t,[{[Ur]:!0,[td]:!0},{eventDataParams:!1,[Xn]:ia}]);if(l.error)return l;let{includePositionAssignments:u,removePriorValues:c,tournamentRecord:d,status:p=Za,event:m,drawIdsToRemove:h,drawIdsToAdd:f}=t,{appliedPolicies:g}=Bt({tournamentRecord:d,event:m}),v={...g,...t.policyDefinitions},y=((e=m==null?void 0:m.drawDefinitions)==null?void 0:e.map(({drawId:R})=>R))??[],I=t.drawDetails?Object.keys(t.drawDetails):[],b=I.length?[]:t.drawIds,S=(f??[]).concat(...h??[],...b??[],...I),w=S.filter(R=>!y.includes(R));if(w.length)return te({result:{error:ja},context:{invalidDrawIds:w}});let U=Mo({event:m,status:p}),T=Object.keys((U==null?void 0:U.drawDetails)||{}).filter(R=>y.includes(R)).reduce((R,N)=>(R[N]=U.drawDetails[N],R),{});for(let R of y)if((!S.length||S.includes(R))&&(h!=null&&h.includes(R)||b!=null&&b.length&&!b.includes(R)?T[R]={...T[R],publishingDetail:{published:!1}}:(f!=null&&f.includes(R)||b!=null&&b.includes(R)||!(b!=null&&b.length))&&(T[R]={...T[R],publishingDetail:{published:!0}})),(i=t.drawDetails)==null?void 0:i[R]){let N=t.drawDetails[R],A=N.structureDetails??T[R].structureDetails,M=N.stageDetails??T[R].stageDetails??{},{structureIdsToRemove:C=[],structureIdsToAdd:O=[],publishingDetail:k={},stagesToRemove:x=[],stagesToAdd:F=[]}=N;if((O||F)&&(k.published=!0),T[R]={publishingDetail:k,structureDetails:A,stageDetails:M},O.length||C.length){let _=(((n=(r=m==null?void 0:m.drawDefinitions)==null?void 0:r.find(B=>B.drawId===R))==null?void 0:n.structures)??[]).map(({structureId:B})=>B),L=(O??[]).concat(C??[]).filter(B=>!_.includes(B));if(L.length)return te({result:{error:Ni},context:{invalidStructureIds:L}});A=A??{};for(let B of _)C.includes(B)?A[B]={published:!1}:A[B]={published:!0};T[R].structureDetails=A}let $=(((o=(a=m==null?void 0:m.drawDefinitions)==null?void 0:a.find(_=>_.drawId===R))==null?void 0:o.structures)??[]).map(({stage:_})=>_);if(F.length){for(let _ of F)M[_]={published:!0};for(let _ of $)M[_]||(M[_]={published:!1})}if(F.length||x.length){for(let _ of x)M[_]={published:!1};for(let _ of $)M[_]||(M[_]={published:!0})}(F.length||x.length)&&(T[R].stageDetails=M)}kv({statusObject:{drawDetails:T},removePriorValues:c,status:p,event:m});let{topics:D}=Do(),P=D.includes(bM),E=P||t.returnEventData?(s=ER({includePositionAssignments:u,...t.eventDataParams,usePublishState:!0,tournamentRecord:d,policyDefinitions:v,event:m}))==null?void 0:s.eventData:void 0;return P&&ut({payload:{eventData:E,tournamentId:d.tournamentId},topic:bM}),{...Q,eventData:E}}var $ee="deleteDrawDefinitions",qM="autoSchedulingAudit",lS="deleteEvents",rCe={AUTO_SCHEDULING_AUDIT:qM,DELETE_EVENTS:lS,DELETE_DRAW_DEFINITIONS:$ee};function $R(t){var e,i,r,n,a;if(!t.tournamentRecord)return{error:ve};let o="deleteDrawDefinitions",s=t.drawIds??[],l=t.event,{autoPublish:u=!0,tournamentRecord:c,auditData:d,eventId:p,force:m}=t,{appliedPolicies:h}=Bt({tournamentRecord:c,event:l}),f={...h,...t.policyDefinitions},g=Array.isArray(s)?s[0]:void 0;if(!l){let N=Kn({tournamentRecord:c,eventId:p,drawId:g});if(N.error)return N;l=N.event}let v=[],y=[],I=[];if(!(l!=null&&l.drawDefinitions))return te({info:"event has no drawDefinition",result:{...Q},stack:o});let b=l.drawDefinitions.map(({drawId:N})=>N);if(s.length||(s=b),s=s.filter(N=>b.includes(N)),!s.length)return te({info:"nothing to do; no matching drawIds in event.",result:{...Q},stack:o});let S=Me(Hi({event:l}).flightProfile,!1,!0),w=({participantId:N,drawPosition:A,qualifier:M,bye:C})=>({bye:C,qualifier:M,drawPosition:A,participantId:N}),U=m??((i=(e=h==null?void 0:h[vo])==null?void 0:e.allowDeletionWithScoresPresent)==null?void 0:i.drawDefinitions),T=Mo({event:l})??{},D=T.drawIds??(T.drawDetails&&Object.keys(T.drawDetails))??[],P,E=[],R=l.drawDefinitions.filter(N=>{var A,M,C,O,k,x,F,$;if(s.includes(N.drawId)){let _=((A=Pn({event:l,drawDefinition:N}))==null?void 0:A.matchUps)??[];if(_.some(({score:re})=>br({score:re}))&&!U)return E.push(N.drawId),!0;let{drawId:L,drawType:B,drawName:V}=N,G=(M=S==null?void 0:S.flights)==null?void 0:M.find(re=>re.drawId===N.drawId);G&&(G.drawEntries=(C=G.drawEntries)==null?void 0:C.filter(re=>hs.includes(re.entryStatus))),D.includes(L)&&(D=D.filter(re=>re!==L),P=!0);let j=(k=(O=ss({stageSequence:1,drawDefinition:N,stage:Ne}))==null?void 0:O.structures)==null?void 0:k[0],z=(F=(x=j?Iy({structureId:j.structureId,tournamentRecord:c,drawDefinition:N}):void 0)==null?void 0:x.positionAssignments)==null?void 0:F.map(w),W=($=ss({stage:Je,drawDefinition:N}))==null?void 0:$.structures,q=W!=null&&W.length?W.map(re=>{var J;let H=re.stageSequence;return{positionAssignments:(J=Iy({structureId:re.structureId,tournamentRecord:c,drawDefinition:N}))==null?void 0:J.positionAssignments.map(w),stageSequence:H}}):void 0,Y={action:$ee,payload:{drawDefinitions:[N],eventId:p??(l==null?void 0:l.eventId),auditData:d}};I.push(Y),v.push(Ge({tournamentId:c.tournamentId,eventId:p??(l==null?void 0:l.eventId),qualifyingPositionAssignments:q,positionAssignments:z,auditData:d,drawType:B,drawName:V,drawId:L})),_==null||_.forEach(({matchUpId:re})=>y.push(re))}return!s.includes(N.drawId)});if(E.length&&!m)return te({context:{drawIdsWithScoresPresent:E},result:{error:gP},stack:o});if(l.drawDefinitions=R,S&&rd({event:l,extension:{name:os,value:S}}),Qw({tournamentRecord:c}),P){let N={};for(let M of D)N[M]=((r=T.drawDetails)==null?void 0:r[M])??{published:!0};let A=kv({statusObject:{drawDetails:N},event:l});if(A.error)return{error:A.error}}if(I.length)if(vP(Iu)){let N=c.tournamentId;ut({topic:Iu,payload:{tournamentId:N,detail:I}});let A=(((a=(n=Ro({element:l,itemType:Ed}))==null?void 0:n.timeItem)==null?void 0:a.itemValue)||0)+1;Tl({element:l,timeItem:{itemType:Ed,itemValue:A},removePriorValues:!0})}else nCe({appliedPolicies:h,event:l,deletedDrawsDetail:v,auditData:d});if(y.length&&ec({tournamentId:c==null?void 0:c.tournamentId,matchUpIds:y}),s.forEach(N=>n0e({drawId:N})),u&&P){let N=xv({...t.eventDataParams,drawIdsToRemove:s,policyDefinitions:f,tournamentRecord:c,event:l});if(N.error)return{...Q,info:N.error}}return{...Q}}function nCe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){var n;if(((n=t==null?void 0:t.audit)==null?void 0:n[Ed])===!1)return;let{extension:a}=It({name:Ed,element:e}),o={...r,deletedDrawsDetail:i},s={value:Array.isArray(a==null?void 0:a.value)?a==null?void 0:a.value.concat(o):[o],name:Ed};_t({element:e,extension:s})}function Bee({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){var a;if(!e)return{error:ve};if(!r)return{error:Ii};let{flightProfile:o}=Hi({event:r});if(o){let s=(a=o.flights)==null?void 0:a.map(({drawId:u})=>u).filter(Boolean),l=$R({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return l.error?l:kP({event:r,name:os})}return{...Q}}function p$(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,o=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(o).length)return{error:ki};let s=Object.keys(o).filter(u=>!n||n===u);if(n&&!s.includes(n))return{error:le};let l;for(let u of s){let c=o[u],{event:d}=Kn({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=aCe({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...Q}:{error:fo}}function aCe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:ve};if(r&&!Array.isArray(r))return{error:le};if(e&&!Array.isArray(e))return{error:le};let a=_u;if(n){let{extension:o}=It({element:n,name:a}),s=(o==null?void 0:o.value)||{},l=tj({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});_t({element:n,extension:{name:a,value:l}})}else{let{extension:o}=It({element:t,name:a}),s=(o==null?void 0:o.value)||{},l=tj({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});_t({extension:{name:a,value:l},element:t})}return{...Q}}function tj(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let o=(n==null?void 0:n.length)&&i.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==r)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let s=(a==null?void 0:a.length)&&e.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==r)}:l}).filter(({matchUpFormatCodes:l,averageTimes:u})=>(l==null?void 0:l.length)||u).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:(o==null?void 0:o.length)&&o||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function Vee(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:o,event:s}=t;if(!e)return{error:ve};if(!Ea({matchUpFormat:n}))return{error:le};if(!s)return{error:Ii};let{averageTimes:l=[],recoveryTimes:u=[]}=xR({tournamentRecord:e,matchUpFormat:n,event:s}),c=s.category,d=(c==null?void 0:c.categoryName)||(c==null?void 0:c.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},m={categoryNames:[d],minutes:{}},h=I=>{var b,S;if((b=I.categoryTypes)!=null&&b.includes(a)&&console.log("encountered:",{categoryType:a}),!((S=I.categoryNames)!=null&&S.includes(d)&&(I.categoryNames=I.categoryNames.filter(w=>w!==d),p={minutes:I.minutes,categoryNames:[d]},!I.categoryNames.length)))return I},f=r&&!isNaN(tt(r)),g=i&&!isNaN(tt(i)),v=l.map(h).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length}),y=u.map(h).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length});return f&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||ri]:r}),v.push(p)),g&&(Object.assign(m.minutes,{[(s==null?void 0:s.eventType)||ri]:i}),y.push(m)),!f&&!g?{error:le}:p$({averageTimes:f&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:n,eventId:o,event:s})}function BR(t){if(t.event)return ij({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=We(t,[{[gn]:!0,[rJ]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=Kn({tournamentRecord:n,eventId:r});if(a)return ij({event:a})}}return{error:fo}}function ij({event:t}){return kP({event:t,name:_u})}var oCe="MON",sCe="TUE",lCe="WED",uCe="THU",cCe="FRI",dCe="SAT",pCe="SUN",jee={MON:oCe,TUE:sCe,WED:lCe,THU:uCe,FRI:cCe,SAT:dCe,SUN:pCe};function Gee(t){return!Array.isArray(t)||dt(t).length!==t.length?!1:t.every(e=>Object.keys(jee).includes(e))}function m$({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:ve};if(!e)return{error:Ii};if(!ul.test(i))return{error:Fr};let r=Hee(t);if(r.error)return r;let{tournamentStartDate:n,tournamentEndDate:a}=r,o=new Date(ht(i)).getTime();if(!n||!a||o<n||o>a)return{error:Fr};let s=e.endDate&&new Date(ht(e.endDate)).getTime();return s&&o>s&&(e.endDate=i),e.startDate=i,{...Q}}function h$(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:ve};if(!i)return{error:Ii};if(!ul.test(r))return{error:Fr};let n=Hee(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:o}=n,s=new Date(ht(r)).getTime();if(!a||!o||s<a||s>o)return{error:Fr};let l=i.startDate&&new Date(ht(i.startDate)).getTime();return l&&s<l&&(i.startDate=r),i.endDate=r,{...Q}}function f$(t){var e;let i=We(t,[{tournamentRecord:!0,event:!0},{[Jr]:u=>ul.test(u),[za]:Fr,startDate:!1,endDate:!1},{[Jr]:u=>u.filter(Boolean).every(c=>ul.test(c)),[za]:Fr,activeDates:!1},{[Jr]:Gee,weekdays:!1}]);if(i.error)return i;let{tournamentRecord:r,weekdays:n,event:a,startDate:o,endDate:s}=t,l=(e=t.activeDates)==null?void 0:e.filter(Boolean);if(o&&s){let u=new Date(ht(o)).getTime(),c=new Date(ht(s)).getTime();if(u>c)return{error:le}}if(l){let u=o||r.startDate,c=s||r.endDate,d=!u||l.every(m=>new Date(m)>=new Date(u)),p=!c||l.every(m=>new Date(m)<=new Date(c));if(!d||!p)return{error:Fr}}if(o){let u=m$({tournamentRecord:r,event:a,startDate:o});if(u.error)return u}if(s){let u=h$({tournamentRecord:r,event:a,endDate:s});if(u.error)return u}return l&&(a.activeDates=l),n&&(a.weekdays=n),{...Q}}function Hee(t){let{startDate:e,endDate:i}=t;return!ul.test(e)||!ul.test(i)?te({result:{error:u9},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(ht(e)).getTime(),tournamentEndDate:new Date(ht(i)).getTime()}}function g$({event:t,orderedDrawIdsMap:e}){var i,r;if(typeof t!="object")return{error:Ii};if(!e)return{error:Qe,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:le,info:"orderedDrawIdsMap must be an object"};let n=Object.values(e);if(!n.every(o=>!isNaN(o)))return{error:le,info:"drawOrder must be numeric"};if(dt(n).length!==n.length)return{error:le,info:"drawOrder values must be unique"};if((i=t.drawDefinitions)!=null&&i.length){let o=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&ji(o,s).length!==o.length)return{error:le,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:a}=Hi({event:t});return(r=a==null?void 0:a.flights)==null||r.forEach(o=>{o.flightNumber=e[o.drawId]}),{...Q}}function v$({tournamentRecord:t,event:e}){var i;if(!t)return{error:ve};if(!e)return{error:Ii};let{flightProfile:r}=Hi({event:e}),n=(r==null?void 0:r.flights)&&Object.assign({},...r.flights.sort((a,o)=>a.flightNumber-o.flightNumber).map((a,o)=>({[a.drawId]:o+1})))||((i=e.drawDefinitions)==null?void 0:i.length)&&Object.assign({},...e.drawDefinitions.sort((a,o)=>a.drawOrder-o.drawOrder).map((a,o)=>({[a.drawId]:o+1})))||void 0;return n?g$({event:e,orderedDrawIdsMap:n}):{...Q}}function zee({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){var o,s;if(!e)return{error:ve};if(!r)return{error:Bs};if(!n)return{error:Ii};let{flightProfile:l}=Hi({event:n});if(l&&(o=l.flights)!=null&&o.find(u=>u.drawId===r)){let u=l.flights.filter(d=>d.drawId!==r),c={name:os,value:{...l,flights:u}};rd({event:n,extension:c})}if((s=n.drawDefinitions)!=null&&s.find(u=>u.drawId===r)){let u=$R({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(u.error)return u}return v$({tournamentRecord:e,event:n})}function Wee(t){var e,i;let r=We(t,[{[td]:!0,[Ur]:!0,[LF]:!1},{replacementIndividualParticipantId:!0,[Jr]:y=>Pi(y),existingIndividualParticipantId:!0,[Ko]:fr,participantId:!0}]),{replacementIndividualParticipantId:n,existingIndividualParticipantId:a,tournamentRecord:o,drawDefinition:s,participantId:l,event:u,uuids:c}=t;if(r.error)return r;if((u==null?void 0:u.eventType)!==go)return{error:ql};if(!(((e=u==null?void 0:u.entries)==null?void 0:e.filter(({entryStatus:y})=>[Eo,Np].includes(y)).map(({participantId:y})=>y))||[]).includes(n))return{error:ks};let d=(o.participants||[]).find(y=>y.participantId===l);if((d==null?void 0:d.participantType)!==gt)return{error:Uh,participant:d};let p=d.individualParticipantIds,m=[n,...p.filter(y=>y!==a)],{participant:h}=ls({participantIds:m,tournamentRecord:o}),f;if(h)f=h.participantId;else{let y={participantId:c==null?void 0:c.pop(),participantRole:en,individualParticipantIds:m,participantType:gt},I=fl({participant:y,returnParticipant:!0,tournamentRecord:o});if(I.error)return I;f=I.participant.participantId}let{flightProfile:g}=Hi({event:u});if(s){let y=(i=g==null?void 0:g.flights)==null?void 0:i.find(({drawId:I})=>I===s.drawId);y&&(y.drawEntries=y.drawEntries.map(I=>I.participantId===l?{...I,participantId:f}:I)),s.entries=s.entries.map(I=>I.participantId===l?{...I,participantId:f}:I);for(let I of s.structures||[])if(I.structures){I.positionAssignments=void 0;for(let b of I.structures)b.positionAssignments=b.positionAssignments.map(S=>S.participantId===l?{...S,participantId:f}:S)}else I.positionAssignments&&(I.positionAssignments=I.positionAssignments.map(b=>b.participantId===l?{...b,participantId:f}:b))}u.entries=u.entries.map(y=>y.participantId===l&&{...y,participantId:f}||y.participantId===n&&{...y,participantId:a}||y);let v=o.events.some(({entries:y,eventId:I,drawDefinitions:b})=>u.eventId===I?b.some(({drawId:S,entries:w})=>S===(s==null?void 0:s.drawId)?!1:w==null?void 0:w.find(U=>U.participantId===l)):y==null?void 0:y.find(S=>S.participantId===l));if(!v){let y=Bh({addIndividualParticipantsToEvents:!1,participantIds:[l],tournamentRecord:o});if(y.error)return y}return{...Q,participantOtherEntries:v,newPairParticipantId:f}}function iU(t){var e,i,r,n,a,o,s,l,u,c,d,p;let{flight:m,suppressNotifications:h,modifyEventEntries:f,existingDrawCount:g,allowReplacement:v,checkEntryStatus:y,tournamentRecord:I,drawDefinition:b,event:S}=t;if(!b)return{error:_e};if(!S)return{error:Ii};S.drawDefinitions||(S.drawDefinitions=[]);let{drawId:w,drawName:U,entries:T}=b,{entries:D}=S,P=0;if(g!==void 0&&g!==S.drawDefinitions.length)return{error:le,info:"drawDefintions count mismatch"};let{flightProfile:E}=Hi({event:S}),R=m&&((e=E==null?void 0:E.flights)==null?void 0:e.find(B=>B.flightNumber===m.flightNumber)),N=(n=(r=(i=E==null?void 0:E.links)==null?void 0:i.find(B=>{var V;return((V=B==null?void 0:B.target)==null?void 0:V.drawId)===w}))==null?void 0:r.source)==null?void 0:n.drawId;if(N&&!S.drawDefinitions.find(B=>B.drawId===N))return te({result:{error:_e},info:{sourceDrawId:N}});if(R&&R.drawId!==b.drawId)return te({result:{error:dm},info:{relevantFlight:R}});let A=T==null?void 0:T.every(({participantId:B,entryStatus:V})=>{let G=R==null?void 0:R.drawEntries.find(j=>j.participantId===B);return!V||(G==null?void 0:G.entryStatus)===V}),M=!y||D&&(T==null?void 0:T.every(({participantId:B,entryStatus:V,entryStage:G})=>{var j;return((j=D.find(z=>z.participantId===B&&(!z.entryStage||z.entryStage===G)))==null?void 0:j.entryStatus)===V}));if(R&&!A)return te({result:{error:dm},context:{drawEntriesPresentInFlight:A,matchingEventEntries:M,relevantFlight:R},info:"Draw entries are not present in flight or do not match entryStatuses"});if(f&&(T==null||T.filter(Boolean).forEach(B=>{if(B!=null&&B.entryStatus&&hs.includes(B==null?void 0:B.entryStatus)){let V=D==null?void 0:D.filter(Boolean).find(G=>G.participantId===B.participantId);V&&B.entryStatus&&(V==null?void 0:V.entryStatus)!==B.entryStatus&&(V.entryStatus=B.entryStatus,P+=1)}})),D&&!M)return te({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:M,eventEntries:D},error:dm}});let C=((o=(a=E==null?void 0:E.flights)==null?void 0:a.map(({flightNumber:B})=>!isNaN(B)&&tt(B)))==null?void 0:o.filter(Boolean))||[],O=((s=S.drawDefinitions.map(({drawOrder:B})=>B&&tt(B)))==null?void 0:s.filter(Boolean))||[],k=Math.max(0,...O,...C)+1,x=(l=E==null?void 0:E.flights)==null?void 0:l.find(B=>B.drawId===w),F;if(x){x.drawName=b.drawName,F={name:os,value:{...E,flights:E.flights}};let B=x.flightNumber;B&&!O.includes(B)?k=B:x.flightNumber=k}else{let B=(E==null?void 0:E.flights)||[];B.push({manuallyAdded:!0,flightNumber:k,drawEntries:T,drawName:U,drawId:w}),F={name:os,value:{...E||{},flights:B}}}rd({event:S,extension:F}),Object.assign(b,{drawOrder:k});let $=S.drawDefinitions.find(B=>B.drawId===w),_=I==null?void 0:I.tournamentId,L=S.eventId;if($){if(!v)return{error:$K};let B=((c=(u=Pn({drawDefinition:$}))==null?void 0:u.matchUps)==null?void 0:c.map(Pr))??[],V=(d=Pn({drawDefinition:b}))==null?void 0:d.matchUps;if(!h){B!=null&&B.length&&ec({matchUpIds:B,action:"modifyDrawDefinition",tournamentId:_,eventId:L}),V!=null&&V.length&&Fc({matchUps:V,tournamentId:_,eventId:L}),S.drawDefinitions=S.drawDefinitions.map(j=>j.drawId===w?b:j);let G=(p=b.structures)==null?void 0:p.map(({structureId:j})=>j);ui({drawDefinition:b,tournamentId:_,structureIds:G,eventId:L})}}else if(S.drawDefinitions.push(b),!h){let{matchUps:B}=Pn({drawDefinition:b,event:S});B&&Fc({tournamentId:I==null?void 0:I.tournamentId,matchUps:B}),mw({drawDefinition:b,tournamentId:_,eventId:L})}return{...Q,modifiedEventEntryStatusCount:P}}function qee(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:u}=t,c=0;if(!(s!=null&&s.length))return{error:Kx};if(!r)return{error:ve};if(!l)return{error:Bs};let d=Io({provisionalPositioning:e,drawDefinition:n,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:m}=d,h=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:y}=v;m&&y<=m&&(!i||h[y])&&(h[y]=v)});let f=Object.values(h),g=f.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==EK(g).length)return{error:BK};for(let v of f){let y=Rv({...v,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,event:u});if(y!=null&&y.error)return y;y!=null&&y.success&&c++}return c?{...Q,modifications:c}:{error:hv}}function I$({deleteExisting:t,event:e,flightProfile:i}){var r;let n="attachFlightProfile";if(!i)return te({result:{error:Qe},stack:n});if(!e)return te({result:{error:Ii},stack:n});let{flightProfile:a}=Hi({event:e});return a&&!t?te({result:{error:pF},stack:n}):(r=e.drawDefinitions)!=null&&r.length?te({result:{error:FK},stack:n}):(rd({event:e,extension:{name:os,value:i}}),{flightProfile:Me(i,!1,!0),...Q})}function mCe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var r;if(!t)return{error:ve};if(!i)return{error:Zc};if(!e)return{error:Qe,info:"scaleAttributes required"};let{scaleType:n,eventType:a,scaleName:o}=e,s=[ZJ,n,a,o].join(".");return(r=t.participants)==null||r.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(u=>u&&(u==null?void 0:u.itemType)!==s))}),{...Q}}function y$({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:o}){var s;if(!a)return{error:Ii};if(r&&!Array.isArray(r))return te({result:{error:le},info:ip("entryStatus"),stack:"removeScaleValues"});let l=a.entries;if(n){let{flightProfile:c}=Hi({event:a}),d=(s=c==null?void 0:c.flights)==null?void 0:s.find(p=>p.drawId===n);d?l=d.drawEntries:l=i==null?void 0:i.entries}let u=(l||[]).filter(c=>(!o||!c.entryStage||c.entryStage===o)&&(!r||r.includes(c.entryStatus))).map(Tt);return mCe({tournamentRecord:t,scaleAttributes:e,participantIds:u})}function VR({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=Za,event:n}){if(!e)return te({result:{error:ve}});if(!n)return te({result:{error:Ii}});if(!At(i))return te({result:{error:Qe}});if(At(i.draws))for(let o of Object.keys(i.draws)){let s=i.draws[o].scheduleDetails??[];if(s.length){let l=[];for(let u of s){let c=l.find(d=>jwe(d.attributes,u.attributes));c!=null&&c.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[o].scheduleDetails=l}}let a=kv({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...Q}}function Yee({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:o}){var s,l;if(!t)return{error:ve};if(!a)return{error:Ii};r=r||((s=a.category)==null?void 0:s.categoryName)||((l=a.category)==null?void 0:l.ageCategoryCode);let u={eventType:a.eventType,scaleType:Fl,scaleName:r};return y$({tournamentRecord:t,scaleAttributes:u,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:o})}function Kee(t){let e=We(t,[{[Ur]:!0},{eventIds:!0,[Xn]:dn}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],o=[],s=[],l=[];if(r.events=(r.events||[]).filter(u=>{if(n.includes(u.eventId)){let p={action:lS,payload:{events:[u]}};a.push(p),o.push({tournamentId:r.tournamentId,eventName:u.eventName,eventType:u.eventType,category:u.category,eventId:u.eventId,gender:u.gender})}let c=u.eventType===go?(u.entries||[]).map(({entryStatus:p,participantId:m})=>p!==Eo&&m).filter(Boolean):[],d=n.includes(u.eventId);return d?l.push(...c):s.push(...c),!d}),i){let u=l.filter(c=>!s.includes(c));r.participants=r.participants.filter(({participantId:c})=>!u.includes(c))}if(Qw({tournamentRecord:r}),a.length)if(vP(Iu)){let u=r.tournamentId;ut({topic:Iu,payload:{type:lS,tournamentId:u,detail:a}})}else zw({tournamentRecord:r,timeItem:{itemValue:o,itemType:lS}});return{...Q}}function Jee(t){var e,i,r;let n=We(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:ia}]);if(n.error)return n;let{eventUpdates:a,event:o}=t,s="modifyEvent",l=gCe(t),u=vCe({enteredParticipants:l}),{enteredParticipantGenders:c,enteredParticipantTypes:d}=u,p=(i=(e=Hi({event:o}))==null?void 0:e.flightProfile)==null?void 0:i.flights,m=!((r=o.drawDefinitions)!=null&&r.length)&&!(p!=null&&p.length),h=ICe({noFlightsNoDraws:m,enteredParticipantGenders:c,eventUpdates:a,stack:s});if(h.error)return h;let f=yCe({enteredParticipantTypes:d,eventUpdates:a,stack:s});if(f.error)return f;let g=hCe({...t,...u,enteredParticipants:l,stack:s});if(g.error)return g;let v=fCe({...t,stack:s});return v.error?v:(a.eventType&&(o.eventType=a.eventType),a.eventName&&(o.eventName=a.eventName),a.gender&&(o.gender=a.gender),{...Q})}function hCe(t){var e,i,r,n,a,o;let s=(e=t.eventUpdates)==null?void 0:e.category;if(!s)return{...Q};let l=ny({category:s});if(l.error)return l;if(t.event.eventType===cr){let u=((r=(i=t.event)==null?void 0:i.drawDefinitions)==null?void 0:r.map(p=>Gs(p)))??[],c=Gs(t.event),d=(((n=ou(t))==null?void 0:n.matchUps)??[]).map(p=>Gs(p))??[];if(![c,...u,...d].filter(Boolean).every(p=>p.collectionDefinitions.every(m=>!m.category||nw({category:t.eventUpdates.category,childCategory:m.category}))))return te({result:{error:QI},stack:t.stack})}if((a=t.enteredParticipants)!=null&&a.length){let u=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,c=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,d=t.enteredParticipants.map(h=>h.participantType===Dt?h:h.individualParticpants??[]).flat(),p=xm({category:s,consideredDate:u}),m=xm({category:s,consideredDate:c});if(p!=null&&p.ageMinDate||p!=null&&p.ageMaxDate||m!=null&&m.ageMinDate||m!=null&&m.ageMaxDate)for(let h of d){let f=(o=h.person)==null?void 0:o.birthDate;if(!f)return te({result:{error:a9},stack:t.stack});let g=new Date(f).getTime();if(p.ageMinDate||p.ageMaxDate){let v=new Date(p.ageMinDate).getTime(),y=new Date(p.ageMaxDate).getTime();if(g<v||g>y)return te({result:{error:lM},stack:t.stack})}if(m.ageMin||m.ageMax){let v=new Date(m.ageMinDate).getTime(),y=new Date(m.ageMaxDate).getTime();if(g<v||g>y)return te({result:{error:lM},stack:t.stack})}}}return{...Q}}function fCe(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=f$({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:r});if(a.error)return te({result:a,stack:n})}return{...Q}}function gCe(t){var e;let{tournamentRecord:i,event:r}=t,n=((e=r==null?void 0:r.entries)==null?void 0:e.filter(({entryStatus:a})=>{let o=a;return[...hs,Jo].includes(o)}).map(({participantId:a})=>a))??[];return n?Ai({participantFilters:{participantIds:n},withIndividualParticipants:!0,tournamentRecord:i}).participants??[]:[]}function vCe({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{var o,s;let l=(o=a.person)!=null&&o.sex?[a.person.sex]:((s=a.individualParticpants)==null?void 0:s.map(u=>{var c;return(c=u.person)==null?void 0:c.sex}))||[];return e.push(...l),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=dt(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function ICe({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||i.gender===Fs||e.length===1&&e[0]===i.gender||t&&i.gender===jn;return i.gender&&!n?te({context:{gender:i.gender,validGender:n},result:{error:nI},stack:r}):{...Q}}function yCe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(cr)&&[cr]||t.includes(Dt)&&[cl]||t.includes(gt)&&[go]||[go,cl,cr]).includes(e.eventType??"");return e.eventType&&!r?te({context:{participantType:e.eventType,validEventType:r},result:{error:ql},stack:i}):{...Q}}function jR({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){var o,s,l;let u="addFlight";if(!n)return te({result:{error:Ii},stack:u});if(!i)return te({result:{error:Qe},stack:u});if(e!=null&&e.length){let g=(n.entries??[]).map(Tt),v=e.map(Tt);if(ji(v,g).length!==v.length)return te({result:{error:le},stack:u})}let c=(o=Hi({event:n}))==null?void 0:o.flightProfile,d=((l=(s=c==null?void 0:c.flights)==null?void 0:s.map(({flightNumber:g})=>!isNaN(g)&&tt(g)))==null?void 0:l.filter(Boolean))||[],p=Math.max(0,...d)+1,m={drawId:r||Ht(),flightNumber:p,drawEntries:e,drawName:i};if(a&&(m.stage=a),t&&(m.qualifyingPositions=t),((c==null?void 0:c.flights)||[]).find(({drawId:g})=>g===m.drawId))return te({result:{error:_9},stack:u});let h=((c==null?void 0:c.flights)||[]).concat(m),f={name:os,value:{...c||{},flights:h}};return rd({event:n,extension:f})}var Xee={};wt(Xee,{drawMatic:()=>N_,garman:()=>nte,generateAdHocMatchUps:()=>fR,generateAdHocRounds:()=>M_,generateAndPopulatePlayoffStructures:()=>o_,generateCourts:()=>b$,generateDrawDefinition:()=>tU,generateDrawMaticRound:()=>b_,generateDrawStructuresAndLinks:()=>v_,generateDrawTypeAndModifyDrawDefinition:()=>I_,generateFlightProfile:()=>UCe,generateLineUps:()=>rte,generateQualifyingStructure:()=>XL,generateSeedingScaleItems:()=>Pee,generateStatCrew:()=>SCe,generateVoluntaryConsolation:()=>aZ,roundRobinGroups:()=>CTe});var bCe="splitLevelBased",Qee="splitWaterfall",Zee="splitShuttle",wCe={SPLIT_LEVEL_BASED:bCe,SPLIT_WATERFALL:Qee,SPLIT_SHUTTLE:Zee};function UCe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:m}=t;if(!p)return{error:Ii};let h=p.entries??[],{flightProfile:f}=Hi({event:p});if(f&&i&&!o)return{error:pF};let g=t.scaledEntries??Hh({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:s,event:p,stage:m}).scaledEntries,v=g.map(Tt),y=Tn(h.filter(({participantId:P})=>!v.includes(P)).filter(P=>(!m||!P.entryStage||P.entryStage===m)&&(!P.entryStatus||Ap.includes(P.entryStatus)))),I=g.concat(...y),b=I.length,S=Math.ceil(b/u),w=Cr(I,S);c===Qee?w=eM(I,u):c===Zee&&(w=eM(I,u,!0));function U(P){return(P||[]).map(({participantId:E,scaleValue:R})=>{let N=h.find(A=>A.participantId===E);return N!=null&&N.scaleValue&&R&&(N.scaleValue=R),N}).sort((E,R)=>E.scaleValue-R.scaleValue).map((E,R)=>(E.scaleValue&&(E.seedNumber=R+1),E))}let T=De(0,u).map(P=>{let E=P+1;return{flightNumber:E,drawId:(d==null?void 0:d.pop())??Ht(),drawEntries:U(w[P]),drawName:(l==null?void 0:l.length)&&l[P]||`${e} ${E}`}}),D={scaleAttributes:n,splitMethod:c,flights:T};if(i){let P=I$({flightProfile:D,deleteExisting:o,event:p});return{splitEntries:Ga()&&w||void 0,...P}}else return{flightProfile:D,...Q}}function ete({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(o=>typeof o=="object"&&Object.keys(o).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return tte({tagName:e,attributes:n,childArrays:i,childObjects:r})}function tte(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,o=m=>{let h=Object.keys(m)[0],f=m[h];return{key:h,value:f}},s=r==null?void 0:r.map(({key:m,value:h})=>tte({tagName:m,childObjects:h.map(o)})).join(`\r
`),l=n==null?void 0:n.map(({key:m,value:h})=>ete({tagName:m,json:h??[]})).join(`\r
`),u=i==null?void 0:i.map(({key:m,value:h})=>`${m}="${h}"`).join(" "),c=u?` ${u}`:"";if(e==="childArray")return l;let d=l!=null&&l.length?`${a}${l}${a}`:"",p=s!=null&&s.length?`${a}${s}${a}`:"";return`<${e}${c}>${d}${p}</${e}>`}function SCe(t){var e,i,r;let n=We(t,[{[Ur]:!0}]);if(n.error)return n;let{tournamentRecord:a}=t,{startDate:o,tournamentId:s,tournamentName:l}=a,{participantMap:u,matchUps:c,mappedMatchUps:d}=Ai({withMatchUps:!0,withEvents:!0,tournamentRecord:a}),p=a.participants.filter(w=>w.participantType===Jt),m=(c==null?void 0:c.filter(w=>w.matchUpType===Jt))??[],h=(m==null?void 0:m.reduce((w,U)=>{let T=(U==null?void 0:U.tieMatchUps)??[];return T&&[...w,...T]},[]))??[],f=(c==null?void 0:c.filter(w=>w.matchUpType===ri))??[],g=(c==null?void 0:c.filter(w=>w.matchUpType===ei))??[],v=h.length===f.length+g.length,y=m.length===1&&v,I={mappedMatchUps:d,participantMap:u,tournamentName:l,tournamentId:s,tournament:v?"N":"Y",startDate:o},b=[],S=[];if(y){let w=m[0],{json:U,xml:T}=rj({teamParticipants:p,teamMatchUp:w,...I,doubles:g,singles:f});S.push(U),b.push(T)}else for(let w of m){let U=(e=w==null?void 0:w.sides)==null?void 0:e.map(({participant:E})=>E==null?void 0:E.participantId).filter(Boolean);if((U==null?void 0:U.length)!==2)continue;let T=U.map(E=>{var R;return E&&((R=u==null?void 0:u[E])==null?void 0:R.participant)}),{xml:D,json:P}=rj({doubles:(i=w.tieMatchUps)==null?void 0:i.filter(E=>E.matchUpType===ei),singles:(r=w.tieMatchUps)==null?void 0:r.filter(E=>E.matchUpType===ri),teamParticipants:T,teamMatchUp:w,...I});S.push(P),b.push(D)}return{json:S,xml:b,...Q}}function rj({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:o,startDate:s,doubles:l,singles:u}){var c,d,p,m;let h=t==null?void 0:t.find(T=>{var D;return(D=T.participantRoleResponsibilities)==null?void 0:D.includes("Home")}),f=t==null?void 0:t.filter(T=>T.participantId!==(h==null?void 0:h.participantId)),g=qo(s,"/","MDY"),v=(h==null?void 0:h.participantName)||((c=f==null?void 0:f[1])==null?void 0:c.participantName),y=(h==null?void 0:h.participantId)||((d=f==null?void 0:f[1])==null?void 0:d.participantId),I=(p=f==null?void 0:f[0])==null?void 0:p.participantName,b=(m=f==null?void 0:f[0])==null?void 0:m.participantId,S={},w=t.map(T=>({team:{...PCe({teamParticipant:T,teamMatchUp:a,uniValues:S,participantMap:i,mappedMatchUps:e,homeid:y})}})),U=Ge({venue:{tournamentname:o?r:void 0,neutralgame:h?"N":"Y",gameid:n,officials:{},tournament:o,rules:{},homename:v,visname:I,homeid:y,visid:b,date:g},childArray:w,singles_matches:u==null?void 0:u.map(T=>nj({matchUp:T,homeid:y,uniValues:S})),doubles_matches:l==null?void 0:l.map(T=>nj({matchUp:T,homeid:y,uniValues:S}))});return{json:U,xml:ete({json:U,tagName:"tngame"})}}function TCe({homeid:t,uniValues:e,participant:i}){var r,n,a,o,s,l,u,c,d,p,m,h,f,g,v;if(!i)return{};let y=((r=i.individualParticipants)==null?void 0:r.length)===2,I=y?dt((n=i.individualParticipants)==null?void 0:n.map(A=>{var M,C;return(C=(M=A.teams)==null?void 0:M[0])==null?void 0:C.participantId})):[],b=y?dt((a=i.individualParticipants)==null?void 0:a.map(A=>{var M,C;return(C=(M=A.teams)==null?void 0:M[0])==null?void 0:C.teamId})):[],S=!y&&((s=(o=i.teams)==null?void 0:o[0])==null?void 0:s.participantId)||(I==null?void 0:I.length)===1&&I[0]||void 0,w=!y&&((u=(l=i.teams)==null?void 0:l[0])==null?void 0:u.teamId)||(b==null?void 0:b.length)===1&&b[0]||S,U=y?void 0:i.participantName,T=(d=(c=i.individualParticipants)==null?void 0:c[0])==null?void 0:d.participantName,D=(m=(p=i.individualParticipants)==null?void 0:p[1])==null?void 0:m.participantName,P=t&&(S===t?"H":"V")||"",E=y?void 0:e[S][i.participantId],R=e[S][(f=(h=i.individualParticipants)==null?void 0:h[0])==null?void 0:f.participantId],N=e[S][(v=(g=i.individualParticipants)==null?void 0:g[1])==null?void 0:v.participantId];return Ge({vh:P,uni:E,uni_1:R,uni_2:N,team:w,name:U,name_1:T,name_2:D})}function DCe({sets:t,sideNumber:e}){return Object.assign({},...(t==null?void 0:t.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s}=i,l=`set_${r}`,u=`tie_${r}`,c=e===1?n:a,d=e===1?o:s;return{[l]:c,[u]:d}}))??[])}function PCe({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){var o,s,l,u,c,d,p,m,h,f,g,v,y,I;let{participantId:b,participantName:S}=t,w=n&&(b===n?"H":"V")||"",U=(o=i==null?void 0:i[b])==null?void 0:o.matchUps,T=U&&Object.keys(U),D=(l=(s=e==null?void 0:e.sides)==null?void 0:s.find(({participant:k})=>k.participantId===b))==null?void 0:l.sideNumber,P=((d=(c=(u=e==null?void 0:e.score)==null?void 0:u.sets)==null?void 0:c[0])==null?void 0:d[`side${D}Score`])??0;a[b]={};let E={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},R=[],N=[],A=0;for(let k of T??[]){let x=r==null?void 0:r[k],F=(p=x.sides.find(({participant:_})=>_.participantId===b))==null?void 0:p.sideNumber,$=((f=(h=(m=x.score)==null?void 0:m.sets)==null?void 0:h[0])==null?void 0:f[`side${F}Score`])??0;A+=$;for(let _ of x.tieMatchUps??[]){let{matchUpType:L,winningSide:B}=_,V=B&&(B===F?"w":"l")||"";V&&(E[L][V]+=1);let G=V==="w"?"1":"0",j=V==="l"?"1":"0";if(L===ri){let z=N.length+1;N.push({singles_pair:{pair:z,won:G,lost:j,tied:"0"}})}else if(L===ei){let z=R.length+1;R.push({doubles_pair:{pair:z,won:G,lost:j,tied:"0"}})}}}let M=[{singles:{childArray:N,won:E.SINGLES.w,lost:E.SINGLES.l}},{doubles:{childArray:R,won:E.DOUBLES.w,lost:E.DOUBLES.l}}],C=[],O=1;for(let k of t.individualParticipantIds){let x=i==null?void 0:i[k];if(x){let{participant:F,counters:$}=x,_={won:((g=$==null?void 0:$.DOUBLES)==null?void 0:g.wins)||0,lost:((v=$==null?void 0:$.DOUBLES)==null?void 0:v.losses)||0},L={won:((y=$==null?void 0:$.SINGLES)==null?void 0:y.wins)||0,lost:((I=$==null?void 0:$.SINGLES)==null?void 0:I.losses)||0},{participantName:B,participantId:V}=F;a[b][V]=O,C.push({player:{name:B,uni:O,singles:L,doubles:_}})}O+=1}return{vh:w,id:b,name:S,score:P||A,totals:M,childArray:C}}function nj({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:o}=t??{},s=o==null?void 0:o.map(l=>{var u;let{sideNumber:c,participant:d}=l,p=DCe({sets:(u=t.score)==null?void 0:u.sets,sideNumber:c});return{[a===ri?"singles_score":"doubles_score"]:{...TCe({homeid:e,uniValues:i,participant:d}),...p}}});return{[a===ri?"singles_match":"doubles_match"]:{match:r,order:n,childArray:s}}}var RCe="ASC",ite="ASC",ECe="DESC",YM="DESC",CCe={ASC:RCe,ASCENDING:ite,DESC:ECe,DESCENDING:YM};function rte(t){var e,i,r,n,a;let{tieFormat:o}=t,{useDefaultEventRanking:s,tournamentRecord:l,drawDefinition:u,scaleAccessor:c,singlesOnly:d,attach:p,event:m}=t;if((m==null?void 0:m.eventType)!==Ca)return{error:ql};if(!l)return{error:ve};if(!o&&!u)return{error:ja};if(o=o??((e=In({drawDefinition:u,event:m}))==null?void 0:e.tieFormat),qn({tieFormat:o}).error)return{error:xl};if(typeof c!="object"&&!s)return{error:le,context:{scaleAccessor:c}};let h={},f=((u==null?void 0:u.entries)??(m==null?void 0:m.entries)??[]).filter(C=>(C==null?void 0:C.entryStatus)===da).map(Tt),{participants:g=[]}=Ai({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:l}),v=g.filter(({participantId:C})=>f.includes(C)),y=C=>C===Ac?"rankings":"ratings",I=((i=m==null?void 0:m.category)==null?void 0:i.categoryName)??((r=m==null?void 0:m.category)==null?void 0:r.ageCategoryCode),{scaleName:b=I,scaleType:S=Ac,sortOrder:w,accessor:U}=c||{},T=y(S),D=(C,O)=>{var k,x,F;let $=(k=C[T])==null?void 0:k[O];if(!$&&s&&($=(x=C[T])==null?void 0:x[cm]),Array.isArray($)){let _=(F=$.find(L=>L.scaleName===b))==null?void 0:F.scaleValue;if(xi(_))return _;if(U&&typeof _=="object")return _[U]}return 0},P=(C,O,k)=>{let x=w===YM?O:C,F=w===YM?C:O;return D(x,k)-D(F,k)},E=(C,O)=>P(C,O,cm),R=(C,O)=>P(C,O,Wd),N=[],A=(o==null?void 0:o.collectionDefinitions)??[];for(let C of v){let O=((n=C.individualParticipants)==null?void 0:n.sort(E))??[],k=d?O:((a=C.individualParticipants)==null?void 0:a.sort(R))??[],x={};for(let $ of A){let _=[],{collectionId:L,matchUpCount:B,matchUpType:V,gender:G}=$,j=Ji(cm)(V);De(0,B).forEach(z=>{let W=j?O:k??[],q=z+1,Y=[];De(0,j?1:2).forEach(re=>{var J;let H=(J=W==null?void 0:W.find(Z=>{var K;let ie=G&&([Qt,hi].includes(G)&&G||G===jn&&[Qt,hi][re]);return(!ie||ie===((K=Z.person)==null?void 0:K.sex))&&!_.includes(Z.participantId)}))==null?void 0:J.participantId;H&&(Y.push(H),_.push(H),x[H]||(x[H]=[]),x[H].push({collectionPosition:q,collectionId:L}))}),j||N.push(Y)})}let F=Object.keys(x).map($=>({collectionAssignments:x[$],participantId:$}));h[C.participantId]=F}let M=[];for(let C of N){let{participant:O}=ls({tournamentParticipants:g,participantIds:C});if(!O){let k={individualParticipantIds:C,participantRole:en,participantType:gt};M.push(k)}}if(p){for(;M.length;)fl({participant:M.pop(),tournamentRecord:l});_t({element:u,extension:{name:Lu,value:h}})}return{...Q,lineUps:h,participantsToAdd:M}}function b$(t){if(!t)return{error:Qe};let e=We(t,[{dates:!1,[Jr]:o=>Array.isArray(o)&&o.every(wa)},{uuids:!1,[Jr]:o=>Array.isArray(o)&&o.every(Pi)},{startTime:!1,endTime:!1,[Jr]:UF},{idPrefix:!1,namePrefix:!1,[Jr]:Pi},{count:!0,[Jr]:xi}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&ig(i,r)||[],a=De(1,t.count+1).map(o=>{var s,l;return Ge({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${o}`)??Ht(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${o}`),dateAvailability:n.map(u=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:u}))})});return{...Q,courts:a}}var nte={};wt(nte,{default:()=>ACe,garman:()=>ste});function rU({court:t,date:e}){let i=e&&t.dateAvailability.find(n=>Yl(n.date,e)),r=t.dateAvailability.find(n=>!n.date);return i||r}function Fv(t){let e=We(t,[{courtDate:!0,_ofType:ia}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=nr(r.startTime);(r.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>t0(s.startTime).localeCompare(t0(l.startTime))).forEach(s=>{let l={startTime:Si(a.toISOString()),endTime:s.startTime};nr(s.startTime)>a&&n.push(l),nr(s.endTime)>a&&(a=nr(s.endTime))});let o={startTime:Si(a.toISOString()),endTime:r.endTime};return nr(r.endTime)>a&&n.push(o),{timeSlots:n}}function MCe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=o=>{var s;let{timeSlots:l}=Fv({includeBookingTypes:e,courtDate:o});return!!((s=l==null?void 0:l.filter(a))!=null&&s.length)};function a(o){let s=nr(o.startTime),l=nr(o.endTime);return s>i||l<r?!1:rw(i,l)>=t}return{enoughTime:n}}function ate(t){let e=We(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:dn}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,o=t.courts,s=nr(n),l=TF(s,i),{enoughTime:u}=MCe({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((o==null?void 0:o.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=rU({date:a,court:c});return!!(d&&u(d))}))||[]).length,...Q}}function GR(t){var e;let{remainingScheduleTimes:i=[],clearScheduleDates:r,periodLength:n=30,scheduleDate:a,courts:o=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(o)||!o.length)return{error:le,courts:o};if(!Array.isArray(s))return{error:XS};if(!wa(a))return{error:Fr};r&&(Array.isArray(r)?r.includes(a)&&(s=[]):s=[]);let{courtBookings:l,unassignedBookings:u}=s.reduce((m,h)=>{let{courtId:f}=h;return f?m.courtBookings[f]?m.courtBookings[f].push(h):m.courtBookings[f]=[h]:m.unassignedBookings.push(h),m},{courtBookings:{},unassignedBookings:[]}),c=o.map((m,h)=>{let{courtId:f,courtName:g}=m,v=l[f]||[],y=rU({date:a,court:m})||{},{bookings:I=[],startTime:b,endTime:S,date:w}=y,U=[i[h]&&{startTime:b,endTime:i[h]},...Me(I,!1,!0),...v].filter(Boolean);return{courtId:f,courtName:g,dateAvailability:{bookings:U,startTime:b,endTime:S,date:w}}});u.sort((m,h)=>kt(m.startTime)-kt(h.startTime));let d=()=>c.map(m=>{let h=m.dateAvailability,{timeSlots:f=[]}=Fv({courtDate:h});return{courtName:m.courtName,courtId:m.courtId,timeSlots:f}}).flat(),p=[];for(let m of u){let{startTime:h,endTime:f,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=m,I=kt(h),b=kt(f),S=d().reduce((w,{courtId:U,courtName:T,timeSlots:D})=>{let P;return D.find(({startTime:E,endTime:R})=>{P=kt(E)-I;let N=I>=kt(E);return b<=kt(R)&&w.startDifference!==0&&((P===0||P+n>=0)&&(w.startDifference===void 0||P<w.startDifference)||N)})?{courtName:T,courtId:U,startDifference:P}:w},{});if(S.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:h,endTime:f};p.push(w),(e=c.find(({courtId:U})=>U===S.courtId))==null||e.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:m})}return{virtualCourts:c.map(({courtId:m,courtName:h,dateAvailability:f})=>({dateAvailability:[f],courtName:h,courtId:m})),assignedBookings:p}}function HR({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function ote(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return De(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function bg({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,o)=>{let s=rU({date:t,court:o}),l=n&&((s==null?void 0:s[n])||o[n]);return l&&(!a||e&&kt(l)<kt(a)||i&&kt(l)>kt(a))?l:a},void 0)}function NCe({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||bg({courts:r,scheduleDate:n,startTime:!0}),i=i||bg({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let o=nr(e),s=nr(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let u=rU({court:l,date:n}),{timeSlots:c}=Fv({courtDate:u});c==null||c.forEach(d=>{let p=nr(d.startTime),m=nr(d.endTime);if(p>s||p<o||m<o)return!1;if(rw(p,m)>=t){let h=Si(p.toISOString());(!a||h<a)&&(a=h)}})}}return{firstTimeSlotStartTime:a}}function w$(t){let e=We(t,[{courts:!0,_ofType:dn}]);if(e.error)return e;let{date:i=wF(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:o}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||HR({averageMatchUpMinutes:u}),i=ht(i),r=Si(r),n=Si(n);let m=0,h=0,f=0,g=0,v=0;!o&&d&&(o=ote({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:y}=GR({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:I}=NCe({averageMinutes:u,courts:y,startTime:r,endTime:n,date:i});s&&I&&(r=I??r);let b=kt(r),S=kt(n)-b,w=Math.floor(S/a),U=De(0,w+1).map(T=>{let D=b+T*a,P=zUe(D),E=ate({courts:y??[],averageMatchUpMinutes:u,periodStart:P,date:i});if(E.error)return{error:E.error};let{availableToScheduleCount:R=0}=E,N=R>h?R-h:0;v+=T?R:0;let A=T?v/T:R,M=a*A/u,C=T?M*(T-1)+A:A,O=R?h&&C-m||N:0;m=C,h=R,f+=O;let k=tt(f)-g;return g+=k,{periodStart:P,add:k,availableToScheduleCount:R,newCourts:N,totalMatchUps:g}});return{scheduleTimes:U.reduce((T,D)=>{let P=De(0,D.add).map(()=>({scheduleTime:D.periodStart}));return T.concat(...P)},[]).flat(),timingProfile:U,totalMatchUps:g}}var ste={getCourtsAvailableAtPeriodStart:ate,generateTimeSlots:Fv,getScheduleTimes:w$,courtGenerator:ote},ACe=ste,lte={};wt(lte,{isValid:()=>Ea,isValidMatchUpFormat:()=>Ea,parse:()=>Ln,stringify:()=>wP});var ute={};wt(ute,{allCompetitionMatchUps:()=>Ls,allDrawMatchUps:()=>Pn,allEventMatchUps:()=>ou,allTournamentMatchUps:()=>Hr,analyzeMatchUp:()=>Uy,applyLineUps:()=>Ate,assignMatchUpSideParticipant:()=>dte,assignTieMatchUpParticipantId:()=>T0,bulkMatchUpStatusUpdate:()=>Ete,calculateWinCriteria:()=>Wh,checkInParticipant:()=>S$,checkMatchUpIsComplete:()=>Cd,checkOutParticipant:()=>U$,competitionScheduleMatchUps:()=>eU,disableTieAutoCalc:()=>Dte,drawMatchUps:()=>a$,enableTieAutoCalc:()=>Ute,eventMatchUps:()=>FR,filterMatchUps:()=>mu,findMatchUp:()=>G_,getAllDrawMatchUps:()=>gr,getAllStructureMatchUps:()=>qt,getCheckedInParticipantIds:()=>xh,getCompetitionMatchUps:()=>wy,getEventMatchUpFormatTiming:()=>J_,getHomeParticipantId:()=>e$,getMatchUpCompetitiveProfile:()=>Tw,getMatchUpContextIds:()=>t$,getMatchUpDailyLimits:()=>_R,getMatchUpDailyLimitsUpdate:()=>X_,getMatchUpDependencies:()=>fs,getMatchUpFormat:()=>i$,getMatchUpFormatTiming:()=>Dw,getMatchUpFormatTimingUpdate:()=>K_,getMatchUpScheduleDetails:()=>JP,getMatchUpType:()=>XP,getMatchUpsStats:()=>r$,getModifiedMatchUpFormatTiming:()=>xR,getParticipantResults:()=>jw,getPredictiveAccuracy:()=>Z_,getRoundMatchUps:()=>An,getRounds:()=>n$,isValidMatchUpFormat:()=>Ea,matchUpActions:()=>mR,mutate:()=>cte,participantScheduledMatchUps:()=>Q_,query:()=>yee,removeDelegatedOutcome:()=>Ste,removeMatchUpSideParticipant:()=>P$,removeTieMatchUpParticipantId:()=>mte,replaceTieMatchUpParticipantId:()=>D$,resetAdHocMatchUps:()=>Mte,resetMatchUpLineUps:()=>O$,resetScorecard:()=>x$,resetTieFormat:()=>k$,setDelegatedOutcome:()=>Cte,setMatchUpFormat:()=>Pte,setMatchUpStatus:()=>aU,setOrderOfFinish:()=>Nte,substituteParticipant:()=>Tte,tallyParticipantResults:()=>Mv,toggleParticipantCheckInState:()=>zR,tournamentMatchUps:()=>LR,updateTieMatchUpScore:()=>rc,validMatchUp:()=>zP,validMatchUps:()=>Co});var cte={};wt(cte,{applyLineUps:()=>Ate,assignMatchUpSideParticipant:()=>dte,assignTieMatchUpParticipantId:()=>T0,bulkMatchUpStatusUpdate:()=>Ete,checkInParticipant:()=>S$,checkOutParticipant:()=>U$,disableTieAutoCalc:()=>Dte,enableTieAutoCalc:()=>Ute,findMatchUp:()=>G_,removeDelegatedOutcome:()=>Ste,removeMatchUpSideParticipant:()=>P$,removeTieMatchUpParticipantId:()=>mte,replaceTieMatchUpParticipantId:()=>D$,resetAdHocMatchUps:()=>Mte,resetMatchUpLineUps:()=>O$,resetScorecard:()=>x$,resetTieFormat:()=>k$,setDelegatedOutcome:()=>Cte,setMatchUpFormat:()=>Pte,setMatchUpStatus:()=>aU,setOrderOfFinish:()=>Nte,substituteParticipant:()=>Tte,toggleParticipantCheckInState:()=>zR,updateTieMatchUpScore:()=>rc});function dte({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){var o,s;if(i&&typeof i!="string")return{error:ks};if(!e)return{error:_e};if(!n)return{error:bn};let l=r===void 0;if(l&&(r=1),![1,2].includes(r))return te({result:{error:le,context:{sideNumber:r}}});let{matchUp:u,structure:c}=Ti({drawDefinition:e,matchUpId:n,event:a});if(!u)return{error:fn};if(!(!(c!=null&&c.structures)&&!(e.drawType&&e.drawType!==Ha)&&!((o=c==null?void 0:c.matchUps)!=null&&o.find(({roundPosition:d})=>!!d))))return{error:zx};if(!i&&((s=u==null?void 0:u.score)!=null&&s.scoreStringSide1||yr.includes(u==null?void 0:u.matchUpstatus)||u!=null&&u.matchUpStatus&&[ir,pr].includes(u.matchUpStatus)))return{error:lP,info:"matchUp has completed status or score"};if(u){if(u.sides=[1,2].map(d=>{var p;let m=((p=u.sides)==null?void 0:p.find(h=>h.sideNumber===d))??{sideNumber:d};return r===d?{...m,participantId:i}:m}),l)for(let d of u.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);Et({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:u})}return{...Q,sidesSwapped:l}}function Aa({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=Ti({drawDefinition:r,event:s,matchUpId:a});if(!l)return{error:fn};let u=Tl({removePriorValues:t,element:l,duplicateValues:i,timeItem:o});return n||Et({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),u}function U$(t){var e;let i=[{[Ur]:!0},{[$n]:!0},{[Xl]:!0},{[wl]:!0}],r=We(t,i);if(r.error)return r;let n=Av(t,[{[vv]:nu,attr:{[CP]:!0}}]);if(n.error)return n;let{tournamentRecord:a,drawDefinition:o,participantId:s,matchUpId:l}=t,u=(e=n==null?void 0:n.matchUp)==null?void 0:e.matchUp,{matchUpStatus:c,score:d}=u??{};if(c&&qF.includes(c)||c&&yr.includes(c)||br({score:d}))return{error:GK};let p=xh({matchUp:u});if(p!=null&&p.error)return p;let{checkedInParticipantIds:m,allRelevantParticipantIds:h}=p??{};if(!(h!=null&&h.includes(s)))return{error:ks};if(!(m!=null&&m.includes(s)))return{error:v9};let f=qJ({matchUp:u});if(f!=null&&f.error)return f;let{sideParticipantIds:g,nestedIndividualParticipantIds:v}=f??{},y=g==null?void 0:g.indexOf(s);return y!==void 0&&[0,1].includes(y)&&((v==null?void 0:v[y])??[]).forEach(I=>{Aa({drawDefinition:o,matchUpId:l,timeItem:{itemType:u0,itemValue:I}})}),Aa({tournamentRecord:a,drawDefinition:o,matchUpId:l,timeItem:{itemValue:s,itemType:u0}}),{...Q,checkedOut:!0}}function S$(t){var e;let i=[{[Ur]:!0},{[$n]:!0},{[Xl]:!0},{[wl]:!0}],r=We(t,i);if(r[Ko])return r;let n=Av(t,[{[vv]:nu,attr:{[CP]:!0}}]);if(n[Ko])return n;let{tournamentRecord:a,drawDefinition:o,participantId:s,matchUpId:l}=t,u=xh({matchUp:(e=n==null?void 0:n.matchUp)==null?void 0:e.matchUp});if(u!=null&&u.error)return u;let{checkedInParticipantIds:c,allRelevantParticipantIds:d}=u??{};if(!(d!=null&&d.includes(s)))return{[Ko]:ks};let p={...Q,checkedIn:!0};return c!=null&&c.includes(s)||Aa({tournamentRecord:a,drawDefinition:o,matchUpId:l,timeItem:{itemValue:s,itemType:l0}}),p}function zR(t){var e,i;let r=We(t,[{[Xl]:!0,[$n]:!0,[wl]:!0}]);if(r.error)return r;let n=t.tournamentId??t.activeTournamentId,a=t.tournamentRecord??(n&&((e=t.tournamentRecords)==null?void 0:e[n]));if(!a)return{error:ve};let o=(i=Av(t,[{[vv]:nu,attr:{[CP]:!0},[Ko]:fn}]).matchUp)==null?void 0:i.matchUp;if(!o)return{error:fn};let{checkedInParticipantIds:s=[]}=xh({matchUp:o}),{participantId:l,matchUpId:u,drawDefinition:c}=t;return l&&s.includes(l)?U$({tournamentRecord:a,drawDefinition:c,participantId:l,matchUpId:u,matchUp:o}):S$({tournamentRecord:a,drawDefinition:c,participantId:l,matchUpId:u,matchUp:o})}function T$({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){var n,a;if(!t)return{error:ve};if(!e)return{error:Bs};if(!r)return{error:fo};let o=ln({drawDefinition:e}),{matchUp:s}=Ti({matchUpId:i,drawDefinition:e,matchUpsMap:o});if(!s)return{error:fn};let{matchUp:l,structure:u}=Ti({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:o,event:r});if(!l)return{error:fn};let{collectionPosition:c,drawPositions:d,collectionId:p,matchUpTieId:m,matchUpType:h}=l;if(h&&!iP([ri,ei],h))return{error:ua};let{positionAssignments:f}=si({structure:u}),g=f==null?void 0:f.filter(T=>d==null?void 0:d.includes(T.drawPosition)),{matchUp:v}=Ti({matchUpId:m,drawDefinition:e,matchUpsMap:o}),y=((n=v==null?void 0:v.sides)==null?void 0:n.map(Tt))??[],I=(g==null?void 0:g.map(Tt))??[],b=[...y,...I],{participants:S}=Ai({tournamentRecord:t,participantFilters:{participantTypes:[Jt],participantIds:b}}),{matchUp:w}=Ti({matchUpId:m,inContext:!0,drawDefinition:e,matchUpsMap:o}),U=(a=In({matchUp:v,drawDefinition:e,structure:u,event:r}))==null?void 0:a.tieFormat;return{inContextDualMatchUp:w,inContextTieMatchUp:l,relevantAssignments:g,collectionPosition:c,teamParticipants:S,collectionId:p,matchUpType:h,dualMatchUp:v,tieMatchUp:s,tieFormat:U,structure:u,...Q}}function D$(t){var e,i,r,n,a,o,s,l,u,c,d,p,m,h,f,g;let v=T$(t);if(v.error)return v;let y="replaceTieMatchUpParticipantid",{existingParticipantId:I,tournamentRecord:b,newParticipantId:S,drawDefinition:w,substitution:U,event:T}=t;if(!I||!S)return te({result:{error:fr},stack:y});if(I===S)return{...Q};let{inContextDualMatchUp:D,inContextTieMatchUp:P,collectionPosition:E,collectionId:R,dualMatchUp:N,tieMatchUp:A,tieFormat:M}=v,C=P==null?void 0:P.matchUpType,O=(e=P==null?void 0:P.sides)==null?void 0:e.find(H=>{var Z,K,ie;return((Z=H.participant)==null?void 0:Z.participantId)===I||((ie=(K=H.participant)==null?void 0:K.individualParticipantIds)==null?void 0:ie.includes(I))});if(!O)return{error:Wi};let k=((i=Ai({tournamentRecord:b,participantFilters:{participantIds:[I,S]}}))==null?void 0:i.participants)??[];if(k.length!==2)return te({result:{error:fr},stack:y});if(k[0].participantType!==k[1].participantType)return te({result:{error:xs},stack:y});let{appliedPolicies:x}=Bt({tournamentRecord:b,drawDefinition:w,event:T}),F=((r=t.policyDefinitions)==null?void 0:r[_r])??(x==null?void 0:x[_r])??Pv[_r],$=k.find(({participantId:H})=>H===S);if((t.enforceGender??((n=F==null?void 0:F.participants)==null?void 0:n.enforceGender))!==!1&&[Qt,hi].includes(P==null?void 0:P.gender)&&(P==null?void 0:P.gender)!==((a=$==null?void 0:$.person)==null?void 0:a.sex))return{error:Uh,info:"Gender mismatch"};let _=(o=F==null?void 0:F.processCodes)==null?void 0:o.substitution;Hw({tournamentId:b.tournamentId,eventId:T.eventId,inContextDualMatchUp:D,drawDefinition:w,dualMatchUp:N});let L=(s=N==null?void 0:N.sides)==null?void 0:s.find(({sideNumber:H})=>H===O.sideNumber);if(!L)return te({result:{sideNumber:O.sideNumber,existingParticipantId:I,error:jr},stack:y});if((u=(l=P==null?void 0:P.sides)==null?void 0:l.flatMap(H=>{var Z,K;return((Z=H.participant)==null?void 0:Z.individualParticipantIds)||((K=H.participant)==null?void 0:K.participantId)||[]}))!=null&&u.includes(S))return te({result:{error:cP},stack:y});let B=(d=(c=D==null?void 0:D.sides)==null?void 0:c.find(({sideNumber:H})=>H===O.sideNumber))==null?void 0:d.participantId,V=L.lineUp,G=V==null?void 0:V.find(({participantId:H})=>S===H),j=V==null?void 0:V.reduce((H,Z)=>Z.substitutionOrder>H?Z.substitutionOrder:H,0),z=(V==null?void 0:V.map(H=>{var Z;let K=Me(H,!1,!0);if(![I,S].includes(K.participantId))return K;if(!U&&[I,S].includes(K.participantId)&&(K.collectionAssignments=(Z=K.collectionAssignments)==null?void 0:Z.filter(ie=>!(ie.collectionPosition===E&&ie.collectionId===R))),U&&I===K.participantId&&(K.collectionAssignments=K.collectionAssignments.map(ie=>ie.collectionPosition===E&&ie.collectionId===R&&ie.substitutionOrder===void 0?{...ie,substitutionOrder:j}:ie)),K.participantId===S){K.collectionAssignments||(K.collectionAssignments=[]);let ie={collectionId:R,collectionPosition:E};U&&(ie.previousParticipantId=I,ie.substitutionOrder=(j??0)+1),K.collectionAssignments.push(ie)}return K}))??[];if(!G){let H={collectionId:R,collectionPosition:E};U&&(H.substitutionOrder=(j??0)+1,H.previousParticipantId=I);let Z={collectionAssignments:[H],participantId:S};z.push(Z)}let W=C===ei,{assignedParticipantIds:q}=c0({lineUp:V,collectionPosition:E,collectionId:R}),{assignedParticipantIds:Y}=c0({lineUp:z,collectionPosition:E,collectionId:R});if(L.lineUp=z,B&&M){let H=jh({participantId:B,lineUp:z,drawDefinition:w,tieFormat:M});if(H.error)return te({result:H,stack:y})}else console.log("team participantId not found");let re,J;if(W){let{tournamentRecord:H}=t,Z=ls({participantIds:Y,tournamentRecord:H});if(!Z.participant){let ie=fl({returnParticipant:!0,pairOverride:!0,tournamentRecord:H,participant:{participantRole:en,individualParticipantIds:Y,participantType:gt}});if(ie.error)return te({result:ie,stack:y});re=(p=ie.participant)==null?void 0:p.participantId}Z=ls({participantIds:q,tournamentRecord:H});let K=(m=Z.participant)==null?void 0:m.participantId;K&&Bh({participantIds:[K],tournamentRecord:H}).success&&(J=K)}if(U||((h=O.substitutions)==null?void 0:h.length)===1){if(U)_&&A&&(A.processCodes=dt([...(A==null?void 0:A.processCodes)??[],..._]));else for(let H of _||[]){let Z=(f=A==null?void 0:A.processCodes)==null?void 0:f.lastIndexOf(H);Z!==void 0&&((g=A==null?void 0:A.processCodes)==null||g.splice(Z,1))}A&&Et({tournamentId:b==null?void 0:b.tournamentId,matchUp:A,context:y,drawDefinition:w})}return N&&Et({tournamentId:b==null?void 0:b.tournamentId,matchUp:N,context:y,drawDefinition:w}),{...Q,modifiedLineUp:z,participantRemoved:J,participantAdded:re}}function pte({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){var o;if(!a||!t||!Array.isArray(n))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:le};let s=(i==null?void 0:i.lineUp)||((o=ep({participantId:e,drawDefinition:r}))==null?void 0:o.lineUp),l=[],u=[];return{modifiedLineUp:(s==null?void 0:s.map(c=>{var d;if(!n.includes(c.participantId))return c;let p=(d=c.collectionAssignments)==null?void 0:d.filter(m=>{let h=m.collectionId===a&&m.collectionPosition===t;return h&&(m.previousParticipantId&&l.push(m.previousParticipantId),u.push({participantId:c.participantId,...m})),!h});return{participantId:c.participantId,collectionAssignments:p}}).filter(Boolean))||[],assignmentsRemoved:u,previousParticipantIds:l}}function OCe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var r,n;let a=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===cr&&((l=s==null?void 0:s.entries)==null?void 0:l.some(u=>u.participantId===e))}),o=s=>!t.includes(s.participantId);for(let s of a){s.entries=(s.entries||[]).filter(o);let{flightProfile:l}=Hi({event:s});(r=l==null?void 0:l.flights)==null||r.forEach(u=>{u.drawEntries=(u.drawEntries||[]).filter(o)}),(n=s==null?void 0:s.drawDefinitions)==null||n.forEach(u=>{u.entries=(u.entries||[]).filter(o)})}return{...Q}}function WR({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return te({result:{error:ve},stack:n});if(!e||!t)return te({result:{error:Qe},stack:n});let a=r.participants??[],o=a.find(d=>d.participantId===e);if(!o)return te({result:{error:Wi},stack:n});if(o!=null&&o.participantType&&![Jt,Qa].includes(o.participantType))return te({context:{participantType:o.participantType},result:{error:xs},stack:n});let s=t.filter(d=>{var p;return((p=a.find(m=>m.participantId===d))==null?void 0:p.participantType)!==Dt});if(s.length)return te({result:{error:ba,invalidParticipantIds:s},stack:n});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&eR({individualParticipantIds:u,tournamentRecord:r}),o.individualParticipantIds=o.individualParticipantIds.concat(...u));let{topics:c}=Do();if(c.includes(on)){let d=a.find(({participantId:p})=>p===e);ut({topic:on,payload:{participants:[d]}})}return OCe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:Me(o,!1,!0),added:u.length,...Q}}function qR(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:o}=t;if(!n)return{error:ve};if(!o)return{error:Sh};if(!o.participantId)return fl({tournamentRecord:n,participant:o});let{participant:s}=ad({participantId:o.participantId,tournamentRecord:n});if(!s)return fl({tournamentRecord:n,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:m,onlineResources:h,contacts:f,person:g}=o;if(m&&s.participantType!==m)return{error:d9};let v={};if(f&&(v.contacts=f),h&&(v.onlineResources=h),c&&Pi(c)&&(v.participantOtherName=c),d&&Pi(d)&&(v.participantName=d),Array.isArray(u)){let{participants:y}=Ai({participantFilters:{participantTypes:[Dt]},tournamentRecord:n}),I=y==null?void 0:y.map(Tt);if(I){let b=u.filter(S=>Pi(S)&&I.includes(S));([Qa,gi].includes(m||s.participantType)||m===gt&&(b.length===2||a))&&(v.individualParticipantIds=b),s.participantType===oI.PAIR&&e&&(v.participantName=kCe({individualParticipants:y,newValues:v}))}}return Object.keys(ML).includes(p)&&(v.participantRole=p),Object.keys(oI).includes(m)&&(v.participantType=m),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===oI.INDIVIDUAL&&g&&xCe({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,Ge(v)),i&&WR({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),ut({topic:on,payload:{tournamentId:n.tournamentId,participants:[s]}}),{participant:Me(s),...Q}}function kCe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function xCe({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:l,birthdate:u,tennisId:c,sex:d}=r;d&&Object.keys(yF).includes(d)&&(n.sex=d);let p;if(Pi(l)&&(n.personId=l),s&&Pi(s)&&(FCe(s)||s==="")&&(n.nationalityCode=s),a&&typeof Pi(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),o&&typeof Pi(o)&&o.length>1&&(n.standardGivenName=o,p=!0),p&&t){let m=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=m}u&&wa(u)&&(n.birthdate=u),c&&Pi(c)&&(n.tennisId=c),Object.assign(e.person,n)}function FCe(t){return bc.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function T0(t){var e,i,r,n,a,o,s,l,u,c,d,p,m,h,f,g,v,y,I,b;let S=T$(t);if(S.error)return S;let w="assignTieMatchUpParticipantId",U=t.teamParticipantId,{tournamentRecord:T,drawDefinition:D,participantId:P,event:E}=t;if(!P)return te({result:{error:fr},stack:w});if(t.sideNumber&&![1,2].includes(t.sideNumber))return te({result:{error:tF},stack:w});let{inContextDualMatchUp:R,inContextTieMatchUp:N,relevantAssignments:A,collectionPosition:M,teamParticipants:C,collectionId:O,matchUpType:k,dualMatchUp:x,tieFormat:F}=S;if((i=(e=N==null?void 0:N.sides)==null?void 0:e.flatMap(ne=>{var de,ye;return((de=ne.participant)==null?void 0:de.individualParticipantIds)||((ye=ne.participant)==null?void 0:ye.participantId)||[]}))!=null&&i.includes(P))return te({result:{...Q},stack:w});U=U??(t.sideNumber?(n=(r=R==null?void 0:R.sides)==null?void 0:r.find(ne=>ne.sideNumber===t.sideNumber))==null?void 0:n.participantId:void 0);let $=(o=(a=Ai({participantFilters:{participantIds:[P]},tournamentRecord:T}))==null?void 0:a.participants)==null?void 0:o[0];if(!$)return te({result:{error:Wi},stack:w});let{appliedPolicies:_}=Bt({tournamentRecord:T,drawDefinition:D,event:E}),L=((s=t.policyDefinitions)==null?void 0:s[_r])??(_==null?void 0:_[_r])??Pv[_r];if((t.enforceGender??((l=L==null?void 0:L.participants)==null?void 0:l.enforceGender))!==!1&&[Qt,hi].includes(N==null?void 0:N.gender)&&(N==null?void 0:N.gender)!==((u=$.person)==null?void 0:u.sex))return{error:Uh,info:"Gender mismatch"};let{individualParticipantIds:B,participantType:V}=$;if(Ji(ri)(k)&&V!==Dt)return{error:xs};let G=V===Dt?[P]:B,j=U&&(C==null?void 0:C.find(({participantId:ne})=>ne===U))||(C==null?void 0:C.find(({individualParticipantIds:ne})=>Nn(G,ne)));if(!j)return{error:cF};if(U||(U=j.participantId),!U)return{error:Wi};let z=(c=A==null?void 0:A.find(ne=>ne.participantId===(j==null?void 0:j.participantId)))==null?void 0:c.drawPosition,W=(p=(d=x==null?void 0:x.sides)==null?void 0:d.find(ne=>ne.participantId===U))==null?void 0:p.sideNumber,q=(h=(m=N==null?void 0:N.sides)==null?void 0:m.find(ne=>z&&ne.drawPosition===z))==null?void 0:h.sideNumber,Y=W??q??t.sideNumber;if(!F)return{error:dv};if(!((f=F.collectionDefinitions)!=null&&f.find(ne=>ne.collectionId===O)))return{error:i9};Hw({tournamentId:T.tournamentId,eventId:E.eventId,inContextDualMatchUp:R,drawDefinition:D,dualMatchUp:x});let re=(g=x==null?void 0:x.sides)==null?void 0:g.find(ne=>ne.sideNumber===Y),J=(v=N==null?void 0:N.sides)==null?void 0:v.find(ne=>ne.sideNumber===Y),H=(b=(I=(re==null?void 0:re.lineUp)??((y=ep({participantId:U,drawDefinition:D}))==null?void 0:y.lineUp))==null?void 0:I.filter(ne=>{var de;return(de=ne.collectionAssignments)==null?void 0:de.find(ye=>ye.collectionPosition===M&&ye.collectionId===O&&!ye.previousParticipantId)}))==null?void 0:b.map(ne=>ne==null?void 0:ne.participantId),Z=(H==null?void 0:H.length)>1&&H||(V===gt?$.individualParticipantIds:[P]),K=pte({collectionPosition:M,teamParticipantId:U,dualMatchUpSide:re,drawDefinition:D,participantIds:Z,collectionId:O});if(K.error)return te({result:K,stack:w});let{modifiedLineUp:ie}=K,ae;if(k===ei){if(V!==gt){let ne=QE({collectionPosition:M,teamParticipantId:U,drawDefinition:D,modifiedLineUp:ie,participantId:P,collectionId:O,tieFormat:F});if(ne!=null&&ne.error)return te({result:ne,stack:w});if(ne=oe({side:J}),ne.error)return ne;ae=ne.deletedParticipantId,re&&(re.lineUp=ie),x&&Et({tournamentId:T==null?void 0:T.tournamentId,matchUp:x,context:w,drawDefinition:D})}else if(V===gt)for(let ne of Z)QE({collectionPosition:M,teamParticipantId:U,drawDefinition:D,modifiedLineUp:ie,participantId:ne,collectionId:O,tieFormat:F})}else{let ne=QE({collectionPosition:M,teamParticipantId:U,drawDefinition:D,modifiedLineUp:ie,participantId:P,collectionId:O,tieFormat:F});if(ne!=null&&ne.error)return ne}if(re&&(re.lineUp=ie),x&&Et({tournamentId:T==null?void 0:T.tournamentId,matchUp:x,context:w,drawDefinition:D}),ae){let{error:ne}=Bh({participantIds:[ae],tournamentRecord:T});ne&&console.log("cleanup")}return{...Q,modifiedLineUp:ie};function oe({side:ne}){let de;if(ne.participant){let ye=ne.participant.individualParticipantIds||[];if(ye.filter(Boolean).length===1){let{participant:ce}=ls({participantIds:ye,tournamentRecord:T});ye.push(P);let{participant:ke}=ls({participantIds:ye,tournamentRecord:T});if(!ke&&ce){ce.individualParticipantIds=ye;let we=qR({pairOverride:!0,tournamentRecord:T,participant:ce});if(we.error)return we}else de=ce==null?void 0:ce.participantId}}else{let ye=fl({participant:{individualParticipantIds:[P],participantRole:en,participantType:gt},pairOverride:!0,tournamentRecord:T});if(ye.error)return ye}return{...Q,deletedParticipantId:de}}}function QE({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:o}){var s,l;let u=(s=ep({participantId:e,drawDefinition:i}))==null?void 0:s.lineUp,c=(l=r||u)==null?void 0:l.find(p=>(p==null?void 0:p.participantId)===n),d={collectionId:a,collectionPosition:t};if(c)c.collectionAssignments.push(d);else{let p={collectionAssignments:[d],participantId:n};r.push(p)}return jh({participantId:e,lineUp:r,drawDefinition:i,tieFormat:o})}function mte(t){var e,i,r,n,a,o,s,l,u,c,d,p,m,h,f,g,v,y,I,b,S,w,U;let{tournamentRecord:T,drawDefinition:D,participantId:P,event:E}=t,R="removeTieMatchUpParticiapantId";if(!P)return te({result:{error:fr},stack:R});let N=T$(t);if(N.error)return N;let{appliedPolicies:A}=Bt({tournamentRecord:T,drawDefinition:D,event:E}),M=(r=(i=((e=t.policyDefinitions)==null?void 0:e[_r])??(A==null?void 0:A[_r])??Pv[_r])==null?void 0:i.processCodes)==null?void 0:r.substitution,{inContextDualMatchUp:C,inContextTieMatchUp:O,relevantAssignments:k,collectionPosition:x,teamParticipants:F,collectionId:$,matchUpType:_,dualMatchUp:L,tieMatchUp:B,tieFormat:V}=N;if(!L)return te({result:{error:la},stack:R});let G=(n=O==null?void 0:O.sides)==null?void 0:n.find(H=>{var Z,K,ie;return((Z=H.participant)==null?void 0:Z.participantId)===P||((ie=(K=H.participant)==null?void 0:K.individualParticipantIds)==null?void 0:ie.includes(P))});if(!G)return te({result:{error:Wi},stack:R});let j=((a=t.policyDefinitions)==null?void 0:a[vo])??(A==null?void 0:A[vo]);if(!((o=G.substitutions)!=null&&o.length)&&(br({score:O==null?void 0:O.score})||O!=null&&O.winningSide)&&(j==null?void 0:j.requireParticipantsForScoring)!==!1)return te({result:{error:$9},stack:R});let z=(l=(s=C==null?void 0:C.sides)==null?void 0:s.find(({sideNumber:H})=>H===G.sideNumber))==null?void 0:l.participantId;if(!z)return te({result:{error:Wi},stack:R});let W=(c=(u=Ai({participantFilters:{participantIds:[P]},tournamentRecord:T}))==null?void 0:u.participants)==null?void 0:c[0];if(!W)return te({result:{error:Wi},stack:R});if(_===ri&&W.participantType===gt)return te({result:{error:Uh},stack:R});let q=W.participantType===Dt?[P]:W.individualParticipantIds;Hw({tournamentId:T.tournamentId,eventId:E.eventId,inContextDualMatchUp:C,drawDefinition:D,dualMatchUp:L});let Y=(d=L.sides)==null?void 0:d.find(({sideNumber:H})=>H===G.sideNumber);if(!Y&&(((p=L.sides)==null?void 0:p.filter(({lineUp:H})=>!H).length)||0)<2){let H=F==null?void 0:F.map(({participantId:Z})=>{var K;return{drawPosition:(K=k==null?void 0:k.find(ie=>ie.participantId===Z))==null?void 0:K.drawPosition,teamParticipantId:Z}});Y=(m=L.sides)==null?void 0:m.find(Z=>{var K;return((K=H==null?void 0:H.find(({drawPosition:ie})=>ie===Z.drawPosition))==null?void 0:K.teamParticipantId)===z})}if(!Y)return te({result:{error:Wi,context:{participantId:P}}});let{modifiedLineUp:re,previousParticipantIds:J}=pte({collectionPosition:x,teamParticipantId:z,dualMatchUpSide:Y,participantIds:q,drawDefinition:D,collectionId:$});if(Y.lineUp=re,z&&V&&jh({participantId:z,lineUp:re,drawDefinition:D,tieFormat:V}),_===ei&&W.participantType===Dt){let H=(h=O==null?void 0:O.sides)==null?void 0:h.find(ie=>ie.sideNumber===(Y==null?void 0:Y.sideNumber)),{participantId:Z}=H??{},K=Z&&((g=(f=Ai({participantFilters:{participantIds:[Z]},tournamentRecord:T,withDraws:!0}))==null?void 0:f.participants)==null?void 0:g[0]);if(K){let ie=((v=K==null?void 0:K.individualParticipantIds)==null?void 0:v.filter(ae=>ae!==P))??[];if(J&&ie.push(...J),ie.length>2)return te({result:{error:ba},stack:R});if((y=K.draws)!=null&&y.length){if(ie.length===1){let{participant:ae}=ls({participantIds:ie,tournamentRecord:T});if(!ae){let oe=fl({participant:{participantRole:en,individualParticipantIds:ie,participantType:gt},pairOverride:!0,tournamentRecord:T});if(oe.error)return te({result:oe,stack:R})}}}else if(ie.length){K.individualParticipantIds=ie;let ae=qR({participant:K,pairOverride:!0,tournamentRecord:T});if(ae.error)return te({result:ae,stack:R})}else{let ae=Bh({participantIds:[Z],tournamentRecord:T});ae.error&&console.log("cleanup",{result:ae})}}else return te({result:{error:Wi},stack:R})}if(((I=G.substitutions)==null?void 0:I.length)===1&&!((w=(S=(b=O==null?void 0:O.sides)==null?void 0:b.find(H=>H.sideNumber!==G.sideNumber))==null?void 0:S.substitutions)!=null&&w.length)&&(U=B==null?void 0:B.processCodes)!=null&&U.length){for(let H of M||[]){let Z=B.processCodes.lastIndexOf(H);B.processCodes.splice(Z,1)}Et({tournamentId:T==null?void 0:T.tournamentId,matchUp:B,context:R,drawDefinition:D})}return Et({tournamentId:T==null?void 0:T.tournamentId,matchUp:L,context:R,drawDefinition:D}),{...Q,modifiedLineUp:re}}function P$(t){var e,i;let r=We(t,[{[Ur]:!0,[$n]:!0,[wl]:!0}]);if(r.error)return r;let{drawDefinition:n,sideNumber:a,matchUpId:o,event:s}=t;if(a&&![1,2].includes(a))return{error:le,sideNumber:a};let{matchUp:l,structure:u}=Ti({drawDefinition:n,matchUpId:o,event:s});return l?Yn({structure:u})?((e=l.sides)==null||e.forEach(c=>{(!a||c.sideNumber===a)&&delete c.participantId}),Et({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,context:"assignSideParticipant",drawDefinition:n,matchUp:l}),{...Q}):{error:zx}:{error:fn}}function LCe({matchUpStatuses:t=[jt,Ft,Pt],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){var n;let a=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),o=(n=a==null?void 0:a.drawPositions)==null?void 0:n.find(d=>d!==i),s=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(o)}).map(d=>d.matchUpStatus),l=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),u=Nn(s||[],t),c=Nn(l||[],t);return{sourceMatchUp:a,winnerHadMatchUpStatus:u,winnerMatchUpStatuses:s,loserHadMatchUpStatus:c,loserMatchUpStatuses:l}}function _Ce({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=rt({drawDefinition:a,structureId:o});if((d==null?void 0:d.structureType)===_n)return{...Q};u=u??ln({drawDefinition:a});let p=((u==null?void 0:u.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:m}=Vm({drawPosition:i,matchUps:p}),h=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==m&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:f}=si({drawDefinition:a,structureId:o});for(let g of h??[])$Ce({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:f,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:s,matchUpsMap:u,matchUp:g,event:c});return{...Q}}function $Ce({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:u,event:c}){var d,p,m;let h="removeSubsequentDrawPosition";if(s){let g=(p=(d=t.find(({matchUpId:y})=>u.matchUpId===y).sides)==null?void 0:d.find(y=>y.drawPosition===r))==null?void 0:p.sideNumber,v=(m=u.sides)==null?void 0:m.find(y=>y.sideNumber===g);v&&delete v.lineUp}u.drawPositions=(u.drawPositions||[]).map(g=>g===r?void 0:g).filter(Boolean);let f=e.filter(({drawPosition:g})=>{var v;return(v=u.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return u.matchUpStatus=f&&jt||[Pt,Ft].includes(u.matchUpStatus)&&u.matchUpStatus||Qi,[Ft,Pt].includes(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&OX({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),Et({tournamentId:n==null?void 0:n.tournamentId,eventId:c==null?void 0:c.eventId,context:`${h}-${r}`,drawDefinition:o,matchUp:u}),{...Q}}function Lv(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,m=Yn({structure:c}),{drawPositions:h,winningSide:f}=l.matchUp||{};if(!m&&!h)return{error:Xb};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:I,winnerMatchUp:b,byeMatchUp:S}}=l,w=el({...t,matchUpStatus:a||Qi,removeWinningSide:!0});if(w.error)return w;let U;if(p){let{matchUpTieId:O,matchUpsMap:k}=t;if(U=rc({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:k,event:d}),!e&&!U.removeWinningSide)return{...Q}}if(m)return{...Q};let{matchUps:T}=qt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:o,structure:c}),{positionAssignments:D}=Mr({structure:c}),P=f-1,E=1-P,R=h[P],N=h[E],{winnerParticipantId:A,loserParticipantId:M}=(D==null?void 0:D.reduce((O,k)=>(k.drawPosition===N&&(O.loserParticipantId=k.participantId),k.drawPosition===R&&(O.winnerParticipantId=k.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},C=T.filter(O=>{var k;return(k=O.drawPositions)==null?void 0:k.includes(N)});if(b&&hte({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:A,tournamentRecord:r,winnerTargetLink:v,drawDefinition:n,winnerMatchUp:b,dualMatchUp:s,matchUpsMap:o}),I){let{winnerHadMatchUpStatus:O}=LCe({drawPositionMatchUps:C,loserDrawPosition:N,sourceMatchUps:T}),k=g.linkCondition===dl;if(O&&k){let F=Math.min(...I.drawPositions);KM({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:F,matchUpsMap:o,event:d})}let x=BCe({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:M,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:I,dualMatchUp:s,matchUpsMap:o,event:d});if(x.error)return x}if(S){let O=Math.min(...S.drawPositions);KM({sourceMatchUpId:u,targetLink:y,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:o,event:d})}return{...Q,...U&&{tieMatchUpResult:U}}}function hte({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){var p,m;let{structureId:h,roundNumber:f}=l,g="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=rt({drawDefinition:s,structureId:v});if(!y)return{error:Ni};let{positionAssignments:I}=Mr({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(D=>D.participantId!==r);let b=(p=I==null?void 0:I.find(D=>D.participantId===r))==null?void 0:p.drawPosition,{matchUps:S}=qt({drawDefinition:s,structure:y,event:d}),w=S.map(D=>D.drawPositions).flat(1/0).filter(Boolean),U=Ra(w);if((b?U[b]:void 0)===1)I==null||I.forEach(D=>{D.participantId===r&&delete D.participantId});else{let D=S.filter(({drawPositions:P})=>P.includes(b));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:D,winnerTargetLink:a})}let T=(m=u==null?void 0:u.drawMatchUps)==null?void 0:m.find(({matchUpId:D})=>D===l.matchUpId);T&&Et({tournamentId:n==null?void 0:n.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:T,context:g,drawDefinition:s})}return f&&_Ce({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:c,matchUpsMap:u,roundNumber:f,structureId:h}),{...Q}}function BCe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:u}){var c,d,p;let m="removeDirectedLoser",h=r.target.structureId,{structure:f}=rt({drawDefinition:a,structureId:h});if(!f)return{error:Ni};let{positionAssignments:g}=Mr({structure:f}),v=(c=g==null?void 0:g.find(y=>y.participantId===e))==null?void 0:c.drawPosition;if(g==null||g.forEach(y=>{y.participantId===e&&delete y.participantId}),f.seedAssignments=(f.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=o==null?void 0:o.sides.reduce((S,w,U)=>w.drawPosition===v?U:S,void 0),I=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(({matchUpId:S})=>S===o.matchUpId),b=(p=I==null?void 0:I.sides)==null?void 0:p[y];b&&(delete b.lineUp,Et({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:I,context:m,drawDefinition:a}))}return{...Q}}function KM({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:o}){let s=a.target.structureId,l="removeDirectedBye";ka({color:"brightyellow",method:l,drawPosition:r});let u=Mw({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:s,event:o});return te({result:u,stack:l})}function VCe(t){var e,i;let{matchUpFormat:r,score:n}=t,a=(e=n==null?void 0:n.sets)==null?void 0:e.length,o=r&&Ln(r),{setFormat:s,finalSetFormat:l,bestOf:u}=o??{};return((i=u&&a===u&&l||s)==null?void 0:i.timed)||!1}function jCe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){var n;let a="attemptToSetMatchUpStatusBYE";if(r!=null&&r.winningSide)return te({result:{error:cv},context:{matchUpStatus:jt},stack:a});let{positionAssignments:o}=Mr({structure:i}),s=o==null?void 0:o.filter(l=>l.bye).map(l=>l.drawPosition);return(n=r.drawPositions)!=null&&n.some(l=>s==null?void 0:s.includes(l))?(r.matchUpStatus=jt,r.matchUpStatusCodes=[],Et({tournamentId:t==null?void 0:t.tournamentId,context:a,drawDefinition:e,matchUp:r}),{...Q}):te({result:{error:t9},info:"matchUp does not include BYE",stack:a})}function dI(t){var e,i;let{tournamentRecord:r,appliedPolicies:n,drawDefinition:a,matchUpsMap:o,targetData:s,structure:l,event:u}=t,c="doubleExitAdvancement";if(l.structureType===_n)return te({result:{...Q},stack:c});let{matchUp:d,targetMatchUps:p,targetLinks:m}=s,{loserMatchUp:h,winnerMatchUp:f,loserTargetDrawPosition:g}=p,v=[Ft,Pt].includes(h==null?void 0:h.matchUpStatus)&&!((e=h.sides)!=null&&e.map(y=>y.participantId??y.participant).filter(Boolean).length);if(h&&h.matchUpStatus!==jt){let{loserTargetLink:y}=m;if((i=n==null?void 0:n.progression)!=null&&i.doubleExitPropagateBye){let I=fte({loserTargetDrawPosition:g,tournamentRecord:r,loserTargetLink:y,drawDefinition:a,loserMatchUp:h,matchUpsMap:o,event:u});if(I.error)return te({result:I,stack:c})}else if(!v){let{feedRound:I,drawPositions:b,matchUpId:S}=h,w=I?2:2-b.indexOf(g),U=aj({...t,targetMatchUp:h,walkoverWinningSide:w,tournamentRecord:r,sourceMatchUp:d,matchUpId:S});if(U.error)return te({result:U,stack:c})}}if(f){let y=aj({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:r,sourceMatchUp:d});if(y.error)return te({result:y,stack:c})}return te({result:{...Q},stack:c})}function aj(t){var e,i,r;let{inContextDrawMatchUps:n,tournamentRecord:a,drawDefinition:o,sourceMatchUp:s,targetMatchUp:l,matchUpsMap:u}=t,c=o.structures.find(({structureId:z})=>z===l.structureId),d=t.matchUpStatus===pr?pr:ir,p=t.matchUpStatus===pr?Pt:Ft,m="conditionallyAdvanceDrawPosition",h=u.drawMatchUps.find(z=>z.matchUpId===l.matchUpId);if(!h)return{error:la};let f=(s==null?void 0:s.drawPositions)||[],g=(e=h.drawPositions)==null?void 0:e.filter(Boolean),v=(s==null?void 0:s.structureId)===l.structureId;if(v&&Nn(f,g)&&(g=g.filter(z=>!f.includes(z))),v&&g.length>1)return te({result:{error:Zf},stack:m});let{pairedPreviousMatchUpIsDoubleExit:y,pairedPreviousMatchUp:I}=NX(t),b=On({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawDefinition:o}),{targetMatchUps:S,targetLinks:w}=b,{loserTargetDrawPosition:U,winnerMatchUp:T,loserMatchUp:D}=S;if(D){let{loserTargetLink:z}=w,W=fte({loserTargetDrawPosition:U,loserMatchUp:D,tournamentRecord:a,loserTargetLink:z,drawDefinition:o,matchUpsMap:u});if(W.error)return te({result:W,stack:m})}let P=((i=h.drawPositions)==null?void 0:i.filter(Boolean))||[],E=P.length===1,R=t.walkoverWinningSide||E&&nS({drawPosition:P[0],matchUpId:l.matchUpId,inContextDrawMatchUps:n})||void 0,N=[Ft,Pt].includes(h.matchUpStatus)&&!P.length,A=h.finishingRound===1,M=N&&!A?d:p,C=n.find(z=>z.matchUpId===I.matchUpId),O=[],k;s&&((s==null?void 0:s.structureId)===(C==null?void 0:C.structureId)?s.roundPosition<(I==null?void 0:I.roundPosition)?k=1:k=2:l.feedRound?s.structureId===l.structureId?k=2:k=1:R&&(k=3-R));let x=t.matchUpStatus,F=I==null?void 0:I.matchUpStatus;k===1?O=[{matchUpStatus:UU(x),previousMatchUpStatus:x,sideNumber:1},{matchUpStatus:UU(F),previousMatchUpStatus:F,sideNumber:2}]:k===2&&(O=[{matchUpStatus:UU(F),previousMatchUpStatus:F,sideNumber:1},{matchUpStatus:UU(x),previousMatchUpStatus:x,sideNumber:2}]),O.length&&(O=O.map(z=>Ge(z)));let $=el({...t,winningSide:R,matchUp:h,matchUpStatusCodes:O,context:m,matchUpStatus:M});if($.error)return te({result:$,stack:m});if(N)return dI({...t,matchUpStatus:M,targetData:b});if(!T)return te({result:{...Q},stack:m});let _=g.length===2?g[R-1]:g[0],{positionAssignments:L}=si({structure:c}),B=L==null?void 0:L.find(z=>z.drawPosition===_),V=u.drawMatchUps.find(z=>z.matchUpId===T.matchUpId),G=(r=V==null?void 0:V.drawPositions)==null?void 0:r.filter(Boolean),j=G.length===1;if(_){if(B!=null&&B.bye){let z=On({matchUpId:V.matchUpId,inContextDrawMatchUps:n,drawDefinition:o});if(j){let W=G.filter(Boolean)[0],q=nS({drawPosition:W,matchUpId:V.matchUpId,inContextDrawMatchUps:n}),Y=el({appliedPolicies:t.appliedPolicies,matchUpId:V.matchUpId,matchUp:V,matchUpStatus:p,matchUpStatusCodes:[],removeScore:!0,context:m,drawDefinition:o,winningSide:q});return Y.error?te({result:Y,stack:m}):DL({drawPositionToAdvance:W,matchUpId:V.matchUpId,inContextDrawMatchUps:n,drawDefinition:o,matchUpsMap:u})}else if([Ft,Pt].includes(T.matchUpStatus)){let W=dI({...t,matchUpId:V.matchUpId,matchUpStatus:M,targetData:z});if(W.error)return te({result:W,stack:m})}return te({result:{...Q},stack:m})}return gg({matchUpId:T.matchUpId,drawPosition:_,inContextDrawMatchUps:n,drawDefinition:o})}else if(y){if(!V)return{error:la};if(j){let q=G[0],Y=nS({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawPosition:q});console.log("existing drawPosition is winningSide",{walkoverWinningSide:Y})}let z=[Ft,Pt].includes(V.matchUpStatus)?p:d,W=el({matchUpId:V.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:V,matchUpStatusCodes:[],removeScore:!0,context:m,drawDefinition:o,matchUpStatus:z});if(W.error)return te({result:W,stack:m});if(z===d){let q=dI({...t,matchUpId:l.matchUpId,matchUpStatus:z,targetData:b});if(q.error)return q}}return te({result:{...Q},stack:m})}function fte(t){var e;let{loserTargetDrawPosition:i,tournamentRecord:r,loserTargetLink:n,drawDefinition:a,matchUpsMap:o,event:s}=t,l=(e=n==null?void 0:n.target)==null?void 0:e.structureId,{structure:u}=rt({drawDefinition:a,structureId:l});return u?eo({drawPosition:i,tournamentRecord:r,drawDefinition:a,structureId:l,matchUpsMap:o,event:s}):{error:Tp}}function UU(t){return t===ir?Ft:t===pr?Pt:t}function GCe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,o=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=r===jt,u=a.winningSide,c=[ir,pr].includes(r),d=Ew({matchUpStatus:r}),p=PM({matchUpStatus:r}),m=!d&&!p,h=t.matchUpTieId||u&&d&&!c,f=u&&c,g=()=>el({...t,removeScore:[Sl,Ft].includes(r),matchUpStatus:r||Qi});return m&&{error:oM}||h&&JM(t)||f&&HCe(t)||u&&Lv(t)||p&&g()||l&&jCe({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:oM}||c&&zCe(t)||o&&JM(t)||te({result:{error:cv},stack:s})}function HCe(t){let e=Lv(t);return e.error?e:dI(t)}function zCe(t){let e=JM({...t,removeScore:!0});return e.error?e:dI(t)}function JM(t){var e;let i="scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){let a=Lv(t);if(a.error)return te({result:a,stack:i})}let r=!!t.matchUp.collectionId,n=el({...t,context:i});if(r){let{matchUpTieId:a,drawDefinition:o,matchUpsMap:s}=t,l=rc({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:o,matchUpsMap:s});if(l.error)return te({result:l,stack:i});Object.assign(n,{tieMatchUpResult:l})}return te({result:n,stack:i})}function WCe({drawDefinition:t,structure:e,matchUp:i}){var r,n,a,o;let{drawPositions:s}=i,{positionAssignments:l}=si({drawDefinition:t,structure:e}),u=(r=l==null?void 0:l.filter(({drawPosition:p})=>s==null?void 0:s.includes(p)))==null?void 0:r.map(p=>{var m;let{extension:h}=It({element:p,name:kc});return(m=h==null?void 0:h.value)==null?void 0:m.groupOrder}),{containerStructures:c}=Uv({drawDefinition:t}),d=c[e.structureId];return{structureIds:(o=(a=(n=Sv({drawDefinition:t,structureId:d}))==null?void 0:n.links)==null?void 0:a.source)==null?void 0:o.filter(p=>{var m;return Nn(u,((m=p.source)==null?void 0:m.finishingPositions)||[])}).map(p=>p.source.structureId)}}function gte({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===Jd&&$c({drawDefinition:t,structure:e})){let{structureIds:n}=WCe({drawDefinition:t,structure:e,matchUp:i});n!=null&&n.length&&r.push(...n)}return{connectedStructureIds:r}}function qCe(t){var e,i,r;let n,{inContextDrawMatchUps:a,inContextMatchUp:o,drawDefinition:s,winningSide:l}=t,u=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(u.target.feedProfile===ys){let c=o.sides.find(({sideNumber:p})=>p!==l).participantId,d=a.find(p=>p.structureId===u.target.structureId&&p.roundNumber===u.target.roundNumber&&p.sides.some(({participantId:m})=>m===c));if((d==null?void 0:d.matchUpStatus)===Qi){let p=On({matchUpId:d.matchUpId,inContextDrawMatchUps:a,drawDefinition:s});if(!np({inContextDrawMatchUps:a,drawDefinition:s,targetData:p})){let{structure:m}=rt({structureId:d.structureId,drawDefinition:s}),h=si({structure:m}).positionAssignments;for(let f of h||[])if(f.participantId===c){let g=o.sides.find(({sideNumber:v})=>v===l).participantId;if(f.participantId=g,m==null?void 0:m.positionAssignments)m.positionAssignments=h;else if(m!=null&&m.structures){let v=Object.assign({},...(h||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of m.structures)(i=y.positionAssignments)==null||i.forEach(I=>I.participantId=v[I.drawPosition])}Lc({tournamentId:(r=t.tournamentRecord)==null?void 0:r.tournamentId,event:t.event,drawDefinition:s,structure:m}),n=!0}}}}return{...Q,qualifierReplaced:n}}function YCe(t){var e,i,r,n,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:u,winningSide:c}=t,d=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(d.target.feedProfile===ys){let p=(i=l.sides.find(({sideNumber:f})=>f===c))==null?void 0:i.participantId,m=s.filter(f=>f.structureId===d.target.structureId&&f.roundNumber===d.target.roundNumber&&f.sides.some(({participantId:g,qualifier:v})=>v&&!g)),h=$o(m);if((h==null?void 0:h.matchUpStatus)===Qi){let f=On({matchUpId:h.matchUpId,inContextDrawMatchUps:s,drawDefinition:u});if(!np({inContextDrawMatchUps:s,drawDefinition:u,targetData:f})){let g=(r=h.sides.find(I=>I.qualifier&&!I.participantId))==null?void 0:r.drawPosition,{structure:v}=rt({structureId:h.structureId,drawDefinition:u});if(!v)return{error:Ni};let y=si({structure:v}).positionAssignments;for(let I of y||[])if(I.drawPosition===g&&!I.participantId){if(I.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let b=Object.assign({},...(y||[]).map(S=>({[S.drawPosition]:S.participantId})));for(let S of v.structures)(n=S.positionAssignments)==null||n.forEach(w=>w.participantId=b[w.drawPosition])}Lc({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:u,structure:v}),o=!0}}}}return{...Q,qualifierPlaced:o}}function KCe(t){var e,i;let r="attemptToSetWinningSide",n,{appliedPolicies:a,disableAutoCalc:o,drawDefinition:s,dualMatchUp:l,winningSide:u,structure:c,matchUp:d}=t;if(l!=null&&l._disableAutoCalc&&o!==!1)return n_(t);if(d.winningSide&&d.winningSide!==u){let{connectedStructureIds:f}=gte({drawDefinition:s,structure:c,matchUp:d});f.length&&(console.log({connectedStructureIds:f}),n=!0);let g=Lv(t);if(g.error)return g}let p=PQ(t);if(p.error)return te({result:p,stack:r});let m,h;return t.qualifierChanging&&(e=a==null?void 0:a[uy])!=null&&e.autoReplaceQualifiers&&(m=qCe(t).qualifierReplaced),t.qualifierAdvancing&&(i=a==null?void 0:a[uy])!=null&&i.autoPlaceQualifiers&&(h=YCe(t).qualifierPlaced),te({result:Ge({...Q,...p,connectedStructures:n,qualifierReplaced:m,qualifierPlaced:h}),stack:r})}var uS={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function vte(t){var e,i,r,n;let{inContextDrawMatchUps:a,appliedPolicies:o,drawDefinition:s,matchUpsMap:l,targetData:u,matchUp:c}=t,{matchUpId:d}=c,{iteration:p=0}=t;p+=1;let m="removeDoubleExit";ka({color:"brightyellow",method:m,matchUpId:d,iteration:p,keyColors:uS});let{targetMatchUps:{loserMatchUp:h,winnerMatchUp:f,loserTargetDrawPosition:g},targetLinks:{loserTargetLink:v}}=u;if(f&&f.matchUpStatus!==jt){let{stage:b,roundNumber:S,roundPosition:w,structureName:U}=f;ka({winner:"winner",roundPosition:w,structureName:U,roundNumber:S,keyColors:uS,stage:b}),oj({...t,targetMatchUp:f,sourceMatchUp:c,iteration:p})}let y=(h==null?void 0:h.matchUpStatus)===jt&&((h==null?void 0:h.feedRound)||(h==null?void 0:h.roundNumber)===1),I=((i=(e=u==null?void 0:u.targetLinks)==null?void 0:e.loserTargetLink)==null?void 0:i.linkCondition)===dl;if(y&&I){let b=a.filter(({roundNumber:U,structureId:T})=>T===c.structureId&&U===1),S=b.map(({roundPosition:U})=>U),w=Cr(S.sort(),2).find(U=>U.includes(c.roundPosition));if(((r=b.filter(({roundPosition:U})=>w.includes(U)))==null?void 0:r.map(({matchUpStatus:U})=>U)).every(U=>[pr,ir].includes(U)))return te({result:{...Q},stack:m})}if(h&&(h.matchUpStatus!==jt||y)){let b=a.find(({matchUpId:E})=>E===h.matchUpId),{structure:S}=rt({drawDefinition:s,structureId:b.structureId}),{stage:w,roundNumber:U,roundPosition:T,feedRound:D,structureName:P}=h;if(ka({loser:"loser",roundPosition:T,structureName:P,roundNumber:U,keyColors:uS,feedRound:D,stage:w}),((n=o==null?void 0:o.progression)==null?void 0:n.doubleExitPropagateBye)||y)KM({drawPosition:g,targetLink:v,inContextDrawMatchUps:a,drawDefinition:s,matchUpsMap:l});else{let E=oj({...t,targetMatchUp:h,structure:S,iteration:p});if(E.error)return te({result:E,stack:m})}}return te({result:{...Q},stack:m})}function oj(t){var e,i,r,n,a,o;let{inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:u,sourceMatchUp:c,targetMatchUp:d,matchUpsMap:p,structure:m,iteration:h}=t,f="conditionallyRemoveDrawPosition";ka({method:f,structureName:m==null?void 0:m.structureName,iteration:h});let g=On({matchUpId:d.matchUpId,inContextDrawMatchUps:s,drawDefinition:u}),{targetMatchUps:{winnerMatchUp:v}}=g,y=p==null?void 0:p.drawMatchUps.find(P=>P.matchUpId===d.matchUpId),I=[],b,S,w;if(d.feedRound)w=(i=(e=v==null?void 0:v.drawPositions)==null?void 0:e.filter(Boolean))==null?void 0:i.find(P=>d.drawPositions.includes(P));else if(!c)w=(r=ji((d==null?void 0:d.drawPositions)||[],(v==null?void 0:v.drawPositions)||[]))==null?void 0:r[0];else if(S=(n=AX({structureId:m.structureId,matchUp:c,matchUpsMap:p}))==null?void 0:n.pairedPreviousMatchUp,b=[ir,pr].includes(S==null?void 0:S.matchUpStatus),I=((a=S==null?void 0:S.drawPositions)==null?void 0:a.filter(Boolean))||[],[...yr,jt].includes(S==null?void 0:S.matchUpStatus)||(S==null?void 0:S.winningSide)){let P=c.drawPositions||[],E=(o=d.drawPositions)==null?void 0:o.filter(Boolean);Nn(P,E)&&(E=E==null?void 0:E.filter(R=>!P.includes(R))),w=P.concat(I).find(R=>E==null?void 0:E.includes(R))}if(v&&w){let{stage:P,roundNumber:E,roundPosition:R,structureName:N}=v;ka({method:"removeDirectedWinner",drawPositionToRemove:w,color:"brightgreen",roundPosition:R,structureName:N,roundNumber:E,keyColors:uS,stage:P}),hte({winningDrawPosition:w,winnerMatchUp:v,inContextDrawMatchUps:s,drawDefinition:u,matchUpsMap:p})}let U=vte({targetData:g,matchUp:d,inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:u,matchUpsMap:p,structure:m,iteration:h});if(U.error)return te({result:U,stack:f});let T=JCe({pairedPreviousDoubleExit:b,noContextTargetMatchUp:y}),D=!b;return U=el({...t,matchUpId:d.matchUpId,matchUp:y,removeWinningSide:!0,matchUpStatusCodes:[],context:f,matchUpStatus:T,removeScore:D,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),U.error?te({result:U,stack:f}):{...Q}}function JCe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===jt?jt:t?[pr,Pt].includes(e==null?void 0:e.matchUpStatus)?Pt:Ft:Qi}function XCe(t){var e,i,r,n,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:u}=t,c=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(c.target.feedProfile===ys){let d=(r=(i=l.sides)==null?void 0:i.find(({sideNumber:m})=>m===l.winningSide))==null?void 0:r.participantId,p=s.find(m=>{var h;return m.structureId===c.target.structureId&&m.roundNumber===c.target.roundNumber&&((h=m.sides)==null?void 0:h.some(({participantId:f})=>f===d))});if(p&&p.matchUpStatus===Qi){let m=On({matchUpId:p.matchUpId,inContextDrawMatchUps:s,drawDefinition:u});if(!np({inContextDrawMatchUps:s,drawDefinition:u,targetData:m})){let{structure:h}=rt({structureId:p.structureId,drawDefinition:u}),f=si({structure:h}).positionAssignments;for(let g of f||[])if(g.participantId===d){if(g.participantId=void 0,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(h==null?void 0:h.structures)||[])(n=y.positionAssignments)==null||n.forEach(I=>I.participantId=v[I.drawPosition])}Lc({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:u,structure:h}),o=!0}}}}return{qualifierRemoved:o}}function QCe(t){var e;let{matchUp:i,matchUpStatus:r,score:n,winningSide:a}=t,o="noDownStreamDependencies";if([ir,pr].includes(i==null?void 0:i.matchUpStatus)&&![ir,pr].includes(r)){let g=vte(t);if(g.error)return te({result:g,stack:o})}let s=r===ir,l=br({score:n})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!a),u=((e=t==null?void 0:t.inContextMatchUp)==null?void 0:e.collectionId)&&VCe(t.inContextMatchUp),c=t.removeScore||!u&&![Ma,ca].includes(r||Ma),d=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||i.winningSide&&!a&&!br({score:n}),p=r&&r!==Qi,m=g=>{var v,y;let I,{structure:b,drawDefinition:S,dualMatchUp:w,disableAutoCalc:U}=t;if(w!=null&&w._disableAutoCalc&&U!==!1)return n_({...t,removeWinningSide:d});let{connectedStructureIds:T}=gte({drawDefinition:S,structure:b,matchUp:i});T.length&&(console.log({connectedStructureIds:T}),I=!0),Object.assign(t,{removeScore:g});let D=Lv(t);if(D.error)return D;if(t.removingQualifier&&(y=(v=t.appliedPolicies)==null?void 0:v[uy])!=null&&y.autoRemoveQualifiers){let P=XCe(t);return{...Q,connectedStructures:I,...P}}return{...Q,connectedStructures:I}};if(d&&a&&t.isCollectionMatchUp)return sj(t);let h=[Sl,ca].includes(r)&&t.dualWinningSideChange,f=(a||h)&&KCe(t)||l&&m(c)||p&&GCe(t)||d&&m(c)||i&&sj({...t,removeScore:!0})||{...Q};return te({result:f,stack:o})}function sj(t){var e;let i="ndd:scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let n=Lv(t);if(n.error)return n}let r=el({...t,context:i});if(t.isCollectionMatchUp){let{matchUpTieId:n,drawDefinition:a,event:o,matchUpsMap:s}=t,{removeWinningSide:l}=rc({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,drawDefinition:a,matchUpsMap:s,event:o});l&&console.log("REMOVE WINNING SIDE")}return te({result:r,stack:i})}function R$(t){var e,i,r;let n=We(t,[{[Ur]:!0,[$n]:!0,[wl]:!0},{homeParticipantId:!0,[Ko]:fr}]);if(n.error)return n;let a=Av(t,[{[vv]:nu,attr:{[CP]:!0}}]);if(a.error)return a;let o=(r=(i=(e=a==null?void 0:a.matchUp)==null?void 0:e.matchUp)==null?void 0:i.sides)==null?void 0:r.map(m=>m==null?void 0:m.participantId);if(t.homeParticipantId&&!(o!=null&&o.includes(t.homeParticipantId)))return{error:ks};let{disableNotice:s,homeParticipantId:l,removePriorValues:u,tournamentRecord:c,drawDefinition:d,matchUpId:p}=t;return Aa({duplicateValues:!1,removePriorValues:u,tournamentRecord:c,drawDefinition:d,disableNotice:s,matchUpId:p,timeItem:{itemType:IL,itemValue:l}})}function Ite({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Op({timeItems:(i==null?void 0:i.timeItems)||[],itemType:qP});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function ud(t){var e;let i="addMatchUpScheduledTime",r=t.matchUp,{removePriorValues:n,tournamentRecord:a,drawDefinition:o,disableNotice:s,scheduledTime:l,matchUpId:u}=t;if(!u)return te({result:{error:bn},stack:i});if(!fv(l))return te({result:{error:Oo},stack:i});if(!r){let h=Ti({drawDefinition:o,matchUpId:u});if(h.error)return te({result:h,stack:i});r=h.matchUp}let c=ht(l),d=Fh({matchUp:r}).scheduledDate,p=c&&!d;if((e=Ite({matchUp:r}).timeModifiers||[])!=null&&e.length){let h=yte({disableNotice:!0,removePriorValues:n,tournamentRecord:a,timeModifiers:[],drawDefinition:o,matchUpId:u,matchUp:r});if(h!=null&&h.error)return te({result:h,stack:i})}let m=Rh(l,!0,p);return Aa({duplicateValues:!1,removePriorValues:n,tournamentRecord:a,drawDefinition:o,disableNotice:s,matchUpId:u,timeItem:{itemType:kh,itemValue:m}})}function yte({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return te({result:{error:bn},stack:s});if(n!==void 0&&!Array.isArray(n))return te({info:ip("timeModifiers"),result:{error:le},stack:s});if(!o){let d=Ti({drawDefinition:i,matchUpId:a});if(d.error)return te({result:d,stack:s});o=d.matchUp}let l=Ite({matchUp:o}).timeModifiers||[],u=n.filter(d=>!l.includes(d));if(n.length&&!u.length)return{...Q};if(u.some(d=>UM.includes(d))){l=l.filter(p=>!UM.includes(p));let d=ud({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return te({result:d,stack:s})}let c=n!=null&&n.length?[...u,...l]:void 0;return Aa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:qP,itemValue:c}})}function YR({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:bn};let o=t&&ul.test(t);if(t&&!o)return{error:Fr};let s={itemValue:ht(t),itemType:Oh};return Aa({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s})}function KR({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtIds:s}){var l,u;if(!i&&!e)return{error:ve};if(!o)return{error:bn};let c=Ti({drawDefinition:r,matchUpId:o});if(c.error)return c;if(((l=c==null?void 0:c.matchUp)==null?void 0:l.matchUpType)!==Va)return{error:ua};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:le,context:{courtIds:s}};let d;if(s){let p=e||i&&{[i.tournamentId]:i},m=nc({tournamentRecords:p});if(m.error)return m;let h=(u=m.courts)==null?void 0:u.filter(f=>s.includes(f.courtId));if((h==null?void 0:h.length)!==s.length)return{error:le,context:{courtIds:s}};d=h==null?void 0:h.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return Aa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:Zl,itemDate:a,itemValue:d}})}function _v({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:o}){if(!i)return{error:ve};if(!a)return{error:bn};if(o){let s=au({tournamentRecords:e,tournamentRecord:i,venueId:o});if(s.error)return s}return Aa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Ah,itemValue:o}})}function qh({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!e)return{error:ve};if(!o)return{error:bn};if(s){let u=Lh({tournamentRecords:e,tournamentRecord:i,courtId:s});if(u.error)return u;let c=(l=u.venue)==null?void 0:l.venueId;_v({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,venueId:c})}return Aa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:_c,itemDate:a,itemValue:s}})}function Ws(t,e){let i=n8.test(t)?t:Si(t),r=ht(t)||ht(e)||qo(new Date);return new Date(`${r}T${i}`).getTime()}function JR(t){var e;let i="addMatchUpScheduleItems",r=We(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[Xn]:ia}],i);if(r.error)return r;let{matchUpDependencies:n,inContextMatchUps:a}=t,{errorOnAnachronism:o=!1,checkChronology:s=!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,disableNotice:p,drawMatchUps:m,matchUpId:h,schedule:f,event:g}=t,v,y;if(m)v=m.find(C=>C.matchUpId===h);else{let C=Ti({drawDefinition:d,event:g,matchUpId:h});if(C.error)return C;v=C.matchUp}let{endTime:I,courtId:b,courtIds:S,courtOrder:w,resumeTime:U,homeParticipantId:T,scheduledDate:D,scheduledTime:P,startTime:E,stopTime:R,timeModifiers:N,venueId:A}=f;s&&(!n||!a)&&({matchUpDependencies:n,matchUps:a}=fs({drawDefinition:d}));let M=(e=n==null?void 0:n[h])==null?void 0:e.matchUpIds;if(f.scheduledDate&&s&&M){let C=a==null?void 0:a.filter(O=>{var k,x;return(((k=O.schedule)==null?void 0:k.scheduledDate)||ht((x=O.schedule)==null?void 0:x.scheduledTime))&&M.includes(O.matchUpId)}).map(({schedule:O})=>{let k=ZS(O);return new Date(k).getTime()});if(C!=null&&C.length){let O=ZS(f),k=new Date(O).getTime();if(Math.max(...C)>=k){if(o)return te({result:{error:rM},stack:i});y=rM}}}if(D!==void 0){let C=YR({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledDate:D,matchUpId:h});if(C!=null&&C.error)return te({result:C,stack:i,context:{scheduledDate:D}})}if(P!==void 0){let C=ud({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledTime:P,matchUpId:h,matchUp:v});if(C!=null&&C.error)return te({result:C,stack:i,context:{scheduledTime:P}})}if(E!==void 0){let C=C$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,startTime:E,event:g});if(C!=null&&C.error)return te({result:C,stack:i,context:{startTime:E}})}if(R!==void 0){let C=N$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,stopTime:R,event:g});if(C!=null&&C.error)return te({result:C,stack:i,context:{stopTime:R}})}if(U!==void 0){let C=A$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,resumeTime:U,matchUpId:h,event:g});if(C!=null&&C.error)return te({result:C,stack:i,context:{resumeTime:U}})}if(I!==void 0){let C=M$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,endTime:I,event:g});if(C!=null&&C.error)return te({result:C,stack:i,context:{endTime:I}})}if(S!==void 0){let C=KR({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,courtIds:S});if(C!=null&&C.error)return te({result:C,stack:i,context:{courtIds:S}})}if(b!==void 0&&D!==void 0){let C=qh({courtDayDate:D,disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:h,courtId:b});if(C!=null&&C.error)return te({result:C,stack:i,context:{courtId:b}})}if(A!==void 0){let C=_v({disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:h,venueId:A});if(C!=null&&C.error)return te({result:C,stack:i,context:{venueId:A}})}if(w!==void 0&&st(w)){let C=E$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,courtOrder:w,matchUpId:h});if(C!=null&&C.error)return te({result:C,stack:i,context:{courtOrder:w}})}if(N!==void 0){let C=yte({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,timeModifiers:N,matchUpId:h,matchUp:v});if(C!=null&&C.error)return te({result:C,stack:i,context:{timeModifiers:N}})}return Pi(T)&&R$({disableNotice:!0,homeParticipantId:T,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h}),p||Et({tournamentId:c==null?void 0:c.tournamentId,eventId:g==null?void 0:g.eventId,context:i,drawDefinition:d,matchUp:v}),y?{...Q,warnings:[y]}:{...Q}}function E$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:bn};if(n&&!st(n))return{error:le,info:"courtOrder must be numeric"};let o=n&&tt(n);return Aa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:WP,itemValue:o}})}function bte({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:o}){if(!o)return{error:bn};if(!n)return{error:fr};if(e){let l=Ai({tournamentRecord:e,participantFilters:{participantTypes:[Dt],participantRoles:[CL]}}).participants??[];if(!Oc({tournamentParticipants:l,participantId:n}))return{error:Wi}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(s.itemSubTypes=[a]),Aa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:o,timeItem:s})}function C$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:o}){if(!n)return{error:bn};if(!fv(a))return{error:Oo};let{matchUp:s}=Ti({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=Fh({matchUp:s}),u=((s==null?void 0:s.timeItems)??[]).filter(c=>[yu,Ll,Bu].includes(c==null?void 0:c.itemType)).map(c=>Ws(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||Ws(a,l)<u){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==bs));let c=Rh(a,!0,!0);return Aa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:bs,itemValue:c}})}else return{error:C9}}function M$({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:o,event:s}){if(!a)return{error:bn};if(!fv(o))return{error:Oo};let{matchUp:l}=Ti({drawDefinition:r,event:s,matchUpId:a}),{scheduledDate:u}=Fh({matchUp:l}),c=((l==null?void 0:l.timeItems)??[]).filter(d=>[bs,Ll,yu].includes(d==null?void 0:d.itemType)).map(d=>Ws(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||Ws(o,u)>c){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Bu));let d=Rh(o,!0,!0);return Aa({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Bu,itemValue:d}})}else return{error:R9}}function N$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:o}){if(!n)return{error:bn};if(!fv(a))return{error:Oo};let{matchUp:s}=Ti({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=Fh({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,f)=>f.itemType===Bu||h,void 0))return{error:oF};let c=u.filter(h=>[bs,Ll,yu].includes(h==null?void 0:h.itemType)).sort((h,f)=>Ws(h.itemValue,l)-Ws(f.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===yu,m=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Ws(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(Ws(a,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:Rh(a,!0,!0),itemType:yu};return Aa({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:h})}else return{error:E9}}function A$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:o}){if(!a)return{error:bn};if(!fv(n))return{error:Oo};let{matchUp:s}=Ti({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=Fh({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,f)=>f.itemType===Bu||h,void 0))return{error:oF};let c=u.filter(h=>[bs,Ll,yu].includes(h==null?void 0:h.itemType)).sort((h,f)=>Ws(h.itemValue,l)-Ws(f.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===Ll,m=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Ws(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(Ws(n,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:Rh(n,!0,!0),itemType:Ll};return Aa({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:h})}else return{error:oUe}}function ZCe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:o,matchUp:s,event:l,score:u}){var c;let d=Me(n,void 0,!0);for(let m of(d==null?void 0:d.tieMatchUps)||[])m.matchUpId===s.matchUpId&&(m.winningSide=r,m.score=u,!br({score:u})&&!e?Object.assign(m,{...lR}):e&&(m.matchUpStatus=e));a=a??((c=In({matchUp:s,structure:o,drawDefinition:t,event:l}))==null?void 0:c.tieFormat);let{winningSide:p}=Gw({matchUp:d,drawDefinition:t,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:p}}function e1e(t){var e;let{tournamentRecord:i,inContextMatchUp:r,structure:n,drawDefinition:a}=t,o=r.roundNumber,s=r.sides.find(w=>w.sideNumber===r.winningSide),l=r.sides.find(w=>w.sideNumber!==r.winningSide),{drawPosition:u,participantId:c}=s,{drawPosition:d,participantId:p}=l,m="swapWinnerLoser",{matchUps:h}=qt(t),f=h.filter(({drawPositions:w,roundNumber:U})=>(w==null?void 0:w.includes(u))&&U>o);Ga({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:f}),f.forEach(w=>{var U,T;w.drawPositions=((U=w.drawPositions)==null?void 0:U.map(D=>D===u?d:D))||[],Et({tournamentId:i==null?void 0:i.tournamentId,eventId:(T=t.event)==null?void 0:T.eventId,context:m,drawDefinition:a,matchUp:w})});let{stage:g,stageSequence:v}=n,y=a.structures.filter(({stage:w,stageSequence:U})=>w===g&&U>v).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:I,winnerTargetLink:b}}=t.targetData,S=[I==null?void 0:I.target.structureId,(e=b==null?void 0:b.target)==null?void 0:e.structureId].filter(Boolean);return a.structures.filter(({stage:w,structureId:U})=>w!==g&&S.includes(U)).forEach(({stage:w,stageSequence:U,structureId:T})=>{y.includes(T)||y.push(T),a.structures.filter(({stage:D,stageSequence:P})=>D===w&&P>U).forEach(({structureId:D})=>{y.includes(D)||y.push(D)})}),a.structures.filter(({structureId:w})=>y.includes(w)).forEach(w=>{let{positionAssignments:U}=si({structure:w}),T=U==null?void 0:U.find(({participantId:P})=>P===c),D=U==null?void 0:U.find(({participantId:P})=>P===p);T&&(T.participantId=p),D&&(D.participantId=c)}),el({...t,context:m})}function nU(t){var e,i,r;let n="setMatchUpStatus";t.matchUpStatus&&[Ft,ir].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:a,disableScoreValidation:o,tournamentRecords:s,tournamentRecord:l,disableAutoCalc:u,enableAutoCalc:c,drawDefinition:d,matchUpStatus:p,winningSide:m,matchUpId:h,event:f,score:g}=t;if(!d)return{error:_e};if(p&&[Sl,Ma,ca,Qi].includes(p)&&m)return{error:le,winningSide:m,matchUpStatus:p};if(![void 0,...bJ].includes(p))return te({result:{error:cv},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let v=ln({drawDefinition:d}),{matchUps:y}=gr({nextMatchUps:!0,tournamentRecord:l,inContext:!0,drawDefinition:d,matchUpsMap:v,event:f}),I=v.drawMatchUps.find(B=>B.matchUpId===h),b=y==null?void 0:y.find(B=>B.matchUpId===h);if(!I||!y)return{error:fn};if((I.winningSide||m)&&p===jt)return{context:"Cannot have Bye with winningSide",error:KU,matchUpStatus:p};let S=b==null?void 0:b.structureId,{structure:w}=rt({drawDefinition:d,structureId:S}),U=Ji(gi)(I.matchUpType),T=(e=b==null?void 0:b.drawPositions)==null?void 0:e.filter(Boolean),D=b==null?void 0:b.matchUpTieId,P=On({matchUpId:D||h,inContextDrawMatchUps:y,drawDefinition:d});Object.assign(t,{inContextDrawMatchUps:y,inContextMatchUp:b,matchUpTieId:D,matchUpsMap:v,targetData:P,structure:w,matchUp:I});let E=np(t),R;if(U){if(u)_t({extension:{name:$m,value:!0},element:I});else if(c){let B=I.winningSide,{winningSide:V,scoreStringSide1:G,scoreStringSide2:j,set:z}=Gw({drawDefinition:d,matchUpsMap:v,structure:w,matchUp:I,event:f}),W={scoreStringSide1:G,scoreStringSide2:j,sets:z?[z]:[]};if(R=V!==B,E&&R)return te({stack:"winningSideWithDownstreamDependencies",result:{error:uP},context:{winningSide:m,matchUp:I}});Dn({name:$m,element:I}),Object.assign(t,{winningSide:V,dualWinningSideChange:R,projectedWinningSide:V,score:W})}Hw({tournamentId:l==null?void 0:l.tournamentId,inContextDualMatchUp:b,eventId:f==null?void 0:f.eventId,dualMatchUp:I,drawDefinition:d})}if(U&&p&&[Ch].includes(p))return{info:"Not supported for matchUpType: TEAM",error:le};if(g&&!U&&!o){let B=I.matchUpFormat??(w==null?void 0:w.matchUpFormat)??(d==null?void 0:d.matchUpFormat)??(f==null?void 0:f.matchUpFormat),V=E_({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:B,matchUpStatus:p,winningSide:m,score:g});if(V.error)return V}let N=((i=Bt({policyTypes:[uy,vo],tournamentRecord:l,drawDefinition:d,event:f}))==null?void 0:i.appliedPolicies)??{};At(t.policyDefinitions)&&Object.assign(N,t.policyDefinitions);let A=i1e({assignedDrawPositions:T,inContextMatchUp:b,appliedPolicies:N,drawDefinition:d,matchUpStatus:p,structure:w,matchUp:I});if(A!=null&&A.error)return A;let M=(b==null?void 0:b.stage)===Je&&b.finishingRound===1,C=M&&m,O=M&&I.winningSide&&!m&&(!t.matchUpStatus||t.matchUpStatus&&PM({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!br({outcome:t.outcome})),k=C&&m!==I.winningSide&&I.winningSide;if(Object.assign(t,{qualifierAdvancing:C,qualifierChanging:k,removingQualifier:O,appliedPolicies:N}),D){let{matchUp:B}=Ti({matchUpId:D,inContext:!0,drawDefinition:d,matchUpsMap:v,event:f});if(B){let V=(r=In({matchUp:B,drawDefinition:d,structure:w,event:f}))==null?void 0:r.tieFormat,{projectedWinningSide:G}=ZCe({drawDefinition:d,matchUpStatus:p,dualMatchUp:B,matchUpsMap:v,winningSide:m,tieFormat:V,structure:w,matchUp:I,event:f,score:g}),j=B.winningSide;R=G!==j;let z=B._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:R,projectedWinningSide:G,autoCalcDisabled:z,matchUpTieId:D,dualMatchUp:B,tieFormat:V})}}let x=Ew({matchUpStatus:p});if(!D){if(E&&!m&&(p&&PM({matchUpStatus:p})||p&&[ir,pr].includes(p)))return{error:KU,activeDownstream:E,winningSide:m};if(m&&m===I.winningSide&&p&&!x)return{context:"winningSide must include directing matchUpStatus",error:KU,directingMatchUpStatus:x,matchUpStatus:p}}let{schedule:F}=t;if(F){let B=JR({disableNotice:!0,tournamentRecords:s,tournamentRecord:l,drawDefinition:d,matchUpId:h,schedule:F});if(B.error)return B}let $=!U&&!R&&m&&I.winningSide&&I.winningSide!==m;if(a&&$&&I.roundPosition)return e1e(t);let _=m&&!D||t.projectedWinningSide;ka({activeDownstream:E,matchUpWinner:_,method:n,winningSide:m});let L=!E&&QCe(t)||_&&t1e(t)||(x||t.autoCalcDisabled)&&wte(t)||{error:L9};return te({result:L,stack:n})}function t1e(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?wte(t):te({stack:"winningSideWithDownstreamDependencies",result:{error:uP},context:{winningSide:i,matchUp:e}})}function wte(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!br({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&Qi||t.winningSide&&Ki||Ma:t.matchUpStatus||Ki,o=t.removeScore||[Sl,Ft].includes(a)&&![Ma,ca].includes(a),s=el({...t,matchUpStatus:a,removeWinningSide:n,context:"sms",removeScore:o});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=rc({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:r});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function i1e({assignedDrawPositions:t,inContextMatchUp:e,appliedPolicies:i,drawDefinition:r,matchUpStatus:n,structure:a,matchUp:o}){var s,l;if(((s=i==null?void 0:i[vo])==null?void 0:s.requireParticipantsForScoring)===!1)return{...Q};let u=(l=e==null?void 0:e.sides)==null?void 0:l.map(p=>p.participantId).filter(Boolean).length,c=o!=null&&o.sides?[]:si({structureId:a==null?void 0:a.structureId,drawDefinition:r}).positionAssignments,d=u&&u===2||o.collectionId&&Yn({structure:a})&&u&&u>=1||(t==null?void 0:t.length)===2&&(c==null?void 0:c.filter(p=>t.includes(p.drawPosition)).every(p=>p.participantId));return n&&yJ.includes(n)&&!d?te({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:n,requiredParticipants:d},result:{error:cv}}):{...Q}}function Ute({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:_e};let{matchUp:n}=Ti({drawDefinition:e,matchUpId:i,event:r});return(n==null?void 0:n.matchUpType)!==Va?{error:ua}:nU({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function Ste({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:_e};if(!i)return{error:bn};let{matchUp:r}=Ti({drawDefinition:t,event:e,matchUpId:i});return r?Dn({name:xP,element:r}):{error:fn}}function r1e({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:o}){var s,l,u,c,d;let p="substituteParticipant";if(!r)return{error:_e};if(!a)return{error:bn};if(!e||!t)return te({result:{error:fr},stack:p});let{matchUp:m}=Ti({drawDefinition:r,matchUpId:a,event:o});if(!m)return{error:fn};if(!m.collectionId)return te({result:{error:ua},stack:p});let h=ln({drawDefinition:r}),{matchUps:f}=gr({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:r,matchUpsMap:h}),g=f==null?void 0:f.find(y=>y.matchUpId===a),v=(l=(s=f==null?void 0:f.find(y=>y.matchUpId===(g==null?void 0:g.matchUpTieId)))==null?void 0:s.sides)==null?void 0:l.find(y=>y.participant.individualParticipants.some(({participantId:I})=>I===e));return!v||n&&v.sideNumber!==n?{error:ks}:(d=(c=(u=v.participant)==null?void 0:u.individualParticipants)==null?void 0:c.map(Tt).filter(y=>y!==e))!=null&&d.includes(t)?D$({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:o}):te({result:{error:ks},stack:p})}function Tte(t){return r1e(t)}function Dte({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:_e};let{matchUp:r}=Ti({drawDefinition:t,matchUpId:e,event:i});return _t({extension:{name:$m,value:!0},element:r})}function Pte(t){let e="setMatchUpFormat",i=We(t,[{tournamentRecord:!0},{[Jr]:S=>Ea({matchUpFormat:S}),[za]:Zb,matchUpFormat:!0}]);if(i.error)return te({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:m,event:h,force:f}=t;if(a&&!Array.isArray(a))return te({result:{error:le,scheduledDates:a},stack:e});if(u&&!iP([cl,go],u))return te({result:{error:ql},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],I=t.drawIds||m&&[m].filter(Boolean)||[];if((l||v!=null&&v.length)&&!n)return te({result:{error:_e},stack:e});if(m&&c&&n){let S=A_({tournamentRecord:r,drawDefinition:n,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:c});if(S.error)return S;g+=1}let b=S=>{let w=[];for(let U of S.structures||[]){if(Array.isArray(p)&&!p.includes(U.stage)||Array.isArray(o)&&!o.includes(U.stageSequence)||v!=null&&v.length&&!v.includes(U.structureId))continue;v!=null&&v.length&&U.matchUpFormat!==s&&(U.matchUpFormat=s,w.push(U.structureId),g+=1);let T=((f||a)&&qt({matchUpFilters:{matchUpStatuses:[Qi]},structure:U}).matchUps)??[],D=(a&&qt({matchUpFilters:{matchUpStatuses:[Qi]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:U}).matchUps)??[];if(T!=null&&T.length){let P=D?D.map(Pr):T.map(Pr);for(let E of T)P.includes(E.matchUpId)&&(E.matchUpFormat=a!=null&&a.length?s:void 0,Et({tournamentId:r==null?void 0:r.tournamentId,eventId:h==null?void 0:h.eventId,context:e,drawDefinition:S,matchUp:E}))}}return!w.length&&S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1),w};for(let S of(r==null?void 0:r.events)||[])if(!(y!=null&&y.length&&!y.includes(S.eventId)||u&&u!==S.eventType||u===cr))if(Array.isArray(o)||Array.isArray(p)||v!=null&&v.length||I!=null&&I.length)for(let w of S.drawDefinitions||[]){if(Array.isArray(I)&&!I.includes(w.drawId))continue;let U=b(w);ui({structureIds:U,drawDefinition:w})}else S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1);return g?{...Q,modificationsCount:g}:{...Q,info:hv}}function O$({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){var a,o;if(!i)return{error:_e};let s=(a=Ti({drawDefinition:i,matchUpId:r}))==null?void 0:a.matchUp;if(!(s!=null&&s.tieMatchUps))return{error:ua};let l=(o=Ti({inContext:!0,drawDefinition:i,matchUpId:r,event:n}))==null?void 0:o.matchUp,u=0;return((s==null?void 0:s.sides)||[]).forEach(c=>{c.lineUp&&delete c.lineUp}),((l==null?void 0:l.sides)||[]).forEach(c=>{if(u+=1,t===!1){let d=l==null?void 0:l.tieFormat,p=c.participantId;d&&p&&jh({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}Et({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:n==null?void 0:n.eventId,drawDefinition:i,matchUp:s})}),{...Q,modificationsCount:u}}function Rte(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n,setTBlast:a}=t;if(!n)return{sets:[]};let o=n.sets||[],s=$l({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:o}),l=$l({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:o}),u=$l({matchUpFormat:e,matchUpStatus:i,winningSide:r,setTBlast:a,sets:o}),c=s===u?l:s;return r&&(s=r===1?u:c,l=r===2?u:c),{score:{sets:o,scoreStringSide1:s,scoreStringSide2:l}}}function aU(t){var e,i;let r=We(t,[{[wl]:!0,[$n]:!0}]);if(r.error)return r;let n=Po(t);if(!t.drawDefinition){let b=t.tournamentRecord??(t.tournamentId&&n[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=b);let S=Kn({eventId:t.eventId,drawId:t.drawId,tournamentRecord:b});if(S.error)return S;S.drawDefinition&&(t.drawDefinition=S.drawDefinition),t.event=S.event}let{disableScoreValidation:a,policyDefinitions:o,tournamentRecord:s,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpId:d,schedule:p,event:m,notes:h}=t,f=t.matchUpFormat||((e=t.outcome)==null?void 0:e.matchUpFormat),{policy:g}=Mp({policyType:vo,tournamentRecord:s,event:m}),v=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(g==null?void 0:g.allowChangePropagation)!==void 0&&g.allowChangePropagation||void 0,{outcome:y,setTBlast:I}=t;if(y!=null&&y.winningSide&&![1,2].includes(y.winningSide))return{error:sP};if(f){let b=A_({tournamentRecord:s,drawDefinition:c,matchUpFormat:f,matchUpId:d,event:m});if(b.error)return b}if((i=y==null?void 0:y.score)!=null&&i.sets&&!y.score.scoreStringSide1){let{score:b}=Rte({...y,setTBlast:I});y.score=b,y.score.sets=y.score.sets.filter(S=>S.side1Score||S.side2Score||S.side1TiebreakScore||S.side2TiebreakScore)}return nU({matchUpStatusCodes:y==null?void 0:y.matchUpStatusCodes,matchUpStatus:y==null?void 0:y.matchUpStatus,winningSide:y==null?void 0:y.winningSide,allowChangePropagation:v,disableScoreValidation:a,score:y==null?void 0:y.score,tournamentRecords:n,policyDefinitions:o,tournamentRecord:s,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpFormat:f,matchUpId:d,schedule:p,event:m,notes:h})}function Ete(t){if(!(t!=null&&t.outcomes))return{error:Qe};if(!Array.isArray(t.outcomes))return{error:Qe,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:ve};let o=i.filter(s=>s.tournamentId===n);if(o.length){let s=n1e({outcomes:o,tournamentRecord:a});if(s.error)return s}}return{...Q}}function n1e(t){var e;let{tournamentRecords:i,tournamentRecord:r,outcomes:n,policyDefinitions:a}=t,o={};n.forEach(s=>{let{eventId:l}=s;o[l]||(o[l]=[]),o[l].push(s)});for(let s of Object.keys(o)){let{event:l}=Kn({tournamentRecord:r,eventId:s});for(let u of o[s]){let{drawId:c}=u,d=(e=l==null?void 0:l.drawDefinitions)==null?void 0:e.find(p=>p.drawId===c);if(d&&c){let{matchUpFormat:p,matchUpId:m}=u,h=aU({schedule:u==null?void 0:u.schedule,tournamentRecords:i,policyDefinitions:a,tournamentRecord:r,drawDefinition:d,matchUpFormat:p,matchUpId:m,outcome:u,drawId:c,event:l});if(h.error)return h}}}return{...Q}}function a1e({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){var n,a;if(!r&&!t)return{error:_e};if(!i)return{error:Qe,info:"missing outcome"};if(!r&&!e)return{error:la};if(!r){let o=Ti({drawDefinition:t,matchUpId:e});if(o.error)return o;r=o.matchUp}return typeof i!="object"||!((n=i.score)!=null&&n.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:le}:_t({element:r,extension:{name:xP,value:i}})}function Cte(t){return a1e(t)}function k$(t){var e,i;let r="resetTieFormat",{drawDefinition:n,event:a,uuids:o}=t,s=We(t,[{[Ur]:!0,[wl]:!0}],r);if(s.error)return s;let l=Av(t,[{[vv]:nu}]);if(l[Ko])return l;let u=(e=t.tournamentRecord)==null?void 0:e.tournamentId,{matchUp:c,structure:d}=(l==null?void 0:l.matchUp)??{};if(!(c!=null&&c.tieMatchUps))return te({result:{error:ua},info:"Must be a TEAM matchUp",stack:r});if(!c.tieFormat)return{...Q};let p=(i=In({structure:d,drawDefinition:n,event:a}))==null?void 0:i.tieFormat;if(!p)return te({result:{error:jr},info:"No inherited tieFormat",stack:r});let m=[],h=[],f=[],g=[];for(let v of p.collectionDefinitions){let{matchUpCount:y,collectionId:I}=v;h.push(I);let b=(c.tieMatchUps||[]).filter(S=>S.collectionId===I);if(b.length>y)b.sort((S,w)=>(S.matchUpStatus===Qi?1:0)-(w.matchUpStatus===Qi?1:0)),f.push(...b.slice(0,y)),m.push(...b.slice(3).map(Pr));else if(f.push(...b),b.length<y){let S=y-b.length,w=Vw({collectionDefinition:v,matchUpsLimit:S,matchUp:c,uuids:o});g.push(...w)}}for(let v of(c==null?void 0:c.tieMatchUps)||[])v.collectionId&&!h.includes(v.collectionId)&&m.push(v.matchUpId);return g.length&&(f.push(...g),Fc({eventId:a==null?void 0:a.eventId,matchUps:g,drawDefinition:n,tournamentId:u})),m.length&&ec({matchUpIds:m,eventId:a==null?void 0:a.eventId,drawDefinition:n,tournamentId:u}),c&&(c.tieMatchUps=f,c.tieFormatId=void 0,c.tieFormat=void 0,Et({structureId:d==null?void 0:d.structureId,eventId:a==null?void 0:a.eventId,context:r,drawDefinition:n,tournamentId:u,matchUp:c})),{...Q,newMatchUps:g,deletedMatchUpIds:m}}function x$(t){var e,i,r;let{tournamentRecord:n,drawDefinition:a,matchUpId:o,event:s}=t,l="resetScorecard";if(!a)return te({result:{error:_e},stack:l});if(!o)return te({result:{error:bn},stack:l});if(!Pi(o))return te({result:{error:le,matchUpId:o},stack:l});let u=ln({drawDefinition:a}),{matchUps:c}=gr({nextMatchUps:!0,inContext:!0,drawDefinition:a,matchUpsMap:u}),d=u.drawMatchUps.find(y=>y.matchUpId===o),p=c==null?void 0:c.find(y=>y.matchUpId===o);if(!d||!c)return{error:fn};if(d.matchUpType!==Ca)return{error:ua};let m=On({inContextDrawMatchUps:c,drawDefinition:a,matchUpId:o}),h=p==null?void 0:p.structureId,{structure:f}=rt({drawDefinition:a,structureId:h});if(Object.assign(t,{inContextDrawMatchUps:c,inContextMatchUp:p,matchUpsMap:u,targetData:m,structure:f,matchUp:d}),np(t))return{error:uP};if((e=d.tieMatchUps)!=null&&e.length)for(let y of d.tieMatchUps){let I=nU({matchUpId:y.matchUpId,matchUpTieId:o,winningSide:void 0,removeScore:!0,tournamentRecord:n,drawDefinition:a,event:s});if(I.error)return te({result:I,stack:l})}let g=(i=Bt({tournamentRecord:n,drawDefinition:a,event:s}))==null?void 0:i.appliedPolicies,v=rc({event:t.event,removeScore:!0,tournamentRecord:n,appliedPolicies:g,drawDefinition:a,matchUpsMap:u,matchUpId:o});if(v.error)return te({result:v,stack:l});if(t.tiebreakReset&&!v.tieFormatRemoved){let y=(r=In({drawDefinition:a,structure:f,event:s}))==null?void 0:r.tieFormat;if(d.tieFormat&&y){let{matchUpCountDifference:I,descendantDifferences:b,ancestorDifferences:S,valueDifference:w}=Vu({descendant:d.tieFormat,ancestor:y});if(b.collectionIds.length===1&&!S.collectionIds.length&&!S.groupsCount&&I===1&&w===1){let U=k$({tournamentRecord:n,drawDefinition:a,matchUpId:o,event:s});if(U.error)return U}}}return{...Q}}function Mte(t){let e=We(t,[{[$n]:!0,[td]:!0},{[ug]:{[uw]:!1,roundNumbers:!1},[aJ]:"At least one must be provided",[Xn]:dn}]);if(e.error)return e;let i=OQ(t);if(i.error)return i;let{matchUpIds:r}=i,n=Ji(Ca)(t.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=t;for(let l of r){if(n){let c=x$({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(c.error||t.removeAssignments&&O$({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return c}let u=nU({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(u.error)return u;if(t.removeAssignments){let c=P$({...t,matchUpId:l});if(c.error)return c}}return{...Q}}function o1e({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){var r;if(!e)return{error:_e};let n="setOrderOfFinish";if(!Array.isArray(i))return te({info:ip("finishingOrder"),result:{error:le},stack:n});let{completedMatchUps:a,matchUpsMap:o}=Tv({inContext:!0,drawDefinition:e}),s=(a==null?void 0:a.map(Pr))??[],l=i.map(Pr),{matchUpTypes:u,roundNumbers:c,structureIds:d,matchUpTieIds:p}=(a??[]).filter(({matchUpId:I})=>l.includes(I)).reduce((I,b)=>{let{matchUpTieId:S,matchUpType:w,roundNumber:U,structureId:T}=b;return I.matchUpTypes.includes(w)||I.matchUpTypes.push(w),I.roundNumbers.includes(U)||I.roundNumbers.push(U),I.structureIds.includes(T)||I.structureIds.push(T),I.matchUpTieIds.includes(S)||I.matchUpTieIds.push(S),I},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(u.length>1||p.length>1||c.length>1||d.length>1)return te({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:le},stack:n});let m,h,f={},g=[],v=[];if(!i.every(({orderOfFinish:I,matchUpId:b})=>(g.push(b),I&&v.push(I),f[b]=I,m=s.includes(b),h=I===void 0||st(I)&&Math.floor(I)>0,m&&h)))return te({result:{error:m?le:cv},info:!m&&"matchUps must be completed"||!h&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:n});let y=a==null?void 0:a.filter(I=>I.structureId===d[0]&&I.roundNumber===c[0]&&I.matchUpType===u[0]&&I.matchUpTieId===p[0]&&!g.includes(I.matchUpId));for(let I of y??[]){let{orderOfFinish:b}=I||{};if(b){if(!st(b))return te({context:{orderOfFinish:b,matchUp:I},result:{error:le},stack:n});v.push(b)}}if(EK(v).length!==v.length||Math.max(...v)>v.length)return te({info:"Values not unique or greater than expected number of values",result:{error:le},stack:n});if(d.length){let I=QP({matchUpFilters:{matchUpIds:l},structureId:d[0],drawDefinition:e,matchUpsMap:o});if(I.error)return te({result:I,stack:n});(r=I.completedMatchUps)==null||r.forEach(b=>{b.orderOfFinish=f[b.matchUpId],Et({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:b})})}return{...Q}}function Nte(t){return o1e(t)}function Ate(t){var e,i,r,n;let{tournamentRecord:a,drawDefinition:o,matchUpId:s,lineUps:l,event:u}=t,c="applyLineUps",d=We(t,[{[Ur]:!0,[$n]:!0,[wl]:!0},{lineUps:!0,[Xn]:dn}],c);if(d.error)return d;let p=a.participants||[],m=Ti({tournamentParticipants:p,inContext:!0,drawDefinition:o,matchUpId:s});if(m.error)return m;if(!m.matchUp)return{error:fn};let{matchUp:h,structure:f}=m,{drawPositions:g,matchUpType:v}=h;if(v!==gi)return{error:ua};if(!(g!=null&&g.length))return{error:Xb};let y=(e=In({matchUp:h,drawDefinition:o,structure:f,event:u}))==null?void 0:e.tieFormat,I={};for(let S of l){if(!Array.isArray(S))return{error:le,lineUp:S};let w={},U=[];for(let R of S){if(typeof R!="object")return{error:le,lineUpAssignment:R};let{participantId:N,collectionAssignments:A=[]}=R;if(!Array.isArray(A))return{error:le,collectionAssignments:A};let M=p.find(O=>O.participantId===N);if(!M)return{error:Wi};if(M.participantType!==Dt)return{error:xs};let C=(r=(i=h.sides)==null?void 0:i.find(O=>{var k,x;return(x=(k=O.participant)==null?void 0:k.individualParticipantIds)==null?void 0:x.includes(N)}))==null?void 0:r.sideNumber;C&&U.push(C);for(let O of A){if(typeof O!="object")return{error:le,collectionAssignment:O};let{collectionId:k,collectionPosition:x}=O,F=(n=y==null?void 0:y.collectionDefinitions)==null?void 0:n.find(L=>L.collectionId===k);if(!F)return{error:le,collectionId:k};let $=`${k}-${x}`;w[$]||(w[$]=[]);let _=w[$].length;if(Ji(ri)(F.matchUpType)&&_||F.matchUpType===ei&&_>1)return{info:"Excessive collectionPosition assignments",error:le};w[$].push(N)}}let T=Object.values(w);for(let R of T)if(R.length===2){let{participant:N}=ls({tournamentParticipants:p,participantIds:R});if(!N){let A=fl({participant:{participantType:gt,participantRole:en,individualParticipantIds:R},pairOverride:!0,tournamentRecord:a});if(A.error)return A}}let D=Ra(U),P=(D[1]||0)>(D[2]||0)&&1||(D[2]||0)>(D[1]||0)&&2||void 0,E=Object.keys(I).map(R=>parseInt(R));P&&!E.includes(P)&&(I[P]=S)}if(!Object.keys(I).length)return{error:dF};if(m=Ti({drawDefinition:o,matchUpId:s}),m.error)return m;if(!m.matchUp)return{error:fn};let{matchUp:b}=m;b.sides||(b.sides=[]);for(let S of[1,2]){let w=b.sides.find(T=>T.sideNumber===S),U=I[S];if(U)w?w.lineUp=U:b.sides.push({lineUp:U,sideNumber:S});else continue}return Et({tournamentId:a==null?void 0:a.tournamentId,context:c,drawDefinition:o,matchUp:b}),{...Q}}var F$={};wt(F$,{anonymizeTournamentRecord:()=>eie,generate:()=>Ote,generateEventWithDraw:()=>tE,generateOutcome:()=>H$,generateOutcomeFromScoreString:()=>L$,generateParticipants:()=>$v,generateTournamentRecord:()=>Qte,modifyTournamentRecord:()=>tie,mutate:()=>Zte});var Ote={};wt(Ote,{generateEventWithDraw:()=>tE,generateOutcome:()=>H$,generateOutcomeFromScoreString:()=>L$,generateParticipants:()=>$v,generateTournamentRecord:()=>Qte});function L$(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n,setTBlast:a}=t;if(!n)return{outcome:{...lR,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:le,winningSide:r};let o=n&&w0({scoreString:n}),s={},l=$l({sets:o,matchUpFormat:e,setTBlast:a}),u=$l({sets:o,reversed:!0,matchUpFormat:e,setTBlast:a});return r===2?(s.scoreStringSide1=u,s.scoreStringSide2=l):(s.scoreStringSide1=l,s.scoreStringSide2=u),s.sets=w0({scoreString:s.scoreStringSide1}),Ge({outcome:{matchUpStatus:i,winningSide:r,score:s}})}function _$({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){var n;let a=(((n=e==null?void 0:e[r.matchUpId])==null?void 0:n.matchUpIds)||[]).filter(o=>i.includes(o)).filter(o=>!t[o]);return{dependenciesScheduled:!(a!=null&&a.length),remainingDependencies:a}}function oU({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function s1e({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function Sy({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var u,c;let d=Si((u=l==null?void 0:l.schedule)==null?void 0:u.endTime),p=d?na(d,tt(o)):na(s,tt(r)+tt(o)),m=i&&(d?na(Si(d),i):na(s,tt(r)+tt(i))),h=((c=a==null?void 0:a[l.matchUpId])==null?void 0:c.participantIds)||[],f=(l.roundPosition&&t[l.matchUpId]||[]).flat();h.forEach(g=>{oU({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&m||p;f.includes(g)?s1e({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),yg({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:p,matchUp:l})}function kte({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){var a,o,s,l,u;let c,d=(o=(a=n.minutesMap)==null?void 0:a[r])==null?void 0:o.recoveryMinutes,p=(((l=(s=n.minutesMap)==null?void 0:s[r])==null?void 0:l.averageMinutes)||0)+(d||0),m=na(i,p),h=((u=e==null?void 0:e[r])==null?void 0:u.dependentMatchUpIds)||[];if(h.length){let f=h.reduce((g,v)=>{let y=t[v];if(!y)return g;let I={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||kt(y)<kt(g.scheduleTime)?I:g},{});f.scheduleTime&&kt(m)>kt(f.scheduleTime)&&(c=f)}return{scheduledDependent:c}}function l1e(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>{var n;return i===ei&&(((n=r==null?void 0:r.participant)==null?void 0:n.individualParticipants)||[])||(r==null?void 0:r.participant)&&[r.participant]||[]}).flat()}var sU="DO_NOT_SCHEDULE",u1e={DO_NOT_SCHEDULE:sU};function $$({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:o}){let s=l1e(o).map(({person:m})=>m==null?void 0:m.personId);if(i){let m=((o==null?void 0:o.potentialParticipants)||[]).flat().map(({person:h})=>h==null?void 0:h.personId);s.push(...m)}let l=s.map(m=>{var h;return(h=r[m])==null?void 0:h.map(f=>({...f,personId:m}))}).filter(Boolean).flat().filter(m=>m.requestType===sU&&Yl(a,m.date)),u=[],c=o==null?void 0:o.matchUpId,d=nr(Si(n),ht(a)),p=Si(TF(d,t).toISOString());for(let m of l){let{requestId:h,startTime:f,endTime:g}=m;(n>f&&n<g||p>f&&p<g)&&(u.push({matchUpId:c,request:m,scheduleTime:n}),e[h]?(e[h].scheduleTimes.includes(n)||e[h].scheduleTimes.push(n),e[h].matchUpIds.includes(c)||e[h].matchUpIds.push(c)):e[h]={request:m,scheduleTimes:[n],matchUpIds:[c]})}return{conflicts:u}}function XM({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=jP(i),o=(t[i.matchUpId]||[]).filter(s=>!Nn(s,a)).flat();[...a,...o].forEach(s=>{if(oU({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[Xo]?l[Xo]+=r:r>0&&(l[Xo]=r),o.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function c1e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){var p,m;let h=[];i||(n=d==null?void 0:d.filter(v=>{let y=v.schedule||{},I=v.matchUpStatus===jt;return I&&h.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!I&&Zw({schedule:y})&&(!u||v.schedule.scheduledDate===u)}),i=n.map(Pr));let f=Array.isArray(l)?l.includes(u):l,g=f?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of g){XM({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(p=v.schedule)==null?void 0:p.scheduledTime;if(y){o[v.matchUpId]=y;let I=(m=c==null?void 0:c[v.matchUpId])==null?void 0:m.recoveryMinutes;Sy({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:r,recoveryMinutes:I,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:h,dateScheduledMatchUps:n,clearDate:f}}function XR({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:o,matchUps:s}){if(typeof r!="object")return{error:ki};if(!Co(s)&&!Array.isArray(i))return{error:Qu};a=a??HR({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:m}=gw({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:m}}})).flat()),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return Zw({schedule:p})&&(!o||d.schedule.scheduledDate===o)}));let c=i==null?void 0:i.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!==jt);return{bookings:c==null?void 0:c.map(({eventId:d,schedule:p,matchUpFormat:m})=>{let{event:h,scheduleTiming:f}=l[d],g=h==null?void 0:h.eventType,v={...f,defaultTiming:u,matchUpFormat:m},{averageMinutes:y,recoveryMinutes:I}=YP({timingDetails:v,eventType:g}),{courtId:b,venueId:S}=p,w=Si(p.scheduledTime),U=na(w,y);return{recoveryMinutes:I,averageMinutes:y,periodLength:a,startTime:w,courtId:b,endTime:U,venueId:S}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function d1e({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),typeof a!="object"||!Object.keys(a).length)return{error:ki};s=s??HR({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:m,venues:h}=nc({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),f=(m==null?void 0:m.filter(S=>!c||c.includes(S.venueId)))??[];u=u??bg({courts:f,scheduleDate:l,startTime:!0}),p=p??bg({courts:f,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=XR({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:c,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:s,startTime:u,bookings:g,endTime:p,courts:f},{scheduleTimes:I}=w$(y),b=(c==null?void 0:c.length)===1&&c[0]||(h==null?void 0:h.length)===1&&h[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(Na("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:I,venueId:b}}function p1e({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,o,s,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(n=n.concat(u.matchUpIds)),u.hash!==l&&!i&&(l=u.hash,r.push({averageMinutes:s,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:n}),n=u.matchUpIds),s=i?e:u.averageMinutes,o=u.recoveryMinutes,a=u.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:o,averageMinutes:s}),{groupedRounds:r}}function xte({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:m,venues:h}){var f;let g={},v=[],y=[],I=[];for(let b of h){let{rounds:S=[],venueId:w}=b,{scheduledRoundsDetails:U,greatestAverageMinutes:T,orderedMatchUpIds:D,minutesMap:P}=Xw({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:u,matchUps:p,rounds:S});I.push(...D??[]);let{groupedRounds:E}=p1e({scheduledRoundsDetails:U,greatestAverageMinutes:T,garmanSinglePass:!0}),R,N=[];d&&({scheduleTimes:N,dateScheduledMatchUpIds:R}=d1e({averageMatchUpMinutes:(f=E[0])==null?void 0:f.averageMinutes,scheduleDate:ht(c),venueIds:[b.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:u,matchUps:p}));let A=c1e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:R,greatestAverageMinutes:T,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:c,minutesMap:P,matchUps:p});({dateScheduledMatchUpIds:R}=A);let M=A,{byeScheduledMatchUpDetails:C,clearDate:O}=A;C!=null&&C.length&&y.push(...C);let{matchUpsToSchedule:k,matchUpMap:x}=CR({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:R,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:D,clearDate:O,matchUps:p}),F=m.filter($=>$.venueId===w);g[w]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:T,scheduledRoundsDetails:U,dateScheduledMatchUps:M,matchUpsToSchedule:k,scheduleTimes:N,groupedRounds:E,venueCourts:F,minutesMap:P,matchUpMap:x},s||v.push(...R)}return{allDateScheduledByeMatchUpDetails:y,allDateScheduledMatchUpIds:v,venueScheduledRoundDetails:g,allDateMatchUpIds:I}}function m1e(t,e){let i=kt(t.scheduleTime),r=kt(t.timeAfterRecovery),n=kt(e.scheduleTime),a=kt(e.timeAfterRecovery),o=i===n||r===a,s=i>n&&i<a,l=n>i&&n<r,u=r>n&&r<a,c=a>i&&a<r;return Ge({hasOverlap:o||s||u||l||c,startAisContained:s,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function B$({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){var o,s,l,u,c;let d=(((o=i==null?void 0:i[n.matchUpId])==null?void 0:o.participantIds)||[]).flat(),p=((l=(s=a==null?void 0:a.minutesMap)==null?void 0:s[n.matchUpId])==null?void 0:l.averageMinutes)||0,m=((c=(u=a==null?void 0:a.minutesMap)==null?void 0:u[n.matchUpId])==null?void 0:c.recoveryMinutes)||0,h=d.every(v=>{var y;oU({individualParticipantProfiles:t,participantId:v});let I=t[v];if(!I.timeAfterRecovery)return!0;let b=Si((y=n==null?void 0:n.schedule)==null?void 0:y.endTime),S=b?na(b,tt(m)):na(r,tt(p)+tt(m));return![...Object.keys(I.potentialBookings).filter(w=>w!==n.drawId).map(w=>I.potentialBookings[w]).flat(),...I.bookings].find(w=>m1e({scheduleTime:r,timeAfterRecovery:S},w).hasOverlap)}),f=e[n.matchUpId],g=(f?rw(nr(f),nr(r),!1):0)>=0;return{enoughTime:h&&g}}function Fte({autoSchedulingAudit:t,tournamentRecords:e}){var i;ut({topic:Iu,payload:t});let r=s=>s?Object.values(s).reduce((l,u)=>l+u.length||0,0):0,n=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((u,c)=>u+c.rounds.length,0),0),a={scheduledDatesCount:(i=t.scheduledDates)==null?void 0:i.length,noTimeMatchUpIdsCount:r(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:r(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:r(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:r(t==null?void 0:t.requestConflicts),profileRoundsCount:n},o={itemType:qM,itemValue:a};for(let s of Object.values(e)){let l=s.tournamentId;vP(Iu)?ut({payload:{type:qM,tournamentId:l,detail:a},topic:Iu}):zw({tournamentRecord:s,timeItem:o})}}function V$({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=jP(r),{matchUpId:a,matchUpType:o}=r,s=(r.roundPosition&&t[a]||[]).flat(),l=dt(n.concat(...s));return l.forEach(u=>{oU({individualParticipantProfiles:e,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=e[u];if(c)return[o,Xo].find(d=>{var p;let m=((p=c.counters)==null?void 0:p[d])||0,h=i[d]||0;return m&&h&&m>=h})}),relevantParticipantIds:l}}function Ty({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:u,schedule:c}){var d,p,m;if(!s)return{error:ve};if(!l&&(!u||!Array.isArray(u)))return{error:bh};if(!l&&(!c||typeof c!="object"))return{error:N9};let h,f=[],g=0;if(r&&!n){let I=fs({tournamentRecords:o,tournamentRecord:s});n=I.matchUpDependencies,h=I.matchUps}h||(h=((d=Hr({tournamentRecord:s}))==null?void 0:d.matchUps)??[]);let v=h.reduce((I,b)=>{let{matchUpId:S,drawId:w,matchUpStatus:U}=b;return(e||U!==jt)&&(t||!yr.includes(U))&&(I[w]?I[w].push(S):I[w]=[S]),I},{}),y=l==null?void 0:l.map(I=>I.matchUpId);for(let I of Object.keys(v)){let{drawDefinition:b}=ld({tournamentRecord:s,drawId:I});if(!b)continue;let S=v[I].filter(U=>(u==null?void 0:u.includes(U))??(y==null?void 0:y.includes(U))),w=Pn({inContext:!1,drawDefinition:b}).matchUps;for(let U of S){let T=((p=l==null?void 0:l.find(P=>P.matchUpId===U))==null?void 0:p.schedule)||c,D=JR({schedule:T,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:h,tournamentRecords:o,tournamentRecord:s,checkChronology:r,drawDefinition:b,drawMatchUps:w,matchUpId:U});if((m=D==null?void 0:D.warnings)!=null&&m.length&&f.push(...D.warnings),D!=null&&D.success&&(g+=1),D.error)return D}}return f.length?{...Q,scheduled:g,warnings:f}:{...Q,scheduled:g}}function lU(t){var e;let{scheduleCompletedMatchUps:i=!1,scheduleByeMatchUps:r=!1,errorOnAnachronism:n,matchUpContextIds:a,removePriorValues:o,tournamentRecords:s,checkChronology:l,matchUpDetails:u,schedule:c}=t;if(t.matchUpIds&&!a)return Ty(t);let d=We(t,[{[gn]:!0},{[ug]:{matchUpContextIds:!1,matchUpDetails:!1},[za]:le,[Xn]:dn}]);if(d.error)return d;if((!u||a)&&!c)return{error:Qe,info:"schedule is required"};let p=[],m=0,{matchUpDependencies:h}=fs({tournamentRecords:s});for(let f of Object.values(s)){let{tournamentId:g}=f,v=a==null?void 0:a.filter(I=>I.tournamentId===g).map(Pr),y=u==null?void 0:u.filter(I=>(I==null?void 0:I.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let I=Ty({matchUpDetails:y,scheduleCompletedMatchUps:i,scheduleByeMatchUps:r,matchUpDependencies:h,errorOnAnachronism:n,removePriorValues:o,tournamentRecords:s,tournamentRecord:f,checkChronology:l,matchUpIds:v,schedule:c});if((e=I.warnings)!=null&&e.length&&p.push(...I.warnings),I.scheduled&&(m+=I.scheduled),I.error)return I}}return p.length?{...Q,scheduled:m,warnings:p}:{...Q,scheduled:m}}function h1e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:m,courts:h,dryRun:f}){var g,v,y,I,b,S,w;let U={},T={},D={},P={},E={},R={},N={},A={},M={},C={};for(let x of n){let F=ht(x==null?void 0:x.scheduleDate),$=(x==null?void 0:x.venues)||[],_={},L={},B=(J,H)=>{J.forEach(Z=>{let K=L[Z].counters;K[H]?K[H]+=1:K[H]=1,K[Xo]?K[Xo]+=1:K[Xo]=1})};D[F]={},P[F]={},U[F]={},T[F]={},N[F]=[],A[F]=[],M[F]=[],C[F]=[];let V={};m.forEach(J=>{var H;(H=J.schedule)!=null&&H.scheduledDate&&Yl(F,ht(J.schedule.scheduledDate))&&yg({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:V,matchUp:J})});let{allDateScheduledByeMatchUpDetails:G,venueScheduledRoundDetails:j,allDateMatchUpIds:z}=xte({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:V,matchUpScheduleTimes:R,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:F,matchUps:m,courts:h,venues:$}),W=10,q=0,Y,re=10;for(;!Y;){for(let{venueId:J}of $){let H=0,Z=j[J];for(;Z.courtsCount&&(g=Z.scheduleTimes)!=null&&g.length&&(v=Z.matchUpsToSchedule)!=null&&v.length&&H<=Z.courtsCount;){let{scheduleTime:K,attempts:ie=0}=Z.scheduleTimes.shift(),ae=Z.matchUpsToSchedule.find(oe=>{var ne,de;let{matchUpId:ye,matchUpType:ce}=oe,{participantIdsAtLimit:ke,relevantParticipantIds:we}=V$({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpDailyLimits:s,matchUp:oe});if(ke.length)return A[F].includes(ye)||A[F].push(ye),!1;let{scheduledDependent:Ze}=kte({matchUpScheduleTimes:R,matchUpDependencies:o,scheduleTime:K,matchUpId:ye,details:Z});if(Ze)return!1;let{dependenciesScheduled:pt,remainingDependencies:he}=_$({matchUpScheduleTimes:R,matchUpDependencies:o,allDateMatchUpIds:z,matchUp:oe});if(!pt)return P[F][ye]||(P[F][ye]=[]),P[F][ye].push({scheduleTime:K,remainingDependencies:he}),!1;let{enoughTime:fe}=B$({individualParticipantProfiles:L,matchUpNotBeforeTimes:V,matchUpDependencies:o,scheduleTime:K,details:Z,matchUp:oe});if(!fe)return D[F][ye]||(D[F][ye]=[]),D[F][ye].push({scheduleTime:K}),!1;let pe=Z.greatestAverageMinutes,{conflicts:Fe}=$$({potentials:e,averageMatchUpMinutes:pe,requestConflicts:C,personRequests:d,scheduleTime:K,scheduleDate:F,matchUp:oe});if(Fe!=null&&Fe.length)return E[F]||(E[F]=[]),E[F].push(...Fe),!1;B(we,ce);let Se=(de=(ne=Z.minutesMap)==null?void 0:ne[ye])==null?void 0:de.recoveryMinutes;return Sy({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpNotBeforeTimes:V,averageMatchUpMinutes:pe,matchUpDependencies:o,recoveryMinutes:Se,scheduleTime:K,matchUp:oe}),R[ye]=K,!0});Z.matchUpsToSchedule=Z.matchUpsToSchedule.filter(({matchUpId:oe})=>oe!==(ae==null?void 0:ae.matchUpId)),ae?H+=1:(T[F][J]||(T[F][J]=[]),T[F][J].push({scheduleTime:K,attempts:ie+1}))}(y=Z.matchUpsToSchedule)!=null&&y.length&&(T[F][J]=(I=T[F][J])==null?void 0:I.filter(K=>{let ie=K.attempts<W;return ie&&Z.scheduleTimes.push(K),!ie})),(!((b=Z.scheduleTimes)!=null&&b.length)||!((S=Z.matchUpsToSchedule)!=null&&S.length))&&(Z.complete=!0)}q+=1,Y=$.every(({venueId:J})=>j[J].complete)||q===re}for(let{venueId:J}of $){let H=j[J].matchUpMap;Object.keys(H).forEach(Z=>{let K=u[Z];K&&Object.keys(H[Z]).forEach(ie=>{let{drawDefinition:ae}=ld({tournamentRecord:K,drawId:ie});ae&&H[Z][ie].forEach(({matchUpId:oe})=>{let ne=R[oe];if(ne){let de=ne.split(":").map(lo).join(":"),ye=`${ht(F)}T${de}`;f?N[F].push(oe):(ud({drawDefinition:ae,scheduledTime:ye,matchUpId:oe}).success&&N[F].push(oe),J&&_v({tournamentRecord:K,drawDefinition:ae,matchUpId:oe,venueId:J}))}})})}),M[F]=j[J].matchUpsToSchedule.map(Pr),U[F][J]=j[J].scheduleTimes.sort((Z,K)=>kt(Z.scheduleTime)-kt(K.scheduleTime))}!f&&G!=null&&G.length&&lU({matchUpDetails:G,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let J of x.venues)for(let H of J.rounds){let Z=(((w=H.matchUps)==null?void 0:w.map(({matchUpId:ie})=>ie))||[]).filter(ie=>N[F].includes(ie));H.canScheduledMatchUpIds=Z;let K=Math.round(Z.length/H.matchUpsCount*1e4)/100;(K===1/0||isNaN(K))&&(K=0),H.possibleToSchedulePct=K,H.matchUpsCount===Z.length&&(H.possibleToSchedule=!0)}}let O=n.map(({scheduleDate:x})=>x),k={timeStamp:Date.now(),overLimitMatchUpIds:A,scheduledMatchUpIds:N,schedulingProfile:c,noTimeMatchUpIds:M,requestConflicts:C,scheduledDates:O};return Fte({tournamentRecords:u,autoSchedulingAudit:k}),{...Q,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:U,dateSchedulingProfiles:n,skippedScheduleTimes:T,recoveryTimeDeferredMatchUpIds:D,dependencyDeferredMatchUpIds:P,matchUpScheduleTimes:R,overLimitMatchUpIds:A,scheduledMatchUpIds:N,noTimeMatchUpIds:M,requestConflicts:C,scheduledDates:O}}function lj({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Qe,stack:"getEarliestCourtTime"};let a=bg({scheduleDate:n,courts:[r],startTime:!0}),o=bg({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||o;let s=rU({court:r,date:n}),{timeSlots:l}=Fv({courtDate:s}),u=nr(e),c=nr(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let m=nr(p.startTime),h=nr(p.endTime);if(m>c||h<u)return d;let f=u>m?u:m;if(rw(f,h)>=t){let g=Si(f.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:o}}function f1e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:m=[],courts:h,dryRun:f}){var g,v;let y={},I={},b={},S={},w={},U={},T={},D={},P={};for(let N of n??[]){let A=ht(N==null?void 0:N.scheduleDate),M=(N==null?void 0:N.venues)||[],C={},O={},k=(J,H)=>{J.forEach(Z=>{let K=O[Z].counters;K[H]?K[H]+=1:K[H]=1,K[Xo]?K[Xo]+=1:K[Xo]=1})};y[A]={},I[A]={},U[A]=[],T[A]=[],D[A]=[],P[A]=[];let x={};m==null||m.forEach(J=>{var H;(H=J.schedule)!=null&&H.scheduledDate&&Yl(A,ht(J.schedule.scheduledDate))&&yg({matchUpPotentialParticipantIds:C,matchUpNotBeforeTimes:x,matchUp:J})});let{allDateScheduledByeMatchUpDetails:F,allDateScheduledMatchUpIds:$,venueScheduledRoundDetails:_,allDateMatchUpIds:L}=xte({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:x,matchUpScheduleTimes:w,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:A,matchUps:m,courts:h,venues:M}),B=m==null?void 0:m.filter(({matchUpId:J})=>$.includes(J)),{bookings:V}=XR({dateScheduledMatchUps:B,tournamentRecords:u,scheduleDate:A,periodLength:c}),{virtualCourts:G}=GR({scheduleDate:A,periodLength:c,bookings:V,courts:h}),j=G==null?void 0:G.reduce((J,H)=>{let{earliestCourtTime:Z,courtEndTime:K}=lj({date:A,averageMinutes:0,court:H});return(!J.startTime||nr(Z)<nr(J.startTime))&&(J.startTime=Z),(!J.endTime||nr(K)>nr(J.endTime))&&(J.endTime=K),J},{}),z=j.startTime,W=({courtId:J,booking:H})=>{var Z;return(Z=G==null?void 0:G.find(K=>K.courtId===J))==null?void 0:Z.dateAvailability[0].bookings.push(H)},q=10,Y=0,re;for(;!re;){for(let{venueId:J}of M){let H=_[J],Z=H.matchUpsToSchedule.length,K=[],ie=[],ae,oe=0;for(;!ae;){for(let ne of H.matchUpsToSchedule){if(ie.length===H.courtsCount||K.length===H.courtsCount){ae=!0;break}let{matchUpId:de,matchUpType:ye}=ne,{participantIdsAtLimit:ce,relevantParticipantIds:ke}=V$({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,matchUpDailyLimits:s,matchUp:ne});if(ce.length){T[A].includes(de)||T[A].push(de);continue}let{dependenciesScheduled:we,remainingDependencies:Ze}=_$({matchUpScheduleTimes:w,matchUpDependencies:o,allDateMatchUpIds:L,matchUp:ne});if(!we){I[A][de]||(I[A][de]=[]),I[A][de].push({remainingDependencies:Ze});continue}let pt=[],he=G==null?void 0:G.reduce((fe,pe)=>{var Fe,Se,He,ue;if(ie.includes(pe.courtId))return fe;let{earliestCourtTime:me}=lj({averageMinutes:H.greatestAverageMinutes,startTime:z,date:A,court:pe});if(fe.scheduleTime&&kt(me)>=kt(fe.scheduleTime))return fe;let{scheduledDependent:Ue}=kte({matchUpScheduleTimes:w,matchUpDependencies:o,scheduleTime:me,matchUpId:de,details:H});if(Ue)return fe;let{enoughTime:$e}=B$({individualParticipantProfiles:O,matchUpNotBeforeTimes:x,matchUpDependencies:o,scheduleTime:me,details:H,matchUp:ne});if(!$e)return y[A][de]||(y[A][de]=[]),y[A][de].includes(me)||y[A][de].push(me),fe;let Ee=((Se=(Fe=H.minutesMap)==null?void 0:Fe[de])==null?void 0:Se.averageMinutes)||H.greatestAverageMinutes,{conflicts:Be}=$$({potentials:e,averageMatchUpMinutes:Ee,requestConflicts:P,personRequests:p,scheduleTime:me,scheduleDate:A,matchUp:ne});if(Be!=null&&Be.length)return pt.push(...Be),!1;k(ke,ye);let xe=(ue=(He=H.minutesMap)==null?void 0:He[de])==null?void 0:ue.recoveryMinutes;return Sy({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,matchUpNotBeforeTimes:x,averageMatchUpMinutes:Ee,matchUpDependencies:o,recoveryMinutes:xe,scheduleTime:me,matchUp:ne}),(!fe.scheduleTime||kt(me)<kt(fe.scheduleTime))&&(fe.averageMatchUpMinutes=Ee,fe.recoveryMinutes=xe,fe.scheduleTime=me,fe.courtName=pe.courtName,fe.courtId=pe.courtId),fe},{});if(he.scheduleTime){let{averageMatchUpMinutes:fe,recoveryMinutes:pe,scheduleTime:Fe,courtId:Se}=he;w[de]=Fe,S[de]=Se,K.push(de),ie.push(Se);let He=Fe,ue=na(He,fe);W({courtId:Se,booking:{averageMatchUpMinutes:fe,recoveryMinutes:pe,periodLength:c,matchUpId:de,startTime:He,courtId:Se,endTime:ue,venueId:J}}),H.matchUpsToSchedule=H.matchUpsToSchedule.filter(me=>me.matchUpId!==de)}else pt!=null&&pt.length&&(b[A]||(b[A]=[]),b[A].push(...pt))}(ie.length===H.courtsCount||K.length===H.courtsCount||!H.matchUpsToSchedule.length)&&(ae=!0),H.matchUpsToSchedule.length&&K<H.courtsCount&&(nr(z)<nr(j.endTime)?z=na(z,c):(ae=!0,H.complete=!0)),oe+=1,!ae&&oe>=Z&&(ae=!0)}(g=H.matchUpsToSchedule)!=null&&g.length||(H.complete=!0)}Y+=1,re=M.every(({venueId:J})=>_[J].complete)||Y===q}for(let{venueId:J}of M){let H=_[J].matchUpMap;Object.keys(H).forEach(Z=>{let K=u[Z];K&&Object.keys(H[Z]).forEach(ie=>{let{drawDefinition:ae}=ld({tournamentRecord:K,drawId:ie});ae&&H[Z][ie].forEach(({matchUpId:oe})=>{let ne=w[oe],de=S[oe];if(ne){let ye=ne.split(":").map(lo).join(":"),ce=`${ht(A)}T${ye}`;f||(ud({drawDefinition:ae,scheduledTime:ce,matchUpId:oe}),qh({courtDayDate:A,tournamentRecords:u,tournamentRecord:K,drawDefinition:ae,matchUpId:oe,courtId:de})),U[A].push(oe)}})})}),D[A]=_[J].matchUpsToSchedule.map(Pr)}!f&&F!=null&&F.length&&lU({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let J of N.venues)for(let H of J.rounds){let Z=(v=(H.matchUps??[]).map(({matchUpId:ie})=>ie))==null?void 0:v.filter(ie=>U[A].includes(ie));H.canScheduledMatchUpIds=Z;let K=Math.round(((Z==null?void 0:Z.length)||0)/H.matchUpsCount*1e4)/100;(K===1/0||isNaN(K))&&(K=void 0),H.possibleToSchedulePct=K,H.matchUpsCount===(Z==null?void 0:Z.length)&&(H.possibleToSchedule=!0)}}let E=(n??[]).map(({scheduleDate:N})=>N),R={timeStamp:Date.now(),overLimitMatchUpIds:T,scheduledMatchUpIds:U,schedulingProfile:d,noTimeMatchUpIds:D,requestConflicts:P,scheduledDates:E};return Fte({tournamentRecords:u,autoSchedulingAudit:R}),{...Q,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:w,overLimitMatchUpIds:T,scheduledMatchUpIds:U,noTimeMatchUpIds:D,requestConflicts:P,scheduledDates:E}}function QR(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=yr,scheduledDates:r,venueIds:n}=t,a=Po(t),o=At(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(o!=null&&o.length))return{error:ki};let s=0;for(let l of o){let u=a[l],c=g1e({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:r,venueIds:n});if(c.error)return c;s+=c.clearedScheduleCount??0}return{...Q,clearedScheduleCount:s}}function g1e({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=yr,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:ve};if(!Array.isArray(e)||!Array.isArray(n))return{error:le};n.length&&t.push("venueId");let a=Hr({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],o={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&Zw({schedule:c,scheduleAttributes:t})&&(!(n!=null&&n.length)||n.includes(c.venueId))&&(o[d]||(o[d]=[]),o[d].push(p))});let s=i.tournamentId,l=0;for(let u in o){let{event:c,drawDefinition:d}=Kn({tournamentRecord:i,drawId:u}),p=Pn({drawDefinition:d,matchUpFilters:{matchUpIds:o[u]}}).matchUps??[];for(let m of p){let h=!1;m.timeItems=(m.timeItems??[]).filter(f=>{let g=(f==null?void 0:f.itemType)&&![Zl,_c,Ah,WP,Oh,kh].includes(f==null?void 0:f.itemType);return g||(h=!0),g}),h&&(Et({context:"clear schedules",eventId:c==null?void 0:c.eventId,drawDefinition:d,tournamentId:s,matchUp:m}),l+=1)}}return{...Q,clearedScheduleCount:l}}function ZR(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:u}=t,c=We(t,[{[gn]:!0},{[Jr]:D=>!D||Array.isArray(D)&&D.every(wa),[Z8]:!1,[Xn]:dn}]);if(c.error)return c;let d=ac({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...Q};let{modifications:p,issues:m=[],schedulingProfile:h=[]}=d,f=Object.assign({},...Object.values(a).map(D=>Uv({tournamentRecord:D}).containedStructures)),g=n.map(D=>{if(wa(D))return ht(D)}).filter(Boolean),v=h.map(D=>D.scheduleDate).map(D=>wa(D)&&ht(D)).filter(D=>D&&(!n.length||g.includes(D)));if(!v.length)return{error:s9};if(r&&!l){let D=Array.isArray(r)?r:[];QR({tournamentRecords:a,scheduledDates:D})}let y=nc({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:I}=Ls({matchUpFilters:{matchUpTypes:[ri,ei]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:b}=fs({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:I}),{matchUpDailyLimits:S}=_R({tournamentRecords:a}),{personRequests:w}=Lp({requestType:sU,tournamentRecords:a}),U=h.filter(D=>{let P=ht(D==null?void 0:D.scheduleDate);return v.includes(P)}).sort((D,P)=>new Date(D.scheduleDate).getTime()-new Date(P.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:m,dateSchedulingProfiles:U,containedStructureIds:f,matchUpDependencies:b,matchUpDailyLimits:S,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:h,personRequests:w,periodLength:o,useGarman:s,matchUps:I,dryRun:l,courts:y};return u?f1e(T):h1e(T)}function eE(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};return n.tournamentId||(n.tournamentId=Ht()),n.startDate&&!qd(n.startDate)&&!QS.test(n.startDate)?{error:Fr}:n.endDate&&!qd(n.endDate)&&!QS.test(n.endDate)?{error:Fr}:(n.extensions&&(n.extensions=n.extensions.filter(pl)),{...n})}function j$({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:o}){var s,l;if(!i)return{error:ve};let u={},c=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===Dt&&v===en),d=0;for(let g of c){let v=a&&((s=pm({element:g,accessor:a}))==null?void 0:s.value)||r&&((l=g.person)==null?void 0:l[r])||e&&g[e];if(v){if(!Object.keys(u).includes(v)){u[v]={participantName:(n==null?void 0:n[d])??v,participantId:(o==null?void 0:o.pop())??Ht(),individualParticipantIds:[],participantRole:en,participantType:Jt};let y={value:r??e,name:vM};_t({element:u[v],extension:y}),d+=1}u[v].individualParticipantIds.push(g.participantId)}}let p=Object.keys(u),m=(i.participants??[]).map(g=>{if(g.participantType!==Jt||g.participantRole!==en)return;let{extension:v}=It({name:vM,element:g}),y=v==null?void 0:v.value;if(p.includes(y))return g.participantId}).filter(Boolean),h=0,f=[];return Object.keys(u).forEach(g=>{let v=u[g],{participantId:y}=v;m.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),f.push(v),h++)}),t&&h?(ut({payload:{tournamentId:i.tournamentId,participants:f},topic:xc}),{...Q,participantsAdded:h}):f.length?{...Q,newParticipants:f}:{error:iUe}}var v1e=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],I1e=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function Lte({count:t=1,participantsCount:e=32}={}){let i=Tn(I1e),r=i.slice(0,t);return{cities:De(0,e).map(n=>n<Math.min(t,i.length)?r[n]:$o(r))}}function _te({count:t=1,participantsCount:e=32}={}){let i=Tn(v1e),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:De(0,e).map(n=>n<Math.min(t,i.length)?r[n]:$o(r))}}function $te({count:t=1,participantsCount:e=32}={}){let i=De(0,t).map(()=>De(0,5).map(()=>ao(0,9)).join(""));return{postalCodes:De(0,e).map(r=>r<t?i[r]:$o(i))}}function D0({idPrefix:t,participantType:e,index:i,uuids:r}){let n=Pi(e)?e[0]:"X";return t?`${t}-${n}-${i}`:(r==null?void 0:r.pop())||Ht()}function Bte(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r==null?void 0:r[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:n}}var y1e={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function ZE(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![Qt,hi].includes(i))return{personData:[],error:le};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:o}=y1e,s=bc.map(({iso:f})=>f).filter(Boolean),l=Math.ceil(r/n.length),u=Math.ceil(r/a.length),c=Math.ceil(r/o.length),d=De(0,l).flatMap(()=>{let f=Me(n,!1,!0);return De(0,n.length).map(()=>va(f))}),p=De(0,u).flatMap(()=>{let f=Me(a,!1,!0);return De(0,a.length).map(()=>va(f))}),m=De(0,c).flatMap(()=>{let f=Me(o,!1,!0);return De(0,o.length).map(()=>va(f))}),h={};for(let f=0;f<r;f++){let g=d.pop(),v=i||$o([Qt,hi]),y=v===Qt?m.pop():p.pop(),I=$o(s);h[`${y}${g}`]={nationalityCode:I,sex:v,firstName:y,lastName:g}}return{personData:Object.values(h).slice(0,e)}}function Vte(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:o,category:s,sex:l}=t||{};if(isNaN(e))return{error:le};let u=(a==null?void 0:a[Qt])||l===Qt&&e||0,c=(a==null?void 0:a[hi])||l===hi&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&ZE({count:u,sex:Qt}).personData||[],m=c&&ZE({count:c,sex:hi}).personData||[],h=[...p,...m,...d&&ZE({count:d}).personData||[]],f=h.filter(T=>!l||u&&c||T.sex===l),g=[];if(Array.isArray(o)){let T=o.filter(D=>typeof D.firstName!="string"||typeof D.lastName!="string"||D.sex&&![Qt,hi].includes(D.sex)||D.nationalityCode&&(typeof D.nationalityCode!="string"||D.nationalityCode.length>3||!bc.find(({iso:P,ioc:E})=>[P,E].includes(D.nationalityCode)))?!1:(D.nationalityCode&&g.push(D.nationalityCode),!0));if(T.length)f=T;else return{error:le}}let v=o?f:Tn(f);if(v.length<e){let{maleFirstNames:T,maleLastNames:D,femaleFirstNames:P,femaleLastNames:E,nationalityCodes:R}=h.reduce((N,A)=>{let{firstName:M,lastName:C,nationalityCode:O}=A;return A.sex===Qt?(N.maleFirstNames.includes(M)||N.maleFirstNames.push(M),N.maleLastNames.includes(C)||N.maleLastNames.push(C)):(N.femaleFirstNames.includes(M)||N.femaleFirstNames.push(M),N.femaleLastNames.includes(C)||N.femaleLastNames.push(C)),N.nationalityCodes.includes(O)||N.nationalityCodes.push(O),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});De(0,e-v.length).forEach(()=>{let N=l||$o([Qt,hi]),A=$o(R),M=$o(N===Qt?T:P),C=$o(N===Qt?D:E),O={firstName:M,lastName:C,sex:N,nationalityCode:A};v.push(O)})}let{ageMinDate:y,ageMaxDate:I}=xm({consideredDate:r,category:s}),b=tt((y==null?void 0:y.slice(0,4))||0)||tt((I==null?void 0:I.slice(0,4))||0)-3,S=tt((I==null?void 0:I.slice(0,4))||0)||tt((y==null?void 0:y.slice(0,4))||0)+3,w=(y||I)&&[b,S],U=v.slice(0,e).map((T,D)=>{let[P,E]=w||[],R=w&&va(De(P,E)),N=va(De(0,365)),A=R&&JUe(R,N);return Object.assign(Ge({extensions:i||[{name:"regionCode",value:D+1}],birthDate:A,isMock:n}),T)});return{persons:U.length&&U||v[0],nationalityCodes:g}}var b1e=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function P0({nameRoot:t="TEAM",count:e=1}={}){let i=Tn(b1e).slice(0,e);return i.length<e&&De(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function $v(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=Tr,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:o,categories:s,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:m,teamSize:h=8,personIds:f,idPrefix:g,uuids:v,personExtensions:y,addressProps:I,gendersCount:b,matchUpType:S,personData:w,sex:U,inContext:T,withISO2:D,withIOC:P,scaleAllParticipants:E}=t,R=m===gt||S===Wd,N=m===Jt||S===Jt;i&&(!Array.isArray(i)||!i.every(ce=>xi(ce))||i.length!==2)&&(i=void 0),e=E?p:e;let A=1e3,M=e&&e>A?e:A;i=i||[1,M],i[1]+=1;let C=p*(R&&2||N&&(h??8)||1),O=Vte({count:C,personExtensions:y,consideredDate:o,gendersCount:b,personData:w,category:l,sex:U});if(O.error)return O;let{nationalityCodes:k,persons:x}=O,F={},$={},_={},L={},B=ce=>{Object.assign(F,ce.doublesRankings),Object.assign($,ce.singlesRankings),Object.assign(L,ce.doublesRatings),Object.assign(_,ce.singlesRatings)};if(At(l)){let ce=uj({scaledParticipantsCount:e,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:l});B(ce)}Array.isArray(s)&&s.forEach(ce=>{let ke=uj({scaledParticipantsCount:e,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:ce});B(ke)});let V=bc.filter(ce=>c==="IOC"&&ce.ioc||ce.iso);function G(ce){let ke=Math.ceil(C/ce);return n&&ke>n?Math.ceil(C/n):ce}let{postalCodesProfile:j,postalCodesCount:z,statesProfile:W,citiesProfile:q,citiesCount:Y,statesCount:re}=I||{},J=ce=>Object.keys(ce).map(ke=>De(0,W[ke]).map(()=>ke)).flat(),H=q&&J(q)||(I==null?void 0:I.cities)||Lte({count:Y||C,participantsCount:C}).cities,Z=W&&J(W)||(I==null?void 0:I.states)||_te({count:re||C,participantsCount:C}).states,K=j&&J(j)||(I==null?void 0:I.postalCodes)||$te({count:z||C,participantsCount:C}).postalCodes,ie={cities:H,states:Z,postalCodes:K},ae=G(u),oe=ae?Tn(V).slice(0,u):d&&V.filter(ce=>d.includes(ce.iso))||V,ne=Tn(De(0,Math.ceil(C/(ae||1))).map(()=>oe).flat(1/0)),de=P0({count:p}).names;return{participants:De(0,p).map(ce=>{let ke=R&&2||N&&(h??8)||1,we=De(0,ke).map(pe=>{let Fe=ce*ke+pe;return ye(Fe)}),Ze=we.map(pe=>pe.participantId),pt=we.map(pe=>pe.person.standardFamilyName).join("/"),he=R?gt:Jt,fe={participantId:D0({participantType:he,index:ce,idPrefix:g,uuids:v}),participantName:R?pt:de[ce],participantRole:en,individualParticipantIds:Ze,participantType:he};return T&&(fe.individualParticipants=we),R||N?[fe,...we]:we}).flat(),...Q};function ye(ce){let ke=x[ce],{nationalityCode:we,participantExtensions:Ze,participantTimeItems:pt,extensions:he,firstName:fe,birthDate:pe,lastName:Fe,personId:Se,sex:He}=ke||{},ue=fe||"GivenName",me=Fe||"FamilyName",Ue=`${ue} ${me}`,$e=ne[ce],Ee=(k==null?void 0:k.length)&&we||$e&&(c==="IOC"?$e.ioc||$e.iso:$e.iso||$e.ioc)||we;ne!=null&&ne.length&&!Ee&&!we&&console.log("%c Invalid Nationality Code",{participantIndex:ce,country:$e});let Be=Bte({...ie,participantIndex:ce,nationalityCode:Ee}),xe=Ge({participantId:D0({participantType:Dt,index:ce,idPrefix:g,uuids:v}),extensions:Ze,timeItems:pt,participantRole:en,participantType:Dt,participantName:Ue,person:{personId:Se||(f==null?void 0:f.length)&&f[ce]||Ht(),birthDate:wa(pe)?pe:void 0,addresses:[Be],standardFamilyName:me,standardGivenName:ue,nationalityCode:Ee,extensions:he,sex:He}});if(P&&Ee){let Pe=bc.find(({iso:at})=>at===Ee);Pe!=null&&Pe.ioc&&(xe.person.iocNationalityCode=Pe.ioc),Pe!=null&&Pe.label&&(xe.person.countryName=Pe.label)}if(D&&Ee){let Pe=bc.find(({iso:at})=>at===Ee);Pe!=null&&Pe.iso2&&(xe.person.iso2NationalityCode=Pe.iso2),Pe!=null&&Pe.label&&(xe.person.countryName=Pe.label)}let qe=Pe=>{var at,di,Ae,yt;let yi=Pe.categoryName||Pe.ratingType||Pe.ageCategoryCode,be=(at=$[yi])==null?void 0:at[ce],Ct=(di=F[yi])==null?void 0:di[ce];SU({scaleValue:be,eventType:Fm,scaleType:Ac,participant:xe,category:Pe}),SU({scaleValue:Ct,eventType:Ou,scaleType:Ac,participant:xe,category:Pe});let Re=(Ae=_[yi])==null?void 0:Ae[ce],Ye=(yt=L[yi])==null?void 0:yt[ce];SU({scaleValue:Re,eventType:Fm,scaleType:yc,participant:xe,category:Pe}),SU({scaleValue:Ye,eventType:Ou,scaleType:yc,participant:xe,category:Pe})};return Array.isArray(s)?s.forEach(Pe=>qe(Pe)):l&&qe(l),xe}}function SU({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,o=[Xd,r,i,a].join("."),s={itemValue:t,itemType:o};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function uj(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,o=e.rankingRange||t.rankingRange||[1,1e3],s={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:m}=e,h=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!m){let[f,g]=o||[];if(l[h]=Tn(De(f,g)).slice(0,i||ao(20,30)),[gt,Jt].includes(n)){let[v,y]=o||[];s[h]=Tn(De(v,y)).slice(0,i||ao(20,30))}}if(m&&r[m]){let{ratingMax:f,ratingMin:g,ratingAttributes:v}=e,y={...r[m],...v||{}},{attributes:I={},decimalsCount:b,accessors:S,range:w,step:U}=y,T=N=>{let A={},M=Object.keys(N||{});for(let C of M){let O=N[C];if(typeof O=="object"&&O.generator){let{range:k}=O,[x,F]=k.slice().sort();A[C]=ao(x,F)}else A[C]=O}return A},D=w[0]>w[1]?2:.7,[P,E]=w.slice().sort(),R=De(0,2e3).map(()=>PK(P,E,D,U,b)).filter(N=>(!f||N<=f)&&(!g||N>=g)).slice(0,i||ao(20,30)).map(N=>S?Object.assign({},...S.map(A=>({[A]:N})),T(I)):N);u[h]=[...a,...R],[gt,Jt].includes(n)&&(c[h]=[...a,...R])}return{singlesRankings:l,doublesRankings:s,singlesRatings:u,doublesRatings:c}}function G$(t){var e,i;let{alternatesCount:r=0,tieFormatName:n,drawSize:a}=t,o=0,s=0,l=0,u=0,c={},d={[Qt]:0,[hi]:0,[jn]:0,[Td]:0,[Fs]:0};(i=(e=At(t.tieFormat)?t.tieFormat:Au({namedFormat:n}))==null?void 0:e.collectionDefinitions)==null||i.filter(Boolean).forEach(f=>{let{category:g,collectionId:v,matchUpType:y,matchUpCount:I,gender:b}=f;if([Qt,hi].includes(b)){let S=I*(y===ei?2:1);d[b]<S&&(d[b]=S)}else b===jn&&(d[Qt]<I&&(d[Qt]=I),d[hi]<I&&(d[hi]=I));if(g){let S=JSON.stringify(g);c[S]=g}if(v||(f.collectionId=Ht()),Ji(ei)(y)){let S=I;u+=I,o=Math.max(o,S)}if(Ji(ri)(y)){let S=I;l+=I,s=Math.max(s,S)}});let p=Object.keys(c).length?Math.max(l,u*2):Math.max(s,o*2),m=o*(a+r),h=s*(a+r);return{maxDoublesDraw:m,maxSinglesDraw:h,teamSize:p,genders:d}}function w1e({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=Dt}=t||{},a=r||0,o={[hi]:0,[jn]:0,[Td]:0,[Qt]:0,[Fs]:0},s=0,l=0,u=0,c=0,d=0,p=({alternatesCount:h=0,uniqueParticipants:f,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:I,category:b,gender:S,stage:w})=>{let U=y===go,T=y===cr,D=!!(f||w===Je||b||S);if(T){c=Math.max(c,v+h),I=typeof I=="object"?I:Au({namedFormat:g});let{teamSize:P,maxDoublesDraw:E,maxSinglesDraw:R,genders:N}=G$({alternatesCount:h,tieFormatName:g,tieFormat:I,drawSize:v});u=Math.max(u,P),l=Math.max(l,R),D||(s=Math.max(s,E)),Object.keys(N).forEach(A=>o[A]+=N[A])}else if(U)if(D){let P=(v+h)*2;d+=P,S&&(o[S]+=P)}else v+h&&v+h>s&&(s=v+h);else if(D){let P=v+h;S&&(o[S]+=P),d+=P}else v&&v>l&&(l=v+h)};if(e==null||e.forEach(h=>{let{tieFormatName:f,tieFormat:g,drawProfiles:v,eventType:y,category:I,gender:b}=h;if(v)for(let S of v){let{tieFormatName:w,tieFormat:U}=S;p({...S,tieFormatName:w||f,tieFormat:U||g,eventType:y,category:I,gender:b})}}),Array.isArray(i))for(let h of i)p(h);let m=Math.max(c*u,s*2,l);return s&&(n=gt),(r||a)<m&&(r=m),r&&s&&[gt,cr].includes(n)&&(l&&Math.floor(l/2)>s?r=Math.floor(l/2):(!l||s*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:c,largestTeamSize:u,participantType:n,gendersCount:o}}function jte({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if((t==null?void 0:t.participantsCount)===0)return{addedCount:0,...Q};let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=w1e({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t==null?void 0:t.teamKey,p=$v({consideredDate:n,...t,participantsCount:o,participantType:s,gendersCount:c,uuids:a}).participants,m=0,h=us({tournamentRecord:e,participants:p});if(h.error)return h;if(m+=h.addedCount,d){let y=j$({tournamentRecord:e,...d});if(y.error)return y}let f=p.filter(({participantType:y})=>y===Dt).map(Tt),g=t!=null&&t.idPrefix?`${Jt}-${t.idPrefix}`:void 0,v=De(0,l).map(y=>{let I=f.slice(y*u,(y+1)*u),b=D0({index:y,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:en,individualParticipantIds:I,participantType:Jt,participantId:b}});return h=us({participants:v,tournamentRecord:e}),h.error?h:(m+=h.addedCount,{addedCount:m,...Q})}function Gte({drawProfiles:t,category:e,gender:i}){let r={},n=t==null?void 0:t.reduce((o,s)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=Ne,drawSize:p=0}=s||{};Object.keys(o).includes(d)||(o[d]=0);let m=(u||p)-l;return c||i||e||d===Je?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=m):o[d]=Math.max(o[d],m),o},{}),a=Object.keys(r);return a.forEach(o=>n[o]+=r[o]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function Hte({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Ne]||0,a=e[Je]||0;return{stageParticipants:{QUALIFYING:r==null?void 0:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(0,a),MAIN:r==null?void 0:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(a,a+n)}}}var U1e={[Ft]:2,[ir]:1,[pr]:1,[zr]:1,[Pt]:4};function H$(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=U1e,matchUpFormat:n=Yo,pointsPerMinute:a=1,sideWeight:o=4}=t;if(!Ea({matchUpFormat:n}))return{error:Jx};if(typeof r!="object")return{error:le};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(o))return{error:le};let s=Object.keys(r).filter(P=>Object.keys(TJ).includes(P)&&P!==Ki);if(Object.keys(s).reduce((P,E)=>P+r[E],0)>100)return{error:le,matchUpStatusProfile:r};let l=s.reduce((P,E)=>(P.pointer=P.pointer+r[E],P.valueMap.push([P.pointer,E]),P),{pointer:0,valueMap:[]}),u=ao(1,100),c=(l.valueMap.find(P=>u<=P[0])??[100,Ki])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([Ft,Pt].includes(c)){i=i||ao(1,2);let P={score:d,matchUpStatus:c,winningSide:i};if(!(c===Pt&&ao(1,100)>100-e))return{outcome:P}}else if([ir,pr].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=Ln(n),{bestOf:m=1,exactly:h,setFormat:f,finalSetFormat:g}=p??{},v=[],y=ao(0,1),I=i?[i-1]:[...De(0,o).map(()=>y),1-y],b=[zr,Pt,Ma,nd].includes(c)&&(va(De(1,h||m))||1),S,w=De(1,(h??m)+1);for(let P of w){let E=P===(h??m),{set:R,incomplete:N,winningSideNumber:A}=S1e({setFormat:E&&g||f,incomplete:b===P,pointsPerMinute:a,matchUpStatus:c,weightedRange:I,setNumber:P});if(v.push(R),N){S=A;break}if(Uy({matchUp:{score:{sets:v},matchUpFormat:n}}).calculatedWinningSide)break}let U=Uy({matchUp:{score:{sets:v},matchUpFormat:n,winningSide:i}}),T=S?i||S:U.calculatedWinningSide,{score:D}=Rte({winningSide:T,score:{sets:v},matchUpStatus:c});return{outcome:{winningSide:T,matchUpStatus:c,score:D}}}function S1e({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let o={setNumber:a},{setTo:s,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=n,m=ao(0,t.length-1),h=t[m],f;if(d){let g=p*e,v=Math.round(g*.2),y=g+va([1,-1])*v,I=Owe(y,2),b=[I,y-I];h&&b.reverse(),f=t[m]+1;let S=b[0]>b[1]&&1||b[1]>b[0]&&2||0;if(r){let[T,D]=b;return Object.assign(o,{side1Score:T,side2Score:D}),yr.includes(i)?{set:o,incomplete:r,winningSideNumber:f}:{set:o,incomplete:r}}S||(b[ao(0,1)]+=1),S=b[0]>b[1]?1:2,S!==f&&b.reverse();let[w,U]=b;return Object.assign(o,{side1Score:w,side2Score:U,winningSide:f}),{set:o}}else{if(r)return o.side1Score=ao(0,u),o.side2Score=ao(0,u),yr.includes(i)&&(f=t[m]+1),{set:o,incomplete:r,winningSideNumber:f};{let g=De(1,s+1).map(U=>De(0,s+2-U).map(()=>U)).flat(),v=g[ao(0,g.length-1)],y=s&&C_({isSide1:!0,tiebreakAt:u,lowValue:v,setTo:s}),I=!y,b=t.length===1&&t[m]+1;if(!I){b?(y[0]>y[1]?1:2)!==b&&y.reverse():h&&y.reverse();let[U,T]=y;Object.assign(o,{side1Score:U,side2Score:T})}let S=by({matchUpScoringFormat:{setFormat:n},setObject:o}),w;if(S.hasTiebreakCondition||I){let{NoAD:U,tiebreakTo:T}=l||c||{},D=De(1,T+1).map(R=>De(0,T+2-R).map(()=>R)).flat(),P=D[ao(0,D.length-1)],E=UR({isSide1:!0,tiebreakNoAd:U,tiebreakTo:T,lowValue:P});if(E)if(I){let R=E[0]>E[1]?1:2;b?R!==b&&E.reverse():h&&E.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=E,w=E[0]>E[1]&&1||E[1]>E[0]&&2||void 0}else S.leadingSide===2?[o.side1TiebreakScore,o.side2TiebreakScore]=E:[o.side2TiebreakScore,o.side1TiebreakScore]=E}o.winningSide=S.winningSide||S.leadingSide||b||w}}return{set:o}}function R0(t){var e,i,r;let{matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:o,tournamentRecord:s,completionGoal:l,drawDefinition:u,event:c}=t;if(!u)return{error:_e};let d=t.matchUpFormat||u.matchUpFormat||(c==null?void 0:c.matchUpFormat),p=u.structures.slice().sort(Mh),m=0,{matchUps:h,matchUpsMap:f}=gr({matchUpFilters:{matchUpTypes:[gi],roundNumbers:[1]},contextFilters:{stages:[Ne,Je]},inContext:!0,drawDefinition:u});if(h!=null&&h.length){let b=((e=c==null?void 0:c.category)==null?void 0:e.ageCategoryCode)||((i=c==null?void 0:c.category)==null?void 0:i.categoryName);if(b){let S=rte({singlesOnly:!0,tournamentRecord:s,drawDefinition:u,scaleAccessor:{scaleName:b,sortOrder:ite,scaleType:Ac},event:c});if(S.error)return S;let{lineUps:w,participantsToAdd:U}=S;us({tournamentRecord:s,participants:U}),_t({element:u,extension:{name:Lu,value:w}})}else{let S=(r=h[0])==null?void 0:r.structureId,{positionAssignments:w}=si({drawDefinition:u,structureId:S});if(w!=null&&w.length){let{participants:U}=Ai({participantFilters:{participantTypes:[gi]},tournamentRecord:s}),T=D=>{let P=D.tieMatchUps.filter(Ji(ri)),E=D.tieMatchUps.filter(Ji(ei));P.forEach((R,N)=>{let A=R.matchUpId;R.sides.forEach(M=>{var C;let{drawPosition:O}=M,k=U==null?void 0:U.find(x=>{var F;let{participantId:$}=x;return((F=w.find(_=>_.participantId===$))==null?void 0:F.drawPosition)===O});if(k){let x=(C=k.individualParticipantIds)==null?void 0:C[N];x&&T0({teamParticipantId:k.participantId,participantId:x,tournamentRecord:s,drawDefinition:u,tieMatchUpId:A,event:c})}})}),E.forEach((R,N)=>{let A=R.matchUpId;R.sides.forEach(M=>{var C,O;let{drawPosition:k}=M,x=U==null?void 0:U.find(F=>{var $;let{participantId:_}=F;return(($=w.find(L=>L.participantId===_))==null?void 0:$.drawPosition)===k});x&&((O=(C=x.individualParticipantIds)==null?void 0:C.slice(N*2,N*2+2))==null||O.forEach(F=>{T0({teamParticipantId:x.participantId,participantId:F,tournamentRecord:s,drawDefinition:u,tieMatchUpId:A,event:c})}))})})};h.forEach(T)}}}let g=typeof a=="string"&&a,v=g&&Ki,y=p.length===2&&p[0].finishingPosition===Jd&&ji(p.map(({stage:b})=>b),[Ne,Bi]).length===2,I=p.map(({structureId:b})=>b);for(let b of I){if(m>=l)break;let S=u.structures.find(T=>T.structureId===b),w=qt({contextFilters:{matchUpTypes:[ei,ri]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:f,structure:S,event:c}).matchUps;w.length;let U=w.filter(({winningSide:T})=>!T).sort(_h).map(Pr);for(let T of U){if(!isNaN(l)&&m>=l)break;let{matchUps:D}=qt({matchUpFilters:{matchUpTypes:[ei,ri]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:f,structure:S,event:c}),P=D.find(R=>R.matchUpId===T),E=[ir,pr].includes(P.matchUpStatus);if(P!=null&&P.readyToScore&&!E){let R=T1e({matchUpStatusProfile:n,tournamentRecord:s,drawDefinition:u,targetMatchUp:P,matchUpFormat:d,matchUpStatus:v,scoreString:g,winningSide:!o&&1,event:c});if(R!=null&&R.error)return R;m+=1}}y&&S.finishingPosition===Jd&&t.completeRoundRobinPlayoffs&&Ev({structureId:S.structureId,applyPositioning:!0,drawDefinition:u})}return{...Q,completedCount:m}}function zte(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus===jt)return;let{matchUpId:d}=a||{},{outcome:p}=L$({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),aU({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function T1e(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:u,event:c}=t;if(l||a)return zte(t);let{matchUpId:d}=s||{},{outcome:p}=H$({matchUpStatusProfile:e,matchUpFormat:o,winningSide:u});return aU({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function Wte({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:o}){var s,l,u,c;let d=Hi({event:o}).flightProfile,{eventName:p,eventType:m,category:h}=o,{startDate:f}=r,g=[],v=(h==null?void 0:h.categoryName)||(h==null?void 0:h.ageCategoryCode)||(h==null?void 0:h.ratingType),y=(s=o.drawDefinitions)==null?void 0:s.map(({drawId:I})=>I);if(Array.isArray(d==null?void 0:d.flights))for(let[I,b]of d.flights.entries()){let{drawId:S,stage:w,drawName:U,drawEntries:T}=b;g.push(b.drawId);let D=n[I],{seedsCount:P,generate:E=!0}=D||{};if(E){let R=T.filter(Na(Xl)).map(Na(Xl)),N=v||p;if(r&&P&&P<=R.length&&De(1,P+1).forEach((k,x)=>{let F={scaleValue:k,scaleName:N,scaleType:Fl,eventType:m,scaleDate:f},$=R[x];Kw({tournamentRecord:r,participantId:$,scaleItem:F})}),y==null?void 0:y.includes(S))break;let A=tU({...D,matchUpType:m,seedingScaleName:N,tournamentRecord:r,drawEntries:T,drawName:U,drawId:S,isMock:a,event:o,stage:w});if(A.error)return{error:A.error,drawIds:[]};let{drawDefinition:M}=A;if(!M)return{error:ja};let C=(l=n[I])==null?void 0:l.drawExtensions;if(Array.isArray(C)&&C.filter(pl).forEach(k=>_t({element:M,extension:k})),A=iU({suppressNotifications:!0,tournamentRecord:r,drawDefinition:M,event:o}),A.error)return{error:A.error,drawIds:[]};if(D!=null&&D.withPlayoffs){let k=(u=M.structures)==null?void 0:u[0].structureId,x=cR({idPrefix:D.idPrefix,...D.withPlayoffs,tournamentRecord:r,drawDefinition:M,structureId:k,isMock:a,event:o});if(x!=null&&x.error)return x}let O=D==null?void 0:D.completionGoal;if((D==null?void 0:D.automated)!==!1&&(e||O)){let k=D==null?void 0:D.matchUpFormat,x=R0({completeAllMatchUps:!O&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:O,drawDefinition:M,matchUpFormat:k,event:o});if(x.error)return{error:x.error,drawIds:[]};let F=x.completedCount;if((D==null?void 0:D.drawType)===Jl){let $=(c=M.structures)==null?void 0:c.find(B=>B.stage===Ne);if(!$)return{error:Ni};let _=Ev({structureId:$.structureId,tournamentRecord:r,drawDefinition:M,event:o});if(_.error)return{error:_.error,drawIds:[]};let L=O?O-(F??0):void 0;if(_=R0({completeAllMatchUps:!O&&e,completionGoal:O?L:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:M,matchUpFormat:k,event:o}),_.error)return{error:_.error,drawIds:[]}}}}}return{...Q,drawIds:g}}function qte(t){var e,i;let{participantsProfile:r={},uniqueParticipantsCount:n,ratingsParameters:a,tournamentRecord:o,eventProfile:s,eventIndex:l,event:u,uuids:c}=t,{category:d,gender:p,eventType:m}=u,h=Ji(cl)(m)&&Dt||Ji(go)(m)&&gt||m,f=n[Ne]||0,g=n[Je]||0,v=(e=s.drawProfiles)!=null&&e.length?f+g:((i=s.participantsProfile)==null?void 0:i.participantsCount)??0,y=[Qt,hi].includes(p)?p:void 0,I=r!=null&&r.idPrefix?`E-${l}-${r==null?void 0:r.idPrefix}`:void 0,{participants:b}=$v({uuids:s.uuids||c,...r,scaledParticipantsCount:s.scaledParticipantsCount,consideredDate:o==null?void 0:o.startDate,rankingRange:s.rankingRange,participantType:h,participantsCount:v,ratingsParameters:a,category:d,idPrefix:I,sex:y}),S=us({tournamentRecord:o,participants:b});if(S.error)return S;let w=b==null?void 0:b.filter(({participantType:T})=>T===h),U=b==null?void 0:b.map(Tt);return{uniqueDrawParticipants:w,uniqueParticipantIds:U}}function D1e({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=Qs,qualifyingPositions:o=0,stage:s=Ne,drawSize:l=0,drawName:u,drawId:c}=r,d=l-o,p=i.slice(0,d).map(Tt);if(p.length){let f=Zs({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:n});if(f.error)return f}let m=p.map(f=>({entryStatus:da,entryStage:s,participantId:f})),h=jR({drawName:u||a,qualifyingPositions:o,drawEntries:m,drawId:c,event:n,stage:s});return h.error?h:{...Q}}function Yte({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:o,event:s}){let l=0;for(let u of n){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=Ne,drawSize:m=0}=u,h=m-c,f=d||o||a||p===Je,g=f?t.slice(l,l+h):i[p||Ne]||[];f&&(l+=h);let v=D1e({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:u,event:s});if(v.error)return v}return{...Q}}function Kte(t){var e;let{allUniqueParticipantIds:i,matchUpStatusProfile:r,participantsProfile:n,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,eventProfile:d,eventIndex:p,publish:m,isMock:h,uuids:f}=t,g=d.gender,v=d.eventName,{eventType:y=cl,policyDefinitions:I,drawProfiles:b=[],eventExtensions:S,surfaceCategory:w,tieFormatName:U,processCodes:T,discipline:D,eventLevel:P,timeItems:E,ballType:R,category:N}=d,A=d.eventId||Ht(),M=d.tieFormat||(y===cr?Au({namedFormat:U,event:{eventId:A,category:N,gender:g},hydrateCollections:s,isMock:h}):void 0),C=c.participants;for(let q of b)!g&&q.gender&&(g=q==null?void 0:q.gender);let{stageParticipantsCount:O,uniqueParticipantsCount:k,uniqueParticipantStages:x}=Gte({drawProfiles:b,category:N,gender:g}),F=Ji(cl)(y)&&Dt||Ji(go)(y)&&gt||y,{uniqueDrawParticipants:$=[],uniqueParticipantIds:_=[]}=x?qte({event:{eventType:y,category:N,gender:g},uniqueParticipantsCount:k,participantsProfile:n,ratingsParameters:u,tournamentRecord:c,eventProfile:d,eventIndex:p,uuids:f}):{},{eventAttributes:L}=d;typeof L!="object"&&(L={});let B=(N==null?void 0:N.categoryName)||(N==null?void 0:N.ageCategoryCode)||(N==null?void 0:N.ratingType);v=v||B||"Generated Event";let V={...L,surfaceCategory:w,processCodes:T,discipline:D,eventLevel:P,eventName:v,eventType:y,tieFormat:M,ballType:R,category:N,eventId:A,gender:g};if(S!=null&&S.length&&Array.isArray(S)){let q=S.filter(pl);q!=null&&q.length&&Object.assign(V,{extensions:q})}if(Array.isArray(E)&&E.forEach(q=>Gh({event:z,timeItem:q})),typeof I=="object")for(let q of Object.keys(I))rp({policyDefinitions:{[q]:I[q]},event:V});V.category&&(V.category.categoryName=B);let G,j=Ov({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:V});if(j.error)return j;let z=j==null?void 0:j.event,{stageParticipants:W}=Hte({allUniqueParticipantIds:i,stageParticipantsCount:O,eventParticipantType:F,targetParticipants:C});if(b!=null&&b.length){let q=Yte({uniqueDrawParticipants:$,autoEntryPositions:o,stageParticipants:W,tournamentRecord:c,drawProfiles:b,category:N,gender:g,event:z});if(q.error)return q;let Y=Wte({matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawProfiles:b,isMock:h,event:z});if(Y.error)return Y;G=Y.drawIds}else if((e=d==null?void 0:d.participantsProfile)!=null&&e.participantsCount){let q=$.map(Tt);if(q.length){let Y=Zs({participantIds:q,autoEntryPositions:o,tournamentRecord:c,entryStage:Ne,event:z});if(Y.error)return Y}}return m&&xv({tournamentRecord:c,event:z}),{drawIds:G,eventId:A,uniqueParticipantIds:_}}function z$({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!wa(e))return{error:Fr};let n="addSchedulingProfileRound",{extension:a}=It({name:Bm,tournamentRecords:t,discover:!0}),o=(a==null?void 0:a.value)||[],s=o.find(p=>Yl(e,p.scheduleDate));if(!s){let{startDate:p,endDate:m}=DR({tournamentRecords:t}),h=new Date(e);if(p&&h<new Date(p)||m&&h>new Date(m))return{error:Fr};s={scheduleDate:e,venues:[]},o.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(m=>!u.includes(m)).sort().map(m=>At(p[m])?c(p[m]):p[m]).flat().join("|");if(l.rounds.find(p=>c(p)===c(r)))return te({result:{error:qK},stack:n});l.rounds.push(r);let d=Nv({tournamentRecords:t,schedulingProfile:o});return d.error?d:{...Q}}function P1e({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:le};let i=Uv({tournamentRecord:e}).containedStructures,r=Hr({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let o of t){let{scheduleDate:s,venues:l=[]}=o;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:m,winnerFinishingPositionRange:h,roundSegment:f}=p,g=r.filter(v=>{var y;let I=(h==null?void 0:h.indexOf("-"))>0&&h.split("-").map(S=>+S),b=(y=v.finishingPositionRange)==null?void 0:y.winner;return v.drawId===m&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!b||!I||ji(b,I).length===2||dt(b).length===dt(I).length&&ji(b,I).length===dt(b).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:I,structureName:b,roundName:S}=g,w=g.structureId;y&&!h&&(w=Object.keys(i).find(D=>i[D].includes(w))??w);let U={tournamentId:n,structureId:w,roundNumber:y,roundSegment:f,eventId:v,drawId:m},T=z$({tournamentRecords:{[n]:e},round:U,scheduleDate:s,venueId:d});if(T.error)return T;a.push({structureName:b,roundName:S,drawName:I,...U})}}}}return{scheduledRounds:a}}function tE(t){var e,i,r;let n=We(t,[{drawProfile:!0,_ofType:ia}]);if(n.error)return n;let{allUniqueParticipantIds:a=[],participantsProfile:o={},matchUpStatusProfile:s,completeAllMatchUps:l,autoEntryPositions:u,hydrateCollections:c,randomWinningSide:d,ratingsParameters:p,tournamentRecord:m,isMock:h=!0,drawProfile:f,startDate:g,drawIndex:v,uuids:y}=t,I=Me(f,!1,!0),{excessParticipantAlternates:b=!0,matchUpFormat:S=Yo,drawType:w=Qs,tournamentAlternates:U=0,alternatesCount:T=0,qualifyingPositions:D,qualifyingProfiles:P,generate:E=!0,eventExtensions:R,drawExtensions:N,completionGoal:A,tieFormatName:M,buildTeams:C,seedsCount:O,timeItems:k,drawName:x,category:F,idPrefix:$,publish:_,gender:L,stage:B}=I,V=I.drawSize||(I.ignoreDefaults?void 0:32),G=I.eventId||Ht(),j=f.eventType||f.matchUpType||cl,z=j===go?gt:Dt,W=At(f.tieFormat)&&f.tieFormat||j===Jt&&Au({event:{eventId:G,category:F,gender:L},namedFormat:M,hydrateCollections:c,isMock:h})||void 0,q=(F==null?void 0:F.categoryName)||(F==null?void 0:F.ageCategoryCode)||(F==null?void 0:F.ratingType),Y=f.eventName||q||`Generated ${j}`,re=(m==null?void 0:m.participants)||[],J=((P==null?void 0:P.map(he=>he.structureProfiles||[]).flat().reduce((he,fe)=>{let pe=!fe.participantsCount||fe.participantsCount>fe.drawSize?fe.drawSize:fe.participantsCount||0;return he+pe},0))||0)*(z===gt?2:1),H=(!f.participantsCount||f.participantsCount>V?V:f.participantsCount)||0,Z={eventName:Y,eventType:j,tieFormat:W,category:F,eventId:G,gender:L};Array.isArray(k)&&k.forEach(he=>Gh({event:Z,timeItem:he}));let{eventAttributes:K}=f;if(typeof K!="object"&&(K={}),Object.assign(Z,K),(R==null?void 0:R.length)&&Array.isArray(R)){let he=R.filter(pl);he!=null&&he.length&&Object.assign(Z,{extensions:he})}let ie=[];if((o==null?void 0:o.participantsCount)===0||f.uniqueParticipants||J||!m||L||F){let he=(H||0)+T+J,fe=he,pe={[Qt]:0,[hi]:0},Fe,Se;j===Jt&&({teamSize:Fe,genders:Se}=G$({alternatesCount:T,tieFormatName:M,tieFormat:W,drawSize:V}),Object.keys(Se).forEach(me=>{[Qt,hi].includes(me)&&Se[me]&&(pe[me]=V*Se[me])}),fe=Fe*((V||0)+J));let He=o!=null&&o.idPrefix?`D-${v}-${o==null?void 0:o.idPrefix}`:void 0,ue=$v({...o,scaledParticipantsCount:f.scaledParticipantsCount||o.scaledParticipantsCount,participantsCount:fe,consideredDate:m==null?void 0:m.startDate,sex:L||(o==null?void 0:o.sex),rankingRange:f.rankingRange,uuids:f.uuids||y,ratingsParameters:p,participantType:z,gendersCount:pe,idPrefix:He,category:F}).participants;if(Z.category&&(Z.category.categoryName=q),m){let me=us({participants:ue,tournamentRecord:m});if(me.error)return me}if(ue.forEach(({participantId:me})=>ie.push(me)),re=ue,j===Jt){let me=Se[Qt]?ue.filter(({participantType:Ae,person:yt})=>Ae===Dt&&(yt==null?void 0:yt.sex)===Qt).map(Tt):[],Ue=Se[hi]?ue.filter(({participantType:Ae,person:yt})=>Ae===Dt&&(yt==null?void 0:yt.sex)===hi).map(Tt):[],$e=ue.filter(({participantType:Ae})=>Ae===Dt).map(Tt).filter(Ae=>!me.includes(Ae)&&!Ue.includes(Ae)),Ee=[...I.teamNames??[],...P0({count:he}).names],Be=Fe-(Se[Qt]+Se[hi]),xe=0,qe=0,Pe=0,at=De(0,he).map(Ae=>{let yt=Ue.slice(xe,xe+Se[hi]),yi=me.slice(qe,qe+Se[Qt]),be=$e.slice(Pe,Pe+Be);xe+=Se[hi],qe+=Se[Qt],Pe+=Be;let Ct=C!==!1?[...yt,...yi,...be]:[];return{participantName:Ee[Ae]||`Team ${Ae+1}`,participantOtherName:`TM${Ae+1}`,participantRole:en,individualParticipantIds:Ct,participantType:Jt,participantId:Ht()}}),di=us({participants:at,tournamentRecord:m});if(!di.success)return di;re=at}}let ae=he=>{let{participantType:fe}=he;return Ji(cl)(j)&&fe===Dt||Ji(go)(j)&&fe===gt?!0:j===Jt&&fe===Jt},oe=he=>{var fe,pe;return!f.gender||((fe=he.person)==null?void 0:fe.sex)===f.gender?!0:(pe=he.individualParticipantIds)==null?void 0:pe.some(Fe=>{let Se=re.find(He=>He.participantId===Fe);return Se&&oe(Se)})},ne=re.filter(ae).filter(oe).filter(({participantId:he})=>!a.includes(he)),de=ne.slice(0,H).map(he=>he.participantId);if(h&&de!=null&&de.length){let he=Zs({autoEntryPositions:u,entryStage:B,tournamentRecord:m,participantIds:de,event:Z});if(he.error)return he}let ye=J?ne.slice(H,H+J).map(he=>he.participantId):0;if(h&&ye!=null&&ye.length){let he=0,fe=1,pe=(Se,He)=>Se.stageSequence-He.stageSequence,Fe=(Se,He)=>Se.roundTarget-He.roundTarget;for(let Se of P.sort(Fe)){fe=Se.roundTarget||fe;let He=1,ue;for(let me of Se.structureProfiles.sort(pe)){let Ue=(me.drawSize||Bx(me.participantsCount))-(ue||0),$e=ye.slice(he,he+Ue),Ee=Zs({entryStage:Je,entryStageSequence:He,autoEntryPositions:u,tournamentRecord:m,participantIds:$e,roundTarget:fe,event:Z});if(Ee.error)return Ee;ue=me.qualifyingPositions,he+=Ue,He+=1}fe+=1}}let ce=b&&((e=m==null?void 0:m.participants)==null?void 0:e.filter(({participantId:he})=>!de.includes(he)).filter(ae).filter(oe).slice(0,T||V-H||U).map(he=>he.participantId));if(h&&ce!=null&&ce.length){let he=Zs({participantIds:ce,autoEntryPositions:!1,entryStatus:Jo,tournamentRecord:m,event:Z});if(he.error)return he.error}let ke=q||Y;m&&O&&O<=de.length&&De(1,O+1).forEach((he,fe)=>{let pe={scaleName:ke,scaleDate:g,scaleType:bL,scaleValue:he,eventType:j},Fe=de[fe];Kw({tournamentRecord:m,participantId:Fe,scaleItem:pe})});let we=tU({...Me(f,!1,!0),tournamentRecord:m,seedingScaleName:ke,matchUpFormat:S,eventId:G,isMock:h,event:Z});if(we.error)return we;if(!we.drawDefinition)return{error:ja};let{drawDefinition:Ze}=we,pt=Ze.drawId;if(Array.isArray(N)&&N.filter(pl).forEach(he=>_t({element:Ze,extension:he})),E){if(iU({drawDefinition:Ze,event:Z,suppressNotifications:!0}),f.withPlayoffs){let fe=(i=Ze.structures)==null?void 0:i[0].structureId,pe=cR({...f.withPlayoffs,tournamentRecord:m,drawDefinition:Ze,structureId:fe,idPrefix:$,isMock:h,event:Z});if(pe!=null&&pe.error)return pe}let he=f.automated===!1;if(h&&!he){let fe=pe=>{var Fe;let Se=R0({completeAllMatchUps:pe.completeAllMatchUps,completionGoal:pe.completionGoal,matchUpStatusProfile:s,randomWinningSide:d,tournamentRecord:m,drawDefinition:Ze,matchUpFormat:S,event:Z});if(Se.error)return Se;let He=Se.completedCount;if(w===Jl){let ue=(Fe=Ze.structures)==null?void 0:Fe.find($e=>$e.stage===Ne);if(!ue)return{error:Ni};Ev({structureId:ue.structureId,tournamentRecord:m,drawDefinition:Ze,event:Z});let me=A?A-(He??0):void 0,Ue=R0({completionGoal:A?me:void 0,matchUpStatusProfile:s,completeAllMatchUps:l,randomWinningSide:d,tournamentRecord:m,drawDefinition:Ze,matchUpFormat:S,event:Z});if(Ue.error)return Ue}};if(A&&fe({completionGoal:A}),f.outcomes){let{matchUps:pe}=Pn({inContext:!0,drawDefinition:Ze,event:Z});for(let Fe of f.outcomes){let{matchUpStatus:Se=Ki,matchUpStatusCodes:He,stageSequence:ue=1,matchUpIndex:me=0,structureOrder:Ue,matchUpFormat:$e,drawPositions:Ee,roundPosition:Be,stage:xe=Ne,roundNumber:qe,winningSide:Pe,scoreString:at}=Fe,di=(pe==null?void 0:pe.reduce((be,Ct)=>{let{structureId:Re,matchUpId:Ye}=Ct;return be[Re]?be[Re].push(Ye):be[Re]=[Ye],be},{}))??[],Ae=Object.assign({},...Object.keys(di).map((be,Ct)=>({[be]:Ct+1}))),yt=(r=pe==null?void 0:pe.filter(be=>(!xe||be.stage===xe)&&(!ue||be.stageSequence===ue)&&(!qe||be.roundNumber===qe)&&(!Be||be.roundPosition===Be)&&(!Ue||Ae[be.structureId]===Ue)&&(!Ee||ji(Ee,be.drawPositions).length===2)))==null?void 0:r[me],yi=zte({matchUpStatusCodes:He,tournamentRecord:m,drawDefinition:Ze,targetMatchUp:yt,matchUpFormat:$e,matchUpStatus:Se,scoreString:at,winningSide:Pe});if(yi!=null&&yi.error)return yi}}l&&fe({completeAllMatchUps:l})}_&&xv({tournamentRecord:m,event:Z})}else{let he=jR({drawEntries:Ze.entries,drawName:x||w,qualifyingPositions:D,drawId:pt,event:Z,stage:B});if(he.error)return he}return{...Q,event:Ge(Z),uniqueParticipantIds:ie,targetParticipants:re,drawDefinition:Ze,eventId:G,drawId:pt}}var Jte=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),R1e=Jte;function E0(t){return parseInt(t)}function cj({startTime:t="",endTime:e=""}={}){if(!t||!e||!Dd.test(t)||!Dd.test(e))return!1;let[i,r]=t.split(":").map(E0),[n,a]=e.split(":").map(E0);return n<i?!1:!(i===n&&a<r)}function E1e(t,e){let[i,r]=t.startTime.split(":").map(E0),[n,a]=e.startTime.split(":").map(E0);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function Xte({dateAvailability:t}){if(!t)return{error:l9};if(!Array.isArray(t))return{error:JU};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:JU};let{date:n,startTime:a,endTime:o,bookings:s=[]}=r;if(!a||!o)return{error:JU};if(n&&!ul.test(n))return{error:Fr,dateAvailability:{date:n},info:e};if(!Dd.test(a))return{error:Oo,dateAvailability:{startTime:a},info:i};if(!Dd.test(o))return{error:Oo,dateAvailability:{endTime:o},info:i};if(a===o)return{error:Oo,dateAvailability:{startTime:a,endTime:o},info:"startTime and endTime are equivalent"};if(!cj({startTime:a,endTime:o}))return{error:Oo,dateAvailability:{startTime:a,endTime:o},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:XS};for(let l of s){if(typeof l!="object")return{error:XS};let{startTime:u,endTime:c}=l;if(!Dd.test(u))return{error:Oo,booking:{startTime:u},info:i};if(!Dd.test(c))return{error:Oo,booking:{endTime:c},info:i};if(u===c)return{error:Oo,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!cj({startTime:u,endTime:c}))return{error:Oo,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function iE({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=au({tournamentRecord:t,venueId:i});if(!a)return{error:Th};a.courts||(a.courts=[]);let o={...Jte(),venueId:i,courtId:r};if(o.courtId||(o.courtId=Ht()),a.courts.some(s=>s.courtId===o.courtId))return{error:D9};{let s=((n==null?void 0:n.dateAvailability)||[]).map(c=>{var d;return{...c,date:ht(c.date),startTime:Si(c.startTime),endTime:Si(c.endTime),bookings:(d=c.bookings)==null?void 0:d.map(({startTime:p,endTime:m,bookingType:h})=>({startTime:Si(p),endTime:Si(m),bookingType:h}))}}),l=Object.keys(o);for(let c of l)if(n!=null&&n[c])if(c==="dateAvailability"){let d=Xte({dateAvailability:s});if(!d.valid&&d.error)return d;o.dateAvailability=s}else o[c]=n[c];let u=o;return a.courts.push(u),e||ut({payload:{venue:a,tournamentId:t.tournamentId},topic:Ep,key:a.venueId}),{...Q,court:Me(o),venueId:i}}}function W$(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:ed};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let o of Object.values(r)){let{venue:s}=au({tournamentRecord:o,venueId:i});if(s){let l=C1e({...t,tournamentRecord:o});for(let u of(l==null?void 0:l.courts)??[])n.push(u==null?void 0:u.courtId);if(l.error)return l;a=!0}}return a?{...Q,courtIds:n}:{error:Th}}function C1e({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:ed};let m=au({tournamentRecord:r,venueId:d});if(m.error)return m;let{venue:h}=m;if(!xi(o)||!n)return{error:T9};o=o??n.length;let f=De(0,o).map(g=>{let v=a==null?void 0:a[g],y=v?p.map(I=>({date:qo(I),startTime:s,endTime:u,...v})):e;return v&&s&&u&&y.push({startTime:s,endTime:u}),{courtName:n[g]||i&&(h==null?void 0:h.venueAbbreviation)&&`${h==null?void 0:h.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||c&&`${c}-${v+1}`;return iE({disableNotice:!0,tournamentRecord:r,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return f.length!==o?te({info:"not all courts could be generated",result:{error:le}}):(h&&ut({payload:{venue:h,tournamentId:r.tournamentId},topic:Ep,key:h.venueId}),{...Q,courts:Me(f)})}function q$({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,o=[];for(let[s,l]of i.entries()){let{venueAbbreviation:u,venueId:c=(r==null?void 0:r.pop())??Ht(),dateAvailability:d,startTime:p="07:00",endTime:m="19:00",courtTimings:h,courtsCount:f,courtNames:g,venueName:v,idPrefix:y,courtIds:I}=l,b={venueName:v||`Venue ${s+1}`,venueAbbreviation:u,venueId:c},S=Pw({tournamentRecord:t,venue:b});if(S.error){if(e)continue;return S}o.push(c);let w=ig(n,a),U=!Array.isArray(d)&&[{startTime:p,endTime:m}].concat(w.map(T=>({date:qo(T),startTime:p,endTime:m})));if(f||g){let T=W$({dateAvailability:d||U,tournamentRecord:t,courtTimings:h,courtsCount:f,courtNames:g,startTime:p,idPrefix:y,courtIds:I,endTime:m,venueId:c,dates:w});if(T.error)return T}}return o}function M1e(t){var e,i,r;let{tournamentRecord:n,leagueProfiles:a,eventIds:o,venueIds:s,drawIds:l,allUniqueParticipantIds:u,uuids:c}=t,d=0;for(let m of a){let h=[],{tieFormatName:f=r0,teamProfiles:g=[],teamsCount:v=0,category:y,idPrefix:I,gender:b}=m,S=m.leagueName??m.eventName??`League ${d+1}`,w=m.leagueId??m.eventId??(c==null?void 0:c.pop())??Ht();o.push(w);let U=At(m.tieFormat)&&m.tieFormat||Au({event:{eventId:w,category:y,gender:b},namedFormat:f,isMock:t.isMock})||void 0;if(!U)return{error:dv};let T=Math.max(v,g.length),D=De(0,T),{genders:P,teamSize:E}=G$({tieFormat:U,drawSize:T}),R={[hi]:0,[jn]:0,[Td]:0,[Qt]:0,[Fs]:0};Object.keys(P).forEach(A=>R[A]+=P[A]);for(let A of D){let M=((e=g==null?void 0:g[A])==null?void 0:e.teamName)??`Team ${A+1}`,C=((i=g==null?void 0:g[A])==null?void 0:i.teamId)||(c==null?void 0:c.pop())||Ht(),O=m.startDate??t.startDate,k=$v({...m==null?void 0:m.participantsProfile,participantsCount:E,consideredDate:O,gendersCount:R,category:y,gender:b,uuids:c}).participants,x=k.map(V=>V.participantId),F=Jt,$=C??D0({participantType:F,idPrefix:I,index:A,uuids:c});h.push({participantId:$,entryStatus:da,entryStage:Ne});let _=((r=g==null?void 0:g[A])==null?void 0:r.venueIds)??[],L={participantId:$,participantRole:en,participantName:M,individualParticipantIds:x,participantType:F,homeVenueIds:_};_.forEach(V=>!s.includes(V)&&s.push(V)),u.push(...x),u.push($);let B=us({participants:[L,...k],tournamentRecord:n});if(B.error)return B}let N={eventName:S,entries:h,eventType:Jt,tieFormat:U,category:y,eventId:w,gender:b};if(n.events||(n.events=[]),n.events.push(N),h.length){let A=(xi(m.roundsCount)&&m.roundsCount)??m.roundsCount===ySe?(T-1)*2:T-1,M=tU({automated:m.automated,tournamentRecord:n,drawType:Ha,roundsCount:A,drawSize:T,event:N});if(M.error)return M;let{drawDefinition:C}=M;if(C){let O=C==null?void 0:C.drawId;iU({drawDefinition:C,event:N,suppressNotifications:!0}),l.push(O)}}d++}let p=s.map(m=>({venueId:m}));q$({tournamentRecord:n,ignoreExistingVenues:!0,venueProfiles:p,uuids:c})}var N1e=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function Qte(t){var e,i,r;let{startDate:n,endDate:a}=t??{},{tournamentName:o=va(N1e),ratingsParameters:s=Tr,tournamentExtensions:l,policyDefinitions:u,schedulingProfile:c,venueProfiles:d,uuids:p}=t??{},m=(t==null?void 0:t.isMock)===!1?void 0:!0;if(n&&!wa(n)||a&&!wa(a))return{error:Fr};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:le};if(!n){let S=new Date;n=qo(a??S),a=qo(S.setDate(S.getDate()+7))}if(!a){let S=new Date(n);a=qo(S.setDate(S.getDate()+7))}let h=eE({...t.tournamentAttributes??{},tournamentName:o,startDate:n,endDate:a,isMock:m}),f=d!=null&&d.length?q$({tournamentRecord:h,venueProfiles:d,uuids:p}):[];if(l!=null&&l.length&&Array.isArray(l)){let S=l.filter(w=>pl({extension:w}));S!=null&&S.length&&Object.assign(h,{extensions:S,isMock:m})}if(typeof u=="object")for(let S of Object.keys(u))rp({policyDefinitions:{[S]:u[S]},tournamentRecord:h});if(!((e=t==null?void 0:t.leagueProfiles)!=null&&e.length)||(i=t.eventProfiles)!=null&&i.length||(r=t.drawProfiles)!=null&&r.length||t.participantsProfile){let S=jte({tournamentRecord:h,...t});if(!S.success)return S}let g=[],v=[],y=[];if(t.leagueProfiles){let S=M1e({allUniqueParticipantIds:g,tournamentRecord:h,...t,eventIds:v,venueIds:f,drawIds:y});if(S!=null&&S.error)return S}if(t.drawProfiles){let S=A1e({allUniqueParticipantIds:g,ratingsParameters:s,tournamentRecord:h,...t,eventIds:v,drawIds:y});if(S!=null&&S.error)return S}if(t.eventProfiles){let S=O1e({allUniqueParticipantIds:g,ratingsParameters:s,tournamentRecord:h,...t,eventIds:v,drawIds:y});if(S!=null&&S.error)return S}let{scheduledRounds:I=void 0,schedulerResult:b={}}=c?k1e({...t,tournamentRecord:h}):{};return gF(),Ge({...Q,tournamentRecord:h,scheduledRounds:I,schedulerResult:b,eventIds:v,venueIds:f,drawIds:y})}function A1e(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,o=0;for(let s of i){let l=tE({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:s,drawIndex:o,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if((s==null?void 0:s.addEvent)!==!1){if(l=Ov({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),n.push(c)}p!=null&&p.length&&r.push(...p),o+=1}}function O1e(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let o of e){let s=Kte({...t,eventIndex:a,eventProfile:o});if(s.error)return s;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=s;u&&n.push(...u),r.push(l),c!=null&&c.length&&i.push(...c),a+=1}}function k1e(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,o=P1e({schedulingProfile:e,tournamentRecord:i});if(o.error)return o;let s=o.scheduledRounds;if(r){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:ZR({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:n}),scheduledRounds:s}}return{scheduledRounds:s}}var Zte={};wt(Zte,{anonymizeTournamentRecord:()=>eie,modifyTournamentRecord:()=>tie});function eie({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){var o,s,l,u,c;if(!i)return{error:ve};let d=Array.isArray(t)?w2.concat(...t):w2,p=L=>{var B;return Array.isArray(t)?(B=L==null?void 0:L.extensions)==null?void 0:B.filter(V=>d.includes(V.name)):L==null?void 0:L.extensions},m={};i.extensions=p(i);let h=a||Ht();m[i.tournamentId]=h,i.tournamentId=h,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${qo(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let L of i.participants||[]){L.extensions=p(L),L.onlineResources=[];let B=Ht();m[L.participantId]=B,L.participantId=B}for(let L of i.participants||[])Array.isArray(L.individualParticipantIds)&&(L.individualParticipantIds=L.individualParticipantIds.map(B=>m[B]));let f=0;for(let L of i.venues||[]){L.venueAbbreviation=`V${f}`,L.extensions=p(L),L.venueName=`Venue #${f}`,L.onlineResources=[],L.addresses=[];let B=Ht();m[L.venueId]=B,L.isMock=!0,f+=1;let V=0;for(let G of L.courts||[])G.courtName=`V${f}C${V}`,G.extensions=p(G),G.onlineResources=[],G.isMock=!0,V+=1}let g=1;for(let L of i.events||[]){L.extensions=p(L),L.onlineResources=[],L.isMock=!0;let B=Ht();m[L.eventId]=B,L.eventId=B;let V=((o=L.category)==null?void 0:o.categoryName)||((s=L.category)==null?void 0:s.ageCategoryCode)||((l=L.category)==null?void 0:l.ratingType)||L.gender;if(L.eventName=`Event ${g} ${V}`,Array.isArray(L.entries))for(let j of L.entries)j.participantId=m[j.participantId];for(let j of L.drawDefinitions||[]){j.extensions=p(j);let z=Ht();if(m[j.drawId]=z,j.drawId=z,j.isMock=!0,Array.isArray(j.entries))for(let q of j.entries)q.participantId=m[q.participantId];let W=q=>{q.extensions=p(q);let Y=Ht();m[q.structureId]=Y,q.structureId=Y;for(let re of q.positionAssignments||[])re.participantId&&(re.participantId=m[re.participantId]);for(let re of q.seedAssignments||[])re.participantId&&(re.participantId=m[re.participantId]);for(let re of q.matchUps||[]){re.isMock=!0;for(let J of re.sides||[])J.lineUp&&(J.lineUp=J.lineUp.map(({participantId:H,collectionAssignments:Z})=>({participantId:m[H],collectionAssignments:Z})))}};for(let q of j.structures||[])if(W(q),Array.isArray(q.structures))for(let Y of q.structures)W(Y);for(let q of j.links||[])q.source.structureId=m[q.source.structureId],q.target.structureId=m[q.target.structureId]}let{extension:G}=It({name:os,element:L});Array.isArray((u=G==null?void 0:G.value)==null?void 0:u.flights)&&((c=G==null?void 0:G.value.flights)==null||c.forEach(j=>{if(j.drawId=m[j.drawId],Array.isArray(j.drawEntries))for(let z of j.drawEntries)z.participantId=m[z.participantId]})),g+=1}let v=i.startDate||qo(new Date),y=(i.participants||[]).filter(({participantType:L})=>L===Dt),I=y.reduce((L,B)=>{var V;let G=(V=B.person)==null?void 0:V.sex;return[Qt,hi].includes(G)?L[G]+=1:L[Td]+=1,L},{[Qt]:0,[hi]:0,[Td]:0}),b=Object.assign({},...Object.keys(I).map(L=>{var B;return{[L]:((B=Vte({category:{ageCategoryCode:"O18"},count:I[L],addressProps:{citiesCount:10},personExtensions:[],consideredDate:v,sex:L}))==null?void 0:B.persons)||[]}})),S={[Qt]:0,[hi]:0,[Td]:0},w=y.length,U=y.reduce((L,B)=>{var V,G;let j=((G=(V=B.person)==null?void 0:V.addresses)==null?void 0:G[0])||{},{city:z,state:W,postalCode:q}=j;return L.cities.includes(z)||L.cities.push(z),L.states.includes(W)||L.states.push(W),L.postalCodes.includes(q)||L.postalCodes.push(q),L},{cities:[],postalCodes:[],states:[]}),T=U.postalCodes.length,D=U.cities.length,P=U.states.length,{cities:E}=Lte({count:D||w,participantsCount:w}),{states:R}=_te({count:P||w,participantsCount:w}),{postalCodes:N}=$te({count:T||w,participantsCount:w}),A={cities:E,states:R,postalCodes:N};y.forEach((L,B)=>{var V,G;let j=L==null?void 0:L.person,z=(j==null?void 0:j.sex)||Td,W=(V=ht(j==null?void 0:j.birthDate))==null?void 0:V.split("-")[0],q=S[z],Y=b[z][q];if(S[z]+=1,W){let[,re,J]=((G=Y==null?void 0:Y.birthDate)==null?void 0:G.split("-"))||[],H=[W,re,J].join("-");Y.birthDate=H}if(j!=null&&j.addresses){let re=Bte({...A,participantIndex:B,nationalityCode:Y.nationalityCode});Y.addresses=[re]}Y.personId=(n==null?void 0:n[B])||Ht(),e?(Y.standardFamilyName=Y.lastName,Y.standardGivenName=Y.firstName,L.participantName=`${Y.standardGivenName} ${Y.standardFamilyName}`):(Y.standardFamilyName=j==null?void 0:j.standardFamilyName,Y.standardGivenName=j==null?void 0:j.standardGivenName),delete Y.firstName,delete Y.lastName,Y.extensions=p(j),L.person=Y,m[j==null?void 0:j.personId]=Y.personId}),(i.participants||[]).filter(({participantType:L})=>L===gt).forEach(L=>{let{individualParticipantIds:B}=L;L.participantName=x1e({individualParticipantIds:B,individualParticipants:y})});let M=(i.participants||[]).filter(({participantType:L})=>L===Jt),C=M.length,O=P0({count:C}).names;M.forEach((L,B)=>{L.participantName=O[B]});let k=(i.participants||[]).filter(({participantType:L})=>L===Qa),x=k.length,F=P0({count:x,nameRoot:"Group"}).names;k.forEach((L,B)=>{L.participantName=F[B]});let{extension:$}=It({element:i,name:Bm});Array.isArray($==null?void 0:$.value)&&($==null||$.value.forEach(L=>{L.tournamentId=m[L.tournamentId],L.structureId=m[L.structureId],L.eventId=m[L.eventId],L.drawId=m[L.drawId]}));let{extension:_}=It({element:i,name:bv});return Array.isArray(_==null?void 0:_.value)&&(_==null||_.value.forEach(L=>{L.personId=m[L.personId]})),{...Q}}function x1e({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function tie(t){var e,i,r;let{ratingsParameters:n=Tr,participantsProfile:a={},matchUpStatusProfile:o,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:u,randomWinningSide:c,schedulingProfile:d,tournamentRecord:p,autoSchedule:m,eventProfiles:h,periodLength:f,venueProfiles:g,drawProfiles:v,isMock:y,uuids:I}=t;if(!p)return{error:ve};let b=[],S=[],w=[];h==null||h.forEach(R=>{var N;let A=(N=p.events)==null?void 0:N.find((M,C)=>R.eventIndex!==void 0&&C===R.eventIndex||R.eventName&&M.eventName===R.eventName||R.eventId&&M.eventId===R.eventId);A!=null&&A.gender&&(R.gender=A.gender)});let U=((e=p.participants)==null?void 0:e.length)||void 0;U&&a!=null&&a.idPrefix&&(a.idPrefix=`${a.idPrefix}-${U}`);let T=jte({startDate:p.startDate,participantsProfile:a,tournamentRecord:p,eventProfiles:h,drawProfiles:v,uuids:I});if(!T.success)return T;if(h){let R=((i=p.events)==null?void 0:i.length)||0;for(let N of h){let{ratingsParameters:A}=N,M=(r=p.events)==null?void 0:r.find((C,O)=>N.eventIndex!==void 0&&O===N.eventIndex||N.eventName&&C.eventName===N.eventName||N.eventId&&C.eventId===N.eventId);if(M){let{gender:C,category:O,eventType:k}=M,{drawProfiles:x,publish:F}=N,$=Ji(cl)(k)&&Dt||Ji(go)(k)&&gt||k;if(x){let{stageParticipantsCount:_,uniqueParticipantsCount:L,uniqueParticipantStages:B}=Gte({drawProfiles:x,category:O,gender:C}),{uniqueDrawParticipants:V=[],uniqueParticipantIds:G=[]}=B?qte({event:{eventType:k,category:O,gender:C},uniqueParticipantsCount:L,participantsProfile:a,ratingsParameters:A,tournamentRecord:p,eventProfile:N,uuids:I}):{};b.push(...G);let{stageParticipants:j}=Hte({targetParticipants:p.participants||[],allUniqueParticipantIds:b,stageParticipantsCount:_,eventParticipantType:$}),z=Yte({uniqueDrawParticipants:V,autoEntryPositions:l,stageParticipants:j,tournamentRecord:p,drawProfiles:x,category:O,gender:C,event:M});if(z.error||(z=Wte({matchUpStatusProfile:o,completeAllMatchUps:s,randomWinningSide:c,tournamentRecord:p,drawProfiles:x,isMock:y,event:M}),z.error))return z;w.push(...z.drawIds)}F&&xv({tournamentRecord:p,event:M})}else{let C=Kte({startDate:p.startDate,allUniqueParticipantIds:b,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,randomWinningSide:c,ratingsParameters:A,tournamentRecord:p,eventProfile:N,eventIndex:R,uuids:I});if(C.error)return C;let{eventId:O,drawIds:k,uniqueParticipantIds:x}=C;k&&w.push(...k),S.push(O),x!=null&&x.length&&b.push(...x),R+=1}}}if(v){let R=(p.events||[]).map(N=>{var A;return((A=N.drawDefinitions)==null?void 0:A.map(()=>1))||[]}).flat().reduce((N,A)=>N+A,0);for(let N of v){let A=tE({startDate:p.startDate,allUniqueParticipantIds:b,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:u,randomWinningSide:c,ratingsParameters:n,tournamentRecord:p,drawProfile:N,drawIndex:R,uuids:I});if(A.error)return A;let{drawId:M,eventId:C,event:O,uniqueParticipantIds:k}=A;if(A=Ov({tournamentRecord:p,event:O,internalUse:!0}),A.error)return A;M&&w.push(M),S.push(C),k!=null&&k.length&&b.push(...k),R+=1}}let D=g!=null&&g.length?q$({tournamentRecord:p,venueProfiles:g}):[],P,E={};if(d!=null&&d.length){let R={[p.tournamentId]:p},N=Nv({tournamentRecords:R,schedulingProfile:d});if(N.error)return N;if(m){let{tournamentId:A}=p,M={[A]:p};E=ZR({tournamentRecords:M,periodLength:f})}}return{totalParticipantsCount:p.participants.length,scheduledRounds:P,schedulerResult:E,...Q,eventIds:S,venueIds:D,drawIds:w}}var iie={};wt(iie,{addDynamicRatings:()=>y_,addIndividualParticipantIds:()=>WR,addParticipant:()=>fl,addParticipants:()=>us,addPenalty:()=>Sie,addPersonRequests:()=>lie,addPersons:()=>Tie,createGroupParticipant:()=>hie,createTeamsFromParticipantAttributes:()=>j$,deleteParticipants:()=>Bh,filterParticipants:()=>Aw,findParticipant:()=>mie,getCompetitionParticipants:()=>O_,getPairedParticipant:()=>ls,getParticipantEventDetails:()=>k_,getParticipantMembership:()=>x_,getParticipantScaleItem:()=>vg,getParticipantSchedules:()=>F_,getParticipantSignInStatus:()=>L_,getParticipantTimeItem:()=>dL,getParticipants:()=>Ai,getScaleValues:()=>Iv,mergeParticipants:()=>Uie,modifyIndividualParticipantIds:()=>uie,modifyParticipant:()=>qR,modifyParticipantName:()=>fie,modifyParticipantOtherName:()=>die,modifyParticipantsSignInStatus:()=>cie,modifyPenalty:()=>bie,modifyPersonRequests:()=>oie,mutate:()=>rie,participantScaleItem:()=>_l,query:()=>aee,regenerateParticipantNames:()=>pie,removeIndividualParticipantIds:()=>NL,removeParticipantIdsFromAllTeams:()=>eR,removePenalty:()=>Iie,removePersonRequests:()=>sie,removeRatings:()=>vie,scaledTeamAssignment:()=>gie,setParticipantScaleItem:()=>Kw,setParticipantScaleItems:()=>ZQ,validateLineUp:()=>iR});var rie={};wt(rie,{addDynamicRatings:()=>y_,addIndividualParticipantIds:()=>WR,addParticipant:()=>fl,addParticipants:()=>us,addPenalty:()=>Sie,addPersonRequests:()=>lie,addPersons:()=>Tie,createGroupParticipant:()=>hie,createTeamsFromParticipantAttributes:()=>j$,deleteParticipants:()=>Bh,findParticipant:()=>mie,mergeParticipants:()=>Uie,modifyIndividualParticipantIds:()=>uie,modifyParticipant:()=>qR,modifyParticipantName:()=>fie,modifyParticipantOtherName:()=>die,modifyParticipantsSignInStatus:()=>cie,modifyPenalty:()=>bie,modifyPersonRequests:()=>oie,regenerateParticipantNames:()=>pie,removeIndividualParticipantIds:()=>NL,removeParticipantIdsFromAllTeams:()=>eR,removePenalty:()=>Iie,removePersonRequests:()=>sie,removeRatings:()=>vie,scaledTeamAssignment:()=>gie,setParticipantScaleItem:()=>Kw,setParticipantScaleItems:()=>ZQ});function nie(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function aie({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:o,endTime:s}=n;return n.requestType===sU&&(a=ht(a),o=Si(o),s=Si(s),a&&o&&s)?{date:a,startTime:o,endTime:s,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=nie(),t[e].push(n);return{mergeCount:r.length}}function Y$(t){let{tournamentRecords:e,personRequests:i}=t,r=We(t,[{[gn]:!0}]);if(r.error)return r;if(!i)return{...Q};let n=Object.values(e);for(let a of n){let o=a.participants??[],s=[];for(let l of Object.keys(i))if(Oc({tournamentParticipants:o,personId:l})){let u=i[l];u.length&&s.push({personId:l,requests:u})}Object.keys(s).length&&_t({element:a,extension:{value:s,name:bv}})}return{...Q}}function oie(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=We(t,[{[gn]:!0},{requests:!0,[Xn]:dn,[za]:le}]);if(n.error)return n;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:o}=Lp({tournamentRecords:e}),s=u=>{o&&(o[u]=o[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(r&&o!=null&&o[r])s(r);else if(o)for(let u of Object.keys(o))s(u);let l=i.filter(u=>!u.requestId);return l.length&&aie({personRequests:o,personId:r,requests:l}),Y$({tournamentRecords:e,personRequests:o})}function sie(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,o=We(t,[{[gn]:!0}]);if(o.error)return o;let{personRequests:s}=Lp({tournamentRecords:e}),l=c=>{var d;s&&(s[c]=s[c].filter(p=>(!i||p.requestType!==i)&&(!r||p.requestId!==r)&&(!a||p.date!==a)),(d=s==null?void 0:s[c])!=null&&d.length||delete s[c])},u=!i&&!r&&!n&&!a;if(!u){if(n&&s!=null&&s[n])l(n);else if(s)for(let c of Object.keys(s))l(c)}return u||!s||!Object.keys(s).length?Dn({name:bv,tournamentRecords:e,discover:!0}):Y$({tournamentRecords:e,personRequests:s})}function lie(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=We(t,[{[gn]:!0,[PSe]:!0},{requests:!0,[Xn]:dn,[za]:le}]);if(n.error)return n;let{personRequests:a}=Lp({tournamentRecords:e}),{mergeCount:o}=aie({personRequests:a,personId:i,requests:r});return o&&a?Y$({tournamentRecords:e,personRequests:a}):{error:le}}function uie({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return te({result:{error:ve},stack:r});if(!e||!t)return te({result:{error:Qe},stack:r});let n=i.participants||[],a=n.find(m=>m.participantId===e);if(!a)return te({result:{error:Wi},stack:r});if(![Jt,Qa].includes(a.participantType))return te({result:{error:xs},context:{participantType:a.participantType},stack:r});let o=t.filter(m=>{var h;return((h=n.find(f=>f.participantId===m))==null?void 0:h.participantType)!==Dt});if(o.length)return te({result:{error:ba,invalidParticipantIds:o},stack:r});let s=a.individualParticipantIds||[],l=t.filter(m=>!s.includes(m)),u=s.filter(m=>!t.includes(m)),c=WR({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return te({result:c,stack:r});let d=NL({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return te({result:d,stack:r});let{topics:p}=Do();if(p.includes(on)){let m=n.find(({participantId:h})=>h===e);ut({topic:on,payload:{tournamentId:i.tournamentId,participants:[m]}})}return{...c,...d}}function cie({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:Qe};if(![my,kJ].includes(i))return{error:le,signInState:i};let r=t.participants||[];if(!r.length)return{error:ew};let n=r.map(Tt),a=e.filter(u=>!n.includes(u));if(a.length)return{error:le,context:{invalidParticipantIds:a}};let o=[],s=new Date().toISOString();for(let u of r){let{participantId:c}=u;if(e.includes(c)){let d=s_({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:hw,itemValue:i,createdAt:s}});if(d.error)return d;o.push(u)}}let{topics:l}=Do();return o.length&&l.includes(on)&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:o}}),{...Q}}function die({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:ve};if(!e)return{error:fr};let{participant:r}=ad({tournamentRecord:t,participantId:e});if(!r)return{error:Wi};r.participantOtherName=i;let{topics:n}=Do();return n.includes(on)&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...Q}}function dj({personFormat:t,person:e}){let i=f=>f.replace(/\W/g,""),r=f=>/^[a-z]*$/.test(i(f)),n=f=>/^[A-Z]*$/.test(i(f)),a=f=>/^[LAST]{4}/.test(i(f)),o=f=>f.toLowerCase().indexOf("l")<f.toLowerCase().indexOf("f"),s=f=>f.indexOf(",")>=0,l=f=>f.toLowerCase().indexOf("f.")>=0,u=f=>f.toLowerCase().indexOf("f")<0,c=f=>f.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=EM((e==null?void 0:e.standardGivenName)??""),m=EM((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${m}`;l(t)&&!s(t)&&!o(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),m=m.toLowerCase()):n(t)?(p=p.toUpperCase(),m=m.toUpperCase()):a(t)&&(m=m.toUpperCase());let h=`${p}${d}${m}`;return u(t)?h=m:o(t)&&(s(t)?h=`${m},${d}${p}`:h=`${m}${d}${p}`),h}function F1e({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,o=r&&i[r];if(r!==Gn&&o){let{personFormat:s,doublesJoiner:l}=o;r===Dt&&(e.participantName=dj({person:a,personFormat:s})),r===gt&&(e.participantName=n==null?void 0:n.map(u=>{var c;let d=(c=t[u])==null?void 0:c.person;return dj({person:d,personFormat:s})}).filter(Boolean).join(l??"/"))}}function pie({tournamentRecord:t,formats:e}){if(!t)return{error:ve};if(!At(e))return{error:Qe};let i=t.participants??[],r=AK(i,"participantId");for(let n of i)F1e({participant:n,participantMap:r,formats:e});return{...Q}}function mie(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,o=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Qe,stack:"publicFindParticipant"};let s,l;for(let u of Object.values(o)){l=u.tournamentId;let c=u.participants||[];if(s=Oc({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),s)break}return{participant:s,tournamentId:l,...Q}}function hie({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=wX,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:ve};if(!a)return{error:Qe,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:le};let o=(Ai({participantFilters:{participantTypes:[Dt]},tournamentRecord:r}).participants??[]).map(c=>c.participantId);for(let c of t)if(!o.includes(c))return{error:xs,participantId:c};let s=Ge({participantId:n||Ht(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:Qa,participantRole:i}),l=fl({participant:s,tournamentRecord:r});if(l.error)return l;let{topics:u}=Do();return u.includes(xc)&&ut({topic:xc,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...Q,participant:Me(s)}}function fie({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:ve};if(!i)return{error:fr};if(!e)return{error:Qe,info:"Missing participantName"};let{participant:r}=ad({tournamentRecord:t,participantId:i});if(!r)return{error:Wi};r.participantName=e;let{topics:n}=Do();return n.includes(on)&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...Q}}function gie({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:u,eventId:c,event:d}){var p,m,h,f,g;if(!o)return{error:ve};if(!Array.isArray(a)&&!st(u)&&!c||!st(r)||n&&!Array.isArray(n)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:le};if(!s&&!n.length||!n&&!(e&&s))return{error:Qe,info:"Missing scaling details"};if(c&&!a){if((d==null?void 0:d.eventType)!==Ca)return{error:ql};a=(p=d==null?void 0:d.entries)==null?void 0:p.filter(({entryStatus:w})=>w===da).map(Tt)}if(!(a!=null&&a.length)&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Qe};let v=e??n.map(({participantId:w})=>w);i&&(a==null||a.reverse(),r+=1),r>((a==null?void 0:a.length)||0)-1&&(r=0);let y=(a==null?void 0:a.slice(r).concat(...a.slice(0,r)))??[],I=[];for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(y.includes(U)){if(T!==Gn)return{error:xs,participant:w};I.push(w)}}if(u&&I.length<u){let w=u-((I==null?void 0:I.length)||0),U=l??"Team",T=De(0,w).map(R=>({participantName:`${U} ${R+1}`,participantType:Gn,participantRole:en})),{participants:D=[]}=us({participants:T,returnParticipants:!0,tournamentRecord:o}),P=D.map(Tt),E=((m=o.participants)==null?void 0:m.filter(({participantId:R})=>P.includes(R)))??[];I.push(...E)}if(!I.length)return{error:cF};if(t)for(let w of I)w.individualParticipantIds=[];else{let w=I.map(U=>U).flat();e!=null&&e.length?v=v.filter(U=>!w.includes(U)):n=n==null?void 0:n.filter(({participantId:U})=>!w.includes(U))}if(!(e!=null&&e.length)&&!(n!=null&&n.length))return{error:pP,info:"Nothing to be done"};if(!n.length){for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(!v.includes(U))continue;if(T!==Dt)return{error:xs,participant:w};let D=(h=_l({scaleAttributes:s,participant:w}))==null?void 0:h.scaleItem,P=s!=null&&s.accessor?(f=D==null?void 0:D.scaleValue)==null?void 0:f[s==null?void 0:s.accessor]:D==null?void 0:D.scaleValue,E={participantId:U,scaleValue:P};n.push(E)}if(!n.length)return{error:Wi}}n.sort((w,U)=>s!=null&&s.sortOrder?((U==null?void 0:U.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((U==null?void 0:U.scaleValue)||1/0));for(let w of n)if(!w.participantId)return{error:le,scaledParticipant:w};let b=0;for(;b<n.length;){for(let w of I){if(b+1>n.length)break;let U=n[b];w.individualParticipantIds.push(U.participantId),b++}I.reverse()}let S=I.map(Tt);for(let w of o.events??[]){if(w.eventType!==Ca)continue;let U=(w.entries??[]).filter(T=>S.includes(T.participantId));for(let T of U){let D=T.participantId,P=(g=I.find(R=>R.participantId===D))==null?void 0:g.individualParticipantIds;w.entries=(w.entries??[]).filter(R=>!P.includes(R.participantId)),(w.drawDefinitions??[]).forEach(R=>{R.entries=(R.entries??[]).filter(N=>!P.includes(N.participantId))});let{flightProfile:E}=Hi({event:w});((E==null?void 0:E.flights)||[]).forEach(R=>{R.drawEntries=(R.drawEntries||[]).filter(N=>!P.includes(N.participantId))})}}return{...Q,scaledParticipants:n}}function vie(t){let e=We(t,[{[Ur]:!0,[xF]:!0},{ratingType:!1,[Jr]:o=>Tr[o]}]);if(e.error)return e;let i=`${t.ratingType}.${$F}`,r=t.asDynamic?i:t.ratingType,n=[Xd,yc,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let o of a)o.timeItems&&(o.timeItems=o.timeItems.filter(s=>s.itemType!==n));return{...Q}}function Iie(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=L1e({...t,tournamentRecord:i});if(r.error&&r.error!==tg)return r}return{...Q}}function L1e({tournamentRecord:t,penaltyId:e}){if(!t)return{error:ve};if(!e)return{error:aF};let i=(t==null?void 0:t.participants)??[],r=[],n=!1,a;return i.forEach(o=>{let s=!1;o.penalties=(o.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,n||(a=l,n=!0)),s&&r.push(o),l.penaltyId!==e))}),a&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...Q,penalty:a}:{error:tg}}var _1e=({penaltyId:t=Ht()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),yie=_1e;function bie(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=$1e({...t,tournamentRecord:i});if(r.error&&r.error!==tg||r.success)return r}return{error:tg}}function $1e({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:ve};if(!e)return{error:le,modifications:e};if(!i)return{error:aF};let r=(t==null?void 0:t.participants)??[],n=Object.keys(yie()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:mP};let o,s=[];return r.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),o||(o=c)),c)),u&&s.push(l)}),o&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:s}}),o?{...Q,penalty:o}:{error:tg}}function wie(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:dt(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=dt(t[n].map(o=>JSON.stringify(o)).concat(e[n].map(o=>JSON.stringify(o)))).map(o=>JSON.parse(o));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=wie(t[n],e[n],i):r[n]=e[n];return r},{})}function Uie({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:ve};e.participants||(e.participants=[]);let r=t.filter(Na(Xl)).map(u=>({[u.participantId]:u})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(u=>{if(n[u.participantId]){let c=wie(u,n[u.participantId],i);return a.push(c),c}return u});let o=e.participants.map(Na(Xl))||[],s=t.filter(({participantId:u})=>!o.includes(u)),{topics:l}=Do();return s.length&&(e.participants=e.participants.concat(...s),l.includes(xc)&&ut({topic:xc,payload:{participants:s}})),a.length&&l.includes(on)&&ut({topic:on,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...Q}}function Sie(t){var e;let{tournamentRecord:i,participantIds:r}=t,n=t.tournamentRecords??(i&&{[i.tournamentId]:i})??{},a;for(let o of Object.values(n)){let s=(e=Ai({tournamentRecord:o}).participants??[])==null?void 0:e.map(Tt).filter(l=>r.includes(l));s.length&&(a=B1e({...t,penaltyId:t.penaltyId??a,tournamentRecord:o,participantIds:s}).penaltyId)}return a?{...Q,penaltyId:a}:{error:Wi}}function B1e({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:u}){if(!e)return{error:ve};if(!i)return{error:fr};if(!n)return{error:S9};let c=((e==null?void 0:e.participants)??[]).filter(m=>i.includes(m.participantId));if(!c.length)return{error:Wi};let d=new Date().toISOString(),p=Object.assign(yie({penaltyId:o}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:s,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(m=>_t({element:p,extension:m})),c.forEach(m=>{m.penalties||(m.penalties=[]),m.penalties.push(p)}),ut({topic:on,payload:{tournamentId:e.tournamentId,participants:c}}),{...Q,penaltyId:p.penaltyId}}function Tie({participantRole:t=en,tournamentRecord:e,persons:i}){var r;if(!e)return{error:ve};if(!Array.isArray(i))return{error:le};if(!Object.keys(ML).includes(t))return{error:p9};let n=(e.participants||[]).map(({person:f})=>f==null?void 0:f.personId).filter(Boolean),a=[],o=i.filter(f=>f&&(!f.personId||!n.includes(f.personId))).map(f=>(f.personId||(f.personId=Ht()),a.push(f.personId),f)),s=(f,g)=>Object.assign({},...Object.keys(f).filter(v=>!g.includes(v)).map(v=>({[v]:f[v]}))),l=o.map(f=>Ge({extensions:f.participantExtensions,timeItems:f.participantTimeItems,participantType:Dt,participantRole:t,person:s(f,["participantExtensions","participantTimeItems","pairedPersons"])})),u=0,c=0,d=us({participants:l,tournamentRecord:e});if(d.error)return d;c=d.addedCount||0;let p=[],m=((r=Ai({participantFilters:{participantTypes:[Dt]},tournamentRecord:e}))==null?void 0:r.participants)??[];if(t===en&&i.filter(({pairedPersons:f})=>f).forEach(({personId:f,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[f,v.personId].map(I=>Oc({tournamentParticipants:m,personId:I})).filter(Boolean);if(y.length===2){let I=y.map(Tt);p.push(Ge({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:en,individualParticipantIds:I,participantType:gt}))}})}),p.length){if(d=us({participants:p,tournamentRecord:e}),d.error)return d;u=d.addedCount||0}let h=c+u;return{...Q,addedCount:h,newPersonIds:a}}var Die={};wt(Die,{bulkUpdatePublishedEventIds:()=>z_,getAllEventData:()=>W_,getCourtInfo:()=>KP,getDrawData:()=>RR,getEventData:()=>ER,getEventPublishStatus:()=>Mo,getPublishState:()=>$h,getTournamentPublishStatus:()=>Nw,getVenueData:()=>hg,mutate:()=>Pie,publishEvent:()=>xv,publishEventSeeding:()=>Rie,publishOrderOfPlay:()=>Aie,publishParticipants:()=>Nie,query:()=>dee,setEventDisplay:()=>VR,unPublishEvent:()=>Oie,unPublishEventSeeding:()=>Eie,unPublishOrderOfPlay:()=>Mie,unPublishParticipants:()=>Cie});var Pie={};wt(Pie,{publishEvent:()=>xv,publishEventSeeding:()=>Rie,publishOrderOfPlay:()=>Aie,publishParticipants:()=>Nie,setEventDisplay:()=>VR,unPublishEvent:()=>Oie,unPublishEventSeeding:()=>Eie,unPublishOrderOfPlay:()=>Mie,unPublishParticipants:()=>Cie});function Rie({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=Za,drawIds:a=[],event:o}){var s,l,u,c;if(!r)return{error:ve};if(!o)return{error:Ii};let d=Mo({event:o,status:n}),p=(((s=d==null?void 0:d.seeding)==null?void 0:s.seedingScaleNames)||i)&&{...(l=d==null?void 0:d.seeding)==null?void 0:l.seedingScaleNames,...i},m=(((u=d==null?void 0:d.seeding)==null?void 0:u.stageSeedingScaleNames)||e)&&{...(c=d==null?void 0:d.seeding)==null?void 0:c.stageSeedingScaleNames,...e},h=Ge({stageSeedingScaleNames:m,seedingScaleNames:p,published:!0,drawIds:a});return kv({statusObject:{seeding:h},removePriorValues:t,status:n,event:o}),ut({topic:CJ,payload:{tournamentId:r.tournamentId,eventId:o.eventId,drawIds:a}}),{...Q}}function Eie({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=Za,drawIds:n,stages:a,event:o}){var s,l;if(!i)return{error:ve};if(!o)return{error:Ii};let u=Mo({event:o});if(u){let c=u.seeding;if(Array.isArray(a)&&c.stageSeedingScaleNames)for(let d of a)c.stageSeedingScaleNames[d]&&delete c.stageSeedingScaleNames[d];Array.isArray(e)&&c!=null&&c.seedingScaleNames&&(c.seedingScaleNames=c.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(n)&&c!=null&&c.drawIds&&(c.drawIds=c.drawIds.filter(d=>!n.includes(d))),(!Object.values(c.stageSeedingScaleNames??{}).length&&!((s=c.seedingScaleNames)!=null&&s.length)&&!((l=c.drawIds)!=null&&l.length)||!a&&!e&&!(n!=null&&n.length))&&(delete c.stageSeedingScaleNames,delete c.seedingScaleNames,delete c.drawIds,c.published=!1),kv({statusObject:{seeding:c},removePriorValues:t,status:r,event:o})}return ut({topic:sL,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...Q}}function Cie(t){let e=Po(t);if(!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=V1e({tournamentRecord:i,...t});if(r.error)return r}return{...Q}}function V1e({removePriorValues:t=!0,tournamentRecord:e,status:i=Za}){if(!e)return{error:ve};let r=`${od}.${sd}`,{timeItem:n}=Ro({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].participants,Tl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),ut({payload:{tournamentId:e.tournamentId},topic:t0e}),{...Q}}function Mie(t){let e=Po(t);if(!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=j1e({tournamentRecord:i,...t});if(r.error)return r}return{...Q}}function j1e({removePriorValues:t=!0,tournamentRecord:e,status:i=Za}){if(!e)return{error:ve};let r=`${od}.${sd}`,{timeItem:n}=Ro({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Tl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),ut({topic:lL,payload:{tournamentId:e.tournamentId}}),{...Q}}function Nie(t){let e=Po(t);if(!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=G1e({tournamentRecord:i,...t});if(r.error)return r}return{...Q}}function G1e({removePriorValues:t,tournamentRecord:e,status:i=Za}){if(!e)return{error:ve};let r=`${od}.${sd}`,{timeItem:n}=Ro({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i].participants={published:!0},Tl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),ut({payload:{tournamentId:e.tournamentId},topic:NJ}),{...Q}}function Aie(t){let e=Po(t);if(!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=H1e({tournamentRecord:i,...t});if(r.error)return r}return{...Q}}function H1e({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=Za,eventIds:n=[]}){if(!i)return{error:ve};let a=`${od}.${sd}`,{timeItem:o}=Ro({element:i,itemType:a}),s=(o==null?void 0:o.itemValue)||{[r]:{}};return s[r].orderOfPlay={published:!0,scheduledDates:t,eventIds:n},Tl({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:e}),ut({topic:MJ,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...Q}}function Oie({removePriorValues:t=!0,tournamentRecord:e,status:i=Za,event:r}){if(!e)return{error:ve};if(!r)return{error:Ii};let n=`${od}.${sd}`,{timeItem:a}=fw({itemType:n,event:r}),o=(a==null?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,Gh({event:r,timeItem:{itemValue:o,itemType:n},removePriorValues:t}),kv({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),ut({topic:oL,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...Q}}var kie={};wt(kie,{getEntryStatusReports:()=>W1e,getParticipantStats:()=>z1e,getStructureReports:()=>Y1e,getVenuesReport:()=>J1e});function z1e({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:o,matchUps:s}){var l,u,c,d,p;if(!n)return{error:ve};if(s&&!Array.isArray(s))return{error:ua};if(s=s??Hr({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(s!=null&&s.length))return{error:Qu};let m=[];e&&m.push(e),r&&m.push(r);let h=m.length?{participantIds:m}:{participantTypes:[Gn]},f=Ai({participantFilters:h,tournamentRecord:n}).participants??[];if(!f.every(({participantType:R})=>R===Gn))return{error:ba};m.length||m.push(...f.map(Tt));let g=new Map,v=new Map,y=new Map,I=new Map,b=(R,N="")=>v.get(R)||v.set(R,{participantName:N,participantId:R,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&v.get(R);for(let R of f){let{participantId:N,individualParticipantIds:A}=R;I.set(N,A??[]),b(N,R.participantName)}if(r&&!I.get(r))return te({result:{error:Wi},context:{teamParticipantId:r}});if(e&&!I.get(e))return te({result:{error:Wi},context:{opponentParticipantId:e}});let S=[],w=R=>{let N=[[],[]];for(let M of R){let C=M.participant;if(C!=null&&C.participantName){g.set(C.participantId,{participantName:C.participantName,ratings:C.ratings});let O=v.get(C.participantId);O&&(O.participantName=C.participantName)}}let A=({side:M,individualParticipantIds:C})=>{var O,k,x,F,$;return M.participantId&&(!(C!=null&&C.length)||C.includes(M.participantId))&&[M.participantId]||((k=(O=M.participant)==null?void 0:O.individualParticipantIds)==null?void 0:k.length)&&(!(C!=null&&C.length)||ji(C,(x=M.participant)==null?void 0:x.individualParticipantIds).length===(($=(F=M.participant)==null?void 0:F.individualParticipantIds)==null?void 0:$.length))&&M.participant.individualParticipantIds};if(I.size){let M=(C,O)=>{for(let k of R){if(!k.participant)continue;let x=A({individualParticipantIds:O,side:k});if(x!=null&&x.length){let F=k.sideNumber;if(!F)continue;let $=[C];i&&$.push(...x),N[F-1]=$;let _=v.get(C);for(let L of x.filter(Boolean))_&&!_.competitorIds.includes(L)&&_.competitorIds.push(L)}}};if(r)(!e||R.every(C=>C.participant&&(A({individualParticipantIds:I.get(r),side:C})||A({individualParticipantIds:I.get(e),side:C}))))&&M(r,I.get(r));else for(let[C,O]of I)M(C,O)}else if(i)for(let M of R){if(!M.participant)continue;let C=A({individualParticipantIds:[],side:M}),O=M.sideNumber;O&&(N[O-1]=C)}return N};for(let R of s){if(!At(R))return{error:ua};let{matchUpStatus:N,matchUpFormat:A,matchUpType:M,winningSide:C,score:O,sides:k}=R;if(!k||!O||M===Va||N===jt)continue;let x=w(k);if(!x.filter(Boolean).length)continue;let F=t&&C&&((l=Tw({matchUp:R}))==null?void 0:l.competitiveness);S.push(R);let $=e_({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:C,score:O}),_=fQ({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:C,score:O}),{pointsTally:L,tiebreaksTally:B}=gQ({matchUpFormat:A,score:O});x.forEach((V,G)=>{var j;for(let z of V){let W=(j=g.get(z))==null?void 0:j.participantName,q=b(z,W);if(q){let Y=(K,ie)=>ie.forEach((ae,oe)=>q[K][oe]+=ae),re=G?[...B].reverse():B,J=G?[...L].reverse():L,H=G?[..._].reverse():_,Z=G?[...$].reverse():$;if(Y("tiebreaks",re),Y("points",J),Y("games",H),Y("sets",Z),C){let K=C-1===G?0:1;q.matchUps[K]+=1}if(F){let K=F.toLowerCase();q.competitiveness[K]||(q.competitiveness[K]=[0,0]),q.competitiveness[K][G]+=1}if(N){let K=N.toLowerCase();q.matchUpStatuses[K]||(q.matchUpStatuses[K]=0),q.matchUpStatuses[K]+=1}}}})}let U=["tiebreaks","matchUps","points","games","sets"],T=["competitive","routine","decisive"],D=new Map,P=(R,N)=>(R??0)+(N??0);for(let[R,N]of v.entries()){for(let A of U){let M=N[A].reduce(P);if(M){let C=N[A][0]/M,O=`${A}Ratio`,k=parseFloat(C.toFixed(2));N[O]=k,y.set(R,!0),D.has(O)||D.set(O,[]),(u=D.get(O))==null||u.push(k)}}for(let A of T){let M=(d=(c=N.competitiveness)==null?void 0:c[A])==null?void 0:d.reduce(P);if(M){let C=N.competitiveness[A][0]/M,O=`${A}Ratio`,k=parseFloat(C.toFixed(2));N[O]=k}}}if(!r){let R=(N,A)=>A-N;for(let N of v.values())for(let A of U){let M=`${A}Ratio`;if(typeof N[M]=="number"){let C=(p=D.get(M))==null?void 0:p.sort(R).indexOf(N[M]);if(typeof C=="number"&&C>=0){let O=`${A}Rank`;N[O]=C+1}}}}let E={relevantMatchUps:S,...Q};return r?(E.teamStats=v.get(r),e&&(E.opponentStats=v.get(e))):E.participatingTeamsCount=y.size,E.allParticipantStats=[...v.values()],E}function C0({participant:t,eventType:e}){var i,r,n,a,o,s;let l=(i=t==null?void 0:t.person)==null?void 0:i.personId,u=(n=(r=t==null?void 0:t.person)==null?void 0:r.personOtherIds)==null?void 0:n[0],c=(a=t==null?void 0:t.person)==null?void 0:a.tennisId,d=(s=(o=t==null?void 0:t.ratings)==null?void 0:o[e])==null?void 0:s.find(({scaleName:f})=>f===ZL),p=d==null?void 0:d.scaleValue,{wtnRating:m,confidence:h}=p||{};return{timeStamp:d==null?void 0:d.scaleDate,personOtherId:u,confidence:h,wtnRating:m,personId:l,tennisId:c}}function W1e({tournamentRecord:t}){if(!t)return{error:ve};let e=t.tournamentId,{participantMap:i}=Ai({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(Hr({matchUpFilters:{matchUpTypes:[cm,Wd]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:m,matchUpType:h})=>m==null?void 0:m.flatMap(f=>{var g,v;return h===Wd?(g=f==null?void 0:f.participant)==null?void 0:g.individualParticipantIds:((v=f==null?void 0:f.participant)==null?void 0:v.participantId)||f.participantId}).filter(Boolean)).filter(Boolean),n=[],a={},o={},s={},l=0,u=({id:m,entry:h,eventId:f,eventType:g})=>{var v;let{qualifyingSeeding:y,mainSeeding:I,entryStatus:b,entryStage:S,drawId:w}=h;a[m]||(a[m]=[]);let{participant:U,events:T}=(i==null?void 0:i[m])??{},D=C0({participant:U,eventType:g}),P=(v=T==null?void 0:T[f])==null?void 0:v.ranking;b===YL&&n.push(m),a[m].push({participantType:U==null?void 0:U.participantType,participantId:m,tournamentId:e,eventType:g,eventId:f,drawId:w,entryStatus:b,entryStage:S,...D,ranking:P,mainSeeding:I,qualifyingSeeding:y})};for(let m of t.events??[]){let h={},f=U=>{h[U]||(h[U]={count:0}),h[U].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=m,I=g.flatMap(U=>{let{drawId:T,entries:D}=U;l+=1;let P=({stage:A,stageSequence:M})=>A===Ne&&M===1||A===Je,E=(U.structures??[]).filter(P).flatMap(({positionAssignments:A})=>A).filter(Boolean).map(({participantId:A})=>A),R=({participantId:A})=>E.includes(A),N=A=>{var M,C,O,k,x,F,$,_;let{participantId:L,entryStatus:B,entryStage:V}=A;f(B);let G=(k=(O=(C=(M=i==null?void 0:i[L])==null?void 0:M.draws)==null?void 0:C[T])==null?void 0:O.seedAssignments)==null?void 0:k[Ne];return{qualifyingSeeding:(_=($=(F=(x=i==null?void 0:i[L])==null?void 0:x.draws)==null?void 0:F[T])==null?void 0:$.seedAssignments)==null?void 0:_[Je],participantId:L,mainSeeding:G,entryStatus:B,entryStage:V,drawId:T}};return D==null?void 0:D.filter(R).map(N)}),b=U=>{var T;let D=U.participantId,P=(T=i==null?void 0:i[D].participant.individualParticipantIds)==null?void 0:T.filter(E=>r.includes(E));return D&&{[D]:{individualParticipantIds:P}}};v===Ou?(()=>{let U=Object.assign({},...I.map(b).filter(Boolean)),T=D=>{U[D.participantId].individualParticipantIds.forEach(P=>{u({id:P,eventType:v,eventId:y,entry:D})})};I.forEach(T)})():I.forEach(U=>{u({id:U==null?void 0:U.participantId,eventType:v,eventId:y,entry:U})});let S=Object.values(h).reduce((U,T)=>U+T.count,0);Object.keys(h).forEach(U=>{h[U].pct=h[U].count/S*100}),s[y]={tournamentId:e,eventId:y,entries:I,entryStatuses:h};let w=Object.assign({},...hs.flatMap(U=>{var T,D;return[{[U+"_count"]:(T=h[U])==null?void 0:T.count},{[U+"_pct"]:(D=h[U])==null?void 0:D.pct}]}));o[y]={tournamentId:e,eventId:y,...w}}let c=Object.values(i??{}).filter(({participant:{participantType:m,participantRole:h}})=>m===Dt&&h===en),d=c.filter(({participant:m})=>!r.includes(m.participantId)).map(({participant:m})=>m.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function q1e({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=h=>{let f=h==null?void 0:h.matchUpFormat;f&&(n[f]||(n[f]=0),n[f]+=1)},o=e.filter(h=>i?h.eventId===i:h.drawId===r).reduce((h,f)=>(a(f),(f.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>h[g.participantId]=g),h),{}),s=Object.values(o),l=s.map(h=>C0({participant:h,eventType:t})).filter(({wtnRating:h})=>h),u=(s.length-l.length)/s.length*100,c=l.reduce((h,f)=>{let{wtnRating:g,confidence:v}=f;return h.totalWTN+=g,h.totalConfidence+=v,h},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?c.totalWTN/l.length:0,p=l!=null&&l.length?c.totalConfidence/l.length:0,m=Object.values(n).reduce((h,f)=>h+(f||0),0);return{matchUpFormatCounts:n,matchUpsCount:m,avgConfidence:p,pctNoRating:u,avgWTN:d}}function Y1e(t){var e;let{tournamentRecord:i,extensionProfiles:r,firstFlightOnly:n}=t;if(!i)return{error:Qf};let a=[],o={},s={},l=[],u=Object.assign({},...(r??[]).map(({name:f,label:g,accessor:v})=>{var y,I,b;let S=(I=(y=It({element:i,name:f}))==null?void 0:y.extension)==null?void 0:I.value,w=v?(b=pm({element:S,accessor:v}))==null?void 0:b.value:S;return{[g||f]:w}})),c=i==null?void 0:i.tournamentId,d=Hr({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],p=f=>{var g,v,y;return(y=(v=(g=Ro({itemType:KF,itemSubTypes:[Fl],element:{timeItems:f}}))==null?void 0:g.timeItem)==null?void 0:v.itemValue)==null?void 0:y.scaleBasis},m=({positionManipulations:f})=>{f==null||f.forEach(g=>{let{structureId:v,name:y}=g,I=g.drawPositions||[g.drawPosition];o[v]||(o[v]=[]),o[v].push(`${y}: ${I.join("/")}`)})},h=(e=i==null?void 0:i.events)==null?void 0:e.flatMap(({timeItems:f,drawDefinitions:g=[],extensions:v,eventType:y,eventName:I,eventId:b,category:S})=>{var w,U,T,D;let P=(T=(U=(w=v==null?void 0:v.find(k=>k.name===os))==null?void 0:w.value)==null?void 0:U.flights)==null?void 0:T.map(k=>({[k.drawId]:k.flightNumber})),E=P&&Object.assign({},...P),R=v==null?void 0:v.find(k=>k.name===Ed),N=f==null?void 0:f.find(k=>k.itemType===Ed),A=((D=R==null?void 0:R.value)==null?void 0:D.length)||(N==null?void 0:N.itemValue)||0,M=Object.values(E??{}),C=E&&Math.min(...M),O=p(f);return s[b]={seedingBasis:O?JSON.stringify(O):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:A,tournamentId:c,eventId:b},g.filter(k=>!n||!P||E[k.drawId]===C).flatMap(k=>{let{matchUpFormat:x,tieFormat:F,timeItems:$,extensions:_,structures:L,drawName:B,drawType:V,drawId:G}=k,{matchUpFormatCounts:j,matchUpsCount:z,avgConfidence:W,pctNoRating:q,avgWTN:Y}=q1e({eventType:y,matchUps:d,drawId:G}),re=p($)||O,J=K1e({extensions:_}),H=(J==null?void 0:J.length)||0;return m({positionManipulations:J}),s[b].totalPositionManipulations+=H,s[b].generatedDrawsCount+=1,H>s[b].maxPositionManipulations&&(s[b].maxPositionManipulations=H),L==null?void 0:L.filter(Z=>Z.stageSequence===1&&[Je,Ne,an,Bi].includes(Z.stage)).map(Z=>{var K,ie,ae;let oe=[Ne,Bi].includes(Z.stage)?d.find(be=>be.structureId===Z.structureId&&be.finishingRound===1&&be.winningSide):void 0;Z.stage===Ne&&a.push({eventName:I,drawName:B,structureId:Z.structureId});let ne=(ie=(K=oe==null?void 0:oe.sides)==null?void 0:K.find(be=>be.sideNumber===oe.winningSide))==null?void 0:ie.participant,de=(ne==null?void 0:ne.participantType)===Gn&&ne.participantId,ye=(ne==null?void 0:ne.participantType)===gt?ne.individualParticipants:[],ce=C0({participant:(ye==null?void 0:ye[0])||ne,eventType:y}),{personId:ke,personOtherId:we,tennisId:Ze,confidence:pt,wtnRating:he}=ce||{},fe=C0({participant:ye==null?void 0:ye[1],eventType:y}),{personId:pe,personOtherId:Fe,tennisId:Se,confidence:He,wtnRating:ue}=fe||{},{ageCategoryCode:me,categoryName:Ue,subType:$e}=S??{},Ee=Z.matchUpFormat||x,Be=(j[Ee]||0)/z*100,{tieFormatName:xe,tieFormatDesc:qe}=U0(F),{tieFormatName:Pe,tieFormatDesc:at}=U0(Z.tieFormat),di=qe===at,Ae=!di&&Pe,yt=Z.tieFormat&&!di&&at,yi=((ae=J==null?void 0:J.filter(be=>be.structureId===Z.structureId))==null?void 0:ae.length)||0;return{...u,tournamentId:c,eventId:b,structureId:Z.structureId,drawId:G,eventType:y,category:$e,categoryName:Ue,ageCategoryCode:me,flightNumber:E==null?void 0:E[G],drawType:V,stage:Z.stage,seedingBasis:re?JSON.stringify(re):void 0,winningPersonId:ke,winningPersonOtherId:we,winningPersonTennisId:Ze,winningPersonWTNrating:he,winningPersonWTNconfidence:pt,winningPerson2Id:pe,winningPerson2OtherId:Fe,winningPerson2TennisId:Se,winningPerson2WTNrating:ue,winningPerson2WTNconfidence:He,winningTeamId:de,positionManipulations:yi,pctNoRating:q,matchUpFormat:Ee,pctInitialMatchUpFormat:Be,matchUpsCount:z,drawTieFormatName:xe,drawTieFormatDesc:qe,tieFormatName:Ae,tieFormatDesc:yt,avgConfidence:W,avgWTN:Y}})})});return a.forEach(({eventName:f,drawName:g,structureId:v})=>{var y;(y=o[v])!=null&&y.length&&l.push({eventName:f,drawName:g,actions:o[v]})}),{eventStructureReports:Object.values(s),structureReports:h,flightReports:l}}function K1e({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:r})=>r===Sf))==null?void 0:e.value)==null?void 0:i.slice(1)}function J1e({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){var a,o;if(!Array.isArray(n))return{error:le,dates:n};if(!Array.isArray(r))return{error:le,venueIds:r};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:ki};if(!n.every(wa))return{error:Fr};let s=nc({tournamentRecords:e,ignoreDisabled:t,dates:n});if(s.error)return s;let l=(a=s==null?void 0:s.venues)==null?void 0:a.filter(({venueId:p})=>!(r!=null&&r.length)||r.includes(p)),u=(o=s.courts)==null?void 0:o.reduce((p,m)=>{var h;return(h=m.dateAvailability)==null||h.forEach(f=>{let g=f.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!n.length||n.includes(p)),c={venueIds:l==null?void 0:l.map(({venueId:p})=>p)},{matchUps:d}=Ls({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:c});return{venuesReport:l==null?void 0:l.map(p=>X1e(u,p,d))}}function X1e(t,e,i){let{venueId:r,courts:n,venueName:a}=e,o={};return t.forEach(s=>{var l;let u=0,c=0,d=0;for(let h of n){let f=h.dateAvailability.find(v=>v.date===s),g=(l=f&&Fv({courtDate:f}).timeSlots)==null?void 0:l.reduce((v,y)=>{let{startTime:I,endTime:b}=y,S=kt(b)-kt(I);return v+S},0);g&&(d+=1),u+=g}let p=i.filter(({schedule:h})=>h.venueId===r&&Yl(s,h.scheduledDate));p.forEach(({schedule:h})=>{let f=Si(h.scheduledTime),g=na(f,h.averageMinutes),v=kt(g)-kt(f);c+=v});let m=u?(c/u*100).toFixed(2):"100";o[s]={scheduledMatchUpsCount:p.length,availableCourts:d,availableMinutes:u,scheduledMinutes:c,percentUtilization:m}}),{venueId:r,venueName:a,venueReport:o}}var xie={};wt(xie,{addMatchUpCourtOrder:()=>E$,addMatchUpEndTime:()=>M$,addMatchUpOfficial:()=>bte,addMatchUpResumeTime:()=>A$,addMatchUpScheduleItems:()=>JR,addMatchUpScheduledDate:()=>YR,addMatchUpScheduledTime:()=>ud,addMatchUpStartTime:()=>C$,addMatchUpStopTime:()=>N$,addSchedulingProfileRound:()=>z$,allocateTeamMatchUpCourts:()=>KR,assignMatchUpCourt:()=>qh,assignMatchUpVenue:()=>_v,bulkRescheduleMatchUps:()=>Gie,bulkScheduleMatchUps:()=>lU,bulkScheduleTournamentMatchUps:()=>Ty,bulkUpdateCourtAssignments:()=>$ie,calculateScheduleTimes:()=>K$,clearMatchUpSchedule:()=>zie,clearScheduledMatchUps:()=>QR,courtGridRows:()=>OR,findMatchUpFormatTiming:()=>MR,findVenue:()=>au,generateBookings:()=>XR,generateVirtualCourts:()=>GR,getMatchUpsToSchedule:()=>CR,getPersonRequests:()=>Lp,getProfileRounds:()=>AR,getScheduledRoundsDetails:()=>Xw,getSchedulingProfile:()=>ac,getSchedulingProfileIssues:()=>q_,matchUpScheduleChange:()=>Hie,modifyMatchUpFormatTiming:()=>p$,mutate:()=>Fie,proAutoSchedule:()=>_ie,proConflicts:()=>Vie,publicFindCourt:()=>UL,query:()=>gee,removeEventMatchUpFormatTiming:()=>BR,removeMatchUpCourtAssignment:()=>Lie,reorderUpcomingMatchUps:()=>jie,scheduleMatchUps:()=>Bie,scheduleProfileRounds:()=>ZR,setMatchUpDailyLimits:()=>Wie,setMatchUpHomeParticipantId:()=>R$,setSchedulingProfile:()=>Nv,toggleParticipantCheckInState:()=>zR,validateSchedulingProfile:()=>NR});var Fie={};wt(Fie,{addMatchUpCourtOrder:()=>E$,addMatchUpEndTime:()=>M$,addMatchUpOfficial:()=>bte,addMatchUpResumeTime:()=>A$,addMatchUpScheduleItems:()=>JR,addMatchUpScheduledDate:()=>YR,addMatchUpScheduledTime:()=>ud,addMatchUpStartTime:()=>C$,addMatchUpStopTime:()=>N$,addSchedulingProfileRound:()=>z$,allocateTeamMatchUpCourts:()=>KR,assignMatchUpCourt:()=>qh,assignMatchUpVenue:()=>_v,bulkRescheduleMatchUps:()=>Gie,bulkScheduleMatchUps:()=>lU,bulkScheduleTournamentMatchUps:()=>Ty,bulkUpdateCourtAssignments:()=>$ie,calculateScheduleTimes:()=>K$,clearMatchUpSchedule:()=>zie,clearScheduledMatchUps:()=>QR,findMatchUpFormatTiming:()=>MR,generateBookings:()=>XR,generateVirtualCourts:()=>GR,matchUpScheduleChange:()=>Hie,modifyMatchUpFormatTiming:()=>p$,proAutoSchedule:()=>_ie,proConflicts:()=>Vie,removeEventMatchUpFormatTiming:()=>BR,removeMatchUpCourtAssignment:()=>Lie,reorderUpcomingMatchUps:()=>jie,scheduleMatchUps:()=>Bie,scheduleProfileRounds:()=>ZR,setMatchUpDailyLimits:()=>Wie,setMatchUpHomeParticipantId:()=>R$,setSchedulingProfile:()=>Nv,toggleParticipantCheckInState:()=>zR,validateSchedulingProfile:()=>NR});function K$({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:ki};o=o??HR({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=nc({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),m=d==null?void 0:d.filter(P=>!u||u.includes(P.venueId));l||(l=m==null?void 0:m.reduce((P,E)=>{var R,N;let A=((N=(R=E.dateAvailability)==null?void 0:R.find(M=>!M.date||Yl(s,M.date)))==null?void 0:N.startTime)??E.startTime;return A&&(!P||kt(A)<kt(P))?A:P},void 0)),c||(c=m==null?void 0:m.reduce((P,E)=>{var R,N;let A=((N=(R=E.dateAvailability)==null?void 0:R.find(M=>!M.date||Yl(s,M.date)))==null?void 0:N.endTime)??E.endTime;return A&&(!P||kt(A)>kt(P))?A:P},void 0));let h=Object.values(a),f=Object.assign({},...h.map(P=>(P.events??[]).map(E=>{let{scheduleTiming:R}=gw({tournamentRecord:P,event:E});return{[E.eventId]:{event:E,scheduleTiming:R}}})).flat()),g=eU({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:u}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],I=[];I.push(...v),I.push(...y);let b={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},S=I==null?void 0:I.map(({eventId:P,schedule:E,matchUpFormat:R})=>{let{event:N,scheduleTiming:A}=f[P],M=N==null?void 0:N.eventType,C={...A,defaultTiming:b,matchUpFormat:R},{averageMinutes:O,recoveryMinutes:k}=YP({eventType:M,timingDetails:C}),{courtId:x,venueId:F}=E,$=Si(E.scheduledTime),_=na($,O);return{recoveryMinutes:k,averageMinutes:O,periodLength:o,startTime:$,endTime:_,courtId:x,venueId:F}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:s,clearScheduleDates:n,periodLength:o,startTime:l,endTime:c,bookings:S,courts:m},{scheduleTimes:U}=w$(w),T=(u==null?void 0:u.length)===1&&u[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,D=I.map(Pr);return{venueId:T,scheduleTimes:U,dateScheduledMatchUpIds:D}}function Lie(t){var e;let i=We(t,[{[gn]:!0}]);if(i.error)return i;let{removePriorValues:r,tournamentRecords:n,tournamentId:a,courtDayDate:o,matchUpId:s,courtId:l,drawId:u}=t,c=n[a];if(!c)return{error:ve};let{drawDefinition:d,event:p}=ld({tournamentRecord:c,drawId:u});if(!d)return{error:_e};let m=Ti({drawDefinition:d,event:p,matchUpId:s});if(m.error)return m;if(((e=m==null?void 0:m.matchUp)==null?void 0:e.matchUpType)===Va){let{itemValue:h}=Op({timeItems:m.matchUp.timeItems??[],itemType:Zl}),f=l&&h.filter(g=>g.courtId!==l);return Aa({duplicateValues:!1,removePriorValues:r,tournamentRecord:c,drawDefinition:d,matchUpId:s,timeItem:{itemType:Zl,itemValue:f}})}else return qh({tournamentRecord:c,drawDefinition:d,courtDayDate:o,courtId:"",matchUpId:s})}function _ie({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:r}){if(!Co(r))return{error:le};if(r.some(({hasContext:m})=>!m))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:dP};let n=eU({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(n.error)return n;let{rows:a}=n,o=[],s=m=>[(m.sides||[]).map(h=>{var f;return[h.participantId,(f=h.participant)==null?void 0:f.individualParticipantIds]}),(m.potentialParticipants||[]).flat().map(h=>[h.participantId,h.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((m,h)=>{let f=[],g=[];Object.values(h).forEach(y=>{if(At(y)&&(y.matchUpId&&(f.push(y.matchUpId),o.push(y)),y.sides)){let I=s(y);g.push(...I)}});let v=Object.values(h).filter(y=>At(y)&&!y.matchUpId);return m.concat({matchUpIds:f,availableCourts:v,rowId:h.rowId,participantIds:g})},[]);r.filter(({matchUpStatus:m})=>m&&m!==jt&&(t||!yr.includes(m))).sort(_h);let u=fs({matchUps:r.concat(o),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,c=[],d=[];for(;r.length&&l.length;){let m=l.shift(),h=[];for(;r.length&&m.availableCourts.length;){let f=r.concat(h).map(T=>T.matchUpId),g=r.shift(),v=g==null?void 0:g.matchUpId,y=v&&u[v].matchUpIds.concat(u[v].dependentMatchUpIds),I=v&&f.some(T=>u[v].matchUpIds.includes(T)),b=v&&d.some(T=>u[v].dependentMatchUpIds.includes(T)),S=m.matchUpIds.some(T=>y.includes(T)),w=s(g),U=m.participantIds.some(T=>w.includes(T));if(g&&!S&&!I&&!U&&!b){let T=m.availableCourts.shift();Object.assign(g.schedule,T.schedule),Object.assign(T,g),c.push(g),m.participantIds.push(...w),m.matchUpIds.push(v)}else g&&h.push(g)}r.push(...h),d.push(...m.matchUpIds)}let p=c.map(({matchUpId:m,tournamentId:h,schedule:f,drawId:g})=>({tournamentId:h,matchUpId:m,drawId:g,schedule:{...f,scheduledDate:i}}));return n=lU({tournamentRecords:e,matchUpDetails:p}),{...n,scheduled:c,notScheduled:r}}function $ie(t){let{courtDayDate:e}=t,i=We(t,[{courtAssignments:!0,[Xn]:dn,[za]:Qe},{[gn]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,o)=>{let{tournamentId:s}=o;return a[s]||(a[s]=[]),a[s].push(o),a},{}),n;return Object.keys(r).every(a=>{let o=t[gn][a];if(!o)return n={error:ve},!1;let s=r[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(s).every(l=>{let{drawDefinition:u}=Kn({tournamentRecord:o,drawId:l});return u?(s[l].every(c=>{let{matchUpId:d,courtId:p}=c,m=qh({tournamentRecord:o,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(m.success)return m==null?void 0:m.success;n={error:O9}}),!0):(n={error:_e},!1)})}),n||Q}function Bie(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:m=30,scheduleDate:h,matchUpIds:f,venueIds:g,startTime:v,endTime:y,dryRun:I}=t,b=We(t,[{[gn]:!0,[uw]:!0},{[Jr]:wa,[za]:Fr,[SSe]:!0},{[Jr]:V=>!V||!isNaN(V),[RSe]:!1,[za]:le,[ESe]:!1,[CSe]:!1}]);if(b.error)return b;let S=t.competitionMatchUps??Ls({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??fs({includeParticipantDependencies:!0,matchUps:S,tournamentRecords:e}).matchUpDependencies;S.forEach(V=>{var G;(G=V.schedule)!=null&&G.scheduledDate&&Yl(h,ht(V.schedule.scheduledDate))&&yg({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:V})});let U=f.map(V=>S.find(G=>G.matchUpId===V)).filter(Boolean),{venueId:T,scheduleTimes:D,dateScheduledMatchUpIds:P}=K$({tournamentRecords:e,remainingScheduleTimes:d,startTime:Si(v),endTime:Si(y),scheduleDate:ht(h),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:m,venueIds:g}),E={},R=[],N={},A={},M={};S.filter(({matchUpId:V})=>P==null?void 0:P.includes(V)).forEach(V=>{var G;XM({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:V,value:1});let j=(G=V.schedule)==null?void 0:G.scheduledTime;if(j){N[V.matchUpId]=j;let z=a==null?void 0:a[V.matchUpId];Sy({recoveryMinutes:z||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:j,matchUp:V})}});let C=U.filter(V=>{let G=P==null?void 0:P.includes(V.matchUpId),j=[jt,Pt,Ki,ca,zr,Ft].includes(V==null?void 0:V.matchUpStatus);return!G&&!V.winningSide&&!j}),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:x}=C.reduce((V,G)=>{let{drawId:j,tournamentId:z,matchUpType:W}=G,{participantIdsAtLimit:q,relevantParticipantIds:Y}=V$({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:u,matchUp:G});return q!=null&&q.length?(V.overLimitMatchUpIds.push(G.matchUpId),V.participantIdsAtLimit.push(...q),V):(Y.forEach(re=>{oU({individualParticipantProfiles:s,participantId:re});let J=s[re].counters;J[W]?J[W]+=1:J[W]=1,J[Xo]?J[Xo]+=1:J[Xo]=1}),V.matchUpMap[z]||(V.matchUpMap[z]={}),V.matchUpMap[z][j]?V.matchUpMap[z][j].push(G):V.matchUpMap[z][j]=[G],yg({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:G}),V)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});C=C.filter(({matchUpId:V})=>!k.includes(V));let F=0,$=(D==null?void 0:D.length)??0,{personRequests:_}=Lp({tournamentRecords:e,requestType:sU});for(;D!=null&&D.length&&C.length&&F<=$;){F++;let{scheduleTime:V}=D.shift(),G=C.find(j=>{let{matchUpId:z}=j,{dependenciesScheduled:W,remainingDependencies:q}=_$({matchUpScheduleTimes:N,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:j});if(!W)return M[z]||(M[z]=[]),M[z].push({scheduleTime:V,remainingDependencies:q}),!1;let{enoughTime:Y}=B$({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:V,matchUp:j});if(!Y)return A[z]||(A[z]=[]),A[z].push({scheduleTime:V}),!1;let{conflicts:re}=$$({potentials:c,averageMatchUpMinutes:r,requestConflicts:E,personRequests:_,scheduleTime:V,scheduleDate:h,matchUp:j});if(re!=null&&re.length)return!1;let J=a==null?void 0:a[j.matchUpId];return Sy({recoveryMinutes:J||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:V,matchUp:j}),N[j.matchUpId]=V,!0});C=C.filter(({matchUpId:j})=>j!==(G==null?void 0:G.matchUpId)),G||R.push(V)}C.forEach(V=>{XM({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:V})});let L=[];Object.keys(O).forEach(V=>{let G=e[V];G&&Object.keys(O[V]).forEach(j=>{let{drawDefinition:z}=ld({tournamentRecord:G,drawId:j});z&&O[V][j].forEach(({matchUpId:W})=>{let q=N[W];if(q){let Y=q.split(":").map(lo).join(":"),re=`${ht(h)}T${Y}`;I?L.push(W):(ud({drawDefinition:z,matchUpId:W,scheduledTime:re}).success&&L.push(W),T&&_v({tournamentRecords:e,tournamentRecord:G,drawDefinition:z,matchUpId:W,venueId:T}))}})})});let B=zF(C);return{...Q,requestConflicts:Object.values(E),remainingScheduleTimes:D==null?void 0:D.map(({scheduleTime:V})=>V),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:x,skippedScheduleTimes:R,overLimitMatchUpIds:k,scheduledMatchUpIds:L,noTimeMatchUpIds:B,recoveryTimeDeferred:A,dependencyDeferred:M}}function Vie({tournamentRecords:t,matchUps:e}){if(!Co(e))return{error:Qu};if(e.some(({matchUpId:m,hasContext:h})=>m&&!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:dP};let i=Math.max(...e.map(({schedule:m})=>(m==null?void 0:m.courtOrder)||1).map(m=>tt(m))),r=De(1,i+1).map(m=>e.filter(h=>{var f;return tt((f=h.schedule)==null?void 0:f.courtOrder)===m})),n={},a={},o={};r.flat().filter(Boolean).sort(_h).forEach(({schedule:m})=>delete m[rS]);let s=dt(e.map(({drawId:m})=>m)),l=fs({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,u=r.map((m,h)=>m.reduce((f,g)=>{if(!g.matchUpId)return f;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:I,schedule:b,sides:S,potentialParticipants:w}=g,U=b==null?void 0:b.courtId;n[v]=h,a[U]=[],f.matchUpIds.push(v),o[v]=g;let T=l[v].matchUpIds;T.length&&f.sourceMatchUpIds.push(...T);let D=(S==null?void 0:S.map(E=>{var R;return[(R=E.participant)==null?void 0:R.individualParticipantIds,E.participantId]}).flat().filter(Boolean))??[],P=(w==null?void 0:w.flat().map(({individualParticipantIds:E,participantId:R})=>[E,R]).flat().filter(Boolean))||[];return f.participantIds.push(...P,...D),y&&f.targetMatchUpIds.push(y),I&&f.targetMatchUpIds.push(I),f},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),c=(m,h)=>l[m].sources.reduce((f,g,v)=>g.includes(h)&&v+1||f,0),d=u.map(()=>[]),p=(m,h,f,g)=>{if(!o[m].schedule[rS]){o[m].schedule[rS]=h,o[m].schedule[aX]=g,d[n[m]].push({matchUpId:m,issueType:f,issueIds:g,issue:h});let v=o[m].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:m,issue:h,issueType:f,issueIds:g})}};return u.forEach((m,h)=>{let f=h?u[h-1]:void 0,g=u.slice(h+1),v={},y=Ra(m.participantIds),I=Object.keys(y).filter(w=>y[w]>1),b=m.matchUpIds.filter(w=>l[w].participantIds.some(U=>I.includes(U)));b.forEach(w=>{v[w]||(v[w]={}),v[w][md]||(v[w][md]=b.filter(U=>U!==w))});let S=f&&m.participantIds.filter(w=>f.participantIds.includes(w));S&&S.forEach(w=>{let U=m.matchUpIds.concat(f.matchUpIds).filter(T=>l[T].participantIds.includes(w));U.forEach(T=>{v[T]||(v[T]={}),v[T][hd]||(v[T][hd]=U.filter(D=>D!==T))})}),m.matchUpIds.forEach(w=>{var U,T,D,P;let E=l[w].matchUpIds;for(let N of g){let A=N.matchUpIds.filter(M=>E.includes(M));A!=null&&A.length&&(A.forEach(M=>p(M,TM,cc,[w])),p(w,TM,cc,A))}if((U=v[w])!=null&&U[md]&&p(w,md,SM,v[w][md]),m.sourceMatchUpIds.includes(w)){let N=m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w));p(w,md,cc,N),m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w)).forEach(A=>p(A,md,cc,[w]))}let R=(T=f==null?void 0:f.matchUpIds)==null?void 0:T.filter(N=>c(w,N)>1);if(R!=null&&R.length&&(p(w,DM,cc,R),R.forEach(N=>p(N,DM,cc,[w]))),(D=v[w])!=null&&D[hd]&&p(w,hd,SM,v[w][hd]),(P=f==null?void 0:f.targetMatchUpIds)==null?void 0:P.includes(w)){let N=o[w].schedule.courtId,A=E.filter(M=>f.matchUpIds.includes(M));A.some(M=>o[M].schedule.courtId===N)||(A.forEach(M=>p(M,hd,cc,[w])),p(w,hd,cc,A))}})}),{courtIssues:a,rowIssues:d}}function jie(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return te({result:{error:ki},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return te({result:{error:Qe},stack:e});let a=r==null?void 0:r.length;if(!a)return{...Q};let o=0;return r.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,m=u+(n?-1:1);m<0&&(m=a-1),m===a&&(m=0);let h=r[m].schedule.scheduledTime,f=s({tournamentId:c,scheduledTime:h,matchUpId:p,drawId:d});if(f.success)o++;else return f}),o===a?Q:te({result:{error:A9},stack:e});function s({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:m}=ld({tournamentRecord:p,drawId:d});return m?ud({drawDefinition:m,scheduledTime:u,matchUpId:c}):{error:ja}}}function Gie(t){var e,i;let{scheduleChange:r,matchUpIds:n,dryRun:a}=t;if(!n||!Array.isArray(n))return{error:bh};if(typeof r!="object")return{error:le};let o=Po(t),s=[],l=[];for(let c of Object.values(o)){let d=Q1e({tournamentRecord:c,scheduleChange:r,matchUpIds:n,dryRun:a});if(d.error)return d;Array.isArray(d.notRescheduled)&&l.push(...d.notRescheduled);let p=zF(d.notRescheduled),m=[];(e=d.rescheduled)==null||e.forEach(h=>{let{matchUpId:f}=h;p.includes(f)&&m.push(f),s.push(h)}),m.length&&(l=((i=d==null?void 0:d.notRescheduled)==null?void 0:i.filter(({matchUpId:h})=>!m.includes(h)))||[])}let u=!!(s.length&&!l.length);return{...Q,rescheduled:s,notRescheduled:l,allRescheduled:u}}function Q1e({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){var n;if(!t)return{error:ve};if(!i||!Array.isArray(i))return{error:bh};if(typeof e!="object")return{error:le};let a=[],o=[],{minutesChange:s,daysChange:l}=e;if(!s&&!l)return{...Q};if(s&&isNaN(s))return{error:le};if(l&&isNaN(l))return{error:le};let{matchUps:u}=Hr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=({matchUpStatus:S})=>!yr.includes(S),d=u==null?void 0:u.filter(S=>Zw({schedule:S.schedule})).filter(S=>c({matchUpStatus:S.matchUpStatus}));if(!(d!=null&&d.length))return{...Q};let{tournamentInfo:p}=zh({tournamentRecord:t}),{startDate:m,endDate:h}=p,f=d==null?void 0:d.reduce((S,w)=>{let{matchUpId:U,drawId:T}=w;return S[T]?S[T].push(U):S[T]=[U],S},{}),g=1440;for(let S of Object.keys(f)){let w=ld({tournamentRecord:t,drawId:S});if(w.error)return w;let U=w.drawDefinition,T=f[S].filter(D=>i.includes(D));for(let D of T)if(D&&U){let P=(n=d.find(C=>C.matchUpId===D))==null?void 0:n.schedule,{scheduledTime:E,scheduledDate:R}=P,N,A,M;if(!N&&l&&R){let C=ht(R);M=qv(C,l),N=new Date(M)<new Date(m)||new Date(M)>new Date(h)}if(s&&E){let C=ht(E),O=kt(Si(E))+s;if(N=O<0||O>g,!N){let k=na(E,s),x=C&&M||R===C&&C;A=x?`${x}T${k}`:k}}if(N)o.push(D);else{if(!r){if(A){let C=ud({scheduledTime:A,drawDefinition:U,matchUpId:D});if(C.error)return C}if(M){let C=YR({scheduledDate:M,drawDefinition:U,matchUpId:D});if(C.error)return C}}(A||M)&&a.push(D)}}}let v=Hr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],y=v.filter(({matchUpId:S})=>a.includes(S)),I=v.filter(({matchUpId:S})=>o.includes(S)),b=y.length&&!I.length;return{...Q,rescheduled:y,notRescheduled:I,allRescheduled:b}}function Hie(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:ki};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=r||{},{drawId:d,matchUpId:p,tournamentId:m}=n||{};if(!u&&!p)return te({result:{error:Qe},stack:e});let{matchUps:h}=Ls({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),f=h==null?void 0:h.find(({matchUpId:b})=>b===u),g=h==null?void 0:h.find(({matchUpId:b})=>b===p),v=0;if(o&&u&&!p){let b=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b!=null&&b.success&&v++,b.error)return te({result:b,stack:e})}else if(a&&o&&u&&p){let b=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b.success&&v++,b.error)return te({result:b,stack:e,info:"source"});let S=y({tournamentId:m,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:s});if(S.success&&v++,S.error)return te({result:S,stack:e,info:"target"})}else return{error:Qe};return v?Q:te({result:{error:hv},stack:e});function y(b){let{tournamentRecords:S,tournamentId:w,matchUp:U,drawId:T}=b,D=S[w],{drawDefinition:P}=ld({tournamentRecord:D,drawId:T});return U.matchUpType===gi?I({...b,tournamentRecord:D,drawDefinition:P}):qh({...b,tournamentRecord:D,drawDefinition:P})}function I({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,sourceCourtId:T,courtDayDate:D,matchUpId:P,matchUp:E,courtId:R}){let N=[R].concat(E.schedule.allocatedCourts.map(({courtId:A})=>A).filter(A=>A!==T));return KR({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,courtDayDate:D,matchUpId:P,courtIds:N})}}function zie({scheduleAttributes:t=[Zl,_c,Ah,Oh,kh,bs,Bu,Ll,yu],tournamentRecord:e,drawDefinition:i,matchUpId:r}){var n,a;let o="clearMatchUpSchedule",s=i?(n=Pn({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:n[0]:(a=Hr({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:a[0];if(!s)return{error:fn};let l=(s.timeItems??[]).filter(u=>(u==null?void 0:u.itemType)&&!t.includes(u==null?void 0:u.itemType));return s.timeItems=l,Et({tournamentId:e.tournamentId,context:o,drawDefinition:i,matchUp:s}),{...Q}}function Wie(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:ki};if(typeof r!="object")return{error:Zu};let a=Object.keys(n).filter(o=>!i||i===o);if(i&&!a.includes(i))return{error:le};for(let o of a){let s=n[o],l=_t({extension:{name:dw,value:{dailyLimits:r}},element:s});if(l.error)return l}return{...Q}}var qie={};wt(qie,{addCollectionDefinition:()=>Q$,addCollectionGroup:()=>Zie,aggregateTieFormats:()=>tre,compareTieFormats:()=>Vu,getTieFormat:()=>H_,modifyCollectionDefinition:()=>J$,modifyTieFormat:()=>ere,mutate:()=>Yie,orderCollectionDefinitions:()=>Xie,query:()=>uee,removeCollectionDefinition:()=>X$,removeCollectionGroup:()=>Jie,tieFormatGenderValidityCheck:()=>bP,validateCollectionDefinition:()=>aw});var Yie={};wt(Yie,{addCollectionDefinition:()=>Q$,addCollectionGroup:()=>Zie,aggregateTieFormats:()=>tre,modifyCollectionDefinition:()=>J$,modifyTieFormat:()=>ere,orderCollectionDefinitions:()=>Xie,removeCollectionDefinition:()=>X$,removeCollectionGroup:()=>Jie});function op({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:o}){var s;let l="getTieFormat",u;if(e=(r==null?void 0:r.structureId)??e,i=(n==null?void 0:n.matchUpId)??i,(i||e)&&!t)return{error:_e};if(a&&o)u=Gs(o);else if(i){if(t&&(!n||!r)){let c=Ti({drawDefinition:t,matchUpId:i});if(c.error)return c;if(((s=c.matchUp)==null?void 0:s.matchUpType)!==Va)return te({result:{error:ua},stack:l});r||(r=c.structure),n||(n=c.matchUp)}u=sI({item:n,drawDefinition:t,structure:r,event:o})||sI({item:r,drawDefinition:t,structure:r,event:o})||Gs(t)||Gs(o)}else if(t&&e){if(!r){let c=rt({drawDefinition:t,structureId:e});if(c.error)return c;r=c==null?void 0:c.structure}u=sI({item:r,drawDefinition:t,structure:r,event:o})||Gs(t)||Gs(o)}else u=Gs(t)||Gs(o);return u?{...Q,structure:r,tieFormat:u,matchUp:n}:te({result:{error:dv},stack:l})}function M0({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![yr].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==ms&&!br(t))}function eC({from:t,to:e}){let i=Object.keys(t),r=ji(i,Object.keys(e)).length===i.length,n=i.filter(o=>t[o]!==e[o]).map(o=>({countChange:e[o]-t[o],collectionId:o})),a=i.every(o=>t[o]===e[o]);return{equivalent:r&&a,matchUpsCountChanges:n}}function Z1e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:o,event:s,uuids:l}){var u,c,d,p;let m="updateTieFormat",h=e==null?void 0:e.tournamentId,f=0,g=0,v=0,y=0,I=n==null?void 0:n.collectionDefinitions.reduce((P,E)=>(P[E.collectionId]=(P[E.collectionId]||0)+E.matchUpCount,P),{}),b=({tieFormat:P})=>{let E=P==null?void 0:P.collectionDefinitions.reduce((R,N)=>(R[N.collectionId]=(R[N.collectionId]||0)+N.matchUpCount,R),{});return eC({from:E,to:I}).equivalent},S=(u=op({drawDefinition:i}))==null?void 0:u.tieFormat,w=(c=op({event:s}))==null?void 0:c.tieFormat;if(s&&a){for(let P of s.drawDefinitions??[])U({drawDefinition:P});s.tieFormat=Yr(n),y+=1}else if(o){if(!o.tieMatchUps)return te({result:{error:ua},stack:m});let P=Ra((d=o.tieMatchUps)==null?void 0:d.map(({collectionId:M})=>M)),E=eC({to:I,from:P}),{changes:R,changesArePossible:N,cannotChangeReaon:A}=pj({matchUp:o,check:E});if(E.equivalent)if(M0({matchUp:o,updateInProgressMatchUps:t}))o.tieFormat=Yr(n),y+=1;else return te({result:{error:iF},info:"matchUp is IN_PROGRESS or COMPLETE",stack:m});else if(N)D({tieFormat:n,matchUp:o,changes:R,uuids:l});else return te({context:{collectionMap:I,matchUpMap:P},result:{error:xl},info:A||"specified changes not possible",stack:m});g+=1,Et({eventId:s==null?void 0:s.eventId,context:m,drawDefinition:i,tournamentId:h,matchUp:o})}else if(r){let P=(p=T({inheritedTieFormat:S??w,structure:r}))==null?void 0:p.modifiedMatchUpsCount;P&&(g+=P,f+=1,y+=1);let E=!r.tieFormat||Vu({ancestor:r.tieFormat,descendant:n}).different;E&&(r.tieFormat=Yr(n),f+=1,y+=1),(P||E)&&i&&ui({structureIds:[r.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)U({drawDefinition:i}),i.tieFormat=Yr(n),y+=1;else return{error:_e};return{modifiedStructuresCount:f,modifiedMatchUpsCount:g,addedMatchUpsCount:v,modifiedCount:y,...Q,tieFormat:n};function U({drawDefinition:P}){var E;let R=P.structures||[],N=[];for(let A of R){if(A.tieFormat)continue;let M=(E=T({inheritedTieFormat:w,structure:A}))==null?void 0:E.modifiedMatchUpsCount;if(M){f+=1,g+=M;let C=A.structureId;N.push(C)}}return ui({structureIds:N,eventId:s==null?void 0:s.eventId,drawDefinition:P}),N.length}function T({inheritedTieFormat:P,structure:E}){var R,N;let A=0,M=((R=qt({matchUpFilters:{matchUpTypes:[gi]},structure:E}))==null?void 0:R.matchUps)||[];for(let C of M){let O=M0({matchUp:C,updateInProgressMatchUps:t}),k=!1,x=Ra((N=C.tieMatchUps)==null?void 0:N.map(({collectionId:$})=>$)),F=eC({from:x,to:I});if(F.equivalent)C.tieFormat&&b(C)&&O&&(C.tieFormat=Yr(n),k=!0);else{let{changes:$,changesArePossible:_}=pj({matchUp:C,check:F});if(_&&!C.tieFormat)D({changes:$,matchUp:C,tieFormat:n,uuids:l});else if(P)(!C.tieFormat||Vu({ancestor:P,descendant:C.tieFormat}).different)&&(C.tieFormat=P,k=!0);else return te({result:{error:dv},stack:m})}k&&(A+=1,Et({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:m,eventId:a,matchUp:C}))}return{modifiedMatchUpsCount:A}}function D({uuids:P,matchUp:E,tieFormat:R,changes:N}){E.tieFormat=Yr(R);let A=[],M=[];return N.forEach(C=>{if(C.countChange>0){let O=Math.max(0,...E.tieMatchUps.filter(F=>F.collectionId===C.collectionId).map(Na("collectionPosition"))),k=R.collectionDefinitions.find(F=>F.collectionId===C.collectionId),x=Vw({matchUpsLimit:C.countChange,collectionPositionOffset:O,collectionDefinition:k,matchUp:E,uuids:P});M.push(...Me(x,!1,!0)),v+=M.length,E.tieMatchUps.push(...x)}else{let O=C.toBePlayedTieMatchUpIds.slice(0,Math.abs(C.countChange));console.log("remove",O.length),A.push(...O),E.tieMatchUps=E.tieMatchUps.filter(({matchUpId:k})=>!O.includes(k))}}),M.length&&Fc({matchUps:M,drawDefinition:i,tournamentId:h,eventId:a}),A.length&&ec({matchUpIds:A,action:"updateTieFormat",drawDefinition:i,tournamentId:h,eventId:a}),{matchUpIdsRemoved:A,matchUpsAdded:M}}}function pj({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let o=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===Qi).map(Na("matchUpId")),s=o.length+a>=0||a>0;return!s&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:o,collectionId:n,countChange:a}),s}),changes:r,cannotChangeReaon:i}}function rE({appliedPolicies:t,drawDefinition:e,auditData:i}){var r;if(!((r=t==null?void 0:t.audit)!=null&&r[aI]))return;let{extension:n}=It({name:aI,element:e}),a={value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(i):[i],name:aI};_t({element:e,extension:a})}function J$({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:m,gender:h,event:f,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b}){let S="modifyCollectionDefinition";if(o&&!Ea({matchUpFormat:o}))return te({result:{error:le},context:{matchUpFormat:o},stack:S});if(r&&typeof r!="string")return te({result:{error:le},context:{collectionName:r},stack:S});if(h&&!Object.values(yF).includes(h))return te({result:{error:le},context:{gender:h},stack:S});if(p&&typeof p!="object")return te({result:{error:le},context:{category:p},stack:S});let w={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b};if(!Object.values(w).filter(Boolean).length&&!i&&!r&&!o&&!s&&!u)return te({result:{error:Qe},stack:S});if(Object.values(w).filter(Boolean).length>1)return te({info:"Only one value assignment allowed per collectionDefinition",result:{error:le},stack:S});let U=op({drawDefinition:a,structureId:c,matchUpId:d,eventId:m,event:f});if(U.error)return te({result:U,stack:S});let{matchUp:T,structure:D,tieFormat:P}=U,E=Yr(P),R=P==null?void 0:P.collectionDefinitions.find(L=>L.collectionId===l),N=E==null?void 0:E.collectionDefinitions.find(L=>L.collectionId===l);if(!R)return te({info:"source collectionDefinition",result:{error:jr},context:{collectionId:l},stack:S});let A=v??y??I??b;if(g!=null&&g.length){let L=kK({matchUpCount:s??(R==null?void 0:R.matchUpCount)??0,collectionValueProfiles:g});if(L.errors)return te({result:{error:le},info:L.errors,stack:S})}else if(A&&!st(A))return te({result:{error:le},info:"value is not an integer",context:{value:A},stack:S});let M=(L,B)=>ji(Object.keys(L),Object.keys(B)).length===Object.keys(L).length&&ji(Object.values(L),Object.values(B)).length===Object.values(L).length,C=g&&(!R.collectionValueProfiles||!M(R.collectionValueProfiles,g)),O=st(v)&&R.collectionValue!==v||st(y)&&R.matchUpValue!==y||st(I)&&R.scoreValue!==I||st(b)&&R.setValue!==b||C,k=[];if(O&&(N.collectionValueProfiles=void 0,N.collectionValue=void 0,N.matchUpValue=void 0,N.scoreValue=void 0,N.setValue=void 0,Object.assign(N,w),k.push({collectionId:l,...Ge(w)})),(st(I)||st(b))&&N.collectionGroupNumber){let L=N.collectionGroupNumber;E.collectionDefinitions=E.collectionDefinitions.map(B=>{let{collectionGroupNumber:V,...G}=B;return V===L?G:B}),E.collectionGroups=E.collectionGroups.filter(({groupNumber:B})=>B!==L),k.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:x,valueGoal:F}=Wh(E),$=Ge({aggregateValue:x,valueGoal:F});if(($.aggregateValue!==(P==null?void 0:P.winCriteria.aggregateValue)||$.valueGoal!==(P==null?void 0:P.winCriteria.valueGoal))&&(E.winCriteria=$,k.push({collectionId:l,winCriteria:$})),st(i)&&R.collectionOrder!==i&&(N.collectionOrder=i,k.push({collectionId:l,collectionOrder:i})),r&&R.collectionName!==r&&(N.collectionName=r,k.push({collectionId:l,collectionName:r})),o&&R.matchUpFormat!==o&&(N.matchUpFormat=o,k.push({collectionId:l,matchUpFormat:o})),st(s)&&R.matchUpCount!==s&&(N.matchUpCount=s,k.push({collectionId:l,matchUpCount:s})),u&&R.matchUpType!==u)return te({result:{error:hP},context:{matchUpType:u},stack:S});p&&R.category!==p&&(N.category=p,k.push({collectionId:l,category:p})),h&&R.gender!==h&&(N.gender=h,k.push({collectionId:l,gender:h}));let _=Ge(E);if(U=qn({tieFormat:_}),U.error)return te({result:U,stack:S});if(!k.length)return te({result:{...Q,modifications:k}});if((P==null?void 0:P.tieFormatName)!==n?(_.tieFormatName=n,k.push({tieFormatName:n})):k.length&&(delete _.tieFormatName,k.push("tieFormatName removed: modifications without new tieFormatName")),U=Z1e({tieFormat:_,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:D,eventId:m,matchUp:T,event:f}),!U.error){let{appliedPolicies:L}=Bt({tournamentRecord:e}),B=Ge({collectionDefinition:N,drawId:a==null?void 0:a.drawId,action:S,structureId:c,matchUpId:d,eventId:m});rE({appliedPolicies:L,drawDefinition:a,auditData:B})}return te({result:{...U,modifications:k},stack:S})}function eMe({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){var o,s;let l=[];return n&&a?l=[a]:i&&r?l=((o=qt({matchUpFilters:{matchUpTypes:[gi]},structure:r}))==null?void 0:o.matchUps)??[]:e&&(l=((s=Pn({matchUpFilters:{matchUpTypes:[gi]},drawDefinition:e}))==null?void 0:s.matchUps)??[]),{targetMatchUps:l.filter(u=>!u.winningSide&&u.matchUpStatus!==Ki&&(t||u.matchUpStatus!==ms&&!br(u)))}}function tMe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let o of r){let s=!!o.tieFormat;s&&(o.tieFormat=Yr(n));let l;if(t){let u=Bt({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=rc({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}s&&!l&&Et({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:o,drawDefinition:i})}return{...Q}}function Kie({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:m,valueGoal:h}=Wh(l);l.winCriteria=Ge({aggregateValue:m,valueGoal:h}),(e&&e!==h||m&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:f}=eMe({updateInProgressMatchUps:t,drawDefinition:a,structureId:o,structure:s,matchUpId:u,matchUp:c});tMe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:f,drawDefinition:a,tieFormat:l,event:p});let g=Ge(l),v=qn({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:_e};return ui({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...Q}}function Jie({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:u}){if(!e)return{error:Qe};if(isNaN(e))return{error:le};let c="removeCollectionGroup",d=s?void 0:op({drawDefinition:r,structureId:a,matchUpId:o,eventId:l,event:u});if(d!=null&&d.error)return te({result:d,stack:c});let p=d==null?void 0:d.structure;s=s??(d==null?void 0:d.matchUp);let m=d==null?void 0:d.tieFormat,h=m==null?void 0:m.winCriteria.valueGoal,f=m==null?void 0:m.winCriteria.aggregateValue,g=Yr(m);if(d=qn({tieFormat:g}),d.error)return te({result:d,stack:c});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(y=>{let{collectionGroupNumber:I,...b}=y;return I!==e?y:(v.push(y.collectionId),b)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:y})=>y!==e),d=Kie({updateInProgressMatchUps:t,originalValueGoal:h,wasAggregateValue:f,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:o,matchUp:s,eventId:l,event:u}),!d.error){let{appliedPolicies:y}=Bt({tournamentRecord:i}),I=Ge({drawId:r==null?void 0:r.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:o,eventId:l});rE({appliedPolicies:y,drawDefinition:r,auditData:I})}return te({result:{...d,modifiedCollectionIds:v},stack:c})}function wg({tieFormat:t,orderMap:e}){var i;let r=Yr(t);return r.collectionDefinitions.forEach(n=>{let a=e[n.collectionId];a&&(n.collectionOrder=a)}),(i=r.collectionDefinitions)==null||i.sort((n,a)=>Xf(n.collectionOrder)-Xf(a.collectionOrder)),r}function Xie({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:o,event:s}){if(typeof n!="object"||!Object.values(n).every(l=>st(l)))return te({result:{error:le},context:{orderMap:n}});if(a&&s!=null&&s.tieFormat)mj({tournamentRecord:t,event:s,orderMap:n});else if(r){let l=e&&Ti({drawDefinition:e,matchUpId:r});if(l!=null&&l.error)return l;if(o=l.matchUp,!o)return{error:la};o!=null&&o.tieFormat&&(o.tieFormat=wg({tieFormat:o.tieFormat,orderMap:n}),Et({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:o}))}else if(i){let l=rt({drawDefinition:e,structureId:i});if(l.error)return l;let u=l.structure;if(u!=null&&u.tieFormat)u.tieFormat=wg({tieFormat:u.tieFormat,orderMap:n}),Qie({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:n}),ui({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)QM({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else if(s!=null&&s.tieFormat)mj({structureIds:[i],tournamentRecord:t,orderMap:n,event:s});else return{error:jr}}else if(e!=null&&e.tieFormat)QM({tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else return{error:jr};return{...Q}}function mj({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=wg({tieFormat:r.tieFormat,orderMap:i});e!=null&&e.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])QM({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function QM({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??(n==null?void 0:n.tieFormat),o=wg({tieFormat:a,orderMap:r});i!=null&&i.length||(e.tieFormat=o);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=wg({tieFormat:l.tieFormat??e.tieFormat??(n==null?void 0:n.tieFormat),orderMap:r})),Qie({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),s.push(l.structureId));ui({drawDefinition:e,structureIds:s})}function Qie({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){var a;let o=(a=qt({matchUpFilters:{matchUpTypes:[gi]},structure:i}))==null?void 0:a.matchUps;for(let s of o)s.tieFormat&&(s.tieFormat=wg({tieFormat:s.tieFormat,orderMap:r}),Et({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function X$({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:u,event:c}){var d,p,m,h,f;let g="removeCollectionDefinition",v=u?void 0:op({drawDefinition:r,structureId:o,matchUpId:s,eventId:l,event:c});if(v!=null&&v.error)return te({result:v,stack:g});let y=v==null?void 0:v.structure;u=u??(v==null?void 0:v.matchUp);let I=v==null?void 0:v.tieFormat,b=Yr(I);if(v=qn({tieFormat:b}),v.error)return te({result:v,stack:g});let S=(d=b==null?void 0:b.collectionDefinitions)==null?void 0:d.find(C=>C.collectionId===a);if(!S)return te({result:{error:jr,collectionId:a}});b.collectionDefinitions=b.collectionDefinitions.filter(C=>C.collectionId!==a),S.collectionGroupNumber&&(b.collectionDefinitions=b.collectionDefinitions.map(C=>{let{collectionGroupNumber:O,...k}=C;return k}),b.collectionGroups=b.collectionGroups.filter(({groupNumber:C})=>C!==S.collectionGroupNumber));let{aggregateValue:w,valueGoal:U}=Wh(b);b.winCriteria=Ge({aggregateValue:w,valueGoal:U});let T=I==null?void 0:I.winCriteria.valueGoal,D=I==null?void 0:I.winCriteria.aggregateValue;(T&&T!==U||w&&!D)&&(n?b.tieFormatName=n:delete b.tieFormatName);let P=[];s&&u?P=[u]:o&&y?P=((p=qt({matchUpFilters:{matchUpTypes:[gi]},structure:y}))==null?void 0:p.matchUps)??[]:r?P=((m=Pn({matchUpFilters:{matchUpTypes:[gi]},drawDefinition:r}))==null?void 0:m.matchUps)??[]:c&&(P=((h=ou({matchUpFilters:{matchUpTypes:[gi]},drawDefinition:r}))==null?void 0:h.matchUps)??[]);let E=(P||[]).filter(C=>{var O,k,x;let F=(k=(O=C.tieMatchUps)==null?void 0:O.filter(_=>_.collectionId===a))==null?void 0:k.some(br),$=e&&C.tieFormat?(x=Vu({descendant:C.tieFormat,ancestor:b}))==null?void 0:x.different:!1;return t&&!F||!C.winningSide&&C.matchUpStatus!==Ki&&(t||C.matchUpStatus!==ms&&!br(C)&&!$)});if(!E.length)return{error:hv};let{appliedPolicies:R}=Bt({tournamentRecord:i});if(s&&u&&t){let C=(f=u.tieMatchUps)==null?void 0:f.filter(O=>O.collectionId===a);for(let O of C??[]){let k=nU({matchUpId:O.matchUpId,tieMatchUpId:u==null?void 0:u.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:R,drawDefinition:r,event:c});if(k.error||(k=Ti({drawDefinition:r,matchUpId:s}),k.error))return k;u=k==null?void 0:k.matchUp}}let N=[];for(let C of E){for(let O of(C==null?void 0:C.sides)??[])O.lineUp=(O.lineUp??[]).map(k=>({participantId:k.participantId,collectionAssignments:((k==null?void 0:k.collectionAssignments)??[]).filter(x=>x.collectionId!==a)}));if(C.tieMatchUps=(C.tieMatchUps??[]).filter(O=>{let k=O.collectionId===a;return k&&N.push(O.matchUpId),!k}),C.tieFormat&&(C.tieFormat=Yr(b)),t){let O=rc({matchUpId:C.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:R,drawDefinition:r,event:c});if(O.error)return O}Et({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,drawDefinition:r,context:g,matchUp:C})}N.length&&ec({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:N,eventId:c==null?void 0:c.eventId,drawDefinition:r});let A=Ge(b);if(v=qn({tieFormat:A}),v.error)return te({result:v,stack:g});if(l&&c)c.tieFormat=A;else if(s&&u)u.tieFormat=A;else if(y)y.tieFormat=A;else if(r)r.tieFormat=A;else if(!u||!r)return{error:_e};ui({drawDefinition:r,eventId:c==null?void 0:c.eventId});let M=Ge({drawId:r==null?void 0:r.drawId,action:g,collectionId:a,structureId:o,matchUpId:s,eventId:l});return rE({appliedPolicies:R,drawDefinition:r,auditData:M}),{tieFormat:A,deletedMatchUpIds:N,targetMatchUps:E,...Q}}function Zie({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(n))return te({result:{error:Qe},stack:d});let p=l?void 0:op({drawDefinition:r,structureId:o,matchUpId:s,eventId:u,event:c});if(p!=null&&p.error)return te({result:p,stack:d});let m=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,f=h==null?void 0:h.winCriteria.valueGoal,g=Yr(h);if(p=qn({tieFormat:g}),p.error)return te({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:I,collectionGroupNumber:b}=y;if(b&&n.includes(I))return te({info:"collectionIds cannot be part of other collectionGroups",result:{error:le},stack:d})}let v=(g.collectionGroups||[]).reduce((y,I)=>I.groupNumber>y?I.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>n.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],Kie({updateInProgressMatchUps:t,originalValueGoal:f,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:o,structure:m,tieFormat:g,matchUpId:s,matchUp:l,eventId:u,event:c})}function Q$({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:m,uuids:h,event:f}){var g,v;let y="addCollectionDefinition",I=Bt({tournamentRecord:r,drawDefinition:s,event:f}).appliedPolicies??{},b=(n==null?void 0:n[_r])??(I==null?void 0:I[_r]);a=a??((g=b==null?void 0:b.participants)==null?void 0:g.enforceCategory);let S=(u??((v=b==null?void 0:b.participants)==null?void 0:v.enforceGender))!==!1,w=!!((i??(f==null?void 0:f.category))&&a!==!1),U=!!((o??(f==null?void 0:f.gender))&&S),T=aw({referenceCategory:i??(f==null?void 0:f.category),collectionDefinition:e,referenceGender:o,checkCategory:w,checkGender:U,event:f});if(T.error)return te({result:T,stack:y});let D=p!=null&&p.tieFormat?void 0:op({drawDefinition:s,structureId:c,matchUpId:d,eventId:m,event:f});if(D!=null&&D.error)return te({result:{error:D.error},stack:y});let P=D==null?void 0:D.structure;p=p??(D==null?void 0:D.matchUp);let E=(p==null?void 0:p.tieFormat)??(D==null?void 0:D.tieFormat),R=Yr(E);if(D=qn({tieFormat:R}),D==null?void 0:D.error)return te({result:{error:D.error},stack:y});if(!e.collectionId)e.collectionId=Ht();else if(R.collectionDefinitions.map(({collectionId:_})=>_).includes(e.collectionId))return te({context:{collectionId:e.collectionId},result:{error:F9}});R.collectionDefinitions.push(e),R.collectionDefinitions.sort((_,L)=>(_.collectionOrder||0)-(L.collectionOrder||0)).forEach((_,L)=>_.collectionOrder=L+1);let{aggregateValue:N,valueGoal:A}=Wh(R);R.winCriteria=Ge({aggregateValue:N,valueGoal:A});let M=E==null?void 0:E.winCriteria.valueGoal,C=E==null?void 0:E.winCriteria.aggregateValue;(M&&M!==A||N&&!C)&&(l?R.tieFormatName=l:delete R.tieFormatName);let O=[],k=[],x=[],F=Ge(R);if(D=qn({tieFormat:F}),D==null?void 0:D.error)return te({result:{error:D.error},stack:y});if(m&&f){f.tieFormat=F;for(let _ of f.drawDefinitions??[])if(!_.tieFormat)for(let L of _.structures??[]){if(L.tieFormat)continue;let B=tC({updateInProgressMatchUps:t,collectionDefinition:e,structure:L,uuids:h});k.push(...B.newMatchUps),x.push(...B.targetMatchUps),O.push(L.structureId)}TU({modifiedMatchUps:x,eventId:f==null?void 0:f.eventId,modifiedStructureIds:O,tournamentRecord:r,drawDefinition:s,addedMatchUps:k,stack:y})}else if(c&&P){P.tieFormat=F;let _=tC({updateInProgressMatchUps:t,collectionDefinition:e,structure:P,uuids:h});k.push(..._.newMatchUps),x=_.targetMatchUps,TU({modifiedMatchUps:x,eventId:f==null?void 0:f.eventId,modifiedStructureIds:O,tournamentRecord:r,drawDefinition:s,addedMatchUps:k,stack:y})}else if(d&&p){if(!M0({matchUp:p,updateInProgressMatchUps:t}))return te({result:{error:iF},stack:y});p.tieFormat=F;let _=Vw({collectionDefinition:e,matchUp:p,uuids:h});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(..._),k.push(..._),TU({modifiedMatchUps:[p],eventId:f==null?void 0:f.eventId,modifiedStructureIds:O,tournamentRecord:r,drawDefinition:s,addedMatchUps:k,stack:y})}else if(s){s.tieFormat=F;for(let _ of s.structures??[]){let L=tC({updateInProgressMatchUps:t,collectionDefinition:e,structure:_,uuids:h});O.push(_.structureId),k.push(...L.newMatchUps),x.push(...L.targetMatchUps)}TU({modifiedMatchUps:x,eventId:f==null?void 0:f.eventId,tournamentRecord:r,drawDefinition:s,addedMatchUps:k,stack:y})}else return{error:_e};let $=Ge({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:y,structureId:c,matchUpId:d,eventId:m});return rE({appliedPolicies:I,drawDefinition:s,auditData:$}),{tieFormat:F,targetMatchUps:x,addedMatchUps:k,...Q}}function tC({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){var n;let a=[],o=((n=qt({matchUpFilters:{matchUpTypes:[gi]},structure:i}))==null?void 0:n.matchUps).filter(s=>M0({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of o){let l=Vw({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),a.push(...l)}return{newMatchUps:a,targetMatchUps:o}}function TU({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:o}){Fc({tournamentId:e==null?void 0:e.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i==null||i.forEach(s=>{Et({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:r,context:o,matchUp:s,eventId:a})}),ui({structureIds:t,drawDefinition:r,eventId:a})}function ere({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!qn({tieFormat:i}).valid)return te({result:{error:xl},info:"falied validation",stack:d});let p=op({drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:c});if(p.error)return te({result:p,stack:d});let{matchUp:m,tieFormat:h}=p,f=Yr(h),g=Vu({descendant:i,ancestor:f,considerations:n});if(g.invalid)return te({context:{invalid:g.invalid},result:{error:xl},stack:d});if(!(g!=null&&g.different))return te({result:{...Q},info:"Nothing to do",stack:d});let v=f.collectionDefinitions.map(({collectionId:D})=>D),y=i.collectionDefinitions.map(({collectionId:D})=>D),I=v.filter(D=>!y.includes(D)),b=i.collectionDefinitions.filter(({collectionId:D})=>!v.includes(D)),S=b.map(Na("collectionId")),w=[],U,T=i.tieFormatName;for(let D of i.collectionDefinitions){if(S.includes(D.collectionId))continue;let P=J$({updateInProgressMatchUps:t,...D,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:c});if(P.modifications&&w.push(...P.modifications),P.error)return te({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of b){let P=Q$({updateInProgressMatchUps:t,collectionDefinition:D,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:o,matchUpId:s,matchUp:m,eventId:l,uuids:u,event:c});if(P.error)return te({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of I){let P=X$({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:D,structureId:o,matchUpId:s,eventId:l,matchUp:m,event:c});if(P.error)return te({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}return(h==null?void 0:h.tieFormatName)!==T?(U.tieFormatName=T,w.push({tieFormatName:T})):(w.length||S.length||I.length)&&(delete U.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),U.collectionDefinitions=U.collectionDefinitions.sort((D,P)=>Xf(D.collectionOrder)-Xf(P.collectionOrder)).map((D,P)=>({...D,collectionOrder:P+1})),{processedTieFormat:Yr(U),modifications:w,...Q}}function tre({tournamentRecord:t}){if(!t)return{error:ve};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=c=>{if(!c.tieFormat)return;let d;for(let p of r)Vu({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)c.tieFormatId=d,delete c.tieFormat;else{let p=Me(c.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=Ht()),c.tieFormatId=p.tieFormatId,delete c.tieFormat,r.push(p),e+=1}},a=i.eventType;n({tieFormat:i.tieFormat,eventType:a});for(let c of i.drawDefinitions??[]){n({tieFormat:c.tieFormat,eventType:a});for(let d of c.structures??[])n({tieFormat:d.tieFormat,eventType:a})}let o=(c,d)=>{var p;let m=(p=l.matchUps)==null?void 0:p.find(h=>h.matchUpId===c);m&&(m.tieFormatId=d,delete m.tieFormat,Et({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:m}))},s=c=>{let d=Me(c.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Ht()),r.push(d),e+=1,o(c.matchUpId,d.tieFormatId)},l=ou({matchUpFilters:{matchUpTypes:[Va]},event:i}),u=l.matchUps??[];for(let c of u){let d;for(let p of r)c.tieFormat&&Vu({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?o(c.matchUpId,d):s(c)}r.length&&(i.tieFormats=r)}return{...Q,addedCount:e}}var ire={};wt(ire,{addDrawDefinitionExtension:()=>OP,addEventExtension:()=>rd,addEventTimeItem:()=>Gh,addExtension:()=>_t,addNotes:()=>sR,addOnlineResource:()=>ure,addParticipantExtension:()=>sJ,addParticipantTimeItem:()=>s_,addTimeItem:()=>Tl,addTournamentExtension:()=>VF,addTournamentTimeItem:()=>zw,analyzeDraws:()=>Ww,analyzeTournament:()=>j_,copyTournamentRecord:()=>nre,createTournamentRecord:()=>eE,generate:()=>rre,getAggregateTeamResults:()=>V_,getAllowedDrawTypes:()=>SR,getAllowedMatchUpFormats:()=>__,getAppliedPolicies:()=>Bt,getCompetitionDateRange:()=>DR,getCompetitionPenalties:()=>$_,getPolicyDefinitions:()=>tc,getTournamentInfo:()=>zh,getTournamentPenalties:()=>TR,getTournamentPersons:()=>B_,getTournamentPoints:()=>PR,getTournamentStructures:()=>jL,getTournamentTimeItem:()=>HP,mutate:()=>are,query:()=>oee,removeDrawDefinitionExtension:()=>lJ,removeEventExtension:()=>kP,removeExtension:()=>Dn,removeNotes:()=>r_,removeOnlineResource:()=>lre,removeParticipantExtension:()=>uJ,removeTournamentExtension:()=>jF,setTournamentCategories:()=>pre,setTournamentDates:()=>nE,setTournamentEndDate:()=>hre,setTournamentName:()=>cre,setTournamentNotes:()=>dre,setTournamentStartDate:()=>mre,setTournamentStatus:()=>sre});var rre={};wt(rre,{copyTournamentRecord:()=>nre,createTournamentRecord:()=>eE});function nre(t){var e,i;let r=We(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(r.error)return r;let{startDate:n,endDate:a}=t.tournamentRecord,o=24*60*60*1e3,s=(n&&a?new Date(ht(a)).getTime()-new Date(ht(n)).getTime():0)/o,l=t.endDate||SF(t.startDate,s),u=h=>h==null?void 0:h.filter(({itemType:f})=>{var g;return(g=t.itemTypeList)==null?void 0:g.includes(f)}),c=h=>h==null?void 0:h.filter(({name:f})=>{var g;return(g=t.extensionList)==null?void 0:g.includes(f)}),d=h=>{let{timeItems:f,extensions:g,...v}=h;return Me({...v,timeItems:u(f),extensions:c(g)},!1,!0)},p=h=>{let{drawDefinitions:f,timeItems:g,extensions:v,startDate:y,endDate:I,...b}=h;return Me({extensions:c(v),timeItems:u(g),startDate:t.startDate,endDate:l,...b},!1,!0)},m={participants:t.copyParticipants?((e=t.tournamentRecord.participants)==null?void 0:e.map(d))??[]:[],parentOrganisation:Me({...t.tournamentRecord.parentOrganisation},!1,!0),venues:Me(t.tournamentRecord.venues??[],!1,!0),extensions:c(t.tournamentRecord.extensions),timeItems:u(t.tournamentRecord.timeItems),events:((i=t.tournamentRecord.events)==null?void 0:i.map(p))??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:Ht(),endDate:l};return{...Q,tournamentRecord:m}}var are={};wt(are,{addDrawDefinitionExtension:()=>OP,addEventExtension:()=>rd,addEventTimeItem:()=>Gh,addExtension:()=>_t,addNotes:()=>sR,addOnlineResource:()=>ure,addParticipantExtension:()=>sJ,addParticipantTimeItem:()=>s_,addTimeItem:()=>Tl,addTournamentExtension:()=>VF,addTournamentTimeItem:()=>zw,removeDrawDefinitionExtension:()=>lJ,removeEventExtension:()=>kP,removeExtension:()=>Dn,removeNotes:()=>r_,removeOnlineResource:()=>lre,removeParticipantExtension:()=>uJ,removeTournamentExtension:()=>jF,setTournamentCategories:()=>pre,setTournamentDates:()=>nE,setTournamentEndDate:()=>hre,setTournamentName:()=>cre,setTournamentNotes:()=>dre,setTournamentStartDate:()=>mre,setTournamentStatus:()=>sre});var iMe="ABANDONED",rMe="ACTIVE",nMe="CANCELLED",aMe="COMPLETED",oMe="IN_PROGRESS",ore={ABANDONED:iMe,ACTIVE:rMe,CANCELLED:nMe,COMPLETED:aMe,IN_PROGRESS:oMe};function sre({tournamentRecord:t,status:e}){return t?e&&!Object.keys(ore).includes(e)?{error:le,info:"Unknown status"}:(t.tournamentStatus=e,{...Q}):{error:ve}}function lre(t){var e,i,r;let n=We(t,[{tournamentRecord:!0,onlineResource:!0}]);if(n.error)return n;let{tournamentRecord:a,onlineResource:o,organisationId:s,participantId:l,personId:u,courtId:c,venueId:d}=t;if(s){if(((e=a.parentOrganisation)==null?void 0:e.parentOrganisationId)!==s)return te({result:{error:jr}});rf({element:a.parentOrganisation,onlineResource:o})}else if(l||u){let p=(a.participants??[]).find(m=>{var h;return u&&((h=m.person)==null?void 0:h.personId)===u||m.participantId===l});if(!p)return te(u?{result:{error:jr}}:{result:{error:Wi}});if(u){if(((i=p.person)==null?void 0:i.personId)!==u)return te({result:{error:Uh}});rf({element:p.person,onlineResource:o})}else rf({element:p,onlineResource:o})}else if(c){let p=(r=(a.venues??[]).filter(m=>!d||m.venueId===d).flatMap(m=>(m.courts??[]).filter(h=>h.courtId===c)))==null?void 0:r[0];if(!p)return te({result:{error:mv}});rf({element:p,onlineResource:o})}else if(d){let p=(a.venues??[]).find(m=>m.venueId===d);if(!p)return te({result:{error:Th}});rf({element:p,onlineResource:o})}else rf({element:a,onlineResource:o}),ut({payload:{parentOrganisation:a.parentOrganisation,onlineResources:a.onlineResources,tournamentId:a.tournamentId},topic:Rp});return{...Q}}function rf({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!((r==null?void 0:r[rg])===e[rg]&&(r==null?void 0:r[ng])===e[ng]&&(r==null?void 0:r[ag])===e[ag]));t.onlineResources=i}function ure(t){var e,i,r;let n=We(t,[{tournamentRecord:!0,onlineResource:!0}]);if(n.error)return n;let{tournamentRecord:a,onlineResource:o,organisationId:s,participantId:l,personId:u,courtId:c,venueId:d}=t;if(s){if(((e=a.parentOrganisation)==null?void 0:e.parentOrganisationId)!==s)return te({result:{error:jr}});nf({element:a.parentOrganisation,onlineResource:o})}else if(l||u){let p=(a.participants??[]).find(m=>{var h;return u&&((h=m.person)==null?void 0:h.personId)===u||m.participantId===l});if(!p)return te(u?{result:{error:jr}}:{result:{error:Wi}});if(u){if(((i=p.person)==null?void 0:i.personId)!==u)return te({result:{error:Uh}});nf({element:p.person,onlineResource:o})}else nf({element:p,onlineResource:o})}else if(c){let p=(r=(a.venues??[]).filter(m=>!d||m.venueId===d).flatMap(m=>(m.courts??[]).filter(h=>h.courtId===c)))==null?void 0:r[0];if(!p)return te({result:{error:mv}});nf({element:p,onlineResource:o})}else if(d){let p=(a.venues??[]).find(m=>m.venueId===d);if(!p)return te({result:{error:Th}});nf({element:p,onlineResource:o})}else nf({element:a,onlineResource:o}),ut({payload:{parentOrganisation:a.parentOrganisation,onlineResources:a.onlineResources,tournamentId:a.tournamentId},topic:Rp});return{...Q}}function nf({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>(r==null?void 0:r[rg])!==e[rg]&&(r==null?void 0:r[ng])!==e[ng]&&(r==null?void 0:r[ag])!==e[ag]);return i.push(e),t.onlineResources=i,{...Q}}function cre({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:ve};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&ut({topic:Rp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...Q}}function dre({tournamentRecord:t,notes:e}){if(!t)return{error:ve};let i=e?sR({element:t,notes:e}):r_({element:t});return i.error?i:(ut({topic:Rp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...Q})}function pre({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,ut({topic:Rp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...Q}):{error:ve}}function sMe({tournamentRecord:t}){var e,i;if(!t)return{error:ve};let{startDate:r,endDate:n}=t,a=ig(r,n),o=[];for(let s of t.venues||[])(e=s==null?void 0:s.courts)!=null&&e.length&&o.push(...s.courts);for(let s of o){let{startTime:l,endTime:u}=(s.dateAvailability??[]).reduce((p,m)=>{let h=kt(p.startTime),f=kt(p.endTime);return m.startTime&&kt(m.startTime)<h&&(p.startTime=m.startTime),m.endTime&&kt(m.endTime)>f&&(p.endTime=m.endTime),p},{startTime:"08:00",endTime:"18:00"}),c=a.map(p=>{var m;return((m=s.dateAvailability)==null?void 0:m.find(h=>h.date===p))??{date:p,startTime:l,endTime:u}}),d=(i=s.dateAvailability)==null?void 0:i.find(p=>!p.date);d&&c.unshift(d),s.dateAvailability=c}return{...Q}}function nE(t){var e,i;let{tournamentRecord:r,startDate:n,endDate:a,weekdays:o}=t,s=(e=t.activeDates)==null?void 0:e.filter(Boolean),l=We(t,[{tournamentRecord:!0},{[Jr]:f=>ul.test(f),[za]:Fr,startDate:!1,endDate:!1},{[Jr]:f=>f.filter(Boolean).every(g=>ul.test(g)),[za]:Fr,activeDates:!1},{[Jr]:Gee,weekdays:!1}]);if(l.error)return l;if(a&&n&&new Date(a)<new Date(n))return{error:le};if(a&&n&&new Date(n)>new Date(a))return{error:le};if(s!=null&&s.length){let f=n||r.startDate,g=a||r.endDate,v=!f||s.every(I=>new Date(I)>=new Date(f)),y=!g||s.every(I=>new Date(I)<=new Date(g));if(!v||!y)return{error:Fr}}let u;(n&&r.startDate&&new Date(n)>new Date(r.startDate)||a&&r.endDate&&new Date(a)<new Date(r.endDate))&&(u=!0);let c=ig(r.startDate,r.endDate);n&&(r.startDate=n),a&&(r.endDate=a);let d=ig(r.startDate,r.endDate),p=c.filter(f=>!d.includes(f)),m=d.filter(f=>!c.includes(f));for(let f of r.events??[])n&&f.startDate&&new Date(f.startDate)<new Date(n)&&(f.startDate=n),a&&f.startDate&&new Date(f.startDate)>new Date(a)&&(f.startDate=n??a),a&&f.endDate&&new Date(f.endDate)>new Date(a)&&(f.endDate=a),n&&f.endDate&&new Date(f.endDate)<new Date(n)&&(f.endDate=a??n);n&&r.endDate&&new Date(n)>new Date(r.endDate)&&(r.endDate=n),a&&r.startDate&&new Date(a)<new Date(r.startDate)&&(r.startDate=a),s&&(r.activeDates=s),o&&(r.weekdays=o);let h=u&&((i=lMe({tournamentRecord:r}))==null?void 0:i.unscheduledMatchUpIds);return sMe({tournamentRecord:r}),ut({payload:Ge({parentOrganisation:r.parentOrganisation,tournamentId:r.tournamentId,activeDates:s,startDate:n,weekdays:o,endDate:a}),topic:Rp}),{...Q,unscheduledMatchUpIds:h,datesAdded:m,datesRemoved:p}}function mre({tournamentRecord:t,startDate:e}){return e?nE({tournamentRecord:t,startDate:e}):{error:Fr}}function hre({tournamentRecord:t,endDate:e}){return e?nE({tournamentRecord:t,endDate:e}):{error:Fr}}function lMe({tournamentRecord:t}){let e=Hr({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let o of e){let{schedule:s,matchUpId:l}=o;if(s&&s.scheduledDate){let u=new Date(s.scheduledDate);(i&&u<i||r&&u>r)&&(a.push(l),n.includes(s.scheduledDate)||n.push(s.scheduledDate))}}return n.length&&!QR({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:LK}:{unscheduledMatchUpIds:a}}var fre={};wt(fre,{addCourt:()=>iE,addCourts:()=>W$,addVenue:()=>Pw,deleteCourt:()=>Tre,deleteVenue:()=>iB,deleteVenues:()=>yre,disableCourts:()=>bre,disableVenues:()=>wre,enableCourts:()=>Ure,enableVenues:()=>Sre,generate:()=>gre,generateCourts:()=>b$,getCompetitionVenues:()=>Jw,getCourts:()=>o$,getVenuesAndCourts:()=>nc,modifyCourt:()=>rB,modifyCourtAvailability:()=>eB,modifyVenue:()=>Dre,mutate:()=>vre,publicFindVenue:()=>wL,query:()=>See});var gre={};wt(gre,{generateCourts:()=>b$});var vre={};wt(vre,{addCourt:()=>iE,addCourts:()=>W$,addVenue:()=>Pw,deleteCourt:()=>Tre,deleteVenue:()=>iB,deleteVenues:()=>yre,disableCourts:()=>bre,disableVenues:()=>wre,enableCourts:()=>Ure,enableVenues:()=>Sre,modifyCourt:()=>rB,modifyCourtAvailability:()=>eB,modifyVenue:()=>Dre});function Z$(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:ve};if(!(t!=null&&t.courtId))return{error:wh};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:o}=ac({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:s}=Hr({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{var m,h,f;let g=(h=(m=p.schedule)==null?void 0:m.allocatedCourts)==null?void 0:h.map(({courtId:v})=>v);return((f=p.schedule)==null?void 0:f.courtId)===c||(g==null?void 0:g.includes(c))});return S0({matchUps:d,schedulingProfile:o})}}function uMe({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:ve};if(!r)return{error:ed};let{schedulingProfile:n}=ac({tournamentRecord:e}),{matchUps:a}=Hr({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:o({matchUps:a,venueId:r})};function o({matchUps:s,venueId:l}){let u=s.filter(c=>{var d,p,m;let h=(p=(d=c.schedule)==null?void 0:d.allocatedCourts)==null?void 0:p.map(({venueId:f})=>f);return((m=c.schedule)==null?void 0:m.venueId)===l||(h==null?void 0:h.includes(l))});return S0({matchUps:u,schedulingProfile:n})}}function eB({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){var o,s,l;if(!t)return{error:ve};if(!n)return{error:wh};let u=Xte({dateAvailability:e});if(u.error)return u;let{updatedDateAvailability:c,totalMergeCount:d}=cMe(e);e=c;let p=Lh({tournamentRecord:t,courtId:n});if(p.error)return p;let{court:m,venue:h}=p,{matchUps:f}=Z$({tournamentRecord:t,venueMatchUps:r,courtId:n});if(f!=null&&f.length){let g=(o=Bt({tournamentRecord:t}))==null?void 0:o.appliedPolicies,v=a??((l=(s=g==null?void 0:g[id])==null?void 0:s.allowDeletionWithScoresPresent)==null?void 0:l.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return m&&(m.dateAvailability=e,!i&&h&&ut({payload:{venue:h,tournamentId:t.tournamentId},topic:Ep,key:h.venueId})),{...Q,totalMergeCount:d}}function cMe(t){let e=0,i=t.reduce((n,a)=>{let{date:o,startTime:s,endTime:l,bookings:u}=a;return n[o]||(n[o]=[]),n[o].push({startTime:s,endTime:l,bookings:u}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(E1e);let{mergedAvailability:a,mergeCount:o}=dMe(i[n]);r.push(...a.map(s=>({date:n,...s}))),e+=o}),{updatedDateAvailability:r,totalMergeCount:e}}function dMe(t){let e,i,r,n=t.length,a=0,o=[];for(;t.length&&n;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(n-=1,!e)e=u,r=d,i=c;else if(rw(nr(i),nr(u),!1)>0){let p={startTime:e,endTime:i};r!=null&&r.length&&(p.bookings=r),o.push(p),e=u,r=d,i=c}else d&&(r?r.push(d):r=d),i=c,a+=1}let s={startTime:e,endTime:i};return r!=null&&r.length&&(s.bookings=r),o.push(s),{mergedAvailability:o,mergeCount:a}}function tB({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:V9,info:e}}function Ire({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:bn};if(!e&&!r)return{error:Bs};let a;if(!e){if(!t)return{error:ve};({drawDefinition:e}=Kn({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=Ti({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:ve};let o=Hr({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=SQ({matchUps:o,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(o=>[_c,Zl].includes(o.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:o})=>![_c,Zl].includes(o)),Et({tournamentId:t==null?void 0:t.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...Q}):{error:fn}}function iB(t){var e,i,r;if(typeof(t==null?void 0:t.venueId)!="string")return{error:ed};let{tournamentRecord:n,venueId:a,force:o}=t,s=t.tournamentRecords||n&&{[n.tournamentId]:n}||{};if(!Object.keys(s).length)return{error:ve};let l=Ls({tournamentRecords:s,contextFilters:{venueIds:[a]}}).matchUps??[],u=(e=Bt({tournamentRecord:n}))==null?void 0:e.appliedPolicies,c=o??((r=(i=u==null?void 0:u[id])==null?void 0:i.allowDeletionWithScoresPresent)==null?void 0:r.venues);if(!l.length||c)for(let d of Object.values(s)){for(let m of l){let h=Ire({matchUpId:m.matchUpId,drawId:m.drawId,tournamentRecord:d});if(h.error)return h}let p;d.venues=(d.venues??[]).filter(m=>(m==null?void 0:m.venueId)!==a?!0:(p=!0,!1)),p&&ut({payload:{venueId:a,tournamentId:d.tournamentId},topic:ZF,key:a})}else return tB({matchUpsCount:l.length});return Qw({tournamentRecords:s}),{...Q}}function yre({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:le};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,o=iB({tournamentRecord:t,venueId:a,force:i});if(o.error)return o}}return{...Q}}function bre(t){let{courtIds:e,dates:i}=t,r=Po(t),n=[{[gn]:!0,[NP]:!0}],a=We(t,n);if(a.error)return a;for(let o of Object.values(r))pMe({tournamentRecord:o,courtIds:e,dates:i});return{...Q}}function pMe({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>_t({extension:{value:r,name:Ds},creationTime:!1,element:a});for(let a of t.venues||[])for(let o of a.courts||[])if(e!=null&&e.includes(o.courtId)){let s=n(o);if(s.error)return s}return{...Q}}function wre(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[gn]:!0,[AP]:!0}],a=We(t,n);if(a.error)return a;let o=Object.keys(e).filter(s=>!i||s===i);for(let s of o){let l=e[s];mMe({tournamentRecord:l,venueIds:r})}return{...Q}}function mMe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let r=_t({creationTime:!1,element:i,extension:{name:Ds,value:!0}});if(r.error)return r}return{...Q}}function Ure(t){let e=Po(t),i=[{[gn]:!0}];!t.enableAll&&i.push({[NP]:!0});let r=We(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:o}=t;for(let s of Object.values(e))hMe({tournamentRecord:s,courtIds:a,enableAll:n,dates:o});return{...Q}}function hMe({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(r)){let{extension:o}=It({element:a,name:Ds});if(o){let s=o.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!r.includes(l))),_t({extension:{name:Ds,value:s},creationTime:!1,element:a})}}else Dn({element:a,name:Ds});return{...Q}}function Sre(t){let e=Po(t),i=[{[gn]:!0}];!t.enableAll&&i.push({[AP]:!0});let r=We(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let o of Object.values(e))for(let s of o.venues||[])(a||n!=null&&n.includes(s.venueId))&&Dn({element:s,name:Ds});return{...Q}}function Tre(t){let{courtId:e,disableNotice:i,force:r}=t,n=Po(t),a=We(t,[{[gn]:!0,[iJ]:!0}]);if(a.error)return a;let o,s;for(let l of Object.values(n)){if(s=fMe({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),s.error&&s.error!==mv)return s;s.success&&(o=!0)}return o?{...Q}:s}function fMe({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){var n,a,o;let s=Lh({tournamentRecord:t,courtId:i});if(s.error)return s;let l=s.venue,{matchUps:u}=Z$({tournamentRecord:t,courtId:i}),c=(n=Bt({tournamentRecord:t}))==null?void 0:n.appliedPolicies,d=r??((o=(a=c==null?void 0:c[id])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:o.courts);if(!(u!=null&&u.length)||d){for(let p of u??[]){let m=Ire({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(m.error)return m}l&&(l.courts=(l.courts??[]).filter(p=>p.courtId!==i),e||ut({payload:{venue:l,tournamentId:t.tournamentId},topic:Ep,key:l.venueId}))}else return tB({matchUpsCount:u.length});return{...Q}}function rB(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,o=Po(t);if(!Object.keys(o).length)return{error:ki};let s,l;for(let u of Object.values(o)){let c=gMe({tournamentRecord:u,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(c!=null&&c.error)return c;s=!0}return s?{...Q}:l}function gMe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:ve};if(!n)return{error:wh};if(!r||typeof r!="object")return{error:Zu};let o=Lh({tournamentRecord:t,courtId:n});if(o.error)return o;let{venue:s,court:l}=o,u=Object.keys(R1e()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>u.includes(p)).length)return{error:mP};let c=u.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(r).filter(p=>c.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=eB({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||ut({payload:{venue:s,tournamentId:t.tournamentId},topic:Ep,key:s==null?void 0:s.venueId}),{...Q,court:Me(l)}}var vMe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),IMe=vMe;function Dre(t){let{modifications:e,venueId:i,force:r}=t,n=Po(t);if(!Object.keys(n).length)return{error:ki};if(typeof i!="string")return{error:ed};let a,o;for(let s of Object.values(n)){let l=yMe({tournamentRecord:s,modifications:e,venueId:i,force:r});if(l.success&&(o=!0),l.error&&(a=l.error),l.error&&l.error!==Th)return l}return Qw({tournamentRecords:n}),o?{...Q}:{error:a}}function yMe({tournamentRecord:t,modifications:e,venueId:i,force:r}){var n,a,o,s,l,u,c,d;if(!t)return{error:ve};if(!e||typeof e!="object")return{error:Zu};if(!i)return{error:ed};let p=(n=Bt({tournamentRecord:t}))==null?void 0:n.appliedPolicies,m=r??((o=(a=p==null?void 0:p[id])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:o.venues),{matchUps:h}=uMe({tournamentRecord:t,venueId:i}),f=au({tournamentRecord:t,venueId:i});if(f.error)return f;let g=f.venue,v=Object.keys(IMe()).filter(T=>T!=="venueId");if(!Object.keys(e).filter(T=>v.includes(T)).length)return{error:mP};let y=v.filter(T=>!["courts","onlineResources"].includes(T)),I=Object.keys(e).filter(T=>y.includes(T));g&&I.forEach(T=>Object.assign(g,{[T]:e[T]}));let b=((s=g==null?void 0:g.courts)==null?void 0:s.map(T=>T.courtId))??[],S=((l=e.courts)==null?void 0:l.map(T=>T.courtId))||[],w=S.length?b.filter(T=>!S.includes(T)):(e==null?void 0:e.courts)&&b,U=[];if(w!=null&&w.length){let T=(c=(u=g==null?void 0:g.courts)==null?void 0:u.filter(D=>w.includes(D.courtId)))==null?void 0:c.map(D=>{var P;let E=Z$({courtId:D.courtId,tournamentRecord:t,venueMatchUps:h});for(let R of E.matchUps??[])U.push({matchUpId:R.matchUpId,drawId:R.drawId});return((P=E.matchUps)==null?void 0:P.length)??0}).reduce((D,P)=>D+P);if(g&&(!T||m))g.courts=(d=g.courts)==null?void 0:d.filter(D=>S.includes(D.courtId)),Ty({schedule:{courtId:"",scheduledDate:""},matchUpDetails:U,removePriorValues:!0,tournamentRecord:t});else return tB({matchUpsCount:T})}if(e.courts)for(let T of e.courts){let{courtId:D}=T||{},P=rB({modifications:T,disableNotice:!0,tournamentRecord:t,venueMatchUps:h,courtId:D,force:r});if(P.error===mv&&(P=iE({disableNotice:!0,tournamentRecord:t,venueId:i,court:T})),P.error)return P}return Qw({tournamentRecord:t}),g&&ut({payload:{venue:g,tournamentId:t.tournamentId},topic:Ep,key:g==null?void 0:g.venueId}),{...Q,venue:Me(g)}}var nB={};wt(nB,{JSON2CSV:()=>PMe,UUID:()=>Ht,UUIDS:()=>s8,allNumeric:()=>MK,attributeFilter:()=>_m,chunkArray:()=>Cr,chunkByNth:()=>eM,chunkSizeProfile:()=>CK,constantToString:()=>tn,countValues:()=>Fwe,createMap:()=>AK,dateTime:()=>o8,definedAttributes:()=>Ge,dehydrateMatchUps:()=>UMe,extractAttributes:()=>uX,flattenJSON:()=>aB,generateDateRange:()=>ig,generateHashCode:()=>Hwe,generateRange:()=>De,generateTimeCode:()=>nie,groupValues:()=>RK,hasAttributeValues:()=>Gwe,instanceCount:()=>Ra,intersection:()=>ji,isConvertableInteger:()=>st,isNumeric:()=>xi,isOdd:()=>DK,isPowerOf2:()=>Os,makeDeepCopy:()=>Me,matchUpScheduleSort:()=>wMe,matchUpSort:()=>_h,nearestPowerOf2:()=>Vx,nextPowerOf2:()=>sv,noNulls:()=>xwe,noNumeric:()=>NK,numericSort:()=>ur,occurrences:()=>_we,overlap:()=>Nn,randomMember:()=>$o,randomPop:()=>va,shuffleArray:()=>Tn,structureSort:()=>Mh,subSort:()=>$we,undefinedToNull:()=>tM,unique:()=>dt,visualizeScheduledMatchUps:()=>bMe});function bMe({scheduledMatchUps:t,showGlobalLog:e}){dTe();let i=t==null?void 0:t.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:o}=t.find(s=>s.structureId===n);return{[n]:`${a} ${o}`}})};i==null||i.forEach(n=>{var a;ka({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let o=t.filter(l=>l.structureId===n),s=((a=An({matchUps:o}))==null?void 0:a.roundMatchUps)||[];Object.keys(s).forEach(l=>{ka({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),s[l].forEach(({matchUpId:u,schedule:c})=>{let d=Si(c.scheduledTime);ka({matchUpId:u,time:d,date:c.scheduledDate,venue:c.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&cTe()}var{extractTime:hj,timeStringMinutes:fj}=o8;function wMe(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=fj(hj(i.scheduledTime)),a=fj(hj(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function UMe({tournamentRecord:t}){if(!t)return{error:ve};if(typeof t!="object"||!t.tournamentId)return{error:le};let{matchUps:e}=Hr({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=SMe({tournamentRecord:t});DMe(e,i)}return{...Q}}function SMe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var TMe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function DMe(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,o=e[r]||e[n]||e[a],s=i.matchUpFormat===o?void 0:i.matchUpFormat;for(let l of Object.keys(i))TMe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function PMe(t,e){if(e&&typeof e!="object")return{error:le};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:m='"',columnJoiner:h=",",rowJoiner:f=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof h!="string"||typeof f!="string"||typeof g!="string"||typeof m!="string")return{error:le};i=Object.assign({},...Object.keys(i).reverse().map(A=>({[A]:Array.isArray(i[A])?i[A]:[typeof i[A]=="string"&&i[A]].filter(Boolean)})));let v=t.filter(Boolean).map(A=>aB(A,g)),y=Object.values(i).flat();r&&l.push(...y);let I=v.reduce((A,M)=>Object.keys(M).every(C=>!A.includes(C)&&A.push(C)||!0)&&A,[]).filter(A=>!(l!=null&&l.length)||l.includes(A)),b=Object.assign({},...Object.keys(i).reverse().map(A=>i[A].map(M=>({[M]:A})).flat()).flat()),S=(A,M)=>e!=null&&e.sortOrder?e.sortOrder.includes(A)&&e.sortOrder.includes(M)&&e.sortOrder.indexOf(A)-e.sortOrder.indexOf(M)||!e.sortOrder.includes(M)&&-1:0,w=I.reduce((A,M)=>{let C=b[M];return C?A.includes(C)||A.push(C):A.push(M),A},[]).sort(S);Object.keys(c).forEach(A=>!w.includes(A)&&w.unshift(A)),Object.keys(i).forEach(A=>!w.includes(A)&&w.unshift(A)),typeof p=="object"&&Object.keys(p).forEach(A=>!w.includes(A)&&w.unshift(A));let U=w.map(A=>c[A]||A);if(s)return[U];let T=A=>`${m}${A}${m}`,D=[],P=A=>Object.values(w.reduce((M,C,O)=>{var k;let x=i[C],F=(x!=null&&x.length?A[x.find(L=>A[L])]:A[C])||(p==null?void 0:p[C])||"",$=((k=d[C])==null?void 0:k[F])||F,_=fa(u[C])?u[C]($):$;return M[C]=T(_),_&&(D[O]=(D[O]||0)+1),M},{})),E=v.map(P),R=o&&[...D].map((A,M)=>!A&&M).filter(xi).reverse();if(R){let A=M=>M.filter((C,O)=>!R.includes(O));E=E.map(A),U=A(U)}let N=E.map(A=>A.join(h));return a?N.map(A=>{let M=A.split(h);return Object.assign({},...M.map((C,O)=>({[U[O]]:C})))}):n?[U.map(T).join(h),...N].join(f):N.join(f)}function aB(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,aB(t[n],e,i.concat(n))),{})}var{FACTORY:gj}=dJ;function RMe({tournamentRecord:t,value:e}){let{extension:i}=It({element:t,name:gj}),r={name:gj,value:{...i==null?void 0:i.value,...e}};_t({element:t,extension:r})}function Pre({timeStamp:t}){let e=Ph(),i=gF();return i&&Object.values(e).forEach(r=>{RMe({tournamentRecord:r,value:{version:tP(),timeStamp:t}})}),i}function Rre({engineType:t,methodName:e,elapsed:i,params:r,result:n}){var a,o;let s=Ga();if(typeof s!="object")return;let l={method:e},u=(n==null?void 0:n.error)&&(s.errors===!0||Array.isArray(s.errors)&&s.errors.includes(e)),c=Array.isArray(s.params)&&((a=s.params)==null?void 0:a.includes(e)),d=s.params&&!Array.isArray(s.params)||c,p=Array.isArray(s.exclude)&&s.exclude.includes(e);!p&&![void 0,!1].includes(s.perf)&&!isNaN(s.perf)&&i>=s.perf&&(l.elapsed=i),!p&&(u||d)&&(l.params=r),!p&&(u||s.result&&!Array.isArray(s.result)&&(!Array.isArray(s.params)||c)||Array.isArray(s.result)&&(o=s.result)!=null&&o.includes(e))&&(l.result=n),Object.keys(l).length>1&&Q9(l,t)}function oB({methodName:t,params:e,start:i}){let r={error:fP,methodName:t},n=i?Date.now()-i:0;return Rre({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function EMe(t,e){var i;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:ve};let r=e.drawId||((i=e.matchUp)==null?void 0:i.drawId);if(r){let{event:o,drawDefinition:s,tournamentId:l}=Kn({tournamentRecords:t,drawId:r});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),o&&(e.event=o)}if(e.eventId&&!e.event){let{event:o,tournamentId:s}=Kn({eventId:e.eventId,tournamentRecords:t});if(!o)return{error:fo};e.tournamentId=s,e.event=o}let n=e.tournamentId??Dh();if(!n&&e)return e;let a=t[n];return n&&!a?{error:ve}:(a&&(e.tournamentRecord=a),e)}function sB(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),o=Dh();i&&(i.activeTournamentId=o);let s=(i==null?void 0:i.tournamentRecord)||IF(o),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||Ph(),u=i?Me(i,void 0,!0):void 0,c=i?EMe(l,i):void 0;if(c!=null&&c.error)return c;let d=CMe({params:c,tournamentRecords:l,tournamentRecord:s,methodName:r,method:e}),p=Date.now()-a;return Rre({result:d,methodName:r,elapsed:p,params:u,engineType:n}),d}function CMe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(Ga())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return yP({engineName:"engine",methodName:r,params:i,err:a})}}function aE(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=Do();for(let o of[...a].sort(MMe)){let s=K9({topic:o});s!=null&&s.length&&pM({topic:o,notices:s})}e&&n&&a.includes(yM)&&pM({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:yM})}var vj={[sL]:5,[oL]:5,[lL]:5,[aL]:5,[nL]:5,[iL]:5,[RJ]:5,[EJ]:5,[rL]:1,[$P]:1,[on]:5,[Ep]:5,[tL]:4,[QF]:4,[ZF]:4,[eL]:4,[_P]:3,[YF]:2};function MMe(t,e){return(vj[e]||0)-(vj[t]||0)}function NMe({convertExtensions:t,removeExtensions:e}){let i=Ph();return{tournamentId:Dh(),tournamentRecords:Me(i,t,!1,e)}}function AMe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=(t==null?void 0:t.tournamentId)??Dh();if(typeof r!="string")return{};let n=IF(r);return{tournamentRecord:Me(n,e,!1,i)}}function OMe(){var t;let e=Ph(),{extension:i}=It({name:Qd,tournamentRecords:e,discover:!0}),r=((t=i==null?void 0:i.value)==null?void 0:t.tournamentIds)||[];return Object.keys(e).forEach(n=>{r.includes(n)||delete e[n]}),IP(e)}function Ij(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Zu}:t!=null&&t.tournamentId?J9(e?Me(t):t):{error:le}}function Dy(t,e=!0){if(typeof t!="object")return{error:Zu};if(ty(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:nM};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},ty(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:nM};return IP(e?Me(t):t)}function kMe(t,e,i,r,n,a){let o=Z9(i,r,n,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(l=>fa(s[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:s[l],...u});if(Ga())return c();try{return c()}catch(d){yP({engineName:"engine",methodName:l,params:u,err:d})}}}),{...Q,...t}}function af(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function Ere(t,e){t.importMethods=(i,r,n,a)=>kMe(t,e,i,r,n,a),t.getTournament=i=>AMe(i),t.getState=i=>NMe({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>tP(),t.reset=()=>(IP({}),af(t)),t.devContext=i=>(ZI(i),af(t)),t.getDevContext=i=>Ga(i),t.newTournamentRecord=(i={})=>{let r=eE(i),n=r.tournamentId;return r.error?r:(Ij(r),ty(n),{...Q,tournamentId:n})},t.setState=(i,r,n)=>{ey(r,n);let a=Dy(i,r);return af(t,a)},t.setTournamentId=i=>ty(i),t.getTournamentId=()=>Dh(),t.setTournamentRecord=(i,r,n)=>{ey(r,n);let a=Ij(i,r);return af(t,a)},t.removeTournamentRecord=i=>{let r=X9(i);return af(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=OMe();return af(t,i)}}function xMe(t,e,i){if(!Array.isArray(e))return{error:le,message:"directives must be an array"};let r=Y9(),n=Date.now(),a=i&&Me(Ph(),!1,!0),o=[];for(let u of e){if(typeof u!="object")return{error:le,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:le,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!r[c])return oB({methodName:c,start:n,params:p});if(d){let h=o[o.length-1],f=Object.keys(d);for(let g of f)h[g]&&(p[g]=h[g])}let m=sB(t,r[c],p,c,"sync");if(m!=null&&m.error)return a&&Dy(a),{...m,rolledBack:!!a};o.push({...m,methodName:c})}let s=Date.now(),l=Pre({timeStamp:s});return aE({directives:e,mutationStatus:l,timeStamp:s}),tw(),{success:o.every(u=>u.success),results:o}}function yj(t,e){if(!At(e))return{error:le,message:"args must be an object"};let i=Object.values(e).filter(fa).length;if(i>1)return{message:"there must be only one arg with typeof function",error:le};let r=i?Object.keys(e).find(m=>fa(e[m])):Pi(e.method)&&e.method;if(!r)return{error:fP};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&Me(Ph(),!1,!0),l=n||t[r]||hF()[r];if(!l)return oB({methodName:r,params:o});let u=sB(t,l,o,r,"sync")??{};u!=null&&u.error&&s&&Dy(s);let c=Date.now(),d=Pre({timeStamp:c}),p=(u==null?void 0:u.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&aE({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:c}),(p||!(u!=null&&u.success)||o!=null&&o.doNotNotify)&&tw(),u}var FMe=(()=>{let t={executionQueue:(e,i)=>xMe(t,e,i),execute:e=>yj(t,e)};return Ere(t,yj),t})(),lB=FMe;function bj(t,e){if(!At(e))return{error:le,message:"args must be an object"};let i=Object.values(e).filter(fa).length;if(i>1)return{message:"there must be only one arg with typeof function",error:le};let r=i?Object.keys(e).find(l=>fa(e[l])):Pi(e.method)&&e.method;if(!r)return{error:fP};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=n||t[r]||hF()[r];return s?sB(t,s,o,r,"ask"):oB({methodName:r,params:o})}(()=>{let t={execute:e=>bj(t,e)};return Ere(t,bj),t})();var Im={},gc;function wj(t,e=!0){if(!t)return{error:Qe};if(typeof t!="object")return{error:Zu};if(t.matchUpId)gc=t.matchUpId,Im[gc]=e?Me(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(Im[i.matchUpId]=e?Me(i):i,gc||(gc=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(Im[i.matchUpId]=e?Me(i):i,gc||(gc=i.matchUpId));return e?Me(t):t}function LMe(){return Im[gc]}function _Me(){return Object.values(Im)}function $Me(){gc=void 0,Im={}}function BMe(t){return Me(Im[gc],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}(()=>{let t={getState:n=>BMe(n),version:()=>tP(),reset:()=>($Me(),{...Q}),drawId:void 0,error:void 0,success:!1,devContext:n=>(ZI(n),t),setState:(n,a,o)=>{ey(a,o);let s=wj(n);return e(s)}};function e(n){return n!=null&&n.error?(t.error=n.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=n.drawId),t}return i([w_]),t;function i(n){n.forEach(a=>{Object.keys(a).forEach(o=>{t[o]=s=>{if(Ga())return r({params:s,governor:a,methodName:o});try{return r({params:s,governor:a,methodName:o})}catch(l){yP({engineName:"matchUpEngine",methodName:o,params:s,err:l})}}})})}function r({params:n,governor:a,methodName:o}){t.error=void 0,t.success=!1;let s=(n==null?void 0:n.matchUp)||LMe(),l=(n==null?void 0:n.matchUps)||_Me(),u=(n==null?void 0:n.rollbackOnError)&&Me(s,!1,!0);n={...n,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let c=a[o](n);if(c!=null&&c.error)return u&&wj(u),{...c,rolledBack:!!u};let d=(c==null?void 0:c.success)&&(n==null?void 0:n.delayNotify)!==!0&&(n==null?void 0:n.doNotNotify)!==!0;return d&&aE(),(d||!(c!=null&&c.success)||n!=null&&n.doNotNotify)&&tw(),c}})();var iC=!1;(()=>{let t={version:()=>tP(),setDeepCopy:(r,n)=>(ey(r,n),t),devContext:r=>(ZI(r),iC=!0,t)};return i([F$]),t;function e(r,n){let a=r({...n});return a!=null&&a.error||aE(),tw(),iC&&(ZI(!1),iC=!1),a}function i(r){r.forEach(n=>{Object.keys(n).forEach(a=>{t[a]=o=>{if(Ga()){let s=e(n[a],o);return!(s!=null&&s.error)&&o!=null&&o.setState&&s!=null&&s.tournamentRecord&&Dy(s.tournamentRecord),s}else try{let s=e(n[a],o);return!(s!=null&&s.error)&&o!=null&&o.setState&&s!=null&&s.tournamentRecord&&Dy(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(o),method:a,error:l})}}})})}})();lB.importMethods(wK,!0,1);var Cre=lB,VMe={getTournamentPoints:PR},jMe=VMe,GMe={calculateNewRatings:iZ,generateDynamicRatings:rZ},HMe=GMe,zMe={...jMe,...HMe};lB.importMethods(zMe);var WMe={[cy]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},qMe={[Fu]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[hm,cI]}},YMe={[Fu]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[hm,vy,Gm],disabledActions:[]}]}},KMe={[Fu]:{policyName:"positionActionsDisabled",enabledStructures:!1}},JMe={[yv]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},XMe={[vo]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:Yo,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[Ne]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[ca]:[],[Sl]:[],[Pt]:[],[Ma]:[],[zr]:[],[Ft]:[]}}},rC="Personal circumstance",QMe={[vo]:{requireAllPositionsAssigned:!1,stage:{[Ne]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Yo,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Yo,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[ca]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[Sl]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[Ma]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[Pt]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[Ft]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:rC,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[zr]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:rC,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[Ql]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:rC,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},ZMe={[ko]:{seedingProfile:{positioning:SP},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},eNe={POLICY_AVOIDANCE_COUNTRY:WMe,POLICY_POSITION_ACTIONS_DEFAULT:_Q,POLICY_POSITION_ACTIONS_DISABLED:KMe,POLICY_POSITION_ACTIONS_NO_MOVEMENT:YMe,POLICY_POSITION_ACTIONS_UNRESTRICTED:qMe,POLICY_PRIVACY_DEFAULT:JMe,POLICY_ROUND_NAMING_DEFAULT:vL,POLICY_SCHEDULING_DEFAULT:wee,POLICY_SCORING_DEFAULT:XMe,POLICY_SCORING_USTA:QMe,POLICY_SEEDING_ITF:ZMe,POLICY_SEEDING_DEFAULT:ree},tNe={ratingsParameters:Tr,matchUpFormats:sSe,countryToFlag:xJ,tieFormats:Fee,countries:bc,policies:eNe,flagIOC:o0e},iNe={};wt(iNe,{activeMatchUpStatuses:()=>qF,auditConstants:()=>rCe,completedMatchUpStatuses:()=>yr,directingMatchUpStatuses:()=>wJ,displayConstants:()=>OEe,drawDefinitionConstants:()=>X8,entryStatusConstants:()=>f0e,errorConditionConstants:()=>sUe,eventConstants:()=>mSe,extensionConstants:()=>dJ,flightConstants:()=>wCe,genderConstants:()=>yF,keyValueConstants:()=>aRe,matchUpActionConstants:()=>vPe,matchUpStatusConstants:()=>TJ,matchUpTypes:()=>Nwe,nonDirectingMatchUpStatuses:()=>UJ,particicipantsRequiredMatchUpStatuses:()=>yJ,participantConstants:()=>a0e,participantRoles:()=>ML,participantTypes:()=>oI,penaltyConstants:()=>bNe,policyConstants:()=>jSe,positionActionConstants:()=>MDe,ratingConstants:()=>zDe,recoveryTimeRequiredMatchUpStatuses:()=>e0e,requestConstants:()=>u1e,resourceContants:()=>eSe,resultConstants:()=>zwe,scaleConstants:()=>_Se,scheduleConstants:()=>V0e,sortingConstants:()=>CCe,surfaceConstants:()=>PNe,tieFormatConstants:()=>lSe,timeItemConstants:()=>_0e,topicConstants:()=>i0e,tournamentConstants:()=>ore,upcomingMatchUpStatuses:()=>SJ,validMatchUpStatuses:()=>bJ,venueConstants:()=>CNe,weekdayConstants:()=>jee});var rNe="Coaching",nNe="Ball Abuse",aNe="Racket Abuse",oNe="Verbal Abuse",sNe="INELIGIBILITY",lNe="Physical Abuse",uNe="Unsportmanlike Conduct",cNe="Dress Code Violation",dNe="Equipment Violation",pNe="Leaving the court",mNe="Failure to complete",hNe="No Show",fNe="Other",gNe="REFUSAL_TO_PLAY",vNe="PROHIBITED_SUBSTANCE",INe="Puncuality",yNe="Failure to sign in",bNe={COACHING:rNe,BALL_ABUSE:nNe,RACKET_ABUSE:aNe,VERBAL_ABUSE:oNe,PHYSICAL_ABUSE:lNe,INELIGIBILITY:sNe,UNSPORTSMANLIKE_CONDUCT:uNe,PROHIBITED_SUBSTANCE:vNe,DRESS_CODE_VIOLATION:cNe,EQUIMENT_VIOLATION:dNe,LEAVING_THE_COURT:pNe,REFUSAL_TO_PLAY:gNe,FAILURE_TO_COMPLETE:mNe,NO_SHOW:hNe,OTHER:fNe,PUNCTUALITY:INe,FAILUIRE_TO_SIGN_IN:yNe},wNe="CLAY",UNe="HARD",SNe="GRASS",TNe="CARPET",DNe="ARTIFICIAL",PNe={CLAY:wNe,HARD:UNe,GRASS:SNe,CARPET:TNe,ARTIFICIAL:DNe},RNe="INDOOR",ENe="OUTDOOR",CNe={INDOOR:RNe,OUTDOOR:ENe};const MNe=Yt({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function NNe({matchUp:t,individualParticipant:e,spacer:i}){var r,n,a;const o=((r=e==null?void 0:e.person)==null?void 0:r.iso2NationalityCode)||"",s=o?(n=tNe.countryToFlag(o))==null?void 0:n.slice(0,4):"",l=document.createElement("span"),u=(a=t==null?void 0:t.matchUpType)==null?void 0:a.toLowerCase();return i||(l.className=MNe({variant:u})),l.innerHTML=i?"":s,l}function nC({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n,side:a,type:o}){if(o==="scale")return Cwe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n});const s=(e==null?void 0:e.configuration)||{},l=document.createElement("div");return o==="flag"&&s.flags&&NNe({className:i,matchUp:r,individualParticipant:t,spacer:n})||o==="seeding"&&Rwe({className:i,composition:e,matchUp:r,side:a})||l}const ANe="Qualifier",ONe="BYE",kNe="TBD";function Uj(t){var e,i,r,n;const{isWinningSide:a,side:o,sideNumber:s,individualParticipant:l,matchUp:u,composition:c}=t||{},d=a?"winner":void 0,p=t.eventHandlers||{},m=c==null?void 0:c.configuration,h={QUALIFIER:((e=m==null?void 0:m.placeHolders)==null?void 0:e.qualifier)||ANe,BYE:((i=m==null?void 0:m.placeHolders)==null?void 0:i.bye)||ONe,TBD:((r=m==null?void 0:m.placeHolders)==null?void 0:r.tbd)||kNe},f=l==null?void 0:l.participantName,g=U=>{ws(p==null?void 0:p.participantClick)&&(U.stopPropagation(),p.participantClick({individualParticipant:l,pointerEvent:U,matchUp:u,side:o}))},v=document.createElement("div");v.classList.add("tmx-i"),v.setAttribute("sideNumber",s),v.setAttribute("id",l==null?void 0:l.participantId),v.onclick=g;const y=document.createElement("div");y.className=swe({variant:d});const I=(m==null?void 0:m.flags)&&nC({...t,type:"flag"});if(I)y.appendChild(I);else{const U=nC({type:"scale",...t});U&&y.appendChild(U)}const b=document.createElement("div");if(b.className=lwe({variant:d}),f){const U=document.createElement("span");if(a&&m!=null&&m.winnerColor)U.style.color=typeof m.winnerColor=="string"?m.winnerColor:"green";else if(m!=null&&m.genderColor){const T=(n=l==null?void 0:l.person)==null?void 0:n.sex,D=T==="MALE"&&"#2E86C1"||T==="FEMALE"&&"#AA336A"||"";U.style.color=typeof m.genderColor=="string"?m.genderColor:D}U.innerHTML=f,b.appendChild(U)}else{const U=document.createElement("abbr");U.className=owe({variant:m.showAddress?"showAddress":""}),U.innerHTML=(o==null?void 0:o.bye)&&h.BYE||(o==null?void 0:o.qualifier)&&h.QUALIFIER||h.TBD,b.appendChild(U)}const S=nC({...t,className:Pwe(),type:"seeding"});S&&b.appendChild(S),y.appendChild(b),v.appendChild(y);const w=Dwe(t);return v.appendChild(w),{element:v}}const xNe=Yt({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{defaulted:{backgroundColor:"#df164c"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}});function FNe({matchUpStatus:t}){const e=t==null?void 0:t.toLowerCase(),i=["WALKOVER","DOUBLE_WALKOVER"].includes(t)?"WO":(t==null?void 0:t.slice(0,3))||"",r=document.createElement("div");r.className=xNe({variant:e});const n=document.createElement("abbr");return n.setAttribute("title",t),n.style.textDecoration="none",n.style.borderBottom="none",n.innerHTML=i,r.appendChild(n),r}function LNe(t){return t instanceof Element||t}const _Ne=Yt({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});function $Ne({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=_Ne(),e}const BNe=Yt({flexDirection:"column",position:"relative",display:"flex"}),VNe=Yt({alignItems:"stretch",display:"flex"}),jNe=Yt({marginInlineEnd:".25rem",color:"green"});function GNe({dim:t="20px"}={}){const e=jNe();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}function Mre({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:r,participant:n,placeholder:a,sideNumber:o,matchUp:s}){var l,u,c;const{winningSide:d,matchUpType:p,isRoundRobin:m,matchUpStatus:h}=s||{},f=r==null?void 0:r.configuration;let g;const v=o?(l=s==null?void 0:s.sides)==null?void 0:l.find(A=>A.sideNumber===o):void 0;n||(n=v==null?void 0:v.participant,g=f!=null&&f.allDrawPositions||f!=null&&f.drawPositions&&v!=null&&v.drawPosition&&((s==null?void 0:s.roundNumber)===t||v!=null&&v.participantFed||m)?v==null?void 0:v.drawPosition:"");const y=p==="DOUBLES",I=y?(u=n==null?void 0:n.individualParticipants)==null?void 0:u[0]:n,b=y&&((c=n==null?void 0:n.individualParticipants)==null?void 0:c[1]),S=o===d||h==="BYE"&&n,w=(f==null?void 0:f.winnerChevron)&&S,U=f==null?void 0:f.teamLogo,T=["RETIRED","DOUBLE_WALKOVER","WALKOVER","DEFAULTED"].includes(h)&&!S,D=f==null?void 0:f.gameScoreOnly,P=document.createElement("div");if(P.className=i&&cwe({drawPosition:g,sideNumber:o}),P.classList.add("tmx-p"),P.setAttribute("id",n==null?void 0:n.participantId),U){const A=$Ne({teamLogo:U});P.appendChild(A)}const E=document.createElement("div");E.className=uwe({variant:y?"doubles":"singles"});const R=document.createElement("div");R.className=dwe({winnerChevron:w,isDoubles:y});const N=Uj({individualParticipant:I,eventHandlers:e,isWinningSide:S,composition:r,sideNumber:o,matchUp:s,side:v}).element;if(R.appendChild(N),b){const A=Uj({individualParticipant:b,eventHandlers:e,isWinningSide:S,composition:r,sideNumber:o,matchUp:s,side:v}).element;R.appendChild(A)}else y&&a&&LNe(a)&&R.appendChild(a);if(E.appendChild(R),P.appendChild(E),i){const A=document.createElement("div");if(S&&!D){const M=GNe();typeof M=="string"?A.innerHTML=M:A.appendChild(M)}else if(T){const M=FNe({matchUpStatus:h});A.appendChild(M)}P.appendChild(A)}return P}const HNe=Yt({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",height:"1.5em"});function zNe({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:r,context:n}){var a;const o=document.createElement("div");o.className=HNe(),o.classList.add("tmx-rh"),o.setAttribute("roundNumber",r);const s=ws(t==null?void 0:t.roundHeaderClick);s&&(o.onclick=d=>t.roundHeaderClick({roundNumber:r,roundProfile:i,roundMatchUps:e,context:n,pointerEvent:d}));const l=s?"⋮":"",u=(a=i==null?void 0:i[r])==null?void 0:a.roundName,c=u&&` <div style="display: flex; flex-direction: row; justify-content: space-between">
        <div>${u}</div>
        <div style="font-weight: bold">${l}</div>
      </div>
  `;return o.innerHTML=c||"",o}const Nre=Yt({flexDirection:"column",display:"flex"}),WNe=Yt({flexDirection:"row",display:"flex"}),Are=Yt({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),qNe=Yt({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),YNe=Yt({fontWeight:"bold",color:"blue",height:"1em"}),Sj=Yt({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),KNe=Yt({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});function JNe(){return Yt({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0})}const XNe=Yt({});function QNe({configuration:t}){const e={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(t!=null&&t.matchUpHover){const i=typeof t.matchUpHover=="string"?t.matchUpHover:"cyan";e["&:hover"]={backgroundColor:i}}else e["&:hover"]={borderColor:"$borderHover"};return Yt(e)}function ZNe({variant:t}){return Yt({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:t})}const eAe=Yt({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),tAe=Yt({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),Tj=Yt({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function iAe({eventHandlers:t,entryStatus:e,sideNumber:i,className:r,matchUp:n}){const a=document.createElement("div");ws(t==null?void 0:t.centerInfoClick)&&(a.onclick=c=>t.centerInfoClick({matchUp:n,sideNumber:i,pointerEvent:c})),a.className=Up(ZNe({variant:i}),r),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",i);const o=document.createElement("div");o.className=eAe();const s=document.createElement("div");s.className=tAe();const l=document.createElement("div");l.className=Tj(),l.innerHTML=e?"Entry status:&nbsp;":"",s.appendChild(l);const u=document.createElement("div");return u.className=Tj(),u.innerHTML=e||"",s.appendChild(u),o.appendChild(s),a.appendChild(o),{element:a}}const pI={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};function rAe({composition:t,isDoubles:e,roundFactor:i=1}){const r=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),n=(t==null?void 0:t.configuration)||{},a=(n==null?void 0:n.connectorWidth)||16,o=n.centerInfo?pI.centerInfo*r:0,s=n.scheduleInfo?pI.scheduleInfo*r:0,l=(60+(n.showAddress?r:0))*(e?1.3:1)+o,u=l*i,c=(l+s)*i;return Yt({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:u,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:c}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}const Ore=t=>Yt({display:"flex",alignItems:"center",height:t,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),nAe=Yt({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),kre=Yt({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),aAe=Yt({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function oAe({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=kre(),e.value=t,e}function sAe({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:r}){const n=r===(i==null?void 0:i.winningSide)||i!=null&&i.winningSide?"loser":void 0,a=r===2?i.side2Score:i.side1Score,o=i.side2TiebreakScore||i.side1TiebreakScore,s=r===2?i.side2TiebreakScore:i.side1TiebreakScore,l=a===void 0&&s,u=l||a,c=e&&i.setNumber%2?"lightgray":"transparent",d=i.editing?i.editing===r:void 0;let p;if(d)p=oAe({value:u});else if(p=document.createElement("p"),p.className=kre({variant:n}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=c,p.innerHTML=isNaN(u)?"":u,!t){const m=document.createElement("span");m.className=nAe(),m.innerHTML=o&&!l?s:"",p.appendChild(m)}return p}function lAe({participantHeight:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:n}){var a,o,s,l;const u=(a=i==null?void 0:i.configuration)==null?void 0:a.winnerChevron,c=(o=i==null?void 0:i.configuration)==null?void 0:o.gameScoreOnly,d=((s=n==null?void 0:n.score)==null?void 0:s.sets)||[],p=(l=i==null?void 0:i.configuration)==null?void 0:l.scoreBox,m=r===2?t:t-1,h=Ore(m),f=y=>{ws(e==null?void 0:e.scoreClick)&&(y.stopPropagation(),e.scoreClick({pointerEvent:y,matchUp:n}))},g=document.createElement("div");g.className=h({sideNumber:!p&&r,fontSize:"5px"}),g.classList.add("sideScore"),g.classList.add("tmx-scr"),g.onclick=f;const v=document.createElement("div");v.className=aAe();for(const y of d||[]){const I=sAe({gameScoreOnly:c,scoreStripes:u,sideNumber:r,set:y});v.appendChild(I)}return g.appendChild(v),g}const uAe=Yt({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var xre={exports:{}};(function(t,e){(function(i,r){t.exports=r()})(pwe,function(){var i=1e3,r=6e4,n=36e5,a="millisecond",o="second",s="minute",l="hour",u="day",c="week",d="month",p="quarter",m="year",h="date",f="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(A){var M=["th","st","nd","rd"],C=A%100;return"["+A+(M[(C-20)%10]||M[C]||M[0])+"]"}},I=function(A,M,C){var O=String(A);return!O||O.length>=M?A:""+Array(M+1-O.length).join(C)+A},b={s:I,z:function(A){var M=-A.utcOffset(),C=Math.abs(M),O=Math.floor(C/60),k=C%60;return(M<=0?"+":"-")+I(O,2,"0")+":"+I(k,2,"0")},m:function A(M,C){if(M.date()<C.date())return-A(C,M);var O=12*(C.year()-M.year())+(C.month()-M.month()),k=M.clone().add(O,d),x=C-k<0,F=M.clone().add(O+(x?-1:1),d);return+(-(O+(C-k)/(x?k-F:F-k))||0)},a:function(A){return A<0?Math.ceil(A)||0:Math.floor(A)},p:function(A){return{M:d,y:m,w:c,d:u,D:h,h:l,m:s,s:o,ms:a,Q:p}[A]||String(A||"").toLowerCase().replace(/s$/,"")},u:function(A){return A===void 0}},S="en",w={};w[S]=y;var U="$isDayjsObject",T=function(A){return A instanceof R||!(!A||!A[U])},D=function A(M,C,O){var k;if(!M)return S;if(typeof M=="string"){var x=M.toLowerCase();w[x]&&(k=x),C&&(w[x]=C,k=x);var F=M.split("-");if(!k&&F.length>1)return A(F[0])}else{var $=M.name;w[$]=M,k=$}return!O&&k&&(S=k),k||!O&&S},P=function(A,M){if(T(A))return A.clone();var C=typeof M=="object"?M:{};return C.date=A,C.args=arguments,new R(C)},E=b;E.l=D,E.i=T,E.w=function(A,M){return P(A,{locale:M.$L,utc:M.$u,x:M.$x,$offset:M.$offset})};var R=function(){function A(C){this.$L=D(C.locale,null,!0),this.parse(C),this.$x=this.$x||C.x||{},this[U]=!0}var M=A.prototype;return M.parse=function(C){this.$d=function(O){var k=O.date,x=O.utc;if(k===null)return new Date(NaN);if(E.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var F=k.match(g);if(F){var $=F[2]-1||0,_=(F[7]||"0").substring(0,3);return x?new Date(Date.UTC(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)):new Date(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)}}return new Date(k)}(C),this.init()},M.init=function(){var C=this.$d;this.$y=C.getFullYear(),this.$M=C.getMonth(),this.$D=C.getDate(),this.$W=C.getDay(),this.$H=C.getHours(),this.$m=C.getMinutes(),this.$s=C.getSeconds(),this.$ms=C.getMilliseconds()},M.$utils=function(){return E},M.isValid=function(){return this.$d.toString()!==f},M.isSame=function(C,O){var k=P(C);return this.startOf(O)<=k&&k<=this.endOf(O)},M.isAfter=function(C,O){return P(C)<this.startOf(O)},M.isBefore=function(C,O){return this.endOf(O)<P(C)},M.$g=function(C,O,k){return E.u(C)?this[O]:this.set(k,C)},M.unix=function(){return Math.floor(this.valueOf()/1e3)},M.valueOf=function(){return this.$d.getTime()},M.startOf=function(C,O){var k=this,x=!!E.u(O)||O,F=E.p(C),$=function(W,q){var Y=E.w(k.$u?Date.UTC(k.$y,q,W):new Date(k.$y,q,W),k);return x?Y:Y.endOf(u)},_=function(W,q){return E.w(k.toDate()[W].apply(k.toDate("s"),(x?[0,0,0,0]:[23,59,59,999]).slice(q)),k)},L=this.$W,B=this.$M,V=this.$D,G="set"+(this.$u?"UTC":"");switch(F){case m:return x?$(1,0):$(31,11);case d:return x?$(1,B):$(0,B+1);case c:var j=this.$locale().weekStart||0,z=(L<j?L+7:L)-j;return $(x?V-z:V+(6-z),B);case u:case h:return _(G+"Hours",0);case l:return _(G+"Minutes",1);case s:return _(G+"Seconds",2);case o:return _(G+"Milliseconds",3);default:return this.clone()}},M.endOf=function(C){return this.startOf(C,!1)},M.$set=function(C,O){var k,x=E.p(C),F="set"+(this.$u?"UTC":""),$=(k={},k[u]=F+"Date",k[h]=F+"Date",k[d]=F+"Month",k[m]=F+"FullYear",k[l]=F+"Hours",k[s]=F+"Minutes",k[o]=F+"Seconds",k[a]=F+"Milliseconds",k)[x],_=x===u?this.$D+(O-this.$W):O;if(x===d||x===m){var L=this.clone().set(h,1);L.$d[$](_),L.init(),this.$d=L.set(h,Math.min(this.$D,L.daysInMonth())).$d}else $&&this.$d[$](_);return this.init(),this},M.set=function(C,O){return this.clone().$set(C,O)},M.get=function(C){return this[E.p(C)]()},M.add=function(C,O){var k,x=this;C=Number(C);var F=E.p(O),$=function(B){var V=P(x);return E.w(V.date(V.date()+Math.round(B*C)),x)};if(F===d)return this.set(d,this.$M+C);if(F===m)return this.set(m,this.$y+C);if(F===u)return $(1);if(F===c)return $(7);var _=(k={},k[s]=r,k[l]=n,k[o]=i,k)[F]||1,L=this.$d.getTime()+C*_;return E.w(L,this)},M.subtract=function(C,O){return this.add(-1*C,O)},M.format=function(C){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||f;var x=C||"YYYY-MM-DDTHH:mm:ssZ",F=E.z(this),$=this.$H,_=this.$m,L=this.$M,B=k.weekdays,V=k.months,G=k.meridiem,j=function(q,Y,re,J){return q&&(q[Y]||q(O,x))||re[Y].slice(0,J)},z=function(q){return E.s($%12||12,q,"0")},W=G||function(q,Y,re){var J=q<12?"AM":"PM";return re?J.toLowerCase():J};return x.replace(v,function(q,Y){return Y||function(re){switch(re){case"YY":return String(O.$y).slice(-2);case"YYYY":return E.s(O.$y,4,"0");case"M":return L+1;case"MM":return E.s(L+1,2,"0");case"MMM":return j(k.monthsShort,L,V,3);case"MMMM":return j(V,L);case"D":return O.$D;case"DD":return E.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return j(k.weekdaysMin,O.$W,B,2);case"ddd":return j(k.weekdaysShort,O.$W,B,3);case"dddd":return B[O.$W];case"H":return String($);case"HH":return E.s($,2,"0");case"h":return z(1);case"hh":return z(2);case"a":return W($,_,!0);case"A":return W($,_,!1);case"m":return String(_);case"mm":return E.s(_,2,"0");case"s":return String(O.$s);case"ss":return E.s(O.$s,2,"0");case"SSS":return E.s(O.$ms,3,"0");case"Z":return F}return null}(q)||F.replace(":","")})},M.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},M.diff=function(C,O,k){var x,F=this,$=E.p(O),_=P(C),L=(_.utcOffset()-this.utcOffset())*r,B=this-_,V=function(){return E.m(F,_)};switch($){case m:x=V()/12;break;case d:x=V();break;case p:x=V()/3;break;case c:x=(B-L)/6048e5;break;case u:x=(B-L)/864e5;break;case l:x=B/n;break;case s:x=B/r;break;case o:x=B/i;break;default:x=B}return k?x:E.a(x)},M.daysInMonth=function(){return this.endOf(d).$D},M.$locale=function(){return w[this.$L]},M.locale=function(C,O){if(!C)return this.$L;var k=this.clone(),x=D(C,O,!0);return x&&(k.$L=x),k},M.clone=function(){return E.w(this.$d,this)},M.toDate=function(){return new Date(this.valueOf())},M.toJSON=function(){return this.isValid()?this.toISOString():null},M.toISOString=function(){return this.$d.toISOString()},M.toString=function(){return this.$d.toUTCString()},A}(),N=R.prototype;return P.prototype=N,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",u],["$M",d],["$y",m],["$D",h]].forEach(function(A){N[A[1]]=function(M){return this.$g(M,A[0],A[1])}}),P.extend=function(A,M){return A.$i||(A(M,R,P),A.$i=!0),P},P.locale=D,P.isDayjs=T,P.unix=function(A){return P(1e3*A)},P.en=w[S],P.Ls=w,P.p={},P})})(xre);var cAe=xre.exports;const dAe=yK(cAe);function pAe({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:r,venueAbbreviation:n,courtName:a}=(t==null?void 0:t.schedule)||{},{dateTime:{extractDate:o,extractTime:s}}=nB,l=s(i);let u=o(r),c="ddd D MMMM";l&&(c+=", hh:mm A",u+=`T${l}`);const d=r?dAe(u).format(c):"Not scheduled",p=n&&(a==null?void 0:a.toString().startsWith(n))&&a||n&&a&&`${n} ${a}`||a||n||"",m=document.createElement("div");m.className=uAe(),m.classList.add("tmx-sch"),ws(e==null?void 0:e.scheduleClick)&&(m.onclick=y=>e.scheduleClick({matchUp:t,pointerEvent:y}));const h=document.createElement("div");h.innerHTML=d,m.append(h);const f=y=>{ws(e==null?void 0:e.venueClick)&&(y.stopPropagation(),e.venueClick({pointerEvent:y,matchUp:t}))},g=document.createElement("div");g.style="display: flex; flex-direction: row";const v=document.createElement("div");if(v.style.paddingRight=".2rem",v.onclick=f,v.innerHTML=p,g.append(v),m.append(g),m.onclick){const y=document.createElement("div");y.innerHTML="⋮",g.append(y)}return m}function Dj({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:r,className:n,matchUp:a}){var o,s;const l=(i==null?void 0:i.configuration)||{},u=l==null?void 0:l.scheduleInfo,c=(o=a==null?void 0:a.score)==null?void 0:o.scoreStringSide1,d=((s=i==null?void 0:i.configuration)==null?void 0:s.scoreBox)&&c,p=(a==null?void 0:a.readyToScore)&&(e==null?void 0:e.scoreClick)&&!Cre.checkScoreHasValue({matchUp:a}),m=document.createElement("div");if(m.className=Up(BNe(),n),m.classList.add("tmx-sd"),m.setAttribute("sideNumber",r),u&&r===1){const g=pAe({matchUp:a,eventHandlers:e});m.appendChild(g)}const h=document.createElement("div");h.className=VNe();const f=Mre({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:a});if(h.appendChild(f),d){const g=document.createElement("div");g.style.border="1px solid lightgray",h.appendChild(g)}if(c){const g=lAe({eventHandlers:e,composition:i,sideNumber:r,matchUp:a});h.appendChild(g)}if(p){const g=Ore(),v=I=>{ws(e==null?void 0:e.scoreClick)&&(event.stopPropagation(),e.scoreClick({pointerEvent:I,matchUp:a}))},y=document.createElement("div");y.className=g({sideNumber:!d&&r,fontSize:"small"}),y.onclick=v,y.innerHTML="[Score]",h.appendChild(y)}return m.appendChild(h),m}function mAe(t){const{composition:e,initialRoundNumber:i=1,matchUp:r,moiety:n,selectedMatchUpId:a,searchActive:o}=t,{roundFactor:s,roundNumber:l,finishingRound:u,matchUpType:c,preFeedRound:d,stage:p}=r,m=t.isFinalRound||parseInt(u)===1,h=p==="QUALIFYING"&&m,f=m,g=parseInt(l)===i,v=c==="DOUBLES",y=(o||r.isRoundRobin||r.collectionId||t.isLucky||t.isAdHoc)&&"mr"||f&&"noProgression"||(h||d)&&"m0"||n&&"m1"||"m2",I=rAe({composition:e,isDoubles:v,roundFactor:s})({isFirstRound:g,link:y}),b=(e==null?void 0:e.configuration)||{},{resultsInfo:S,centerInfo:w}=b||{},U=t.eventHandlers||{},T=A=>{ws(U==null?void 0:U.matchUpClick)&&U.matchUpClick({pointerEvent:A,matchUp:r})},D=document.createElement("div");D.className=Up(e.theme,t==null?void 0:t.className,"matchup",XNe()),D.classList.add("tmx-m"),D.setAttribute("id",r==null?void 0:r.matchUpId),D.onclick=T;const P=document.createElement("div");P.className=QNe({configuration:b});const E=({sideNumber:A})=>{var M,C,O;const k=(O=(C=(M=r==null?void 0:r.sides.find(x=>x.sideNumber===A))==null?void 0:M.participant)==null?void 0:C.entryStatus)==null?void 0:O.replace("_"," ");return iAe({eventHandlers:U,entryStatus:k,sideNumber:A,className:A===2&&I,matchUp:r})},R=Dj({initialRoundNumber:i,eventHandlers:U,sideNumber:1,composition:e,matchUp:r}),N=Dj({className:!w&&I,initialRoundNumber:i,eventHandlers:U,sideNumber:2,composition:e,matchUp:r});if(P.appendChild(R),w){const A=E({sideNumber:1}),M=E({sideNumber:2});P.appendChild(A.element),P.appendChild(M.element)}if(P.appendChild(N),S){const A=hAe({score:r.score});P.appendChild(A)}if(D.appendChild(P),a===r.matchUpId){const A=document.createElement("div");A.className=JNe(),D.appendChild(A)}return D}function hAe({score:t}){var e;const i=(e=t==null?void 0:t.sets)==null?void 0:e.filter(Boolean).sort((o,s)=>(o.setNumber||0)-(s.setNumber||0)),r=i==null?void 0:i[i.length-1],n=(r==null?void 0:r.side1PointsScore)||(r==null?void 0:r.side2PointsScore),a=document.createElement("div");if(a.className=KNe(),n){const o=document.createElement("div");o.className=Sj({variant:"points"}),o.innerHTML="PTS",a.appendChild(o)}for(const o of i||[]){const s=document.createElement("div");s.setAttribute("key",o.setNumber),s.className=Sj({variant:"set"}),s.innerHTML=o.setNumber,a.appendChild(s)}return a}function fAe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,isRoundRobin:n,searchActive:a,composition:o,roundFactor:s,roundNumber:l,roundProfile:u,minWidth:c,matchUps:d,context:p,isLucky:m}){const h=d.filter(P=>P.roundNumber===l).sort((P,E)=>(P.roundPosition||0)-(E.roundPosition||0)),f=h.every(({roundPosition:P,drawPositions:E})=>!P&&!E),g=(o==null?void 0:o.configuration)||{},v=document.createElement("div");if(v.className=Nre(),v.classList.add("tmx-rd"),v.setAttribute("roundNumber",l),g.roundHeader){const P=zNe({roundProfile:u,roundMatchUps:h,roundNumber:l,eventHandlers:i,context:p});v.appendChild(P)}const y=document.createElement("div");y.className=Are({variant:f?"adHoc":void 0}),c&&(y.style.minWidth=c);let I,b,S;if(n){const P=R=>R.reduce((N,A)=>A+N,0);h.sort((R,N)=>{const A=P(R.drawPositions)-P(N.drawPositions),M=Math.min(...R.drawPositions??[])-Math.min(...N.drawPositions??[]);return A||M});const E=h.reduce((R,N)=>(R[N.structureId]=N.structureName,R),{});I=Object.values(E),b=Object.keys(E),S=Object.keys(nB.instanceCount(h.map(({structureId:R})=>R))).length}else f&&h.sort((P,E)=>(P.roundOrder??0)-(E.roundOrder??0));const w=S&&h.length/S,U=Object.keys(u).map(P=>parseInt(P)),T=U.indexOf(l),D=T===0&&"first"||T===U.length-1&&"last";return h.forEach((P,E)=>{const R=w&&!(E%w),N=w&&Math.floor(E/w),A=w&&I[N];if(R){const O=document.createElement("div");O.className=qNe({variant:N,roundOrder:D}),y.appendChild(O);const k=document.createElement("div");if(k.className=YNe(),ws(i==null?void 0:i.groupHeaderClick)){const{drawId:x,containerStructureId:F}=h[0];y.onclick=$=>i.groupHeaderClick({structureId:b[N],containerStructureId:F,pointerEvent:$,drawId:x})}l===t&&(k.innerHTML=A),y.appendChild(k)}const M=E%2===0;s?P.roundFactor=s:t>1&&(P.roundFactor=Math.pow(2,l-t));const C=mAe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,searchActive:a,composition:o,isAdHoc:f,isLucky:m,matchUp:P,moiety:M});y.appendChild(C)}),v.appendChild(y),v}function gAe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:r,composition:n,structureId:a,finalColumn:o,matchUps:s,minWidth:l,context:u}){var c;const{roundNumbers:d,roundProfile:p,hasOddMatchUpsCount:m,isNotEliminationStructure:h}=Cre.getRoundMatchUps({matchUps:s});a=a||(u==null?void 0:u.structureId)||((c=s==null?void 0:s[0])==null?void 0:c.structureId);const f=s.some(({isRoundRobin:I})=>I),g=m||h,v=document.createElement("div");v.className=WNe(),v.classList.add("tmx-str"),v.setAttribute("id",a);const y=Math.max(...d);for(const I of d){if(I<t)continue;const b=fAe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:I===y,isRoundRobin:f,searchActive:r,composition:n,roundNumber:I,roundProfile:p,matchUps:s,minWidth:l,context:u,isLucky:g});v.appendChild(b)}if(o){const I=document.createElement("div");I.className=Nre();const b=document.createElement("div");b.className=Are(),b.appendChild(o),I.appendChild(b),v.appendChild(I)}return v}const Pj=Yt({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});function vAe({content:t,theme:e}){const i=document.createElement("div");return i.className=e?Up(Pj(),e):Pj(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}const{createTheme:Yh}=IK({theme:{lineHeights:{scheduleInfo:`${pI.scheduleInfo}rem`,centerInfo:`${pI.centerInfo}rem`,gameScore:`${pI.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),Rj=Yh("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),IAe=Yh("wimbledon-theme",{borderWidths:{borderInlineStart:"10px"},colors:{connector:"transparent",borderHover:"darkgrey",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),yAe=Yh("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),bAe=Yh("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),Ej=Yh("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),wAe=Yh("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),UAe=Yh("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}}),SAe={Australian:{configuration:{flags:!0},theme:Rj},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:Ej},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:Ej},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:yAe},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:IAe},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:bAe},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:UAe},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:Rj},Night:{configuration:{flags:!0},theme:wAe}},{MALE:TAe,FEMALE:DAe}=rT,{PAIR:PAe}=bW,RAe="utr",EAe={utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},Fre=t=>(e,i,r)=>{var d;const n=e.getColumn().getDefinition(),a=n.field==="side1"&&1||n.field==="side2"&&2,o=document.createElement("div"),s=e.getRow().getData(),l=s.winningSide,u=e.getValue(),c=s.participant||u.participant||s.person&&s;if(c){const p=EAe[RAe],m=f=>Mre({eventHandlers:{participantClick:g=>cu(t)&&t({...g,event:g.pointerEvent,cell:e})},composition:{configuration:{participantDetail:"TEAM",winnerColor:!0,genderColor:!0,scaleAttributes:p,flag:!1}},matchUp:s.matchUp,participant:f,placeholder:i,sideNumber:a}),h=f=>{const g=document.createElement("div");return g.className="flexrow flexjustifystart",f.individualParticipants.forEach((v,y)=>{if(g.appendChild(m(v)),!y){const I=document.createElement("span");I.style.width="1em",I.innerHTML="&nbsp;",g.appendChild(I)}}),g};return r==="sideBySide"&&c.participantType===PAe?h(c):m(c)}if(l){const p=n.field===s.winningSide;o.style.color=p?"green":"red"}else{const p=(u==null?void 0:u.sex)||((d=s==null?void 0:s.person)==null?void 0:d.sex),m=p===TAe&&"#2E86C1"||p===DAe&&"#AA336A"||"";o.style.color=m}return o.innerHTML=(m1(u)?u.participantName:u)||"",o};function CAe(t){var o;const e=t.getRow().getData();if(!((o=e.competitiveProfile)!=null&&o.competitiveness))return"";const{competitiveProfile:i,score:r}=e,n=document.createElement("span"),a={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(r){const{competitiveness:s}=i;n.style.fontSize="smaller",n.style.color=a[s],n.innerHTML=s}return n}function MAe(t){const e=t.getRow().getData();if(!e.readyToScore)return"";const i=e.matchUp.matchUpStatus==="WALKOVER",r=document.createElement("span");return r.classList.add("scoreCell"),e.score?(r.style.fontSize="smaller",r.innerHTML=e.score):i?r.innerHTML="WO":(r.style.fontSize="smaller",r.style.color="blue",r.innerHTML="--- --- ---"),r}function ZM(t,e){var n,a,o,s;const i=(t==null?void 0:t.person)||((n=t==null?void 0:t.participant)==null?void 0:n.person),r=(e==null?void 0:e.person)||((a=e==null?void 0:e.participant)==null?void 0:a.person);return i||r?i!=null&&i.standardFamilyName&&!(r!=null&&r.standardFamilyName)||r!=null&&r.standardFamilyName&&!(i!=null&&i.standardFamilyName)||!(i!=null&&i.standardFamilyName)&&!(r!=null&&r.standardFamilyName)?1:(o=i.standardFamilyName)==null?void 0:o.localeCompare(r==null?void 0:r.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!(t!=null&&t.participantName)&&!(e!=null&&e.participantName)?1:(s=t==null?void 0:t.participantName)==null?void 0:s.localeCompare(e==null?void 0:e.participantName)}function NAe(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}function AAe({data:t}){const e=t.some(r=>r.courtName),i=r=>{const n=document.createElement("div");n.className="has-text-warning-dark",n.innerHTML="Select participant";const a=()=>console.log("boo");return r.getValue().participantName&&Fre(a)(r,n)};return[{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:Zi,minWidth:50,width:50},{formatter:"rownum",headerSort:!1,hozAlign:zd,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"scheduledDate",title:"Date",width:110},{visible:!!e,field:"courtName",title:"Court",width:100},{field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:i,sorter:ZM,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:i,sorter:ZM,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{formatter:MAe,sorter:NAe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:Nbe,formatter:CAe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:zd,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70}]}var OAe=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};const{TEAM:kAe}=Mz,Cj=t=>{var M,C,O,k,x;const{potentialParticipants:e,structureName:i,matchUpType:r,roundNumber:n,matchUpId:a,roundName:o,schedule:s,eventId:l,drawId:u,sides:c,...d}=t,{scheduledDate:p,scheduleTime:m,courtName:h}=s||{},f=F=>{var $;return(($=F.person)==null?void 0:$.standardFamilyName)||F.participantName},g=(e==null?void 0:e.map(F=>({participantName:F.map(f).filter(Boolean).join(" or ")})))||[],v=((M=c==null?void 0:c[0])==null?void 0:M.participant)||g.shift(),y=((C=c==null?void 0:c[1])==null?void 0:C.participant)||g.shift(),I={participantName:v==null?void 0:v.participantName,sex:(O=v==null?void 0:v.person)==null?void 0:O.sex,participant:v},b={participantName:y==null?void 0:y.participantName,sex:(k=y==null?void 0:y.person)==null?void 0:k.sex,participant:y},S=c.flatMap(({participant:F})=>{var $;return($=F==null?void 0:F.individualParticipantIds)!=null&&$.length?F.individualParticipantIds:F==null?void 0:F.participantId}).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,U=!!d.winningSide,T=!!(d.winningSide||d.readyToScore),D=(x=d.score)==null?void 0:x.scoreStringSide1,P=c.flatMap(F=>{var _,L,B;const $=(_=F.participant)==null?void 0:_.person;return $?[$.standardGivenName,$.standardFamilyName]:(B=(L=F.participant)==null?void 0:L.individualParticipants)==null?void 0:B.map(({person:V})=>[V.standardGivenName,V.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),E=OAe([P,v==null?void 0:v.participantName,y==null?void 0:y.participantName].filter(Boolean).join(" ")).toLowerCase(),R=t.collectionId?kAe:r,N=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,A={score:D,matchUpStatus:t.matchUpStatus,readyToScore:T,complete:U,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:S,flight:t.drawName,competitiveProfile:N,structureName:i,scheduledDate:p,readyToScore:T,scheduleTime:m,matchUpType:r,scoreDetail:A,winningSide:w,roundNumber:n,searchText:E,courtName:h,eventType:R,matchUpId:a,roundName:o,complete:U,eventId:l,matchUp:t,drawId:u,side1:I,side2:b,score:D}},{CONTAINER:xAe}=cT;async function FAe(t){const{drawId:e,structureId:i,eventData:r}=t;let n,a,o,s,l=t.matchUps;const u=()=>{var b,S;const v=(b=r==null?void 0:r.drawsData)==null?void 0:b.find(w=>w.drawId===e);a=(S=v==null?void 0:v.structures)==null?void 0:S.find(w=>w.structureId===i),s=(a==null?void 0:a.structureType)===xAe;const y=a!=null&&a.roundMatchUps?Object.values((a==null?void 0:a.roundMatchUps)||{}).flat():[],I=y.flatMap(w=>w.tieMatchUps||[]);return I.length&&y.push(...I),y.filter(({matchUpStatus:w})=>w!=="BYE").filter(({sides:w})=>!o||w.find(U=>{var T,D;return(D=(T=U.participant)==null?void 0:T.participantName)==null?void 0:D.toLowerCase().includes(o==null?void 0:o.toLowerCase())}))};l||(l=await u()),r&&l.forEach(v=>v.eventName=r.eventInfo.eventName);const c=()=>l.map(Cj),d=()=>u().map(Cj),p=v=>{v.participantFilter&&(o=v.participantFilter),n.replaceData(d())},m=c(),h=AAe({data:m}),f=s?["roundName","structureName"]:["roundName"];return(v=>{KD({anchorId:"flightDisplay"});const y=document.getElementById("flightDisplay");n=new Hb(y,{groupHeader:[Mbe,I=>I],headerSortElement:gK(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:f,columns:h,data:v})})(m),{table:n,replaceTableData:p}}const LAe=t=>t.reduce((e,i)=>e+parseFloat(i),0),Mj=t=>parseFloat((LAe(t)/t.length).toFixed(2));function Nj(t){var p,m;const{participantResult:e,drawPosition:i,participantId:r,participantMap:n}=t,a=(p=e==null?void 0:e.ratingVariation)!=null&&p.length?Mj(e.ratingVariation):0,o=(m=e==null?void 0:e.pressureScores)!=null&&m.length?Mj(e.pressureScores):0,s=`${(e==null?void 0:e.pointsWon)||0}/${(e==null?void 0:e.pointsLost)||0}`,l=`${(e==null?void 0:e.gamesWon)||0}/${(e==null?void 0:e.gamesLost)||0}`,u=`${(e==null?void 0:e.setsWon)||0}/${(e==null?void 0:e.setsLost)||0}`,c=(e==null?void 0:e.groupOrder)||(e==null?void 0:e.provisionalOrder),d=n[r];return{participantName:d.participantName,groupName:d.groupName,...e,averageVariation:a,averagePressure:o,participantId:r,pointsResult:s,drawPosition:i,participant:d,gamesResult:l,setsResult:u,order:c}}function N0(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:t-e}function of(t){const e=t.getValue();return e&&`${(parseFloat(e)*100).toFixed(0)}%`}function Aj(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:e-t}function _Ae({isAdHoc:t}){return[{formatter:Fre(({event:e,cell:i,...r})=>console.log("cell clicked",{event:e,cell:i,undefined:void 0,params:r})),sorter:ZM,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,title:"Name",widthGrow:2,frozen:!0},{headerHozAlign:Zi,headerWordWrap:!0,title:"Match W/L",hozAlign:Zi,maxWidth:80,field:"result"},{formatter:of,headerHozAlign:Zi,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:Zi,maxWidth:80},{headerHozAlign:Zi,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:Zi,maxWidth:80},{formatter:of,headerHozAlign:Zi,headerWordWrap:!0,title:"Set Win%",hozAlign:Zi,field:"setsPct",maxWidth:80},{headerHozAlign:Zi,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:Zi,maxWidth:80},{formatter:of,headerHozAlign:Zi,headerWordWrap:!0,title:"Game Win%",hozAlign:Zi,field:"gamesPct",maxWidth:80},{headerHozAlign:Zi,headerWordWrap:!0,field:"pointsResult",title:"Points W/L",hozAlign:Zi,maxWidth:80},{formatter:of,headerHozAlign:Zi,headerWordWrap:!0,title:"Points Win%",field:"pointsPct",hozAlign:Zi,maxWidth:80},{formatter:of,field:"averagePressure",headerHozAlign:Zi,sorter:Aj,hozAlign:Zi,maxWidth:70,title:"PS"},{formatter:of,field:"averageVariation",headerHozAlign:Zi,sorter:Aj,hozAlign:Zi,maxWidth:70,title:"RV"},{headerHozAlign:Zi,field:"pressureOrder",sorter:N0,hozAlign:Zi,visible:t,title:"Order",maxWidth:80},{headerHozAlign:Zi,sorter:N0,visible:!t,hozAlign:Zi,title:"Order",field:"order",maxWidth:80},{field:"groupName",visible:!1,title:"Group"}]}async function $Ae({drawId:t,structureId:e,eventData:i,participants:r=[]}){var b,S;let n,a,o;const s=(b=i==null?void 0:i.drawsData)==null?void 0:b.find(w=>w.drawId===t);let l=(S=s==null?void 0:s.structures)==null?void 0:S.find(w=>w.structureId===e);const u=UT.isAdHoc({structure:l}),c=w=>(w??[]).reduce((U,T)=>(U[T.participantId]=T,U),{}),d={},p=()=>{var T,D;const w=(T=i==null?void 0:i.drawsData)==null?void 0:T.find(P=>P.drawId===t);return l=(D=w==null?void 0:w.structures)==null?void 0:D.find(P=>P.structureId===e),o||(o=c(r)),(l!=null&&l.roundMatchUps?Object.values(l.roundMatchUps).flat():[]).forEach(({sides:P,structureName:E,structureId:R})=>{d[R]=E,P.forEach(N=>{N.participantId&&(o[N.participantId].groupName=E)})}),((l==null?void 0:l.participantResults)??[]).filter(P=>{var R;const E=o[P.participantId];return!a||((R=E==null?void 0:E.participantName)==null?void 0:R.toLowerCase().includes(a==null?void 0:a.toLowerCase()))})},m=p(),h=()=>m==null?void 0:m.map(w=>Nj({...w,participantMap:o})).sort((w,U)=>u?N0(w.pressureOrder,U.pressureOrder):N0(w.order,U.order)),f=()=>{var w;return(w=p())==null?void 0:w.map(U=>Nj({...U,participantMap:o}))},g=w=>{(w==null?void 0:w.participantFilter)!==void 0&&(a=w.participantFilter),n.replaceData(f())},v=h(),y=_Ae({isAdHoc:u});return(w=>{KD({anchorId:"flightDisplay"});const U=document.getElementById("flightDisplay"),T=Object.values(d).length>1?["groupName"]:void 0;n=new Hb(U,{headerSortElement:gK(["averageVariation","averagePressure","participantName","gamesResult","matchUpsPct","setsResult","gamesPct","setsPct","result","order"]),height:window.innerHeight*.85,groupHeader:[D=>D],placeholder:"No participants",renderHorizontal:"virtual",index:"matchUpId",groupBy:T,columns:y,data:w})})(v),{table:n,replaceTableData:g}}const{CONTAINER:BAe}=cT;function VAe(t){const{callback:e,structure:i,existingView:r}=t,n=l=>r!==l&&cu(e)&&e({refresh:!0,view:l}),a=(i==null?void 0:i.structureType)===BAe,o=vfe.isAdHoc({structure:i}),s=[];return r!==AV&&s.push({onClick:()=>n(AV),label:o?"Columns":"Draw",close:!0}),r!==kV&&s.push({onClick:()=>n(kV),label:"Table view",close:!0}),(o||a)&&r!==OV&&s.push({onClick:()=>n(OV),label:"Statistics",close:!0}),{label:"Display",id:"roundDisplayButton",options:s,selection:!1,location:Nm,align:Nm}}function Oj({tournamentId:t,eventId:e,header:i,flightDisplay:r,displayFormat:n}){const a=()=>{var l;return(l=document.getElementById("structureButton"))==null?void 0:l.remove()},o=()=>{var l;return(l=document.getElementById("roundDisplayButton"))==null?void 0:l.remove()};cK({tournamentId:t,eventId:e,hydrateParticipants:!1}).then(l=>{var y,I,b;const u=((y=l==null?void 0:l.data)==null?void 0:y.eventData)||(l==null?void 0:l.data),c=((I=l==null?void 0:l.data)==null?void 0:I.participants)||[];window!=null&&window.dev&&(window.dev.eventData=u);const d=S=>Object.values(S.roundMatchUps||{}).flat(),p=S=>{var w;return(w=S.structures)==null?void 0:w.some(U=>d(U).length>0)},m=u==null?void 0:u.drawsData.filter(p);{const S=new Map(c.map(U=>[U.participantId,U])),w=U=>{var T;for(const D of U.sides||[])D.participantId&&(D.participant=S.get(D.participantId),(T=D.participant)!=null&&T.individualParticipantIds&&(D.participant.individualParticipants=D.participant.individualParticipantIds.map(P=>S.get(P))))};for(const U of m)for(const T of U.structures)Object.values(T.roundMatchUps||{}).flat().forEach(D=>{var P;w(D),(P=D.tieMatchUps)==null||P.forEach(w)})}const h=S=>{var E,R;const w=m[S];if(!w)return;const U=w.drawId,T=({view:N})=>{N&&(n=N),h(S)},D=N=>{var B,V;const A=(B=w.structures)==null?void 0:B[N];o();const M=VAe({callback:T,structure:A}),C=om({button:M});i.appendChild(C);const O=A.structureId,k=Object.values(A.roundMatchUps||{}).flat();UT.isAdHoc({structure:A})&&k.sort(HD.matchUpScheduleSort),r.innerHTML=w.drawName,Kp(r);const F={...(V=u==null?void 0:u.eventInfo)==null?void 0:V.display,...w==null?void 0:w.display,...A==null?void 0:A.display},$=F==null?void 0:F.compositionName,_=F==null?void 0:F.configuration,L=SAe[$??"National"];if(Object.assign(L.configuration,_),L.configuration.genderColor=!0,n==="roundsColumns"){const G=vAe({content:gAe({context:{drawId:U,structureId:O},matchUps:k,composition:L,structure:A}),theme:L.theme});r.appendChild(G)}else n==="roundsStats"?$Ae({drawId:U,structureId:O,eventData:u,participants:c}):FAe({drawId:U,structureId:O,eventData:u})};if(((E=w.structures)==null?void 0:E.length)>1){const N=w.structures.map(({structureName:C},O)=>({onClick:()=>D(O),label:C,close:!0})),A={label:w.structures[0].structureName,options:N,id:"structureButton",modifyLabel:!0,selection:!0,location:zd},M=om({button:A});i.appendChild(M)}(R=w.structures)!=null&&R[0]&&D(0)},f=m.map(({drawName:S},w)=>({onClick:()=>h(w),label:S,close:!0})),g={label:(b=m==null?void 0:m[0])==null?void 0:b.drawName,options:f,modifyLabel:!0,id:"flightButton",selection:!0,location:zd},v=om({button:g,stateChange:a});i.appendChild(v),h(0)})}function Kp(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}function jAe(t,e,i,r,n){if(n){const a=e.target.value;n(a)?(r.innerHTML="",r.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(r.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),r.classList.add("is-danger"))}}var Qo="top",gl="bottom",vl="right",Zo="left",uB="auto",uU=[Qo,gl,vl,Zo],Ug="start",Py="end",GAe="clippingParents",Lre="viewport",Hv="popper",HAe="reference",kj=uU.reduce(function(t,e){return t.concat([e+"-"+Ug,e+"-"+Py])},[]),_re=[].concat(uU,[uB]).reduce(function(t,e){return t.concat([e,e+"-"+Ug,e+"-"+Py])},[]),zAe="beforeRead",WAe="read",qAe="afterRead",YAe="beforeMain",KAe="main",JAe="afterMain",XAe="beforeWrite",QAe="write",ZAe="afterWrite",eOe=[zAe,WAe,qAe,YAe,KAe,JAe,XAe,QAe,ZAe];function ju(t){return t?(t.nodeName||"").toLowerCase():null}function _s(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function zm(t){var e=_s(t).Element;return t instanceof e||t instanceof Element}function tl(t){var e=_s(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function cB(t){if(typeof ShadowRoot>"u")return!1;var e=_s(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function tOe(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var r=e.styles[i]||{},n=e.attributes[i]||{},a=e.elements[i];!tl(a)||!ju(a)||(Object.assign(a.style,r),Object.keys(n).forEach(function(o){var s=n[o];s===!1?a.removeAttribute(o):a.setAttribute(o,s===!0?"":s)}))})}function iOe(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(r){var n=e.elements[r],a=e.attributes[r]||{},o=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:i[r]),s=o.reduce(function(l,u){return l[u]="",l},{});!tl(n)||!ju(n)||(Object.assign(n.style,s),Object.keys(a).forEach(function(l){n.removeAttribute(l)}))})}}const $re={name:"applyStyles",enabled:!0,phase:"write",fn:tOe,effect:iOe,requires:["computeStyles"]};function bu(t){return t.split("-")[0]}var ym=Math.max,A0=Math.min,Sg=Math.round;function eN(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Bre(){return!/^((?!chrome|android).)*safari/i.test(eN())}function Tg(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var r=t.getBoundingClientRect(),n=1,a=1;e&&tl(t)&&(n=t.offsetWidth>0&&Sg(r.width)/t.offsetWidth||1,a=t.offsetHeight>0&&Sg(r.height)/t.offsetHeight||1);var o=zm(t)?_s(t):window,s=o.visualViewport,l=!Bre()&&i,u=(r.left+(l&&s?s.offsetLeft:0))/n,c=(r.top+(l&&s?s.offsetTop:0))/a,d=r.width/n,p=r.height/a;return{width:d,height:p,top:c,right:u+d,bottom:c+p,left:u,x:u,y:c}}function dB(t){var e=Tg(t),i=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:r}}function Vre(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&cB(i)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Vc(t){return _s(t).getComputedStyle(t)}function rOe(t){return["table","td","th"].indexOf(ju(t))>=0}function _p(t){return((zm(t)?t.ownerDocument:t.document)||window.document).documentElement}function oE(t){return ju(t)==="html"?t:t.assignedSlot||t.parentNode||(cB(t)?t.host:null)||_p(t)}function xj(t){return!tl(t)||Vc(t).position==="fixed"?null:t.offsetParent}function nOe(t){var e=/firefox/i.test(eN()),i=/Trident/i.test(eN());if(i&&tl(t)){var r=Vc(t);if(r.position==="fixed")return null}var n=oE(t);for(cB(n)&&(n=n.host);tl(n)&&["html","body"].indexOf(ju(n))<0;){var a=Vc(n);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return n;n=n.parentNode}return null}function cU(t){for(var e=_s(t),i=xj(t);i&&rOe(i)&&Vc(i).position==="static";)i=xj(i);return i&&(ju(i)==="html"||ju(i)==="body"&&Vc(i).position==="static")?e:i||nOe(t)||e}function pB(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function mI(t,e,i){return ym(t,A0(e,i))}function aOe(t,e,i){var r=mI(t,e,i);return r>i?i:r}function jre(){return{top:0,right:0,bottom:0,left:0}}function Gre(t){return Object.assign({},jre(),t)}function Hre(t,e){return e.reduce(function(i,r){return i[r]=t,i},{})}var oOe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Gre(typeof e!="number"?e:Hre(e,uU))};function sOe(t){var e,i=t.state,r=t.name,n=t.options,a=i.elements.arrow,o=i.modifiersData.popperOffsets,s=bu(i.placement),l=pB(s),u=[Zo,vl].indexOf(s)>=0,c=u?"height":"width";if(!(!a||!o)){var d=oOe(n.padding,i),p=dB(a),m=l==="y"?Qo:Zo,h=l==="y"?gl:vl,f=i.rects.reference[c]+i.rects.reference[l]-o[l]-i.rects.popper[c],g=o[l]-i.rects.reference[l],v=cU(a),y=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,I=f/2-g/2,b=d[m],S=y-p[c]-d[h],w=y/2-p[c]/2+I,U=mI(b,w,S),T=l;i.modifiersData[r]=(e={},e[T]=U,e.centerOffset=U-w,e)}}function lOe(t){var e=t.state,i=t.options,r=i.element,n=r===void 0?"[data-popper-arrow]":r;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||Vre(e.elements.popper,n)&&(e.elements.arrow=n))}const uOe={name:"arrow",enabled:!0,phase:"main",fn:sOe,effect:lOe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Dg(t){return t.split("-")[1]}var cOe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function dOe(t,e){var i=t.x,r=t.y,n=e.devicePixelRatio||1;return{x:Sg(i*n)/n||0,y:Sg(r*n)/n||0}}function Fj(t){var e,i=t.popper,r=t.popperRect,n=t.placement,a=t.variation,o=t.offsets,s=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,d=t.isFixed,p=o.x,m=p===void 0?0:p,h=o.y,f=h===void 0?0:h,g=typeof c=="function"?c({x:m,y:f}):{x:m,y:f};m=g.x,f=g.y;var v=o.hasOwnProperty("x"),y=o.hasOwnProperty("y"),I=Zo,b=Qo,S=window;if(u){var w=cU(i),U="clientHeight",T="clientWidth";if(w===_s(i)&&(w=_p(i),Vc(w).position!=="static"&&s==="absolute"&&(U="scrollHeight",T="scrollWidth")),w=w,n===Qo||(n===Zo||n===vl)&&a===Py){b=gl;var D=d&&w===S&&S.visualViewport?S.visualViewport.height:w[U];f-=D-r.height,f*=l?1:-1}if(n===Zo||(n===Qo||n===gl)&&a===Py){I=vl;var P=d&&w===S&&S.visualViewport?S.visualViewport.width:w[T];m-=P-r.width,m*=l?1:-1}}var E=Object.assign({position:s},u&&cOe),R=c===!0?dOe({x:m,y:f},_s(i)):{x:m,y:f};if(m=R.x,f=R.y,l){var N;return Object.assign({},E,(N={},N[b]=y?"0":"",N[I]=v?"0":"",N.transform=(S.devicePixelRatio||1)<=1?"translate("+m+"px, "+f+"px)":"translate3d("+m+"px, "+f+"px, 0)",N))}return Object.assign({},E,(e={},e[b]=y?f+"px":"",e[I]=v?m+"px":"",e.transform="",e))}function pOe(t){var e=t.state,i=t.options,r=i.gpuAcceleration,n=r===void 0?!0:r,a=i.adaptive,o=a===void 0?!0:a,s=i.roundOffsets,l=s===void 0?!0:s,u={placement:bu(e.placement),variation:Dg(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Fj(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Fj(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const mOe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:pOe,data:{}};var DU={passive:!0};function hOe(t){var e=t.state,i=t.instance,r=t.options,n=r.scroll,a=n===void 0?!0:n,o=r.resize,s=o===void 0?!0:o,l=_s(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",i.update,DU)}),s&&l.addEventListener("resize",i.update,DU),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",i.update,DU)}),s&&l.removeEventListener("resize",i.update,DU)}}const fOe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:hOe,data:{}};var gOe={left:"right",right:"left",bottom:"top",top:"bottom"};function cS(t){return t.replace(/left|right|bottom|top/g,function(e){return gOe[e]})}var vOe={start:"end",end:"start"};function Lj(t){return t.replace(/start|end/g,function(e){return vOe[e]})}function mB(t){var e=_s(t),i=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:i,scrollTop:r}}function hB(t){return Tg(_p(t)).left+mB(t).scrollLeft}function IOe(t,e){var i=_s(t),r=_p(t),n=i.visualViewport,a=r.clientWidth,o=r.clientHeight,s=0,l=0;if(n){a=n.width,o=n.height;var u=Bre();(u||!u&&e==="fixed")&&(s=n.offsetLeft,l=n.offsetTop)}return{width:a,height:o,x:s+hB(t),y:l}}function yOe(t){var e,i=_p(t),r=mB(t),n=(e=t.ownerDocument)==null?void 0:e.body,a=ym(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),o=ym(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),s=-r.scrollLeft+hB(t),l=-r.scrollTop;return Vc(n||i).direction==="rtl"&&(s+=ym(i.clientWidth,n?n.clientWidth:0)-a),{width:a,height:o,x:s,y:l}}function fB(t){var e=Vc(t),i=e.overflow,r=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function zre(t){return["html","body","#document"].indexOf(ju(t))>=0?t.ownerDocument.body:tl(t)&&fB(t)?t:zre(oE(t))}function hI(t,e){var i;e===void 0&&(e=[]);var r=zre(t),n=r===((i=t.ownerDocument)==null?void 0:i.body),a=_s(r),o=n?[a].concat(a.visualViewport||[],fB(r)?r:[]):r,s=e.concat(o);return n?s:s.concat(hI(oE(o)))}function tN(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function bOe(t,e){var i=Tg(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function _j(t,e,i){return e===Lre?tN(IOe(t,i)):zm(e)?bOe(e,i):tN(yOe(_p(t)))}function wOe(t){var e=hI(oE(t)),i=["absolute","fixed"].indexOf(Vc(t).position)>=0,r=i&&tl(t)?cU(t):t;return zm(r)?e.filter(function(n){return zm(n)&&Vre(n,r)&&ju(n)!=="body"}):[]}function UOe(t,e,i,r){var n=e==="clippingParents"?wOe(t):[].concat(e),a=[].concat(n,[i]),o=a[0],s=a.reduce(function(l,u){var c=_j(t,u,r);return l.top=ym(c.top,l.top),l.right=A0(c.right,l.right),l.bottom=A0(c.bottom,l.bottom),l.left=ym(c.left,l.left),l},_j(t,o,r));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function Wre(t){var e=t.reference,i=t.element,r=t.placement,n=r?bu(r):null,a=r?Dg(r):null,o=e.x+e.width/2-i.width/2,s=e.y+e.height/2-i.height/2,l;switch(n){case Qo:l={x:o,y:e.y-i.height};break;case gl:l={x:o,y:e.y+e.height};break;case vl:l={x:e.x+e.width,y:s};break;case Zo:l={x:e.x-i.width,y:s};break;default:l={x:e.x,y:e.y}}var u=n?pB(n):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case Ug:l[u]=l[u]-(e[c]/2-i[c]/2);break;case Py:l[u]=l[u]+(e[c]/2-i[c]/2);break}}return l}function Ry(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=r===void 0?t.placement:r,a=i.strategy,o=a===void 0?t.strategy:a,s=i.boundary,l=s===void 0?GAe:s,u=i.rootBoundary,c=u===void 0?Lre:u,d=i.elementContext,p=d===void 0?Hv:d,m=i.altBoundary,h=m===void 0?!1:m,f=i.padding,g=f===void 0?0:f,v=Gre(typeof g!="number"?g:Hre(g,uU)),y=p===Hv?HAe:Hv,I=t.rects.popper,b=t.elements[h?y:p],S=UOe(zm(b)?b:b.contextElement||_p(t.elements.popper),l,c,o),w=Tg(t.elements.reference),U=Wre({reference:w,element:I,strategy:"absolute",placement:n}),T=tN(Object.assign({},I,U)),D=p===Hv?T:w,P={top:S.top-D.top+v.top,bottom:D.bottom-S.bottom+v.bottom,left:S.left-D.left+v.left,right:D.right-S.right+v.right},E=t.modifiersData.offset;if(p===Hv&&E){var R=E[n];Object.keys(P).forEach(function(N){var A=[vl,gl].indexOf(N)>=0?1:-1,M=[Qo,gl].indexOf(N)>=0?"y":"x";P[N]+=R[M]*A})}return P}function SOe(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=i.boundary,a=i.rootBoundary,o=i.padding,s=i.flipVariations,l=i.allowedAutoPlacements,u=l===void 0?_re:l,c=Dg(r),d=c?s?kj:kj.filter(function(h){return Dg(h)===c}):uU,p=d.filter(function(h){return u.indexOf(h)>=0});p.length===0&&(p=d);var m=p.reduce(function(h,f){return h[f]=Ry(t,{placement:f,boundary:n,rootBoundary:a,padding:o})[bu(f)],h},{});return Object.keys(m).sort(function(h,f){return m[h]-m[f]})}function TOe(t){if(bu(t)===uB)return[];var e=cS(t);return[Lj(t),e,Lj(e)]}function DOe(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var n=i.mainAxis,a=n===void 0?!0:n,o=i.altAxis,s=o===void 0?!0:o,l=i.fallbackPlacements,u=i.padding,c=i.boundary,d=i.rootBoundary,p=i.altBoundary,m=i.flipVariations,h=m===void 0?!0:m,f=i.allowedAutoPlacements,g=e.options.placement,v=bu(g),y=v===g,I=l||(y||!h?[cS(g)]:TOe(g)),b=[g].concat(I).reduce(function(B,V){return B.concat(bu(V)===uB?SOe(e,{placement:V,boundary:c,rootBoundary:d,padding:u,flipVariations:h,allowedAutoPlacements:f}):V)},[]),S=e.rects.reference,w=e.rects.popper,U=new Map,T=!0,D=b[0],P=0;P<b.length;P++){var E=b[P],R=bu(E),N=Dg(E)===Ug,A=[Qo,gl].indexOf(R)>=0,M=A?"width":"height",C=Ry(e,{placement:E,boundary:c,rootBoundary:d,altBoundary:p,padding:u}),O=A?N?vl:Zo:N?gl:Qo;S[M]>w[M]&&(O=cS(O));var k=cS(O),x=[];if(a&&x.push(C[R]<=0),s&&x.push(C[O]<=0,C[k]<=0),x.every(function(B){return B})){D=E,T=!1;break}U.set(E,x)}if(T)for(var F=h?3:1,$=function(V){var G=b.find(function(j){var z=U.get(j);if(z)return z.slice(0,V).every(function(W){return W})});if(G)return D=G,"break"},_=F;_>0;_--){var L=$(_);if(L==="break")break}e.placement!==D&&(e.modifiersData[r]._skip=!0,e.placement=D,e.reset=!0)}}const POe={name:"flip",enabled:!0,phase:"main",fn:DOe,requiresIfExists:["offset"],data:{_skip:!1}};function $j(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function Bj(t){return[Qo,vl,gl,Zo].some(function(e){return t[e]>=0})}function ROe(t){var e=t.state,i=t.name,r=e.rects.reference,n=e.rects.popper,a=e.modifiersData.preventOverflow,o=Ry(e,{elementContext:"reference"}),s=Ry(e,{altBoundary:!0}),l=$j(o,r),u=$j(s,n,a),c=Bj(l),d=Bj(u);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":d})}const EOe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:ROe};function COe(t,e,i){var r=bu(t),n=[Zo,Qo].indexOf(r)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,o=a[0],s=a[1];return o=o||0,s=(s||0)*n,[Zo,vl].indexOf(r)>=0?{x:s,y:o}:{x:o,y:s}}function MOe(t){var e=t.state,i=t.options,r=t.name,n=i.offset,a=n===void 0?[0,0]:n,o=_re.reduce(function(c,d){return c[d]=COe(d,e.rects,a),c},{}),s=o[e.placement],l=s.x,u=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[r]=o}const NOe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:MOe};function AOe(t){var e=t.state,i=t.name;e.modifiersData[i]=Wre({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const OOe={name:"popperOffsets",enabled:!0,phase:"read",fn:AOe,data:{}};function kOe(t){return t==="x"?"y":"x"}function xOe(t){var e=t.state,i=t.options,r=t.name,n=i.mainAxis,a=n===void 0?!0:n,o=i.altAxis,s=o===void 0?!1:o,l=i.boundary,u=i.rootBoundary,c=i.altBoundary,d=i.padding,p=i.tether,m=p===void 0?!0:p,h=i.tetherOffset,f=h===void 0?0:h,g=Ry(e,{boundary:l,rootBoundary:u,padding:d,altBoundary:c}),v=bu(e.placement),y=Dg(e.placement),I=!y,b=pB(v),S=kOe(b),w=e.modifiersData.popperOffsets,U=e.rects.reference,T=e.rects.popper,D=typeof f=="function"?f(Object.assign({},e.rects,{placement:e.placement})):f,P=typeof D=="number"?{mainAxis:D,altAxis:D}:Object.assign({mainAxis:0,altAxis:0},D),E=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,R={x:0,y:0};if(w){if(a){var N,A=b==="y"?Qo:Zo,M=b==="y"?gl:vl,C=b==="y"?"height":"width",O=w[b],k=O+g[A],x=O-g[M],F=m?-T[C]/2:0,$=y===Ug?U[C]:T[C],_=y===Ug?-T[C]:-U[C],L=e.elements.arrow,B=m&&L?dB(L):{width:0,height:0},V=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:jre(),G=V[A],j=V[M],z=mI(0,U[C],B[C]),W=I?U[C]/2-F-z-G-P.mainAxis:$-z-G-P.mainAxis,q=I?-U[C]/2+F+z+j+P.mainAxis:_+z+j+P.mainAxis,Y=e.elements.arrow&&cU(e.elements.arrow),re=Y?b==="y"?Y.clientTop||0:Y.clientLeft||0:0,J=(N=E==null?void 0:E[b])!=null?N:0,H=O+W-J-re,Z=O+q-J,K=mI(m?A0(k,H):k,O,m?ym(x,Z):x);w[b]=K,R[b]=K-O}if(s){var ie,ae=b==="x"?Qo:Zo,oe=b==="x"?gl:vl,ne=w[S],de=S==="y"?"height":"width",ye=ne+g[ae],ce=ne-g[oe],ke=[Qo,Zo].indexOf(v)!==-1,we=(ie=E==null?void 0:E[S])!=null?ie:0,Ze=ke?ye:ne-U[de]-T[de]-we+P.altAxis,pt=ke?ne+U[de]+T[de]-we-P.altAxis:ce,he=m&&ke?aOe(Ze,ne,pt):mI(m?Ze:ye,ne,m?pt:ce);w[S]=he,R[S]=he-ne}e.modifiersData[r]=R}}const FOe={name:"preventOverflow",enabled:!0,phase:"main",fn:xOe,requiresIfExists:["offset"]};function LOe(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function _Oe(t){return t===_s(t)||!tl(t)?mB(t):LOe(t)}function $Oe(t){var e=t.getBoundingClientRect(),i=Sg(e.width)/t.offsetWidth||1,r=Sg(e.height)/t.offsetHeight||1;return i!==1||r!==1}function BOe(t,e,i){i===void 0&&(i=!1);var r=tl(e),n=tl(e)&&$Oe(e),a=_p(e),o=Tg(t,n,i),s={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((ju(e)!=="body"||fB(a))&&(s=_Oe(e)),tl(e)?(l=Tg(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=hB(a))),{x:o.left+s.scrollLeft-l.x,y:o.top+s.scrollTop-l.y,width:o.width,height:o.height}}function VOe(t){var e=new Map,i=new Set,r=[];t.forEach(function(a){e.set(a.name,a)});function n(a){i.add(a.name);var o=[].concat(a.requires||[],a.requiresIfExists||[]);o.forEach(function(s){if(!i.has(s)){var l=e.get(s);l&&n(l)}}),r.push(a)}return t.forEach(function(a){i.has(a.name)||n(a)}),r}function jOe(t){var e=VOe(t);return eOe.reduce(function(i,r){return i.concat(e.filter(function(n){return n.phase===r}))},[])}function GOe(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function HOe(t){var e=t.reduce(function(i,r){var n=i[r.name];return i[r.name]=n?Object.assign({},n,r,{options:Object.assign({},n.options,r.options),data:Object.assign({},n.data,r.data)}):r,i},{});return Object.keys(e).map(function(i){return e[i]})}var Vj={placement:"bottom",modifiers:[],strategy:"absolute"};function jj(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function zOe(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,r=i===void 0?[]:i,n=e.defaultOptions,a=n===void 0?Vj:n;return function(s,l,u){u===void 0&&(u=a);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},Vj,a),modifiersData:{},elements:{reference:s,popper:l},attributes:{},styles:{}},d=[],p=!1,m={state:c,setOptions:function(v){var y=typeof v=="function"?v(c.options):v;f(),c.options=Object.assign({},a,c.options,y),c.scrollParents={reference:zm(s)?hI(s):s.contextElement?hI(s.contextElement):[],popper:hI(l)};var I=jOe(HOe([].concat(r,c.options.modifiers)));return c.orderedModifiers=I.filter(function(b){return b.enabled}),h(),m.update()},forceUpdate:function(){if(!p){var v=c.elements,y=v.reference,I=v.popper;if(jj(y,I)){c.rects={reference:BOe(y,cU(I),c.options.strategy==="fixed"),popper:dB(I)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(P){return c.modifiersData[P.name]=Object.assign({},P.data)});for(var b=0;b<c.orderedModifiers.length;b++){if(c.reset===!0){c.reset=!1,b=-1;continue}var S=c.orderedModifiers[b],w=S.fn,U=S.options,T=U===void 0?{}:U,D=S.name;typeof w=="function"&&(c=w({state:c,options:T,name:D,instance:m})||c)}}}},update:GOe(function(){return new Promise(function(g){m.forceUpdate(),g(c)})}),destroy:function(){f(),p=!0}};if(!jj(s,l))return m;m.setOptions(u).then(function(g){!p&&u.onFirstUpdate&&u.onFirstUpdate(g)});function h(){c.orderedModifiers.forEach(function(g){var v=g.name,y=g.options,I=y===void 0?{}:y,b=g.effect;if(typeof b=="function"){var S=b({state:c,name:v,instance:m,options:I}),w=function(){};d.push(S||w)}})}function f(){d.forEach(function(g){return g()}),d=[]}return m}}var WOe=[fOe,OOe,mOe,$re,NOe,POe,FOe,uOe,EOe],qOe=zOe({defaultModifiers:WOe}),YOe="tippy-box",qre="tippy-content",KOe="tippy-backdrop",Yre="tippy-arrow",Kre="tippy-svg-arrow",Hp={passive:!0,capture:!0},Jre=function(){return document.body};function aC(t,e,i){if(Array.isArray(t)){var r=t[e];return r??(Array.isArray(i)?i[e]:i)}return t}function gB(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function Xre(t,e){return typeof t=="function"?t.apply(void 0,e):t}function Gj(t,e){if(e===0)return t;var i;return function(r){clearTimeout(i),i=setTimeout(function(){t(r)},e)}}function JOe(t){return t.split(/\s+/).filter(Boolean)}function uf(t){return[].concat(t)}function Hj(t,e){t.indexOf(e)===-1&&t.push(e)}function XOe(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function QOe(t){return t.split("-")[0]}function O0(t){return[].slice.call(t)}function zj(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function fI(){return document.createElement("div")}function sE(t){return["Element","Fragment"].some(function(e){return gB(t,e)})}function ZOe(t){return gB(t,"NodeList")}function eke(t){return gB(t,"MouseEvent")}function tke(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function ike(t){return sE(t)?[t]:ZOe(t)?O0(t):Array.isArray(t)?t:O0(document.querySelectorAll(t))}function oC(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function Wj(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function rke(t){var e,i=uf(t),r=i[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function nke(t,e){var i=e.clientX,r=e.clientY;return t.every(function(n){var a=n.popperRect,o=n.popperState,s=n.props,l=s.interactiveBorder,u=QOe(o.placement),c=o.modifiersData.offset;if(!c)return!0;var d=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,m=u==="right"?c.left.x:0,h=u==="left"?c.right.x:0,f=a.top-r+d>l,g=r-a.bottom-p>l,v=a.left-i+m>l,y=i-a.right-h>l;return f||g||v||y})}function sC(t,e,i){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(n){t[r](n,i)})}function qj(t,e){for(var i=e;i;){var r;if(t.contains(i))return!0;i=i.getRootNode==null||(r=i.getRootNode())==null?void 0:r.host}return!1}var su={isTouch:!1},Yj=0;function ake(){su.isTouch||(su.isTouch=!0,window.performance&&document.addEventListener("mousemove",Qre))}function Qre(){var t=performance.now();t-Yj<20&&(su.isTouch=!1,document.removeEventListener("mousemove",Qre)),Yj=t}function oke(){var t=document.activeElement;if(tke(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function ske(){document.addEventListener("touchstart",ake,Hp),window.addEventListener("blur",oke)}var lke=typeof window<"u"&&typeof document<"u",uke=lke?!!window.msCrypto:!1,cke={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},dke={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},El=Object.assign({appendTo:Jre,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},cke,dke),pke=Object.keys(El),mke=function(e){var i=Object.keys(e);i.forEach(function(r){El[r]=e[r]})};function Zre(t){var e=t.plugins||[],i=e.reduce(function(r,n){var a=n.name,o=n.defaultValue;if(a){var s;r[a]=t[a]!==void 0?t[a]:(s=El[a])!=null?s:o}return r},{});return Object.assign({},t,i)}function hke(t,e){var i=e?Object.keys(Zre(Object.assign({},El,{plugins:e}))):pke,r=i.reduce(function(n,a){var o=(t.getAttribute("data-tippy-"+a)||"").trim();if(!o)return n;if(a==="content")n[a]=o;else try{n[a]=JSON.parse(o)}catch{n[a]=o}return n},{});return r}function Kj(t,e){var i=Object.assign({},e,{content:Xre(e.content,[t])},e.ignoreAttributes?{}:hke(t,e.plugins));return i.aria=Object.assign({},El.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var fke=function(){return"innerHTML"};function iN(t,e){t[fke()]=e}function Jj(t){var e=fI();return t===!0?e.className=Yre:(e.className=Kre,sE(t)?e.appendChild(t):iN(e,t)),e}function Xj(t,e){sE(e.content)?(iN(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?iN(t,e.content):t.textContent=e.content)}function rN(t){var e=t.firstElementChild,i=O0(e.children);return{box:e,content:i.find(function(r){return r.classList.contains(qre)}),arrow:i.find(function(r){return r.classList.contains(Yre)||r.classList.contains(Kre)}),backdrop:i.find(function(r){return r.classList.contains(KOe)})}}function ene(t){var e=fI(),i=fI();i.className=YOe,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=fI();r.className=qre,r.setAttribute("data-state","hidden"),Xj(r,t.props),e.appendChild(i),i.appendChild(r),n(t.props,t.props);function n(a,o){var s=rN(e),l=s.box,u=s.content,c=s.arrow;o.theme?l.setAttribute("data-theme",o.theme):l.removeAttribute("data-theme"),typeof o.animation=="string"?l.setAttribute("data-animation",o.animation):l.removeAttribute("data-animation"),o.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?l.setAttribute("role",o.role):l.removeAttribute("role"),(a.content!==o.content||a.allowHTML!==o.allowHTML)&&Xj(u,t.props),o.arrow?c?a.arrow!==o.arrow&&(l.removeChild(c),l.appendChild(Jj(o.arrow))):l.appendChild(Jj(o.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:n}}ene.$$tippy=!0;var gke=1,PU=[],lC=[];function vke(t,e){var i=Kj(t,Object.assign({},El,Zre(zj(e)))),r,n,a,o=!1,s=!1,l=!1,u=!1,c,d,p,m=[],h=Gj(H,i.interactiveDebounce),f,g=gke++,v=null,y=XOe(i.plugins),I={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},b={id:g,reference:t,popper:fI(),popperInstance:v,props:i,state:I,plugins:y,clearDelayTimeouts:Ze,setProps:pt,setContent:he,show:fe,hide:pe,hideWithInteractivity:Fe,enable:ke,disable:we,unmount:Se,destroy:He};if(!i.render)return b;var S=i.render(b),w=S.popper,U=S.onUpdate;w.setAttribute("data-tippy-root",""),w.id="tippy-"+b.id,b.popper=w,t._tippy=b,w._tippy=b;var T=y.map(function(ue){return ue.fn(b)}),D=t.hasAttribute("aria-expanded");return Y(),F(),O(),k("onCreate",[b]),i.showOnCreate&&ye(),w.addEventListener("mouseenter",function(){b.props.interactive&&b.state.isVisible&&b.clearDelayTimeouts()}),w.addEventListener("mouseleave",function(){b.props.interactive&&b.props.trigger.indexOf("mouseenter")>=0&&A().addEventListener("mousemove",h)}),b;function P(){var ue=b.props.touch;return Array.isArray(ue)?ue:[ue,0]}function E(){return P()[0]==="hold"}function R(){var ue;return!!((ue=b.props.render)!=null&&ue.$$tippy)}function N(){return f||t}function A(){var ue=N().parentNode;return ue?rke(ue):document}function M(){return rN(w)}function C(ue){return b.state.isMounted&&!b.state.isVisible||su.isTouch||c&&c.type==="focus"?0:aC(b.props.delay,ue?0:1,El.delay)}function O(ue){ue===void 0&&(ue=!1),w.style.pointerEvents=b.props.interactive&&!ue?"":"none",w.style.zIndex=""+b.props.zIndex}function k(ue,me,Ue){if(Ue===void 0&&(Ue=!0),T.forEach(function(Ee){Ee[ue]&&Ee[ue].apply(Ee,me)}),Ue){var $e;($e=b.props)[ue].apply($e,me)}}function x(){var ue=b.props.aria;if(ue.content){var me="aria-"+ue.content,Ue=w.id,$e=uf(b.props.triggerTarget||t);$e.forEach(function(Ee){var Be=Ee.getAttribute(me);if(b.state.isVisible)Ee.setAttribute(me,Be?Be+" "+Ue:Ue);else{var xe=Be&&Be.replace(Ue,"").trim();xe?Ee.setAttribute(me,xe):Ee.removeAttribute(me)}})}}function F(){if(!(D||!b.props.aria.expanded)){var ue=uf(b.props.triggerTarget||t);ue.forEach(function(me){b.props.interactive?me.setAttribute("aria-expanded",b.state.isVisible&&me===N()?"true":"false"):me.removeAttribute("aria-expanded")})}}function $(){A().removeEventListener("mousemove",h),PU=PU.filter(function(ue){return ue!==h})}function _(ue){if(!(su.isTouch&&(l||ue.type==="mousedown"))){var me=ue.composedPath&&ue.composedPath()[0]||ue.target;if(!(b.props.interactive&&qj(w,me))){if(uf(b.props.triggerTarget||t).some(function(Ue){return qj(Ue,me)})){if(su.isTouch||b.state.isVisible&&b.props.trigger.indexOf("click")>=0)return}else k("onClickOutside",[b,ue]);b.props.hideOnClick===!0&&(b.clearDelayTimeouts(),b.hide(),s=!0,setTimeout(function(){s=!1}),b.state.isMounted||G())}}}function L(){l=!0}function B(){l=!1}function V(){var ue=A();ue.addEventListener("mousedown",_,!0),ue.addEventListener("touchend",_,Hp),ue.addEventListener("touchstart",B,Hp),ue.addEventListener("touchmove",L,Hp)}function G(){var ue=A();ue.removeEventListener("mousedown",_,!0),ue.removeEventListener("touchend",_,Hp),ue.removeEventListener("touchstart",B,Hp),ue.removeEventListener("touchmove",L,Hp)}function j(ue,me){W(ue,function(){!b.state.isVisible&&w.parentNode&&w.parentNode.contains(w)&&me()})}function z(ue,me){W(ue,me)}function W(ue,me){var Ue=M().box;function $e(Ee){Ee.target===Ue&&(sC(Ue,"remove",$e),me())}if(ue===0)return me();sC(Ue,"remove",d),sC(Ue,"add",$e),d=$e}function q(ue,me,Ue){Ue===void 0&&(Ue=!1);var $e=uf(b.props.triggerTarget||t);$e.forEach(function(Ee){Ee.addEventListener(ue,me,Ue),m.push({node:Ee,eventType:ue,handler:me,options:Ue})})}function Y(){E()&&(q("touchstart",J,{passive:!0}),q("touchend",Z,{passive:!0})),JOe(b.props.trigger).forEach(function(ue){if(ue!=="manual")switch(q(ue,J),ue){case"mouseenter":q("mouseleave",Z);break;case"focus":q(uke?"focusout":"blur",K);break;case"focusin":q("focusout",K);break}})}function re(){m.forEach(function(ue){var me=ue.node,Ue=ue.eventType,$e=ue.handler,Ee=ue.options;me.removeEventListener(Ue,$e,Ee)}),m=[]}function J(ue){var me,Ue=!1;if(!(!b.state.isEnabled||ie(ue)||s)){var $e=((me=c)==null?void 0:me.type)==="focus";c=ue,f=ue.currentTarget,F(),!b.state.isVisible&&eke(ue)&&PU.forEach(function(Ee){return Ee(ue)}),ue.type==="click"&&(b.props.trigger.indexOf("mouseenter")<0||o)&&b.props.hideOnClick!==!1&&b.state.isVisible?Ue=!0:ye(ue),ue.type==="click"&&(o=!Ue),Ue&&!$e&&ce(ue)}}function H(ue){var me=ue.target,Ue=N().contains(me)||w.contains(me);if(!(ue.type==="mousemove"&&Ue)){var $e=de().concat(w).map(function(Ee){var Be,xe=Ee._tippy,qe=(Be=xe.popperInstance)==null?void 0:Be.state;return qe?{popperRect:Ee.getBoundingClientRect(),popperState:qe,props:i}:null}).filter(Boolean);nke($e,ue)&&($(),ce(ue))}}function Z(ue){var me=ie(ue)||b.props.trigger.indexOf("click")>=0&&o;if(!me){if(b.props.interactive){b.hideWithInteractivity(ue);return}ce(ue)}}function K(ue){b.props.trigger.indexOf("focusin")<0&&ue.target!==N()||b.props.interactive&&ue.relatedTarget&&w.contains(ue.relatedTarget)||ce(ue)}function ie(ue){return su.isTouch?E()!==ue.type.indexOf("touch")>=0:!1}function ae(){oe();var ue=b.props,me=ue.popperOptions,Ue=ue.placement,$e=ue.offset,Ee=ue.getReferenceClientRect,Be=ue.moveTransition,xe=R()?rN(w).arrow:null,qe=Ee?{getBoundingClientRect:Ee,contextElement:Ee.contextElement||N()}:t,Pe={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Ae){var yt=Ae.state;if(R()){var yi=M(),be=yi.box;["placement","reference-hidden","escaped"].forEach(function(Ct){Ct==="placement"?be.setAttribute("data-placement",yt.placement):yt.attributes.popper["data-popper-"+Ct]?be.setAttribute("data-"+Ct,""):be.removeAttribute("data-"+Ct)}),yt.attributes.popper={}}}},at=[{name:"offset",options:{offset:$e}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Be}},Pe];R()&&xe&&at.push({name:"arrow",options:{element:xe,padding:3}}),at.push.apply(at,(me==null?void 0:me.modifiers)||[]),b.popperInstance=qOe(qe,w,Object.assign({},me,{placement:Ue,onFirstUpdate:p,modifiers:at}))}function oe(){b.popperInstance&&(b.popperInstance.destroy(),b.popperInstance=null)}function ne(){var ue=b.props.appendTo,me,Ue=N();b.props.interactive&&ue===Jre||ue==="parent"?me=Ue.parentNode:me=Xre(ue,[Ue]),me.contains(w)||me.appendChild(w),b.state.isMounted=!0,ae()}function de(){return O0(w.querySelectorAll("[data-tippy-root]"))}function ye(ue){b.clearDelayTimeouts(),ue&&k("onTrigger",[b,ue]),V();var me=C(!0),Ue=P(),$e=Ue[0],Ee=Ue[1];su.isTouch&&$e==="hold"&&Ee&&(me=Ee),me?r=setTimeout(function(){b.show()},me):b.show()}function ce(ue){if(b.clearDelayTimeouts(),k("onUntrigger",[b,ue]),!b.state.isVisible){G();return}if(!(b.props.trigger.indexOf("mouseenter")>=0&&b.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(ue.type)>=0&&o)){var me=C(!1);me?n=setTimeout(function(){b.state.isVisible&&b.hide()},me):a=requestAnimationFrame(function(){b.hide()})}}function ke(){b.state.isEnabled=!0}function we(){b.hide(),b.state.isEnabled=!1}function Ze(){clearTimeout(r),clearTimeout(n),cancelAnimationFrame(a)}function pt(ue){if(!b.state.isDestroyed){k("onBeforeUpdate",[b,ue]),re();var me=b.props,Ue=Kj(t,Object.assign({},me,zj(ue),{ignoreAttributes:!0}));b.props=Ue,Y(),me.interactiveDebounce!==Ue.interactiveDebounce&&($(),h=Gj(H,Ue.interactiveDebounce)),me.triggerTarget&&!Ue.triggerTarget?uf(me.triggerTarget).forEach(function($e){$e.removeAttribute("aria-expanded")}):Ue.triggerTarget&&t.removeAttribute("aria-expanded"),F(),O(),U&&U(me,Ue),b.popperInstance&&(ae(),de().forEach(function($e){requestAnimationFrame($e._tippy.popperInstance.forceUpdate)})),k("onAfterUpdate",[b,ue])}}function he(ue){b.setProps({content:ue})}function fe(){var ue=b.state.isVisible,me=b.state.isDestroyed,Ue=!b.state.isEnabled,$e=su.isTouch&&!b.props.touch,Ee=aC(b.props.duration,0,El.duration);if(!(ue||me||Ue||$e)&&!N().hasAttribute("disabled")&&(k("onShow",[b],!1),b.props.onShow(b)!==!1)){if(b.state.isVisible=!0,R()&&(w.style.visibility="visible"),O(),V(),b.state.isMounted||(w.style.transition="none"),R()){var Be=M(),xe=Be.box,qe=Be.content;oC([xe,qe],0)}p=function(){var at;if(!(!b.state.isVisible||u)){if(u=!0,w.offsetHeight,w.style.transition=b.props.moveTransition,R()&&b.props.animation){var di=M(),Ae=di.box,yt=di.content;oC([Ae,yt],Ee),Wj([Ae,yt],"visible")}x(),F(),Hj(lC,b),(at=b.popperInstance)==null||at.forceUpdate(),k("onMount",[b]),b.props.animation&&R()&&z(Ee,function(){b.state.isShown=!0,k("onShown",[b])})}},ne()}}function pe(){var ue=!b.state.isVisible,me=b.state.isDestroyed,Ue=!b.state.isEnabled,$e=aC(b.props.duration,1,El.duration);if(!(ue||me||Ue)&&(k("onHide",[b],!1),b.props.onHide(b)!==!1)){if(b.state.isVisible=!1,b.state.isShown=!1,u=!1,o=!1,R()&&(w.style.visibility="hidden"),$(),G(),O(!0),R()){var Ee=M(),Be=Ee.box,xe=Ee.content;b.props.animation&&(oC([Be,xe],$e),Wj([Be,xe],"hidden"))}x(),F(),b.props.animation?R()&&j($e,b.unmount):b.unmount()}}function Fe(ue){A().addEventListener("mousemove",h),Hj(PU,h),h(ue)}function Se(){b.state.isVisible&&b.hide(),b.state.isMounted&&(oe(),de().forEach(function(ue){ue._tippy.unmount()}),w.parentNode&&w.parentNode.removeChild(w),lC=lC.filter(function(ue){return ue!==b}),b.state.isMounted=!1,k("onHidden",[b]))}function He(){b.state.isDestroyed||(b.clearDelayTimeouts(),b.unmount(),re(),delete t._tippy,b.state.isDestroyed=!0,k("onDestroy",[b]))}}function dU(t,e){e===void 0&&(e={});var i=El.plugins.concat(e.plugins||[]);ske();var r=Object.assign({},e,{plugins:i}),n=ike(t),a=n.reduce(function(o,s){var l=s&&vke(s,r);return l&&o.push(l),o},[]);return sE(t)?a[0]:a}dU.defaultProps=El;dU.setDefaultProps=mke;dU.currentInput=su;Object.assign({},$re,{effect:function(e){var i=e.state,r={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,r.popper),i.styles=r,i.elements.arrow&&Object.assign(i.elements.arrow.style,r.arrow)}});dU.setDefaultProps({render:ene});function Qj(t){var i;const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===Nm?e.style.marginLeft="1em":e.style.marginRight="1em",t.intent&&e.classList.add(t.intent),(i=t.toolTip)!=null&&i.content&&dU(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=Hs),e}const Ike=({target:t})=>(e=[])=>{t.style.backgroundColor=e!=null&&e.length?"lightgray":p1;const i=(r,n,a)=>{const o=t.getElementsByClassName(`options_${r}`)[0];o&&(o.style.display=e!=null&&e.length?n:a)};i(d1,vU,Hs),i(zd,Hs,vU),i(Zi,Hs,vU),i(Nm,Hs,vU)};function yke(t){var v;const{table:e,targetClassName:i,items:r=[],onSelection:n}=t,a=!!t.target,o=t.target||i&&((v=document.getElementsByClassName(i))==null?void 0:v[0]);if(!o)return{};let s=0,l=0;const u={},c={};let d;if(a){Kp(o);const y=bke();Object.assign(u,y.elements),o.appendChild(y.anchor)}const p=Object.assign({},...[d1,zd,Zi,Nm,MV].map(y=>{var b;const I=(b=o.getElementsByClassName(`options_${y}`))==null?void 0:b[0];return Kp(I),{[y]:I}}).filter(Boolean)),m=Ike({target:o}),h=(y,I)=>{cu(I.onClick)&&(y.stopPropagation(),!I.disabled&&I.onClick(y,e),I.stateChange&&m())},f={onClick:()=>{},location:Nm};for(const y of r){const I={...f};m1(y)&&Object.assign(I,y);const b=p[I.location];if(!b){console.log(I.location,p);continue}if(I.location===d1&&(s+=1),I.location===MV){if(cu(I.headerClick)){const S=o.getElementsByClassName("panelHeader")[0];S&&(S.onclick=I.headerClick)}l+=1}if(!I.hide&&(I.input||I.placeholder||I.search)){const S=document.createElement("p");S.style.marginRight="1em",S.className=`control ${I.search?"has-icons-left has-icons-right":""}`;const w=document.createElement("input");if(I.focus&&(d=w),w.className="input font-medium",w.setAttribute("type","text"),w.setAttribute("autocomplete","cc-number"),w.setAttribute("placeholder",y.placeholder||p1),I.id&&(c[I.id]=w),I.id&&w.setAttribute("id",I.id),I.onKeyDown&&w.addEventListener("keydown",U=>I.onKeyDown(U,I)),I.onChange&&w.addEventListener("change",U=>I.onChange(U,I)),I.onKeyUp&&w.addEventListener("keyup",U=>{I.clearSearch&&U.key==="Escape"&&(U.stopPropagation(),w.value="",I.clearSearch()),I.onKeyUp(U,I)}),I.class&&w.classList.add(I.class),I.visible===!1&&(S.style.display=Hs),I.value&&(w.value=I.value),S.appendChild(w),I.search){const U=document.createElement("span");if(U.className="icon is-small is-left font-medium",U.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',S.appendChild(U),cu(I.clearSearch)){const T=document.createElement("span");T.className="icon is-small is-right font-medium",T.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',T.onclick=D=>{D.stopPropagation(),w.value="",I.clearSearch()},S.appendChild(T)}}if(y.validator){const U=document.createElement("p");U.className="help font-medium",S.appendChild(U),w.addEventListener("input",T=>jAe(y,T,w,U,y.validator))}I.id&&(u[I.id]=S,S.id=I.id),b==null||b.appendChild(S);continue}if(!I.hide&&I.text){const S=document.createElement("div");S.className="font-medium",I.id&&(u[I.id]=S,S.id=I.id),S.innerHTML=I.text,S.onclick=w=>h(w,I),b==null||b.appendChild(S);continue}if(!(!I.id&&(!(I!=null&&I.label)||I.hide))){if(I.options){const S=om({target:b,button:I,stateChange:m});I.visible===!1&&(S.style.display=Hs),I.id&&(u[I.id]=S)}else if(m1(I.selection)){const{selection:{options:S,actions:w},actionPlacement:U,threshold:T=8,...D}=I;if((S==null?void 0:S.length)<T){S.length&&(U===NV?S.unshift({divider:!0}):S.push({divider:!0})),w.forEach(R=>{const{label:N,...A}=R,M={...A,label:`<p style="font-weight: bold">${N}</p>`};U===NV?S.unshift(M):S.push(M)});const P={...D,options:S},E=om({target:b,button:P,stateChange:m});P.visible===!1&&(E.style.display=Hs),P.id&&(u[I.id]=E)}else{const P=Qj(I);P.onclick=E=>{E.stopPropagation()},I.id&&(u[I.id]=P),b==null||b.appendChild(P)}}else{const S=Qj(I);S.onclick=w=>h(w,I),I.id&&(u[I.id]=S),b==null||b.appendChild(S)}(!(I!=null&&I.label)||I.hide)&&(u[I.id].style.display=Hs)}}const g=o.getElementsByClassName("panelHeader")[0];return g&&(g.style.display=l?p1:Hs),e==null||e.on("rowSelectionChanged",(y,I)=>{cu(n)&&n(I),s&&m(I)}),m(),d&&setTimeout(()=>d.focus(),200),{elements:u,inputs:c}}function bke(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=Hs,t.appendChild(e);const i=document.createElement("div");i.className=tge,i.style.flexWrap="wrap-reverse;";const r={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};r.optionsOverlay.className="options_overlay",r.optionsCenter.className="options_center",r.optionsRight.className="options_right",r.optionsLeft.className="options_left";for(const n of Object.values(r))i.appendChild(n);return t.appendChild(i),{elements:r,anchor:t,header:e}}function wke(t){const e=Cbe(t),i=[{onKeyDown:n=>n.keyCode===8&&n.target.value.length===1&&e(""),onChange:n=>e(n.target.value),onKeyUp:n=>e(n.target.value),clearSearch:()=>e(""),placeholder:"Search tournaments",location:zd,search:!0}],r=document.getElementById(oG);yke({target:r,items:i})}function Uke(t){var u,c;const e=document.createElement("span"),i=document.createElement("table"),r=t.getValue();i.style.width="400px";const n="4em",a=document.createElement("tr"),o=r.tournamentImageURL||((c=(u=r.onlineResources)==null?void 0:u.find(({name:d,resourceType:p})=>d==="tournamentImage"&&p==="URL"))==null?void 0:c.identifier),s=o?`<img src='${o}' style='width: ${n}' alt=''>`:"",l=`<td style='min-width: ${n}'>${s}</td><td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${r.tournamentName}</strong></div><div style='margin-left: 1em'>${r.startDate} / ${r.endDate}</div></td>`;return a.innerHTML=l,i.appendChild(a),e.appendChild(i),e}function Ske(){return[{formatter:Uke,cellClick:(e,i)=>{const r=i.getRow().getData().tournamentId;if(r){const n=`/${L0}/${r}`;Om.router.navigate(n)}},field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3}]}function Tke({providerAbbr:t}){const e=s=>console.log("Network error",{error:s});let i;const r=({providerAbbr:s})=>{setTimeout(()=>{const u=c=>{var d;return((d=c==null?void 0:c.data)==null?void 0:d.calendar)&&i.replaceData(c.data.calendar)};Y1({providerAbbr:s}).then(u,e)},1e3)},n=Ske(),a=s=>{KD({anchorId:dC});const l=document.getElementById(dC);i=new Hb(l,{height:window.innerHeight*.9,placeholder:"No tournaments",index:"tournament.tournamentId",headerVisible:!1,layout:"fitColumns",reactiveData:!0,data:s,columns:n}),i.on("tableBuilt",()=>{wke(i)})},o=s=>{s.tournaments.sort((l,u)=>new Date(u.tournament.startDate).getTime()-new Date(l.tournament.startDate).getTime()),a(s.tournaments)};if(t){const s=l=>{var u;(u=l==null?void 0:l.data)!=null&&u.calendar&&o(l.data.calendar)};Y1({providerAbbr:t}).then(s,e)}return{table:i,replaceTableData:r}}function Dke({startDate:t,endDate:e}){const i=new Date(t),r=new Date(e),n=["January","February","March","April","May","June","July","August","September","October","November","December"],a=i.getDate()===r.getDate(),o=i.getFullYear()===r.getFullYear(),s=o&&i.getMonth()===r.getMonth(),l=u=>[u.getFullYear(),u.getMonth()+1,u.getDate()].join("/");return a&&o&&s?`${n[i.getMonth()]} ${i.getDate()}, ${i.getFullYear()}`:o&&s?`${n[i.getMonth()]} ${i.getDate()}-${r.getDate()}, ${i.getFullYear()}`:o?`${n[i.getMonth()]} ${i.getDate()} - ${n[r.getMonth()]} ${r.getDate()}, ${i.getFullYear()}`:`${l(i)} - ${l(r)}`}async function Pke(t){var o,s,l,u,c;const e=document.getElementById(une);Kp(e);const i=((o=t==null?void 0:t.data)==null?void 0:o.tournamentInfo)??{},r=(s=i.onlineResources)==null?void 0:s.find(d=>d.name==="tournamentImage"),n=document.getElementById(sG);if(r!=null&&r.identifier?n.innerHTML=`<img src="${r.identifier}" alt="${i.name}" style="max-height: 20em" />`:Kp(n),i.tournamentName){const d=document.getElementById(aG),p=`<h1>${i.tournamentName}</h1>`,m=`<h2>${Dke(i)}</h2>`;d.innerHTML=`${p}${m}`}const a=document.getElementById(iI("Info"));if(i.notes?(a.innerHTML=i.notes,J1("Info"),OE("Info")):(Kp(a),kE("Info")),(l=i.eventInfo)!=null&&l.length){const d=i.tournamentId,p=document.getElementById(iI("Events"));Kp(p);const m=document.createElement("div"),h=document.createElement("div");h.id="flightDisplay";const f=i.eventInfo.map(({eventId:b,eventName:S})=>({onClick:()=>Oj({tournamentId:d,eventId:b,header:m,flightDisplay:h,displayFormat:"roundsColumns"}),label:S,close:!0})),g={label:i.eventInfo[0].eventName,options:f,id:"eventButton",modifyLabel:!0,selection:!0,location:zd},y=om({button:g,stateChange:()=>{var b,S;(b=document.getElementById("structureButton"))==null||b.remove(),(S=document.getElementById("flightButton"))==null||S.remove()}}),I=i.eventInfo[0].eventId;m.className="block",m.appendChild(y),p.appendChild(m),p.appendChild(h),Oj({tournamentId:d,eventId:I,header:m,flightDisplay:h,displayFormat:"roundsColumns"}),OE("Events"),Om.tab||J1("Events")}else kE("Events");if((c=(u=i.publishState)==null?void 0:u.orderOfPlay)!=null&&c.published){const d=document.getElementById(iI("Schedule")),p=document.createElement("div");p.style.width="100%",p.className="block",p.id="scheduleHeader",d.appendChild(p);const m=document.createElement("div");m.id="tournamentSchedule",d.appendChild(m),OE("Schedule")}else kE("Schedule")}const Rke=""+new URL("courthive-transparent-logo-ScJ-jfxv.png",import.meta.url).href;function Eke(){document.querySelector(`#${Ey}`).innerHTML=`
  <div>
    <a href="https://courthive.com" target="_blank">
      <img src="${Rke}" class="logo" alt="Vite logo" />
    </a>
    <h1 class="name">CourtHive</h1>
  </div>
`}var Cke=/([:*])(\w+)/g,Mke="([^/]+)",Nke=/\*/g,Ake="?(?:.*)",Oke=/\/\?/g,kke="/?([^/]+|)",xke="(?:/^|^)",Fke="";function tne(t){return t===void 0&&(t="/"),IB()?location.pathname+location.search+location.hash:t}function Wr(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function k0(t){return typeof t=="string"}function Lke(t){return typeof t=="function"}function x0(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function _ke(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,r,n){return i===null&&(i={}),i[e[n]]=decodeURIComponent(r),i},null)}function F0(t){var e=Wr(t).split(/\?(.*)?$/);return[Wr(e[0]),e.slice(1).join("")]}function vB(t){for(var e={},i=t.split("&"),r=0;r<i.length;r++){var n=i[r].split("=");if(n[0]!==""){var a=decodeURIComponent(n[0]);e[a]?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(decodeURIComponent(n[1]||""))):e[a]=decodeURIComponent(n[1]||"")}}return e}function ine(t,e){var i=F0(Wr(t.currentLocationPath)),r=i[0],n=i[1],a=n===""?null:vB(n),o=[],s;if(k0(e.path)){if(s=xke+Wr(e.path).replace(Cke,function(d,p,m){return o.push(m),Mke}).replace(Nke,Ake).replace(Oke,kke)+"$",Wr(e.path)===""&&Wr(r)==="")return{url:r,queryString:n,hashString:x0(t.to),route:e,data:null,params:a}}else s=e.path;var l=new RegExp(s,Fke),u=r.match(l);if(u){var c=k0(e.path)?_ke(u,o):u.groups?u.groups:u.slice(1);return{url:Wr(r.replace(new RegExp("^"+t.instance.root),"")),queryString:n,hashString:x0(t.to),route:e,data:c,params:a}}return!1}function rne(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function Kh(t,e){return typeof t[e]>"u"||t[e]===!0}function $ke(t){if(!t)return{};var e=t.split(","),i={},r;return e.forEach(function(n){var a=n.split(":").map(function(o){return o.replace(/(^ +| +$)/g,"")});switch(a[0]){case"historyAPIMethod":i.historyAPIMethod=a[1];break;case"resolveOptionsStrategy":r||(r={}),r.strategy=a[1];break;case"resolveOptionsHash":r||(r={}),r.hash=a[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[a[0]]=a[1]==="true";break}}),r&&(i.resolveOptions=r),i}function IB(){return typeof window<"u"}function Bke(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(r){i[r]&&(e[r]||(e[r]=[]),e[r].push(i[r]))})}),e}function hu(t,e,i){var r=e||{},n=0;(function a(){if(!t[n]){i&&i(r);return}Array.isArray(t[n])?(t.splice.apply(t,[n,1].concat(t[n][0](r)?t[n][1]:t[n][2])),a()):t[n](r,function(o){typeof o>"u"||o===!0?(n+=1,a()):i&&i(r)})})()}hu.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function Zj(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=tne(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function uC(t,e){for(var i=0;i<t.instance.routes.length;i++){var r=t.instance.routes[i],n=ine(t,r);if(n&&(t.matches||(t.matches=[]),t.matches.push(n),t.resolveOptions.strategy==="ONE")){e();return}}e()}function Vke(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function jke(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var eG=IB(),Gke=rne();function Hke(t,e){if(Kh(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),r=eG&&t.resolveOptions&&t.resolveOptions.hash===!0;Gke?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",r?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!r){var n=location.hash;location.hash="",location.hash=n}t.instance.__freezeListening=!1},1))):eG&&(window.location.href=t.to)}e()}function nne(t,e){var i=t.instance;if(!i.lastResolved()){e();return}hu(i.lastResolved().map(function(r){return function(n,a){if(!r.route.hooks||!r.route.hooks.leave){a();return}var o=!1,s=t.instance.matchLocation(r.route.path,t.currentLocationPath,!1);if(r.route.path!=="*")o=!s;else{var l=t.matches?t.matches.find(function(u){return r.route.path===u.route.path}):!1;o=!l}if(Kh(t.navigateOptions,"callHooks")&&o){hu(r.route.hooks.leave.map(function(u){return function(c,d){return u(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return a()}]));return}else a()}}),{},function(){return e()})}function zke(t,e){t.match.route.hooks&&t.match.route.hooks.before&&Kh(t.navigateOptions,"callHooks")?hu(t.match.route.hooks.before.map(function(i){return function(n,a){return i(function(o){o===!1?t.instance.__markAsClean(t):a()},t.match)}}).concat([function(){return e()}])):e()}function Wke(t,e){Kh(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function qke(t,e){t.match.route.hooks&&t.match.route.hooks.after&&Kh(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function Yke(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(r){r.route.hooks&&r.route.hooks.already&&Kh(t.navigateOptions,"callHooks")&&r.route.hooks.already.forEach(function(n){return n(t.match)})}),e(!1);return}e()}function Kke(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var r=F0(t.currentLocationPath),n=r[0],a=r[1],o=x0(t.to);i.path=Wr(n);var s={url:i.path,queryString:a,hashString:o,data:null,route:i,params:a!==""?vB(a):null};t.matches=[s],t.match=s}e()}function Jke(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function Xke(t,e){t.instance._setCurrent(null),e()}function ane(t,e){Kh(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var one=[Yke,zke,Wke,qke],tG=[nne,Kke,hu.if(function(t){var e=t.notFoundHandled;return e},one.concat([ane]),[Jke,Xke])];function nN(){return nN=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},nN.apply(this,arguments)}function iG(t,e){var i=0;function r(){if(i===t.matches.length){ane(t,e);return}hu(one,nN({},t,{match:t.matches[i]}),function(){i+=1,r()})}nne(t,r)}function cC(t){t.instance.__markAsClean(t)}function aN(){return aN=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},aN.apply(this,arguments)}var rG="[data-navigo]";function Qke(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:rG},r=this,n="/",a=null,o=[],s=!1,l,u=rne(),c=IB();t?n=Wr(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d(F){return F.indexOf("#")>=0&&(i.hash===!0?F=F.split("#")[1]||"/":F=F.split("#")[0]),F}function p(F){return Wr(n+"/"+Wr(F))}function m(F,$,_,L){return F=k0(F)?p(F):F,{name:L||Wr(String(F)),path:F,handler:$,hooks:Bke(_)}}function h(F,$,_){var L=this;return typeof F=="object"&&!(F instanceof RegExp)?(Object.keys(F).forEach(function(B){if(typeof F[B]=="function")L.on(B,F[B]);else{var V=F[B],G=V.uses,j=V.as,z=V.hooks;o.push(m(B,G,[l,z],j))}}),this):(typeof F=="function"&&(_=$,$=F,F=n),o.push(m(F,$,[l,_])),this)}function f(F,$){if(r.__dirty){r.__waiting.push(function(){return r.resolve(F,$)});return}else r.__dirty=!0;F=F?Wr(n)+"/"+Wr(F):void 0;var _={instance:r,to:F,currentLocationPath:F,navigateOptions:{},resolveOptions:aN({},i,$)};return hu([Zj,uC,hu.if(function(L){var B=L.matches;return B&&B.length>0},iG,tG)],_,cC),_.matches?_.matches:!1}function g(F,$){if(r.__dirty){r.__waiting.push(function(){return r.navigate(F,$)});return}else r.__dirty=!0;F=Wr(n)+"/"+Wr(F);var _={instance:r,to:F,navigateOptions:$||{},resolveOptions:$&&$.resolveOptions?$.resolveOptions:i,currentLocationPath:d(F)};hu([Vke,jke,uC,hu.if(function(L){var B=L.matches;return B&&B.length>0},iG,tG),Hke,cC],_,cC)}function v(F,$,_){var L=E(F,$);return L!==null?(g(L.replace(new RegExp("^/?"+n),""),_),!0):!1}function y(F){return this.routes=o=o.filter(function($){return k0(F)?Wr($.path)!==Wr(F):Lke(F)?F!==$.handler:String($.path)!==String(F)}),this}function I(){u&&(this.__popstateListener=function(){r.__freezeListening||f()},window.addEventListener("popstate",this.__popstateListener))}function b(){this.routes=o=[],u&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=s=!0}function S(F,$){return r._notFoundRoute=m("*",F,[l,$],"__NOT_FOUND__"),this}function w(){if(c)return U().forEach(function(F){if(F.getAttribute("data-navigo")==="false"||F.getAttribute("target")==="_blank"){F.hasListenerAttached&&F.removeEventListener("click",F.navigoHandler);return}F.hasListenerAttached||(F.hasListenerAttached=!0,F.navigoHandler=function($){if(($.ctrlKey||$.metaKey)&&$.target.tagName.toLowerCase()==="a")return!1;var _=F.getAttribute("href");if(typeof _>"u"||_===null)return!1;if(_.match(/^(http|https)/)&&typeof URL<"u")try{var L=new URL(_);_=L.pathname+L.search}catch{}var B=$ke(F.getAttribute("data-navigo-options"));s||($.preventDefault(),$.stopPropagation(),r.navigate(Wr(_),B))},F.addEventListener("click",F.navigoHandler))}),r}function U(){return c?[].slice.call(document.querySelectorAll(i.linksSelector||rG)):[]}function T(F){return"/"+n+"/"+Wr(F)}function D(F){return l=F,this}function P(){return a}function E(F,$,_){var L=o.find(function(G){return G.name===F}),B=null;if(L){if(B=L.path,$)for(var V in $)B=B.replace(":"+V,$[V]);B=B.match(/^\//)?B:"/"+B}return B&&_&&!_.includeRoot&&(B=B.replace(new RegExp("^/"+n),"")),B}function R(F){return F.getAttribute("href")}function N(F){var $=F0(Wr(F)),_=$[0],L=$[1],B=L===""?null:vB(L),V=x0(F),G=m(_,function(){},[l],_);return{url:_,queryString:L,hashString:V,route:G,data:null,params:B}}function A(){return N(Wr(tne(n)).replace(new RegExp("^"+n),""))}function M(F){var $={instance:r,currentLocationPath:F,to:F,navigateOptions:{},resolveOptions:i};return uC($,function(){}),$.matches?$.matches:!1}function C(F,$,_){typeof $<"u"&&(typeof _>"u"||_)&&($=p($));var L={instance:r,to:$,currentLocationPath:$};Zj(L,function(){}),typeof F=="string"&&(F=typeof _>"u"||_?p(F):F);var B=ine(L,{name:String(F),path:F,handler:function(){},hooks:{}});return B||!1}function O(F,$,_){return typeof $=="string"&&($=k($)),$?($.hooks[F]||($.hooks[F]=[]),$.hooks[F].push(_),function(){$.hooks[F]=$.hooks[F].filter(function(L){return L!==_})}):(console.warn("Route doesn't exists: "+$),function(){})}function k(F){return typeof F=="string"?o.find(function($){return $.name===p(F)}):o.find(function($){return $.handler===F})}function x(F){F.instance.__dirty=!1,F.instance.__waiting.length>0&&F.instance.__waiting.shift()()}this.root=n,this.routes=o,this.destroyed=s,this.current=a,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=x,this.on=h,this.off=y,this.resolve=f,this.navigate=g,this.navigateByName=v,this.destroy=b,this.notFound=S,this.updatePageLinks=w,this.link=T,this.hooks=D,this.extractGETParameters=function(F){return F0(d(F))},this.lastResolved=P,this.generate=E,this.getLinkPath=R,this.match=M,this.matchLocation=C,this.getCurrentLocation=A,this.addBeforeHook=O.bind(this,"before"),this.addAfterHook=O.bind(this,"after"),this.addAlreadyHook=O.bind(this,"already"),this.addLeaveHook=O.bind(this,"leave"),this.getRoute=k,this._pathToMatchObject=N,this._clean=Wr,this._checkForAHash=d,this._setCurrent=function(F){return a=r.current=F},I.call(this),w.call(this)}var Zke={};function exe(){window.location.host.startsWith("localhost")||Zke.PUBLIC_URL;const t=document.getElementById("back"),e=!0,i=new Qke("/",{hash:e});return i.on("/",()=>{t.style.display="none",WU(Ey),Eke()}),i.on("/tournaments/:providerAbbr",({data:r})=>{t.style.display="none";const n=r.providerAbbr.toUpperCase();WU(oN),Tke({providerAbbr:n})}),i.on("/tournament/:tournamentId",({data:r})=>{t.style.display="block";const n=r.tournamentId;Om.tournamentId=n,WU(L0),uK({tournamentId:n}).then(Pke)}),i.notFound(()=>{i.navigate("/")}),i.resolve(),i}const txe=document.body;txe.appendChild(cbe());Ebe();Om.router=exe();
//# sourceMappingURL=index-DR-kT3Id.js.map
