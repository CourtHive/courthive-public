var Xre=Object.defineProperty;var Jre=(t,e,i)=>e in t?Xre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Ve=(t,e,i)=>(Jre(t,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const Jj="tournament_title_block",Zj="tournaments_control",lE="tournaments_table",Zre="tournament_events",Qj="tournament_logo",tN="tournaments",F0="tournament",Sy="splash",Qre=[tN,F0,Sy];var ene=Object.defineProperty,yt=(t,e)=>{for(var i in e)ene(t,i,{get:e[i],enumerable:!0})};function L0(){return"2.1.29"}var eG={};yt(eG,{competitionGovernor:()=>tG,drawsGovernor:()=>wT,entriesGovernor:()=>i4,eventGovernor:()=>u4,generationGovernor:()=>D4,matchUpFormatGovernor:()=>F4,matchUpGovernor:()=>L4,mocksGovernor:()=>Jk,participantGovernor:()=>MY,policyGovernor:()=>M6,publishingGovernor:()=>QY,queryGovernor:()=>k6,reportGovernor:()=>l5,scheduleGovernor:()=>cx,scoreGovernor:()=>FO,tieFormatGovernor:()=>b5,tournamentGovernor:()=>E5,venueGovernor:()=>j5});var tG={};yt(tG,{getLinkedTournamentIds:()=>Vy,getTournamentIds:()=>$y,linkTournaments:()=>Hz,mutate:()=>iG,query:()=>qz,unlinkTournament:()=>Wz,unlinkTournaments:()=>zz});var iG={};yt(iG,{linkTournaments:()=>Hz,unlinkTournament:()=>Wz,unlinkTournaments:()=>zz});var zp="SINGLES",ti="SINGLES",Ed="DOUBLES",Qt="DOUBLES",ka="TEAM",hi="TEAM",tne={SINGLES_MATCHUP:zp,SINGLES:ti,DOUBLES_MATCHUP:Ed,DOUBLES:Qt,TEAM_MATCHUP:ka,TEAM:hi},rG={[ti]:[ti,"S"],[Qt]:[Qt,"D"],[hi]:[hi,"T"],S:[ti,"S"],D:[Qt,"D"],T:[hi,"T"]};function or(t,e){return(t??0)-(e??0)}function Ze(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function Us(t){return isNaN(t)?!1:t&&(t&t-1)===0}function fB(t){if(!t.length)return;let e=[...t].sort(or),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function ine(t){if(!Us(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function iN(t){return isNaN(t)?0:t%2&&t+1||t}function rN(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Li(t){return!isNaN(parseFloat(t))}function nG(t){let e=Ze(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function Ug(t){if(isNaN(t))return!1;for(;!Us(t);)t++;return t}function to(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function ot(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function rne(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function nne(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function aG(t,e,i,r,n=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=aG(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),r&&(s=nne(s,r)),parseFloat(s.toFixed(n))}function uS(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function ct(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function ane(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function wn(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function wf(t){return ot(t)?t:1/0}function wa(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function one(t){return oG(wa(t))}function oG(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function sne(t,e,i){return i.indexOf(t)===e}function sG(t){return t.filter(sne)}function fa(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function pa(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Se(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function js(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function Vi(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function gB(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function Rn(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function lne(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function une(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function Pr(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function lG(t,[e,...i]){return t.length?[t.slice(0,e),...lG(t.slice(e),[...i,e])]:[]}function cne(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function uG(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function cG(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function uE(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let o=i?!!(Math.floor(a/e)%2):!1,s=a%e,l=o?e-1-s:s;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function dne(t,e=1){if(!Array.isArray(t)||!t.every(ot))return[];let i=Math.min(...t,e),r=Math.max(...t);return Se(i,r+1).filter(n=>!t.includes(n))}function ma(t){return typeof t=="function"}function Ti(t){return typeof t=="string"}function Nt(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function pne(t,e){if(!Nt(t)||!Nt(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function dG(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(Nt).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var mne=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function cE(t,e){if(t===void 0)return null;if(!Nt(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>cE(a))}:{[n]:e?r(t[n]):cE(t[n])}))}function dE(t){return Array.isArray(t)?t.length+t.map(dE).reduce((e,i)=>e+i,0):Nt(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>dE(t[e])).reduce((e,i)=>e+i,0):0}function hne(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=dE(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function _0(t,e){return!Array.isArray(t)||!Ti(e)?!1:Vi(t,rG[e]).length}var J={success:!0},pG="error",fne={SUCCESS:J,ERROR:pG};function mG({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:o}=n;if(typeof a!="number"||typeof o!="number"||o>e||o<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==ct(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...J}}var gne={};yt(gne,{addNotice:()=>lt,callListener:()=>wE,createInstanceState:()=>Jne,cycleMutationStatus:()=>AN,deepCopyEnabled:()=>NN,deleteNotice:()=>ON,deleteNotices:()=>Ey,disableNotifications:()=>TH,enableNotifications:()=>PU,getDevContext:()=>Fa,getMethods:()=>RH,getNotices:()=>CH,getProvider:()=>UE,getTopics:()=>vo,getTournamentId:()=>Hm,getTournamentRecord:()=>kN,getTournamentRecords:()=>zm,globalLog:()=>NH,handleCaughtError:()=>tT,hasTopic:()=>Q0,removeTournamentRecord:()=>MH,setDeepCopy:()=>yI,setDevContext:()=>II,setGlobalLog:()=>SH,setGlobalMethods:()=>DH,setGlobalSubscriptions:()=>Qne,setMethods:()=>PH,setStateMethods:()=>AH,setStateProvider:()=>Xne,setSubscriptions:()=>eae,setTournamentId:()=>bI,setTournamentRecord:()=>EH,setTournamentRecords:()=>eT,timeKeeper:()=>Zne});var pE={message:"Chronological error; time violation.",code:"ANACHRONISM"},gI={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},hG={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},mE={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Oi={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},ge={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},Ty={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},Uf={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Wp={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},_e={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},fG={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},xa={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},op={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},nN={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},aN={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},Sf={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},gG={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},vG={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},vne={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},oN={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},Dy={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},$0={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},Ine={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},Sg={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},Tg={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},sN={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},B0={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},lN={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},Py={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},ks={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},IG={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},yG={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},bG={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},wG={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},UG={message:"Invalid action",code:"ERR_INVALID_ACTION"},hE={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},SG={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},TG={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},DG={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},uN={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},PG={message:"Existing round",code:"ERR_EXISTING_ROUND"},yne={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},za={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Ei={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},cN={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},sp={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},RG={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Ll={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},gi={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},lo={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},CG={message:"Event exists",code:"ERR_EXISTING_EVENT"},EG={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},MG={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},dN={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},NG={message:"Missing stage",code:"ERR_MISSING_STAGE"},lp={message:"Invalid stage",code:"ERR_INVALID_STAGE"},AG={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},OG={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},kG={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},fE={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},Ry={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},TU={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},Dg={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Dl={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},pN={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},mN={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},xG={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},Pg={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},yn={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},$m={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},dn={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Bu={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},na={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},aa={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},hN={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},V0={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},bne={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},FG={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},fN={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},LG={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},gN={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},wne={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},qp={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},Une={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},vN={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},Sne={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},j0={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},Tne={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},Dne={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},Bm={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Xe={message:"Missing value",code:"ERR_MISSING_VALUE"},_G={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},$G={message:"Missing date",code:"ERR_MISSING_DATE"},BG={message:"No valid dates",code:"ERR_NO_VALID_DATES"},cS={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},DU={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},VG={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Nr={message:"Invalid Date",code:"ERR_INVALID_DATE"},Mo={message:"Invalid time",code:"ERR_INVALID_TIME"},jG={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},gE={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},GG={message:"Invalid score",code:"ERR_INVALID_SCORE"},G0={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},Pne={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},IN={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},HG={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},H0={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},vE={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},z0={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Vm={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Ss={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},va={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},zG={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Ts={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},WG={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},jm={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},Cy={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},pr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},zi={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},qG={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},Rne={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},YG={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Vc={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},KG={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},XG={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},JG={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},Rg={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},W0={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},yN={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},IE={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},ZG={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},Cne={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},Ene={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},QG={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},eH={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},yE={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},tH={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},bN={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},iH={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},wN={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},Tf={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},rH={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},Cg={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},nH={message:"Court exists",code:"ERR_EXISTING_COURT"},aH={message:"Venue exists",code:"ERR_EXISTING_VENUE"},Gm={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},jc={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},oH={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},UN={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},sH={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},lH={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},Mne={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},SN={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},uH={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},TN={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},DN={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},q0={message:"Missing context",code:"ERR_MISSING_CONTEXT"},cH={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},hm={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},dH={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},Eg={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},pH={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},Y0={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},mH={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},hH={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Vu={message:"Invalid object",code:"ERR_INVALID_OBJECT"},Gv={message:"Invalid gender",code:"ERR_INVALID_GENDER"},vI={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},oe={message:"Invalid values",code:"ERR_INVALID_VALUES"},fH={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},PN={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},gH={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},K0={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},RN={message:"Value unchanged",code:"ABORT_UNCHANGED"},_r={message:"Not found",code:"ERR_NOT_FOUND"},X0={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},vH={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},CN={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},IH={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},yH={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},bE={message:"Existing stage",code:"ERR_EXISTING_STAGE"},EN={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},J0={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},bH={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},Z0={message:"Scores present",code:"ERR_SCORES_PRESENT"},Nne={ANACHRONISM:pE,CANNOT_CHANGE_WINNING_SIDE:z0,CANNOT_MODIFY_TIEFORMAT:IN,CANNOT_MODIFY_PARTICIPANT_TYPE:HG,CANNOT_REMOVE_MAIN_STRUCTURE:hG,CANNOT_REMOVE_PARTICIPANTS:H0,CATEGORY_MISMATCH:vE,COURT_EXISTS:nH,COURT_NOT_FOUND:Cg,DRAW_DEFINITION_NOT_FOUND:xa,DRAW_ID_EXISTS:IG,DRAW_POSITION_ACTIVE:$0,DRAW_POSITION_ASSIGNED:Sf,DRAW_POSITION_NOT_CLEARED:vG,DRAW_POSITION_NOT_FOUND:vne,DRAW_SIZE_MISMATCH:lN,DUPLICATE_ENTRY:gI,DUPLICATE_VALUE:fH,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:eH,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:QG,EVENT_EXISTS:CG,EVENT_NOT_FOUND:lo,EXISTING_DRAW_DEFINITIONS:fG,EXISTING_END_TIME:UN,EXISTING_FLIGHT:vH,EXISTING_MATCHUP_ID:yH,EXISTING_OUTCOME:IH,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:Rg,EXISTING_PARTICIPANT:W0,EXISTING_POLICY_TYPE:gN,EXISTING_PROFILE:CN,EXISTING_ROUND:PG,EXISTING_STAGE:bE,EXISTING_STRUCTURE:EN,INCOMPATIBLE_MATCHUP_STATUS:TU,INCOMPLETE_SOURCE_STRUCTURE:nN,INSUFFICIENT_DRAW_POSITIONS:bN,INVALID_ACTION:UG,INVALID_ASSIGNMENT:hE,INVALID_BOOKINGS:cS,INVALID_CATEGORY:vI,INVALID_COLLECTION_DEFINITION:hH,INVALID_CONFIGURATION:mH,INVALID_DATE_AVAILABILITY:DU,INVALID_DATE:Nr,INVALID_DRAW_DEFINITION:Wp,INVALID_DRAW_POSITION_FOR_SEEDING:aN,INVALID_DRAW_POSITION:Sg,INVALID_DRAW_SIZE:B0,INVALID_END_TIME:oH,INVALID_ENTRIES:MG,INVALID_EVENT_TYPE:Ll,INVALID_GAME_SCORES:gE,INVALID_GENDER:Gv,INVALID_MATCHUP_FORMAT:pN,INVALID_MATCHUP_STATUS:Dg,INVALID_MATCHUP_STATUS_BYE:kG,INVALID_MATCHUP:aa,INVALID_OBJECT:Vu,INVALID_PARTICIPANT_ID:Ss,INVALID_PARTICIPANT_IDS:va,INVALID_PARTICIPANT_ROLE:zG,INVALID_PARTICIPANT_SEEDING:yG,INVALID_PARTICIPANT_TYPE:Ts,INVALID_PARTICIPANT:Vm,INVALID_POLICY_DEFINITION:LG,INVALID_RECORDS:mE,INVALID_SCALE_ITEM:hm,INVALID_SEED_NUMBER:TG,INVALID_SEED_POSITION:DG,INVALID_SET_NUMBER:Sne,INVALID_SIDE_NUMBER:vN,INVALID_SCORE:GG,INVALID_STAGE:lp,INVALID_START_TIME:lH,INVALID_STRUCTURE:op,INVALID_STOP_TIME:sH,INVALID_TIE_FORMAT:Dl,INVALID_TIME:Mo,INVALID_TIME_ITEM:SN,INVALID_TOURNAMENT_DATES:jG,INVALID_TOURNAMENT_RECORD:Ty,INVALID_VALUES:oe,INVALID_WINNING_SIDE:G0,MATCHUP_NOT_FOUND:dn,METHOD_NOT_FOUND:J0,MISSING_ASSIGNMENTS:dN,MISSING_ASYNC_STATE_PROVIDER:uH,MISSING_AVOIDANCE_POLICY:FG,MISSING_BIRTH_DATE:_G,MISSING_COLLECTION_DEFINITION:xG,MISSING_COURT_ID:Bm,MISSING_COURTS_INFO:rH,MISSING_DATE_AVAILABILITY:VG,MISSING_DATE:$G,MISSING_DRAW_DEFINITION:_e,MISSING_DRAW_ID:ks,MISSING_DRAW_POSITION:Tg,MISSING_DRAW_POSITIONS:Dy,MISSING_DRAW_SIZE:Py,MISSING_ENTRIES:EG,MISSING_EVENT:gi,MISSING_MATCHUP_FORMAT:mN,MISSING_MATCHUP_ID:yn,MISSING_MATCHUP_IDS:$m,MISSING_MATCHUP:na,MISSING_MATCHUPS:Bu,MISSING_PARTICIPANT_COUNT:KG,MISSING_PARTICIPANT_ID:pr,MISSING_PARTICIPANT_IDS:Vc,MISSING_PARTICIPANT_ROLE:WG,MISSING_PARTICIPANT:jm,MISSING_PARTICIPANTS:Cy,MISSING_PENALTY_ID:wN,MISSING_PENALTY_TYPE:iH,MISSING_PERSON_DETAILS:JG,MISSING_POLICY_ATTRIBUTES:fN,MISSING_POLICY_DEFINITION:V0,MISSING_POLICY_TYPE:hN,MISSING_POSITION_ASSIGNMENTS:OG,MISSING_ROUND_NUMBER:yne,MISSING_SCHEDULE:cH,MISSING_SCORING_POLICY:Une,MISSING_SEED_ASSIGNMENTS:SG,MISSING_SEEDCOUNT_THRESHOLDS:wG,MISSING_SEEDING_POLICY:bne,MISSING_SET_NUMBER:Tne,MISSING_SET_OBJECT:j0,MISSING_SIDE_NUMBER:Dne,MISSING_STAGE:NG,MISSING_STRUCTURE_ID:za,MISSING_STRUCTURE:sp,MISSING_STRUCTURES:cN,MISSING_TARGET_LINK:uN,MISSING_TIE_FORMAT:Pg,MISSING_TIME_ITEM:TN,MISSING_TIME_ITEMS:DN,MISSING_TOURNAMENT_ID:Uf,MISSING_TOURNAMENT_RECORD:ge,MISSING_TOURNAMENT_RECORDS:Oi,MISSING_VALUE:Xe,MISSING_VENUE_ID:jc,MODIFICATIONS_FAILED:dH,NO_CANDIDATES:Y0,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:tH,NO_MODIFICATIONS_APPLIED:Eg,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:yE,NO_PARTICIPANT_REMOVED:YG,NO_VALID_ACTIONS:gH,NO_VALID_ATTRIBUTES:K0,NO_VALID_DATES:BG,NOT_FOUND:_r,NOT_IMPLEMENTED:X0,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:yN,PARTICIPANT_ID_EXISTS:qG,PARTICIPANT_NOT_CHECKED_IN:XG,PARTICIPANT_NOT_FOUND:zi,PARTICIPANT_PAIR_EXISTS:Rne,PENALTY_NOT_FOUND:Tf,POLICY_NOT_ATTACHED:wne,POLICY_NOT_FOUND:qp,SCHEDULE_NOT_CLEARED:gG,SCHEDULED_MATCHUPS:bH,SCORES_PRESENT:Z0,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:bG,STAGE_SEQUENCE_LIMIT:AG,STRUCTURE_NOT_FOUND:Ei,TEAM_NOT_FOUND:PN,UNABLE_TO_ASSIGN_COURT:pH,UNLINKED_STRUCTURES:RG,UNRECOGNIZED_DRAW_TYPE:oN,UNRECOGNIZED_MATCHUP_FORMAT:Ry,UNRECOGNIZED_MATCHUP_STATUS:fE,VALUE_UNCHANGED:RN,VENUE_EXISTS:aH},Pi={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},wH={addNotice:Gne,callListener:Yne,cycleMutationStatus:jne,deleteNotice:Wne,deleteNotices:zne,disableNotifications:Ane,enableNotifications:One,getMethods:MN,getNotices:Hne,getTopics:qne,getTournamentId:UH,getTournamentRecord:kne,getTournamentRecords:xne,removeTournamentRecord:$ne,setMethods:Vne,setSubscriptions:Bne,setTournamentId:Lne,setTournamentRecord:Fne,setTournamentRecords:_ne,handleCaughtError:Kne};function Ane(){Pi.disableNotifications=!0}function One(){Pi.disableNotifications=!1}function UH(){return Pi.tournamentId}function kne(t){return Pi.tournamentRecords[t]}function xne(){return Pi.tournamentRecords}function Fne(t){let e=t==null?void 0:t.tournamentId;return e?(Pi.tournamentRecords[e]=t,{success:!0}):{error:Ty}}function Lne(t){return t?Pi.tournamentRecords[t]?(Pi.tournamentId=t,{success:!0}):{error:ge}:(Pi.tournamentId=void 0,{success:!0})}function _ne(t){Pi.tournamentRecords=t;let e=Object.keys(t);e.length===1?Pi.tournamentId=e[0]:e.length||(Pi.tournamentId=void 0)}function $ne(t){if(typeof t!="string")return{error:oe};if(!Pi.tournamentRecords[t])return{error:_r};delete Pi.tournamentRecords[t];let e=Object.keys(Pi.tournamentRecords);return e.length===1?Pi.tournamentId=e[0]:e.length||(Pi.tournamentId=void 0),{success:!0}}function Bne(t){return typeof t.subscriptions!="object"?{error:oe}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?Pi.subscriptions[e]=t.subscriptions[e]:delete Pi.subscriptions[e]}),{...J})}function Vne(t){return typeof t!="object"?{error:oe}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(Pi.methods[e]=t[e])}),{...J})}function jne(){let t=Pi.modified;return Pi.modified=!1,t}function Gne({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(Pi.disableNotifications||(Pi.modified=!0),!(Pi.disableNotifications||!Pi.subscriptions[t]&&!r)))return i&&(Pi.notices=Pi.notices.filter(n=>!(n.topic===t&&n.key===i))),Pi.notices.push({topic:t,payload:e,key:i}),{...J}}function MN(){return Pi.methods??{}}function Hne({topic:t}){return Pi.notices.filter(e=>e.topic===t).map(e=>e.payload)}function zne(){Pi.notices=[]}function Wne({topic:t,key:e}){Pi.notices=Pi.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function qne(){return{topics:Object.keys(Pi.subscriptions)}}function Yne({topic:t,notices:e},i){let r=Pi.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i==null?void 0:i[t];n&&typeof n=="function"&&n(e)}function Kne({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:UH(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var ri={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},$r=wH,vB=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function Xne(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Vi(Object.keys(t),vB).length!==vB.length)throw new Error("Global state provider is missing required methods");return $r=t,{success:!0}}function Jne(){if($r.createInstanceState){try{$r.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:uH}}function Fa(t){return!t||typeof t!="object"?ri.devContext??!1:typeof ri.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=ri.devContext)==null?void 0:i[e])===t[e]})&&ri.devContext}function Zne(t="reset",e="default"){var r,n;let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(ri.timers).filter(a=>a!=="default"||ri.timers[a].startTime).map(a=>{let o=ri.timers[a],s=o.state==="stopped"?0:(i-((o==null?void 0:o.startTime)??0))/1e3,l=o.elapsedTime+s;return{state:ri.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=ri.timers[e].state==="stopped"?0:(i-(((r=ri.timers[e])==null?void 0:r.startTime)??0))/1e3,o=ri.timers[e].elapsedTime+a;return{state:ri.timers[e].state,elapsedTime:o.toFixed(2),timer:e}}}if(!ri.timers[e]||t==="reset"){if(e==="allTimers")return ri.timers={default:{elapsedTime:0}},!0;ri.timers[e]={startTime:i,state:"active",elapsedTime:0}}return ri.timers[e].elapsedTime||(ri.timers[e].elapsedTime=0),t==="stop"&&ri.timers[e].state!=="stopped"&&(ri.timers[e].state="stopped")&&(ri.timers[e].elapsedTime+=(i-(((n=ri.timers[e])==null?void 0:n.startTime)??0))/1e3),t==="start"&&(ri.timers[e].startTime=i)&&(ri.timers[e].state="active"),ri.timers[e]}function SH(t){ma(t)?ri.globalLog=t:delete ri.globalLog}function II(t){ri.devContext=t}function TH(){$r.disableNotifications()}function PU(){$r.enableNotifications()}function yI(t,e){typeof t=="boolean"&&(ri.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(ri.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(ri.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(ri.deepCopyAttributes.stringify=e.stringify),e.threshold&&(ri.deepCopyAttributes.threshold=e.threshold))}function NN(){return{enabled:ri.deepCopy,...ri.deepCopyAttributes}}function Qne(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{ri.globalSubscriptions[e]=t.subscriptions[e]}),{...J}):{error:Xe,info:"missing subscriptions"}}function eae(t){return t!=null&&t.subscriptions?$r.setSubscriptions({subscriptions:t.subscriptions}):{error:Xe,info:"missing subscriptions"}}function DH(t){return t?typeof t!="object"?{error:oe}:(Object.keys(t).forEach(e=>{ma(t[e])&&(ri.globalMethods[e]=t[e])}),{...J}):{error:Xe,info:"missing method declarations"}}function PH(t){return t?typeof t!="object"?{error:oe}:$r.setMethods(t):{error:Xe,info:"missing method declarations"}}function AN(){return $r.cycleMutationStatus()}function lt(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=ri.globalSubscriptions[t.topic];return $r.addNotice(t,e)}function RH(){return{...ri.globalMethods,...$r.getMethods()}}function CH(t){return $r.getNotices(t)}function ON({key:t,topic:e}){return $r.deleteNotice({key:t,topic:e})}function Ey(){return $r.deleteNotices()}function vo(){return $r.getTopics()}function Q0(t){var e,i;return(i=(e=vo())==null?void 0:e.topics)==null?void 0:i.includes(t)}async function wE(t){return $r.callListener(t,ri.globalSubscriptions)}function Hm(){return $r.getTournamentId()}function kN(t){return $r.getTournamentRecord(t)}function zm(){return $r.getTournamentRecords()}function EH(t){return $r.setTournamentRecord(t)}function eT(t){return $r.setTournamentRecords(t)}function bI(t){return $r.setTournamentId(t)}function MH(t){return $r.removeTournamentRecord(t)}function UE(){return $r}function tT({engineName:t,methodName:e,params:i,err:r}){let n=ma($r.handleCaughtError)&&$r.handleCaughtError||wH.handleCaughtError,{tournamentRecord:a,...o}=i;return n({params:o,engineName:t,methodName:e,err:r})}function NH(t,e){if(ri.globalLog)try{ri.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),SH()}else console.log(e,t)}function AH(t,e,i,r){if(!Nt(t))return{error:oe};Li||(i=1);let n=Array.isArray(e)?e:[],a={},o=(s,l=0)=>{Object.keys(s).forEach(u=>{ma(s[u])?a[u]=s[u]:Nt(s[u])&&(e===!0||n!=null&&n.includes(u))&&(i===void 0||l<i)&&o(s[u],l+1)})};return o(t),r?DH(a):PH(a),{methods:a}}function tae(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function Ge(t,e,i,r){var o;if(typeof t!="object"||t===null)return t;(o=NN())!=null&&o.enabled||(r=!0);let n=["",void 0,null];e&&n.push(!1);let a=tae(t,n,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(l=>Ge(l))}:{[s]:r?t[s]:Ge(t[s])}))}function ee({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,Ge(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...J}),e??{success:!0}}var Ds="ANY",Jt="MALE",Bn="MIXED",wd="OTHER",pi="FEMALE",iT={ANY:Ds,MALE:Jt,FEMALE:pi,MIXED:Bn,OTHER:wd},iae="MIXED events can not contain mixed singles or { gender: ANY } collections",rae="events with { gender: ANY } can not contain MIXED singles collections";function rT(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&[Jt,pi].includes(i)&&i!==n?ee({result:{valid:!1,error:Gv},context:{gender:n},stack:e}):i===Bn&&(n===Ds||n===Bn&&r!==Qt)?ee({result:{error:Gv,valid:!1},info:iae,stack:e}):i===Ds&&n===Bn&&r!==Qt?ee({result:{error:Gv,valid:!1},info:rae,stack:e}):{valid:!0}}var nae="normal",IB="timed",aae="final",xN="NOAD",RU="SET",oae={S:nae,F:aae};function nT(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&(t!=null&&t.setFormat))return sae(t,e)}function wI(t){return!isNaN(Number(t))&&Number(t)}function OH(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function sae(t,e){var c;let i=wI(t.bestOf)||void 0,r=wI(t.exactly)||void 0,n=i||r;if((c=t.setFormat)!=null&&c.timed&&t.simplified&&n===1)return OH(t.setFormat);let a=n&&`${RU}${n}`||"",o=yB(t.setFormat,e),s=o&&`S:${o}`||"",l=yB(t.finalSetFormat,e),u=n&&n>1&&l&&o!==l&&`F:${l}`||"";if(a&&o)return[a,s,u].filter(d=>d).join("-")}function yB(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return OH(t);if(t.tiebreakSet)return bB(t.tiebreakSet);let i=wI(t.setTo);if(i){let r=t.NoAD&&xN||"",n=bB(t.tiebreakFormat),a=n&&`/${n}`||"",o=wI(t.tiebreakAt),s=o&&(o!==i||e)&&`@${o}`||"";if(n!==!1)return`${i}${r}${a}${s}`}}}function bB(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&wI(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?xN:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function kn(t){if(Ti(t)){let e=t.startsWith("T")&&IB||t.startsWith(RU)&&RU||"";if(e===IB){let i=xH(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e===RU)return lae(t)}}function lae(t){let e=t.split("-"),i=My(e[0].slice(3)),r=i===1||i%2!==0?i:void 0,n=i!==1&&i%2===0?i:void 0,a=e&&wB(e[1]),o=e&&wB(e[2]),s=a&&a.timed||o&&o.timed,l=r&&r<6||s&&n,u=!e[2]||o,c=a,d=Ge({setFormat:a,exactly:n,bestOf:r});if(o&&(d.finalSetFormat=o),l&&c&&u)return d}function wB(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=oae[e[0]],r=e[1];if(i&&r){if(r.startsWith("TB")){let h=UB(r);return h===!1?!1:typeof h=="object"?{tiebreakSet:h}:void 0}if(r.startsWith("T"))return xH(r);let n=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=n&&FH(n[2])||!1,o=!(n!=null&&n[2])||a,s=n?My(n[1]):void 0,l=kH(r),u=l!==!1,c=u&&l||s,d=UB(r.split("/")[1]),p=d!==!1,m={setTo:s};return a&&(m.NoAD=!0),d?(m.tiebreakFormat=d,m.tiebreakAt=c):m.noTiebreak=!0,s&&o&&p&&u&&m||!1}}}function kH(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?My(i[1]):i[1])||!1}function UB(t){if(t)if(t.startsWith("TB")){let e=kH(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),r=i==null?void 0:i[1],n=i&&FH(i[2]),a=!(i!=null&&i[2])||n,o=My(r);if(o&&a){let s={tiebreakTo:o};return e&&typeof e=="string"&&!ot(e)&&(s.modifier=e),n&&(s.NoAD=!0),s}else return!1}else return!1}function xH(t){var s;let e=t.slice(1),i=e.match(/^(\d+)(@?[A-Za-z]*)/),r=My(i==null?void 0:i[1]);if(!r)return;let n={timed:!0,minutes:r},a=i==null?void 0:i[2],o=[void 0,"P","G"].includes(a);if(a&&!o){let l=(s=e.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:s[3];return l?(n.modifier=l,n):void 0}return a&&(n.based=i[2]),n}function FH(t){return t&&t.indexOf(xN)>=0}function My(t){return isNaN(Number(t))?0:Number(t)}function Ua({matchUpFormat:t}){if(!Ti(t)||t==="")return!1;let e=kn(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),r=i==null?void 0:i[1],n=i==null?void 0:i[2],a=i==null?void 0:i[3],o=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o==null?void 0:o[1],l=o==null?void 0:o[2],u=o==null?void 0:o[3];return nT(e,!!(i&&n&&r===a||o&&l&&s===u))===t}var dS=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,LH=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Zs=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Ud=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function pS(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=pt(t.scheduledTime)),!e)return;let i=bi(t.scheduledTime),r=pt(e);return r&&i&&(r+=`T${i}`),r}function uae(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function Mg(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Ud.test(Wm(t,!0,!0)))}function Ia(t){return Md(t)||dS.test(t)}function cae(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return dae(i,{displaySeconds:!1})}function dae(t,e){let i=parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e!=null&&e.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(no).join(":")}var FN=t=>{let e=UI(t)||Md(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${no(r)}-${no(e.getUTCDate())}`};function pae(t){let e=UI(t)||Md(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function $o(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),o=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,o].join(e):i==="MDY"?[n,a,o].join(e):i==="YDM"?[o,a,n].join(e):i==="DYM"?[a,o,n].join(e):i==="MYD"?[n,o,a].join(e):[o,n,a].join(e)}function mS(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function mae(t){return mS(t).getTime()}function UI(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function Df(t,e){if(!Ia(t)||!Ia(e))return[];let i=pt(t)+"T00:00",r=pt(e)+"T00:00",n=new Date(i),a=new Date(r),o=UI(a)&&UI(n)&&u(n,a),s=[],l=0;if(o){let c=n,d=c.getTime();for(;d<=a.getTime()&&l<300;)l+=1,s.push(new Date(c)),d=c.setDate(c.getDate()+1)}return s.map(c=>$o(c));function u(c,d){return c<=d}}var hae=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Md(t){return typeof t!="string"?!1:hae.test(t)}function LN(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!isNaN(parseInt(r)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function kt(t){let e=bi(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>parseInt(n));return i*60+r}function fae(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[no(e),no(i)].join(":")}function hS(t){return LN(t)?t.split(":").slice(0,2).map(no).join(":"):void 0}function bi(t){return Md(t)&&t.indexOf("T")>0?hS(t.split("T").reverse()[0]):hS(t)}function pt(t){return Md(t)||Zs.test(t)?t.split("T")[0]:void 0}function Bv(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),pt(i.toISOString())}function fS(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function gae(t){let e=fS(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(no).join(":")}function vae(t){var i;let e=fS(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),((i=e.hours)==null?void 0:i[0])==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function Wm(t,e,i){let r=pt(t),n=bi(t),a=r?n:t;return t?e&&(r&&i&&t||gae(a))||vae(a):void 0}function _H(t,e){let i=fS(t),r=fS(e);if(parseInt(i.hours)<parseInt(r.hours))return-1;if(parseInt(i.hours)>parseInt(r.hours))return 1;if(i.hours===r.hours){if(parseInt(i.minutes)<parseInt(r.minutes))return-1;if(parseInt(i.minutes)>parseInt(r.minutes))return 1}return 0}function _N(t,e=7){let i=pt(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return $o(n)}function Iae(t){return _N(t)}function yae(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),$o(n,i)}function bae(t,e,i){let r=new Date(t,0);return $o(new Date(r.setDate(e)),i)}function ir(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(no),n=mS(e).setHours(i,r,0,0);return mS(n)}function Ny(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function ia(t,e){let i=bi(t);if(!i)return"00:00";let r=isNaN(e)?0:e;return bi($N(ir(i),r).toISOString())}function $N(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function no(t){return t.toString()[1]?t:"0"+t}function _l(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var $H={addDays:_N,addWeek:Iae,addMinutesToTimeString:ia,convertTime:Wm,getIsoDateString:pS,getUTCdateString:FN,DateHHMM:cae,extractDate:pt,extractTime:bi,formatDate:$o,getDateByWeek:yae,isISODateString:Md,isDate:UI,isTimeString:LN,offsetDate:mS,offsetTime:mae,sameDay:_l,timeStringMinutes:kt,timeToDate:ir,timeUTC:pae,validTimeValue:Mg,validDateString:dS,timeValidation:Ud,dateValidation:Zs},wae=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),Uae=t=>t.filter(Boolean).every(Li);function fm(t){let e=t.category;if(typeof e!="object")return{error:vI};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o}=e,s=e.categoryName,l;if(!wae([i,r,n,s],"string")||!Uae([a,o]))return{error:vI};let u=t.consideredDate??pt(new Date().toLocaleDateString("sv"));if(!Ia(u))return{error:Nr};let[c]=u.split("-").slice(0,3).map(x=>parseInt(x)),d=Bv(u,-1),[p,m]=d.split("-").slice(1,3).map(x=>parseInt(x)),h=`${no(p)}-${no(m)}`,f=Bv(u,1),[g,v]=f.split("-").slice(1,3).map(x=>parseInt(x)),y=`${no(g)}-${no(v)}`,I=o&&Bv(u,-1*365*o),b=a&&Bv(u,-1*365*a),S=[],w=x=>!S.includes(x)&&S.push(x);i=i??s;let U=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,D=i==null?void 0:i.includes("-"),P=D&&(i==null?void 0:i.match(T)),C=i==null?void 0:i.match(U),R=(x,F)=>`${x}-${F}`,N=x=>{let F=c-x,$=R(F,y);e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x-1&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=x-1)},A=x=>{let F=c-x-1,$=R(F,y);e.ageMin&&e.ageMin>x&&w(`Invalid submitted ageMin: ${o}`),e.ageMax&&e.ageMax>x&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=x)},M=x=>{let F=c-x,$=R(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x+1&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=x+1)},E=x=>{let F=c-x-1,$=R(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=x)},O=x=>{let[F,$,_]=(x.match(U)||[]).slice(1),L=parseInt($);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(L)):F==="O"&&M(L),_==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),A(L)):_==="O"&&E(L),r=r??I,n=n??b};if(P){if(r=void 0,n=void 0,a=void 0,o=void 0,e.ageMin){let $=c-e.ageMin;r=R($,h)}if(e.ageMax){let $=c-e.ageMax-1;n=R($,y)}let[x,F]=((i==null?void 0:i.match(T))??[]).slice(1).map($=>parseInt($));x<=F?(o=x,a=F,l=!0):w(`Invalid combined age range ${i}`)}else D?i==null||i.split("-").forEach(O):C?O(i):(o&&M(o),a&&A(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),o=void 0);let k=Ge({consideredDate:u,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o});return S.length&&(k.errors=S),k}function SI({category:t}){if(!Nt(t))return{error:oe};let e=fm({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!Li(i)?ee({result:{error:oe},context:{ratingMax:i}}):r&&!Li(r)?ee({result:{error:oe},context:{ratingMin:r}}):{...e}}function Ay({childCategory:t,withDetails:e,category:i}){let r=SI({category:i}),n=SI({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),o=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),s=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),u=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=Ge({invalidRatingRange:u,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:o,invalidAgeMin:a,valid:!u&&!s&&!l&&!c&&!o&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function Oy({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:o}){a=a??(o==null?void 0:o.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),ee({result:{errors:l,error:Vu},stack:s});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:m,matchUpFormat:h,matchUpValue:f,matchUpType:g,scoreValue:v,setValue:y,category:I,gender:b}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof m!="number"&&l.push(`matchUpCount is not type number: ${m}`),g&&!_0([ti,Qt],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(u!=null&&u.length)].concat([f,d,v,y].map(ot)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),f&&typeof f!="number"&&l.push(`matchUpValue is not type number: ${f}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&m){let S=mG({collectionValueProfiles:u,matchUpCount:m});S.errors&&l.push(...S.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),h&&!Ua({matchUpFormat:h})&&l.push(`Invalid matchUpFormat: ${h}`),r){let S=rT({referenceGender:a,matchUpType:g,gender:b});if(S.error)return ee({context:{referenceGender:a,gender:b},result:S,stack:s})}if(t&&n&&I){let S=Ay({category:n,childCategory:I});if(!S.valid)return ee({result:{error:vI},context:S,stack:s})}return l.length?ee({result:{errors:l,error:hH},stack:s}):{valid:!0}}function Hn(t){var g,v,y,I;let e=!!((t==null?void 0:t.enforceCategory)!==!1&&(t!=null&&t.category)),i=!!((t==null?void 0:t.enforceGender)!==!1&&(t!=null&&t.gender)),r=t==null?void 0:t.checkCollectionIds,n=t==null?void 0:t.tieFormat,a=t==null?void 0:t.event,o="validateTieFormat",s=[],l=Sae({...t,stack:o});if(l!=null&&l.error)return l;let u,c=n.collectionDefinitions.every(b=>{let{setValue:S,scoreValue:w,collectionValue:U}=b;(S||w)&&!U&&(u=!0);let{valid:T,errors:D}=Oy({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:b,checkCollectionIds:r,checkCategory:e,checkGender:i,event:a});return T?!0:(Array.isArray(D)&&s.push(...D),!1)}),d=typeof((g=n.winCriteria)==null?void 0:g.valueGoal)=="number"&&((v=n.winCriteria)==null?void 0:v.valueGoal)>0&&!u||((y=n.winCriteria)==null?void 0:y.aggregateValue);if(!(d||(I=n.winCriteria)!=null&&I.aggregateValue))return u?s.push("aggregateValue is required"):s.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),ee({context:{tieFormat:n,errors:s,aggregateValueImperative:u},result:{error:Dl},stack:o});let p=n.collectionDefinitions.map(({collectionId:b})=>b),m=!r||p.length===ct(p).length,h=c&&d&&m;return h?{valid:h,errors:s}:ee({result:{error:Dl},context:{tieFormat:n,errors:s},stack:o})}function Sae(t){let{tieFormat:e,stack:i}=t;return!t||!e||!Nt(e)?ee({result:{error:Dl},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):Nt(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...J}:ee({result:{error:Dl},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):ee({result:{error:Dl},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var Pf="resourceSubType",Rf="resourceType",Cf="identifier",Tae={RESOURCE_SUB_TYPE:Pf,RESOURCE_TYPE:Rf,IDENTIFIER:Cf};function Me(t,e,i,r,n=0){if(UE().makeDeepCopy)return UE().makeDeepCopy(t,e,i,r);let a=NN(),{stringify:o,toJSON:s,ignore:l,modulate:u}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||ma(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&n>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(m=>!i||!l||Array.isArray(l)&&!l.includes(m)||ma(l)&&!l(m)),p=(m,h)=>{c[m]=ma(h==null?void 0:h.toString)?h.toString():JSON.stringify(h)};for(let m of d){let h=t[m],f=ma(u)?u(h):void 0;if(f!==void 0)c[m]=f;else if(e&&m==="extensions"&&Array.isArray(h)){let g=BN(h);Object.assign(c,...g)}else r&&m==="extensions"?c[m]=[]:Array.isArray(o)&&o.includes(m)?p(m,h):Array.isArray(s)&&s.includes(m)&&ma(h==null?void 0:h.toJSON)?c[m]=h.toJSON():h===null?c[m]=void 0:uae(h)?c[m]=new Date(h).toISOString():c[m]=Me(h,e,i,r,n+1)}return c}function BN(t){return t==null?void 0:t.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function BH(t=1,e){return Se(0,t).map(()=>Gt(e))}function Gt(t){let e=[];for(let s=0;s<256;s++)e[s]=(s<16?"0":"")+s.toString(16);let i=Math.random()*4294967295|0,r=Math.random()*4294967295|0,n=Math.random()*4294967295|0,a=Math.random()*4294967295|0,o=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${o.replace(/-/g,"")}`:o}var VH={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},jH={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},GH={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},HH={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},zH={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},WH={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},qH={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},YH={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},KH={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},XH={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},pu="SET3-S:6/TB7",Dae="SET3-S:6/TB7-F:TB10",JH={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},ZH={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},QH={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},ez={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},tz={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},iz={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},rz={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},gS="COLLEGE_DEFAULT",SE="COLLEGE_JUCO",TE="COLLEGE_D3",nz="DOMINANT_DUO",az="DOMINANT_DUO_MIXED",oz="LAVER_CUP",sz="TEAM_DOUBLES_3_AGGREGATION",lz="TIME_TENNIS_DUAL",uz="TIME_TENNIS_PRO_CIRCUIT",cz="USTA_BREWER_CUP",dz="USTA_OZAKI_CUP",pz="USTA_COLLEGE",mz="USTA_GOLD_TEAM_CHALLENGE",hz="USTA_LEVEL_1",fz="USTA_INTERSECTIONAL",gz="USTA_SECTION_BATTLE",vz="USTA_SOUTHERN_LEVEL_5",Iz="USTA_TOC",yz="USTA_WTT_ITT",bz="USTA_ZONAL",Pae={COLLEGE_D3:TE,COLLEGE_DEFAULT:gS,COLLEGE_JUCO:SE,DOMINANT_DUO:nz,DOMINANT_DUO_MIXED:az,LAVER_CUP:oz,TEAM_DOUBLES_3_AGGREGATION:sz,TIME_TENNIS_DUAL:lz,TIME_TENNIS_PRO_CIRCUIT:uz,USTA_BREWER_CUP:cz,USTA_OZAKI_CUP:dz,USTA_COLLEGE:pz,USTA_GOLD_TEAM_CHALLENGE:mz,USTA_INTERSECTIONAL:fz,USTA_LEVEL_1:hz,USTA_SECTION_BATTLE:gz,USTA_SOUTHERN_LEVEL_5:vz,USTA_TOC:Iz,USTA_WTT_ITT:yz,USTA_ZONAL:bz},wz="STANDARD",SB={[wz]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[TE]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:pu,matchUpCount:6,matchUpValue:1},tieFormatName:TE,valueGoal:5},[gS]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:pu,matchUpCount:6,matchUpValue:1},tieFormatName:gS,valueGoal:4},[SE]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:pu,matchUpCount:6,matchUpValue:1},tieFormatName:SE,valueGoal:5},[oz]:iz,[nz]:JH,[az]:qH,[sz]:jH,[lz]:YH,[uz]:WH,[cz]:KH,[dz]:XH,[pz]:ZH,[mz]:VH,[fz]:zH,[hz]:QH,[gz]:HH,[vz]:GH,[yz]:ez,[Iz]:rz,[bz]:tz},Rae=t=>{let e=t!=null&&t.namedFormat&&Object.keys(SB).includes(t.namedFormat)?t.namedFormat:wz,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],r,{category:n,gender:a}=(t==null?void 0:t.event)??{},o=Me(SB[e],!1,!0),s=l=>{var c,d;if(!(t!=null&&t.isMock)&&!((c=t==null?void 0:t.event)!=null&&c.isMock)||!t.event)return(i==null?void 0:i.pop())??Gt();let u=(d=t==null?void 0:t.event)==null?void 0:d.eventId;return i.pop()??`${u}-COL-${l+1}`};return o.hydrate?(r={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:Dae,collectionName:"Doubles",matchUpType:Qt,...o.doubles},{collectionId:s(1),matchUpFormat:pu,collectionName:"Singles",matchUpType:ti,...o.singles}]},o.tieFormatName&&(r.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((l,u)=>l.collectionId=s(u)),r=o),t!=null&&t.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},Iu=Rae,Qs="SINGLES",gm="SINGLES",uo="DOUBLES",yu="DOUBLES",sr="TEAM",Sa="TEAM",Cae="AGE",Eae="RATING",Mae="BOTH",Uz={AGE:Cae,BOTH:Mae,DOUBLES:uo,DOUBLES_EVENT:yu,RATING:Eae,SINGLES:Qs,SINGLES_EVENT:gm,TEAM_EVENT:Sa,TEAM:sr},Oe="MAIN",Ye="QUALIFYING",rn="CONSOLATION",Ar="VOLUNTARY_CONSOLATION",$i="PLAY_OFF",aT=[Oe,Ye,rn,$i,Ar],vm={[Ye]:1,[Oe]:2,[$i]:3,[rn]:3,[Ar]:4},Sz="finishingPositions",Tz="aggregateEventStructures",Dz={[Oe]:1,[$i]:2,[rn]:3,[Ye]:4,[Ar]:5},Nae={[$i]:1,[Oe]:2,[rn]:3,[Ye]:4,[Ar]:5},VN="CLUSTER",Aae="SEPARATE",Nd="WATERFALL",oT="ITEM",xn="CONTAINER",Oo="DRAW",sT="RANDOM",Fo="TOP_DOWN",Ad="BOTTOM_UP",bu="POSITION",wu="WINNER",$l="LOSER",el="FIRST_MATCHUP",La="AD_HOC",Oae="AD_HOC",Ng="FEED_IN",Ef="COMPASS",Mf="OLYMPIC",kae="SINGLE_ELIMINATION",Gs="SINGLE_ELIMINATION",ky="DOUBLE_ELIMINATION",Nf="FIRST_MATCH_LOSER_CONSOLATION",xy="FIRST_ROUND_LOSER_CONSOLATION",up="LUCKY_DRAW",lT="CURTIS_CONSOLATION",xae="CURTIS_CONSOLATION",jN="FEED_IN_CHAMPIONSHIP_TO_SF",TI="FEED_IN_CHAMPIONSHIP_TO_SF",GN="FEED_IN_CHAMPIONSHIP_TO_QF",DI="FEED_IN_CHAMPIONSHIP_TO_QF",HN="FEED_IN_CHAMPIONSHIP_TO_R16",PI="FEED_IN_CHAMPIONSHIP_TO_R16",Pz="MODIFIED_FEED_IN_CHAMPIONSHIP",RI="MODIFIED_FEED_IN_CHAMPIONSHIP",Fy="FEED_IN_CHAMPIONSHIP",Fae="DOUBLE_ROUND_ROBIN",Xo="ROUND_ROBIN",Bl="ROUND_ROBIN_WITH_PLAYOFF",Rz="DECIDER",Cz="BACKDRAW",zN={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},WN={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Od="WIN_RATIO",qm="ROUND_OUTCOME",Ez=[Ef,lT,DI,PI,TI,Fy,GN,HN,jN,Nf,xy,up,RI,Mf,$i,Bl],Lae=[La,Ef,lT,ky,DI,PI,TI,Fy,Ng,Nf,xy,up,RI,Mf,$i,Xo,Bl,Gs],uT={MAIN:Oe,QUALIFYING:Ye,CONSOLATION:rn,ITEM:oT,CONTAINER:xn,FIRST_MATCHUP:el,WINNER:wu,LOSER:$l,AD_HOC:La,FEED_IN:Ng,FLEX_ROUNDS:Oae,COMPASS:Ef,PLAY_OFF:$i,OLYMPIC:Mf,KNOCKOUT:kae,SINGLE_ELIMINATION:Gs,DOUBLE_ELIMINATION:ky,CURTIS:lT,FICSF:jN,FICQF:GN,FICR16:HN,MFIC:Pz,VOLUNTARY_CONSOLATION:Ar,FIRST_MATCH_LOSER_CONSOLATION:Nf,FIRST_ROUND_LOSER_CONSOLATION:xy,MODIFIED_FEED_IN_CHAMPIONSHIP:RI,FEED_IN_CHAMPIONSHIP_TO_R16:PI,FEED_IN_CHAMPIONSHIP_TO_QF:DI,FEED_IN_CHAMPIONSHIP_TO_SF:TI,FEED_IN_CHAMPIONSHIP:Fy,LUCKY_DRAW:up,ROUND_ROBIN_WITH_PLAYOFF:Bl,ROUND_ROBIN:Xo,DECIDER:Rz,BACKDRAW:Cz,COMPASS_ATTRIBUTES:zN,OLYMPIC_ATTRIBUTES:WN,DRAW:Oo,RANDOM:sT,TOP_DOWN:Fo,BOTTOM_UP:Ad,WATERFALL:Nd,WIN_RATIO:Od,ROUND_OUTCOME:qm,MULTI_STRUCTURE_DRAWS:Ez,generatedDrawTypes:Lae,stageOrder:vm,finishOrder:Dz,AGGREGATE_EVENT_STRUCTURES:Tz,FINISHING_POSITIONS:Sz},_ae=uT,pn="tournamentRecords",qN="policyDefinitions",br="tournamentRecord",YN="onlineResource",Fn="drawDefinition",Mz="tieFormatName",KN="matchUpFormat",Vl="participantId",Nz="scheduleDates",$ae="tournamentId",Bae="scheduleDate",Vae="roundNumber",cT="structureId",XN="participant",Ly="matchUpIds",Az="entryStage",jae="policyType",Oz="structures",JN="eventType",hl="matchUpId",dT="tieFormat",pT="inContext",mT="structure",hT="courtIds",Gae="personId",fT="venueIds",ZN="matchUps",kz="courtId",xz="eventId",Xl="matchUp",Fz="drawId",Bo="error",Gc="event",Ag="param",QN="uuids",Hae="averageMatchUpMinutes",zae="recoveryMinutes",Wae="periodLength",qae="number",ea="object",un="array",Kr="_validate",Lz="_message",_a="_invalid",Xn="_ofType",eA="_anyOf",Af="_oneOf",TB={[YN]:t=>Vi(Object.keys(t),[Pf,Rf,Cf]).length===3,[Mz]:t=>t&&Iu({namedFormat:t}),[QN]:t=>!t||Array.isArray(t)&&t.every(Ti),[dT]:t=>!Hn({tieFormat:t}).error,[JN]:t=>[Qs,uo,sr].includes(t),[Az]:t=>aT.includes(t)},Yae={[pn]:Oi,[br]:ge,[qN]:V0,[Fn]:_e,[Vl]:pr,[KN]:mN,[$ae]:Uf,[cT]:za,[Ly]:$m,[XN]:jm,[YN]:Vu,[JN]:Ll,[Oz]:cN,[hl]:yn,[dT]:Dl,[mT]:sp,[kz]:Bm,[ZN]:Bu,[xz]:lo,[Xl]:na,[hT]:Xe,[fT]:Xe,[Fz]:ks,[Gc]:gi},Kae={[pn]:ea,[qN]:ea,[br]:ea,[Fn]:ea,[YN]:ea,[Nz]:un,[XN]:ea,[Ly]:un,[Oz]:un,[dT]:ea,[mT]:ea,[hT]:un,[fT]:un,[ZN]:un,[Xl]:ea,[Gc]:ea,[QN]:un};function ze(t,e,i){if(!t&&!Nt(t))return{error:oe};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:oe};let{paramError:r,errorParam:n}=Zae(t,e);if(!r)return{valid:!0};let a=r[Kr]&&(r[Bo]||r[_a])||(t==null?void 0:t[n])===void 0&&(r[Bo]||r[_a]||Yae[n]||oe)||oe,o=n??(r[Af]&&Object.keys(r[Af]).join(", "));return ee({info:{param:o,message:r[Lz]},result:{error:a},stack:i})}function _z(t,e){let i=Object.keys(t),r=Object.keys(e);return Vi(i,r)}function Xae(t,e){if(!e)return;let i=_z(t,e);return i.length!==1?{error:oe}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function Jae(t,e){if(!e)return;let i=_z(t,e).filter(r=>t[r]);return i.length<1?{error:oe}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function Zae(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:o,_validate:s,_info:l,...u})=>{let c=a&&Xae(t,a);if(c!=null&&c.error)return c.error;c&&Object.assign(u,c);let d=o&&Jae(t,o);if(d!=null&&d.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(h=>typeof u[h]=="boolean"),m=p.find(h=>{let f=s&&!ma(s),g=t[h]!==void 0&&!s&&Qae(t,h,n),v=u[h]&&[void 0,null].includes(t[h]),y=f||g||v||s&&t[h]!==void 0&&!eoe(t[h],s)||TB[h]&&!TB[h](t[h]);return y&&(i=h,r=l),y});return!p.length||m}),errorParam:i,paramInfo:r}}function Qae(t,e,i){return i=i||Kae[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function eoe(t,e){return ma(e)?e(t):!0}var tA="DYNAMIC",wc="RANKING",fc="RATING",kd="SCALE",Pl="SEEDING",toe={RANKING:wc,RATING:fc,SCALE:kd,SEEDING:Pl};function Og(t){var n;let e=ze(t,[{[XN]:!0}]);if(e.error)return e;let i=(n=t.participant.timeItems)==null?void 0:n.filter(({itemType:a})=>(a==null?void 0:a.startsWith(kd))&&[wc,fc,Pl].includes(a.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(i!=null&&i.length){let a=s=>i.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,u)=>new Date(l.createdAt||void 0).getTime()-new Date(u.createdAt||void 0).getTime()).pop(),o=ct(i.map(({itemType:s})=>s));for(let s of o){let l=a(s);if(l){let[,u,c,d,p]=l.itemType.split("."),m=p?`${d}.${p}`:d,h=u===Pl&&"seedings"||u===wc&&"rankings"||"ratings";r[h][c]||(r[h][c]=[]),r[h][c].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:m})}}}return{...J,...r}}function Im(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,o,s){if(!a||!o)return;let l=Object.keys(a),u=Object.keys(o),c=Object.assign({},...u.filter(m=>m.indexOf("||")).map(m=>m.split("||").map(h=>({[h]:m}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let m of l)if(d.indexOf(m)>=0||p){let h=c[m]||m,f=o[h]||p,g=a[m];if(typeof f=="object"&&typeof g!="function"&&!Array.isArray(f))if(Array.isArray(g)){let v=g.map(y=>{let I={};return n(y,f,I)!==!1?I:void 0}).filter(Boolean);s[m]=v}else g&&(s[m]={},n(g,f,s[m]));else{let v=a[m];if(Array.isArray(f)&&!f.includes(v))return!1;(o[m]||p&&o[m]!==!1)&&(s[m]=v)}}}}var DE="voluntaryConsolation",nu="competitiveBands",iA="roundRobinTally",ym="positionActions",Or="matchUpActions",CU="rankingPoints",Of="roundNaming",_y="participant",CI="progression",Hc="scheduling",vS="avoidance",ioe="participant",roe="display",Ps="scoring",ms="seeding",kf="feedIn",noe="audit",IS="draws",aoe={POLICY_TYPE_VOLUNTARY_CONSOLATION:DE,POLICY_TYPE_COMPETITIVE_BANDS:nu,POLICY_TYPE_ROUND_ROBIN_TALLY:iA,POLICY_TYPE_POSITION_ACTIONS:ym,POLICY_TYPE_MATCHUP_ACTIONS:Or,POLICY_TYPE_RANKING_POINTS:CU,POLICY_TYPE_ROUND_NAMING:Of,POLICY_TYPE_PARTICIPANT:_y,POLICY_TYPE_PROGRESSION:CI,POLICY_TYPE_SCHEDULING:Hc,POLICY_TYPE_AVOIDANCE:vS,POLICY_TYPE_DISPLAY:roe,POLICY_TYPE_PRIVACY:ioe,POLICY_TYPE_FEED_IN:kf,POLICY_TYPE_SCORING:Ps,POLICY_TYPE_SEEDING:ms,POLICY_TYPE_AUDIT:noe,POLICY_TYPE_DRAWS:IS};function Uc({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let o=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),s=Me(o,!1,n);if(s){let l=e==null?void 0:e[_y];if(i!=null&&i.withScaleValues){let{ratings:u,rankings:c}=Og({participant:s});s.rankings=c,s.ratings=u}if(l!=null&&l.participant)return Im({template:l.participant,source:s})}return s}var ooe="element required",soe="missing name";function Un(t){if(!t||typeof t!="object")return{error:Xe};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:oe};if(!(t!=null&&t.name))return{error:Xe,info:soe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=Un({element:i,name:t.name});if(r.error)return ee({result:r,stack:"removeExtension"})}return{...J}}return{error:Xe,info:ooe}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...J}):{...J,info:_r}}function tl({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function Lt(t){if(typeof t!="object")return{error:Xe};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return ee({result:{error:oe},stack:e});if(!tl({extension:t.extension}))return ee({result:{error:oe,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=Lt({extension:t.extension,element:r});if(n.error)return ee({result:n,stack:e})}return{...J}}else return ee({result:{error:Xe},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...J}}function rA(t){return!t||typeof t!="object"?{error:Xe}:t.tournamentRecord?Lt({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:ge}}function gT(t){return!t||typeof t!="object"?{error:Xe}:t.drawDefinition?Lt({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:xa}}function zc(t){return!t||typeof t!="object"?{error:Xe}:t.event?Lt({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:lo}}function $z(t){var r;if(!t||typeof t!="object")return{error:Xe};if(!t.participantId)return{error:pr};let e=((r=t.tournamentRecord)==null?void 0:r.participants)||[],i=Uc({participantId:t.participantId,tournamentParticipants:e});return i?Lt({creationTime:t.creationTime,extension:t.extension,element:i}):{error:zi}}function nA(t){return!t||typeof t!="object"?{error:Xe}:t.tournamentRecord?Un({element:t.tournamentRecord,name:t.name}):{error:ge}}function Bz(t){return!t||typeof t!="object"?{error:Xe}:t.drawDefinition?Un({element:t.drawDefinition,name:t.name}):{error:xa}}function vT(t){return!t||typeof t!="object"?{error:Xe}:t!=null&&t.event?Un({element:t.event,name:t.name}):{error:lo}}function Vz(t){var r;if(!t||typeof t!="object")return{error:Xe};if(!t.participantId)return{error:pr};let e=((r=t.tournamentRecord)==null?void 0:r.participants)||[],i=Uc({participantId:t.participantId,tournamentParticipants:e});return i?Un({element:i,name:t.name}):{error:zi}}function $y({tournamentRecords:t}){return{tournamentIds:Nt(t)?Object.keys(t):[],...J}}var loe="extensionQueries";function gt({discover:t,element:e,name:i,...r}){var a;if(!e||!i){if(t&&r){let o=Object.keys(r).filter(u=>typeof t=="boolean"||Array.isArray(t)&&t.includes(u)).find(u=>{var c;return Array.isArray((c=r[u])==null?void 0:c.extensions)?r[u].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=o&&r[o];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(u=>{var c;return(c=u.extensions)==null?void 0:c.length}));let l=(a=s==null?void 0:s.extensions)==null?void 0:a.find(u=>(u==null?void 0:u.name)===i);return{extension:l,info:l?void 0:_r}}return ee({result:{error:Xe},stack:loe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let n=e.extensions.find(o=>(o==null?void 0:o.name)===i);return{extension:n,info:n?void 0:_r}}var uoe="activeSuspension",EI="appliedPolicies",jz="context",IT="delegatedOutcome",Is="disabled",bm="disableAutoCalc",yT="disableLinks",yS="display",Dd="drawDeletions",coe="drawProfile",bS="entryProfile",doe="eventProfile",poe="eventWithdrawalRequests",moe="factory",Jo="flightProfile",PE="groupingAttribute",Uu="lineUps",xd="linkedTournamentsIds",bT="matchUpHistory",aA="participantRepresentatives",kg="personRequests",ff="positionActions",hoe="rankingPoints",foe="registration",fl="roundTarget",By="scheduleLimits",Su="scheduleTiming",wm="schedulingProfile",goe="statusDetail",xf="subOrder",Sc="tally",Hv="tieFormatModification",Gz={ACTIVE_SUSPENSION:uoe,APPLIED_POLICIES:EI,CONTEXT:jz,DELEGATED_OUTCOME:IT,DISABLED:Is,DISABLE_LINKS:yT,DISABLE_AUTO_CALC:bm,DISPLAY:yS,DRAW_DELETIONS:Dd,DRAW_PROFILE:coe,ENTRY_PROFILE:bS,EVENT_PROFILE:doe,EVENT_WITHDRAWAL_REQUESTS:poe,FLIGHT_PROFILE:Jo,GROUPING_ATTRIBUTE:PE,LINEUPS:Uu,LINKED_TOURNAMENTS:xd,MATCHUP_HISTORY:bT,PARTICIPANT_REPRESENTATIVES:aA,PERSON_REQUESTS:kg,POSITION_ACTIONS:ff,RANKING_POINTS:hoe,REGISTRATION:foe,ROUND_TARGET:fl,SCHEDULE_LIMITS:By,SCHEDULE_TIMING:Su,SCHEDULING_PROFILE:wm,STATUS_DETAIL:goe,SUB_ORDER:xf,TALLY:Sc,TIE_FORMAT_MODIFICATIONS:Hv,FACTORY:moe},DB=[IT,Is,bm,yT,Jo,Uu,xd,bT,aA,kg,fl,By,Su,wm,xf,Sc,Hv];function Hz({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Oi};let e=$y({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?Lt({tournamentRecords:t,discover:!0,extension:{name:xd,value:{tournamentIds:i}}}):{...J}}function zz({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Oi};let e=Un({name:xd,tournamentRecords:t,discover:!0});return ee({result:e,stack:"unlinkTournaments"})}function Wz({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:oe};if(!e)return{error:Uf};let i=$y({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:Uf};let n;return r.every(a=>{var d;let o=t[a],{extension:s}=gt({element:o,name:xd});if(!s)return!0;let l=((d=s==null?void 0:s.value)==null?void 0:d.tournamentIds)||[];if(!(l!=null&&l.length)||l.length===1&&l.includes(e)||a===e){let p=nA({name:xd,tournamentRecord:o});return p.error&&(n=p.error),p.success}let u=l.filter(p=>p!==e);s.value={tournamentIds:u};let c=rA({tournamentRecord:o,extension:s});return c.error&&(n=c.error),c.success}),n?{error:n}:{...J}}var qz={};yt(qz,{getLinkedTournamentIds:()=>Vy,getTournamentIds:()=>$y});function Vy({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Oi}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var o;let i=t[e],r=i==null?void 0:i.tournamentId,{extension:n}=gt({element:i,name:xd}),a=(((o=n==null?void 0:n.value)==null?void 0:o.tournamentIds)||[]).filter(s=>s!==r);return{[e]:a}}))}}var wT={};yt(wT,{adHocPositionSwap:()=>_q,addAdHocMatchUps:()=>YT,addDrawDefinitionTimeItem:()=>oO,addFinishingRounds:()=>ib,addGoesTo:()=>_d,addPlayoffStructures:()=>qT,addQualifyingStructure:()=>Lq,addVoluntaryConsolationStage:()=>Nq,addVoluntaryConsolationStructure:()=>YA,allPlayoffPositionsFilled:()=>nO,alternateDrawPositionAssignment:()=>bq,assignDrawPosition:()=>c3,assignDrawPositionBye:()=>Ya,attachConsolationStructures:()=>o3,attachPlayoffStructures:()=>SO,attachQualifyingStructure:()=>aO,attachStructures:()=>WT,autoSeeding:()=>gpe,automatedPlayoffPositioning:()=>jg,automatedPositioning:()=>pb,checkValidEntries:()=>JT,deleteAdHocMatchUps:()=>p3,drawMatic:()=>WO,findDrawDefinition:()=>CO,generateAdHocMatchUps:()=>ZT,generateAdHocRounds:()=>zO,generateAndPopulatePlayoffStructures:()=>wO,generateDrawDefinition:()=>Mb,generateDrawMaticRound:()=>xO,generateDrawStructuresAndLinks:()=>AO,generateDrawTypeAndModifyDrawDefinition:()=>OO,generateQualifyingStructure:()=>pO,generateVoluntaryConsolation:()=>F3,getAssignedParticipantIds:()=>gp,getAvailableMatchUpsCount:()=>KT,getAvailablePlayoffProfiles:()=>hb,getDrawDefinitionTimeItem:()=>RA,getDrawParticipantRepresentativeIds:()=>PO,getDrawStructures:()=>Zo,getDrawTypeCoercion:()=>Ub,getEligibleVoluntaryConsolationParticipants:()=>DO,getMatchUpsMap:()=>sn,getParticipantIdFinishingPositions:()=>RO,getPositionAssignments:()=>xI,getPositionsPlayedOff:()=>Gg,getSeedingThresholds:()=>ZA,getSeedsCount:()=>Sb,getStructureSeedAssignments:()=>po,getTeamLineUp:()=>Ld,getValidGroupSizes:()=>cb,isAdHoc:()=>zn,isCompletedStructure:()=>Cc,isValidForQualifying:()=>NO,luckyLoserDrawPositionAssignment:()=>mq,modifyDrawDefinition:()=>s3,modifyDrawName:()=>TO,modifySeedAssignment:()=>wq,mutate:()=>Yz,positionActions:()=>MO,pruneDrawDefinition:()=>u3,qualifierDrawPositionAssignment:()=>yq,query:()=>f3,removeDrawPositionAssignment:()=>kI,removeRoundMatchUps:()=>m3,removeSeededParticipant:()=>Fq,removeStructure:()=>Eq,renameStructures:()=>Cq,resetDrawDefinition:()=>l3,resetVoluntaryConsolationStructure:()=>cW,setDrawParticipantRepresentativeIds:()=>Kz,setPositionAssignments:()=>vq,setStructureOrder:()=>Pq,setSubOrder:()=>h3,shiftAdHocRounds:()=>gq,swapAdHocRounds:()=>Iq,swapDrawPositionAssignments:()=>kq,updateTeamLineUp:()=>lh,withdrawParticipantAtDrawPosition:()=>aq});var Yz={};yt(Yz,{adHocPositionSwap:()=>_q,addAdHocMatchUps:()=>YT,addDrawDefinitionTimeItem:()=>oO,addPlayoffStructures:()=>qT,addQualifyingStructure:()=>Lq,addVoluntaryConsolationStage:()=>Nq,addVoluntaryConsolationStructure:()=>YA,alternateDrawPositionAssignment:()=>bq,assignDrawPosition:()=>c3,assignDrawPositionBye:()=>Ya,attachConsolationStructures:()=>o3,attachPlayoffStructures:()=>SO,attachQualifyingStructure:()=>aO,attachStructures:()=>WT,automatedPlayoffPositioning:()=>jg,automatedPositioning:()=>pb,deleteAdHocMatchUps:()=>p3,luckyLoserDrawPositionAssignment:()=>mq,modifyDrawDefinition:()=>s3,modifyDrawName:()=>TO,modifySeedAssignment:()=>wq,pruneDrawDefinition:()=>u3,qualifierDrawPositionAssignment:()=>yq,removeDrawPositionAssignment:()=>kI,removeRoundMatchUps:()=>m3,removeSeededParticipant:()=>Fq,removeStructure:()=>Eq,renameStructures:()=>Cq,resetDrawDefinition:()=>l3,resetVoluntaryConsolationStructure:()=>cW,setDrawParticipantRepresentativeIds:()=>Kz,setPositionAssignments:()=>vq,setStructureOrder:()=>Pq,setSubOrder:()=>h3,shiftAdHocRounds:()=>gq,swapAdHocRounds:()=>Iq,swapDrawPositionAssignments:()=>kq,updateTeamLineUp:()=>lh,withdrawParticipantAtDrawPosition:()=>aq});var oA=t=>e=>t[e],sA=(t=[])=>t.map(Tr).filter(Boolean),RE=(t=[])=>t.map(Ut).filter(Boolean),Ut=(t={})=>oA(t)("participantId"),Tr=(t={})=>oA(t)("matchUpId"),MI=(t={})=>oA(t)("drawId");function Kz({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:xa};if(!Array.isArray(t))return{error:oe};let i=RE((e==null?void 0:e.entries)||[]);return t.length&&Vi(t,i).length<t.length?{error:oe}:gT({drawDefinition:e,extension:{name:aA,value:t}})}var $a="ABANDONED",Ym="AWAITING_RESULT",Vt="BYE",ju="CANCELLED",qi="COMPLETED",xg="DEAD_RUBBER",Mt="DEFAULTED",cr="DOUBLE_DEFAULT",er="DOUBLE_WALKOVER",os="IN_PROGRESS",co="INCOMPLETE",lA="NOT_PLAYED",mn="RETIRED",Wc="SUSPENDED",Ji="TO_BE_PLAYED",zt="WALKOVER",voe=[Ym,qi,Mt,os,co,mn,Wc],Xz=[Ym,qi,Mt,er,cr,os,co,mn,Wc,zt],Jz=[$a,Ym,Vt,ju,qi,xg,Mt,er,cr,os,co,lA,mn,Wc,Ji,zt],Zz=[Vt,er,cr,qi,Mt,mn,zt],Qz=[$a,Ym,ju,xg,os,co,lA,Wc,Ji,void 0],gr=[ju,$a,qi,xg,Mt,er,cr,mn,zt],uA=[$a,qi,Mt,er,cr,os,mn,zt],eW=[os,co,Wc,Ji],tW={ABANDONED:$a,AWAITING_RESULT:Ym,BYE:Vt,CANCELLED:ju,COMPLETED:qi,DEAD_RUBBER:xg,DEFAULTED:Mt,DOUBLE_WALKOVER:er,DOUBLE_DEFAULT:cr,IN_PROGRESS:os,INCOMPLETE:co,NOT_PLAYED:lA,RETIRED:mn,SUSPENDED:Wc,TO_BE_PLAYED:Ji,WALKOVER:zt};function Km(t,e,i){var d,p;let r=m=>{var h,f;return(f=(h=gt({element:m,name:fl}))==null?void 0:h.extension)==null?void 0:f.value},n=i==null?void 0:i.deprioritizeCompleted,a=(i==null?void 0:i.mode)===Tz&&Nae,o=(i==null?void 0:i.mode)===Sz&&Dz,s=o||a||vm,l=m=>(m==null?void 0:m.stage)===Oe&&(m==null?void 0:m.stageSequence)===1,u=m=>l(m)?-1:s[m==null?void 0:m.stage],c=m=>m==null?void 0:m.matchUps.every(({matchUpStatus:h})=>gr.includes(h)?1:-1);return n&&c(t)-c(e)||a&&u(t)-u(e)||((t==null?void 0:t.stage)&&s[t.stage]||0)-((e==null?void 0:e.stage)&&s[e.stage]||0)||(r(t)||0)-(r(e)||0)||!o&&!a&&(((d=e==null?void 0:e.positionAssignments)==null?void 0:d.length)??1/0)-(((p=t==null?void 0:t.positionAssignments)==null?void 0:p.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(wS(t)||0)-(wS(e)||0)}function wS(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var n;let r=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((a,o)=>a+o,0);return!e||r<e?r:e},void 0)}function et(t){let e=ze(t,[{[Fn]:!0,[cT]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=Zo({drawDefinition:i}),a=n==null?void 0:n.map(l=>l.structures?[...l.structures].concat(l):l).flat(),o=a==null?void 0:a.find(l=>l.structureId===r);if(!o)return{error:Ei};let s=o.structureType===oT?a==null?void 0:a.find(l=>{var u;return(u=l.structures)==null?void 0:u.some(c=>c.structureId===r)}):void 0;return{structure:o,containingStructure:s}}function Zo({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:o,stage:s}){var h;let l=!e&&_e||!(e!=null&&e.structures)&&cN||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let u=f=>{var v,y;let g=(y=(v=gt({element:f,name:fl}))==null?void 0:v.extension)==null?void 0:y.value;return!n||n===g},c=((h=e==null?void 0:e.structures)==null?void 0:h.filter(p).filter(m).filter(u).sort((f,g)=>Km(f,g,a)))??[],d=t?Object.assign({},...aT.map(f=>{let g=c==null?void 0:c.filter(v=>v.stage===f);return(g==null?void 0:g.length)&&{[f]:g}}).filter(Boolean)):{};return{structures:c,stageStructures:d};function p(f){return!s&&!Array.isArray(o)||s&&f.stage===s||Array.isArray(o)&&o.includes(f.stage)}function m(f){return!r&&!Array.isArray(i)||r&&f.stageSequence===r||Array.isArray(i)&&i.includes(f.stageSequence)}}function iW({drawDefinition:t}){if(!t)return{error:_e};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=ai({structure:i}),a=(n==null?void 0:n.map(Ut).filter(Boolean))??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function ai({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:_e};if({structure:i,error:r}=et({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>ai({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=OG,{positionAssignments:n,error:r}}function Rr({drawDefinition:t,structureId:e,structure:i}){var u;let r=((u=ai({drawDefinition:t,structureId:e,structure:i}))==null?void 0:u.positionAssignments)||[],n=r==null?void 0:r.filter(c=>c.participantId??c.bye??c.qualifier),a=r&&(r==null?void 0:r.length)===(n==null?void 0:n.length),o=r==null?void 0:r.filter(c=>!c.participantId&&!c.bye&&!c.qualifier),s=r==null?void 0:r.filter(c=>!c.participantId&&c.bye),l=r==null?void 0:r.filter(c=>!c.participantId&&c.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:o,assignedPositions:n,qualifierPositions:l,byePositions:s}}var cA="addDrawDefinition",UT="addMatchUps",Tc="addParticipants",dA="addScaleItems",rW="addEvent",pA="addVenue",mu="audit",mA="dataIssue",hA="deleteParticipants",fA="deleteVenue",gA="deletedDrawIds",vA="deletedMatchUpIds",IA="modifyDrawDefinition",nW="modifyDrawEntries",aW="modifyEventEntries",yA="modifyMatchUp",nn="modifyParticipants",bA="modifyPositionAssignments",wA="modifySeedAssignments",cp="modifyTournamentDetail",dp="modifyVenue",CE="mutations",EE="publishEvent",oW="publishEventSeeding",sW="publishOrderOfPlay",lW="publishParticipants",UA="unPublishEvent",SA="unPublishEventSeeding",TA="unPublishOrderOfPlay",Ioe="unPublishParticipants",ST="updateInContextMatchUp",yoe={ADD_DRAW_DEFINITION:cA,ADD_MATCHUPS:UT,ADD_PARTICIPANTS:Tc,ADD_SCALE_ITEMS:dA,ADD_EVENT:rW,ADD_VENUE:pA,AUDIT:mu,DATA_ISSUE:mA,DELETE_PARTICIPANTS:hA,DELETE_VENUE:fA,DELETED_DRAW_IDS:gA,DELETED_MATCHUP_IDS:vA,MODIFY_DRAW_DEFINITION:IA,MODIFY_DRAW_ENTRIES:nW,MODIFY_EVENT_ENTRIES:aW,MODIFY_MATCHUP:yA,MODIFY_PARTICIPANTS:nn,MODIFY_POSITION_ASSIGNMENTS:bA,MODIFY_SEED_ASSIGNMENTS:wA,MODIFY_TOURNAMENT_DETAIL:cp,MODIFY_VENUE:dp,MUTATIONS:CE,PUBLISH_EVENT_SEEDING:oW,PUBLISH_EVENT:EE,PUBLISH_ORDER_OF_PLAY:sW,PUBLISH_PARTICIPANTS:lW,UNPUBLISH_EVENT_SEEDING:SA,UNPUBLISH_EVENT:UA,UNPUBLISH_ORDER_OF_PLAY:TA,UPDATE_INCONTEXT_MATCHUP:ST};function TT(t,e){var a;if(!t)return{error:_e};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=e==null?void 0:e.filter(Boolean);return t.updatedAt=r,(a=t.structures)==null||a.filter(Boolean).forEach(o=>{(!(n!=null&&n.length)||n!=null&&n.includes(o.structureId))&&(o.updatedAt=r)}),{...J}}function Dc({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&TT(t),lt({payload:{matchUps:i,tournamentId:e,eventId:r},topic:UT}),{...J}}function Gu({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&TT(t),lt({topic:vA,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)ON({key:a});return{...J}}function Rt({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&si({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),lt({topic:yA,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...J}):(console.log(na),{error:na})}function boe({tournamentId:t,inContextMatchUp:e}){return e?(lt({payload:{inContextMatchUp:e,tournamentId:t},topic:ST,key:e.matchUpId}),{...J}):{error:na}}function jy({tournamentId:t,eventId:e,drawDefinition:i}){return i?(TT(i),lt({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:cA,key:i.drawId}),{...J}):(console.log(_e),{error:_e})}function woe({tournamentId:t,eventId:e,drawId:i}){return lt({payload:{drawId:i,tournamentId:t,eventId:e},topic:gA,key:i}),ON({key:i}),{...J}}function si({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(TT(t,i),lt({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:IA,key:t.drawId}),{...J}):{error:_e}}function uW({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:_e};if(!i)return{error:sp};let n=i.seedAssignments,a=i.structureId,o=t.drawId;return lt({payload:{tournamentId:e,eventId:r,drawId:o,structureId:a,seedAssignments:n},topic:wA,key:t.drawId}),si({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...J}}function Pc({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:_e};if(!i)return{error:sp};let n=ai({structure:i}),a=i.structureId,o=t.drawId,s=r==null?void 0:r.eventId;return lt({topic:bA,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:s,drawId:o},key:a}),si({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:s}),{...J}}function cW({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){var o,s;if(!e)return{error:_e};let n=(o=e.structures)==null?void 0:o.find(l=>l.stage===Ar);if(!n)return{error:Ei};let a=((s=n.matchUps)==null?void 0:s.map(({matchUpId:l})=>l))||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],Gu({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==Ar)),si({tournamentId:t==null?void 0:t.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...J}}function DA({drawPositions:t,structure:e}){var r;if([Ye,Oe].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=ai({structure:e});(r=i==null?void 0:i.filter(({drawPosition:n})=>t==null?void 0:t.includes(n)))==null||r.forEach(n=>{Lt({element:n,extension:{name:yT,value:!0}})})}function DT(t){var s,l;let{appliedPolicies:e,positionAction:i,drawDefinition:r}=t;if(((s=e==null?void 0:e.audit)==null?void 0:s[ff])===!1)return;let{extension:n}=gt({name:ff,element:r}),a=Array.isArray(n==null?void 0:n.value)?(n==null?void 0:n.value)??[]:[];if(!(a!=null&&a.length)){let u=r.structures.find(c=>c.stage===Oe);if(u){let c=(l=ai({structure:u}).positionAssignments)==null?void 0:l.map(({drawPosition:d,participantId:p,bye:m,qualifier:h})=>({drawPosition:d,participantId:p,qualifier:h,bye:m}));a.push({name:"initialMainAssignments",initialAssignments:c})}}let o={value:a.concat(i),name:ff};Lt({element:r,extension:o})}function Fg({tournamentRecord:t,drawDefinition:e,event:i}){var s;let r=((s=(t==null?void 0:t.events)||i&&[i])==null?void 0:s.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],n={},a={},o=r.map(l=>{var u;return(u=l==null?void 0:l.structures)==null?void 0:u.filter(c=>c==null?void 0:c.structures)}).flat().filter(Boolean);for(let l of o){let{structures:u,structureId:c}=l??{};u&&c&&(n[c]=u==null?void 0:u.map(d=>d.structureId))&&u.forEach(d=>a[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:n,containerStructures:a}}function PT(t){var a;let{sides:e,matchUpType:i}=t||{},r=(a=t.potentialParticipants)!=null&&a.length?t.potentialParticipants.flat().map(o=>i===Qt?(o==null?void 0:o.individualParticipantIds)||[]:o.participantId).flat():[],n=(e||[]).map(o=>{var s;return i===Qt&&(((s=o==null?void 0:o.participant)==null?void 0:s.individualParticipantIds)||[])||(o==null?void 0:o.participantId)&&[o.participantId]||[]}).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function Io(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var Gy="SIGN_IN_STATUS",dW="SIGNED_OUT",NI="SIGNED_IN",Vn="TEAM",St="INDIVIDUAL",Wa="GROUP",ht="PAIR",Kt="TEAM",zv={TEAM_PARTICIPANT:Vn,INDIVIDUAL:St,GROUP:Wa,TEAM:Kt,PAIR:ht},pW={INDIVIDUAL:St,GROUP:Wa,PAIR:ht,TEAM:Kt,SIGN_IN_STATUS:Gy,SIGNED_OUT:dW,SIGNED_IN:NI};function PA({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?Me(e,t==null?void 0:t.convertExtensions,!0):e,a=n.filter(l=>l.participantType===Kt),o=n.filter(l=>l.participantType===Wa),s=n.filter(l=>l.participantType===ht);return n.forEach(l=>{if(l.participantType===St){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{var p;d===u&&!((p=l.teamParticipantIds)!=null&&p.includes(c.participantId))&&(l.teamParticipantIds.push(c.participantId),r.get(c.participantId)||r.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),s.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),o.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}var Yp=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function mW({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n==null?void 0:n.map(({person:s})=>s)].flat().filter(Boolean);function o(s){let{nationalityCode:l}=s||{};if(l){let u=Yp.find(({iso:c})=>c===l);i&&(u!=null&&u.ioc)&&!s.iocNationalityCode&&(s.iocNationalityCode=u.ioc),e&&(u!=null&&u.iso2)&&!s.iso2NationalityCode&&(s.iso2NationalityCode=u.iso2),u!=null&&u.label&&!s.countryName&&(s.countryName=u.label)}}a.forEach(o)}function Uoe({participantMap:t,template:e}){var r;let i=Object.values(t);for(let n of i){let a=n.participant;if((r=a.individualParticipantIds)!=null&&r.length){a.individualParticipants=[];for(let o of a.individualParticipantIds){let s=t[o].participant;a.individualParticipants.push(e?Im({template:e,source:s}):s)}}}}function qc(t){var n;let{tournamentRecord:e,participantId:i}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let a of Object.values(r)){let o=(n=a.participants)==null?void 0:n.find(s=>s.participantId===i);if(o)return{participant:o,tournamentId:a.tournamentId}}return{error:zi}}function hW(t){let{tournamentRecord:e,participantId:i}=t;if(i){let n=qc({tournamentRecord:e,participantId:i});return n.participant??n}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Xe}}function yo(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=hW(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:oe,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:DN};let a=n.timeItems.filter(s=>(s==null?void 0:s.itemType)===r).filter(s=>!(i!=null&&i.length)||i.some(l=>{var u;return(u=s==null?void 0:s.itemSubTypes)==null?void 0:u.includes(l)})).sort((s,l)=>{let u=new Date(s.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),o=Me(a.pop(),!1,!0);if(o){let s={timeItem:o,...J};return e&&Object.assign(s,{previousItems:a}),s}else return{info:_r}}function RA({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:ks};if(!e.timeItems)return{info:_r};let{timeItem:n,previousItems:a,info:o}=yo({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function Hy({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:gi};if(!r.timeItems)return{info:_r};let{timeItem:n,previousItems:a,info:o}=yo({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:o}}function RT({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:ge};if(!e.timeItems)return{info:_r};let{timeItem:n,previousItems:a,info:o}=yo({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function CA({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:ge};if(!i)return{error:pr};let a=qc({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:o}=a;if(!(o!=null&&o.timeItems))return{info:_r};let{timeItem:s,previousItems:l,info:u}=yo({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return s&&{timeItem:s,previousItems:l}||{info:u}}var Soe={[Wa]:"groupParticipantIds",[ht]:"pairParticipantIds",[Kt]:"teamParticipantIds"},Toe={[Wa]:"groups",[Kt]:"teams"};function fW({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,internalUse:a,withISO2:o,withIOC:s}){let l=[],u={};for(let c of i.participants??[]){let d=c==null?void 0:c.participantId;d&&Roe({participantMap:u,participantId:d})}for(let c of i.participants??[]){let d=Me(c,e,a),{participantId:p,individualParticipantIds:m,participantType:h}=d;if(!u[p]){l.push(p);continue}if(Object.assign(u[p].participant,d),m){let f=Poe({individualParticipantIds:m,participantCopy:d,participantMap:u,participantType:h,participantId:p});f.missingParticipantIds.length&&l.push(...f.missingParticipantIds)}if(r&&(u[p].participant.signedIn=Doe(d)),n){let{ratings:f,rankings:g,seedings:v}=Og({participant:d});u[p].participant.seedings=v,u[p].participant.rankings=g,u[p].participant.ratings=f}(s||o)&&mW({participant:u[p].participant,withISO2:o,withIOC:s})}if(t){let c=Nt(t)?t:void 0;Uoe({participantMap:u,template:c})}return{missingParticipantIds:l,participantMap:u}}function Doe(t){let{timeItem:e}=yo({itemType:Gy,element:t});return(e==null?void 0:e.itemValue)===NI}function Poe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){var o;let a=[];for(let s of t){let l=(o=i[s])==null?void 0:o.participant;if(!l){a.push(s);continue}if(l[Soe[r]].push(n),[Kt,Wa].includes(r)){let{participantRoleResponsibilities:u,participantOtherName:c,participantName:d,participantId:p,teamId:m}=e,h=Toe[r];l[h].push({participantRoleResponsibilities:u,participantOtherName:c,participantName:d,participantId:p,teamId:m})}if(r===ht){let u=t.find(c=>c!==s);i[s].pairIdMap[n]=u,i[s].pairIdMap[u]=n}}return{missingParticipantIds:a}}function Roe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[ti]:{...i},[Qt]:{...i},[Kt]:{...i},...i}}}function Xm({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){var s;if(e)return{participantMap:(s=fW({...t,...r,tournamentRecord:i}))==null?void 0:s.participantMap};let a=Me(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&a.forEach(l=>mW({participant:l,...t}));let o;if((n||t!=null&&t.withGroupings)&&(a!=null&&a.length)&&({participantsWithGroupings:a,groupInfo:o}=PA({participantsProfile:t,deepCopy:!1,participants:a})),(t==null?void 0:t.withScaleValues)&&(a==null?void 0:a.length))for(let l of a){let{ratings:u,rankings:c}=Og({participant:l});l.rankings=c,l.ratings=u}return{participants:a,groupInfo:o}}function $t({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:hN};let o={};return i&&s(i),a&&s(a),r&&s(r),n&&s(n),{appliedPolicies:o,...J};function s(l){var c,d;let u=(d=(c=l==null?void 0:l.extensions)==null?void 0:c.find(p=>p.name===EI))==null?void 0:d.value;if(u)for(let p of Object.keys(u))(t?e.includes(p):!e.length||e.includes(p))&&(o[p]=Me(u[p],!1,!0))}}function Hu({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:hN};let{appliedPolicies:a}=$t({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),o={};for(let s of t){let l=a==null?void 0:a[s];l&&(o[s]=l)}return Object.keys(o).length?{policyDefinitions:o}:{info:qp.message}}var gW="WALKOVER",PB="RETIRED",EA="COMPETITIVE",AI="ROUTINE",OI="DECISIVE",EU="winRatio",Coe={[nu]:{policyName:"Competitive Bands Default",profileBands:{[OI]:20,[AI]:50}}},MA=Coe;function zu({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let o=Hu({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[nu])??(o==null?void 0:o[nu])??MA[nu];a.policies[nu]=s}return a}function pp({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:ge};let{appliedPolicies:a}=$t({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a!=null&&a[i]?{policy:a[i]}:{info:qp==null?void 0:qp.message}}function zy({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){var s,l,u,c,d,p;e=e??((s=r==null?void 0:r.category)==null?void 0:s.categoryName)??((l=r==null?void 0:r.category)==null?void 0:l.ageCategoryCode),i=i??((u=r==null?void 0:r.category)==null?void 0:u.categoryType)??((c=r==null?void 0:r.category)==null?void 0:c.subType);let{policy:n}=pp({policyType:Hc,tournamentRecord:t,event:r}),a=(d=t?gt({element:t,name:Su}).extension:void 0)==null?void 0:d.value,o=(p=r&&gt({name:Su,element:r}).extension)==null?void 0:p.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:o,categoryName:e,categoryType:i,policy:n}}}function NA({drawDefinition:t,attributes:e}){let{extension:i}=gt({element:t,name:bS}),r=(i==null?void 0:i.value)||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:bS,value:r},gT({drawDefinition:t,extension:i}),{entryProfile:r}}function Wy({drawDefinition:t}){let{extension:e}=gt({element:t,name:bS});return{entryProfile:(e==null?void 0:e.value)||{}}}var Vo="ALTERNATE",qy="CONFIRMED",oa="DIRECT_ACCEPTANCE",Yy="FEED_IN",Ky="JUNIOR_EXEMPT",Tu="LUCKY_LOSER",Xy="ORGANISER_ACCEPTANCE",Jy="QUALIFIER",Eoe="REGISTERED",Zy="SPECIAL_EXEMPT",bo="UNGROUPED",mp="UNPAIRED",Ff="WILDCARD",Du="WITHDRAWN",MU=[qy,oa,Ky,Xy,Zy],vW=[Yy,Tu,Jy],hp=[qy,oa,Yy,Ky,Xy,Zy,Ff],ss=[qy,oa,Ky,Tu,Jy,Xy,Zy,Ff],IW=[Vo,qy,oa,Yy,Ky,Tu,Xy,Jy,Eoe,Zy,bo,mp,Ff,Du],Moe={ALTERNATE:Vo,CONFIRMED:qy,DIRECT_ACCEPTANCE:oa,DIRECT_ENTRY_STATUSES:hp,DRAW_SPECIFIC_STATUSES:vW,EQUIVALENT_ACCEPTANCE_STATUSES:MU,FEED_IN:Yy,JUNIOR_EXEMPT:Ky,LUCKY_LOSER:Tu,ORGANISER_ACCEPTANCE:Xy,QUALIFIER:Jy,SPECIAL_EXEMPT:Zy,STRUCTURE_SELECTED_STATUSES:ss,UNGROUPED:bo,UNPAIRED:mp,VALID_ENTRY_STATUSES:IW,WILDCARD:Ff,WITHDRAWN:Du};function AA({stage:t,drawDefinition:e}){let{entryProfile:i}=Wy({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&aT.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return NA({drawDefinition:e,attributes:n}),!0}return r}function Noe({stage:t,drawDefinition:e}){var r;let{entryProfile:i}=Wy({drawDefinition:e});return((r=i[t])==null?void 0:r.alternates)||0}function Aoe({stage:t,drawDefinition:e}){var r;let{entryProfile:i}=Wy({drawDefinition:e});return((r=i[t])==null?void 0:r.wildcardsCount)||0}function ME({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function Jm({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:o,stages:s,stage:l}){var c;let u=((c=i.entries)==null?void 0:c.reduce((d,p)=>{var v,y;let m=(y=(v=gt({name:fl,element:p}))==null?void 0:v.extension)==null?void 0:y.value,h=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),f=!n||p.entryStatus&&n.includes(p.entryStatus),g=p.entryStageSequence??1;return h&&(!r||g===r)&&f&&(!o||!m||o===m)?d.concat(p):d},[]))??[];if(a&&l===$i){let{playoffEntries:d,error:p}=Ooe({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:u).filter(m=>!e||m.placementGroup===e)}return u}function Ooe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===bu&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:o}=n.source,{structure:s}=et({drawDefinition:e,structureId:o});(s==null?void 0:s.structureType)===xn&&(s.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(f=>{var y;let{participantId:g}=f,v=(y=gt({element:f,name:Sc}).extension)==null?void 0:y.value;return v&&g?{[g]:v}:void 0}).filter(Boolean)),m=Object.keys(p).reduce((f,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return f.includes(y)||f.push(y),f},[]).length===Object.keys(p).length,h=Object.keys(p).filter(f=>{let g=p[f],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||m)&&h.forEach(f=>{let g=p[f],{groupOrder:v,provisionalOrder:y,GEMscore:I}=g,b=v||t&&y,S=[...a??[]].sort(or).indexOf(b)+1;r.push({entryStage:$i,entryStatus:Yy,placementGroup:S,groupingValue:d,participantId:f,GEMscore:I})})})}return{playoffEntries:r}}function koe({stage:t,drawDefinition:e}){return hp.reduce((i,r)=>(ME({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function po({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){var h;let a,o=[];n||({structure:n,error:a}=et({drawDefinition:i,structureId:r}));let s=ai({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:Ei};r||(r=n.structureId);let{stage:l,stageSequence:u}=n,c=l===$i&&i&&Jm({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:r,stage:l}),d=c?c.filter(f=>f.placementGroup===1).sort((f,g)=>f.GEMscore<g.GEMscore&&1||f.GEMscore>g.GEMscore&&-1||0).map((f,g)=>{let v=g+1;return{participantId:f.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],p=d==null?void 0:d.slice(0,e?d.length:s.length/2);p.length?o=p:n.seedAssignments?o=n.seedAssignments:a=SG;let m=n.seedLimit??((h=n==null?void 0:n.positionAssignments)==null?void 0:h.length);return{seedAssignments:o,stageSequence:u,seedLimit:m,stage:l,error:a}}function Ls(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function Wv({item:t,drawDefinition:e,structure:i,event:r}){var n,a,o;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((n=e.tieFormats)==null?void 0:n.find(l=>t.tieFormatId===l.tieFormatId))||(r.tieFormat?r.tieFormat:(a=r.tieFormats)==null?void 0:a.find(l=>t.tieFormatId===l.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(o=e.tieFormats)==null?void 0:o.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function vn({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:Wv({item:i,drawDefinition:t,structure:e,event:r})||Wv({item:e,drawDefinition:t,structure:e,event:r})||Ls(t)||Ls(r)}}function xoe({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function sn({drawDefinition:t,structure:e}){let i={},r=[];return((t==null?void 0:t.structures)??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:o,structures:s}=n,l=Array.isArray(s);if(l)l&&s.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=o;i[a]={matchUps:u,itemStructureIds:[]},u==null||u.forEach(c=>{r.push(c),c.tieMatchUps&&r.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function Fd({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=(e==null?void 0:e.mappedMatchUps)??t;let n=t[i],a=((n==null?void 0:n.itemStructureIds)||[]).map(o=>{let{matchUps:s,structureName:l}=t[o];return r?s.map(u=>Object.assign(Me(u,!0,!0),{containerStructureId:i,structureId:o,structureName:l})):s}).flat();return((n==null?void 0:n.matchUps)||[]).concat(...a)}function yW({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=Pr(t,t.length/e).map(n=>n.reduce((a,o)=>a+o)),r=i.slice().sort(or);return i.map(n=>r.indexOf(n)+1)}function CT(t){if(!Nt(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>ot(a)||a===void 0||a===null);return r&&n}function wo(t){return Array.isArray(t)?t.every(CT):!1}function Cn({matchUps:t=[],interpolate:e}){var d;if(!wo(t))return{roundMatchUps:[],error:oe};let i=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?Ze(m.roundNumber):m.roundNumber;return!m.roundNumber||p.includes(h)?p:p.concat(h)},[]).sort(or).map(p=>{let m=t.filter(g=>g.roundNumber===p),h=m.find(({matchUpType:g})=>g===hi)?m.filter(({matchUpType:g})=>g===hi):m,f=g=>g.sort((v,y)=>or(v.roundPosition,y.roundPosition));return{[p]:f(h)}}),r=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?Ze(m.roundNumber):m.roundNumber;return p[h]||(p[h]=Ge({abbreviatedRoundName:m.abbreviatedRoundName,finishingRound:m.finishingRound,roundName:m.roundName})),p},{}),n=Object.assign({},...i);if(e){let p=Math.max(...Object.keys(n).map(h=>Ze(h)).filter(h=>!isNaN(h))),m=(d=n[p])==null?void 0:d.length;if(m>1&&Us(m)){let h=p+1,f=h+m/2;Se(h,f).forEach((g,v)=>{n[g]=Se(0,m/(2+v*2)).map(()=>({}))})}}let a=0,o=Object.assign({},...Object.keys(n).map(p=>{var g,v,y;let m=(g=n[p])==null?void 0:g.length,h=(y=(v=n[p])==null?void 0:v.filter(I=>{var b;return!gr.includes(I.matchUpStatus)&&!((b=I.score)!=null&&b.scoreStringSide1)}))==null?void 0:y.length,f=m&&m===h;return a=Math.max(a,m),{[p]:{matchUpsCount:m,inactiveCount:h,inactiveRound:f}}})),s=0,l=0,u=Object.keys(n).map(p=>Ze(p)).filter(p=>!isNaN(p));u.forEach(p=>{var f,g,v,y,I;let m=n[p].sort((b,S)=>b.roundPosition-S.roundPosition),h=m.map(b=>(b==null?void 0:b.drawPositions)||[]).flat();if(o[p].roundNumber=p,o[p].roundFactor=o[p].matchUpsCount?a/o[p].matchUpsCount:1,o[p].finishingRound=(f=r[p])==null?void 0:f.finishingRound,o[p].roundName=(g=r[p])==null?void 0:g.roundName,o[p].abbreviatedRoundName=(v=r[p])==null?void 0:v.abbreviatedRoundName,o[p].finishingPositionRange=(I=(y=n[p])==null?void 0:y[0])==null?void 0:I.finishingPositionRange,p===1||!o[p-1]){let b=h.sort(or),S=Pr(b,2);o[p].drawPositions=b,o[p].pairedDrawPositions=S}else{let b=o[p-1],S=b.drawPositions,w=b.matchUpsCount/o[p].matchUpsCount,U=Pr(S,w),T=m.map(D=>{let{roundPosition:P}=D,C=[...D.drawPositions||[],void 0,void 0].slice(0,2);if(!P)return C;let R=(C==null?void 0:C.filter(Boolean))||[];if(!(R!=null&&R.length))return[void 0,void 0];if(p<3&&(R==null?void 0:R.length)===2)return C==null?void 0:C.slice().sort(or);let N=Vi(S,R).length!==(R==null?void 0:R.length);if(R!=null&&R.length&&N)return(R==null?void 0:R.length)===1?[R[0],void 0]:C==null?void 0:C.slice().sort(or);let A=(P-1)*2;return U.slice(A,A+2).map(M=>R==null?void 0:R.find(E=>M.includes(E)))});o[p].drawPositions=T==null?void 0:T.flat(),o[p].pairedDrawPositions=T}o[p+1]&&o[p+1].matchUpsCount===o[p].matchUpsCount&&(o[p+1].feedRound=!0,o[p+1].feedRoundIndex=l,o[p].preFeedRound=!0,l+=1),o[p]&&!o[p].feedRound&&(o[p].roundIndex=s,s+=1)});let c=!!Object.values(o).find(({matchUpsCount:p})=>!Us(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:c,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:u,roundProfile:o,...J}}function NU(t){if(!Array.isArray(t))return"";let e=t.filter(Li);return e.length?ct([Math.min(...e),Math.max(...e)]).join("-"):""}function Foe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:_e};if(!e)return{error:za};let{structure:r}=et({drawDefinition:t,structureId:e});if((r==null?void 0:r.stage)!==rn)return{error:lp,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=(n==null?void 0:n.filter(d=>d.target.structureId===e))||[],o=(a==null?void 0:a.reduce((d,p)=>{let{structureId:m}=p.source;return d.includes(m)?d:d.concat(m)},[]))||[],s=Object.assign({},...o.map(d=>{let p=Fd({structureId:d,matchUpsMap:i}),m=Cn({matchUps:p}).roundProfile;return{[d]:m}})),l=Fd({matchUpsMap:i,structureId:e}),{roundProfile:u}=Cn({matchUps:l}),c={};return a==null||a.forEach(d=>{var R,N,A;let{structureId:p,roundNumber:m}=d.source,{feedProfile:h,groupedOrder:f,positionInterleave:g,roundNumber:v}=d.target,y=s[p],I=(R=y[1])==null?void 0:R.drawPositions,b=(N=y[m])==null?void 0:N.matchUpsCount;if(!b)return;let S=b?I.length/b:0,w=I.length/S,U=I.slice(),T=yW({roundPositionsCount:w,groupedOrder:f}),D=(T==null?void 0:T.length)||1;if(D<=w){let M=I.length/D,E=Pr(U,M);h===Ad&&E.forEach(O=>O.reverse()),U=(T==null?void 0:T.length)&&(T==null?void 0:T.map(O=>E[O-1]).flat())||U}let P=Pr(U,S);if(g){let M=Se(0,g.interleave).map(()=>{}),E=Se(0,g.offset).map(()=>{});P=P.map(k=>[k,...M]),P.unshift(E),P=P.flat(1);let O=P.length-g.offset;P=P.slice(0,O)}c[v]||(c[v]={});let C=(A=u==null?void 0:u[v])!=null&&A.feedRound?2:1;P.forEach((M,E)=>{let O=1+E*C;c[v][O]||(c[v][O]=NU(M))})}),{sourceDrawPositionRanges:c}}function bW({drawDefinition:t}){if(typeof t!="object")return{error:Wp};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((o,s)=>{let{stage:l}=s;return o[l]?o[l].push(s):o[l]=[s],o},{});for(let o of Object.keys(n)){let s=n[o].find(({stageSequence:u})=>u===1);if(!s)continue;let{structureId:l}=s;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:o})}return{exitProfiles:e};function a({exitProfiles:o,exitProfile:s,structureId:l,targetRound:u,aggregator:c,stage:d}){o[l]||(o[l]=[]),s==="0"&&[rn,$i].includes(d)||o[l].push(s);let p=r.filter(m=>m.source.structureId===l&&m.source.roundNumber>=u);for(let m of p){let h=m.source.roundNumber,f=m.target.roundNumber,g=m.target.structureId,v=i.find(I=>I.structureId===g).stage,y=[v,g,f,h].join("|");if(c[y])return;c[y]=!0,a({exitProfile:`${s}-${h}`,structureId:g,exitProfiles:o,targetRound:f,aggregator:c,stage:v})}}}function Loe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){var o;if(!t)return{error:_e};if(!i)return{error:za};if(!e){let s=Fd({matchUpsMap:r,structureId:i});if({roundProfile:e}=Cn({matchUps:s}),!e)return{error:Xe}}let n=(Math.min(...((o=e==null?void 0:e[1])==null?void 0:o.drawPositions)??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{var v,y;let l=(v=e==null?void 0:e[s])==null?void 0:v.matchUpsCount,u=((y=e==null?void 0:e[1])==null?void 0:y.drawPositions)??[],c=Pr(u,u.length/l),d=c.map(NU),p=c.map(I=>I.map(b=>b-n)).map(NU),m=a.map(I=>{var S;if(I>s)return;let b=((S=e==null?void 0:e[I])==null?void 0:S.drawPositions)??[];return Pr(b,b.length/l)}).filter(Boolean),h=Se(0,l).map(I=>m.map(b=>b[I]).flat().filter(Boolean).sort(or)).map(I=>ct(I)),f=h.map(I=>cne(I).map(NU).join(", ")),g=Object.assign({},...Se(0,l).map(I=>({[I+1]:{firstRoundDrawPositionsRange:d[I],firstRoundOffsetDrawPositionsRange:p[I],possibleDrawPositions:h[I],drawPositionsRange:f[I]}})));return{[s]:g}}))}}function OA({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){var a;if(!i)return!1;r=r??i.matchUps??[],t=t??Cn({matchUps:r}).roundsNotPowerOf2;let n=!!((a=i.positionAssignments)!=null&&a.find(({drawPosition:o})=>o))||!!(r!=null&&r.find(({drawPositions:o})=>o==null?void 0:o.length));return(!(e!=null&&e.drawType)||e.drawType!==up)&&!(i!=null&&i.structures)&&t&&n}function zn({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(n=>n==null?void 0:n.roundPosition)),r=!!(e!=null&&e.find(n=>{var a;return(a=n==null?void 0:n.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==Ar&&(!e.length||!i&&!r)}var wW={[Of]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Oe]:"",[$i]:"P",[Ye]:"Q",[rn]:"C"}}},_oe=wW;function $oe({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){var R,N,A;let{roundProfile:n,roundMatchUps:a}=Cn({matchUps:r}),{structureAbbreviation:o,stage:s}=i,l=zn({structure:i}),u=OA({structure:i}),c=i.structures,d={},p=wW[Of],m=i.stage===Ye,h=m?Math.max(...((e==null?void 0:e.structures)??[]).filter(M=>M.stage===Ye).map(({stageSequence:M})=>M??1),0):0,f=(i.stageSequence??1)<h?i.stageSequence??1:"",g=f&&(((R=t==null?void 0:t.affixes)==null?void 0:R.preQualifying)||p.affixes.preQualifying)||"",v=(t==null?void 0:t.roundNamingMap)||p.roundNamingMap||{},y=(t==null?void 0:t.abbreviatedRoundNamingMap)||p.abbreviatedRoundNamingMap||{},I=((N=t==null?void 0:t.affixes)==null?void 0:N.preFeedRound)||p.affixes.preFeedRound,b=((A=t==null?void 0:t.affixes)==null?void 0:A.roundNumber)||p.affixes.roundNumber,S=((t==null?void 0:t.namingConventions)||p.namingConventions).round,w=s&&s!==Oe?s[0]:"",U=(t==null?void 0:t.stageConstants)||p.stageConstants,T=s&&(U==null?void 0:U[s])||w,D=`${g}${T}${f}`,P=n?Object.keys(n):[],C=m&&(U!=null&&U[Ye])?`${U==null?void 0:U[Ye]}-`:"";if(c||l||u)Object.assign(d,...P.map(M=>{let E=`${C}${S} ${M}`,O=`${b}${M}`;return{[M]:{roundName:E,abbreviatedRoundName:O}}}));else{let M=m&&((t==null?void 0:t.qualifyingFinishMap)||(p==null?void 0:p.qualifyingFinishMap)||{});Object.assign(d,...P.map(E=>{if(!(n!=null&&n[E]))return;let{matchUpsCount:O,preFeedRound:k}=n[E],x=O*2,F=(M==null?void 0:M[n==null?void 0:n[E].finishingRound])||M&&`${b}${x}`||v[O]||`${b}${x}`,$=k?`-${I}`:"",_=`${F}${$}`,L=[D,o,_].filter(Boolean).join("-"),B=`${y[O]||`${b}${x}`}${$}`,V=[D,o,B].filter(Boolean).join("-");return{[E]:{abbreviatedRoundName:V,roundName:L}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}var Boe=(t,e)=>(t||0)+(e||0);function UW(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&gW||i<=e[OI]&&OI||i<=e[AI]&&AI||EA}function SW({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(Boe)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function Voe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function TW(t){return t.map(Voe).sort().map(e=>parseFloat(e.toFixed(2)))}function Qy({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:na};let{score:r,winningSide:n}=i;if(!n)return{error:oe};let a=!e&&t&&pp({policyType:nu,tournamentRecord:t}).policy,o=e||(a==null?void 0:a.profileBands)||MA[nu].profileBands,s=SW({score:r}),l=TW([s]),u=UW(l,o),c=Array.isArray(l)?l[0]:l;return{...J,competitiveness:u,pctSpread:c}}function DW({matchUp:t}){var o,s,l;if(!t)return{error:na};if(t&&!t.sides)return{error:aa};if(t&&!t.hasContext)return{error:q0};let e=(o=t.sides??[])==null?void 0:o.map(u=>u==null?void 0:u.participantId).filter(Boolean),i=((s=t.sides)==null?void 0:s.filter(u=>{var c;return((c=u.participant)==null?void 0:c.participantType)===St}).map(u=>u.participantId).filter(Boolean))??[],r=(((l=t.sides??[])==null?void 0:l.map(u=>{var c;return(c=u.participant)==null?void 0:c.individualParticipants}).filter(Boolean))??[]).map(u=>(u??[]).map(c=>c==null?void 0:c.participantId).filter(Boolean)),n=[...i,...r.flat()].filter(Boolean)??[],a=ct(n.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:a,individualParticipantIds:n,sideParticipantIds:e,...J}}var US="CHECK_IN",SS="CHECK_OUT",joe="SCHEDULE",Zm="SCHEDULE.ASSIGNMENT.VENUE",jl="SCHEDULE.ALLOCATION.COURTS",Rc="SCHEDULE.ASSIGNMENT.COURT",ET="SCHEDULE.COURT.ORDER",Qm="SCHEDULE.DATE",Goe="COMPLETED.DATE",kA="HOME_PARTICIPANT_ID",xA="SCHEDULE.ASSIGN.OFFICIAL",eh="SCHEDULE.TIME.SCHEDULED",hs="SCHEDULE.TIME.START",hu="SCHEDULE.TIME.STOP",Rl="SCHEDULE.TIME.RESUME",Pu="SCHEDULE.TIME.END",MT="SCHEDULE.TIME.MODIFIERS",PW="TO_BE_ANNOUNCED",RW="NEXT_AVAILABLE",CW="FOLLOWED_BY",EW="AFTER_REST",MW="RAIN_DELAY",Hoe="NOT_BEFORE",NE=[PW,RW,CW,EW,MW],zoe="ELIGIBILITY",Woe="REGISTRATION",qoe="SUSPENSION",Yoe="MEDICAL",Koe="PENALTY",NW="SCALE",AW="RATING",OW="RANKING",FA="SEEDING",Yc="PUBLISH",qa="PUBLIC",Kc="STATUS",Xoe="MODIFICATION",Joe="RETRIEVAL",Zoe="other",Qoe={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:NE,AFTER_REST:EW,ALLOCATE_COURTS:jl,ASSIGN_COURT:Rc,ASSIGN_OFFICIAL:xA,ASSIGN_VENUE:Zm,CHECK_IN:US,CHECK_OUT:SS,COMPLETED_DATE:Goe,COURT_ORDER:ET,ELIGIBILITY:zoe,END_TIME:Pu,FOLLOWED_BY:CW,MEDICAL:Yoe,MODIFICATION:Xoe,NEXT_AVAILABLE:RW,NOT_BEFORE:Hoe,OTHER:Zoe,PENALTY:Koe,PUBLIC:qa,PUBLISH:Yc,RANKING:OW,RATING:AW,RAIN_DELAY:MW,REGISTRATION:Woe,RESUME_TIME:Rl,RETRIEVAL:Joe,SCALE:NW,SCHEDULE:joe,SCHEDULED_DATE:Qm,SCHEDULED_TIME:eh,SEEDING:FA,START_TIME:hs,STATUS:Kc,STOP_TIME:hu,SUSPENSION:qoe,TIME_MODIFIERS:MT,TO_BE_ANNOUNCED:PW};function th({matchUp:t}){if(!t)return{error:na};if(!t.hasContext)return{error:q0};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:aa};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=DW({matchUp:t}),n=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[US,SS].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(s=>s.itemValue).filter(s=>n.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===US);e==null||e.forEach((s,l)=>{let u=r==null?void 0:r[l],c=(s==null?void 0:s.length)&&s.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),r==null||r.forEach((s,l)=>{a.includes(s)&&((e==null?void 0:e[l])??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let o=r==null?void 0:r.reduce((s,l)=>a.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...J}}var Yi=t=>e=>{let i=Nt(e)&&(e==null?void 0:e.matchUpType)||Ti(e)&&e;return i&&rG[t].includes(i)};function qv(t){var a;let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},r=(e==null?void 0:e.map(({matchUpFormatCodes:o})=>o==null?void 0:o.filter(s=>s===i)).flat().filter(Boolean).sort((o,s)=>((o==null?void 0:o.length)||0)-((s==null?void 0:s.length)||0)))||[],n=r.includes(i)?i:r[0];return(a=e==null?void 0:e.find(({matchUpFormatCodes:o,averageTimes:s})=>(o==null?void 0:o.find(l=>n===l))&&s))==null?void 0:a.averageTimes}function Yv(t){var n;let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:r}=t||{};return(n=e==null?void 0:e.find(({matchUpFormatCodes:a,averageTimes:o,recoveryTimes:s})=>{if(o&&i){let{greaterThan:l=0,lessThan:u=360}=o;if(i>l&&i<u)return!0}return(a==null?void 0:a.find(l=>l===r))&&s}))==null?void 0:n.recoveryTimes}function kW({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>{var o,s;return(((o=a.categoryNames)==null?void 0:o.length)||0)-(((s=n.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:n,categoryNames:a})=>!(a!=null&&a.length)&&!(n!=null&&n.length)||(a==null?void 0:a.includes(e))||(n==null?void 0:n.includes(i)))).find(Boolean)}function ese({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:o,policy:s}){var p;let l=(e==null?void 0:e.matchUpRecoveryTimes)&&Yv({...e,averageMinutes:i,matchUpFormat:n}),u=(t==null?void 0:t.matchUpRecoveryTimes)&&Yv({...t,averageMinutes:i,matchUpFormat:n}),c=(s==null?void 0:s.matchUpRecoveryTimes)&&Yv({...s,averageMinutes:i,matchUpFormat:n}),d=[l,u,c,(p=s==null?void 0:s.defaultTimes)==null?void 0:p.recoveryTimes,r==null?void 0:r.recoveryTimes];return kW({categoryName:a,categoryType:o,timesBlockArray:d})}function tse({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:o}){var d;let s=(a==null?void 0:a.matchUpAverageTimes)&&qv({...a,matchUpFormat:t}),l=(n==null?void 0:n.matchUpAverageTimes)&&qv({...n,matchUpFormat:t}),u=(o==null?void 0:o.matchUpAverageTimes)&&qv({...o,matchUpFormat:t}),c=[s,l,u,(d=o==null?void 0:o.defaultTimes)==null?void 0:d.averageTimes,r==null?void 0:r.averageTimes];return kW({categoryName:e,categoryType:i,timesBlockArray:c})}var xW="DOUBLES_SINGLES",FW="SINGLES_DOUBLES",jo="total",AE="participantConflict",oc="matchUpConflict",LW="ISSUE_IDS",cd="CONFLICT",dd="WARNING",OE="ERROR",kE="ISSUE",AU="STATE",ise={SINGLES_DOUBLES:FW,DOUBLES_SINGLES:xW,TOTAL:jo,CONFLICT_MATCHUP_ORDER:oc,CONFLICT_PARTICIPANTS:AE,SCHEDULE_ISSUE_IDS:LW,SCHEDULE_CONFLICT:cd,SCHEDULE_WARNING:dd,SCHEDULE_ERROR:OE,SCHEDULE_ISSUE:kE,SCHEDULE_STATE:AU};function eb({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:s}){if(!i)return{error:ge};o=o??(s==null?void 0:s.eventType)??gm;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=zy({tournamentRecord:i,categoryName:n,categoryType:a,event:s}),c={...u,matchUpFormat:r,categoryType:a,defaultTiming:l};return NT({eventType:o,timingDetails:c})}function NT({timingDetails:t,eventType:e}){let i=tse(t),r=Object.keys((i==null?void 0:i.minutes)||{}),n=(i==null?void 0:i.minutes)&&((r==null?void 0:r.includes(e))&&i.minutes[e]||i.minutes.default),a=ese({...t,averageMinutes:n}),o=Object.keys((a==null?void 0:a.minutes)||{}),s=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),l=Yi(gm)(e)?FW:xW,u=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(l))&&a.minutes[l]||s);return{averageMinutes:n,recoveryMinutes:s,typeChangeRecoveryMinutes:u}}function oC(t){return t.createdAt?new Date(t.createdAt).getTime():0}function fp({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>oC(n)-oC(a)).pop(),r=i&&oC(i);return{itemValue:i==null?void 0:i.itemValue,timeStamp:r}}function _W({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=fp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:eh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function ih({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=fp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Qm});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function Fp(t){if(LH.test(t)){let e=FN();return new Date(`${e}T${t}`)}else return new Date(t)}function rse({matchUp:t}){if(!t)return{error:na};if(!t.timeItems)return{error:DN};let e=t.timeItems.filter(r=>[hs,hu,Rl,Pu].includes(r==null?void 0:r.itemType)).sort((r,n)=>Fp(r.itemValue).getTime()-Fp(n.itemValue).getTime()),i=e.reduce((r,n)=>{var l,u;let a,o=(l=n==null?void 0:n.itemType)==null?void 0:l.split("."),s=`SCHEDULE.TIME.${((u=n==null?void 0:n.itemType)==null?void 0:u.startsWith("SCHEDULE.TIME"))&&o[2]}`;switch(s){case hs:a=0;break;case Pu:if(r.lastValue&&[hs,Rl].includes(r.lastType)){let c=Fp(n.itemValue).getTime()-Fp(r.lastValue).getTime();a=r.milliseconds+c}else a=r.milliseconds;break;case hu:if([hs,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let c=Fp(n.itemValue).getTime()-Fp(r.lastValue).getTime();a=r.milliseconds+c}else a=r.milliseconds;break;default:a=r.milliseconds;break}return{milliseconds:a,lastType:s,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([hs,Rl].includes(i.lastType)){let r=new Date().getTime()-Fp(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:nse(i.milliseconds),relevantTimeItems:e}}function nse(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function ase({matchUp:t}){var r;let e=(t==null?void 0:t.timeItems)||[],i=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{startTime:(r=e.reduce((n,a)=>{let o=a.itemType===hs&&a;return o&&(!n||i(o)<i(n))?o:n},void 0))==null?void 0:r.itemValue}}function tb(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:oe};let n=Io(t);i.venueId||(i.venueId=Gt());let a;for(let o of Object.values(n)){let s=ose({disableNotice:!0,tournamentRecord:o,context:r,venue:i});if(s!=null&&s.error)return s;a=s.venue}return e||lt({topic:pA,payload:{venue:i}}),Ge({...J,venue:a})}function ose({tournamentRecord:t,disableNotice:e,context:i,venue:r}){return t?r?(t.venues||(t.venues=[]),r.venueId||(r.venueId=Gt()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0)?{error:aH}:(i&&Lt({element:r,extension:{value:i,name:jz}}),t.venues.push(r),e||lt({payload:{venue:r,tournamentId:t.tournamentId},topic:pA}),{...J,venue:Me(r)})):{error:Xe,info:"missing venue"}:{error:ge}}function Jl({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:ge};if(!i)return{error:jc};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(Vy({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let o=t[a],s=Jl({tournamentRecord:o,venueId:i});if(s.success&&s.venue)return tb({tournamentRecord:e,venue:s.venue}),{...J,venue:r}}}return r?{...J,venue:r}:{error:Gm}}function LA({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=Jl({tournamentRecords:i,tournamentRecord:r,venueId:n});return Me(a,t,!0)}function rh({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:ge};if(!i)return{error:Bm};let r="findCourt",n,a;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(s=>{s.courtId===i&&(n=s,a=o)})}),n)return{...J,court:n,venue:a};if(t){let o=(Vy({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of o){let l=t[s],u=rh({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&tb({tournamentRecord:e,venue:u.venue}),{...J,court:n,venue:a}}}return ee({result:{error:Cg},stack:r})}function _A(t){return Me(rh(t),!1,!0)}function AT({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:ge};if(!i)return{error:Bm};let r=rh({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f})=>({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f}))(r.court);return{...J,courtInfo:Me(n,!1,e)}}function Lf(t){var l;let e=ze(t,[{[br]:!0},{venueId:!0,[Bo]:jc}]);if(e.error)return e;let{tournamentRecord:i,venueId:r}=t,n=Jl({tournamentRecord:i,venueId:r});if(n.error)return n;let a=(((l=n.venue)==null?void 0:l.courts)??[]).map(u=>(({courtInfo:c})=>({...c}))(AT({courtId:u.courtId,internalUse:!0,tournamentRecord:i}))),o=n.venue&&(({venueId:u,venueName:c,venueAbbreviation:d})=>({venueAbbreviation:d,venueName:c,venueId:u}))(n.venue),s=o&&{...o,courtsInfo:a};return{...J,venueData:Me(s,!1,!0)}}function sse({matchUp:t}){var r;let e=(t==null?void 0:t.timeItems)||[],i=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{endTime:(r=e.reduce((n,a)=>{let o=a.itemType===Pu&&a;return o&&(!n||i(o)>i(n))?o:n},void 0))==null?void 0:r.itemValue}}function Gi({event:t,eventId:e}){var n,a;if(!t)return{error:gi};let i=(n=gt({name:Jo,element:t}))==null?void 0:n.extension,r=e?Me(i==null?void 0:i.value,!1,!0):i==null?void 0:i.value;return e&&((a=t.drawDefinitions)==null||a.forEach(o=>{var s;(s=r==null?void 0:r.flights)==null||s.forEach(l=>{l.drawId===o.drawId&&Object.assign(l,{drawDefinition:o})})})),{flightProfile:r}}function Wn(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},o=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(o).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(r){let u,c=s.find(d=>{var m,h,f;let p=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===r);if(p)u=p,l=a[d.eventId].tournamentId;else{let g=(f=(h=d&&((m=Gi({event:d}))==null?void 0:m.flightProfile))==null?void 0:h.flights)==null?void 0:f.find(v=>v.drawId===r);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:r}}return p});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=s.find(c=>(c==null?void 0:c.eventId)===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...ee({result:{error:lo},stack:n})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...ee({result:{error:xa},context:{drawId:r,eventId:i},stack:n})}}function OT(t){var S,w,U,T,D,P,C,R,N,A;let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:o,scheduleTiming:s,matchUpFormat:l,publishStatus:u,matchUp:c}=t;if(!c)return{error:na};if(n&&!c.matchUpType&&!t.matchUpType&&(e||a)&&c.drawId){let M=t.drawDefinition||((S=e==null?void 0:e.drawDefinitions)==null?void 0:S.find(O=>O.drawId===c.drawId));!M&&a&&({drawDefinition:M,event:e}=Wn({drawId:c.drawId,tournamentRecord:a}));let E=c.structureId&&((w=M==null?void 0:M.structures)==null?void 0:w.find(({structureId:O})=>O===c.structureId));i=t.matchUpType||(E==null?void 0:E.matchUpType)||(M==null?void 0:M.matchUpType)||(e==null?void 0:e.eventType)!==sr&&(e==null?void 0:e.eventType)}let{milliseconds:d,time:p}=rse({matchUp:c}),{startTime:m}=ase({matchUp:c}),{endTime:h}=sse({matchUp:c}),f,{eventIds:g,drawIds:v}=r??{};if((!g||g.includes(c.eventId))&&(!v||v.includes(c.drawId))){let M=ne=>ne.createdAt?new Date(ne.createdAt).getTime():0,E=new Map,O=((U=c.timeItems)==null?void 0:U.toSorted((ne,de)=>M(ne)-M(de)))??[];for(let ne of O)E.set(ne.itemType,ne.itemValue);let k=E.get(kA),x=E.get(jl),F=E.get(eh),$=E.get(MT),_=E.get(Qm),L=E.get(xA),B=E.get(ET),V=E.get(Zm),G=E.get(Rc),j,z,q,W,Y,re=c.matchUpType??i;if(s&&F&&n&&re){let ne={matchUpFormat:c.matchUpFormat??l,...s};({averageMinutes:z=0,recoveryMinutes:q=0,typeChangeRecoveryMinutes:W=0}=NT({timingDetails:ne,eventType:re})),(z||q)&&(j=h?ia(bi(h),q):ia(F,z+q)),W&&(Y=h?ia(bi(h),W):ia(F,z+W))}!_&&F&&(_=pt(F));let K=pS({scheduledDate:_,scheduledTime:F}),H={},Q=((T=a&&V&&Lf({tournamentRecord:a,venueId:V}))==null?void 0:T.venueData)||{};V&&(H[V]=Q);let{venueName:X,venueAbbreviation:ie,courtsInfo:ae}=Q,le=(D=G&&(ae==null?void 0:ae.find(ne=>ne.courtId===G)))==null?void 0:D.courtName;for(let ne of x||[]){if(!a)break;ne.venueId&&!H[ne.venueid]&&(H[ne.venueId]=(P=Lf({venueId:ne.venueId,tournamentRecord:a}))==null?void 0:P.venueData);let de=H[ne.venueId];ne.venueName=de==null?void 0:de.venueName;let Ie=(C=de==null?void 0:de.courtsInfo)==null?void 0:C.find(ce=>ce.courtId===ne.courtId);ne.courtName=Ie==null?void 0:Ie.courtName}f=Ge({typeChangeTimeAfterRecovery:Y,timeAfterRecovery:j,scheduledDate:_,scheduledTime:F,isoDateString:K,homeParticipantId:k,venueAbbreviation:ie,allocatedCourts:x,timeModifiers:$,venueName:X,venueId:V,courtOrder:B,courtName:le,courtId:G,official:L,typeChangeRecoveryMinutes:W,recoveryMinutes:q,averageMinutes:z,milliseconds:d,startTime:m,endTime:h,time:p})}else f=Ge({milliseconds:d,startTime:m,endTime:h,time:p});let{scheduledDate:y}=ih({matchUp:c}),{scheduledTime:I}=_W({matchUp:c});if(o&&((R=u==null?void 0:u.displaySettings)!=null&&R.draws)){let M=u.displaySettings.draws,E=(N=(M==null?void 0:M[c.drawId])??(M==null?void 0:M.default))==null?void 0:N.scheduleDetails;if(E){let O=(A=E.find(k=>{var x;return y&&((x=k.dates)==null?void 0:x.includes(y))})??E.find(k=>{var x;return!((x=k.dates)!=null&&x.length)}))==null?void 0:A.attributes;if(O){let k=Object.assign({},...Object.keys(f).map(x=>({[x]:!0})),O);f=Im({source:f,template:k})}}}let b=c.matchUpStatus&&gr.includes(c.matchUpStatus)&&(pt(h)||pt(y)||pt(I))||void 0;return{schedule:f,endDate:b}}function lse({drawPositions:t,roundProfile:e,roundNumber:i}){var s;let r=[void 0,void 0];if(cG(t))return{orderedDrawPositions:r,displayOrder:r};let n=e==null?void 0:e[i],a=((s=n==null?void 0:n.pairedDrawPositions)==null?void 0:s.find(l=>Rn(l||[],t.filter(Boolean))))??r,o=n==null?void 0:n.feedRound;if(uG(t)){let l=[...t].sort(or);return{orderedDrawPositions:l.length===2?l:a,displayOrder:o?l:a}}if(o){let l=[t.find(u=>!isNaN(Ze(u))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:a,displayOrder:a}}function TS({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=s=>s===void 0?-1:s,o=i.map(s=>{let{collectionAssignments:l,participantId:u}=s,c=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((s,l)=>a(s.substitutionOrder)-a(l.substitutionOrder));for(let s of o){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=s;r.includes(l)||(u&&n.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),r=r.filter(d=>d!==u),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function Qo({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:ge};if(!Array.isArray(i)||i.length>2)return{error:va};if(!i.length)return ee({result:{error:Vc},stack:r});t=t??(e==null?void 0:e.participants)??[];let n=t.filter(s=>s.participantType===ht&&Vi(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),a=n[0];if(!a)return ee({result:{error:zi},stack:r});let o=Me(n.slice(1),!1,!0);return{participant:Me(a),duplicatedPairParticipants:o,...J}}function Ld({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:_e};if(typeof e!="string")return{error:pr};let{extension:i}=gt({element:t,name:Uu});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function use({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:m})=>{var g,v,y,I;let{assignedParticipantIds:h,substitutions:f}=TS({collectionPosition:i,collectionId:o,lineUp:p});if(l===Qt){if((h==null?void 0:h.length)<=2){let b=(v=(g=n==null?void 0:n[h[0]])==null?void 0:g.pairIdMap)==null?void 0:v[h[1]],S=(I=b&&((y=n[b])==null?void 0:y.participant)||Qo({participantIds:h,tournamentParticipants:t}).participant)==null?void 0:I.participantId;return{[d]:{participantId:S,teamParticipant:m,substitutions:f}}}else if((h==null?void 0:h.length)>2)return{[d]:{teamParticipant:m,substitutions:f}}}else{let b=h==null?void 0:h[0];return b&&{[d]:{participantId:b,teamParticipant:m,substitutions:f}}}};if(!(r!=null&&r.length)){let d=(s==null?void 0:s.map(p=>{var g;let{teamParticipant:m,sideNumber:h}=p,f=p.lineUp||((g=Ld({participantId:m.teamParticipantId,drawDefinition:a}))==null?void 0:g.lineUp);return u({attribute:h,lineUp:f,teamParticipant:m})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=(r==null?void 0:r.map(d=>{var g,v,y;let p=(g=e.find(I=>I.drawPosition===d))==null?void 0:g.participantId,m=s==null?void 0:s.find(I=>(I==null?void 0:I.drawPosition)===d),h=(m==null?void 0:m.teamParticipant)||p&&((v=n==null?void 0:n[p])==null?void 0:v.participant)||(t==null?void 0:t.find(({participantId:I})=>I===p)),f=(m==null?void 0:m.lineUp)||((y=Ld({participantId:p,drawDefinition:a}))==null?void 0:y.lineUp);return u({attribute:d,lineUp:f,teamParticipant:h})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function kT(t){var n,a,o;let e=ze(t,[{[Xl]:!0}]);if(e.error)return e;let i=t==null?void 0:t.matchUp,r=i==null?void 0:i.matchUpType;if(!r&&((n=i==null?void 0:i.sides)!=null&&n.length)){let s=(o=(a=i.sides.find(({participant:l})=>l))==null?void 0:a.participant)==null?void 0:o.participantType;r=s===St&&ti||s===ht&&Qt||s===Kt&&Kt||void 0}return{matchUpType:r}}function cse({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:o,sideNumber:s}){var m,h,f,g;let l=i.find(v=>v.drawPosition&&v.drawPosition===a),u=a&&t,c=s&&e,d=u?(m=u[a])==null?void 0:m.participantId:l==null?void 0:l.participantId,p=l?dse({displaySideNumber:r,seedAssignments:n,participantId:d,assignment:l,sideNumber:s}):{...c==null?void 0:c[s]};if(o&&(s===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&u){let v=(h=u[a])==null?void 0:h.teamParticipant,y=(f=u[a])==null?void 0:f.participant,I=(g=u[a])==null?void 0:g.substitutions;y&&(p.participant=y),I&&(p.substitutions=I),v&&(p.teamParticipant=v)}return p}function dse({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let o=pse({seedAssignments:e,participantId:i});Object.assign(a,o,{participantId:i}),o!=null&&o.seedNumber&&(o==null?void 0:o.seedValue)===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function pse({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}function $W({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:o,initialRoundOfPlay:s,additionalContext:l,roundNamingProfile:u,tournamentRecord:c,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:m,seedAssignments:h,usePublishState:f,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:I,drawDefinition:b,publishStatus:S,scoringActive:w,matchUpTieId:U,isRoundRobin:T,roundProfile:D,sideLineUps:P,structure:C,context:R,matchUp:N,event:A}){var je,ue,he,Re,xe,Ce,we,Ue,wt,Le,rt,Ci,Be,nt,Ii;l=l??{};let M=(je=vn({drawDefinition:b,structure:C,matchUp:N,event:A}))==null?void 0:je.tieFormat,{roundOffset:E,structureId:O,structureName:k,stage:x,stageSequence:F}=C,{drawId:$,drawName:_,drawType:L}=b??{},B=M==null?void 0:M.collectionDefinitions,V=N.collectionId&&(B==null?void 0:B.find(be=>be.collectionId===N.collectionId)),G=N.collectionId?V==null?void 0:V.matchUpFormat:N.matchUpFormat??(C==null?void 0:C.matchUpFormat)??(b==null?void 0:b.matchUpFormat)??(A==null?void 0:A.matchUpFormat),j=N.matchUpType||(V==null?void 0:V.matchUpType)||(C==null?void 0:C.matchUpType)||(b==null?void 0:b.matchUpType)||!Yi(sr)(A==null?void 0:A.eventType)&&(A==null?void 0:A.eventType),z=m?Vt:N.matchUpStatus,{schedule:q,endDate:W}=OT({scheduleVisibilityFilters:t,afterRecoveryTimes:o,tournamentRecord:c,usePublishState:f,scheduleTiming:y,drawDefinition:b,matchUpFormat:G,publishStatus:S,matchUpType:j,matchUp:N,event:A}),Y=d??N.drawPositions??[],{collectionPosition:re,collectionId:K,roundPosition:H}=N,Q=N.roundNumber??l.roundNumber,X=K?use({tournamentParticipants:i,positionAssignments:r,collectionPosition:re,participantMap:g,drawDefinition:b,drawPositions:Y,collectionId:K,sideLineUps:P,matchUpType:j}):void 0,ie=((ue=u==null?void 0:u[Q])==null?void 0:ue.roundName)||l.roundName,ae=((he=u==null?void 0:u[Q])==null?void 0:he.abbreviatedRoundName)||l.abbreviatedRoundName,le=(Re=D==null?void 0:D[Q])==null?void 0:Re.feedRound,ne=(xe=D==null?void 0:D[Q])==null?void 0:xe.preFeedRound,de=(Ce=D==null?void 0:D[Q])==null?void 0:Ce.roundFactor,Ie=n==null?void 0:n[Q],ce=H?Ie==null?void 0:Ie[H]:void 0,ke=e==null?void 0:e[Q],Pe=V!=null&&V.category?{...(R==null?void 0:R.category)||{},...V.category}:(R==null?void 0:R.category)??(A==null?void 0:A.category),it=((we=N.processCodes)==null?void 0:we.length)&&N.processCodes||((Ue=V==null?void 0:V.processCodes)==null?void 0:Ue.length)&&(V==null?void 0:V.processCodes)||((wt=C==null?void 0:C.processCodes)==null?void 0:wt.length)&&(C==null?void 0:C.processCodes)||((Le=b==null?void 0:b.processCodes)==null?void 0:Le.length)&&(b==null?void 0:b.processCodes)||((rt=A==null?void 0:A.processCodes)==null?void 0:rt.length)&&(A==null?void 0:A.processCodes)||(c==null?void 0:c.processCodes),It=(I==null?void 0:I.withCompetitiveness)&&Qy({...v,matchUp:N}),me=N.finishingPositionRange??l.finishingPositionRange,fe=be=>Ge(be,void 0,!0),pe={...fe(R),...fe({matchUpFormat:N.matchUpType===sr?void 0:G,tieFormat:N.matchUpType!==sr?void 0:M,gender:(V==null?void 0:V.gender)??(A==null?void 0:A.gender),roundOfPlay:x!==Ye&&ot(s)&&s+(Q||0),endDate:N.endDate??W,discipline:A==null?void 0:A.discipline,category:Pe,finishingPositionRange:me,abbreviatedRoundName:ae,drawPositionsRange:ce,competitiveProfile:It,structureName:k,stageSequence:F,drawPositions:Y,matchUpStatus:z,processCodes:it,isRoundRobin:T,matchUpTieId:U,preFeedRound:ne,matchUpType:j,roundFactor:de,roundOffset:E,structureId:O,roundNumber:Q,feedRound:le,roundName:ie,drawName:_,drawType:L,schedule:q,drawId:$,stage:x}),...Me(fe(N),!0,!0)};if(G&&((Ci=N.score)!=null&&Ci.scoreStringSide1)){let be=kn(G),{bestOf:Et,finalSetFormat:Ee,setFormat:qe}=be??{};(Ee!=null&&Ee.tiebreakSet||qe!=null&&qe.tiebreakSet||qe!=null&&qe.timed)&&(pe.score.sets=pe.score.sets.sort((Ot,ci)=>Ot.setNumber-ci.setNumber).map((Ot,ci)=>(ci+1===Et?(Ee!=null&&Ee.tiebreakSet||Ee!=null&&Ee.timed)&&(Ot.tiebreakSet=!0):(qe!=null&&qe.tiebreakSet||qe!=null&&qe.timed)&&(Ot.tiebreakSet=!0),Ot)))}if(Array.isArray(Y)){let{orderedDrawPositions:be,displayOrder:Et}=lse({drawPositions:Y,roundProfile:D,roundNumber:Q}),Ee=(Be=D==null?void 0:D[Q])==null?void 0:Be.feedRound,qe=Et[0]!==be[0],Ot=be.concat(void 0,void 0).slice(0,2).map((ci,yi)=>{var lU;let xi=yi+1,di=qe?3-xi:xi,gn=cse({...X,positionAssignments:r,displaySideNumber:di,seedAssignments:h,drawPosition:ci,isFeedRound:Ee,sideNumber:xi}),zr=(lU=N.sides)==null?void 0:lU.find(aC=>aC.sideNumber===xi),iu=H?(H-1)*2+yi+1:void 0,sU=iu?ke==null?void 0:ke[iu]:void 0;return fe({sourceDrawPositionRange:sU,...zr,...gn})});Object.assign(pe,Me({sides:Ot},!0,!0))}if(i&&pe.sides&&a!==!1){let be=p==null?void 0:p[_y],Et=Ee=>{var Ot;let qe=(Ot=g==null?void 0:g[Ee])==null?void 0:Ot.participant;return qe&&Im({template:be==null?void 0:be.participant,source:qe})};if(pe.sides.filter(Boolean).forEach(Ee=>{var qe,Ot,ci,yi;if(Ee.participantId){let xi=Me(Et(Ee.participantId)||(i?Uc({policyDefinitions:p,participantId:Ee.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:I}):void 0),void 0,!0);if(xi){if(b!=null&&b.entries){let di=b.entries.find(zr=>zr.participantId===Ee.participantId),gn=(qe=A==null?void 0:A.entries)==null?void 0:qe.find(zr=>zr.participantId===Ee.participantId);xi.entryStatus=(di==null?void 0:di.entryStatus)||(gn==null?void 0:gn.entryStatus),di!=null&&di.entryStage&&(xi.entryStage=di.entryStage)}Object.assign(Ee,{participant:xi})}}if((ci=(Ot=Ee==null?void 0:Ee.participant)==null?void 0:Ot.individualParticipantIds)!=null&&ci.length&&!((yi=Ee.participant.individualParticipants)!=null&&yi.length)){let xi=Ee.participant.individualParticipantIds.map(di=>Et(di)||(i?Uc({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:I,participantId:di}):void 0));Object.assign(Ee.participant,{individualParticipants:xi})}}),!pe.matchUpType){let{matchUpType:Ee}=kT({matchUp:pe});Ee&&Object.assign(pe,{matchUpType:Ee})}if(I!=null&&I.inferGender&&(!pe.gender||pe.gender===Bn)&&((nt=pe.sides)==null?void 0:nt.length)===2&&pe.matchUpType!==sr){let Ee=pe.sides.map(qe=>{var Ot,ci,yi,xi;if(Yi(ti)(pe.matchUpType))return(ci=(Ot=qe.participant)==null?void 0:Ot.person)==null?void 0:ci.sex;if(((xi=(yi=qe.participant)==null?void 0:yi.individualParticipants)==null?void 0:xi.length)===2){let di=ct(qe.participant.individualParticipants.map(gn=>{var zr;return(zr=gn.person)==null?void 0:zr.sex})).filter(Boolean);if(di.length===1)return di[0]}});if(Ee.filter(Boolean).length===2&&ct(Ee).length===1){let qe=Ee[0];pe.inferredGender=qe}}}if(pe.tieMatchUps){let be=pe.matchUpStatus===Vt,Et=(Ii=pe.sides)==null?void 0:Ii.map(({participant:Ee,drawPosition:qe,sideNumber:Ot,lineUp:ci})=>{let yi=(Ee==null?void 0:Ee.participantType)===sr&&Ee;return{teamParticipant:yi&&Ge({participantRoleResponsibilities:yi.participantRoleResponsibilities,participantOtherName:yi.participanOthertName,participantName:yi.participantName,participantId:yi.participantId,teamId:yi.teamId}),drawPosition:qe,sideNumber:Ot,lineUp:ci}});pe.tieMatchUps=pe.tieMatchUps.map(Ee=>{let qe=pe.matchUpId,Ot={finishingPositionRange:pe.finishingPositionRange,abbreviatedRoundName:ae,roundNumber:Q,roundName:ie};return $W({tieDrawPositions:Y,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:Et,drawPositionsRanges:n,initialRoundOfPlay:s,roundNamingProfile:u,additionalContext:Ot,appliedPolicies:p,isCollectionBye:be,usePublishState:f,publishStatus:S,matchUpTieId:qe,isRoundRobin:T,roundProfile:D,matchUp:Ee,event:A,tournamentParticipants:i,positionAssignments:r,tournamentRecord:c,seedAssignments:h,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:I,drawDefinition:b,scoringActive:w,structure:C,context:R})})}let Fe=pe.sides&&pe.sides.filter(be=>be==null?void 0:be.participantId).length===2,De=!pe.winningSide;if(Object.assign(pe,{readyToScore:w&&Fe&&De,hasContext:!0}),Fe){let{allParticipantsCheckedIn:be,checkedInParticipantIds:Et}=th({matchUp:pe});Object.assign(pe,{allParticipantsCheckedIn:be,checkedInParticipantIds:Et})}return Array.isArray(I==null?void 0:I.exclude)&&(I==null||I.exclude.forEach(be=>delete pe[be])),pe}function mse({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=fp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:jl});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:Me(r,!1,!0)}:e}function hse({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=fp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Rc});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function fse({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=fp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Zm});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function au(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:o,matchUpFormats:s,roundPositions:l,matchUpFormat:u,collectionIds:c,isMatchUpTie:d,roundNumbers:p,matchUpIds:m,roundNames:h,filterMatchUpTypes:f=!0,filterMatchUpIds:g=!0,stageSequences:v,scheduledDates:y,scheduledDate:I,participantIds:b,processContext:S,tournamentIds:w,matchUpTypes:U,structureIds:T,readyToScore:D,courtIds:P,eventIds:C,venueIds:R,drawIds:N,stages:A}=t,M=Array.isArray(b)?b.filter(Boolean):[],E=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],k=Array.isArray(A)?A.filter(Boolean):[],x=Array.isArray(v)?v.filter(Boolean):[],F=Array.isArray(c)?c.filter(Boolean):[],$=Array.isArray(h)?h.filter(Boolean):[],_=Array.isArray(p)?p.filter(Boolean):[],L=Array.isArray(l)?l.filter(Boolean):[],B=Array.isArray(m)&&g?m.filter(Boolean):[],V=Array.isArray(U)&&f?U.filter(Boolean):[],G=Array.isArray(P)?P.filter(Boolean):[],j=Array.isArray(R)?R.filter(Boolean):[],z=Array.isArray(s)&&s.filter(Boolean)||typeof u=="string"&&[u]||[],q=Array.isArray(y)&&y.filter(Boolean)||typeof I=="string"&&I.length&&[I]||[],W=Array.isArray(w)?w.filter(Boolean):[],Y=Array.isArray(C)?C.filter(Boolean):[],re=Array.isArray(N)?N.filter(Boolean):[],K=Array.isArray(T)?T.filter(Boolean):[];return e.filter(H=>{var Q;if(D&&!Yi(ka)(H)&&!H.readyToScore||H.winningSide&&o&&![1,2].includes(H.winningSide)||d!==void 0&&(d&&!H.tieMatchUps||!d&&H.tieMatchUps)||n!==void 0&&(n&&!H.collectionId||!n&&H.collectionId)||k.length&&!k.includes(H.stage)||x.length&&!x.includes(H.stageSequence)||F.length&&(!H.collectionId||!F.includes(H.collectionId))||$.length&&(!H.roundName||!$.includes(H.roundName))||_.length&&(!H.roundNumber||!_.includes(H.roundNumber))||L.length&&(!H.roundPosition||!L.includes(H.roundPosition))||E.length&&(!H.matchUpStatus||!E.includes(H.matchUpStatus))||O.length&&H.matchUpStatus&&O.includes(H.matchUpStatus)||B.length&&!B.includes(H.matchUpId)||V.length&&(!H.matchUpType||!_0(V,H.matchUpType))||z.length&&(!H.matchUpFormat||!z.includes(H.matchUpFormat)))return!1;if(q!=null&&q.length){let{scheduledTime:X}=_W({matchUp:H}),{scheduledDate:ie}=ih({matchUp:H}),ae=pt(X)||ie;if(!q.find(le=>_l(le,ae)))return!1}if(G.length){let{courtId:X}=hse({matchUp:H}),{allocatedCourts:ie}=mse({matchUp:H}),ae=ie==null?void 0:ie.map(({courtId:le})=>le);if(!G.filter(Boolean).includes(X)||ae!=null&&ae.includes(X))return!1}if(j.length){let{venueId:X}=fse({matchUp:H});if(!j.filter(Boolean).includes(X))return!1}if(S){if(W.length&&!W.includes(H.tournamentId)||Y.length&&!Y.includes(H.eventId)||re.length&&!re.includes(H.drawId)||K.length&&!K.includes(H.structureId))return!1;let X=((Q=H.sides)==null?void 0:Q.map(({participantId:ie})=>ie).filter(Boolean))??[];if(r&&X.length<r||M.length&&!M.some(ie=>X.includes(ie)))return!1}return!0})}function Wt(t){var G,j,z,q,W,Y,re;let{provisionalPositioning:e,tournamentRecord:i,contextFilters:r,matchUpFilters:n,contextProfile:a,drawDefinition:o,context:s={},structure:l,inContext:u,event:c}=t,{seedAssignments:d,contextContent:p,exitProfiles:m,matchUpsMap:h}=t,f={},g={};if(!l)return{collectionPositionMatchUps:f,error:sp,roundMatchUps:g,matchUps:[]};let v=Array.isArray(n==null?void 0:n.eventIds)?n==null?void 0:n.eventIds.filter(Boolean):[],y=Array.isArray(n==null?void 0:n.structureIds)?n==null?void 0:n.structureIds.filter(Boolean):[],I=Array.isArray(n==null?void 0:n.drawIds)?n==null?void 0:n.drawIds.filter(Boolean):[],b=!(s!=null&&s.eventId)||!(v!=null&&v.length)&&!((G=r==null?void 0:r.eventIds)!=null&&G.filter(Boolean).length)||(v==null?void 0:v.includes(s.eventId))||((j=r==null?void 0:r.eventIds)==null?void 0:j.includes(s.eventId)),S=!(y!=null&&y.length)||y.includes(l.structureId),w=!o||!(I!=null&&I.length)||I.includes(o.drawId);if(!b||!S||!w)return{collectionPositionMatchUps:f,roundMatchUps:g,matchUps:[]};a&&!p&&(p=zu({tournamentRecord:i,contextProfile:a,drawDefinition:o}));let{appliedPolicies:U}=$t({drawDefinition:o}),T={...t.tournamentAppliedPolicies,...U,...t.policyDefinitions},D=(z=T==null?void 0:T.scoring)==null?void 0:z.structures,P=l.stage&&((q=D==null?void 0:D.stage)==null?void 0:q[l.stage]),C=l.stageSequence&&((W=P==null?void 0:P.stageSequence)==null?void 0:W[l.stageSequence]),R=((Y=T==null?void 0:T.scoring)==null?void 0:Y.requireAllPositionsAssigned)||(P==null?void 0:P.requireAllPositionsAssigned)||(C==null?void 0:C.requireAllPositionsAssigned);h||(h=sn({drawDefinition:o,structure:l}));let{positionAssignments:N,allPositionsAssigned:A}=Rr({structure:l}),M=!R||A,{seedAssignments:E}=po({provisionalPositioning:e,drawDefinition:o,structure:l});d=d??E;let{structureId:O}=l;m=m||o&&bW({drawDefinition:o}).exitProfiles;let k=m==null?void 0:m[O],x=(k==null?void 0:k.length)&&(k[0].split("-").map(K=>parseInt(K)).reduce((K,H)=>K+H)||0),F=!!l.structures,$=Fd({matchUpsMap:h,structureId:O,inContext:u}),_=T==null?void 0:T[Of],L=$oe({roundNamingPolicy:_,drawDefinition:o,structure:l,matchUps:$}),{roundNamingProfile:B,roundProfile:V}=L;if(g=(L==null?void 0:L.roundMatchUps)??[],n&&($=au({matchUps:$,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),u){let{sourceDrawPositionRanges:K}=Foe({drawDefinition:o,matchUpsMap:h,structureId:O}),H=o?Loe({drawDefinition:o,roundProfile:V,matchUpsMap:h,structureId:O}).drawPositionsRanges:void 0;$=$.map(Q=>$W({tournamentParticipants:t.tournamentParticipants??(i==null?void 0:i.participants),scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,participantMap:t.participantMap,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:K,positionAssignments:N,drawPositionsRanges:H,initialRoundOfPlay:x,roundNamingProfile:B,tournamentRecord:i,appliedPolicies:T,seedAssignments:d,contextContent:p,contextProfile:a,drawDefinition:o,scoringActive:M,isRoundRobin:F,roundProfile:V,structure:l,context:s,matchUp:Q,event:c})),($==null?void 0:$.filter(Q=>Array.isArray(Q.tieMatchUps))).forEach(Q=>{let X=Q.tieMatchUps;$=$.concat(...X)}),r&&($=au({processContext:!0,...r,matchUps:$}))}else($==null?void 0:$.filter(K=>Array.isArray(K.tieMatchUps))).forEach(K=>{let H=K.tieMatchUps;$=$.concat(...H)});return n&&($=au({matchUps:$,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n!=null&&n.matchUpTypes||n!=null&&n.matchUpIds)&&($=au({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:$})),(n!=null&&n.matchUpTypes||n!=null&&n.matchUpIds||u)&&(g=Cn({matchUps:$}).roundMatchUps??[]),(re=vn({drawDefinition:o,structure:l,event:c}))!=null&&re.tieFormat&&({collectionPositionMatchUps:f}=xoe({matchUps:$})),{collectionPositionMatchUps:f,roundMatchUps:g,isRoundRobin:F,roundProfile:V,matchUpsMap:h,matchUps:$}}function Pd({matchUp:t}){return t?gr.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function xT({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:m,publishStatus:h,contextProfile:f,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structureId:I,inContext:b,structure:S,context:w,event:U}){!S&&I&&({structure:S}=et({drawDefinition:g,structureId:I}));let T=Wt({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:m,publishStatus:h,contextProfile:f,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structure:S,inContext:b,context:w,event:U}),D=[],P=[],C=[],R=[],N=[];if(T.error)return T;let{matchUps:A}=T,{assignedPositions:M}=Rr({structure:S}),E=M==null?void 0:M.filter(k=>k.participantId).map(k=>k.drawPosition),O;return A.filter(k=>{var F;let x=((F=u==null?void 0:u.matchUpTypes)==null?void 0:F.length)===1&&u.matchUpTypes[0]===hi;return!(k.matchUpType!==hi&&x)}).forEach(k=>{var G,j,z,q;if(k.matchUpStatus===$a){D.push(k);return}k.matchUpType===hi&&(O=!0);let x=k.collectionId,F=x&&((G=k.sides)==null?void 0:G.every(W=>W.participantId)),$=!x&&((j=k.drawPositions)==null?void 0:j.filter(Boolean).length)===2,_=!x&&((z=k.drawPositions)==null?void 0:z.every(W=>E==null?void 0:E.includes(W))),L=M==null?void 0:M.filter(W=>W.bye).map(W=>W.drawPosition),B=!x&&((q=k.drawPositions)==null?void 0:q.find(W=>L==null?void 0:L.includes(W))),V=eW.includes(k.matchUpStatus)&&(F||$&&(!t||_));return B?N.push(k):Pd({matchUp:k})?P.push(k):V?C.push(k):R.push(k)}),{includesTeamMatchUps:O,abandonedMatchUps:D,completedMatchUps:P,upcomingMatchUps:C,pendingMatchUps:R,byeMatchUps:N,structure:S}}function gse({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:_e};if(!i)return{error:za};let{links:r}=Lg({drawDefinition:t,structureId:i}),n=r.source.reduce((o,s)=>!s.source.roundNumber||s.source.roundNumber===e?o.concat(s):o,[]),a=r.target.reduce((o,s)=>!s.target.roundNumber||s.target.roundNumber===e?o.concat(s):o,[]);return{links:{source:n,target:a}}}function sC({finishingPositions:t,linkCondition:e,linkType:i,source:r}){var a;let n=r.find(o=>{var l,u;let s=!((l=o.source)!=null&&l.finishingPositions)||!t||Rn(t,(u=o.source)==null?void 0:u.finishingPositions);return e===o.linkCondition&&s&&o.linkType===i});return[wu,$l].includes(n==null?void 0:n.linkType)&&!((a=n==null?void 0:n.source)!=null&&a.roundNumber)?ee({result:{error:oe},stack:"getTargetLink",context:n}):n}function Lg({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>{var a,o;return((a=n.source)==null?void 0:a.structureId)===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),((o=n.target)==null?void 0:o.structureId)===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r},{source:[],target:[]})}:{error:za}:{error:_e}}function vse({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(o=>o.roundNumber===i&&!o.matchUpTieId),a=t.filter(o=>o.roundNumber===i+1&&!o.matchUpTieId);if(a.length){let o;return a.length===n.length?o=a.find(s=>s.roundPosition===r):a.length===n.length/2&&(o=a.find(s=>s.roundPosition===Math.ceil(r/2))),{matchUp:o}}return{message:"no progression found"}}function lC({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){var D;if(!n)return{error:uN};let{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:l,positionInterleave:u}}=n,{structure:c}=et({drawDefinition:r,structureId:a}),{positionAssignments:d}=ai({structure:c}),p=(e==null?void 0:e.filter(P=>P.structureId===(c==null?void 0:c.structureId))).filter(P=>P.roundNumber===l&&!P.matchUpTieId),m=p.length,h=Se(1,m+1),f=m/t,g=Math.ceil(f*i),v=1-i%2;if(u!=null&&u.interleave&&f!==.5){let P=u.offset+(i-1)*u.interleave,C=i+P;g=Math.ceil(C/2),v=1-C%2}let y=h,I=h[g-1],b=yW({roundPositionsCount:h.length,groupedOrder:s}),S=(b==null?void 0:b.length)||1;if(S<=h.length){let P=m/S,C=Pr(h,P);o===Ad&&C.forEach(R=>R.reverse()),y=(b==null?void 0:b.length)&&(b==null?void 0:b.map(R=>C[R-1]).flat())||y}o===Fo?I=y[g-1]:o===Ad?((!(b!=null&&b.length)||S>h.length)&&(g=p.length+1-g),I=y[g-1]):o===sT&&Fa()&&console.log(X0,{feedProfile:o});let w=I&&p.reduce((P,C)=>C.roundPosition===I?C:P,void 0),U;w!=null&&w.feedRound?(v=0,U=Math.min(...(w.drawPositions||[]).filter(Boolean))):U=((D=w==null?void 0:w.drawPositions)==null?void 0:D.length)===2&&(w==null?void 0:w.drawPositions[v]);let T=d==null?void 0:d.find(({drawPosition:P})=>P===U);if(T){let{extension:P}=gt({element:T,name:yT});if(P!=null&&P.value)return{disabledDrawPosition:U}}return{matchUp:w,targetDrawPosition:U,matchUpDrawPositionIndex:v}}function En({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(s=>s.matchUpId===n));let{structure:o}=et({structureId:a==null?void 0:a.structureId,drawDefinition:r});return(o==null?void 0:o.finishingPosition)===qm?Ise({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:o,matchUp:a}):yse({matchUp:a})}function Ise({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){var R,N,A;let{winnerMatchUpId:a,loserMatchUpId:o}=n,{links:s}=gse({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),l=s==null?void 0:s.source,u=sC({source:l,linkType:wu}),c=sC({linkCondition:el,linkType:$l,source:l}),d=sC({source:l,linkType:$l}),p=c&&d;d||(d=c);let m=(R=u==null?void 0:u.target)==null?void 0:R.feedProfile,h=(N=d==null?void 0:d.target)==null?void 0:N.feedProfile,f=(A=c==null?void 0:c.target)==null?void 0:A.feedProfile,g,v,y,I,b,S,w,U,T,D;if(e&&(a||o)&&(w=a&&m!==Oo&&t.find(({matchUpId:M})=>M===a),I=o&&h!==Oo&&t.find(({matchUpId:M})=>M===o),w||I))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u},targetMatchUps:{loserMatchUp:I,winnerMatchUp:w}};let{roundPosition:P}=n;D=D||t.filter(M=>M.structureId===r.structureId);let C=D.reduce((M,E)=>E.roundNumber===n.roundNumber&&!E.matchUpTieId?M+1:M,0);return d&&!I&&h!==Oo&&({matchUpDrawPositionIndex:S,targetDrawPosition:b,matchUp:I}=lC({targetLink:d,sourceRoundMatchUpCount:C,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),p&&f!==Oo&&({matchUpDrawPositionIndex:y,targetDrawPosition:v,matchUp:g}=lC({targetLink:c,sourceRoundMatchUpCount:C,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),u&&!w&&m!==Oo&&({matchUpDrawPositionIndex:T,targetDrawPosition:U,matchUp:w}=lC({targetLink:u,sourceRoundMatchUpCount:C,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),w||(D=D||t.filter(M=>M.structureId===r.structureId),{matchUp:w}=vse({structureMatchUps:D,matchUp:n})),Ge({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u,byeTargetLink:c},targetMatchUps:{winnerMatchUpDrawPositionIndex:T,loserMatchUpDrawPositionIndex:S,byeMatchUpDrawPositionIndex:y,winnerTargetDrawPosition:U,loserTargetDrawPosition:b,byeTargetDrawPosition:v,winnerMatchUp:w,loserMatchUp:I,byeMatchUp:g},targetMatchUpIds:!!(a||o)})}function yse({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function bse({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{var l,u,c,d,p,m;let{matchUpId:n,structureId:a,drawPositions:o=[]}=r,{structure:s}=et({drawDefinition:t,structureId:a});if((s==null?void 0:s.finishingPosition)===Od){let{roundNumber:h}=r,f=h&&Ze(h)+1,g=s.matchUps??[],{roundMatchUps:v}=Cn({matchUps:g});if(f&&(v!=null&&v[f])){let y=[...o].sort(or).map((I,b)=>{let S=v[f].find(w=>{var U;return(U=w.drawPositions)==null?void 0:U.includes(I)});return{matchUpId:S==null?void 0:S.matchUpId,roundNumber:f,schedule:S==null?void 0:S.schedule,sideNumber:b+1,structureName:s.structureName}});Object.assign(r,{sidesTo:y})}}else{let h=En({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:n}),{winnerMatchUp:f}=h.targetMatchUps,{loserMatchUp:g}=h.targetMatchUps;!r.winnerMatchUpId&&f&&(r.winnerMatchUpId=f.matchUpId),!r.loserMatchUpId&&g&&(r.loserMatchUpId=g.matchUpId);let v=uC({upcomingMatchUp:f}),y=uC({upcomingMatchUp:g});if(r.matchUpStatus!==Vt&&(g==null?void 0:g.matchUpStatus)===Vt){let{matchUp:b}=BW({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=b&&uC({upcomingMatchUp:b})||y}let I=(l=r.schedule)==null?void 0:l.timeAfterRecovery;if(I&&((u=v==null?void 0:v.schedule)!=null&&u.scheduledTime&&kt(v.schedule.scheduledTime)<kt(I)&&(i[v.matchUpId]=r.matchUpId,v.schedule.scheduleConflict=r.matchUpId),(c=y==null?void 0:y.schedule)!=null&&c.scheduledTime&&kt(y.schedule.scheduledTime)<kt(I)&&(i[y.matchUpId]=r.matchUpId,y.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:v,loserTo:y}),(d=r.drawPositions)==null?void 0:d.filter(Boolean).length){let b=((m=(p=h.targetLinks)==null?void 0:p.loserTargetLink)==null?void 0:m.linkCondition)===el,S=wse(r);if(S.length){let w=RE(f==null?void 0:f.sides),U=RE(g==null?void 0:g.sides),T=S.find(({participantId:P})=>w.includes(P))?[]:S,D=S.find(({participantId:P})=>U.includes(P))?[]:S;g&&b&&D.length<2&&D.push({bye:!0,tbd:!0}),T!=null&&T.length&&f&&(!h.targetMatchUpIds&&f&&(f=e.find(({matchUpId:P})=>P===f.matchUpId)),f.potentialParticipants||(f.potentialParticipants=[]),f.potentialParticipants.push(T)),D!=null&&D.length&&g&&(h.targetMatchUpIds||(f=e.find(({matchUpId:P})=>P===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(D))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function wse(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:r,qualifier:n})=>i||r&&{participantId:r}||n&&{qualifier:n}).filter(Boolean))||[]}function BW({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var o;let{matchUpId:r,matchUpStatus:n,structureId:a}=t||{};if(!t||!a||(t==null?void 0:t.matchUpStatus)===Ji)return{matchUp:t};if(n===Vt){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((o=En({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r}))==null?void 0:o.targetMatchUps)||{},BW({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function uC(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o}))(t.upcomingMatchUp)}function mr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=_g(t);if(i.error)return ee({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:o,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...o??[],...s??[]),matchUpsMap:l}}function _g(t){if(!(t!=null&&t.drawDefinition))return{error:_e};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:m,scheduleTiming:h,participantMap:f,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:I,inContext:b,context:S,event:w}=t,U=[],T=[],D=[],P=[],C=[];v&&!i&&(i=zu({policyDefinitions:u,tournamentRecord:c,contextProfile:v,event:w}));let R;!(e!=null&&e.length)&&c&&(e=c==null?void 0:c.participants,(b||s!=null&&s.withGroupings)&&(e!=null&&e.length)&&({participantsWithGroupings:e,groupInfo:R}=PA({participants:e,participantsProfile:s})));let{structures:N}=Zo({drawDefinition:y});if(!N)return{error:Ei};r||(r=sn({drawDefinition:y}));let A=y&&bW({drawDefinition:y}).exitProfiles;N.forEach(O=>{let{byeMatchUps:k=[],pendingMatchUps:x=[],upcomingMatchUps:F=[],completedMatchUps:$=[],abandonedMatchUps:_=[]}=xT({matchUpFilters:I?void 0:m,contextFilters:I?void 0:p,inContext:b||I||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:f,scheduleTiming:h,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:A,matchUpsMap:r,structure:O,context:S,event:w});U=U.concat(..._),T=T.concat(...$),D=D.concat(...F),P=P.concat(...x),C=C.concat(...k)});let M=O=>(!m&&!I&&!p||(m&&(O=au({matchUps:O,...m})),p&&(O=au({matchUps:O,...p,processContext:!0}))),O),E={abandonedMatchUps:M(U),completedMatchUps:M(T),upcomingMatchUps:M(D),pendingMatchUps:M(P),byeMatchUps:M(C),matchUpsMap:r,...J,groupInfo:R};if(I){let O=typeof I=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:k,completed:x,upcoming:F,pending:$,bye:_}=O,L=[].concat(...k&&U||[],...x&&T||[],...F&&D||[],...$&&P||[],..._&&C||[]);bse({inContextDrawMatchUps:L,drawDefinition:y})}return E}function Zl(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextFilters:d,contextProfile:p,matchUpFilters:m,nextMatchUps:h,inContext:f,context:g,event:v}=t;if(!v)return{error:gi};let{eventId:y,eventName:I,endDate:b,eventType:S,category:w,gender:U,matchUpFormat:T}=v??{},D={...g,...Ge({indoorOutDoor:v.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),surfaceCategory:v.surfaceCategory??(c==null?void 0:c.surfaceCategory),endDate:v.endDate??(c==null?void 0:c.endDate),tournamentId:c==null?void 0:c.tournamentId,matchUpFormat:T,eventName:I,eventType:S,category:w,eventId:y,gender:U})};b&&(D.endDate=b),p&&!i&&(i=zu({policyDefinitions:l,tournamentRecord:c,contextProfile:p,event:v}));let P;if(!(e!=null&&e.length)&&!r&&c){let N=Xm({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:p,inContext:f});r=N.participantMap,e=N.participants??[],P=N.groupInfo}let C=v.drawDefinitions??[],R=zy({tournamentRecord:c,event:v}).scheduleTiming;return{matchUps:C.flatMap(N=>{let{matchUps:A}=mr({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:D,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,contextFilters:d,contextProfile:p,drawDefinition:N,contextContent:i,matchUpFilters:m,participantMap:r,scheduleTiming:R,nextMatchUps:h,inContext:f,event:v});return A??[]}),groupInfo:P}}function Br(t){let e=ze(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:ge};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,contextProfile:d,matchUpFilters:p,contextFilters:m,nextMatchUps:h,context:f}=t,g=t.tournamentId??u.tournamentId,v=(u==null?void 0:u.events)??[];r||({participants:r,participantMap:i}=Xm({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,contextProfile:d,inContext:c}));let{appliedPolicies:y}=$t({tournamentRecord:u}),I={...f,tournamentId:g,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},b=zu({policyDefinitions:l,tournamentRecord:u,contextProfile:d});return{matchUps:v.flatMap(S=>{var w;return I.eventDrawsCount=((w=S.drawDefinitions)==null?void 0:w.length)??0,Zl({context:I,scheduleVisibilityFilters:n,tournamentAppliedPolicies:y,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,contextContent:b,contextFilters:m,contextProfile:d,matchUpFilters:p,participantMap:i,nextMatchUps:h,participants:r,inContext:c,event:S}).matchUps??[]}).concat(...u.matchUps??[])}}function Rs({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof r!="object"||!Object.keys(r).length)return{error:Oi};let u=Object.keys(r).map(c=>{let d=r[c];return Br({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:d,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}).matchUps??[]}).flat();return{...J,matchUps:u}}function nh(t,e){return Use(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function Use(t,e){return(vm[t==null?void 0:t.stage]||0)-(vm[e==null?void 0:e.stage]||0)}function Sn(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:m,drawDefinition:h,nextMatchUps:f,inContext:g,context:v,event:y}=t,{eventId:I,eventName:b,endDate:S,eventType:w,category:U,gender:T,matchUpFormat:D}=y??{},P={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(c==null?void 0:c.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(c==null?void 0:c.indoorOutdoor),matchUpFormat:D,eventType:w,eventName:b,category:U,eventId:I,endDate:S,gender:T},C;return!(e!=null&&e.length)&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:C}=Xm({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:m,inContext:g})),m&&!r&&(r=zu({policyDefinitions:l,tournamentRecord:c,contextProfile:m,drawDefinition:h,event:y})),{...mr({context:P,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,drawDefinition:h,contextContent:r,contextFilters:p,contextProfile:m,matchUpFilters:d,participantMap:i,nextMatchUps:f,inContext:g,event:y}),groupInfo:C}}function Kp({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Me(t),r=e.split("."),n=[],a;s({targetElement:i,attributes:r});let o={value:a};return n.length&&(o.values=n),o;function s({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,m]of u.entries())if(l!=null&&l[m]){let h=u.slice(p+1);h.length?Array.isArray(l[m])?l[m].forEach(f=>s({targetElement:f,attributes:h})):(l=l[m],d({targetElement:l,index:p})):(a||(a=l[m]),n.includes(l[m])||n.push(l[m]))}function d({targetElement:p,index:m}){if(p&&m===u.length-1&&["string","number"].includes(typeof p)){let h=c?p.slice(0,c):p;a?n.includes(h)||n.push(h):(a=h,n.push(h))}}}}var VW=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(r=>{var n;return{[r]:(n=Kp({element:e,accessor:r}))==null?void 0:n.value}})||typeof t=="object"&&Object.keys(t).map(r=>{var n;return{[r]:(n=Kp({element:e,accessor:r}))==null?void 0:n.value}})||((i=typeof t=="string"&&Kp({element:e,accessor:t}))==null?void 0:i.value)},Ta=VW;function ib({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:o,fmlc:s}){var g;if(!wo(a))return[];let{roundProfile:l,roundNumbers:u=[]}=Cn({interpolate:!0,matchUps:a});r=r??Math.max(...u,0);let c=n?r-n:0,d=c&&((g=l==null?void 0:l[r-c])==null?void 0:g.matchUpsCount),p=l&&Object.values(l).map(Ta("matchUpsCount")),m=(v,y)=>{let I=Math.min(...v);d&&y&&I===1&&(I=d);let b=Math.max(...v);return e&&b>e&&(b=e),[I,b]},h=l&&Object.assign({},...u.map(v=>{let y=(r??0)+1-v-c,I=l[v].matchUpsCount,b={finishingPositionRange:{},finishingRound:y},S=p==null?void 0:p.slice(v-1).reduce((N,A)=>N+(A||0),0),w=s&&v!==1,U=1+t+(w?i??0:0),T=1,D=Se(U,o?U+I*2:S+U+T),P=S+T-I,C=m(D.slice(P)),R=m(D.slice(0,P),!0);return b.finishingPositionRange={loser:C,winner:R},{[v]:b}})),f=Fa({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&h[v.roundNumber];f&&!y&&console.log({roundFinishingData:h,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),a}function _d({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var n;if(!e)return{error:_e};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=mr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((n=e==null?void 0:e.structures)==null?void 0:n.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];ib({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:o,structureId:s}=a,l=En({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:o}),{winnerMatchUp:u,loserMatchUp:c}=l.targetMatchUps,d=u==null?void 0:u.matchUpId,p=c==null?void 0:c.matchUpId,m=Fd({matchUpsMap:i,structureId:s}).find(h=>h.matchUpId===o);if(m&&(d&&(r.winnerMatchUpIds[m.matchUpId]=d,Object.assign(m,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(r.loserMatchUpIds[m.matchUpId]=p,a.loserMatchUpId=p,m.loserMatchUpId=p,a.finishingPositionRange))){let h=c.finishingPositionRange&&[...a.finishingPositionRange.loser,...c.finishingPositionRange.loser],f=h&&[Math.min(...h),Math.max(...h)];a.finishingPositionRange.loser=f,m.finishingPositionRange.loser=f}}),{inContextDrawMatchUps:t,goesToMap:r}}function ls(t){var y;let e=Io(t),i=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:o}=t;if(!Array.isArray(i))return{error:Bu};if(!Array.isArray(r))return{error:ks};let s=(y=t.matchUpIds)!=null&&y.length?t.matchUpIds:i.map(I=>I.matchUpId);if(!Array.isArray(s))return{error:$m};let l={},u={},c={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),m=p.reduce((I,b)=>I.concat(b.events??[]).map(S=>(S.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:I})=>I===bu),h=i;if(m.length){h=Rs({nextMatchUps:!0,tournamentRecords:e}).matchUps;let I=m.reduce((b,S)=>{var T,D;let w=(T=S.source)==null?void 0:T.structureId,U=(D=S.target)==null?void 0:D.structureId;return w&&U&&(c[U]=w),w&&!b.includes(w)&&b.push(w),b},[]);for(let b of I)l[b]=[];for(let b of h??[]){let S=b.containerStructureId||b.structureId;I.includes(S)&&l[S].push(b.matchUpId)}}let f=I=>{u[I]||(u[I]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[I]=[])},g=(I,b)=>{u[I].matchUpIds.forEach(S=>{u[b].matchUpIds.push(S)}),u[b].matchUpIds.push(I),u[I].dependentMatchUpIds.push(b),n&&u[I].participantIds.forEach(S=>u[b].participantIds.push(S))},v=I=>{let b=Object.keys(l).length;for(let S of I||[]){let{matchUpId:w,winnerMatchUpId:U,loserMatchUpId:T}=S;if(!s.length||s.includes(w)){if(f(w),n){let{individualParticipantIds:C}=PT(S);u[w].participantIds=C}U&&(f(U),g(w,U),d[U].push(w)),T&&(f(T),g(w,T),d[T].push(w)),u[w].sources.push(d[w]);let D=d[w].map(C=>u[C].sources[0]).flat(),P=d[w].map(C=>u[C].sources[1]).flat();if(u[w].sources.push(D,P),b){let C=S.containerStructureId||S.structureId,R=c[C];if(l[R])for(let N of l[R])f(N),g(N,w),d[N].push(w)}}}};if(o)_d({drawDefinition:o}),h!=null&&h.length||(h=Sn({drawDefinition:o}).matchUps),v(h);else{if(h!=null&&h.length||(h=Rs({nextMatchUps:!0,tournamentRecords:e}).matchUps),!r.length){let I=p!=null&&p.length?p.map(({events:b=[]})=>b.map(({drawDefinitions:S=[]})=>S.map(({drawId:w})=>w))).flat(1/0):[];I&&(r=I)}for(let I of r){let b=h==null?void 0:h.filter(S=>S.drawId===I).sort(nh);if(!(b!=null&&b.find(({roundPosition:S})=>!S))){let S=b==null?void 0:b.find(({tournamentId:U})=>U),{drawDefinition:w}=Wn({tournamentRecord:e[S==null?void 0:S.tournamentId],drawId:I});w&&_d({drawDefinition:w})}v(b)}}return{positionDependencies:l,matchUpDependencies:u,sourceMatchUpIds:d,matchUps:h,...J}}function vr(t){var d,p;let e=t==null?void 0:t.matchUp,i=(t==null?void 0:t.score)||(e==null?void 0:e.score),r=(d=i==null?void 0:i.sets)==null?void 0:d[0],{side1Score:n,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s,side1PointScore:l,side2PointScore:u}=r||{},c=n||a||o||s||l||u;return!!(((p=i==null?void 0:i.sets)==null?void 0:p.length)>1||c)}function rb({matchUpStatus:t}){return Zz.includes(t)}function Sse({matchUpStatus:t}){return uA.includes(t)}function xE({matchUpStatus:t}){return Qz.includes(t)}function $A({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){var s;let a=r==null?void 0:r.find(({participantId:l})=>l),o=(s=i==null?void 0:i.filter($A))==null?void 0:s.length;return vr({score:n})||o||e&&a||t&&Sse({matchUpStatus:t})&&![Mt,zt,os].includes(t)}function nb(t){var U;let{drawDefinition:e,findContainer:i,structureId:r,event:n}=t,a=t.structure,o={isCollectionMatchUp:!1},{containedStructures:s}=Fg({drawDefinition:e}),l=r?s[r]||[]:[];if(!a){let T=et({drawDefinition:e,structureId:r});if(T.error)return T;a=i?T.containingStructure??T.structure:T.structure}if(zn({structure:a}))return{structure:a,isAdHoc:!0,error:Sg};let{matchUps:u}=mr({inContext:!0,matchUpFilters:o,drawDefinition:e,event:n}),c=u==null?void 0:u.filter(T=>T.structureId===r||l.includes(T.structureId)),{matchUpDependencies:d}=ls({drawIds:[e.drawId],matchUps:u,drawDefinition:e}),p=[],m=[],h={},f=[];for(let T of u??[]){if(T.structureId===r||l.includes(T.structureId)){m.push(...T.drawPositions??[]);let D=T.roundNumber;for(let P of(T.drawPositions??[]).filter(Boolean))(!h[P]||D&&h[P]>D)&&(h[P]=D)}$A(T)&&(f.push(T),p.push(T.matchUpId,...((U=d==null?void 0:d[T==null?void 0:T.matchUpId])==null?void 0:U.matchUpIds)||[]))}let g=ct(m.filter(Boolean)).sort(or),v=ct(p),y=ct(c==null?void 0:c.map(({matchUpId:T,drawPositions:D})=>v.includes(T)?D:[]).flat().filter(Boolean)).sort(or),{positionAssignments:I}=ai({drawDefinition:e,structure:a}),b=I==null?void 0:I.filter(T=>T.bye).map(T=>T.drawPosition),S=I==null?void 0:I.filter(T=>T.qualifier).map(T=>T.drawPosition),w=(g==null?void 0:g.filter(T=>!y.includes(T)))||[];return{allDrawPositions:g,inContextStructureMatchUps:c,drawPositionInitialRounds:h,activeDependentMatchUpIds:v,qualifyingDrawPositions:S,inactiveDrawPositions:w,positionAssignments:I,activeDrawPositions:y,byeDrawPositions:b,activeMatchUps:f,structure:a}}function Um({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(or)[0]}}var nc={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},DS=[];function Aa(t,e){Ti(t)&&(t={method:t}),(e||Fa())&&DS.push(t)}function Tse(t){let e=DS.slice();return t&&(DS.length=0),e}function Dse(t){let e=Tse(t).map(i=>{let{color:r,keyColors:n,method:a,newline:o}=i,s=Object.keys(nc).includes(r)?nc[r]:nc.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=n&&Object.keys(n).includes(c)&&nc[n[c]]?nc[n[c]]:nc.brightwhite;return`${nc.white}${c}: ${d}${i[c]}`}).join(", "),u=(a==null?void 0:a.length)<15?"		":"	";return[o?`
`:"",s,a,u,nc.white,l,nc.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function Pse(){DS.length=0}function Ya({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUpsMap:a,structureId:o,structure:s,event:l}){var D,P,C;if(!r)return{error:_e};if(s||({structure:s}=et({drawDefinition:r,structureId:o})),!s)return{error:Ei};o||({structureId:o}=s);let u="assignDrawPositionBye";Aa({method:u,color:"cyan",drawPosition:n}),a||(a=sn({drawDefinition:r}));let{positionAssignments:c}=ai({structure:s}),{activeDrawPositions:d}=nb({drawDefinition:r,structureId:o});if((D=c==null?void 0:c.find(R=>R.drawPosition===n))!=null&&D.bye)return{...J};if(d!=null&&d.includes(n))return{error:$0};let p=c==null?void 0:c.find(R=>R.drawPosition===n);if(!p)return{error:Sg};let{filled:m,containsBye:h,assignedParticipantId:f}=Rse(p);if(h)return{...J};if(m&&!h)return ee({result:{error:Sf},stack:u});let g=$t({tournamentRecord:i,drawDefinition:r,event:l}).appliedPolicies??{},v=mr({inContext:!0,drawDefinition:r,matchUpsMap:a}).matchUps??[],y={isCollectionMatchUp:!1},{matchUps:I}=Wt({provisionalPositioning:t,drawDefinition:r,matchUpFilters:y,matchUpsMap:a,structure:s});if(c==null||c.forEach(R=>{R.drawPosition===n&&(R.bye=!0)}),s.structureType===xn)return Cse({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:I}),Pc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),RB({assignedParticipantId:f,isPositionAction:e,appliedPolicies:g,drawDefinition:r,drawPosition:n,structureId:o,stack:u});let{roundProfile:b,roundMatchUps:S}=Cn({matchUps:I}),w=(P=b&&Object.keys(b).map(R=>parseInt(R)).reverse())==null?void 0:P.find(R=>{var N;return(N=b==null?void 0:b[R].drawPositions)==null?void 0:N.includes(n)}),U=w?S==null?void 0:S[w].find(({drawPositions:R})=>R==null?void 0:R.includes(n)):void 0;U&&jW({tournamentRecord:i,drawDefinition:r,matchUp:U,event:l});let T=(C=U==null?void 0:U.drawPositions)==null?void 0:C.find(R=>R!==n);if(U&&T){let R=BA({sourceDrawPositions:U.drawPositions,matchUpId:U.matchUpId,inContextDrawMatchUps:v,drawPositionToAdvance:T,tournamentRecord:i,drawDefinition:r,matchUpsMap:a});if(R.error)return R}return Pc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),RB({assignedParticipantId:f,isPositionAction:e,appliedPolicies:g,drawDefinition:r,drawPosition:n,structureId:o,stack:u})}function RB({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:o}){return e&&DT({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:o}}),ee({result:{...J},stack:o})}function Rse(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:r,filled:e||i||r}}function jW({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:Vt,score:void 0,winningSide:void 0}),Rt({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(n==null?void 0:n.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function Cse({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{var o;(o=a.drawPositions)!=null&&o.includes(i)&&jW({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function BA({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:o,event:s}){var I,b;Aa({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(S=>S.matchUpId===o),u=(I=e.find(S=>S.matchUpId===o))==null?void 0:I.structureId,{structure:c}=et({drawDefinition:n,structureId:u}),{positionAssignments:d}=ai({structure:c}),p=d==null?void 0:d.filter(S=>S.bye).map(S=>S.drawPosition),m=(b=l==null?void 0:l.drawPositions)==null?void 0:b.find(S=>S!==t),h=m&&(p==null?void 0:p.includes(m)),{targetLinks:{loserTargetLink:f},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v,loserTargetDrawPosition:y}}=En({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:o});if(v&&v.structureId===(c==null?void 0:c.structureId)&&Ese({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:v,matchUpsMap:a,event:s}),g&&h&&g.structureId!==(c==null?void 0:c.structureId)){let{roundNumber:S}=g;if(S===1){let w=Ya({structureId:f.target.structureId,drawPosition:y,tournamentRecord:r,drawDefinition:n,event:s});if(w.error)return w}else GW({loserTargetDrawPosition:y,tournamentRecord:r,loserTargetLink:f,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:s})}return{...J}}function Ese({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:o,event:s}){var A,M,E,O,k,x;let l="advanceWinner",u=o.drawMatchUps.find(F=>F.matchUpId===a.matchUpId),c=(A=e.find(F=>F.matchUpId===a.matchUpId))==null?void 0:A.structureId,{structure:d}=et({drawDefinition:n,structureId:c}),{positionAssignments:p}=ai({structure:d}),m=(M=p==null?void 0:p.find(({drawPosition:F})=>F===t))==null?void 0:M.bye,h=(E=u.drawPositions)==null?void 0:E.filter(Boolean),f=p==null?void 0:p.filter(F=>h==null?void 0:h.includes(F.drawPosition)),g=p==null?void 0:p.find(({drawPosition:F})=>F===t),v=i==null?void 0:i.find(F=>F!==t),y=(O=v&&(f==null?void 0:f.find(({drawPosition:F})=>F===v)))==null?void 0:O.bye,I=m&&y;if(I&&console.log({isByeAdvancedBye:I}),(h==null?void 0:h.length)>1&&m&&!y)return ee({result:{error:Sf},stack:l});let b=h==null?void 0:h.find(F=>F!==t),S=I,w=[...(u.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),U=w.map(F=>!F&&!S||F===t?(S=!0,t):F).sort(or);if(!S)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:f}),ee({result:{error:Sf},stack:l});let T=(k=p==null?void 0:p.find(({drawPosition:F})=>F===b))==null?void 0:k.bye,D=(x=p==null?void 0:p.find(({drawPosition:F})=>F===t))==null?void 0:x.bye;Object.assign(u,{matchUpStatus:D||T?Vt:Ji,score:void 0,winningSide:void 0,drawPositions:U});let P=u.drawPositions.find(F=>!w.includes(F));Aa({method:l,color:"brightyellow",changedDrawPosition:P,pairedDrawPositionIsBye:T,drawPositionIsBye:D}),Rt({tournamentId:r==null?void 0:r.tournamentId,matchUp:u,eventId:s==null?void 0:s.eventId,context:l,drawDefinition:n});let{targetLinks:{loserTargetLink:C},targetMatchUps:{loserMatchUp:R,loserTargetDrawPosition:N}}=En({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(T||D){let F=T?t:b;if(F)BA({drawPositionToAdvance:F,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:o});else if(D&&C&&R)if(R.feedRound)GW({loserTargetDrawPosition:N,tournamentRecord:r,loserTargetLink:C,drawDefinition:n,loserMatchUp:R,matchUpsMap:o});else{let $=1-a.roundPosition%2,_=R.drawPositions[$],L=Ya({structureId:C.target.structureId,drawPosition:_,tournamentRecord:r,drawDefinition:n,event:s});if(L.error)return L}}}function GW({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){let{roundNumber:s}=n;Aa({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[n.structureId].matchUps,{initialRoundNumber:u}=Um({drawPosition:t,matchUps:l});if(u===s){let c=Ya({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:o});if(c.error)return c}}function HW({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:o}=Wt({drawDefinition:i,matchUpsMap:r,structure:n,event:a});o.forEach(s=>{let l=t.filter(({drawPosition:u})=>{var c;return(c=s.drawPositions)==null?void 0:c.includes(u)}).filter(u=>u.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?Vt:Ji}),Rt({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:s}))})}function ab(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=t,{structure:u}=et({drawDefinition:a,structureId:o}),c=(Rr({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(c&&i&&!r&&(r=c==null?void 0:c.drawPosition),!r)return{error:Tg};i||(i=c==null?void 0:c.participantId);let{activeDrawPositions:d}=nb({drawDefinition:a,structureId:o});return d.includes(r)?{error:$0}:(e||({matchUps:e}=mr({inContext:!0,drawDefinition:a,matchUpsMap:s})),FE({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:o,drawPosition:r,matchUpsMap:s,event:l}).drawPositionCleared?(Pc({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:u,event:l}),{...J,participantId:i}):{error:vG})}function FE({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:o}){var v,y;let{structure:s}=et({drawDefinition:i,structureId:a});if(!s)return{error:Ei};let l=Rr({drawDefinition:i,structure:s}).positionAssignments||[],u=l.some(I=>{if(I.drawPosition===r)return delete I.participantId,delete I.qualifier,delete I.bye,!0});if(s.structureType===xn)return HW({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:s}),{drawPositionCleared:u,...J};let c={isCollectionMatchUp:!1},{matchUps:d}=Wt({drawDefinition:i,matchUpFilters:c,matchUpsMap:n,structure:s,event:o}),{roundProfile:p,roundMatchUps:m}=Cn({matchUps:d}),h=(v=p&&Object.keys(p))==null?void 0:v.map(I=>Ze(I)),f=r,g=(y=h==null?void 0:h.map(I=>{var R,N,A,M;let b=(N=(R=p==null?void 0:p[I])==null?void 0:R.pairedDrawPositions)==null?void 0:N.find(E=>E.includes(f)),S=b==null?void 0:b.find(E=>E!==f),w=l.find(E=>E.drawPosition===S),U=p==null?void 0:p[I+1],T=w==null?void 0:w.bye,D=(A=U==null?void 0:U.pairedDrawPositions)==null?void 0:A.find(E=>E.includes(S)),P=T&&D&&U&&((M=U.drawPositions)==null?void 0:M.includes(S)),C=b&&{pairedDrawPositionByeAdvancedPair:!P&&D,pairedDrawPosition:S,targetDrawPosition:f,relevantPair:b,roundNumber:I};return P&&(f=S),C}).filter(I=>I==null?void 0:I.targetDrawPosition))==null?void 0:y.reduce((I,b)=>{let{roundNumber:S,relevantPair:w,targetDrawPosition:U,pairedDrawPosition:T,pairedDrawPositionByeAdvancedPair:D}=b,P={roundNumber:S,targetDrawPosition:U,relevantPair:w},C=D&&{roundNumber:S+1,targetDrawPosition:T,relevantPair:D,subsequentRoundRemoval:!0},R=[P,C].filter(Boolean);return I.concat(...R)},[]);return g==null||g.forEach(({roundNumber:I,targetDrawPosition:b,relevantPair:S})=>{let w=m==null?void 0:m[I].find(U=>{var T;return Rn((T=U.drawPositions)==null?void 0:T.filter(Boolean),S.filter(Boolean))});w&&(Mse({inContextDrawMatchUps:t,targetDrawPosition:b,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:I,matchUpsMap:n}),zW({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:r,matchUpsMap:n,structure:s,event:o}))}),{tasks:g,drawPositionCleared:u,positionAssignments:l}}function Mse({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:o}){let{structure:s}=et({drawDefinition:r,structureId:o});if(!s)return{error:Ei};if(s.structureType===xn)return;n=n||sn({drawDefinition:r});let l=((n==null?void 0:n.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:u}=Um({drawPosition:e,matchUps:l}),c=l==null?void 0:l.filter(p=>{var m;return p.roundNumber>=a&&p.roundNumber!==u&&((m=p.drawPositions)==null?void 0:m.includes(e))}),d=ai({drawDefinition:r,structureId:o}).positionAssignments??[];return c==null||c.forEach(p=>zW({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:s})),{...J}}function zW({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var U,T,D,P,C;let u="removeDrawPosition",c=(U=n.drawPositions)==null?void 0:U.slice(),d=n.matchUpStatus,p=n.winningSide;o=o??sn({drawDefinition:r});let m=o.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:h}=Um({drawPosition:a,matchUps:m});if(n.roundNumber&&h&&n.roundNumber>h){let R=(n.drawPositions??[]).map(N=>N===a?void 0:N);n.drawPositions=R}if(n.matchUpType===hi){let R=(((T=t==null?void 0:t.find(N=>N.matchUpId===n.matchUpId))==null?void 0:T.sides)??[]).reduce((N,A,M)=>A.drawPosition===a?M:N,void 0);R!==void 0&&((P=(D=n.sides)==null?void 0:D[R])!=null&&P.lineUp)&&((C=n.sides)==null||delete C[R].lineUp,Rt({tournamentId:i==null?void 0:i.tournamentId,context:`${u}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:n,drawDefinition:r}))}let f=En({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:v,winnerMatchUp:y,loserMatchUpDrawPositionIndex:I}}=f,b=e.filter(({drawPosition:R})=>{var N;return(N=n.drawPositions)==null?void 0:N.includes(R)}).filter(R=>R.bye).length,S=b&&Vt||n.matchUpStatus&&[Mt,zt].includes(n.matchUpStatus)&&n.matcHUpStatus||Ji;n.matchUpStatus=S,n.matchUpStatus&&[zt,Mt].includes(n.matchUpStatus)&&(n.winningSide=void 0);let w=c==null?void 0:c.find(R=>{var N;return!((N=n.drawPositions)!=null&&N.includes(R))});if(c!=null&&c.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(w&&Aa({method:u,color:"brightyellow",removedDrawPosition:w}),Rt({tournamentId:i==null?void 0:i.tournamentId,context:`${u}-${a}`,eventId:l==null?void 0:l.eventId,matchUp:n,drawDefinition:r})),v&&v.structureId!==f.matchUp.structureId&&!b){let{drawPositions:R,roundNumber:N}=v;if(N===1){let A=R[I];FE({structureId:v.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o})}else{let A=Math.min(...R.filter(Boolean)),M=Nse({loserMatchUpDrawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:v,matchUpsMap:o,event:l});if(M.error)return ee({result:M,stack:u});let E=((o==null?void 0:o.mappedMatchUps)||{})[v.structureId].matchUps,{initialRoundNumber:O}=Um({drawPosition:A,matchUps:E});O===1&&(Aa({method:u,color:"brightyellow",loserMatchUpDrawPosition:A}),FE({structureId:v.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o}))}}return y&&y.structureId!==f.matchUp.structureId&&g.target.feedProfile,{...J}}function Nse({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){var u;let{structure:s}=et({structureId:n.structureId,drawDefinition:r}),{positionAssignments:l}=ai({structure:s});if((u=l==null?void 0:l.find(c=>c.drawPosition===t))!=null&&u.bye){let c=ab({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:o});if(c.error)return c}return{...J}}function gp({drawDefinition:t,stages:e}){if(!t)return{error:_e};let i=((t==null?void 0:t.structures)??[]).filter(n=>!(e!=null&&e.length)||n.stage&&e.includes(n.stage)),r=ct(i.map(n=>{let{positionAssignments:a}=ai({structure:n});return a?a.map(Ut):[]}).flat().filter(Boolean));return{...J,assignedParticipantIds:r}}function ys(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:o}=n,s=`_${a||Oe}${o||""}`;return r[s]||(r[s]=[]),r[s].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let o=a+1;return{...n,entryPosition:o}})).flat()}function hd(t){return[mp,bo].includes(t)}function PS({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:u,stage:c,event:d}){var D,P,C,R,N,A,M,E,O,k,x,F;if(!n||!Array.isArray(n))return{error:Ss,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:gi};if(a&&!IW.includes(a))return{error:IE};if(o&&!aT.includes(o))return{error:lp};let p="modifyEntriesStatus",m=[];if(!a&&!s)return ee({result:{error:Xe},info:"Missing entryStatus",stack:p});if(s&&!tl({extension:s,requiredAttributes:["name"]}))return ee({result:{error:oe},info:"Invalid extension",context:{extension:s},stack:p});let h=[];(D=d==null?void 0:d.drawDefinitions)==null||D.forEach($=>{let _=gp({stages:c&&[c],drawDefinition:$}).assignedParticipantIds??[];h.push(..._)});let f=(i==null?void 0:i.participants)??[];if(!n.every($=>{var L;let _=(L=Uc({tournamentParticipants:f,participantId:$}))==null?void 0:L.participantType;return!(_&&[ht,Vn].includes(_)&&hd(a))&&!(a&&(d!=null&&d.eventType)&&_===St&&[uo,Sa].includes(d.eventType)&&[Vo,...MU].includes(a))}))return{error:IE};let g=d&&Gi({event:d}).flightProfile,v=(P=g==null?void 0:g.flights)==null?void 0:P.find($=>$.drawId===u),y=$=>{let _=($||[]).filter(B=>!c||!B.entryStage||c===B.entryStage).filter(({participantId:B})=>n.includes(B)),L=B=>a&&h.includes(B.participantId)&&!(MU.includes(B.entryStatus)&&MU.includes(a));return _.every(B=>L(B)&&!e?!1:(a&&(B.entryStatus=a,delete B.entryPosition),o&&(B.entryStage=o,delete B.entryPosition),s&&(s.value?Lt({element:B,extension:s}):Un({element:B,name:s.name})),!0))?{...J}:{error:Rg}},I=({flight:$,drawDefinition:_})=>{d&&(d.entries=ys({entries:d.entries??[]})),$&&($.drawEntries=ys({entries:$.drawEntries})),_&&(_.entries=ys({entries:_.entries}))},b=$=>{let{flight:_,drawDefinition:L}=$,B="updateDrawEntries";if(_){let V=y(_.drawEntries);if(V.error)return ee({result:V,stack:B})}if(L){let V=y(L.entries);if(V.error)return ee({result:V,stack:B});m.includes(L.drawId)||m.push(L.drawId)}return{...J}},S=((C=d==null?void 0:d.entries)==null?void 0:C.find(({entryPosition:$})=>$))??(((R=v==null?void 0:v.drawEntries)==null?void 0:R.find(({entryPosition:$})=>$))||((N=r==null?void 0:r.entries)==null?void 0:N.find(({entryPosition:$})=>$)));if(t&&!S&&I({flight:v,drawDefinition:r}),v||r){let $=b({flight:v,drawDefinition:r});if($.error)return ee({result:$,stack:p})}let w=((A=d==null?void 0:d.drawDefinitions)==null?void 0:A.map(({drawId:$})=>$))??[],U=((M=g==null?void 0:g.flights)==null?void 0:M.filter($=>!w.includes($.drawId)))||[];for(let $ of U){let _=$&&b({flight:$});if(_!=null&&_.error)return ee({result:_,stack:p})}let T=((E=g==null?void 0:g.flights)==null?void 0:E.length)===1&&(((O=d==null?void 0:d.drawDefinitions)==null?void 0:O.length)??0)<=((k=g==null?void 0:g.flights)==null?void 0:k.length);if(!v&&!r&&a&&vW.includes(a))return{error:eH};if(!v&&!r||a===Du||l&&T){let $=y(d==null?void 0:d.entries);if($!=null&&$.error)return ee({result:$,stack:p});let _;if(a===Du&&((x=g==null?void 0:g.flights)==null||x.every(L=>{let B=y(L.drawEntries);return B.error?(_=B.error,!1):(L.drawEntries=L.drawEntries.filter(({participantId:V})=>!n.includes(V)),!0)}),(F=d==null?void 0:d.drawDefinitions)==null||F.every(L=>{var V;let B=y(L.entries);return B.error?(_=B.error,!1):(L.entries=(V=L.entries)==null?void 0:V.filter(({participantId:G})=>!n.includes(G)),!0)})),_)return ee({result:{error:_},stack:p})}t&&I({flight:v,drawDefinition:r});for(let $ of(d==null?void 0:d.drawDefinitions)??[])m.length&&!m.includes($.drawId)||si({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:$});return{...J}}function Cl({requireTimeStamp:t,scaleAttributes:e,participant:i}){var r,n;if(!i)return{error:jm};if(!Nt(e))return{error:oe};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=e,u=[kd,o,s,l].join("."),c=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===u).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(c){let[d,p,m,h]=((r=c.itemType)==null?void 0:r.split("."))??[];if(d!==kd)return{error:hm};let f=((n=a&&Kp({element:c.itemValue,accessor:a}))==null?void 0:n.value)||c.itemValue,g={eventType:m,scaleDate:c.itemDate,scaleValue:f,scaleName:h,scaleType:p};return{...J,scaleItem:g}}}return{...J,scaleItem:void 0}}function Ase({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){var c,d,p;let a={},o=m=>[kd,Pl,n.eventType,m].join("."),s=Object.assign({},...(r.timeItems||[]).filter(({itemType:m})=>m.split(".")[1]===Pl).map(({itemType:m,itemValue:h})=>({[m]:h}))),l=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(o),u=Vi(Object.keys(s),l);if((!e||!Object.keys(s).length&&!((c=t==null?void 0:t.drawIds)!=null&&c.length)||u.length)&&u.length){if(t!=null&&t.stageSeedingScaleNames){let m=Object.keys(t.stageSeedingScaleNames).map(f=>{let g=o(t.stageSeedingScaleNames[f]),v=s[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);a.seedAssignments=h}else if(u){let m=u.map(h=>s[h]);a.seedValue=m.pop()}}else if(!e&&typeof i=="object"){let m=Object.keys(i).map(f=>{let g=o(i[f]),v=s[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);a.seedAssignments=h}else{let{categoryName:m,ageCategoryCode:h}=n.category||{},f=[h,n.eventId,m].filter(Boolean),g;for(let v of f){let y={eventType:n.eventType,scaleType:Pl,scaleName:v},I=Cl({scaleAttributes:y,participant:r});if(I.scaleItem){g=I.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((p=(d=t==null?void 0:t.published)==null?void 0:d.drawIds)!=null&&p.length))){let v=g.scaleValue;a.seedValue=v}}return a}function Ose({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...BN(d??[])):{},m=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:o,eventId:a});i.events[a]=Ge(m,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function WW(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||r===Vt||e[i].scheduleItems.push({...c,scheduledDate:pt(c==null?void 0:c.scheduledDate),scheduledTime:bi(c==null?void 0:c.scheduledTime),checkScoreHasValue:vr({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,drawId:d})}function ob(t){var a,o,s;let e=ze(t,[{[br]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:r=qa}=t,n=`${Yc}.${Kc}`;return Me((s=(o=(a=RT({tournamentRecord:i,itemType:n}))==null?void 0:a.timeItem)==null?void 0:o.itemValue)==null?void 0:s[r],!1,!0)}function kse(t){let{tournamentId:e}=t??{};return!!e}function Uo({event:t,status:e=qa}){var r,n,a;let i=`${Yc}.${Kc}`;return(a=(n=(r=Hy({itemType:i,event:t}))==null?void 0:r.timeItem)==null?void 0:n.itemValue)==null?void 0:a[e]}function VA({drawDetails:t,drawId:e}){var i,r;return(r=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:r.published}function ah(t){var d,p,m,h,f,g,v,y,I;let{tournamentRecord:e,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:o,event:s}=t??{};if(e&&!kse(e))return{error:oe};if(n&&!s)return{error:lo};if(Array.isArray(r)&&(r!=null&&r.length)){let b={};for(let S of r){if(!Ti(S))return{error:oe};let w=(d=Wn({tournamentRecord:e,eventId:S}))==null?void 0:d.event;if(!w)return{error:lo};let U=cC({event:w});b[S]=U}return{...J,publishState:b}}if(s){let b=cC({event:s}),S={};if(o)return i?{publishState:{status:{published:!!((p=b.status.publishedDrawIds)!=null&&p.includes(o)),drawDetail:(m=b.status.drawDetails)==null?void 0:m[o]},...J}}:{error:xa};if(Array.isArray(a)&&(a!=null&&a.length)){let w=((h=s.drawDefinitions)==null?void 0:h.map(MI))??[];for(let U of a){if(!Ti(U))return{error:oe};if(!w.includes(U))return{error:xa};S[U]={status:{published:!!b.status.publishedDrawIds.includes(U),drawDetail:(f=b.status.drawDetails)==null?void 0:f[U]}}}}else S=b;return{...J,publishState:S}}let l=[],u=!1,c={};for(let b of(e==null?void 0:e.events)??[]){let S=cC({event:b});c[b.eventId]=S,S.status.published&&(l.push(b.eventId),u=!0);for(let{drawId:w}of b.drawDefinitions??[]){let U=(v=(g=S.status)==null?void 0:g.publishedDrawIds)==null?void 0:v.includes(w);U&&(c[w]={status:{published:U}})}}if(e){let b=ob({tournamentRecord:e});c.tournament=b??{},((y=b==null?void 0:b.orderOfPlay)!=null&&y.published||(I=b==null?void 0:b.participants)!=null&&I.published)&&(u=!0),c.tournament.status={published:u,publishedEventIds:l}}return{...J,publishState:c}}function cC({event:t}){var s;let e=Uo({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let r=e.drawDetails??{};for(let l of((s=t.drawDefinitions)==null?void 0:s.map(MI))||[])r[l]||(r[l]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter(l=>VA({drawDetails:r,drawId:l})),a=n!=null&&n.length?n:e.drawIds??[];if(a!=null&&a.length&&!(n!=null&&n.length))for(let l of a)r[l]={publishingDetail:{published:!0}};let o=(a==null?void 0:a.length)>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:r,published:o}}}function FT(t,e){return(t||"").localeCompare(e||"")}function xse({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:r,matchUpStatus:n,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:u,drawId:c,stage:d}){let p=e[a],m=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:c});let h=p.structureParticipation[l],{winner:f,loser:g}=t,v=r?f:g;r&&(h.winCount+=1,n===zt&&(h.walkoverWinCount+=1),n===Mt&&(h.defaultWinCount+=1)),v&&(!h.finishingPositionRange||m(v)<m(h.finishingPositionRange))&&(h.finishingPositionRange=v),i&&((!h.finishingRound||i<h.finishingRound)&&(h.finishingMatchUpId=u,h.finishingRound=i,h.roundNumber=s),i===1&&(h.participantWon=r))}function CB(t){var M,E,O,k,x,F,$,_,L,B;let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:o,withEvents:s,withDraws:l,finishingPositionRange:u,finishingRound:c,matchUpStatus:d,stageSequence:p,roundNumber:m,structureId:h,score:f,stage:g,withRankingProfile:v,tieWinningSide:y,roundPosition:I,matchUpTieId:b,matchUpSides:S,collectionId:w,matchUpType:U,winningSide:T,matchUpId:D,schedule:P,eventId:C,drawId:R,sides:N}=t,A=a&&(N==null?void 0:N.length)===2&&Object.assign({},...N.map(({sideNumber:V},G)=>{let j=N[1-G].participantId;return V&&{[V]:j}}).filter(Boolean));for(let V of N){let{participantId:G,sideNumber:j,bye:z}=V;if(z)continue;let q=T===j,W=K=>{var ie,ae;let H=(ie=n[K])==null?void 0:ie.participant,Q=H==null?void 0:H.participantType,X=[{participantId:K,participantType:Q}];if(Q!==Vn)for(let le of(H==null?void 0:H.individualParticipantIds)||[]){let ne=(ae=n[le])==null?void 0:ae.participant;X.push({participantType:ne==null?void 0:ne.participantType,participantId:le})}return X},Y=(K,H)=>{if(o){if(n[K].matchUps[D]={participantWon:q,matchUpType:U,structureId:h,sideNumber:j,matchUpId:D,eventId:C,drawId:R,stage:g},a){let Q=W(H);n[K].matchUps[D].opponentParticipantInfo=Q}w&&(n[K].matchUps[D].collectionId=w)}a&&H&&(n[K].opponents[H]={participantId:H,matchUpId:D,eventId:C,drawId:R}),v&&xse({finishingPositionRange:u,participantMap:n,participantWon:q,finishingRound:c,matchUpStatus:d,participantId:K,stageSequence:p,roundNumber:m,structureId:h,matchUpId:D,drawId:R,stage:g}),(i||e)&&WW({participantMap:n,participantId:K,matchUpStatus:d,roundPosition:I,matchUpType:U,roundNumber:m,structureId:h,matchUpId:D,schedule:P,drawId:R,score:f})},re=({participant:K,partnerParticipantId:H})=>{var X,ie,ae;let Q=(le,ne)=>{le&&(le.partnerParticipantIds||(le.partnerParticipantIds=[]),le.partnerParticipantIds.includes(ne)||le.partnerParticipantIds.push(ne))};l&&Q((X=K==null?void 0:K.draws)==null?void 0:X[R],H),s&&Q((ie=K==null?void 0:K.events)==null?void 0:ie[C],H),o&&Q((ae=K==null?void 0:K.matchUps)==null?void 0:ae[D],H)};if(G&&n[G]){let K=A==null?void 0:A[j];Y(G,K);let H=((M=n[G])==null?void 0:M.participant.participantType)===ht,Q=((E=n[G])==null?void 0:E.participant.individualParticipantIds)||[];if(b){if(r){let X=ie=>n[ie].matchUps[b]={participantWon:y===j,matchUpId:b,matchUpType:hi,sideNumber:j};X(G),Q.forEach(X)}if(l&&!n[G].draws[R]){let X=(k=(O=S.find(le=>le.sideNumber===j))==null?void 0:O.participant)==null?void 0:k.participantId,ie=($=(F=(x=n[X])==null?void 0:x.draws)==null?void 0:F[R])==null?void 0:$.entryStatus,ae=le=>n[le].draws[R]={entryStatus:ie,eventId:C,drawId:R};ae(G),Q.forEach(ae)}}if(H&&(Q.forEach(X=>n[X]&&Y(X,K)),Q.forEach((X,ie)=>{let ae=Q[1-ie],le=n[X];le&&re({participant:le,partnerParticipantId:ae})}),s&&S)){let X=(L=(_=S.find(ie=>ie.sideNumber===j))==null?void 0:_.participant)==null?void 0:L.participantId;if(X){let ie=(B=n[X])==null?void 0:B.events[C];ie?(n[G].events[C]={...ie},Q.forEach(ae=>n[ae].events[C]={...ie})):console.log("Missing teamEntry",{eventId:C,teamParticipantId:X})}}if(T){let X=ie=>{q?(n[ie].counters[U].wins+=1,n[ie].counters.wins+=1,d===zt&&(n[ie].counters[U].walkoverWins+=1,n[ie].counters.walkoverWins+=1),d===Mt&&(n[ie].counters[U].defaultWins+=1,n[ie].counters.defaultWins+=1)):(n[ie].counters[U].losses+=1,n[ie].counters.losses+=1,d===zt&&(n[ie].counters[U].walkovers+=1,n[ie].counters.walkovers+=1),d===Mt&&(n[ie].counters[U].defaults+=1,n[ie].counters.defaults+=1))};X(G),Q.forEach(X)}}}}function Fse(t){var N,A,M,E,O,k,x;let{participantFilters:e,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,participantMap:o,contextProfile:s,withPotentialMatchUps:l,withRankingProfile:u,withScheduleItems:c,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:m,withOpponents:h,withMatchUps:f,withSeeding:g,withEvents:v,withDraws:y}=t,I=e==null?void 0:e.participantIds,b=F=>{var _,L;let $=[F];return(L=(_=o[F])==null?void 0:_.participant.individualParticipantIds)==null||L.forEach(B=>$.push(B)),$.some(B=>!(I!=null&&I.length)||I.includes(B))?$:[]},S={withMatchUps:f||u,withEvents:v||u,withDraws:y||u,withPotentialMatchUps:l,withRankingProfile:u,withScheduleItems:c,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:m,participantMap:o,withOpponents:h,withSeeding:g},w=[],U={},T=[],D={},P={},C={},R=({eventType:F,scaleNames:$,participantId:_})=>{var L,B,V,G,j;return(j=(G=(V=(B=(L=o[_])==null?void 0:L.participant)==null?void 0:B.rankings)==null?void 0:V[F])==null?void 0:G.find(z=>$.includes(z.scaleName)))==null?void 0:j.scaleValue};for(let F of(n==null?void 0:n.events)||[]){if(e!=null&&e.eventIds&&!e.eventIds.includes(F.eventId))continue;let{drawDefinitions:$=[],extensions:_=[],eventType:L,eventName:B,category:V,entries:G,eventId:j,gender:z}=F,{flightProfile:q}=Gi({event:F}),W=(q==null?void 0:q.flights)??[],Y=ah({event:F}).publishState;Y&&(D[j]=Y);let re=(N=Y==null?void 0:Y.status)==null?void 0:N.publishedSeeding;if(v||g||u){let H=i?Object.assign({},...BN(_??[])):{};P[j]={...H,eventName:B,eventType:L,category:V,eventId:j,gender:z};let Q=[V==null?void 0:V.categoryName,V==null?void 0:V.ageCategoryCode].filter(Boolean);for(let X of G){let{participantId:ie}=X;if(!ie||!o[ie])continue;let ae=R({eventType:L,scaleNames:Q,participantId:ie}),le,ne;if(g){let Ie=o[ie].participant;({seedAssignments:le,seedValue:ne}=Ase({publishedSeeding:re,usePublishState:a,withSeeding:g,participant:Ie,event:F}))}let de=Ie=>{var ke,Pe;if((Pe=(ke=o[Ie])==null?void 0:ke.events)!=null&&Pe[j])return;let ce=o[Ie];Ose({convertExtensions:i,seedAssignments:le,participant:ce,withSeeding:g,seedValue:ne,eventId:j,ranking:ae,entry:X})};de(ie),(o[ie].participant.individualParticipantIds||[]).forEach(de)}}let K=(A=D==null?void 0:D[j])==null?void 0:A.publishedSeeding;if(y||u||g){let H=X=>X?Object.assign({},...X.map(({participantId:ie,seedValue:ae,seedNumber:le})=>({[ie]:{seedValue:ae,seedNumber:le}}))):void 0,Q=ct([...$.map(MI),...W.map(MI)]);for(let X of Q){let ie=$.find(we=>we.drawId===X),ae=[V==null?void 0:V.categoryName,V==null?void 0:V.ageCategoryCode].filter(Boolean),{structures:le=[],drawOrder:ne,drawName:de,drawType:Ie}=ie??{},ce=W==null?void 0:W.find(we=>we.drawId===X),ke=(ie==null?void 0:ie.entries)||(ce==null?void 0:ce.drawEntries),Pe=ce==null?void 0:ce.flightNumber,it=((ie==null?void 0:ie.structures)||[]).sort((we,Ue)=>Km(we,Ue)).map(({structureId:we,structures:Ue})=>[we,...(Ue||[]).map(({structureId:wt})=>wt)]).flat(1/0),It,me,fe,pe,Fe=0,De=le.filter(({stage:we,stageSequence:Ue})=>we===Oe&&Ue===1||we===Ye).flatMap(we=>{let{positionAssignments:Ue}=ai({structure:we}),{seedAssignments:wt,stageSequence:Le,stage:rt}=we;return rt===Oe?(Fe=(Ue==null?void 0:Ue.length)??0,fe=Ue,pe=wt):Le===1&&(It=Ue,me=wt),Ue}).map(({participantId:we})=>we).filter(Boolean),je=H(pe),ue=H(me),he=ie?ke.filter(({participantId:we})=>De.includes(we)):ke,Re=!a||(K==null?void 0:K.published)&&(((M=K==null?void 0:K.drawIds)==null?void 0:M.length)===0||((E=K==null?void 0:K.drawIds)==null?void 0:E.includes(X)));for(let we of he){if(!o[we.participantId])continue;let{entryStatus:Ue,entryStage:wt,entryPosition:Le,participantId:rt}=we,Ci=R({participantId:rt,scaleNames:ae,eventType:L}),Be=nt=>{var yi,xi,di,gn,zr;if(!o[nt]||(yi=o[nt].draws)!=null&&yi[X])return;let Ii=g&&Re,be=Ii?{}:void 0,Et=Ii?((xi=je==null?void 0:je[rt])==null?void 0:xi.seedValue)||((di=je==null?void 0:je[rt])==null?void 0:di.seedNumber):void 0,Ee=Et?je==null?void 0:je[rt]:void 0,qe=Ii?((gn=ue==null?void 0:ue[rt])==null?void 0:gn.seedValue)||((zr=ue==null?void 0:ue[rt])==null?void 0:zr.seedNumber):void 0,Ot=qe?ue==null?void 0:ue[rt]:void 0;be&&Et&&(be[Oe]=Ee),be&&qe&&(be[Ye]=Ot);let ci=Et||qe;ci&&(o[nt].participant.seedings[L]||(o[nt].participant.seedings[L]=[]),Ee&&o[nt].participant.seedings[L].push({...Ee,scaleName:X}),Ot&&o[nt].participant.seedings[L].push({...Ot,scaleName:X}),be&&(o[nt].events[j].seedAssignments||(o[nt].events[j].seedAssignments={}),Object.keys(be).forEach(iu=>o[nt].events[j].seedAssignments[iu]=be[iu]))),(y||u)&&(o[nt].draws[X]=Ge({seedAssignments:be,entryPosition:Le,entryStatus:Ue,entryStage:wt,seedValue:ci,eventId:j,ranking:Ci,drawId:X},!1,!1,!0))};[bo,mp].includes(Ue)||(Be(rt),(O=o[rt].participant.individualParticipantIds||[])==null||O.forEach(Be))}let xe=((ie==null?void 0:ie.structures)??[]).reduce((we,Ue)=>(we.includes(Ue.stage)||we.push(Ue.stage),we),[]),Ce=((ie==null?void 0:ie.links)??[]).length;C[X]={qualifyingPositionAssignments:It,qualifyingSeedAssignments:me,mainPositionAssignments:fe,qualifyingSeedingMap:ue,mainSeedAssignments:pe,orderedStructureIds:it,mainSeedingMap:je,flightNumber:Pe,linksCount:Ce,drawOrder:ne,drawName:de,drawType:Ie,drawSize:Fe,drawId:X,stages:xe}}}if(u||d||p||m||h||f||y){let H=!!d||l,Q=((k=Zl({afterRecoveryTimes:!!d,policyDefinitions:r,tournamentRecord:n,inContext:!0,contextProfile:s,participantMap:o,nextMatchUps:H,event:F}))==null?void 0:k.matchUps)??[];for(let X of Q){let{finishingPositionRange:ie,potentialParticipants:ae,tieMatchUps:le=[],sides:ne=[],winningSide:de,matchUpType:Ie,matchUpId:ce,eventId:ke,drawId:Pe,collectionId:it,stageSequence:It,finishingRound:me,matchUpStatus:fe,roundPosition:pe,roundNumber:Fe,structureId:De,schedule:je,score:ue,stage:he}=X;U[ce]=X;let Re={finishingPositionRange:ie,finishingRound:me,stageSequence:It,roundPosition:pe,collectionId:it,roundNumber:Fe,structureId:De,schedule:je,eventId:ke,drawId:Pe,score:ue,stage:he};CB({...Re,...S,matchUpStatus:fe,winningSide:de,matchUpType:Ie,matchUpId:ce,sides:ne});for(let xe of le){let{winningSide:Ce,sides:we=[],matchUpId:Ue,matchUpStatus:wt,matchUpType:Le}=xe;CB({...Re,...S,winningSide:Ce,tieWinningSide:de,matchUpTieId:ce,matchUpId:Ue,sides:we,matchUpSides:ne,matchUpStatus:wt,matchUpType:Le})}Array.isArray(ae)&&(H||d||c)&&((x=ae.flat().map(Ut).filter(Boolean))==null||x.forEach(xe=>{var Ce;(Ce=b(xe))==null||Ce.forEach(we=>{o[we]&&(o[we].potentialMatchUps[ce]=Ge({tournamentId:n==null?void 0:n.tournamentId,matchUpId:ce,eventId:ke,drawId:Pe}))}),(d||c)&&WW({potential:!0,participantMap:o,participantId:xe,matchUpStatus:fe,roundPosition:pe,structureId:De,matchUpType:Ie,roundNumber:Fe,matchUpId:ce,schedule:je,drawId:Pe,score:ue})}))}T.push(...Q)}}if(m||u||d){let F=Object.values(o);for(let $ of F){let{wins:_,losses:L,[ti]:{wins:B,losses:V},[Qt]:{wins:G,losses:j}}=$.counters,z=(q,W,Y)=>{let re=W+Y,K=W,H=re&&K/re;$.statistics[q]={denominator:re,numerator:K,statValue:H,statCode:q}};if(m&&(z(EU,_,L),z(`${EU}.${ti}`,B,V),z(`${EU}.${Qt}`,G,j)),u){let q=(W=[])=>Math.abs(W[0]-W[1]);for(let W of Object.keys($.draws)){let{orderedStructureIds:Y=[],flightNumber:re}=C[W]||{};if($.structureParticipation&&Y.length){let K,H=0,Q=Y.map(X=>{let ie=$.structureParticipation[X];if(!ie)return;K||(K=ie==null?void 0:ie.finishingPositionRange),q(K)>q(ie==null?void 0:ie.finishingPositionRange)&&(K=ie==null?void 0:ie.finishingPositionRange);let ae=ie.stage!==Ye;return ae&&(H+=1),Ge({...ie,participationOrder:ae?H:void 0,flightNumber:re})}).filter(Boolean);$.draws[W]&&($.draws[W].finishingPositionRange=K,$.draws[W].structureParticipation=Q)}}}if(d){let q=Nt(d)?d.scheduledMinutesDifference:0,W=$.scheduleItems||[],Y=$.potentialMatchUps||{},re=W.reduce((H,Q)=>{let{scheduledDate:X,scheduledTime:ie}=Q;return H[X]||(H[X]=[]),ie&&H[X].push(Q),H},{});Object.values(re).forEach(H=>H.sort(_H));for(let H of W){let{typeChangeTimeAfterRecovery:Q,timeAfterRecovery:X,scheduledDate:ie,scheduledTime:ae}=H,le=re[ie],ne=kt(ae);for(let de of le){if(de.matchUpId===H.matchUpId||[zt,Mt].includes(de.matchUpStatus)&&!de.checkScoreHasValue)continue;let Ie=H.matchUpType!==de.matchUpType&&Q||X,ce=H.drawId===de.drawId,ke=Y[H.matchUpId]&&Y[de.matchUpId],Pe=kt(de.scheduledTime),it=Math.abs(Pe-ne),It=Pe>=ne;if((q&&!isNaN(q)?it<=q:It&&kt(de.scheduledTime)<kt(Ie))&&!(ke&&ce)&&It){let me=[H.matchUpId,de.matchUpId].sort(FT).join("|");$.scheduleConflicts[me]={priorScheduledMatchUpId:H.matchUpId,matchUpIdWithConflict:de.matchUpId}}}}let K=$.participant.participantId;Object.keys($.scheduleConflicts).length&&w.push(K),o[K].scheduleConflicts=$.scheduleConflicts}}}return{participantIdsWithConflicts:w,eventsPublishStatuses:D,derivedEventInfo:P,derivedDrawInfo:C,mappedMatchUps:U,participantMap:o,matchUps:T}}function sb({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var b;if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:o,participantRoles:s,participantRoleResponsibilities:l,participantTypes:u,participantIds:c,signInStatus:d,enableOrFiltering:p,eventIds:m,genders:h}=t,f=wl(m)&&((b=e==null?void 0:e.events)==null?void 0:b.filter(S=>m==null?void 0:m.includes(S.eventId)))||(e==null?void 0:e.events)||[],g=n&&Lse({drawEntryStatuses:n,tournamentEvents:f}),v=o&&_se({eventEntryStatuses:o,tournamentEvents:f}),y=a!==void 0&&[!0,!1].includes(a)&&f.reduce((S,w)=>S.concat(...(w.drawDefinitions||[]).map(U=>iW({drawDefinition:U}).allPositionedParticipantIds).filter(Boolean)),[]),I=S=>r==null?void 0:r.reduce((w,U)=>{let{accessor:T,value:D}=U,{values:P}=Kp({element:S,accessor:T});return w&&(P==null?void 0:P.includes(D))},!0);if(i=i==null?void 0:i.filter(S=>{var N,A;let w=(A=(N=yo({element:S,itemType:Gy}))==null?void 0:N.timeItem)==null?void 0:A.itemValue,{participantRoleResponsibilities:U,participantType:T,participantRole:D,participantId:P,person:C}=S,R=Array.isArray(h)&&(h==null?void 0:h.length)&&(C==null?void 0:C.sex)&&h.includes(C.sex);return p?h&&R||a&&y.includes(P)||a===!1&&!y.includes(P)||(g==null?void 0:g.includes(P))||(v==null?void 0:v.includes(P))||(c==null?void 0:c.includes(P))||d&&w===d||u&&T&&wl(u)&&u.includes(T)||s&&D&&wl(s)&&s.includes(D)||l&&wl(U)&&wl(l)&&l.find(M=>U==null?void 0:U.includes(M))||(r==null?void 0:r.length)&&wl(r)&&I(S):(!h||R)&&(a===void 0||a&&y.includes(P)||a===!1&&!y.includes(P))&&(!g||g.includes(P))&&(!v||v.includes(P))&&(!c||c.includes(P))&&(!d||w===d)&&(!u||T&&wl(u)&&u.includes(T))&&(!s||D&&wl(s)&&s.includes(D))&&(!l||wl(U)&&wl(l)&&l.find(M=>U==null?void 0:U.includes(M)))&&(!(r!=null&&r.length)||wl(r)&&I(S))}),f.length&&m){let S=f.filter(w=>m.includes(w.eventId)).map(w=>{let U=(w.entries||[]).map(D=>D.participantId);if(Yi(Qs)(w.eventType))return U;let T=((e==null?void 0:e.participants)??[]).filter(D=>U.includes(D.participantId)).map(D=>D.individualParticipantIds).flat(1);return U.concat(...T)}).flat(1);i=i==null?void 0:i.filter(w=>S.includes(w.participantId))}return i}function wl(t){return t&&Array.isArray(t)&&t.length}function Lse({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return ct(e.reduce((r,n)=>{var l,u;let{flightProfile:a}=Gi({event:n}),o=((l=a==null?void 0:a.flights)==null?void 0:l.map(({drawEntries:c})=>Array.isArray(c)?c.filter(i).map(Ut):[]).flat())||[],s=((u=n.drawDefinitions)==null?void 0:u.map(({entries:c})=>c?c.filter(i).map(Ut):[]))||[];return r.concat(...o,...s)},[]))}function _se({eventEntryStatuses:t,tournamentEvents:e}){return ct(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Ut);return i.concat(...n)},[]))}function Mi(t){var B;let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:o,withScheduleItems:s,tournamentRecord:l,scheduleAnalysis:u,withSignInStatus:c,withTeamMatchUps:d,withScaleValues:p,usePublishState:m,contextProfile:h,withStatistics:f,withOpponents:g,withMatchUps:v,internalUse:y,withSeeding:I,withEvents:b,withDraws:S,withISO2:w,withIOC:U}=t;if(!l)return{error:ge};(v||n)&&ls({tournamentRecord:l});let T=fW({convertExtensions:a,tournamentRecord:l,withSignInStatus:c,withScaleValues:p,internalUse:y,withISO2:w,withIOC:U}),{participantMap:D}=T,P=Fse({withMatchUps:v??n,withEvents:b??n,withDraws:S??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:s,policyDefinitions:o,tournamentRecord:l,scheduleAnalysis:u,withTeamMatchUps:d,usePublishState:m,withStatistics:f,participantMap:D,withOpponents:g,contextProfile:h,withSeeding:I}),{participantIdsWithConflicts:C,eventsPublishStatuses:R,derivedEventInfo:N,derivedDrawInfo:A,mappedMatchUps:M}=P,E=P.matchUps;D=P.participantMap;let O=u??r,k=({potentialMatchUps:V,scheduleConflicts:G,scheduleItems:j,participant:z,statistics:q,opponents:W,matchUps:Y,events:re,draws:K})=>{let H=Object.values(K),Q=Object.values(W);return g&&(H==null||H.forEach(X=>{X.opponents=Q.filter(ie=>ie.drawId===X.drawId)})),Ge({...z,scheduleConflicts:u?Object.values(G):void 0,draws:S||n?H:void 0,events:b||n?Object.values(re):void 0,matchUps:v||n?Object.values(Y):void 0,opponents:g?Q:void 0,potentialMatchUps:O?Object.values(V):void 0,statistics:f?Object.values(q):void 0,scheduleItems:s?j:void 0},!1,!1,!0)},x=new Map;for(let V of Object.keys(D))x.set(V,k(D[V]));let F=[...x.values()],$=(B=o==null?void 0:o[_y])==null?void 0:B.participant,_=sb({participants:F,participantFilters:i,tournamentRecord:l});if(e){let V=Nt(e)?e:void 0;for(let G of _)for(let j of G.individualParticipantIds??[]){let z=D[G.participantId].participant;z!=null&&z.individualParticipants||(z.individualParticipants=[]),G.individualParticipants||(G.individualParticipants=[]);let q=x.get(j),W=V?Im({template:V,source:q}):q;z!=null&&z.individualParticipants&&z.individualParticipants.push(W),G.individualParticipants.push(W)}}let L=$?_.map(V=>Im({source:V,template:$})):_;return{participantMap:t.returnParticipantMap!==!1?D:void 0,mappedMatchUps:t.returnMatchUps!==!1?M:void 0,matchUps:t.returnMatchUps!==!1?E:void 0,missingParticipantIds:T.missingParticipantIds,participantIdsWithConflicts:C,eventsPublishStatuses:R,derivedEventInfo:N,derivedDrawInfo:A,participants:L,...J}}function Xp({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){var a;if(!e)return{error:_e};let n=(a=e.entries)==null?void 0:a.find(o=>o.participantId===t&&(!i||i===o.entryStatus)&&(!r||r===o.entryStage));return t&&n}function $g(t){var m,h,f,g,v,y,I,b,S;let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=t;if(!i)return{error:_e};let{entryProfile:o}=Wy({drawDefinition:i}),s=a&&r&&((f=(h=(m=o==null?void 0:o[a])==null?void 0:m.stageSequence)==null?void 0:h[r])==null?void 0:f.qualifiersCount)||a&&((g=o==null?void 0:o[a])==null?void 0:g.qualifiersCount)||0,l={};if(!n)return{qualifiersCount:s,roundQualifiersCounts:l};let{structure:u}=et({drawDefinition:i,structureId:n}),c=(v=i.links)==null?void 0:v.filter(w=>{var U;return((U=w==null?void 0:w.target)==null?void 0:U.structureId)===(u==null?void 0:u.structureId)}),d=0;if(c!=null&&c.length)for(let w of c){let U=(y=et({structureId:w.source.structureId,drawDefinition:i}))==null?void 0:y.structure;if((U==null?void 0:U.stage)===Ye){let T=w.source.roundNumber,D=w.target.roundNumber,P=0;if(U.structureType===xn){let C=((I=U.structures)==null?void 0:I.length)??0,R=((b=w.source.finishingPositions)==null?void 0:b.length)??0;P=C*R}else P=((S=Wt({matchUpFilters:{roundNumbers:[T]},structure:U,afterRecoveryTimes:!1,provisionalPositioning:e,inContext:!1}).matchUps)==null?void 0:S.length)||0;l[D]||(l[D]=0),l[D]+=P,d+=P}}let p=Object.keys(l);if(p.length<=1){let w=p[0]||1;l[w]=Math.max(l[w]||0,s)}return d=Math.max(d,s),{qualifiersCount:d,roundQualifiersCounts:l}}function RS({stage:t,drawDefinition:e}){var r;let{entryProfile:i}=Wy({drawDefinition:e});return((r=i==null?void 0:i[t])==null?void 0:r.drawSize)||0}function $se(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=RS({stage:n,drawDefinition:i}),{qualifiersCount:o}=$g({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-o}function qW({stage:t,drawDefinition:e}){return!!(t===Ar||AA({stage:t,drawDefinition:e})&&RS({stage:t,drawDefinition:e}))}function YW({entryStatus:t=oa,drawDefinition:e,stageSequence:i,stage:r}){if(t===Vo)return Noe({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...J}:{error:QG};let n=$se({drawDefinition:e,stageSequence:i,stage:r}),a=Aoe({drawDefinition:e,stage:r}),o=ME({entryStatus:Ff,drawDefinition:e,stage:r}),s=ME({entryStatus:oa,drawDefinition:e,stage:r}),l=o+s,u=l>=n,c=n-l;return r!==Ar&&u?{error:yE}:t===Ff?o<a?{...J}:{error:yE}:{positionsAvailable:c,...J}}function jA(t){let e=ze(t,[{[Fn]:!0,[Az]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=oa,entryStageSequence:n,entryStage:a=Oe,ignoreStageSpace:o,drawDefinition:s,entryPosition:l,participant:u,roundTarget:c,extensions:d,extension:p,drawType:m,event:h}=t,f="addDrawEntry";if(m!==La&&!qW({stage:a,drawDefinition:s}))return ee({result:{error:lp},stack:f});let g=YW({stageSequence:n,stage:a,drawDefinition:s,entryStatus:r});if(!o&&!g.success&&(!m||m!==La))return{error:g.error};if(p&&!tl({extension:p}))return ee({result:{error:oe},info:"Invalid extension",context:{extension:p},stack:f});let v=t.participantId||(u==null?void 0:u.participantId);if(!v)return ee({result:{error:pr},stack:f});let y=r===Tu&&Xp({participantId:v,drawDefinition:s,entryStatus:r}),I=a===Ar&&Xp({participantId:v,drawDefinition:s,entryStage:a}),b=Xp({participantId:v,drawDefinition:s}),S=r!==Tu&&a!==Ar&&b;if(S)return i?(lt({payload:{drawId:s.drawId,eventId:h==null?void 0:h.eventId,error:gI,participantId:v},topic:mA}),{...J}):ee({result:{error:gI},context:{participantId:v},stack:f});if(y||I)return ee({context:{invalidEntry:S,invalidLuckyLoser:y,invalidVoluntaryConsolation:I},result:{error:W0},stack:f});let w=Ge({entryStageSequence:n,participantId:v,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&Lt({element:w,extension:p}),c&&Lt({extension:{name:"roundEntry",value:c},element:w}),s.entries||(s.entries=[]),s.entries.push(w),si({drawDefinition:s}),{...J}}function Bse(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=oa,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:o,drawDefinition:s,stageSequence:l,stage:u=Oe,roundTarget:c,extension:d,event:p}=t;if(!u)return{error:NG};if(!s)return{error:_e};if(!Array.isArray(o))return{error:va};if(!qW({stage:u,drawDefinition:s}))return{error:lp};if(d&&!tl({extension:d}))return ee({result:{error:oe},info:"Invalid extension",context:{extension:d},stack:e});let m=YW({drawDefinition:s,stageSequence:l,entryStatus:r,stage:u});if(!a&&!m.success)return{error:m.error};let h=m.positionsAvailable??0;if(!a&&u!==Ar&&h<o.length)return{error:yN};let f=[],g=s.drawId,v=p==null?void 0:p.eventId,y=o.reduce((I,b)=>{let S=r===Tu&&Xp({participantId:b,drawDefinition:s,entryStatus:r}),w=u===Ar&&Xp({entryStage:u,drawDefinition:s,participantId:b}),U=Xp({participantId:b,drawDefinition:s});return r!==Tu&&u!==Ar&&U&&(f.push(b),i&&lt({payload:{error:gI,participantId:b,eventId:v,drawId:g},topic:mA})),S||w?I.concat(b):I},[]);return f.length&&!i?ee({context:{eventId:v,drawId:g,duplicateEntries:f},result:{error:gI},stack:e}):(o.filter(I=>I&&!y.includes(I)).forEach(I=>{let b={entryStageSequence:l,entryStage:u,participantId:I,entryStatus:r};d&&Lt({element:b,extension:d}),c&&Lt({extension:{name:fl,value:c},element:b}),s.entries||(s.entries=[]),s.entries.push(b)}),n&&(s.entries=ys({entries:s.entries})),si({drawDefinition:s}),y!=null&&y.length||f!=null&&f.length?{info:"some participantIds could not be added",participantIdsNotAdded:y,duplicateEntries:f,...J}:{...J})}function GA({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,entryStage:l,extension:u,drawId:c,event:d}){if(!(n!=null&&n.length))return{error:Vc};if(!d)return{error:lo};if(!c)return{error:ks};let p=(d.entries||[]).map(Ut);if(n.filter(f=>!p.includes(f)).length)return{error:EG};if(a){let f=Bse({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,extension:u});if(f.error)return f}let{flightProfile:m}=Gi({event:d}),h=m==null?void 0:m.flights.find(f=>f.drawId===c);return h!=null&&h.drawEntries&&(n.forEach(f=>{let g=o===Tu&&dC({participantId:f,entryStatus:o,flight:h}),v=l===Ar&&dC({participantId:f,entryStage:l,flight:h});!(o!==Tu&&l!==Ar&&dC({flight:h,participantId:f}))&&!g&&!v&&h.drawEntries.push({participantId:f,entryStatus:o,entryStage:l})}),e&&(h.drawEntries=ys({entries:h.drawEntries}))),{...J}}function dC({participantId:t,entryStatus:e,entryStage:i,flight:r}){var a;let n=(a=r.drawEntries)==null?void 0:a.find(o=>o.participantId===t&&(!e||e===o.entryStatus)&&(!i||i===o.entryStage));return t&&n}function lb({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){var d,p,m,h;let a="removeEventEntries";if(!(n!=null&&n.eventId))return{error:gi};if(!Array.isArray(e)||e.some(f=>!Ti(f)))return ee({result:{error:Ss},stack:a});let o=(n.drawDefinitions??[]).flatMap(f=>gp({drawDefinition:f}).assignedParticipantIds??[]),s=((i==null?void 0:i.length)&&((d=n.entries)==null?void 0:d.filter(f=>f.entryStatus&&i.includes(f.entryStatus)))||[]).map(Ut).filter(f=>!o.includes(f)),l=(r&&((p=n.entries)==null?void 0:p.filter(f=>f.entryStage&&f.entryStage===r))||[]).map(Ut).filter(f=>!o.includes(f));if(e.length?e=e.filter(f=>(!(i!=null&&i.length)||s.includes(f))&&(!r||l.includes(f))):s.length&&l.length?e=Vi(s,l):s.length?e=s:l.length&&(e=l),(e==null?void 0:e.length)&&o.some(f=>e.includes(f)))return ee({result:{error:Rg},stack:a});if(!(e!=null&&e.length))return{...J,participantIdsRemoved:[]};let u=[];n.entries=(n.entries??[]).filter(f=>{let g=!e.includes(f==null?void 0:f.participantId);return g||u.push(f.participantId),g}),t&&(n.entries=ys({entries:n.entries}));let{flightProfile:c}=Gi({event:n});return(m=c==null?void 0:c.flights)==null||m.forEach(f=>{f.drawEntries=(f.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(h=n.drawDefinitions)==null||h.forEach(f=>{f.entries=(f.entries??[]).filter(g=>!e.includes(g.participantId))}),{...J,participantIdsRemoved:u}}var KW={[Or]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},Bg=KW;function Hs(t){var M,E;let{suppressDuplicateEntries:e=!0,entryStatus:i=oa,autoEntryPositions:r=!0,enforceGender:n=!0,entryStageSequence:a,policyDefinitions:o,entryStage:s=Oe,tournamentRecord:l,ignoreStageSpace:u,drawDefinition:c,roundTarget:d,extensions:p,extension:m,drawId:h,event:f}=t,g="addEventEntries";if(!Array.isArray(t.participantIds))return ee({result:{error:va},stack:g});let v=ct(t.participantIds??[]);if(!f)return{error:gi};if(!(v!=null&&v.length))return ee({result:{error:Vc},stack:g});if(!(f!=null&&f.eventId))return{error:lo};let y=$t({tournamentRecord:l,event:f}).appliedPolicies??{},I=(o==null?void 0:o[Or])??(y==null?void 0:y[Or])??Bg[Or],b=(n??((M=I==null?void 0:I.participants)==null?void 0:M.enforceGender))!==!1,S=[],w=[];if(p&&(!Array.isArray(p)||!p.every(O=>tl({extension:O})))||m&&!tl({extension:m}))return ee({context:Ge({extension:m,extensions:p}),result:{error:oe},info:"Invalid extension(s)",stack:g});let U=!!l,T=[],D,P=((E=l==null?void 0:l.participants)==null?void 0:E.filter(O=>{var F,$,_;if(!v.includes(O.participantId))return!1;let k=Yi(ti)(f.eventType)&&O.participantType===St&&!hd(i),x=f.eventType===Qt&&O.participantType===ht;return k&&(!f.gender||!b||[Bn,Ds].includes(f.gender)||f.gender===((F=O.person)==null?void 0:F.sex))||x&&!hd(i)||f.eventType===Qt&&O.participantType===St&&hd(i)?!0:k&&f.gender&&b&&![Bn,Ds].includes(f.gender)&&f.gender!==(($=O.person)==null?void 0:$.sex)?(T.push({participantId:O.participantId,sex:(_=O.person)==null?void 0:_.sex}),!1):f.eventType===Kt&&(O.participantType===Kt||hd(i)&&O.participantType===St)}).map(O=>O.participantId))??[],C=v.filter(O=>!U||P.includes(O));f.entries||(f.entries=[]);let R=f.entries.map(O=>{var k;return O.participantId||((k=O.participant)==null?void 0:k.participantId)});if(C.forEach(O=>{var k;if(!R.includes(O)){let x=Ge({participantId:O,entryStatus:i,entryStage:s,extensions:p});m&&Lt({element:x,extension:m}),d&&Lt({extension:{name:fl,value:d},element:x}),a&&(x.entryStageSequence=a),S.push(x.participantId),(k=f.entries)==null||k.push(x)}}),h&&!hd(s)){let O=GA({participantIds:C,suppressDuplicateEntries:e,autoEntryPositions:r,entryStageSequence:a,ignoreStageSpace:u,drawDefinition:c,entryStatus:i,roundTarget:d,entryStage:s,extension:m,drawId:h,event:f});O.error&&(D=O.error)}if(f.eventType&&[yu,Sa].includes(f.eventType)){let O=(f.entries||[]).map($=>$.participantId),k=(f.entries||[]).filter($=>hd($.entryStatus)).map($=>$.participantId),x=((l==null?void 0:l.participants)??[]).filter($=>O.includes($.participantId)&&$.participantType&&[ht,Kt].includes($.participantType)).map($=>$.individualParticipantIds).flat(1/0),F=k.filter($=>x.includes($));F.length&&(w.push(...F),lb({participantIds:F,autoEntryPositions:!1,event:f}))}if(C.length!==v.length)return ee({context:{mismatchedGender:T,gender:f.gender},result:{error:va},stack:g});r&&(f.entries=ys({entries:f.entries||[]}));let N=S.length,A=w.length;return ee({result:{...J,addedEntriesCount:N,removedEntriesCount:A},stack:g,info:D})}var XW="ADMINISTRATION",Vse="CAPTAIN",jse="COACH",Zr="COMPETITOR",JW="MEDIA",ZW="MEDICAL",HA="OFFICIAL",QW="OTHER",eq="SECURITY",zA={ADMINISTRATION:XW,CAPTAIN:Vse,COACH:jse,COMPETITOR:Zr,MEDIA:JW,MEDICAL:ZW,OFFICIAL:HA,OTHER:QW,SECURITY:eq};function WA({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return ee({result:{error:ge},stack:a});if(!i||!e)return ee({result:{error:Xe},stack:a});let o=(r.participants??[]).find(c=>c.participantId===i);if(!o)return ee({result:{error:zi},stack:a});if(![Kt,Wa].includes(o.participantType))return ee({result:{participantType:o.participantType,error:Ts},stack:a});let s=tq({individualParticipantIds:e,groupingParticipant:o,tournamentRecord:r,suppressErrors:n}),{removed:l,error:u}=s;if(u)return ee({result:s,stack:a});if(t)for(let c of r.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(m=>!d.includes(m));Hs({participantIds:p,entryStatus:bo,tournamentRecord:r,event:c})}}return l&&lt({topic:nn,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...J,...s}}function tq({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){var p,m;let o=[];if(!e)return{removed:o};let s=[],l=[];a||({participants:a,mappedMatchUps:n}=Mi({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let u=(m=(p=a==null?void 0:a.find(({participantId:h})=>h===e.participantId))==null?void 0:p.events)==null?void 0:m.map(({eventId:h})=>h),c=(e.individualParticipantIds??[]).filter(h=>{var y;let f=t==null?void 0:t.includes(h),g=f&&((y=a==null?void 0:a.find(I=>I.participantId===h))==null?void 0:y.matchUps.filter(({eventId:I})=>u.includes(I)).map(({matchUpId:I})=>n==null?void 0:n[I]).filter(({winningSide:I,score:b})=>I||vr({score:b}))),v=f&&!(g!=null&&g.length);if(f&&!v&&l.push(h),v){o.push(h);for(let I of i.events??[])for(let b of I.drawDefinitions??[]){let{extension:S}=gt({element:b,name:Uu}),w=S==null?void 0:S.value[e.participantId];S&&w&&(S.value[e.participantId]=w.filter(T=>T.participantId!==h),Lt({element:b,extension:S}),jy({drawDefinition:b}));let U=Sn({drawDefinition:b,inContext:!1}).matchUps??[];for(let T of U){let D=T.sides??[];for(let P of D){let C=P.lineUp??[];C.find(R=>R.participantId===h)&&(P.lineUp=C.filter(R=>R.participantId!==h),Rt({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:b,matchUp:T}))}}}}else s.push(h);return!v});e.individualParticipantIds=c;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:s,removed:o};return l.length&&!r&&{...d,cannotRemove:l,error:H0}||d}function LT({participantRole:t=Zr,individualParticipantIds:e=[],groupingTypes:i=[Vn,Wa],tournamentRecord:r}){if(!r)return{error:ge};let n=r.participants??[],{participants:a,mappedMatchUps:o}=Mi({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),s=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=tq({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:o,participants:a});u&&s++}),s?J:{error:YG}}function oh(t){var h,f;let e=ze(t,[{[br]:!0},{participantIds:!0,[Xn]:un,[Bo]:Vc}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:r,participantIds:n}=t,a=((h=r.participants)==null?void 0:h.length)||0;if(!a)return{...J};let o=(f=r.events||[])==null?void 0:f.filter(({eventType:g})=>g===sr).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),s=Mi({participantFilters:{participantIds:n},tournamentRecord:r,withDraws:!0}).participants??[],l=g=>{let v=(Br({matchUpFilters:{drawIds:g,matchUpTypes:[Qt]},tournamentRecord:r}).matchUps??[]).flatMap(({sides:y})=>y==null?void 0:y.map(({participantId:I})=>I||[])).filter(Boolean);return Vi(v,n)},u=o!=null&&o.length?l(o):[],c=s.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(o!=null&&o.length)||!(o!=null&&o.includes(y.drawId)))&&y.positionAssignments).length});if(u!=null&&u.length||c.length)return{error:Rg};let d={},p={};for(let g of r.events||[]){let v=lb({participantIds:n,event:g});if(v.error)return v;d[g.eventId]=v.participantIdsRemoved}r.participants=(r.participants??[]).filter(g=>{var y,I;let v=n.includes(g.participantId)||g.participantType===ht&&((y=g.individualParticipantIds)==null?void 0:y.some(b=>n.includes(b)));if(!v&&g.participantType===sr&&((I=g.individualParticipantIds)!=null&&I.some(b=>n.includes(b)))&&(g.individualParticipantIds=g.individualParticipantIds.filter(b=>!n.includes(b))),v&&i&&g.participantType&&[ht,Kt].includes(g.participantType))for(let b of g.individualParticipantIds||[])n.includes(b)||(p[g.participantId]||(p[g.participantId]=[]),p[g.participantId].push(b));return!v});let m=a-r.participants.length;if(LT({individualParticipantIds:n,tournamentRecord:r}),i)for(let g of r.events||[]){let v=d[g.eventId].map(y=>p[y]||[]).flat();Hs({participantIds:v,entryStatus:bo,tournamentRecord:r,event:g})}return m&&lt({payload:{participantIds:n,tournamentId:r.tournamentId},topic:hA}),m?{...J,participantsRemovedCount:m}:{error:H0}}function iq({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){var l;let o=n.entries??[];if(r){let{flightProfile:u}=Gi({event:n}),c=(l=u==null?void 0:u.flights)==null?void 0:l.find(d=>d.drawId===r);c?o=c.drawEntries:e.entries&&(o=e==null?void 0:e.entries)}let s=o.filter(u=>(!(i!=null&&i.length)||!u.entryStatus||i.includes(u.entryStatus))&&(!a||!u.entryStage||u.entryStage===a)&&(!t||u.entryStatus&&ss.includes(u.entryStatus)));return{entries:o,stageEntries:s}}function rq({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:o}){var v;let s="destroyGroupEntry";if(!e)return{error:ge};if(!r)return ee({result:{error:pr},stack:s});if(!o)return{error:gi};if(!o.eventType||![yu,Sa].includes(o.eventType))return ee({result:{error:Ll},stack:s});let l=e.participants??[],u=l.find(y=>y.participantId===r);if(!u)return ee({result:{error:zi},stack:s});if(!u.participantType||![ht,Vn].includes(u.participantType)||u.participantType===Vn&&o.eventType!==Sa||u.participantType===ht&&o.eventType!==yu)return{error:Ts};let c=(o.entries??[]).find(y=>y.participantId===r);if(!c)return{error:ZG};let{stageEntries:d}=iq({selected:!1,drawDefinition:i,drawId:n,event:o,stage:a}),p=d.map(Ut),m=l.filter(({participantId:y})=>p.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),h=(v=u.individualParticipantIds)==null?void 0:v.filter(y=>js(y,m).length===1),f=lb({participantIds:[r],event:o});if(f.error||h!=null&&h.length&&(f=Hs({participantIds:h,entryStatus:bo,entryStage:c.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:o}),f.error))return f;let g;return t&&oh({participantIds:[r],tournamentRecord:e}).success&&(g=!0),{...J,participantRemoved:g}}function qA({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return rq({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function nq(t){if(!t.tournamentRecord)return{error:ge};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let o=rq({participantId:a,...i});o.success&&(r+=1),o.error&&n.push(o.error)}return r?{destroyedCount:r,...J}:{error:n}}function kI(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:o,drawId:s}=t,l="removeDrawPositionAssignment",u=ab(t);if(u.error)return ee({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:m}=t,h=$t({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([Vo,Du].includes(a)&&c){let{tournamentRecord:g}=t,{participant:v}=qc({tournamentRecord:g,participantId:c}),{participantType:y,individualParticipantIds:I}=v??{};if(n&&y===ht){let b=qA({tournamentRecord:g,drawDefinition:r,participantId:c,event:p});if(b.error)return ee({result:b,stack:l});I&&PS({participantIds:I,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:s,event:p})}else PS({participantIds:[c],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:s,event:p})}if(i){let g=Ya({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:m,matchUpsMap:o,event:p});if(g.error)return ee({result:g,stack:l})}let{structure:f}=et({drawDefinition:r,structureId:m});return DA({structure:f,drawPositions:[d]}),DT({appliedPolicies:h,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:m}}),u}function aq(t){return Object.assign(t,{entryStatus:Du}),kI(t)}function LE(t){return Ti(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Qr(t){return Ti(t)?LE(t.replace(/_/g," ")):""}var gc=({finishingPosition:t=qm,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:r=[],stageSequence:n=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:u,matchUpType:c,matchUps:d=[],structureId:p,roundOffset:m,roundLimit:h,stageOrder:f,structures:g,stage:v})=>{let y={structureId:p??Gt(),structureAbbreviation:i,finishingPosition:t,seedAssignments:r,matchUpFormat:s,stageSequence:n,structureName:u};a&&(y.structureOrder=a),l&&(y.structureType=l),o&&(typeof o=="string"?y.seedingProfile=o:typeof o=="object"&&typeof o.positioning=="string"&&(y.seedingProfile=o.positioning)),c&&(y.matchUpType=c),m&&(y.roundOffset=m),f&&(y.stageOrder=f),h&&(y.roundLimit=h),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let I=d.flatMap(({drawPositions:b})=>b).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=ct(I).sort((b,S)=>b-S).map(b=>({drawPosition:b}))),y},ao=gc;function YA({structureName:t=Qr(Ar),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:_e};let a=ao({stage:Ar,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),si({drawDefinition:i,structureIds:[a.structureId]}),{...J}}function KA({drawPositions:t}){if(!(t!=null&&t.length))return{error:Dy};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=ct(i.map(_T)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function _T(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(or).join("|")}function oq({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,m)=>m),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),o=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{n[p].push([a[v],o[v]])});let m=a.shift(),h=a.pop(),f=o.shift();a=[m,f,...a].filter(Boolean),o=[...o,h].filter(Boolean)});let s=a.shift(),l=a.pop(),u=o.shift();a=[s,u,...a].filter(Boolean),o=[...o,l].filter(Boolean);let c=d=>d[0].reduce((p,m)=>p+m);return[...n].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(m=>m<=t)).map(p=>{let m=p.map(h=>h+e);return _T(m)}))}function Gse({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Xe}}var Hse={getRoundRobinGroupMatchUps:KA,determineRoundNumber:Gse,drawPositionsHash:_T,groupRounds:oq};function ub(t){var U;let{groupNameBase:e="Group",playoffAttributes:i,stageSequence:r=1,structureOptions:n,appliedPolicies:a,seedingProfile:o,stage:s=Oe,matchUpType:l,roundTarget:u,structureId:c,groupNames:d,drawSize:p,idPrefix:m,isMock:h,uuids:f}=t,g=t.structureName??((U=i==null?void 0:i["0"])==null?void 0:U.name)??Qr(Oe),{groupCount:v,groupSize:y}=zse({structureOptions:n,appliedPolicies:a,drawSize:p}),I=Od,b,S=Se(1,v+1).map(T=>{let D=Wse({groupSize:y,structureOrder:T,matchUpType:l,drawSize:p,idPrefix:m,isMock:h});b=Array.isArray(D)?Math.max(...D.map(({roundNumber:C})=>C??0)):0;let P=(d==null?void 0:d[T-1])??`${e} ${T}`;return gc({structureId:f==null?void 0:f.pop(),structureType:oT,finishingPosition:I,structureOrder:T,structureName:P,matchUps:D})}),w=gc({structureId:c??(f==null?void 0:f.pop()),structureType:xn,finishingPosition:I,seedingProfile:o,structureName:g,stageSequence:r,structures:S,stage:s});return u&&Lt({extension:{name:fl,value:u},element:w}),{structures:[w],maxRoundNumber:b,groupCount:v,links:[],groupSize:y,...J}}function zse({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e==null?void 0:e.groupSize,n=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=cb({groupSizeLimit:n,drawSize:i}),o=a&&Math.max(...a);r&&(a!=null&&a.includes(r))||(r&&r>4||!(a!=null&&a.includes(4))?r=o:r=4);let s=Math.ceil(i/r);return{groupSize:r,groupCount:s}}function cb(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=Se(3,e+1).filter(n=>{let a=Math.ceil(i/n),o=a*n-i,s=Math.ceil(i/a),l=Math.ceil(o/a);return(!o||o<n)&&s===n&&s>=3&&l<2});return{...J,validGroupSizes:r}}function Wse({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:o}){let s=(t-1)*i,l=Se(1+s,i+1+s),u=KA({drawPositions:l}).uniqueMatchUpGroupings??[],c=oq({groupSize:i,drawPositionOffset:s});return u.map(p).sort((m,h)=>(m.roundNumber??1/0)-(h.roundNumber??1/0));function d(m){return c.reduce((h,f,g)=>f.includes(m)?g+1:h,void 0)}function p(m){let h=_T(m),f=d(h),g=[1,r],v=qse({structureOrder:t,drawPositions:m,roundNumber:f,idPrefix:n,uuids:o}),y={matchUpStatus:f?Ji:Vt,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:m,roundNumber:f,matchUpId:v};return a&&(y.isMock=!0),y}}function qse({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:(n==null?void 0:n.pop())||Gt()}function XA(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!ot(i))return{seedBlocks:void 0,...ee({result:{error:oe},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=Ug(i);if(e){let m=Math.min(e,n),h=[],f=1;for(Se(0,m).forEach(()=>{h.push([f]),f++});f<n;){let g=Se(f,f+m);f+=m,h.push(g)}return{...J,seedBlocks:h}}let a=Se(1,n+1),o=[],s=n/2;for(;s>1;){let m=Pr(a,s),h=m.length;m.forEach((f,g)=>{let v,y=g<h/2,I=g%2===0,b=f[0],S=f[f.length-1];r&&h>4?h===8?v=y?S:b:v=I?b:S:v=y?b:S,Rn(f,o)||o.push(v)}),s=s/2}let l=a.filter(m=>!o.includes(m));for(;l.length;)l.length%2===0?o.push(l.pop()):o.push(l.shift());let u=Se(0,20).map(m=>Math.pow(2,m));u.unshift(1);let c=u.indexOf(n),d=0,p=[];return Se(0,c).forEach(m=>{p.push(o.slice(d,d+u[m])),d+=u[m]}),{...J,seedBlocks:p}}function JA({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!ot(e))return{seedGroups:void 0,...ee({result:{error:oe},context:{drawSize:e},stack:i})};if(t){if(!ot(t))return{seedGroups:void 0,...ee({context:{roundRobinGroupsCount:t},result:{error:oe},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:Se(0,n).map(()=>{let a=Se(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=XA({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function ZA({roundRobinGroupsCount:t,participantsCount:e}){var n;if(t){let{validGroupSizes:a}=cb({drawSize:e});if(!((n=a==null?void 0:a.map(o=>Math.ceil(e/o)))!=null&&n.includes(t)))return ee({context:{roundRobinGroupsCount:t},result:{error:oe}})}let{seedGroups:i}=JA({drawSize:e,roundRobinGroupsCount:t}),r=(i==null?void 0:i.map(a=>Math.min(...a)))||[];return{...J,seedingThresholds:r}}function _f(t){if(!t)return 1/0;if(ot(t))return Ze(t);let e=t.split("-")[0];return ot(e)?Ze(e):1/0}function Yse({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(or),e.reverse(),e}function Kse({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function Xse({positioning:t,size:e}){let i=Yse({size:e}),r=[],n=[],a=p=>p[0],o=p=>p[p.length-1],s=(p,m)=>(t&&[VN,Nd].includes(t)&&m%2?o(p):a(p))||a(p),l=(p,m)=>{if(p.every(h=>!n.includes(h))){let h=s(p,m);return n.push(h),h}},u=p=>{let m=p.filter(h=>!n.includes(h));if(m.length)return n.push(...m),m},c=(p,m)=>{let h=s(p,m);if(!n.includes(h))return n.push(h),h},d=Se(1,e+1);for(let p of i)if(p===1){let m=Pr(d,2),h=m.map(l).filter(Boolean);h.length&&r.push(h);let f=m.flatMap(u).filter(Boolean);f.length&&r.push(f)}else{let m=Pr(d,p).map(c).filter(Boolean);m.length&&r.push(m)}return{divisions:i,divisionGroupings:r}}function sh({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:o}){var E;let s=[];if(!o)return{error:sp};let{matchUps:l,roundMatchUps:u}=Wt({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:c}=po({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:o}),{positionAssignments:d}=Rr({structure:o}),p=d==null?void 0:d.length,m=(c==null?void 0:c.length)??0,h=[],f=Object.keys(u).map(O=>parseInt(O)).sort((O,k)=>O-k).map(O=>{let k=u[O].map(F=>F.drawPositions).flat(1/0).filter(Boolean),x=k.filter(F=>!h.includes(F));return h=h.concat(...k),x}).filter(O=>O.length).reverse(),g=f.pop()??[],v=g&&Math.min(...g)-1||0;r=r??((E=i==null?void 0:i.seeding)==null?void 0:E.seedingProfile);let y=(g==null?void 0:g.length)||0,I=f.filter(O=>O.filter(k=>k<=m).length),{stage:b,structureType:S,roundLimit:w}=o,U=S===xn,T=!U&&(f==null?void 0:f.length),D=!U&&b===Ye&&w,P=I.flat(1/0),C=T?P==null?void 0:P.length:0,R=a?p:m,N=OA({drawDefinition:n,structure:o,matchUps:l}),A=N?0:!T&&R||R&&P.length<R&&R-P.length||0;if(D){let O=o!=null&&o.matchUps?o.matchUps.filter(({roundNumber:x})=>x===o.roundLimit).length:0,k=g.length/O;if(!T){let x=db(r),F=Pr(g,k),$=1,_=Se(0,F[0].length).map(()=>{let L=Se($,$+F.length);return $+=F.length,L});({validSeedBlocks:s}=sq({drawPositionBlocks:F,nonRandom:r==null?void 0:r.nonRandom,positioning:x,seedGroups:_}))}}else U?{validSeedBlocks:s}=Jse({nonRandom:r==null?void 0:r.nonRandom,seedingProfile:r,structure:o}):T?s=I.map(O=>({seedNumbers:O,drawPositions:O})):N&&Pr(g,2).map((O,k)=>({drawPositions:[O[0]],seedNumbers:[k+1]})).forEach(O=>s.push(O));if(!U&&!N&&!D){let{blocks:O}=Zse({drawPositionOffset:v,seedNumberOffset:C,seedCountGoal:A,seedingProfile:r,baseDrawSize:y});O.forEach(k=>s.push(k))}let M=s.flatMap(O=>O.drawPositions).reduce((O,k)=>(g==null?void 0:g.includes(k))&&O,!0);return!N&&!T&&!U&&!M?{error:DG,validSeedBlocks:[],isContainer:U,isFeedIn:T}:{isLuckyStructure:N,validSeedBlocks:s,isContainer:U,isFeedIn:T}}function Jse({seedingProfile:t,structure:e,nonRandom:i}){var c;let r=e.structures||[],n=r.length,a=(c=ai({structure:e}))==null?void 0:c.positionAssignments,o=db(t),s=(a==null?void 0:a.length)??0,{seedGroups:l}=JA({roundRobinGroupsCount:n,drawSize:s}),u=r.map(d=>{var p;return(p=ai({structure:d}).positionAssignments)==null?void 0:p.map(m=>m.drawPosition)});return sq({drawPositionBlocks:u,positioning:o,seedGroups:l,nonRandom:i})}function sq({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=Xse({size:i.length,positioning:e}),o=[];return i.forEach((s,l)=>{let u=Kse({blockPattern:a,index:l});s.forEach((c,d)=>{let p=l%2?t.length-d-1:d,m=t[p].slice().filter((f,g)=>u.includes(g+1)&&f);e!==Nd?m=r?m:wn(m):l%2&&m.reverse();let h=m.find(f=>!o.includes(f));h&&(o.push(h),n.push({drawPositions:[h],seedNumbers:[c]}))})}),{validSeedBlocks:n}}function Zse(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:o}=t,s=1,l=[],{seedBlocks:u}=XA({cluster:db(n)===VN,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let d of u){if(s+1>a)break;let p=d.map(h=>h+e),m=c(s+1,d.length).map(h=>+h+r);s+=d.length,l.push({drawPositions:p,seedNumbers:m})}return{blocks:l};function c(d,p){return Array.from(new Array(p),(m,h)=>h+d)}}function CS({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){var l,u,c,d,p,m;let{structure:o}=et({drawDefinition:e,structureId:n});t||(t=$t({drawDefinition:e}).appliedPolicies);let s=i==null?void 0:i.validSeedBlocks;return!s&&o&&(s=(l=sh({appliedPolicies:t,drawDefinition:e,structure:o}))==null?void 0:l.validSeedBlocks),(c=(u=t==null?void 0:t.seeding)==null?void 0:u.validSeedPositions)!=null&&c.ignore?!0:(p=(d=t==null?void 0:t.seeding)==null?void 0:d.validSeedPositions)!=null&&p.strict?(((m=s.find(h=>h.seedNumbers.includes(a)))==null?void 0:m.drawPositions)||[]).includes(r):[].concat(...s.map(h=>h.drawPositions)).includes(r)}function lq(t){var R,N,A;let{provisionalPositioning:e,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:o}=t,{structure:s}=et({drawDefinition:i,structureId:a}),{seedAssignments:l}=po({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:s}),{positionAssignments:u}=Rr({structure:s}),c=(R=u==null?void 0:u.filter(M=>M.participantId??M.bye??M.qualifier))==null?void 0:R.map(M=>M.drawPosition).filter(Boolean),{appliedPolicies:d}=$t({drawDefinition:i}),p=((n==null?void 0:n.validSeedBlocks)||s&&((N=sh({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:r,structure:s}))==null?void 0:N.validSeedBlocks)||[]).filter(M=>M.drawPositions.filter(E=>!(c!=null&&c.includes(E))).length)[0],m=l==null?void 0:l.map(M=>M.participantId).filter(Boolean),h=u==null?void 0:u.map(M=>M.participantId).filter(Boolean),f=m==null?void 0:m.filter(M=>h==null?void 0:h.includes(M)),g=m==null?void 0:m.filter(M=>!(h!=null&&h.includes(M))),v=l==null?void 0:l.filter(M=>g==null?void 0:g.includes(M.participantId)),y=l==null?void 0:l.filter(M=>!M.participantId),I=(v!=null&&v.length&&v.length>0?v.length:(y==null?void 0:y.length)??0)&&(p==null?void 0:p.drawPositions.filter(M=>!(c!=null&&c.includes(M))))||[],b=o?wn(I):I,S=[],w=b.map(()=>{var E;let M=(E=C(v,S))==null?void 0:E.participantId;return M&&S.push(M),M}).filter(Boolean),U=l==null?void 0:l.filter(M=>f==null?void 0:f.includes(M.participantId)).map(M=>M.seedNumber),T=((p==null?void 0:p.seedNumbers)||[]).filter(M=>!(U!=null&&U.includes(M))),D=l==null?void 0:l.filter(M=>T.includes(M.seedNumber)).map(M=>M.participantId),P=(A=d==null?void 0:d.seeding)==null?void 0:A.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:P===void 0||P?w:D,unplacedSeedNumbers:T,unfilledPositions:b,unplacedSeedAssignments:v};function C(M,E){let O=M.filter(F=>!E.includes(F.participantId)),k=Math.min(...O.map(F=>_f(F.seedValue))),x=O.filter(F=>_f(F.seedValue)===k);return wn(x).pop()}}function db(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function Vg({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:u,event:c}){var S,w,U;let d="assignSeed",{structure:p}=et({drawDefinition:i,structureId:o}),{positionAssignments:m}=Rr({structure:p}),h=po({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,f=h.map(T=>T.seedNumber),g=Xp({drawDefinition:i,participantId:n});if(n&&!g)return ee({result:{error:Ss},context:{participantId:n},stack:d});let v=c?(w=(S=Gi({event:c}).flightProfile)==null?void 0:S.flights)==null?void 0:w.length:0,y=v&&v>1,I=(U=m==null?void 0:m.find(T=>T.participantId===n))==null?void 0:U.drawPosition;if(I&&!CS({drawPosition:I,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s}))return ee({result:{error:aN},context:{assignedDrawPosition:I},info:"invalid seed position",stack:d});f.includes(s)||h.push({seedNumber:s,seedValue:l});let b;return h.forEach(T=>{T.participantId===n&&T.seedNumber!==s&&(T.participantId=void 0),T.seedNumber===s&&(T.participantId=n,!(r!=null&&r.groupSeedingThreshold)&&!y&&(T.seedValue=l??s),b=!0)}),b?(uW({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:p,eventId:u}),{...J}):ee({result:{error:TG},stack:d})}function QA({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:o}){var p,m,h,f;let s=(m=(p=t==null?void 0:t.sides)==null?void 0:p[e])==null?void 0:m.sideNumber,l=s&&((h=a.sides)==null?void 0:h.find(g=>g.sideNumber===s)),{extension:u}=gt({element:n,name:Uu}),c=(u==null?void 0:u.value)||{},d=Me(c[i],!1,!0);if(l)(f=a==null?void 0:a.sides)==null||f.forEach(g=>{g.sideNumber===s&&(g.lineUp=d)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(I=>I.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===s);g&&(g.lineUp=d)}Rt({tournamentId:r==null?void 0:r.tournamentId,context:"updateSidLineUp",eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUp:a})}function uq(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,o=i.roundNumber>1&&i.roundNumber-1,s=Fd({structureId:r.structureId,matchUpsMap:n});!e&&a&&(e=s.find(({drawPositions:h,roundNumber:f})=>f===o&&(h==null?void 0:h.includes(a))));let l=e==null?void 0:e.roundPosition,u=l%2?1:-1,c=l+u,d=o&&s.find(({roundNumber:h,roundPosition:f})=>h===o&&f===c),p=d==null?void 0:d.matchUpStatus,m=[er,cr].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:m}}function Qse({drawPosition:t,drawPositions:e}){let i=!1,r=!!(e!=null&&e.includes(t));return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(or).filter(Boolean),positionAdded:i,positionAssigned:r}}function cq({structureId:t,matchUpsMap:e,matchUp:i}){let r=i==null?void 0:i.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:Fd({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:s})=>o===(i==null?void 0:i.roundNumber)&&s===a)}}function dq({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:o}=cq({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:r});if(a&&o){let s=o==null?void 0:o.matchUpId,l=t.find(c=>c.matchUpId===s),u=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(c=>{let d=Ti(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function OU({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,o)=>{var s;return(s=a.drawPositions)!=null&&s.includes(e)?o+1:n},void 0)}function $f({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:u}){var R,N,A,M;let c="assignMatchUpDrawPosition";s||(s=sn({drawDefinition:n})),t||(t=mr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[]);let d=t.find(E=>E.matchUpId===l),p=d==null?void 0:d.structureId,m=(R=n==null?void 0:n.structures)==null?void 0:R.find(E=>E.structureId===p);if(!m)return{error:Ei};let h=(N=s==null?void 0:s.drawMatchUps)==null?void 0:N.find(E=>E.matchUpId===l),f=(h==null?void 0:h.drawPositions)??[],{positionAdded:g,positionAssigned:v,updatedDrawPositions:y}=Qse({drawPositions:f,drawPosition:o}),{positionAssignments:I}=ai({drawDefinition:n,structure:m}),b=(A=I==null?void 0:I.filter(E=>y.includes(E.drawPosition)))==null?void 0:A.find(({bye:E})=>E),S=(h==null?void 0:h.matchUpStatus)&&[zt,Mt].includes(h.matchUpStatus)&&y.filter(Boolean).length<2;if(a=b&&Vt||a||S&&h.matchUpStatus||(h==null?void 0:h.matchUpStatus)&&[er,cr].includes(h.matchUpStatus)&&h.matchUpStatus||Ji,h&&g){t=mr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[];let E=S&&OU({inContextDrawMatchUps:t,drawPosition:o,matchUpId:l})||void 0;h!=null&&h.matchUpStatusCodes&&dq({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:s,matchUp:h}),Object.assign(h,{drawPositions:y,winningSide:E,matchUpStatus:a}),Rt({tournamentId:i==null?void 0:i.tournamentId,eventId:d==null?void 0:d.eventId,context:c,drawDefinition:n,matchUp:h})}let w=En({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:U,loserMatchUp:T,loserTargetDrawPosition:D},targetLinks:{loserTargetLink:P}}=w,C=Fd({structureId:m.structureId,matchUpsMap:s});if(v&&b){if(U)if([Vt,er,cr].includes(a)){let E=$f({matchUpId:U.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(E.error)return E}else{let{structureId:E}=U;E!==m.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(U&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:E}=uq({targetMatchUp:h,drawPosition:o,matchUpsMap:s,structure:m});if(E){let O=$f({matchUpId:U.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(O.error)return O}}if((h==null?void 0:h.matchUpType)===hi){let E=t==null?void 0:t.find(({matchUpId:x})=>x===h.matchUpId),O=((E==null?void 0:E.sides)??[]).reduce((x,F,$)=>F.drawPosition===o?$:x,void 0),k=(M=I==null?void 0:I.find(x=>x.drawPosition===o))==null?void 0:M.participantId;k&&O!==void 0&&QA({inContextTargetMatchUp:E,drawPositionSideIndex:O,teamParticipantId:k,tournamentRecord:i,drawDefinition:n,matchUp:h})}if((P==null?void 0:P.linkCondition)===el&&y.filter(Boolean).length===2&&!b&&C.filter(({drawPositions:E,roundNumber:O})=>O===1&&Rn(E,y)).every(({matchUpStatus:E})=>[qi,mn].includes(E))&&T){let{structureId:E}=T,O=Ya({drawPosition:D,tournamentRecord:i,drawDefinition:n,structureId:E,matchUpsMap:s,event:u});if(O.error)return O}return v?{...J}:ee({result:{error:Sf},context:{drawPosition:o},stack:c})}function pq({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){var c,d,p,m;let a=((p=(d=(c=Fg({drawDefinition:e}))==null?void 0:c.containedStructures)==null?void 0:d[n.structureId])==null?void 0:p.map(({structureId:h})=>h))||[];a.push(n==null?void 0:n.structureId);let o=(i==null?void 0:i.map(({drawPosition:h})=>h))||[],s=(t==null?void 0:t.filter(h=>a.includes(h.structureId)&&Vi(h.drawPositions??[],o).length))??[],l=s.map(({matchUpId:h})=>h),u=((m=r==null?void 0:r.drawMatchUps)==null?void 0:m.filter(h=>l.includes(h.matchUpId)))??[];return{drawPositions:o,matchUps:u,targetMatchUps:s}}function eO({lineUp:t}){if(!Array.isArray(t))return;let e={};return ct(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:o}=TS({collectionPosition:a,collectionId:r,lineUp:t});o.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function $d(t){return`${t} must be an array`}function $T({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push($d("lineUp")),{valid:!1,errors:i,error:oe};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:o,collectionAssignments:s}=a;return o?typeof o!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push($d("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=ct(t.map(Ut)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?oe:void 0}}function lh({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:_e};if(typeof e!="string")return{error:pr};let n=$T({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=gt({element:t,name:Uu}),o=(a==null?void 0:a.value)||{};return o[e]=eO({lineUp:r}),Lt({element:t,extension:{name:Uu,value:o}}),jy({drawDefinition:t}),{...J}}function tO({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:o,event:s}){if(!r)return{error:_e};let{drawPositions:l,matchUps:u,targetMatchUps:c}=pq({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:o});for(let d of c)d.matchUpType===ka&&(d.sides??[]).forEach((p,m)=>{var h;if(p!=null&&p.drawPosition&&(l!=null&&l.includes(p.drawPosition))){let f=u.find(({matchUpId:g})=>g===d.matchUpId);if((h=f==null?void 0:f.sides)!=null&&h[m]){if(delete f.sides[m].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&lh({drawDefinition:r,participantId:v,lineUp:[],tieFormat:g})}Rt({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:r,matchUp:f})}}});return{...J}}function il({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){var P,C,R,N,A;let m="assignDrawPosition";if(!s&&!i)return ee({result:{error:pr},stack:m});c=c??sn({drawDefinition:a}),e||({matchUps:e}=mr({inContext:!0,drawDefinition:a,matchUpsMap:c}));let h=et({drawDefinition:a,structureId:d});if(h.error)return ee({result:h,stack:m});let{structure:f}=h;if(!f)return{error:Ei};if(zn({structure:f}))return ee({result:{error:aa},stack:m});let{seedAssignments:g}=po({provisionalPositioning:t,drawDefinition:a,structure:f}),v=(P=g==null?void 0:g.find(M=>M.participantId===s))==null?void 0:P.seedNumber,{appliedPolicies:y}=$t({tournamentRecord:n,drawDefinition:a,structure:f,event:p});if(v&&!CS({seedNumber:v,appliedPolicies:y,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return ee({result:{error:aN},context:{drawPosition:u},stack:m});let I=Rr({structure:f}).positionAssignments||[],b=I==null?void 0:I.find(M=>M.drawPosition===u);if(!b)return ee({result:{error:Sg},context:{drawPosition:u},stack:m});if(I!=null&&I.map(Ut).includes(s))return ee({result:{error:Rg},context:{drawPosition:u},stack:m});let{containsParticipant:S,containsBye:w}=D(b);if(w){let M=ab({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(M.error)return ee({result:M,stack:m})}if(S&&b.participantId!==s){let{activeDrawPositions:M}=nb({drawDefinition:a,structureId:d});if(M.includes(u))return ee({result:{error:$0},stack:m});tO({assignments:[b],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:f})}if(b.participantId=s,i&&(b.qualifier=!0),f.stage===Oe&&(!f.stageSequence||f.stageSequence>1)||f.stage&&[rn,$i].includes(f.stage)){let M=f.stage===Ye?Ye:Oe,E=(((R=(C=a.structures)==null?void 0:C.find(O=>(O==null?void 0:O.stage)===M&&(O==null?void 0:O.stageSequence)===1))==null?void 0:R.seedAssignments)??[]).find(O=>O.participantId===s);if(E!=null&&E.participantId){let{participantId:O,seedNumber:k,seedValue:x}=E;Vg({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:O,seedNumber:k,seedValue:x,structureId:d,event:p})}}if(f.structureType!==xn)ele({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:f,event:p});else{HW({positionAssignments:I,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:f});let{drawPositions:M,matchUps:E,targetMatchUps:O}=pq({assignments:[b],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:f});if(M&&(E==null?void 0:E.length)===1&&E[0].matchUpType===hi){let k=((O==null?void 0:O[0].sides)??[]).reduce((x,F,$)=>M!=null&&M.includes(F.drawPosition)?$:x,void 0);QA({inContextTargetMatchUp:O[0],teamParticipantId:s,matchUp:E[0],drawPositionSideIndex:k,tournamentRecord:n,drawDefinition:a})}}let U=(N=a.entries)==null?void 0:N.find(M=>M.participantId===s),T=(A=p==null?void 0:p.entries)==null?void 0:A.find(M=>M.participantId===s);return!U&&T&&jA({entryStatus:T.entryStatus,entryStage:f.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:s,event:p}),Pc({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:f,event:p}),{positionAssignments:I,...J};function D(M){let E=M.bye,O=M.qualifier,k=M.participantId;return{containsBye:E,containsQualifier:O,containsParticipant:k,filled:E||O||k}}}function ele({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=Wt({provisionalPositioning:t,matchUpFilters:u,drawDefinition:n,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:d}=Cn({matchUps:c}),{initialRoundNumber:p}=Um({drawPosition:a,matchUps:c}),m=p&&(d==null?void 0:d[p].find(h=>{var f;return(f=h.drawPositions)==null?void 0:f.includes(a)}));if(m){let h=$f({matchUpId:m.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o});if(h.error)return ee({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:h})}return{...J}}function iO(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:_e};let d=$t({tournamentRecord:n,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:m}=t;m||(m=sn({drawDefinition:a}),Object.assign(t,{matchUpsMap:m})),p||({matchUps:p}=mr({inContext:!0,drawDefinition:a,matchUpsMap:m}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:h}=ai({drawDefinition:a,structureId:l}),f=h==null?void 0:h.find(b=>b.drawPosition===s);if(f!=null&&f.participantId){let b=f.participantId,S=il({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:u});return S.success?I({appliedPolicies:d,removedParticipantId:b}):ee({result:S,stack:c})}let g=ab({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:m,event:u});if(g.error)return ee({result:g,stack:c});let v=g.participantId,y=il({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:u});if(!y.success)return ee({result:y,stack:c});return I({appliedPolicies:d,removedParticipantId:v});function I({appliedPolicies:b,removedParticipantId:S}){let{structure:w}=et({drawDefinition:a,structureId:l});DA({drawPositions:[s],structure:w});let U={[e]:o,name:r,drawPosition:s,structureId:l};return DT({appliedPolicies:b,drawDefinition:a,positionAction:U}),ee({context:{removedParticipantId:S},result:{...J},stack:c})}}function tle({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return iO({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function mq(t){return tle(t)}function hq({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let o of i.matchUps)e[o.matchUpId]&&(o.roundNumber=e[o.matchUpId],Rt({tournamentId:r==null?void 0:r.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:n,matchUp:o}))}function fq(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=ze(t,i);if(r.error)return r;let n=et(t);if(n.error)return n;let a=n.structure;if(!zn({structure:a}))return ee({result:{error:op,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=Cn({matchUps:a==null?void 0:a.matchUps});return s!=null&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Bu}}function gq(t){var c;let e=fq(t,[{targetRoundNumber:!0,roundNumber:!0,[Xn]:qae}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e,{targetRoundNumber:a,roundNumber:o}=t;if(!(n!=null&&n.includes(o))||!(n!=null&&n.includes(a)))return ee({result:{error:oe},info:"roundNumbers must be valid rounds"});let s=a>o,l=s?Se(o+1,a+1):Se(a,o),u={};return l.forEach(d=>((r==null?void 0:r[d])??[]).forEach(({matchUpId:p})=>{u[p]=d-(s?1:-1)})),(c=r==null?void 0:r[o])==null||c.forEach(({matchUpId:d})=>u[d]=a),hq({params:t,modMap:u,structure:i}),{...J}}function vq({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){var s;if(!r)return{error:_e};if(!Array.isArray(t))return{error:oe};let a="setPositionAssignments";for(let l of t){let{structureId:u,positionAssignments:c}=l;if(!c)continue;let d=et({drawDefinition:r,structureId:u});if(d.error)return d;let p=d.structure;if(!p)return{error:Ei};let m=(s=ai({structure:p}).positionAssignments)==null?void 0:s.map(({drawPosition:v})=>v),h=c==null?void 0:c.map(({drawPosition:v})=>v);if(Vi(m,h).length!==(m==null?void 0:m.length))return ee({result:{error:oe},info:"drawPositions do not match",stack:a});let f=sn({drawDefinition:r}),{matchUps:g}=mr({inContext:!0,drawDefinition:r,matchUpsMap:f});for(let v of c||[]){let{drawPosition:y,participantId:I,bye:b,qualifier:S}=v;if(b){let w=Ya({tournamentRecord:i,drawDefinition:r,drawPosition:y,matchUpsMap:f,structureId:u,structure:p,event:n});if(w!=null&&w.error)return w}else if(S)c.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(I){let w=il({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:r,participantId:I,drawPosition:y,matchUpsMap:f,structureId:u,event:n});if(w!=null&&w.error)return w}}Pc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:p,event:n})}let o=t.map(({structureId:l})=>l);return si({tournamentId:i==null?void 0:i.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:r,structureIds:o}),{...J}}function Iq(t){let e=fq(t,[{roundNumbers:!0,[Xn]:un,[Kr]:o=>o.length===2&&o.every(Li)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(o=>n==null?void 0:n.includes(o)))return ee({result:{error:oe,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((o,s)=>((r==null?void 0:r[o])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-s]})),hq({params:t,modMap:a,structure:i}),{...J}}function ile({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return iO({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function yq(t){return ile(t)}function bq({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return iO({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function wq({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:o}){if(!i)return{error:_e};if(!n)return{error:za};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===r);if(e&&!s)return{error:Ss};let{structure:l}=et({drawDefinition:i,structureId:n});if(!l)return{error:Ei};if(!(!t||Li(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Li(p)&&Ze(p)>0)))return{error:oe};let{seedAssignments:u}=po({drawDefinition:i,structure:l}),c=u==null?void 0:u.map(p=>p.seedNumber),d=u==null?void 0:u.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(m=>parseInt(m)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return uW({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:i,structure:l}),{...J}}function Uq({drawDefinition:t,structureId:e}){if(!t)return{error:_e};let{structure:i}=et({drawDefinition:t,structureId:e}),r=((t==null?void 0:t.links)||[]).filter(n=>{var a;return((a=n.source)==null?void 0:a.structureId)===e}).map(n=>{var a;return(a=n.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(n=>r.includes(n.structureId)),structure:i}}function BT({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:o}){if(!a)return{error:gi};let s={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=Zo({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:r,stages:n,stage:o});if(l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function rO({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:o}){if(!e)return{error:ge};let s={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=BT({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:u,stage:o});if(c&&l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function Cc(t){if(!(t!=null&&t.drawDefinition))return!1;let e=xT(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r==null?void 0:r.filter(({matchUpType:o})=>o===hi),n=n==null?void 0:n.filter(({matchUpType:o})=>o===hi),a=a==null?void 0:a.filter(({matchUpType:o})=>o===hi)),!!(r!=null&&r.length&&!(n!=null&&n.length)&&!(a!=null&&a.length))}function nO(t){var o,s;let{drawDefinition:e,structureId:i}=t;if(!e)return{error:_e};let{playoffStructures:r}=Uq({drawDefinition:e,structureId:i});if(!(r!=null&&r.length))return!1;let n=((s=(o=e==null?void 0:e.entries)==null?void 0:o.filter(l=>(l==null?void 0:l.entryStatus)&&ss.includes(l.entryStatus)))==null?void 0:s.length)??0,a=0;return(r||[]).reduce((l,u)=>{var c;return!!((c=ai({structure:u}).positionAssignments??[])!=null&&c.filter(d=>(d.participantId&&a++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!r.length)||a===n}function _E({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i!=null&&i[n]){let o=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(s=>{let l=_E({accessors:o,significantCharacters:t,value:s});r.push(...l)});else if(i=i[n],o.length){let s=_E({accessors:o,significantCharacters:t,value:i});r.push(...s)}else a({value:i})}function a({value:o}){if(o&&["string","number"].includes(typeof o)){let s=t?o.slice(0,t):o;r.push(s)}}return r}function rle({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:fN};if(!Array.isArray(r))return{error:Cy};let n={};return t.forEach(a=>{let o=r.find(l=>l.participantId===a),{values:s}=Sq({policyAttributes:e,idCollections:i,participants:r,participant:o});s&&s.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function Sq({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:fN};if(!r)return{error:jm};let n=[];return t.forEach(a=>{let{directive:o,groupings:s,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");n.push(..._E({significantCharacters:u,value:r,accessors:c}))}else if(o){let c=a==null?void 0:a.includeIds,d=((e==null?void 0:e[o])||[]).filter(p=>!c||c.includes(p));d!=null&&d.length&&(i!=null&&i.length)&&d.forEach(p=>{var h;let m=i.find(f=>f.participantId===p);if((h=m==null?void 0:m.individualParticipantIds)!=null&&h.includes(r.participantId)){let f=m==null?void 0:m.participantId;n.push(f)}})}else s&&Object.keys(s).forEach(c=>{s[c].includes(r.participantId)&&n.push(c)})}),{values:ct(n)}}function EB({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let o=n[a.participantId],{values:s}=Sq({participants:e,policyAttributes:i,idCollections:r,participant:o});return{...a,values:s}})}function Tq({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r==null?void 0:r.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,o=t?t[a]||[]:[],s=!!i.some(l=>o.includes(l));return{[n]:{participantGroups:o,includesGroupsToAvoid:s}}}))}function nle(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=Tq(t);return i.map(a=>{let o=e.filter(u=>a.includes(u)),s=n(o),l=o.filter(u=>!s.includes(u)).filter(u=>{var d;let c=MB(u);return!((d=r[c])!=null&&d.includesGroupsToAvoid)});return{unassigned:o,unpaired:s,pairedNoConflict:l}});function n(a){return a.filter(s=>!o(s));function o(s){let l=MB(s);return!a.includes(l)}}}function ale(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=Tq(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),o=a.length===n.length?a:[],s=n.filter(l=>{var u;return(u=r[l])==null?void 0:u.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:o,pairedNoConflict:s?[]:a,conflictsCount:s}})}function MB(t){return Number(t%2?t+1:t-1)}function ole({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function sle({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let o=r.map(s=>a?ale({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):nle({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:u}}else{let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length);return{unassigned:s,unpaired:l,pairedNoConflict:u}}}function Dq({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function lle({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){var u;let a=Object.assign({},...Object.keys(r).map(c=>[c,r[c].filter(d=>e.includes(d))]).filter(c=>c[1].length).map(([c,d])=>({[c]:d}))),o=Object.keys(a).reduce((c,d)=>a[d].length>c?a[d].length:c,0),s=Object.keys(a).filter(c=>a[c].length===o),l=pa(i?s:Object.keys(a));return n=t&&((u=a[n])!=null&&u.length)?n:l,{participantId:n&&a[n]?pa(a[n]):pa(e),groupKey:n}}function ule({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function cle({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:o,groupKey:s}){let l=n.reduce((T,D)=>D.length>T?D.length:T,0)<=2,u=Dq({positionAssignments:t,participantIds:e}),c=ule({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=lle({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:o,groupKey:s}),m=ole({participantId:d,allGroups:o}),h=sle({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:m,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:c}),{unassigned:f,unpaired:g,pairedNoConflict:v}=h,y=(v==null?void 0:v.length)&&v[0],I=(g==null?void 0:g.length)&&g[0],b=a&&y?y:I,S=a?I:y,w=(b==null?void 0:b.length)&&b||(S==null?void 0:S.length)&&S,U;if(w!=null&&w.length){let T=fa(w);U=fa(T)}else{let T=fa(f[0]);U=fa(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:U}}function ES({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(s=>s.drawPosition),a=KA({drawPositions:n}).uniqueMatchUpGroupings??[],o=Object.assign({},...r.map(s=>({[s.drawPosition]:s})));a.forEach(s=>{Rn(o[s[0]].values||[],o[s[1]].values||[])&&(i.push(s),r.conflict=!0)})}):e.forEach(r=>{var n,a;Rn(((n=r[0])==null?void 0:n.values)||[],((a=r[1])==null?void 0:a.values)||[])&&(i.push(r),r.conflict=!0)}),i}function dle({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.map(a=>{let o=a.map(s=>s.drawPosition);return a.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(u=>!(o!=null&&o.includes(u))).filter(u=>{let c=i.find(f=>f.includes(u)).find(f=>f!==u),d=t.find(f=>f.drawPosition===c),p=ES({isRoundRobin:n,groupedParticipants:[[s,d]]}),m=[t.find(f=>f.drawPosition===u),d],h=ES({isRoundRobin:n,groupedParticipants:[m]});return!p.length&&!h.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function NB(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(I=>I==null?void 0:I.length).filter(Boolean)),p=d>2,m=Me(e,!1,!0).filter(I=>!I.qualifier),h=e.filter(I=>!I.participantId&&(!I.bye||(n==null?void 0:n.includes(I.drawPosition)))).map(I=>I.drawPosition);Se(0,r).forEach(()=>{let{newGroupKey:I,selectedParticipantId:b,targetDrawPosition:S}=cle({...t,candidatePositionAssignments:m,allGroups:l,groupKey:c});c=I,m.forEach(w=>{w.drawPosition===S&&(w.participantId=b)})});let f=EB({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Pr(f,d),v=ES({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let I=dle({positionedParticipants:f,potentialDrawPositions:h,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(I.length){let b=ple({candidatePositionAssignments:m,swapOptions:I});b.error&&console.log({result:b}),f=EB({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Pr(f,d),v=ES({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return m.forEach(I=>{if(I.bye&&I.participantId){let b=hE;u.push(b)}if(I.qualifier&&I.participantId){let b=hE;u.push(b)}}),{positionAssignments:m,conflicts:v.length,groupedParticipants:g,errors:u}}function ple({candidatePositionAssignments:t,swapOptions:e}){let i=fa(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=fa(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===r),o=t.find(u=>u.drawPosition===n)??{},s={participantId:o==null?void 0:o.participantId,qualifier:o==null?void 0:o.qualifier,bye:o==null?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...J}}function mle({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){var $;if(!c)return{error:FG};let{candidatesCount:m=1,policyAttributes:h,targetDivisions:f}=c,{roundsToSeparate:g}=c,v="randomUnseededSeparation",{structure:y}=et({drawDefinition:a,structureId:u}),{matchUps:I}=Wt({provisionalPositioning:t,matchUpsMap:l,structure:y,event:p});if(f&&Us(f)&&!g){let _=ine(f)||0,L=I.reduce((B,V)=>V.roundNumber>B?V.roundNumber:B,0);g=L<_?1:L-_+1}let{positionAssignments:b}=Rr({structure:y}),S=PA({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,w=b==null?void 0:b.filter(_=>!_.participantId),U=b==null?void 0:b.map(_=>_.drawPosition),T=(y==null?void 0:y.structureType)===xn,D=T?{structure:y,matchUps:I,allDrawPositions:U,roundsToSeparate:g}:{matchUps:I,allDrawPositions:U,roundsToSeparate:g},{drawPositionGroups:P,drawPositionChunks:C}=T?hle(D):fle(D),R={groupParticipants:s.filter(_=>_.participantType===Wa).map(_=>_.participantId),teamParticipants:s.filter(_=>_.participantType===Kt).map(_=>_.participantId),pairParticipants:s.filter(_=>_.participantType===ht).map(_=>_.participantId)},N=rle({targetParticipantIds:e,policyAttributes:h,idCollections:R,participants:s});if(N.error)return ee({result:N,stack:v});let A=Object.assign({},...e.map(_=>{let L=Object.keys(N).filter(B=>(N[B]??[]).includes(_));return{[_]:L}})),M=Dq({participantIds:e,positionAssignments:b});if(M.length>((w==null?void 0:w.length)||0))return{error:bN};let E,O=M.length,k=Se(0,m).map(()=>NB({initialPositionAssignments:b,participantsWithGroupings:S,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:r,participantIdGroups:A,drawPositionChunks:C,drawPositionGroups:P,policyAttributes:h,idCollections:R,allGroups:N,drawSize:d}));if(E=k.reduce((_,L)=>!_||(L.conflicts||0)<(_.conflicts||0)?L:_,void 0),!E||E.conflicts){let _=Se(0,m).map(()=>NB({initialPositionAssignments:b,participantsWithGroupings:S,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:r,participantIdGroups:A,drawPositionChunks:C,drawPositionGroups:P,policyAttributes:h,idCollections:R,allGroups:N,drawSize:d}));E=k.concat(..._).filter(L=>{var B;return!((B=L.errors)!=null&&B.length)}).reduce((L,B)=>!L||(B.conflicts||0)<(L.conflicts||0)?B:L,void 0)}if(!E)return{error:Y0};let x=((($=ai({structure:y}))==null?void 0:$.positionAssignments)??[]).filter(_=>_.participantId).map(_=>_.participantId),F=E.positionAssignments.filter(_=>!x.includes(_.participantId));for(let _ of F)if(_.bye){let L=Ya({tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,..._});if(L.error)return ee({result:L,stack:v})}else if(_.participantId){let L=il({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,..._});if(L.error)return ee({result:L,stack:v,context:{assignment:_}})}return{...J}}function hle(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function fle({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),n=r.flat().sort(or),a=Math.max(...n),o=t.filter(c=>c>a),s=n.length,l=Se(s===2?1:2,s).filter(c=>c===rN(c)),u=l.slice(0,e||l.length).reverse().map(c=>Pr(n,c));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:r,drawPositionChunks:u}}function gle({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){var D,P;let m="positionUnseededParticipants";c||({structure:c}=et({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:h}=Rr({structure:c}),{seedAssignments:f}=po({provisionalPositioning:t,drawDefinition:a,structure:c}),g=f==null?void 0:f.map(C=>C.participantId).filter(Boolean),{stage:v,stageSequence:y}=c,I=v===Ye?(P=(D=gt({element:c,name:fl}))==null?void 0:D.extension)==null?void 0:P.value:void 0,b=Jm({provisionalPositioning:t,drawDefinition:a,stageSequence:y,entryStatuses:hp,structureId:u,roundTarget:I,stage:v}),S=b.filter(C=>!(g!=null&&g.includes(C.participantId))).map(C=>C.participantId),w=h==null?void 0:h.filter(C=>!C.participantId&&!C.bye&&!C.qualifier).map(C=>C.drawPosition);if(!r&&S.length>((w==null?void 0:w.length)||0))return ee({result:{error:bN},context:{unseededParticipantsCount:S.length,unfilledDrawPositionsCount:w==null?void 0:w.length},stack:m});let{appliedPolicies:U}=$t({tournamentRecord:n,drawDefinition:a,event:p}),T=U==null?void 0:U[vS];if(c.stage===$i){let C=b.reduce((R,N)=>(R[N.groupingValue]||(R[N.groupingValue]=[]),R[N.groupingValue].push(N.participantId),R),{});Object.keys(C).length&&(T||(T={policyName:"Playoff Avoidance"}),T.policyAttributes||(T.policyAttributes=[]),T.policyAttributes.push({groupings:C}))}return T&&s?mle({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:T,drawSize:d,entries:b}):vle({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unfilledDrawPositions:w,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function vle({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?wn(r):r.reverse();for(let m of e){let h=p.pop();if(!n||h){let f=il({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:m,drawPosition:h,matchUpsMap:l,structureId:u,event:d});if(f!=null&&f.error&&console.log("!!!!!",{result:f}),f==null?void 0:f.error)return ee({result:f,stack:"randomUnseededDistribution"})}}return{...J}}function Ile(t){let e=t.structure??et(t).structure,i="positionQualifiers",r=[];if(e.stage===rn)return ee({result:{error:lp},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:o}=yle(t);for(let s of Object.keys(n)){let l=a==null?void 0:a.filter(u=>o[s].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(n[s]>(l||0))return ee({result:{error:tH},context:{unfilledDrawPositions:l},stack:i});Se(0,n[s]).forEach(()=>{let u=fa(l);r.push(u),a==null||a.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...J,qualifierDrawPositions:r}}function yle({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=et({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=Rr({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:o,roundQualifiersCounts:s}=$g({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(s?Object.keys(s):[]).map(f=>Ze(f)),{matchUps:u}=Wt({structure:e}),{roundProfile:c}=Cn({matchUps:u}),d=Object.assign({},...l.filter(f=>c==null?void 0:c[f]).map(f=>{var g,v;return{[f]:((v=(g=c==null?void 0:c[f])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=r==null?void 0:r.filter(f=>f.qualifier).map(f=>f.drawPosition),m=o-((p==null?void 0:p.length)??0),h=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(f=>{let g=r==null?void 0:r.filter(v=>{var y,I;return v.qualifier&&((I=(y=d[f])==null?void 0:y.drawPositions)==null?void 0:I.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[f]:((s==null?void 0:s[f])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:m,placedQualifiersCount:h,roundQualifiersCounts:s,positionAssignments:r,roundDrawPositions:d,qualifiersCount:o}}function AB({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:m}){let h=[],f=[],g=0;if(p||({structure:p}=et({drawDefinition:a,structureId:c})),c||(c=p==null?void 0:p.structureId),r||(r=$t({drawDefinition:a}).appliedPolicies),!n){let v=p&&sh({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:o,structure:p});v!=null&&v.error&&f.push(v.error),n=v==null?void 0:v.validSeedBlocks}return u=u??(n==null?void 0:n.length)??0,Se(0,u).forEach(()=>{if(g<(u||0)){let v=ble({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:c,matchUpsMap:d,event:m});v!=null&&v.success&&(g++,h.push(...v.seedPositions??[])),v.error&&f.push({seedPositionError:v.error})}}),f.length?{error:f}:{...J,seedPositions:h}}function ble({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=lq({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:s,event:u}),{appliedPolicies:p}=$t({drawDefinition:r}),{avoidance:m}=p??{};m&&o&&(c==null?void 0:c.length)>2;let h=[];for(let f of c){let g=d.pop();if(!g)return{error:Tg};h.push(g);let v=il({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:f,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:s,event:u});if(!v.success)return v}return{...J,seedPositions:h}}function wle({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=Rr({structure:i}),{seedAssignments:n}=po({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(o=>o.participantId).map(o=>({[o.participantId]:o})));return r==null?void 0:r.map(o=>a[o.participantId]?{...o,seedNumber:a[o.participantId].seedNumber,seedValue:a[o.participantId].seedValue}:"").filter(Boolean)}function Ule({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>{if(i-r.length>a.drawPositions.length)r.push(...a.drawPositions);else{let o=$E(Pr(a.drawPositions,2)),s,l=t[r.length];for(;s=kU(o,l);)r.push(s),l=t[r.length]}});let n=r.map(a=>Array.isArray(a)?wn(a):a).flat(1/0);return nG(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function kU(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return kU(e?n:t[Math.round(Math.random())],e)}return i<r?kU(t[1],e):kU(t[0],e)}function $E(t){let e=Math.floor(t.length/2);return t.length>2?[$E(t.slice(0,e)),$E(t.slice(e))]:t}function Sle({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:o,structure:s}){var b;a||(a=sh({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:s}));let{isFeedIn:l,isLuckyStructure:u,isContainer:c}=a,{validSeedBlocks:d}=a;(b=i==null?void 0:i.seeding)!=null&&b.containerByesIgnoreSeeding&&(d=[]);let p=wle({provisionalPositioning:t,drawDefinition:r,structure:s})??[],m=ct([].concat(...e.map(S=>S.drawPositions))),h=p.filter(S=>m.includes(S.drawPosition)),f=(S,w)=>_f(S.seedValue)-_f(w.seedValue),g=d.reduce((S,w)=>{let U=h.filter(T=>{var D;return(D=w.drawPositions)==null?void 0:D.includes(T.drawPosition)}).sort(f);return S.concat(...U)},[]).map(S=>S.drawPosition),v=Ule({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:o}),y=OB({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,o),I=OB({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,o);return{strictSeedOrderByePositions:y,blockSeedOrderByePositions:I,isLuckyStructure:u,positionedSeeds:p,isContainer:c,isFeedIn:l}}function OB({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r==null?void 0:r.sort((n,a)=>n-a)).filter(r=>(r==null?void 0:r[0])+1===(r==null?void 0:r[1]));return t.map(r=>i.find(n=>n==null?void 0:n.includes(r))).filter(Boolean).map(r=>r==null?void 0:r.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function Tle({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:o,isFeedIn:s}){var M,E;let l=(M=r==null?void 0:r.seeding)==null?void 0:M.seedingProfile,u=o.stage===Ye,{positionAssignments:c}=Rr({structure:o}),d=c==null?void 0:c.filter(O=>O.participantId).map(O=>O.drawPosition),p={isCollectionMatchUp:!1},{matchUps:m,roundMatchUps:h}=Wt({provisionalPositioning:t,matchUpFilters:p,structure:o}),f=(h==null?void 0:h[1])||[],g=o.structureType===xn?m:f,v=ct([].concat(...g.map(O=>O.drawPositions))),y=Math.min(...v)-1,I=d==null?void 0:d.filter(O=>v.includes(O)),b=O=>{let k=Math.ceil(O.length/2),x=[O.slice(0,k),O.slice(k)],F=x.map(z=>[].concat(...z.flat(1/0)).length),$=Math.min(...F.flat(1/0)),_=Math.max(...F.flat(1/0)),L=F.indexOf(_),B=$!==_,V=wn(x),[G,j]=!$||B?[x[L],x[1-L]]:[V[0],V[1]];return{greaterHalf:G,lesserHalf:j}},S=O=>{let{greaterHalf:k,lesserHalf:x}=b(O),{greaterHalf:F,lesserHalf:$}=b(k),_=wn(F.flat(1/0)).pop(),L=F.flat().filter(B=>B!==_);return{newlyFilteredChunks:[...x,...$,L],drawPosition:_}},w=O=>!e.includes(O),U=O=>!(I!=null&&I.includes(O)),T=O=>{let k=Pr(O.sort(or),Math.ceil(O.length/4)).map($=>$.filter(U)),x=[].concat(...k.flat(1/0)).length,F=[];for(let $=0;$<x;$++){let{newlyFilteredChunks:_,drawPosition:L}=S(k);F.push(L),k=_}return F},{validSeedBlocks:D}=sh({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:o}),P=D==null?void 0:D.map(O=>{var k;return(k=O.drawPositions)==null?void 0:k.map(x=>x+y)}),C;if(s){let O=v.length,{seedBlocks:k}=XA({cluster:db(l)===VN,participantsCount:O});C=k.map(x=>x.map(F=>F+y)).map(T).filter(x=>x.length)}else u?C=P==null?void 0:P.map(O=>O.filter(U)):C=P==null?void 0:P.map(T).filter(O=>O.length);let R=g.map(O=>O.drawPositions).map(O=>O==null?void 0:O.sort((k,x)=>k-x)).filter(O=>(O==null?void 0:O[0])+1===(O==null?void 0:O[1])),N=O=>R.reduce((k,x)=>x.includes(O)?x.reduce((F,$)=>$!==O?$:F,void 0):k,void 0),A=C.map(O=>O.map(N)).flat(1/0).filter(U).filter(w).filter(Boolean);if(u&&!o.structures){let O=a%4,k=A.slice(0,O),x=(E=h[o.roundLimit])==null?void 0:E.length,F=Pr(A.slice(O),x).map(wn).flat();A=k.concat(F)}return{unseededByePositions:A}}function Dle({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){var P;let a={isCollectionMatchUp:!1},{matchUps:o,roundMatchUps:s}=Wt({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:r,event:n}),l=(s==null?void 0:s[1])||[],u=(r==null?void 0:r.structureType)===xn,c=u?o:l,d=u?((P=r==null?void 0:r.structures)==null?void 0:P.length)||0:o.length,{structureId:p,stage:m,stageSequence:h}=r,f=Jm({entryStatuses:ss,provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:m}),{qualifiersCount:g}=$g({provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:m}),v=f.length+g,{positionAssignments:y,unassignedPositions:I}=Rr({structure:r}),b=I==null?void 0:I.map(C=>C.drawPosition),S=y==null?void 0:y.filter(C=>C.bye).length,w=y==null?void 0:y.filter(C=>C.bye).map(C=>C.drawPosition),U=c.map(C=>C.drawPositions).filter(C=>C==null?void 0:C.reduce((R,N)=>!(w!=null&&w.includes(N))&&R,!0)).flat(1/0).filter(C=>b==null?void 0:b.includes(C)),T=y==null?void 0:y.length,D=T?T-v:0;return D>d&&r.stageSequence===1&&r.stage!==rn&&(D=d),{placedByes:S,byesCount:D,relevantMatchUps:c,placedByePositions:w,roundMatchUps:s,positionsToAvoidDoubleBye:U}}function kB({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:u,seedsOnly:c,event:d}){var R;l||({structure:l}=et({drawDefinition:r,structureId:s})),s||(s=l==null?void 0:l.structureId);let p=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===Ye),{byesCount:m,placedByes:h,relevantMatchUps:f}=Dle({provisionalPositioning:t,drawDefinition:r,matchUpsMap:o,structure:l,event:d}),g=m-(h||0);if(g<=0)return{...J};let{strictSeedOrderByePositions:v,blockSeedOrderByePositions:y,isLuckyStructure:I,isFeedIn:b}=Sle({provisionalPositioning:t,relevantMatchUps:f,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:l}),S=(l==null?void 0:l.structureType)&&[xn,oT].includes(l.structureType)&&((R=i==null?void 0:i.seeding)==null?void 0:R.containerByesIgnoreSeeding),w=p&&(y!=null&&y.length)?y:v,{unseededByePositions:U}=Tle({provisionalPositioning:t,seedOrderByePositions:w,isLuckyStructure:I,appliedPolicies:i,drawDefinition:r,seedLimit:u,structure:l,isFeedIn:b}),T=N=>N%2,D=(N,A)=>(N||[]).every(M=>T(M)?A!==M+1:A!==M-1),P=[].concat(...w);if(!c)for(;U.length;){let N=U.find(A=>D(P,A));N?(P.push(N),U=U.filter(A=>A!==N)):(P.push(...U),U=[])}S&&(P=wn(P),Fa({ignoreSeededByes:S})&&console.log({byePositions:P}));let C=P.slice(0,g);for(let N of C){let A=Ya({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:d});if(A!=null&&A.error)return A}return{...J,unseededByePositions:U,byeDrawPositions:C}}function pb(t){var M,E,O,k;let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:o,placementGroup:s,seedingProfile:l,structureId:u,seedLimit:c,seedsOnly:d,drawType:p,drawSize:m,event:h}=t,f=[];i||(TH(),e=Me(e,!1,!0));let g=x=>(i||PU(),ee({result:x,stack:"automatedPositioning"})),v=x=>(i||PU(),x),y=et({drawDefinition:e,structureId:u});if(y.error)return g(y);let I=y.structure;if(!I)return{error:Ei};let b=t.appliedPolicies||((M=$t({drawDefinition:e,structure:I,event:h}))==null?void 0:M.appliedPolicies),{qualifiersCount:S}=$g({stageSequence:I.stageSequence,provisionalPositioning:r,stage:I.stage,drawDefinition:e,structureId:u}),w=hp;if(!((E=Jm({stageSequence:I.stageSequence,provisionalPositioning:r,stage:I.stage,placementGroup:s,drawDefinition:e,entryStatuses:w,structureId:u}))!=null&&E.length)&&!S)return v({...J});let U=t.matchUpsMap??sn({drawDefinition:e}),T=t.inContextDrawMatchUps??((O=mr({inContext:!0,drawDefinition:e,matchUpsMap:U}))==null?void 0:O.matchUps),D=[],P=sh({provisionalPositioning:r,appliedPolicies:b,drawDefinition:e,seedingProfile:l,structure:I});if(P.error)return P;let{validSeedBlocks:C}=P;f.push({validSeedBlocks:C});let R=t.participants||(o?(k=Mi({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:o}))==null?void 0:k.participants:[]);if(db(I.seedingProfile||l)===Nd){let x=a?kB({provisionalPositioning:r,tournamentRecord:o,appliedPolicies:b,drawDefinition:e,seedBlockInfo:P,matchUpsMap:U,structure:I,seedLimit:c,seedsOnly:d,event:h}):void 0;if(x!=null&&x.error)return g(x);D=x.unseededByePositions,f.push({action:"positionByes",unseededByePositions:D});let F=I.seedingProfile?{positioning:I.seedingProfile}:l;if(x=AB({seedingProfile:F,provisionalPositioning:r,inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:C,drawDefinition:e,seedBlockInfo:P,participants:R,matchUpsMap:U,structure:I,event:h}),x.error)return g(x);f.push({seedPositions:x.seedPositions,action:"positionSeedBlocks"})}else{if(p!==up){let F=I.seedingProfile?{positioning:I.seedingProfile}:l,$=AB({seedingProfile:F,provisionalPositioning:r,inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:C,drawDefinition:e,seedBlockInfo:P,participants:R,matchUpsMap:U,structure:I,event:h});if($.error)return g($);f.push({action:"positionSeedBlocks",seedPositions:$.seedPositions})}let x=a?kB({provisionalPositioning:r,tournamentRecord:o,appliedPolicies:b,drawDefinition:e,seedBlockInfo:P,matchUpsMap:U,structure:I,seedLimit:c,seedsOnly:d,event:h}):void 0;if(x!=null&&x.error)return g(x);D=x==null?void 0:x.unseededByePositions,f.push({action:"positionByes",byeDrawPositions:x==null?void 0:x.byeDrawPositions,unseededByePositions:D})}let N={};if(!d){let x=Ile({inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:C,drawDefinition:e,seedBlockInfo:P,participants:R,matchUpsMap:U,structure:I});if(x.error||(x.conflicts&&(N.qualifierConflicts=x.conflicts),f.push({action:"positionQualifiers",qualifierDrawPositions:x.qualifierDrawPositions}),x=gle({provisionalPositioning:r,inContextDrawMatchUps:T,unseededByePositions:D,multipleStructures:n,tournamentRecord:o,drawDefinition:e,seedBlockInfo:P,participants:R,matchUpsMap:U,structureId:u,structure:I,drawSize:m,event:h}),x.error))return g(x);x.conflicts&&(N.unseededConflicts=x.conflicts),f.push({action:"positionUnseededParticipants"})}let{positionAssignments:A}=ai({drawDefinition:e,structure:I});return si({drawDefinition:e,structureIds:[u]}),i||PU(),{positionAssignments:A,conflicts:N,...J,positioningReport:f}}function jg(t){var p;let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,placeByes:s,seedsOnly:l}=t;if(!n)return{error:xa};if(!Cc({drawDefinition:n,structureId:o})&&!i)return{error:nN};let u=(p=Uq({drawDefinition:n,structureId:o}).playoffStructures)==null?void 0:p.sort((m,h)=>wS(m)-wS(h)),c=[],d=[];if(u)for(let m of u){let{structureId:h}=m,f=pb({structureId:h,provisionalPositioning:i,applyPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:s,seedsOnly:l});if(f.error)return f;f.positionAssignments&&c.push({positionAssignments:f.positionAssignments,structureId:h}),f.positioningReport&&d.push(f.positioningReport)}return{...J,structurePositionAssignments:c,positioningReports:d}}function Pq({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>ot(i)))&&ee({result:{error:oe},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>wf(i.structureOrder)-wf(r.structureOrder)),{...J}):{error:_e}}function VT({drawDefinition:t}){var g,v,y,I,b,S,w;let e=t.structures??[],i=t.links??[],r=new Map,n=U=>{let T=r.get(U)||r.set(U,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(U);if(T&&!(T!=null&&T.stage)){let D=e.find(P=>P.structureId===U);T.stage=D==null?void 0:D.stage}return T},a={},o={},s=i.map(U=>{let T=U.source.structureId,D=U.target.structureId,P=n(T),C=n(D);return[Ad,Fo,sT,Nd].includes(U.target.feedProfile)?(P==null||P.targets.push(D),C==null||C.sources.push(T)):U.target.feedProfile===Oo&&(C==null||C.drawSources.push(T),P==null||P.drawTargets.push(D)),o[D]=o[D]||U.target.feedProfile===Oo,a[D]=ct([...a[D]||[],T]).filter(Boolean),[U.source.structureId,U.target.structureId]});for(let U of r.keys()){let T=r.get(U);if(T){let D=T.targets??[];for(;D.length;){let P=D.pop(),C=P&&r[P];(g=C==null?void 0:C.targets)!=null&&g.length?D.push(...C.targets):C&&(T.rootStage=C.stage)}if(T.rootStage||(T.rootStage=T.stage),!((v=T.targets)!=null&&v.length)){let P=T.sources??[];for(;P.length;){let C=P.pop(),R=C&&r[C];if((y=R==null?void 0:R.sources)!=null&&y.length){for(let N of R.sources)(I=T.progeny)!=null&&I.includes(N)||((b=T.progeny)==null||b.push(N));P.push(...R.sources)}}}}}let l=0;for(let U of r.keys()){let T=r.get(U);if(T&&T.rootStage===Ye){let D=[(S=T.drawTargets)==null?void 0:S[0]],P=0;for(;D.length;){P+=1;let C=D.pop(),R=C?r.get(C):void 0;(w=R==null?void 0:R.drawTargets)!=null&&w.length&&D.push(R.drawTargets[0])}T.distanceFromMain=P,P>l&&(l=P)}}let u=s.length;Se(0,Math.ceil(u/2)).forEach(()=>{s=Se(0,u).map(U=>{let T=s[U],D=s.reduce((P,C)=>Rn(T,C)?P.concat(...C):P,[])||[];return ct(T.concat(...D))})});let c=s[0],d=(U,T)=>Vi(U,T).length===U.length,p=s.slice(1).reduce((U,T)=>U&&d(T,c),!0),m=[c].filter(Boolean),h=[c].filter(Boolean);e.forEach(U=>{let{structureId:T,stage:D}=U;m.find(P=>P.includes(T))||(m.push([T]),D!==Ar&&h.push([T]))});let f=p&&h.length===1;return!(i!=null&&i.length)&&e.length===1&&n(e[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:f,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:o,structureGroups:m}}function Rq({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=VT({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...J}}function aO(t){let e=ze(t,[{[br]:!0,[Fn]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return Ple({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function Ple(t){var c;let e=ze(t,[{[Fn]:!0,[mT]:!0},{link:!0,[Xn]:ea,[pG]:uN}]);if(e.error)return e;let{drawDefinition:i,tournamentId:r,structure:n,eventId:a,link:o}=t,s=o.target.structureId,l=et({drawDefinition:i,structureId:s});if(l.error)return ee({stack:"attachQualifyingStructure",context:{targetStructureId:s},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(n),i.links.push(o),Rq({drawDefinition:i});let u=((c=Wt({structure:n}))==null?void 0:c.matchUps)||[];return Dc({drawDefinition:i,tournamentId:r,matchUps:u,eventId:a}),si({drawDefinition:i,structureIds:[n.structureId]}),{...J}}function Cq({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:oe};if(!t)return{error:_e};let i=Object.assign({},...e.map(r=>{if(!Nt(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Xe};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let o=i[a.structureId];o&&(a.structureName=o)}}return{...J}}function oO({drawDefinition:t,timeItem:e}){if(!t)return{error:xa};if(!e)return{error:TN};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:SN};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),jy({drawDefinition:t}),{...J}}function Eq(t){var v;let{tournamentRecord:e,drawDefinition:i,structureId:r,event:n}=t,a=ze(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let o=i.structures??[],s=o.find(y=>y.structureId===r);if(!s)return{error:Ei};let l=o.find(({stage:y,stageSequence:I})=>y===Oe&&I===1),u=r===(l==null?void 0:l.structureId),c=o.filter(({stage:y})=>y===Ye).map(Ta("structureId"));if(u&&!c.length)return{error:hG};let d=c.includes(r),p=Rle({isQualifyingStructure:d,structure:s,...t});if(p!=null&&p.error)return p;let{structureIdsToRemove:m,relatedStructureIdsMap:h}=Ele({qualifyingStructureIds:c,isQualifyingStructure:d,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureId:r}),{removedMatchUpIds:f,removedStructureIds:g}=Mle({relatedStructureIdsMap:h,qualifyingStructureIds:c,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:m,structureId:r});if(Cle({removedMatchUpIds:f,drawDefinition:i}),u){let y=(v=l.matchUps??[])==null?void 0:v.map(Ta("matchUpId"));f.push(...y),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&Rq({drawDefinition:i}),Gu({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:f,action:"removeStructure",eventId:n==null?void 0:n.eventId,drawDefinition:i}),si({drawDefinition:i,eventId:n==null?void 0:n.eventId}),{...J,removedMatchUpIds:f,removedStructureIds:g}}function Rle({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:o}){var l,u,c,d,p,m;let s=[r];if(t){let h=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},f=(l=h(r))==null?void 0:l.source.structureId;for(;f;)s.push(f),f=(u=h(f))==null?void 0:u.source.structureId}if((c=mr({matchUpFilters:{structureIds:s},drawDefinition:i}).matchUps)!=null&&c.some(({score:h})=>vr({score:h}))){let h=(d=$t({tournamentRecord:e,drawDefinition:i,structure:n,event:a}))==null?void 0:d.appliedPolicies;if(!(o??((m=(p=h==null?void 0:h[Ps])==null?void 0:p.allowDeletionWithScoresPresent)==null?void 0:m.structures)))return{error:Z0}}return{...J}}function Cle({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=mr({drawDefinition:e});i==null||i.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function Ele({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let o=(n.structures??[]).map(Ta("structureId")),s=c=>{var d;return((d=n.links)==null?void 0:d.map(p=>p.source.structureId===c&&p.target.structureId!==(r==null?void 0:r.structureId)&&p.target.structureId).filter(Boolean))??[]},l=c=>{var d;return((d=n.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===c&&p.source.structureId).filter(Boolean))??[]},u=new Map;return o.forEach(c=>u.set(c,e?l(c):s(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function Mle({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;a!=null&&a.length;){let u=a.pop();l.push(...Ole({idBeingRemoved:u,drawDefinition:n}));let c=Ale({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:n,structureId:o});s.push(...c.removedStructureIds);let d=Nle({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:u,structureId:o});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function Nle({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){var n;return t&&((n=e.get(t))==null?void 0:n.filter(a=>a!==(i==null?void 0:i.structureId)||r===i.structureId))}function Ale({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){var o;let a=[];return r.links=((o=r.links)==null?void 0:o.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function Ole({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=et({structureId:t,drawDefinition:e}),r=Wt({structure:i}).matchUps;return sA(r)}function MS({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:_e};if(!AA({drawDefinition:e,stage:r}))return{error:lp};let n=koe({drawDefinition:e,stage:r}),{qualifiersCount:a}=$g({drawDefinition:e,stageSequence:t,stage:r}),o=n+a;if(i<o)return{error:lN};let{entryProfile:s}=NA({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return si({drawDefinition:e}),{...J,entryProfile:s}}function Mq({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?AA({drawDefinition:e,stage:i})?i!==Oe?{error:lN,info:"qualifiersCount can only be set for main stage"}:(NA({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),si({drawDefinition:e}),{...J}):{error:lp}:{error:_e}}function kle({drawDefinition:t,drawSize:e}){if(!t)return{error:_e};let i=MS({stage:Ar,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(si({drawDefinition:t}),{...J})}function Nq(t){return kle(t)}var xle="qualifierDrawPositionAssignment",Fle="withdrawParticipantAtDrawPosition",Lle="alternateDrawPositionAssignment",_le="luckyLoserDrawPositionAssignment",xB="removeDrawPositionAssignment",Aq="swapDrawPositionAssignments",$le="modifyPairAssignment",Ble="adHocPositionSwap",Vle="modifyParticipantOtherName",FB="assignDrawPosition",jle="removeSeededParticipant",Gle="assignDrawPositionBye",Hle="modifySeedAssignment",Oq="addPenalty",sO="MODIFY_PAIR",jT="QUALIFIER",lO="ALTERNATE",uO="WITHDRAW",Sm="ASSIGN",BE="REMOVE",cO="LUCKY",xU="REMOVE_SEED",GT="SWAP",NS="NICKNAME",Kv="SEED_VALUE",Bf="PENALTY",AS="BYE",zle={MODIFY_PAIR_ASSIGNMENT:sO,QUALIFYING_PARTICIPANT:jT,ALTERNATE_PARTICIPANT:lO,WITHDRAW_PARTICIPANT:uO,ASSIGN_PARTICIPANT:Sm,LUCKY_PARTICIPANT:cO,REMOVE_ASSIGNMENT:BE,SWAP_PARTICIPANTS:GT,ADD_NICKNAME:NS,REMOVE_SEED:xU,ADD_PENALTY:Bf,ASSIGN_BYE:AS,SEED_VALUE:Kv};function kq({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:_e};if(!r)return{error:za};if((i==null?void 0:i.length)!==2)return{error:oe,drawPositions:i};let a=sn({drawDefinition:e}),{matchUps:o}=mr({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:s}=et({drawDefinition:e,structureId:r});if(!s)return{error:Ei};let l=$t({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},u;if(s.structureType===xn?u=Yle({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}):u=Wle({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}),u.error)return u;if(DA({structure:s,drawPositions:i}),DT({appliedPolicies:l,drawDefinition:e,positionAction:{name:Aq,drawPositions:i,structureId:r}}),Pc({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:n}),n.eventType===Sa){let c=Wt({matchUpFilters:{matchUpTypes:[ka]},inContext:!0,structure:s}).matchUps.filter(p=>{var m;return(m=p.drawPositions)==null?void 0:m.some(h=>i.includes(h))}),d=Wt({matchUpFilters:{matchUpTypes:[ka]},structure:s}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(m=>{var f;let h=m==null?void 0:m.drawPosition;if(i.includes(h)){let g=m.participantId,v=d.find(({matchUpId:I})=>I===p.matchUpId),y=(f=p==null?void 0:p.sides)==null?void 0:f.reduce((I,b,S)=>b.drawPosition===h?S:I,void 0);QA({inContextTargetMatchUp:p,drawPositionSideIndex:y,teamParticipantId:g,tournamentRecord:t,drawDefinition:e,matchUp:v,event:n})}})})}return si({drawDefinition:e,structureIds:[r]}),{...J}}function Wle({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){let s=a==null?void 0:a.positionAssignments.filter(u=>r==null?void 0:r.includes(u.drawPosition));if(!s)return{error:oe,structure:a,info:"Missing positionAssignments"};if(s.filter(({bye:u})=>u).length===2)return{...J};if(s.filter(({qualifier:u})=>u).length===2)return{...J};let l=s.some(({qualifier:u})=>u);return s.some(({bye:u})=>u)&&!l?xq({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o}):qle({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o})}function xq({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=r.find(({bye:h})=>h),l=r.find(({participantId:h})=>h),u=s.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,m=kI({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return m.error||(m=kI({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),m.error)||(Ya({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:o}),m=il({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:n,event:o}),m.error)?m:{...J}}function qle({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=Object.assign({},...r.map((l,u)=>{let{drawPosition:c}=l,d={...r[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>s[l.drawPosition]||l),tO({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:o}),{...J}}function Yle({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){var u;let s=(u=a.structures)==null?void 0:u.reduce((c,d)=>{let p=d==null?void 0:d.positionAssignments.filter(m=>r==null?void 0:r.includes(m.drawPosition));return p&&c.push(...p),c},[]);if(s.filter(({bye:c})=>c).length===2)return{...J};if(s.filter(({qualifier:c})=>c).length===2)return{...J};tO({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:s,structure:a,event:o});let l=s.some(({qualifier:c})=>c);if(s.some(({bye:c})=>c)&&!l)xq({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o});else{let c=Me(s,!1,!0);s.forEach((d,p)=>{let m=c[1-p].participantId;d.qualifier=c[1-p].qualifier,d.participantId=m})}return{...J}}function Fq({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){var o;let n="removeSeededParticipant";if(!t)return{error:ge};if(!e)return{error:_e};let a=(e.structures??[]).find(s=>s.structureId===r);return a?!a.stage||![Oe,Ye].includes(a.stage)||a.stage===Oe&&a.stageSequence!==1?ee({result:{error:op},stack:n}):(o=a.seedAssignments)!=null&&o.find(s=>s.participantId===i)?{...J}:ee({info:"participant not seeded",result:{error:_r},context:{participantId:i}}):ee({result:{error:Ei},stack:n})}function mb({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=wu}){return!r||!n?{error:za}:{link:Ge({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:Oo,roundNumber:t,structureId:n}})}}function dO({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:(r==null?void 0:r.pop())||Gt()}function OS({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:o,nodes:s}){let l=0,u=[],c=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let m=s==null?void 0:s[l],h=s==null?void 0:s[l+1];d&&(m.roundNumber=d),h&&d&&(h.roundNumber=d);let f=dO({roundPosition:c,roundNumber:i,idPrefix:n,uuids:o}),g={roundPosition:c,children:[m,h],matchUpId:f};u.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:Ji,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),r.push(v),c++,l+=2}return{roundNodes:u,matchUps:r}}function rl({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:u}){if(isNaN(s)||s<2||r&&s<=r)return{matchUps:[],roundsCount:0};if(r&&(!Us(s)||s%r)){let g=r;for(;g<s;)g=2*g;s=g}let c=r&&!(s%2)&&(!isNaN(r)||i&&!isNaN(i))&&(s/r===Math.round(s/r)||i&&s/i===Math.round(s/i));if(!Us(s)&&!c)return{matchUps:[],roundsCount:0};let d=Se(1,s+1).map(g=>({drawPosition:g})),p,m=[],h=1;for({roundNodes:p,matchUps:m}=OS({matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,nodes:d,uuids:u}),h++,a=a??i;p.length>1;)r&&p.length===r&&(a=h-1),{roundNodes:p,matchUps:m}=OS({nodes:p,matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,uuids:u}),h++;let f=h-1;return m=ib({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:f,roundLimit:a,matchUps:m}),a?m=m.filter(g=>a&&(g.roundNumber??0)<=a):a=h-1,{drawSize:s,matchUps:m,roundsCount:f,roundLimit:a}}function pO(t){var k,x,F,$,_,L;let e="generateQualifyingStructure";if(!t.drawDefinition)return ee({result:{error:_e},stack:e});if(t.drawSize&&!ot(t.drawSize)||t.participantsCount&&!ot(t.participantsCount)||t.qualifyingPositions&&!ot(t.qualifyingPositions))return ee({result:{error:oe},stack:e});let i=t.drawSize??iN(t.participantsCount),{qualifyingRoundNumber:r,qualifyingPositions:n,targetStructureId:a,structureOptions:o,appliedPolicies:s,drawDefinition:l,matchUpFormat:u,structureName:c,structureId:d,roundTarget:p,drawType:m,idPrefix:h,isMock:f,uuids:g}=t;if(!t.drawSize)return ee({result:{error:Py},context:{drawSize:i},stack:e});if(n&&n>=t.drawSize)return ee({result:{error:oe},context:{drawSize:i,qualifyingPositions:n},stack:e});let v,y,I,b,S=0,w,U=1,{structureProfiles:T}=VT({drawDefinition:l}),D=T[a];if(!D)return ee({result:{error:Ei},context:{targetStructureId:a},stack:e});let P=l.matchUpType,C=p?`${p}-`:"",R=D.stage===Ye,N=((x=(k=s==null?void 0:s[Of])==null?void 0:k.namingConventions)==null?void 0:x.pre)??(($=(F=_oe[Of])==null?void 0:F.namingConventions)==null?void 0:$.pre),A=R&&N?`${N}-`:"",M=c??(C?`${A}${Qr(Ye)} ${C}`:`${A}${Qr(Ye)}`);if(m===Xo){let{maxRoundNumber:B,structures:V,groupCount:G}=ub({structureName:c??M,structureId:d??(g==null?void 0:g.pop()),stage:Ye,structureOptions:o,appliedPolicies:s,stageSequence:U,matchUpType:P,roundTarget:p,idPrefix:h,drawSize:i,isMock:f,uuids:g});S=G,v=B,I=V[0],w=[1]}else({drawSize:i,matchUps:b,roundLimit:v,roundsCount:y}=rl({qualifyingRoundNumber:r,qualifyingPositions:n,matchUpType:P,idPrefix:h,drawSize:i,isMock:f,uuids:g})),v||(v=y),I=ao({structureName:c??M,structureId:d??(g==null?void 0:g.pop()),qualifyingRoundNumber:v,stage:Ye,matchUpFormat:u,stageSequence:U,matchUpType:P,roundLimit:v,matchUps:b}),p&&Lt({extension:{name:fl,value:p},element:I}),S=(_=b==null?void 0:b.filter(B=>B.roundNumber===v))==null?void 0:_.length;let E=m===Xo?bu:wu,O=I&&v&&((L=mb({sourceStructureId:I.structureId,sourceRoundNumber:v,targetStructureId:a,finishingPositions:w,linkType:E}))==null?void 0:L.link);return{qualifyingDrawPositionsCount:i,qualifiersCount:S,...J,structure:I,link:O}}function Lq(t){if(!t.tournamentRecord)return{error:ge};let e=Kle(t);return e.error,e}function Kle(t){if(!t.drawDefinition)return{error:_e};if(!t.targetStructureId)return{error:za};let e=pO(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:oe}:aO({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function _q(t){var d;let e=ze(t,[{[Fn]:!0,[cT]:!0,[hl]:!0},{[Vae]:!0,[Kr]:p=>Number.isInteger(p)&&p>0},{[Kr]:p=>Array.isArray(p)&&p.length===2&&p.every(Ti),[_a]:va,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=t,{structure:o}=et({drawDefinition:i,structureId:r});if(!o)return{error:Ei};if(!zn({structure:o}))return{error:op};let s=p=>{var m;return(m=p.sides)==null?void 0:m.map(h=>h.participantId).some(h=>t.participantIds.includes(h))},l=p=>p.roundNumber===t.roundNumber,u=p=>!vr(p),c=((o==null?void 0:o.matchUps)??[]).filter(l).filter(u).filter(s);if(c.length!==2)return{error:va};for(let p of c){let m=(d=p==null?void 0:p.sides)==null?void 0:d.find(h=>t.participantIds.includes(h==null?void 0:h.participantId));if(m){let h=t.participantIds.find(f=>f!==(m==null?void 0:m.participantId));m.participantId=h,Rt({tournamentId:n==null?void 0:n.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:p})}}return si({drawDefinition:i,structureIds:[r]}),{...J}}function Xle({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:o,uuids:s,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Se(0,c).map(f=>d?d+f:void 0),m=[];for(let f=0;f<c;f++){let g=p.shift(),v={drawPosition:g,fed:u+1,feed:!0},y=l[f];y.roundNumber=i-1;let I=dO({roundPosition:y.roundPosition,roundNumber:i,idPrefix:n,uuids:s}),b={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Ji,roundNumber:i,matchUpId:I};t&&(b.matchUpType=r),o&&(b.isMock=!0),a.push(b);let S={children:[y,v]};m.push(S)}let h=e?e-c:void 0;return{roundNodes:m,matchUps:a,drawPosition:h}}function Ec(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:m,uuids:h,fmlc:f}=t;a=a??A(e);let g=Jle({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((M,E)=>M+E,0);else if(e){let M=e-a;i=g.filter(E=>E<=M?(M-=E,!0):!1),y=i.reduce((E,O)=>E+O,0),r=i.length}else n>=v?r=0:u&&(r=v-u,n=0),i=g.filter((M,E)=>u&&!r||r&&E>=n+r||E<n?0:M),y=i.reduce((M,E)=>M+E,0),r=i.length;let I=[...g,...i].sort((M,E)=>E-M),b=I.length,S=[...(l??[]).map(M=>M-1),...(o??[]).map(M=>b-M)].map(M=>I[M]).reduce((M,E)=>M+E,0);y=y-S;let w=0,U=[],T,D=1,P=Se(0,a).map((M,E)=>({drawPosition:E+1+y})),C=y+1;for(let M of g){if({roundNodes:T,matchUps:U}=OS({matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:m,nodes:P,uuids:h}),D++,i.includes(M)){let E=wa(i)[M],O=Se(0,E),k=b+1-D,x=(o==null?void 0:o.includes(k))??(l==null?void 0:l.includes(D));O.forEach(()=>{({roundNodes:T,matchUps:U,drawPosition:C}=Xle({drawPosition:!x&&C||void 0,nodes:T,matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:m,uuids:h,fed:w})),D++,w+=1})}P=T}b!==D-1&&console.log("ERROR");let R=a-y;U=ib({finishingPositionOffset:c?R:s,positionsFed:y,roundsCount:b,matchUps:U,fmlc:f});let N=T!=null&&T.length?T[0]:T;return N&&(N.roundNumber=D-1,N.matchUps=U),{draw:N,matchUps:U,roundsCount:b};function A(M){let E=rN(M);return E>M?E/2:E}}function Jle({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Se(0,e).reverse().map(i=>Math.pow(2,i))}function gf(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:m,sequenceLimit:h,stage:f=Oe,drawSize:g,idPrefix:v,isMock:y,uuids:I}=t;if(!(!o||!u||o!=null&&o[l])||g<2||h&&s>h)return{};let b=[],S=[],w=[],U=t.matchUpType??(p==null?void 0:p.matchUpType),T=e+1,D=e+g,P=`${T}-${D}`,C=o==null?void 0:o[l],R=r&&`${r} `||"",N=(o==null?void 0:o[P])??(n==null?void 0:n[P]),A=t.structureName||(N==null?void 0:N.name)||(C==null?void 0:C.name)&&(i?`${R}${C==null?void 0:C.name}`:C.name)||`${R}${P}`,M=(N==null?void 0:N.abbreviation)??(C==null?void 0:C.abbreviation),E=t.structureId??(C==null?void 0:C.structureId)??(I==null?void 0:I.pop()),O={idPrefix:v&&`${v}-${A}-RP`,finishingPositionOffset:e,matchUpType:U,drawSize:g,isMock:y,uuids:I},{matchUps:k}=m?Ec(O):rl(O),x=ao({structureAbbreviation:M,stageSequence:s,structureName:A,matchUpType:U,roundOffset:d,structureId:E,matchUps:k,stage:f});b.push(...k),S.push(x);let F=Math.ceil(Math.log(g)/Math.log(2)),$=c?Math.min(c-d,F):(!a||T<a)&&F||0;return g>2&&Se(1,$+1).forEach(L=>_(L)),{structureId:x.structureId,matchUps:b,structureName:A,structures:S,links:w,...J};function _(L){let B=g/Math.pow(2,L);if(B<2)return;let V=g/Math.pow(2,L)+e;if(a&&V+1>a)return;let{structures:G,structureId:j,matchUps:z,links:q}=gf({finishingPositionOffset:V,exitProfile:`${l}-${L}`,roundOffset:d+L,stageSequence:s+1,drawSize:B,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:h,matchUpType:U,idPrefix:v,uuids:I,stage:f});if(x.structureId&&j){let W={linkType:$l,source:{roundNumber:L,structureId:x.structureId},target:{roundNumber:1,feedProfile:Fo,structureId:j}};q&&x&&q.push(W),q!=null&&q.length&&w.push(...q)}return G!=null&&G.length&&S.push(...G),z!=null&&z.length&&b.push(...z),{structureId:j,childLinks:q,structures:S}}}function mO({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=et({drawDefinition:t,structureId:i});if(r.error)return ee({result:r});let{matchUps:n}=Wt({structure:r.structure,matchUpsMap:e});return{...Cn({matchUps:n}),matchUps:n,matchUpsMap:e}}function LB({finishingPositions:t,drawDefinition:e,structureId:i}){var n;let{roundProfile:r}=mO({drawDefinition:e,structureId:i});return(n=r&&Object.keys(r))==null?void 0:n.reduce((a,o)=>($q(r==null?void 0:r[o]).forEach(s=>{t.forEach(l=>{Zle({position:l,rangeDefinition:s})&&(a[l]={roundNumber:o})})}),a),{})}function Zle({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return Se(i,(r||i)+1).includes(t)}function $q(t){var e,i;return[ct(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),ct(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function Qle(t){return $q(t).map(e=>Se(e[0],e[1]&&e[1]+1||e[0]+1))}function Gg({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:oe,context:{structureIds:e}};if(!t)return{error:_e};e=e??(t.structures??[]).filter(a=>a.stage!==Ye).map(({structureId:a})=>a);let r=e.map(a=>{var s;let{roundProfile:o}=mO({drawDefinition:t,matchUpsMap:i,structureId:a});return(s=o&&Object.values(o))==null?void 0:s.map(Qle).flat()}).flat(),n=r.filter(a=>(a==null?void 0:a.length)===1).sort(or).flat();return{positionsNotPlayedOff:ct(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function Bq({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:_e};if(!r)return{error:za};if(!e)return{error:Xe,info:"missing playoffPositions"};let n=Gg({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,o=e.filter(v=>!a.includes(v)),s=LB({finishingPositions:o,drawDefinition:i,structureId:r}),l=Object.values(s).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>Ze(v)).filter(v=>!t.includes(v)),u=LB({finishingPositions:a,drawDefinition:i,structureId:r}),c=u?Object.values(u):[],d=u?c.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>Ze(v)):[],p=l.filter(v=>!d.includes(v)).sort(or),{roundProfile:m}=mO({drawDefinition:i,structureId:r}),h=p.map(v=>{let y=m==null?void 0:m[v].finishingPositionRange.loser,[I,b]=y??[0,0];return Se(I,(b||I)+1)}).flat().sort(or),{playoffRoundsRanges:f}=eue({playoffSourceRounds:p,roundProfile:m}),g=[...p,...d];return{playoffPositionsReturned:h,playedOffSourceRounds:d,playoffRoundsRanges:f,playoffSourceRounds:p,sourceRounds:g,roundProfile:m}}function eue({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,o=Se(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:o,roundNumber:i}})}}function hb({drawDefinition:t,structureId:e}){if(!t)return{error:_e};let{matchUps:i,matchUpsMap:r}=Sn({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=Gg({drawDefinition:t,matchUpsMap:r}),{structures:o}=Zo({drawDefinition:t}),s=o.filter(u=>!e&&u.stage!==Ar||u.structureId===e),l={};for(let u of s){let c=u==null?void 0:u.structureId,d=tue({playoffPositions:n,drawDefinition:t,structure:u,matchUps:i}),{error:p,...m}=d;if(p)return d;l[c]={structureId:c,...m}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function tue({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){var m,h,f,g,v,y,I,b,S;let n=i==null?void 0:i.structureId,{links:a}=Lg({drawDefinition:e,structureId:n});if(i.structureType===xn||i.structures){let w=(h=(m=ai({structure:i}))==null?void 0:m.positionAssignments)==null?void 0:h.length,U=i.structures.length,T=(w??0)/U,D=((f=a.source)==null?void 0:f.flatMap(({source:x})=>(x==null?void 0:x.finishingPositions)||[]))||[],P=Se(1,T+1).filter(x=>!D.includes(x)),C=((v=(g=r.find(x=>x.containerStructureId===n&&x.finishingPositionRange))==null?void 0:g.finishingPositionRange)==null?void 0:v.winner)||[0,1],R=a==null?void 0:a.source.map(({target:x})=>x.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:A=[]}=Gg({structureIds:R,drawDefinition:e}),M=[...N,...A],E=Se(C[0],C[1]+1).filter(x=>!M.includes(x)),O=Pr(E,E.length/P.length),k=P.map((x,F)=>{let $=O[F],_=[Math.min(...$||[]),Math.max(...$||[])].join("-");return{finishingPosition:x,finishingPositions:$,finishingPositionRange:_}});return{positionsNotPlayedOff:E,playoffFinishingPositionRanges:k,finishingPositionsAvailable:P,finishingPositionsPlayedOff:D,positionsPlayedOff:N,groupCount:U,groupSize:T}}let o=((y=a==null?void 0:a.source)==null?void 0:y.filter(w=>w.linkCondition!==el).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],s=((I=a==null?void 0:a.source)==null?void 0:I.filter(w=>w.linkCondition===el).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],l=Bq({excludeRoundNumbers:o,playoffPositions:t,drawDefinition:e,structureId:n}),u=l!=null&&l.playoffSourceRounds?[...(l==null?void 0:l.playoffSourceRounds)||[]]:void 0,c=[...(l==null?void 0:l.playoffRoundsRanges)||[]],{roundProfile:d,error:p}=l;for(let w of s){let U=a==null?void 0:a.source.find(R=>R.source.roundNumber===w),T=U==null?void 0:U.target.roundNumber,D=U==null?void 0:U.target.structureId,P=r.filter(({roundNumber:R,structureId:N})=>N===D&&R===T),C=P.filter(({sides:R})=>R.find(N=>N.participantFed&&!N.participantId)).length;if(u&&C===P.length){u.push(w);let R=(S=(b=d==null?void 0:d[w])==null?void 0:b.finishingPositionRange)==null?void 0:S.loser;if(R){let N=Math.min(...R),A=N+C,M=Se(N,A),E={finishingPositionRange:[N,A-1].join("-"),finishingPositions:M,roundNumber:w};c.push(E)}}}return u&&u.sort(or),c.sort((w,U)=>w.roundNumber-U.roundNumber),{playoffRounds:u,playoffRoundsRanges:c,error:p}}function iue({playoffGroups:t,drawDefinition:e,structureId:i}){var n,a;if(!e)return{error:_e};if(!Ti(i)||!Array.isArray(t))return{error:oe};let r=t.map(({finishingPositions:o})=>o).flat();return{positionRangeMap:(a=(n=hb({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:n.filter(o=>r.includes(o.finishingPosition)))==null?void 0:a.reduce((o,s)=>(o[s.finishingPosition]=s,o),{})}}function Vq(t){var y,I;let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:o=Oe,matchUpType:s,structureId:l,idPrefix:u,drawSize:c,isMock:d,uuids:p}=t,m={finishingPositionOffset:e,matchUpType:s,drawSize:c,idPrefix:u,isMock:d,uuids:p},{matchUps:h}=n?Ec(m):rl(m),f=ao({structureName:a||((y=i==null?void 0:i["0"])==null?void 0:y.name)||Qr(Oe),structureId:l||(p==null?void 0:p.pop()),stageSequence:r,matchUpType:s,matchUps:h,stage:o}),g=[f],v=[];if(c>2){let b=c/2,{matchUps:S}=rl({finishingPositionOffset:e+b,idPrefix:u&&`${u}-c`,drawSize:b,matchUpType:s,isMock:d}),w=Qr(rn),U=((I=i==null?void 0:i["0-1"])==null?void 0:I.name)??t.consolationStructureName??(a?`${a} ${w}`:w),T=ao({structureName:U,matchUps:S,structureId:p==null?void 0:p.pop(),stage:rn,stageSequence:1,matchUpType:s});g.push(T);let D={linkType:$l,source:{roundNumber:1,structureId:f.structureId},target:{roundNumber:1,feedProfile:Fo,structureId:T.structureId}};v.push(D)}return{...J,structures:g,links:v}}function jq({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let o=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),s=(n==null?void 0:n.roundGroupedOrder)||[],l=n==null?void 0:n.roundFeedProfiles;return Se(1+e,r+1+e).map(u=>{let c=l!=null&&l[u-1]?l[u-1]:u%2&&Fo||Ad,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:$l,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},m=s[u-1];return m&&(p.target.groupedOrder=m),Fa()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=el,p.target.feedProfile=Fo),o.includes(d)?p:void 0}).filter(Boolean)}function Gq(t){var S,w;let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:o,stage:s=Oe,matchUpType:l,structureId:u,drawSize:c,idPrefix:d,isMock:p,uuids:m}=t,h={finishingPositionOffset:i,matchUpType:l,drawSize:c,idPrefix:d,isMock:p,uuids:m},{matchUps:f,roundsCount:g}=o?Ec(h):rl(h),v=t.structureName??((S=n==null?void 0:n["0"])==null?void 0:S.name)??Qr(Oe),y=gc({structureId:u||(m==null?void 0:m.pop()),structureName:v,stageSequence:r,matchUpType:l,matchUps:f,stage:s}),I=[y],b=[];if(c>2){let U=[0,2].slice(0,c/16).map((T,D)=>{let P=D+1,{consolationStructure:C}=rue({idPrefix:d&&`${d}-c${D}`,structureId:m==null?void 0:m.pop(),playoffStructureNameBase:e,playoffAttributes:n,structureNameMap:a,stageSequence:P,roundOffset:T,matchUpType:l,drawSize:c,isMock:p,index:D,uuids:m});I.push(C);let R=jq({consolationStructure:C,roundsCount:2,mainStructure:y,roundOffset:T});return{consolationStructure:C,links:R}}).map(T=>T.links).flat();if(b.push(...U),c>=4&&c<=16||c>32){let{matchUps:T}=rl({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),D=((w=n==null?void 0:n["3-4"])==null?void 0:w.name)??Qr($i),P=(a==null?void 0:a[D])||D,C=e?`${e} ${P}`:P,R=gc({structureId:m==null?void 0:m.pop(),matchUps:T,stageSequence:2,stage:$i,structureName:C,matchUpType:l}),N={linkType:$l,source:{roundNumber:g-1,structureId:y.structureId},target:{structureId:R.structureId,feedProfile:Fo,roundNumber:1}};I.push(R),b.push(N)}}return{structures:I,links:b,...J}}function rue({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:u,index:c,uuids:d}){var y,I;let p=l/(2*Math.pow(2,n)),{matchUps:m,roundsCount:h}=Ec({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:u,uuids:d}),f=c===0&&((y=i==null?void 0:i["0-1"])==null?void 0:y.name)||c===1&&((I=i==null?void 0:i["0-3"])==null?void 0:I.name)||`${Qr(rn)} ${c+1}`,g=(r==null?void 0:r[f])||f,v=t?`${t} ${g}`:g;return{consolationStructure:gc({matchUps:m,stage:rn,structureName:v,stageSequence:e,matchUpType:a,structureId:o}),consolationRoundsCount:h}}function _p(t){var P,C,R,N;let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:o,stage:s=Oe,structureId:l,matchUpType:u,skipRounds:c,feedRounds:d,idPrefix:p,drawSize:m,isMock:h,uuids:f,fmlc:g}=t,v=t.feedPolicy||((P=t.policyDefinitions)==null?void 0:P[kf])||((C=t.appliedPolicies)==null?void 0:C[kf]),y={finishingPositionOffset:e,matchUpType:u,skipRounds:c,drawSize:m,idPrefix:p,isMock:h,uuids:f},{matchUps:I}=a?Ec(y):rl(y),b=ao({structureName:o||((R=r==null?void 0:r["0"])==null?void 0:R.name)||Qr(Oe),structureId:l||(f==null?void 0:f.pop()),stageSequence:i,matchUpType:u,matchUps:I,stage:s}),S=[b],w=[],U=m/2,{matchUps:T,roundsCount:D}=Ec({finishingPositionOffset:U,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:U,matchUpType:u,feedRounds:d,skipRounds:c,isMock:h,uuids:f,fmlc:g});if(m>2){let A=((N=r==null?void 0:r["0-1"])==null?void 0:N.name)??Qr(rn),M=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${A}`:A,E=ao({matchUps:T,structureId:f==null?void 0:f.pop(),stage:rn,stageSequence:1,structureName:M,matchUpType:u});S.push(E);let O=jq({consolationStructure:E,mainStructure:b,roundsCount:D,feedPolicy:v,fmlc:g});w.push(...O)}return{...J,structures:S,links:w}}function Hq({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:m}){var S,w,U,T,D,P;u=u||(n==null?void 0:n[kf]);let h="processPlayoffGroups",f=0,g=[],v=[],y=[],{error:I,positionRangeMap:b}=iue({structureId:r,drawDefinition:o,playoffGroups:s});if(I)return ee({result:{error:I},stack:h});if(!(!b||s!=null&&s.every(C=>{let{finishingPositions:R=[]}=C;if(!R.length)return!1;let N=[...R].sort(or).map((A,M)=>(R[M+1]||A)-A).every(A=>A<2);return(!t||N)&&R.every(A=>b[A])})))return ee({context:{validFinishingPositions:Object.values(b)},result:{error:oe},stack:h});for(let C of s){let R=C.finishingPositions,N=b&&R.map($=>{var _;return(_=b[$])==null?void 0:_.finishingPositions}).flat(),A=c*R.length,M=Ug(A),E=M===2&&Gs||C.drawType||Gs;N&&(f=Math.min(...N)-1);let O=N&&`${Math.min(...N)}-${Math.max(...N)}`,k=C.structureName||O&&((w=(S=C.playoffAttributes)==null?void 0:S[O])==null?void 0:w.name)||((T=(U=C.playoffAttributes)==null?void 0:U["0"])==null?void 0:T.name),x={addNameBaseToAttributeName:C.addNameBaseToAttributeName,playoffStructureNameBase:C.playoffStructureNameBase,finishingPositionNaming:C.finishingPositionNaming,finishingPositionLimit:C.finishingPositionLimit,structureId:C.structureId??(m==null?void 0:m.pop()),playoffAttributes:C.playoffAttributes,structureNameMap:C.structureNameMap,sequenceLimit:C.sequenceLimit,structureName:k,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:f,stage:$i,stageSequence:a,matchUpType:l,drawSize:M,isMock:p,uuids:m},F=({playoffStructures:$,playoffLinks:_})=>{let[L]=$,B=uU({playoffStructureId:L.structureId,finishingPositions:R,sourceStructureId:r});y.push(B),y.push(..._),v.push(...$),g.push({structureId:L.structureId,finishingPositions:R}),f+=A};if(E===Gs){let{matchUps:$}=rl({finishingPositionLimit:f+A,idPrefix:d&&`${d}-po`,finishingPositionOffset:f,matchUpType:l,drawSize:M,isMock:p,uuids:m}),_=ao({structureId:C.structureId??(m==null?void 0:m.pop()),matchUpFormat:e,stage:$i,structureName:k,stageSequence:a,matchUps:$});v.push(_);let L=uU({playoffStructureId:_.structureId,finishingPositions:R,sourceStructureId:r});y.push(L),f+=A,g.push({structureId:_.structureId,finishingPositions:R})}else if([Ef,Mf,$i].includes(E)){let $={playoffAttributes:C.playoffAttributes??i,playoffStructureNameBase:C.playoffStructureNameBase,structureId:C.structureId??(m==null?void 0:m.pop()),structureName:C.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:f,stage:$i,roundOffset:0,stageSequence:a,drawSize:M,isMock:p,uuids:m};E===Ef?Object.assign($,{playoffAttributes:(C==null?void 0:C.playoffAttributes)??i??zN,roundOffsetLimit:3}):E===Mf&&Object.assign($,{playoffAttributes:(C==null?void 0:C.playoffAttributes)??i??WN,roundOffsetLimit:2});let _=gf($);if(_.error)return _;if((D=_.links)!=null&&D.length&&y.push(..._.links),(P=_.structures)!=null&&P.length&&v.push(..._.structures),v.sort(Km),_.structureId){let L=uU({playoffStructureId:_.structureId,finishingPositions:R,sourceStructureId:r});y.push(L),g.push({structureId:_.structureId,finishingPositions:R})}f+=A}else if([Nf,Fy,PI,DI,TI,RI].includes(E)){let $=[m==null?void 0:m.pop(),m==null?void 0:m.pop()],_={playoffStructureNameBase:C.playoffStructureNameBase,structureId:C.structureId??(m==null?void 0:m.pop()),playoffAttributes:C.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:f,uuids:$,stage:$i,structureName:k,matchUpType:l,feedPolicy:u,drawSize:M,isMock:p},L={[Nf]:{fmlc:!0,feedRounds:1},[RI]:{feedRounds:1},[PI]:{feedsFromFinal:3},[DI]:{feedsFromFinal:2},[TI]:{feedsFromFinal:1}};Object.assign(_,L[E]||{});let{structures:B,links:V}=_p(_),[G]=B,j=uU({playoffStructureId:G.structureId,finishingPositions:R,sourceStructureId:r});y.push(j),y.push(...V),v.push(...B),g.push({structureId:G.structureId,finishingPositions:R}),f+=A}else if([Xo].includes(E)){let{structures:$,links:_}=ub({...x,structureOptions:C.structureOptions||{groupSize:4}});F({playoffStructures:$,playoffLinks:_})}else if([xy].includes(E)){let{structures:$,links:_}=Vq(x);F({playoffStructures:$,playoffLinks:_})}else if([xae].includes(E)){let{structures:$,links:_}=Gq(x);F({playoffStructures:$,playoffLinks:_})}else if([La].includes(E)){let $=ao({structureId:C.structureId??(m==null?void 0:m.pop()),structureName:C.structureName,finishingPosition:EU,stage:$i,stageSequence:a,matchUps:[]});F({playoffStructures:[$],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:b,structures:v,links:y}}function uU({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:bu,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:Oo,roundNumber:1}}}function fb({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>gb({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function gb({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:u}=e||{},c=i??o??0,d=p=>{if(!n&&!(r!=null&&r.isMock))return(a==null?void 0:a.pop())??Gt();let m=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${r==null?void 0:r.matchUpId}-${m}-TMU-${p+1}`};return Se(0,c).map(p=>{let m=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Ji,collectionPosition:m,collectionId:l,processCodes:u,matchUpType:s,isMock:n}})}function nue(t){var T,D,P;let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return ee({result:{error:Xe},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:o,groupCount:s,groupSize:l,event:u}=t,c=Hq({requireSequential:r,sourceStructureId:i,playoffGroups:o,groupCount:s,groupSize:l,...t});if(c.error)return ee({result:c,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:m,positionRangeMap:h}=c,f=m==null?void 0:m.map(({finishingPositions:C})=>C).flat().map(C=>h[C].finishingPositions).flat();a.structures.push(...d),a.links.push(...p);let{matchUps:g,matchUpsMap:v}=mr({inContext:!0,drawDefinition:a}),y=d.map(({structureId:C})=>C),I=g==null?void 0:g.filter(({structureId:C})=>y.includes(C)).map(Tr),b=(T=v==null?void 0:v.drawMatchUps)==null?void 0:T.filter(({matchUpId:C})=>I==null?void 0:I.includes(C));if(b!=null&&b.length){let C=(D=vn({drawDefinition:a,event:u}))==null?void 0:D.tieFormat;C&&b.forEach(R=>{let{tieMatchUps:N}=fb({isMock:t.isMock,tieFormat:C,matchUp:R});Object.assign(R,{tieMatchUps:N,matchUpType:ka})})}let{positionAssignments:S}=ai({structureId:i,drawDefinition:a}),w={};S==null||S.forEach(C=>{var N,A,M;let R=(M=(A=(N=gt({element:C,name:Sc}))==null?void 0:N.extension)==null?void 0:A.value)==null?void 0:M.groupOrder;R&&(w[R]||(w[R]=[]),w[R].push(C.participantId))});let U=jg({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:n,drawDefinition:a});return U.error&&((P=U.error)==null?void 0:P.code)!==nN.code?ee({result:U,stack:e}):{structures:d,links:p,positionsPlayedOff:f,drawDefinition:a,...J}}function af({value:t,sourceRange:e,targetRange:i}){let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),o=Math.max(...i);return(t-r)*(o-a)/(n-r)+a}var ko="ELO",zq="NTRP",aue="TRN",Wq="UTR",hO="WTN",oue={ELO:ko,NTRP:zq,TRN:aue,UTR:Wq,WTN:hO},sue={[ko]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[zq]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[Wq]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[hO]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Mr=sue;function lue({sourceRatingType:t,sourceRating:e}){let i=Mr[t].range,r=i[0]>i[1],n=Mr[ko].range;return af({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function uue({targetRatingType:t,sourceRating:e}){let i=Mr[t].decimalsCount||0,r=Mr[t].range,n=r[0]>r[1],a=Math.max(...r),o=Mr[ko].range,s=af({targetRange:r,sourceRange:o,value:e}),l=parseFloat(s.toFixed(i));return n?a-l:l}function _B(t){var d;let e=ze(t,[{ratings:!0,[Xn]:ea}]);if(e.error)return e;let i=t.matchUpType&&[ti,Qt].includes(t.matchUpType)?t.matchUpType:ti,r=Object.keys(Mr),n=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:ko,a=t.ratings[i]?t.ratings[i].reduce((p,m)=>p.includes(m.scaleName)?p:p.concat(m.scaleName),[]):[];if(!a)return{error:_r};let o=((d=t.ratings[i])==null?void 0:d.find(p=>p.scaleName===n))??t.ratings[i][0];if(a[0]===n)return o;let s=o.scaleName,l=Mr[o.scaleName].accessor,u=l?o.scaleValue[l]:o.scaleValue,c=lue({sourceRatingType:s,sourceRating:u});return{convertedRating:uue({targetRatingType:n,sourceRating:c}),sourceRating:u}}function cue({participantResults:t,sides:e,score:i}){var s,l;let r=e.find(({sideNumber:u})=>u===1),n=e.find(({sideNumber:u})=>u===2),a=(s=r==null?void 0:r.participant)==null?void 0:s.ratings,o=(l=n==null?void 0:n.participant)==null?void 0:l.ratings;if(a!=null&&a[ti]&&(o!=null&&o[ti])){let u=ko,{convertedRating:c}=_B({ratings:a,targetRatingType:u}),{convertedRating:d}=_B({ratings:o,targetRatingType:u}),{side1pressure:p,side2pressure:m}=due({side1ConvertedRating:c,side2ConvertedRating:d,score:i});p&&t[r==null?void 0:r.participantId].pressureScores.push(p),m&&t[n==null?void 0:n.participantId].pressureScores.push(m);let h=Math.max(...Mr[ko].range),f=uS((d-c)/h),g=uS((c-d)/h);t[r==null?void 0:r.participantId].ratingVariation.push(f),t[n==null?void 0:n.participantId].ratingVariation.push(g)}}function due({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){var y,I;let r=t>e?t:e,n=t>e?e:t,a=Math.abs(t-e),o=Mr[ko].range,s=Math.max(...o),l=(s-r)*0,u=(r+l)/s*a,c=(y=i==null?void 0:i.sets)==null?void 0:y.reduce((b,S)=>b+((S==null?void 0:S.side1Score)??0),0),d=(I=i==null?void 0:i.sets)==null?void 0:I.reduce((b,S)=>b+(S.side2Score??0),0),p=t>e?2:1,m=(c||0)*(n+(p===1?u:0)),h=(d||0)*(n+(p===2?u:0)),f=m+h,g=f?uS(m/f):0,v=f?uS(h/f):0;return{side1pressure:g,side2pressure:v}}function fO({winningSide:t,matchUpFormat:e=pu,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],o=n==null?void 0:n.sets,s=typeof t=="number"&&t-1,l=kn(e),u=gO((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===Mt&&(r!=null&&r.setsCreditForDefaults)||i===zt&&(r!=null&&r.setsCreditForWalkovers)))a[s]=u;else for(let c of o||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof s=="number"&&i===mn&&(+a[1-s]===u&&(a[1-s]-=1),r!=null&&r.setsCreditForRetirements&&(a[s]=u)),a}function qq({matchUpFormat:t=pu,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){var p,m;let{sets:a}=n||{};if(!a)return[0,0];let o=typeof e=="number"&&e-1,s=kn(t),l=(s==null?void 0:s.bestOf)??1,u=gO(l),c=((p=s==null?void 0:s.setFormat)==null?void 0:p.tiebreakAt)||0,d=[[],[]];if(typeof o=="number"&&(i===Mt&&(r!=null&&r.gamesCreditForDefaults)||i===zt&&(r!=null&&r.gamesCreditForWalkovers))){let h=((m=s==null?void 0:s.setFormat)==null?void 0:m.setTo)||0,f=u*h;d[o].push(f)}else a.forEach((h,f)=>{var S;let g=(h.setNumber||f+1)>u&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",v=(S=s==null?void 0:s[g])==null?void 0:S.based,y=s==null?void 0:s[g].tiebreakSet,{side1Score:I,side2Score:b}=h;$B(v)&&(d[0].push(Ze(I||0)),d[1].push(Ze(b||0))),y&&h.winningSide&&(r==null?void 0:r.gamesCreditForTiebreakSets)!==!1&&d[h.winningSide-1].push(1)});if(i===mn&&typeof o=="number"){let h=a.length>u&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",f=s==null?void 0:s[h];if($B(f.based)){let g=(f==null?void 0:f.setTo)||0,v=I=>{if(!(!s||I===""))return+I===c-1||+I===c?Ze(c||0)+1:+I<c?g:c},y=fO({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(d.map(I=>I[o]<=I[1-o]).reduce((I,b)=>I+(b?1:0),0)>y[1-o]){let I=d[o].length,b=v(d[1-o][I-1]);b&&(d[o][I-1]=b)}u>d[o].length&&(r!=null&&r.gamesCreditForRetirements)&&d[o].push(g)}}return[d[0].reduce((h,f)=>h+f,0),d[1].reduce((h,f)=>h+f,0)]}function Yq({matchUpFormat:t,score:e}){var s;let i=t?kn(t):void 0,r=(i==null?void 0:i.bestOf)??1,n=gO(r),a=[0,0],o=[0,0];return(s=e==null?void 0:e.sets)==null||s.forEach((l,u)=>{var p;let c=(l.setNumber||u+1)>n&&(i!=null&&i.finalSetFormat)?"finalSetFormat":"setFormat",d=(p=i==null?void 0:i[c])==null?void 0:p.based;if(Kq(d)){let{side1Score:m,side2Score:h}=l;m&&(o[0]+=Ze(m||0)),h&&(o[1]+=Ze(h||0))}else l.side1TiebreakScore&&(o[0]+=Ze(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(o[1]+=Ze(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(a[l.winningSide-1]+=1)}),{pointsTally:o,tiebreaksTally:a}}function gO(t){return t&&Math.ceil(t/2)||1}function Kq(t){return t==="P"}function $B(t){return!Kq(t)}function pue({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:r,totalSets:n}){var u;let a=e&&kn(e)||{},o=a.bestOf,s=o&&Math.ceil(o/2)||1,l=(u=a.setFormat)==null?void 0:u.setTo;Object.keys(t).forEach(c=>{let d=t[c].setsWon,p=t[c].setsLost,m=i!=null&&i.groupTotalSetsPlayed?n:r*(s||0)||d+p,h=Math.round(d/m*1e3)/1e3;(h===1/0||isNaN(h))&&(h=m);let f=t[c].tieMatchUpsWon,g=t[c].tieMatchUpsLost,v=f+g,y=Math.round(f/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=f);let I=t[c].matchUpsWon,b=t[c].matchUpsLost,S=I+b,w=Math.round(I/S*1e3)/1e3;(w===1/0||isNaN(w))&&(w=I);let U=t[c].gamesWon||0,T=t[c].gamesLost||0,D=(r||0)*(s||0)*(l||0),P=Math.max(D,U+T),C=Math.round(U/P*1e3)/1e3;(C===1/0||isNaN(C))&&(C=0);let R=t[c].pointsWon+t[c].pointsLost,N=Math.round(t[c].pointsWon/R*1e3)/1e3;(N===1/0||isNaN(N))&&(N=0),t[c].setsWon=d,t[c].setsLost=p,t[c].setsPct=h,t[c].tieMatchUpsWon=f,t[c].tieMatchUpsPct=y,t[c].matchUpsPct=w,t[c].gamesWon=U,t[c].gamesLost=T,t[c].gamesPct=C,t[c].pointsPct=N,t[c].result=`${t[c].matchUpsWon}/${t[c].matchUpsLost}`})}function vb({participantIds:t,pressureRating:e,matchUpFormat:i,tallyPolicy:r,perPlayer:n,matchUps:a}){var c,d,p,m,h,f,g;let o={},s=(r==null?void 0:r.excludeMatchUpStatuses)||[],l=a==null?void 0:a.filter(v=>(v.tieMatchUps||!s.includes(v.matchUpStatus))&&(!(t!=null&&t.length)||Vi(t,[of(v,0),of(v,1)]).length===2)),u=(c=l==null?void 0:l.flatMap(({score:v,tieMatchUps:y})=>{var I;return y?y.filter(({matchUpStatus:b})=>!s.includes(b)).flatMap(({score:b})=>{var S;return((S=b==null?void 0:b.sets)==null?void 0:S.length)??0}):((I=v==null?void 0:v.sets)==null?void 0:I.length)??0}))==null?void 0:c.reduce((v,y)=>v+y,0);for(let v of l??[]){let{matchUpStatus:y,tieMatchUps:I,tieFormat:b,score:S,winningSide:w,sides:U}=v,T=b&&v._disableAutoCalc&&b.collectionDefinitions.every(({scoreValue:N})=>N),D=w&&mue(v),P=w&&hue(v);if(!D&&!P)if(y&&gr.includes(y)){let N=of(v,0),A=of(v,1);N&&(sc(o,N),o[N].matchUpsCancelled+=1),A&&(sc(o,A),o[A].matchUpsCancelled+=1)}else if(I!=null&&I.length){n=0;for(let N of I){if(N.winningSide){let A=(d=U==null?void 0:U.find(({sideNumber:E})=>E===N.winningSide))==null?void 0:d.participantId,M=(p=U==null?void 0:U.find(({sideNumber:E})=>E===N.winningSide))==null?void 0:p.participantId;A&&M&&(sc(o,A),sc(o,M),o[A].tieMatchUpsWon+=1,o[M].tieMatchUpsLost+=1,Yi(ti)(N.matchUpType)?(o[A].tieSinglesWon+=1,o[M].tieSinglesLost+=1):Yi(Qt)(N.matchUpType)&&(o[A].tieDoublesWon+=1,o[M].tieDoublesLost+=1))}BB({score:N.score,manualGamesOverride:T,participantResults:o,sides:U})}}else BB({manualGamesOverride:T,participantResults:o,score:S,sides:U});else if(sc(o,D),sc(o,P),I==null?void 0:I.length){n=0;for(let N of I){let{matchUpType:A}=N,M=Yi(Qt)(A),E=Yi(ti)(A);N.winningSide&&(N.winningSide===w?(D&&(o[D].tieMatchUpsWon+=1,E&&(o[D].tieSinglesWon+=1),M&&(o[D].tieDoublesWon+=1)),P&&(o[P].tieMatchUpsLost+=1,E&&(o[P].tieSinglesLost+=1),M&&(o[P].tieDoublesLost+=1))):N.winningSide!==w&&(P&&(o[P].tieMatchUpsWon+=1,E&&(o[P].tieSinglesWon+=1),M&&(o[P].tieDoublesWon+=1)),D&&(o[D].tieMatchUpsLost+=1,E&&(o[D].tieSinglesLost+=1),M&&(o[D].tieDoublesLost+=1)))),VB({matchUpFormat:N.matchUpFormat,matchUpStatus:N.matchUpStatus,matchUpType:N.matchUpType,score:N.score,sides:N.sides,winningParticipantId:D,losingParticipantId:P,manualGamesOverride:T,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:r,winningSide:w})}Xq({winningParticipantId:D,losingParticipantId:P,participantResults:o,matchUpStatus:y})}else VB({matchUpFormat:v.matchUpFormat??i,matchUpType:v.matchUpType,isTieMatchUp:void 0,winningParticipantId:D,manualGamesOverride:T,losingParticipantId:P,participantResults:o,pressureRating:e,matchUpStatus:y,tallyPolicy:r,winningSide:w,score:S,sides:U});let C=(m=S==null?void 0:S.sets)==null?void 0:m.reduce((N,A)=>N+((A==null?void 0:A.side1Score)??0),0),R=(h=S==null?void 0:S.sets)==null?void 0:h.reduce((N,A)=>N+(A.side2Score??0),0);if(T){let N=(f=U==null?void 0:U.find(({sideNumber:M})=>M===1))==null?void 0:f.participantId,A=(g=U==null?void 0:U.find(({sideNumber:M})=>M===2))==null?void 0:g.participantId;sc(o,N),sc(o,A),N&&(o[N].gamesWon+=C,o[N].gamesLost+=R),A&&(o[A].gamesWon+=R,o[A].gamesLost+=C)}}return pue({participantResults:o,matchUpFormat:i,tallyPolicy:r,perPlayer:n,totalSets:u}),{participantResults:o}}function mue(t){let e=t.winningSide-1;return of(t,e)}function hue(t){let e=1-(t.winningSide-1);return of(t,e)}function of(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function sc(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function BB({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],o=[0,0];for(let l of n||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(o[u-1]+=1),a[0].push(Ze(c||0)),a[1].push(Ze(d||0))}let s=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];r.forEach((l,u)=>{let{participantId:c}=l;c&&(sc(e,c),e[c].setsWon+=o[u],e[c].setsLost+=o[1-u],t||(e[c].gamesWon+=s[u],e[c].gamesLost+=s[1-u]))})}function VB({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:o,isTieMatchUp:s,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let m=c&&c-1,h=1-m;n&&l===ti&&cue({participantResults:r,sides:p,score:d}),s||Xq({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:o});let f=fO({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=qq({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:v}=Yq({score:d,matchUpFormat:a});t&&(r[t].setsWon+=f[m],r[t].setsLost+=f[h],e||(r[t].gamesWon+=g[m],r[t].gamesLost+=g[h]),r[t].pointsWon+=v[m],r[t].pointsLost+=v[h]),i&&(r[i].setsWon+=f[h],r[i].setsLost+=f[m],e||(r[i].gamesWon+=g[h],r[i].gamesLost+=g[m]),r[i].pointsWon+=v[h],r[i].pointsLost+=v[m])}function Xq({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===zt&&(i[e].walkovers+=1),r===Mt&&(i[e].defaults+=1),r===mn&&(i[e].retirements+=1),[Mt,mn,zt].includes(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function fue({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(o=>{o.participantId&&o.participant&&(r[o.participantId]=o.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,o)=>{var s,l;if((s=a.excludedDirectives)!=null&&s.length){let u=a.excludedDirectives.map(({attribute:p})=>p).join(", "),c=`${u.length} directives were excluded due to participants limit}`;n.push(c);let d=`Excluded: ${u}`;n.push(d)}else{let u=(f,g)=>parseFloat(a.reversed?f:g)-parseFloat(a.reversed?g:f),c=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=f=>{f.groups&&Object.keys(f.groups).sort(u).forEach(g=>{let v=f.groups[g].map(I=>r[I]).join(", "),y=`${g} ${f.attribute}: ${v}`;n.push(y)})},p=a.reversed?" in reverse order":"",m=a.groups?"grouped":"separated",h=`Step ${o+1}: ${c} particiants were ${m}${p} by ${a.attribute}`;if(n.push(h),a.idsFilter){let f=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;n.push(f)}d(a)}n.push("----------------------")}),n.push("Final Order:"),e.forEach(a=>{let{participantId:o,resolved:s}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[o]} => resolved: ${!!s}`)}),n.join(`\r
`)}function Jq({participantResults:t,participantIds:e,attribute:i}){return Zq({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:o}=n,s=o==null?void 0:o[i];return!isNaN(s)&&a&&(r[s]?r[s].push(a):r[s]=[a]),r},{})}function Zq(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var gue=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],pC={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function jB(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!vue(t))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n==null?void 0:n.groupOrderKey)?n.groupOrderKey:"matchUpsWon",s=Jq({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l=Object.keys(s).map(g=>parseFloat(g)).sort((g,v)=>v-g).map(g=>s[g]).map(g=>{let v=Qq({participantIds:g,...t});return a.push(...v.report??[]),v.order}).map((g,v)=>g.map(y=>y.resolved?y:{...y,subGroup:[v].concat(...y.subGroup??[])})).flat(),u,c=0,d=1,p;l.forEach((g,v)=>{var I;v&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let y=parseInt(((I=g.subGroup)==null?void 0:I.join(""))||0);g.resolved?(g.position=v+1,d=g.position):(u&&y>u&&(d+=c,c=0),g.position=d,c+=1),u=y});let m=l.map(({position:g})=>g),h=wa(m);return l.forEach(g=>{let{participantId:v,position:y}=g||{},I=i[v];g.GEMscore=f(I);let b=h[y];(g==null?void 0:g.position)!==void 0&&(b>1&&(g.ties=b,r&&(g.subOrder=r[v])),g.rankOrder=y,g.groupOrder=y+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function f(g){return(Array.isArray(n==null?void 0:n.GEMscore)?Object.keys(pC).filter(v=>n.GEMscore.includes(v)):Object.keys(pC)).map(v=>(g[v]||0)*Math.pow(10,pC[v].toFixed(3))).reduce((v,y)=>v+y,0)}}function vue({participantResults:t,participantsCount:e}){let i=Zq({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function Iue({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:r,attribute:n,idsFilter:a,matchUps:o,reversed:s}){let{participantResults:l}=vb({participantIds:a&&e,matchUpFormat:i,tallyPolicy:r,matchUps:o}),u=Jq({participantResults:l,participantIds:e,attribute:n}),c=[{attribute:n,reversed:s,groups:u,idsFilter:a}],d;return Object.keys(u).length>1&&e.length&&(d=Object.keys(u).map(p=>parseFloat(p)).sort((p,m)=>s?p-m:m-p).map(p=>u[p]).map(p=>{let m=Qq({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:r,matchUps:o});return c.push(...m.report??[]),m.order}).map((p,m)=>p.map(h=>h.resolved?h:{...h,subGroup:[m].concat(...h.subGroup??[])})).flat()),{order:d,report:c}}function Qq({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let o=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(n!=null&&n.headToHead)||!n.headToHead.disabled&&!e)){let c=yue({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:c,headToHeadWinner:d,report:s}}}let u=((n==null?void 0:n.tallyDirectives)||gue).filter(c=>{let d=!(Li(c.maxParticipants)&&(i==null?void 0:i.length)>c.maxParticipants);return d||o.push(c),d});return o.length&&s.push({excludedDirectives:o,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,disableHeadToHead:m})=>(l=Iue({disableHeadToHead:m,participantIds:i,matchUpFormat:r,tallyPolicy:n,attribute:c,idsFilter:p,matchUps:a,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(c=>({participantId:c})),report:s}}function yue({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function Hg({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:o}){if(!(n!=null&&n.length)||!wo(n))return{error:Bu};let s=ct(n.map(({structureId:b})=>b));if(s.length!==1)return ee({result:{error:oe,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:s}});let l=n.filter(b=>b&&b.matchUpStatus!==Vt),u=l.length&&ct(l.map(({drawPositions:b})=>b).flat()).length,c=l.filter(b=>Pd({matchUp:b})).length===l.length;c||(o=0);let d=n.every(({matchUpType:b,tieMatchUps:S})=>b===hi&&(S==null?void 0:S.every(w=>Pd({matchUp:w})))),p=t==null?void 0:t[iA],m=n.filter(b=>Pd({matchUp:b})||b.matchUpType===hi),{participantResults:h}=vb({matchUps:m,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:o}),f,g,{groupOrder:v,report:y}=jB({matchUps:m,participantResults:h,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a});if(i&&bue({participantResults:h}),c&&v)f=y,g=v,v.forEach(b=>{let{participantId:S,groupOrder:w,rankOrder:U,subOrder:T,ties:D,GEMscore:P}=b,C=h[S];Object.assign(C,{groupOrder:w,rankOrder:U,GEMscore:P,subOrder:T,ties:D})});else{let{groupOrder:b,report:S}=jB({requireCompletion:!1,participantResults:h,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});f=S,g=b,b&&b.forEach(w=>{let{participantId:U,groupOrder:T,GEMscore:D}=w,P=h[U];Object.assign(P,{provisionalOrder:T,GEMscore:D})})}let I={completedTieMatchUps:d,readableReport:"",participantResults:h,bracketComplete:c,order:[],report:f};if((c||d)&&(I.order=g),e||Fa({tally:!0})){let b=fue({matchUps:n,report:f,order:g});Fa({tally:!0})&&console.log(b),I.readableReport=b}return I}function bue({participantResults:t}){let e=n=>n.reduce((a,o)=>a+parseFloat(o),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:o}=a,s=o!=null&&o.length?i(o):0;return{participantId:n,averagePressure:s}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function e3({positionAssignments:t}){let e=(t||[]).filter(Ta(Vl)).map(n=>{let{extension:a}=gt({element:n,name:xf}),o=Ze(a==null?void 0:a.value),s=!isNaN(o)&&o;return s&&{participantId:n.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=wa(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function vO({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!wo(n))return{error:oe};if(!t)return{error:oe};let{policyDefinitions:o}=Hu({policyTypes:[iA],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:s}=e3({positionAssignments:t}),l=n.length?Hg({policyDefinitions:o,matchUpFormat:r,subOrderMap:s,matchUps:n}):void 0;if(l!=null&&l.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(m=>{let{participantId:h}=m;if(p.includes(h)){let f={value:u[h],name:Sc};Lt({element:m,extension:f}),u[h].ties||Un({element:m,name:xf})}else Un({element:m,name:Sc}),Un({element:m,name:xf})}),si({drawDefinition:i}),{...J,participantResults:u,bracketComplete:c,report:d}}function t3({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function wi(t){let e=ze(t,[{[Fn]:!0,[hl]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:o,matchUpId:s,inContext:l,context:u,event:c}=t,{structures:d=[]}=Zo({drawDefinition:a}),p=t.contextContent||n&&zu({contextProfile:n,drawDefinition:a});for(let m of d){let{matchUps:h}=Wt({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:o,inContext:l,structure:m,context:u,event:c}),{matchUp:f}=t3({matchUps:h,matchUpId:s});if(f)return{matchUp:f,structure:m}}return{error:dn}}function HT(t){var e;return!Nt(t)||!t.notes?{error:Xe}:Nt(t.element)?!Ti(t.notes)&&!((e=t.notes)!=null&&e.testing)?{error:oe}:(Object.assign(t.element,{notes:t.notes}),{...J}):{error:oe}}function IO(t){return Nt(t)?Nt(t.element)?(t.element.notes&&delete t.element.notes,{...J}):{error:oe}:{error:Xe}}var zT={matchUpStatus:Ji,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function zs(t){var U,T,D,P,C,R,N,A;let e="modifyMatchUpScore",i=t.matchUpFormat,r=t.matchUp,n,{matchUpStatusCodes:a,tournamentRecord:o,drawDefinition:s,matchUpStatus:l,removeScore:u,winningSide:c,matchUpId:d,event:p,notes:m,score:h}=t,f=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(U=$t({policyTypes:[Ps],tournamentRecord:o,drawDefinition:s,structure:n,event:p}))==null?void 0:U.appliedPolicies,g=r.matchUpType===hi;if(g&&s){if(d&&r.matchUpId!==d){let M=wi({drawDefinition:s,matchUpId:d,event:p});if(!M.matchUp)return{error:dn};({matchUp:r,structure:n}=M)}}else r.matchUpId!==d&&console.log("!!!!!");l&&[zt,er].includes(l)||u?Object.assign(r,{...zT}):h&&(r.score=h);let v=l&&(r==null?void 0:r.matchUpStatus)===Mt&&l!==Mt;l&&(r.matchUpStatus=l),i&&(r.matchUpFormat=i),a&&(r.matchUpStatusCodes=a),c&&(r.winningSide=c),t.removeWinningSide&&(r.winningSide=void 0),!n&&s&&({structure:n}=wi({drawDefinition:s,matchUpId:d,event:p})),l&&!r.winningSide&&vr(r)&&!gr.includes(l)&&![Ym,Wc,co].includes(l)&&(r.matchUpStatus=os);let y;if((v&&((T=r==null?void 0:r.processCodes)!=null&&T.length)||l===Mt)&&(y=(P=(D=f==null?void 0:f[Ps])==null?void 0:D.processCodes)==null?void 0:P.incompleteAssignmentsOnDefault),!r.collectionId){let M=(n==null?void 0:n.structureType)===xn,E=zn({structure:n});if(OA({drawDefinition:s,structure:n})||E||M){let O=F=>{i=g?"SET1-S:T100":i??r.matchUpFormat??(F==null?void 0:F.matchUpFormat)??(s==null?void 0:s.matchUpFormat)??(p==null?void 0:p.matchUpFormat);let $=g?{matchUpTypes:[hi]}:void 0,{matchUps:_}=Wt({afterRecoveryTimes:!1,tournamentRecord:o,inContext:!0,matchUpFilters:$,drawDefinition:s,structure:F,event:p});return E&&(F.positionAssignments=ct(_.flatMap(L=>(L.sides??[]).map(B=>B.participantId)).filter(Boolean)).map(L=>({participantId:L}))),vO({positionAssignments:F.positionAssignments,tournamentRecord:o,drawDefinition:s,matchUpFormat:i,matchUps:_,event:p})},k=M&&n.structures.find(F=>F==null?void 0:F.matchUps.find($=>$.matchUpId===d)),x=O(k||n);if(x.error)return ee({result:x,stack:e})}}if(m){let M=HT({element:r,notes:m});if(M.error)return ee({result:M,stack:e})}let I=o==null?void 0:o.tournamentId,b=vo().topics.includes(ST),S=(b||y)&&sn({drawDefinition:s}),w=S&&((C=mr({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:o,inContext:!0,drawDefinition:s,matchUpsMap:S}).matchUps)==null?void 0:C[0]);if(b&&w&&boe({tournamentId:I,inContextMatchUp:w}),Array.isArray(y)&&w&&!((R=w.sides)!=null&&R.every(({participantId:M})=>M)))if(l===Mt)r.processCodes=ct([...r.processCodes??[],...y]);else for(let M of y||[]){let E=M&&((N=r==null?void 0:r.processCodes)==null?void 0:N.lastIndexOf(M));(A=r==null?void 0:r.processCodes)==null||A.splice(E,1)}return Rt({eventId:p==null?void 0:p.eventId,context:e,drawDefinition:s,tournamentId:I,matchUp:r}),{...J}}function yO(t){var h,f,g,v;let{matchUpStatusCodes:e,matchUpStatus:i,structure:r,matchUp:n,dualMatchUp:a,inContextMatchUp:o,autoCalcDisabled:s}=t,l=rb({matchUpStatus:i})||[ju,$a].includes(i)&&a||s,u=((h=n==null?void 0:n.sides)==null?void 0:h.map(y=>y.participantId).filter(Boolean).length)||((f=o==null?void 0:o.sides)==null?void 0:f.map(y=>y.participantId).filter(Boolean).length),c="attemptToModifyScore";if(!(zn({structure:r})&&u===1||i===Mt&&u||wue({structure:r,matchUp:n,inContextMatchUp:o})||((v=(g=t.appliedPolicies)==null?void 0:g[Ps])==null?void 0:v.requireParticipantsForScoring)===!1))return ee({result:{error:dN},stack:c});let d=[zt].includes(i),p=l?i:t.winningSide&&qi||co,m=zs({...t,matchUpStatusCodes:l&&e||[],matchUpStatus:p,context:c,removeScore:d});return ee({result:m,stack:c})}function wue({structure:t,matchUp:e,inContextMatchUp:i}){var s;let{drawPositions:r}=e,{positionAssignments:n}=Rr({structure:t}),a=n==null?void 0:n.filter(l=>(r==null?void 0:r.includes(l.drawPosition))&&l.participantId),o=(s=i==null?void 0:i.sides)==null?void 0:s.every(l=>l.participantId);return(a==null?void 0:a.length)===2||o}function i3({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>ot(r==null?void 0:r.groupValue)&&(r==null?void 0:r.groupNumber)).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>Ze(r));return{groupValueGroups:e,groupValueNumbers:i}}function Uue({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(y=>y.collectionId===t.collectionId),o=[0,0],s=[0,0],l=a.every(y=>gr.includes(y.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:m,scoreValue:h,setValue:f}=t,g=c&&e.includes(c),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),ot(p)?a.forEach(y=>{y.winningSide&&(o[y.winningSide-1]+=p)}):ot(f)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(S=>{S.winningSide&&(o[S.winningSide-1]+=f)})}):ot(h)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(S=>{let{side1TiebreakScore:w=0,side2TiebreakScore:U=0,side1Score:T=0,side2Score:D=0}=S;(y.matchUpStatus===qi||y.winningSide||S.winningSide)&&(T||D?(o[0]+=T,o[1]+=D):(w||U)&&S.winningSide&&(o[S.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(y=>{if(y.winningSide){let I=y.collectionPosition,b=Sue({collectionDefinition:t,collectionPosition:I});ot(b)&&(o[y.winningSide-1]+=b)}}),ot(d)){let y;if(m!=null&&m.aggregateValue)l&&(ot(p||f||h)&&o[0]!==o[1]?y=o[0]>o[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(m!=null&&m.valueGoal)y=o.reduce((I,b,S)=>b>=m.valueGoal?S+1:I,0);else{let I=Math.floor(t.matchUpCount/2)+1;y=v.reduce((b,S,w)=>S>=I?w+1:b,0)}y&&(g?i[c].values[y-1]+=d:s[y-1]+=d)}else g?(i[c].values[0]+=o[0]||0,i[c].values[1]+=o[1]||0):s=o;g?(i[c].sideWins[0]+=v[0]||0,i[c].sideWins[1]+=v[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):s.forEach((y,I)=>r[I]+=y||0)}function Sue({collectionDefinition:t,collectionPosition:e}){var i,r;return(r=(i=t.collectionValueProfiles||[])==null?void 0:i.find(n=>n.collectionPosition===e))==null?void 0:r.matchUpValue}function Ib(t){var b,S,w,U,T;let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:o,event:s}=t;if(!Array.isArray(e)||e.length!==2||isNaN(e.reduce((D,P)=>D+P)))return{error:oe};if(!o)return{error:na};let l=((b=vn({matchUp:o,drawDefinition:r,structure:a,event:s}))==null?void 0:b.tieFormat)||(t==null?void 0:t.tieFormat);if(!l)return{error:Pg};let u=Hn({tieFormat:l});if(u.error)return u;let c=(l==null?void 0:l.collectionDefinitions)||[],d=(o==null?void 0:o.tieMatchUps)??[],p=[0,0],{groupValueGroups:m,groupValueNumbers:h}=i3(l);for(let D of c)Uue({collectionDefinition:D,groupValueNumbers:h,groupValueGroups:m,sideTieValues:p,tieMatchUps:d});for(let D of h){let P=m[D],{allGroupMatchUpsCompleted:C,matchUpCount:R,winCriteria:N,groupValue:A,sideWins:M,values:E}=P,O;if(N!=null&&N.aggregateValue)C&&E[0]!==E[1]&&(O=E[0]>E[1]?1:2);else if(N!=null&&N.valueGoal)O=E.reduce((k,x,F)=>x>=N.valueGoal?F+1:k,void 0);else{let k=Math.floor(R/2)+1;O=M.reduce((x,F,$)=>F>=k?$+1:x,void 0)}O&&(p[O-1]+=A||0)}let f=p.map((D,P)=>(D||0)+e[P]),g={side1Score:f[0],side2Score:f[1],winningSide:void 0},v=f.join(i),y=f.slice().reverse().join(i),I;if(l!=null&&l.winCriteria){let{valueGoal:D,aggregateValue:P,tallyDirectives:C}=l.winCriteria;if(D?I=(S=f.map((R,N)=>({sideNumber:N+1,points:R})).find(({points:R})=>R>=D))==null?void 0:S.sideNumber:P&&d.every(R=>R.matchUpStatus&&gr.includes(R.matchUpStatus)||R.winningSide)&&f[0]!==f[1]&&(I=f[0]>f[1]?1:2),!I&&C){let R=o.matchUpId,N=o.hasContext?o:((w=n==null?void 0:n.drawMatchUps)==null?void 0:w[R])||r&&((U=wi({inContext:!0,drawDefinition:r,matchUpId:R}))==null?void 0:U.matchUp);if(N){let{completedTieMatchUps:A,order:M}=Hg({matchUps:[N]});if(A&&(M!=null&&M.length)){let E=M[0].participantId;I=(T=N.sides.find(({participantId:O})=>O===E))==null?void 0:T.sideNumber}}}}return I&&(g.winningSide=I),{scoreStringSide1:v,scoreStringSide2:y,winningSide:I,set:g}}function yb({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){var a,o;if(r){t||(t=(a=wi({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:s}=gt({element:e,name:Uu}),l=Me((s==null?void 0:s.value)||{},!1,!0),u=({displaySideNumber:c,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:c});r.sides=(o=t==null?void 0:t.sides)==null?void 0:o.map(c=>{var g;let d=c.participantId,p=d&&l[d]||void 0,{lineUp:m,...h}=((g=r.sides)==null?void 0:g.find(({sideNumber:v})=>v===c.sideNumber))??{},f=m!=null&&m.length?m:p;return{...u(c),...h,lineUp:f}}),Rt({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function qr(t){if(t)return Me(t,!1,!0)}function bO(t){let e=ze(t,[{[pn]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:s})=>s),o=n.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...o),i.eventIds.push(...a),i.drawIds.push(...o),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function r3({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=bO({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&(r==null?void 0:r[n].includes(e))||i&&(r==null?void 0:r[n].includes(i)))}function Wu(t){var R,N,A,M;let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:o,event:s}=t,l=t.tournamentRecords||t.tournamentRecord&&{[(R=t.tournamentRecord)==null?void 0:R.tournamentId]:t.tournamentRecord}||{},u=t.tournamentId||((N=t.tournamentRecord)==null?void 0:N.tournamentId);l&&r3({tournamentRecords:l,...t});let c=u&&l[u];if(!c)return{error:ge};let d=wi({drawDefinition:i,event:s,matchUpId:o});if(d.error)return d;if(!d.matchUp)return{error:dn};let{matchUp:p,structure:m}=d;if(!p.tieMatchUps)return{error:aa};yb({tournamentId:c==null?void 0:c.tournamentId,eventId:s==null?void 0:s.eventId,dualMatchUp:p,drawDefinition:i});let{extension:h}=gt({name:bm,element:p});if(h!=null&&h.value)if(n)Un({element:p,name:bm});else return{...J,score:p.score};let f=(A=vn({drawDefinition:i,structure:m,matchUp:p,event:s}))==null?void 0:A.tieFormat;p.tieFormat=qr(f);let g=Ib({drawDefinition:i,matchUpsMap:a,structure:m,matchUp:p,event:s}),{winningSide:v,set:y,scoreStringSide1:I,scoreStringSide2:b}=g,S=(y==null?void 0:y.side1Score)||(y==null?void 0:y.side2Score);if(e&&!p.score&&!S)return{...J};let w={scoreStringSide1:I,scoreStringSide2:b,sets:y?[y]:[]},U=v&&[1,2].includes(v),T=U&&qi||$A({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:w})&&os||Ji,D=!!(p.winningSide&&!U),P=p.tieMatchUps.find(({score:E,winningSide:O,matchUpStatus:k})=>{var x;return((x=E==null?void 0:E.sets)==null?void 0:x.length)&&(E.sets[0].side1Score||E.sets[0].side2Score)||k&&gr.includes(k)||O}),C;if(p.tieFormat&&!U&&!P){let E=(M=vn({drawDefinition:i,structure:m,event:s}))==null?void 0:M.tieFormat;E&&JSON.stringify(f)===JSON.stringify(E)&&(p.tieFormatId=void 0,p.tieFormat=void 0,C=!0)}return zs({appliedPolicies:t.appliedPolicies,matchUpStatus:T,score:w,removeWinningSide:D,tournamentRecord:c,drawDefinition:i,removeScore:n,winningSide:v,matchUpId:o,matchUp:p,event:s}),{...J,score:w,removeWinningSide:D,tieFormatRemoved:C,winningSide:v}}function Tue({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){var h,f,g,v,y;let m="directWinner";if(o){let I=u.drawPositions||[],b=I[t],S=o.source.structureId,w=et({structureId:S,drawDefinition:l});if(w.error)return w;let{structure:U}=w,{positionAssignments:T}=Rr({structureId:S,drawDefinition:l}),D=(h=T==null?void 0:T.find(M=>M.drawPosition===n))==null?void 0:h.participantId,P=o.target.structureId,{positionAssignments:C}=Rr({structureId:P,drawDefinition:l}),R=(f=C==null?void 0:C.find(M=>M.participantId===D))==null?void 0:f.drawPosition,N=C==null?void 0:C.filter(M=>{let E=I.includes(M.drawPosition),O=!M.participantId&&!M.bye&&!M.qualifier;return E&&O}).map(M=>M.drawPosition),A=N==null?void 0:N.includes(b);if(D&&o.target.roundNumber===1&&A)il({drawPosition:b,participantId:D,structureId:P,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(D&&(N!=null&&N.length)){let M=N.pop();M&&il({participantId:D,structureId:P,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:M,matchUpsMap:d,event:p})}else if(R){let M=$f({drawPosition:R,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(M.error)return ee({result:M,stack:m})}else if((U==null?void 0:U.stage)!==Ye){let M="winner target position unavaiallble";return console.log(M),{error:M}}if(U!=null&&U.seedAssignments&&U.structureId!==P){let M=U.seedAssignments.find(({participantId:O})=>O===D),E=M==null?void 0:M.participantId;M&&E&&Vg({eventId:u==null?void 0:u.eventId,structureId:P,...M,tournamentRecord:a,drawDefinition:l,participantId:E})}}else{let I=$f({matchUpId:u.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(I.error)return I}if(c&&i){let I=(g=c.sides)==null?void 0:g.find(b=>b.sideNumber===i);if(I!=null&&I.lineUp){let b=c.roundPosition,S=u.roundPosition,w=b===S&&b!==1||Math.floor(b/2)===S?2:1,U=(v=d==null?void 0:d.drawMatchUps)==null?void 0:v.find(({matchUpId:P})=>P===u.matchUpId),T=[1,2].map(P=>{var C;return{...((C=U.sides)==null?void 0:C.find(R=>R.sideNumber===P))||{},sideNumber:P}});U.sides=T;let D=U.sides.find(P=>P.sideNumber===w);if(D){let P=(y=I.lineUp)==null?void 0:y.filter(C=>C==null?void 0:C.participantId);D.lineUp=eO({lineUp:P}),Rt({tournamentId:a==null?void 0:a.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:U,context:m,drawDefinition:l})}}}return{...J}}function Due(t){var F,$,_;let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:r,sourceMatchUpStatus:n,loserDrawPosition:a,tournamentRecord:o,loserTargetLink:s,drawDefinition:l,loserMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}=t,m="directLoser",h=s.linkCondition,f=u.drawPositions||[],g=h===el&&u.roundNumber===2&&Math.min(...f.filter(Boolean)),v=g||f[e],y=g||f[1-e],I=s.source.structureId,{structure:b}=et({structureId:I,drawDefinition:l}),{matchUps:S}=Wt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:b,event:p}),w=S.filter(L=>{var B;return(B=L.drawPositions)==null?void 0:B.includes(a)}).filter(L=>{let B=L.sides.find(G=>G.drawPosition===a),V=L.matchUpStatus===zt||L.matchUpStatus===Mt&&!vr(L);return(B==null?void 0:B.sideNumber)===L.winningSide&&!V}),U=h===el&&w.length===0,{positionAssignments:T}=Rr({structureId:I,drawDefinition:l}),D=(F=T==null?void 0:T.find(L=>L.drawPosition===a))==null?void 0:F.participantId,P=s.target.structureId,{positionAssignments:C}=Rr({structureId:P,drawDefinition:l}),R=C==null?void 0:C.filter(({drawPosition:L})=>f.includes(L));if(R!=null&&R.some(L=>L.participantId===D))return{...J};let N=R==null?void 0:R.filter(L=>{let B=f.includes(L.drawPosition),V=!L.participantId&&!L.bye&&!L.qualifier;return B&&V}).map(L=>L.drawPosition),A=N==null?void 0:N.includes(v),M=s.target.roundNumber>1&&(N==null?void 0:N.length),E=s.target.roundNumber===1&&A;if(g){let L=O();if(L.error)return ee({result:L,stack:m})}else if(E){let L=x();if(L.error)return ee({result:L,stack:m})}else if(D&&M){N.sort(or);let L=N[0],B=il({participantId:D,structureId:P,drawPosition:L,inContextDrawMatchUps:i,sourceMatchUpStatus:n,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p});if(B.error)return ee({result:B,stack:m})}else return ee({context:{loserDrawPosition:a,loserTargetLink:s,targetDrawPositionIsUnfilled:A},result:{error:A?Sg:Ine},stack:m});if(b!=null&&b.seedAssignments&&b.structureId!==P){let L=b.seedAssignments.find(({participantId:V})=>V===D),B=L==null?void 0:L.participantId;L&&B&&Vg({eventId:u==null?void 0:u.eventId,structureId:P,...L,tournamentRecord:o,drawDefinition:l,participantId:B})}if(c&&r){let L=($=c.sides)==null?void 0:$.find(B=>B.sideNumber===3-r);if(L!=null&&L.lineUp){let{roundNumber:B,eventId:V}=u,{roundPosition:G}=c,j=B===1?2-G%2:1,z=(_=d==null?void 0:d.drawMatchUps)==null?void 0:_.find(({matchUpId:Y})=>Y===u.matchUpId),q=[1,2].map(Y=>{var re;return{...((re=z.sides)==null?void 0:re.find(K=>K.sideNumber===Y))||{},sideNumber:Y}});z.sides=q;let W=z.sides.find(Y=>Y.sideNumber===j);W&&(W.lineUp=eO({lineUp:L.lineUp}),Rt({tournamentId:o==null?void 0:o.tournamentId,matchUp:z,context:m,drawDefinition:l,eventId:V}))}}return{...J};function O(){let L="loserLinkFedFMLC";return ee(U?{result:x(),stack:L}:{result:k(),stack:L})}function k(){let L=Ya({drawPosition:y,structureId:P,tournamentRecord:o,drawDefinition:l,event:p});return ee({result:L,stack:"assignLoserPositionBye"})}function x(){let L=D?il({drawPosition:v,participantId:D,structureId:P,inContextDrawMatchUps:i,sourceMatchUpStatus:n,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p}):{error:pr};return ee({result:L,stack:"assignLoserDrawPosition"})}}function n3(t){var w;let e="directParticipants",i=yO(t);if(i.error)return ee({result:i,stack:e});let r=rb({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,projectedWinningSide:a,inContextDrawMatchUps:o,tournamentRecord:s,drawDefinition:l,matchUpStatus:u,dualMatchUp:c,matchUpsMap:d,winningSide:p,targetData:m,matchUpId:h,structure:f,matchUp:g,event:v}=t,y=!!g.collectionId,I=zn({structure:f}),b=g.drawPositions,S;if(y){let{matchUpTieId:U,matchUpsMap:T}=t,D=Wu({appliedPolicies:t.appliedPolicies,matchUpId:U,tournamentRecord:s,drawDefinition:l,matchUpsMap:T,event:v});if(S=D&&{tieMatchUpResult:D},b=(w=o.find(({matchUpId:P})=>P===U))==null?void 0:w.drawPositions,!n)return ee({result:{...J,...S},stack:e})}if(I)return ee({result:{...J,...S},stack:e});if(b){let U=a?a-1:p-1,T=1-U,D=b[U],P=b[T],{targetLinks:{loserTargetLink:C,winnerTargetLink:R,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:A,loserMatchUpDrawPositionIndex:M,winnerMatchUp:E,loserMatchUp:O,byeMatchUp:k}}=m;if(E){let x=Tue({sourceMatchUpStatus:r&&u||qi,winnerMatchUpDrawPositionIndex:A,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:a,winningDrawPosition:D,tournamentRecord:s,winnerTargetLink:R,drawDefinition:l,winnerMatchUp:E,dualMatchUp:c,matchUpsMap:d,event:v});if(x.error)return ee({result:x,stack:e})}if(O){let x=Due({sourceMatchUpStatus:r&&u||qi,loserMatchUpDrawPositionIndex:M,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:a,loserDrawPosition:P,tournamentRecord:s,loserTargetLink:C,drawDefinition:l,loserMatchUp:O,winningSide:p,matchUpsMap:d,dualMatchUp:c,event:v});if(x.error)return ee({result:x,stack:e})}if(k){let x=k.drawPositions||[],F=Math.min(...x.filter(Boolean)),$=N.target.structureId,_=Ya({drawPosition:F,structureId:$,tournamentRecord:s,drawDefinition:l,event:v});if(_.error)return ee({result:_,stack:e})}}else return ee({result:{error:Dy},stack:e});return ee({result:{...J,...S},stack:e})}function wO(t){var j,z,q,W;let e="genPlayoffStructure";if(!t.drawDefinition)return ee({result:{error:_e},stack:e});let i=hb(t);if(i.error)return ee({result:i,stack:e});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:o,finishingPositionLimit:s,playoffAttributes:l,playoffPositions:u,roundOffsetLimit:c,tournamentRecord:d,exitProfileLimit:p,roundProfiles:m,roundNumbers:h,idPrefix:f,isMock:g,event:v,uuids:y}=t,I=Me(t.drawDefinition,!1,!0),{structure:b}=et({structureId:r,drawDefinition:I});if(!b)return ee({result:{error:Ei},stack:e});if(b.structureType===xn||b.structures)return nue({sourceStructureId:b.structureId,...t,...i,drawDefinition:I});let{playoffRoundsRanges:S,playoffRounds:w}=i,{playoffPositionsReturned:U,error:T,playoffSourceRounds:D,playoffRoundsRanges:P}=Bq(t);if(T)return ee({result:{error:T},stack:e});let C=(m==null?void 0:m.length)&&Object.assign({},...m),R=h||typeof m=="object"&&m.map(Y=>Object.keys(Y)).flat(),N=Array.isArray(R)&&R.map(Y=>!isNaN(Y)&&Ze(Y)).filter(Boolean);if(N){if(!Array.isArray(N))return ee({result:{error:oe},context:{validRoundNumbers:N},stack:e});N.forEach(Y=>{if(!(w!=null&&w.includes(Y)))return ee({result:{error:oe},context:{roundNumber:Y},stack:e})})}u&&u.forEach(Y=>{if(!(U!=null&&U.includes(Y)))return ee({result:{error:oe},context:{playoffPosition:Y},stack:e})});let A=N||D,M=N?S:P,E=[],O=[];for(let Y of A??[]){let re=M==null?void 0:M.find(ne=>ne.roundNumber===Y);if(!re)return ee({result:{error:oe},context:{roundNumber:Y},stack:e});let K=re.finishingPositions.length,H=Math.min(...re.finishingPositions)-1,Q=2,X=Y&&(C==null?void 0:C[Y])&&Q+C[Y]-1,ie=gf({exitProfile:`0-${Y}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:H,playoffAttributes:l,exitProfileLimit:p,stage:$i,roundOffset:0,drawDefinition:I,sequenceLimit:X,stageSequence:Q,drawSize:K,idPrefix:f,isMock:g,uuids:y,finishingPositionNaming:o,finishingPositionLimit:s,roundOffsetLimit:c});if(ie.error)return ee({result:ie,stack:e});let{structures:ae,links:le}=ie;if(ae!=null&&ae.length&&E.push(...ae),le!=null&&le.length&&O.push(...le),ie.structureId&&Y){let ne={linkType:$l,source:{structureId:r,roundNumber:Y},target:{structureId:ie.structureId,feedProfile:Fo,roundNumber:1}};O.push(ne)}}if(!E.length)return ee({result:{error:oe},info:"No structures generated",stack:e});I.structures.push(...E),I.links.push(...O);let{matchUps:k,matchUpsMap:x}=mr({inContext:!0,drawDefinition:I}),F=E.map(({structureId:Y})=>Y),$=k==null?void 0:k.filter(({structureId:Y})=>F.includes(Y)).map(Tr),_=(j=x==null?void 0:x.drawMatchUps)==null?void 0:j.filter(({matchUpId:Y})=>$==null?void 0:$.includes(Y));if(_!=null&&_.length){let Y=(z=vn({drawDefinition:I,event:v}))==null?void 0:z.tieFormat;Y&&_.forEach(re=>{let{tieMatchUps:K}=fb({matchUp:re,tieFormat:Y,isMock:g});Object.assign(re,{tieMatchUps:K,matchUpType:hi})})}(q=k==null?void 0:k.filter(Y=>Pd({matchUp:Y})&&Y.structureId===r))==null||q.forEach(Y=>{let{matchUpId:re,score:K,winningSide:H}=Y,Q=En({inContextDrawMatchUps:k,drawDefinition:I,matchUpId:re}),X=n3({inContextDrawMatchUps:k,tournamentRecord:d,drawDefinition:I,matchUpsMap:x,winningSide:H,targetData:Q,matchUpId:re,structure:b,matchUp:Y,score:K,event:v});X.error&&console.log(X.error)}),(W=k==null?void 0:k.filter(Y=>Y.matchUpStatus===Vt&&Y.structureId===r))==null||W.forEach(Y=>{let{matchUpId:re}=Y,K=En({inContextDrawMatchUps:k,drawDefinition:I,matchUpId:re}),{targetLinks:{loserTargetLink:H},targetMatchUps:{loserMatchUpDrawPositionIndex:Q,loserMatchUp:X}}=K;if(H&&X){let ie=H.target.structureId,ae=X.drawPositions[Q],le=Ya({drawPosition:ae,structureId:ie,tournamentRecord:d,drawDefinition:I,event:v});le.error&&console.log(le.error)}});let L=[],B=_d({inContextDrawMatchUps:k,drawDefinition:I,matchUpsMap:x}).goesToMap,{structure:V}=et({drawDefinition:t.drawDefinition,structureId:r}),{matchUps:G}=Wt({structure:V});return G.forEach(Y=>{var H,Q;let re=B==null?void 0:B.loserMatchUpIds[Y.matchUpId];if(re&&Y.loserMatchUpId!==re){Y.loserMatchUpId=re;let X={tournamentId:d==null?void 0:d.tournamentId,eventId:(H=t.event)==null?void 0:H.eventId,context:e,matchUp:Y};L.push(X)}let K=B==null?void 0:B.winnerMatchUpIds[Y.matchUpId];if(K&&Y.winnerMatchUpId!==K){Y.winnerMatchUpId=K;let X={tournamentId:d==null?void 0:d.tournamentId,eventId:(Q=t.event)==null?void 0:Q.eventId,context:e,matchUp:Y};L.push(X)}}),{structures:E,matchUpModifications:L,links:O,drawDefinition:I,...J}}function a3({element:t}){if(!t)return{error:oe};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:oe};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function gl(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:TN};let a=hW(t);if(a.error)return a;if(!(Nt(n)&&Ti(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:SN};if(!a.timeItems)a.timeItems=[];else if(Pue({element:a,duplicateValues:e,timeItem:n}))return{...J};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let o=new Date().toISOString();Object.assign(n,{createdAt:o})}return r&&(a.timeItems=a.timeItems.filter(({itemType:o})=>n.itemType!==o)),r&&!n.itemValue||a.timeItems.push(n),{...J}}function Pue({element:t,duplicateValues:e,timeItem:i}){var s;let{itemType:r,itemSubTypes:n,itemValue:a}=i,o=r&&((s=yo({itemSubTypes:n,itemType:r,element:t}))==null?void 0:s.timeItem);return o&&JSON.stringify(o==null?void 0:o.itemValue)===JSON.stringify(a)&&!e}function UO({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:ge};if(!n)return{error:pr};let o=qc({tournamentRecord:i,participantId:n});return o.error?o:gl({element:o.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function bb(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:ge};let o=gl({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(o.error)return o;let s=a3({element:i});return lt({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:s},topic:cp}),o}function uh(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?gl({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:lo}}function o3(t){return WT({...t,itemType:"attachConsolationStructures"})}function SO(t){return WT({...t,itemType:"attachPlayoffStructures"})}function WT({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:o}){var g,v,y;let s="attachStructures";if(!r)return{error:_e};if(!Array.isArray(n)||!Array.isArray(a))return ee({result:{error:oe},stack:s});let l=I=>{var b;return[I.source.structureId,I.source.roundNumber||((b=I.source.finishingPositions)==null?void 0:b.join("|")),I.target.roundNumber].join("|")},u=(g=r.links)==null?void 0:g.map(l);if(a.some(I=>{let b=l(I);return u==null?void 0:u.includes(b)}))return ee({result:{error:EN},info:"playoff structure exists",stack:s});a.length&&((v=r.links)==null||v.push(...a));let c=n.map(({structureId:I})=>I),d=(y=r.structures)==null?void 0:y.map(({structureId:I})=>I);r.structures=(r.structures??[]).map(I=>c.includes(I.structureId)?n.find(({structureId:b})=>b===I.structureId):I);let p=n==null?void 0:n.filter(({structureId:I})=>!(d!=null&&d.includes(I)));p.length&&r.structures.push(...p),_d({drawDefinition:r});let m=n.map(I=>{var b;return((b=Wt({structure:I}))==null?void 0:b.matchUps)||[]}).flat();Dc({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUps:m});let h=n.map(({structureId:I})=>I);if(si({drawDefinition:r,structureIds:h}),e==null?void 0:e.length){let I={};e.forEach(S=>{var U;let w=(U=S.matchUp)==null?void 0:U.matchUpId;w&&(I[w]=S)});let b=S=>{S.matchUps.forEach(w=>{if(I[w.matchUpId]){let{tieMatchUps:U,...T}=I[w.matchUpId].matchUp;if(Object.assign(w,T),U==null?void 0:U.length){let D={};U.forEach(P=>I[P.matchUpId]=P),w.tieMatchUps.forEach(P=>Object.assign(P,D[P.matchUpId]))}I[w.matchUpId].matchUp=w,Rt(I[w.matchUpId])}})};r.structures.forEach(S=>{if(d!=null&&d.includes(S.structureId))if(S.structures)for(let w of S.structures)b(w);else b(S)})}let f=p.map(Ta("structureId"));if(i){let I={itemValue:{structureIds:h,drawId:r.drawId},itemType:t};gl({element:i,timeItem:I})}return{...J,addedStructureIds:f}}function qT(t){var o,s;let{structures:e,links:i,matchUpModifications:r,error:n}=wO(t);if(n)return{error:n};let a=t.drawDefinition;return SO({tournamentId:(o=t.tournamentRecord)==null?void 0:o.tournamentId,eventId:((s=t.event)==null?void 0:s.eventId)||t.eventId,matchUpModifications:r,drawDefinition:a,structures:e,links:i})}function Bd(t){let e=ze(t,[{_anyOf:{[pn]:!1,[br]:!1,[Fn]:!1,[Gc]:!1},[qN]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=GB(t,r);if(n.error)return n;i.push(...(n==null?void 0:n.applied)??[]),t.drawDefinition&&si({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ge};for(let a of n){let o=t.tournamentRecords[a],s=GB(t,o);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:ge};return i.length?{...J,applied:i}:{error:gN}}function GB(t,e){let i=$t(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:V0};for(let a of n)if(!i[a]||t.allowReplacement){let o=t.policyDefinitions[a];if(!o)continue;if(!Nt(o))return{error:oe};let{policyName:s,...l}=o;if(!l||!Object.keys(l).length||s&&!Ti(s))return{error:oe};i[a]=t.policyDefinitions[a],r.push(a)}return r!=null&&r.length?{...Lt({element:e,extension:{name:EI,value:i}}),applied:r}:{applied:r,error:gN}}function TO({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){var s;if(!r||typeof r!="string")return ee({result:{error:oe},context:{drawName:r}});i||(i=Gi({event:a}).flightProfile);let o=(s=i==null?void 0:i.flights)==null?void 0:s.find(l=>l.drawId===n);if(o){o.drawName=r;let l={name:Jo,value:{...i,flights:i.flights}};zc({event:a,extension:l})}return e&&(e.drawName=r,si({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!o&&!e?{error:_e}:{...J,flight:o}}function s3({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){var l;if(!Nt(i))return{error:oe};let a=Gi({event:n}).flightProfile,o=i.drawName&&TO({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:r,event:n});if(o!=null&&o.error)return o==null?void 0:o.error;let s=(o==null?void 0:o.flight)||((l=a==null?void 0:a.flights)==null?void 0:l.find(u=>u.drawId===r));if(!s&&!e)return{error:_e};if(s){let u={name:Jo,value:{...a,flights:a.flights}};zc({event:n,extension:u})}return e&&(i.policyDefinitions&&Bd({policyDefinitions:i.policyDefinitions,drawDefinition:e}),si({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...J}}function l3({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var o,s;if(!i)return{error:_e};let r=sn({drawDefinition:i}),n=l=>{var u;return(u=r==null?void 0:r.drawMatchUps)==null?void 0:u.find(c=>c.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:u,stage:c,stageSequence:d}=l;u&&(d!==1||![Ye,Oe].includes(c))&&(l.positionAssignments=u.map(h=>(delete h.participantId,h)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:m}=Wt({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:l});for(let h of p){let{matchUpId:f,roundNumber:g}=h,v=h.sides||[],y=n(f);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==Vt&&Object.assign(y,zT),g&&g>1&&((o=y.drawPositions)==null?void 0:o.length)&&!m){let I=v==null?void 0:v.map(({drawPosition:S,participantFed:w})=>!w&&S).filter(Boolean),b=y.drawPositions.map(S=>I.includes(S)?void 0:S);y.drawPositions=b}e?delete y.timeItems:(s=y.timeItems)!=null&&s.length&&(y.timeItems=y.timeItems.filter(I=>I.itemType&&![jl,Rc,Zm,xA,Qm,eh].includes(I.itemType))),Rt({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}i.extensions=i.extensions.filter(l=>l.name!==ff);let a=(i.structures||[]).map(({structureId:l})=>l);return si({drawDefinition:i,structureIds:a}),{...J}}function wb({tournamentRecord:t}){var r;if(!t)return{error:ge};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return((r=t.events)==null?void 0:r.map(n=>{let a=n.eventId;return i[a]=n,((n==null?void 0:n.drawDefinitions)||[]).map(o=>({drawDefinition:o,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:n,eventId:a})=>{let o=0,s=0,l=0,{allStructuresLinked:u}=VT({drawDefinition:n}),c=i[a],d=((n==null?void 0:n.structures)||[]).map(b=>{let{stage:S,stageSequence:w,structureId:U}=b,T=vm[S],{inContextStructureMatchUps:D}=nb({drawDefinition:n,structure:b,event:c}),P=D==null?void 0:D.filter(({winningSide:L})=>L),C=P.filter(Boolean).length||0;s+=C,l+=D.length-s;let R=Math.max(P.filter(({roundNumber:L})=>L===1).map(({roundPosition:L})=>L)),{positionAssignments:N}=ai({structure:b}),A=N==null?void 0:N.filter(({participantId:L})=>L);o+=(A==null?void 0:A.length)??0;let M=((N==null?void 0:N.length)??0)-((A==null?void 0:A.length)??0),{roundMatchUps:E,roundProfile:O,roundNumbers:k,maxMatchUpsCount:x}=Cn({matchUps:D}),F=O&&Object.keys(O).filter(L=>!O[L].inactiveRound).map(L=>parseInt(L)),$=O&&Object.keys(O).filter(L=>O[L].inactiveRound).map(L=>parseInt(L)),_=O&&Object.values(O).every(L=>L.inactiveRound);return{positionsAssignedCount:(A==null?void 0:A.length)??0,maxWinningSideFirstRoundPosition:R,unassignedPositionsCount:M,inactiveStructure:_,maxMatchUpsCount:x,inactiveRounds:$,roundMatchUps:E,activeRounds:F,roundNumbers:k,roundProfile:O,structureId:U,stageSequence:w,orderNumber:T,stage:S}}),p=d.find(b=>b.orderNumber===2&&b.stageSequence===1),m=d.filter(({inactiveStructure:b})=>!b).length,{links:h}=Lg({structureId:p.structureId,drawDefinition:n}),f=Ze(p.activeRounds[0])===1&&p.activeRounds.length===1&&m===1,g=d==null?void 0:d.every(({inactiveStructure:b})=>b),v=!h.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=n.drawId;o&&!s&&e.positionsNoOutcomes.push(y),g&&e.inactive.push(y),f&&e.matchPlay.push(y),v&&e.canBePruned.push(y);let I={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:o,allStructuresLinked:u,structuresData:d,inactiveDraw:g,isMatchPlay:f,drawId:y};e.drawAnalysis[y]=I}),{...J,drawsAnalysis:e}}function u3({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){var o;if(!e)return{error:ge};if(!i)return{error:_e};let n=[],{drawsAnalysis:a}=wb({tournamentRecord:e});if(a.canBePruned.includes(r)){let s=a.matchPlay.includes(r),l=a.drawAnalysis[r],{structures:[u]}=Zo({stageSequence:1,drawDefinition:i,stage:Oe}),c=l.structuresData.find(({structureId:h})=>u.structureId===h),d=(u.matchUps??[]).sort((h,f)=>h.roundPosition-f.roundPosition);n=d.filter(({roundNumber:h})=>!c.inactiveRounds.includes(h));let p=n.map(Tr),m=d.map(Tr).filter(h=>!p.includes(h));if(s){let h=n.filter(({roundNumber:I})=>!c.inactiveRounds.includes(I)).filter(({winningSide:I})=>I),f=h.map(Tr),g=p.filter(I=>!f.includes(I));m.push(...g);let v=h.flatMap(I=>I.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((I,b)=>({[I]:b+1})));if(h.forEach(I=>{t?I.drawPositions=I.drawPositions.map(b=>y[b]):delete I.drawPositions}),t){let I=(o=u==null?void 0:u.positionAssignments)==null?void 0:o.filter(b=>v.includes(b.drawPosition)).map(b=>(b.drawPosition=y[b.drawPosition],b));u.positionAssignments=I}else u.positionAssignments=[];u.matchUps=h,n=h}Gu({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:m,drawDefinition:i}),si({drawDefinition:i})}return{...J,matchUps:n}}function c3({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:o,bye:s}){if(!e)return{error:_e};if(!r)return{error:Tg};if(!n)return{error:za};if(s){let l=Ya({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:o});if(l.error)return l}else{if(a)return{error:X0};{let l=il({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,event:o});if(l.error)return l}}return{...J}}function d3(t){var l,u,c,d,p;let e=t.matchUpIds??[],{drawDefinition:i}=t,r=t.structureId??((u=(l=i==null?void 0:i.structures)==null?void 0:l.find(m=>{var h;return(h=m.matchUps)==null?void 0:h.some(({matchUpId:f})=>e.includes(f))}))==null?void 0:u.structureId)??((d=(c=i==null?void 0:i.structures)==null?void 0:c[0])==null?void 0:d.structureId);if(!r)return{error:Ei};let n=(p=i.structures)==null?void 0:p.find(m=>m.structureId===r);if(!n)return{error:Ei};let a=n==null?void 0:n.matchUps,o=a==null?void 0:a.find(m=>!!m.roundPosition);if(n.structures||o||n.finishingPosition===qm)return{error:op};let s=a.filter(({roundNumber:m})=>{var h;return(h=t.roundNumbers)==null?void 0:h.includes(m)}).map(Tr);return e=e.filter(m=>!s.includes(m)),t.roundNumbers&&!e.length&&(e=s),{existingMatchUps:a,matchUpIds:e,structureId:r,structure:n}}function p3(t){let e=ze(t,[{[Fn]:!0},{[Af]:{[Ly]:!1,roundNumbers:!1},[_a]:oe,[Xn]:un}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:o,event:s}=t,l=d3(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,m=[],h=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:I})=>{if(I&&!n)return!1;if(I||vr({score:y})){if(!I&&!i)return!1;m.push(v)}else if(!r)return!1;return p==null?void 0:p.includes(v)}))??[],f=h.map(Tr),g=h.map(({tieMatchUps:v})=>v==null?void 0:v.map(Tr)).filter(Boolean).flat();if(f.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:I})=>!f.includes(I)),Gu({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...f],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:o});let v=ct(u.matchUps.map(Ta("roundNumber"))),y=dne(v);if(y.length){y.reverse();for(let I of y)u.matchUps.forEach(b=>{b.roundNumber&&b.roundNumber>I&&(b.roundNumber-=1,Rt({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:b}))})}if(m.length){u.positionAssignments=ct(u.matchUps.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U}));let I=(u==null?void 0:u.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(s==null?void 0:s.matchUpFormat),b=l.existingMatchUps.some(U=>U.matchUpType===ka)?{matchUpTypes:[ka]}:void 0,{matchUps:S}=Wt({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:b,structure:u,event:s});zn({structure:u})&&(u.positionAssignments=ct(S.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U})));let w=vO({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:I,matchUps:S,event:s});w.error&&console.log(w)}si({structureIds:[c],eventId:s==null?void 0:s.eventId,drawDefinition:o})}return!f.length&&p.length?{error:Z0}:{...J,deletedMatchUpsCount:[...f,...g].length}}function m3({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:ge};if(!i)return{error:_e};if(!n)return ee({result:{error:Xe},info:"roundNumber required"});let o=et({drawDefinition:i,structureId:r});if(o.error)return o;let s=o.structure;return s!=null&&s.structures?{error:op}:zn({structure:s})?Rue({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:s}):(console.log("not implemented"),{...J})}function Rue({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let o=(n==null?void 0:n.matchUps)??[],s=[],l=[],u=!1;if(o.reduce((c,d)=>{let p=d==null?void 0:d.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(or).includes(r)){let c=o.filter(d=>{let p=d.roundNumber===r&&(!gr.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map(Tr))),!p});l.length&&(Gu({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===r)||(c.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Rt({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),n.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...J}}function YT(t){var p,m,h,f,g,v;let{suppressNotifications:e,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=t;if(typeof r!="object")return{error:_e};let o=t==null?void 0:t.structureId;if(!o&&((p=r.structures)==null?void 0:p.length)===1&&(o=(h=(m=r.structures)==null?void 0:m[0])==null?void 0:h.structureId),typeof o!="string")return{error:za};if(!wo(n))return{error:oe,info:$d("matchUps")};let s=(f=r.structures)==null?void 0:f.find(y=>y.structureId===o);if(!s)return{error:Ei};let l=(s==null?void 0:s.matchUps).find(y=>!!y.roundPosition);if(s.structures||l||s.finishingPosition===qm)return{error:op};let u=((v=(g=Br({tournamentRecord:i,inContext:!1}))==null?void 0:g.matchUps)==null?void 0:v.map(Tr))??[],c=n.map(Tr);if(Rn(u,c))return{error:yH,info:"One or more matchUpIds already present in tournamentRecord"};s.matchUps.push(...n);let d=n.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return e||(Dc({tournamentId:i==null?void 0:i.tournamentId,matchUps:[...d,...n],eventId:a==null?void 0:a.eventId,drawDefinition:r}),si({drawDefinition:r,structureIds:[o]})),{...J}}function h3({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){var m;if(!e)return{error:_e};if(!r)return{error:za};if(!i)return{error:Tg};let{structure:o}=et({drawDefinition:e,structureId:r});if(!o)return{error:Ei};let s=o;o.structures&&o.structureType===xn&&(s=(m=o.structures)==null?void 0:m.find(h=>{var f;return(f=h.positionAssignments)==null?void 0:f.find(g=>g.drawPosition===i)}));let l=s==null?void 0:s.positionAssignments,u=l==null?void 0:l.find(h=>h.drawPosition===i);u&&Lt({element:u,extension:{name:xf,value:n}});let c=((a==null?void 0:a.eventType)===hi||e.matchUpType===hi||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(o==null?void 0:o.tieFormat)))&&{matchUpTypes:[hi]},{matchUps:d}=Wt({structure:s,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:c,event:a}),p=(o==null?void 0:o.matchUpFormat)??e.matchUpFormat;return vO({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),si({drawDefinition:e,structureIds:[r]}),{...J}}var f3={};yt(f3,{addGoesTo:()=>_d,allPlayoffPositionsFilled:()=>nO,checkValidEntries:()=>JT,findDrawDefinition:()=>CO,getAssignedParticipantIds:()=>gp,getAvailableMatchUpsCount:()=>KT,getAvailablePlayoffProfiles:()=>hb,getDrawDefinitionTimeItem:()=>RA,getDrawParticipantRepresentativeIds:()=>PO,getDrawStructures:()=>Zo,getDrawTypeCoercion:()=>Ub,getEligibleVoluntaryConsolationParticipants:()=>DO,getMatchUpsMap:()=>sn,getParticipantIdFinishingPositions:()=>RO,getPositionAssignments:()=>xI,getPositionsPlayedOff:()=>Gg,getSeedingThresholds:()=>ZA,getSeedsCount:()=>Sb,getStructureSeedAssignments:()=>po,getTeamLineUp:()=>Ld,getValidGroupSizes:()=>cb,isAdHoc:()=>zn,isCompletedStructure:()=>Cc,isValidForQualifying:()=>NO,positionActions:()=>MO});function DO({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:m}){var O,k,x,F,$;if(!s)return{error:_e};let h=[Oe,$i];i&&h.push(Ye);let f=m!=null&&m.eventType?{matchUpTypes:[m.eventType]}:void 0,g=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,v=e&&m?((O=Zl({contextFilters:{stages:h},matchUpFilters:f,tournamentRecord:o,inContext:!0,event:m}))==null?void 0:O.matchUps)??[]:((k=Sn({contextFilters:{stages:h},matchUpFilters:g,tournamentRecord:o,inContext:!0,drawDefinition:s}))==null?void 0:k.matchUps)??[],y=Jm({stage:Ar,drawDefinition:s}).map(({participantId:_})=>_),I={},b={},S={},w={};n||(n=Hu({policyTypes:[DE],tournamentRecord:o,drawDefinition:s,event:m}).policyDefinitions);let U=n==null?void 0:n[DE];t=t.length&&t||(U==null?void 0:U.excludedMatchUpStatuses)||[],e=e??(U==null?void 0:U.includeEventParticipants),d=d??(U==null?void 0:U.allEntries),r=r??(U==null?void 0:U.finishingRoundLimit),a=a??(U==null?void 0:U.roundNumberLimit),l=l??(U==null?void 0:U.matchUpsLimit),u===void 0&&(u=(U==null?void 0:U.requirePlay)!==void 0?U.requirePlay:!0),c===void 0&&(c=(U==null?void 0:U.requireLoss)!==void 0?U.requireLoss:!0),p=p??(U==null?void 0:U.winsLimit);for(let _ of v){if(u&&_.winningSide&&![1,2].includes(_.winningSide)&&_.matchUpStatus!==er||_.finishingRound&&r&&_.finishingRound>=r||_.finishingRound&&a&&_.finishingRound<=a)continue;let L=(x=_.sides)==null?void 0:x.find(({sideNumber:V})=>_.winningSide&&V===3-_.winningSide),B=(F=_.sides)==null?void 0:F.find(({sideNumber:V})=>_.winningSide&&V===_.winningSide);if(($=_.sides)==null||$.forEach(V=>{var j;let G=(j=V==null?void 0:V.participant)==null?void 0:j.participantId;G&&(S[G]=V.participant,_.matchUpStatus===er&&!u&&(b[G]=V.participant,I[G]||(I[G]=0),(!_.matchUpStatus||!t.includes(_.matchUpStatus))&&(I[G]+=1)))}),L==null?void 0:L.participant){let V=L.participant.participantId;b[V]=L.participant,I[V]||(I[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(I[V]+=1)}if(B!=null&&B.participant){let V=B.participant.participantId;w[V]||(w[V]=0),w[V]+=1,I[V]||(I[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(I[V]+=1)}}let T=(o==null?void 0:o.participants)&&!u&&!c&&d,D=T?((e&&m?m.entries:s.entries)??[]).filter(_=>![Du,bo].includes(_.entryStatus)).map(({participantId:_})=>_):[],P=Object.keys(b),C=T?((o==null?void 0:o.participants)??[]).filter(({participantId:_})=>D.includes(_)):c&&Object.values(b)||Object.values(S),R=_=>!c||P.includes(_),N=_=>!u||(I[_]||0)>=0,A=_=>!p||(w[_]||0)<=p,M=_=>!l||I[_]<=l,E=_=>!y.includes(_);return{eligibleParticipants:C.filter(_=>R(_.participantId)&&N(_.participantId)&&A(_.participantId)&&M(_.participantId)&&E(_.participantId)).map(_=>{var L;return{..._,individualParticipants:(L=_.individualParticipantIds)==null?void 0:L.map(B=>{var V;return(V=o==null?void 0:o.participants)==null?void 0:V.find(G=>G.participantId===B)})}}),losingParticipantIds:P,...J}}function KT(t){var h,f,g,v,y,I,b,S;let e=ze(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:r}=t,n=t.structureId??(((h=i.structures)==null?void 0:h.length)===1&&((g=(f=i.structures)==null?void 0:f[0])==null?void 0:g.structureId));if(typeof n!="string")return{error:za};let a=(v=i.structures)==null?void 0:v.find(w=>w.structureId===n);if(!a)return{error:Ei};let o,s=(y=a.matchUps??[])==null?void 0:y.reduce((w,U)=>(U.roundPosition&&(o=!0),((U==null?void 0:U.roundNumber)||0)>w?U.roundNumber:w),0);if(a.structures||o||a.finishingPosition===qm)return{error:op};let l=((I=i==null?void 0:i.entries)==null?void 0:I.filter(w=>{let U=w.entryStatus;return ss.includes(U)}))??[],u=Math.floor((l==null?void 0:l.length)/2)||1,c=r??s??1,d=((S=(b=a.matchUps)==null?void 0:b.filter(w=>w.roundNumber===c))==null?void 0:S.length)??0,p=u-d,m=p>0?p:0;return{...J,availableMatchUpsCount:m,lastRoundNumber:s,roundMatchUpsCount:u}}function PO({drawDefinition:t}){var i;let e=gt({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:((i=e.extension)==null?void 0:i.value)||[]}}function Cue({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:_e};let r=mr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=Me(r.matchUps,!1,!0),a=ct(n.reduce((s,l)=>s.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),o=Object.assign({},...a.map(s=>{let l=n.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:a,participantIdMatchUps:o}}function RO({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:_e};let{participantIds:r,participantIdMatchUps:n}=Cue({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(r==null?void 0:r.map(o=>{let s=n[o].filter(d=>[qi,Vt].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(h=>h.bye),m=d.sides.find(h=>h.participantId===o).sideNumber;return(d.winningSide||t&&p&&m)===m?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),u=d=>Math.abs(d[0]-d[1]),c=l.reduce((d,p)=>d&&u(d)<u(p)?d:p,void 0);return{[o]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:c}}}))||[];return Object.assign({},...a)}function Xc({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:ge};if(!r)return{error:ks};if(!e&&t){if(typeof i!="string"&&(i=r3({tournamentRecords:t,drawId:r}),!i))return{error:Uf};if(e=t[i],!e)return{error:ge}}let n=e&&Wn({tournamentRecord:e,drawId:r});return n!=null&&n.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...J}:ee({result:{error:xa},stack:"findDrawDefinition"})}function CO(t){let{drawDefinition:e,error:i}=Xc(t);return i?{error:i}:{drawDefinition:Me(e)}}function VE({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=Lg({drawDefinition:i,structureId:r})||{},o=((a==null?void 0:a.target)||[]).filter(({linkType:s})=>s===n).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:u}=et({structureId:l,drawDefinition:i});if(!(e&&(u==null?void 0:u.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:o.map(({source:s})=>s.structureId),relevantLinks:o}}function Eue({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){var s;let o=((s=a==null?void 0:a.entries)==null?void 0:s.filter(({entryStatus:l})=>[bo,mp].includes(l)).map(({participantId:l})=>l))||[];if(o.length){let l=r.individualParticipantIds,u=e?t.filter(({participantId:d})=>o.includes(d)):void 0,c=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:Ge({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:$le,availableIndividualParticipantIds:o,availableIndividualParticipants:u,existingIndividualParticipantIds:l,existingIndividualParticipants:c,type:sO},!1,!1,!0)}}return{}}function Vd(t){var g,v,y,I,b;let{inContextDrawMatchUps:e,targetData:i,drawDefinition:r,relevantLink:n}=t;if((n==null?void 0:n.linkCondition)===el&&((g=i==null?void 0:i.matchUp)==null?void 0:g.matchUpStatus)===Vt)return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:o},targetLinks:s}=i,l=a&&En({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),u=(v=l==null?void 0:l.targetMatchUps)==null?void 0:v.loserMatchUp,c=(y=l==null?void 0:l.targetMatchUps)==null?void 0:y.loserMatchUpDrawPositionIndex,d=(I=u==null?void 0:u.sides[c])==null?void 0:I.participant,p=[Mt,zt].includes(a==null?void 0:a.matchUpStatus)&&!d,m=((b=o==null?void 0:o.drawPositions)==null?void 0:b.filter(Boolean).length)||0;if(a!=null&&a.winningSide&&!p||o!=null&&o.winningSide&&m===2&&(!o.feedRound||![zt,Mt].includes(o==null?void 0:o.matchUpStatus)))return!0;let h=o&&En({matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),f=l&&Vd({relevantLink:s==null?void 0:s.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:r});return!!(h&&Vd({targetData:h,inContextDrawMatchUps:e,drawDefinition:r})||f)}var Mue={[ym]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Ye,Oe],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[NS,Bf,jT,Kv],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},FU="positionAction",jE="matchUpAction";function g3({actionType:t=FU,appliedPolicies:e,drawDefinition:i,structure:r}){var d,p;let n=t===FU&&ym||t===jE&&Or,a=t===FU&&Mue||t===jE&&KW,o=n&&((e==null?void 0:e[n])||(a==null?void 0:a[n])),s=((p=(d=i.links)==null?void 0:d.filter(m=>{var h;return((h=m==null?void 0:m.target)==null?void 0:h.structureId)===(r==null?void 0:r.structureId)}))==null?void 0:p.map(({target:m})=>m.feedProfile))??[],{enabledStructures:l,disabledStructures:u}=o||{},c=u==null?void 0:u.find(m=>{let{stages:h,stageSequences:f,structureTypes:g,feedProfiles:v}=m;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>s.includes(y)))&&(!(h!=null&&h.length)||Array.isArray(h)&&(h==null?void 0:h.includes(r==null?void 0:r.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(r==null?void 0:r.structureType)))&&(!(f!=null&&f.length)||Array.isArray(f)&&f.includes(r==null?void 0:r.stageSequence))});return{enabledStructures:l,actionsDisabled:c,actionsPolicy:o}}function HB({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function v3({enabledStructures:t,drawDefinition:e,structure:i}){var s,l;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},o=((l=(s=e.links)==null?void 0:s.filter(u=>{var c;return((c=u==null?void 0:u.target)==null?void 0:c.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:l.map(({target:u})=>u.feedProfile))||[];return{policyActions:t.find(u=>{let{stages:c,stageSequences:d,structureTypes:p,feedProfiles:m}=u||{},h=!(c!=null&&c.length)||Array.isArray(c)&&c.includes(r),f=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(n),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(a),v=!(m!=null&&m.length)||Array.isArray(m)&&m.some(y=>o.includes(y));return f&&g&&v&&u&&h})}}function Zn({action:t,policyActions:e}){var r;let i=!(e!=null&&e.enabledActions)||((r=e==null?void 0:e.disabledActions)==null?void 0:r.length)&&e.disabledActions.includes(t);return i?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!i}var I3="replaceTieMatchUpParticipantId",y3="assignTieMatchUpParticipantId",GE="removeTieMatchUpParticipantId",zB="assignMatchUpSideParticipant",Nue="removeMatchUpSideParticipant",b3="substituteParticipant",HE="REMOVE_SUBSTITUTION",w3="REPLACE_PARTICIPANT",EO="REMOVE_PARTICIPANT",zE="setMatchUpStatus",WE="SUBSTITUTION",U3="SCHEDULE",Aue="PENALTY",qE="REFEREE",S3="STATUS",YE="START",T3="SCORE",KE="END",Oue={REPLACE_TEAM_POSITION_METHOD:I3,ASSIGN_TEAM_POSITION_METHOD:y3,REMOVE_TEAM_POSITION_METHOD:GE,REPLACE_PARTICIPANT:w3,SUBSTITUTION_METHOD:b3,REMOVE_SUBSTITUTION:HE,REMOVE_PARTICIPANT:EO,SCHEDULE_METHOD:zE,SUBSTITUTION:WE,SCHEDULE:U3,PENALTY:Aue,REFEREE:qE,STATUS:S3,SCORE:T3,START:YE,END:KE};function kue({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){var A,M,E,O,k,x,F,$,_,L,B,V,G,j,z;let m=[],h=(A=n.sides)==null?void 0:A.find(q=>q.participant),f=n.gender===Bn&&n.sideNumber&&((M=n.sides)==null?void 0:M.filter(q=>q.particiapntId).length)===1&&((O=(E=h==null?void 0:h.participant)==null?void 0:E.person)==null?void 0:O.sex),g=n.matchUpType,v=(o??((k=r==null?void 0:r.participants)==null?void 0:k.enforceGender))!==!1?n.gender:void 0,y=(F=(x=n.sides)==null?void 0:x.flatMap(q=>{var W;return((W=q.participant)==null?void 0:W.individualParticipants)||q.participant}).filter(Boolean))==null?void 0:F.map(Ut),I=($=n.sides)==null?void 0:$.filter(q=>!l||q.sideNumber===l).flatMap(q=>{var W;return((W=q.participant)==null?void 0:W.individualParticipants)||q.participant}).filter(Boolean),b=I==null?void 0:I.map(Ut),S=(L=(_=e==null?void 0:e.find(q=>q.matchUpId===n.matchUpTieId))==null?void 0:_.sides)==null?void 0:L.map(q=>{var W,Y;return(Y=(W=q==null?void 0:q.participant)==null?void 0:W.individualParticipants)==null?void 0:Y.filter(({participantId:re,person:K})=>!(b!=null&&b.includes(re))&&(!v||v===Ds||K.sex===v||v===Bn&&!f||f&&K.sex!==f))}),w=l?S==null?void 0:S[l-1]:S==null?void 0:S.map((q,W)=>({participants:q,sideNumber:W+1})),U=l?(B=S==null?void 0:S[l-1])==null?void 0:B.map(Ut):S==null?void 0:S.map((q,W)=>({participants:q==null?void 0:q.map(Ut),sideNumber:W+1})),T=l&&(Yi(zp)(g)&&!(b!=null&&b.length)||Yi(Ed)(g)&&((b==null?void 0:b.length)??0)<2)||!l&&(Yi(zp)(g)&&((b==null?void 0:b.length)??0)<2||Yi(Ed)(g)&&((b==null?void 0:b.length)??0)<4),D=U==null?void 0:U.filter(q=>!(y!=null&&y.includes(q))),P=w==null?void 0:w.filter(({participantId:q})=>D.includes(q));if(T&&(D!=null&&D.length)&&m.push({availableParticipantIds:D,method:y3,availableParticipants:P,type:Sm,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),b!=null&&b.length&&(!vr(c)||(V=p==null?void 0:p.substitutions)!=null&&V.length)&&m.push({method:GE,type:EO,existingParticipantIds:b,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),P!=null&&P.length&&(!l&&(b!=null&&b.length)||l&&(p!=null&&p.participant))&&m.push({availableParticipantIds:D,method:I3,availableParticipants:P,type:w3,existingParticipantIds:b,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),Zn({policyActions:a,action:HE})&&((G=p==null?void 0:p.substitutions)==null?void 0:G.length)){let q=((j=p.participant)==null?void 0:j.participantType)===St&&[p.participantId]||((z=p.participant)==null?void 0:z.participantType)===ht&&p.participant.individualParticipantIds||[],W=p.substitutions.map(Y=>Y.participantId).filter(Y=>q.includes(Y));(!s||W.includes(s))&&m.push({method:GE,type:HE,substitutedParticipantIds:W,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let C=t==null?void 0:t[Or],R=C==null?void 0:C.substituteWithoutScore,N=C==null?void 0:C.substituteAfterCompleted;if(Zn({policyActions:a,action:WE})&&i.length===2&&(!l&&(b!=null&&b.length)||l&&(p!=null&&p.participant))&&(R||vr(c))&&(N||c.matchUpStatus&&!gr.includes(c.matchUpStatus))&&(I!=null&&I.length)&&w.length){let q=I.map(Ut);m.push({info:"list of team players available for substitution",method:b3,availableParticipantIds:U,existingParticipantIds:q,availableParticipants:w,existingParticipants:I,type:WE,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return m}function xue({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:u,structure:c,drawId:d,event:p}){var U,T,D,P,C;if(i.includes(s))return{};let m=(U=l.find(R=>R.type===Sm))==null?void 0:U.availableParticipantIds,h=(T=a==null?void 0:a[ym])==null?void 0:T.otherFlightEntries,f=(D=a==null?void 0:a[ym])==null?void 0:D.restrictQualifyingAlternates,g=(o.entries??[]).filter(({entryStage:R})=>!f||(c.stage===Ye?R===Ye:R!==Ye)).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:R})=>R).filter(Boolean),{allPositionedParticipantIds:v}=iW({drawDefinition:o}),y=r.map(R=>R.participantId).filter(Boolean),I=g.filter(R=>c.stage&&[Ye,Oe,$i].includes(c.stage)?!(v!=null&&v.includes(R)):!y.includes(R)),b=((p==null?void 0:p.entries)??[]).filter(R=>R.entryStatus===Vo&&D3({restrictQualifyingAlternates:f,structure:c,entry:R})&&(c.stage&&[Ye,Oe,$i].includes(c.stage)?!(v!=null&&v.includes(R.participantId)):!y.includes(R.participantId))).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(R=>R.participantId),S=ct(I.concat(b));if(h){let R=(C=(P=p?Gi({event:p}).flightProfile:void 0)==null?void 0:P.flights)==null?void 0:C.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(A=>A.participantId&&![Du,bo,mp].includes(A.entryStatus)&&!g.includes(A.participantId)).map(({participantId:A})=>A)).flat().filter(Boolean);R!=null&&R.length&&S.push(...R)}m!=null&&m.length&&(S=S.filter(R=>!m.includes(R)));let w=n?t==null?void 0:t.filter(R=>S.includes(R.participantId)):void 0;return w==null||w.forEach(R=>{let N=(o.entries??[]).find(A=>A.participantId===R.participantId);R.entryPosition=N==null?void 0:N.entryPosition}),w==null||w.sort((R,N)=>(R.entryPosition||1/0)-(N.entryPosition||1/0)),S.length?{validAlternatesAction:Ge({payload:{drawId:d,structureId:u,drawPosition:s},willDisableLinks:e,method:Lle,availableAlternatesParticipantIds:S,type:lO,availableAlternates:w})}:{}}function D3({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===Ye&&!t||i.entryStage===Oe&&r===rn)return!0}function Fue({eventEntries:t,structure:e}){let i=n=>n.entryStatus===Vo&&D3({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(Ut)}function Lue({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:u,drawId:c,event:d}){var T,D,P,C,R,N,A;let p=[],m=(l==null?void 0:l.matchUps)??[],h=(D=(T=u.sides)==null?void 0:T.find(M=>M.sideNumber===o))==null?void 0:D.participantId,f=m.filter(({roundNumber:M})=>M===u.roundNumber),g=((P=n==null?void 0:n.entries)==null?void 0:P.filter(({entryStatus:M})=>M&&hp.includes(M)).map(Ut))??[],v=f.map(M=>(M.sides??[]).flatMap(Ut)).flat().filter(Boolean),y=g.filter(M=>!i.includes(M)&&(!t||!v.includes(M))),I=e==null?void 0:e.filter(M=>y==null?void 0:y.includes(M.participantId)).map(M=>Me(M,void 0,!0));I==null||I.forEach(M=>{let E=(n.entries??[]).find(O=>O.participantId===M.participantId);M.entryPosition=E==null?void 0:E.entryPosition}),y.length&&p.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:zB,type:Sm,availableParticipantIds:y,participantsAvailable:I});let b=(d==null?void 0:d.entries)??[],S=Fue({eventEntries:b,structure:l}),w=ct(g.concat(S));if(r){let M=(R=(C=d?Gi({event:d}):void 0)==null?void 0:C.flights)==null?void 0:R.filter(E=>E.drawId!==c).flatMap(E=>E.drawEntries.filter(O=>O.participantId&&![Du,bo,mp].includes(O.entryStatus)).map(({participantId:O})=>O)).filter(Boolean);M!=null&&M.length&&w.push(...M)}w=w.filter(M=>!i.includes(M)&&!y.includes(M)&&(!t||!v.includes(M)));let U=e==null?void 0:e.filter(M=>w.includes(M.participantId)).map(M=>Me(M,void 0,!0));if(U==null||U.forEach(M=>{let E=(n.entries??[]).find(O=>O.participantId===M.participantId);M.entryPosition=E==null?void 0:E.entryPosition}),U==null||U.sort((M,E)=>(M.entryPosition||1/0)-(E.entryPosition||1/0)),w.length&&p.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:w,participantsAvailable:U,method:zB,type:Vo}),!vr(u)&&o&&h){p.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:Nue,type:EO});let M=L=>L.sides.map(Ut),E=({matchUpId:L})=>L!==u.matchUpId,O=L=>!vr(L),k=(A=(N=u.sides)==null?void 0:N.find(L=>L.sideNumber!==o))==null?void 0:A.participantId,x=m.filter(({roundNumber:L})=>L!==u.roundNumber).filter(E).map(M),F=[k,...x.filter(L=>L.includes(h)).flat()].filter(Boolean),$=L=>!F.flat().includes(L),_=f.filter(O).filter(E).map(M).flat().filter($);if(_.length){let L=e==null?void 0:e.filter(B=>_.includes(B.participantId)).map(B=>Me(B,void 0,!0));p.push({payload:{participantIds:[h],roundNumber:u.roundNumber,structureId:a,sideNumber:o,matchUpId:s,drawId:c},swappableParticipantIds:_,method:Ble,type:GT,swappableParticipants:L})}}return p}function XT(t){var q,W,Y,re,K,H,Q,X,ie;if(!t)return{error:oe};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:o,sideNumber:s,matchUpId:l}=t,u=t.tournamentRecord??(t.tournamentId&&Ti(t.tournamentId)&&((q=t.tournamentRecords)==null?void 0:q[t.tournamentId]));if(!u)return{error:ge};if(!l||!Ti(l))return{error:yn};if(s&&![1,2].includes(s))return ee({result:{error:oe},context:{sideNumber:s}});if(!e){let ae=(Br({tournamentRecord:u}).matchUps??[]).find(ne=>ne.matchUpId===l);i=((u==null?void 0:u.events)??[]).find(ne=>ne.eventId===(ae==null?void 0:ae.eventId));let le=((i==null?void 0:i.drawDefinitions)??[]).find(ne=>ne.drawId===(ae==null?void 0:ae.drawId));le&&(e=le)}if(!e)return{error:_e};let c=Mi({withIndividualParticipants:!0,tournamentRecord:u}).participants,{drawId:d}=e,{matchUp:p,structure:m}=wi({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:dn};let h=$t({tournamentRecord:u,drawDefinition:e,structure:m,event:i}).appliedPolicies??{};Object.assign(h,n??{});let f=(W=h==null?void 0:h[ym])==null?void 0:W.otherFlightEntries,g=(h==null?void 0:h[Or])??Bg[Or],{enabledStructures:v}=g3({actionType:jE,appliedPolicies:h,drawDefinition:e,structure:m}),{policyActions:y}=v3({enabledStructures:v,drawDefinition:e,structure:m}),I=t.matchUpsMap??sn({drawDefinition:e}),b=t.inContextDrawMatchUps??mr({tournamentParticipants:c,inContext:!0,drawDefinition:e,matchUpsMap:I,event:i}).matchUps,S=b==null?void 0:b.find(ae=>ae.matchUpId===l),w=s&&((Y=S==null?void 0:S.sides)==null?void 0:Y.find(ae=>ae.sideNumber===s)),U=((re=S==null?void 0:S.sides)==null?void 0:re.map(ae=>{var le;return ae.participantId||((le=ae.participant)==null?void 0:le.participantid)}).filter(Boolean))??[],{assignedPositions:T,allPositionsAssigned:D}=Rr({structure:m}),{structureId:P}=m??{},C=[];if(!P)return{validActions:C};let R=zn({structure:m}),N=p.collectionId;if(R&&!N){let ae=Lue({restrictAdHocRoundParticipants:r,tournamentParticipants:c,matchUpParticipantIds:U,otherFlightEntries:f,drawDefinition:e,structureId:P,sideNumber:s,matchUpId:l,structure:m,matchUp:p,drawId:d,event:i});C.push(...ae)}let A=Cc({drawDefinition:e,structure:m}),M=T==null?void 0:T.filter(ae=>ae.participantId).map(ae=>ae.drawPosition),E=T==null?void 0:T.filter(ae=>ae.bye).map(ae=>ae.drawPosition),O=p.matchUpStatus===Vt||!N&&((K=p.drawPositions)==null?void 0:K.reduce((ae,le)=>(E==null?void 0:E.includes(le))||ae,!1));if(O)return{validActions:C,isByeMatchUp:O};Zn({policyActions:y,action:qE})&&C.push({type:qE,payload:{matchUpId:l}});let k=!rb({matchUpStatus:p.matchUpStatus}),x=(H=h==null?void 0:h.scoring)==null?void 0:H.structures,F=(m==null?void 0:m.stage)&&(x==null?void 0:x.stage)&&(x==null?void 0:x.stage[m.stage]),$=(m==null?void 0:m.stageSequence)&&(F==null?void 0:F.stageSequence)&&F.stageSequence[m.stageSequence],_=!((Q=h==null?void 0:h.scoring)!=null&&Q.requireAllPositionsAssigned||F!=null&&F.requireAllPositionsAssigned||$!=null&&$.requireAllPositionsAssigned)||D,L=p.sides&&p.sides.filter(ae=>ae==null?void 0:ae.participantId).length===2,B=p.matchUpStatus&&[er,cr].includes(p.matchUpStatus),V=En({inContextDrawMatchUps:b,drawDefinition:e,matchUpId:l}),G=Vd({inContextDrawMatchUps:b,drawDefinition:e,targetData:V}),j=(((X=S==null?void 0:S.drawPositions)==null?void 0:X.length)===2&&S.drawPositions.every(ae=>M==null?void 0:M.includes(ae))&&((ie=S==null?void 0:S.sides)==null?void 0:ie.length)===2&&S.sides.every(({participantId:ae})=>ae)||L)&&!(B&&G),z={method:Oq,type:Bf,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(k&&C.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:zE,type:U3}),Zn({policyActions:y,action:Bf})&&(w!=null&&w.participant||!s&&(U!=null&&U.length))&&C.push(z),k&&j&&C.push({type:S3}),_&&j){let{matchUpId:ae,matchUpFormat:le}=p,ne={drawId:d,matchUpId:ae,matchUpFormat:le,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};C.push({info:"set outcome and winningSide",method:zE,type:T3,payload:ne}),Zn({policyActions:y,action:YE})&&C.push({type:YE}),Zn({policyActions:y,action:KE})&&C.push({type:KE})}if(N&&S){let ae=kue({specifiedPolicyDefinitions:n,inContextDrawMatchUps:b,matchUpParticipantIds:U,matchUpActionsPolicy:g,inContextMatchUp:S,policyActions:y,enforceGender:a,participantId:o,sideNumber:s,matchUpId:l,matchUp:p,drawId:d,side:w});C.push(...ae)}return{structureIsComplete:A,validActions:C,isDoubleExit:B,...J}}function _ue({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:u,drawId:c,event:d}){var v,y,I,b,S,w,U;if(n.includes(s)||r&&!e)return{};let{sourceStructureIds:p,targetStructureIds:m}=((v=o.links)==null?void 0:v.reduce((T,D)=>{var R,N;let P=(R=D.source)==null?void 0:R.structureId,C=(N=D.target)==null?void 0:N.structureId;return T.sourceStructureIds.includes(P)||T.sourceStructureIds.push(P),T.targetStructureIds.includes(C)||T.targetStructureIds.push(C),T},{sourceStructureIds:[],targetStructureIds:[]}))||{},h=[],f=((y=o.links)==null?void 0:y.filter(T=>{var D;return((D=T.target)==null?void 0:D.structureId)===u.structureId}))??[];for(let T of f){let D=(I=T==null?void 0:T.source)==null?void 0:I.structureId,{structure:P}=et({structureId:D,drawDefinition:o}),C=(P==null?void 0:P.finishingPosition)===qm&&((p==null?void 0:p.length)!==1||(m==null?void 0:m.length)!==1),R={};if(C){let{matchUps:M}=Wt({drawDefinition:o,structure:u,event:d}),{initialRoundNumber:E}=Um({drawPosition:s,matchUps:M}),O=(w=(S=(b=o.links)==null?void 0:b.find(k=>{var x;return((x=k.target)==null?void 0:x.structureId)===(u==null?void 0:u.structureId)&&k.target.roundNumber===E}))==null?void 0:S.source)==null?void 0:w.roundNumber;R.roundNumbers=[O]}let{completedMatchUps:N}=xT({structureId:D,inContext:!0,matchUpFilters:R,drawDefinition:o}),A=a.map(M=>M.participantId).filter(Boolean);(U=N==null?void 0:N.filter(({matchUpType:M,winningSide:E})=>E&&((d==null?void 0:d.eventType)!==sr||M===sr)).map(({winningSide:M,sides:E})=>M&&(E==null?void 0:E[1-(M-1)])).map(Ut).filter(M=>M&&!A.includes(M)))==null||U.forEach(M=>{h.includes(M)||h.push(M)})}let g=t==null?void 0:t.filter(T=>h==null?void 0:h.includes(T.participantId));return g==null||g.forEach(T=>{let D=(o.entries??[]).find(P=>P.participantId===T.participantId);T.entryPosition=D==null?void 0:D.entryPosition}),h!=null&&h.length?{validLuckyLosersAction:{type:cO,method:_le,availableLuckyLosers:g,availableLuckyLoserParticipantIds:h,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:s}}}:{}}function $ue({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:m,event:h}){var S,w,U;let{drawId:f}=u,g=[],v,y,I=[],b=(w=(S=l==null?void 0:l[ms])==null?void 0:S.validSeedPositions)==null?void 0:w.ignore;if(b||({unplacedSeedParticipantIds:v,unplacedSeedAssignments:y,unfilledPositions:I}=lq({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:m,event:h})),I!=null&&I.length||(I=o.filter(T=>!T.participantId&&!T.bye&&!T.qualifier).map(T=>T.drawPosition)),d||g.push({payload:{drawId:f,structureId:m,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:Gle,type:AS}),a&&b){let T=o.map(N=>N.participantId).filter(Boolean),D={structureIds:t},{completedMatchUps:P}=_g({inContext:!0,matchUpFilters:D,drawDefinition:u}),C=ct((U=(P??[]).filter(({matchUpType:N})=>(h==null?void 0:h.eventType)!==sr||N===sr))==null?void 0:U.map(({sides:N})=>N==null?void 0:N.map(Ut)).flat().filter(N=>N&&!T.includes(N))),R=s?n==null?void 0:n.filter(N=>C==null?void 0:C.includes(N.participantId)).map(N=>Me(N,void 0,!0)):void 0;return R==null||R.forEach(N=>{let A=(u.entries??[]).find(M=>M.participantId===N.participantId);N.entryPosition=A==null?void 0:A.entryPosition}),R!=null&&R.length&&g.push(Ge({payload:{drawId:f,structureId:m,drawPosition:p},willDisableLinks:i,method:FB,type:Sm,availableParticipantIds:C,participantsAvailable:R})),{validAssignmentActions:g}}if(I.includes(p)||d){let T;if(y!=null&&y.length){let P=y.filter(C=>v==null?void 0:v.includes(C.participantId));P.sort(Bue),T=P.map(C=>C.participantId)}else T=e;let D=s?n==null?void 0:n.filter(P=>T.includes(P.participantId)).map(P=>Me(P,void 0,!0)):void 0;D!=null&&D.length&&g.push(Ge({payload:{drawId:f,structureId:m,drawPosition:p},willDisableLinks:i,method:FB,type:Sm,availableParticipantIds:T,participantsAvailable:D}))}return{validAssignmentActions:g}}function Bue(t,e){return t.bye||_f(t.seedValue)<_f(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function Vue({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var S,w,U;let u=[],c=[],d=[],p=[],m=i.map(T=>T.participantId).filter(Boolean),h=n==null?void 0:n[ym],f=!(h!=null&&h.disableRoundRestrictions)&&t[o],g=h==null?void 0:h.requireCompletedStructures,{sourceStructureIds:v,relevantLinks:y}=VE({targetRoundNumber:f,linkType:wu,drawDefinition:a,structureId:s})||{};v!=null&&v.length&&p.push(...v);let{sourceStructureIds:I,relevantLinks:b}=VE({targetRoundNumber:f,linkType:bu,drawDefinition:a,structureId:s})||{};I!=null&&I.length&&p.push(...I);for(let T of y){let D=(S=a.structures)==null?void 0:S.find(C=>C.structureId===T.source.structureId);if((D==null?void 0:D.stage)!==Ye)continue;let P=Cc({structureId:T.source.structureId,drawDefinition:a});if(!g||P){let C=D.qualifyingRoundNumber,{matchUps:R}=Wt({matchUpFilters:{roundNumbers:[C],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:D});for(let N of R){let A=N.sides.find(E=>(E==null?void 0:E.sideNumber)===N.winningSide),M=N.matchUpStatus===Vt&&((w=N.sides)==null?void 0:w.find(({participantId:E})=>E));if(A||M){let{participantId:E,participant:O}=A||M||{};E&&!m.includes(E)&&(O&&r&&u.push(O),c.push(E))}}}}for(let T of b){let D=(U=a.structures)==null?void 0:U.find(C=>C.structureId===T.source.structureId);if((D==null?void 0:D.stage)!==Ye)continue;let P=Cc({structureId:T.source.structureId,drawDefinition:a});if(!g||P){let{positionAssignments:C}=ai({structure:D}),R=(C==null?void 0:C.map(N=>{var E;let A=N.participantId,M=(E=gt({element:N,name:Sc}).extension)==null?void 0:E.value;return M?{participantId:A,groupOrder:M==null?void 0:M.groupOrder}:{}}).filter(({groupOrder:N,participantId:A})=>N===1&&!m.includes(A)).map(({participantId:N})=>N))??[];if(R&&c.push(...R),r){let N=e.filter(({participantId:A})=>R.includes(A));u.push(...N)}}}return c.length&&d.push(Ge({qualifyingParticipants:r?u:void 0,method:xle,type:jT,qualifyingParticipantIds:c,payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function jue({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:m,event:h}){if(n.includes(c))return{};let f=P=>!t||P.participantId||P.qualifier||P.bye,g=r==null?void 0:r.filter(P=>P!==c&&!(u&&s.includes(P))),v=(a==null?void 0:a.filter(P=>f(P)&&(g==null?void 0:g.includes(P.drawPosition))))??[],y=v.map(({drawPosition:P})=>P),{matchUps:I}=Wt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:h}),b=I.filter(({drawPositions:P})=>Rn(P,y)),S=Object.assign({},...b.map(P=>{var C;return(C=P.sides)==null?void 0:C.filter(({sourceDrawPositionRange:R})=>R).map(({drawPosition:R,sourceDrawPositionRange:N})=>({[R]:N}))}).flat()),w=v.map(P=>P.participantId).filter(Boolean),U=(i??[]).filter(P=>w.includes(P.participantId)),T=Object.assign({},...U.map(P=>({[P.participantId]:P}))),D=v.map(P=>{let C=T==null?void 0:T[P.participantId],R=S[P.drawPosition];return Ge({...P,participant:o?Me(C,!1,!0):void 0,sourceDrawPositionRange:R})});return D.length?{validSwapAction:{payload:{drawId:m,structureId:d,drawPositions:[c]},willDisableLinks:e,method:Aq,type:GT,availableAssignments:D}}:{}}function MO(t){var z;let e=ze(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:o,drawPosition:s,event:l}=t,u=t.tournamentParticipants??(a&&Mi({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],c=et({structureId:t.structureId,drawDefinition:o});if(c.error)return c;let d=c.containingStructure||c.structure;if(!d)return{error:Ei};let p=d.structureId;if(c=nb({drawDefinition:o,structureId:p}),s===void 0&&!c.isAdHoc)return{error:Tg};if(c.isAdHoc)return XT(t);if(c.error)return c;let{drawPositionInitialRounds:m,inactiveDrawPositions:h,activeDrawPositions:f,byeDrawPositions:g}=c,v=$t({tournamentRecord:a,drawDefinition:o,structure:d,event:l}).appliedPolicies??{};Object.assign(v,i??{});let{actionsPolicy:y,enabledStructures:I,actionsDisabled:b}=g3({actionType:FU,appliedPolicies:v,drawDefinition:o,structure:d}),S=(y==null?void 0:y.activePositionOverrides)||[],{sourceStructureIds:w}=VE({finishingPosition:Od,targetRoundNumber:1,linkType:bu,drawDefinition:o,structureId:p})||{},U;w!=null&&w.length&&(U=w.every(q=>Cc({structureId:q,drawDefinition:o})));let T=w.length,D=w.length&&!U,{policyActions:P}=v3({enabledStructures:I,drawDefinition:o,structure:d}),C=![Ye,Oe].includes(d.stage)||d.stageSequence!==1,{drawId:R}=o,N=[],{assignedPositions:A,positionAssignments:M}=Rr({structure:d}),E=A==null?void 0:A.find(q=>q.drawPosition===s),O=!!E;if(!((z=M==null?void 0:M.map(q=>q.drawPosition))!=null&&z.includes(s)))return{error:Sg};let{stage:k,stageSequence:x}=d,F=[k];k===rn&&F.push(Oe),k===Oe&&F.push(rn);let $=Jm({entryStatuses:hp,provisionalPositioning:n,drawDefinition:o,stageSequence:x,structureId:p,stages:F}),_=gp({drawDefinition:o,stages:F}).assignedParticipantIds??[],L=$.filter(q=>!_.includes(q.participantId)).map(q=>q.participantId),B=g.includes(s),V=f.includes(s);if(b)return{info:"Actions Disabled for structure",isActiveDrawPosition:V,isDrawPosition:!0,hasPositionAssigned:O,validActions:[],isByePosition:B};if(Zn({policyActions:P,action:Sm})&&!V&&M&&!D&&(!E||B)){let{validAssignmentActions:q}=$ue({positionSourceStructureIds:w,unassignedParticipantIds:L,possiblyDisablingAction:C,isWinRatioFedStructure:T,tournamentParticipants:u,positionAssignments:M,returnParticipants:r,appliedPolicies:v,drawDefinition:o,isByePosition:B,drawPosition:s,structureId:p,event:l});q==null||q.forEach(W=>N.push(W))}if(Zn({policyActions:P,action:jT})&&!V){let{validAssignmentActions:q}=Vue({drawPositionInitialRounds:m,tournamentParticipants:u,positionAssignments:M,returnParticipants:r,appliedPolicies:v,drawDefinition:o,drawPosition:s,structureId:p,drawId:R});q==null||q.forEach(W=>N.push(W))}let{participantId:G}=E||{},j=G&&u.find(q=>q.participantId===G);if(E){Zn({policyActions:P,action:BE})&&!V&&(N.push({type:BE,method:xB,payload:{drawId:R,structureId:p,drawPosition:s},willDisableLinks:C}),B||N.push({type:uO,method:Fle,payload:{drawId:R,structureId:p,drawPosition:s},willDisableLinks:C}),Zn({policyActions:P,action:AS})&&!B&&N.push({type:AS,method:xB,payload:{drawId:R,structureId:p,drawPosition:s,replaceWithBye:!0},willDisableLinks:C}));let q=d.stage===Ye||d.stage===Oe&&d.stageSequence===1;if(!B&&HB({activePositionOverrides:S,activeDrawPositions:f,action:Kv})&&Zn({policyActions:P,action:Kv})&&CS({drawDefinition:o,structureId:p,drawPosition:s})&&q){let{seedAssignments:W}=po({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:Y,seedValue:re}=(W==null?void 0:W.find(K=>K.participantId===G))??{};N.push({type:Kv,method:Hle,participant:j,seedNumber:Y,payload:{drawId:R,structureId:p,participantId:G,seedValue:re}})}if(!B&&HB({activePositionOverrides:S,activeDrawPositions:f,action:xU})&&Zn({policyActions:P,action:xU})&&CS({drawDefinition:o,structureId:p,drawPosition:s})&&q){let{seedAssignments:W}=po({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:Y}=(W==null?void 0:W.find(re=>re.participantId===G))??{};N.push({method:jle,type:xU,participant:j,seedNumber:Y,payload:{participantId:G,structureId:p,drawId:R}})}if(!B&&G){if(Zn({policyActions:P,action:Bf})){let W={type:Bf,method:Oq,participant:j,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:R}};N.push(W)}if(Zn({policyActions:P,action:NS})){let W={type:NS,method:Vle,participant:j,payload:{participantId:G,otherName:void 0}};N.push(W)}}if(Zn({policyActions:P,action:GT})){let{validSwapAction:W}=jue({possiblyDisablingAction:C,tournamentParticipants:u,inactiveDrawPositions:h,activeDrawPositions:f,positionAssignments:M,returnParticipants:r,byeDrawPositions:g,drawDefinition:o,isByePosition:B,drawPosition:s,structureId:p,structure:d,drawId:R});W&&N.push(W)}}if(Zn({policyActions:P,action:lO})&&!D){let{validAlternatesAction:q}=xue({possiblyDisablingAction:C,tournamentParticipants:u,positionAssignments:M,activeDrawPositions:f,returnParticipants:r,appliedPolicies:v,drawDefinition:o,drawPosition:s,validActions:N,structureId:p,structure:d,drawId:R,event:l});q&&N.push(q)}if(Zn({policyActions:P,action:cO})&&!D&&!V&&M){let{validLuckyLosersAction:q}=_ue({sourceStructuresComplete:U,possiblyDisablingAction:C,isWinRatioFedStructure:T,tournamentParticipants:u,activeDrawPositions:f,positionAssignments:M,drawDefinition:o,drawPosition:s,structureId:p,structure:d,drawId:R});q&&N.push(q)}if((j==null?void 0:j.participantType)===ht&&Zn({policyActions:P,action:sO})){let{validModifyAssignedPairAction:q}=Eue({tournamentParticipants:u,returnParticipants:r,drawPosition:s,participant:j,drawId:R,event:l});q&&N.push(q)}return{isActiveDrawPosition:V,isDrawPosition:!0,hasPositionAssigned:O,isByePosition:B,validActions:N,...J}}function Ub({policyDefinitions:t,appliedPolicies:e,drawType:i}){var a,o;let r=(a=t==null?void 0:t[IS])==null?void 0:a.drawTypeCoercion,n=(o=e==null?void 0:e[IS])==null?void 0:o.drawTypeCoercion;return(typeof r=="boolean"?r:void 0)??(i&&(r==null?void 0:r[i]))??(typeof n=="boolean"?n:void 0)??(i&&(n==null?void 0:n[i]))??!0}function xI({tournamentRecord:t,drawDefinition:e,stage:i=Oe,structureId:r,structure:n}){var s;if(!t)return{error:ge};if(!n&&!e)return{error:_e};if(!n&&!r&&((s=e==null?void 0:e.structures)==null?void 0:s.filter(l=>l.stage===i).length)===1&&(n=e.structures.find(l=>l.stage===i)),!n&&!r)return{error:za};let{error:a,positionAssignments:o}=ai({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:o??[],structureId:n==null?void 0:n.structureId,error:a}}function NO({structureId:t,drawDefinition:e}){if(!e)return{error:_e};if(!Ti(t))return{error:oe};let i=Lg({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!Vi([Ad,Fo,sT,Nd],r).length;return{...J,valid:n}}function P3({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:oe};let i=Ug(t);return i?{drawSize:i}:ee({result:{error:oe},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function Sb(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:o,event:s}=t||{},l="getSeedsCount",u=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let h=Hu({tournamentRecord:a,drawDefinition:o,event:s});if(h.error)return ee({result:h,stack:l});i=h.policyDefinitions}let c=ot(u);if(u&&!c)return ee({result:{error:oe},context:{participantsCount:u},stack:l});if(n&&!c)return ee({result:{error:KG},stack:l});if(isNaN(r))if(u)({drawSize:r}=P3({participantsCount:u}));else return ee({result:{error:Py},stack:l});let d=n&&u||r;if(d&&d>r)return{error:yN};let p=i==null?void 0:i[ms];if(!p)return{error:LG};let m=p.seedsCountThresholds;return m?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:m.filter(h=>e?h.drawSize<=r:r===h.drawSize).reduce((h,f)=>u&&u>=f.minimumParticipantCount?f.seedsCount:h,0)}):{error:wG}}function JT({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:o,event:s}){var v;if((!o||!n)&&i&&({participants:o,participantMap:n}=Mi({tournamentRecord:i})),!o)return{error:Cy};if(!Array.isArray(o))return{error:oe};if(!s)return{error:gi};let l=(e==null?void 0:e[Or])??(r==null?void 0:r[Or])??Bg[Or],u=(a??((v=l==null?void 0:l.participants)==null?void 0:v.enforceGender))!==!1,{eventType:c,gender:d}=s,p=c===yu,m=c===Sa&&Kt||p&&ht||St,h=Object.assign({},...(t??s.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),f=Object.keys(h),g=o.filter(y=>f.includes(y.participantId)).filter(y=>{let I=Gue({participant:y,participantType:m,eventType:c,entryStatusMap:h}),b=Hue({genderEnforced:u,participantMap:n,eventGender:d,participant:y,isDoubles:p,mismatch:I});return I||!b});if(g.length){let y=g.map(I=>I.participantId);return{error:MG,invalidParticipantIds:y}}return{...J,valid:!0}}function Gue({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[yu,Sa].includes(i)&&t.participantType===St&&(hd(n)||n===Du);return t.participantType!==e&&!a}function Hue(t){var d,p,m;let{participant:e,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:o}=t,s=!n&&a&&ct(((d=e==null?void 0:e.individualParticipantIds)==null?void 0:d.map(h=>{var f,g,v;return(v=(g=(f=i==null?void 0:i[h])==null?void 0:f.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],l=!r||!(s!=null&&s.length)||Ds===r||[Jt,pi].includes(r)&&s[0]===r||Bn===r&&(s.length===1&&((p=e.individualParticipantIds)==null?void 0:p.length)===1||s.length===2),u=(m=e==null?void 0:e.person)==null?void 0:m.sex,c=!(e!=null&&e.person)||!r||[Ds,Bn].includes(r)||[Jt,pi].includes(r)&&u===r;return!o||l&&c}function R3({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:r,uuids:n}){var f;let a="generateQualifyingSTructures",o=[],s=[],l=[],u=(g,v)=>g.stageSequence-v.stageSequence,c=(g,v)=>g.roundTarget-v.roundTarget,d=0,p=0,m,h=1;for(let g of t.sort(c)){let v=g.structureProfiles||[];h=g.roundTarget||h;let y=1,I=0,b,S,w;for(let U of(v||[]).sort(u)){let T=iN(U.drawSize||U.participantsCount),{qualifyingRoundNumber:D,structureOptions:P,matchUpFormat:C,structureName:R,structureId:N,drawType:A}=U,M=U.matchUpType,E=U.qualifyingPositions||zue({drawSize:T,qualifyingRoundNumber:D}),O,k,x;if(!ot(T))return ee({result:{error:Py},stack:a});let F=t.length>1?`${h}-`:"",$=v.length>1||F?y:"",_=R||(F||$?`${Qr(Ye)} ${F}${$}`:Qr(Ye));if(A===Xo){let{structures:L,groupCount:B,maxRoundNumber:V}=ub({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),stage:Ye,structureOptions:P,appliedPolicies:e,stageSequence:y,matchUpType:M,roundTarget:h,drawSize:T,idPrefix:i,isMock:r,uuids:n});I=B,O=V,k=L[0],m=[1]}else({drawSize:T,matchUps:x,roundLimit:O}=rl({qualifyingRoundNumber:D,qualifyingPositions:E,matchUpType:M,drawSize:T,idPrefix:i,isMock:r,uuids:n})),k=ao({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),qualifyingRoundNumber:O,stage:Ye,matchUpFormat:C,stageSequence:y,matchUpType:M,roundLimit:O,matchUps:x}),h&&Lt({extension:{name:fl,value:h},element:k}),I=((f=x==null?void 0:x.filter(L=>L.roundNumber===O))==null?void 0:f.length)||0;if(y>1){let{link:L}=mb({sourceStructureId:S,sourceRoundNumber:b,targetStructureId:k.structureId,finishingPositions:w===bu?[1]:void 0,linkType:w});l.push(L),d+=(T||0)-I}else d+=T||0;w=A===Xo?bu:wu,S=k.structureId,b=O,s.push(k),y+=1}p+=I,o.push({qualifiersCount:I,finalQualifyingRoundNumber:b,finalQualifyingStructureId:S,finishingPositions:m,roundTarget:h,linkType:w}),h+=1}return{qualifiersCount:p,qualifyingDrawPositionsCount:d,qualifyingDetails:o,structures:s,...J,links:l}}function zue({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function C3(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=Ze(t.drawSize),n=e&&t.drawType!==La&&(typeof e=="boolean"||e<=2)&&r===2&&Gs||t.drawType||Gs,a=Ez.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=Gs;else if(r<4&&i)return{...ee({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:B0},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function Wue(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:Qr(Oe),...t,stage:Oe},{structures:a,groupCount:o,groupSize:s}=ub(n);if(o<1)return{error:mH};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:Qr($i)}],[u]=a,{structures:c,links:d}=Hq({sourceStructureId:u.structureId,requireSequential:r,drawDefinition:e,playoffGroups:l,groupCount:o,groupSize:s,...t});return c&&a.push(...c),{...J,structures:a,links:d}}function que({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),n=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),o=r.map((u,c)=>{let d=r.indexOf(u)%2?Fo:Ad,p=1+c;return{linkType:$l,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),s={linkType:wu,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Fo,roundNumber:n,structureId:t.structureId}},l=[{linkType:wu,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Fo,roundNumber:1,structureId:i.structureId}},{linkType:$l,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Fo,roundNumber:1,structureId:i.structureId}}];return[...o,s,...l]}function Yue({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let o=[],{matchUps:s}=Ec({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=gc({structureName:t||Qr(Oe),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:Oe,matchUpType:e,matchUps:s});o.push(l);let u=r/2,{matchUps:c}=Ec({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=gc({structureName:Qr(Cz),matchUps:c,structureId:a==null?void 0:a.pop(),stage:rn,stageSequence:2,matchUpType:e});o.push(d);let{matchUps:p}=rl({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),m=gc({structureName:Qr(Rz),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:$i,matchUpType:e});o.push(m);let h=que({mainStructure:l,consolationStructure:d,deciderStructure:m});return{structures:o,links:h,...J}}function Kue(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:o,isMock:s,uuids:l}=t;if(!ot(o)||o<2)return{matchUps:[],roundsCount:0};if(Us(o))return rl(t);let u=Xue(o),c=u.shift(),d=Se(1,((c==null?void 0:c.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],m=1;({matchUps:p}=OS({roundNumber:m,matchUpType:n,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:l})),m++;let h=t.roundLimit||e;for(let g of u){let v=g.participantsCount/2,y=Se(1,v+1);r&&v===r&&(h=m-1);let I=y.map(b=>{let S=dO({roundPosition:b,roundNumber:m,idPrefix:a,uuids:l});return{roundPosition:b,roundNumber:m,matchUpId:S}});p.push(...I),m++}let f=m-1;return p=ib({finishingPositionOffset:i,lucky:!0,roundsCount:f,roundLimit:h,matchUps:p}),h&&(p=p.filter(g=>g.roundNumber<=h)),{matchUps:p,roundsCount:f,roundLimit:h}}function Xue(t){let e=Ze(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),o=a===1,s=!!(!o&&a%2);i=!o&&s?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:s})}return n}function E3(t){var m,h;let{playoffAttributes:e,stageSequence:i=1,stage:r=Oe,matchUpType:n,drawSize:a,uuids:o}=t,s=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,l=t.structureId||s()||(o==null?void 0:o.pop()),u=t.appliedPolicies??$t(t),c=((m=t.policyDefinitions)==null?void 0:m[kf])||(u==null?void 0:u[kf]);t.skipRounds=t.skipRounds||a<=4&&(c!=null&&c.feedFromMainFinal?0:1)||0;let d=t.structureName??((h=e==null?void 0:e["0"])==null?void 0:h.name)??Qr(Oe),p=()=>{let{matchUps:f}=rl(t);return{structures:[ao({stageSequence:i,structureName:d,matchUpType:n,structureId:l,matchUps:f,stage:r})],links:[],...J}};return{generators:{[La]:()=>({structures:[ao({finishingPosition:Od,stageSequence:i,structureName:d,matchUps:[],matchUpType:n,structureId:l,stage:r})],links:[],...J}),[up]:()=>{let{matchUps:f}=Kue(t);return{structures:[ao({stageSequence:i,structureName:d,matchUpType:n,structureId:l,matchUps:f,stage:r})],links:[],...J}},[Gs]:()=>p(),[ky]:()=>Yue(t),[Ef]:()=>gf({...t,roundOffsetLimit:3,playoffAttributes:e??zN}),[Mf]:()=>gf({...t,roundOffsetLimit:2,playoffAttributes:e??WN}),[$i]:()=>gf(t),[Ng]:()=>{let{matchUps:f}=Ec({drawSize:a,uuids:o,matchUpType:n});return{structures:[ao({stageSequence:i,structureName:d,matchUpType:n,structureId:l,stage:Oe,matchUps:f})],links:[],...J}},[xy]:()=>Vq(t),[Nf]:()=>_p({...t,feedRounds:1,fmlc:!0}),[Pz]:()=>_p({...t,feedRounds:1}),[jN]:()=>_p({...t,feedsFromFinal:1}),[GN]:()=>_p({...t,feedsFromFinal:2}),[HN]:()=>_p({...t,feedsFromFinal:3}),[Fy]:()=>_p(t),[lT]:()=>Gq(t),[Xo]:()=>ub(t),[Bl]:()=>Wue(t)}}}function AO(t){var _,L,B,V,G;let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:r,staggeredEntry:n,drawDefinition:a,tieFormat:o,isMock:s,uuids:l}=t||{},u=Ze(t.drawSize),c=t.drawTypeCoercion??Ub({appliedPolicies:r,drawType:t.drawType}),d="generateDrawStructuresAndLinks",p=C3({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:c,drawSize:u});if(p.error)return p;let m=p.drawType,h=[],f=[],g=(t==null?void 0:t.matchUpType)??ti,v=(_=a==null?void 0:a.structures)==null?void 0:_.filter(({stage:j})=>j===Ye);v&&h.push(...v);let y=v==null?void 0:v.map(({structureId:j})=>j),I=(L=a==null?void 0:a.structures)==null?void 0:L.find(({stage:j,stageSequence:z})=>j===Oe&&z===1),b=(B=a==null?void 0:a.links)==null?void 0:B.filter(j=>j.target.structureId===(I==null?void 0:I.structureId)&&(y==null?void 0:y.includes(j.source.structureId))),S=(j,z)=>{var q;if(j.linkType===bu&&(z!=null&&z.structures)){let W=j.source.finishingPositions||[];return z.structures.length*W.length}else if(j.linkType===wu&&((q=z==null?void 0:z.matchUps)!=null&&q.length)){let W=j.source.roundNumber;return z.matchUps.filter(({roundNumber:Y})=>Y===W).length}},w=v==null?void 0:v.map(j=>{var K,H,Q;let z=b==null?void 0:b.find(X=>X.target.structureId===j.structureId),q=((H=(K=ai({structure:j}))==null?void 0:K.positionAssignments)==null?void 0:H.length)??0;if(!z)return q;let W=z==null?void 0:z.source.structureId,Y=(Q=a.structures)==null?void 0:Q.find(X=>X.structureId===W),re=S(z,Y)||0;return q-re}).filter(Boolean).reduce((j,z)=>j+z,0),U=b==null?void 0:b.map(j=>{let z=j.source.structureId,q=v==null?void 0:v.find(W=>W.structureId===z);return S(j,q)}).filter(Boolean).reduce((j,z)=>j+z,0),T=!!(I&&!((V=I==null?void 0:I.matchUps)!=null&&V.length));if(v!=null&&v.length&&!T)return{error:bE};let D=!(v!=null&&v.length)&&t.qualifyingProfiles,P=(D==null?void 0:D.length)&&R3({idPrefix:t.idPrefix,qualifyingProfiles:D,appliedPolicies:r,isMock:s,uuids:l});if(P!=null&&P.error)return P;let{qualifyingDrawPositionsCount:C,qualifyingDetails:R,qualifiersCount:N}=P||{qualifyingDrawPositionsCount:w,qualifiersCount:U};C&&(P!=null&&P.structures&&h.push(...P.structures),P!=null&&P.links&&f.push(...P.links)),Object.assign(t,Ge({drawSize:u,matchUpType:g,tieFormat:o}));let A=m!==La&&(!u||u<2||!n&&![Ng,up].includes(m)&&([Bl,Xo].includes(m)&&u<3||![Xo,Bl].includes(m)&&!Us(u)));if(A&&!C)return ee({context:{drawSize:u,invalidDrawSize:A},result:{error:B0},stack:d});let{generators:M,error:E}=E3(t);if(E)return{error:E};let O=M[m];if(!O)return{error:oN};let k=O==null?void 0:O();if(k.error)return k;let{structures:x,links:F}=k;if(x!=null&&x.length){let j=x.find(({stage:z,stageSequence:q})=>z===Oe&&q===1);if(I&&j){if(T){let z=j.structureId;if(j.structureId=I.structureId,F==null?void 0:F.length)for(let q of F)q.source.structureId===z&&(q.source.structureId=I.structureId),q.target.structureId===z&&(q.target.structureId=I.structureId)}else if(!i)return{error:bE}}h.push(...x)}h.sort(Km),F!=null&&F.length&&f.push(...F);let $=k.structures.find(({stage:j,stageSequence:z})=>j===Oe&&z===1);for(let j of R||[]){let{finalQualifyingRoundNumber:z,finalQualifyingStructureId:q,roundTarget:W,finishingPositions:Y,linkType:re}=j,K=$&&((G=mb({targetStructureId:$.structureId,sourceStructureId:q,sourceRoundNumber:z,finishingPositions:Y,targetEntryRound:W,linkType:re}))==null?void 0:G.link);if(K!=null&&K.error)return K;K&&f.push(K)}return b&&f.push(...b),{...J,qualifyingResult:{qualifyingDrawPositionsCount:C,qualifiersCount:N},structures:h,links:f}}function OO(t){var I,b;let{modifyOriginal:e=!0,stageSequence:i=1,isMock:r}=t||{},n="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return ee({result:{error:_e},stack:n});let a=e?t.drawDefinition:Me(t.drawDefinition,!1,!0),{tieFormat:o,matchUpType:s}=t;if(o){let S=Hn({tieFormat:o});if(S.error)return S}o=qr(o??((I=vn({drawDefinition:a}))==null?void 0:I.tieFormat)),s=s??(a.matchUpType||ti),t.tieFormat=o,t.matchUpType=s;let l=RS({drawDefinition:a,stage:Oe});t.drawSize=t.drawSize??l,!l&&t.drawSize&&MS({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:Oe});let u=sn({drawDefinition:a}).drawMatchUps.map(Tr),c=AO(t);if(c.error)return ee({result:c,stack:n});let{structures:d,links:p,qualifyingResult:m}=c;a.structures=d,a.links=p;let h=Math.max(t.qualifiersCount??0,(m==null?void 0:m.qualifiersCount)||0);if(m!=null&&m.qualifyingDrawPositionsCount&&!RS({stage:Ye,drawDefinition:a})){let S=MS({drawSize:m.qualifyingDrawPositionsCount,stage:Ye,drawDefinition:a});if(S.error)return S}if(h){let S=Mq({qualifiersCount:h,drawDefinition:a,stage:Oe});if(S.error)return S}let f=t.drawSize??l;Object.assign(t,Ge({drawSize:f,matchUpType:s,tieFormat:o}));let{matchUps:g,matchUpsMap:v}=mr({drawDefinition:a});o&&(g==null||g.forEach(S=>{if(!u.includes(S.matchUpId)){let{tieMatchUps:w}=fb({tieFormat:o,matchUp:S,isMock:r});Object.assign(S,{tieMatchUps:w,matchUpType:s})}}));let{inContextDrawMatchUps:y}=_d({drawDefinition:a,matchUpsMap:v});return si({tournamentId:(b=t.tournamentRecord)==null?void 0:b.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:y,drawDefinition:a,matchUpsMap:v,...J,structures:d,matchUps:g,links:p}}function Tb(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,o;if(!N3({scaleItem:n}))return{error:hm};if(r&&Array.isArray(i.participants)&&(o=i.participants.find(s=>s.participantId===r),o)){if(o.participantType===Vn&&(n==null?void 0:n.eventType)!==Sa)return{error:hm};let s=A3({removePriorValues:e,participant:o,scaleItem:n});if(s.error)return s;a=!s.valueChanged;let{topics:l}=vo();l.includes(nn)&&lt({topic:nn,payload:{tournamentId:i.tournamentId,participants:[o]}})}return a&&{...J,info:RN,existingValue:n==null?void 0:n.scaleValue}||o&&{...J,newValue:n==null?void 0:n.scaleValue}||{error:zi}}function M3(t){var d;let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=t;if(!r)return{error:ge};if(!r.participants)return{error:Cy};let o=0,s={},l=[];for(let p of e){let m=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let h of p.scaleItems)if(N3({scaleItem:h}))Array.isArray(s[m])||(s[m]=[]),s[m].push(h);else return{error:hm}}for(let p of r.participants){let{participantId:m}=p||{};if(Array.isArray(s[m]))for(let h of s[m]){if(p.participantType===Vn&&(h==null?void 0:h.eventType)!==Sa)return ee({context:{participantId:m,scaleItem:h,participantType:p.participantType},info:"Invalid participantType for eventType",result:{error:hm}});A3({participant:p,scaleItem:h,removePriorValues:i}),l.push(p),o++}}let u=o?void 0:Eg,{topics:c}=vo();if(c.includes(nn)&&o&&lt({topic:nn,payload:{tournamentId:r.tournamentId,participants:l}}),a){let{eventId:p,drawId:m,...h}=a,f=((d=h.scaleAttributes)==null?void 0:d.scaleType)&&[h.scaleAttributes.scaleType];if(Object.keys(h).length){let g={itemType:dA,itemValue:h};if(f&&(g.itemSubTypes=f),m||p){let{drawDefinition:v,event:y}=Wn({tournamentRecord:r,eventId:p,drawId:m});m&&oO({drawDefinition:v,timeItem:g}),p&&uh({event:y,timeItem:g})}else bb({tournamentRecord:r,timeItem:g})}}return n&&c.includes(mu)&&lt({topic:mu,payload:n}),Ge({...J,modificationsApplied:o,info:u})}function N3({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e==null?void 0:e.includes(r)).length===i.length}function A3({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:jm};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(u=>r.includes(u)&&i[u]).length!==n.length)return{error:hm};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:o}=Cl({scaleAttributes:i,participant:e}),s=u=>[void 0,null,""].includes(u),l=!(s(o==null?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o==null?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[kd,u,c,d].join("."),m=Ge({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(m.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(h=>h.itemType!==p)),e.timeItems.push(m)}return{...J,valueChanged:l,newValue:i.scaleValue}}function kO(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=ze(t,[{[br]:!0},{modifiedScaleValues:!0,[Xn]:ea}]);if(n.error)return n;for(let a in i){let o=Tb({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(o.error)return o}return{...J}}function Vf(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:pr};let{participant:a,tournamentId:o}=qc({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...Cl({participant:a,scaleAttributes:i}),tournamentId:o}:{error:zi}}var Jue=(t=0)=>250/Math.pow(t+5,.4),Zue=()=>1;function Que(t=3,e=2){let i=t/e;return isNaN(i)?tf.kDefault():i}var tf={nSpread:400,diffThreshold:.125,kCalc:Jue,kMultiplier:Que,kDefault:Zue};function O3(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=Mr,winnerCountables:n=1,loserCountables:a=0,ratingType:o=ko,maxCountables:s,countables:l}=t||{},u=r==null?void 0:r[o];if(!u)return{error:Xe};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,m=d?c.slice().reverse():c,h=(E,O)=>parseFloat(O)>=Math.min(...E)&&parseFloat(O)<=Math.max(...E);(!h(c,e)||!h(c,i))&&(h(c,e)||(e=u.defaultInitialization),h(c,i)||(i=u.defaultInitialization));let f=af({targetRange:Mr[ko].range,sourceRange:m,value:d?c[0]-e:e}),g=af({targetRange:Mr[ko].range,sourceRange:m,value:d?c[0]-i:i}),v=(E,O)=>1/(1+Math.pow(10,(O-E)/tf.nSpread)),y=v(f,g),I=v(g,f),b=tf.kCalc(n),S=tf.kCalc(a),w=tf.kMultiplier(s,l),U=f+w*b*(1-y),T=g+w*S*(0-I),D=af({sourceRange:Mr[ko].range,value:U,targetRange:m}),P=af({sourceRange:Mr[ko].range,value:T,targetRange:m}),C=d?c[0]-D:D,R=parseFloat(C.toFixed(p)),N=d?c[0]-P:P,A=parseFloat(N.toFixed(p)),M=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(D>P&&M>tf.diffThreshold||R<0||A<0)&&(R=e,A=i),{newWinnerRating:R,newLoserRating:A}}var ece=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function k3(t){var y,I;let e=ze(t,[{[br]:!0},{matchUpIds:!0,[Xn]:un,[Bo]:$m},{ratingType:!1,[Kr]:b=>Mr[b]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a=ko,refreshDynamic:o,considerGames:s,drawDefinition:l,matchUpIds:u,asDynamic:c}=t,d=Mr[a],{accessor:p}=d,m={},h=(t.matchUps||o&&Sn({drawDefinition:l,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:gr}}).matchUps||Br({matchUpFilters:{matchUpIds:u,matchUpStatuses:gr},tournamentRecord:n,inContext:!0}).matchUps)??[],f=`${a}.${tA}`,g=c?f:a;h.sort(nh);for(let b of h){let{endDate:S,matchUpFormat:w,score:U,sides:T,winningSide:D}=b,P=b.matchUpType,C={eventType:P,scaleName:a,scaleType:fc},R={scaleName:f,eventType:P,scaleType:fc},N=Object.assign({},...(T??[]).map(_=>{let{sideNumber:L,participant:B}=_;return L&&{[L]:[B==null?void 0:B.participantId,...(B==null?void 0:B.individualParticipantIds)??[]].filter(Boolean).flat()}})),A=Object.assign({},...Object.values(N).flat().map(_=>{let L=m[_],B=!o||L?Vf({scaleAttributes:R,tournamentRecord:n,participantId:_}).scaleItem:void 0,V=Vf({tournamentRecord:n,scaleAttributes:C,participantId:_}).scaleItem,G=p?{[p]:void 0}:void 0;return _&&{[_]:B??V??{scaleName:g,eventType:P,scaleDate:S,scaleType:fc,scaleValue:G}}})),M=w?kn(w):{},E=(M==null?void 0:M.bestOf)||1,O=(M==null?void 0:M.setsTo)||1,k=s?E&O:E,x=(U==null?void 0:U.sets)&&ece(U.sets)||D===1&&[1,0]||[0,1],F=D?N[D]:[],$=D?N[3-D]:[];for(let _ of F){let L=(y=A[_])==null?void 0:y.scaleValue,B=typeof L=="object"?L[p]:L;for(let V of $){let G=(I=A[V])==null?void 0:I.scaleValue,j=typeof G=="object"?G[p]:G,z=D?x[D]:[0,0],q=D?x[3-D]:[0,0],{newWinnerRating:W,newLoserRating:Y}=O3({winnerCountables:z,loserCountables:q,maxCountables:k,winnerRating:B,loserRating:j,ratingType:a}),re=p?{...L,[p]:W}:W,K=p?{...G,[p]:Y}:Y;A[_].scaleValue=re,A[V].scaleValue=K,A[_].scaleName=g,A[V].scaleName=g}}Object.assign(m,A),i&&kO({tournamentRecord:n,modifiedScaleValues:m,removePriorValues:r})}let v=h.map(({matchUpId:b})=>b);return{...J,modifiedScaleValues:m,outputScaleName:g,processedMatchUpIds:v}}function ZT(t){var g;let{matchUpIds:e=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:o}=t;if(typeof i!="object")return{error:_e};let{participantIdPairings:s,matchUpsCount:l}=t,u=KT(t);if(u.error)return ee({result:u});let{lastRoundNumber:c,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=u;if(!l)n?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return ee({result:{error:oe,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(s&&!Array.isArray(s)||l&&!ot(l)||e&&!Array.isArray(e)||!s&&!l)return{error:oe,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:oe,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(c||0))return{error:oe,info:"roundNumber error"};let m=r??(n&&(c??0)+1||c||1);s=s??Se(0,l).map(()=>({participantIds:[void 0,void 0]}));let h=v=>{if(!t.idPrefix)return;let y=i.drawId,I=t.idPrefix??"ah";return`${y}-${I}-${m}-${v}`},f=s==null?void 0:s.map((v,y)=>{let I=(v==null?void 0:v.participantIds)??[void 0,void 0];I.push(void 0,void 0);let b=I.slice(0,2).map((w,U)=>Ge({sideNumber:U+1,participantId:w})),S=e[y]??h(y)??Gt();return{roundNumber:m,matchUpStatus:Ji,matchUpId:S,sides:b}});if(f!=null&&f.length){let v=(g=vn({drawDefinition:i,event:o}))==null?void 0:g.tieFormat;v&&f.forEach(y=>{let{tieMatchUps:I}=fb({tieFormat:v,matchUp:y,isMock:a});Object.assign(y,{tieMatchUps:I,matchUpType:hi})})}return{roundNumber:m,matchUpsCount:(f==null?void 0:f.length)??0,matchUps:f,...J}}function tce({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),o=Object.keys(i),s=[],l=WB({actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),u=[mC(l)];s.push(l);let c=l.value,d=l,p=1,m=0,h=o.length,f;do h-=1,f=o.length*i[o[0]].length;while(f>t&&h>5);let g=[];o.forEach(y=>{i[y].slice(0,h).forEach(I=>{m+=1;let b=Jp(y,I.opponent);if(!g.includes(b)){let S=WB({stipulated:[[y,I.opponent]],actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!u.includes(mC(S))){u.push(mC(S)),s.push(S);let{maxDelta:w,value:U}=S;w<d.maxDelta&&(d=S),(U<c||U===c&&Math.round(Math.random()))&&(c=U),g.push(b),p+=1}}}),s=s.filter(I=>Math.abs(I.value-c)<5)}),s.sort((y,I)=>y.maxDiff-I.maxDiff);let v=fa(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:m,candidate:v}}function mC(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function WB({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let o=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,m]=d,h=Jp(p,m),f=i[h];s.push({participantIds:d,value:f}),l+=i[h]}),Pr(t,a).map(d=>wn(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((m,h)=>o.includes(h)||m,!1)){o.push(...p);let m=d.value;l+=m,s.push({participantIds:p,value:m})}}),s.sort((d,p)=>d.value-p.value);let u=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=Jp(m,h),g=r[f];return g>d?g:d},0),c=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=Jp(m,h),g=n[f];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:u,maxDiff:c}}function Jp(t,e){return[t,e].sort(FT).join("|")}function x3({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let o=Jp(a,n);i.includes(o)||i.push(o)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function ice({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(Ut);if(r.length===2){let[n,a]=r,o=Jp(n,a);e.includes(o)||e.push(o)}}return{encounters:e}}function rce({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(o=>r(n,o));i[n]=a.sort((o,s)=>o.value-s.value)}function r(n,a){let o=Jp(n,a);return{opponent:a,value:e[o]}}return{pairingValues:i}}var nce=0;function ace({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){var o;let a=((o=Mr[r])==null?void 0:o.defaultInitialization)??nce;return n.split("|").map(s=>{var l;if(i===uo){let u=(l=t==null?void 0:t.find(c=>c.participantId===s))==null?void 0:l.individualParticipantIds;return u?u==null?void 0:u.map(c=>e[c]||a):a*2}else return e[s]||a})}function oce(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:o,deltaObjects:s,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;n.forEach(I=>{let b=ace({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:I}),S=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?S:S*-1)||0,U=Math.abs(b[0]-b[1])+w,T=Math.abs(b[0]-b[1]);s[I]=T,l[I]||(l[I]=0),l[I]+=U?Math.pow(U,2):0});let p=n.map(I=>({pairing:I,value:l[I]})).sort((I,b)=>I.value-b.value),{pairingValues:m}=rce({possiblePairings:r,valueObjects:l}),{candidate:h,candidatesCount:f,deltaCandidate:g,iterations:v}=tce({valueSortedPairings:p,maxIterations:a,pairingValues:m,deltaObjects:s,valueObjects:l}),{participantIdPairings:y}=o?g:h;return{participantIdPairings:y,candidatesCount:f,deltaCandidate:g,iterations:v,candidate:h}}var sce=100,lce=100,uce=4e3;function xO(t){var G,j;let{encounterValue:e=sce,sameTeamValue:i=lce,maxIterations:r=uce,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:o,iterationMatchUps:s,tournamentRecord:l,dynamicRatings:u,refreshDynamic:c,participantIds:d,drawDefinition:p,roundNumber:m,structureId:h,matchUpIds:f,eventType:g,scaleName:v,idPrefix:y,isMock:I,salted:b,event:S}=t;if(!p)return{error:_e};if(!t.structure&&!h)return{error:Ei};let w=t.structure||et({drawDefinition:p,structureId:h}).structure;if(!Nt(w))return{error:sp};if(!(d!=null&&d.length))return{error:Vc};let U=[...s??[],...(w==null?void 0:w.matchUps)??[]],{encounters:T}=ice({matchUps:U}),D=(l==null?void 0:l.participants)??[],P={};if(u){let z=ct(w!=null&&w.matchUps?w.matchUps.map(({roundNumber:W})=>W):[]),q=Math.max(...z,0);if(q){let W=(G=w==null?void 0:w.matchUps)==null?void 0:G.filter(({roundNumber:re})=>re===q).map(({matchUpId:re})=>re),Y=k3({ratingType:v??((j=S==null?void 0:S.category)==null?void 0:j.ratingType),updateParticipantRatings:n,tournamentRecord:l,asDynamic:!0,refreshDynamic:c,drawDefinition:p,matchUpIds:W});if(Y.error)return Y;Y.modifiedScaleValues&&(P=Y.modifiedScaleValues)}}let{valueObjects:C}=cce({tournamentParticipants:D,encounterValue:e,sameTeamValue:i,encounters:T}),{uniquePairings:R,possiblePairings:N,deltaObjects:A}=x3({participantIds:d}),M=Object.values(P).length?P:t.adHocRatings,E={tournamentParticipants:D,possiblePairings:N,participantIds:d,uniquePairings:R,drawDefinition:p,maxIterations:r,adHocRatings:M,deltaObjects:A,valueObjects:C,eventType:g,scaleName:v,structure:w,salted:b},{candidatesCount:O,participantIdPairings:k,deltaCandidate:x,iterations:F,candidate:$}=oce(E);if(!O)return{error:Y0};let _,L;if(a){let z=ZT({structureId:w==null?void 0:w.structureId,ignoreLastRoundNumber:o,participantIdPairings:k,newRound:!0,drawDefinition:p,roundNumber:m,matchUpIds:f,idPrefix:y,isMock:I,event:S});if(z.error)return z;_=z.roundNumber,L=z.matchUps}let{maxDelta:B,maxDiff:V}=$;return{roundNumber:_,participantIdPairings:k,modifiedScaleValues:P,candidatesCount:O,deltaCandidate:x,...J,iterations:F,matchUps:L,maxDelta:B,maxDiff:V}}function cce({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let o of t)n[o]||(n[o]=0),n[o]+=i;let a=e==null?void 0:e.filter(({participantType:o})=>o===Kt);if(a)for(let o of a){let s=o.individualParticipantIds??[],{uniquePairings:l}=x3({participantIds:s});for(let u of l)n[u]||(n[u]=0),n[u]+=r}return{valueObjects:n}}function F3(t){var C,R,N,A;let{drawType:e=Gs,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:o,placeByes:s,isMock:l,event:u}=t,c=t==null?void 0:t.drawDefinition;if(!c)return{error:_e};let d=Ar,p=Jm({stageSequence:1,drawDefinition:c,stage:d}),m=[Xo,ky,Bl].includes(e)?p.length:Ug(p.length);if(!a&&e===Ng&&p.length<2||e===Xo&&p.length<3)return{error:B0};let{tieFormat:h,matchUpType:f}=t;if(h){let M=Hn({tieFormat:h});if(M.error)return M}h=qr(h??((C=vn({drawDefinition:c}))==null?void 0:C.tieFormat)),f=f??c.matchUpType??ti;let{structures:g}=Zo({stageSequence:1,drawDefinition:c,stage:d});if(g.length>1)return{error:AG};if((N=(R=g==null?void 0:g[0])==null?void 0:R.matchUps)!=null&&N.length)return{error:EN};let v=(A=g==null?void 0:g[0])==null?void 0:A.structureId;Object.assign(t,Ge({structureName:t.structureName??Qr(Ar),structureId:v,matchUpType:f,tieFormat:h,drawSize:m,stage:d}));let y=E3(t);if(y.error)return y;let I=y.generators[e];if(!I)return{error:oN};let b=I==null?void 0:I();if(b.error)return b;let{structures:S,links:w}=b,U=S.map(M=>Wt({structure:M}).matchUps).flat();h&&U.forEach(M=>{let{tieMatchUps:E}=fb({matchUp:M,tieFormat:h,isMock:l});Object.assign(M,{tieMatchUps:E,matchUpType:f})}),(!r||!i)&&(c=Me(c,!1,!0)),c.links||(c.links=[]),w.length&&c.links.push(...w);let T=S.map(({structureId:M})=>M);c.structures||(c.structures=[]);let D=c.structures.map(({structureId:M})=>M);c.structures=c.structures.map(M=>T.includes(M.structureId)?S.find(({structureId:E})=>E===M.structureId):M);let P=S.filter(({structureId:M})=>!D.includes(M));return P.length&&c.structures.push(...P),o&&pb({seedingProfile:t.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:c,structureId:v,placeByes:s,drawSize:m,event:u}),i&&si({drawDefinition:c}),{links:w,structures:S,...J}}var FO={};yt(FO,{addGame:()=>H3,addPoint:()=>G3,addSet:()=>W3,addShot:()=>z3,analyzeScore:()=>jO,analyzeSet:()=>LI,calculateHistoryScore:()=>B3,checkScoreHasValue:()=>vr,checkSetIsComplete:()=>tD,clearHistory:()=>j3,generate:()=>L3,generateScoreString:()=>El,generateTieMatchUpScore:()=>Ib,getSetComplement:()=>HO,getTiebreakComplement:()=>aD,helpers:()=>X3,isValidMatchUpFormat:()=>Ua,keyValueScore:()=>U6,mutate:()=>$3,parseMatchUpFormat:()=>kn,parseScoreString:()=>LS,query:()=>R6,redo:()=>q3,reverseScore:()=>_3,setServingSide:()=>V3,stringifyMatchUpFormat:()=>nT,tidyScore:()=>P6,umo:()=>K3,undo:()=>Y3,validateScore:()=>GO,validateTieFormat:()=>Hn});var L3={};yt(L3,{generateScoreString:()=>El,generateTieMatchUpScore:()=>Ib,reverseScore:()=>_3});function El(t){let{winnerFirst:e=!0,addOutcomeString:i,reversed:r=!1,matchUpStatus:n,matchUpFormat:a,autoComplete:o,winningSide:s,sets:l}=t;if(!l)return{error:Xe,info:"missing sets"};let u=a&&kn(a),{bestOf:c,finalSetFormat:d,setFormat:p}=u??{},m=r||!(!e||!s||s===1),h=i?dce({matchUpStatus:n}):"",f=(l==null?void 0:l.sort(pce).map(g).filter(Boolean).join(" "))||"";if(!h)return f;if(s===2)return`${h} ${f}`;return`${f} ${h}`;function g(v){let y=c&&v.setNumber===c&&d?d:p,I=$=>Li($==null?void 0:$.side1Score)||Li($==null?void 0:$.side2Score),b=$=>Li($==null?void 0:$.side1TiebreakScore)||Li($==null?void 0:$.side2TiebreakScore),S=(y==null?void 0:y.tiebreakSet)||!I(v)&&b(v),{side1Score:w,side2Score:U,side1TiebreakScore:T,side2TiebreakScore:D}=v,P=T||(Li(T)||o?0:""),C=D||(Li(D)||o?0:"");if(S)return`[${(m?[C,P]:[P,C]).join("-")}]`;let R=Math.min(P,C),N=R===P?1:2,A=R?`(${R})`:"",M=w||(Li(w)||o?0:""),E=U||(Li(U)||o?0:""),O=$=>N===$?A:"",k=`${M}${O(1)}`,x=`${E}${O(2)}`,F=m?`${[x,k].join("-")}`:`${[k,x].join("-")}`;return["-"," "].includes(F)&&(F=""),F}}function dce({matchUpStatus:t}){let e={[mn]:"RET",[zt]:"WO",[cr]:"DF/DF",[er]:"WO/WO",[Wc]:"SUS",[$a]:"ABN",[Mt]:"DEF",[xg]:"DR"};return t&&e[t]||""}function pce(t,e){return t.setNumber-e.setNumber}function _3(t){if(!(t!=null&&t.score))return{error:Xe};let{sets:e}=t.score,i=e.map(a=>{let{side1TiebreakScore:o,side2TiebreakScore:s,winningSide:l,side1Score:u,side2Score:c,setNumber:d}=a;return Ge({winningSide:l?3-l:void 0,side1TiebreakScore:s,side2TiebreakScore:o,side1Score:c,side2Score:u,setNumber:d})}),r=El({sets:i}),n=El({sets:i,reversed:!0});return{reversedScore:{sets:i,scoreStringSide1:r,scoreStringSide2:n},...J}}var $3={};yt($3,{addGame:()=>H3,addPoint:()=>G3,addSet:()=>W3,addShot:()=>z3,calculateHistoryScore:()=>B3,clearHistory:()=>j3,redo:()=>q3,setServingSide:()=>V3,umo:()=>K3,undo:()=>Y3});function vp({matchUp:t}){let{extension:e}=gt({name:bT,element:t});if(!e)return{error:_r};let{history:i=[],undoHistory:r=[]}=e.value;return{history:i,undoHistory:r,...J}}function B3(t){var P,C;if(!t)return{error:Xe};let{matchUp:e,updateScore:i}=t;if(!e)return{error:na};let r=((P=vp({matchUp:e}))==null?void 0:P.history)||[];if(!Array.isArray(r))return{error:oe,info:"history is not an array"};let{matchUpFormat:n}=e;if(!n)return{error:mN};if(!Ua({matchUpFormat:n}))return{error:pN};let a=kn(n),{bestOf:o,finalSetFormat:s,setFormat:l}=a,u=["0","15","30","40","A","G"],c={sets:[]},d=[],p,m=[0,0],h=1,f=0,g,v=0,y=R=>[1,2].includes(R),I=()=>(f+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:f,games:[]}),b=()=>({winningSide:void 0,points:[]}),S=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),w=S(),U=b(),T=I(),D=0;for(let R of r){D+=1,g=c.sets.length+1===o;let N=g&&s?s:l,{tiebreakAt:A,setTo:M,NoAD:E,tiebbreakFormat:O}=N,k=T.side1Score===A&&T.side1Score===T.side2Score,x=!!N.tiebreakSet,F=x?N.tiebreakSet:O,{tiebreakTo:$,NoAD:_}=F||{},L=()=>{p=void 0,m=[0,0],h=3-h,T.side1TiebreakScore=0,T.side2TiebreakScore=0,T.side1PointScore="",T.side2PointScore="",v=0},B=j=>{T.winningSide=j;let{s:z,...q}=T;c.sets.push(q),w=S(),U=b(),T=I(),L()},V=j=>{U.winningSide=j;let{g:z,...q}=U;T.games.push(q),w=S(),U=b(),L();let W=`side${j}Score`;T[W]+=1},G=j=>{w.winningSide=j;let{p:z,...q}=w;U.points.push(q),w=S(),v=0;let W=()=>m.reduce((re,K)=>re+K)%4/4>.5?h:3-h,Y=j-1;if(k||x){m[Y]+=1,p=W(),T[`side${j}TiebreakScore`]=m[Y],T[`side${3-j}TiebreakScore`]=m[1-Y];let re=_?1:2;if(m[Y]>=$&&m[Y]>=m[1-Y]+re)return V(j),{gameCompleted:!0}}else if(m[1-Y]===4&&m[Y]===3?m[1-Y]-=1:m[Y]+=1,T.side1PointScore=u[m[0]],T.side2PointScore=u[m[1]],m[Y]===5||m[Y]===4&&m[1-Y]<3||E&&m[Y]===4)return V(j),{gameCompleted:!0}};if(y(R.srv)&&(h=R.srv),["p","s","g","o"].includes(R.u)&&d.push(R.u),R.shotOutcome&&(w.shots.push(R),R.shotType==="SERVE"&&["OUT","NET"].includes(R.shotOutcome)&&(v+=1),v===2)){let j=3-h;G(j)}if(y(R.p)||ot(R.pointNumber)){let j=R.winningSide||R.p;if((C=G(j))!=null&&C.gameCompleted)continue}if(y(R.g)||ot(R.gameNumber)){let j=R.winningSide||R.g;U.winningSide=j;let z=`side${j}Score`,q=`side${3-j}Score`;if(d.length&&(d.includes("p"),d=[]),V(j),T[z]===M&&T[z]-T[q]>=(E?1:2)&&(B(j),g))break}if(y(R.s)||ot(R.setNumber)){let j=R.winningSide||R.s;if(B(j),d.length&&(d.includes("p"),d.includes("g"),d=[]),g)break}}return D!==r.length&&console.log({error:"Match completed with excess history"}),(T.side1Score||T.side2Score||T.games.length||T.side1TiebreakScore||T.side2TiebreakScore)&&c.sets.push(T),c.scoreStringSide1=El({...c,matchUpFormat:n}),c.scoreStringSide2=El({...c,matchUpFormat:n,reversed:!0}),h=p||h,i&&(e.score=c),{...J,servingSide:h,score:c}}function Ip({undoHistory:t,history:e,matchUp:i}){return Lt({element:i,extension:{value:{history:e,undoHistory:t},name:bT}})}function V3({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:vN};let{history:i=[]}=vp({matchUp:t});return i.push({srv:e}),Ip({matchUp:t,history:i})}function j3({matchUp:t}){return Ip({matchUp:t})}function G3({matchUp:t,point:e}){if(!e||!t)return{error:Xe};if(typeof e!="object")return{error:oe,context:{point:e}};let{history:i=[]}=vp({matchUp:t});return i.push(e),Ip({matchUp:t,history:i})}function H3({matchUp:t,game:e}){if(typeof e!="object")return{error:oe,context:{game:e}};let{history:i=[]}=vp({matchUp:t});return i.push(e),Ip({matchUp:t,history:i})}function z3({matchUp:t,shot:e}){if(typeof e!="object")return{error:Xe};let{history:i=[]}=vp({matchUp:t});return i.push(e),Ip({matchUp:t,history:i})}function W3({matchUp:t,set:e}){if(typeof e!="object")return{error:Xe};let{history:i=[]}=vp({matchUp:t});return i.push(e),Ip({matchUp:t,history:i})}function q3({matchUp:t}){let{history:e=[],undoHistory:i=[]}=vp({matchUp:t});return i.length&&e.push(i.pop()),Ip({matchUp:t,history:e,undoHistory:i})}function Y3({matchUp:t}){let{history:e=[],undoHistory:i=[]}=vp({matchUp:t});return i.push(e.pop()),Ip({matchUp:t,history:e,undoHistory:i})}var K3={},X3={};yt(X3,{keyValueScore:()=>U6,parseMatchUpFormat:()=>kn,stringifyMatchUpFormat:()=>nT,tidyScore:()=>P6});var Zp=" ",XE="DEF",mce="COMPLETED",J3="WO",hce="WO/WO",Z3="ABN",Q3="SUS",e6="RET",t6="INT",i6=[e6,XE,J3,hce,Z3,Q3,t6],JE="DEFAULTED",r6="WALKOVER",n6="ABANDONED",a6="SUSPENDED",o6="RETIRED",s6="INTERRUPTED",fce=[o6,JE,r6],gce="Enter Score",Tm="()",jd="[]",LO=["up","left","shift+tab"],_O=["enter","down","tab","right"],kS="backspace",l6="r",u6="s",c6="a",d6="d",p6="w",m6="i",QT=[l6,d6,p6,c6,u6,m6],eD="space",hC=["[","("],xS=[...LO,..._O,eD,"]"],h6="-",vce="/",Qp=h6,Ml=h6,f6=[vce],Ice=0,yce=["=","+","num_1","num_2","shift+=","shift+-"],$O=["0","1","2","3","4","5","6","7","8","9"].concat(QT),g6=$O.map(t=>`shift+${t}`),v6=[Qp,kS].concat(xS,f6),I6=[$O,g6,v6].join(","),bce=[I6,LO,_O,yce].join(","),wce={OUTCOMEKEYS:QT,SIDE1KEYS:$O,SIDE2KEYS:g6,MODIFIERS:v6,PROMPT:gce,MOVEUP:LO,MOVEDOWN:_O,HOTKEYS:bce};function zh({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=y6({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==Zp?Zp:"";return t+r+i}else return i+Zp+t}function y6({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of i6){let r=t==null?void 0:t.indexOf(i);r===0?t=t.slice(i.length+1).trim()+Zp:r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function ZE({analysis:t,scoreString:e,sets:i,lowSide:r}){var f,g,v;let n,a;if(!e)return{scoreString:e,sets:i};let{scoreString:o,removed:s}=y6({scoreString:e});if(e=o,s)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},u=Object.values(l).filter(y=>y!==void 0).length;l.setNumber&&u===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:c}=t.setFormat,{tiebreakTo:d,NoAD:p}=c||{},{isTiebreakEntry:m}=vf({brackets:jd,scoreString:e}),h=Sce(e);if(h>=0){n=e.slice(0,h);let{isTiebreakEntry:y}=vf({brackets:Tm,scoreString:n}),{lastOpenBracketIndex:I,isTiebreakEntry:b}=vf({brackets:jd,scoreString:n}),S=n&&n[n.length-1].trim(),w=n&&!isNaN(S),U=t.isIncompleteSetScore;if(m&&b){let T=n.slice(I+1).split(Ml),D=(T==null?void 0:T.length)>0&&T[0]!==void 0&&!isNaN(parseInt(T[0]))&&parseInt(T[0])||void 0,P=(T==null?void 0:T.length)>1&&T[1]!==void 0&&parseInt(T[1])||void 0,C=[D,P];if(P){let R=r===1?1:0;C[R]=((C==null?void 0:C[1-R])||0)+(p?1:2),(C[R]||0)<d&&(C[R]=d),n=e.slice(0,I+1),n+=C.join(Ml)}else D!==void 0?(n=e.slice(0,I+1),n+=D):(n=e.slice(0,I),U=!0);l.side1TiebreakScore=C[0]||0,l.side2TiebreakScore=C[1]||0}if(n.length||(n=void 0),U){let T=(f=l.side1Score)==null?void 0:f.toString();if(T){let D=T==null?void 0:T.slice(0,T.length-1);l.side1Score=!isNaN(D)&&parseInt(D)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let T=(g=l.side2Score)==null?void 0:g.toString(),D=(v=l.side1Score)==null?void 0:v.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let P=T==null?void 0:T.slice(0,T.length-1);l.side2Score=!isNaN(P)&&parseInt(P)||void 0}else{let P=D==null?void 0:D.slice(0,D.length-1);l.side1Score=!isNaN(P)&&parseInt(P)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else y?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(m&&!b?a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i,a[i.length-1]=l),m||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:e,sets:i}}function vf({brackets:t=Tm,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...js(i,n)),o=Math.max(...js(r,n));return{isTiebreakEntry:a>o,lastOpenBracketIndex:a}}function Uce({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=jd.split(""),a=t.split(""),o=Math.max(...js(r,a)),s=Math.max(...js(n,a)),l=Math.max(...js(Ml,a));return i&&o>s&&l>o}function Sce(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function b6(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function qB({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){var l;let n=kn(t),{bestOf:a}=n,o=Math.ceil(a/2),s=((l=r==null?void 0:r.reduce((u,c)=>{let{winningSide:d}=c;return d&&u[d-1]++,u},[0,0]))==null?void 0:l.indexOf(o))+1||void 0;return fce.includes(e)&&i&&(s=i),{matchUpWinningSide:s}}function tD({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:o}){var b;if(!o)return{error:Xe,info:"missing set"};e=e||i&&kn(i);let s=n&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:l,side2Score:u}=o,{setTo:c,tiebreakAt:d}=s,p=l||u,m=iD({set:o}),h=Math.abs(l-u),f=l>=c||u>=c,g=r||l>=c&&u>=c||d&&d<c&&(l===d||u===d),v=t||g&&(m===1&&o.side1TiebreakScore>o.side2TiebreakScore||m===2&&o.side2TiebreakScore>o.side1TiebreakScore),y=!g&&s.NoAD||g||r&&((b=s.tiebreakFormat)!=null&&b.NoAD)?1:2,I=h>=y;return!!((a&&p||f&&(I||g)||r)&&(!g||v))}function iD({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function BO({analysis:t,set:e}){let i=iD({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return tD({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function Tce({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];r=Ze(r);let{validSide2Score:o,requiresTiebreak:s}=Dce({analysis:t,set:a,value:r});if(o){n=!0,e=(e||"")+r,a.side2Score=r;let l=BO({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,s){let u=Tm.split("")[0];e+=u}else t.isDecidingSet||(e+=Zp)}return{sets:i,scoreString:e,updated:n}}function Dce({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:o}=r,{side1Score:s}=e,l,u;return n&&n<a?s===n?l=i<=a:l=i<=n:s===a?o?l=i<a:l=i<=a+1:s===a-1?o?l=i<=a:l=i<=a+1:s===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?u=s===a&&i===n||s===n&&i===a:u=s>=a&&i>=a&&s!==i),{validSide2Score:l,requiresTiebreak:u}}function w6({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let o;return e===l6?r?(o=!0,r=zh({scoreString:r,lowSide:t,outcome:e6}),n=t===2?1:2,a=o6):(o=!0,r=zh({scoreString:r,lowSide:t,outcome:XE}),n=t===2?1:2,a=JE):e===d6?(o=!0,r=zh({scoreString:r,lowSide:t,outcome:XE}),n=t===2?1:2,a=JE):e===p6?(o=!0,i=[],r=J3,n=t===2?1:2,a=r6):e===u6&&r?(o=!0,r=zh({scoreString:r,lowSide:t,outcome:Q3}),a=a6,n=void 0):e===c6?(o=!0,r=zh({scoreString:r,lowSide:t,outcome:Z3}),a=n6,n=void 0):e===m6&&r&&(o=!0,r=zh({scoreString:r,lowSide:t,outcome:t6}),a=s6,n=void 0),{updated:o,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function Pce(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:o,lowSide:s,value:l}=t,u,c;!(e!=null&&e.length)&&l!==kS&&(e=[{setNumber:1}]);let d=e.length-1;if(QT.includes(l)){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;m&&!h?i="missing side2Score":o.finalSetIsComplete||n?i="final set is already complete":o.isIncompleteSetScore?i="incomplete set scoreString":o.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:u}=w6({lowSide:s,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===kS){if({scoreString:r,sets:e,outcomeRemoved:c}=ZE({analysis:o,scoreString:r,sets:e}),(r==null?void 0:r.trim())===""&&(r=r.trim()),r||(e=[]),c){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;if(m&&h){let f=m>h&&1||h>m&&2||void 0;f&&(p.winningSide=f,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,u=!0}else if(o.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===eD){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p,f=m>h&&1||h>m&&2||void 0;f&&!n&&!o.isIncompleteSetScore&&(e[e.length-1].winningSide=f,e.push({setNumber:e.length+1}),r+=" ",u=!0)}else if(l===Qp&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&o.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let m=Ze((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=Ze(m),p=e[d].side1Score.toString(),u=!0}else{let m=Ze((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=Ze(m),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let m=(e.slice(0,d)||[]).filter(h=>h).map(h=>{let{side1Score:f,side2Score:g}=h;return[f,g].join("-")}).join(" ");m?r=m+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:u}}function Rce({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){var d;let o,s,{tiebreakSet:{tiebreakTo:l,NoAD:u}}=t.setFormat,[c]=jd.split("");if(t.isMatchTiebreakEntry||(r+=c),n[t.setNumber-1]){let{lastOpenBracketIndex:p}=vf({brackets:jd,scoreString:r}),m=(r.slice((p??0)+1)+(e?"":a)).split(Ml);if((((d=m[i-1])==null?void 0:d.length)||0)>=2)s="tiebreak digit limit";else if(e){i===1&&(m[0]=(m[0]||"")+a),i===2&&(m[1]=(m[1]||"")+a);let h=[m[0]||0,m[1]||0].map(v=>Ze(v)),f=i===1?1:0;h[f]=h[1-f]+(u?1:2),h[f]<l&&(h[f]=l);let g=n[n.length-1];g.side1TiebreakScore=h[0],g.side2TiebreakScore=h[1],r=r.slice(0,(p??0)+1),r+=h.join(Ml),o=!0}else{let h=[m[0]||0,m[1]||0].map(g=>Ze(g)),f=n[n.length-1];f.side1TiebreakScore=h[0],f.side2TiebreakScore=h[1],r+=a,o=!0}}else{let p=b6({lowValue:Ze(a||0),tiebreakTo:l,NoAD:u}),m=[Ze(a),p];i===2&&m.reverse();let h={side1TiebreakScore:m[0],side2TiebreakScore:m[1],setNumber:(n==null?void 0:n.length)+1||1};n.push(h),r+=m.join(Ml),o=!0}return{info:s,scoreString:r,sets:n,updated:o}}function Cce({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:o}=(t==null?void 0:t.setFormat)||{},s=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(o&&r===n||r>n)return{scoreString:i};let l=h(),u=[r,l];e===2&&u.reverse();let c=Tm.split("")[0],d=u.join(Qp)+(s?c:Zp);i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},m=BO({analysis:t,set:p});return p.winningSide=m||void 0,{scoreString:i,set:p};function h(){return s?r+1:r+1===n?r+(o?1:2):n}}function Ece({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){var x,F,$;let a=(((x=n==null?void 0:n.filter(_=>_==null?void 0:_.winningSide))==null?void 0:x.length)||0)+(i?0:1),o=kn(t),s=a===(o==null?void 0:o.bestOf),l=s&&(o==null?void 0:o.finalSetFormat)||(o==null?void 0:o.setFormat)||{},u=l==null?void 0:l.timed,c=s&&n[(o==null?void 0:o.bestOf)-1],d=c==null?void 0:c.winningSide,{isTiebreakEntry:p}=vf({brackets:Tm,scoreString:e}),{isTiebreakEntry:m}=vf({brackets:jd,scoreString:e}),h=p||m,f=!!l.tiebreakSet,g=(F=e==null?void 0:e[e.length-1])==null?void 0:F.trim(),v=e&&!isNaN(g),y=!h&&g===Qp,I=p&&hC.includes(g),b=m&&hC.includes(g),S=m&&g===Ml,w=e==null?void 0:e.split(""),[U]=jd.split(""),T=w&&Math.max(...js(U,w)),D=w&&Math.max(...js(Ml,w)),P=w&&D>T,C=($=n[n.length-1])==null?void 0:$.winningSide,R=(n==null?void 0:n.length)&&!C,N=i6.find(_=>(e==null?void 0:e.indexOf(_))>=0),A=!isNaN(r),M=r===eD,E=xS.includes(r),O=e==null?void 0:e.split("").find(_=>hC.includes(_)),k=E&&m&&!b&&(S||!Uce({scoreString:e}));return{isTiebreakSetValue:f&&A,matchUpScoringFormat:o,setNumber:a,setFormat:l,matchTiebreakHasJoiner:P,isGameScoreEntry:R,isSpace:M,isCloser:E,isTiebreakCloser:E&&O&&h&&v,isDecidingSet:s,isTiebreakSet:f,isTimedSet:u,isNumericEnding:v,isNumericValue:A,hasOpener:O,hasOutcome:N,finalSet:c,finalSetIsComplete:d,lastSetIsComplete:C,isInvalidSetTiebreakValue:M&&h&&I,isInvalidMatchTiebreakValue:k,isTiebreakEntry:h,isSetTiebreakEntry:p,isMatchTiebreakEntry:m,isIncompleteSetScore:y,isIncompleteSetTiebreak:I,isIncompleteMatchTiebreak:b,isPartialMatchTiebreakValue:S}}function U6(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:o}=t,{matchUpFormat:s,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!I6.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:m}=qB({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=m;let h=Ece({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:s});if(f6.includes(i)&&(i=Qp),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&p&&Ze(i)===0&&(h.isTiebreakCloser=!0),xS.includes(i)&&h.hasOpener&&(i=""),xS.includes(i)&&(i=eD),h.lastSetIsComplete){let f=(r==null?void 0:r.length)&&r[r.length-1];r&&f!==" "&&(r+=" ")}if(h.isTimedSet)({info:d,sets:n,scoreString:r,updated:c,matchUpStatus:o,winningSide:a}=Pce({analysis:h,lowSide:e,scoreString:r,sets:n,matchUpStatus:o,winningSide:a,value:i}));else if(QT.includes(i))h.finalSetIsComplete||a?d="final set is already complete":!h.isTiebreakEntry&&!h.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:o,winningSide:a,updated:c}=w6({lowSide:e,sets:n,scoreString:r,matchUpStatus:o,winningSide:a,value:i}):h.isTiebreakEntry||h.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===kS)c=!0,{scoreString:r,sets:n}=ZE({analysis:h,scoreString:r,sets:n,lowSide:e}),r||(n=[]),o=void 0,a=void 0;else if(h.hasOutcome)d="has outcome";else if(i===Qp&&!h.isMatchTiebreakEntry)(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(c=!0,{scoreString:r,sets:n}=ZE({analysis:h,scoreString:r,sets:n,lowSide:e}),o=void 0);else if(i===Ml&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?d="existing joiner":h.isNumericEnding&&(c=!0,r+=Ml);else if([Qp,Ml].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:n,scoreString:r,updated:c}=Tce({analysis:h,scoreString:r,sets:n,value:i}));else if(h.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(h.isTiebreakCloser){let f=h.isSetTiebreakEntry?Tm:jd,g=f.split("").reverse()[0],v=f.split("")[0],y=n[n.length-1],{tiebreakFormat:I}=h.setFormat,{tiebreakTo:b,NoAD:S}=I||{},w=iD({set:y});if(!h.isTiebreakSet){let T=parseInt(r.split(v).reverse()[0]),D=b6({lowValue:T,tiebreakTo:b,NoAD:S});w===1?(y.side1TiebreakScore=D,y.side2TiebreakScore=T):(y.side1TiebreakScore=T,y.side2TiebreakScore=D)}r=(r||"")+g,h.isDecidingSet||(r+=Zp);let U=BO({analysis:h,set:y});y.winningSide=U||void 0,c=!0}else if(h.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:c}=Rce({analysis:h,auto:u,lowSide:e,scoreString:r,sets:n,value:i}));else if(h.isSetTiebreakEntry){let[f]=Tm.split(""),g=Math.max(...js(f,r.split(""))),v=r.slice(g+1),y=v&&Ze(v)===Ice,I=Ze(v?v+i:i),{tiebreakFormat:b}=h.setFormat,{tiebreakTo:S,NoAD:w}=b||{};!y&&v.length<2?w&&I>S-1?d="invalid low value for NoAD tiebreak":(c=!0,r=(r||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)d=`invalid key: ${i}`;else if(h.isGameScoreEntry)d="game scoreString entry";else if(h.lastSetIsComplete||!n.length){c=!0;let{scoreString:f,set:g}=Cce({analysis:h,lowSide:e,scoreString:r,value:Ze(i)});g&&(g.setNumber=(n==null?void 0:n.length)+1||1),n=(n==null?void 0:n.concat(g).filter(Boolean))||[g],r=f||void 0}else console.log("error: unknown outcome")}if(c){n=n==null?void 0:n.filter(Boolean);let{matchUpWinningSide:f}=qB({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=f,f&&(!o||[Ji,co].includes(o))?(o=mce,n=n.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:I,side2TiebreakScore:b}=g;return v||y||I||b})):r&&!a&&![a6,n6,s6].includes(o)&&(o=void 0),{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}return{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}var rD="\\d+-\\d+",FI="\\d+-\\d+\\(\\d+\\)",VO="\\[\\d+-\\d+\\]",Mce="\\d+-\\d+\\(\\d+-\\d+\\)",Nce=new RegExp(`(${rD}),`,"g"),Ace=new RegExp(`(${FI}),`,"g"),Oce=[rD,FI,VO,Mce],kce=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],xce=kce.map(t=>{let e=t.split("").map(i=>Oce[i]).join(" ");return new RegExp(`^${e}$`)});function YB(t){return!t||xce.some(e=>e.test(t))}function Fce(t){let e="[];",i="()",r=e+i,n=[e[0],i[0]],a=Object.assign({},...r.split("").map(l=>({[l]:0}))),o="",s=t.split("").map(l=>{let u=r.includes(l)&&l,c=n.includes(u);if(c&&u)return a[u]+=1,o=u,l;if(!c&&u&&o&&u!==o){a[o]-=1;let d=e.includes(o)&&e||i.includes(o)&&i||"",p=d.split("").find(m=>m!==o);if(d.includes(u))a[o]||(o="");else return a[u]||(o=""),p}return l}).join("");return t!==s?s:t}function LU(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function Lce(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function jf(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function FS(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function KB(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function _ce(t){return t.startsWith("(")&&t.endsWith(")")}function $ce({score:t,applied:e}){t=Fce(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let U=w.replace(")",") ");t=t.replace(w,U)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let w of a||[]){let[U]=w.match(n).slice(1),T=U.replace(/ /g,"");t=t.replace(w,`(${T})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(U,T)})}if(o=/\(\((\d)\)\)/g,o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(U,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(w=>{let U=new RegExp(`(\\d+)${w}(\\d+)`,"g"),T=t.match(U);T&&T.forEach(D=>t=t.replace(D,D.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[U]=w.match(/\((\d+), \)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"&&(t=t.replace(w,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(w=>{let[U]=w.match(/\((\d+)\/\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${U})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(w=>{let[U]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${U},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[U]=w.match(/\(\/(\d+)\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&parseInt(U)<6?t=t.replace(w,`(6-${U})`):t=t.replace(w,`(${U})`)});let p,m,h,f,g,v=()=>{g=wa(t.split("")),m=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],h=g["["]===g["]"]+1,f=m&&!h};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(_ce)?t=w.map(U=>{let T=U.slice(1,U.length-1);return T.length>2?T:U}).join(" "):t=w.join(" ")}v();let I=/[A-Za-z]+/.test(t),b=/\d+/.test(t);if(!I&&!b)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],U=0;for(let T of t.split("").reverse())T===")"&&(U?w.push("("):U+=1),T==="("&&(U-=1),w.push(T);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),f&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),f&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),f){let w="",U=0;for(let T of t.split(""))T==="("&&(U?w+=")":U+=1),T===")"&&(U-=1),w+=T;t=w}v(),h&&!m&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let S=w=>{let U=w.indexOf("("),T=w.indexOf(")");return U>=0&&T>=0&&U<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);S(w)&&(t=w,v())}return{score:t,applied:e}}function nD(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=js("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,o)=>o%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function Bce({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[Nce,Ace].forEach(i=>{let r=t.match(i);r!=null&&r.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(nD).join(" "),{score:t,applied:e}}function Vce({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let m=/^-(\d+)$/;if(m.test(p)){let[h]=p.match(m).slice(1);if(h.length===2)return h.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(LU),a=0,o="";for(let p of n){let m=js(p,r).filter(v=>!a||v>a)[0],h=r.slice(a,m-1),f=r[m-1],g=e(f);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((I,b)=>+I-+b));if(y===1){let I=[h.join(" "),[f,p].join("")].join(" ");o+=I,a=m+1}else if(y===0){let I=Math.max(...v);if([4,5,6,7,8,9].includes(I)){let b=[6,4].includes(I)?I+1:I-1,S=[I,b].sort().reverse().join("-"),w=[h.join(" "),[S,p].join("")].join(" ");o+=w,a=m+1}}}}if(n.length&&o.length){let p=r.slice(a).join(" ");return o=[o,p].join(" "),{score:o.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((m,h)=>+m-+h,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let s=r.map(p=>Lce(p)&&"bracket"||jf(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,m="";return r.forEach((h,f)=>{s[f]==="bracket"&&p==="set"?(h=i(h),m+=h):m+=` ${h}`,p=s[f]}),{score:m.trim()}}r=t.split(" ");let l,u=r.map(p=>{let m=new RegExp(/^(\d+)-(\d+)$/);if(m.test(p)){let[h,f]=p.match(m).slice(1),g=Math.abs([h,f].reduce((y,I)=>+y-+I)),v=Math.max(h,f);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=js("tiebreak",u);if(c.length){let p="";r.forEach((m,h)=>{c.includes(h)?p+=`(${m}) `:c.includes(h+1)?p+=`${m}`:p+=`${m} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,m,h]=t.match(d).slice(1),f=Math.max(m,h)>=10;!jf(p)&&f&&(t=t.replace(d,`${p} [${m}-${h}]`))}return u=[],t=t.split(" ").map(p=>{let m=/^\((.*)\)$/,h=m.test(p),f=new RegExp(VO).test(p)&&"super"||new RegExp(FI).test(p)&&"tiebreak"||new RegExp(rD).test(p)&&"standard"||"unknown";return u.push(f),f==="standard"&&h?p.match(m)[1]:p}).join(" "),{score:t}}function jce({score:t,applied:e}){for(let T of[".",","," ","/"]){let D=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(D.test(t)){let P=t.match(D).slice(1).map(R=>parseInt(R)),C=Math.abs(P[0]-P[1]);C<=10&&C>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,D,P,C,R,N]=t.match(i).slice(1);t=t.replace(i,`${T}${D}-${P} ${C}-${R}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let o=nD(t);o!==t&&(t=o,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[T,D,P]=t.match(s).slice(1),[C,R]=D.split("");t=`${T}-${C} ${R}-${P}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[T,D]=t.match(u).slice(1),P=T.trim(),C=D.trim();if(l.test(P)&&l.test(C)){let R=P.match(l).slice(1,3).join("-"),N=C.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[T,D]=t.match(c).slice(1),P=T.trim(),C=D.trim();if(l.test(P)&&l.test(C)){let R=P.match(l).slice(1,3).join("-"),N=C.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("singleSetCommaSeparationPattern")}let p=0,m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(t)&&p<3;){let[T,D,P]=t.match(m).slice(1),C=D.split(""),R=`${T}-${C[0]} ${C[1]}-${P}`;t=t.replace(m,R),e.push("noSetSeparationPattern"),p+=1}let h=/(^|\s)7-6\s(\d+)\s/g,f=t.match(h);if(f!=null&&f.length){let T=/(^|\s)7-6\s(\d+)\s/;f.forEach(D=>{let P=D.match(T).slice(2)[0];t=t.replace(D,`7-6(${P}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(T=>{let D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(T=>{let D=" "+T.slice(1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let T=t.match(v)[0],D=T.split("/").map(P=>`(${P})`).join(" ")+" ";t=t.replace(T,D),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let I=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(I.test(t)){let T=t.match(I),D=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),P=t;T.forEach(C=>{let[R,N]=C.match(D).slice(1),A=`${R}-${N}`;P=P.replace(C,A)}),t=P,e.push("slashSetPattern")}let b=/(.*)\s(1\d)\s(\d+)$/;if(b.test(t)){let[T,D,P]=t.match(b).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${D}${P}`,e.push("spaceSeparatedSuperPattern"))}let S=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(S)||[]){let[D,P,C,R]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,A]=P.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${D}${P}(${C})${R}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(w)||[]){let D=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[P,C,R]=T.match(D).slice(1),[N,A]=P.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${P}(${C})${R}`),e.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let T of t.match(U)||[]){let D=/(^|\s)(\d \d)\(/,[P,C]=T.match(D).slice(1);t=t.replace(T,`${P}${C.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function Gce({score:t,matchUpStatus:e}){var s;let i=t==null?void 0:t.split(" ");t=i.map(l=>{if(l.endsWith("]")){let u=l.split("[");if(jf(u[0]))return u[0]+`(${u[1].slice(0,u[1].length-1)})`}return l}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let l of t.match(r)){let u=(s=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:s[1];if(Li(u)&&(u==null?void 0:u[0])>2){if([2,4].includes(u.length))u=u.split("").join("-");else if(u.length===3){let c=u.indexOf("1");u=FS(u.split(""),c)}}t=t.replace(l,`(${u})`)}i=t==null?void 0:t.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((l,u)=>{let c=[void 0,"","COMPLETED"].includes(e)||u!==a;if(n.test(l)&&c){let[d,p,m]=Array.from(l.match(n)).slice(1),h=Math.min(p,m);return`${d}(${h})`}return l}).join(" "),i=t==null?void 0:t.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(l=>{if(n.test(l)){let[u,c]=Array.from(l.match(n)).slice(1),d=u.split("");return`${d[0]}-${d[1]}(${c})`}return l}).join(" "),i=t==null?void 0:t.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(l=>{if(n.test(l)){let[u,c]=Array.from(l.match(n)).slice(1);return jf(u)?`${u}(${c})`:u}return l}).join(" "),i=t==null?void 0:t.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),t=i.map(l=>{if(n.test(l)){let[u]=l.match(n).slice(1);return`[${u<9?10:parseInt(u)+2}-${u}]`}return l}).join(" ");let o=/\((\d)+0 /;if(o.test(t)){let l=t.match(o)[1];t=t.replace(o,`(${l}) `)}return{score:t}}function Hce({score:t,attributes:e,identifier:i}){var c,d,p;if(typeof t!="string")return{score:t,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=t.match(r);for(let m of n||[]){let h=(d=(c=m.match(/^\((.*)\)$/))==null?void 0:c.slice(1))==null?void 0:d[0],f=t.split(m)[0].split(")").reverse()[0].replace(/\D/g,"");if((h==null?void 0:h.length)===2&&(f==null?void 0:f.length)>=2){let y=f.slice(f.length-2).split("").map(I=>parseInt(I));if(Math.abs(y[0]-y[1])===1)continue}let g=KB(h),v=nD(g);t=t.replace(m,`(${v})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);(p=t.match(a))==null||p.forEach(m=>{let h=KB(m.match(/^\[(.*)\]$/)[1]);t=t.replace(m,`(${h}) `).trim()});let o=[")","]"],s=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&o.some(m=>t.endsWith(m))&&s.some(m=>t.includes(m))){let m="",h=t.split(/[)\]]/).filter(Boolean).map(I=>(I.startsWith(",")&&(I=I.slice(1)),I.trim())),f=h.every(I=>I.includes(",")||LU(I)),g=h.every(I=>I.includes("/")||LU(I)),v=h.every(I=>I.includes("-")||LU(I)),y=f&&","||v&&"-"||g&&"/";if(y){let I;h.forEach(b=>{if(b.startsWith("("))if(I==="set"&&(m+=" "),b.includes(y))m+=b.slice(1).split(y).map(S=>S.trim()).join("-"),I="set";else{let S=b.slice(1);m+=`(${S}) `,I="tiebreak"}else if(b.startsWith("[")){let S=b.slice(1).split(y).map(U=>parseInt(U.trim())),w=Math.min(...S);I==="set"?m+=`(${w}) `:m+=`[${S.join("-")}] `,I="tiebreak"}}),t=m.trim()}}let l=wa(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&jf(t)&&Li(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let u=/\(\)/g;return u.test(t)&&(t=t.replace(u,"").trim()),{score:t}}function S6({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let s=`${r[0]}-${r[1]}`;return r[2]&&(s+=` (${r[2]})`),n(),r.push(r),s};n();let o=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let s=e.shift(),l=Li(s)&&parseInt(s),u=r[0]!==void 0&&r[1]!==void 0;if(Li(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,o())){i.push(a()),r=[void 0,void 0];continue}if(u&&e.length===1&&Li(e[0])){let c=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=c,i.push(a()),r=[void 0,void 0]}u&&o()}}return{sets:i}}function QE(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=FS(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=FS(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function T6(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e==null?void 0:e.toString().split(""),a=n==null?void 0:n.every(s=>Li(s)),o=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let s=a?n.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(S6({score:e}),s.length,e.length===3&&o(s.slice(0,2))===1){let[l,u,c]=s;e=`${l}-${u}(${c})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,u,c]=s;e=`[${l}${u}-${c}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&o(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,u,c,d]=s,p=Math.min(c,d);e=`${l}-${u}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,u,c,d]=s;e=`[${l}${u}-${c}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,u,c,d]=s;e=`${l}${u} ${c}${d}`,i.push("split4")}else if(e.length===5&&o(s.slice(0,2))===1){let[l,u,c,d,p]=s;e=`${l}-${u}(${c}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&o(s.slice(3))===1){let[l,u,c,d,p]=s;e=`${l}-${u} ${c}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&s[4]===1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d} [${p}${m}-${h}]`,i.push("numericTiebreakPattern6")}else if(o(s.slice(0,2))===1&&o(s.slice(3,5))>1&&o(s.slice(5,7))>1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u}(${c}) ${d}-${p} ${m}-${h}`,i.push("numericTiebreakPattern7")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))===1&&o(s.slice(5,7))>1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d}(${p}) ${m}-${h}`,i.push("numericTiebreakPattern8")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&o(s.slice(4,6))===1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d} ${p}-${m}(${h})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=QE(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=Pr(e.split(""),2).map(g=>g.join("")),u=l.map(g=>{let[v,y]=g.split("").map(S=>parseInt(S)),I=Math.abs(v-y),b=v>y?1:2;return I>1&&b||b*-1}),c=u.reduce((g,v)=>g>0&&v>0,1),d=wa(u),p=u.map(g=>Math.abs(g)),m=wa(p),h=u[0]<0,f=!h&&u[1]<0;if(u[0]>0&&u[1]>0&&u[0]!==u[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(c)e=l.join(" "),i.push("chunkSplit");else if(s.length===6){if(d[1]===2||d[2]===2)if(!Object.values(m).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,I,b,S]=s,w=u.reduce((U,T,D)=>T<0?D:U,void 0);if(w===0){let U=Math.min(y,I);e=`${g}-${v}(${U}) ${b}-${S}`,i.push("chunkSplitTiebreak1")}else if(w===1){let U=Math.min(b,S);e=`${g}-${v} ${y}-${I}(${U})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${I}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,y,I,b,S,w,U]=s;h||f?s[5]===1&&(h?e=`${g}-${v}(${y}) ${I}-${b} [${S}${w}-${U}]`:e=`${g}-${v} ${y}-${I}(${b}) [${S}${w}-${U}]`):(u[0],u[1])}}}return{score:e,applied:i,matchUpStatus:r}}function D6(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let u=l.match(n).slice(1).map(d=>parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,o=e[0]>0&&e[0]===e[1],s=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}function zce({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),o=a.length;t=a.map((c,d)=>{if(new RegExp(FI).test(c)){let m=c.slice(3),h=c.slice(0,3),f=h.split("-");if(!jf(h)&&!e){let g=Math.max(...f),v=h.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+m}}else if(c.length===2&&Li(c))return c.split("").join("-");c=nD(c);let p=new RegExp(`^${VO}$`).test(c)&&"super"||new RegExp(`^${FI}$`).test(c)&&"tiebreak"||new RegExp(`^${rD}$`).test(c)&&"standard"||"unknown";if(r.push(p),o>1&&p==="standard"&&d<2){let[m,h]=c.split("-"),f=Math.abs(parseInt(m)-parseInt(h)),g=Math.max(m,h),v=Math.min(m,h),y=[parseInt(m),parseInt(h)].indexOf(v);if(g>9&&f>2){let I=g.toString().split(""),b=I.find(S=>parseInt(S)>v||d&&parseInt(S)<=n)??I[0];b&&(c=y?[b,v].join("-"):[v,b].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[m,h]=c.split("-");if(!Math.abs(parseInt(m)-parseInt(h))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:u}=D6(t);if(u===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function Wce({score:t}){let{setsTied:e,winningSide:i}=D6(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let s=t.match(r).slice(1)[0],l=s<=8?10:s+2;t=t.replace(r,` [${l}-${s}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(s=>Li(s)))return{score:t};if(o[0]==="76"){let s=o[1].length===2?Math.min(...o[1].split("").map(l=>parseInt(l))):o[1];t=[...n.slice(0,n.length-1),`7-6(${s})`].join(" ")}else{o=o.map(u=>parseInt(u));let s=Math.max(...o),l=Math.abs(o[0]-o[1]);if(s>=10){if(l>2&&o.every(u=>+u>=10)){let u=o.map(c=>c===s?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(o=u)}t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" ")}else n.length===3&&s>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" "))}return{score:t}}function qce({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function Yce({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function Kce({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=FS(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=T6({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function Xce({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&QE(t)?{score:QE(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function Jce({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function Zce({score:t,profile:e,applied:i}){var o;t=t==null?void 0:t.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let n=(o=e==null?void 0:e.matchUpStatuses)==null?void 0:o.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(a,"").trim(),applied:i}):{score:t}}function Qce({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function ede({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function tde({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function ide({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function rde({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[o,s]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${o}-${s}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Li(i))&&e.length===4&&(t=e)}return{score:t}}function nde({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var ade={handleTiebreakSlashSeparation:ide,handleSetSlashSeparation:ede,punctuationAdjustments:$ce,handleGameSeparation:tde,joinFloatingTiebreak:Vce,handleBracketSpacing:Bce,handleSpaceSeparator:rde,separateScoreBlocks:Kce,matchKnownPatterns:jce,removeDanglingBits:Qce,removeErroneous:Xce,handleWalkover:Jce,properTiebreak:Gce,handleNumeric:T6,handleRetired:Zce,containedSets:Hce,sensibleSets:zce,stringScore:qce,superSquare:Wce,setBuilder:S6,excisions:nde,replaceOh:Yce},fC={},ode=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],sde=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function P6(t){if(!t.score)return{error:oe};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:o,profile:s}=t,l=[],u,c=[],d,p,m=e,h=g=>{g.forEach(v=>{p=ade[v]({profile:s,identifier:r,matchUpStatus:u,attributes:d,applied:c,score:m});let y=p.score!==m;y&&l.push({method:v,score:p.score}),a&&(o||y||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},v),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),m=p.score})};h(ode);let f=YB(m);return f||(m=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),h(sde),f=YB(m),f||(m="")),c.forEach(g=>{fC[g]||(fC[g]=0),fC[g]+=1}),{matchUpStatus:u==null?void 0:u.toUpperCase(),modifications:l,attributes:d,isValid:f,score:m}}var R6={};yt(R6,{analyzeScore:()=>jO,analyzeSet:()=>LI,checkScoreHasValue:()=>vr,checkSetIsComplete:()=>tD,getSetComplement:()=>HO,getTiebreakComplement:()=>aD,isValidMatchUpFormat:()=>Ua,parseScoreString:()=>LS,validateScore:()=>GO,validateTieFormat:()=>Hn});function jO({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){var S,w;let a=(n==null?void 0:n.sets)??[],o=((a==null?void 0:a.filter(U=>U==null?void 0:U.winningSide))||[]).reduce((U,T)=>{let{winningSide:D}=T;if(!D)return U;let P=D-1;return U[P]++,U},[0,0]),s=r?r-1:void 0,l=s!==void 0?1-s:void 0,u=s!==void 0&&o[s],c=l!==void 0&&o[l],d=e?kn(e):void 0,p=Math.max(...o),m=wa(o)[p],h=((S=d==null?void 0:d.setFormat)==null?void 0:S.timed)||((w=d==null?void 0:d.finalSetFormat)==null?void 0:w.timed),f=d==null?void 0:d.bestOf,g=f&&Math.ceil(f/2)||1,v=i??t,y=v&&[Mt,mn,zt].includes(v),I=!d||!a.length||a.every((U,T)=>{let D=T+1,P=D===f,C=D===a.length,{side1Score:R,side2Score:N,side1TiebreakScore:A,side2TiebreakScore:M,winningSide:E}=U,O=Math.max(R??0,N??0),k=A??M,{finalSetFormat:x,setFormat:F}=d,$=P&&x||F;if(k){let{tiebreakTo:_,NoAD:L}=($==null?void 0:$.tiebreakFormat)||{},B=Math.max(A??0,M??0);if(L&&B>_||B<_&&E&&(C&&!y||!C))return!1}return $.setTo?!(!$.noTiebreak&&O>$.setTo+1):!0}),b=(!e||p===g)&&m===1&&o.indexOf(p)+1||void 0;return{valid:!!(I&&(r&&u>c&&r===b||r&&y||!r&&!b&&(![qi,Mt,mn,zt].includes(v)||h&&v===qi)))}}function GO({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:oe};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=n,l="scoreString must be a string!";if(o!==void 0&&typeof o!="string")return{error:oe,info:l};if(s!==void 0&&typeof s!="string")return{error:oe,info:l};if(a!==void 0&&!Array.isArray(a))return{error:oe,info:$d("sets")};if(a!=null&&a.length){let u=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(u.length!==ct(u).length)return{error:oe,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:m,side1TiebreakScore:h,side2TiebreakScore:f,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:I}=d;if(![[p,m],[h,f],[g,v]].filter(b=>b.some(S=>![void 0,null].includes(S))).every(b=>b.every(S=>ot(S))))return{error:oe,info:"non-numeric values"};if(![I,y].filter(b=>![void 0,null].includes(b)).every(b=>ot(b)))return{error:oe,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:oe,info:"winningSide must be 1 or 2"}}let{valid:c}=jO({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!c)return{error:GG,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var HO=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let o=Ze(i);(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),n&&n<r&&o>n&&(o=n);let s;return a&&!n?(o>r&&(s=r),s=o<r?r:r-1):s=o+1<r&&r||n&&n<r&&o===n&&r||!n&&o+2||r+1,[e?o:s,e?s:o]},aD=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let o=lde({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:o,e?o:a]};function lde(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function LS({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((r,n)=>i({set:r,setNumber:n+1}));function i({set:r,setNumber:n}){let a=/\(([^)]+)\)/,o=/\[([^)]+)\]/,s=a.exec(r),l=o.exec(r),u=(r==null?void 0:r.startsWith("["))&&l&&l[1].split("-").map(I=>parseInt(I)),c=s&&r.replace(s[0],"")||l&&r.replace(l[0],"")||r,d=!u&&c.split("-").map(I=>parseInt(I)),p=u?u[0]>u[1]&&1||u[0]<u[1]&&2||void 0:d[0]>d[1]&&1||d[0]<d[1]&&2||void 0,m=s?s[1]:void 0,h=(m&&aD({lowValue:m,isSide1:p===2,tiebreakTo:t}))??[],[f,g]=d||[],[v,y]=u||h||[];return{side1Score:f,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:y,winningSide:p,setNumber:n}}}function ude({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=iD({set:n});return tD({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function LI(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:j0};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},o=n||a,s=!!(r&&o&&r===o),l=s&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),u=!!(l!=null&&l.tiebreakSet),c=!!(l!=null&&l.timed),d=!u&&!c,p=!!(r&&o&&r<=o),m=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],h=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],f=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],g=m.filter(k=>k!==void 0).length,v=h.filter(k=>k!==void 0).length,y=f.filter(k=>k!==void 0).length,I=m==null?void 0:m.filter(k=>!isNaN(k)).length,b=f==null?void 0:f.filter(k=>!isNaN(k)).length,{tiebreakAt:S}=l||{},w=S&&m.filter(k=>k>=S).length===2,U=w&&(m[0]>m[1]&&1||m[1]>m[0]&&2||void 0),T=!!(b&&!I),D=!!(e!=null&&e.winningSide),{error:P,result:C}=cde({sideTiebreakScores:f,sideGameScores:m,setFormat:l,setObject:e}),{error:R,result:N}=dde({sideTiebreakScores:f,setObject:e,setFormat:l}),A=d&&!T&&C||u&&T&&N||c,M=p&&!(u&&!T)&&!(d&&T)&&(!D||A),E=ude({isTimedSet:c,matchUpScoringFormat:i,isDecidingSet:s,isTiebreakSet:T,setObject:e}),O={expectTiebreakSet:u,expectTimedSet:c,hasTiebreakCondition:w,isCompletedSet:D,isDecidingSet:s,isTiebreakSet:T,isValidSet:M,isValidSetNumber:p,isValidSetOutcome:A,leadingSide:U,setFormat:l,sideGameScores:m,sideGameScoresCount:g,sidePointScores:h,sidePointScoresCount:v,sideTiebreakScores:f,sideTiebreakScoresCount:y,winningSide:E};return(e==null?void 0:e.winningSide)!==void 0&&(T?(O.isValidTiebreakSetOutcome=N,N||(O.tiebreakSetError=R)):(O.isValidStandardSetOutcome=C,C||(O.standardSetError=P))),O}function cde({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:j0};let n=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||n||a)return{result:!1,error:oe};if((i==null?void 0:i.filter(U=>!isNaN(U)).length)!==2)return{result:!1,error:gE};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:u}=e||{};if(!(o&&(i!=null&&i.find(U=>U>=o))))return{result:!1,error:gE};let c=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!c)return{result:!1,error:G0};let d=(t==null?void 0:t.winningSide)-1,p=1-d,m=i[d],h=i[p],f=m-h;if(!(m>h))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(r==null?void 0:r.filter(U=>!isNaN(U)).length)===2,y=r==null?void 0:r[d],I=r==null?void 0:r[p],b=s&&i.filter(U=>U>=s).length===2;if(g){let{NoAD:U,tiebreakTo:T}=l;if(b){if(f>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&(r!=null&&r.find(N=>N>=T))))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let D=s<o?o:o+1;if(m>D)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!I||y<I)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let P=U?1:2,C=y-I,R=I>=T-1;if(C&&R&&C<P)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(m>o&&!b)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let S=u?1:2,w=h>=o-1;return f&&w&&!b&&f<S?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:f>S&&m>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function dde({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:j0};let r=!!(e!=null&&e.tiebreakSet),n=!!(e!=null&&e.timed);if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:G0};let{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:l}=o||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=(t==null?void 0:t.winningSide)-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let m=s?1:2,h=d-p,f=p>=l-1;return h&&f&&h<m?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}function pde(t){var d,p,m;let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:o,isMock:s,event:l}=t,{tieFormat:u,matchUpFormat:c}=t;if(a===sr&&o===sr){let h=(p=(d=e==null?void 0:e.structures)==null?void 0:d.find(({stage:f})=>f===Oe))==null?void 0:p.tieFormat;u=u||h||n&&((m=l==null?void 0:l.tieFormat)==null?void 0:m.tieFormatName)===n&&l.tieFormat||n&&Iu({namedFormat:n,hydrateCollections:i,isMock:s,event:l})||(l==null?void 0:l.tieFormat)||Iu({event:l,isMock:s,hydrateCollections:i}),c=void 0}else c||(u=void 0,l!=null&&l.matchUpFormat||(c=pu));if(u){let h=Hn({gender:l==null?void 0:l.gender,enforceGender:r,tieFormat:u});if(h.error)return h}return{tieFormat:u,matchUpFormat:c}}function mde(t){var I,b,S,w,U;let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,drawEntries:n,structureId:a,idPrefix:o,isMock:s,event:l}=t,u=t.qualifyingProfiles,c=u!=null&&u.length?R3({uuids:t.uuids,qualifyingProfiles:u,appliedPolicies:r,idPrefix:o,isMock:s}):void 0;if(c!=null&&c.error)return c;e.structures=(I=e.structures)==null?void 0:I.filter(({structureId:T})=>T!==i),e.links=(b=e.links)==null?void 0:b.filter(({source:T})=>T.structureId!==i);let{qualifiersCount:d,qualifyingDrawPositionsCount:p,qualifyingDetails:m}=c??{};p&&(c!=null&&c.structures&&((S=e.structures)==null||S.push(...c.structures)),c!=null&&c.links&&((w=e.links)==null||w.push(...c.links)));let h=(U=e.structures)==null?void 0:U.find(({stage:T,stageSequence:D})=>T===Oe&&D===1),{qualifiersCount:f}=$g({stageSequence:1,drawDefinition:e,structureId:a,stage:Oe}),g=Math.max(d??0,f??0),v=Mq({qualifiersCount:g,drawDefinition:e,stage:Oe});if(v.error||(v=MS({drawSize:p,stage:Ye,drawDefinition:e}),v.error))return v;hde({drawDefinition:e,drawEntries:n,event:l});let y=fde({mainStructure:h,qualifyingDetails:m,drawDefinition:e});return y.error?y:{drawDefinition:e,structureId:a}}function hde({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===Ye)){let n={...r,entryStage:r.entryStage??Oe,drawDefinition:t,event:i};jA(n)}}function fde({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var r;for(let n of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:o,roundTarget:s,finishingPositions:l,linkType:u}=n,c=t&&((r=mb({targetStructureId:t.structureId,sourceStructureId:o,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:s,linkType:u}))==null?void 0:r.link);if(c!=null&&c.error)return c;c&&(i.links||(i.links=[]),i.links.push(c))}return{error:void 0}}function C6(t){var r,n;let{participantIds:e}=t,i=((n=(r=t.drawDefinition)==null?void 0:r.entries)==null?void 0:n.filter(a=>{let o=a.entryStatus;return!t.restrictEntryStatus||ss.includes(o)}).map(Ut))??[];if(e){let a=e.filter(o=>!(i!=null&&i.includes(o)));if(a!=null&&a.length)return ee({result:{error:Ss},info:{invalidParticipantIds:a}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:oe,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:oe,info:"roundsCount must be less than 32"}:{participantIds:e}}function zO(t){var d;let e=[],{roundsCount:i=1,drawDefinition:r,matchUpsCount:n,structureId:a,idPrefix:o,isMock:s,event:l}=t,u,c=C6(t);if(c.error)return c;for(let p of Se(1,i+1)){let m=ZT({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:r,matchUpsCount:n,structureId:a,roundNumber:u,idPrefix:o,isMock:s,event:l});if(m.error)return ee({result:m,info:{iteration:p}});(d=m.matchUps)!=null&&d.length&&e.push(...m.matchUps),u=((m==null?void 0:m.roundNumber)??1)+1}return{matchUps:e}}function gde(t){var l;let{tournamentRecord:e,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=t,o=t.scaleAccessor??((l=Mr[r])==null?void 0:l.accessor),s=e.participants??[];for(let u of i??[]){let c=s==null?void 0:s.find(p=>p.participantId===u),d=XB({scaleName:`${r}.${tA}`,participant:c,eventType:n});!d&&r&&(d=XB({scaleAccessor:o,participant:c,scaleName:r,eventType:n})),d&&!a[u]&&(a[u]=d)}return a}function XB({scaleType:t=fc,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){var o,s;let a=(s=(o=i&&Cl({scaleAttributes:{eventType:n??gm,scaleType:t,scaleName:r},participant:i}))==null?void 0:o.scaleItem)==null?void 0:s.scaleValue;return e&&Nt(a)?a[e]:a}function WO(t){var c,d;let e=Ide(t);if(e!=null&&e.error)return e;let i=C6(t);if(i.error)return i;let r=vde(t);if(r.error)return r;let n=gde(t),a=((c=t.tournamentRecord)==null?void 0:c.isMock)??t.isMock,o=t.eventType??((d=t.event)==null?void 0:d.eventType),s=[],l=[],u;for(let p of Se(1,(t.roundsCount??1)+1)){let m=xO({...t,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:s,adHocRatings:n,roundNumber:u,eventType:o,isMock:a});if(m.error)return m;let{matchUps:h,...f}=m;f.modifiedScaleValues&&(n=f.modifiedScaleValues),l.push({...f,iteration:p,matchUpsCount:h==null?void 0:h.length}),u=((f==null?void 0:f.roundNumber)??1)+1,h!=null&&h.length&&s.push(...h)}return{...J,matchUps:s,roundResults:l}}function vde(t){var n,a,o;if(t.structureId)return t.structureId;let e=t.drawDefinition,i=(a=(n=e==null?void 0:e.structures)==null?void 0:n.filter(s=>s.stageSequence===1))==null?void 0:a.reduce((s,l)=>{let u=l.stage&&vm[l.stage];return zn({structure:l})&&u>(vm[s==null?void 0:s.stage]||1)?l:s},void 0),r=(o=e==null?void 0:e.structures)==null?void 0:o.find(s=>s.structureId===(i==null?void 0:i.structureId));return r?zn({structure:r})?{structure:r}:{error:Wp}:{error:Ei}}function Ide(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:oe,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==La?{error:Wp}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:oe,info:"Missing Entries"}:{error:void 0}}function yde(t){var c,d;let{tournamentRecord:e,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:o}=t,s=(c=o==null?void 0:o.entries)==null?void 0:c.filter(({entryStage:p,entryStatus:m})=>(!p||p===Oe)&&m&&ss.includes(m)),l=s==null?void 0:s.map(Ut),u=s?Math.floor(s.length/2):0;if(t.automated)return bde({...t,participantIds:l});{let p=zO({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:u,idPrefix:n,isMock:a,event:o});if(p.error)return p;(d=p.matchUps)!=null&&d.length&&YT({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:r,event:o})}return{...J}}function bde(t){var l,u;let{restrictEntryStatus:e,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:o}=t.drawMatic??{},s=WO({...t,eventType:((l=t.drawMatic)==null?void 0:l.eventType)??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:o??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:r,matchUpIds:n});return s.error?s:((u=s==null?void 0:s.matchUps)!=null&&u.length&&YT({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:s.matchUps,event:t.event,structureId:r}),{...J})}function wde({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:u}){var y,I;r=r??n;let c=et({drawDefinition:o,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:Ei};let{positionAssignments:p}=Rr({structure:d}),m=(p==null?void 0:p.length)||0;if(u>m)return{error:bG};let h=(y=d.structures)==null?void 0:y.length,f=ot(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),g=(I=JA({roundRobinGroupsCount:h,drawSize:m}))==null?void 0:I.seedGroups,{seedsCount:v}=Sb({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:m});return v&&(a!=null&&a[ms])&&u>v&&e&&(u=v),d.seedLimit=u,d.seedAssignments=Se(1,u+1).map(b=>{let S=g==null?void 0:g.find(T=>T.includes(b)),w=S&&Math.min(...S),U=f&&b>=f?w:b;return{participantId:void 0,seedNumber:b,seedValue:U}}),si({drawDefinition:o,structureIds:[l]}),{...J,seedLimit:u}}function ch({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:o,stage:s}){if(!e)return{error:ge};return a=a??(o==null?void 0:o.entries)??[],{scaledEntries:a.filter(c=>(!s||!c.entryStage||c.entryStage===s)&&(!n||!c.entryStageSequence||c.entryStageSequence===n)&&ss.includes(c.entryStatus)).map(c=>{let{participantId:d}=c,{scaleItem:p}=Vf({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...c,...p}}).filter(c=>{let d=c.scaleValue;return!r&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(r||l)};function l(c,d){return t?u(d)-u(c):u(c)-u(d)}function u(c){return parseFloat(c.scaleValue||(t?-1:1e5))}}function E6(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=Zo({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r==null?void 0:r.find(({structureId:m})=>!n.includes(m));if(!a)return ee({result:{error:Ei},stack:e});let o=a==null?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:u}=Ede({...t,structureId:o});(t.seededParticipants||t.event||t.seedingScaleName)&&Tde({...t,seedsCount:s,structure:a,structureId:o});let c=t.automated!==!1&&t.drawType!==La&&!(t.qualifyingOnly&&t.stage!==Ye),d=((r==null?void 0:r.length)||0)>1,p=c?Sde({...t,multipleStructures:d,seedLimit:u,structureId:o}):{};return p!=null&&p.error?ee({result:p,stack:e}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function Ude({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{var o,s;let a=(s=(o=gt({name:fl,element:n}))==null?void 0:o.extension)==null?void 0:s.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!a||a===r)&&hp.includes(n.entryStatus)})}function Sde(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=pb({...t,seedsOnly:e});if(i.error)return i;let r=i==null?void 0:i.positionAssignments,n=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function Tde(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(Ut);e?Dde({...t,enteredParticipantIds:a}):(n||i)&&Pde({...t,enteredParticipantIds:a})}function Dde(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:u,event:c}=t,d=u?sh({provisionalPositioning:e,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:u}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,m)=>p.seedNumber<m.seedNumber?-1:p.seedNumber<m.seedNumber?1:0).forEach(p=>{let{participantId:m,seedNumber:h,seedValue:f}=p;Vg({provisionalPositioning:e,tournamentRecord:n,drawDefinition:o,seedingProfile:s,participantId:m,seedBlockInfo:d,structureId:l,seedNumber:h,seedValue:f,event:c})})}function Pde(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:m}=(d==null?void 0:d.category)||{},h=d==null?void 0:d.eventType,f=Rde({...t,ageCategoryCode:m,categoryName:p,eventType:h})||l&&Cde({...t,ageCategoryCode:m,categoryName:p,eventType:h}),g=(f==null?void 0:f.length)??0;g<e&&(e=g),f==null||f.filter(({participantId:v})=>r.includes(v)).slice(0,a||e).forEach((v,y)=>{let I=y+1,{participantId:b,scaleValue:S}=v,w=(n==null?void 0:n[I])||S||I;Vg({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:u,participantId:b,structureId:c,seedNumber:I,seedValue:w,event:d})})}function Rde(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:o}=t,{categoryName:s,ageCategoryCode:l}=(o==null?void 0:o.category)||{},u=o==null?void 0:o.eventType,c={scaleName:i||s||l||o.eventId,scaleType:Pl,eventType:u};return ch({scaleAttributes:c,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function Cde(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:o,ageCategoryCode:s}=(r==null?void 0:r.category)||{},l=r==null?void 0:r.eventType;return ch({scaleAttributes:{scaleName:o||s,scaleType:wc,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function Ede(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=Ude(t);e>i.length&&(e=i.length);let{seedLimit:r}=wde({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function Mde(t){var b;let e=OO({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:o,seedingProfile:s,participants:l,drawEntries:u,placeByes:c,drawSize:d,drawType:p,entries:m}=t,h=[],f=[],g=Nde({suppressDuplicateEntries:r,ignoreStageSpace:n,drawDefinition:i,drawEntries:u,drawType:p,entries:m});if(g.error)return g;let v=p===up?0:Ze(t.seedsCount??0),y=E6({...t,qualifyingOnly:!d||o,appliedPolicies:a,drawDefinition:i,seedingProfile:s,participants:l,stage:Oe,seedsCount:v,placeByes:c,drawSize:d,entries:m});if(y.error&&!y.conflicts)return y;(b=y.positioningReport)!=null&&b.length&&h.push({[Oe]:y.positioningReport});let I=y.structureId;return y.conflicts&&(f=y.conflicts),p===La&&t.roundsCount&&yde({...t,drawDefinition:i,structureId:I}),{drawDefinition:i,positioningReports:h,conflicts:f,structureId:I}}function Nde(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let o of a){if(r&&o.entryStage&&o.entryStage!==Oe)continue;let s={...o,ignoreStageSpace:e??n===La,entryStage:o.entryStage??Oe,event:t.event,drawDefinition:i,drawType:n},l=jA(s);if(r&&l.error)return l}return{error:void 0}}var Ade=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),Ode=Ade;function kde(t){let{drawId:e=Gt(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=Ode();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function qO(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:o,event:s}=t,l=ze(t,[{[Fn]:!0,[KN]:!0}]);if(l.error)return l;if(!Ua({matchUpFormat:n}))return{error:Ry};let u="setMatchUpFormat";if(o){let c=wi({drawDefinition:r,matchUpId:o,event:s});if(c.error)return c;let d=c.matchUp;if((d==null?void 0:d.matchUpType)===sr)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:aa};d&&(d.matchUpFormat=n,Rt({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:u,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===sr)return{error:Ll};for(let c of e){let d=et({drawDefinition:r,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if((s==null?void 0:s.eventType)===sr)return{error:Ll};let c=et({drawDefinition:r,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),si({drawDefinition:r,structureIds:e}),{...J}}function xde({tieFormat:t}){let e=Hn({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Gt());return{tieFormat:t}}function Fde({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:r,tieFormat:n,event:a}){if((i||n)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&n&&JSON.stringify(a.tieFormat)===JSON.stringify(n))){if(n){let o=xde({tieFormat:n});if(o.error)return o;e.tieFormat=o.tieFormat??n}else if(i){let o=qO({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}r&&(e.matchUpType=r)}return{error:void 0}}var M6={};yt(M6,{attachPolicies:()=>Bd,findPolicy:()=>pp,getAppliedPolicies:()=>$t,getPolicyDefinitions:()=>Hu,mutate:()=>N6,query:()=>O6,removePolicy:()=>A6});var N6={};yt(N6,{attachPolicies:()=>Bd,removePolicy:()=>A6});function A6(t){let e=ze(t,[{[jae]:!0,_anyOf:{[pn]:!1,[br]:!1,[Fn]:!1,[Gc]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return JB(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ge};for(let a of n){let o=t.tournamentRecords[a],s=JB(t,o);if(s.error)return s;i=!0}}else return{error:ge};return i?{...J}:{error:qp}}function JB(t,e){let i=$t(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?Lt({element:e,extension:{name:EI,value:i}}):Un({element:e,name:EI}),{...J}):{error:qp}}var O6={};yt(O6,{findPolicy:()=>pp,getAppliedPolicies:()=>$t,getPolicyDefinitions:()=>Hu});var Lde={[ms]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Bl]:{positioning:Nd},[Xo]:{positioning:Nd}},positioning:Aae},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},e1=Lde;function _de({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return ee({info:"policyDefinitions must be an object",result:{error:oe},stack:r});let n={[vS]:t==null?void 0:t[vS]};return e?$de({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&Bd({drawDefinition:i,policyDefinitions:n}),!(t!=null&&t[ms])&&!(e!=null&&e[ms])&&(Bd({policyDefinitions:e1,drawDefinition:i}),t&&Object.assign(t,e1)),{error:void 0}}function $de({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e==null?void 0:e[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(Bd({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function Bde(t){var v,y,I,b,S;let{tournamentRecord:e,matchUpFormat:i,appliedPolicies:r,policyDefinitions:n,matchUpType:a,tieFormat:o,drawType:s,stack:l,event:u}=t,c=t.drawId?(v=u==null?void 0:u.drawDefinitions)==null?void 0:v.find(w=>w.drawId===t.drawId):void 0;c&&s!==c.drawType&&(c.drawType=s);let d=c??kde({processCodes:t.processCodes,drawId:t.drawId,drawType:s}),p=Fde({tournamentRecord:e,drawDefinition:d,matchUpFormat:i,matchUpType:a,tieFormat:o,event:u});if(p.error)return ee({result:p,stack:l});let m=_de({appliedPolicies:r,policyDefinitions:n,drawDefinition:d,stack:l});if(m.error)return m;let h=(I=(y=c==null?void 0:c.structures)==null?void 0:y.find(w=>w.stage===Oe&&w.stageSequence===1))==null?void 0:I.structureId,f=c?(b=c.structures)==null?void 0:b.filter(w=>w.stage===Ye):[],g=(f==null?void 0:f.length)===1&&!((S=f[0].matchUps)!=null&&S.length)&&f[0].structureId;return{drawDefinition:d,structureId:h,existingDrawDefinition:c,existingQualifyingPlaceholderStructureId:g}}function Vde(t){var c,d;let e="generateOrGetExisting",i=[],r=[],n=Bde(t);if(n.error)return ee({result:n,stack:e});let a=n.existingDrawDefinition,o=n.drawDefinition??{},s=n.structureId,l=t.drawEntries??t.eventEntries??[],u=n.existingQualifyingPlaceholderStructureId&&mde({...t,...n})||Mde({...t,...n,entries:l});return u.error?ee({result:u,stack:e}):((c=u.positioningReports)!=null&&c.length&&i.push(...u.positioningReports??[]),(d=u.conflicts)!=null&&d.length&&r.push(...u.conflicts??[]),o=u.drawDefinition,s=u.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:o,structureId:s,conflicts:r,entries:l})}function jde(t){var f,g,v;let{qualifyingPlaceholder:e,qualifyingProfiles:i,existingDrawDefinition:r,positioningReports:n,appliedPolicies:a,qualifyingOnly:o,drawDefinition:s,seedingProfile:l,participants:u,structureId:c,entries:d,stack:p}=t,m=e&&!(i!=null&&i.length)&&!r,h=[];if(i){let y=(w,U)=>w.stageSequence-U.stageSequence,I=(w,U)=>w.roundTarget-U.roundTarget,b=[],S=1;i.sort(I);for(let w of i){if(!Array.isArray(w.structureProfiles))return ee({info:$d("structureProfiles"),result:{error:Xe},stack:p});S=w.roundTarget||S;let U=((f=w.structureProfiles)==null?void 0:f.sort(y))||[],T=1;for(let D of U){let{qualifyingRoundNumber:P,qualifyingPositions:C,seededParticipants:R,seedingScaleName:N,seedsCount:A=0,seedByRanking:M,placeByes:E,drawSize:O}=D,k=E6({...t,seedingProfile:D.seedingProfile??l,stageSequence:T,qualifyingRoundNumber:P,preparedStructureIds:b,qualifyingPositions:C,seededParticipants:R,stage:Ye,seedingScaleName:N,appliedPolicies:a,drawDefinition:s,qualifyingOnly:o,seedByRanking:M,participants:u,roundTarget:S,seedsCount:A,placeByes:E,drawSize:O,entries:d});if(k.error)return k;k.structureId&&b.push(k.structureId),T+=1,(g=k.conflicts)!=null&&g.length&&h.push(...k.conflicts),(v=k.positioningReport)!=null&&v.length&&n.push({[Ye]:k.positioningReport})}S+=1}}else if(c&&m){let y=ao({structureName:Qr(Ye),stage:Ye}),{link:I}=mb({sourceStructureId:y.structureId,targetStructureId:c,sourceRoundNumber:0,linkType:bu});s.structures||(s.structures=[]),s.structures.push(y),s.links||(s.links=[]),s.links.push(I)}return{qualifyingConflicts:h,error:void 0}}var k6={};yt(k6,{addGoesTo:()=>_d,allCompetitionMatchUps:()=>Rs,allDrawMatchUps:()=>Sn,allEventMatchUps:()=>Zl,allPlayoffPositionsFilled:()=>nO,allTournamentMatchUps:()=>Br,analyzeDraws:()=>wb,analyzeMatchUp:()=>$I,analyzeTournament:()=>rk,bulkUpdatePublishedEventIds:()=>ok,calculateWinCriteria:()=>ph,categoryCanContain:()=>Ay,checkMatchUpIsComplete:()=>Pd,checkValidEntries:()=>JT,compareTieFormats:()=>Ru,competitionScheduleMatchUps:()=>Eb,courtGridRows:()=>gD,credits:()=>Gde,drawMatchUps:()=>bk,eventMatchUps:()=>yD,filterMatchUps:()=>au,filterParticipants:()=>sb,findDrawDefinition:()=>CO,findExtension:()=>gt,findVenue:()=>Jl,getAggregateTeamResults:()=>ik,getAllDrawMatchUps:()=>mr,getAllEventData:()=>sk,getAllStructureMatchUps:()=>Wt,getAllowedDrawTypes:()=>oD,getAllowedMatchUpFormats:()=>QO,getAppliedPolicies:()=>$t,getAssignedParticipantIds:()=>gp,getAvailableMatchUpsCount:()=>KT,getAvailablePlayoffProfiles:()=>hb,getCategoryAgeDetails:()=>fm,getCheckedInParticipantIds:()=>th,getCompetitionDateRange:()=>lD,getCompetitionMatchUps:()=>_I,getCompetitionParticipants:()=>YO,getCompetitionPenalties:()=>ek,getCompetitionVenues:()=>Db,getCourtInfo:()=>AT,getCourts:()=>wk,getDrawData:()=>cD,getDrawDefinitionTimeItem:()=>RA,getDrawParticipantRepresentativeIds:()=>PO,getDrawStructures:()=>Zo,getDrawTypeCoercion:()=>Ub,getEligibleVoluntaryConsolationParticipants:()=>DO,getEntriesAndSeedsCount:()=>vD,getEvent:()=>Tk,getEventData:()=>dD,getEventMatchUpFormatTiming:()=>dk,getEventProperties:()=>Uk,getEventPublishStatus:()=>Uo,getEventStructures:()=>BT,getEventTimeItem:()=>Hy,getEvents:()=>Sk,getFlightProfile:()=>Gi,getHomeParticipantId:()=>fk,getLinkedTournamentIds:()=>Vy,getMatchUpCompetitiveProfile:()=>Qy,getMatchUpContextIds:()=>gk,getMatchUpDailyLimits:()=>wD,getMatchUpDailyLimitsUpdate:()=>pk,getMatchUpDependencies:()=>ls,getMatchUpFormat:()=>vk,getMatchUpFormatTiming:()=>eb,getMatchUpFormatTimingUpdate:()=>ck,getMatchUpScheduleDetails:()=>OT,getMatchUpType:()=>kT,getMatchUpsMap:()=>sn,getMatchUpsStats:()=>Ik,getMatchUpsToSchedule:()=>pD,getMaxEntryPosition:()=>uk,getModifiedMatchUpFormatTiming:()=>ID,getPairedParticipant:()=>Qo,getParticipantEventDetails:()=>KO,getParticipantIdFinishingPositions:()=>RO,getParticipantMembership:()=>XO,getParticipantResults:()=>vb,getParticipantScaleItem:()=>Vf,getParticipantSchedules:()=>JO,getParticipantSignInStatus:()=>ZO,getParticipantTimeItem:()=>CA,getParticipants:()=>Mi,getPersonRequests:()=>yp,getPolicyDefinitions:()=>Hu,getPositionAssignments:()=>xI,getPositionsPlayedOff:()=>Gg,getPredictiveAccuracy:()=>hk,getProfileRounds:()=>fD,getPublishState:()=>ah,getRoundMatchUps:()=>Cn,getRounds:()=>yk,getScaleValues:()=>Og,getScaledEntries:()=>ch,getScheduledRoundsDetails:()=>Pb,getSchedulingProfile:()=>Yu,getSchedulingProfileIssues:()=>lk,getSeedingThresholds:()=>ZA,getSeedsCount:()=>Sb,getStructureSeedAssignments:()=>po,getTeamLineUp:()=>Ld,getTieFormat:()=>ak,getTimeItem:()=>yo,getTournamentIds:()=>$y,getTournamentInfo:()=>dh,getTournamentPenalties:()=>sD,getTournamentPersons:()=>tk,getTournamentPoints:()=>uD,getTournamentPublishStatus:()=>ob,getTournamentStructures:()=>rO,getTournamentTimeItem:()=>RT,getValidGroupSizes:()=>cb,getVenueData:()=>Lf,getVenuesAndCourts:()=>qu,isAdHoc:()=>zn,isCompletedStructure:()=>Cc,isValidForQualifying:()=>NO,isValidMatchUpFormat:()=>Ua,matchUpActions:()=>XT,participantScaleItem:()=>Cl,participantScheduledMatchUps:()=>mk,positionActions:()=>MO,publicFindCourt:()=>_A,publicFindVenue:()=>LA,tallyParticipantResults:()=>Hg,tieFormatGenderValidityCheck:()=>rT,tournamentMatchUps:()=>bD,validMatchUp:()=>CT,validMatchUps:()=>wo,validateCollectionDefinition:()=>Oy,validateLineUp:()=>$T});function Gde(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var x6={};yt(x6,{filterParticipants:()=>sb,getCompetitionParticipants:()=>YO,getPairedParticipant:()=>Qo,getParticipantEventDetails:()=>KO,getParticipantMembership:()=>XO,getParticipantScaleItem:()=>Vf,getParticipantSchedules:()=>JO,getParticipantSignInStatus:()=>ZO,getParticipantTimeItem:()=>CA,getParticipants:()=>Mi,getScaleValues:()=>Og,participantScaleItem:()=>Cl,validateLineUp:()=>$T});function YO(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Oi};let i=[],r={},n={},a={},o=[],s={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:m,matchUps:h,derivedEventInfo:f,derivedDrawInfo:g}=Mi({...t,tournamentRecord:u});Object.assign(s,d),Object.assign(r,p),Object.assign(n,f),Object.assign(a,g),i.push(...m??[]),o.push(...h??[]),c==null||c.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:s,participants:i,...J,matchUps:o}}function KO({tournamentRecord:t,participantId:e}){if(!t)return{error:ge};if(!e)return{error:pr};let i=[e].concat((t.participants??[]).filter(r=>{var n;return(r==null?void 0:r.participantType)&&[Kt,ht].includes(r.participantType)&&((n=r.individualParticipantIds)==null?void 0:n.includes(e))}).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=((r==null?void 0:r.entries)??[]).map(a=>a.participantId);return Rn(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function XO({tournamentRecord:t,participantId:e}){if(!t)return{error:ge};if(!e)return{error:pr};let{participants:i}=Mi({participantFilters:{participantTypes:[Kt,ht,Wa]},tournamentRecord:t});return(i??[]).filter(r=>{var n;return(n=r.individualParticipantIds)==null?void 0:n.includes(e)}).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function JO({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:ge};if(typeof t!="object")return{error:Vu,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=Br({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),o=ls({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],s={};for(let l of a){let{sides:u}=l,c,d=(u==null?void 0:u.map(m=>{if(m.participant)return[m.participant].concat(...m.participant.individualParticipants||[]);o[l.matchUpId]&&!c&&(c=(o[l.matchUpId]||[]).map(h=>n[h]).filter(({winningSide:h,bye:f})=>!h&&!f))}).filter(Boolean).flat())??[];for(let m of d){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].matchUps.push(l)}let p=(c==null?void 0:c.map(({sides:m})=>m).flat().map(({participant:m})=>m&&[m].concat(...m.individualParticipants||[])).filter(Boolean).flat())||[];for(let m of p){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...J}}function ZO({tournamentRecord:t,participantId:e}){if(!t)return{error:ge};if(!e)return{error:pr};let{participant:i}=qc({tournamentRecord:t,participantId:e});if(!i)return{error:zi};let{timeItem:r}=yo({itemType:Gy,element:i});return r&&r.itemValue===NI&&NI}var F6={};yt(F6,{analyzeDraws:()=>wb,analyzeTournament:()=>rk,getAggregateTeamResults:()=>ik,getAllowedDrawTypes:()=>oD,getAllowedMatchUpFormats:()=>QO,getAppliedPolicies:()=>$t,getCompetitionDateRange:()=>lD,getCompetitionPenalties:()=>ek,getPolicyDefinitions:()=>Hu,getTournamentInfo:()=>dh,getTournamentPenalties:()=>sD,getTournamentPersons:()=>tk,getTournamentPoints:()=>uD,getTournamentStructures:()=>rO,getTournamentTimeItem:()=>RT});function QO({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:ge};let{appliedPolicies:r}=$t({tournamentRecord:t});return(((n=r==null?void 0:r[Ps])==null?void 0:n.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function oD({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:ge};let{appliedPolicies:r}=$t({tournamentRecord:t});return(((n=r==null?void 0:r[IS])==null?void 0:n.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function sD({tournamentRecord:t}){if(!t)return{error:ge};let e=((t==null?void 0:t.participants)??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:o}=a||{};i[o]?i[o].participants.push(n):i[o]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function ek({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Oi};let e=[];for(let i of Object.values(t)){let{penalties:r}=sD({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function L6({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:m,notes:h})=>({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:m,notes:h}))(t)}}var Hde={[_y]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},zde=Hde;function dh(t){var s,l,u,c;let{tournamentRecord:e}=t??{};if(!e)return{error:ge};let i=(({tournamentId:d,tournamentRank:p,tournamentStatus:m,formalName:h,tournamentName:f,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:I,startDate:b,endDate:S,hostCountryCode:w,venues:U,notes:T,updatedAt:D})=>({tournamentId:d,tournamentRank:p,tournamentStatus:m,formalName:h,tournamentName:f,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:I,startDate:b,endDate:S,hostCountryCode:w,venues:U,notes:T,updatedAt:D}))(e),r=((s=Mi({participantFilters:{participantRoles:[XW,HA,JW,ZW,eq]},policyDefinitions:zde,tournamentRecord:e}))==null?void 0:s.participants)??[];r&&(i.tournamentContacts=r);let n=(l=ah({tournamentRecord:e}))==null?void 0:l.publishState,a=((c=(u=n==null?void 0:n.tournament)==null?void 0:u.status)==null?void 0:c.publishedEventIds)||[],o=[];for(let d of e.events??[])if(!(t!=null&&t.usePublishState)||a.includes(d.eventId)){let p=L6({event:d}).eventInfo;p&&o.push(p)}return i.timeItemValues=a3({element:e}),i.publishState=n==null?void 0:n.tournament,i.eventInfo=o,{tournamentInfo:Me(Ge(i),!1,!0),...J}}function lD({tournamentRecords:t}){if(!Nt(t))return{error:Oi};let e=Object.keys(t??{}).reduce((n,a)=>{let o=t[a],{tournamentInfo:{startDate:s,endDate:l}}=dh({tournamentRecord:o}),u=s&&new Date(pt(s));(!n.startDate||u&&u<n.startDate)&&(n.startDate=u);let c=l&&new Date(pt(l));return(!n.endDate||c&&c>n.endDate)&&(n.endDate=c),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&pt(e.startDate.toISOString()),r=e.endDate&&pt(e.endDate.toISOString());return!i||!r?{error:$G}:{startDate:i,endDate:r}}function tk({tournamentRecord:t,participantFilters:e}){if(!t)return{error:ge};let i=t.participants||[];e&&(i=sb({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:o}=a.person;r[o]?r[o].participantIds.push(a.participantId):r[o]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function ik(t){var d,p,m,h,f,g,v,y;let e=ze(t,[{[br]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},r={},n=I=>{var S,w,U;let b=(S=I==null?void 0:I.individualParticipants)==null?void 0:S.map(T=>{var D;return((D=T.teams)==null?void 0:D.length)===1&&T.teams[0]});return((w=I==null?void 0:I.teams)==null?void 0:w.length)===1&&((U=I==null?void 0:I.teams)==null?void 0:U[0])||(b==null?void 0:b[0].participantId)===(b==null?void 0:b[1].participantId)&&(b==null?void 0:b[0])},{matchUps:a,participants:o}=Mi({participantFilters:{participantTypes:[St]},withRankingProfile:!0,withStatistics:!0,...t});for(let I of o??[]){if(I.participantType===Vn)continue;((p=(d=I.draws)==null?void 0:d[0])==null?void 0:p.drawId)==="draw-0-3"&&console.log(I.participantType,I.draws[0].finishingPositionRange);let b=n(I);if(b)for(let S of(I==null?void 0:I.draws)??[]){let w=(m=S==null?void 0:S.finishingPositionRange)==null?void 0:m.join("-");if(w&&(i!=null&&i[w])){let U=b==null?void 0:b.participantId,T=S==null?void 0:S.drawId,D=`${U}|${T}|${w}`;r[D]=i[w]}}}let s=I=>({teamName:I,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(I,b,S)=>{I[b]===void 0&&(I[b]=0),I[b]+=S},u={},c={};for(let I of a??[]){let{sides:b,matchUpFormat:S}=I,w=S&&kn(S);if((b==null?void 0:b.length)===2&&((h=w.setFormat)!=null&&h.timed)&&(!w.finalSetFormat||(f=w.finalSetFormat)!=null&&f.timed))for(let U of b){let T=n(U.participant),D=T==null?void 0:T.participantId,P=(g=U.participant)==null?void 0:g.participantId,C=T==null?void 0:T.participantName,R=U.sideNumber,N=((v=U.participant)==null?void 0:v.individualParticipantIds)||P&&[P]||[];if(N.forEach(A=>{A&&!u[A]&&(u[A]=s(C))}),D&&R){c[D]||(c[D]=s(C));let A=[...N.map(E=>u[E]),c[D]];I.winningSide&&(R===I.winningSide?A.forEach(E=>l(E,"win",1)):A.forEach(E=>l(E,"loss",1)));let M=((y=I.score)==null?void 0:y.sets)||[];for(let E of M){let O=(E==null?void 0:E[`side${3-R}Score`])||0,k=(E==null?void 0:E[`side${R}Score`])||0,x=k-O;A.forEach(F=>l(F,"pointsPlayed",k+O)),A.forEach(F=>l(F,"points",k)),A.forEach(F=>l(F,"diff",x))}}}}for(let I of Object.keys(r)){let[b]=I.split("|");c[b]&&(c[b].bonus+=r[I],c[b].pointsPct=parseFloat((c[b].points/c[b].pointsPlayed).toFixed(2)),c[b].standingPoints=c[b].win+c[b].bonus)}for(let I of Object.keys(u))u[I].pointsPct=parseFloat((u[I].points/u[I].pointsPlayed).toFixed(2));return{...J,individualResults:u,teamResults:c}}function Wde(t){var a,o,s,l,u,c,d;let e=((o=(a=t.participants)==null?void 0:a.filter(({participantType:p})=>p===Kt))==null?void 0:o.length)===2,i=((s=t.events)==null?void 0:s.length)===1&&t.events[0],r=((l=i==null?void 0:i.drawDefinitions)==null?void 0:l.length)===1&&i.drawDefinitions[0],n=((d=(c=((u=r==null?void 0:r.structures)==null?void 0:u.length)===1&&r.structures[0])==null?void 0:c.positionAssignments)==null?void 0:d.length)===2;return!!(i.tieFormat&&e&&n)}function rk({tournamentRecord:t}){var n;if(!t)return{error:ge};let{drawsAnalysis:e}=wb({tournamentRecord:t}),i={isDual:Wde(t),drawsAnalysis:e},r=Mi({tournamentRecord:t});return(n=r.missingParticipantIds)!=null&&n.length&&(i.missingParticipantIds=r.missingParticipantIds),{...J,analysis:i}}function _6(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function qde(t){let{participation:e={},awardProfiles:i,startDate:r,eventType:n,drawSize:a,drawType:o,category:s,endDate:l,level:u}=t,{participationOrder:c,flightNumber:d,rankingStage:p}=e,m=h=>!r&&!l||!h.dateRanges?!0:h.dateRanges.some(f=>{let g=!r||!f.startDate||new Date(r)>new Date(f.startDate),v=!l||!f.endDate||new Date(l)<=new Date(f.endDate);return g&&v});return{awardProfile:i.find(h=>{var f,g,v,y,I,b,S,w,U,T;return m(h)&&(!h.maxFlightNumber||d<=h.maxFlightNumber)&&(!((f=h.drawTypes)!=null&&f.length)||((g=h.drawTypes)==null?void 0:g.includes(o)))&&(!((v=h.drawSizes)!=null&&v.length)||h.drawSizes.includes(a))&&(!((y=h.stages)!=null&&y.length)||h.stages.includes(p))&&(!((I=h.levels)!=null&&I.length)||h.levels.includes(u))&&(!h.maxDrawSize||a<=h.maxDrawSize)&&(!h.drawSize||h.drawSize===a)&&(!h.maxLevel||u<=h.maxLevel)&&(!d||!((S=(b=h.flights)==null?void 0:b.flightNumbers)!=null&&S.length)||h.flights.flightNumbers.includes(d))&&(!h.participationOrder||h.participationOrder===c)&&(!((w=h.category)!=null&&w.ageCategoryCodes)||h.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((U=h.eventTypes)!=null&&U.length)||((T=h.eventTypes)==null?void 0:T.includes(n)))})}}function ZB({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){var h,f;let o=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(I=>I.flight===g||I.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},s=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(ot(g)?g:0),I=_6(a,g==null?void 0:g.level);return{value:o(v,I)||ot(I)&&I||y}},l=0,u,c,d,p,m=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(I=>{var b;return I.drawSize===r||((b=I.drawSizes)==null?void 0:b.includes(r))}),v=i.find(I=>I.drawSize&&I.threshold&&r>I.drawSize),y=i.find(I=>{var b;return!I.drawSize&&!((b=I.drawSizes)!=null&&b.length)});m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m],y=y==null?void 0:y[m]),c=s(g,e).value,d=s(v,e).value,p=s(y,e).value,l=c||d||p,u=c&&g.requireWin||d&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(h=i==null?void 0:i.drawSizes)==null?void 0:h[r],v=i;m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m]),c=s(g,e).value,p=s(v,e).value,l=c||p,u=c?g.requireWin:v==null?void 0:v.requireWin}else ot(i)&&m===void 0&&(l=i);return e&&((f=n==null?void 0:n.pct)!=null&&f[e])&&(l=Math.round(l*n.pct[e])),{awardPoints:l,requireWin:u}}function uD({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){var v;if(!i)return{error:ge};let{policyDefinitions:n}=Hu({policyTypes:[CU],tournamentRecord:i}),a=(e==null?void 0:e[CU])??(n==null?void 0:n[CU]);if(!a)return{error:V0};let o=a.awardProfiles,s=a.requireWinFirstRound,l=a.requireWinForPoints,{participants:u,derivedEventInfo:c,derivedDrawInfo:d,mappedMatchUps:p}=Mi({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),m=u==null?void 0:u.filter(y=>{var I;return(I=y.draws)==null?void 0:I.length}),h={},f={},g={};for(let y of m??[]){let{participantType:I,participantId:b,person:S,draws:w}=y;for(let U of w){let{drawId:T,structureParticipation:D,eventId:P}=U,C=c[P],R=d[T],N=R==null?void 0:R.drawType,{category:A,eventType:M}=C||{},E=U.startDate||C.startDate||i.startDate,O=U.endDate||C.endDate||i.endDate;if(M===Sa&&b!==Vn)continue;let k;if(o){let x=l,F=0,$=0,_=0,L;for(let B of D){let{finishingPositionRange:V,participationOrder:G,participantWon:j,flightNumber:z,rankingStage:q,winCount:W}=B;F+=W||0;let Y=R==null?void 0:R.drawSize,{awardProfile:re}=qde({awardProfiles:o,participation:B,eventType:M,startDate:E,category:A,drawSize:Y,drawType:N,endDate:O,level:r});if(re){if(!Y)continue;let K=Array.isArray(V)&&Math.max(...V),H=ct(V||[]).join("-"),Q=K&&q!==Ye&&(V==null?void 0:V.includes(Y));re.requireWinForPoints!==void 0&&(x=re.requireWinForPoints),re.requireWinFirstRound!==void 0&&(s=re.requireWinFirstRound);let{finishingPositionPoints:X={},finishingPositionRanges:ie,finishingRound:ae,pointsPerWin:le,flights:ne}=re,de=Array.isArray(re.perWinPoints)?(v=re.perWinPoints)==null?void 0:v.find(Pe=>{var it;return(it=Pe.participationOrders)==null?void 0:it.includes(G)}):re.perWinPoints,Ie=X.participationOrders,ce=0,ke;if((!Ie||Ie.includes(G))&&ie&&K){let Pe=ie[K];Pe&&({awardPoints:ce,requireWin:ke}=ZB({flightNumber:z,valueObj:Pe,drawSize:Y,flights:ne,level:r}))}if(!ce&&ae&&G===1&&K){let Pe=ae[K];Pe&&({awardPoints:ce,requireWin:ke}=ZB({participantWon:j,flightNumber:z,valueObj:Pe,drawSize:Y,flights:ne,level:r}))}if(Q&&s!==void 0&&(x=s),ke!==void 0&&(x=ke),ce>$&&(!x||W)&&($=ce,L=K),!ce&&le&&W&&(_+=W*le,L=H),!ce&&W&&de){let Pe=_6(r,de==null?void 0:de.level);Pe?_+=W*Pe:de.value&&(_+=W*de.value)}}if(k=$+_,I===Vn){let K=(y.matchUps||[]).filter(({structureId:H})=>H===B.structureId);for(let{matchUpId:H}of K){let Q=p[H],X=Q.sides.find(ie=>ie.participantId===b).sideNumber;if(Q.winningSice===X)for(let ie of Q.tieMatchUps)ie.winningSide}}}if(_||$){let B={winCount:F,positionPoints:$,rangeAccessor:L,perWinPoints:_,eventType:M,drawId:T,points:k},V=S==null?void 0:S.personId;V?(h[V]||(h[V]=[]),h[V].push(B)):I===ht?(g[b]||(g[b]=[]),g[b].push(B)):I===Vn&&(f[b]||(f[b]=[]),f[b].push(B))}}}}return{participantsWithOutcomes:m,personPoints:h,pairPoints:g,teamPoints:f,...J}}var $6={};yt($6,{compareTieFormats:()=>Ru,getTieFormat:()=>ak,tieFormatGenderValidityCheck:()=>rT,validateCollectionDefinition:()=>Oy});function _S(t){var n;if(!t)return{};let e=[],i=t.tieFormatName,r=(n=t.collectionDefinitions)==null?void 0:n.map(a=>{let{matchUpType:o,matchUpFormat:s,matchUpCount:l,category:u,gender:c}=a;e.includes(s)||e.push(s);let d=u==null?void 0:u.ageCategoryCode;return[l,o===Ed?"D":"S",d,s,c].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:r}}function Ru({considerations:t={},descendant:e,ancestor:i}){var S,w;let r={},n={},{matchUpFormats:a,tieFormatDesc:o}=_S(e),{matchUpFormats:s,tieFormatDesc:l}=_S(i),u=ct((a??[]).filter(U=>!(s??[]).includes(U)).concat((s??[]).filter(U=>!(a??[]).includes(U)))),c=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionName:U})=>U).join("|")),d=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")),p=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U}))),m=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U})));r.collectionIds=gB(Object.keys(p),Object.keys(m)),n.collectionIds=gB(Object.keys(m),Object.keys(p)),r.collectionsValue=QB(p),n.collectionsValue=QB(m),r.groupsCount=((S=i==null?void 0:i.collectionGroups)==null?void 0:S.length)??(0-(((w=e==null?void 0:e.collectionGroups)==null?void 0:w.length)??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let h=r.collectionsValue.totalValue-n.collectionsValue.totalValue,f=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,v=n.collectionsValue.assignmentValues.some((U,T)=>{let D=r.collectionsValue.assignmentValues[T];return!D||U.valueKey!==D.valueKey||U.value!==D.value?!0:Array.isArray(U.value)?U.value.every((P,C)=>D.value[C]===P):!1}),y=c||d||l!==o||g||v||h!==0,I=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],b=I.length&&I;return{matchUpFormatDifferences:u,matchUpCountDifference:f,descendantDifferences:r,ancestorDifferences:n,orderDifference:d,valueDifference:h,nameDifference:c,descendantDesc:o,ancestorDesc:l,...J,different:y,invalid:b}}function QB(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(FT).reduce((n,a)=>{let o=t[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=o,m={collectionValueProfiles:s,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},h=Object.keys(m).filter(g=>![void 0,null].includes(m[g])&&(!Array.isArray(m[g])||m[g].length>0));h.length!==1&&e.push({collectionId:a});let f=h[0];if(f){let g=f==="collectionValueProfiles"?Object.values(s):m[f];i.push({valueKey:f,value:g})}return r+=u,s!=null&&s.length?n+s.reduce((g,v)=>g+v.value,0):u?ot(c)?n+c*u:ot(d)?n+d*u:ot(p)?n+p*u:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function nk(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=B6(t);return{matchUp:Me(e,!0,!0),error:i}}function B6({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:u,drawId:c,event:d}){var h;if(!i)return{error:ge};if(typeof s!="string")return{error:yn};if(!a||!d){let f=(Br({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find(g=>g.matchUpId===s);if(!f)return{error:dn};({eventId:u,drawId:c}=f),{event:d,drawDefinition:a}=Wn({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:xa};n&&!r&&(r=zu({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:u??(d==null?void 0:d.eventId),drawId:c},{participants:m=[]}=Xm({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(o){let f=(Sn({context:l?p:void 0,participants:m,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!f)return{error:dn};let g=(h=a==null?void 0:a.structures)==null?void 0:h.find(v=>v.structureId===f.structureId);return{drawDefinition:a,structure:g,matchUp:f}}else{let{matchUp:f,structure:g}=wi({context:l?p:void 0,tournamentParticipants:m,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:s,inContext:l,event:d});return{matchUp:f,structure:g,drawDefinition:a}}}function ak({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:o,event:s}){var m,h,f,g,v;if(!t)return{error:ge};if(!o&&!s&&!i&&!r)return ee({result:{error:Xe},stack:"getTieFormat"});a&&!s&&(s=(m=t.events)==null?void 0:m.find(y=>y.eventId===a));let l=nk({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:o,event:s});if(r&&(l!=null&&l.error))return l;if(!e&&(l!=null&&l.drawDefinition)&&(e=l==null?void 0:l.drawDefinition),n=n??(l==null?void 0:l.structure),!n&&i&&!r){if(!e)return{error:ks};let y=et({drawDefinition:e,structureId:i});if(y.error)return y;n=y.structure}let u=((n==null?void 0:n.tieFormat)||(n==null?void 0:n.tieFormatId))&&((h=vn({structure:n,drawDefinition:e,event:s}))==null?void 0:h.tieFormat),c=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((f=vn({drawDefinition:e,event:s}))==null?void 0:f.tieFormat),d=(g=vn({event:s}))==null?void 0:g.tieFormat,p=(v=vn({matchUp:l==null?void 0:l.matchUp,drawDefinition:e,structure:n,event:s}))==null?void 0:v.tieFormat;return{...J,matchUp:l==null?void 0:l.matchUp,structureDefaultTieFormat:qr(u),eventDefaultTieFormat:qr(d),drawDefaultTieFormat:qr(c),tieFormat:qr(p),structure:n}}var V6={};yt(V6,{bulkUpdatePublishedEventIds:()=>ok,getAllEventData:()=>sk,getCourtInfo:()=>AT,getDrawData:()=>cD,getEventData:()=>dD,getEventPublishStatus:()=>Uo,getPublishState:()=>ah,getTournamentPublishStatus:()=>ob,getVenueData:()=>Lf});function ok({tournamentRecord:t,outcomes:e}){var n;if(!t)return{error:ge};if(!(e!=null&&e.length))return{error:Xe,info:"Missing outcomes"};let i=e.reduce((a,o)=>{let{drawId:s,eventId:l}=o;return l&&s&&(a[l]?a[l].includes(s)||a[l].push(s):a[l]=[s]),a},{}),r=Object.keys(i);return{publishedEventIds:((n=t.events)==null?void 0:n.filter(a=>r.includes(a.eventId))).filter(a=>{let o=Uo({event:a}),{drawDetails:s,drawIds:l}=o??{},{eventId:u}=a;return i[u].filter(c=>{let d=s?Object.keys(o.drawDetails).filter(p=>VA({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(c))||d.includes(c)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:i}}function j6({dates:t=[],extension:e}){var r;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=Nt(e.value)?(r=e.value)==null?void 0:r.dates:void 0;if(Array.isArray(i))return i!=null&&i.length?!!i.filter(n=>!t.length||t.includes(n)).length:!1}function G6({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){var o;let n={...Me(r,t,!0),venueId:i.venueId},{extension:a}=gt({name:Is,element:r});if(e&&a){let s=Nt(a.value)?(o=a.value)==null?void 0:o.dates:void 0,l=(a==null?void 0:a.value)===!0?[]:n.dateAvailability.map(u=>{let c=u.date;if(!(!c||s.includes(c)))return u}).filter(Boolean);n.dateAvailability=l}return{inContextCourt:n}}function qu(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},o=[],s=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])if(!(r.length&&!r.includes(p.venueId))){if(i){let{extension:m}=gt({name:Is,element:p});if(m!=null&&m.value)continue}o.includes(p.venueId)||(u.push(Me(p,e,!0)),o.push(p.venueId));for(let m of p.courts??[])if(!s.includes(m.courtId)){if(i){let{extension:f}=gt({name:Is,element:m});if(j6({extension:f,dates:n}))continue}let{inContextCourt:h}=G6({convertExtensions:e,ignoreDisabled:i,venue:p,court:m});l.push(h),s.push(m.courtId)}}}),{courts:l,venues:u,...J}}function Yde({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:Oi};let n=Me(e.venues??[],t).filter(o=>{if(!i)return o;let{extension:s}=gt({name:Is,element:o});return!(s!=null&&s.value)&&o}).filter(Boolean),a=n.reduce((o,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(u=>{if(!i&&!(r!=null&&r.length))return u;let{extension:c}=gt({name:Is,element:u});return j6({extension:c,dates:r})}).filter(Boolean).map(u=>{let{inContextCourt:c}=G6({convertExtensions:t,ignoreDisabled:i,venue:s,court:u});return c});return l.length?o.concat(l):o},[]);return{venues:n,courts:a}}function Db({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Oi}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:o}=Yde({tournamentRecord:a,dates:i});return o==null||o.forEach(s=>{let{venueId:l,courts:u}=s;(!e||u!=null&&u.length)&&!r.venueIds.includes(l)&&(r.venues.push(s),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function sk({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:ge};let i=t.events||[],r=(t==null?void 0:t.participants)||[],{tournamentInfo:n}=dh({tournamentRecord:t}),{venues:a}=qu({tournamentRecord:t}),o=i.map(s=>{let{eventId:l}=s,u=L6({event:s}).eventInfo,c=zy({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(m=>{let h=(({drawId:I,drawName:b,matchUpFormat:S,updatedAt:w})=>({matchUpFormat:S,updatedAt:w,drawName:b,drawId:I}))(m),{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=_g({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:m,event:s});return{drawInfo:h,matchUps:{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=Uo({event:s});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:o}}}function H6({publishStatus:t,drawId:e}){var i,r,n;return t!=null&&t.drawDetails?(n=(r=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:r.publishingDetail)==null?void 0:n.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}var z6="PUBLIC",Kde="ADMIN",Xde={PUBLIC_DISPLAY:z6,ADMIN_DISPLAY:Kde};function cD(t){var C,R,N;let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:o,status:s=qa,pressureRating:l,refreshResults:u,drawDefinition:c,noDeepCopy:d,sortConfig:p,context:m,event:h}=t;if(!c)return{error:_e};let f=(({matchUpFormat:A,updatedAt:M,drawType:E,drawName:O,drawId:k})=>({matchUpFormat:A,updatedAt:M,drawName:O,drawType:E,drawId:k}))(c);f.display=(C=gt({element:c,name:yS}).extension)==null?void 0:C.value;let g={},v,{allStructuresLinked:y,sourceStructureIds:I,hasDrawFeedProfile:b,structureGroups:S}=VT({drawDefinition:c});if(!y)return{error:RG};let w=(t==null?void 0:t.publishStatus)??Uo({event:h,status:s}),U=t.eventPublished??!!((N=(R=ah({event:h}).publishState)==null?void 0:R.status)!=null&&N.published),T=!1,D=!1,P=S.map(A=>{let M={},E=A.map(O=>{let{structure:k}=et({drawDefinition:c,structureId:O}),{seedAssignments:x}=po({drawDefinition:c,structure:k});return(k==null?void 0:k.stage)===Oe&&k.stageSequence===1&&(v=x),(k==null?void 0:k.stage)===Ye&&(g[k.stageSequence??0]=x),k}).sort((O,k)=>Km(O,k,p)).map(O=>{var z,q;if(!O)return;let k=O==null?void 0:O.structureId,x=[];O.stage&&[Oe,rn,$i].includes(O.stage)&&(x=v),(O==null?void 0:O.stage)===Ye&&(x=g[O.stageSequence??0]);let{matchUps:F,roundMatchUps:$,roundProfile:_}=Wt({seedAssignments:(z=O==null?void 0:O.seedAssignments)!=null&&z.length?void 0:x,context:{drawId:f.drawId,...m},tournamentParticipants:e,policyDefinitions:r,tournamentRecord:n,usePublishState:o,publishStatus:w,drawDefinition:c,inContext:a,structure:O,event:h}),{positionAssignments:L}=ai({structure:O}),B=L==null?void 0:L.filter(Ta(Vl)).map(W=>{var H,Q;let Y=(Q=(H=gt({element:W,name:Sc}))==null?void 0:H.extension)==null?void 0:Q.value,{drawPosition:re,participantId:K}=W;return D=!0,{participantResult:Y,participantId:K,drawPosition:re}});if(F.length&&(!(B!=null&&B.length)&&t.allParticipantResults||u&&!O.structures)){let{subOrderMap:W}=e3({positionAssignments:L}),Y=F.some(K=>K.matchUpType===ka)?F.filter(K=>K.matchUpType===ka):F,re=Hg({matchUpFormat:O.matchUpFormat,matchUps:Y,policyDefinitions:r,pressureRating:l,subOrderMap:W});B=L==null?void 0:L.filter(Ta(Vl)).map(K=>{var X;let{drawPosition:H,participantId:Q}=K;return D=!0,{participantResult:Q&&((X=re==null?void 0:re.participantResults)==null?void 0:X[Q]),participantId:Q,drawPosition:H}})}let V=O?(({stageSequence:W,structureName:Y,structureType:re,matchUpFormat:K,stage:H})=>({stageSequence:W,structureName:Y,structureType:re,matchUpFormat:K,stage:H}))(O):{},G=(q=gt({element:O,name:yS}).extension)==null?void 0:q.value;V.display=(G==null?void 0:G[z6])??G,V.sourceStructureIds=I[k],V.hasDrawFeedProfile=b[k],V.positionAssignments=L,V.structureActive=F.reduce((W,Y)=>{var K;let re=[er,cr,os,qi,ju,Mt,mn,zt].includes(Y.matchUpStatus);return W||re||!!Y.winningSide||!!((K=Y.score)!=null&&K.scoreStringSide1)},!1);let j=F.reduce((W,Y)=>W&&[Vt,qi,mn,zt,Mt,$a].includes(Y.matchUpStatus),!!F.length);return V.structureCompleted=j,M[k]=j,V.structureActive&&(T=!0),{...V,participantResults:B,seedAssignments:x,roundMatchUps:$,roundProfile:_,structureId:k}});return E.forEach(O=>{var k;i||delete O.positionAssignments,O.sourceStructuresComplete=(k=O.sourceStructureIds)==null?void 0:k.every(x=>M[x])}),E}).flat();return f.drawActive=T,f.participantPlacements=D,f.drawGenerated=P==null?void 0:P.reduce((A,M)=>A||!!(M!=null&&M.roundMatchUps),!1),f.drawCompleted=P==null?void 0:P.reduce((A,M)=>A&&M.structureCompleted,!0),f.drawPublished=o?U&&H6({publishStatus:w,drawId:f.drawId}):void 0,{structures:!o||f.drawPublished?d&&P||Me(P,!1,!0):void 0,drawInfo:d?f:Me(f,!1,!0),...J}}function dD(t){var R,N,A;let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=qa,sortConfig:o}=t,s=ze(t,[{tournamentRecord:!0},{[eA]:{event:!1,eventId:!1}}]);if(s.error)return s;let l=Me(t.tournamentRecord,!1,!0),u=t.event?void 0:Wn({tournamentRecord:l,eventId:t.eventId}).event,c=t.event?Me(t.event,!1,!0):u&&Me(u,!1,!0)||void 0;if(!c)return{error:lo};let{eventId:d}=c,{tournamentId:p,endDate:m}=l,h=Uo({event:c,status:a}),f=ah({event:c}).publishState??{},g=!!((R=f==null?void 0:f.status)!=null&&R.published),{participants:v}=Mi({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:l}),y=({stage:M,drawId:E})=>{var k,x,F;if(!n)return!0;let O=(x=(k=h==null?void 0:h.drawDetails)==null?void 0:k[E])==null?void 0:x.stageDetails;return!O||!Object.keys(O).length?!0:(F=O[M])==null?void 0:F.published},I=({structureId:M,drawId:E})=>{var k,x,F;if(!n)return!0;let O=(x=(k=h==null?void 0:h.drawDetails)==null?void 0:k[E])==null?void 0:x.structureDetails;return!O||!Object.keys(O).length?!0:(F=O[M])==null?void 0:F.published},b=({drawId:M})=>n?H6({publishStatus:h,drawId:M}):!0,S=({drawId:M,structure:E})=>{var k,x,F,$;if(!n)return E;let O=($=(F=(x=(k=h==null?void 0:h.drawDetails)==null?void 0:k[M])==null?void 0:x.structureDetails)==null?void 0:F[E.structureId])==null?void 0:$.roundLimit;if(ot(O)){let _=Se(1,O+1),L={},B={};for(let V of _)E.roundMatchUps[V]&&(L[V]=E.roundMatchUps[V],B[V]=E.roundProfile[V]);E.roundMatchUps=L,E.roundProfile=B}return E},w=c.drawDefinitions||[],U=!n||g?w.filter(b).map(M=>(({drawInfo:E,structures:O})=>({...E,structures:O}))(cD({allParticipantResults:t.allParticipantResults,context:{eventId:d,tournamentId:p,endDate:m},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:v,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:l,usePublishState:n,drawDefinition:M,publishStatus:h,sortConfig:o,event:c}))).map(({structures:M,...E})=>{let O=M==null?void 0:M.filter(({stage:k,structureId:x})=>I({structureId:x,drawId:E.drawId})&&y({stage:k,drawId:E.drawId})).map(k=>S({drawId:E.drawId,structure:k}));return{...E,structures:O}}).filter(M=>{var E;return(E=M.structures)==null?void 0:E.length}):void 0,T=(Array.isArray(l.venues)?l.venues:[]).map(M=>(({venueData:E})=>({...E}))(Lf({venueId:M.venueId,tournamentRecord:l}))),D=(({eventId:M,eventName:E,eventType:O,eventLevel:k,surfaceCategory:x,matchUpFormat:F,category:$,gender:_,startDate:L,endDate:B,ballType:V,discipline:G})=>({eventId:M,eventName:E,eventType:O,eventLevel:k,surfaceCategory:x,matchUpFormat:F,category:$,gender:_,startDate:L,endDate:B,ballType:V,discipline:G}))(c);D.display=(N=gt({element:c,name:yS}).extension)==null?void 0:N.value;let{tournamentInfo:P}=dh({tournamentRecord:l}),C={tournamentInfo:P,venuesData:T,eventInfo:D,drawsData:U};return C.eventInfo.publishState=f,C.eventInfo.published=(A=f==null?void 0:f.status)==null?void 0:A.published,{...J,eventData:C,participants:v}}var W6={};yt(W6,{courtGridRows:()=>gD,findVenue:()=>Jl,getMatchUpsToSchedule:()=>pD,getPersonRequests:()=>yp,getProfileRounds:()=>fD,getScheduledRoundsDetails:()=>Pb,getSchedulingProfile:()=>Yu,getSchedulingProfileIssues:()=>lk,publicFindCourt:()=>_A});function Gf({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){var u,c,d,p;let{individualParticipantIds:n}=PT(r);i=i??((u=r.schedule)==null?void 0:u.timeAfterRecovery);let a=m=>{t[m]||(t[m]=[]),t[m]=ct(t[m].concat(...n))},o=m=>{i&&(!e[m]||i>e[m])&&(e[m]=i)},s=((c=r.winnerTo)==null?void 0:c.matchUpId)||r.winnerMatchUpId;s&&(i&&o(s),a(s));let l=((d=r.loserTo)==null?void 0:d.matchUpId)||r.loserMatchUpId;l&&(i&&o(l),a(l)),(p=r.sidesTo)!=null&&p.length&&r.sidesTo.forEach(({matchUpId:m})=>{m&&(i&&o(m),a(m))})}function pD(t){let e=ze(t,[{[ZN]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,orderedMatchUpIds:s,clearDate:l,matchUps:u}=t,c=o?Object.keys(o):[],d=(s??[]).map(m=>u.find(h=>h.matchUpId===m)).filter(Boolean).filter(m=>{let h=!l&&(r.includes(m.matchUpId)||c.includes(m.matchUpId)),f=[Vt,Mt,qi,$a,mn,zt,er,cr].includes(m==null?void 0:m.matchUpStatus);return n||!h&&!m.winningSide&&!f}),p=i&&a?d.reduce((m,h)=>{let{drawId:f,tournamentId:g}=h;return m.matchUpMap[g]||(m.matchUpMap[g]={}),m.matchUpMap[g][f]?m.matchUpMap[g][f].push(h):m.matchUpMap[g][f]=[h],Gf({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:h}),m},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function mD({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!Ua({matchUpFormat:r}))return{error:Ry};let u=Object.keys(i).filter(d=>!o||d===o),c;return u.forEach(d=>{var h;if(c)return;let p=i[d],m=l?(h=Wn({tournamentRecord:p,eventId:l}))==null?void 0:h.event:void 0;return c=eb({tournamentRecord:p,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:m}),(c==null?void 0:c.averageMinutes)||(c==null?void 0:c.recoveryMinutes)}),{recoveryMinutes:(c==null?void 0:c.recoveryMinutes)||t,averageMinutes:(c==null?void 0:c.averageMinutes)||e,typeChangeRecoveryMinutes:(c==null?void 0:c.typeChangeRecoveryMinutes)||(c==null?void 0:c.recoveryMinutes)||t}}function Pb(t){let e=ze(t,[{[eA]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[Xn]:un}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:Oi};let a={},o=[],s=t.rounds.toSorted((h,f)=>(h.sortOrder??0)-(f.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(h=>Fg({tournamentRecord:h}).containedStructures)),u=t.matchUps??Rs({nextMatchUps:!0,tournamentRecords:n}).matchUps,c=0,d={},p={},m={};return{scheduledRoundsDetails:s.flatMap(h=>{var U;let f=h.periodLength||r,g=[];l!=null&&l[h.structureId]?g.push(...l[h.structureId]):g.push(h.structureId);let v=u?au({tournamentIds:[h.tournamentId],roundNumbers:[h.roundNumber],matchUpIds:h.matchUpIds,eventIds:[h.eventId],drawIds:[h.drawId],processContext:!0,structureIds:g,matchUps:u}).sort(nh):[],{segmentNumber:y,segmentsCount:I}=h.roundSegment||{};if(ot(y)&&Us(v==null?void 0:v.length)&&Us(I)&&y>0&&y<=I&&I<(v==null?void 0:v.length)&&!((U=h.matchUpIds)!=null&&U.length)){let T=v.length/I,D=T*(y-1);v=v.slice(D,D+T)}let b=n[h.tournamentId],S=Wn({drawId:h.drawId,tournamentRecord:b}).event,w=[];for(let T of v){let D=T.matchUpFormat;D&&(a[D]||(a[D]=[],a[D].push(T)),w.push(D))}for(let T of w){let{eventType:D,category:P}=S??{},{categoryName:C,ageCategoryCode:R}=P??{},{typeChangeRecoveryMinutes:N,recoveryMinutes:A,averageMinutes:M,error:E}=mD({categoryName:C??R,categoryType:P==null?void 0:P.categoryType,tournamentId:h.tournamentId,eventId:h.eventId,tournamentRecords:n,matchUpFormat:T,eventType:D});if(E)return{error:E,round:h};let O=v.filter(x=>(i||!gr.includes(x.matchUpStatus))&&x.matchUpStatus!==Vt).map(Tr);O.forEach(x=>{m[x]={typeChangeRecoveryMinutes:N,recoveryMinutes:A,averageMinutes:M},d[x]=A,p[x]=M}),o.push(...O),c=Math.max(M||0,c);let k=`${M}|${f}`;return{roundPeriodLength:f,recoveryMinutes:A,averageMinutes:M,matchUpIds:O,hash:k}}}),greatestAverageMinutes:c,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:o,minutesMap:m,...J}}function q6({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t==null?void 0:t.map(s=>{let l=pt(s==null?void 0:s.scheduleDate);if(!l){n.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let u=((s==null?void 0:s.venues)||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!(e!=null&&e.includes(p))){n.push(`Missing venueId: ${p}`);return}let m=d.filter(h=>{let f=i.includes(h.eventId)&&r.includes(h.drawId);return f||n.push(`Invalid eventId: ${h.eventId} or drawId: ${h.drawId}`),f});if(m.length)return{venueId:p,rounds:m}}).filter(Boolean);return u.length&&l&&{...s,venues:u}}).filter(Boolean),o=n.length;return{updatedSchedulingProfile:a,modifications:o,issues:n}}function hD({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:oe};let{venueIds:i,tournamentsMap:r}=Zde({tournamentRecords:t}),n,a,o=e.every(s=>{let{scheduleDate:l,venues:u}=s;return Ia(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(m=>{var T,D,P,C;if(!m)return a="empty round",!1;let{roundSegment:h,tournamentId:f,structureId:g,roundNumber:v,eventId:y,drawId:I}=m,b=(C=(P=(D=(T=r==null?void 0:r[f])==null?void 0:T[y])==null?void 0:D[I])==null?void 0:P[g])==null?void 0:C.includes(v);b||(a="Invalid rounds");let{segmentNumber:S,segmentsCount:w}=h||{},U=!h||ot(S)&&Us(w)&&S<=w;return U||(a="Invalid segment"),b&&U}):(n=Gm,!1):(a="rounds should be an array",!1)}):!1});return!o&&!n&&(n=oe),{valid:!!o,error:n,info:a}}function Jde(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],o=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:c,courts:d})=>(!r||(d==null?void 0:d.length))&&c),u=e==null?void 0:e.tournamentId;return u&&(n.push(u),i[u]={},((e==null?void 0:e.events)||[]).forEach(c=>{let d=c.eventId;o.push(d),i[u][d]={},(c.drawDefinitions||[]).forEach(p=>{let m=p.drawId;s.push(m),i[u][d][m]={};let{structures:h}=Zo({drawDefinition:p});(h||[]).forEach(f=>{var b;let g=f.structureId,{matchUps:v}=Wt({structure:f}),{roundMatchUps:y}=Cn({matchUps:v}),I=y&&Object.keys(y).map(S=>parseInt(S));i[u][d][m][g]=I,a.push(g),(b=f.structures)!=null&&b.length&&f.structures.forEach(S=>{a.push(S.structureId),i[u][d][m][S.structureId]=I})})})})),{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}function Zde(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:m,eventIds:h,drawIds:f}=Jde({tournamentRecord:u});return m.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...h),l.drawIds.push(...f),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:r,eventIds:n,drawIds:a}}function Yu({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Oi};let{extension:i}=gt({element:e,name:wm,tournamentRecords:t,discover:!0}),r=(i==null?void 0:i.value)||[];if(r.length){let{venueIds:n}=Db({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:o}=bO({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:u}=q6({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:o});if(l){r=s;let c=zg({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return c.error?c:{schedulingProfile:r,modifications:l,issues:u}}}return{schedulingProfile:r,modifications:0}}function zg({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=hD({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?Lt({tournamentRecords:t,discover:!0,extension:{name:wm,value:i}}):Un({element:e,name:wm,tournamentRecords:t,discover:!0})}function Rb(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=Yu({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:r}=Db({tournamentRecords:i}),{eventIds:n,drawIds:a}=bO({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=q6({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return s?{...zg({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...J,modifications:s,issues:l}}function lk(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:Ty};if(!Array.isArray(e))return{error:oe};if(!e.every(Ia))return{error:Nr};let n=[],a=0,o={},{schedulingProfile:s}=Yu({tournamentRecords:i});if(!s)return{issues:n,...J};let{matchUps:l}=Rs({nextMatchUps:!0,tournamentRecords:i});for(let c of s){let{scheduleDate:d,venues:p=[]}=c;if(!(e!=null&&e.length)||e.includes(d)){for(let m of p||[])if(m){let{rounds:h}=m,f=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=Pb({tournamentRecords:i,periodLength:r,matchUps:l,rounds:h}),{matchUpDependencies:y}=ls({tournamentRecords:i,matchUps:l}),I=b=>{let S;return v==null||v.find((w,U)=>{let T=w.matchUpIds.includes(b);return T&&(S=U),T}),S};if(g==null||g.forEach((b,S)=>{var T;let w=g.slice(S+1),U=Vi(w,((T=y==null?void 0:y[b])==null?void 0:T.matchUpIds)||[]);U.length&&f.push({matchUpId:b,shouldBeAfter:U})}),f.length){a+=f.length;let b=f.map(({matchUpId:S,shouldBeAfter:w})=>{let U=I(S),T=ct(w.map(I));return o[d]||(o[d]={}),o[d][U]||(o[d][U]=[]),T.forEach(D=>{o[d][U].includes(D)||o[d][U].push(D)}),{matchUpId:S,matchUpRoundIndex:U,earlierRoundIndices:T,shouldBeAfter:w}});n.push(...b)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...n.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:m}=c;return{[d]:{earlierRoundIndices:m,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:o,...J}}function yp(t){let{tournamentRecords:e,requestType:i}=t,r=ze(t,[{[pn]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:o}=gt({element:a,name:kg}),s=(o==null?void 0:o.value)||[];for(let l of s){let{personId:u,requests:c}=l||{};n[u]||(n[u]=[]);for(let d of c)i&&d.requestType!==i||n[u].push(d)}}return{personRequests:n,...J}}function t1(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:o,eventId:s,drawId:l}=t,u=r?e:o,c=[n,s,l,u,a].join("|");return Ge({structureId:u,roundSegment:i,tournamentId:n,roundNumber:a,eventId:s,drawId:l,id:c})}function eV({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:o,categoryType:s}=n||{},{categoryName:l,ageCategoryCode:u}=o||{},c=wa(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let m=c[p],h=mD({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:s,eventType:a});if(h.error)return h;let f=h.averageMinutes*m;isNaN(d)||(d+=f)}),{roundMinutes:d}}function Qde(t){return(t||[]).reduce((e,i)=>{var a,o;let r=(((a=i.finishingPositionRange)==null?void 0:a.winner)||[]).reduce((s,l)=>s+l,0),n=(((o=i.finishingPositionRange)==null?void 0:o.winner)||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:n}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function tV(t){let e=t.length,i=t.filter(({sides:u})=>u==null?void 0:u.some(({bye:c})=>c)).length||0,r=t.filter(({winningSide:u,matchUpStatus:c})=>u||gr.includes(c)).length||0,n=t.filter(({schedule:u,matchUpStatus:c})=>(u==null?void 0:u.scheduledDate)&&(u==null?void 0:u.scheduledTime)&&c!==Vt).length||0,a=e-i,o=a===r,s=a-n,l=a-n;return{unscheduledCount:s,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:o,byeCount:i}}function fD({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:Ty};t={[i.tournamentId]:i}}if(e){let a=hD({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=Yu({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:_r};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:o})=>a.map(({rounds:s})=>s.map(l=>{var c;let u=t1(l);return(c=u.roundSegment)!=null&&c.segmentsCount&&(n[u.id]=u.roundSegment.segmentsCount),Ge({id:r?u.id:void 0,scheduleDate:o,...u})}))).flat(1/0),segmentedRounds:n}}function gD({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:oe};let r=i==null?void 0:i.reduce((o,s)=>{let l=s.matchUps||[],u=Math.max(0,...l.map(c=>c.schedule.courtOrder||0));return u>o?u:o},1),n=e?Math.max(e,r):r,a=Se(0,n).map(o=>({matchUps:Se(0,i.length).map(s=>{let l=i[s],{courtId:u,venueId:c}=l;return{schedule:{courtOrder:o+1,venueId:c,courtId:u}}})}));return i.forEach((o,s)=>{var l;for(let u of o.matchUps){let c=(l=u.schedule)==null?void 0:l.courtOrder;c&&(a[c-1].matchUps[s]=u)}}),{courtPrefix:t,rows:a.map((o,s)=>Object.assign({rowId:`rowId-${s+1}`},...o.matchUps.map((l,u)=>({[`${t}${u}`]:l}))))}}var Y6={};yt(Y6,{getEntriesAndSeedsCount:()=>vD,getMaxEntryPosition:()=>uk});function vD({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:gi};let{entries:o,stageEntries:s}=iq({drawDefinition:e,drawId:r,stage:a,event:n}),l=s.length,{drawSize:u}=P3({participantsCount:l}),c=Sb({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return ee({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:o,seedsCount:d,stageEntries:s}}function uk(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>Ze(n||0)),0)}var K6={};yt(K6,{allCompetitionMatchUps:()=>Rs,allDrawMatchUps:()=>Sn,allEventMatchUps:()=>Zl,allTournamentMatchUps:()=>Br,analyzeMatchUp:()=>$I,calculateWinCriteria:()=>ph,checkMatchUpIsComplete:()=>Pd,competitionScheduleMatchUps:()=>Eb,drawMatchUps:()=>bk,eventMatchUps:()=>yD,filterMatchUps:()=>au,getAllDrawMatchUps:()=>mr,getAllStructureMatchUps:()=>Wt,getCheckedInParticipantIds:()=>th,getCompetitionMatchUps:()=>_I,getEventMatchUpFormatTiming:()=>dk,getHomeParticipantId:()=>fk,getMatchUpCompetitiveProfile:()=>Qy,getMatchUpContextIds:()=>gk,getMatchUpDailyLimits:()=>wD,getMatchUpDailyLimitsUpdate:()=>pk,getMatchUpDependencies:()=>ls,getMatchUpFormat:()=>vk,getMatchUpFormatTiming:()=>eb,getMatchUpFormatTimingUpdate:()=>ck,getMatchUpScheduleDetails:()=>OT,getMatchUpType:()=>kT,getMatchUpsStats:()=>Ik,getModifiedMatchUpFormatTiming:()=>ID,getParticipantResults:()=>vb,getPredictiveAccuracy:()=>hk,getRoundMatchUps:()=>Cn,getRounds:()=>yk,isValidMatchUpFormat:()=>Ua,matchUpActions:()=>XT,participantScheduledMatchUps:()=>mk,tallyParticipantResults:()=>Hg,tournamentMatchUps:()=>bD,validMatchUp:()=>CT,validMatchUps:()=>wo});function X6({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Oi};let i=[],r;for(let n of Object.values(t)){let{extension:a}=gt({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let o=n.events??[];for(let s of o){let{eventId:l}=s,{extension:u}=gt({name:e,element:s});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function ck({tournamentRecords:t}){return X6({extensionName:Su,tournamentRecords:t})}var gC="ADULT",vC="JUNIOR",cU="WHEELCHAIR",epe={[Hc]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Qt]:30,default:60}}]},defaultDailyLimits:{[ti]:2,[Qt]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[pu],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[cU],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[gC,cU],minutes:{default:60,[Qt]:30}},{categoryTypes:[vC],minutes:{default:60,[Qt]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[gC,cU],minutes:{default:30}},{categoryTypes:[vC],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[gC,vC],minutes:{default:30}},{categoryTypes:[cU],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},tpe=epe;function dk({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:gi};let n=[],a;if(e!=null&&e.length){let d=[];n=e.map(p=>{let m=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(m==null?void 0:m.matchUpFormat)&&Ua({matchUpFormat:m==null?void 0:m.matchUpFormat}))return d.push(m.matchUpFormat),m}).filter(Boolean)}else{let{policy:d}=pp({policyType:Ps,tournamentRecord:t,event:r});if(d!=null&&d.matchUpFormats)n=d==null?void 0:d.matchUpFormats;else{let{extension:p}=gt({name:Su,element:r}),m,h;p!=null&&p.value?{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=p.value:{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=tpe[Hc],n=ct([...(m||[]).map(f=>f.matchUpFormatCodes),...(h||[]).map(f=>f.matchUpFormatCodes)].flat()).map(f=>({matchUpFormat:f})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=r,u=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:gi};let c=n.map(({matchUpFormat:d,description:p})=>{let m=eb({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:o,event:r});return{matchUpFormat:d,description:p,...m}});return Ge({eventMatchUpFormatTiming:c,info:a})}function ID(t){let e=ze(t,[{[br]:!0},{[Kr]:f=>Ua({matchUpFormat:f}),[_a]:Ry,[KN]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=gt({name:Su,element:n}),o=a==null?void 0:a.value,{extension:s}=gt({element:i,name:Su}),l=s==null?void 0:s.value,u=(o==null?void 0:o.matchUpAverageTimes)&&qv({...o,matchUpFormat:r}),c=(l==null?void 0:l.matchUpAverageTimes)&&qv({...l,matchUpFormat:r}),d=[u,c].find(f=>f),p=(o==null?void 0:o.matchUpRecoveryTimes)&&Yv({...o,matchUpFormat:r}),m=(l==null?void 0:l.matchUpRecoveryTimes)&&Yv({...l,matchUpFormat:r}),h=[p,m].find(f=>f);return{matchUpFormat:r,recoveryTimes:h,averageTimes:d}}function pk({tournamentRecords:t}){return X6({extensionName:By,tournamentRecords:t})}var Cb=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function mk({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!wo(e))return{error:Bu};if(!Array.isArray(t))return{error:oe};let i=e.filter(Boolean).filter(({schedule:r})=>Cb({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,o=pt(a==null?void 0:a.scheduledDate),s=bi(a==null?void 0:a.scheduledTime);return o&&s&&(r[o]?r[o].push(n):r[o]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>{var o,s;return _H(bi((o=n.schedule)==null?void 0:o.scheduledTime),bi((s=a.schedule)==null?void 0:s.scheduledTime))})}),{...J,scheduledMatchUps:i}}function ipe({tournamentRecords:t}){var r;let e={},i=[];for(let n of Object.values(t))for(let a of n.events??[]){let o=Uo({event:a}),s=o==null?void 0:o.drawDetails;Nt(s)?(Object.assign(e,s),i.push(...Object.keys(s).filter(l=>VA({drawId:l,drawDetails:s})))):(r=o==null?void 0:o.drawIds)!=null&&r.length&&i.push(...o.drawIds)}return{drawIds:i,detailsMap:e}}function $S({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:s,drawId:l,structureId:u,roundNumber:c})=>`${s}|${l}|${u}${c}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let m=r({eventId:l,drawId:u,structureId:c,roundNumber:d});i[m]=p})});let n=[],a={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},u=l.scheduledDate&&pt(l.scheduledDate)||l.scheduledTime&&pt(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(s)}let o=Object.keys(a).sort();for(let s of o){let l=a[s],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},m=p.scheduledTime&&bi(p.scheduledTime)||"noScheduledTime";u[m]||(u[m]=[]),u[m].push(d)}let c=Object.keys(u).sort();for(let d of c){let p=u[d];p.sort((m,h)=>{let f=i[r(m)]||0,g=i[r(h)]||0;return f-g}),n.push(...p)}}return n}function yD(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:m,contextProfile:h,nextMatchUps:f,tournamentId:g,inContext:v,context:y,event:I}=t;if(!I)return{error:gi};let{eventId:b,eventName:S,endDate:w,eventType:U,category:T,gender:D}=I??{},P={...y,...Ge({surfaceCategory:I.surfaceCategory??(c==null?void 0:c.surfaceCategory),indoorOutDoor:I.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),tournamentId:g??(c==null?void 0:c.tournamentId),endDate:w??(c==null?void 0:c.endDate),eventName:S,eventType:U,category:T,eventId:b,gender:D})},C;!e&&c&&({participants:e,participantMap:r,groupInfo:C}=Xm({participantsProfile:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextProfile:h,inContext:v})),h&&!i&&(i=zu({policyDefinitions:l,tournamentRecord:c,contextProfile:h,event:I}));let R=Uo({event:I});return{...(I.drawDefinitions??[]).reduce((N,A)=>{var E;let M=_g({hydrateParticipants:t.hydrateParticipants,context:P,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:m,participantMap:r,publishStatus:R,contextProfile:h,drawDefinition:A,nextMatchUps:f,inContext:v,event:I});return(E=Object.keys(M))==null||E.forEach(O=>{Array.isArray(M[O])&&(N[O]||(N[O]=[]),N[O]=N[O].concat(M[O]))}),N},{}),...J,groupInfo:C}}function bD(t){if(!(t!=null&&t.tournamentRecord))return{error:ge};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,inContext:l=!0,usePublishState:u,contextFilters:c,matchUpFilters:d,contextProfile:p,nextMatchUps:m,context:h}=t,f=t.tournamentId??s.tournamentId,g=(s==null?void 0:s.events)??[],{participants:v,participantMap:y,groupInfo:I}=Xm({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:p,inContext:l});p&&!e&&(e=zu({policyDefinitions:a,tournamentRecord:s,contextProfile:p}));let{appliedPolicies:b}=$t({tournamentRecord:s}),S=(c==null?void 0:c.eventIds)??[];return{...g.filter(w=>!S.includes(w.eventId)).map(w=>{var T,D,P;let U={eventDrawsCount:((D=(T=Gi({event:w}).flightProfile)==null?void 0:T.flights)==null?void 0:D.length)||((P=w.drawDefinitions)==null?void 0:P.length)||0,...h};return yD({hydrateParticipants:t.hydrateParticipants,context:U,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:u,contextFilters:c,contextProfile:p,contextContent:e,matchUpFilters:d,participantMap:y,participants:v,tournamentId:f,nextMatchUps:m,inContext:l,event:w})}).reduce((w,U)=>{var T;return(T=U&&Object.keys(U).filter(D=>!["success","matchUpsMap"].includes(D)))==null||T.forEach(D=>{Array.isArray(U[D])&&(w[D]||(w[D]=[]),w[D]=w[D].concat(U[D]),w.matchUpsCount+=U[D].length)}),w},{matchUpsCount:0}),groupInfo:I}}function _I({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:o,contextFilters:s,nextMatchUps:l,inContext:u}){if(typeof r!="object"||!Object.keys(r).length)return{error:Oi};let c=Object.keys(r).map(p=>{let m=r[p];return bD({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:m,usePublishState:a,matchUpFilters:o,contextFilters:s,nextMatchUps:l,inContext:u})}),d={};return{...c.reduce((p,m)=>(Object.keys(m).forEach(h=>{Array.isArray(m[h])&&(p[h]||(p[h]=[]),p[h]=p[h].concat(m[h])),h==="groupInfo"&&Object.assign(d,m[h])}),p),{}),groupInfo:d}}function Eb(t){var R,N,A,M,E,O,k;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:Oi};let{courts:e,venues:i}=qu(t),r=Yu(t).schedulingProfile,{sortDateMatchUps:n=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:o,activeTournamentId:s,tournamentRecords:l,withCourtGridRows:u,minCourtGridRows:c,usePublishState:d,status:p=qa,sortCourtsData:m}=t,h=s??Hm()??Object.keys(l)[0],f=d?ob({tournamentRecord:l[h],status:p}):void 0,g=o?_I({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[qi]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!((R=f==null?void 0:f.orderOfPlay)!=null&&R.published))return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let v,y;d&&({drawIds:v,detailsMap:y}=ipe({tournamentRecords:l})),v!=null&&v.length&&(t.contextFilters||(t.contextFilters={}),(N=t.contextFilters)!=null&&N.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(x=>v.includes(x)):t.contextFilters.drawIds=v),(A=f==null?void 0:f.eventIds)!=null&&A.length&&(t.matchUpFilters||(t.matchUpFilters={}),(M=t.matchUpFilters)!=null&&M.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(x=>f.eventIds.includes(x)):t.matchUpFilters.eventIds=f.eventIds),(E=f==null?void 0:f.scheduledDates)!=null&&E.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(x=>f.scheduledDates.includes(x)):t.matchUpFilters.scheduledDates=f.scheduledDates),o&&(t.matchUpFilters||(t.matchUpFilters={}),(k=(O=t.matchUpFilters)==null?void 0:O.excludeMatchUpStatuses)!=null&&k.length?t.matchUpFilters.excludeMatchUpStatuses.includes(qi)||t.matchUpFilters.excludeMatchUpStatuses.push(qi):t.matchUpFilters.excludeMatchUpStatuses=[qi]);let{completedMatchUps:I,upcomingMatchUps:b,pendingMatchUps:S,groupInfo:w}=_I({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),U=[...b??[],...S??[]];y&&(!(v!=null&&v.length)||Object.keys(y).length)&&(U=U.filter(x=>{var L,B;let{drawId:F,structureId:$,stage:_}=x;if(!((B=(L=y==null?void 0:y[F])==null?void 0:L.publishingDetail)!=null&&B.published))return!1;if(y[F].stageDetails){let V=Object.keys(y[F].stageDetails),G=V.filter(z=>!y[F].stageDetails[z].published),j=V.filter(z=>y[F].stageDetails[z].published);return G.length&&G.includes(_)?!1:j.length&&j.includes(_)?!0:G.length&&!G.includes(_)&&!j.length}if(y[F].structureDetails){let V=Object.keys(y[F].structureDetails),G=V.filter(z=>!y[F].structureDetails[z].published),j=V.filter(z=>y[F].structureDetails[z].published);return G.length&&G.includes($)?!1:j.length&&j.includes($)?!0:G.length&&!G.includes($)&&!j.length}return!0}));let T=n?$S({matchUps:U,schedulingProfile:r}):U,D=e==null?void 0:e.map(x=>{let F=C(x);return{surfaceCategory:(x==null?void 0:x.surfaceCategory)??"",matchUps:F,...x}}),P={completedMatchUps:o?g:I,dateMatchUps:T,courtsData:D,groupInfo:w,venues:i};if(u){let{rows:x,courtPrefix:F}=gD({minRowsCount:c,courtsData:D});P.courtPrefix=F,P.rows=x}return{...P,...J};function C({courtId:x}){let F=(a?T.concat(I??[]):T).filter($=>{var _,L,B;return((_=$.schedule)==null?void 0:_.courtId)===x||((B=(L=$.schedule)==null?void 0:L.allocatedCourts)==null?void 0:B.map(({courtId:V})=>V).includes(x))});return m?$S({matchUps:F,schedulingProfile:r}):F}}function wD({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Oi};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:o}=rpe({tournamentRecord:a});r=o}),{matchUpDailyLimits:r}}function rpe(t){var s;let e=ze(t,[{[br]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:r}=pp({policyType:Hc,tournamentRecord:i}),{extension:n}=gt({element:i,name:By}),a=(s=n==null?void 0:n.value)==null?void 0:s.dailyLimits,o=r==null?void 0:r.defaultDailyLimits;return{matchUpDailyLimits:a||o}}function hk(t){var A,M,E,O;let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:o,zoneDoubling:s,matchUpType:l,scaleName:u,eventId:c,zonePct:d,drawId:p,event:m}=t;if(!r&&!e)return{error:ge};if(l&&![ti,Qt].includes(l))return{error:oe,info:{matchUpType:l}};if(e&&!wo(e))return{error:oe,context:{matchUps:e}};let h=Mr[u],f=(h==null?void 0:h.ascending)??t.ascending??!1,g=(h==null?void 0:h.accessor)??t.valueAccessor,v=Array.isArray(h==null?void 0:h.range)?Math.abs(h.range[0]-h.range[1]):0,y=ot(d)&&v?(d??0/100)*v:t.zoneMargin??v,I={withScaleValues:!0,withCompetitiveness:!0},b={matchUpTypes:l?[l]:[ti,Qt]},S=r==null?void 0:r.participants;(A=e==null?void 0:e[0])!=null&&A.hasContext?p?e=e.filter(k=>k.drawId===p):c&&(e=e.filter(k=>k.eventId===c)):e===void 0&&(e=p&&!n&&[]||!p&&c&&!m&&[]||p&&((M=Sn({inContext:!0,drawDefinition:n,contextFilters:b,contextProfile:I,participants:S}))==null?void 0:M.matchUps)||!p&&c&&((E=Zl({inContext:!0,contextFilters:b,contextProfile:I,participants:S,event:m}))==null?void 0:E.matchUps)||((O=Br({tournamentRecord:r,contextFilters:b,contextProfile:I}))==null?void 0:O.matchUps)||[]),l&&(e=e.filter(k=>k.matchUpType===l));let w=e.filter(({winningSide:k,score:x,sides:F,matchUpStatus:$})=>![mn,Mt,zt,xg,$a].includes($??"")&&vr({score:x})&&(F==null?void 0:F.length)===2&&k),U=ape({matchUps:w,excludeMargin:a,exclusionRule:o,valueAccessor:g,ascending:f,scaleName:u}),T=!s||Yi(ti)(l)?y:(y||0)*2,D=y?w.map(({competitiveProfile:k,matchUpType:x,score:F,sides:$})=>{let _=J6({singlesForDoubles:i,valueAccessor:g,matchUpType:x,scaleName:u,sides:$}),L=Math.abs(_[0].value-_[1].value);return{competitiveness:k==null?void 0:k.competitiveness,valuesGap:L,score:F}}).filter(({valuesGap:k})=>k<=T):[],P=npe({zoneData:D}),C=P&&[].concat(Object.values(P)).flat().length,R=C&&Object.assign({},...Object.keys(P).map(k=>({[k]:Math.round(1e4*P[k].length/C)/100}))),N=w.length-((D==null?void 0:D.length)||0);return{...J,relevantMatchUps:w,zoneDistribution:R,zoneData:D,accuracy:U,nonZone:N}}function npe({zoneData:t}){let e={[EA]:[],[AI]:[],[OI]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function J6({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let o=e==null?void 0:e.range.sort(),s=l=>{let u=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&u>=o[0]&&u<=o[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l==null?void 0:l.individualParticipants;if(c!=null&&c.length){let d=[],p=0;for(let m of c){let{scaleValue:h,value:f}=iV({singlesForDoubles:t,valueAccessor:i,participant:m,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:v}=s(h);g&&u.push(v),d.push(h),f&&!isNaN(p)?p+=f:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=iV({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:m,exclusionValue:h}=s(d);return m&&u.push(h),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function iV({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){var u,c,d,p,m;let a=t?ti:i,o=(c=(u=r==null?void 0:r.rankings)==null?void 0:u[a])==null?void 0:c.find(h=>h.scaleName===n),s=(m=((p=(d=r==null?void 0:r.ratings)==null?void 0:d[a])==null?void 0:p.find(h=>h.scaleName===n))||o)==null?void 0:m.scaleValue,l=e?s==null?void 0:s[e]:s;return{scaleValue:s,value:l}}function ape({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let u of a){let{matchUpType:c,sides:d,score:p,winningSide:m}=u;if(!m)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:Xe};let h=m-1,f=J6({exclusionRule:e,valueAccessor:i,matchUpType:c,scaleName:n,sides:d});if(e){let S=f.map(({exclusionValues:w})=>w).flat();if(S.length){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:S,winningSide:m,sideValues:f});continue}}if(f.filter(S=>![void 0,"",null].includes(S.value)).length<2){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:m,sideValues:f});continue}let g=f[h].value-f[1-h].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:m,excludeGap:y,sideValues:f,valuesGap:g});continue}let I=r?g:g*-1,b=m===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;I>0?o.affirmative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p}):o.negative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}function ph({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=i3({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:o,collectionGroupNumber:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,m=s&&r.includes(s);if(ot(p||d))n=!0;else{if(m)continue;if(typeof l=="number"&&ot(l))i+=l;else if(Array.isArray(o)&&(o!=null&&o.length))for(let h of o)i+=h.matchUpValue;else typeof c=="number"&&ot(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...J}:{valueGoal:Math.floor(i/2)+1,...J}}function fk(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=ze(t,[{[Xl]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:o}=fp({timeItems:(r==null?void 0:r.timeItems)||[],itemType:kA});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function gk({matchUps:t,matchUpId:e}){if(!wo(t))return{error:oe};let i=t.find(s=>s.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:o}}function Wg(t,e){if(!Nt(t))return{error:oe};if(!Array.isArray(e))return{error:oe};let i={};for(let{param:r,error:n,attr:a}of e){let o=ope({params:t,param:r,attr:a,error:n});if(o!=null&&o.error)return o;i[r]=o}return i}function ope({params:t,param:e,attr:i,error:r}){if(e===mT&&Nt(t.drawDefinition)&&Ti(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===Xl){let n=B6({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:_r,info:{param:e}}}function vk(t){var p,m;let{structureId:e,matchUpId:i,event:r}=t,n=t.drawDefinition,a=ze(t,[{[br]:!0},{[eA]:{[cT]:!1,[hl]:!1,[Fz]:!1,[Gc]:!1}}]);if(a[Bo])return a;let o=(p=Wg(t,[{[Ag]:Xl,[Bo]:Xe}]))==null?void 0:p.matchUp;if(i&&(o!=null&&o.error))return o;!n&&(o!=null&&o.drawDefinition)&&(n=o==null?void 0:o.drawDefinition);let s=o==null?void 0:o.structure;if(!s&&e&&!i){if(!n)return{error:ks};let h=et({drawDefinition:n,structureId:e});if(h.error)return h;s=h.structure}let l=s==null?void 0:s.matchUpFormat,u=n==null?void 0:n.matchUpFormat,c=r==null?void 0:r.matchUpFormat,d=((m=o==null?void 0:o.matchUp)==null?void 0:m.matchUpFormat)||l||u||c;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:c,drawDefaultMatchUpFormat:u,matchUpFormat:d}}function Ik({profileBands:t,tournamentRecord:e,matchUps:i}){if(!wo(i))return{error:Bu};let r=!t&&pp({policyType:nu,tournamentRecord:e}).policy,n=t||(r==null?void 0:r.profileBands)||MA[nu].profileBands,a=i.filter(({winningSide:p})=>p),o=a.map(SW),s=(p,m)=>{let h=UW(m,n);return p[h]+=1,p},l=TW(o).reduce((p,m)=>s(p,m),{[EA]:0,[AI]:0,[OI]:0,[gW]:0}),u=Object.keys(l).reduce((p,m)=>(l[m]||0)+p,0),c=Object.keys(l).map(p=>{let m=parseFloat((l[p]/u).toFixed(4));return{[p]:m*100}}),d=a.filter(({matchUpStatus:p})=>p===PB).length;return c.push({[PB]:parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...J}}var{stageOrder:rV}=_ae;function spe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(rV[t==null?void 0:t.stage]||0)-(rV[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function yk({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){var w;if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:oe,inContextMatchUps:r};if(o&&!n){if(typeof o!="object")return{error:Ty};n={[o.tournamentId]:o}}let m=typeof n!="object"||!Object.keys(n).length;if((d||u||!r||!a&&(t||i||a||s))&&m)return{error:Oi};let h=Object.assign({},...Object.values(n??{}).map(({venues:U=[],tournamentId:T})=>({[T]:U==null?void 0:U.map(({venueId:D})=>D)}))),f=Object.values(n??{}).map(({events:U=[],tournamentId:T,startDate:D,endDate:P})=>U.map(C=>({...C,validVenueIds:h[T],startDate:C.startDate??D,endDate:C.endDate??P}))).flat(),{segmentedRounds:g,profileRounds:v}=n&&(t||i||a||s)&&fD({tournamentRecords:n,schedulingProfile:a})||{},y=t&&Object.assign({},...v.map(U=>({[U.id]:U}))),I=r||n&&((w=Rs({tournamentRecords:n,matchUpFilters:l}))==null?void 0:w.matchUps)||[],b=[],S=I&&Object.values(I.reduce((U,T)=>{var j;let D=t1(T).id,P=g==null?void 0:g[D],C=[...((j=U[D])==null?void 0:j.matchUps)??[],T],{containerStructureId:R,stageSequence:N,structureName:A,tournamentId:M,isRoundRobin:E,matchUpType:O,roundNumber:k,roundOffset:x,structureId:F,eventName:$,roundName:_,drawName:L,eventId:B,drawId:V}=T,G=E?R:F;return{...U,[D]:{id:c?D:void 0,structureId:G,stageSequence:N,segmentsCount:P,structureName:A,tournamentId:M,matchUpType:O,roundNumber:k,roundOffset:x,eventName:$,roundName:_,drawName:L,matchUps:C,eventId:B,drawId:V}}},{})).map(U=>{let{minFinishingSum:T,winnerFinishingPositionRange:D}=Qde(U.matchUps),P=U.segmentsCount;if(P){let k=U.matchUps.length/P;return Pr(U.matchUps.sort((x,F)=>x.roundPosition-F.roundPosition),k).map((x,F)=>{let{unscheduledCount:$,incompleteCount:_,matchUpsCount:L,isScheduled:B,isComplete:V,byeCount:G}=tV(x),j=eV({matchUps:U.matchUps,tournamentRecords:n,events:f,round:U});return Ge({...U,...p,roundSegment:{segmentsCount:P,segmentNumber:F+1},winnerFinishingPositionRange:D,unscheduledCount:$,incompleteCount:_,minFinishingSum:T,matchUpsCount:L,isScheduled:B,roundTiming:j,isComplete:V,byeCount:G,matchUps:x})})}let{unscheduledCount:C,incompleteCount:R,matchUpsCount:N,isScheduled:A,isComplete:M,byeCount:E}=tV(U.matchUps),O=eV({matchUps:U.matchUps,tournamentRecords:n,events:f,round:U});return Ge({...U,...p,winnerFinishingPositionRange:D,unscheduledCount:C,incompleteCount:R,minFinishingSum:T,matchUpsCount:N,isScheduled:A,roundTiming:O,isComplete:M,byeCount:E})}).flat().filter(U=>{if(t){let F=pt(t),$=c?U.id:t1(U).id;if(F&&y[$]&&pt(y[$].scheduleDate)===F)return!1}let{isComplete:T,isScheduled:D}=U,P=!i||!T,C=!e||!D,R=d||u?f==null?void 0:f.find(({eventId:F})=>F===U.eventId):void 0,N=(R==null?void 0:R.startDate)??(o==null?void 0:o.startDate),A=(R==null?void 0:R.endDate)??(o==null?void 0:o.endDate),M=!u||!N||new Date(u)>=new Date(N),E=!u||!A||new Date(u)<=new Date(A),O=M&&E,k=!d||(R==null?void 0:R.validVenueIds.includes(d)),x=P&&C&&k&&O;return x||b.push(U),x}).sort(spe)||[];return{...J,rounds:S,excludedRounds:b}}function $I(t){var V;let{matchUp:e,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=t||{},{matchUpFormat:o}=t||{};if(!e)return{error:na};o=o||(e==null?void 0:e.matchUpFormat);let s=kn(o),l=!!(e!=null&&e.winningSide),u=(V=e.score)==null?void 0:V.sets,c=u==null?void 0:u.length,d=r&&r-1,p=!!(u!=null&&u.find((G,j)=>G.setNumber===r&&j===d)),m=(u==null?void 0:u.filter(G=>G==null?void 0:G.winningSide))||[],h=(m==null?void 0:m.length)||0,f=r&&(u==null?void 0:u.slice(r))||[],g=!!(c&&r&&(f!=null&&f.reduce((G,j)=>(!j||!j.side1Score&&!j.side2Score&&!j.side1TiebreakScore&&!j.side2TiebreakScore&&!j.side1PointScore&&!j.side2PointScore)&&G,!0))),v=r<=c&&u.find(G=>G.setNumber===r),y=v&&LI({setObject:v,matchUpScoringFormat:s}),{isCompletedSet:I,sideGameScores:b,sideTiebreakScores:S}=y||{},w=!!(v&&!I&&g||r&&r===c+1&&!l),U=[1,2].includes(i),T=U?i-1:0,D=v&&U&&(!n&&!a&&b[T]!==void 0&&b[T]||n&&S[T]!==void 0&&S[T]),P=!!D,C=m==null?void 0:m.map(G=>LI({setObject:G,matchUpScoringFormat:s}).isValidSetOutcome).reduce((G,j)=>G&&j,!0),R=m.reduce((G,j)=>{let{winningSide:z}=j,q=z-1;return G[q]++,G},[0,0]),N=e==null?void 0:e.winningSide,A=N&&N-1,M=1-A,E=R[A],O=R[M],k=Math.max(...R),x=wa(R)[k],{bestOf:F,exactly:$}=s??{},_=F&&Math.ceil(F/2)||$||1,L=k===_&&x===1&&R.indexOf(k)+1||void 0,B=E>O&&N===L;return{completedSetsHaveValidOutcomes:C,validMatchUpWinningSide:B,calculatedWinningSide:L,matchUpScoringFormat:s,validMatchUpOutcome:L&&C&&B,isLastSetWithValues:g,completedSetsCount:h,isCompletedMatchUp:l,isValidSideNumber:U,hasExistingValue:P,existingValue:D,isExistingSet:p,isActiveSet:w,...y}}function bk({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,tournamentId:v,inContext:y,context:I,event:b}){let{eventId:S,eventName:w,endDate:U,eventType:T,category:D,gender:P}=b??{},C={...I,...Ge({surfaceCategory:(b==null?void 0:b.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(b==null?void 0:b.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:U??(b==null?void 0:b.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:w,eventType:T,category:D,eventId:S,gender:P})},R;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:R}=Xm({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:h,inContext:y})),b&&h&&!c&&(c=zu({policyDefinitions:a,tournamentRecord:s,contextProfile:h,drawDefinition:f,event:b})),{..._g({context:C,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,inContext:y,event:b}),groupInfo:R}}var Z6={};yt(Z6,{getCompetitionVenues:()=>Db,getCourts:()=>wk,getVenuesAndCourts:()=>qu,publicFindVenue:()=>LA});function wk({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=Me(r.courts||[]);return a.forEach(o=>Object.assign(o,{venueId:n})),a}).flat()}:{error:ge}}var Q6={};yt(Q6,{categoryCanContain:()=>Ay,getCategoryAgeDetails:()=>fm,getEvent:()=>Tk,getEventProperties:()=>Uk,getEventStructures:()=>BT,getEventTimeItem:()=>Hy,getEvents:()=>Sk,getFlightProfile:()=>Gi,getScaledEntries:()=>ch});function Uk({tournamentRecord:t,event:e}){var d,p;if(!t)return{error:ge};if(!e)return{error:gi};let i=e.entries||[],r=t.participants||[],n=((d=e.category)==null?void 0:d.categoryName)||((p=e.category)==null?void 0:p.ageCategoryCode),{eventType:a}=e,o=i.map(m=>m.participantId),s=r.filter(m=>o.includes(m.participantId)),l,u,c;return{entryScaleAttributes:s.map(m=>{var S,w,U,T,D,P;let{participantId:h,participantName:f,name:g}=m,v={scaleType:FA,eventType:a,scaleName:n},y=(w=(S=Cl({participant:m,scaleAttributes:v}))==null?void 0:S.scaleItem)==null?void 0:w.scaleValue;v={scaleType:OW,eventType:a,scaleName:n};let I=(T=(U=Cl({participant:m,scaleAttributes:v}))==null?void 0:U.scaleItem)==null?void 0:T.scaleValue;v={scaleType:AW,eventType:a,scaleName:n};let b=(P=(D=Cl({participant:m,scaleAttributes:v}))==null?void 0:D.scaleItem)==null?void 0:P.scaleValue;return l=!!(l||y),u=!!(u||I),c=!!(c||b),{participantId:h,participantName:f||g,seed:y,ranking:I,rating:b}}),hasSeededParticipants:l,hasRankedParticipants:u,hasRatedParticipants:c}}function Sk({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:o}){var c,d,p,m;if(!t)return{error:ge};let{tournamentId:s}=t,l=(t.events??[]).filter(({eventId:h})=>!n||Array.isArray(n)&&n.includes(h)).map(h=>{var v;let f=(v=h.drawDefinitions)==null?void 0:v.map(MI);if(a!=null&&a.length&&!Vi(a,f).length)return;let g=Me(h);return r&&Object.assign(g,{tournamentId:s}),o&&Object.assign(g,o),g}).filter(Boolean),u={};if(e){let h=Mi({withScaleValues:!0,tournamentRecord:t}).participantMap,f=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of l){let v=i??g.eventType,y=g.eventId;u[y]||(u[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let I=(g.entries??[]).filter(({entryStatus:P})=>ss.includes(P)).map(Ut),b=P=>{var C,R,N,A,M,E;if((C=P==null?void 0:P.ratings)!=null&&C[v])for(let O of((R=P==null?void 0:P.ratings)==null?void 0:R[v])??[]){let k=O.scaleName;u[y].ratings[k]||(u[y].ratings[k]=[]);let x=(N=Mr[k])==null?void 0:N.accessor;if(x){let F=parseFloat((A=O.scaleValue)==null?void 0:A[x]);F&&u[y].ratings[k].push(F)}}if((M=P==null?void 0:P.rankings)!=null&&M[v])for(let O of((E=P==null?void 0:P.rankings)==null?void 0:E[v])??[]){let k=O.scaleName;u[y].ranking[k]||(u[y].ranking[k]=[]),O.scaleValue&&u[y].ranking[k].push(O.scaleValue)}};for(let P of I){let C=(c=h==null?void 0:h[P])==null?void 0:c.participant;if((C==null?void 0:C.participantType)!==St)for(let R of(C==null?void 0:C.individualParticipantIds)??[]){let N=(d=h==null?void 0:h[R])==null?void 0:d.participant;b(N)}else b(C)}let S=u[y].ratings;for(let P of Object.keys(S)){let C=S[P];if(!C.length)continue;let R=(p=fB(C))==null?void 0:p.toFixed(2);u[y].ratingsStats[P]={avg:parseFloat((f(C)/C.length).toFixed(2)),median:R?parseFloat(R):void 0,max:Math.max(...C),min:Math.min(...C)}}let w=(P,C)=>{var N,A;let R=M=>{var E,O,k,x,F,$,_,L,B,V;if((E=u[y].draws)!=null&&E[P]&&((O=M==null?void 0:M.ratings)!=null&&O[v]))for(let G of((k=M==null?void 0:M.ratings)==null?void 0:k[v])??[]){let j=G.scaleName;(x=u[y].draws[P])!=null&&x.ratings[j]||(u[y].draws[P].ratings[j]=[]);let z=(F=Mr[j])==null?void 0:F.accessor;if(z){let q=parseFloat(($=G.scaleValue)==null?void 0:$[z]);q&&u[y].draws[P].ratings[j].push(q)}}if((_=u[y].draws)!=null&&_[P]&&((L=M==null?void 0:M.rankings)!=null&&L[v]))for(let G of((B=M==null?void 0:M.rankings)==null?void 0:B[v])??[]){let j=G.scaleName;(V=u[y].draws[P])!=null&&V.ranking[j]||(u[y].draws[P].ranking[j]=[]);let z=G.scaleValue;z&&u[y].draws[P].ranking[j].push(z)}};for(let M of C.filter(Boolean)){let E=(N=h==null?void 0:h[M])==null?void 0:N.participant;if((E==null?void 0:E.participantType)!==St)for(let O of(E==null?void 0:E.individualParticipantIds)??[]){let k=(A=h==null?void 0:h[O])==null?void 0:A.participant;R(k)}else R(E)}},U=[],T=P=>(a==null?void 0:a.length)&&a.includes(P)||U.includes(P);for(let P of g.drawDefinitions??[]){let C=P.drawId;if(T(C))continue;let R=gp({drawDefinition:P}).assignedParticipantIds??[];u[y].draws[C]||(u[y].draws[C]={ratingsStats:{},ratings:{},ranking:{}}),U.push(C),w(C,R)}let D=Gi({event:g}).flightProfile;for(let P of(D==null?void 0:D.flights)??[]){let C=P.drawId;if(T(C))continue;let R=P.drawEntries.map(Ut);w(C,R)}for(let P of U){let C=u[y].draws[P].ratings;for(let R of Object.keys(C)){let N=C[R];if(!N.length)continue;let A=(m=fB(N))==null?void 0:m.toFixed(2);u[y].draws[P].ratingsStats[R]={avg:parseFloat((f(N)/N.length).toFixed(2)),median:A?parseFloat(A):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return Ge({eventScaleValues:u,events:l,...J})}function Tk({tournamentRecord:t,drawDefinition:e,context:i,event:r}){var o;if(!t)return{error:ge};if(!r)return{error:gi};let n=Me(r);i&&Object.assign(n,i);let a=e&&((o=n.drawDefinitions)==null?void 0:o.find(({drawId:s})=>e.drawId===s));return Ge({drawDefinition:a,event:n})}function lpe(t){var m,h;let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=dpe(t),n=ppe({...t,policyDefinitions:r,appliedPolicies:i}),a=cpe(t),o=mpe({...t,consideredEntries:a,appliedPolicies:i});if(o!=null&&o.error)return ee({result:o,stack:e});let s=hpe({...t,consideredEntries:a}),l=upe({...t,appliedPolicies:i,policyDefinitions:r,drawSize:s});if(l.error)return ee({result:l,stack:e});let u=l.drawType;if(isNaN(s)&&u!==La)return ee({result:{error:Py},stack:e});let c=(r==null?void 0:r[ms])??(i==null?void 0:i[ms]),d=t.seedingProfile??((h=(m=c==null?void 0:c.seedingProfile)==null?void 0:m.drawTypes)==null?void 0:h[u??""])??(c==null?void 0:c.seedingProfile);t.seedingProfile&&(r[ms]||(r[ms]={...e1[ms]}),r[ms].seedingProfile=d);let p=fpe({...t,drawType:u});return p!=null&&p.error?ee({result:p,stack:e}):{drawSize:s,drawType:u,enforceGender:n,seedingProfile:d,appliedPolicies:i,policyDefinitions:r}}function upe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??Ub({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),o=C3({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return o.error?o:{drawType:o.drawType}}function e4(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...ss,Jy].includes(e.entryStatus))}function cpe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||e4(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Oe)}function dpe(t){let{tournamentRecord:e,event:i}=t,r=$t({tournamentRecord:e,event:i}).appliedPolicies??{},n=Me(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function ppe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var r,n,a,o;return t??((n=(r=e==null?void 0:e[Or])==null?void 0:r.participants)==null?void 0:n.enforceGender)??((o=(a=i==null?void 0:i[Or])==null?void 0:a.participants)==null?void 0:o.enforceGender)}function mpe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:o,event:s}=t;return s&&o&&JT({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:o,event:s})}function hpe(t){return!t.drawSize&&t.consideredEntries.length&&![La,ky,Ng,Xo,Bl].includes(t.drawType??"")&&Ug(t.consideredEntries.length)||t.drawSize&&Ze(t.drawSize)||!1}function fpe(t){var o,s;let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:r,drawType:n}=t,a=!r&&e&&oD({tournamentRecord:e,categoryType:(o=i==null?void 0:i.category)==null?void 0:o.categoryType,categoryName:(s=i==null?void 0:i.category)==null?void 0:s.categoryName});return a!=null&&a.length&&!a.includes(n)?{error:sN}:{...J}}function Mb(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:o}=Mi({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=e4(r==null?void 0:r.entries)??[],l=lpe({...t,participantMap:o,participants:a,eventEntries:s});if(l.error)return ee({result:l,stack:n});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:m,seedingProfile:h}=l,f=r==null?void 0:r.eventType,g=t.matchUpType??f,v=pde({...t,enforceGender:m,eventType:f,matchUpType:g});if(v.error)return ee({result:v,stack:n});let{matchUpFormat:y,tieFormat:I}=v;if(t.drawId&&typeof t.drawId!="string")return ee({result:{error:oe},stack:n});let b=Vde({...t,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:y,seedingProfile:h,participants:a,eventEntries:s,matchUpType:g,tieFormat:I,drawSize:d,drawType:p,event:r});if(b.error)return ee({result:b,stack:n});let{existingDrawDefinition:S,positioningReports:w,drawDefinition:U,structureId:T,conflicts:D,entries:P}=b;if(!U)return ee({result:{error:oe},stack:n});let C=jde({...t,existingDrawDefinition:S,positioningReports:w,appliedPolicies:u,drawDefinition:U,seedingProfile:h,participants:a,structureId:T,entries:P,params:t,stack:n});if(C.error)return C;let{qualifyingConflicts:R}=C;return U.drawName=t.drawName??(p&&Qr(p)),d&&typeof e=="object"&&d>=4&&YA({...e,drawDefinition:U,matchUpType:g}),{existingDrawDefinition:!!S,qualifyingConflicts:R,positioningReports:w,drawDefinition:U,structureId:T,...J,conflicts:D}}function t4({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Xe,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:s},l)=>({[s]:l+1})));n=n||t.scaleName;let o=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:a[s],eventType:t.eventType,scaleType:Pl,scaleName:n,scaleDate:o}],participantId:s}))}}function gpe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:o,event:s,stage:l,sortDescending:u,scaleSortMethod:c}){let d=vD({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:o,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:m,stageEntries:h}=d;if(!h||!m)return{error:oe};let f=ch({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=t4({scaleAttributes:r,scaledEntries:f,stageEntries:h,seedsCount:m,scaleName:n});return{scaleItemsWithParticipantIds:g}}var i4={};yt(i4,{addDrawEntries:()=>GA,addEventEntries:()=>Hs,addEventEntryPairs:()=>s4,destroyPairEntries:()=>nq,destroyPairEntry:()=>qA,getEntriesAndSeedsCount:()=>vD,getMaxEntryPosition:()=>uk,modifyEntriesStatus:()=>PS,modifyEventEntries:()=>l4,mutate:()=>r4,promoteAlternate:()=>a4,promoteAlternates:()=>Pk,query:()=>Y6,removeDrawEntries:()=>o4,removeEventEntries:()=>lb,setEntryPosition:()=>Dk,setEntryPositions:()=>n4});var r4={};yt(r4,{addDrawEntries:()=>GA,addEventEntries:()=>Hs,addEventEntryPairs:()=>s4,destroyPairEntries:()=>nq,destroyPairEntry:()=>qA,modifyEntriesStatus:()=>PS,modifyEventEntries:()=>l4,promoteAlternate:()=>a4,promoteAlternates:()=>Pk,removeDrawEntries:()=>o4,removeEventEntries:()=>lb,setEntryPosition:()=>Dk,setEntryPositions:()=>n4});function Dk({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let o="setEntryPositions";if(!t)return{error:ge};if(!i)return ee({result:{error:pr},stack:o});if(r!==void 0&&!Number.isSafeInteger(r))return{error:oe,entryPosition:r};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let s=l=>{l.entries.forEach(u=>{u.entryPosition===r&&u.participantId!==i&&(u.entryPosition+=.1)})};return n||(a!=null&&a.entries&&(s(a),a.entries=ys({entries:a.entries})),e!=null&&e.entries&&(s(e),e.entries=ys({entries:e.entries}))),{...J}}function n4({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:ge};if(!Array.isArray(e))return{error:oe};for(let n of e){let{participantId:a,entryPosition:o}=n,s=Dk({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:o,event:r});if(s.error)return s}return r!=null&&r.entries&&(r.entries=ys({entries:r.entries})),i!=null&&i.entries&&(i.entries=ys({entries:i.entries})),{...J}}function a4(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:oe,participantId:e}:Pk({...t,participantIds:[e].filter(Boolean)})}function Pk({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Oe,eventId:a,event:o}){if(!t)return{error:ge};if(!Array.isArray(i))return{error:oe,participantIds:i};if(!o)return{error:gi};let s="promoteAlternates";if(o){let l=nV({element:o,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=nV({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?ee({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...J},stack:s}):l}return{...J}}function nV({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===Vo),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),o=n.reduce((d,p)=>{let{entryPosition:m}=p;return isNaN(m)&&d||(!d||m<d.entryPosition)&&p||d},void 0),s=a.length?a:[o].filter(Boolean);if(!(s!=null&&s.length))return{error:ZG};let l=s.filter(({entryStatus:d})=>d!==Vo);if(l.length)return{error:IE,invalidEntryStatus:l};let u=s.filter(({entryStage:d})=>d&&d!==r);if(u.length)return{error:Cne,invalidStage:u};let c=e&&s.filter(d=>d.stageSequence!==e);if(c!=null&&c.length)return{error:Ene,invalidStageSequence:c};for(let d of s){d.entryStatus=oa;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(h=>{h.entryStatus===Vo&&h.entryPosition>p&&(h.entryPosition=h.entryPosition-1)});let m=Math.max(...i.entries.filter(h=>h.entryStatus===oa&&!isNaN(h.entryPosition)).map(({entryPosition:h})=>Ze(h||0)),0);d.entryPosition=m||0}return{...J}}function o4({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){var c;if(!a)return{error:gi};if(!r)return{error:ks};if(!(e!=null&&e.length))return{error:Vc};let o=gp({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(Rn(o,e))return{error:Rg};let s=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:l}=Gi({event:a}),u=(c=l==null?void 0:l.flights)==null?void 0:c.find(d=>d.drawId===r);return u!=null&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(s),t&&(u.drawEntries=ys({entries:u.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(s),t&&(i.entries=ys({entries:i.entries}))),{...J}}function nl(t){var f,g,v,y,I;let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:o}=t,s=t.tournamentId?(f=t.tournamentRecords)==null?void 0:f[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((g=t.tournamentRecords)==null?void 0:g[t.activeTournamentId]));if(!s)return{error:ge};if(!o)return ee({result:{error:jm},stack:e});o.participantId||(o.participantId=Gt()),s.participants||(s.participants=[]);let{participantId:l,individualParticipantIds:u}=o;if(s.participants.reduce((b,S)=>S.participantId===l||b,!1))return{error:qG};let{participantType:c,participantRole:d}=o;if(!c||!Object.keys(zv).includes(c))return{error:Ts,participantType:c};if(!d)return{error:WG};let p=s.participants||[],m=p.filter(b=>b.participantType===St).map(b=>b.participantId);if(c!==St&&o.person)return{error:oe,person:o.person};if(u&&!Array.isArray(u))return{error:oe,individualParticipantIds:u};if(c===ht){if(o.person)return{error:oe,person:o.person};if(o.individualParticipantIds){if(o.individualParticipantIds.length!==2&&!a)return ee({info:"PAIR must be 2 individualParticipantIds",result:{error:va},stack:e});{let w=p.filter(U=>U.participantType===St).map(U=>U.participantId);if(!Array.isArray(o.individualParticipantIds))return ee({result:{error:va},stack:e});if(!o.individualParticipantIds.reduce((U,T)=>w.includes(T)&&U,!0))return ee({result:{error:va},stack:e})}}else return ee({result:{error:Vc},stack:e});let b=p.filter(w=>w.participantType===ht).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),S=o.participantType===ht&&b.find(w=>Vi(w.individualParticipantIds,o.individualParticipantIds).length===2);if(S&&!i)return{...J,existingParticipant:!0,participant:r&&Me(S.participant)};if(!o.participantName){let w=p.filter(T=>{var D;return(D=o.individualParticipantIds)==null?void 0:D.includes(T.participantId)}),U=w.map(T=>{var D;return(D=T.person)==null?void 0:D.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(U+="/Unknown"),o.participantName=U}}else if(c===St){if(!((v=o.person)!=null&&v.standardFamilyName)||!((y=o.person)!=null&&y.standardGivenName))return{error:JG};if(!o.participantName){let b=`${o.person.standardFamilyName.toUpperCase()}, ${o.person.standardGivenName}`;o.participantName=b}}else if(c&&[Kt,Wa].includes(c)){if(u||(o.individualParticipantIds=[]),(I=o.individualParticipantIds)==null?void 0:I.length)for(let b of o.individualParticipantIds){if(typeof b!="string")return ee({result:{participantId:b,error:oe},stack:e});if(!m.includes(b))return ee({result:{participantId:b,error:zi},stack:e})}}else return{error:Ts};s.participants.push(o),n||lt({payload:{tournamentId:s.tournamentId,participants:[o]},topic:Tc});let h={participant:r&&Me(o),...J};return Ge(h)}function es({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:ge};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=Gt())});let a=r.filter(d=>!n.includes(d.participantId)),o=r.filter(d=>n.includes(d.participantId)),s=a.filter(d=>d.participantType===St),l=a.filter(d=>d.participantType!==St),u=s.concat(...l),c=[];if(u.length){for(let p of u){let m=nl({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(m.error)return m;m.success&&!m.existingParticipant&&c.push(m.participant)}c.length&&lt({topic:Tc,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&Me(c),addedCount:c.length,...J};return o.length&&Object.assign(d,{notAdded:o,info:W0}),Ge(d)}else return{info:"No new participants to add",addedCount:0,...J}}function s4(t){let e=ze(t,[{[br]:!0,[Gc]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=Vo,participantIdPairs:n=[],entryStage:a=Oe,tournamentRecord:o,drawDefinition:s,event:l,uuids:u}=t;if(l.eventType!==Qt)return{error:Ll};let c=[],d=new Map;for(let b of o.participants??[]){let{participantType:S,participantId:w,person:U,individualParticipantIds:T}=b;S===St&&(U!=null&&U.sex)?d.set(w,U.sex):S===ht&&T&&c.push(T)}let p=n.filter(b=>{if(b.length!==2)return!0;if(!l.gender||l.gender===Ds)return!1;if(!d.has(b[0])||!d.has(b[1]))return!0;let S=b.map(U=>d.get(U)),w=l.gender===Jt&&(S[0]!==Jt||S[1]!==Jt)||l.gender===pi&&(S[0]!==pi||S[1]!==pi);return l.gender===Bn&&(S.sort(FT),(S[0]!==pi||S[1]!==Jt)&&(w=!0)),w});if(p.length)return{error:va,invalidParticipantIdPairs:p};let m=n.map(b=>({participantId:(u==null?void 0:u.pop())??Gt(),participantRole:Zr,individualParticipantIds:b,participantType:ht})),h=i?m:m.filter(b=>!c.find(S=>Vi(S,b.individualParticipantIds).length===2)),f,g=[];if(h){let b=es({allowDuplicateParticipantIdPairs:i,participants:h,returnParticipants:!0,tournamentRecord:o});if(b.error)return b;g=b.participants||[],f=b.info}let v=n.map(b=>{let S=g.find(U=>Vi(U.individualParticipantIds,b).length===2);if(S)return S;let{participant:w}=Qo({tournamentRecord:o,participantIds:b});return w}).map(b=>b.participantId),y=Hs({participantIds:v,tournamentRecord:o,drawDefinition:s,entryStatus:r,entryStage:a,event:l});h.length&&lt({payload:{participants:h},topic:Tc});let I=h.map(Ut);return{...y,info:f,newParticipantIds:I}}function l4({entryStatus:t=oa,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Oe,tournamentRecord:n,event:a}){if(!n)return{error:ge};if(!a)return{error:gi};let o=n.participants??[],s=o.filter(f=>f.participantType===St).map(f=>f.participantId),l=e.concat(...i).flat(1/0).filter(f=>!s.includes(f));if(l.length)return{error:va,invalidParticipantIds:l};let u=i.filter(f=>f.length!==2);if(u.length)return{error:va,invalidParticipantIdPairs:u};let c=o.filter(f=>f.participantType===ht).map(f=>f.individualParticipantIds),d=i.filter(f=>!c.find(g=>Vi(g,f).length===2)).map(f=>({participantType:ht,participantRole:Zr,individualParticipantIds:f})),p=es({participants:d,tournamentRecord:n});if(p.error)return p;let m=i.map(f=>{let{participant:g}=Qo({tournamentRecord:n,participantIds:f});return g}).map(f=>({participantId:f,entryStatus:t,entryStage:r})),h=e.map(f=>({entryStatus:bo,participantId:f,entryStage:r}));return a.entries=(a.entries??[]).filter(f=>f.entryStage===r),a.entries=a.entries.concat(...m,...h),{...J}}var u4={};yt(u4,{addDrawDefinition:()=>Nb,addEvent:()=>qg,addFlight:()=>DD,assignSeedPositions:()=>w4,attachFlightProfile:()=>Ok,categoryCanContain:()=>Ay,deleteDrawDefinitions:()=>UD,deleteEvents:()=>S4,deleteFlightAndFlightDraw:()=>y4,deleteFlightProfileAndFlightDraws:()=>h4,generate:()=>c4,generateEventsFromTieFormat:()=>d4,getCategoryAgeDetails:()=>fm,getEvent:()=>Tk,getEventProperties:()=>Uk,getEventStructures:()=>BT,getEventTimeItem:()=>Hy,getEvents:()=>Sk,getFlightProfile:()=>Gi,getScaledEntries:()=>ch,modifyEvent:()=>T4,modifyEventMatchUpFormatTiming:()=>f4,modifyPairAssignment:()=>b4,mutate:()=>p4,query:()=>Q6,refreshEventDrawOrder:()=>Ak,removeEventMatchUpFormatTiming:()=>SD,removeScaleValues:()=>kk,removeSeeding:()=>U4,setEventDates:()=>Mk,setEventDisplay:()=>TD,setEventEndDate:()=>Ek,setEventStartDate:()=>Ck,updateDrawIdsOrder:()=>Nk,validateCategory:()=>SI});var c4={};yt(c4,{generateEventsFromTieFormat:()=>d4});function vpe({tournamentId:t,event:e}){return e?(lt({payload:{tournamentId:t,event:e},key:e.eventId,topic:rW}),{...J}):{error:gi}}var Ipe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},ype={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},bpe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},wpe={COLLEGE_D3:Ipe,COLLEGE_DEFAULT:ype,COLLEGE_JUCO:bpe,DOMINANT_DUO:JH,DOMINANT_DUO_MIXED:qH,LAVER_CUP:iz,TEAM_DOUBLES_3_AGGREGATION:jH,TIME_TENNIS_DUAL:YH,TIME_TENNIS_PRO_CIRCUIT:WH,USTA_BREWER_CUP:KH,USTA_OZAKI_CUP:XH,USTA_COLLEGE:ZH,USTA_GOLD_TEAM_CHALLENGE:VH,USTA_INTERSECTIONAL:zH,USTA_LEVEL_1:QH,USTA_SECTION_BATTLE:HH,USTA_SOUTHERN_LEVEL_5:GH,USTA_TOC:rz,USTA_WTT_ITT:ez,USTA_ZONAL:tz};function qg({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){var s,l,u,c;if(!e)return{error:ge};if(e.events||(e.events=[]),!r)return{error:gi};let{startDate:n,endDate:a}=e;if(!i&&((s=r.entries)!=null&&s.length||(l=r.drawDefinitions)!=null&&l.length)){let d=Ge({drawDefinitions:!!((u=r.drawDefinitions)!=null&&u.length),entries:!!((c=r.entries)!=null&&c.length)});return{info:"entries/drawDefinitions cannot exist",error:oe,context:d}}let o={eventType:gm,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===Sa){if(r.tieFormat){let d=Hn({tieFormat:r.tieFormat});if(d.error)return d}else if(r.tieFormatName){if(!wpe[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:oe};let d=Iu({isMock:e==null?void 0:e.isMock,namedFormat:r.tieFormatName,event:r});o.tieFormat=d}}if(o.eventId||(o.eventId=Gt()),e.events.reduce((d,p)=>d||p.eventId===o.eventId,void 0))return{error:CG};{let d=o;if(e.events.push(d),!t){let{topics:p}=vo();if(p.includes(UT)){let f=Zl({event:r}).matchUps??[];Dc({tournamentId:e==null?void 0:e.tournamentId,eventId:r.eventId,matchUps:f})}let{drawDefinitions:m,...h}=r;for(let f of m||[])jy({drawDefinition:f});vpe({tournamentId:e==null?void 0:e.tournamentId,event:h})}return{...J,event:o}}}function d4(t){var o,s,l,u;let e=ze(t,[{[Af]:{[dT]:!0,[Mz]:!0}},{[br]:!0}]);if(e.error)return e;let i=t.tieFormat||Iu({namedFormat:t.tieFormatName}),r=t.uuids||[BH(i.collectionDefinitions.length)],n={[Jt]:[],[pi]:[]};if(t.addEntriesFromTeams){let c=(s=(o=t.tournamentRecord.participants)==null?void 0:o.filter(d=>d.participantType===Vn))==null?void 0:s.flatMap(d=>d.individualParticipantIds??[]);for(let d of t.tournamentRecord.participants??[])if(c!=null&&c.includes(d.participantId)){let p=(l=d.person)==null?void 0:l.sex;p&&[Jt,pi].includes(p)&&n[p].push(d.participantId)}}let a=[];for(let c of i.collectionDefinitions??[]){let d=((u=r==null?void 0:r.pop())==null?void 0:u.toString())||Gt(),p=c.matchUpType,m=c.gender,h={matchUpFormat:c.matchUpFormat,eventName:c.collectionName,category:c.category,gender:m,eventType:p,eventId:d};if(t.addEntriesFromTeams){let f=p===yu?bo:t.entryStatus||oa,g=m===Bn?[...n[Jt],...n[pi]]:n[m]??[];if(g.length){let v=Hs({participantIds:g,entryStatus:f,event:h});if(v.error)return v}}if(a.push(h),t.addEvents!==!1){let f=qg({internalUse:!0,tournamentRecord:t.tournamentRecord,event:h});if(f.error)return f}}return{...J,events:a}}var p4={};yt(p4,{addDrawDefinition:()=>Nb,addEvent:()=>qg,addFlight:()=>DD,assignSeedPositions:()=>w4,attachFlightProfile:()=>Ok,deleteDrawDefinitions:()=>UD,deleteEvents:()=>S4,deleteFlightAndFlightDraw:()=>y4,deleteFlightProfileAndFlightDraws:()=>h4,modifyEvent:()=>T4,modifyEventMatchUpFormatTiming:()=>f4,modifyPairAssignment:()=>b4,refreshEventDrawOrder:()=>Ak,removeEventMatchUpFormatTiming:()=>SD,removeScaleValues:()=>kk,removeSeeding:()=>U4,setEventDates:()=>Mk,setEventDisplay:()=>TD,setEventEndDate:()=>Ek,setEventStartDate:()=>Ck,updateDrawIdsOrder:()=>Nk,validateCategory:()=>SI});function Yg({removePriorValues:t=!0,status:e=qa,statusObject:i,event:r}){if(!Nt(i))return{error:oe};let n=Uo({event:r,status:e}),a=`${Yc}.${Kc}`,o={itemValue:{[e]:{...n,...i}},itemType:a};return uh({timeItem:o,removePriorValues:t,event:r})}function Kg(t){var S,w,U,T,D,P,C;let e=ze(t,[{[br]:!0,[Gc]:!0},{eventDataParams:!1,[Xn]:ea}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=qa,event:o,drawIdsToRemove:s,drawIdsToAdd:l}=t,{appliedPolicies:u}=$t({tournamentRecord:n,event:o}),c={...u,...t.policyDefinitions},d=((S=o==null?void 0:o.drawDefinitions)==null?void 0:S.map(({drawId:R})=>R))??[],p=t.drawDetails?Object.keys(t.drawDetails):[],m=p.length?[]:t.drawIds,h=(l??[]).concat(...s??[],...m??[],...p),f=h.filter(R=>!d.includes(R));if(f.length)return ee({result:{error:xa},context:{invalidDrawIds:f}});let g=Uo({event:o,status:a}),v=Object.keys((g==null?void 0:g.drawDetails)||{}).filter(R=>d.includes(R)).reduce((R,N)=>(R[N]=g.drawDetails[N],R),{});for(let R of d)if((!h.length||h.includes(R))&&(s!=null&&s.includes(R)||m!=null&&m.length&&!m.includes(R)?v[R]={...v[R],publishingDetail:{published:!1}}:(l!=null&&l.includes(R)||m!=null&&m.includes(R)||!(m!=null&&m.length))&&(v[R]={...v[R],publishingDetail:{published:!0}})),(w=t.drawDetails)==null?void 0:w[R]){let N=t.drawDetails[R],A=N.structureDetails??v[R].structureDetails,M=N.stageDetails??v[R].stageDetails??{},{structureIdsToRemove:E=[],structureIdsToAdd:O=[],publishingDetail:k={},stagesToRemove:x=[],stagesToAdd:F=[]}=N;if((O||F)&&(k.published=!0),v[R]={publishingDetail:k,structureDetails:A,stageDetails:M},O.length||E.length){let _=(((T=(U=o==null?void 0:o.drawDefinitions)==null?void 0:U.find(B=>B.drawId===R))==null?void 0:T.structures)??[]).map(({structureId:B})=>B),L=(O??[]).concat(E??[]).filter(B=>!_.includes(B));if(L.length)return ee({result:{error:Ei},context:{invalidStructureIds:L}});A=A??{};for(let B of _)E.includes(B)?A[B]={published:!1}:A[B]={published:!0};v[R].structureDetails=A}let $=(((P=(D=o==null?void 0:o.drawDefinitions)==null?void 0:D.find(_=>_.drawId===R))==null?void 0:P.structures)??[]).map(({stage:_})=>_);if(F.length){for(let _ of F)M[_]={published:!0};for(let _ of $)M[_]||(M[_]={published:!1})}if(F.length||x.length){for(let _ of x)M[_]={published:!1};for(let _ of $)M[_]||(M[_]={published:!0})}(F.length||x.length)&&(v[R].stageDetails=M)}Yg({statusObject:{drawDetails:v},removePriorValues:r,status:a,event:o});let{topics:y}=vo(),I=y.includes(EE),b=I||t.returnEventData?(C=dD({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:c,event:o}))==null?void 0:C.eventData:void 0;return I&&lt({payload:{eventData:b,tournamentId:n.tournamentId},topic:EE}),{...J,eventData:b}}var m4="deleteDrawDefinitions",i1="autoSchedulingAudit",_U="deleteEvents",Upe={AUTO_SCHEDULING_AUDIT:i1,DELETE_EVENTS:_U,DELETE_DRAW_DEFINITIONS:m4};function UD(t){var T,D,P,C,R;if(!t.tournamentRecord)return{error:ge};let e="deleteDrawDefinitions",i=t.drawIds??[],r=t.event,{autoPublish:n=!0,tournamentRecord:a,auditData:o,eventId:s,force:l}=t,{appliedPolicies:u}=$t({tournamentRecord:a,event:r}),c={...u,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!r){let N=Wn({tournamentRecord:a,eventId:s,drawId:d});if(N.error)return N;r=N.event}let p=[],m=[],h=[];if(!(r!=null&&r.drawDefinitions))return ee({info:"event has no drawDefinition",result:{...J},stack:e});let f=r.drawDefinitions.map(({drawId:N})=>N);if(i.length||(i=f),i=i.filter(N=>f.includes(N)),!i.length)return ee({info:"nothing to do; no matching drawIds in event.",result:{...J},stack:e});let g=Me(Gi({event:r}).flightProfile,!1,!0),v=({participantId:N,drawPosition:A,qualifier:M,bye:E})=>({bye:E,qualifier:M,drawPosition:A,participantId:N}),y=l??((D=(T=u==null?void 0:u[Ps])==null?void 0:T.allowDeletionWithScoresPresent)==null?void 0:D.drawDefinitions),I=Uo({event:r})??{},b=I.drawIds??(I.drawDetails&&Object.keys(I.drawDetails))??[],S,w=[],U=r.drawDefinitions.filter(N=>{var A,M,E,O,k,x,F,$;if(i.includes(N.drawId)){let _=((A=Sn({event:r,drawDefinition:N}))==null?void 0:A.matchUps)??[];if(_.some(({score:re})=>vr({score:re}))&&!y)return w.push(N.drawId),!0;let{drawId:L,drawType:B,drawName:V}=N,G=(M=g==null?void 0:g.flights)==null?void 0:M.find(re=>re.drawId===N.drawId);G&&(G.drawEntries=(E=G.drawEntries)==null?void 0:E.filter(re=>ss.includes(re.entryStatus))),b.includes(L)&&(b=b.filter(re=>re!==L),S=!0);let j=(k=(O=Zo({stageSequence:1,drawDefinition:N,stage:Oe}))==null?void 0:O.structures)==null?void 0:k[0],z=(F=(x=j?xI({structureId:j.structureId,tournamentRecord:a,drawDefinition:N}):void 0)==null?void 0:x.positionAssignments)==null?void 0:F.map(v),q=($=Zo({stage:Ye,drawDefinition:N}))==null?void 0:$.structures,W=q!=null&&q.length?q.map(re=>{var H;let K=re.stageSequence;return{positionAssignments:(H=xI({structureId:re.structureId,tournamentRecord:a,drawDefinition:N}))==null?void 0:H.positionAssignments.map(v),stageSequence:K}}):void 0,Y={action:m4,payload:{drawDefinitions:[N],eventId:s??(r==null?void 0:r.eventId),auditData:o}};h.push(Y),p.push(Ge({tournamentId:a.tournamentId,eventId:s??(r==null?void 0:r.eventId),qualifyingPositionAssignments:W,positionAssignments:z,auditData:o,drawType:B,drawName:V,drawId:L})),_==null||_.forEach(({matchUpId:re})=>m.push(re))}return!i.includes(N.drawId)});if(w.length&&!l)return ee({context:{drawIdsWithScoresPresent:w},result:{error:Z0},stack:e});if(r.drawDefinitions=U,g&&zc({event:r,extension:{name:Jo,value:g}}),Rb({tournamentRecord:a}),S){let N={};for(let M of b)N[M]=((P=I.drawDetails)==null?void 0:P[M])??{published:!0};let A=Yg({statusObject:{drawDetails:N},event:r});if(A.error)return{error:A.error}}if(h.length)if(Q0(mu)){let N=a.tournamentId;lt({topic:mu,payload:{tournamentId:N,detail:h}});let A=(((R=(C=yo({element:r,itemType:Dd}))==null?void 0:C.timeItem)==null?void 0:R.itemValue)||0)+1;gl({element:r,timeItem:{itemType:Dd,itemValue:A},removePriorValues:!0})}else Spe({appliedPolicies:u,event:r,deletedDrawsDetail:p,auditData:o});if(m.length&&Gu({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:m}),i.forEach(N=>woe({drawId:N})),n&&S){let N=Kg({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:c,tournamentRecord:a,event:r});if(N.error)return{...J,info:N.error}}return{...J}}function Spe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){var s;if(((s=t==null?void 0:t.audit)==null?void 0:s[Dd])===!1)return;let{extension:n}=gt({name:Dd,element:e}),a={...r,deletedDrawsDetail:i},o={value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(a):[a],name:Dd};Lt({element:e,extension:o})}function h4({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){var o;if(!e)return{error:ge};if(!r)return{error:gi};let{flightProfile:a}=Gi({event:r});if(a){let s=(o=a.flights)==null?void 0:o.map(({drawId:u})=>u).filter(Boolean),l=UD({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return l.error?l:vT({event:r,name:Jo})}return{...J}}function Rk(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,o=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(o).length)return{error:Oi};let s=Object.keys(o).filter(u=>!n||n===u);if(n&&!s.includes(n))return{error:oe};let l;for(let u of s){let c=o[u],{event:d}=Wn({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=Tpe({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...J}:{error:lo}}function Tpe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:ge};if(r&&!Array.isArray(r))return{error:oe};if(e&&!Array.isArray(e))return{error:oe};let a=Su;if(n){let{extension:o}=gt({element:n,name:a}),s=(o==null?void 0:o.value)||{},l=aV({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});Lt({element:n,extension:{name:a,value:l}})}else{let{extension:o}=gt({element:t,name:a}),s=(o==null?void 0:o.value)||{},l=aV({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});Lt({extension:{name:a,value:l},element:t})}return{...J}}function aV(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let o=(n==null?void 0:n.length)&&i.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==r)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let s=(a==null?void 0:a.length)&&e.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==r)}:l}).filter(({matchUpFormatCodes:l,averageTimes:u})=>(l==null?void 0:l.length)||u).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:(o==null?void 0:o.length)&&o||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function f4(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:o,event:s}=t;if(!e)return{error:ge};if(!Ua({matchUpFormat:n}))return{error:oe};if(!s)return{error:gi};let{averageTimes:l=[],recoveryTimes:u=[]}=ID({tournamentRecord:e,matchUpFormat:n,event:s}),c=s.category,d=(c==null?void 0:c.categoryName)||(c==null?void 0:c.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},m={categoryNames:[d],minutes:{}},h=I=>{var b,S;if((b=I.categoryTypes)!=null&&b.includes(a)&&console.log("encountered:",{categoryType:a}),!((S=I.categoryNames)!=null&&S.includes(d)&&(I.categoryNames=I.categoryNames.filter(w=>w!==d),p={minutes:I.minutes,categoryNames:[d]},!I.categoryNames.length)))return I},f=r&&!isNaN(Ze(r)),g=i&&!isNaN(Ze(i)),v=l.map(h).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length}),y=u.map(h).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length});return f&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||ti]:r}),v.push(p)),g&&(Object.assign(m.minutes,{[(s==null?void 0:s.eventType)||ti]:i}),y.push(m)),!f&&!g?{error:oe}:Rk({averageTimes:f&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:n,eventId:o,event:s})}function SD(t){if(t.event)return oV({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=ze(t,[{[pn]:!0,[xz]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=Wn({tournamentRecord:n,eventId:r});if(a)return oV({event:a})}}return{error:lo}}function oV({event:t}){return vT({event:t,name:Su})}var Dpe="MON",Ppe="TUE",Rpe="WED",Cpe="THU",Epe="FRI",Mpe="SAT",Npe="SUN",g4={MON:Dpe,TUE:Ppe,WED:Rpe,THU:Cpe,FRI:Epe,SAT:Mpe,SUN:Npe};function v4(t){return!Array.isArray(t)||ct(t).length!==t.length?!1:t.every(e=>Object.keys(g4).includes(e))}function Ck({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:ge};if(!e)return{error:gi};if(!Zs.test(i))return{error:Nr};let r=I4(t);if(r.error)return r;let{tournamentStartDate:n,tournamentEndDate:a}=r,o=new Date(pt(i)).getTime();if(!n||!a||o<n||o>a)return{error:Nr};let s=e.endDate&&new Date(pt(e.endDate)).getTime();return s&&o>s&&(e.endDate=i),e.startDate=i,{...J}}function Ek(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:ge};if(!i)return{error:gi};if(!Zs.test(r))return{error:Nr};let n=I4(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:o}=n,s=new Date(pt(r)).getTime();if(!a||!o||s<a||s>o)return{error:Nr};let l=i.startDate&&new Date(pt(i.startDate)).getTime();return l&&s<l&&(i.startDate=r),i.endDate=r,{...J}}function Mk(t){var l;let e=ze(t,[{tournamentRecord:!0,event:!0},{[Kr]:u=>Zs.test(u),[_a]:Nr,startDate:!1,endDate:!1},{[Kr]:u=>u.filter(Boolean).every(c=>Zs.test(c)),[_a]:Nr,activeDates:!1},{[Kr]:v4,weekdays:!1}]);if(e.error)return e;let{tournamentRecord:i,weekdays:r,event:n,startDate:a,endDate:o}=t,s=(l=t.activeDates)==null?void 0:l.filter(Boolean);if(a&&o){let u=new Date(pt(a)).getTime(),c=new Date(pt(o)).getTime();if(u>c)return{error:oe}}if(s){let u=a||i.startDate,c=o||i.endDate,d=!u||s.every(m=>new Date(m)>=new Date(u)),p=!c||s.every(m=>new Date(m)<=new Date(c));if(!d||!p)return{error:Nr}}if(a){let u=Ck({tournamentRecord:i,event:n,startDate:a});if(u.error)return u}if(o){let u=Ek({tournamentRecord:i,event:n,endDate:o});if(u.error)return u}return s&&(n.activeDates=s),r&&(n.weekdays=r),{...J}}function I4(t){let{startDate:e,endDate:i}=t;return!Zs.test(e)||!Zs.test(i)?ee({result:{error:jG},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(pt(e)).getTime(),tournamentEndDate:new Date(pt(i)).getTime()}}function Nk({event:t,orderedDrawIdsMap:e}){var n,a;if(typeof t!="object")return{error:gi};if(!e)return{error:Xe,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:oe,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(o=>!isNaN(o)))return{error:oe,info:"drawOrder must be numeric"};if(ct(i).length!==i.length)return{error:oe,info:"drawOrder values must be unique"};if((n=t.drawDefinitions)!=null&&n.length){let o=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&Vi(o,s).length!==o.length)return{error:oe,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:r}=Gi({event:t});return(a=r==null?void 0:r.flights)==null||a.forEach(o=>{o.flightNumber=e[o.drawId]}),{...J}}function Ak({tournamentRecord:t,event:e}){var n;if(!t)return{error:ge};if(!e)return{error:gi};let{flightProfile:i}=Gi({event:e}),r=(i==null?void 0:i.flights)&&Object.assign({},...i.flights.sort((a,o)=>a.flightNumber-o.flightNumber).map((a,o)=>({[a.drawId]:o+1})))||((n=e.drawDefinitions)==null?void 0:n.length)&&Object.assign({},...e.drawDefinitions.sort((a,o)=>a.drawOrder-o.drawOrder).map((a,o)=>({[a.drawId]:o+1})))||void 0;return r?Nk({event:e,orderedDrawIdsMap:r}):{...J}}function y4({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){var s,l;if(!e)return{error:ge};if(!r)return{error:ks};if(!n)return{error:gi};let{flightProfile:o}=Gi({event:n});if(o&&((s=o.flights)!=null&&s.find(u=>u.drawId===r))){let u=o.flights.filter(d=>d.drawId!==r),c={name:Jo,value:{...o,flights:u}};zc({event:n,extension:c})}if((l=n.drawDefinitions)!=null&&l.find(u=>u.drawId===r)){let u=UD({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(u.error)return u}return Ak({tournamentRecord:e,event:n})}function b4(t){var g,v;let e=ze(t,[{[Gc]:!0,[br]:!0,[QN]:!1},{replacementIndividualParticipantId:!0,[Kr]:y=>Ti(y),existingIndividualParticipantId:!0,[Bo]:pr,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:r,tournamentRecord:n,drawDefinition:a,participantId:o,event:s,uuids:l}=t;if(e.error)return e;if((s==null?void 0:s.eventType)!==uo)return{error:Ll};if(!(((g=s==null?void 0:s.entries)==null?void 0:g.filter(({entryStatus:y})=>[bo,mp].includes(y)).map(({participantId:y})=>y))||[]).includes(i))return{error:Ss};let u=(n.participants||[]).find(y=>y.participantId===o);if((u==null?void 0:u.participantType)!==ht)return{error:Vm,participant:u};let c=u.individualParticipantIds,d=[i,...c.filter(y=>y!==r)],{participant:p}=Qo({participantIds:d,tournamentRecord:n}),m;if(p)m=p.participantId;else{let y={participantId:l==null?void 0:l.pop(),participantRole:Zr,individualParticipantIds:d,participantType:ht},I=nl({participant:y,returnParticipant:!0,tournamentRecord:n});if(I.error)return I;m=I.participant.participantId}let{flightProfile:h}=Gi({event:s});if(a){let y=(v=h==null?void 0:h.flights)==null?void 0:v.find(({drawId:I})=>I===a.drawId);y&&(y.drawEntries=y.drawEntries.map(I=>I.participantId===o?{...I,participantId:m}:I)),a.entries=a.entries.map(I=>I.participantId===o?{...I,participantId:m}:I);for(let I of a.structures||[])if(I.structures){I.positionAssignments=void 0;for(let b of I.structures)b.positionAssignments=b.positionAssignments.map(S=>S.participantId===o?{...S,participantId:m}:S)}else I.positionAssignments&&(I.positionAssignments=I.positionAssignments.map(b=>b.participantId===o?{...b,participantId:m}:b))}s.entries=s.entries.map(y=>y.participantId===o&&{...y,participantId:m}||y.participantId===i&&{...y,participantId:r}||y);let f=n.events.some(({entries:y,eventId:I,drawDefinitions:b})=>s.eventId===I?b.some(({drawId:S,entries:w})=>S===(a==null?void 0:a.drawId)?!1:w==null?void 0:w.find(U=>U.participantId===o)):y==null?void 0:y.find(S=>S.participantId===o));if(!f){let y=oh({addIndividualParticipantsToEvents:!1,participantIds:[o],tournamentRecord:n});if(y.error)return y}return{...J,participantOtherEntries:f,newPairParticipantId:m}}function Nb(t){var R,N,A,M,E,O,k,x,F,$,_,L;let{flight:e,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:o,tournamentRecord:s,drawDefinition:l,event:u}=t;if(!l)return{error:_e};if(!u)return{error:gi};u.drawDefinitions||(u.drawDefinitions=[]);let{drawId:c,drawName:d,entries:p}=l,{entries:m}=u,h=0;if(n!==void 0&&n!==u.drawDefinitions.length)return{error:oe,info:"drawDefintions count mismatch"};let{flightProfile:f}=Gi({event:u}),g=e&&((R=f==null?void 0:f.flights)==null?void 0:R.find(B=>B.flightNumber===e.flightNumber)),v=(M=(A=(N=f==null?void 0:f.links)==null?void 0:N.find(B=>{var V;return((V=B==null?void 0:B.target)==null?void 0:V.drawId)===c}))==null?void 0:A.source)==null?void 0:M.drawId;if(v&&!u.drawDefinitions.find(B=>B.drawId===v))return ee({result:{error:_e},info:{sourceDrawId:v}});if(g&&g.drawId!==l.drawId)return ee({result:{error:Wp},info:{relevantFlight:g}});let y=p==null?void 0:p.every(({participantId:B,entryStatus:V})=>{let G=g==null?void 0:g.drawEntries.find(j=>j.participantId===B);return!V||(G==null?void 0:G.entryStatus)===V}),I=!o||m&&(p==null?void 0:p.every(({participantId:B,entryStatus:V,entryStage:G})=>{var j;return((j=m.find(z=>z.participantId===B&&(!z.entryStage||z.entryStage===G)))==null?void 0:j.entryStatus)===V}));if(g&&!y)return ee({result:{error:Wp},context:{drawEntriesPresentInFlight:y,matchingEventEntries:I,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&(p==null||p.filter(Boolean).forEach(B=>{if(B!=null&&B.entryStatus&&ss.includes(B==null?void 0:B.entryStatus)){let V=m==null?void 0:m.filter(Boolean).find(G=>G.participantId===B.participantId);V&&B.entryStatus&&(V==null?void 0:V.entryStatus)!==B.entryStatus&&(V.entryStatus=B.entryStatus,h+=1)}})),m&&!I)return ee({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:I,eventEntries:m},error:Wp}});let b=((O=(E=f==null?void 0:f.flights)==null?void 0:E.map(({flightNumber:B})=>!isNaN(B)&&Ze(B)))==null?void 0:O.filter(Boolean))||[],S=((k=u.drawDefinitions.map(({drawOrder:B})=>B&&Ze(B)))==null?void 0:k.filter(Boolean))||[],w=Math.max(0,...S,...b)+1,U=(x=f==null?void 0:f.flights)==null?void 0:x.find(B=>B.drawId===c),T;if(U){U.drawName=l.drawName,T={name:Jo,value:{...f,flights:f.flights}};let B=U.flightNumber;B&&!S.includes(B)?w=B:U.flightNumber=w}else{let B=(f==null?void 0:f.flights)||[];B.push({manuallyAdded:!0,flightNumber:w,drawEntries:p,drawName:d,drawId:c}),T={name:Jo,value:{...f||{},flights:B}}}zc({event:u,extension:T}),Object.assign(l,{drawOrder:w});let D=u.drawDefinitions.find(B=>B.drawId===c),P=s==null?void 0:s.tournamentId,C=u.eventId;if(D){if(!a)return{error:IG};let B=(($=(F=Sn({drawDefinition:D}))==null?void 0:F.matchUps)==null?void 0:$.map(Tr))??[],V=(_=Sn({drawDefinition:l}))==null?void 0:_.matchUps;if(!i){B!=null&&B.length&&Gu({matchUpIds:B,action:"modifyDrawDefinition",tournamentId:P,eventId:C}),V!=null&&V.length&&Dc({matchUps:V,tournamentId:P,eventId:C}),u.drawDefinitions=u.drawDefinitions.map(j=>j.drawId===c?l:j);let G=(L=l.structures)==null?void 0:L.map(({structureId:j})=>j);si({drawDefinition:l,tournamentId:P,structureIds:G,eventId:C})}}else if(u.drawDefinitions.push(l),!i){let{matchUps:B}=Sn({drawDefinition:l,event:u});B&&Dc({tournamentId:s==null?void 0:s.tournamentId,matchUps:B}),jy({drawDefinition:l,tournamentId:P,eventId:C})}return{...J,modifiedEventEntryStatusCount:h}}function w4(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:u}=t,c=0;if(!(s!=null&&s.length))return{error:dN};if(!r)return{error:ge};if(!l)return{error:ks};let d=po({provisionalPositioning:e,drawDefinition:n,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:m}=d,h=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:y}=v;m&&y<=m&&(!i||h[y])&&(h[y]=v)});let f=Object.values(h),g=f.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==sG(g).length)return{error:yG};for(let v of f){let y=Vg({...v,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,event:u});if(y!=null&&y.error)return y;y!=null&&y.success&&c++}return c?{...J,modifications:c}:{error:Eg}}function Ok({deleteExisting:t,event:e,flightProfile:i}){var a;let r="attachFlightProfile";if(!i)return ee({result:{error:Xe},stack:r});if(!e)return ee({result:{error:gi},stack:r});let{flightProfile:n}=Gi({event:e});return n&&!t?ee({result:{error:CN},stack:r}):(a=e.drawDefinitions)!=null&&a.length?ee({result:{error:fG},stack:r}):(zc({event:e,extension:{name:Jo,value:i}}),{flightProfile:Me(i,!1,!0),...J})}function Ape({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var s;if(!t)return{error:ge};if(!i)return{error:Vc};if(!e)return{error:Xe,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=e,o=[NW,r,n,a].join(".");return(s=t.participants)==null||s.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(u=>u&&(u==null?void 0:u.itemType)!==o))}),{...J}}function kk({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:o}){var u;if(!a)return{error:gi};if(r&&!Array.isArray(r))return ee({result:{error:oe},info:$d("entryStatus"),stack:"removeScaleValues"});let s=a.entries;if(n){let{flightProfile:c}=Gi({event:a}),d=(u=c==null?void 0:c.flights)==null?void 0:u.find(p=>p.drawId===n);d?s=d.drawEntries:s=i==null?void 0:i.entries}let l=(s||[]).filter(c=>(!o||!c.entryStage||c.entryStage===o)&&(!r||r.includes(c.entryStatus))).map(Ut);return Ape({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function TD({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=qa,event:n}){if(!e)return ee({result:{error:ge}});if(!n)return ee({result:{error:gi}});if(!Nt(i))return ee({result:{error:Xe}});if(Nt(i.draws))for(let o of Object.keys(i.draws)){let s=i.draws[o].scheduleDetails??[];if(s.length){let l=[];for(let u of s){let c=l.find(d=>pne(d.attributes,u.attributes));c!=null&&c.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[o].scheduleDetails=l}}let a=Yg({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...J}}function U4({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:o}){var l,u;if(!t)return{error:ge};if(!a)return{error:gi};r=r||((l=a.category)==null?void 0:l.categoryName)||((u=a.category)==null?void 0:u.ageCategoryCode);let s={eventType:a.eventType,scaleType:Pl,scaleName:r};return kk({tournamentRecord:t,scaleAttributes:s,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:o})}function S4(t){let e=ze(t,[{[br]:!0},{eventIds:!0,[Xn]:un}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],o=[],s=[],l=[];if(r.events=(r.events||[]).filter(u=>{if(n.includes(u.eventId)){let p={action:_U,payload:{events:[u]}};a.push(p),o.push({tournamentId:r.tournamentId,eventName:u.eventName,eventType:u.eventType,category:u.category,eventId:u.eventId,gender:u.gender})}let c=u.eventType===uo?(u.entries||[]).map(({entryStatus:p,participantId:m})=>p!==bo&&m).filter(Boolean):[],d=n.includes(u.eventId);return d?l.push(...c):s.push(...c),!d}),i){let u=l.filter(c=>!s.includes(c));r.participants=r.participants.filter(({participantId:c})=>!u.includes(c))}if(Rb({tournamentRecord:r}),a.length)if(Q0(mu)){let u=r.tournamentId;lt({topic:mu,payload:{type:_U,tournamentId:u,detail:a}})}else bb({tournamentRecord:r,timeItem:{itemValue:o,itemType:_U}});return{...J}}function T4(t){var f,g,v;let e=ze(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:ea}]);if(e.error)return e;let{eventUpdates:i,event:r}=t,n="modifyEvent",a=xpe(t),o=Fpe({enteredParticipants:a}),{enteredParticipantGenders:s,enteredParticipantTypes:l}=o,u=(g=(f=Gi({event:r}))==null?void 0:f.flightProfile)==null?void 0:g.flights,c=!((v=r.drawDefinitions)!=null&&v.length)&&!(u!=null&&u.length),d=Lpe({noFlightsNoDraws:c,enteredParticipantGenders:s,eventUpdates:i,stack:n});if(d.error)return d;let p=_pe({enteredParticipantTypes:l,eventUpdates:i,stack:n});if(p.error)return p;let m=Ope({...t,...o,enteredParticipants:a,stack:n});if(m.error)return m;let h=kpe({...t,stack:n});return h.error?h:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{...J})}function Ope(t){var r,n,a,o,s,l;let e=(r=t.eventUpdates)==null?void 0:r.category;if(!e)return{...J};let i=SI({category:e});if(i.error)return i;if(t.event.eventType===sr){let u=((a=(n=t.event)==null?void 0:n.drawDefinitions)==null?void 0:a.map(p=>Ls(p)))??[],c=Ls(t.event),d=(((o=Zl(t))==null?void 0:o.matchUps)??[]).map(p=>Ls(p))??[];if(![c,...u,...d].filter(Boolean).every(p=>p.collectionDefinitions.every(m=>!m.category||Ay({category:t.eventUpdates.category,childCategory:m.category}))))return ee({result:{error:vI},stack:t.stack})}if((s=t.enteredParticipants)!=null&&s.length){let u=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,c=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,d=t.enteredParticipants.map(h=>h.participantType===St?h:h.individualParticpants??[]).flat(),p=fm({category:e,consideredDate:u}),m=fm({category:e,consideredDate:c});if(p!=null&&p.ageMinDate||p!=null&&p.ageMaxDate||m!=null&&m.ageMinDate||m!=null&&m.ageMaxDate)for(let h of d){let f=(l=h.person)==null?void 0:l.birthDate;if(!f)return ee({result:{error:_G},stack:t.stack});let g=new Date(f).getTime();if(p.ageMinDate||p.ageMaxDate){let v=new Date(p.ageMinDate).getTime(),y=new Date(p.ageMaxDate).getTime();if(g<v||g>y)return ee({result:{error:vE},stack:t.stack})}if(m.ageMin||m.ageMax){let v=new Date(m.ageMinDate).getTime(),y=new Date(m.ageMaxDate).getTime();if(g<v||g>y)return ee({result:{error:vE},stack:t.stack})}}}return{...J}}function kpe(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=Mk({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:r});if(a.error)return ee({result:a,stack:n})}return{...J}}function xpe(t){var n;let{tournamentRecord:e,event:i}=t,r=((n=i==null?void 0:i.entries)==null?void 0:n.filter(({entryStatus:a})=>{let o=a;return[...ss,Vo].includes(o)}).map(({participantId:a})=>a))??[];return r?Mi({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function Fpe({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{var s,l;let o=(s=a.person)!=null&&s.sex?[a.person.sex]:((l=a.individualParticpants)==null?void 0:l.map(u=>{var c;return(c=u.person)==null?void 0:c.sex}))||[];return e.push(...o),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=ct(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function Lpe({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||i.gender===Ds||e.length===1&&e[0]===i.gender||t&&i.gender===Bn;return i.gender&&!n?ee({context:{gender:i.gender,validGender:n},result:{error:Gv},stack:r}):{...J}}function _pe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(sr)&&[sr]||t.includes(St)&&[Qs]||t.includes(ht)&&[uo]||[uo,Qs,sr]).includes(e.eventType??"");return e.eventType&&!r?ee({context:{participantType:e.eventType,validEventType:r},result:{error:Ll},stack:i}):{...J}}function DD({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){var m,h,f;let o="addFlight";if(!n)return ee({result:{error:gi},stack:o});if(!i)return ee({result:{error:Xe},stack:o});if(e!=null&&e.length){let g=(n.entries??[]).map(Ut),v=e.map(Ut);if(Vi(v,g).length!==v.length)return ee({result:{error:oe},stack:o})}let s=(m=Gi({event:n}))==null?void 0:m.flightProfile,l=((f=(h=s==null?void 0:s.flights)==null?void 0:h.map(({flightNumber:g})=>!isNaN(g)&&Ze(g)))==null?void 0:f.filter(Boolean))||[],u=Math.max(0,...l)+1,c={drawId:r||Gt(),flightNumber:u,drawEntries:e,drawName:i};if(a&&(c.stage=a),t&&(c.qualifyingPositions=t),((s==null?void 0:s.flights)||[]).find(({drawId:g})=>g===c.drawId))return ee({result:{error:vH},stack:o});let d=((s==null?void 0:s.flights)||[]).concat(c),p={name:Jo,value:{...s||{},flights:d}};return zc({event:n,extension:p})}var D4={};yt(D4,{drawMatic:()=>WO,garman:()=>A4,generateAdHocMatchUps:()=>ZT,generateAdHocRounds:()=>zO,generateAndPopulatePlayoffStructures:()=>wO,generateCourts:()=>xk,generateDrawDefinition:()=>Mb,generateDrawMaticRound:()=>xO,generateDrawStructuresAndLinks:()=>AO,generateDrawTypeAndModifyDrawDefinition:()=>OO,generateFlightProfile:()=>Vpe,generateLineUps:()=>N4,generateQualifyingStructure:()=>pO,generateSeedingScaleItems:()=>t4,generateStatCrew:()=>jpe,generateVoluntaryConsolation:()=>F3,roundRobinGroups:()=>Hse});var $pe="splitLevelBased",P4="splitWaterfall",R4="splitShuttle",Bpe={SPLIT_LEVEL_BASED:$pe,SPLIT_WATERFALL:P4,SPLIT_SHUTTLE:R4};function Vpe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:m}=t;if(!p)return{error:gi};let h=p.entries??[],{flightProfile:f}=Gi({event:p});if(f&&i&&!o)return{error:CN};let g=t.scaledEntries??ch({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:s,event:p,stage:m}).scaledEntries,v=g.map(Ut),y=wn(h.filter(({participantId:P})=>!v.includes(P)).filter(P=>(!m||!P.entryStage||P.entryStage===m)&&(!P.entryStatus||hp.includes(P.entryStatus)))),I=g.concat(...y),b=I.length,S=Math.ceil(b/u),w=Pr(I,S);c===P4?w=uE(I,u):c===R4&&(w=uE(I,u,!0));function U(P){return(P||[]).map(({participantId:C,scaleValue:R})=>{let N=h.find(A=>A.participantId===C);return N!=null&&N.scaleValue&&R&&(N.scaleValue=R),N}).sort((C,R)=>C.scaleValue-R.scaleValue).map((C,R)=>(C.scaleValue&&(C.seedNumber=R+1),C))}let T=Se(0,u).map(P=>{let C=P+1;return{flightNumber:C,drawId:(d==null?void 0:d.pop())??Gt(),drawEntries:U(w[P]),drawName:(l==null?void 0:l.length)&&l[P]||`${e} ${C}`}}),D={scaleAttributes:n,splitMethod:c,flights:T};if(i){let P=Ok({flightProfile:D,deleteExisting:o,event:p});return{splitEntries:Fa()&&w||void 0,...P}}else return{flightProfile:D,...J}}function C4({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(o=>typeof o=="object"&&Object.keys(o).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return E4({tagName:e,attributes:n,childArrays:i,childObjects:r})}function E4(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,o=m=>{let h=Object.keys(m)[0],f=m[h];return{key:h,value:f}},s=r==null?void 0:r.map(({key:m,value:h})=>E4({tagName:m,childObjects:h.map(o)})).join(`\r
`),l=n==null?void 0:n.map(({key:m,value:h})=>C4({tagName:m,json:h??[]})).join(`\r
`),u=i==null?void 0:i.map(({key:m,value:h})=>`${m}="${h}"`).join(" "),c=u?` ${u}`:"";if(e==="childArray")return l;let d=l!=null&&l.length?`${a}${l}${a}`:"",p=s!=null&&s.length?`${a}${s}${a}`:"";return`<${e}${c}>${d}${p}</${e}>`}function jpe(t){var I,b,S;let e=ze(t,[{[br]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:r,tournamentId:n,tournamentName:a}=i,{participantMap:o,matchUps:s,mappedMatchUps:l}=Mi({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),u=i.participants.filter(w=>w.participantType===Kt),c=(s==null?void 0:s.filter(w=>w.matchUpType===Kt))??[],d=(c==null?void 0:c.reduce((w,U)=>{let T=(U==null?void 0:U.tieMatchUps)??[];return T&&[...w,...T]},[]))??[],p=(s==null?void 0:s.filter(w=>w.matchUpType===ti))??[],m=(s==null?void 0:s.filter(w=>w.matchUpType===Qt))??[],h=d.length===p.length+m.length,f=c.length===1&&h,g={mappedMatchUps:l,participantMap:o,tournamentName:a,tournamentId:n,tournament:h?"N":"Y",startDate:r},v=[],y=[];if(f){let w=c[0],{json:U,xml:T}=sV({teamParticipants:u,teamMatchUp:w,...g,doubles:m,singles:p});y.push(U),v.push(T)}else for(let w of c){let U=(I=w==null?void 0:w.sides)==null?void 0:I.map(({participant:C})=>C==null?void 0:C.participantId).filter(Boolean);if((U==null?void 0:U.length)!==2)continue;let T=U.map(C=>{var R;return C&&((R=o==null?void 0:o[C])==null?void 0:R.participant)}),{xml:D,json:P}=sV({doubles:(b=w.tieMatchUps)==null?void 0:b.filter(C=>C.matchUpType===Qt),singles:(S=w.tieMatchUps)==null?void 0:S.filter(C=>C.matchUpType===ti),teamParticipants:T,teamMatchUp:w,...g});y.push(P),v.push(D)}return{json:y,xml:v,...J}}function sV({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:o,startDate:s,doubles:l,singles:u}){var b,S,w,U;let c=t==null?void 0:t.find(T=>{var D;return(D=T.participantRoleResponsibilities)==null?void 0:D.includes("Home")}),d=t==null?void 0:t.filter(T=>T.participantId!==(c==null?void 0:c.participantId)),p=$o(s,"/","MDY"),m=(c==null?void 0:c.participantName)||((b=d==null?void 0:d[1])==null?void 0:b.participantName),h=(c==null?void 0:c.participantId)||((S=d==null?void 0:d[1])==null?void 0:S.participantId),f=(w=d==null?void 0:d[0])==null?void 0:w.participantName,g=(U=d==null?void 0:d[0])==null?void 0:U.participantId,v={},y=t.map(T=>({team:{...zpe({teamParticipant:T,teamMatchUp:a,uniValues:v,participantMap:i,mappedMatchUps:e,homeid:h})}})),I=Ge({venue:{tournamentname:o?r:void 0,neutralgame:c?"N":"Y",gameid:n,officials:{},tournament:o,rules:{},homename:m,visname:f,homeid:h,visid:g,date:p},childArray:y,singles_matches:u==null?void 0:u.map(T=>lV({matchUp:T,homeid:h,uniValues:v})),doubles_matches:l==null?void 0:l.map(T=>lV({matchUp:T,homeid:h,uniValues:v}))});return{json:I,xml:C4({json:I,tagName:"tngame"})}}function Gpe({homeid:t,uniValues:e,participant:i}){var f,g,v,y,I,b,S,w,U,T,D,P,C,R,N;if(!i)return{};let r=((f=i.individualParticipants)==null?void 0:f.length)===2,n=r?ct((g=i.individualParticipants)==null?void 0:g.map(A=>{var M,E;return(E=(M=A.teams)==null?void 0:M[0])==null?void 0:E.participantId})):[],a=r?ct((v=i.individualParticipants)==null?void 0:v.map(A=>{var M,E;return(E=(M=A.teams)==null?void 0:M[0])==null?void 0:E.teamId})):[],o=!r&&((I=(y=i.teams)==null?void 0:y[0])==null?void 0:I.participantId)||(n==null?void 0:n.length)===1&&n[0]||void 0,s=!r&&((S=(b=i.teams)==null?void 0:b[0])==null?void 0:S.teamId)||(a==null?void 0:a.length)===1&&a[0]||o,l=r?void 0:i.participantName,u=(U=(w=i.individualParticipants)==null?void 0:w[0])==null?void 0:U.participantName,c=(D=(T=i.individualParticipants)==null?void 0:T[1])==null?void 0:D.participantName,d=t&&(o===t?"H":"V")||"",p=r?void 0:e[o][i.participantId],m=e[o][(C=(P=i.individualParticipants)==null?void 0:P[0])==null?void 0:C.participantId],h=e[o][(N=(R=i.individualParticipants)==null?void 0:R[1])==null?void 0:N.participantId];return Ge({vh:d,uni:p,uni_1:m,uni_2:h,team:s,name:l,name_1:u,name_2:c})}function Hpe({sets:t,sideNumber:e}){return Object.assign({},...(t==null?void 0:t.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s}=i,l=`set_${r}`,u=`tie_${r}`,c=e===1?n:a,d=e===1?o:s;return{[l]:c,[u]:d}}))??[])}function zpe({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){var b,S,w,U,T,D,P,C,R,N,A,M,E,O;let{participantId:o,participantName:s}=t,l=n&&(o===n?"H":"V")||"",u=(b=i==null?void 0:i[o])==null?void 0:b.matchUps,c=u&&Object.keys(u),d=(w=(S=e==null?void 0:e.sides)==null?void 0:S.find(({participant:k})=>k.participantId===o))==null?void 0:w.sideNumber,p=((D=(T=(U=e==null?void 0:e.score)==null?void 0:U.sets)==null?void 0:T[0])==null?void 0:D[`side${d}Score`])??0;a[o]={};let m={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},h=[],f=[],g=0;for(let k of c??[]){let x=r==null?void 0:r[k],F=(P=x.sides.find(({participant:_})=>_.participantId===o))==null?void 0:P.sideNumber,$=((N=(R=(C=x.score)==null?void 0:C.sets)==null?void 0:R[0])==null?void 0:N[`side${F}Score`])??0;g+=$;for(let _ of x.tieMatchUps??[]){let{matchUpType:L,winningSide:B}=_,V=B&&(B===F?"w":"l")||"";V&&(m[L][V]+=1);let G=V==="w"?"1":"0",j=V==="l"?"1":"0";if(L===ti){let z=f.length+1;f.push({singles_pair:{pair:z,won:G,lost:j,tied:"0"}})}else if(L===Qt){let z=h.length+1;h.push({doubles_pair:{pair:z,won:G,lost:j,tied:"0"}})}}}let v=[{singles:{childArray:f,won:m.SINGLES.w,lost:m.SINGLES.l}},{doubles:{childArray:h,won:m.DOUBLES.w,lost:m.DOUBLES.l}}],y=[],I=1;for(let k of t.individualParticipantIds){let x=i==null?void 0:i[k];if(x){let{participant:F,counters:$}=x,_={won:((A=$==null?void 0:$.DOUBLES)==null?void 0:A.wins)||0,lost:((M=$==null?void 0:$.DOUBLES)==null?void 0:M.losses)||0},L={won:((E=$==null?void 0:$.SINGLES)==null?void 0:E.wins)||0,lost:((O=$==null?void 0:$.SINGLES)==null?void 0:O.losses)||0},{participantName:B,participantId:V}=F;a[o][V]=I,y.push({player:{name:B,uni:I,singles:L,doubles:_}})}I+=1}return{vh:l,id:o,name:s,score:p||g,totals:v,childArray:y}}function lV({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:o}=t??{},s=o==null?void 0:o.map(l=>{var p;let{sideNumber:u,participant:c}=l,d=Hpe({sets:(p=t.score)==null?void 0:p.sets,sideNumber:u});return{[a===ti?"singles_score":"doubles_score"]:{...Gpe({homeid:e,uniValues:i,participant:c}),...d}}});return{[a===ti?"singles_match":"doubles_match"]:{match:r,order:n,childArray:s}}}var Wpe="ASC",M4="ASC",qpe="DESC",r1="DESC",Ype={ASC:Wpe,ASCENDING:M4,DESC:qpe,DESCENDING:r1};function N4(t){var C,R,N,A,M;let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:o,attach:s,event:l}=t;if((l==null?void 0:l.eventType)!==Sa)return{error:Ll};if(!r)return{error:ge};if(!e&&!n)return{error:xa};if(e=e??((C=vn({drawDefinition:n,event:l}))==null?void 0:C.tieFormat),Hn({tieFormat:e}).error)return{error:Dl};if(typeof a!="object"&&!i)return{error:oe,context:{scaleAccessor:a}};let u={},c=((n==null?void 0:n.entries)??(l==null?void 0:l.entries)??[]).filter(E=>(E==null?void 0:E.entryStatus)===oa).map(Ut),{participants:d=[]}=Mi({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=d.filter(({participantId:E})=>c.includes(E)),m=E=>E===wc?"rankings":"ratings",h=((R=l==null?void 0:l.category)==null?void 0:R.categoryName)??((N=l==null?void 0:l.category)==null?void 0:N.ageCategoryCode),{scaleName:f=h,scaleType:g=wc,sortOrder:v,accessor:y}=a||{},I=m(g),b=(E,O)=>{var x,F,$;let k=(x=E[I])==null?void 0:x[O];if(!k&&i&&(k=(F=E[I])==null?void 0:F[zp]),Array.isArray(k)){let _=($=k.find(L=>L.scaleName===f))==null?void 0:$.scaleValue;if(Li(_))return _;if(y&&typeof _=="object")return _[y]}return 0},S=(E,O,k)=>{let x=v===r1?O:E,F=v===r1?E:O;return b(x,k)-b(F,k)},w=(E,O)=>S(E,O,zp),U=(E,O)=>S(E,O,Ed),T=[],D=(e==null?void 0:e.collectionDefinitions)??[];for(let E of p){let O=((A=E.individualParticipants)==null?void 0:A.sort(w))??[],k=o?O:((M=E.individualParticipants)==null?void 0:M.sort(U))??[],x={};for(let $ of D){let _=[],{collectionId:L,matchUpCount:B,matchUpType:V,gender:G}=$,j=Yi(zp)(V);Se(0,B).forEach(z=>{let q=j?O:k??[],W=z+1,Y=[];Se(0,j?1:2).forEach(re=>{var H;let K=(H=q==null?void 0:q.find(Q=>{var ie;let X=G&&([Jt,pi].includes(G)&&G||G===Bn&&[Jt,pi][re]);return(!X||X===((ie=Q.person)==null?void 0:ie.sex))&&!_.includes(Q.participantId)}))==null?void 0:H.participantId;K&&(Y.push(K),_.push(K),x[K]||(x[K]=[]),x[K].push({collectionPosition:W,collectionId:L}))}),j||T.push(Y)})}let F=Object.keys(x).map($=>({collectionAssignments:x[$],participantId:$}));u[E.participantId]=F}let P=[];for(let E of T){let{participant:O}=Qo({tournamentParticipants:d,participantIds:E});if(!O){let k={individualParticipantIds:E,participantRole:Zr,participantType:ht};P.push(k)}}if(s){for(;P.length;)nl({participant:P.pop(),tournamentRecord:r});Lt({element:n,extension:{name:Uu,value:u}})}return{...J,lineUps:u,participantsToAdd:P}}function xk(t){if(!t)return{error:Xe};let e=ze(t,[{dates:!1,[Kr]:o=>Array.isArray(o)&&o.every(Ia)},{uuids:!1,[Kr]:o=>Array.isArray(o)&&o.every(Ti)},{startTime:!1,endTime:!1,[Kr]:LN},{idPrefix:!1,namePrefix:!1,[Kr]:Ti},{count:!0,[Kr]:Li}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&Df(i,r)||[],a=Se(1,t.count+1).map(o=>{var s,l;return Ge({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${o}`)??Gt(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${o}`),dateAvailability:n.map(u=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:u}))})});return{...J,courts:a}}var A4={};yt(A4,{default:()=>Jpe,garman:()=>x4});function Ab({court:t,date:e}){let i=e&&t.dateAvailability.find(n=>_l(n.date,e)),r=t.dateAvailability.find(n=>!n.date);return i||r}function Xg(t){let e=ze(t,[{courtDate:!0,_ofType:ea}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=ir(r.startTime);(r.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>hS(s.startTime).localeCompare(hS(l.startTime))).forEach(s=>{let l={startTime:bi(a.toISOString()),endTime:s.startTime};ir(s.startTime)>a&&n.push(l),ir(s.endTime)>a&&(a=ir(s.endTime))});let o={startTime:bi(a.toISOString()),endTime:r.endTime};return ir(r.endTime)>a&&n.push(o),{timeSlots:n}}function Kpe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=o=>{var l;let{timeSlots:s}=Xg({includeBookingTypes:e,courtDate:o});return!!((l=s==null?void 0:s.filter(a))!=null&&l.length)};function a(o){let s=ir(o.startTime),l=ir(o.endTime);return s>i||l<r?!1:Ny(i,l)>=t}return{enoughTime:n}}function O4(t){let e=ze(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:un}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,o=t.courts,s=ir(n),l=$N(s,i),{enoughTime:u}=Kpe({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((o==null?void 0:o.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=Ab({date:a,court:c});return!!(d&&u(d))}))||[]).length,...J}}function PD(t){var p;let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=t,{bookings:o=[]}=t;if(!Array.isArray(a)||!a.length)return{error:oe,courts:a};if(!Array.isArray(o))return{error:cS};if(!Ia(n))return{error:Nr};i&&(Array.isArray(i)?i.includes(n)&&(o=[]):o=[]);let{courtBookings:s,unassignedBookings:l}=o.reduce((m,h)=>{let{courtId:f}=h;return f?m.courtBookings[f]?m.courtBookings[f].push(h):m.courtBookings[f]=[h]:m.unassignedBookings.push(h),m},{courtBookings:{},unassignedBookings:[]}),u=a.map((m,h)=>{let{courtId:f,courtName:g}=m,v=s[f]||[],y=Ab({date:n,court:m})||{},{bookings:I=[],startTime:b,endTime:S,date:w}=y,U=[e[h]&&{startTime:b,endTime:e[h]},...Me(I,!1,!0),...v].filter(Boolean);return{courtId:f,courtName:g,dateAvailability:{bookings:U,startTime:b,endTime:S,date:w}}});l.sort((m,h)=>kt(m.startTime)-kt(h.startTime));let c=()=>u.map(m=>{let h=m.dateAvailability,{timeSlots:f=[]}=Xg({courtDate:h});return{courtName:m.courtName,courtId:m.courtId,timeSlots:f}}).flat(),d=[];for(let m of l){let{startTime:h,endTime:f,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=m,I=kt(h),b=kt(f),S=c().reduce((w,{courtId:U,courtName:T,timeSlots:D})=>{let P;return D.find(({startTime:C,endTime:R})=>{P=kt(C)-I;let N=I>=kt(C);return b<=kt(R)&&w.startDifference!==0&&((P===0||P+r>=0)&&(w.startDifference===void 0||P<w.startDifference)||N)})?{courtName:T,courtId:U,startDifference:P}:w},{});if(S.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:h,endTime:f};d.push(w),(p=u.find(({courtId:U})=>U===S.courtId))==null||p.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:m})}return{virtualCourts:u.map(({courtId:m,courtName:h,dateAvailability:f})=>({dateAvailability:[f],courtName:h,courtId:m})),assignedBookings:d}}function RD({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function k4(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return Se(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function Hf({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,o)=>{let s=Ab({date:t,court:o}),l=n&&((s==null?void 0:s[n])||o[n]);return l&&(!a||e&&kt(l)<kt(a)||i&&kt(l)>kt(a))?l:a},void 0)}function Xpe({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||Hf({courts:r,scheduleDate:n,startTime:!0}),i=i||Hf({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let o=ir(e),s=ir(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let u=Ab({court:l,date:n}),{timeSlots:c}=Xg({courtDate:u});c==null||c.forEach(d=>{let p=ir(d.startTime),m=ir(d.endTime);if(p>s||p<o||m<o)return!1;if(Ny(p,m)>=t){let h=bi(p.toISOString());(!a||h<a)&&(a=h)}})}}return{firstTimeSlotStartTime:a}}function Fk(t){let e=ze(t,[{courts:!0,_ofType:un}]);if(e.error)return e;let{date:i=FN(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:o}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||RD({averageMatchUpMinutes:u}),i=pt(i),r=bi(r),n=bi(n);let m=0,h=0,f=0,g=0,v=0;!o&&d&&(o=k4({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:y}=PD({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:I}=Xpe({averageMinutes:u,courts:y,startTime:r,endTime:n,date:i});s&&I&&(r=I||r);let b=kt(r),S=kt(n)-b,w=Math.floor(S/a),U=Se(0,w+1).map(T=>{let D=b+T*a,P=fae(D),C=O4({courts:y??[],averageMatchUpMinutes:u,periodStart:P,date:i});if(C.error)return{error:C.error};let{availableToScheduleCount:R=0}=C,N=R>h?R-h:0;v+=T?R:0;let A=T?v/T:R,M=a*A/u,E=T?M*(T-1)+A:A,O=R?h&&E-m||N:0;m=E,h=R,f+=O;let k=Ze(f)-g;return g+=k,{periodStart:P,add:k,availableToScheduleCount:R,newCourts:N,totalMatchUps:g}});return{scheduleTimes:U.reduce((T,D)=>{let P=Se(0,D.add).map(()=>({scheduleTime:D.periodStart}));return T.concat(...P)},[]).flat(),timingProfile:U,totalMatchUps:g}}var x4={getCourtsAvailableAtPeriodStart:O4,generateTimeSlots:Xg,getScheduleTimes:Fk,courtGenerator:k4},Jpe=x4,F4={};yt(F4,{isValid:()=>Ua,isValidMatchUpFormat:()=>Ua,parse:()=>kn,stringify:()=>nT});var L4={};yt(L4,{allCompetitionMatchUps:()=>Rs,allDrawMatchUps:()=>Sn,allEventMatchUps:()=>Zl,allTournamentMatchUps:()=>Br,analyzeMatchUp:()=>$I,applyLineUps:()=>oY,assignMatchUpSideParticipant:()=>$4,assignTieMatchUpParticipantId:()=>BS,bulkMatchUpStatusUpdate:()=>iY,calculateWinCriteria:()=>ph,checkInParticipant:()=>_k,checkMatchUpIsComplete:()=>Pd,checkOutParticipant:()=>Lk,competitionScheduleMatchUps:()=>Eb,disableTieAutoCalc:()=>Q4,drawMatchUps:()=>bk,enableTieAutoCalc:()=>X4,eventMatchUps:()=>yD,filterMatchUps:()=>au,findMatchUp:()=>nk,getAllDrawMatchUps:()=>mr,getAllStructureMatchUps:()=>Wt,getCheckedInParticipantIds:()=>th,getCompetitionMatchUps:()=>_I,getEventMatchUpFormatTiming:()=>dk,getHomeParticipantId:()=>fk,getMatchUpCompetitiveProfile:()=>Qy,getMatchUpContextIds:()=>gk,getMatchUpDailyLimits:()=>wD,getMatchUpDailyLimitsUpdate:()=>pk,getMatchUpDependencies:()=>ls,getMatchUpFormat:()=>vk,getMatchUpFormatTiming:()=>eb,getMatchUpFormatTimingUpdate:()=>ck,getMatchUpScheduleDetails:()=>OT,getMatchUpType:()=>kT,getMatchUpsStats:()=>Ik,getModifiedMatchUpFormatTiming:()=>ID,getParticipantResults:()=>vb,getPredictiveAccuracy:()=>hk,getRoundMatchUps:()=>Cn,getRounds:()=>yk,isValidMatchUpFormat:()=>Ua,matchUpActions:()=>XT,mutate:()=>_4,participantScheduledMatchUps:()=>mk,query:()=>K6,removeDelegatedOutcome:()=>J4,removeMatchUpSideParticipant:()=>Vk,removeTieMatchUpParticipantId:()=>V4,replaceTieMatchUpParticipantId:()=>Bk,resetAdHocMatchUps:()=>nY,resetMatchUpLineUps:()=>Yk,resetScorecard:()=>Xk,resetTieFormat:()=>Kk,setDelegatedOutcome:()=>rY,setMatchUpFormat:()=>eY,setMatchUpStatus:()=>kb,setOrderOfFinish:()=>aY,substituteParticipant:()=>Z4,tallyParticipantResults:()=>Hg,toggleParticipantCheckInState:()=>CD,tournamentMatchUps:()=>bD,updateTieMatchUpScore:()=>Wu,validMatchUp:()=>CT,validMatchUps:()=>wo});var _4={};yt(_4,{applyLineUps:()=>oY,assignMatchUpSideParticipant:()=>$4,assignTieMatchUpParticipantId:()=>BS,bulkMatchUpStatusUpdate:()=>iY,checkInParticipant:()=>_k,checkOutParticipant:()=>Lk,disableTieAutoCalc:()=>Q4,enableTieAutoCalc:()=>X4,findMatchUp:()=>nk,removeDelegatedOutcome:()=>J4,removeMatchUpSideParticipant:()=>Vk,removeTieMatchUpParticipantId:()=>V4,replaceTieMatchUpParticipantId:()=>Bk,resetAdHocMatchUps:()=>nY,resetMatchUpLineUps:()=>Yk,resetScorecard:()=>Xk,resetTieFormat:()=>Kk,setDelegatedOutcome:()=>rY,setMatchUpFormat:()=>eY,setMatchUpStatus:()=>kb,setOrderOfFinish:()=>aY,substituteParticipant:()=>Z4,toggleParticipantCheckInState:()=>CD,updateTieMatchUpScore:()=>Wu});function $4({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){var u,c;if(i&&typeof i!="string")return{error:Ss};if(!e)return{error:_e};if(!n)return{error:yn};let o=r===void 0;if(o&&(r=1),![1,2].includes(r))return ee({result:{error:oe,context:{sideNumber:r}}});let{matchUp:s,structure:l}=wi({drawDefinition:e,matchUpId:n,event:a});if(!s)return{error:dn};if(!(!(l!=null&&l.structures)&&!(e.drawType&&e.drawType!==La)&&!((u=l==null?void 0:l.matchUps)!=null&&u.find(({roundPosition:d})=>!!d))))return{error:sN};if(!i&&((c=s==null?void 0:s.score)!=null&&c.scoreStringSide1||gr.includes(s==null?void 0:s.matchUpstatus)||s!=null&&s.matchUpStatus&&[er,cr].includes(s.matchUpStatus)))return{error:H0,info:"matchUp has completed status or score"};if(s){if(s.sides=[1,2].map(d=>{var m;let p=((m=s.sides)==null?void 0:m.find(h=>h.sideNumber===d))??{sideNumber:d};return r===d?{...p,participantId:i}:p}),o)for(let d of s.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);Rt({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:s})}return{...J,sidesSwapped:o}}function Da({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=wi({drawDefinition:r,event:s,matchUpId:a});if(!l)return{error:dn};let u=gl({removePriorValues:t,element:l,duplicateValues:i,timeItem:o});return n||Rt({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),u}function Lk(t){var y;let e=[{[br]:!0},{[Fn]:!0},{[Vl]:!0},{[hl]:!0}],i=ze(t,e);if(i.error)return i;let r=Wg(t,[{[Ag]:Xl,attr:{[pT]:!0}}]);if(r.error)return r;let{tournamentRecord:n,drawDefinition:a,participantId:o,matchUpId:s}=t,l=(y=r==null?void 0:r.matchUp)==null?void 0:y.matchUp,{matchUpStatus:u,score:c}=l??{};if(u&&uA.includes(u)||u&&gr.includes(u)||vr({score:c}))return{error:UG};let d=th({matchUp:l});if(d!=null&&d.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:m}=d??{};if(!(m!=null&&m.includes(o)))return{error:Ss};if(!(p!=null&&p.includes(o)))return{error:XG};let h=DW({matchUp:l});if(h!=null&&h.error)return h;let{sideParticipantIds:f,nestedIndividualParticipantIds:g}=h??{},v=f==null?void 0:f.indexOf(o);return v!==void 0&&[0,1].includes(v)&&((g==null?void 0:g[v])??[]).forEach(I=>{Da({drawDefinition:a,matchUpId:s,timeItem:{itemType:SS,itemValue:I}})}),Da({tournamentRecord:n,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:SS}}),{...J,checkedOut:!0}}function _k(t){var p;let e=[{[br]:!0},{[Fn]:!0},{[Vl]:!0},{[hl]:!0}],i=ze(t,e);if(i[Bo])return i;let r=Wg(t,[{[Ag]:Xl,attr:{[pT]:!0}}]);if(r[Bo])return r;let{tournamentRecord:n,drawDefinition:a,participantId:o,matchUpId:s}=t,l=th({matchUp:(p=r==null?void 0:r.matchUp)==null?void 0:p.matchUp});if(l!=null&&l.error)return l;let{checkedInParticipantIds:u,allRelevantParticipantIds:c}=l??{};if(!(c!=null&&c.includes(o)))return{[Bo]:Ss};let d={...J,checkedIn:!0};return u!=null&&u.includes(o)||Da({tournamentRecord:n,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:US}}),d}function CD(t){var u,c;let e=ze(t,[{[Vl]:!0,[Fn]:!0,[hl]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,r=t.tournamentRecord??(i&&((u=t.tournamentRecords)==null?void 0:u[i]));if(!r)return{error:ge};let n=(c=Wg(t,[{[Ag]:Xl,attr:{[pT]:!0},[Bo]:dn}]).matchUp)==null?void 0:c.matchUp;if(!n)return{error:dn};let{checkedInParticipantIds:a=[]}=th({matchUp:n}),{participantId:o,matchUpId:s,drawDefinition:l}=t;return o&&a.includes(o)?Lk({tournamentRecord:r,drawDefinition:l,participantId:o,matchUpId:s,matchUp:n}):_k({tournamentRecord:r,drawDefinition:l,participantId:o,matchUpId:s,matchUp:n})}function $k({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){var w,U;if(!t)return{error:ge};if(!e)return{error:ks};if(!r)return{error:lo};let n=sn({drawDefinition:e}),{matchUp:a}=wi({matchUpId:i,drawDefinition:e,matchUpsMap:n});if(!a)return{error:dn};let{matchUp:o,structure:s}=wi({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:n,event:r});if(!o)return{error:dn};let{collectionPosition:l,drawPositions:u,collectionId:c,matchUpTieId:d,matchUpType:p}=o;if(p&&!_0([ti,Qt],p))return{error:aa};let{positionAssignments:m}=ai({structure:s}),h=m==null?void 0:m.filter(T=>u==null?void 0:u.includes(T.drawPosition)),{matchUp:f}=wi({matchUpId:d,drawDefinition:e,matchUpsMap:n}),g=((w=f==null?void 0:f.sides)==null?void 0:w.map(Ut))??[],v=(h==null?void 0:h.map(Ut))??[],y=[...g,...v],{participants:I}=Mi({tournamentRecord:t,participantFilters:{participantTypes:[Kt],participantIds:y}}),{matchUp:b}=wi({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:n}),S=(U=vn({matchUp:f,drawDefinition:e,structure:s,event:r}))==null?void 0:U.tieFormat;return{inContextDualMatchUp:b,inContextTieMatchUp:o,relevantAssignments:h,collectionPosition:l,teamParticipants:I,collectionId:c,matchUpType:p,dualMatchUp:f,tieMatchUp:a,tieFormat:S,structure:s,...J}}function Bk(t){var k,x,F,$,_,L,B,V,G,j,z,q,W,Y,re,K;let e=$k(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:o,substitution:s,event:l}=t;if(!r||!a)return ee({result:{error:pr},stack:i});if(r===a)return{...J};let{inContextDualMatchUp:u,inContextTieMatchUp:c,collectionPosition:d,collectionId:p,dualMatchUp:m,tieMatchUp:h,tieFormat:f}=e,g=c==null?void 0:c.matchUpType,v=(k=c==null?void 0:c.sides)==null?void 0:k.find(H=>{var Q,X,ie;return((Q=H.participant)==null?void 0:Q.participantId)===r||((ie=(X=H.participant)==null?void 0:X.individualParticipantIds)==null?void 0:ie.includes(r))});if(!v)return{error:zi};let y=((x=Mi({tournamentRecord:n,participantFilters:{participantIds:[r,a]}}))==null?void 0:x.participants)??[];if(y.length!==2)return ee({result:{error:pr},stack:i});if(y[0].participantType!==y[1].participantType)return ee({result:{error:Ts},stack:i});let{appliedPolicies:I}=$t({tournamentRecord:n,drawDefinition:o,event:l}),b=((F=t.policyDefinitions)==null?void 0:F[Or])??(I==null?void 0:I[Or])??Bg[Or],S=y.find(({participantId:H})=>H===a);if((t.enforceGender??(($=b==null?void 0:b.participants)==null?void 0:$.enforceGender))!==!1&&[Jt,pi].includes(c==null?void 0:c.gender)&&(c==null?void 0:c.gender)!==((_=S==null?void 0:S.person)==null?void 0:_.sex))return{error:Vm,info:"Gender mismatch"};let w=(L=b==null?void 0:b.processCodes)==null?void 0:L.substitution;yb({tournamentId:n.tournamentId,eventId:l.eventId,inContextDualMatchUp:u,drawDefinition:o,dualMatchUp:m});let U=(B=m==null?void 0:m.sides)==null?void 0:B.find(({sideNumber:H})=>H===v.sideNumber);if(!U)return ee({result:{sideNumber:v.sideNumber,existingParticipantId:r,error:_r},stack:i});if((G=(V=c==null?void 0:c.sides)==null?void 0:V.flatMap(H=>{var Q,X;return((Q=H.participant)==null?void 0:Q.individualParticipantIds)||((X=H.participant)==null?void 0:X.participantId)||[]}))!=null&&G.includes(a))return ee({result:{error:W0},stack:i});let T=(z=(j=u==null?void 0:u.sides)==null?void 0:j.find(({sideNumber:H})=>H===v.sideNumber))==null?void 0:z.participantId,D=U.lineUp,P=D==null?void 0:D.find(({participantId:H})=>a===H),C=D==null?void 0:D.reduce((H,Q)=>Q.substitutionOrder>H?Q.substitutionOrder:H,0),R=(D==null?void 0:D.map(H=>{var X;let Q=Me(H,!1,!0);if(![r,a].includes(Q.participantId))return Q;if(!s&&[r,a].includes(Q.participantId)&&(Q.collectionAssignments=(X=Q.collectionAssignments)==null?void 0:X.filter(ie=>!(ie.collectionPosition===d&&ie.collectionId===p))),s&&r===Q.participantId&&(Q.collectionAssignments=Q.collectionAssignments.map(ie=>ie.collectionPosition===d&&ie.collectionId===p&&ie.substitutionOrder===void 0?{...ie,substitutionOrder:C}:ie)),Q.participantId===a){Q.collectionAssignments||(Q.collectionAssignments=[]);let ie={collectionId:p,collectionPosition:d};s&&(ie.previousParticipantId=r,ie.substitutionOrder=(C??0)+1),Q.collectionAssignments.push(ie)}return Q}))??[];if(!P){let H={collectionId:p,collectionPosition:d};s&&(H.substitutionOrder=(C??0)+1,H.previousParticipantId=r);let Q={collectionAssignments:[H],participantId:a};R.push(Q)}let N=g===Qt,{assignedParticipantIds:A}=TS({lineUp:D,collectionPosition:d,collectionId:p}),{assignedParticipantIds:M}=TS({lineUp:R,collectionPosition:d,collectionId:p});if(U.lineUp=R,T&&f){let H=lh({participantId:T,lineUp:R,drawDefinition:o,tieFormat:f});if(H.error)return ee({result:H,stack:i})}else console.log("team participantId not found");let E,O;if(N){let{tournamentRecord:H}=t,Q=Qo({participantIds:M,tournamentRecord:H});if(!Q.participant){let ie=nl({returnParticipant:!0,pairOverride:!0,tournamentRecord:H,participant:{participantRole:Zr,individualParticipantIds:M,participantType:ht}});if(ie.error)return ee({result:ie,stack:i});E=(q=ie.participant)==null?void 0:q.participantId}Q=Qo({participantIds:A,tournamentRecord:H});let X=(W=Q.participant)==null?void 0:W.participantId;X&&oh({participantIds:[X],tournamentRecord:H}).success&&(O=X)}if(s||((Y=v.substitutions)==null?void 0:Y.length)===1){if(s)w&&h&&(h.processCodes=ct([...(h==null?void 0:h.processCodes)??[],...w]));else for(let H of w||[]){let Q=(re=h==null?void 0:h.processCodes)==null?void 0:re.lastIndexOf(H);Q!==void 0&&((K=h==null?void 0:h.processCodes)==null||K.splice(Q,1))}h&&Rt({tournamentId:n==null?void 0:n.tournamentId,matchUp:h,context:i,drawDefinition:o})}return m&&Rt({tournamentId:n==null?void 0:n.tournamentId,matchUp:m,context:i,drawDefinition:o}),{...J,modifiedLineUp:R,participantRemoved:O,participantAdded:E}}function B4({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){var u;if(!a||!t||!Array.isArray(n))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:oe};let o=(i==null?void 0:i.lineUp)||((u=Ld({participantId:e,drawDefinition:r}))==null?void 0:u.lineUp),s=[],l=[];return{modifiedLineUp:(o==null?void 0:o.map(c=>{var p;if(!n.includes(c.participantId))return c;let d=(p=c.collectionAssignments)==null?void 0:p.filter(m=>{let h=m.collectionId===a&&m.collectionPosition===t;return h&&(m.previousParticipantId&&s.push(m.previousParticipantId),l.push({participantId:c.participantId,...m})),!h});return{participantId:c.participantId,collectionAssignments:d}}).filter(Boolean))||[],assignmentsRemoved:l,previousParticipantIds:s}}function Zpe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var a,o;let r=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===sr&&((l=s==null?void 0:s.entries)==null?void 0:l.some(u=>u.participantId===e))}),n=s=>!t.includes(s.participantId);for(let s of r){s.entries=(s.entries||[]).filter(n);let{flightProfile:l}=Gi({event:s});(a=l==null?void 0:l.flights)==null||a.forEach(u=>{u.drawEntries=(u.drawEntries||[]).filter(n)}),(o=s==null?void 0:s.drawDefinitions)==null||o.forEach(u=>{u.entries=(u.entries||[]).filter(n)})}return{...J}}function ED({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return ee({result:{error:ge},stack:n});if(!e||!t)return ee({result:{error:Xe},stack:n});let a=r.participants??[],o=a.find(d=>d.participantId===e);if(!o)return ee({result:{error:zi},stack:n});if(o!=null&&o.participantType&&![Kt,Wa].includes(o.participantType))return ee({context:{participantType:o.participantType},result:{error:Ts},stack:n});let s=t.filter(d=>{var p;return((p=a.find(m=>m.participantId===d))==null?void 0:p.participantType)!==St});if(s.length)return ee({result:{error:va,invalidParticipantIds:s},stack:n});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&LT({individualParticipantIds:u,tournamentRecord:r}),o.individualParticipantIds=o.individualParticipantIds.concat(...u));let{topics:c}=vo();if(c.includes(nn)){let d=a.find(({participantId:p})=>p===e);lt({topic:nn,payload:{participants:[d]}})}return Zpe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:Me(o,!1,!0),added:u.length,...J}}function MD(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:o}=t;if(!n)return{error:ge};if(!o)return{error:jm};if(!o.participantId)return nl({tournamentRecord:n,participant:o});let{participant:s}=qc({participantId:o.participantId,tournamentRecord:n});if(!s)return nl({tournamentRecord:n,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:m,onlineResources:h,contacts:f,person:g}=o;if(m&&s.participantType!==m)return{error:HG};let v={};if(f&&(v.contacts=f),h&&(v.onlineResources=h),c&&Ti(c)&&(v.participantOtherName=c),d&&Ti(d)&&(v.participantName=d),Array.isArray(u)){let{participants:y}=Mi({participantFilters:{participantTypes:[St]},tournamentRecord:n}),I=y==null?void 0:y.map(Ut);if(I){let b=u.filter(S=>Ti(S)&&I.includes(S));([Wa,hi].includes(m||s.participantType)||m===ht&&(b.length===2||a))&&(v.individualParticipantIds=b),s.participantType===zv.PAIR&&e&&(v.participantName=Qpe({individualParticipants:y,newValues:v}))}}return Object.keys(zA).includes(p)&&(v.participantRole=p),Object.keys(zv).includes(m)&&(v.participantType=m),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===zv.INDIVIDUAL&&g&&eme({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,Ge(v)),i&&ED({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),lt({topic:nn,payload:{tournamentId:n.tournamentId,participants:[s]}}),{participant:Me(s),...J}}function Qpe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function eme({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:l,birthdate:u,tennisId:c,sex:d}=r;d&&Object.keys(iT).includes(d)&&(n.sex=d);let p;if(Ti(l)&&(n.personId=l),s&&Ti(s)&&(tme(s)||s==="")&&(n.nationalityCode=s),a&&typeof Ti(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),o&&typeof Ti(o)&&o.length>1&&(n.standardGivenName=o,p=!0),p&&t){let m=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=m}u&&Ia(u)&&(n.birthdate=u),c&&Ti(c)&&(n.tennisId=c),Object.assign(e.person,n)}function tme(t){return Yp.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function BS(t){var F,$,_,L,B,V,G,j,z,q,W,Y,re,K,H,Q,X,ie,ae,le;let e=$k(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",r=t.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:o,event:s}=t;if(!o)return ee({result:{error:pr},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return ee({result:{error:vN},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:u,relevantAssignments:c,collectionPosition:d,teamParticipants:p,collectionId:m,matchUpType:h,dualMatchUp:f,tieFormat:g}=e;if(($=(F=u==null?void 0:u.sides)==null?void 0:F.flatMap(ne=>{var de,Ie;return((de=ne.participant)==null?void 0:de.individualParticipantIds)||((Ie=ne.participant)==null?void 0:Ie.participantId)||[]}))!=null&&$.includes(o))return ee({result:{...J},stack:i});r=r??(t.sideNumber?(L=(_=l==null?void 0:l.sides)==null?void 0:_.find(ne=>ne.sideNumber===t.sideNumber))==null?void 0:L.participantId:void 0);let v=(V=(B=Mi({participantFilters:{participantIds:[o]},tournamentRecord:n}))==null?void 0:B.participants)==null?void 0:V[0];if(!v)return ee({result:{error:zi},stack:i});let{appliedPolicies:y}=$t({tournamentRecord:n,drawDefinition:a,event:s}),I=((G=t.policyDefinitions)==null?void 0:G[Or])??(y==null?void 0:y[Or])??Bg[Or];if((t.enforceGender??((j=I==null?void 0:I.participants)==null?void 0:j.enforceGender))!==!1&&[Jt,pi].includes(u==null?void 0:u.gender)&&(u==null?void 0:u.gender)!==((z=v.person)==null?void 0:z.sex))return{error:Vm,info:"Gender mismatch"};let{individualParticipantIds:b,participantType:S}=v;if(Yi(ti)(h)&&S!==St)return{error:Ts};let w=S===St?[o]:b,U=r&&(p==null?void 0:p.find(({participantId:ne})=>ne===r))||(p==null?void 0:p.find(({individualParticipantIds:ne})=>Rn(w,ne)));if(!U)return{error:PN};if(r||(r=U.participantId),!r)return{error:zi};let T=(q=c==null?void 0:c.find(ne=>ne.participantId===(U==null?void 0:U.participantId)))==null?void 0:q.drawPosition,D=(Y=(W=f==null?void 0:f.sides)==null?void 0:W.find(ne=>ne.participantId===r))==null?void 0:Y.sideNumber,P=(K=(re=u==null?void 0:u.sides)==null?void 0:re.find(ne=>T&&ne.drawPosition===T))==null?void 0:K.sideNumber,C=D??P??t.sideNumber;if(!g)return{error:Pg};if(!((H=g.collectionDefinitions)!=null&&H.find(ne=>ne.collectionId===m)))return{error:xG};yb({tournamentId:n.tournamentId,eventId:s.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:f});let R=(Q=f==null?void 0:f.sides)==null?void 0:Q.find(ne=>ne.sideNumber===C),N=(X=u==null?void 0:u.sides)==null?void 0:X.find(ne=>ne.sideNumber===C),A=(le=(ae=(R==null?void 0:R.lineUp)??((ie=Ld({participantId:r,drawDefinition:a}))==null?void 0:ie.lineUp))==null?void 0:ae.filter(ne=>{var de;return(de=ne.collectionAssignments)==null?void 0:de.find(Ie=>Ie.collectionPosition===d&&Ie.collectionId===m&&!Ie.previousParticipantId)}))==null?void 0:le.map(ne=>ne==null?void 0:ne.participantId),M=(A==null?void 0:A.length)>1&&A||(S===ht?v.individualParticipantIds:[o]),E=B4({collectionPosition:d,teamParticipantId:r,dualMatchUpSide:R,drawDefinition:a,participantIds:M,collectionId:m});if(E.error)return ee({result:E,stack:i});let{modifiedLineUp:O}=E,k;if(h===Qt){if(S!==ht){let ne=IC({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:o,collectionId:m,tieFormat:g});if(ne!=null&&ne.error)return ee({result:ne,stack:i});if(ne=x({side:N}),ne.error)return ne;k=ne.deletedParticipantId,R&&(R.lineUp=O),f&&Rt({tournamentId:n==null?void 0:n.tournamentId,matchUp:f,context:i,drawDefinition:a})}else if(S===ht)for(let ne of M)IC({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:ne,collectionId:m,tieFormat:g})}else{let ne=IC({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:o,collectionId:m,tieFormat:g});if(ne!=null&&ne.error)return ne}if(R&&(R.lineUp=O),f&&Rt({tournamentId:n==null?void 0:n.tournamentId,matchUp:f,context:i,drawDefinition:a}),k){let{error:ne}=oh({participantIds:[k],tournamentRecord:n});ne&&console.log("cleanup")}return{...J,modifiedLineUp:O};function x({side:ne}){let de;if(ne.participant){let Ie=ne.participant.individualParticipantIds||[];if(Ie.filter(Boolean).length===1){let{participant:ce}=Qo({participantIds:Ie,tournamentRecord:n});Ie.push(o);let{participant:ke}=Qo({participantIds:Ie,tournamentRecord:n});if(!ke&&ce){ce.individualParticipantIds=Ie;let Pe=MD({pairOverride:!0,tournamentRecord:n,participant:ce});if(Pe.error)return Pe}else de=ce==null?void 0:ce.participantId}}else{let Ie=nl({participant:{individualParticipantIds:[o],participantRole:Zr,participantType:ht},pairOverride:!0,tournamentRecord:n});if(Ie.error)return Ie}return{...J,deletedParticipantId:de}}}function IC({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:o}){var c,d;let s=(c=Ld({participantId:e,drawDefinition:i}))==null?void 0:c.lineUp,l=(d=r||s)==null?void 0:d.find(p=>(p==null?void 0:p.participantId)===n),u={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(u);else{let p={collectionAssignments:[u],participantId:n};r.push(p)}return lh({participantId:e,lineUp:r,drawDefinition:i,tieFormat:o})}function V4(t){var C,R,N,A,M,E,O,k,x,F,$,_,L,B,V,G,j,z,q,W,Y,re,K;let{tournamentRecord:e,drawDefinition:i,participantId:r,event:n}=t,a="removeTieMatchUpParticiapantId";if(!r)return ee({result:{error:pr},stack:a});let o=$k(t);if(o.error)return o;let{appliedPolicies:s}=$t({tournamentRecord:e,drawDefinition:i,event:n}),l=(N=(R=((C=t.policyDefinitions)==null?void 0:C[Or])??(s==null?void 0:s[Or])??Bg[Or])==null?void 0:R.processCodes)==null?void 0:N.substitution,{inContextDualMatchUp:u,inContextTieMatchUp:c,relevantAssignments:d,collectionPosition:p,teamParticipants:m,collectionId:h,matchUpType:f,dualMatchUp:g,tieMatchUp:v,tieFormat:y}=o;if(!g)return ee({result:{error:na},stack:a});let I=(A=c==null?void 0:c.sides)==null?void 0:A.find(H=>{var Q,X,ie;return((Q=H.participant)==null?void 0:Q.participantId)===r||((ie=(X=H.participant)==null?void 0:X.individualParticipantIds)==null?void 0:ie.includes(r))});if(!I)return ee({result:{error:zi},stack:a});let b=((M=t.policyDefinitions)==null?void 0:M[Ps])??(s==null?void 0:s[Ps]);if(!((E=I.substitutions)!=null&&E.length)&&(vr({score:c==null?void 0:c.score})||c!=null&&c.winningSide)&&(b==null?void 0:b.requireParticipantsForScoring)!==!1)return ee({result:{error:IH},stack:a});let S=(k=(O=u==null?void 0:u.sides)==null?void 0:O.find(({sideNumber:H})=>H===I.sideNumber))==null?void 0:k.participantId;if(!S)return ee({result:{error:zi},stack:a});let w=(F=(x=Mi({participantFilters:{participantIds:[r]},tournamentRecord:e}))==null?void 0:x.participants)==null?void 0:F[0];if(!w)return ee({result:{error:zi},stack:a});if(f===ti&&w.participantType===ht)return ee({result:{error:Vm},stack:a});let U=w.participantType===St?[r]:w.individualParticipantIds;yb({tournamentId:e.tournamentId,eventId:n.eventId,inContextDualMatchUp:u,drawDefinition:i,dualMatchUp:g});let T=($=g.sides)==null?void 0:$.find(({sideNumber:H})=>H===I.sideNumber);if(!T&&(((_=g.sides)==null?void 0:_.filter(({lineUp:H})=>!H).length)||0)<2){let H=m==null?void 0:m.map(({participantId:Q})=>{var X;return{drawPosition:(X=d==null?void 0:d.find(ie=>ie.participantId===Q))==null?void 0:X.drawPosition,teamParticipantId:Q}});T=(L=g.sides)==null?void 0:L.find(Q=>{var X;return((X=H==null?void 0:H.find(({drawPosition:ie})=>ie===Q.drawPosition))==null?void 0:X.teamParticipantId)===S})}if(!T)return ee({result:{error:zi,context:{participantId:r}}});let{modifiedLineUp:D,previousParticipantIds:P}=B4({collectionPosition:p,teamParticipantId:S,dualMatchUpSide:T,participantIds:U,drawDefinition:i,collectionId:h});if(T.lineUp=D,S&&y&&lh({participantId:S,lineUp:D,drawDefinition:i,tieFormat:y}),f===Qt&&w.participantType===St){let H=(B=c==null?void 0:c.sides)==null?void 0:B.find(ie=>ie.sideNumber===(T==null?void 0:T.sideNumber)),{participantId:Q}=H??{},X=Q&&((G=(V=Mi({participantFilters:{participantIds:[Q]},tournamentRecord:e,withDraws:!0}))==null?void 0:V.participants)==null?void 0:G[0]);if(X){let ie=((j=X==null?void 0:X.individualParticipantIds)==null?void 0:j.filter(ae=>ae!==r))??[];if(P&&ie.push(...P),ie.length>2)return ee({result:{error:va},stack:a});if((z=X.draws)!=null&&z.length){if(ie.length===1){let{participant:ae}=Qo({participantIds:ie,tournamentRecord:e});if(!ae){let le=nl({participant:{participantRole:Zr,individualParticipantIds:ie,participantType:ht},pairOverride:!0,tournamentRecord:e});if(le.error)return ee({result:le,stack:a})}}}else if(ie.length){X.individualParticipantIds=ie;let ae=MD({participant:X,pairOverride:!0,tournamentRecord:e});if(ae.error)return ee({result:ae,stack:a})}else{let ae=oh({participantIds:[Q],tournamentRecord:e});ae.error&&console.log("cleanup",{result:ae})}}else return ee({result:{error:zi},stack:a})}if(((q=I.substitutions)==null?void 0:q.length)===1&&!((re=(Y=(W=c==null?void 0:c.sides)==null?void 0:W.find(H=>H.sideNumber!==I.sideNumber))==null?void 0:Y.substitutions)!=null&&re.length)&&((K=v==null?void 0:v.processCodes)!=null&&K.length)){for(let H of l||[]){let Q=v.processCodes.lastIndexOf(H);v.processCodes.splice(Q,1)}Rt({tournamentId:e==null?void 0:e.tournamentId,matchUp:v,context:a,drawDefinition:i})}return Rt({tournamentId:e==null?void 0:e.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...J,modifiedLineUp:D}}function Vk(t){var l,u;let e=ze(t,[{[br]:!0,[Fn]:!0,[hl]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=t;if(r&&![1,2].includes(r))return{error:oe,sideNumber:r};let{matchUp:o,structure:s}=wi({drawDefinition:i,matchUpId:n,event:a});return o?zn({structure:s})?((l=o.sides)==null||l.forEach(c=>{(!r||c.sideNumber===r)&&delete c.participantId}),Rt({tournamentId:(u=t.tournamentRecord)==null?void 0:u.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:o}),{...J}):{error:sN}:{error:dn}}function ime({matchUpStatuses:t=[Vt,zt,Mt],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){var c;let n=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),a=(c=n==null?void 0:n.drawPositions)==null?void 0:c.find(d=>d!==i),o=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(a)}).map(d=>d.matchUpStatus),s=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),l=Rn(o||[],t),u=Rn(s||[],t);return{sourceMatchUp:n,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:o,loserHadMatchUpStatus:u,loserMatchUpStatuses:s}}function rme({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=et({drawDefinition:a,structureId:o});if((d==null?void 0:d.structureType)===xn)return{...J};u=u??sn({drawDefinition:a});let p=((u==null?void 0:u.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:m}=Um({drawPosition:i,matchUps:p}),h=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==m&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:f}=ai({drawDefinition:a,structureId:o});for(let g of h??[])nme({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:f,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:s,matchUpsMap:u,matchUp:g,event:c});return{...J}}function nme({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:u,event:c}){var m,h,f;let d="removeSubsequentDrawPosition";if(s){let g=(h=(m=t.find(({matchUpId:y})=>u.matchUpId===y).sides)==null?void 0:m.find(y=>y.drawPosition===r))==null?void 0:h.sideNumber,v=(f=u.sides)==null?void 0:f.find(y=>y.sideNumber===g);v&&delete v.lineUp}u.drawPositions=(u.drawPositions||[]).map(g=>g===r?void 0:g).filter(Boolean);let p=e.filter(({drawPosition:g})=>{var v;return(v=u.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return u.matchUpStatus=p&&Vt||[Mt,zt].includes(u.matchUpStatus)&&u.matchUpStatus||Ji,[zt,Mt].includes(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&dq({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),Rt({tournamentId:n==null?void 0:n.tournamentId,eventId:c==null?void 0:c.eventId,context:`${d}-${r}`,drawDefinition:o,matchUp:u}),{...J}}function Jg(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,m=zn({structure:c}),{drawPositions:h,winningSide:f}=l.matchUp||{};if(!m&&!h)return{error:Dy};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:I,winnerMatchUp:b,byeMatchUp:S}}=l,w=zs({...t,matchUpStatus:a||Ji,removeWinningSide:!0});if(w.error)return w;let U;if(p){let{matchUpTieId:O,matchUpsMap:k}=t;if(U=Wu({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:k,event:d}),!e&&!U.removeWinningSide)return{...J}}if(m)return{...J};let{matchUps:T}=Wt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:o,structure:c}),{positionAssignments:D}=Rr({structure:c}),P=f-1,C=1-P,R=h[P],N=h[C],{winnerParticipantId:A,loserParticipantId:M}=(D==null?void 0:D.reduce((O,k)=>(k.drawPosition===N&&(O.loserParticipantId=k.participantId),k.drawPosition===R&&(O.winnerParticipantId=k.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},E=T.filter(O=>{var k;return(k=O.drawPositions)==null?void 0:k.includes(N)});if(b&&j4({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:A,tournamentRecord:r,winnerTargetLink:v,drawDefinition:n,winnerMatchUp:b,dualMatchUp:s,matchUpsMap:o}),I){let{winnerHadMatchUpStatus:O}=ime({drawPositionMatchUps:E,loserDrawPosition:N,sourceMatchUps:T}),k=g.linkCondition===el;if(O&&k){let F=Math.min(...I.drawPositions);n1({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:F,matchUpsMap:o,event:d})}let x=ame({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:M,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:I,dualMatchUp:s,matchUpsMap:o,event:d});if(x.error)return x}if(S){let O=Math.min(...S.drawPositions);n1({sourceMatchUpId:u,targetLink:y,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:o,event:d})}return{...J,...U&&{tieMatchUpResult:U}}}function j4({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){var f,g;let{structureId:p,roundNumber:m}=l,h="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=et({drawDefinition:s,structureId:v});if(!y)return{error:Ei};let{positionAssignments:I}=Rr({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(D=>D.participantId!==r);let b=(f=I==null?void 0:I.find(D=>D.participantId===r))==null?void 0:f.drawPosition,{matchUps:S}=Wt({drawDefinition:s,structure:y,event:d}),w=S.map(D=>D.drawPositions).flat(1/0).filter(Boolean),U=wa(w);if((b?U[b]:void 0)===1)I==null||I.forEach(D=>{D.participantId===r&&delete D.participantId});else{let D=S.filter(({drawPositions:P})=>P.includes(b));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:D,winnerTargetLink:a})}let T=(g=u==null?void 0:u.drawMatchUps)==null?void 0:g.find(({matchUpId:D})=>D===l.matchUpId);T&&Rt({tournamentId:n==null?void 0:n.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:T,context:h,drawDefinition:s})}return m&&rme({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:c,matchUpsMap:u,roundNumber:m,structureId:p}),{...J}}function ame({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:u}){var f,g,v;let c="removeDirectedLoser",d=r.target.structureId,{structure:p}=et({drawDefinition:a,structureId:d});if(!p)return{error:Ei};let{positionAssignments:m}=Rr({structure:p}),h=(f=m==null?void 0:m.find(y=>y.participantId===e))==null?void 0:f.drawPosition;if(m==null||m.forEach(y=>{y.participantId===e&&delete y.participantId}),p.seedAssignments=(p.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=o==null?void 0:o.sides.reduce((S,w,U)=>w.drawPosition===h?U:S,void 0),I=(g=s==null?void 0:s.drawMatchUps)==null?void 0:g.find(({matchUpId:S})=>S===o.matchUpId),b=(v=I==null?void 0:I.sides)==null?void 0:v[y];b&&(delete b.lineUp,Rt({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:I,context:c,drawDefinition:a}))}return{...J}}function n1({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:o}){let s=a.target.structureId,l="removeDirectedBye";Aa({color:"brightyellow",method:l,drawPosition:r});let u=ab({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:s,event:o});return ee({result:u,stack:l})}function ome(t){var l,u;let{matchUpFormat:e,score:i}=t,r=(l=i==null?void 0:i.sets)==null?void 0:l.length,n=e&&kn(e),{setFormat:a,finalSetFormat:o,bestOf:s}=n??{};return((u=s&&r===s&&o||a)==null?void 0:u.timed)||!1}function sme({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){var s;let n="attemptToSetMatchUpStatusBYE";if(r!=null&&r.winningSide)return ee({result:{error:Dg},context:{matchUpStatus:Vt},stack:n});let{positionAssignments:a}=Rr({structure:i}),o=a==null?void 0:a.filter(l=>l.bye).map(l=>l.drawPosition);return(s=r.drawPositions)!=null&&s.some(l=>o==null?void 0:o.includes(l))?(r.matchUpStatus=Vt,r.matchUpStatusCodes=[],Rt({tournamentId:t==null?void 0:t.tournamentId,context:n,drawDefinition:e,matchUp:r}),{...J}):ee({result:{error:kG},info:"matchUp does not include BYE",stack:n})}function Xv(t){var g,v;let{tournamentRecord:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:o,event:s}=t,l="doubleExitAdvancement";if(o.structureType===xn)return ee({result:{...J},stack:l});let{matchUp:u,targetMatchUps:c,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:m,loserTargetDrawPosition:h}=c,f=[zt,Mt].includes(p==null?void 0:p.matchUpStatus)&&!((g=p.sides)!=null&&g.map(y=>y.participantId??y.participant).filter(Boolean).length);if(p&&p.matchUpStatus!==Vt){let{loserTargetLink:y}=d;if((v=i==null?void 0:i.progression)!=null&&v.doubleExitPropagateBye){let I=G4({loserTargetDrawPosition:h,tournamentRecord:e,loserTargetLink:y,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:s});if(I.error)return ee({result:I,stack:l})}else if(!f){let{feedRound:I,drawPositions:b,matchUpId:S}=p,w=I?2:2-b.indexOf(h),U=uV({...t,targetMatchUp:p,walkoverWinningSide:w,tournamentRecord:e,sourceMatchUp:u,matchUpId:S});if(U.error)return ee({result:U,stack:l})}}if(m){let y=uV({...t,matchUpId:m.matchUpId,targetMatchUp:m,tournamentRecord:e,sourceMatchUp:u});if(y.error)return ee({result:y,stack:l})}return ee({result:{...J},stack:l})}function uV(t){var V,G,j;let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:o}=t,s=r.structures.find(({structureId:z})=>z===a.structureId),l=t.matchUpStatus===cr?cr:er,u=t.matchUpStatus===cr?Mt:zt,c="conditionallyAdvanceDrawPosition",d=o.drawMatchUps.find(z=>z.matchUpId===a.matchUpId);if(!d)return{error:na};let p=(n==null?void 0:n.drawPositions)||[],m=(V=d.drawPositions)==null?void 0:V.filter(Boolean),h=(n==null?void 0:n.structureId)===a.structureId;if(h&&Rn(p,m)&&(m=m.filter(z=>!p.includes(z))),h&&m.length>1)return ee({result:{error:Sf},stack:c});let{pairedPreviousMatchUpIsDoubleExit:f,pairedPreviousMatchUp:g}=uq(t),v=En({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:y,targetLinks:I}=v,{loserTargetDrawPosition:b,winnerMatchUp:S,loserMatchUp:w}=y;if(w){let{loserTargetLink:z}=I,q=G4({loserTargetDrawPosition:b,loserMatchUp:w,tournamentRecord:i,loserTargetLink:z,drawDefinition:r,matchUpsMap:o});if(q.error)return ee({result:q,stack:c})}let U=((G=d.drawPositions)==null?void 0:G.filter(Boolean))||[],T=U.length===1,D=t.walkoverWinningSide||T&&OU({drawPosition:U[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,P=[zt,Mt].includes(d.matchUpStatus)&&!U.length,C=d.finishingRound===1,R=P&&!C?l:u,N=e.find(z=>z.matchUpId===g.matchUpId),A=[],M;n&&((n==null?void 0:n.structureId)===(N==null?void 0:N.structureId)?n.roundPosition<(g==null?void 0:g.roundPosition)?M=1:M=2:a.feedRound?n.structureId===a.structureId?M=2:M=1:D&&(M=3-D));let E=t.matchUpStatus,O=g==null?void 0:g.matchUpStatus;M===1?A=[{matchUpStatus:dU(E),previousMatchUpStatus:E,sideNumber:1},{matchUpStatus:dU(O),previousMatchUpStatus:O,sideNumber:2}]:M===2&&(A=[{matchUpStatus:dU(O),previousMatchUpStatus:O,sideNumber:1},{matchUpStatus:dU(E),previousMatchUpStatus:E,sideNumber:2}]),A.length&&(A=A.map(z=>Ge(z)));let k=zs({...t,winningSide:D,matchUp:d,matchUpStatusCodes:A,context:c,matchUpStatus:R});if(k.error)return ee({result:k,stack:c});if(P)return Xv({...t,matchUpStatus:R,targetData:v});if(!S)return ee({result:{...J},stack:c});let x=m.length===2?m[D-1]:m[0],{positionAssignments:F}=ai({structure:s}),$=F==null?void 0:F.find(z=>z.drawPosition===x),_=o.drawMatchUps.find(z=>z.matchUpId===S.matchUpId),L=(j=_==null?void 0:_.drawPositions)==null?void 0:j.filter(Boolean),B=L.length===1;if(x){if($!=null&&$.bye){let z=En({matchUpId:_.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(B){let q=L.filter(Boolean)[0],W=OU({drawPosition:q,matchUpId:_.matchUpId,inContextDrawMatchUps:e}),Y=zs({appliedPolicies:t.appliedPolicies,matchUpId:_.matchUpId,matchUp:_,matchUpStatus:u,matchUpStatusCodes:[],removeScore:!0,context:c,drawDefinition:r,winningSide:W});return Y.error?ee({result:Y,stack:c}):BA({drawPositionToAdvance:q,matchUpId:_.matchUpId,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:o})}else if([zt,Mt].includes(S.matchUpStatus)){let q=Xv({...t,matchUpId:_.matchUpId,matchUpStatus:R,targetData:z});if(q.error)return ee({result:q,stack:c})}return ee({result:{...J},stack:c})}return $f({matchUpId:S.matchUpId,drawPosition:x,inContextDrawMatchUps:e,drawDefinition:r})}else if(f){if(!_)return{error:na};if(B){let W=L[0],Y=OU({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:W});console.log("existing drawPosition is winningSide",{walkoverWinningSide:Y})}let z=[zt,Mt].includes(_.matchUpStatus)?u:l,q=zs({matchUpId:_.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:_,matchUpStatusCodes:[],removeScore:!0,context:c,drawDefinition:r,matchUpStatus:z});if(q.error)return ee({result:q,stack:c});if(z===l){let W=Xv({...t,matchUpId:a.matchUpId,matchUpStatus:z,targetData:v});if(W.error)return W}}return ee({result:{...J},stack:c})}function G4(t){var u;let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:o}=t,s=(u=r==null?void 0:r.target)==null?void 0:u.structureId,{structure:l}=et({drawDefinition:n,structureId:s});return l?Ya({drawPosition:e,tournamentRecord:i,drawDefinition:n,structureId:s,matchUpsMap:a,event:o}):{error:sp}}function dU(t){return t===er?zt:t===cr?Mt:t}function lme(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,o=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=r===Vt,u=a.winningSide,c=[er,cr].includes(r),d=rb({matchUpStatus:r}),p=xE({matchUpStatus:r}),m=!d&&!p,h=t.matchUpTieId||u&&d&&!c,f=u&&c,g=()=>zs({...t,removeScore:[ju,zt].includes(r),matchUpStatus:r||Ji});return m&&{error:fE}||h&&a1(t)||f&&ume(t)||u&&Jg(t)||p&&g()||l&&sme({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:fE}||c&&cme(t)||o&&a1(t)||ee({result:{error:Dg},stack:s})}function ume(t){let e=Jg(t);return e.error?e:Xv(t)}function cme(t){let e=a1({...t,removeScore:!0});return e.error?e:Xv(t)}function a1(t){var n;let e="scoreModification";if(t.isCollectionMatchUp&&((n=t.dualMatchUp)!=null&&n.winningSide)&&!t.projectedWinningSide){let a=Jg(t);if(a.error)return ee({result:a,stack:e})}let i=!!t.matchUp.collectionId,r=zs({...t,context:e});if(i){let{matchUpTieId:a,drawDefinition:o,matchUpsMap:s}=t,l=Wu({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:o,matchUpsMap:s});if(l.error)return ee({result:l,stack:e});Object.assign(r,{tieMatchUpResult:l})}return ee({result:r,stack:e})}function dme({drawDefinition:t,structure:e,matchUp:i}){var l,u,c,d;let{drawPositions:r}=i,{positionAssignments:n}=ai({drawDefinition:t,structure:e}),a=(l=n==null?void 0:n.filter(({drawPosition:p})=>r==null?void 0:r.includes(p)))==null?void 0:l.map(p=>{var h;let{extension:m}=gt({element:p,name:Sc});return(h=m==null?void 0:m.value)==null?void 0:h.groupOrder}),{containerStructures:o}=Fg({drawDefinition:t}),s=o[e.structureId];return{structureIds:(d=(c=(u=Lg({drawDefinition:t,structureId:s}))==null?void 0:u.links)==null?void 0:c.source)==null?void 0:d.filter(p=>{var m;return Rn(a,((m=p.source)==null?void 0:m.finishingPositions)||[])}).map(p=>p.source.structureId)}}function H4({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===Od&&Cc({drawDefinition:t,structure:e})){let{structureIds:n}=dme({drawDefinition:t,structure:e,matchUp:i});n!=null&&n.length&&r.push(...n)}return{connectedStructureIds:r}}function pme(t){var s,l,u;let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,o=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(o.target.feedProfile===Oo){let c=r.sides.find(({sideNumber:p})=>p!==a).participantId,d=i.find(p=>p.structureId===o.target.structureId&&p.roundNumber===o.target.roundNumber&&p.sides.some(({participantId:m})=>m===c));if((d==null?void 0:d.matchUpStatus)===Ji){let p=En({matchUpId:d.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Vd({inContextDrawMatchUps:i,drawDefinition:n,targetData:p})){let{structure:m}=et({structureId:d.structureId,drawDefinition:n}),h=ai({structure:m}).positionAssignments;for(let f of h||[])if(f.participantId===c){let g=r.sides.find(({sideNumber:v})=>v===a).participantId;if(f.participantId=g,m==null?void 0:m.positionAssignments)m.positionAssignments=h;else if(m!=null&&m.structures){let v=Object.assign({},...(h||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of m.structures)(l=y.positionAssignments)==null||l.forEach(I=>I.participantId=v[I.drawPosition])}Pc({tournamentId:(u=t.tournamentRecord)==null?void 0:u.tournamentId,event:t.event,drawDefinition:n,structure:m}),e=!0}}}}return{...J,qualifierReplaced:e}}function mme(t){var s,l,u,c,d;let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,o=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(o.target.feedProfile===Oo){let p=(l=r.sides.find(({sideNumber:f})=>f===a))==null?void 0:l.participantId,m=i.filter(f=>f.structureId===o.target.structureId&&f.roundNumber===o.target.roundNumber&&f.sides.some(({participantId:g,qualifier:v})=>v&&!g)),h=pa(m);if((h==null?void 0:h.matchUpStatus)===Ji){let f=En({matchUpId:h.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Vd({inContextDrawMatchUps:i,drawDefinition:n,targetData:f})){let g=(u=h.sides.find(I=>I.qualifier&&!I.participantId))==null?void 0:u.drawPosition,{structure:v}=et({structureId:h.structureId,drawDefinition:n});if(!v)return{error:Ei};let y=ai({structure:v}).positionAssignments;for(let I of y||[])if(I.drawPosition===g&&!I.participantId){if(I.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let b=Object.assign({},...(y||[]).map(S=>({[S.drawPosition]:S.participantId})));for(let S of v.structures)(c=S.positionAssignments)==null||c.forEach(w=>w.participantId=b[w.drawPosition])}Pc({tournamentId:(d=t.tournamentRecord)==null?void 0:d.tournamentId,event:t.event,drawDefinition:n,structure:v}),e=!0}}}}return{...J,qualifierPlaced:e}}function hme(t){var m,h;let e="attemptToSetWinningSide",i,{appliedPolicies:r,disableAutoCalc:n,drawDefinition:a,dualMatchUp:o,winningSide:s,structure:l,matchUp:u}=t;if(o!=null&&o._disableAutoCalc&&n!==!1)return yO(t);if(u.winningSide&&u.winningSide!==s){let{connectedStructureIds:f}=H4({drawDefinition:a,structure:l,matchUp:u});f.length&&(console.log({connectedStructureIds:f}),i=!0);let g=Jg(t);if(g.error)return g}let c=n3(t);if(c.error)return ee({result:c,stack:e});let d,p;return t.qualifierChanging&&((m=r==null?void 0:r[CI])!=null&&m.autoReplaceQualifiers)&&(d=pme(t).qualifierReplaced),t.qualifierAdvancing&&((h=r==null?void 0:r[CI])!=null&&h.autoPlaceQualifiers)&&(p=mme(t).qualifierPlaced),ee({result:Ge({...J,...c,connectedStructures:i,qualifierReplaced:d,qualifierPlaced:p}),stack:e})}var $U={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function z4(t){var g,v,y,I;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:o}=t,{matchUpId:s}=o,{iteration:l=0}=t;l+=1;let u="removeDoubleExit";Aa({color:"brightyellow",method:u,matchUpId:s,iteration:l,keyColors:$U});let{targetMatchUps:{loserMatchUp:c,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:m}}=a;if(d&&d.matchUpStatus!==Vt){let{stage:b,roundNumber:S,roundPosition:w,structureName:U}=d;Aa({winner:"winner",roundPosition:w,structureName:U,roundNumber:S,keyColors:$U,stage:b}),cV({...t,targetMatchUp:d,sourceMatchUp:o,iteration:l})}let h=(c==null?void 0:c.matchUpStatus)===Vt&&((c==null?void 0:c.feedRound)||(c==null?void 0:c.roundNumber)===1),f=((v=(g=a==null?void 0:a.targetLinks)==null?void 0:g.loserTargetLink)==null?void 0:v.linkCondition)===el;if(h&&f){let b=e.filter(({roundNumber:U,structureId:T})=>T===o.structureId&&U===1),S=b.map(({roundPosition:U})=>U),w=Pr(S.sort(),2).find(U=>U.includes(o.roundPosition));if(((y=b.filter(({roundPosition:U})=>w.includes(U)))==null?void 0:y.map(({matchUpStatus:U})=>U)).every(U=>[cr,er].includes(U)))return ee({result:{...J},stack:u})}if(c&&(c.matchUpStatus!==Vt||h)){let b=e.find(({matchUpId:C})=>C===c.matchUpId),{structure:S}=et({drawDefinition:r,structureId:b.structureId}),{stage:w,roundNumber:U,roundPosition:T,feedRound:D,structureName:P}=c;if(Aa({loser:"loser",roundPosition:T,structureName:P,roundNumber:U,keyColors:$U,feedRound:D,stage:w}),((I=i==null?void 0:i.progression)==null?void 0:I.doubleExitPropagateBye)||h)n1({drawPosition:p,targetLink:m,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:n});else{let C=cV({...t,targetMatchUp:c,structure:S,iteration:l});if(C.error)return ee({result:C,stack:u})}}return ee({result:{...J},stack:u})}function cV(t){var b,S,w,U,T,D;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:o,structure:s,iteration:l}=t,u="conditionallyRemoveDrawPosition";Aa({method:u,structureName:s==null?void 0:s.structureName,iteration:l});let c=En({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:d}}=c,p=o==null?void 0:o.drawMatchUps.find(P=>P.matchUpId===a.matchUpId),m=[],h,f,g;if(a.feedRound)g=(S=(b=d==null?void 0:d.drawPositions)==null?void 0:b.filter(Boolean))==null?void 0:S.find(P=>a.drawPositions.includes(P));else if(!n)g=(w=Vi((a==null?void 0:a.drawPositions)||[],(d==null?void 0:d.drawPositions)||[]))==null?void 0:w[0];else if(f=(U=cq({structureId:s.structureId,matchUp:n,matchUpsMap:o}))==null?void 0:U.pairedPreviousMatchUp,h=[er,cr].includes(f==null?void 0:f.matchUpStatus),m=((T=f==null?void 0:f.drawPositions)==null?void 0:T.filter(Boolean))||[],[...gr,Vt].includes(f==null?void 0:f.matchUpStatus)||(f==null?void 0:f.winningSide)){let P=n.drawPositions||[],C=(D=a.drawPositions)==null?void 0:D.filter(Boolean);Rn(P,C)&&(C=C==null?void 0:C.filter(R=>!P.includes(R))),g=P.concat(m).find(R=>C==null?void 0:C.includes(R))}if(d&&g){let{stage:P,roundNumber:C,roundPosition:R,structureName:N}=d;Aa({method:"removeDirectedWinner",drawPositionToRemove:g,color:"brightgreen",roundPosition:R,structureName:N,roundNumber:C,keyColors:$U,stage:P}),j4({winningDrawPosition:g,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:o})}let v=z4({targetData:c,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:o,structure:s,iteration:l});if(v.error)return ee({result:v,stack:u});let y=fme({pairedPreviousDoubleExit:h,noContextTargetMatchUp:p}),I=!h;return v=zs({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],context:u,matchUpStatus:y,removeScore:I,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),v.error?ee({result:v,stack:u}):{...J}}function fme({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===Vt?Vt:t?[cr,Mt].includes(e==null?void 0:e.matchUpStatus)?Mt:zt:Ji}function gme(t){var o,s,l,u,c;let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=t,a=(o=t.targetData.targetLinks)==null?void 0:o.winnerTargetLink;if(a.target.feedProfile===Oo){let d=(l=(s=r.sides)==null?void 0:s.find(({sideNumber:m})=>m===r.winningSide))==null?void 0:l.participantId,p=i.find(m=>{var h;return m.structureId===a.target.structureId&&m.roundNumber===a.target.roundNumber&&((h=m.sides)==null?void 0:h.some(({participantId:f})=>f===d))});if(p&&p.matchUpStatus===Ji){let m=En({matchUpId:p.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Vd({inContextDrawMatchUps:i,drawDefinition:n,targetData:m})){let{structure:h}=et({structureId:p.structureId,drawDefinition:n}),f=ai({structure:h}).positionAssignments;for(let g of f||[])if(g.participantId===d){if(g.participantId=void 0,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(h==null?void 0:h.structures)||[])(u=y.positionAssignments)==null||u.forEach(I=>I.participantId=v[I.drawPosition])}Pc({tournamentId:(c=t.tournamentRecord)==null?void 0:c.tournamentId,event:t.event,drawDefinition:n,structure:h}),e=!0}}}}return{qualifierRemoved:e}}function vme(t){var f;let{matchUp:e,matchUpStatus:i,score:r,winningSide:n}=t,a="noDownStreamDependencies";if([er,cr].includes(e==null?void 0:e.matchUpStatus)&&![er,cr].includes(i)){let g=z4(t);if(g.error)return ee({result:g,stack:a})}let o=i===er,s=vr({score:r})&&!o&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!n),l=((f=t==null?void 0:t.inContextMatchUp)==null?void 0:f.collectionId)&&ome(t.inContextMatchUp),u=t.removeScore||!l&&![co,$a].includes(i||co),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!n&&!vr({score:r}),d=i&&i!==Ji,p=g=>{var T,D;let v,{structure:y,drawDefinition:I,dualMatchUp:b,disableAutoCalc:S}=t;if(b!=null&&b._disableAutoCalc&&S!==!1)return yO({...t,removeWinningSide:c});let{connectedStructureIds:w}=H4({drawDefinition:I,structure:y,matchUp:e});w.length&&(console.log({connectedStructureIds:w}),v=!0),Object.assign(t,{removeScore:g});let U=Jg(t);if(U.error)return U;if(t.removingQualifier&&((D=(T=t.appliedPolicies)==null?void 0:T[CI])!=null&&D.autoRemoveQualifiers)){let P=gme(t);return{...J,connectedStructures:v,...P}}return{...J,connectedStructures:v}};if(c&&n&&t.isCollectionMatchUp)return dV(t);let m=[ju,$a].includes(i)&&t.dualWinningSideChange,h=(n||m)&&hme(t)||s&&p(u)||d&&lme(t)||c&&p(u)||e&&dV({...t,removeScore:!0})||{...J};return ee({result:h,stack:a})}function dV(t){var r;let e="ndd:scoreModification";if(t.isCollectionMatchUp&&((r=t.dualMatchUp)!=null&&r.winningSide)&&!t.projectedWinningSide&&!t.autoCalcDisabled){let n=Jg(t);if(n.error)return n}let i=zs({...t,context:e});if(t.isCollectionMatchUp){let{matchUpTieId:n,drawDefinition:a,event:o,matchUpsMap:s}=t,{removeWinningSide:l}=Wu({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,drawDefinition:a,matchUpsMap:s,event:o});l&&console.log("REMOVE WINNING SIDE")}return ee({result:i,stack:e})}function jk(t){var c,d,p;let e=ze(t,[{[br]:!0,[Fn]:!0,[hl]:!0},{homeParticipantId:!0,[Bo]:pr}]);if(e.error)return e;let i=Wg(t,[{[Ag]:Xl,attr:{[pT]:!0}}]);if(i.error)return i;let r=(p=(d=(c=i==null?void 0:i.matchUp)==null?void 0:c.matchUp)==null?void 0:d.sides)==null?void 0:p.map(m=>m==null?void 0:m.participantId);if(t.homeParticipantId&&!(r!=null&&r.includes(t.homeParticipantId)))return{error:Ss};let{disableNotice:n=!0,homeParticipantId:a,removePriorValues:o,tournamentRecord:s,drawDefinition:l,matchUpId:u}=t;return Da({duplicateValues:!1,removePriorValues:o,tournamentRecord:s,drawDefinition:l,disableNotice:n,matchUpId:u,timeItem:{itemType:kA,itemValue:a}})}function W4({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=fp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:MT});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function Jc(t){var m;let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:o,scheduledTime:s,matchUpId:l}=t;if(!l)return ee({result:{error:yn},stack:e});if(!Mg(s))return ee({result:{error:Mo},stack:e});if(!i){let h=wi({drawDefinition:a,matchUpId:l});if(h.error)return ee({result:h,stack:e});i=h.matchUp}let u=pt(s),c=ih({matchUp:i}).scheduledDate,d=u&&!c;if((m=W4({matchUp:i}).timeModifiers||[])!=null&&m.length){let h=q4({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(h!=null&&h.error)return ee({result:h,stack:e})}let p=Wm(s,!0,d);return Da({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:o,matchUpId:l,timeItem:{itemType:eh,itemValue:p}})}function q4({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return ee({result:{error:yn},stack:s});if(n!==void 0&&!Array.isArray(n))return ee({info:$d("timeModifiers"),result:{error:oe},stack:s});if(!o){let d=wi({drawDefinition:i,matchUpId:a});if(d.error)return ee({result:d,stack:s});o=d.matchUp}let l=W4({matchUp:o}).timeModifiers||[],u=n.filter(d=>!l.includes(d));if(n.length&&!u.length)return{...J};if(u.some(d=>NE.includes(d))){l=l.filter(p=>!NE.includes(p));let d=Jc({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return ee({result:d,stack:s})}let c=n!=null&&n.length?[...u,...l]:void 0;return Da({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:MT,itemValue:c}})}function ND({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:yn};let o=t&&Zs.test(t);if(t&&!o)return{error:Nr};let s={itemValue:pt(t),itemType:Qm};return Da({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s})}function AD({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtIds:s}){var c,d;if(!i&&!e)return{error:ge};if(!o)return{error:yn};let l=wi({drawDefinition:r,matchUpId:o});if(l.error)return l;if(((c=l==null?void 0:l.matchUp)==null?void 0:c.matchUpType)!==ka)return{error:aa};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:oe,context:{courtIds:s}};let u;if(s){let p=e||i&&{[i.tournamentId]:i},m=qu({tournamentRecords:p});if(m.error)return m;let h=(d=m.courts)==null?void 0:d.filter(f=>s.includes(f.courtId));if((h==null?void 0:h.length)!==s.length)return{error:oe,context:{courtIds:s}};u=h==null?void 0:h.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return Da({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:jl,itemDate:a,itemValue:u}})}function Zg({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:o}){if(!i)return{error:ge};if(!a)return{error:yn};if(o){let s=Jl({tournamentRecords:e,tournamentRecord:i,venueId:o});if(s.error)return s}return Da({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Zm,itemValue:o}})}function mh({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!e)return{error:ge};if(!o)return{error:yn};if(s){let u=rh({tournamentRecords:e,tournamentRecord:i,courtId:s});if(u.error)return u;let c=(l=u.venue)==null?void 0:l.venueId;Zg({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,venueId:c})}return Da({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:Rc,itemDate:a,itemValue:s}})}function Bs(t,e){let i=LH.test(t)?t:bi(t),r=pt(t)||pt(e)||$o(new Date);return new Date(`${r}T${i}`).getTime()}function OD(t){var M;let e="addMatchUpScheduleItems",i=ze(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[Xn]:ea}],e);if(i.error)return i;let{matchUpDependencies:r,inContextMatchUps:n}=t,{errorOnAnachronism:a=!1,checkChronology:o=!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,disableNotice:d,drawMatchUps:p,matchUpId:m,schedule:h,event:f}=t,g,v;if(p)g=p.find(E=>E.matchUpId===m);else{let E=wi({drawDefinition:c,event:f,matchUpId:m});if(E.error)return E;g=E.matchUp}let{endTime:y,courtId:I,courtIds:b,courtOrder:S,resumeTime:w,homeParticipantId:U,scheduledDate:T,scheduledTime:D,startTime:P,stopTime:C,timeModifiers:R,venueId:N}=h;o&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=ls({drawDefinition:c}));let A=(M=r==null?void 0:r[m])==null?void 0:M.matchUpIds;if(h.scheduledDate&&o&&A){let E=n==null?void 0:n.filter(O=>{var k,x;return(((k=O.schedule)==null?void 0:k.scheduledDate)||pt((x=O.schedule)==null?void 0:x.scheduledTime))&&A.includes(O.matchUpId)}).map(({schedule:O})=>{let k=pS(O);return new Date(k).getTime()});if(E!=null&&E.length){let O=pS(h),k=new Date(O).getTime();if(Math.max(...E)>=k){if(a)return ee({result:{error:pE},stack:e});v=pE}}}if(T!==void 0){let E=ND({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,scheduledDate:T,matchUpId:m});if(E!=null&&E.error)return ee({result:E,stack:e,context:{scheduledDate:T}})}if(D!==void 0){let E=Jc({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,scheduledTime:D,matchUpId:m,matchUp:g});if(E!=null&&E.error)return ee({result:E,stack:e,context:{scheduledTime:D}})}if(P!==void 0){let E=Hk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m,startTime:P,event:f});if(E!=null&&E.error)return ee({result:E,stack:e,context:{startTime:P}})}if(C!==void 0){let E=Wk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m,stopTime:C,event:f});if(E!=null&&E.error)return ee({result:E,stack:e,context:{stopTime:C}})}if(w!==void 0){let E=qk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,resumeTime:w,matchUpId:m,event:f});if(E!=null&&E.error)return ee({result:E,stack:e,context:{resumeTime:w}})}if(y!==void 0){let E=zk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m,endTime:y,event:f});if(E!=null&&E.error)return ee({result:E,stack:e,context:{endTime:y}})}if(b!==void 0){let E=AD({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m,courtIds:b});if(E!=null&&E.error)return ee({result:E,stack:e,context:{courtIds:b}})}if(I!==void 0&&T!==void 0){let E=mh({courtDayDate:T,disableNotice:!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,matchUpId:m,courtId:I});if(E!=null&&E.error)return ee({result:E,stack:e,context:{courtId:I}})}if(N!==void 0){let E=Zg({disableNotice:!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,matchUpId:m,venueId:N});if(E!=null&&E.error)return ee({result:E,stack:e,context:{venueId:N}})}if(S!==void 0&&ot(S)){let E=Gk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,courtOrder:S,matchUpId:m});if(E!=null&&E.error)return ee({result:E,stack:e,context:{courtOrder:S}})}if(R!==void 0){let E=q4({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,timeModifiers:R,matchUpId:m,matchUp:g});if(E!=null&&E.error)return ee({result:E,stack:e,context:{timeModifiers:R}})}return Ti(U)&&jk({disableNotice:!0,homeParticipantId:U,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m}),d||Rt({tournamentId:u==null?void 0:u.tournamentId,eventId:f==null?void 0:f.eventId,context:e,drawDefinition:c,matchUp:g}),v?{...J,warnings:[v]}:{...J}}function Gk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:yn};if(n&&!ot(n))return{error:oe,info:"courtOrder must be numeric"};let o=n&&Ze(n);return Da({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:ET,itemValue:o}})}function Y4({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:o}){if(!o)return{error:yn};if(!n)return{error:pr};if(e){let l=Mi({tournamentRecord:e,participantFilters:{participantTypes:[St],participantRoles:[HA]}}).participants??[];if(!Uc({tournamentParticipants:l,participantId:n}))return{error:zi}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(s.itemSubTypes=[a]),Da({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:o,timeItem:s})}function Hk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:o}){if(!n)return{error:yn};if(!Mg(a))return{error:Mo};let{matchUp:s}=wi({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=ih({matchUp:s}),u=((s==null?void 0:s.timeItems)??[]).filter(c=>[hu,Rl,Pu].includes(c==null?void 0:c.itemType)).map(c=>Bs(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||Bs(a,l)<u){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==hs));let c=Wm(a,!0,!0);return Da({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:hs,itemValue:c}})}else return{error:lH}}function zk({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:o,event:s}){if(!a)return{error:yn};if(!Mg(o))return{error:Mo};let{matchUp:l}=wi({drawDefinition:r,event:s,matchUpId:a}),{scheduledDate:u}=ih({matchUp:l}),c=((l==null?void 0:l.timeItems)??[]).filter(d=>[hs,Rl,hu].includes(d==null?void 0:d.itemType)).map(d=>Bs(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||Bs(o,u)>c){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Pu));let d=Wm(o,!0,!0);return Da({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Pu,itemValue:d}})}else return{error:oH}}function Wk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:o}){if(!n)return{error:yn};if(!Mg(a))return{error:Mo};let{matchUp:s}=wi({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=ih({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,f)=>f.itemType===Pu||h,void 0))return{error:UN};let c=u.filter(h=>[hs,Rl,hu].includes(h==null?void 0:h.itemType)).sort((h,f)=>Bs(h.itemValue,l)-Bs(f.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===hu,m=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Bs(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(Bs(a,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:Wm(a,!0,!0),itemType:hu};return Da({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:h})}else return{error:sH}}function qk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:o}){if(!a)return{error:yn};if(!Mg(n))return{error:Mo};let{matchUp:s}=wi({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=ih({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,f)=>f.itemType===Pu||h,void 0))return{error:UN};let c=u.filter(h=>[hs,Rl,hu].includes(h==null?void 0:h.itemType)).sort((h,f)=>Bs(h.itemValue,l)-Bs(f.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===Rl,m=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Bs(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(Bs(n,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:Wm(n,!0,!0),itemType:Rl};return Da({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:h})}else return{error:Mne}}function Ime({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:o,matchUp:s,event:l,score:u}){var p;let c=Me(n,void 0,!0);for(let m of(c==null?void 0:c.tieMatchUps)||[])m.matchUpId===s.matchUpId&&(m.winningSide=r,m.score=u,!vr({score:u})&&!e?Object.assign(m,{...zT}):e&&(m.matchUpStatus=e));a=a??((p=vn({matchUp:s,structure:o,drawDefinition:t,event:l}))==null?void 0:p.tieFormat);let{winningSide:d}=Ib({matchUp:c,drawDefinition:t,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:d}}function yme(t){var S;let{tournamentRecord:e,inContextMatchUp:i,structure:r,drawDefinition:n}=t,a=i.roundNumber,o=i.sides.find(w=>w.sideNumber===i.winningSide),s=i.sides.find(w=>w.sideNumber!==i.winningSide),{drawPosition:l,participantId:u}=o,{drawPosition:c,participantId:d}=s,p="swapWinnerLoser",{matchUps:m}=Wt(t),h=m.filter(({drawPositions:w,roundNumber:U})=>(w==null?void 0:w.includes(l))&&U>a);Fa({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:h}),h.forEach(w=>{var U,T;w.drawPositions=((U=w.drawPositions)==null?void 0:U.map(D=>D===l?c:D))||[],Rt({tournamentId:e==null?void 0:e.tournamentId,eventId:(T=t.event)==null?void 0:T.eventId,context:p,drawDefinition:n,matchUp:w})});let{stage:f,stageSequence:g}=r,v=n.structures.filter(({stage:w,stageSequence:U})=>w===f&&U>g).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:y,winnerTargetLink:I}}=t.targetData,b=[y==null?void 0:y.target.structureId,(S=I==null?void 0:I.target)==null?void 0:S.structureId].filter(Boolean);return n.structures.filter(({stage:w,structureId:U})=>w!==f&&b.includes(U)).forEach(({stage:w,stageSequence:U,structureId:T})=>{v.includes(T)||v.push(T),n.structures.filter(({stage:D,stageSequence:P})=>D===w&&P>U).forEach(({structureId:D})=>{v.includes(D)||v.push(D)})}),n.structures.filter(({structureId:w})=>v.includes(w)).forEach(w=>{let{positionAssignments:U}=ai({structure:w}),T=U==null?void 0:U.find(({participantId:P})=>P===u),D=U==null?void 0:U.find(({participantId:P})=>P===d);T&&(T.participantId=d),D&&(D.participantId=u)}),zs({...t,context:p})}function Ob(t){var $,_,L;let e="setMatchUpStatus";t.matchUpStatus&&[zt,er].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,tournamentRecords:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpStatus:u,winningSide:c,matchUpId:d,event:p,score:m}=t;if(!l)return{error:_e};if(u&&[ju,co,$a,Ji].includes(u)&&c)return{error:oe,winningSide:c,matchUpStatus:u};if(![void 0,...Jz].includes(u))return ee({result:{error:Dg},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let h=sn({drawDefinition:l}),{matchUps:f}=mr({nextMatchUps:!0,tournamentRecord:a,inContext:!0,drawDefinition:l,matchUpsMap:h,event:p}),g=h.drawMatchUps.find(B=>B.matchUpId===d),v=f==null?void 0:f.find(B=>B.matchUpId===d);if(!g||!f)return{error:dn};if((g.winningSide||c)&&u===Vt)return{context:"Cannot have Bye with winningSide",error:TU,matchUpStatus:u};let y=v==null?void 0:v.structureId,{structure:I}=et({drawDefinition:l,structureId:y}),b=Yi(hi)(g.matchUpType),S=($=v==null?void 0:v.drawPositions)==null?void 0:$.filter(Boolean),w=v==null?void 0:v.matchUpTieId,U=En({matchUpId:w||d,inContextDrawMatchUps:f,drawDefinition:l});Object.assign(t,{inContextDrawMatchUps:f,inContextMatchUp:v,matchUpTieId:w,matchUpsMap:h,targetData:U,structure:I,matchUp:g});let T=Vd(t),D;if(b){if(o)Lt({extension:{name:bm,value:!0},element:g});else if(s){let B=g.winningSide,{winningSide:V,scoreStringSide1:G,scoreStringSide2:j,set:z}=Ib({drawDefinition:l,matchUpsMap:h,structure:I,matchUp:g,event:p}),q={scoreStringSide1:G,scoreStringSide2:j,sets:z?[z]:[]};if(D=V!==B,T&&D)return ee({stack:"winningSideWithDownstreamDependencies",result:{error:z0},context:{winningSide:c,matchUp:g}});Un({name:bm,element:g}),Object.assign(t,{winningSide:V,dualWinningSideChange:D,projectedWinningSide:V,score:q})}yb({tournamentId:a==null?void 0:a.tournamentId,inContextDualMatchUp:v,eventId:p==null?void 0:p.eventId,dualMatchUp:g,drawDefinition:l})}if(b&&u&&[Ym].includes(u))return{info:"Not supported for matchUpType: TEAM",error:oe};if(m&&!b&&!r){let B=g.matchUpFormat??(I==null?void 0:I.matchUpFormat)??(l==null?void 0:l.matchUpFormat)??(p==null?void 0:p.matchUpFormat),V=GO({existingMatchUpStatus:g.matchUpStatus,matchUpFormat:B,matchUpStatus:u,winningSide:c,score:m});if(V.error)return V}let P=((_=$t({policyTypes:[CI,Ps],tournamentRecord:a,drawDefinition:l,event:p}))==null?void 0:_.appliedPolicies)??{};Nt(t.policyDefinitions)&&Object.assign(P,t.policyDefinitions);let C=wme({assignedDrawPositions:S,inContextMatchUp:v,appliedPolicies:P,drawDefinition:l,matchUpStatus:u,structure:I,matchUp:g});if(C!=null&&C.error)return C;let R=(v==null?void 0:v.stage)===Ye&&v.finishingRound===1,N=R&&c,A=R&&g.winningSide&&!c&&(!t.matchUpStatus||t.matchUpStatus&&xE({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!vr({outcome:t.outcome})),M=N&&c!==g.winningSide&&g.winningSide;if(Object.assign(t,{qualifierAdvancing:N,qualifierChanging:M,removingQualifier:A,appliedPolicies:P}),w){let{matchUp:B}=wi({matchUpId:w,inContext:!0,drawDefinition:l,matchUpsMap:h,event:p});if(B){let V=(L=vn({matchUp:B,drawDefinition:l,structure:I,event:p}))==null?void 0:L.tieFormat,{projectedWinningSide:G}=Ime({drawDefinition:l,matchUpStatus:u,dualMatchUp:B,matchUpsMap:h,winningSide:c,tieFormat:V,structure:I,matchUp:g,event:p,score:m}),j=B.winningSide;D=G!==j;let z=B._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:D,projectedWinningSide:G,autoCalcDisabled:z,matchUpTieId:w,dualMatchUp:B,tieFormat:V})}}let E=rb({matchUpStatus:u});if(!w){if(T&&!c&&(u&&xE({matchUpStatus:u})||u&&[er,cr].includes(u)))return{error:TU,activeDownstream:T,winningSide:c};if(c&&c===g.winningSide&&u&&!E)return{context:"winningSide must include directing matchUpStatus",error:TU,directingMatchUpStatus:E,matchUpStatus:u}}let{schedule:O}=t;if(O){let B=OD({disableNotice:!0,tournamentRecords:n,tournamentRecord:a,drawDefinition:l,matchUpId:d,schedule:O});if(B.error)return B}let k=!b&&!D&&c&&g.winningSide&&g.winningSide!==c;if(i&&k&&g.roundPosition)return yme(t);let x=c&&!w||t.projectedWinningSide;Aa({activeDownstream:T,matchUpWinner:x,method:e,winningSide:c});let F=!T&&vme(t)||x&&bme(t)||(E||t.autoCalcDisabled)&&K4(t)||{error:gH};return ee({result:F,stack:e})}function bme(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?K4(t):ee({stack:"winningSideWithDownstreamDependencies",result:{error:z0},context:{winningSide:i,matchUp:e}})}function K4(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!vr({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&Ji||t.winningSide&&qi||co:t.matchUpStatus||qi,o=t.removeScore||[ju,zt].includes(a)&&![co,$a].includes(a),s=zs({...t,matchUpStatus:a,removeWinningSide:n,context:"sms",removeScore:o});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=Wu({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:r});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function wme({assignedDrawPositions:t,inContextMatchUp:e,appliedPolicies:i,drawDefinition:r,matchUpStatus:n,structure:a,matchUp:o}){var c,d;if(((c=i==null?void 0:i[Ps])==null?void 0:c.requireParticipantsForScoring)===!1)return{...J};let s=(d=e==null?void 0:e.sides)==null?void 0:d.map(p=>p.participantId).filter(Boolean).length,l=o!=null&&o.sides?[]:ai({structureId:a==null?void 0:a.structureId,drawDefinition:r}).positionAssignments,u=s&&s===2||o.collectionId&&zn({structure:a})&&s&&s>=1||(t==null?void 0:t.length)===2&&(l==null?void 0:l.filter(p=>t.includes(p.drawPosition)).every(p=>p.participantId));return n&&Xz.includes(n)&&!u?ee({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:n,requiredParticipants:u},result:{error:Dg}}):{...J}}function X4({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:_e};let{matchUp:n}=wi({drawDefinition:e,matchUpId:i,event:r});return(n==null?void 0:n.matchUpType)!==ka?{error:aa}:Ob({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function J4({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:_e};if(!i)return{error:yn};let{matchUp:r}=wi({drawDefinition:t,event:e,matchUpId:i});return r?Un({name:IT,element:r}):{error:dn}}function Ume({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:o}){var m,h,f,g,v;let s="substituteParticipant";if(!r)return{error:_e};if(!a)return{error:yn};if(!e||!t)return ee({result:{error:pr},stack:s});let{matchUp:l}=wi({drawDefinition:r,matchUpId:a,event:o});if(!l)return{error:dn};if(!l.collectionId)return ee({result:{error:aa},stack:s});let u=sn({drawDefinition:r}),{matchUps:c}=mr({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:r,matchUpsMap:u}),d=c==null?void 0:c.find(y=>y.matchUpId===a),p=(h=(m=c==null?void 0:c.find(y=>y.matchUpId===(d==null?void 0:d.matchUpTieId)))==null?void 0:m.sides)==null?void 0:h.find(y=>y.participant.individualParticipants.some(({participantId:I})=>I===e));return!p||n&&p.sideNumber!==n?{error:Ss}:(v=(g=(f=p.participant)==null?void 0:f.individualParticipants)==null?void 0:g.map(Ut).filter(y=>y!==e))!=null&&v.includes(t)?Bk({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:o}):ee({result:{error:Ss},stack:s})}function Z4(t){return Ume(t)}function Q4({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:_e};let{matchUp:r}=wi({drawDefinition:t,matchUpId:e,event:i});return Lt({extension:{name:bm,value:!0},element:r})}function eY(t){let e="setMatchUpFormat",i=ze(t,[{tournamentRecord:!0},{[Kr]:S=>Ua({matchUpFormat:S}),[_a]:Ry,matchUpFormat:!0}]);if(i.error)return ee({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:m,event:h,force:f}=t;if(a&&!Array.isArray(a))return ee({result:{error:oe,scheduledDates:a},stack:e});if(u&&!_0([Qs,uo],u))return ee({result:{error:Ll},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],I=t.drawIds||m&&[m].filter(Boolean)||[];if((l||v!=null&&v.length)&&!n)return ee({result:{error:_e},stack:e});if(m&&c&&n){let S=qO({tournamentRecord:r,drawDefinition:n,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:c});if(S.error)return S;g+=1}let b=S=>{let w=[];for(let U of S.structures||[]){if(Array.isArray(p)&&!p.includes(U.stage)||Array.isArray(o)&&!o.includes(U.stageSequence)||v!=null&&v.length&&!v.includes(U.structureId))continue;v!=null&&v.length&&U.matchUpFormat!==s&&(U.matchUpFormat=s,w.push(U.structureId),g+=1);let T=((f||a)&&Wt({matchUpFilters:{matchUpStatuses:[Ji]},structure:U}).matchUps)??[],D=(a&&Wt({matchUpFilters:{matchUpStatuses:[Ji]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:U}).matchUps)??[];if(T!=null&&T.length){let P=D?D.map(Tr):T.map(Tr);for(let C of T)P.includes(C.matchUpId)&&(C.matchUpFormat=a!=null&&a.length?s:void 0,Rt({tournamentId:r==null?void 0:r.tournamentId,eventId:h==null?void 0:h.eventId,context:e,drawDefinition:S,matchUp:C}))}}return!w.length&&S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1),w};for(let S of(r==null?void 0:r.events)||[])if(!(y!=null&&y.length&&!y.includes(S.eventId)||u&&u!==S.eventType||u===sr))if(Array.isArray(o)||Array.isArray(p)||v!=null&&v.length||I!=null&&I.length)for(let w of S.drawDefinitions||[]){if(Array.isArray(I)&&!I.includes(w.drawId))continue;let U=b(w);si({structureIds:U,drawDefinition:w})}else S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1);return g?{...J,modificationsCount:g}:{...J,info:Eg}}function Yk({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){var l,u;if(!i)return{error:_e};let a=(l=wi({drawDefinition:i,matchUpId:r}))==null?void 0:l.matchUp;if(!(a!=null&&a.tieMatchUps))return{error:aa};let o=(u=wi({inContext:!0,drawDefinition:i,matchUpId:r,event:n}))==null?void 0:u.matchUp,s=0;return((a==null?void 0:a.sides)||[]).forEach(c=>{c.lineUp&&delete c.lineUp}),((o==null?void 0:o.sides)||[]).forEach(c=>{if(s+=1,t===!1){let d=o==null?void 0:o.tieFormat,p=c.participantId;d&&p&&lh({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}Rt({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:n==null?void 0:n.eventId,drawDefinition:i,matchUp:a})}),{...J,modificationsCount:s}}function tY(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}=t;if(!n)return{sets:[]};let a=n.sets||[],o=El({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:a}),s=El({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:a}),l=El({matchUpFormat:e,matchUpStatus:i,winningSide:r,sets:a}),u=o===l?s:o;return r&&(o=r===1?l:u,s=r===2?l:u),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function kb(t){var v,y;let e=ze(t,[{[hl]:!0,[Fn]:!0}]);if(e.error)return e;let i=Io(t);if(!t.drawDefinition){let I=t.tournamentRecord??(t.tournamentId&&i[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=I);let b=Wn({eventId:t.eventId,drawId:t.drawId,tournamentRecord:I});if(b.error)return b;b.drawDefinition&&(t.drawDefinition=b.drawDefinition),t.event=b.event}let{disableScoreValidation:r,policyDefinitions:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpId:u,schedule:c,event:d,notes:p}=t,m=t.matchUpFormat||((v=t.outcome)==null?void 0:v.matchUpFormat),{policy:h}=pp({policyType:Ps,tournamentRecord:a,event:d}),f=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(h==null?void 0:h.allowChangePropagation)!==void 0&&h.allowChangePropagation||void 0,{outcome:g}=t;if(g!=null&&g.winningSide&&![1,2].includes(g.winningSide))return{error:G0};if(m){let I=qO({tournamentRecord:a,drawDefinition:l,matchUpFormat:m,matchUpId:u,event:d});if(I.error)return I}if((y=g==null?void 0:g.score)!=null&&y.sets&&!g.score.scoreStringSide1){let{score:I}=tY(g);g.score=I,g.score.sets=g.score.sets.filter(b=>b.side1Score||b.side2Score||b.side1TiebreakScore||b.side2TiebreakScore)}return Ob({matchUpStatusCodes:g==null?void 0:g.matchUpStatusCodes,matchUpStatus:g==null?void 0:g.matchUpStatus,winningSide:g==null?void 0:g.winningSide,allowChangePropagation:f,disableScoreValidation:r,score:g==null?void 0:g.score,tournamentRecords:i,policyDefinitions:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpFormat:m,matchUpId:u,schedule:c,event:d,notes:p})}function iY(t){if(!(t!=null&&t.outcomes))return{error:Xe};if(!Array.isArray(t.outcomes))return{error:Xe,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:ge};let o=i.filter(s=>s.tournamentId===n);if(o.length){let s=Sme({outcomes:o,tournamentRecord:a});if(s.error)return s}}return{...J}}function Sme(t){var o;let{tournamentRecords:e,tournamentRecord:i,outcomes:r,policyDefinitions:n}=t,a={};r.forEach(s=>{let{eventId:l}=s;a[l]||(a[l]=[]),a[l].push(s)});for(let s of Object.keys(a)){let{event:l}=Wn({tournamentRecord:i,eventId:s});for(let u of a[s]){let{drawId:c}=u,d=(o=l==null?void 0:l.drawDefinitions)==null?void 0:o.find(p=>p.drawId===c);if(d&&c){let{matchUpFormat:p,matchUpId:m}=u,h=kb({schedule:u==null?void 0:u.schedule,tournamentRecords:e,policyDefinitions:n,tournamentRecord:i,drawDefinition:d,matchUpFormat:p,matchUpId:m,outcome:u,drawId:c,event:l});if(h.error)return h}}}return{...J}}function Tme({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){var n,a;if(!r&&!t)return{error:_e};if(!i)return{error:Xe,info:"missing outcome"};if(!r&&!e)return{error:na};if(!r){let o=wi({drawDefinition:t,matchUpId:e});if(o.error)return o;r=o.matchUp}return typeof i!="object"||!((n=i.score)!=null&&n.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:oe}:Lt({element:r,extension:{name:IT,value:i}})}function rY(t){return Tme(t)}function Kk(t){var f,g;let e="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=t,a=ze(t,[{[br]:!0,[hl]:!0}],e);if(a.error)return a;let o=Wg(t,[{[Ag]:Xl}]);if(o[Bo])return o;let s=(f=t.tournamentRecord)==null?void 0:f.tournamentId,{matchUp:l,structure:u}=(o==null?void 0:o.matchUp)??{};if(!(l!=null&&l.tieMatchUps))return ee({result:{error:aa},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...J};let c=(g=vn({structure:u,drawDefinition:i,event:r}))==null?void 0:g.tieFormat;if(!c)return ee({result:{error:_r},info:"No inherited tieFormat",stack:e});let d=[],p=[],m=[],h=[];for(let v of c.collectionDefinitions){let{matchUpCount:y,collectionId:I}=v;p.push(I);let b=(l.tieMatchUps||[]).filter(S=>S.collectionId===I);if(b.length>y)b.sort((S,w)=>(S.matchUpStatus===Ji?1:0)-(w.matchUpStatus===Ji?1:0)),m.push(...b.slice(0,y)),d.push(...b.slice(3).map(Tr));else if(m.push(...b),b.length<y){let S=y-b.length,w=gb({collectionDefinition:v,matchUpsLimit:S,matchUp:l,uuids:n});h.push(...w)}}for(let v of(l==null?void 0:l.tieMatchUps)||[])v.collectionId&&!p.includes(v.collectionId)&&d.push(v.matchUpId);return h.length&&(m.push(...h),Dc({eventId:r==null?void 0:r.eventId,matchUps:h,drawDefinition:i,tournamentId:s})),d.length&&Gu({matchUpIds:d,eventId:r==null?void 0:r.eventId,drawDefinition:i,tournamentId:s}),l&&(l.tieMatchUps=m,l.tieFormatId=void 0,l.tieFormat=void 0,Rt({structureId:u==null?void 0:u.structureId,eventId:r==null?void 0:r.eventId,context:e,drawDefinition:i,tournamentId:s,matchUp:l})),{...J,newMatchUps:h,deletedMatchUpIds:d}}function Xk(t){var f,g,v;let{tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}=t,a="resetScorecard";if(!i)return ee({result:{error:_e},stack:a});if(!r)return ee({result:{error:yn},stack:a});if(!Ti(r))return ee({result:{error:oe,matchUpId:r},stack:a});let o=sn({drawDefinition:i}),{matchUps:s}=mr({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:o}),l=o.drawMatchUps.find(y=>y.matchUpId===r),u=s==null?void 0:s.find(y=>y.matchUpId===r);if(!l||!s)return{error:dn};if(l.matchUpType!==Sa)return{error:aa};let c=En({inContextDrawMatchUps:s,drawDefinition:i,matchUpId:r}),d=u==null?void 0:u.structureId,{structure:p}=et({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:s,inContextMatchUp:u,matchUpsMap:o,targetData:c,structure:p,matchUp:l}),Vd(t))return{error:z0};if((f=l.tieMatchUps)!=null&&f.length)for(let y of l.tieMatchUps){let I=Ob({matchUpId:y.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:n});if(I.error)return ee({result:I,stack:a})}let m=(g=$t({tournamentRecord:e,drawDefinition:i,event:n}))==null?void 0:g.appliedPolicies,h=Wu({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:m,drawDefinition:i,matchUpsMap:o,matchUpId:r});if(h.error)return ee({result:h,stack:a});if(t.tiebreakReset&&!h.tieFormatRemoved){let y=(v=vn({drawDefinition:i,structure:p,event:n}))==null?void 0:v.tieFormat;if(l.tieFormat&&y){let{matchUpCountDifference:I,descendantDifferences:b,ancestorDifferences:S,valueDifference:w}=Ru({descendant:l.tieFormat,ancestor:y});if(b.collectionIds.length===1&&!S.collectionIds.length&&!S.groupsCount&&I===1&&w===1){let U=Kk({tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n});if(U.error)return U}}}return{...J}}function nY(t){let e=ze(t,[{[Fn]:!0,[Gc]:!0},{[Af]:{[Ly]:!1,roundNumbers:!1},[Lz]:"At least one must be provided",[Xn]:un}]);if(e.error)return e;let i=d3(t);if(i.error)return i;let{matchUpIds:r}=i,n=Yi(Sa)(t.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=t;for(let l of r){if(n){let c=Xk({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(c.error||t.removeAssignments&&Yk({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return c}let u=Ob({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(u.error)return u;if(t.removeAssignments){let c=Vk({...t,matchUpId:l});if(c.error)return c}}return{...J}}function Dme({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){var y;if(!e)return{error:_e};let r="setOrderOfFinish";if(!Array.isArray(i))return ee({info:$d("finishingOrder"),result:{error:oe},stack:r});let{completedMatchUps:n,matchUpsMap:a}=_g({inContext:!0,drawDefinition:e}),o=(n==null?void 0:n.map(Tr))??[],s=i.map(Tr),{matchUpTypes:l,roundNumbers:u,structureIds:c,matchUpTieIds:d}=(n??[]).filter(({matchUpId:I})=>s.includes(I)).reduce((I,b)=>{let{matchUpTieId:S,matchUpType:w,roundNumber:U,structureId:T}=b;return I.matchUpTypes.includes(w)||I.matchUpTypes.push(w),I.roundNumbers.includes(U)||I.roundNumbers.push(U),I.structureIds.includes(T)||I.structureIds.push(T),I.matchUpTieIds.includes(S)||I.matchUpTieIds.push(S),I},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||u.length>1||c.length>1)return ee({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:oe},stack:r});let p,m,h={},f=[],g=[];if(!i.every(({orderOfFinish:I,matchUpId:b})=>(f.push(b),I&&g.push(I),h[b]=I,p=o.includes(b),m=I===void 0||ot(I)&&Math.floor(I)>0,p&&m)))return ee({result:{error:p?oe:Dg},info:!p&&"matchUps must be completed"||!m&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let v=n==null?void 0:n.filter(I=>I.structureId===c[0]&&I.roundNumber===u[0]&&I.matchUpType===l[0]&&I.matchUpTieId===d[0]&&!f.includes(I.matchUpId));for(let I of v??[]){let{orderOfFinish:b}=I||{};if(b){if(!ot(b))return ee({context:{orderOfFinish:b,matchUp:I},result:{error:oe},stack:r});g.push(b)}}if(sG(g).length!==g.length||Math.max(...g)>g.length)return ee({info:"Values not unique or greater than expected number of values",result:{error:oe},stack:r});if(c.length){let I=xT({matchUpFilters:{matchUpIds:s},structureId:c[0],drawDefinition:e,matchUpsMap:a});if(I.error)return ee({result:I,stack:r});(y=I.completedMatchUps)==null||y.forEach(b=>{b.orderOfFinish=h[b.matchUpId],Rt({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:b})})}return{...J}}function aY(t){return Dme(t)}function oY(t){var v,y,I,b;let{tournamentRecord:e,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=t,o="applyLineUps",s=ze(t,[{[br]:!0,[Fn]:!0,[hl]:!0},{lineUps:!0,[Xn]:un}],o);if(s.error)return s;let l=e.participants||[],u=wi({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:r});if(u.error)return u;if(!u.matchUp)return{error:dn};let{matchUp:c,structure:d}=u,{drawPositions:p,matchUpType:m}=c;if(m!==hi)return{error:aa};if(!(p!=null&&p.length))return{error:Dy};let h=(v=vn({matchUp:c,drawDefinition:i,structure:d,event:a}))==null?void 0:v.tieFormat,f={};for(let S of n){if(!Array.isArray(S))return{error:oe,lineUp:S};let w={},U=[];for(let R of S){if(typeof R!="object")return{error:oe,lineUpAssignment:R};let{participantId:N,collectionAssignments:A=[]}=R;if(!Array.isArray(A))return{error:oe,collectionAssignments:A};let M=l.find(O=>O.participantId===N);if(!M)return{error:zi};if(M.participantType!==St)return{error:Ts};let E=(I=(y=c.sides)==null?void 0:y.find(O=>{var k,x;return(x=(k=O.participant)==null?void 0:k.individualParticipantIds)==null?void 0:x.includes(N)}))==null?void 0:I.sideNumber;E&&U.push(E);for(let O of A){if(typeof O!="object")return{error:oe,collectionAssignment:O};let{collectionId:k,collectionPosition:x}=O,F=(b=h==null?void 0:h.collectionDefinitions)==null?void 0:b.find(L=>L.collectionId===k);if(!F)return{error:oe,collectionId:k};let $=`${k}-${x}`;w[$]||(w[$]=[]);let _=w[$].length;if(Yi(ti)(F.matchUpType)&&_||F.matchUpType===Qt&&_>1)return{info:"Excessive collectionPosition assignments",error:oe};w[$].push(N)}}let T=Object.values(w);for(let R of T)if(R.length===2){let{participant:N}=Qo({tournamentParticipants:l,participantIds:R});if(!N){let A=nl({participant:{participantType:ht,participantRole:Zr,individualParticipantIds:R},pairOverride:!0,tournamentRecord:e});if(A.error)return A}}let D=wa(U),P=(D[1]||0)>(D[2]||0)&&1||(D[2]||0)>(D[1]||0)&&2||void 0,C=Object.keys(f).map(R=>parseInt(R));P&&!C.includes(P)&&(f[P]=S)}if(!Object.keys(f).length)return{error:RN};if(u=wi({drawDefinition:i,matchUpId:r}),u.error)return u;if(!u.matchUp)return{error:dn};let{matchUp:g}=u;g.sides||(g.sides=[]);for(let S of[1,2]){let w=g.sides.find(T=>T.sideNumber===S),U=f[S];if(U)w?w.lineUp=U:g.sides.push({lineUp:U,sideNumber:S});else continue}return Rt({tournamentId:e==null?void 0:e.tournamentId,context:o,drawDefinition:i,matchUp:g}),{...J}}var Jk={};yt(Jk,{anonymizeTournamentRecord:()=>CY,generate:()=>sY,generateEventWithDraw:()=>_D,generateOutcome:()=>ax,generateOutcomeFromScoreString:()=>Zk,generateParticipants:()=>Qg,generateTournamentRecord:()=>PY,modifyTournamentRecord:()=>EY,mutate:()=>RY});var sY={};yt(sY,{generateEventWithDraw:()=>_D,generateOutcome:()=>ax,generateOutcomeFromScoreString:()=>Zk,generateParticipants:()=>Qg,generateTournamentRecord:()=>PY});function Zk(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n}=t;if(!n)return{outcome:{...zT,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:oe,winningSide:r};let a=n&&LS({scoreString:n}),o={},s=El({sets:a,matchUpFormat:e}),l=El({sets:a,reversed:!0,matchUpFormat:e});return r===2?(o.scoreStringSide1=l,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=l),o.sets=LS({scoreString:o.scoreStringSide1}),Ge({outcome:{matchUpStatus:i,winningSide:r,score:o}})}function Qk({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){var a;let n=(((a=e==null?void 0:e[r.matchUpId])==null?void 0:a.matchUpIds)||[]).filter(o=>i.includes(o)).filter(o=>!t[o]);return{dependenciesScheduled:!(n!=null&&n.length),remainingDependencies:n}}function xb({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function Pme({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function BI({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var h,f;let u=bi((h=l==null?void 0:l.schedule)==null?void 0:h.endTime),c=u?ia(u,Ze(o)):ia(s,Ze(r)+Ze(o)),d=i&&(u?ia(bi(u),i):ia(s,Ze(r)+Ze(i))),p=((f=a==null?void 0:a[l.matchUpId])==null?void 0:f.participantIds)||[],m=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(g=>{xb({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&d||c;m.includes(g)?Pme({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),Gf({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:c,matchUp:l})}function lY({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){var c,d,p,m,h;let a,o=(d=(c=n.minutesMap)==null?void 0:c[r])==null?void 0:d.recoveryMinutes,s=(((m=(p=n.minutesMap)==null?void 0:p[r])==null?void 0:m.averageMinutes)||0)+(o||0),l=ia(i,s),u=((h=e==null?void 0:e[r])==null?void 0:h.dependentMatchUpIds)||[];if(u.length){let f=u.reduce((g,v)=>{let y=t[v];if(!y)return g;let I={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||kt(y)<kt(g.scheduleTime)?I:g},{});f.scheduleTime&&kt(l)>kt(f.scheduleTime)&&(a=f)}return{scheduledDependent:a}}function Rme(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>{var n;return i===Qt&&(((n=r==null?void 0:r.participant)==null?void 0:n.individualParticipants)||[])||(r==null?void 0:r.participant)&&[r.participant]||[]}).flat()}var Fb="DO_NOT_SCHEDULE",Cme={DO_NOT_SCHEDULE:Fb};function ex({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:o}){let s=Rme(o).map(({person:m})=>m==null?void 0:m.personId);if(i){let m=((o==null?void 0:o.potentialParticipants)||[]).flat().map(({person:h})=>h==null?void 0:h.personId);s.push(...m)}let l=s.map(m=>{var h;return(h=r[m])==null?void 0:h.map(f=>({...f,personId:m}))}).filter(Boolean).flat().filter(m=>m.requestType===Fb&&_l(a,m.date)),u=[],c=o==null?void 0:o.matchUpId,d=ir(bi(n),pt(a)),p=bi($N(d,t).toISOString());for(let m of l){let{requestId:h,startTime:f,endTime:g}=m;(n>f&&n<g||p>f&&p<g)&&(u.push({matchUpId:c,request:m,scheduleTime:n}),e[h]?(e[h].scheduleTimes.includes(n)||e[h].scheduleTimes.push(n),e[h].matchUpIds.includes(c)||e[h].matchUpIds.push(c)):e[h]={request:m,scheduleTimes:[n],matchUpIds:[c]})}return{conflicts:u}}function o1({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=PT(i),o=(t[i.matchUpId]||[]).filter(s=>!Rn(s,a)).flat();[...a,...o].forEach(s=>{if(xb({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[jo]?l[jo]+=r:r>0&&(l[jo]=r),o.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function Eme({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){var f,g;let p=[];i||(n=d==null?void 0:d.filter(v=>{let y=v.schedule||{},I=v.matchUpStatus===Vt;return I&&p.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!I&&Cb({schedule:y})&&(!u||v.schedule.scheduledDate===u)}),i=n.map(Tr));let m=Array.isArray(l)?l.includes(u):l,h=m?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of h){o1({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(f=v.schedule)==null?void 0:f.scheduledTime;if(y){o[v.matchUpId]=y;let I=(g=c==null?void 0:c[v.matchUpId])==null?void 0:g.recoveryMinutes;BI({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:r,recoveryMinutes:I,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:m}}function kD({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:o,matchUps:s}){if(typeof r!="object")return{error:Oi};if(!wo(s)&&!Array.isArray(i))return{error:Bu};a=a??RD({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:m}=zy({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:m}}})).flat()),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return Cb({schedule:p})&&(!o||d.schedule.scheduledDate===o)}));let c=i==null?void 0:i.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!==Vt);return{bookings:c==null?void 0:c.map(({eventId:d,schedule:p,matchUpFormat:m})=>{let{event:h,scheduleTiming:f}=l[d],g=h==null?void 0:h.eventType,v={...f,defaultTiming:u,matchUpFormat:m},{averageMinutes:y,recoveryMinutes:I}=NT({timingDetails:v,eventType:g}),{courtId:b,venueId:S}=p,w=bi(p.scheduledTime),U=ia(w,y);return{recoveryMinutes:I,averageMinutes:y,periodLength:a,startTime:w,courtId:b,endTime:U,venueId:S}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function Mme({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),typeof a!="object"||!Object.keys(a).length)return{error:Oi};s=s??RD({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:m,venues:h}=qu({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),f=(m==null?void 0:m.filter(S=>!c||c.includes(S.venueId)))??[];u=u??Hf({courts:f,scheduleDate:l,startTime:!0}),p=p??Hf({courts:f,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=kD({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:c,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:s,startTime:u,bookings:g,endTime:p,courts:f},{scheduleTimes:I}=Fk(y),b=(c==null?void 0:c.length)===1&&c[0]||(h==null?void 0:h.length)===1&&h[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(Ta("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:I,venueId:b}}function Nme({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,o,s,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(n=n.concat(u.matchUpIds)),u.hash!==l&&!i&&(l=u.hash,r.push({averageMinutes:s,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:n}),n=u.matchUpIds),s=i?e:u.averageMinutes,o=u.recoveryMinutes,a=u.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:o,averageMinutes:s}),{groupedRounds:r}}function uY({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:m,venues:h}){var I;let f={},g=[],v=[],y=[];for(let b of h){let{rounds:S=[],venueId:w}=b,{scheduledRoundsDetails:U,greatestAverageMinutes:T,orderedMatchUpIds:D,minutesMap:P}=Pb({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:u,matchUps:p,rounds:S});y.push(...D??[]);let{groupedRounds:C}=Nme({scheduledRoundsDetails:U,greatestAverageMinutes:T,garmanSinglePass:!0}),R,N=[];d&&({scheduleTimes:N,dateScheduledMatchUpIds:R}=Mme({averageMatchUpMinutes:(I=C[0])==null?void 0:I.averageMinutes,scheduleDate:pt(c),venueIds:[b.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:u,matchUps:p}));let A=Eme({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:R,greatestAverageMinutes:T,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:c,minutesMap:P,matchUps:p});({dateScheduledMatchUpIds:R}=A);let M=A,{byeScheduledMatchUpDetails:E,clearDate:O}=A;E!=null&&E.length&&v.push(...E);let{matchUpsToSchedule:k,matchUpMap:x}=pD({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:R,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:D,clearDate:O,matchUps:p}),F=m.filter($=>$.venueId===w);f[w]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:T,scheduledRoundsDetails:U,dateScheduledMatchUps:M,matchUpsToSchedule:k,scheduleTimes:N,groupedRounds:C,venueCourts:F,minutesMap:P,matchUpMap:x},s||g.push(...R)}return{allDateScheduledByeMatchUpDetails:v,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:f,allDateMatchUpIds:y}}function Ame(t,e){let i=kt(t.scheduleTime),r=kt(t.timeAfterRecovery),n=kt(e.scheduleTime),a=kt(e.timeAfterRecovery),o=i===n||r===a,s=i>n&&i<a,l=n>i&&n<r,u=r>n&&r<a,c=a>i&&a<r;return Ge({hasOverlap:o||s||u||l||c,startAisContained:s,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function tx({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){var p,m,h,f,g;let o=(((p=i==null?void 0:i[n.matchUpId])==null?void 0:p.participantIds)||[]).flat(),s=((h=(m=a==null?void 0:a.minutesMap)==null?void 0:m[n.matchUpId])==null?void 0:h.averageMinutes)||0,l=((g=(f=a==null?void 0:a.minutesMap)==null?void 0:f[n.matchUpId])==null?void 0:g.recoveryMinutes)||0,u=o.every(v=>{var S;xb({individualParticipantProfiles:t,participantId:v});let y=t[v];if(!y.timeAfterRecovery)return!0;let I=bi((S=n==null?void 0:n.schedule)==null?void 0:S.endTime),b=I?ia(I,Ze(l)):ia(r,Ze(s)+Ze(l));return![...Object.keys(y.potentialBookings).filter(w=>w!==n.drawId).map(w=>y.potentialBookings[w]).flat(),...y.bookings].find(w=>Ame({scheduleTime:r,timeAfterRecovery:b},w).hasOverlap)}),c=e[n.matchUpId],d=(c?Ny(ir(c),ir(r),!1):0)>=0;return{enoughTime:u&&d}}function cY({autoSchedulingAudit:t,tournamentRecords:e}){var o;lt({topic:mu,payload:t});let i=s=>s?Object.values(s).reduce((l,u)=>l+u.length||0,0):0,r=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((u,c)=>u+c.rounds.length,0),0),n={scheduledDatesCount:(o=t.scheduledDates)==null?void 0:o.length,noTimeMatchUpIdsCount:i(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:i(t==null?void 0:t.requestConflicts),profileRoundsCount:r},a={itemType:i1,itemValue:n};for(let s of Object.values(e)){let l=s.tournamentId;Q0(mu)?lt({payload:{type:i1,tournamentId:l,detail:n},topic:mu}):bb({tournamentRecord:s,timeItem:a})}}function ix({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=PT(r),{matchUpId:a,matchUpType:o}=r,s=(r.roundPosition&&t[a]||[]).flat(),l=ct(n.concat(...s));return l.forEach(u=>{xb({individualParticipantProfiles:e,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=e[u];if(c)return[o,jo].find(d=>{var h;let p=((h=c.counters)==null?void 0:h[d])||0,m=i[d]||0;return p&&m&&p>=m})}),relevantParticipantIds:l}}function VI({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:u,schedule:c}){var g,v,y;if(!s)return{error:ge};if(!l&&(!u||!Array.isArray(u)))return{error:$m};if(!l&&(!c||typeof c!="object"))return{error:cH};let d,p=[],m=0;if(r&&!n){let I=ls({tournamentRecords:o,tournamentRecord:s});n=I.matchUpDependencies,d=I.matchUps}d||(d=((g=Br({tournamentRecord:s}))==null?void 0:g.matchUps)??[]);let h=d.reduce((I,b)=>{let{matchUpId:S,drawId:w,matchUpStatus:U}=b;return(e||U!==Vt)&&(t||!gr.includes(U))&&(I[w]?I[w].push(S):I[w]=[S]),I},{}),f=l==null?void 0:l.map(I=>I.matchUpId);for(let I of Object.keys(h)){let{drawDefinition:b}=Xc({tournamentRecord:s,drawId:I});if(!b)continue;let S=h[I].filter(U=>(u==null?void 0:u.includes(U))??(f==null?void 0:f.includes(U))),w=Sn({inContext:!1,drawDefinition:b}).matchUps;for(let U of S){let T=((v=l==null?void 0:l.find(P=>P.matchUpId===U))==null?void 0:v.schedule)||c,D=OD({schedule:T,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:o,tournamentRecord:s,checkChronology:r,drawDefinition:b,drawMatchUps:w,matchUpId:U});if((y=D==null?void 0:D.warnings)!=null&&y.length&&p.push(...D.warnings),D!=null&&D.success&&(m+=1),D.error)return D}}return p.length?{...J,scheduled:m,warnings:p}:{...J,scheduled:m}}function Lb(t){var h;let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:o,checkChronology:s,matchUpDetails:l,schedule:u}=t;if(t.matchUpIds&&!n)return VI(t);let c=ze(t,[{[pn]:!0},{[Af]:{matchUpContextIds:!1,matchUpDetails:!1},[_a]:oe,[Xn]:un}]);if(c.error)return c;if((!l||n)&&!u)return{error:Xe,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:m}=ls({tournamentRecords:o});for(let f of Object.values(o)){let{tournamentId:g}=f,v=n==null?void 0:n.filter(I=>I.tournamentId===g).map(Tr),y=l==null?void 0:l.filter(I=>(I==null?void 0:I.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let I=VI({matchUpDetails:y,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:m,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:o,tournamentRecord:f,checkChronology:s,matchUpIds:v,schedule:u});if((h=I.warnings)!=null&&h.length&&d.push(...I.warnings),I.scheduled&&(p+=I.scheduled),I.error)return I}}return d.length?{...J,scheduled:p,warnings:d}:{...J,scheduled:p}}function Ome({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:m,courts:h,dryRun:f}){var R,N,A,M,E,O,k;let g={},v={},y={},I={},b={},S={},w={},U={},T={},D={};for(let x of n){let F=pt(x==null?void 0:x.scheduleDate),$=(x==null?void 0:x.venues)||[],_={},L={},B=(K,H)=>{K.forEach(Q=>{let X=L[Q].counters;X[H]?X[H]+=1:X[H]=1,X[jo]?X[jo]+=1:X[jo]=1})};y[F]={},I[F]={},g[F]={},v[F]={},w[F]=[],U[F]=[],T[F]=[],D[F]=[];let V={};m.forEach(K=>{var H;(H=K.schedule)!=null&&H.scheduledDate&&_l(F,pt(K.schedule.scheduledDate))&&Gf({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:V,matchUp:K})});let{allDateScheduledByeMatchUpDetails:G,venueScheduledRoundDetails:j,allDateMatchUpIds:z}=uY({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:V,matchUpScheduleTimes:S,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:F,matchUps:m,courts:h,venues:$}),q=10,W=0,Y,re=10;for(;!Y;){for(let{venueId:K}of $){let H=0,Q=j[K];for(;Q.courtsCount&&((R=Q.scheduleTimes)!=null&&R.length)&&((N=Q.matchUpsToSchedule)!=null&&N.length)&&H<=Q.courtsCount;){let{scheduleTime:X,attempts:ie=0}=Q.scheduleTimes.shift(),ae=Q.matchUpsToSchedule.find(le=>{var Fe,De;let{matchUpId:ne,matchUpType:de}=le,{participantIdsAtLimit:Ie,relevantParticipantIds:ce}=ix({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpDailyLimits:s,matchUp:le});if(Ie.length)return U[F].includes(ne)||U[F].push(ne),!1;let{scheduledDependent:ke}=lY({matchUpScheduleTimes:S,matchUpDependencies:o,scheduleTime:X,matchUpId:ne,details:Q});if(ke)return!1;let{dependenciesScheduled:Pe,remainingDependencies:it}=Qk({matchUpScheduleTimes:S,matchUpDependencies:o,allDateMatchUpIds:z,matchUp:le});if(!Pe)return I[F][ne]||(I[F][ne]=[]),I[F][ne].push({scheduleTime:X,remainingDependencies:it}),!1;let{enoughTime:It}=tx({individualParticipantProfiles:L,matchUpNotBeforeTimes:V,matchUpDependencies:o,scheduleTime:X,details:Q,matchUp:le});if(!It)return y[F][ne]||(y[F][ne]=[]),y[F][ne].push({scheduleTime:X}),!1;let me=Q.greatestAverageMinutes,{conflicts:fe}=ex({potentials:e,averageMatchUpMinutes:me,requestConflicts:D,personRequests:d,scheduleTime:X,scheduleDate:F,matchUp:le});if(fe!=null&&fe.length)return b[F]||(b[F]=[]),b[F].push(...fe),!1;B(ce,de);let pe=(De=(Fe=Q.minutesMap)==null?void 0:Fe[ne])==null?void 0:De.recoveryMinutes;return BI({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpNotBeforeTimes:V,averageMatchUpMinutes:me,matchUpDependencies:o,recoveryMinutes:pe,scheduleTime:X,matchUp:le}),S[ne]=X,!0});Q.matchUpsToSchedule=Q.matchUpsToSchedule.filter(({matchUpId:le})=>le!==(ae==null?void 0:ae.matchUpId)),ae?H+=1:(v[F][K]||(v[F][K]=[]),v[F][K].push({scheduleTime:X,attempts:ie+1}))}(A=Q.matchUpsToSchedule)!=null&&A.length&&(v[F][K]=(M=v[F][K])==null?void 0:M.filter(X=>{let ie=X.attempts<q;return ie&&Q.scheduleTimes.push(X),!ie})),(!((E=Q.scheduleTimes)!=null&&E.length)||!((O=Q.matchUpsToSchedule)!=null&&O.length))&&(Q.complete=!0)}W+=1,Y=$.every(({venueId:K})=>j[K].complete)||W===re}for(let{venueId:K}of $){let H=j[K].matchUpMap;Object.keys(H).forEach(Q=>{let X=u[Q];X&&Object.keys(H[Q]).forEach(ie=>{let{drawDefinition:ae}=Xc({tournamentRecord:X,drawId:ie});ae&&H[Q][ie].forEach(({matchUpId:le})=>{let ne=S[le];if(ne){let de=ne.split(":").map(no).join(":"),Ie=`${pt(F)}T${de}`;f?w[F].push(le):(Jc({drawDefinition:ae,scheduledTime:Ie,matchUpId:le}).success&&w[F].push(le),K&&Zg({tournamentRecord:X,drawDefinition:ae,matchUpId:le,venueId:K}))}})})}),T[F]=j[K].matchUpsToSchedule.map(Tr),g[F][K]=j[K].scheduleTimes.sort((Q,X)=>kt(Q.scheduleTime)-kt(X.scheduleTime))}!f&&(G!=null&&G.length)&&Lb({matchUpDetails:G,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let K of x.venues)for(let H of K.rounds){let Q=(((k=H.matchUps)==null?void 0:k.map(({matchUpId:ie})=>ie))||[]).filter(ie=>w[F].includes(ie));H.canScheduledMatchUpIds=Q;let X=Math.round(Q.length/H.matchUpsCount*1e4)/100;(X===1/0||isNaN(X))&&(X=0),H.possibleToSchedulePct=X,H.matchUpsCount===Q.length&&(H.possibleToSchedule=!0)}}let P=n.map(({scheduleDate:x})=>x),C={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:w,schedulingProfile:c,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:P};return cY({tournamentRecords:u,autoSchedulingAudit:C}),{...J,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:v,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:S,overLimitMatchUpIds:U,scheduledMatchUpIds:w,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:P}}function pV({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Xe,stack:"getEarliestCourtTime"};let a=Hf({scheduleDate:n,courts:[r],startTime:!0}),o=Hf({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||o;let s=Ab({court:r,date:n}),{timeSlots:l}=Xg({courtDate:s}),u=ir(e),c=ir(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let m=ir(p.startTime),h=ir(p.endTime);if(m>c||h<u)return d;let f=u>m?u:m;if(Ny(f,h)>=t){let g=bi(f.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:o}}function kme({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:m=[],courts:h,dryRun:f}){var C,R;let g={},v={},y={},I={},b={},S={},w={},U={},T={};for(let N of n??[]){let A=pt(N==null?void 0:N.scheduleDate),M=(N==null?void 0:N.venues)||[],E={},O={},k=(K,H)=>{K.forEach(Q=>{let X=O[Q].counters;X[H]?X[H]+=1:X[H]=1,X[jo]?X[jo]+=1:X[jo]=1})};g[A]={},v[A]={},S[A]=[],w[A]=[],U[A]=[],T[A]=[];let x={};m==null||m.forEach(K=>{var H;(H=K.schedule)!=null&&H.scheduledDate&&_l(A,pt(K.schedule.scheduledDate))&&Gf({matchUpPotentialParticipantIds:E,matchUpNotBeforeTimes:x,matchUp:K})});let{allDateScheduledByeMatchUpDetails:F,allDateScheduledMatchUpIds:$,venueScheduledRoundDetails:_,allDateMatchUpIds:L}=uY({matchUpPotentialParticipantIds:E,individualParticipantProfiles:O,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:x,matchUpScheduleTimes:b,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:A,matchUps:m,courts:h,venues:M}),B=m==null?void 0:m.filter(({matchUpId:K})=>$.includes(K)),{bookings:V}=kD({dateScheduledMatchUps:B,tournamentRecords:u,scheduleDate:A,periodLength:c}),{virtualCourts:G}=PD({scheduleDate:A,periodLength:c,bookings:V,courts:h}),j=G==null?void 0:G.reduce((K,H)=>{let{earliestCourtTime:Q,courtEndTime:X}=pV({date:A,averageMinutes:0,court:H});return(!K.startTime||ir(Q)<ir(K.startTime))&&(K.startTime=Q),(!K.endTime||ir(X)>ir(K.endTime))&&(K.endTime=X),K},{}),z=j.startTime,q=({courtId:K,booking:H})=>{var Q;return(Q=G==null?void 0:G.find(X=>X.courtId===K))==null?void 0:Q.dateAvailability[0].bookings.push(H)},W=10,Y=0,re;for(;!re;){for(let{venueId:K}of M){let H=_[K],Q=H.matchUpsToSchedule.length,X=[],ie=[],ae,le=0;for(;!ae;){for(let ne of H.matchUpsToSchedule){if(ie.length===H.courtsCount||X.length===H.courtsCount){ae=!0;break}let{matchUpId:de,matchUpType:Ie}=ne,{participantIdsAtLimit:ce,relevantParticipantIds:ke}=ix({matchUpPotentialParticipantIds:E,individualParticipantProfiles:O,matchUpDailyLimits:s,matchUp:ne});if(ce.length){w[A].includes(de)||w[A].push(de);continue}let{dependenciesScheduled:Pe,remainingDependencies:it}=Qk({matchUpScheduleTimes:b,matchUpDependencies:o,allDateMatchUpIds:L,matchUp:ne});if(!Pe){v[A][de]||(v[A][de]=[]),v[A][de].push({remainingDependencies:it});continue}let It=[],me=G==null?void 0:G.reduce((fe,pe)=>{var xe,Ce,we,Ue;if(ie.includes(pe.courtId))return fe;let{earliestCourtTime:Fe}=pV({averageMinutes:H.greatestAverageMinutes,startTime:z,date:A,court:pe});if(fe.scheduleTime&&kt(Fe)>=kt(fe.scheduleTime))return fe;let{scheduledDependent:De}=lY({matchUpScheduleTimes:b,matchUpDependencies:o,scheduleTime:Fe,matchUpId:de,details:H});if(De)return fe;let{enoughTime:je}=tx({individualParticipantProfiles:O,matchUpNotBeforeTimes:x,matchUpDependencies:o,scheduleTime:Fe,details:H,matchUp:ne});if(!je)return g[A][de]||(g[A][de]=[]),g[A][de].includes(Fe)||g[A][de].push(Fe),fe;let ue=((Ce=(xe=H.minutesMap)==null?void 0:xe[de])==null?void 0:Ce.averageMinutes)||H.greatestAverageMinutes,{conflicts:he}=ex({potentials:e,averageMatchUpMinutes:ue,requestConflicts:T,personRequests:p,scheduleTime:Fe,scheduleDate:A,matchUp:ne});if(he!=null&&he.length)return It.push(...he),!1;k(ke,Ie);let Re=(Ue=(we=H.minutesMap)==null?void 0:we[de])==null?void 0:Ue.recoveryMinutes;return BI({matchUpPotentialParticipantIds:E,individualParticipantProfiles:O,matchUpNotBeforeTimes:x,averageMatchUpMinutes:ue,matchUpDependencies:o,recoveryMinutes:Re,scheduleTime:Fe,matchUp:ne}),(!fe.scheduleTime||kt(Fe)<kt(fe.scheduleTime))&&(fe.averageMatchUpMinutes=ue,fe.recoveryMinutes=Re,fe.scheduleTime=Fe,fe.courtName=pe.courtName,fe.courtId=pe.courtId),fe},{});if(me.scheduleTime){let{averageMatchUpMinutes:fe,recoveryMinutes:pe,scheduleTime:Fe,courtId:De}=me;b[de]=Fe,I[de]=De,X.push(de),ie.push(De);let je=Fe,ue=ia(je,fe);q({courtId:De,booking:{averageMatchUpMinutes:fe,recoveryMinutes:pe,periodLength:c,matchUpId:de,startTime:je,courtId:De,endTime:ue,venueId:K}}),H.matchUpsToSchedule=H.matchUpsToSchedule.filter(he=>he.matchUpId!==de)}else It!=null&&It.length&&(y[A]||(y[A]=[]),y[A].push(...It))}(ie.length===H.courtsCount||X.length===H.courtsCount||!H.matchUpsToSchedule.length)&&(ae=!0),H.matchUpsToSchedule.length&&X<H.courtsCount&&(ir(z)<ir(j.endTime)?z=ia(z,c):(ae=!0,H.complete=!0)),le+=1,!ae&&le>=Q&&(ae=!0)}(C=H.matchUpsToSchedule)!=null&&C.length||(H.complete=!0)}Y+=1,re=M.every(({venueId:K})=>_[K].complete)||Y===W}for(let{venueId:K}of M){let H=_[K].matchUpMap;Object.keys(H).forEach(Q=>{let X=u[Q];X&&Object.keys(H[Q]).forEach(ie=>{let{drawDefinition:ae}=Xc({tournamentRecord:X,drawId:ie});ae&&H[Q][ie].forEach(({matchUpId:le})=>{let ne=b[le],de=I[le];if(ne){let Ie=ne.split(":").map(no).join(":"),ce=`${pt(A)}T${Ie}`;f||(Jc({drawDefinition:ae,scheduledTime:ce,matchUpId:le}),mh({courtDayDate:A,tournamentRecords:u,tournamentRecord:X,drawDefinition:ae,matchUpId:le,courtId:de})),S[A].push(le)}})})}),U[A]=_[K].matchUpsToSchedule.map(Tr)}!f&&(F!=null&&F.length)&&Lb({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let K of N.venues)for(let H of K.rounds){let Q=(R=(H.matchUps??[]).map(({matchUpId:ie})=>ie))==null?void 0:R.filter(ie=>S[A].includes(ie));H.canScheduledMatchUpIds=Q;let X=Math.round(((Q==null?void 0:Q.length)||0)/H.matchUpsCount*1e4)/100;(X===1/0||isNaN(X))&&(X=void 0),H.possibleToSchedulePct=X,H.matchUpsCount===(Q==null?void 0:Q.length)&&(H.possibleToSchedule=!0)}}let D=(n??[]).map(({scheduleDate:N})=>N),P={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:S,schedulingProfile:d,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:D};return cY({tournamentRecords:u,autoSchedulingAudit:P}),{...J,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:v,matchUpScheduleTimes:b,overLimitMatchUpIds:w,scheduledMatchUpIds:S,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:D}}function xD(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=gr,scheduledDates:r,venueIds:n}=t,a=Io(t),o=Nt(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(o!=null&&o.length))return{error:Oi};let s=0;for(let l of o){let u=a[l],c=xme({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:r,venueIds:n});if(c.error)return c;s+=c.clearedScheduleCount??0}return{...J,clearedScheduleCount:s}}function xme({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=gr,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:ge};if(!Array.isArray(e)||!Array.isArray(n))return{error:oe};n.length&&t.push("venueId");let a=Br({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],o={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&Cb({schedule:c,scheduleAttributes:t})&&(!(n!=null&&n.length)||n.includes(c.venueId))&&(o[d]||(o[d]=[]),o[d].push(p))});let s=i.tournamentId,l=0;for(let u in o){let{event:c,drawDefinition:d}=Wn({tournamentRecord:i,drawId:u}),p=Sn({drawDefinition:d,matchUpFilters:{matchUpIds:o[u]}}).matchUps??[];for(let m of p){let h=!1;m.timeItems=(m.timeItems??[]).filter(f=>{let g=(f==null?void 0:f.itemType)&&![jl,Rc,Zm,ET,Qm,eh].includes(f==null?void 0:f.itemType);return g||(h=!0),g}),h&&(Rt({context:"clear schedules",eventId:c==null?void 0:c.eventId,drawDefinition:d,tournamentId:s,matchUp:m}),l+=1)}}return{...J,clearedScheduleCount:l}}function FD(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:u}=t,c=ze(t,[{[pn]:!0},{[Kr]:D=>!D||Array.isArray(D)&&D.every(Ia),[Nz]:!1,[Xn]:un}]);if(c.error)return c;let d=Yu({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...J};let{modifications:p,issues:m=[],schedulingProfile:h=[]}=d,f=Object.assign({},...Object.values(a).map(D=>Fg({tournamentRecord:D}).containedStructures)),g=n.map(D=>{if(Ia(D))return pt(D)}).filter(Boolean),v=h.map(D=>D.scheduleDate).map(D=>Ia(D)&&pt(D)).filter(D=>D&&(!n.length||g.includes(D)));if(!v.length)return{error:BG};if(r&&!l){let D=Array.isArray(r)?r:[];xD({tournamentRecords:a,scheduledDates:D})}let y=qu({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:I}=Rs({matchUpFilters:{matchUpTypes:[ti,Qt]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:b}=ls({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:I}),{matchUpDailyLimits:S}=wD({tournamentRecords:a}),{personRequests:w}=yp({requestType:Fb,tournamentRecords:a}),U=h.filter(D=>{let P=pt(D==null?void 0:D.scheduleDate);return v.includes(P)}).sort((D,P)=>new Date(D.scheduleDate).getTime()-new Date(P.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:m,dateSchedulingProfiles:U,containedStructureIds:f,matchUpDependencies:b,matchUpDailyLimits:S,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:h,personRequests:w,periodLength:o,useGarman:s,matchUps:I,dryRun:l,courts:y};return u?kme(T):Ome(T)}function LD(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};return n.tournamentId||(n.tournamentId=Gt()),n.startDate&&!Md(n.startDate)&&!dS.test(n.startDate)?{error:Nr}:n.endDate&&!Md(n.endDate)&&!dS.test(n.endDate)?{error:Nr}:(n.extensions&&(n.extensions=n.extensions.filter(tl)),{...n})}function rx({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:o}){var h,f;if(!i)return{error:ge};let s={},l=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===St&&v===Zr),u=0;for(let g of l){let v=a&&((h=Kp({element:g,accessor:a}))==null?void 0:h.value)||r&&((f=g.person)==null?void 0:f[r])||e&&g[e];if(v){if(!Object.keys(s).includes(v)){s[v]={participantName:(n==null?void 0:n[u])??v,participantId:(o==null?void 0:o.pop())??Gt(),individualParticipantIds:[],participantRole:Zr,participantType:Kt};let y={value:r??e,name:PE};Lt({element:s[v],extension:y}),u+=1}s[v].individualParticipantIds.push(g.participantId)}}let c=Object.keys(s),d=(i.participants??[]).map(g=>{if(g.participantType!==Kt||g.participantRole!==Zr)return;let{extension:v}=gt({name:PE,element:g}),y=v==null?void 0:v.value;if(c.includes(y))return g.participantId}).filter(Boolean),p=0,m=[];return Object.keys(s).forEach(g=>{let v=s[g],{participantId:y}=v;d.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),m.push(v),p++)}),t&&p?(lt({payload:{tournamentId:i.tournamentId,participants:m},topic:Tc}),{...J,participantsAdded:p}):m.length?{...J,newParticipants:m}:{error:Pne}}var Fme=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],Lme=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function dY({count:t=1,participantsCount:e=32}={}){let i=wn(Lme),r=i.slice(0,t);return{cities:Se(0,e).map(n=>n<Math.min(t,i.length)?r[n]:pa(r))}}function pY({count:t=1,participantsCount:e=32}={}){let i=wn(Fme),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:Se(0,e).map(n=>n<Math.min(t,i.length)?r[n]:pa(r))}}function mY({count:t=1,participantsCount:e=32}={}){let i=Se(0,t).map(()=>Se(0,5).map(()=>to(0,9)).join(""));return{postalCodes:Se(0,e).map(r=>r<t?i[r]:pa(i))}}function VS({idPrefix:t,participantType:e,index:i,uuids:r}){let n=Ti(e)?e[0]:"X";return t?`${t}-${n}-${i}`:(r==null?void 0:r.pop())||Gt()}function hY(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r==null?void 0:r[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:n}}var _me={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function yC(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![Jt,pi].includes(i))return{personData:[],error:oe};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:o}=_me,s=Yp.map(({iso:f})=>f).filter(Boolean),l=Math.ceil(r/n.length),u=Math.ceil(r/a.length),c=Math.ceil(r/o.length),d=Se(0,l).flatMap(()=>{let f=Me(n,!1,!0);return Se(0,n.length).map(()=>fa(f))}),p=Se(0,u).flatMap(()=>{let f=Me(a,!1,!0);return Se(0,a.length).map(()=>fa(f))}),m=Se(0,c).flatMap(()=>{let f=Me(o,!1,!0);return Se(0,o.length).map(()=>fa(f))}),h={};for(let f=0;f<r;f++){let g=d.pop(),v=i||pa([Jt,pi]),y=v===Jt?m.pop():p.pop(),I=pa(s);h[`${y}${g}`]={nationalityCode:I,sex:v,firstName:y,lastName:g}}return{personData:Object.values(h).slice(0,e)}}function fY(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:o,category:s,sex:l}=t||{};if(isNaN(e))return{error:oe};let u=(a==null?void 0:a[Jt])||l===Jt&&e||0,c=(a==null?void 0:a[pi])||l===pi&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&yC({count:u,sex:Jt}).personData||[],m=c&&yC({count:c,sex:pi}).personData||[],h=[...p,...m,...d&&yC({count:d}).personData||[]],f=h.filter(T=>!l||u&&c||T.sex===l),g=[];if(Array.isArray(o)){let T=o.filter(D=>typeof D.firstName!="string"||typeof D.lastName!="string"||D.sex&&![Jt,pi].includes(D.sex)||D.nationalityCode&&(typeof D.nationalityCode!="string"||D.nationalityCode.length>3||!Yp.find(({iso:P,ioc:C})=>[P,C].includes(D.nationalityCode)))?!1:(D.nationalityCode&&g.push(D.nationalityCode),!0));if(T.length)f=T;else return{error:oe}}let v=o?f:wn(f);if(v.length<e){let{maleFirstNames:T,maleLastNames:D,femaleFirstNames:P,femaleLastNames:C,nationalityCodes:R}=h.reduce((N,A)=>{let{firstName:M,lastName:E,nationalityCode:O}=A;return A.sex===Jt?(N.maleFirstNames.includes(M)||N.maleFirstNames.push(M),N.maleLastNames.includes(E)||N.maleLastNames.push(E)):(N.femaleFirstNames.includes(M)||N.femaleFirstNames.push(M),N.femaleLastNames.includes(E)||N.femaleLastNames.push(E)),N.nationalityCodes.includes(O)||N.nationalityCodes.push(O),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Se(0,e-v.length).forEach(()=>{let N=l||pa([Jt,pi]),A=pa(R),M=pa(N===Jt?T:P),E=pa(N===Jt?D:C),O={firstName:M,lastName:E,sex:N,nationalityCode:A};v.push(O)})}let{ageMinDate:y,ageMaxDate:I}=fm({consideredDate:r,category:s}),b=Ze((y==null?void 0:y.slice(0,4))||0)||Ze((I==null?void 0:I.slice(0,4))||0)-3,S=Ze((I==null?void 0:I.slice(0,4))||0)||Ze((y==null?void 0:y.slice(0,4))||0)+3,w=(y||I)&&[b,S],U=v.slice(0,e).map((T,D)=>{let[P,C]=w||[],R=w&&fa(Se(P,C)),N=fa(Se(0,365)),A=R&&bae(R,N);return Object.assign(Ge({extensions:i||[{name:"regionCode",value:D+1}],birthDate:A,isMock:n}),T)});return{persons:U.length&&U||v[0],nationalityCodes:g}}var $me=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function jS({nameRoot:t="TEAM",count:e=1}={}){let i=wn($me).slice(0,e);return i.length<e&&Se(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function Qg(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=Mr,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:o,categories:s,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:m,teamSize:h=8,personIds:f,idPrefix:g,uuids:v,personExtensions:y,addressProps:I,gendersCount:b,matchUpType:S,personData:w,sex:U,inContext:T,withISO2:D,withIOC:P,scaleAllParticipants:C}=t,R=m===ht||S===Ed,N=m===Kt||S===Kt;i&&(!Array.isArray(i)||!i.every(ce=>Li(ce))||i.length!==2)&&(i=void 0),e=C?p:e;let A=1e3,M=e&&e>A?e:A;i=i||[1,M],i[1]+=1;let E=p*(R&&2||N&&(h??8)||1),O=fY({count:E,personExtensions:y,consideredDate:o,gendersCount:b,personData:w,category:l,sex:U});if(O.error)return O;let{nationalityCodes:k,persons:x}=O,F={},$={},_={},L={},B=ce=>{Object.assign(F,ce.doublesRankings),Object.assign($,ce.singlesRankings),Object.assign(L,ce.doublesRatings),Object.assign(_,ce.singlesRatings)};if(Nt(l)){let ce=mV({scaledParticipantsCount:e,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:l});B(ce)}Array.isArray(s)&&s.forEach(ce=>{let ke=mV({scaledParticipantsCount:e,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:ce});B(ke)});let V=Yp.filter(ce=>c==="IOC"&&ce.ioc||ce.iso);function G(ce){let ke=Math.ceil(E/ce);return n&&ke>n?Math.ceil(E/n):ce}let{postalCodesProfile:j,postalCodesCount:z,statesProfile:q,citiesProfile:W,citiesCount:Y,statesCount:re}=I||{},K=ce=>Object.keys(ce).map(ke=>Se(0,q[ke]).map(()=>ke)).flat(),H=W&&K(W)||(I==null?void 0:I.cities)||dY({count:Y||E,participantsCount:E}).cities,Q=q&&K(q)||(I==null?void 0:I.states)||pY({count:re||E,participantsCount:E}).states,X=j&&K(j)||(I==null?void 0:I.postalCodes)||mY({count:z||E,participantsCount:E}).postalCodes,ie={cities:H,states:Q,postalCodes:X},ae=G(u),le=ae?wn(V).slice(0,u):d&&V.filter(ce=>d.includes(ce.iso))||V,ne=wn(Se(0,Math.ceil(E/(ae||1))).map(()=>le).flat(1/0)),de=jS({count:p}).names;return{participants:Se(0,p).map(ce=>{let ke=R&&2||N&&(h??8)||1,Pe=Se(0,ke).map(pe=>{let Fe=ce*ke+pe;return Ie(Fe)}),it=Pe.map(pe=>pe.participantId),It=Pe.map(pe=>pe.person.standardFamilyName).join("/"),me=R?ht:Kt,fe={participantId:VS({participantType:me,index:ce,idPrefix:g,uuids:v}),participantName:R?It:de[ce],participantRole:Zr,individualParticipantIds:it,participantType:me};return T&&(fe.individualParticipants=Pe),R||N?[fe,...Pe]:Pe}).flat(),...J};function Ie(ce){let ke=x[ce],{nationalityCode:Pe,participantExtensions:it,participantTimeItems:It,extensions:me,firstName:fe,birthDate:pe,lastName:Fe,personId:De,sex:je}=ke||{},ue=fe||"GivenName",he=Fe||"FamilyName",Re=`${ue} ${he}`,xe=ne[ce],Ce=(k==null?void 0:k.length)&&Pe||xe&&(c==="IOC"?xe.ioc||xe.iso:xe.iso||xe.ioc)||Pe;ne!=null&&ne.length&&!Ce&&!Pe&&console.log("%c Invalid Nationality Code",{participantIndex:ce,country:xe});let we=hY({...ie,participantIndex:ce,nationalityCode:Ce}),Ue=Ge({participantId:VS({participantType:St,index:ce,idPrefix:g,uuids:v}),extensions:it,timeItems:It,participantRole:Zr,participantType:St,participantName:Re,person:{personId:De||(f==null?void 0:f.length)&&f[ce]||Gt(),birthDate:Ia(pe)?pe:void 0,addresses:[we],standardFamilyName:he,standardGivenName:ue,nationalityCode:Ce,extensions:me,sex:je}});if(P&&Ce){let Le=Yp.find(({iso:rt})=>rt===Ce);Le!=null&&Le.ioc&&(Ue.person.iocNationalityCode=Le.ioc),Le!=null&&Le.label&&(Ue.person.countryName=Le.label)}if(D&&Ce){let Le=Yp.find(({iso:rt})=>rt===Ce);Le!=null&&Le.iso2&&(Ue.person.iso2NationalityCode=Le.iso2),Le!=null&&Le.label&&(Ue.person.countryName=Le.label)}let wt=Le=>{var be,Et,Ee,qe;let rt=Le.categoryName||Le.ratingType||Le.ageCategoryCode,Ci=(be=$[rt])==null?void 0:be[ce],Be=(Et=F[rt])==null?void 0:Et[ce];pU({scaleValue:Ci,eventType:gm,scaleType:wc,participant:Ue,category:Le}),pU({scaleValue:Be,eventType:yu,scaleType:wc,participant:Ue,category:Le});let nt=(Ee=_[rt])==null?void 0:Ee[ce],Ii=(qe=L[rt])==null?void 0:qe[ce];pU({scaleValue:nt,eventType:gm,scaleType:fc,participant:Ue,category:Le}),pU({scaleValue:Ii,eventType:yu,scaleType:fc,participant:Ue,category:Le})};return Array.isArray(s)?s.forEach(Le=>wt(Le)):l&&wt(l),Ue}}function pU({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,o=[kd,r,i,a].join("."),s={itemValue:t,itemType:o};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function mV(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,o=e.rankingRange||t.rankingRange||[1,1e3],s={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:m}=e,h=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!m){let[f,g]=o||[];if(l[h]=wn(Se(f,g)).slice(0,i||to(20,30)),[ht,Kt].includes(n)){let[v,y]=o||[];s[h]=wn(Se(v,y)).slice(0,i||to(20,30))}}if(m&&r[m]){let{ratingMax:f,ratingMin:g,ratingAttributes:v}=e,y={...r[m],...v||{}},{attributes:I={},decimalsCount:b,accessors:S,range:w,step:U}=y,T=N=>{let A={},M=Object.keys(N||{});for(let E of M){let O=N[E];if(typeof O=="object"&&O.generator){let{range:k}=O,[x,F]=k.slice().sort();A[E]=to(x,F)}else A[E]=O}return A},D=w[0]>w[1]?2:.7,[P,C]=w.slice().sort(),R=Se(0,2e3).map(()=>aG(P,C,D,U,b)).filter(N=>(!f||N<=f)&&(!g||N>=g)).slice(0,i||to(20,30)).map(N=>S?Object.assign({},...S.map(A=>({[A]:N})),T(I)):N);u[h]=[...a,...R],[ht,Kt].includes(n)&&(c[h]=[...a,...R])}return{singlesRankings:l,doublesRankings:s,singlesRatings:u,doublesRatings:c}}function nx(t){var m,h;let{alternatesCount:e=0,tieFormatName:i,drawSize:r}=t,n=0,a=0,o=0,s=0,l={},u={[Jt]:0,[pi]:0,[Bn]:0,[wd]:0,[Ds]:0};(h=(m=Nt(t.tieFormat)?t.tieFormat:Iu({namedFormat:i}))==null?void 0:m.collectionDefinitions)==null||h.filter(Boolean).forEach(f=>{let{category:g,collectionId:v,matchUpType:y,matchUpCount:I,gender:b}=f;if([Jt,pi].includes(b)){let S=I*(y===Qt?2:1);u[b]<S&&(u[b]=S)}else b===Bn&&(u[Jt]<I&&(u[Jt]=I),u[pi]<I&&(u[pi]=I));if(g){let S=JSON.stringify(g);l[S]=g}if(v||(f.collectionId=Gt()),Yi(Qt)(y)){let S=I;s+=I,n=Math.max(n,S)}if(Yi(ti)(y)){let S=I;o+=I,a=Math.max(a,S)}});let c=Object.keys(l).length?Math.max(o,s*2):Math.max(a,n*2),d=n*(r+e),p=a*(r+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:c,genders:u}}function Bme({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=St}=t||{},a=r||0,o={[pi]:0,[Bn]:0,[wd]:0,[Jt]:0,[Ds]:0},s=0,l=0,u=0,c=0,d=0,p=({alternatesCount:h=0,uniqueParticipants:f,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:I,category:b,gender:S,stage:w})=>{let U=y===uo,T=y===sr,D=!!(f||w===Ye||b||S);if(T){c=Math.max(c,v+h),I=typeof I=="object"?I:Iu({namedFormat:g});let{teamSize:P,maxDoublesDraw:C,maxSinglesDraw:R,genders:N}=nx({alternatesCount:h,tieFormatName:g,tieFormat:I,drawSize:v});u=Math.max(u,P),l=Math.max(l,R),D||(s=Math.max(s,C)),Object.keys(N).forEach(A=>o[A]+=N[A])}else if(U)if(D){let P=(v+h)*2;d+=P,S&&(o[S]+=P)}else v+h&&v+h>s&&(s=v+h);else if(D){let P=v+h;S&&(o[S]+=P),d+=P}else v&&v>l&&(l=v+h)};if(e==null||e.forEach(h=>{let{tieFormatName:f,tieFormat:g,drawProfiles:v,eventType:y,category:I,gender:b}=h;if(v)for(let S of v){let{tieFormatName:w,tieFormat:U}=S;p({...S,tieFormatName:w||f,tieFormat:U||g,eventType:y,category:I,gender:b})}}),Array.isArray(i))for(let h of i)p(h);let m=Math.max(c*u,s*2,l);return s&&(n=ht),(r||a)<m&&(r=m),r&&s&&[ht,sr].includes(n)&&(l&&Math.floor(l/2)>s?r=Math.floor(l/2):(!l||s*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:c,largestTeamSize:u,participantType:n,gendersCount:o}}function gY({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if((t==null?void 0:t.participantsCount)===0)return{addedCount:0,...J};let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=Bme({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t==null?void 0:t.teamKey,p=Qg({consideredDate:n,...t,participantsCount:o,participantType:s,gendersCount:c,uuids:a}).participants,m=0,h=es({tournamentRecord:e,participants:p});if(h.error)return h;if(m+=h.addedCount,d){let y=rx({tournamentRecord:e,...d});if(y.error)return y}let f=p.filter(({participantType:y})=>y===St).map(Ut),g=t!=null&&t.idPrefix?`${Kt}-${t.idPrefix}`:void 0,v=Se(0,l).map(y=>{let I=f.slice(y*u,(y+1)*u),b=VS({index:y,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:Zr,individualParticipantIds:I,participantType:Kt,participantId:b}});return h=es({participants:v,tournamentRecord:e}),h.error?h:(m+=h.addedCount,{addedCount:m,...J})}function vY({drawProfiles:t,category:e,gender:i}){let r={},n=t==null?void 0:t.reduce((o,s)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=Oe,drawSize:p=0}=s||{};Object.keys(o).includes(d)||(o[d]=0);let m=(u||p)-l;return c||i||e||d===Ye?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=m):o[d]=Math.max(o[d],m),o},{}),a=Object.keys(r);return a.forEach(o=>n[o]+=r[o]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function IY({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Oe]||0,a=e[Ye]||0;return{stageParticipants:{QUALIFYING:r==null?void 0:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(0,a),MAIN:r==null?void 0:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(a,a+n)}}}var Vme={[zt]:2,[er]:1,[cr]:1,[mn]:1,[Mt]:4};function ax(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=Vme,matchUpFormat:n=pu,pointsPerMinute:a=1,sideWeight:o=4}=t;if(!Ua({matchUpFormat:n}))return{error:pN};if(typeof r!="object")return{error:oe};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(o))return{error:oe};let s=Object.keys(r).filter(P=>Object.keys(tW).includes(P)&&P!==qi);if(Object.keys(s).reduce((P,C)=>P+r[C],0)>100)return{error:oe,matchUpStatusProfile:r};let l=s.reduce((P,C)=>(P.pointer=P.pointer+r[C],P.valueMap.push([P.pointer,C]),P),{pointer:0,valueMap:[]}),u=to(1,100),c=(l.valueMap.find(P=>u<=P[0])??[100,qi])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([zt,Mt].includes(c)){i=i||to(1,2);let P={score:d,matchUpStatus:c,winningSide:i};if(!(c===Mt&&to(1,100)>100-e))return{outcome:P}}else if([er,cr].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=kn(n),{bestOf:m=1,exactly:h,setFormat:f,finalSetFormat:g}=p??{},v=[],y=to(0,1),I=i?[i-1]:[...Se(0,o).map(()=>y),1-y],b=[mn,Mt,co,Wc].includes(c)&&(fa(Se(1,h||m))||1),S,w=Se(1,(h??m)+1);for(let P of w){let C=P===(h??m),{set:R,incomplete:N,winningSideNumber:A}=jme({setFormat:C&&g||f,incomplete:b===P,pointsPerMinute:a,matchUpStatus:c,weightedRange:I,setNumber:P});if(v.push(R),N){S=A;break}if($I({matchUp:{score:{sets:v},matchUpFormat:n}}).calculatedWinningSide)break}let U=$I({matchUp:{score:{sets:v},matchUpFormat:n,winningSide:i}}),T=S?i||S:U.calculatedWinningSide,{score:D}=tY({winningSide:T,score:{sets:v},matchUpStatus:c});return{outcome:{winningSide:T,matchUpStatus:c,score:D}}}function jme({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let o={setNumber:a},{setTo:s,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=n,m=to(0,t.length-1),h=t[m],f;if(d){let g=p*e,v=Math.round(g*.2),y=g+fa([1,-1])*v,I=rne(y,2),b=[I,y-I];h&&b.reverse(),f=t[m]+1;let S=b[0]>b[1]&&1||b[1]>b[0]&&2||0;if(r){let[T,D]=b;return Object.assign(o,{side1Score:T,side2Score:D}),gr.includes(i)?{set:o,incomplete:r,winningSideNumber:f}:{set:o,incomplete:r}}S||(b[to(0,1)]+=1),S=b[0]>b[1]?1:2,S!==f&&b.reverse();let[w,U]=b;return Object.assign(o,{side1Score:w,side2Score:U,winningSide:f}),{set:o}}else{if(r)return o.side1Score=to(0,u),o.side2Score=to(0,u),gr.includes(i)&&(f=t[m]+1),{set:o,incomplete:r,winningSideNumber:f};{let g=Se(1,s+1).map(U=>Se(0,s+2-U).map(()=>U)).flat(),v=g[to(0,g.length-1)],y=s&&HO({isSide1:!0,tiebreakAt:u,lowValue:v,setTo:s}),I=!y,b=t.length===1&&t[m]+1;if(!I){b?(y[0]>y[1]?1:2)!==b&&y.reverse():h&&y.reverse();let[U,T]=y;Object.assign(o,{side1Score:U,side2Score:T})}let S=LI({matchUpScoringFormat:{setFormat:n},setObject:o}),w;if(S.hasTiebreakCondition||I){let{NoAD:U,tiebreakTo:T}=l||c||{},D=Se(1,T+1).map(R=>Se(0,T+2-R).map(()=>R)).flat(),P=D[to(0,D.length-1)],C=aD({isSide1:!0,tiebreakNoAd:U,tiebreakTo:T,lowValue:P});if(C)if(I){let R=C[0]>C[1]?1:2;b?R!==b&&C.reverse():h&&C.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=C,w=C[0]>C[1]&&1||C[1]>C[0]&&2||void 0}else S.leadingSide===2?[o.side1TiebreakScore,o.side2TiebreakScore]=C:[o.side2TiebreakScore,o.side1TiebreakScore]=C}o.winningSide=S.winningSide||S.leadingSide||b||w}}return{set:o}}function GS(t){var v,y,I;let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:o,event:s}=t;if(!o)return{error:_e};let l=t.matchUpFormat||o.matchUpFormat||(s==null?void 0:s.matchUpFormat),u=o.structures.slice().sort(Km),c=0,{matchUps:d,matchUpsMap:p}=mr({matchUpFilters:{matchUpTypes:[hi],roundNumbers:[1]},contextFilters:{stages:[Oe,Ye]},inContext:!0,drawDefinition:o});if(d!=null&&d.length){let b=((v=s==null?void 0:s.category)==null?void 0:v.ageCategoryCode)||((y=s==null?void 0:s.category)==null?void 0:y.categoryName);if(b){let S=N4({singlesOnly:!0,tournamentRecord:n,drawDefinition:o,scaleAccessor:{scaleName:b,sortOrder:M4,scaleType:wc},event:s});if(S.error)return S;let{lineUps:w,participantsToAdd:U}=S;es({tournamentRecord:n,participants:U}),Lt({element:o,extension:{name:Uu,value:w}})}else{let S=(I=d[0])==null?void 0:I.structureId,{positionAssignments:w}=ai({drawDefinition:o,structureId:S});if(w!=null&&w.length){let{participants:U}=Mi({participantFilters:{participantTypes:[hi]},tournamentRecord:n}),T=D=>{let P=D.tieMatchUps.filter(Yi(ti)),C=D.tieMatchUps.filter(Yi(Qt));P.forEach((R,N)=>{let A=R.matchUpId;R.sides.forEach(M=>{var k;let{drawPosition:E}=M,O=U==null?void 0:U.find(x=>{var $;let{participantId:F}=x;return(($=w.find(_=>_.participantId===F))==null?void 0:$.drawPosition)===E});if(O){let x=(k=O.individualParticipantIds)==null?void 0:k[N];x&&BS({teamParticipantId:O.participantId,participantId:x,tournamentRecord:n,drawDefinition:o,tieMatchUpId:A,event:s})}})}),C.forEach((R,N)=>{let A=R.matchUpId;R.sides.forEach(M=>{var k,x;let{drawPosition:E}=M,O=U==null?void 0:U.find(F=>{var _;let{participantId:$}=F;return((_=w.find(L=>L.participantId===$))==null?void 0:_.drawPosition)===E});O&&((x=(k=O.individualParticipantIds)==null?void 0:k.slice(N*2,N*2+2))==null||x.forEach(F=>{BS({teamParticipantId:O.participantId,participantId:F,tournamentRecord:n,drawDefinition:o,tieMatchUpId:A,event:s})}))})})};d.forEach(T)}}}let m=typeof i=="string"&&i,h=m&&qi,f=u.length===2&&u[0].finishingPosition===Od&&Vi(u.map(({stage:b})=>b),[Oe,$i]).length===2,g=u.map(({structureId:b})=>b);for(let b of g){if(c>=a)break;let S=o.structures.find(T=>T.structureId===b),w=Wt({contextFilters:{matchUpTypes:[Qt,ti]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:S,event:s}).matchUps;w.length;let U=w.filter(({winningSide:T})=>!T).sort(nh).map(Tr);for(let T of U){if(!isNaN(a)&&c>=a)break;let{matchUps:D}=Wt({matchUpFilters:{matchUpTypes:[Qt,ti]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:S,event:s}),P=D.find(R=>R.matchUpId===T),C=[er,cr].includes(P.matchUpStatus);if(P!=null&&P.readyToScore&&!C){let R=Gme({matchUpStatusProfile:e,tournamentRecord:n,drawDefinition:o,targetMatchUp:P,matchUpFormat:l,matchUpStatus:h,scoreString:m,winningSide:!r&&1,event:s});if(R!=null&&R.error)return R;c+=1}}f&&S.finishingPosition===Od&&t.completeRoundRobinPlayoffs&&jg({structureId:S.structureId,applyPositioning:!0,drawDefinition:o})}return{...J,completedCount:c}}function yY(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus===Vt)return;let{matchUpId:d}=a||{},{outcome:p}=Zk({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),kb({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function Gme(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:u,event:c}=t;if(l||a)return yY(t);let{matchUpId:d}=s||{},{outcome:p}=ax({matchUpStatusProfile:e,matchUpFormat:o,winningSide:u});return kb({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function bY({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:o}){var f,g,v,y;let s=Gi({event:o}).flightProfile,{eventName:l,eventType:u,category:c}=o,{startDate:d}=r,p=[],m=(c==null?void 0:c.categoryName)||(c==null?void 0:c.ageCategoryCode)||(c==null?void 0:c.ratingType),h=(f=o.drawDefinitions)==null?void 0:f.map(({drawId:I})=>I);if(Array.isArray(s==null?void 0:s.flights))for(let[I,b]of s.flights.entries()){let{drawId:S,stage:w,drawName:U,drawEntries:T}=b;p.push(b.drawId);let D=n[I],{seedsCount:P,generate:C=!0}=D||{};if(C){let R=T.filter(Ta(Vl)).map(Ta(Vl)),N=m||l;if(r&&P&&P<=R.length&&Se(1,P+1).forEach((k,x)=>{let F={scaleValue:k,scaleName:N,scaleType:Pl,eventType:u,scaleDate:d},$=R[x];Tb({tournamentRecord:r,participantId:$,scaleItem:F})}),h==null?void 0:h.includes(S))break;let A=Mb({...D,matchUpType:u,seedingScaleName:N,tournamentRecord:r,drawEntries:T,drawName:U,drawId:S,isMock:a,event:o,stage:w});if(A.error)return{error:A.error,drawIds:[]};let{drawDefinition:M}=A;if(!M)return{error:xa};let E=(g=n[I])==null?void 0:g.drawExtensions;if(Array.isArray(E)&&E.filter(tl).forEach(k=>Lt({element:M,extension:k})),A=Nb({suppressNotifications:!0,tournamentRecord:r,drawDefinition:M,event:o}),A.error)return{error:A.error,drawIds:[]};if(D!=null&&D.withPlayoffs){let k=(v=M.structures)==null?void 0:v[0].structureId,x=qT({idPrefix:D.idPrefix,...D.withPlayoffs,tournamentRecord:r,drawDefinition:M,structureId:k,isMock:a,event:o});if(x!=null&&x.error)return x}let O=D==null?void 0:D.completionGoal;if((D==null?void 0:D.automated)!==!1&&(e||O)){let k=D==null?void 0:D.matchUpFormat,x=GS({completeAllMatchUps:!O&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:O,drawDefinition:M,matchUpFormat:k,event:o});if(x.error)return{error:x.error,drawIds:[]};let F=x.completedCount;if((D==null?void 0:D.drawType)===Bl){let $=(y=M.structures)==null?void 0:y.find(B=>B.stage===Oe);if(!$)return{error:Ei};let _=jg({structureId:$.structureId,tournamentRecord:r,drawDefinition:M,event:o});if(_.error)return{error:_.error,drawIds:[]};let L=O?O-(F??0):void 0;if(_=GS({completeAllMatchUps:!O&&e,completionGoal:O?L:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:M,matchUpFormat:k,event:o}),_.error)return{error:_.error,drawIds:[]}}}}}return{...J,drawIds:p}}function wY(t){var w,U;let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:o,event:s,uuids:l}=t,{category:u,gender:c,eventType:d}=s,p=Yi(Qs)(d)&&St||Yi(uo)(d)&&ht||d,m=i[Oe]||0,h=i[Ye]||0,f=(w=a.drawProfiles)!=null&&w.length?m+h:((U=a.participantsProfile)==null?void 0:U.participantsCount)??0,g=[Jt,pi].includes(c)?c:void 0,v=e!=null&&e.idPrefix?`E-${o}-${e==null?void 0:e.idPrefix}`:void 0,{participants:y}=Qg({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n==null?void 0:n.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:f,ratingsParameters:r,category:u,idPrefix:v,sex:g}),I=es({tournamentRecord:n,participants:y});if(I.error)return I;let b=y==null?void 0:y.filter(({participantType:T})=>T===p),S=y==null?void 0:y.map(Ut);return{uniqueDrawParticipants:b,uniqueParticipantIds:S}}function Hme({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=Gs,qualifyingPositions:o=0,stage:s=Oe,drawSize:l=0,drawName:u,drawId:c}=r,d=l-o,p=i.slice(0,d).map(Ut);if(p.length){let f=Hs({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:n});if(f.error)return f}let m=p.map(f=>({entryStatus:oa,entryStage:s,participantId:f})),h=DD({drawName:u||a,qualifyingPositions:o,drawEntries:m,drawId:c,event:n,stage:s});return h.error?h:{...J}}function UY({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:o,event:s}){let l=0;for(let u of n){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=Oe,drawSize:m=0}=u,h=m-c,f=d||o||a||p===Ye,g=f?t.slice(l,l+h):i[p||Oe]||[];f&&(l+=h);let v=Hme({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:u,event:s});if(v.error)return v}return{...J}}function SY(t){var q;let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,publish:p,isMock:m,uuids:h}=t,f=c.gender,g=c.eventName,{eventType:v=Qs,policyDefinitions:y,drawProfiles:I=[],eventExtensions:b,surfaceCategory:S,tieFormatName:w,processCodes:U,discipline:T,eventLevel:D,timeItems:P,ballType:C,category:R}=c,N=c.eventId||Gt(),A=c.tieFormat||(v===sr?Iu({namedFormat:w,event:{eventId:N,category:R,gender:f},hydrateCollections:o,isMock:m}):void 0),M=u.participants;for(let W of I)!f&&W.gender&&(f=W==null?void 0:W.gender);let{stageParticipantsCount:E,uniqueParticipantsCount:O,uniqueParticipantStages:k}=vY({drawProfiles:I,category:R,gender:f}),x=Yi(Qs)(v)&&St||Yi(uo)(v)&&ht||v,{uniqueDrawParticipants:F=[],uniqueParticipantIds:$=[]}=k?wY({event:{eventType:v,category:R,gender:f},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,uuids:h}):{},{eventAttributes:_}=c;typeof _!="object"&&(_={});let L=(R==null?void 0:R.categoryName)||(R==null?void 0:R.ageCategoryCode)||(R==null?void 0:R.ratingType);g=g||L||"Generated Event";let B={..._,surfaceCategory:S,processCodes:U,discipline:T,eventLevel:D,eventName:g,eventType:v,tieFormat:A,ballType:C,category:R,eventId:N,gender:f};if(b!=null&&b.length&&Array.isArray(b)){let W=b.filter(tl);W!=null&&W.length&&Object.assign(B,{extensions:W})}if(Array.isArray(P)&&P.forEach(W=>uh({event:j,timeItem:W})),typeof y=="object")for(let W of Object.keys(y))Bd({policyDefinitions:{[W]:y[W]},event:B});B.category&&(B.category.categoryName=L);let V,G=qg({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:B});if(G.error)return G;let j=G==null?void 0:G.event,{stageParticipants:z}=IY({allUniqueParticipantIds:e,stageParticipantsCount:E,eventParticipantType:x,targetParticipants:M});if(I!=null&&I.length){let W=UY({uniqueDrawParticipants:F,autoEntryPositions:a,stageParticipants:z,tournamentRecord:u,drawProfiles:I,category:R,gender:f,event:j});if(W.error)return W;let Y=bY({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:s,tournamentRecord:u,drawProfiles:I,isMock:m,event:j});if(Y.error)return Y;V=Y.drawIds}else if((q=c==null?void 0:c.participantsProfile)!=null&&q.participantsCount){let W=F.map(Ut);if(W.length){let Y=Hs({participantIds:W,autoEntryPositions:a,tournamentRecord:u,entryStage:Oe,event:j});if(Y.error)return Y}}return p&&Kg({tournamentRecord:u,event:j}),{drawIds:V,eventId:N,uniqueParticipantIds:$}}function ox({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!Ia(e))return{error:Nr};let n="addSchedulingProfileRound",{extension:a}=gt({name:wm,tournamentRecords:t,discover:!0}),o=(a==null?void 0:a.value)||[],s=o.find(p=>_l(e,p.scheduleDate));if(!s){let{startDate:p,endDate:m}=lD({tournamentRecords:t}),h=new Date(e);if(p&&h<new Date(p)||m&&h>new Date(m))return{error:Nr};s={scheduleDate:e,venues:[]},o.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(m=>!u.includes(m)).sort().map(m=>Nt(p[m])?c(p[m]):p[m]).flat().join("|");if(l.rounds.find(p=>c(p)===c(r)))return ee({result:{error:PG},stack:n});l.rounds.push(r);let d=zg({tournamentRecords:t,schedulingProfile:o});return d.error?d:{...J}}function zme({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:oe};let i=Fg({tournamentRecord:e}).containedStructures,r=Br({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let o of t){let{scheduleDate:s,venues:l=[]}=o;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:m,winnerFinishingPositionRange:h,roundSegment:f}=p,g=r.filter(v=>{var b;let y=(h==null?void 0:h.indexOf("-"))>0&&h.split("-").map(S=>+S),I=(b=v.finishingPositionRange)==null?void 0:b.winner;return v.drawId===m&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!I||!y||Vi(I,y).length===2||ct(I).length===ct(y).length&&Vi(I,y).length===ct(I).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:I,structureName:b,roundName:S}=g,w=g.structureId;y&&!h&&(w=Object.keys(i).find(D=>i[D].includes(w))??w);let U={tournamentId:n,structureId:w,roundNumber:y,roundSegment:f,eventId:v,drawId:m},T=ox({tournamentRecords:{[n]:e},round:U,scheduleDate:s,venueId:d});if(T.error)return T;a.push({structureName:b,roundName:S,drawName:I,...U})}}}}return{scheduledRounds:a}}function _D(t){var Pe,it,It;let e=ze(t,[{drawProfile:!0,_ofType:ea}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,isMock:d=!0,drawProfile:p,startDate:m,drawIndex:h,uuids:f}=t,g=Me(p,!1,!0),{excessParticipantAlternates:v=!0,matchUpFormat:y=pu,drawType:I=Gs,tournamentAlternates:b=0,alternatesCount:S=0,qualifyingPositions:w,qualifyingProfiles:U,generate:T=!0,eventExtensions:D,drawExtensions:P,completionGoal:C,tieFormatName:R,buildTeams:N,seedsCount:A,timeItems:M,drawName:E,category:O,idPrefix:k,publish:x,gender:F,stage:$}=g,_=g.drawSize||(g.ignoreDefaults?void 0:32),L=g.eventId||Gt(),B=p.eventType||p.matchUpType||Qs,V=B===uo?ht:St,G=Nt(p.tieFormat)&&p.tieFormat||B===Kt&&Iu({event:{eventId:L,category:O,gender:F},namedFormat:R,hydrateCollections:s,isMock:d})||void 0,j=(O==null?void 0:O.categoryName)||(O==null?void 0:O.ageCategoryCode)||(O==null?void 0:O.ratingType),z=p.eventName||j||`Generated ${B}`,q=(c==null?void 0:c.participants)||[],W=((U==null?void 0:U.map(me=>me.structureProfiles||[]).flat().reduce((me,fe)=>{let pe=!fe.participantsCount||fe.participantsCount>fe.drawSize?fe.drawSize:fe.participantsCount||0;return me+pe},0))||0)*(V===ht?2:1),Y=(!p.participantsCount||p.participantsCount>_?_:p.participantsCount)||0,re={eventName:z,eventType:B,tieFormat:G,category:O,eventId:L,gender:F};Array.isArray(M)&&M.forEach(me=>uh({event:re,timeItem:me}));let{eventAttributes:K}=p;if(typeof K!="object"&&(K={}),Object.assign(re,K),(D==null?void 0:D.length)&&Array.isArray(D)){let me=D.filter(tl);me!=null&&me.length&&Object.assign(re,{extensions:me})}let H=[];if((r==null?void 0:r.participantsCount)===0||p.uniqueParticipants||W||!c||F||O){let me=(Y||0)+S+W,fe=me,pe={[Jt]:0,[pi]:0},Fe,De;B===Kt&&({teamSize:Fe,genders:De}=nx({alternatesCount:S,tieFormatName:R,tieFormat:G,drawSize:_}),Object.keys(De).forEach(he=>{[Jt,pi].includes(he)&&De[he]&&(pe[he]=_*De[he])}),fe=Fe*((_||0)+W));let je=r!=null&&r.idPrefix?`D-${h}-${r==null?void 0:r.idPrefix}`:void 0,ue=Qg({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:fe,consideredDate:c==null?void 0:c.startDate,sex:F||(r==null?void 0:r.sex),rankingRange:p.rankingRange,uuids:p.uuids||f,ratingsParameters:u,participantType:V,gendersCount:pe,idPrefix:je,category:O}).participants;if(re.category&&(re.category.categoryName=j),c){let he=es({participants:ue,tournamentRecord:c});if(he.error)return he}if(ue.forEach(({participantId:he})=>H.push(he)),q=ue,B===Kt){let he=De[Jt]?ue.filter(({participantType:Be,person:nt})=>Be===St&&(nt==null?void 0:nt.sex)===Jt).map(Ut):[],Re=De[pi]?ue.filter(({participantType:Be,person:nt})=>Be===St&&(nt==null?void 0:nt.sex)===pi).map(Ut):[],xe=ue.filter(({participantType:Be})=>Be===St).map(Ut).filter(Be=>!he.includes(Be)&&!Re.includes(Be)),Ce=[...g.teamNames??[],...jS({count:me}).names],we=Fe-(De[Jt]+De[pi]),Ue=0,wt=0,Le=0,rt=Se(0,me).map(Be=>{let nt=Re.slice(Ue,Ue+De[pi]),Ii=he.slice(wt,wt+De[Jt]),be=xe.slice(Le,Le+we);Ue+=De[pi],wt+=De[Jt],Le+=we;let Et=N!==!1?[...nt,...Ii,...be]:[];return{participantName:Ce[Be]||`Team ${Be+1}`,participantOtherName:`TM${Be+1}`,participantRole:Zr,individualParticipantIds:Et,participantType:Kt,participantId:Gt()}}),Ci=es({participants:rt,tournamentRecord:c});if(!Ci.success)return Ci;q=rt}}let Q=me=>{let{participantType:fe}=me;return Yi(Qs)(B)&&fe===St||Yi(uo)(B)&&fe===ht?!0:B===Kt&&fe===Kt},X=me=>{var fe,pe;return!p.gender||((fe=me.person)==null?void 0:fe.sex)===p.gender?!0:(pe=me.individualParticipantIds)==null?void 0:pe.some(Fe=>{let De=q.find(je=>je.participantId===Fe);return De&&X(De)})},ie=q.filter(Q).filter(X).filter(({participantId:me})=>!i.includes(me)),ae=ie.slice(0,Y).map(me=>me.participantId);if(d&&(ae!=null&&ae.length)){let me=Hs({autoEntryPositions:o,entryStage:$,tournamentRecord:c,participantIds:ae,event:re});if(me.error)return me}let le=W?ie.slice(Y,Y+W).map(me=>me.participantId):0;if(d&&(le!=null&&le.length)){let me=0,fe=1,pe=(De,je)=>De.stageSequence-je.stageSequence,Fe=(De,je)=>De.roundTarget-je.roundTarget;for(let De of U.sort(Fe)){fe=De.roundTarget||fe;let je=1,ue;for(let he of De.structureProfiles.sort(pe)){let Re=(he.drawSize||iN(he.participantsCount))-(ue||0),xe=le.slice(me,me+Re),Ce=Hs({entryStage:Ye,entryStageSequence:je,autoEntryPositions:o,tournamentRecord:c,participantIds:xe,roundTarget:fe,event:re});if(Ce.error)return Ce;ue=he.qualifyingPositions,me+=Re,je+=1}fe+=1}}let ne=v&&((Pe=c==null?void 0:c.participants)==null?void 0:Pe.filter(({participantId:me})=>!ae.includes(me)).filter(Q).filter(X).slice(0,S||_-Y||b).map(me=>me.participantId));if(d&&(ne!=null&&ne.length)){let me=Hs({participantIds:ne,autoEntryPositions:!1,entryStatus:Vo,tournamentRecord:c,event:re});if(me.error)return me.error}let de=j||z;c&&A&&A<=ae.length&&Se(1,A+1).forEach((me,fe)=>{let pe={scaleName:de,scaleDate:m,scaleType:FA,scaleValue:me,eventType:B},Fe=ae[fe];Tb({tournamentRecord:c,participantId:Fe,scaleItem:pe})});let Ie=Mb({...Me(p,!1,!0),tournamentRecord:c,seedingScaleName:de,matchUpFormat:y,eventId:L,isMock:d,event:re});if(Ie.error)return Ie;if(!Ie.drawDefinition)return{error:xa};let{drawDefinition:ce}=Ie,ke=ce.drawId;if(Array.isArray(P)&&P.filter(tl).forEach(me=>Lt({element:ce,extension:me})),T){if(Nb({drawDefinition:ce,event:re,suppressNotifications:!0}),p.withPlayoffs){let fe=(it=ce.structures)==null?void 0:it[0].structureId,pe=qT({...p.withPlayoffs,tournamentRecord:c,drawDefinition:ce,structureId:fe,idPrefix:k,isMock:d,event:re});if(pe!=null&&pe.error)return pe}let me=p.automated===!1;if(d&&!me){let fe=pe=>{var je;let Fe=GS({completeAllMatchUps:pe.completeAllMatchUps,completionGoal:pe.completionGoal,matchUpStatusProfile:n,randomWinningSide:l,tournamentRecord:c,drawDefinition:ce,matchUpFormat:y,event:re});if(Fe.error)return Fe;let De=Fe.completedCount;if(I===Bl){let ue=(je=ce.structures)==null?void 0:je.find(xe=>xe.stage===Oe);if(!ue)return{error:Ei};jg({structureId:ue.structureId,tournamentRecord:c,drawDefinition:ce,event:re});let he=C?C-(De??0):void 0,Re=GS({completionGoal:C?he:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawDefinition:ce,matchUpFormat:y,event:re});if(Re.error)return Re}};if(C&&fe({completionGoal:C}),p.outcomes){let{matchUps:pe}=Sn({inContext:!0,drawDefinition:ce,event:re});for(let Fe of p.outcomes){let{matchUpStatus:De=qi,matchUpStatusCodes:je,stageSequence:ue=1,matchUpIndex:he=0,structureOrder:Re,matchUpFormat:xe,drawPositions:Ce,roundPosition:we,stage:Ue=Oe,roundNumber:wt,winningSide:Le,scoreString:rt}=Fe,Ci=(pe==null?void 0:pe.reduce((be,Et)=>{let{structureId:Ee,matchUpId:qe}=Et;return be[Ee]?be[Ee].push(qe):be[Ee]=[qe],be},{}))??[],Be=Object.assign({},...Object.keys(Ci).map((be,Et)=>({[be]:Et+1}))),nt=(It=pe==null?void 0:pe.filter(be=>(!Ue||be.stage===Ue)&&(!ue||be.stageSequence===ue)&&(!wt||be.roundNumber===wt)&&(!we||be.roundPosition===we)&&(!Re||Be[be.structureId]===Re)&&(!Ce||Vi(Ce,be.drawPositions).length===2)))==null?void 0:It[he],Ii=yY({matchUpStatusCodes:je,tournamentRecord:c,drawDefinition:ce,targetMatchUp:nt,matchUpFormat:xe,matchUpStatus:De,scoreString:rt,winningSide:Le});if(Ii!=null&&Ii.error)return Ii}}a&&fe({completeAllMatchUps:a})}x&&Kg({tournamentRecord:c,event:re})}else{let me=DD({drawEntries:ce.entries,drawName:E||I,qualifyingPositions:w,drawId:ke,event:re,stage:$});if(me.error)return me}return{...J,event:Ge(re),uniqueParticipantIds:H,targetParticipants:q,drawDefinition:ce,eventId:L,drawId:ke}}var TY=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),Wme=TY;function HS(t){return parseInt(t)}function hV({startTime:t="",endTime:e=""}={}){if(!t||!e||!Ud.test(t)||!Ud.test(e))return!1;let[i,r]=t.split(":").map(HS),[n,a]=e.split(":").map(HS);return n<i?!1:!(i===n&&a<r)}function qme(t,e){let[i,r]=t.startTime.split(":").map(HS),[n,a]=e.startTime.split(":").map(HS);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function DY({dateAvailability:t}){if(!t)return{error:VG};if(!Array.isArray(t))return{error:DU};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:DU};let{date:n,startTime:a,endTime:o,bookings:s=[]}=r;if(!a||!o)return{error:DU};if(n&&!Zs.test(n))return{error:Nr,dateAvailability:{date:n},info:e};if(!Ud.test(a))return{error:Mo,dateAvailability:{startTime:a},info:i};if(!Ud.test(o))return{error:Mo,dateAvailability:{endTime:o},info:i};if(a===o)return{error:Mo,dateAvailability:{startTime:a,endTime:o},info:"startTime and endTime are equivalent"};if(!hV({startTime:a,endTime:o}))return{error:Mo,dateAvailability:{startTime:a,endTime:o},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:cS};for(let l of s){if(typeof l!="object")return{error:cS};let{startTime:u,endTime:c}=l;if(!Ud.test(u))return{error:Mo,booking:{startTime:u},info:i};if(!Ud.test(c))return{error:Mo,booking:{endTime:c},info:i};if(u===c)return{error:Mo,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!hV({startTime:u,endTime:c}))return{error:Mo,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function $D({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=Jl({tournamentRecord:t,venueId:i});if(!a)return{error:Gm};a.courts||(a.courts=[]);let o={...TY(),venueId:i,courtId:r};if(o.courtId||(o.courtId=Gt()),a.courts.some(s=>s.courtId===o.courtId))return{error:nH};{let s=((n==null?void 0:n.dateAvailability)||[]).map(c=>{var d;return{...c,date:pt(c.date),startTime:bi(c.startTime),endTime:bi(c.endTime),bookings:(d=c.bookings)==null?void 0:d.map(({startTime:p,endTime:m,bookingType:h})=>({startTime:bi(p),endTime:bi(m),bookingType:h}))}}),l=Object.keys(o);for(let c of l)if(n!=null&&n[c])if(c==="dateAvailability"){let d=DY({dateAvailability:s});if(!d.valid&&d.error)return d;o.dateAvailability=s}else o[c]=n[c];let u=o;return a.courts.push(u),e||lt({payload:{venue:a,tournamentId:t.tournamentId},topic:dp,key:a.venueId}),{...J,court:Me(o),venueId:i}}}function sx(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:jc};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let o of Object.values(r)){let{venue:s}=Jl({tournamentRecord:o,venueId:i});if(s){let l=Yme({...t,tournamentRecord:o});for(let u of(l==null?void 0:l.courts)??[])n.push(u==null?void 0:u.courtId);if(l.error)return l;a=!0}}return a?{...J,courtIds:n}:{error:Gm}}function Yme({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:jc};let m=Jl({tournamentRecord:r,venueId:d});if(m.error)return m;let{venue:h}=m;if(!Li(o)||!n)return{error:rH};o=o??n.length;let f=Se(0,o).map(g=>{let v=a==null?void 0:a[g],y=v?p.map(I=>({date:$o(I),startTime:s,endTime:u,...v})):e;return v&&s&&u&&y.push({startTime:s,endTime:u}),{courtName:n[g]||i&&(h==null?void 0:h.venueAbbreviation)&&`${h==null?void 0:h.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||c&&`${c}-${v+1}`;return $D({disableNotice:!0,tournamentRecord:r,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return f.length!==o?ee({info:"not all courts could be generated",result:{error:oe}}):(h&&lt({payload:{venue:h,tournamentId:r.tournamentId},topic:dp,key:h.venueId}),{...J,courts:Me(f)})}function lx({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,o=[];for(let[s,l]of i.entries()){let{venueAbbreviation:u,venueId:c=(r==null?void 0:r.pop())??Gt(),dateAvailability:d,startTime:p="07:00",endTime:m="19:00",courtTimings:h,courtsCount:f,courtNames:g,venueName:v,idPrefix:y,courtIds:I}=l,b={venueName:v||`Venue ${s+1}`,venueAbbreviation:u,venueId:c},S=tb({tournamentRecord:t,venue:b});if(S.error){if(e)continue;return S}o.push(c);let w=Df(n,a),U=!Array.isArray(d)&&[{startTime:p,endTime:m}].concat(w.map(T=>({date:$o(T),startTime:p,endTime:m})));if(f||g){let T=sx({dateAvailability:d||U,tournamentRecord:t,courtTimings:h,courtsCount:f,courtNames:g,startTime:p,idPrefix:y,courtIds:I,endTime:m,venueId:c,dates:w});if(T.error)return T}}return o}function Kme(t){var c,d,p;let{tournamentRecord:e,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:o,uuids:s}=t,l=0;for(let m of i){let h=[],{tieFormatName:f=gS,teamProfiles:g=[],teamsCount:v=0,category:y,idPrefix:I,gender:b}=m,S=m.leagueName??m.eventName??`League ${l+1}`,w=m.leagueId??m.eventId??(s==null?void 0:s.pop())??Gt();r.push(w);let U=Nt(m.tieFormat)&&m.tieFormat||Iu({event:{eventId:w,category:y,gender:b},namedFormat:f,isMock:t.isMock})||void 0;if(!U)return{error:Pg};let T=Math.max(v,g.length),D=Se(0,T),{genders:P,teamSize:C}=nx({tieFormat:U,drawSize:T}),R={[pi]:0,[Bn]:0,[wd]:0,[Jt]:0,[Ds]:0};Object.keys(P).forEach(A=>R[A]+=P[A]);for(let A of D){let M=((c=g==null?void 0:g[A])==null?void 0:c.teamName)??`Team ${A+1}`,E=((d=g==null?void 0:g[A])==null?void 0:d.teamId)||(s==null?void 0:s.pop())||Gt(),O=m.startDate??t.startDate,k=Qg({...m==null?void 0:m.participantsProfile,participantsCount:C,consideredDate:O,gendersCount:R,category:y,gender:b,uuids:s}).participants,x=k.map(V=>V.participantId),F=Kt,$=E??VS({participantType:F,idPrefix:I,index:A,uuids:s});h.push({participantId:$,entryStatus:oa,entryStage:Oe});let _=((p=g==null?void 0:g[A])==null?void 0:p.venueIds)??[],L={participantId:$,participantRole:Zr,participantName:M,individualParticipantIds:x,participantType:F,homeVenueIds:_};_.forEach(V=>!n.includes(V)&&n.push(V)),o.push(...x),o.push($);let B=es({participants:[L,...k],tournamentRecord:e});if(B.error)return B}let N={eventName:S,entries:h,eventType:Kt,tieFormat:U,category:y,eventId:w,gender:b};if(e.events||(e.events=[]),e.events.push(N),h.length){let A=(Li(m.roundsCount)&&m.roundsCount)??m.roundsCount===Fae?(T-1)*2:T-1,M=Mb({automated:m.automated,tournamentRecord:e,drawType:La,roundsCount:A,drawSize:T,event:N});if(M.error)return M;let{drawDefinition:E}=M;if(E){let O=E==null?void 0:E.drawId;Nb({drawDefinition:E,event:N,suppressNotifications:!0}),a.push(O)}}l++}let u=n.map(m=>({venueId:m}));lx({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:u,uuids:s})}var Xme=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function PY(t){var y,I,b;let{startDate:e,endDate:i}=t??{},{tournamentName:r=fa(Xme),ratingsParameters:n=Mr,tournamentExtensions:a,policyDefinitions:o,schedulingProfile:s,venueProfiles:l,uuids:u}=t??{},c=(t==null?void 0:t.isMock)===!1?void 0:!0;if(e&&!Ia(e)||i&&!Ia(i))return{error:Nr};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:oe};if(!e){let S=new Date;e=$o(i??S),i=$o(S.setDate(S.getDate()+7))}if(!i){let S=new Date(e);i=$o(S.setDate(S.getDate()+7))}let d=LD({...t.tournamentAttributes??{},tournamentName:r,startDate:e,endDate:i,isMock:c}),p=l!=null&&l.length?lx({tournamentRecord:d,venueProfiles:l,uuids:u}):[];if(a!=null&&a.length&&Array.isArray(a)){let S=a.filter(w=>tl({extension:w}));S!=null&&S.length&&Object.assign(d,{extensions:S,isMock:c})}if(typeof o=="object")for(let S of Object.keys(o))Bd({policyDefinitions:{[S]:o[S]},tournamentRecord:d});if(!((y=t==null?void 0:t.leagueProfiles)!=null&&y.length)||(I=t.eventProfiles)!=null&&I.length||(b=t.drawProfiles)!=null&&b.length||t.participantsProfile){let S=gY({tournamentRecord:d,...t});if(!S.success)return S}let m=[],h=[],f=[];if(t.leagueProfiles){let S=Kme({allUniqueParticipantIds:m,tournamentRecord:d,...t,eventIds:h,venueIds:p,drawIds:f});if(S!=null&&S.error)return S}if(t.drawProfiles){let S=Jme({allUniqueParticipantIds:m,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:f});if(S!=null&&S.error)return S}if(t.eventProfiles){let S=Zme({allUniqueParticipantIds:m,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:f});if(S!=null&&S.error)return S}let{scheduledRounds:g=void 0,schedulerResult:v={}}=s?Qme({...t,tournamentRecord:d}):{};return AN(),Ge({...J,tournamentRecord:d,scheduledRounds:g,schedulerResult:v,eventIds:h,venueIds:p,drawIds:f})}function Jme(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,o=0;for(let s of i){let l=_D({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:s,drawIndex:o,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if((s==null?void 0:s.addEvent)!==!1){if(l=qg({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),n.push(c)}p!=null&&p.length&&r.push(...p),o+=1}}function Zme(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let o of e){let s=SY({...t,eventIndex:a,eventProfile:o});if(s.error)return s;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=s;u&&n.push(...u),r.push(l),c!=null&&c.length&&i.push(...c),a+=1}}function Qme(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,o=zme({schedulingProfile:e,tournamentRecord:i});if(o.error)return o;let s=o.scheduledRounds;if(r){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:FD({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:n}),scheduledRounds:s}}return{scheduledRounds:s}}var RY={};yt(RY,{anonymizeTournamentRecord:()=>CY,modifyTournamentRecord:()=>EY});function CY({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){var k,x,F,$,_;if(!i)return{error:ge};let o=Array.isArray(t)?DB.concat(...t):DB,s=L=>{var B;return Array.isArray(t)?(B=L==null?void 0:L.extensions)==null?void 0:B.filter(V=>o.includes(V.name)):L==null?void 0:L.extensions},l={};i.extensions=s(i);let u=a||Gt();l[i.tournamentId]=u,i.tournamentId=u,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${$o(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let L of i.participants||[]){L.extensions=s(L),L.onlineResources=[];let B=Gt();l[L.participantId]=B,L.participantId=B}for(let L of i.participants||[])Array.isArray(L.individualParticipantIds)&&(L.individualParticipantIds=L.individualParticipantIds.map(B=>l[B]));let c=0;for(let L of i.venues||[]){L.venueAbbreviation=`V${c}`,L.extensions=s(L),L.venueName=`Venue #${c}`,L.onlineResources=[],L.addresses=[];let B=Gt();l[L.venueId]=B,L.isMock=!0,c+=1;let V=0;for(let G of L.courts||[])G.courtName=`V${c}C${V}`,G.extensions=s(G),G.onlineResources=[],G.isMock=!0,V+=1}let d=1;for(let L of i.events||[]){L.extensions=s(L),L.onlineResources=[],L.isMock=!0;let B=Gt();l[L.eventId]=B,L.eventId=B;let V=((k=L.category)==null?void 0:k.categoryName)||((x=L.category)==null?void 0:x.ageCategoryCode)||((F=L.category)==null?void 0:F.ratingType)||L.gender;if(L.eventName=`Event ${d} ${V}`,Array.isArray(L.entries))for(let j of L.entries)j.participantId=l[j.participantId];for(let j of L.drawDefinitions||[]){j.extensions=s(j);let z=Gt();if(l[j.drawId]=z,j.drawId=z,j.isMock=!0,Array.isArray(j.entries))for(let W of j.entries)W.participantId=l[W.participantId];let q=W=>{W.extensions=s(W);let Y=Gt();l[W.structureId]=Y,W.structureId=Y;for(let re of W.positionAssignments||[])re.participantId&&(re.participantId=l[re.participantId]);for(let re of W.seedAssignments||[])re.participantId&&(re.participantId=l[re.participantId]);for(let re of W.matchUps||[]){re.isMock=!0;for(let K of re.sides||[])K.lineUp&&(K.lineUp=K.lineUp.map(({participantId:H,collectionAssignments:Q})=>({participantId:l[H],collectionAssignments:Q})))}};for(let W of j.structures||[])if(q(W),Array.isArray(W.structures))for(let Y of W.structures)q(Y);for(let W of j.links||[])W.source.structureId=l[W.source.structureId],W.target.structureId=l[W.target.structureId]}let{extension:G}=gt({name:Jo,element:L});Array.isArray(($=G==null?void 0:G.value)==null?void 0:$.flights)&&((_=G==null?void 0:G.value.flights)==null||_.forEach(j=>{if(j.drawId=l[j.drawId],Array.isArray(j.drawEntries))for(let z of j.drawEntries)z.participantId=l[z.participantId]})),d+=1}let p=i.startDate||$o(new Date),m=(i.participants||[]).filter(({participantType:L})=>L===St),h=m.reduce((L,B)=>{var G;let V=(G=B.person)==null?void 0:G.sex;return[Jt,pi].includes(V)?L[V]+=1:L[wd]+=1,L},{[Jt]:0,[pi]:0,[wd]:0}),f=Object.assign({},...Object.keys(h).map(L=>{var B;return{[L]:((B=fY({category:{ageCategoryCode:"O18"},count:h[L],addressProps:{citiesCount:10},personExtensions:[],consideredDate:p,sex:L}))==null?void 0:B.persons)||[]}})),g={[Jt]:0,[pi]:0,[wd]:0},v=m.length,y=m.reduce((L,B)=>{var q,W;let V=((W=(q=B.person)==null?void 0:q.addresses)==null?void 0:W[0])||{},{city:G,state:j,postalCode:z}=V;return L.cities.includes(G)||L.cities.push(G),L.states.includes(j)||L.states.push(j),L.postalCodes.includes(z)||L.postalCodes.push(z),L},{cities:[],postalCodes:[],states:[]}),I=y.postalCodes.length,b=y.cities.length,S=y.states.length,{cities:w}=dY({count:b||v,participantsCount:v}),{states:U}=pY({count:S||v,participantsCount:v}),{postalCodes:T}=mY({count:I||v,participantsCount:v}),D={cities:w,states:U,postalCodes:T};m.forEach((L,B)=>{var W,Y;let V=L==null?void 0:L.person,G=(V==null?void 0:V.sex)||wd,j=(W=pt(V==null?void 0:V.birthDate))==null?void 0:W.split("-")[0],z=g[G],q=f[G][z];if(g[G]+=1,j){let[,re,K]=((Y=q==null?void 0:q.birthDate)==null?void 0:Y.split("-"))||[],H=[j,re,K].join("-");q.birthDate=H}if(V!=null&&V.addresses){let re=hY({...D,participantIndex:B,nationalityCode:q.nationalityCode});q.addresses=[re]}q.personId=(n==null?void 0:n[B])||Gt(),e?(q.standardFamilyName=q.lastName,q.standardGivenName=q.firstName,L.participantName=`${q.standardGivenName} ${q.standardFamilyName}`):(q.standardFamilyName=V==null?void 0:V.standardFamilyName,q.standardGivenName=V==null?void 0:V.standardGivenName),delete q.firstName,delete q.lastName,q.extensions=s(V),L.person=q,l[V==null?void 0:V.personId]=q.personId}),(i.participants||[]).filter(({participantType:L})=>L===ht).forEach(L=>{let{individualParticipantIds:B}=L;L.participantName=ehe({individualParticipantIds:B,individualParticipants:m})});let P=(i.participants||[]).filter(({participantType:L})=>L===Kt),C=P.length,R=jS({count:C}).names;P.forEach((L,B)=>{L.participantName=R[B]});let N=(i.participants||[]).filter(({participantType:L})=>L===Wa),A=N.length,M=jS({count:A,nameRoot:"Group"}).names;N.forEach((L,B)=>{L.participantName=M[B]});let{extension:E}=gt({element:i,name:wm});Array.isArray(E==null?void 0:E.value)&&(E==null||E.value.forEach(L=>{L.tournamentId=l[L.tournamentId],L.structureId=l[L.structureId],L.eventId=l[L.eventId],L.drawId=l[L.drawId]}));let{extension:O}=gt({element:i,name:kg});return Array.isArray(O==null?void 0:O.value)&&(O==null||O.value.forEach(L=>{L.personId=l[L.personId]})),{...J}}function ehe({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function EY(t){var D,P,C;let{ratingsParameters:e=Mr,participantsProfile:i={},matchUpStatusProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,schedulingProfile:l,tournamentRecord:u,autoSchedule:c,eventProfiles:d,periodLength:p,venueProfiles:m,drawProfiles:h,isMock:f,uuids:g}=t;if(!u)return{error:ge};let v=[],y=[],I=[];d==null||d.forEach(R=>{var A;let N=(A=u.events)==null?void 0:A.find((M,E)=>R.eventIndex!==void 0&&E===R.eventIndex||R.eventName&&M.eventName===R.eventName||R.eventId&&M.eventId===R.eventId);N!=null&&N.gender&&(R.gender=N.gender)});let b=((D=u.participants)==null?void 0:D.length)||void 0;b&&(i!=null&&i.idPrefix)&&(i.idPrefix=`${i.idPrefix}-${b}`);let S=gY({startDate:u.startDate,participantsProfile:i,tournamentRecord:u,eventProfiles:d,drawProfiles:h,uuids:g});if(!S.success)return S;if(d){let R=((P=u.events)==null?void 0:P.length)||0;for(let N of d){let{ratingsParameters:A}=N,M=(C=u.events)==null?void 0:C.find((E,O)=>N.eventIndex!==void 0&&O===N.eventIndex||N.eventName&&E.eventName===N.eventName||N.eventId&&E.eventId===N.eventId);if(M){let{gender:E,category:O,eventType:k}=M,{drawProfiles:x,publish:F}=N,$=Yi(Qs)(k)&&St||Yi(uo)(k)&&ht||k;if(x){let{stageParticipantsCount:_,uniqueParticipantsCount:L,uniqueParticipantStages:B}=vY({drawProfiles:x,category:O,gender:E}),{uniqueDrawParticipants:V=[],uniqueParticipantIds:G=[]}=B?wY({event:{eventType:k,category:O,gender:E},uniqueParticipantsCount:L,participantsProfile:i,ratingsParameters:A,tournamentRecord:u,eventProfile:N,uuids:g}):{};v.push(...G);let{stageParticipants:j}=IY({targetParticipants:u.participants||[],allUniqueParticipantIds:v,stageParticipantsCount:_,eventParticipantType:$}),z=UY({uniqueDrawParticipants:V,autoEntryPositions:a,stageParticipants:j,tournamentRecord:u,drawProfiles:x,category:O,gender:E,event:M});if(z.error||(z=bY({matchUpStatusProfile:r,completeAllMatchUps:n,randomWinningSide:s,tournamentRecord:u,drawProfiles:x,isMock:f,event:M}),z.error))return z;I.push(...z.drawIds)}F&&Kg({tournamentRecord:u,event:M})}else{let E=SY({startDate:u.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:a,randomWinningSide:s,ratingsParameters:A,tournamentRecord:u,eventProfile:N,eventIndex:R,uuids:g});if(E.error)return E;let{eventId:O,drawIds:k,uniqueParticipantIds:x}=E;k&&I.push(...k),y.push(O),x!=null&&x.length&&v.push(...x),R+=1}}}if(h){let R=(u.events||[]).map(N=>{var A;return((A=N.drawDefinitions)==null?void 0:A.map(()=>1))||[]}).flat().reduce((N,A)=>N+A,0);for(let N of h){let A=_D({startDate:u.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:e,tournamentRecord:u,drawProfile:N,drawIndex:R,uuids:g});if(A.error)return A;let{drawId:M,eventId:E,event:O,uniqueParticipantIds:k}=A;if(A=qg({tournamentRecord:u,event:O,internalUse:!0}),A.error)return A;M&&I.push(M),y.push(E),k!=null&&k.length&&v.push(...k),R+=1}}let w=m!=null&&m.length?lx({tournamentRecord:u,venueProfiles:m}):[],U,T={};if(l!=null&&l.length){let R={[u.tournamentId]:u},N=zg({tournamentRecords:R,schedulingProfile:l});if(N.error)return N;if(c){let{tournamentId:A}=u,M={[A]:u};T=FD({tournamentRecords:M,periodLength:p})}}return{totalParticipantsCount:u.participants.length,scheduledRounds:U,schedulerResult:T,...J,eventIds:y,venueIds:w,drawIds:I}}var MY={};yt(MY,{addDynamicRatings:()=>kO,addIndividualParticipantIds:()=>ED,addParticipant:()=>nl,addParticipants:()=>es,addPenalty:()=>JY,addPersonRequests:()=>FY,addPersons:()=>ZY,createGroupParticipant:()=>jY,createTeamsFromParticipantAttributes:()=>rx,deleteParticipants:()=>oh,filterParticipants:()=>sb,findParticipant:()=>VY,getCompetitionParticipants:()=>YO,getPairedParticipant:()=>Qo,getParticipantEventDetails:()=>KO,getParticipantMembership:()=>XO,getParticipantScaleItem:()=>Vf,getParticipantSchedules:()=>JO,getParticipantSignInStatus:()=>ZO,getParticipantTimeItem:()=>CA,getParticipants:()=>Mi,getScaleValues:()=>Og,mergeParticipants:()=>XY,modifyIndividualParticipantIds:()=>LY,modifyParticipant:()=>MD,modifyParticipantName:()=>GY,modifyParticipantOtherName:()=>$Y,modifyParticipantsSignInStatus:()=>_Y,modifyPenalty:()=>YY,modifyPersonRequests:()=>kY,mutate:()=>NY,participantScaleItem:()=>Cl,query:()=>x6,regenerateParticipantNames:()=>BY,removeIndividualParticipantIds:()=>WA,removeParticipantIdsFromAllTeams:()=>LT,removePenalty:()=>WY,removePersonRequests:()=>xY,removeRatings:()=>zY,scaledTeamAssignment:()=>HY,setParticipantScaleItem:()=>Tb,setParticipantScaleItems:()=>M3,validateLineUp:()=>$T});var NY={};yt(NY,{addDynamicRatings:()=>kO,addIndividualParticipantIds:()=>ED,addParticipant:()=>nl,addParticipants:()=>es,addPenalty:()=>JY,addPersonRequests:()=>FY,addPersons:()=>ZY,createGroupParticipant:()=>jY,createTeamsFromParticipantAttributes:()=>rx,deleteParticipants:()=>oh,findParticipant:()=>VY,mergeParticipants:()=>XY,modifyIndividualParticipantIds:()=>LY,modifyParticipant:()=>MD,modifyParticipantName:()=>GY,modifyParticipantOtherName:()=>$Y,modifyParticipantsSignInStatus:()=>_Y,modifyPenalty:()=>YY,modifyPersonRequests:()=>kY,regenerateParticipantNames:()=>BY,removeIndividualParticipantIds:()=>WA,removeParticipantIdsFromAllTeams:()=>LT,removePenalty:()=>WY,removePersonRequests:()=>xY,removeRatings:()=>zY,scaledTeamAssignment:()=>HY,setParticipantScaleItem:()=>Tb,setParticipantScaleItems:()=>M3});function AY(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function OY({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:o,endTime:s}=n;return n.requestType===Fb&&(a=pt(a),o=bi(o),s=bi(s),a&&o&&s)?{date:a,startTime:o,endTime:s,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=AY(),t[e].push(n);return{mergeCount:r.length}}function ux(t){let{tournamentRecords:e,personRequests:i}=t,r=ze(t,[{[pn]:!0}]);if(r.error)return r;if(!i)return{...J};let n=Object.values(e);for(let a of n){let o=a.participants??[],s=[];for(let l of Object.keys(i))if(Uc({tournamentParticipants:o,personId:l})){let u=i[l];u.length&&s.push({personId:l,requests:u})}Object.keys(s).length&&Lt({element:a,extension:{value:s,name:kg}})}return{...J}}function kY(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=ze(t,[{[pn]:!0},{requests:!0,[Xn]:un,[_a]:oe}]);if(n.error)return n;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:o}=yp({tournamentRecords:e}),s=u=>{o&&(o[u]=o[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(r&&(o!=null&&o[r]))s(r);else if(o)for(let u of Object.keys(o))s(u);let l=i.filter(u=>!u.requestId);return l.length&&OY({personRequests:o,personId:r,requests:l}),ux({tournamentRecords:e,personRequests:o})}function xY(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,o=ze(t,[{[pn]:!0}]);if(o.error)return o;let{personRequests:s}=yp({tournamentRecords:e}),l=c=>{var d;s&&(s[c]=s[c].filter(p=>(!i||p.requestType!==i)&&(!r||p.requestId!==r)&&(!a||p.date!==a)),(d=s==null?void 0:s[c])!=null&&d.length||delete s[c])},u=!i&&!r&&!n&&!a;if(!u){if(n&&(s!=null&&s[n]))l(n);else if(s)for(let c of Object.keys(s))l(c)}return u||!s||!Object.keys(s).length?Un({name:kg,tournamentRecords:e,discover:!0}):ux({tournamentRecords:e,personRequests:s})}function FY(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=ze(t,[{[pn]:!0,[Gae]:!0},{requests:!0,[Xn]:un,[_a]:oe}]);if(n.error)return n;let{personRequests:a}=yp({tournamentRecords:e}),{mergeCount:o}=OY({personRequests:a,personId:i,requests:r});return o&&a?ux({tournamentRecords:e,personRequests:a}):{error:oe}}function LY({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return ee({result:{error:ge},stack:r});if(!e||!t)return ee({result:{error:Xe},stack:r});let n=i.participants||[],a=n.find(m=>m.participantId===e);if(!a)return ee({result:{error:zi},stack:r});if(![Kt,Wa].includes(a.participantType))return ee({result:{error:Ts},context:{participantType:a.participantType},stack:r});let o=t.filter(m=>{var h;return((h=n.find(f=>f.participantId===m))==null?void 0:h.participantType)!==St});if(o.length)return ee({result:{error:va,invalidParticipantIds:o},stack:r});let s=a.individualParticipantIds||[],l=t.filter(m=>!s.includes(m)),u=s.filter(m=>!t.includes(m)),c=ED({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return ee({result:c,stack:r});let d=WA({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return ee({result:d,stack:r});let{topics:p}=vo();if(p.includes(nn)){let m=n.find(({participantId:h})=>h===e);lt({topic:nn,payload:{tournamentId:i.tournamentId,participants:[m]}})}return{...c,...d}}function _Y({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:ge};if(!Array.isArray(e))return{error:Xe};if(![NI,dW].includes(i))return{error:oe,signInState:i};let r=t.participants||[];if(!r.length)return{error:Cy};let n=r.map(Ut),a=e.filter(u=>!n.includes(u));if(a.length)return{error:oe,context:{invalidParticipantIds:a}};let o=[],s=new Date().toISOString();for(let u of r){let{participantId:c}=u;if(e.includes(c)){let d=UO({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:Gy,itemValue:i,createdAt:s}});if(d.error)return d;o.push(u)}}let{topics:l}=vo();return o.length&&l.includes(nn)&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:o}}),{...J}}function $Y({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:ge};if(!e)return{error:pr};let{participant:r}=qc({tournamentRecord:t,participantId:e});if(!r)return{error:zi};r.participantOtherName=i;let{topics:n}=vo();return n.includes(nn)&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...J}}function fV({personFormat:t,person:e}){let i=f=>f.replace(/\W/g,""),r=f=>/^[a-z]*$/.test(i(f)),n=f=>/^[A-Z]*$/.test(i(f)),a=f=>/^[LAST]{4}/.test(i(f)),o=f=>f.toLowerCase().indexOf("l")<f.toLowerCase().indexOf("f"),s=f=>f.indexOf(",")>=0,l=f=>f.toLowerCase().indexOf("f.")>=0,u=f=>f.toLowerCase().indexOf("f")<0,c=f=>f.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=LE((e==null?void 0:e.standardGivenName)??""),m=LE((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${m}`;l(t)&&!s(t)&&!o(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),m=m.toLowerCase()):n(t)?(p=p.toUpperCase(),m=m.toUpperCase()):a(t)&&(m=m.toUpperCase());let h=`${p}${d}${m}`;return u(t)?h=m:o(t)&&(s(t)?h=`${m},${d}${p}`:h=`${m}${d}${p}`),h}function the({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,o=r&&i[r];if(r!==Vn&&o){let{personFormat:s,doublesJoiner:l}=o;r===St&&(e.participantName=fV({person:a,personFormat:s})),r===ht&&(e.participantName=n==null?void 0:n.map(u=>{var d;let c=(d=t[u])==null?void 0:d.person;return fV({person:c,personFormat:s})}).filter(Boolean).join(l??"/"))}}function BY({tournamentRecord:t,formats:e}){if(!t)return{error:ge};if(!Nt(e))return{error:Xe};let i=t.participants??[],r=dG(i,"participantId");for(let n of i)the({participant:n,participantMap:r,formats:e});return{...J}}function VY(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,o=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Xe,stack:"publicFindParticipant"};let s,l;for(let u of Object.values(o)){l=u.tournamentId;let c=u.participants||[];if(s=Uc({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),s)break}return{participant:s,tournamentId:l,...J}}function jY({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=QW,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:ge};if(!a)return{error:Xe,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:oe};let o=(Mi({participantFilters:{participantTypes:[St]},tournamentRecord:r}).participants??[]).map(c=>c.participantId);for(let c of t)if(!o.includes(c))return{error:Ts,participantId:c};let s=Ge({participantId:n||Gt(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:Wa,participantRole:i}),l=nl({participant:s,tournamentRecord:r});if(l.error)return l;let{topics:u}=vo();return u.includes(Tc)&&lt({topic:Tc,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...J,participant:Me(s)}}function GY({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:ge};if(!i)return{error:pr};if(!e)return{error:Xe,info:"Missing participantName"};let{participant:r}=qc({tournamentRecord:t,participantId:i});if(!r)return{error:zi};r.participantName=e;let{topics:n}=vo();return n.includes(nn)&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...J}}function HY({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:u,eventId:c,event:d}){var v,y,I,b,S;if(!o)return{error:ge};if(!Array.isArray(a)&&!ot(u)&&!c||!ot(r)||n&&!Array.isArray(n)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:oe};if(!s&&!n.length||!n&&!(e&&s))return{error:Xe,info:"Missing scaling details"};if(c&&!a){if((d==null?void 0:d.eventType)!==Sa)return{error:Ll};a=(v=d==null?void 0:d.entries)==null?void 0:v.filter(({entryStatus:w})=>w===oa).map(Ut)}if(!(a!=null&&a.length)&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Xe};let p=e??n.map(({participantId:w})=>w);i&&(a==null||a.reverse(),r+=1),r>((a==null?void 0:a.length)||0)-1&&(r=0);let m=(a==null?void 0:a.slice(r).concat(...a.slice(0,r)))??[],h=[];for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(m.includes(U)){if(T!==Vn)return{error:Ts,participant:w};h.push(w)}}if(u&&h.length<u){let w=u-((h==null?void 0:h.length)||0),U=l??"Team",T=Se(0,w).map(R=>({participantName:`${U} ${R+1}`,participantType:Vn,participantRole:Zr})),{participants:D=[]}=es({participants:T,returnParticipants:!0,tournamentRecord:o}),P=D.map(Ut),C=((y=o.participants)==null?void 0:y.filter(({participantId:R})=>P.includes(R)))??[];h.push(...C)}if(!h.length)return{error:PN};if(t)for(let w of h)w.individualParticipantIds=[];else{let w=h.map(U=>U).flat();e!=null&&e.length?p=p.filter(U=>!w.includes(U)):n=n==null?void 0:n.filter(({participantId:U})=>!w.includes(U))}if(!(e!=null&&e.length)&&!(n!=null&&n.length))return{error:Y0,info:"Nothing to be done"};if(!n.length){for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(!p.includes(U))continue;if(T!==St)return{error:Ts,participant:w};let D=(I=Cl({scaleAttributes:s,participant:w}))==null?void 0:I.scaleItem,P=s!=null&&s.accessor?(b=D==null?void 0:D.scaleValue)==null?void 0:b[s==null?void 0:s.accessor]:D==null?void 0:D.scaleValue,C={participantId:U,scaleValue:P};n.push(C)}if(!n.length)return{error:zi}}n.sort((w,U)=>s!=null&&s.sortOrder?((U==null?void 0:U.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((U==null?void 0:U.scaleValue)||1/0));for(let w of n)if(!w.participantId)return{error:oe,scaledParticipant:w};let f=0;for(;f<n.length;){for(let w of h){if(f+1>n.length)break;let U=n[f];w.individualParticipantIds.push(U.participantId),f++}h.reverse()}let g=h.map(Ut);for(let w of o.events??[]){if(w.eventType!==Sa)continue;let U=(w.entries??[]).filter(T=>g.includes(T.participantId));for(let T of U){let D=T.participantId,P=(S=h.find(R=>R.participantId===D))==null?void 0:S.individualParticipantIds;w.entries=(w.entries??[]).filter(R=>!P.includes(R.participantId)),(w.drawDefinitions??[]).forEach(R=>{R.entries=(R.entries??[]).filter(N=>!P.includes(N.participantId))});let{flightProfile:C}=Gi({event:w});((C==null?void 0:C.flights)||[]).forEach(R=>{R.drawEntries=(R.drawEntries||[]).filter(N=>!P.includes(N.participantId))})}}return{...J,scaledParticipants:n}}function zY(t){let e=ze(t,[{[br]:!0,[JN]:!0},{ratingType:!1,[Kr]:o=>Mr[o]}]);if(e.error)return e;let i=`${t.ratingType}.${tA}`,r=t.asDynamic?i:t.ratingType,n=[kd,fc,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let o of a)o.timeItems&&(o.timeItems=o.timeItems.filter(s=>s.itemType!==n));return{...J}}function WY(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Oi};for(let i of Object.values(e)){let r=ihe({...t,tournamentRecord:i});if(r.error&&r.error!==Tf)return r}return{...J}}function ihe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:ge};if(!e)return{error:wN};let i=(t==null?void 0:t.participants)??[],r=[],n=!1,a;return i.forEach(o=>{let s=!1;o.penalties=(o.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,n||(a=l,n=!0)),s&&r.push(o),l.penaltyId!==e))}),a&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...J,penalty:a}:{error:Tf}}var rhe=({penaltyId:t=Gt()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),qY=rhe;function YY(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Oi};for(let i of Object.values(e)){let r=nhe({...t,tournamentRecord:i});if(r.error&&r.error!==Tf||r.success)return r}return{error:Tf}}function nhe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:ge};if(!e)return{error:oe,modifications:e};if(!i)return{error:wN};let r=(t==null?void 0:t.participants)??[],n=Object.keys(qY()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:K0};let o,s=[];return r.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),o||(o=c)),c)),u&&s.push(l)}),o&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:s}}),o?{...J,penalty:o}:{error:Tf}}function KY(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:ct(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=ct(t[n].map(o=>JSON.stringify(o)).concat(e[n].map(o=>JSON.stringify(o)))).map(o=>JSON.parse(o));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=KY(t[n],e[n],i):r[n]=e[n];return r},{})}function XY({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:ge};e.participants||(e.participants=[]);let r=t.filter(Ta(Vl)).map(u=>({[u.participantId]:u})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(u=>{if(n[u.participantId]){let c=KY(u,n[u.participantId],i);return a.push(c),c}return u});let o=e.participants.map(Ta(Vl))||[],s=t.filter(({participantId:u})=>!o.includes(u)),{topics:l}=vo();return s.length&&(e.participants=e.participants.concat(...s),l.includes(Tc)&&lt({topic:Tc,payload:{participants:s}})),a.length&&l.includes(nn)&&lt({topic:nn,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...J}}function JY(t){var a;let{tournamentRecord:e,participantIds:i}=t,r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n;for(let o of Object.values(r)){let s=(a=Mi({tournamentRecord:o}).participants??[])==null?void 0:a.map(Ut).filter(l=>i.includes(l));s.length&&(n=ahe({...t,penaltyId:t.penaltyId??n,tournamentRecord:o,participantIds:s}).penaltyId)}return n?{...J,penaltyId:n}:{error:zi}}function ahe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:u}){if(!e)return{error:ge};if(!i)return{error:pr};if(!n)return{error:iH};let c=((e==null?void 0:e.participants)??[]).filter(m=>i.includes(m.participantId));if(!c.length)return{error:zi};let d=new Date().toISOString(),p=Object.assign(qY({penaltyId:o}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:s,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(m=>Lt({element:p,extension:m})),c.forEach(m=>{m.penalties||(m.penalties=[]),m.penalties.push(p)}),lt({topic:nn,payload:{tournamentId:e.tournamentId,participants:c}}),{...J,penaltyId:p.penaltyId}}function ZY({participantRole:t=Zr,tournamentRecord:e,persons:i}){var h;if(!e)return{error:ge};if(!Array.isArray(i))return{error:oe};if(!Object.keys(zA).includes(t))return{error:zG};let r=(e.participants||[]).map(({person:f})=>f==null?void 0:f.personId).filter(Boolean),n=[],a=i.filter(f=>f&&(!f.personId||!r.includes(f.personId))).map(f=>(f.personId||(f.personId=Gt()),n.push(f.personId),f)),o=(f,g)=>Object.assign({},...Object.keys(f).filter(v=>!g.includes(v)).map(v=>({[v]:f[v]}))),s=a.map(f=>Ge({extensions:f.participantExtensions,timeItems:f.participantTimeItems,participantType:St,participantRole:t,person:o(f,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,u=0,c=es({participants:s,tournamentRecord:e});if(c.error)return c;u=c.addedCount||0;let d=[],p=((h=Mi({participantFilters:{participantTypes:[St]},tournamentRecord:e}))==null?void 0:h.participants)??[];if(t===Zr&&i.filter(({pairedPersons:f})=>f).forEach(({personId:f,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[f,v.personId].map(I=>Uc({tournamentParticipants:p,personId:I})).filter(Boolean);if(y.length===2){let I=y.map(Ut);d.push(Ge({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:Zr,individualParticipantIds:I,participantType:ht}))}})}),d.length){if(c=es({participants:d,tournamentRecord:e}),c.error)return c;l=c.addedCount||0}let m=u+l;return{...J,addedCount:m,newPersonIds:n}}var QY={};yt(QY,{bulkUpdatePublishedEventIds:()=>ok,getAllEventData:()=>sk,getCourtInfo:()=>AT,getDrawData:()=>cD,getEventData:()=>dD,getEventPublishStatus:()=>Uo,getPublishState:()=>ah,getTournamentPublishStatus:()=>ob,getVenueData:()=>Lf,mutate:()=>e5,publishEvent:()=>Kg,publishEventSeeding:()=>t5,publishOrderOfPlay:()=>o5,publishParticipants:()=>a5,query:()=>V6,setEventDisplay:()=>TD,unPublishEvent:()=>s5,unPublishEventSeeding:()=>i5,unPublishOrderOfPlay:()=>n5,unPublishParticipants:()=>r5});var e5={};yt(e5,{publishEvent:()=>Kg,publishEventSeeding:()=>t5,publishOrderOfPlay:()=>o5,publishParticipants:()=>a5,setEventDisplay:()=>TD,unPublishEvent:()=>s5,unPublishEventSeeding:()=>i5,unPublishOrderOfPlay:()=>n5,unPublishParticipants:()=>r5});function t5({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=qa,drawIds:a=[],event:o}){var d,p,m,h;if(!r)return{error:ge};if(!o)return{error:gi};let s=Uo({event:o,status:n}),l=(((d=s==null?void 0:s.seeding)==null?void 0:d.seedingScaleNames)||i)&&{...(p=s==null?void 0:s.seeding)==null?void 0:p.seedingScaleNames,...i},u=(((m=s==null?void 0:s.seeding)==null?void 0:m.stageSeedingScaleNames)||e)&&{...(h=s==null?void 0:s.seeding)==null?void 0:h.stageSeedingScaleNames,...e},c=Ge({stageSeedingScaleNames:u,seedingScaleNames:l,published:!0,drawIds:a});return Yg({statusObject:{seeding:c},removePriorValues:t,status:n,event:o}),lt({topic:oW,payload:{tournamentId:r.tournamentId,eventId:o.eventId,drawIds:a}}),{...J}}function i5({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=qa,drawIds:n,stages:a,event:o}){var l,u;if(!i)return{error:ge};if(!o)return{error:gi};let s=Uo({event:o});if(s){let c=s.seeding;if(Array.isArray(a)&&c.stageSeedingScaleNames)for(let d of a)c.stageSeedingScaleNames[d]&&delete c.stageSeedingScaleNames[d];Array.isArray(e)&&(c!=null&&c.seedingScaleNames)&&(c.seedingScaleNames=c.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(n)&&(c!=null&&c.drawIds)&&(c.drawIds=c.drawIds.filter(d=>!n.includes(d))),(!Object.values(c.stageSeedingScaleNames??{}).length&&!((l=c.seedingScaleNames)!=null&&l.length)&&!((u=c.drawIds)!=null&&u.length)||!a&&!e&&!(n!=null&&n.length))&&(delete c.stageSeedingScaleNames,delete c.seedingScaleNames,delete c.drawIds,c.published=!1),Yg({statusObject:{seeding:c},removePriorValues:t,status:r,event:o})}return lt({topic:SA,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...J}}function r5(t){let e=Io(t);if(!Object.keys(e).length)return{error:Oi};for(let i of Object.values(e)){let r=ohe({tournamentRecord:i,...t});if(r.error)return r}return{...J}}function ohe({removePriorValues:t=!0,tournamentRecord:e,status:i=qa}){if(!e)return{error:ge};let r=`${Yc}.${Kc}`,{timeItem:n}=yo({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].participants,gl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),lt({payload:{tournamentId:e.tournamentId},topic:Ioe}),{...J}}function n5(t){let e=Io(t);if(!Object.keys(e).length)return{error:Oi};for(let i of Object.values(e)){let r=she({tournamentRecord:i,...t});if(r.error)return r}return{...J}}function she({removePriorValues:t=!0,tournamentRecord:e,status:i=qa}){if(!e)return{error:ge};let r=`${Yc}.${Kc}`,{timeItem:n}=yo({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,gl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),lt({topic:TA,payload:{tournamentId:e.tournamentId}}),{...J}}function a5(t){let e=Io(t);if(!Object.keys(e).length)return{error:Oi};for(let i of Object.values(e)){let r=lhe({tournamentRecord:i,...t});if(r.error)return r}return{...J}}function lhe({removePriorValues:t,tournamentRecord:e,status:i=qa}){if(!e)return{error:ge};let r=`${Yc}.${Kc}`,{timeItem:n}=yo({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i].participants={published:!0},gl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),lt({payload:{tournamentId:e.tournamentId},topic:lW}),{...J}}function o5(t){let e=Io(t);if(!Object.keys(e).length)return{error:Oi};for(let i of Object.values(e)){let r=uhe({tournamentRecord:i,...t});if(r.error)return r}return{...J}}function uhe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=qa,eventIds:n=[]}){if(!i)return{error:ge};let a=`${Yc}.${Kc}`,{timeItem:o}=yo({element:i,itemType:a}),s=(o==null?void 0:o.itemValue)||{[r]:{}};return s[r].orderOfPlay={published:!0,scheduledDates:t,eventIds:n},gl({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:e}),lt({topic:sW,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...J}}function s5({removePriorValues:t=!0,tournamentRecord:e,status:i=qa,event:r}){if(!e)return{error:ge};if(!r)return{error:gi};let n=`${Yc}.${Kc}`,{timeItem:a}=Hy({itemType:n,event:r}),o=(a==null?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,uh({event:r,timeItem:{itemValue:o,itemType:n},removePriorValues:t}),Yg({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),lt({topic:UA,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...J}}var l5={};yt(l5,{getEntryStatusReports:()=>dhe,getParticipantStats:()=>che,getStructureReports:()=>mhe,getVenuesReport:()=>fhe});function che({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:o,matchUps:s}){var U,T,D,P,C;if(!n)return{error:ge};if(s&&!Array.isArray(s))return{error:aa};if(s=s??Br({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(s!=null&&s.length))return{error:Bu};let l=[];e&&l.push(e),r&&l.push(r);let u=l.length?{participantIds:l}:{participantTypes:[Vn]},c=Mi({participantFilters:u,tournamentRecord:n}).participants??[];if(!c.every(({participantType:R})=>R===Vn))return{error:va};l.length||l.push(...c.map(Ut));let d=new Map,p=new Map,m=new Map,h=new Map,f=(R,N="")=>p.get(R)||p.set(R,{participantName:N,participantId:R,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(R);for(let R of c){let{participantId:N,individualParticipantIds:A}=R;h.set(N,A??[]),f(N,R.participantName)}if(r&&!h.get(r))return ee({result:{error:zi},context:{teamParticipantId:r}});if(e&&!h.get(e))return ee({result:{error:zi},context:{opponentParticipantId:e}});let g=[],v=R=>{let N=[[],[]];for(let M of R){let E=M.participant;if(E!=null&&E.participantName){d.set(E.participantId,{participantName:E.participantName,ratings:E.ratings});let O=p.get(E.participantId);O&&(O.participantName=E.participantName)}}let A=({side:M,individualParticipantIds:E})=>{var O,k,x,F,$;return M.participantId&&(!(E!=null&&E.length)||E.includes(M.participantId))&&[M.participantId]||((k=(O=M.participant)==null?void 0:O.individualParticipantIds)==null?void 0:k.length)&&(!(E!=null&&E.length)||Vi(E,(x=M.participant)==null?void 0:x.individualParticipantIds).length===(($=(F=M.participant)==null?void 0:F.individualParticipantIds)==null?void 0:$.length))&&M.participant.individualParticipantIds};if(h.size){let M=(E,O)=>{for(let k of R){if(!k.participant)continue;let x=A({individualParticipantIds:O,side:k});if(x!=null&&x.length){let F=k.sideNumber;if(!F)continue;let $=[E];i&&$.push(...x),N[F-1]=$;let _=p.get(E);for(let L of x.filter(Boolean))_&&!_.competitorIds.includes(L)&&_.competitorIds.push(L)}}};if(r)(!e||R.every(E=>E.participant&&(A({individualParticipantIds:h.get(r),side:E})||A({individualParticipantIds:h.get(e),side:E}))))&&M(r,h.get(r));else for(let[E,O]of h)M(E,O)}else if(i)for(let M of R){if(!M.participant)continue;let E=A({individualParticipantIds:[],side:M}),O=M.sideNumber;O&&(N[O-1]=E)}return N};for(let R of s){if(!Nt(R))return{error:aa};let{matchUpStatus:N,matchUpFormat:A,matchUpType:M,winningSide:E,score:O,sides:k}=R;if(!k||!O||M===ka||N===Vt)continue;let x=v(k);if(!x.filter(Boolean).length)continue;let F=t&&E&&((U=Qy({matchUp:R}))==null?void 0:U.competitiveness);g.push(R);let $=fO({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:E,score:O}),_=qq({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:E,score:O}),{pointsTally:L,tiebreaksTally:B}=Yq({matchUpFormat:A,score:O});x.forEach((V,G)=>{var j;for(let z of V){let q=(j=d.get(z))==null?void 0:j.participantName,W=f(z,q);if(W){let Y=(X,ie)=>ie.forEach((ae,le)=>W[X][le]+=ae),re=G?[...B].reverse():B,K=G?[...L].reverse():L,H=G?[..._].reverse():_,Q=G?[...$].reverse():$;if(Y("tiebreaks",re),Y("points",K),Y("games",H),Y("sets",Q),E){let X=E-1===G?0:1;W.matchUps[X]+=1}if(F){let X=F.toLowerCase();W.competitiveness[X]||(W.competitiveness[X]=[0,0]),W.competitiveness[X][G]+=1}if(N){let X=N.toLowerCase();W.matchUpStatuses[X]||(W.matchUpStatuses[X]=0),W.matchUpStatuses[X]+=1}}}})}let y=["tiebreaks","matchUps","points","games","sets"],I=["competitive","routine","decisive"],b=new Map,S=(R,N)=>(R??0)+(N??0);for(let[R,N]of p.entries()){for(let A of y){let M=N[A].reduce(S);if(M){let E=N[A][0]/M,O=`${A}Ratio`,k=parseFloat(E.toFixed(2));N[O]=k,m.set(R,!0),b.has(O)||b.set(O,[]),(T=b.get(O))==null||T.push(k)}}for(let A of I){let M=(P=(D=N.competitiveness)==null?void 0:D[A])==null?void 0:P.reduce(S);if(M){let E=N.competitiveness[A][0]/M,O=`${A}Ratio`,k=parseFloat(E.toFixed(2));N[O]=k}}}if(!r){let R=(N,A)=>A-N;for(let N of p.values())for(let A of y){let M=`${A}Ratio`;if(typeof N[M]=="number"){let E=(C=b.get(M))==null?void 0:C.sort(R).indexOf(N[M]);if(typeof E=="number"&&E>=0){let O=`${A}Rank`;N[O]=E+1}}}}let w={relevantMatchUps:g,...J};return r?(w.teamStats=p.get(r),e&&(w.opponentStats=p.get(e))):w.participatingTeamsCount=m.size,w.allParticipantStats=[...p.values()],w}function zS({participant:t,eventType:e}){var u,c,d,p,m,h;let i=(u=t==null?void 0:t.person)==null?void 0:u.personId,r=(d=(c=t==null?void 0:t.person)==null?void 0:c.personOtherIds)==null?void 0:d[0],n=(p=t==null?void 0:t.person)==null?void 0:p.tennisId,a=(h=(m=t==null?void 0:t.ratings)==null?void 0:m[e])==null?void 0:h.find(({scaleName:f})=>f===hO),o=a==null?void 0:a.scaleValue,{wtnRating:s,confidence:l}=o||{};return{timeStamp:a==null?void 0:a.scaleDate,personOtherId:r,confidence:l,wtnRating:s,personId:i,tennisId:n}}function dhe({tournamentRecord:t}){if(!t)return{error:ge};let e=t.tournamentId,{participantMap:i}=Mi({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(Br({matchUpFilters:{matchUpTypes:[zp,Ed]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:m,matchUpType:h})=>m==null?void 0:m.flatMap(f=>{var g,v;return h===Ed?(g=f==null?void 0:f.participant)==null?void 0:g.individualParticipantIds:((v=f==null?void 0:f.participant)==null?void 0:v.participantId)||f.participantId}).filter(Boolean)).filter(Boolean),n=[],a={},o={},s={},l=0,u=({id:m,entry:h,eventId:f,eventType:g})=>{var P;let{qualifyingSeeding:v,mainSeeding:y,entryStatus:I,entryStage:b,drawId:S}=h;a[m]||(a[m]=[]);let{participant:w,events:U}=(i==null?void 0:i[m])??{},T=zS({participant:w,eventType:g}),D=(P=U==null?void 0:U[f])==null?void 0:P.ranking;I===uO&&n.push(m),a[m].push({participantType:w==null?void 0:w.participantType,participantId:m,tournamentId:e,eventType:g,eventId:f,drawId:S,entryStatus:I,entryStage:b,...T,ranking:D,mainSeeding:y,qualifyingSeeding:v})};for(let m of t.events??[]){let h={},f=U=>{h[U]||(h[U]={count:0}),h[U].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=m,I=g.flatMap(U=>{let{drawId:T,entries:D}=U;l+=1;let P=({stage:A,stageSequence:M})=>A===Oe&&M===1||A===Ye,C=(U.structures??[]).filter(P).flatMap(({positionAssignments:A})=>A).filter(Boolean).map(({participantId:A})=>A),R=({participantId:A})=>C.includes(A),N=A=>{var x,F,$,_,L,B,V,G;let{participantId:M,entryStatus:E,entryStage:O}=A;f(E);let k=(_=($=(F=(x=i==null?void 0:i[M])==null?void 0:x.draws)==null?void 0:F[T])==null?void 0:$.seedAssignments)==null?void 0:_[Oe];return{qualifyingSeeding:(G=(V=(B=(L=i==null?void 0:i[M])==null?void 0:L.draws)==null?void 0:B[T])==null?void 0:V.seedAssignments)==null?void 0:G[Ye],participantId:M,mainSeeding:k,entryStatus:E,entryStage:O,drawId:T}};return D==null?void 0:D.filter(R).map(N)}),b=U=>{var P;let T=U.participantId,D=(P=i==null?void 0:i[T].participant.individualParticipantIds)==null?void 0:P.filter(C=>r.includes(C));return T&&{[T]:{individualParticipantIds:D}}};v===yu?(()=>{let U=Object.assign({},...I.map(b).filter(Boolean)),T=D=>{U[D.participantId].individualParticipantIds.forEach(P=>{u({id:P,eventType:v,eventId:y,entry:D})})};I.forEach(T)})():I.forEach(U=>{u({id:U==null?void 0:U.participantId,eventType:v,eventId:y,entry:U})});let S=Object.values(h).reduce((U,T)=>U+T.count,0);Object.keys(h).forEach(U=>{h[U].pct=h[U].count/S*100}),s[y]={tournamentId:e,eventId:y,entries:I,entryStatuses:h};let w=Object.assign({},...ss.flatMap(U=>{var T,D;return[{[U+"_count"]:(T=h[U])==null?void 0:T.count},{[U+"_pct"]:(D=h[U])==null?void 0:D.pct}]}));o[y]={tournamentId:e,eventId:y,...w}}let c=Object.values(i??{}).filter(({participant:{participantType:m,participantRole:h}})=>m===St&&h===Zr),d=c.filter(({participant:m})=>!r.includes(m.participantId)).map(({participant:m})=>m.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function phe({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=h=>{let f=h==null?void 0:h.matchUpFormat;f&&(n[f]||(n[f]=0),n[f]+=1)},o=e.filter(h=>i?h.eventId===i:h.drawId===r).reduce((h,f)=>(a(f),(f.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>h[g.participantId]=g),h),{}),s=Object.values(o),l=s.map(h=>zS({participant:h,eventType:t})).filter(({wtnRating:h})=>h),u=(s.length-l.length)/s.length*100,c=l.reduce((h,f)=>{let{wtnRating:g,confidence:v}=f;return h.totalWTN+=g,h.totalConfidence+=v,h},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?c.totalWTN/l.length:0,p=l!=null&&l.length?c.totalConfidence/l.length:0,m=Object.values(n).reduce((h,f)=>h+(f||0),0);return{matchUpFormatCounts:n,matchUpsCount:m,avgConfidence:p,pctNoRating:u,avgWTN:d}}function mhe(t){var h;let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:r}=t;if(!e)return{error:Uf};let n=[],a={},o={},s=[],l=Object.assign({},...(i??[]).map(({name:f,label:g,accessor:v})=>{var b,S,w;let y=(S=(b=gt({element:e,name:f}))==null?void 0:b.extension)==null?void 0:S.value,I=v?(w=Kp({element:y,accessor:v}))==null?void 0:w.value:y;return{[g||f]:I}})),u=e==null?void 0:e.tournamentId,c=Br({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],d=f=>{var g,v,y;return(y=(v=(g=yo({itemType:dA,itemSubTypes:[Pl],element:{timeItems:f}}))==null?void 0:g.timeItem)==null?void 0:v.itemValue)==null?void 0:y.scaleBasis},p=({positionManipulations:f})=>{f==null||f.forEach(g=>{let{structureId:v,name:y}=g,I=g.drawPositions||[g.drawPosition];a[v]||(a[v]=[]),a[v].push(`${y}: ${I.join("/")}`)})},m=(h=e==null?void 0:e.events)==null?void 0:h.flatMap(({timeItems:f,drawDefinitions:g=[],extensions:v,eventType:y,eventName:I,eventId:b,category:S})=>{var A,M,E,O;let w=(E=(M=(A=v==null?void 0:v.find(k=>k.name===Jo))==null?void 0:A.value)==null?void 0:M.flights)==null?void 0:E.map(k=>({[k.drawId]:k.flightNumber})),U=w&&Object.assign({},...w),T=v==null?void 0:v.find(k=>k.name===Dd),D=f==null?void 0:f.find(k=>k.itemType===Dd),P=((O=T==null?void 0:T.value)==null?void 0:O.length)||(D==null?void 0:D.itemValue)||0,C=Object.values(U??{}),R=U&&Math.min(...C),N=d(f);return o[b]={seedingBasis:N?JSON.stringify(N):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:P,tournamentId:u,eventId:b},g.filter(k=>!r||!w||U[k.drawId]===R).flatMap(k=>{let{matchUpFormat:x,tieFormat:F,timeItems:$,extensions:_,structures:L,drawName:B,drawType:V,drawId:G}=k,{matchUpFormatCounts:j,matchUpsCount:z,avgConfidence:q,pctNoRating:W,avgWTN:Y}=phe({eventType:y,matchUps:c,drawId:G}),re=d($)||N,K=hhe({extensions:_}),H=(K==null?void 0:K.length)||0;return p({positionManipulations:K}),o[b].totalPositionManipulations+=H,o[b].generatedDrawsCount+=1,H>o[b].maxPositionManipulations&&(o[b].maxPositionManipulations=H),L==null?void 0:L.filter(Q=>Q.stageSequence===1&&[Ye,Oe,rn,$i].includes(Q.stage)).map(Q=>{var Be,nt,Ii;let X=[Oe,$i].includes(Q.stage)?c.find(be=>be.structureId===Q.structureId&&be.finishingRound===1&&be.winningSide):void 0;Q.stage===Oe&&n.push({eventName:I,drawName:B,structureId:Q.structureId});let ie=(nt=(Be=X==null?void 0:X.sides)==null?void 0:Be.find(be=>be.sideNumber===X.winningSide))==null?void 0:nt.participant,ae=(ie==null?void 0:ie.participantType)===Vn&&ie.participantId,le=(ie==null?void 0:ie.participantType)===ht?ie.individualParticipants:[],ne=zS({participant:(le==null?void 0:le[0])||ie,eventType:y}),{personId:de,personOtherId:Ie,tennisId:ce,confidence:ke,wtnRating:Pe}=ne||{},it=zS({participant:le==null?void 0:le[1],eventType:y}),{personId:It,personOtherId:me,tennisId:fe,confidence:pe,wtnRating:Fe}=it||{},{ageCategoryCode:De,categoryName:je,subType:ue}=S??{},he=Q.matchUpFormat||x,Re=(j[he]||0)/z*100,{tieFormatName:xe,tieFormatDesc:Ce}=_S(F),{tieFormatName:we,tieFormatDesc:Ue}=_S(Q.tieFormat),wt=Ce===Ue,Le=!wt&&we,rt=Q.tieFormat&&!wt&&Ue,Ci=((Ii=K==null?void 0:K.filter(be=>be.structureId===Q.structureId))==null?void 0:Ii.length)||0;return{...l,tournamentId:u,eventId:b,structureId:Q.structureId,drawId:G,eventType:y,category:ue,categoryName:je,ageCategoryCode:De,flightNumber:U[G],drawType:V,stage:Q.stage,seedingBasis:re?JSON.stringify(re):void 0,winningPersonId:de,winningPersonOtherId:Ie,winningPersonTennisId:ce,winningPersonWTNrating:Pe,winningPersonWTNconfidence:ke,winningPerson2Id:It,winningPerson2OtherId:me,winningPerson2TennisId:fe,winningPerson2WTNrating:Fe,winningPerson2WTNconfidence:pe,winningTeamId:ae,positionManipulations:Ci,pctNoRating:W,matchUpFormat:he,pctInitialMatchUpFormat:Re,matchUpsCount:z,drawTieFormatName:xe,drawTieFormatDesc:Ce,tieFormatName:Le,tieFormatDesc:rt,avgConfidence:q,avgWTN:Y}})})});return n.forEach(({eventName:f,drawName:g,structureId:v})=>{var y;(y=a[v])!=null&&y.length&&s.push({eventName:f,drawName:g,actions:a[v]})}),{eventStructureReports:Object.values(o),structureReports:m,flightReports:s}}function hhe({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:r})=>r===ff))==null?void 0:e.value)==null?void 0:i.slice(1)}function fhe({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){var c,d;if(!Array.isArray(n))return{error:oe,dates:n};if(!Array.isArray(r))return{error:oe,venueIds:r};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:Oi};if(!n.every(Ia))return{error:Nr};let a=qu({tournamentRecords:e,ignoreDisabled:t,dates:n});if(a.error)return a;let o=(c=a==null?void 0:a.venues)==null?void 0:c.filter(({venueId:p})=>!(r!=null&&r.length)||r.includes(p)),s=(d=a.courts)==null?void 0:d.reduce((p,m)=>{var h;return(h=m.dateAvailability)==null||h.forEach(f=>{let g=f.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!n.length||n.includes(p)),l={venueIds:o==null?void 0:o.map(({venueId:p})=>p)},{matchUps:u}=Rs({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:o==null?void 0:o.map(p=>ghe(s,p,u))}}function ghe(t,e,i){let{venueId:r,courts:n,venueName:a}=e,o={};return t.forEach(s=>{var m;let l=0,u=0,c=0;for(let h of n){let f=h.dateAvailability.find(v=>v.date===s),g=(m=f&&Xg({courtDate:f}).timeSlots)==null?void 0:m.reduce((v,y)=>{let{startTime:I,endTime:b}=y,S=kt(b)-kt(I);return v+S},0);g&&(c+=1),l+=g}let d=i.filter(({schedule:h})=>h.venueId===r&&_l(s,h.scheduledDate));d.forEach(({schedule:h})=>{let f=bi(h.scheduledTime),g=ia(f,h.averageMinutes),v=kt(g)-kt(f);u+=v});let p=l?(u/l*100).toFixed(2):"100";o[s]={scheduledMatchUpsCount:d.length,availableCourts:c,availableMinutes:l,scheduledMinutes:u,percentUtilization:p}}),{venueId:r,venueName:a,venueReport:o}}var cx={};yt(cx,{addMatchUpCourtOrder:()=>Gk,addMatchUpEndTime:()=>zk,addMatchUpOfficial:()=>Y4,addMatchUpResumeTime:()=>qk,addMatchUpScheduleItems:()=>OD,addMatchUpScheduledDate:()=>ND,addMatchUpScheduledTime:()=>Jc,addMatchUpStartTime:()=>Hk,addMatchUpStopTime:()=>Wk,addSchedulingProfileRound:()=>ox,allocateTeamMatchUpCourts:()=>AD,assignMatchUpCourt:()=>mh,assignMatchUpVenue:()=>Zg,bulkRescheduleMatchUps:()=>g5,bulkScheduleMatchUps:()=>Lb,bulkScheduleTournamentMatchUps:()=>VI,bulkUpdateCourtAssignments:()=>p5,calculateScheduleTimes:()=>dx,clearMatchUpSchedule:()=>I5,clearScheduledMatchUps:()=>xD,courtGridRows:()=>gD,findMatchUpFormatTiming:()=>mD,findVenue:()=>Jl,generateBookings:()=>kD,generateVirtualCourts:()=>PD,getMatchUpsToSchedule:()=>pD,getPersonRequests:()=>yp,getProfileRounds:()=>fD,getScheduledRoundsDetails:()=>Pb,getSchedulingProfile:()=>Yu,getSchedulingProfileIssues:()=>lk,matchUpScheduleChange:()=>v5,modifyMatchUpFormatTiming:()=>Rk,mutate:()=>u5,proAutoSchedule:()=>d5,proConflicts:()=>h5,publicFindCourt:()=>_A,query:()=>W6,removeEventMatchUpFormatTiming:()=>SD,removeMatchUpCourtAssignment:()=>c5,reorderUpcomingMatchUps:()=>f5,scheduleMatchUps:()=>m5,scheduleProfileRounds:()=>FD,setMatchUpDailyLimits:()=>y5,setMatchUpHomeParticipantId:()=>jk,setSchedulingProfile:()=>zg,toggleParticipantCheckInState:()=>CD,validateSchedulingProfile:()=>hD});var u5={};yt(u5,{addMatchUpCourtOrder:()=>Gk,addMatchUpEndTime:()=>zk,addMatchUpOfficial:()=>Y4,addMatchUpResumeTime:()=>qk,addMatchUpScheduleItems:()=>OD,addMatchUpScheduledDate:()=>ND,addMatchUpScheduledTime:()=>Jc,addMatchUpStartTime:()=>Hk,addMatchUpStopTime:()=>Wk,addSchedulingProfileRound:()=>ox,allocateTeamMatchUpCourts:()=>AD,assignMatchUpCourt:()=>mh,assignMatchUpVenue:()=>Zg,bulkRescheduleMatchUps:()=>g5,bulkScheduleMatchUps:()=>Lb,bulkScheduleTournamentMatchUps:()=>VI,bulkUpdateCourtAssignments:()=>p5,calculateScheduleTimes:()=>dx,clearMatchUpSchedule:()=>I5,clearScheduledMatchUps:()=>xD,findMatchUpFormatTiming:()=>mD,generateBookings:()=>kD,generateVirtualCourts:()=>PD,matchUpScheduleChange:()=>v5,modifyMatchUpFormatTiming:()=>Rk,proAutoSchedule:()=>d5,proConflicts:()=>h5,removeEventMatchUpFormatTiming:()=>SD,removeMatchUpCourtAssignment:()=>c5,reorderUpcomingMatchUps:()=>f5,scheduleMatchUps:()=>m5,scheduleProfileRounds:()=>FD,setMatchUpDailyLimits:()=>y5,setMatchUpHomeParticipantId:()=>jk,setSchedulingProfile:()=>zg,toggleParticipantCheckInState:()=>CD,validateSchedulingProfile:()=>hD});function dx({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:Oi};o=o??RD({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=qu({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),m=d==null?void 0:d.filter(P=>!u||u.includes(P.venueId));l||(l=m==null?void 0:m.reduce((P,C)=>{var N,A;let R=((A=(N=C.dateAvailability)==null?void 0:N.find(M=>!M.date||_l(s,M.date)))==null?void 0:A.startTime)??C.startTime;return R&&(!P||kt(R)<kt(P))?R:P},void 0)),c||(c=m==null?void 0:m.reduce((P,C)=>{var N,A;let R=((A=(N=C.dateAvailability)==null?void 0:N.find(M=>!M.date||_l(s,M.date)))==null?void 0:A.endTime)??C.endTime;return R&&(!P||kt(R)>kt(P))?R:P},void 0));let h=Object.values(a),f=Object.assign({},...h.map(P=>(P.events??[]).map(C=>{let{scheduleTiming:R}=zy({tournamentRecord:P,event:C});return{[C.eventId]:{event:C,scheduleTiming:R}}})).flat()),g=Eb({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:u}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],I=[];I.push(...v),I.push(...y);let b={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},S=I==null?void 0:I.map(({eventId:P,schedule:C,matchUpFormat:R})=>{let{event:N,scheduleTiming:A}=f[P],M=N==null?void 0:N.eventType,E={...A,defaultTiming:b,matchUpFormat:R},{averageMinutes:O,recoveryMinutes:k}=NT({eventType:M,timingDetails:E}),{courtId:x,venueId:F}=C,$=bi(C.scheduledTime),_=ia($,O);return{recoveryMinutes:k,averageMinutes:O,periodLength:o,startTime:$,endTime:_,courtId:x,venueId:F}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:s,clearScheduleDates:n,periodLength:o,startTime:l,endTime:c,bookings:S,courts:m},{scheduleTimes:U}=Fk(w),T=(u==null?void 0:u.length)===1&&u[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,D=I.map(Tr);return{venueId:T,scheduleTimes:U,dateScheduledMatchUpIds:D}}function c5(t){var m;let e=ze(t,[{[pn]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:o,courtId:s,drawId:l}=t,u=r[n];if(!u)return{error:ge};let{drawDefinition:c,event:d}=Xc({tournamentRecord:u,drawId:l});if(!c)return{error:_e};let p=wi({drawDefinition:c,event:d,matchUpId:o});if(p.error)return p;if(((m=p==null?void 0:p.matchUp)==null?void 0:m.matchUpType)===ka){let{itemValue:h}=fp({timeItems:p.matchUp.timeItems??[],itemType:jl}),f=s&&h.filter(g=>g.courtId!==s);return Da({duplicateValues:!1,removePriorValues:i,tournamentRecord:u,drawDefinition:c,matchUpId:o,timeItem:{itemType:jl,itemValue:f}})}else return mh({tournamentRecord:u,drawDefinition:c,courtDayDate:a,courtId:"",matchUpId:o})}function d5({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:r}){if(!wo(r))return{error:oe};if(r.some(({hasContext:m})=>!m))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:q0};let n=Eb({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(n.error)return n;let{rows:a}=n,o=[],s=m=>[(m.sides||[]).map(h=>{var f;return[h.participantId,(f=h.participant)==null?void 0:f.individualParticipantIds]}),(m.potentialParticipants||[]).flat().map(h=>[h.participantId,h.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((m,h)=>{let f=[],g=[];Object.values(h).forEach(y=>{if(Nt(y)&&(y.matchUpId&&(f.push(y.matchUpId),o.push(y)),y.sides)){let I=s(y);g.push(...I)}});let v=Object.values(h).filter(y=>Nt(y)&&!y.matchUpId);return m.concat({matchUpIds:f,availableCourts:v,rowId:h.rowId,participantIds:g})},[]);r.filter(({matchUpStatus:m})=>m&&m!==Vt&&(t||!gr.includes(m))).sort(nh);let u=ls({matchUps:r.concat(o),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,c=[],d=[];for(;r.length&&l.length;){let m=l.shift(),h=[];for(;r.length&&m.availableCourts.length;){let f=r.concat(h).map(T=>T.matchUpId),g=r.shift(),v=g==null?void 0:g.matchUpId,y=v&&u[v].matchUpIds.concat(u[v].dependentMatchUpIds),I=v&&f.some(T=>u[v].matchUpIds.includes(T)),b=v&&d.some(T=>u[v].dependentMatchUpIds.includes(T)),S=m.matchUpIds.some(T=>y.includes(T)),w=s(g),U=m.participantIds.some(T=>w.includes(T));if(g&&!S&&!I&&!U&&!b){let T=m.availableCourts.shift();Object.assign(g.schedule,T.schedule),Object.assign(T,g),c.push(g),m.participantIds.push(...w),m.matchUpIds.push(v)}else g&&h.push(g)}r.push(...h),d.push(...m.matchUpIds)}let p=c.map(({matchUpId:m,tournamentId:h,schedule:f,drawId:g})=>({tournamentId:h,matchUpId:m,drawId:g,schedule:{...f,scheduledDate:i}}));return n=Lb({tournamentRecords:e,matchUpDetails:p}),{...n,scheduled:c,notScheduled:r}}function p5(t){let{courtDayDate:e}=t,i=ze(t,[{courtAssignments:!0,[Xn]:un,[_a]:Xe},{[pn]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,o)=>{let{tournamentId:s}=o;return a[s]||(a[s]=[]),a[s].push(o),a},{}),n;return Object.keys(r).every(a=>{let o=t[pn][a];if(!o)return n={error:ge},!1;let s=r[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(s).every(l=>{let{drawDefinition:u}=Wn({tournamentRecord:o,drawId:l});return u?(s[l].every(c=>{let{matchUpId:d,courtId:p}=c,m=mh({tournamentRecord:o,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(m.success)return m==null?void 0:m.success;n={error:pH}}),!0):(n={error:_e},!1)})}),n||J}function m5(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:m=30,scheduleDate:h,matchUpIds:f,venueIds:g,startTime:v,endTime:y,dryRun:I}=t,b=ze(t,[{[pn]:!0,[Ly]:!0},{[Kr]:Ia,[_a]:Nr,[Bae]:!0},{[Kr]:V=>!V||!isNaN(V),[Hae]:!1,[_a]:oe,[zae]:!1,[Wae]:!1}]);if(b.error)return b;let S=t.competitionMatchUps??Rs({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??ls({includeParticipantDependencies:!0,matchUps:S,tournamentRecords:e}).matchUpDependencies;S.forEach(V=>{var G;(G=V.schedule)!=null&&G.scheduledDate&&_l(h,pt(V.schedule.scheduledDate))&&Gf({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:V})});let U=f.map(V=>S.find(G=>G.matchUpId===V)).filter(Boolean),{venueId:T,scheduleTimes:D,dateScheduledMatchUpIds:P}=dx({tournamentRecords:e,remainingScheduleTimes:d,startTime:bi(v),endTime:bi(y),scheduleDate:pt(h),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:m,venueIds:g}),C={},R=[],N={},A={},M={};S.filter(({matchUpId:V})=>P==null?void 0:P.includes(V)).forEach(V=>{var j;o1({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:V,value:1});let G=(j=V.schedule)==null?void 0:j.scheduledTime;if(G){N[V.matchUpId]=G;let z=a==null?void 0:a[V.matchUpId];BI({recoveryMinutes:z||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:G,matchUp:V})}});let E=U.filter(V=>{let G=P==null?void 0:P.includes(V.matchUpId),j=[Vt,Mt,qi,$a,mn,zt].includes(V==null?void 0:V.matchUpStatus);return!G&&!V.winningSide&&!j}),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:x}=E.reduce((V,G)=>{let{drawId:j,tournamentId:z,matchUpType:q}=G,{participantIdsAtLimit:W,relevantParticipantIds:Y}=ix({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:u,matchUp:G});return W!=null&&W.length?(V.overLimitMatchUpIds.push(G.matchUpId),V.participantIdsAtLimit.push(...W),V):(Y.forEach(re=>{xb({individualParticipantProfiles:s,participantId:re});let K=s[re].counters;K[q]?K[q]+=1:K[q]=1,K[jo]?K[jo]+=1:K[jo]=1}),V.matchUpMap[z]||(V.matchUpMap[z]={}),V.matchUpMap[z][j]?V.matchUpMap[z][j].push(G):V.matchUpMap[z][j]=[G],Gf({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:G}),V)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});E=E.filter(({matchUpId:V})=>!k.includes(V));let F=0,$=(D==null?void 0:D.length)??0,{personRequests:_}=yp({tournamentRecords:e,requestType:Fb});for(;D!=null&&D.length&&E.length&&F<=$;){F++;let{scheduleTime:V}=D.shift(),G=E.find(j=>{let{matchUpId:z}=j,{dependenciesScheduled:q,remainingDependencies:W}=Qk({matchUpScheduleTimes:N,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:j});if(!q)return M[z]||(M[z]=[]),M[z].push({scheduleTime:V,remainingDependencies:W}),!1;let{enoughTime:Y}=tx({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:V,matchUp:j});if(!Y)return A[z]||(A[z]=[]),A[z].push({scheduleTime:V}),!1;let{conflicts:re}=ex({potentials:c,averageMatchUpMinutes:r,requestConflicts:C,personRequests:_,scheduleTime:V,scheduleDate:h,matchUp:j});if(re!=null&&re.length)return!1;let K=a==null?void 0:a[j.matchUpId];return BI({recoveryMinutes:K||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:V,matchUp:j}),N[j.matchUpId]=V,!0});E=E.filter(({matchUpId:j})=>j!==(G==null?void 0:G.matchUpId)),G||R.push(V)}E.forEach(V=>{o1({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:V})});let L=[];Object.keys(O).forEach(V=>{let G=e[V];G&&Object.keys(O[V]).forEach(j=>{let{drawDefinition:z}=Xc({tournamentRecord:G,drawId:j});z&&O[V][j].forEach(({matchUpId:q})=>{let W=N[q];if(W){let Y=W.split(":").map(no).join(":"),re=`${pt(h)}T${Y}`;I?L.push(q):(Jc({drawDefinition:z,matchUpId:q,scheduledTime:re}).success&&L.push(q),T&&Zg({tournamentRecords:e,tournamentRecord:G,drawDefinition:z,matchUpId:q,venueId:T}))}})})});let B=sA(E);return{...J,requestConflicts:Object.values(C),remainingScheduleTimes:D==null?void 0:D.map(({scheduleTime:V})=>V),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:x,skippedScheduleTimes:R,overLimitMatchUpIds:k,scheduledMatchUpIds:L,noTimeMatchUpIds:B,recoveryTimeDeferred:A,dependencyDeferred:M}}function h5({tournamentRecords:t,matchUps:e}){if(!wo(e))return{error:Bu};if(e.some(({matchUpId:m,hasContext:h})=>m&&!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:q0};let i=Math.max(...e.map(({schedule:m})=>(m==null?void 0:m.courtOrder)||1).map(m=>Ze(m))),r=Se(1,i+1).map(m=>e.filter(h=>{var f;return Ze((f=h.schedule)==null?void 0:f.courtOrder)===m})),n={},a={},o={};r.flat().filter(Boolean).sort(nh).forEach(({schedule:m})=>delete m[AU]);let s=ct(e.map(({drawId:m})=>m)),l=ls({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,u=r.map((m,h)=>m.reduce((f,g)=>{if(!g.matchUpId)return f;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:I,schedule:b,sides:S,potentialParticipants:w}=g,U=b==null?void 0:b.courtId;n[v]=h,a[U]=[],f.matchUpIds.push(v),o[v]=g;let T=l[v].matchUpIds;T.length&&f.sourceMatchUpIds.push(...T);let D=(S==null?void 0:S.map(C=>{var R;return[(R=C.participant)==null?void 0:R.individualParticipantIds,C.participantId]}).flat().filter(Boolean))??[],P=(w==null?void 0:w.flat().map(({individualParticipantIds:C,participantId:R})=>[C,R]).flat().filter(Boolean))||[];return f.participantIds.push(...P,...D),y&&f.targetMatchUpIds.push(y),I&&f.targetMatchUpIds.push(I),f},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),c=(m,h)=>l[m].sources.reduce((f,g,v)=>g.includes(h)&&v+1||f,0),d=u.map(()=>[]),p=(m,h,f,g)=>{if(!o[m].schedule[AU]){o[m].schedule[AU]=h,o[m].schedule[LW]=g,d[n[m]].push({matchUpId:m,issueType:f,issueIds:g,issue:h});let v=o[m].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:m,issue:h,issueType:f,issueIds:g})}};return u.forEach((m,h)=>{let f=h?u[h-1]:void 0,g=u.slice(h+1),v={},y=wa(m.participantIds),I=Object.keys(y).filter(w=>y[w]>1),b=m.matchUpIds.filter(w=>l[w].participantIds.some(U=>I.includes(U)));b.forEach(w=>{v[w]||(v[w]={}),v[w][cd]||(v[w][cd]=b.filter(U=>U!==w))});let S=f&&m.participantIds.filter(w=>f.participantIds.includes(w));S&&S.forEach(w=>{let U=m.matchUpIds.concat(f.matchUpIds).filter(T=>l[T].participantIds.includes(w));U.forEach(T=>{v[T]||(v[T]={}),v[T][dd]||(v[T][dd]=U.filter(D=>D!==T))})}),m.matchUpIds.forEach(w=>{var D,P,C,R;let U=l[w].matchUpIds;for(let N of g){let A=N.matchUpIds.filter(M=>U.includes(M));A!=null&&A.length&&(A.forEach(M=>p(M,OE,oc,[w])),p(w,OE,oc,A))}if((D=v[w])!=null&&D[cd]&&p(w,cd,AE,v[w][cd]),m.sourceMatchUpIds.includes(w)){let N=m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w));p(w,cd,oc,N),m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w)).forEach(A=>p(A,cd,oc,[w]))}let T=(P=f==null?void 0:f.matchUpIds)==null?void 0:P.filter(N=>c(w,N)>1);if(T!=null&&T.length&&(p(w,kE,oc,T),T.forEach(N=>p(N,kE,oc,[w]))),(C=v[w])!=null&&C[dd]&&p(w,dd,AE,v[w][dd]),(R=f==null?void 0:f.targetMatchUpIds)==null?void 0:R.includes(w)){let N=o[w].schedule.courtId,A=U.filter(M=>f.matchUpIds.includes(M));A.some(M=>o[M].schedule.courtId===N)||(A.forEach(M=>p(M,dd,oc,[w])),p(w,dd,oc,A))}})}),{courtIssues:a,rowIssues:d}}function f5(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return ee({result:{error:Oi},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return ee({result:{error:Xe},stack:e});let a=r==null?void 0:r.length;if(!a)return{...J};let o=0;return r.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,m=u+(n?-1:1);m<0&&(m=a-1),m===a&&(m=0);let h=r[m].schedule.scheduledTime,f=s({tournamentId:c,scheduledTime:h,matchUpId:p,drawId:d});if(f.success)o++;else return f}),o===a?J:ee({result:{error:dH},stack:e});function s({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:m}=Xc({tournamentRecord:p,drawId:d});return m?Jc({drawDefinition:m,scheduledTime:u,matchUpId:c}):{error:xa}}}function g5(t){var l,u;let{scheduleChange:e,matchUpIds:i,dryRun:r}=t;if(!i||!Array.isArray(i))return{error:$m};if(typeof e!="object")return{error:oe};let n=Io(t),a=[],o=[];for(let c of Object.values(n)){let d=vhe({tournamentRecord:c,scheduleChange:e,matchUpIds:i,dryRun:r});if(d.error)return d;Array.isArray(d.notRescheduled)&&o.push(...d.notRescheduled);let p=sA(d.notRescheduled),m=[];(l=d.rescheduled)==null||l.forEach(h=>{let{matchUpId:f}=h;p.includes(f)&&m.push(f),a.push(h)}),m.length&&(o=((u=d==null?void 0:d.notRescheduled)==null?void 0:u.filter(({matchUpId:h})=>!m.includes(h)))||[])}let s=!!(a.length&&!o.length);return{...J,rescheduled:a,notRescheduled:o,allRescheduled:s}}function vhe({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){var b;if(!t)return{error:ge};if(!i||!Array.isArray(i))return{error:$m};if(typeof e!="object")return{error:oe};let n=[],a=[],{minutesChange:o,daysChange:s}=e;if(!o&&!s)return{...J};if(o&&isNaN(o))return{error:oe};if(s&&isNaN(s))return{error:oe};let{matchUps:l}=Br({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:S})=>!gr.includes(S),c=l==null?void 0:l.filter(S=>Cb({schedule:S.schedule})).filter(S=>u({matchUpStatus:S.matchUpStatus}));if(!(c!=null&&c.length))return{...J};let{tournamentInfo:d}=dh({tournamentRecord:t}),{startDate:p,endDate:m}=d,h=c==null?void 0:c.reduce((S,w)=>{let{matchUpId:U,drawId:T}=w;return S[T]?S[T].push(U):S[T]=[U],S},{}),f=1440;for(let S of Object.keys(h)){let w=Xc({tournamentRecord:t,drawId:S});if(w.error)return w;let U=w.drawDefinition,T=h[S].filter(D=>i.includes(D));for(let D of T)if(D&&U){let P=(b=c.find(E=>E.matchUpId===D))==null?void 0:b.schedule,{scheduledTime:C,scheduledDate:R}=P,N,A,M;if(!N&&s&&R){let E=pt(R);M=Bv(E,s),N=new Date(M)<new Date(p)||new Date(M)>new Date(m)}if(o&&C){let E=pt(C),O=kt(bi(C))+o;if(N=O<0||O>f,!N){let k=ia(C,o),x=E&&M||R===E&&E;A=x?`${x}T${k}`:k}}if(N)a.push(D);else{if(!r){if(A){let E=Jc({scheduledTime:A,drawDefinition:U,matchUpId:D});if(E.error)return E}if(M){let E=ND({scheduledDate:M,drawDefinition:U,matchUpId:D});if(E.error)return E}}(A||M)&&n.push(D)}}}let g=Br({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],v=g.filter(({matchUpId:S})=>n.includes(S)),y=g.filter(({matchUpId:S})=>a.includes(S)),I=v.length&&!y.length;return{...J,rescheduled:v,notRescheduled:y,allRescheduled:I}}function v5(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Oi};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=r||{},{drawId:d,matchUpId:p,tournamentId:m}=n||{};if(!u&&!p)return ee({result:{error:Xe},stack:e});let{matchUps:h}=Rs({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),f=h==null?void 0:h.find(({matchUpId:b})=>b===u),g=h==null?void 0:h.find(({matchUpId:b})=>b===p),v=0;if(o&&u&&!p){let b=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b!=null&&b.success&&v++,b.error)return ee({result:b,stack:e})}else if(a&&o&&u&&p){let b=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b.success&&v++,b.error)return ee({result:b,stack:e,info:"source"});let S=y({tournamentId:m,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:s});if(S.success&&v++,S.error)return ee({result:S,stack:e,info:"target"})}else return{error:Xe};return v?J:ee({result:{error:Eg},stack:e});function y(b){let{tournamentRecords:S,tournamentId:w,matchUp:U,drawId:T}=b,D=S[w],{drawDefinition:P}=Xc({tournamentRecord:D,drawId:T});return U.matchUpType===hi?I({...b,tournamentRecord:D,drawDefinition:P}):mh({...b,tournamentRecord:D,drawDefinition:P})}function I({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,sourceCourtId:T,courtDayDate:D,matchUpId:P,matchUp:C,courtId:R}){let N=[R].concat(C.schedule.allocatedCourts.map(({courtId:A})=>A).filter(A=>A!==T));return AD({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,courtDayDate:D,matchUpId:P,courtIds:N})}}function I5({scheduleAttributes:t=[jl,Rc,Zm,Qm,eh,hs,Pu,Rl,hu],tournamentRecord:e,drawDefinition:i,matchUpId:r}){var s,l;let n="clearMatchUpSchedule",a=i?(s=Sn({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:s[0]:(l=Br({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:l[0];if(!a)return{error:dn};let o=(a.timeItems??[]).filter(u=>(u==null?void 0:u.itemType)&&!t.includes(u==null?void 0:u.itemType));return a.timeItems=o,Rt({tournamentId:e.tournamentId,context:n,drawDefinition:i,matchUp:a}),{...J}}function y5(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:Oi};if(typeof r!="object")return{error:Vu};let a=Object.keys(n).filter(o=>!i||i===o);if(i&&!a.includes(i))return{error:oe};for(let o of a){let s=n[o],l=Lt({extension:{name:By,value:{dailyLimits:r}},element:s});if(l.error)return l}return{...J}}var b5={};yt(b5,{addCollectionDefinition:()=>hx,addCollectionGroup:()=>P5,aggregateTieFormats:()=>C5,compareTieFormats:()=>Ru,getTieFormat:()=>ak,modifyCollectionDefinition:()=>px,modifyTieFormat:()=>R5,mutate:()=>w5,orderCollectionDefinitions:()=>T5,query:()=>$6,removeCollectionDefinition:()=>mx,removeCollectionGroup:()=>S5,tieFormatGenderValidityCheck:()=>rT,validateCollectionDefinition:()=>Oy});var w5={};yt(w5,{addCollectionDefinition:()=>hx,addCollectionGroup:()=>P5,aggregateTieFormats:()=>C5,modifyCollectionDefinition:()=>px,modifyTieFormat:()=>R5,orderCollectionDefinitions:()=>T5,removeCollectionDefinition:()=>mx,removeCollectionGroup:()=>S5});function Gd({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:o}){var u;let s="getTieFormat",l;if(e=(r==null?void 0:r.structureId)??e,i=(n==null?void 0:n.matchUpId)??i,(i||e)&&!t)return{error:_e};if(a&&o)l=Ls(o);else if(i){if(t&&(!n||!r)){let c=wi({drawDefinition:t,matchUpId:i});if(c.error)return c;if(((u=c.matchUp)==null?void 0:u.matchUpType)!==ka)return ee({result:{error:aa},stack:s});r||(r=c.structure),n||(n=c.matchUp)}l=Wv({item:n,drawDefinition:t,structure:r,event:o})||Wv({item:r,drawDefinition:t,structure:r,event:o})||Ls(t)||Ls(o)}else if(t&&e){if(!r){let c=et({drawDefinition:t,structureId:e});if(c.error)return c;r=c==null?void 0:c.structure}l=Wv({item:r,drawDefinition:t,structure:r,event:o})||Ls(t)||Ls(o)}else l=Ls(t)||Ls(o);return l?{...J,structure:r,tieFormat:l,matchUp:n}:ee({result:{error:Pg},stack:s})}function WS({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![gr].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==os&&!vr(t))}function bC({from:t,to:e}){let i=Object.keys(t),r=Vi(i,Object.keys(e)).length===i.length,n=i.filter(o=>t[o]!==e[o]).map(o=>({countChange:e[o]-t[o],collectionId:o})),a=i.every(o=>t[o]===e[o]);return{equivalent:r&&a,matchUpsCountChanges:n}}function Ihe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:o,event:s,uuids:l}){var w,U,T,D;let u="updateTieFormat",c=e==null?void 0:e.tournamentId,d=0,p=0,m=0,h=0,f=n==null?void 0:n.collectionDefinitions.reduce((P,C)=>(P[C.collectionId]=(P[C.collectionId]||0)+C.matchUpCount,P),{}),g=({tieFormat:P})=>{let C=P==null?void 0:P.collectionDefinitions.reduce((R,N)=>(R[N.collectionId]=(R[N.collectionId]||0)+N.matchUpCount,R),{});return bC({from:C,to:f}).equivalent},v=(w=Gd({drawDefinition:i}))==null?void 0:w.tieFormat,y=(U=Gd({event:s}))==null?void 0:U.tieFormat;if(s&&a){for(let P of s.drawDefinitions??[])I({drawDefinition:P});s.tieFormat=qr(n),h+=1}else if(o){if(!o.tieMatchUps)return ee({result:{error:aa},stack:u});let P=wa((T=o.tieMatchUps)==null?void 0:T.map(({collectionId:M})=>M)),C=bC({to:f,from:P}),{changes:R,changesArePossible:N,cannotChangeReaon:A}=gV({matchUp:o,check:C});if(C.equivalent)if(WS({matchUp:o,updateInProgressMatchUps:t}))o.tieFormat=qr(n),h+=1;else return ee({result:{error:IN},info:"matchUp is IN_PROGRESS or COMPLETE",stack:u});else if(N)S({tieFormat:n,matchUp:o,changes:R,uuids:l});else return ee({context:{collectionMap:f,matchUpMap:P},result:{error:Dl},info:A||"specified changes not possible",stack:u});p+=1,Rt({eventId:s==null?void 0:s.eventId,context:u,drawDefinition:i,tournamentId:c,matchUp:o})}else if(r){let P=(D=b({inheritedTieFormat:v??y,structure:r}))==null?void 0:D.modifiedMatchUpsCount;P&&(p+=P,d+=1,h+=1);let C=!r.tieFormat||Ru({ancestor:r.tieFormat,descendant:n}).different;C&&(r.tieFormat=qr(n),d+=1,h+=1),(P||C)&&i&&si({structureIds:[r.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)I({drawDefinition:i}),i.tieFormat=qr(n),h+=1;else return{error:_e};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:m,modifiedCount:h,...J,tieFormat:n};function I({drawDefinition:P}){var N;let C=P.structures||[],R=[];for(let A of C){if(A.tieFormat)continue;let M=(N=b({inheritedTieFormat:y,structure:A}))==null?void 0:N.modifiedMatchUpsCount;if(M){d+=1,p+=M;let E=A.structureId;R.push(E)}}return si({structureIds:R,eventId:s==null?void 0:s.eventId,drawDefinition:P}),R.length}function b({inheritedTieFormat:P,structure:C}){var A,M;let R=0,N=((A=Wt({matchUpFilters:{matchUpTypes:[hi]},structure:C}))==null?void 0:A.matchUps)||[];for(let E of N){let O=WS({matchUp:E,updateInProgressMatchUps:t}),k=!1,x=wa((M=E.tieMatchUps)==null?void 0:M.map(({collectionId:$})=>$)),F=bC({from:x,to:f});if(F.equivalent)E.tieFormat&&g(E)&&O&&(E.tieFormat=qr(n),k=!0);else{let{changes:$,changesArePossible:_}=gV({matchUp:E,check:F});if(_&&!E.tieFormat)S({changes:$,matchUp:E,tieFormat:n,uuids:l});else if(P)(!E.tieFormat||Ru({ancestor:P,descendant:E.tieFormat}).different)&&(E.tieFormat=P,k=!0);else return ee({result:{error:Pg},stack:u})}k&&(R+=1,Rt({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:u,eventId:a,matchUp:E}))}return{modifiedMatchUpsCount:R}}function S({uuids:P,matchUp:C,tieFormat:R,changes:N}){C.tieFormat=qr(R);let A=[],M=[];return N.forEach(E=>{if(E.countChange>0){let O=Math.max(0,...C.tieMatchUps.filter(F=>F.collectionId===E.collectionId).map(Ta("collectionPosition"))),k=R.collectionDefinitions.find(F=>F.collectionId===E.collectionId),x=gb({matchUpsLimit:E.countChange,collectionPositionOffset:O,collectionDefinition:k,matchUp:C,uuids:P});M.push(...Me(x,!1,!0)),m+=M.length,C.tieMatchUps.push(...x)}else{let O=E.toBePlayedTieMatchUpIds.slice(0,Math.abs(E.countChange));console.log("remove",O.length),A.push(...O),C.tieMatchUps=C.tieMatchUps.filter(({matchUpId:k})=>!O.includes(k))}}),M.length&&Dc({matchUps:M,drawDefinition:i,tournamentId:c,eventId:a}),A.length&&Gu({matchUpIds:A,action:"updateTieFormat",drawDefinition:i,tournamentId:c,eventId:a}),{matchUpIdsRemoved:A,matchUpsAdded:M}}}function gV({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let o=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===Ji).map(Ta("matchUpId")),s=o.length+a>=0||a>0;return!s&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:o,collectionId:n,countChange:a}),s}),changes:r,cannotChangeReaon:i}}function BD({appliedPolicies:t,drawDefinition:e,auditData:i}){var a;if(!((a=t==null?void 0:t.audit)!=null&&a[Hv]))return;let{extension:r}=gt({name:Hv,element:e}),n={value:Array.isArray(r==null?void 0:r.value)?r==null?void 0:r.value.concat(i):[i],name:Hv};Lt({element:e,extension:n})}function px({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:m,gender:h,event:f,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b}){let S="modifyCollectionDefinition";if(o&&!Ua({matchUpFormat:o}))return ee({result:{error:oe},context:{matchUpFormat:o},stack:S});if(r&&typeof r!="string")return ee({result:{error:oe},context:{collectionName:r},stack:S});if(h&&!Object.values(iT).includes(h))return ee({result:{error:oe},context:{gender:h},stack:S});if(p&&typeof p!="object")return ee({result:{error:oe},context:{category:p},stack:S});let w={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b};if(!Object.values(w).filter(Boolean).length&&!i&&!r&&!o&&!s&&!u)return ee({result:{error:Xe},stack:S});if(Object.values(w).filter(Boolean).length>1)return ee({info:"Only one value assignment allowed per collectionDefinition",result:{error:oe},stack:S});let U=Gd({drawDefinition:a,structureId:c,matchUpId:d,eventId:m,event:f});if(U.error)return ee({result:U,stack:S});let{matchUp:T,structure:D,tieFormat:P}=U,C=qr(P),R=P==null?void 0:P.collectionDefinitions.find(L=>L.collectionId===l),N=C==null?void 0:C.collectionDefinitions.find(L=>L.collectionId===l);if(!R)return ee({info:"source collectionDefinition",result:{error:_r},context:{collectionId:l},stack:S});let A=v??y??I??b;if(g!=null&&g.length){let L=mG({matchUpCount:s??(R==null?void 0:R.matchUpCount)??0,collectionValueProfiles:g});if(L.errors)return ee({result:{error:oe},info:L.errors,stack:S})}else if(A&&!ot(A))return ee({result:{error:oe},info:"value is not an integer",context:{value:A},stack:S});let M=(L,B)=>Vi(Object.keys(L),Object.keys(B)).length===Object.keys(L).length&&Vi(Object.values(L),Object.values(B)).length===Object.values(L).length,E=g&&(!R.collectionValueProfiles||!M(R.collectionValueProfiles,g)),O=ot(v)&&R.collectionValue!==v||ot(y)&&R.matchUpValue!==y||ot(I)&&R.scoreValue!==I||ot(b)&&R.setValue!==b||E,k=[];if(O&&(N.collectionValueProfiles=void 0,N.collectionValue=void 0,N.matchUpValue=void 0,N.scoreValue=void 0,N.setValue=void 0,Object.assign(N,w),k.push({collectionId:l,...Ge(w)})),(ot(I)||ot(b))&&N.collectionGroupNumber){let L=N.collectionGroupNumber;C.collectionDefinitions=C.collectionDefinitions.map(B=>{let{collectionGroupNumber:V,...G}=B;return V===L?G:B}),C.collectionGroups=C.collectionGroups.filter(({groupNumber:B})=>B!==L),k.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:x,valueGoal:F}=ph(C),$=Ge({aggregateValue:x,valueGoal:F});if(($.aggregateValue!==(P==null?void 0:P.winCriteria.aggregateValue)||$.valueGoal!==(P==null?void 0:P.winCriteria.valueGoal))&&(C.winCriteria=$,k.push({collectionId:l,winCriteria:$})),ot(i)&&R.collectionOrder!==i&&(N.collectionOrder=i,k.push({collectionId:l,collectionOrder:i})),r&&R.collectionName!==r&&(N.collectionName=r,k.push({collectionId:l,collectionName:r})),o&&R.matchUpFormat!==o&&(N.matchUpFormat=o,k.push({collectionId:l,matchUpFormat:o})),ot(s)&&R.matchUpCount!==s&&(N.matchUpCount=s,k.push({collectionId:l,matchUpCount:s})),u&&R.matchUpType!==u)return ee({result:{error:X0},context:{matchUpType:u},stack:S});p&&R.category!==p&&(N.category=p,k.push({collectionId:l,category:p})),h&&R.gender!==h&&(N.gender=h,k.push({collectionId:l,gender:h}));let _=Ge(C);if(U=Hn({tieFormat:_}),U.error)return ee({result:U,stack:S});if(!k.length)return ee({result:{...J,modifications:k}});if((P==null?void 0:P.tieFormatName)!==n?(_.tieFormatName=n,k.push({tieFormatName:n})):k.length&&(delete _.tieFormatName,k.push("tieFormatName removed: modifications without new tieFormatName")),U=Ihe({tieFormat:_,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:D,eventId:m,matchUp:T,event:f}),!U.error){let{appliedPolicies:L}=$t({tournamentRecord:e}),B=Ge({collectionDefinition:N,drawId:a==null?void 0:a.drawId,action:S,structureId:c,matchUpId:d,eventId:m});BD({appliedPolicies:L,drawDefinition:a,auditData:B})}return ee({result:{...U,modifications:k},stack:S})}function yhe({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){var s,l;let o=[];return n&&a?o=[a]:i&&r?o=((s=Wt({matchUpFilters:{matchUpTypes:[hi]},structure:r}))==null?void 0:s.matchUps)??[]:e&&(o=((l=Sn({matchUpFilters:{matchUpTypes:[hi]},drawDefinition:e}))==null?void 0:l.matchUps)??[]),{targetMatchUps:o.filter(u=>!u.winningSide&&u.matchUpStatus!==qi&&(t||u.matchUpStatus!==os&&!vr(u)))}}function bhe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let o of r){let s=!!o.tieFormat;s&&(o.tieFormat=qr(n));let l;if(t){let u=$t({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=Wu({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}s&&!l&&Rt({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:o,drawDefinition:i})}return{...J}}function U5({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:m,valueGoal:h}=ph(l);l.winCriteria=Ge({aggregateValue:m,valueGoal:h}),(e&&e!==h||m&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:f}=yhe({updateInProgressMatchUps:t,drawDefinition:a,structureId:o,structure:s,matchUpId:u,matchUp:c});bhe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:f,drawDefinition:a,tieFormat:l,event:p});let g=Ge(l),v=Hn({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:_e};return si({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...J}}function S5({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:u}){if(!e)return{error:Xe};if(isNaN(e))return{error:oe};let c="removeCollectionGroup",d=s?void 0:Gd({drawDefinition:r,structureId:a,matchUpId:o,eventId:l,event:u});if(d!=null&&d.error)return ee({result:d,stack:c});let p=d==null?void 0:d.structure;s=s??(d==null?void 0:d.matchUp);let m=d==null?void 0:d.tieFormat,h=m==null?void 0:m.winCriteria.valueGoal,f=m==null?void 0:m.winCriteria.aggregateValue,g=qr(m);if(d=Hn({tieFormat:g}),d.error)return ee({result:d,stack:c});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(y=>{let{collectionGroupNumber:I,...b}=y;return I!==e?y:(v.push(y.collectionId),b)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:y})=>y!==e),d=U5({updateInProgressMatchUps:t,originalValueGoal:h,wasAggregateValue:f,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:o,matchUp:s,eventId:l,event:u}),!d.error){let{appliedPolicies:y}=$t({tournamentRecord:i}),I=Ge({drawId:r==null?void 0:r.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:o,eventId:l});BD({appliedPolicies:y,drawDefinition:r,auditData:I})}return ee({result:{...d,modifiedCollectionIds:v},stack:c})}function zf({tieFormat:t,orderMap:e}){var r;let i=qr(t);return i.collectionDefinitions.forEach(n=>{let a=e[n.collectionId];a&&(n.collectionOrder=a)}),(r=i.collectionDefinitions)==null||r.sort((n,a)=>wf(n.collectionOrder)-wf(a.collectionOrder)),i}function T5({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:o,event:s}){if(typeof n!="object"||!Object.values(n).every(l=>ot(l)))return ee({result:{error:oe},context:{orderMap:n}});if(a&&(s!=null&&s.tieFormat))vV({tournamentRecord:t,event:s,orderMap:n});else if(r){let l=e&&wi({drawDefinition:e,matchUpId:r});if(l!=null&&l.error)return l;if(o=l.matchUp,!o)return{error:na};o!=null&&o.tieFormat&&(o.tieFormat=zf({tieFormat:o.tieFormat,orderMap:n}),Rt({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:o}))}else if(i){let l=et({drawDefinition:e,structureId:i});if(l.error)return l;let u=l.structure;if(u!=null&&u.tieFormat)u.tieFormat=zf({tieFormat:u.tieFormat,orderMap:n}),D5({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:n}),si({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)s1({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else if(s!=null&&s.tieFormat)vV({structureIds:[i],tournamentRecord:t,orderMap:n,event:s});else return{error:_r}}else if(e!=null&&e.tieFormat)s1({tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else return{error:_r};return{...J}}function vV({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=zf({tieFormat:r.tieFormat,orderMap:i});e!=null&&e.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])s1({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function s1({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??(n==null?void 0:n.tieFormat),o=zf({tieFormat:a,orderMap:r});i!=null&&i.length||(e.tieFormat=o);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=zf({tieFormat:l.tieFormat??e.tieFormat??(n==null?void 0:n.tieFormat),orderMap:r})),D5({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),s.push(l.structureId));si({drawDefinition:e,structureIds:s})}function D5({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){var o;let a=(o=Wt({matchUpFilters:{matchUpTypes:[hi]},structure:i}))==null?void 0:o.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=zf({tieFormat:s.tieFormat,orderMap:r}),Rt({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function mx({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:u,event:c}){var C,R,N,A,M;let d="removeCollectionDefinition",p=u?void 0:Gd({drawDefinition:r,structureId:o,matchUpId:s,eventId:l,event:c});if(p!=null&&p.error)return ee({result:p,stack:d});let m=p==null?void 0:p.structure;u=u??(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,f=qr(h);if(p=Hn({tieFormat:f}),p.error)return ee({result:p,stack:d});let g=(C=f==null?void 0:f.collectionDefinitions)==null?void 0:C.find(E=>E.collectionId===a);if(!g)return ee({result:{error:_r,collectionId:a}});f.collectionDefinitions=f.collectionDefinitions.filter(E=>E.collectionId!==a),g.collectionGroupNumber&&(f.collectionDefinitions=f.collectionDefinitions.map(E=>{let{collectionGroupNumber:O,...k}=E;return k}),f.collectionGroups=f.collectionGroups.filter(({groupNumber:E})=>E!==g.collectionGroupNumber));let{aggregateValue:v,valueGoal:y}=ph(f);f.winCriteria=Ge({aggregateValue:v,valueGoal:y});let I=h==null?void 0:h.winCriteria.valueGoal,b=h==null?void 0:h.winCriteria.aggregateValue;(I&&I!==y||v&&!b)&&(n?f.tieFormatName=n:delete f.tieFormatName);let S=[];s&&u?S=[u]:o&&m?S=((R=Wt({matchUpFilters:{matchUpTypes:[hi]},structure:m}))==null?void 0:R.matchUps)??[]:r?S=((N=Sn({matchUpFilters:{matchUpTypes:[hi]},drawDefinition:r}))==null?void 0:N.matchUps)??[]:c&&(S=((A=Zl({matchUpFilters:{matchUpTypes:[hi]},drawDefinition:r}))==null?void 0:A.matchUps)??[]);let w=(S||[]).filter(E=>{var x,F,$;let O=(F=(x=E.tieMatchUps)==null?void 0:x.filter(_=>_.collectionId===a))==null?void 0:F.some(vr),k=e&&E.tieFormat?($=Ru({descendant:E.tieFormat,ancestor:f}))==null?void 0:$.different:!1;return t&&!O||!E.winningSide&&E.matchUpStatus!==qi&&(t||E.matchUpStatus!==os&&!vr(E)&&!k)});if(!w.length)return{error:Eg};let{appliedPolicies:U}=$t({tournamentRecord:i});if(s&&u&&t){let E=(M=u.tieMatchUps)==null?void 0:M.filter(O=>O.collectionId===a);for(let O of E??[]){let k=Ob({matchUpId:O.matchUpId,tieMatchUpId:u==null?void 0:u.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(k.error||(k=wi({drawDefinition:r,matchUpId:s}),k.error))return k;u=k==null?void 0:k.matchUp}}let T=[];for(let E of w){for(let O of(E==null?void 0:E.sides)??[])O.lineUp=(O.lineUp??[]).map(k=>({participantId:k.participantId,collectionAssignments:((k==null?void 0:k.collectionAssignments)??[]).filter(x=>x.collectionId!==a)}));if(E.tieMatchUps=(E.tieMatchUps??[]).filter(O=>{let k=O.collectionId===a;return k&&T.push(O.matchUpId),!k}),E.tieFormat&&(E.tieFormat=qr(f)),t){let O=Wu({matchUpId:E.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(O.error)return O}Rt({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,drawDefinition:r,context:d,matchUp:E})}T.length&&Gu({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:T,eventId:c==null?void 0:c.eventId,drawDefinition:r});let D=Ge(f);if(p=Hn({tieFormat:D}),p.error)return ee({result:p,stack:d});if(l&&c)c.tieFormat=D;else if(s&&u)u.tieFormat=D;else if(m)m.tieFormat=D;else if(r)r.tieFormat=D;else if(!u||!r)return{error:_e};si({drawDefinition:r,eventId:c==null?void 0:c.eventId});let P=Ge({drawId:r==null?void 0:r.drawId,action:d,collectionId:a,structureId:o,matchUpId:s,eventId:l});return BD({appliedPolicies:U,drawDefinition:r,auditData:P}),{tieFormat:D,deletedMatchUpIds:T,targetMatchUps:w,...J}}function P5({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(n))return ee({result:{error:Xe},stack:d});let p=l?void 0:Gd({drawDefinition:r,structureId:o,matchUpId:s,eventId:u,event:c});if(p!=null&&p.error)return ee({result:p,stack:d});let m=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,f=h==null?void 0:h.winCriteria.valueGoal,g=qr(h);if(p=Hn({tieFormat:g}),p.error)return ee({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:I,collectionGroupNumber:b}=y;if(b&&n.includes(I))return ee({info:"collectionIds cannot be part of other collectionGroups",result:{error:oe},stack:d})}let v=(g.collectionGroups||[]).reduce((y,I)=>I.groupNumber>y?I.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>n.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],U5({updateInProgressMatchUps:t,originalValueGoal:f,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:o,structure:m,tieFormat:g,matchUpId:s,matchUp:l,eventId:u,event:c})}function hx({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:m,uuids:h,event:f}){var F,$;let g="addCollectionDefinition",v=$t({tournamentRecord:r,drawDefinition:s,event:f}).appliedPolicies??{},y=(n==null?void 0:n[Or])??(v==null?void 0:v[Or]);a=a??((F=y==null?void 0:y.participants)==null?void 0:F.enforceCategory);let I=(u??(($=y==null?void 0:y.participants)==null?void 0:$.enforceGender))!==!1,b=!!((i??(f==null?void 0:f.category))&&a!==!1),S=!!((o??(f==null?void 0:f.gender))&&I),w=Oy({referenceCategory:i??(f==null?void 0:f.category),collectionDefinition:e,referenceGender:o,checkCategory:b,checkGender:S,event:f});if(w.error)return ee({result:w,stack:g});let U=p!=null&&p.tieFormat?void 0:Gd({drawDefinition:s,structureId:c,matchUpId:d,eventId:m,event:f});if(U!=null&&U.error)return ee({result:{error:U.error},stack:g});let T=U==null?void 0:U.structure;p=p??(U==null?void 0:U.matchUp);let D=(p==null?void 0:p.tieFormat)??(U==null?void 0:U.tieFormat),P=qr(D);if(U=Hn({tieFormat:P}),U==null?void 0:U.error)return ee({result:{error:U.error},stack:g});if(!e.collectionId)e.collectionId=Gt();else if(P.collectionDefinitions.map(({collectionId:_})=>_).includes(e.collectionId))return ee({context:{collectionId:e.collectionId},result:{error:fH}});P.collectionDefinitions.push(e),P.collectionDefinitions.sort((_,L)=>(_.collectionOrder||0)-(L.collectionOrder||0)).forEach((_,L)=>_.collectionOrder=L+1);let{aggregateValue:C,valueGoal:R}=ph(P);P.winCriteria=Ge({aggregateValue:C,valueGoal:R});let N=D==null?void 0:D.winCriteria.valueGoal,A=D==null?void 0:D.winCriteria.aggregateValue;(N&&N!==R||C&&!A)&&(l?P.tieFormatName=l:delete P.tieFormatName);let M=[],E=[],O=[],k=Ge(P);if(U=Hn({tieFormat:k}),U==null?void 0:U.error)return ee({result:{error:U.error},stack:g});if(m&&f){f.tieFormat=k;for(let _ of f.drawDefinitions??[])if(!_.tieFormat)for(let L of _.structures??[]){if(L.tieFormat)continue;let B=wC({updateInProgressMatchUps:t,collectionDefinition:e,structure:L,uuids:h});E.push(...B.newMatchUps),O.push(...B.targetMatchUps),M.push(L.structureId)}mU({modifiedMatchUps:O,eventId:f==null?void 0:f.eventId,modifiedStructureIds:M,tournamentRecord:r,drawDefinition:s,addedMatchUps:E,stack:g})}else if(c&&T){T.tieFormat=k;let _=wC({updateInProgressMatchUps:t,collectionDefinition:e,structure:T,uuids:h});E.push(..._.newMatchUps),O=_.targetMatchUps,mU({modifiedMatchUps:O,eventId:f==null?void 0:f.eventId,modifiedStructureIds:M,tournamentRecord:r,drawDefinition:s,addedMatchUps:E,stack:g})}else if(d&&p){if(!WS({matchUp:p,updateInProgressMatchUps:t}))return ee({result:{error:IN},stack:g});p.tieFormat=k;let _=gb({collectionDefinition:e,matchUp:p,uuids:h});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(..._),E.push(..._),mU({modifiedMatchUps:[p],eventId:f==null?void 0:f.eventId,modifiedStructureIds:M,tournamentRecord:r,drawDefinition:s,addedMatchUps:E,stack:g})}else if(s){s.tieFormat=k;for(let _ of s.structures??[]){let L=wC({updateInProgressMatchUps:t,collectionDefinition:e,structure:_,uuids:h});M.push(_.structureId),E.push(...L.newMatchUps),O.push(...L.targetMatchUps)}mU({modifiedMatchUps:O,eventId:f==null?void 0:f.eventId,tournamentRecord:r,drawDefinition:s,addedMatchUps:E,stack:g})}else return{error:_e};let x=Ge({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:g,structureId:c,matchUpId:d,eventId:m});return BD({appliedPolicies:v,drawDefinition:s,auditData:x}),{tieFormat:k,targetMatchUps:O,addedMatchUps:E,...J}}function wC({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){var o;let n=[],a=((o=Wt({matchUpFilters:{matchUpTypes:[hi]},structure:i}))==null?void 0:o.matchUps).filter(s=>WS({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let l=gb({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),n.push(...l)}return{newMatchUps:n,targetMatchUps:a}}function mU({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:o}){Dc({tournamentId:e==null?void 0:e.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i==null||i.forEach(s=>{Rt({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:r,context:o,matchUp:s,eventId:a})}),si({structureIds:t,drawDefinition:r,eventId:a})}function R5({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!Hn({tieFormat:i}).valid)return ee({result:{error:Dl},info:"falied validation",stack:d});let p=Gd({drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:c});if(p.error)return ee({result:p,stack:d});let{matchUp:m,tieFormat:h}=p,f=qr(h),g=Ru({descendant:i,ancestor:f,considerations:n});if(g.invalid)return ee({context:{invalid:g.invalid},result:{error:Dl},stack:d});if(!(g!=null&&g.different))return ee({result:{...J},info:"Nothing to do",stack:d});let v=f.collectionDefinitions.map(({collectionId:D})=>D),y=i.collectionDefinitions.map(({collectionId:D})=>D),I=v.filter(D=>!y.includes(D)),b=i.collectionDefinitions.filter(({collectionId:D})=>!v.includes(D)),S=b.map(Ta("collectionId")),w=[],U,T=i.tieFormatName;for(let D of i.collectionDefinitions){if(S.includes(D.collectionId))continue;let P=px({updateInProgressMatchUps:t,...D,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:c});if(P.modifications&&w.push(...P.modifications),P.error)return ee({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of b){let P=hx({updateInProgressMatchUps:t,collectionDefinition:D,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:o,matchUpId:s,matchUp:m,eventId:l,uuids:u,event:c});if(P.error)return ee({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of I){let P=mx({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:D,structureId:o,matchUpId:s,eventId:l,matchUp:m,event:c});if(P.error)return ee({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}return(h==null?void 0:h.tieFormatName)!==T?(U.tieFormatName=T,w.push({tieFormatName:T})):(w.length||S.length||I.length)&&(delete U.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),U.collectionDefinitions=U.collectionDefinitions.sort((D,P)=>wf(D.collectionOrder)-wf(P.collectionOrder)).map((D,P)=>({...D,collectionOrder:P+1})),{processedTieFormat:qr(U),modifications:w,...J}}function C5({tournamentRecord:t}){if(!t)return{error:ge};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=c=>{if(!c.tieFormat)return;let d;for(let p of r)Ru({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)c.tieFormatId=d,delete c.tieFormat;else{let p=Me(c.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=Gt()),c.tieFormatId=p.tieFormatId,delete c.tieFormat,r.push(p),e+=1}},a=i.eventType;n({tieFormat:i.tieFormat,eventType:a});for(let c of i.drawDefinitions??[]){n({tieFormat:c.tieFormat,eventType:a});for(let d of c.structures??[])n({tieFormat:d.tieFormat,eventType:a})}let o=(c,d)=>{var m;let p=(m=l.matchUps)==null?void 0:m.find(h=>h.matchUpId===c);p&&(p.tieFormatId=d,delete p.tieFormat,Rt({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:p}))},s=c=>{let d=Me(c.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Gt()),r.push(d),e+=1,o(c.matchUpId,d.tieFormatId)},l=Zl({matchUpFilters:{matchUpTypes:[ka]},event:i}),u=l.matchUps??[];for(let c of u){let d;for(let p of r)c.tieFormat&&Ru({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?o(c.matchUpId,d):s(c)}r.length&&(i.tieFormats=r)}return{...J,addedCount:e}}var E5={};yt(E5,{addDrawDefinitionExtension:()=>gT,addEventExtension:()=>zc,addEventTimeItem:()=>uh,addExtension:()=>Lt,addNotes:()=>HT,addOnlineResource:()=>F5,addParticipantExtension:()=>$z,addParticipantTimeItem:()=>UO,addTimeItem:()=>gl,addTournamentExtension:()=>rA,addTournamentTimeItem:()=>bb,analyzeDraws:()=>wb,analyzeTournament:()=>rk,copyTournamentRecord:()=>N5,createTournamentRecord:()=>LD,generate:()=>M5,getAggregateTeamResults:()=>ik,getAllowedDrawTypes:()=>oD,getAllowedMatchUpFormats:()=>QO,getAppliedPolicies:()=>$t,getCompetitionDateRange:()=>lD,getCompetitionPenalties:()=>ek,getPolicyDefinitions:()=>Hu,getTournamentInfo:()=>dh,getTournamentPenalties:()=>sD,getTournamentPersons:()=>tk,getTournamentPoints:()=>uD,getTournamentStructures:()=>rO,getTournamentTimeItem:()=>RT,mutate:()=>A5,query:()=>F6,removeDrawDefinitionExtension:()=>Bz,removeEventExtension:()=>vT,removeExtension:()=>Un,removeNotes:()=>IO,removeOnlineResource:()=>x5,removeParticipantExtension:()=>Vz,removeTournamentExtension:()=>nA,setTournamentCategories:()=>$5,setTournamentDates:()=>VD,setTournamentEndDate:()=>V5,setTournamentName:()=>L5,setTournamentNotes:()=>_5,setTournamentStartDate:()=>B5,setTournamentStatus:()=>k5});var M5={};yt(M5,{copyTournamentRecord:()=>N5,createTournamentRecord:()=>LD});function N5(t){var p,m;let e=ze(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord,n=24*60*60*1e3,a=(i&&r?new Date(pt(r)).getTime()-new Date(pt(i)).getTime():0)/n,o=t.endDate||_N(t.startDate,a),s=h=>h==null?void 0:h.filter(({itemType:f})=>{var g;return(g=t.itemTypeList)==null?void 0:g.includes(f)}),l=h=>h==null?void 0:h.filter(({name:f})=>{var g;return(g=t.extensionList)==null?void 0:g.includes(f)}),u=h=>{let{timeItems:f,extensions:g,...v}=h;return Me({...v,timeItems:s(f),extensions:l(g)},!1,!0)},c=h=>{let{drawDefinitions:f,timeItems:g,extensions:v,startDate:y,endDate:I,...b}=h;return Me({extensions:l(v),timeItems:s(g),startDate:t.startDate,endDate:o,...b},!1,!0)},d={participants:t.copyParticipants?((p=t.tournamentRecord.participants)==null?void 0:p.map(u))??[]:[],parentOrganisation:Me({...t.tournamentRecord.parentOrganisation},!1,!0),venues:Me(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:s(t.tournamentRecord.timeItems),events:((m=t.tournamentRecord.events)==null?void 0:m.map(c))??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:Gt(),endDate:o};return{...J,tournamentRecord:d}}var A5={};yt(A5,{addDrawDefinitionExtension:()=>gT,addEventExtension:()=>zc,addEventTimeItem:()=>uh,addExtension:()=>Lt,addNotes:()=>HT,addOnlineResource:()=>F5,addParticipantExtension:()=>$z,addParticipantTimeItem:()=>UO,addTimeItem:()=>gl,addTournamentExtension:()=>rA,addTournamentTimeItem:()=>bb,removeDrawDefinitionExtension:()=>Bz,removeEventExtension:()=>vT,removeExtension:()=>Un,removeNotes:()=>IO,removeOnlineResource:()=>x5,removeParticipantExtension:()=>Vz,removeTournamentExtension:()=>nA,setTournamentCategories:()=>$5,setTournamentDates:()=>VD,setTournamentEndDate:()=>V5,setTournamentName:()=>L5,setTournamentNotes:()=>_5,setTournamentStartDate:()=>B5,setTournamentStatus:()=>k5});var whe="ABANDONED",Uhe="ACTIVE",She="CANCELLED",The="COMPLETED",Dhe="IN_PROGRESS",O5={ABANDONED:whe,ACTIVE:Uhe,CANCELLED:She,COMPLETED:The,IN_PROGRESS:Dhe};function k5({tournamentRecord:t,status:e}){return t?e&&!Object.keys(O5).includes(e)?{error:oe,info:"Unknown status"}:(t.tournamentStatus=e,{...J}):{error:ge}}function x5(t){var u,c,d;let e=ze(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:o,courtId:s,venueId:l}=t;if(n){if(((u=i.parentOrganisation)==null?void 0:u.parentOrganisationId)!==n)return ee({result:{error:_r}});Wh({element:i.parentOrganisation,onlineResource:r})}else if(a||o){let p=(i.participants??[]).find(m=>{var h;return o&&((h=m.person)==null?void 0:h.personId)===o||m.participantId===a});if(!p)return ee(o?{result:{error:_r}}:{result:{error:zi}});if(o){if(((c=p.person)==null?void 0:c.personId)!==o)return ee({result:{error:Vm}});Wh({element:p.person,onlineResource:r})}else Wh({element:p,onlineResource:r})}else if(s){let p=(d=(i.venues??[]).filter(m=>!l||m.venueId===l).flatMap(m=>(m.courts??[]).filter(h=>h.courtId===s)))==null?void 0:d[0];if(!p)return ee({result:{error:Cg}});Wh({element:p,onlineResource:r})}else if(l){let p=(i.venues??[]).find(m=>m.venueId===l);if(!p)return ee({result:{error:Gm}});Wh({element:p,onlineResource:r})}else Wh({element:i,onlineResource:r}),lt({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:cp});return{...J}}function Wh({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!((r==null?void 0:r[Pf])===e[Pf]&&(r==null?void 0:r[Rf])===e[Rf]&&(r==null?void 0:r[Cf])===e[Cf]));t.onlineResources=i}function F5(t){var u,c,d;let e=ze(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:o,courtId:s,venueId:l}=t;if(n){if(((u=i.parentOrganisation)==null?void 0:u.parentOrganisationId)!==n)return ee({result:{error:_r}});qh({element:i.parentOrganisation,onlineResource:r})}else if(a||o){let p=(i.participants??[]).find(m=>{var h;return o&&((h=m.person)==null?void 0:h.personId)===o||m.participantId===a});if(!p)return ee(o?{result:{error:_r}}:{result:{error:zi}});if(o){if(((c=p.person)==null?void 0:c.personId)!==o)return ee({result:{error:Vm}});qh({element:p.person,onlineResource:r})}else qh({element:p,onlineResource:r})}else if(s){let p=(d=(i.venues??[]).filter(m=>!l||m.venueId===l).flatMap(m=>(m.courts??[]).filter(h=>h.courtId===s)))==null?void 0:d[0];if(!p)return ee({result:{error:Cg}});qh({element:p,onlineResource:r})}else if(l){let p=(i.venues??[]).find(m=>m.venueId===l);if(!p)return ee({result:{error:Gm}});qh({element:p,onlineResource:r})}else qh({element:i,onlineResource:r}),lt({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:cp});return{...J}}function qh({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>(r==null?void 0:r[Pf])!==e[Pf]&&(r==null?void 0:r[Rf])!==e[Rf]&&(r==null?void 0:r[Cf])!==e[Cf]);return i.push(e),t.onlineResources=i,{...J}}function L5({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:ge};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&lt({topic:cp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...J}}function _5({tournamentRecord:t,notes:e}){if(!t)return{error:ge};let i=e?HT({element:t,notes:e}):IO({element:t});return i.error?i:(lt({topic:cp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...J})}function $5({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,lt({topic:cp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...J}):{error:ge}}function Phe({tournamentRecord:t}){var a,o;if(!t)return{error:ge};let{startDate:e,endDate:i}=t,r=Df(e,i),n=[];for(let s of t.venues||[])(a=s==null?void 0:s.courts)!=null&&a.length&&n.push(...s.courts);for(let s of n){let{startTime:l,endTime:u}=(s.dateAvailability??[]).reduce((p,m)=>{let h=kt(p.startTime),f=kt(p.endTime);return m.startTime&&kt(m.startTime)<h&&(p.startTime=m.startTime),m.endTime&&kt(m.endTime)>f&&(p.endTime=m.endTime),p},{startTime:"08:00",endTime:"18:00"}),c=r.map(p=>{var m;return((m=s.dateAvailability)==null?void 0:m.find(h=>h.date===p))??{date:p,startTime:l,endTime:u}}),d=(o=s.dateAvailability)==null?void 0:o.find(p=>!p.date);d&&c.unshift(d),s.dateAvailability=c}return{...J}}function VD(t){var m,h;let{tournamentRecord:e,startDate:i,endDate:r,weekdays:n}=t,a=(m=t.activeDates)==null?void 0:m.filter(Boolean),o=ze(t,[{tournamentRecord:!0},{[Kr]:f=>Zs.test(f),[_a]:Nr,startDate:!1,endDate:!1},{[Kr]:f=>f.filter(Boolean).every(g=>Zs.test(g)),[_a]:Nr,activeDates:!1},{[Kr]:v4,weekdays:!1}]);if(o.error)return o;if(r&&i&&new Date(r)<new Date(i))return{error:oe};if(r&&i&&new Date(i)>new Date(r))return{error:oe};if(a!=null&&a.length){let f=i||e.startDate,g=r||e.endDate,v=!f||a.every(I=>new Date(I)>=new Date(f)),y=!g||a.every(I=>new Date(I)<=new Date(g));if(!v||!y)return{error:Nr}}let s;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||r&&e.endDate&&new Date(r)<new Date(e.endDate))&&(s=!0);let l=Df(e.startDate,e.endDate);i&&(e.startDate=i),r&&(e.endDate=r);let u=Df(e.startDate,e.endDate),c=l.filter(f=>!u.includes(f)),d=u.filter(f=>!l.includes(f));for(let f of e.events??[])i&&f.startDate&&new Date(f.startDate)<new Date(i)&&(f.startDate=i),r&&f.startDate&&new Date(f.startDate)>new Date(r)&&(f.startDate=i??r),r&&f.endDate&&new Date(f.endDate)>new Date(r)&&(f.endDate=r),i&&f.endDate&&new Date(f.endDate)<new Date(i)&&(f.endDate=r??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),r&&e.startDate&&new Date(r)<new Date(e.startDate)&&(e.startDate=r),a&&(e.activeDates=a),n&&(e.weekdays=n);let p=s&&((h=Rhe({tournamentRecord:e}))==null?void 0:h.unscheduledMatchUpIds);return Phe({tournamentRecord:e}),lt({payload:Ge({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:n,endDate:r}),topic:cp}),{...J,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:c}}function B5({tournamentRecord:t,startDate:e}){return e?VD({tournamentRecord:t,startDate:e}):{error:Nr}}function V5({tournamentRecord:t,endDate:e}){return e?VD({tournamentRecord:t,endDate:e}):{error:Nr}}function Rhe({tournamentRecord:t}){let e=Br({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let o of e){let{schedule:s,matchUpId:l}=o;if(s&&s.scheduledDate){let u=new Date(s.scheduledDate);(i&&u<i||r&&u>r)&&(a.push(l),n.includes(s.scheduledDate)||n.push(s.scheduledDate))}}return n.length&&!xD({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:gG}:{unscheduledMatchUpIds:a}}var j5={};yt(j5,{addCourt:()=>$D,addCourts:()=>sx,addVenue:()=>tb,deleteCourt:()=>J5,deleteVenue:()=>Ix,deleteVenues:()=>W5,disableCourts:()=>q5,disableVenues:()=>Y5,enableCourts:()=>K5,enableVenues:()=>X5,generate:()=>G5,generateCourts:()=>xk,getCompetitionVenues:()=>Db,getCourts:()=>wk,getVenuesAndCourts:()=>qu,modifyCourt:()=>yx,modifyCourtAvailability:()=>gx,modifyVenue:()=>Z5,mutate:()=>H5,publicFindVenue:()=>LA,query:()=>Z6});var G5={};yt(G5,{generateCourts:()=>xk});var H5={};yt(H5,{addCourt:()=>$D,addCourts:()=>sx,addVenue:()=>tb,deleteCourt:()=>J5,deleteVenue:()=>Ix,deleteVenues:()=>W5,disableCourts:()=>q5,disableVenues:()=>Y5,enableCourts:()=>K5,enableVenues:()=>X5,modifyCourt:()=>yx,modifyCourtAvailability:()=>gx,modifyVenue:()=>Z5});function fx(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:ge};if(!(t!=null&&t.courtId))return{error:Bm};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:o}=Yu({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:s}=Br({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{var h,f,g;let m=(f=(h=p.schedule)==null?void 0:h.allocatedCourts)==null?void 0:f.map(({courtId:v})=>v);return((g=p.schedule)==null?void 0:g.courtId)===c||(m==null?void 0:m.includes(c))});return $S({matchUps:d,schedulingProfile:o})}}function Che({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:ge};if(!r)return{error:jc};let{schedulingProfile:n}=Yu({tournamentRecord:e}),{matchUps:a}=Br({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:o({matchUps:a,venueId:r})};function o({matchUps:s,venueId:l}){let u=s.filter(c=>{var p,m,h;let d=(m=(p=c.schedule)==null?void 0:p.allocatedCourts)==null?void 0:m.map(({venueId:f})=>f);return((h=c.schedule)==null?void 0:h.venueId)===l||(d==null?void 0:d.includes(l))});return $S({matchUps:u,schedulingProfile:n})}}function gx({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){var m,h,f;if(!t)return{error:ge};if(!n)return{error:Bm};let o=DY({dateAvailability:e});if(o.error)return o;let{updatedDateAvailability:s,totalMergeCount:l}=Ehe(e);e=s;let u=rh({tournamentRecord:t,courtId:n});if(u.error)return u;let{court:c,venue:d}=u,{matchUps:p}=fx({tournamentRecord:t,venueMatchUps:r,courtId:n});if(p!=null&&p.length){let g=(m=$t({tournamentRecord:t}))==null?void 0:m.appliedPolicies,v=a??((f=(h=g==null?void 0:g[Hc])==null?void 0:h.allowDeletionWithScoresPresent)==null?void 0:f.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return c&&(c.dateAvailability=e,!i&&d&&lt({payload:{venue:d,tournamentId:t.tournamentId},topic:dp,key:d.venueId})),{...J,totalMergeCount:l}}function Ehe(t){let e=0,i=t.reduce((n,a)=>{let{date:o,startTime:s,endTime:l,bookings:u}=a;return n[o]||(n[o]=[]),n[o].push({startTime:s,endTime:l,bookings:u}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(qme);let{mergedAvailability:a,mergeCount:o}=Mhe(i[n]);r.push(...a.map(s=>({date:n,...s}))),e+=o}),{updatedDateAvailability:r,totalMergeCount:e}}function Mhe(t){let e,i,r,n=t.length,a=0,o=[];for(;t.length&&n;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(n-=1,!e)e=u,r=d,i=c;else if(Ny(ir(i),ir(u),!1)>0){let p={startTime:e,endTime:i};r!=null&&r.length&&(p.bookings=r),o.push(p),e=u,r=d,i=c}else d&&(r?r.push(d):r=d),i=c,a+=1}let s={startTime:e,endTime:i};return r!=null&&r.length&&(s.bookings=r),o.push(s),{mergedAvailability:o,mergeCount:a}}function vx({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:bH,info:e}}function z5({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:yn};if(!e&&!r)return{error:ks};let a;if(!e){if(!t)return{error:ge};({drawDefinition:e}=Wn({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=wi({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:ge};let o=Br({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=t3({matchUps:o,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(o=>[Rc,jl].includes(o.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:o})=>![Rc,jl].includes(o)),Rt({tournamentId:t==null?void 0:t.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...J}):{error:dn}}function Ix(t){var l,u,c;if(typeof(t==null?void 0:t.venueId)!="string")return{error:jc};let{tournamentRecord:e,venueId:i,force:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(n).length)return{error:ge};let a=Rs({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],o=(l=$t({tournamentRecord:e}))==null?void 0:l.appliedPolicies,s=r??((c=(u=o==null?void 0:o[Hc])==null?void 0:u.allowDeletionWithScoresPresent)==null?void 0:c.venues);if(!a.length||s)for(let d of Object.values(n)){for(let m of a){let h=z5({matchUpId:m.matchUpId,drawId:m.drawId,tournamentRecord:d});if(h.error)return h}let p;d.venues=(d.venues??[]).filter(m=>(m==null?void 0:m.venueId)!==i?!0:(p=!0,!1)),p&&lt({payload:{venueId:i,tournamentId:d.tournamentId},topic:fA,key:i})}else return vx({matchUpsCount:a.length});return Rb({tournamentRecords:n}),{...J}}function W5({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:ge};if(!Array.isArray(e))return{error:oe};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,o=Ix({tournamentRecord:t,venueId:a,force:i});if(o.error)return o}}return{...J}}function q5(t){let{courtIds:e,dates:i}=t,r=Io(t),n=[{[pn]:!0,[hT]:!0}],a=ze(t,n);if(a.error)return a;for(let o of Object.values(r))Nhe({tournamentRecord:o,courtIds:e,dates:i});return{...J}}function Nhe({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>Lt({extension:{value:r,name:Is},creationTime:!1,element:a});for(let a of t.venues||[])for(let o of a.courts||[])if(e!=null&&e.includes(o.courtId)){let s=n(o);if(s.error)return s}return{...J}}function Y5(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[pn]:!0,[fT]:!0}],a=ze(t,n);if(a.error)return a;let o=Object.keys(e).filter(s=>!i||s===i);for(let s of o){let l=e[s];Ahe({tournamentRecord:l,venueIds:r})}return{...J}}function Ahe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let r=Lt({creationTime:!1,element:i,extension:{name:Is,value:!0}});if(r.error)return r}return{...J}}function K5(t){let e=Io(t),i=[{[pn]:!0}];!t.enableAll&&i.push({[hT]:!0});let r=ze(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:o}=t;for(let s of Object.values(e))Ohe({tournamentRecord:s,courtIds:a,enableAll:n,dates:o});return{...J}}function Ohe({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(r)){let{extension:o}=gt({element:a,name:Is});if(o){let s=o.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!r.includes(l))),Lt({extension:{name:Is,value:s},creationTime:!1,element:a})}}else Un({element:a,name:Is});return{...J}}function X5(t){let e=Io(t),i=[{[pn]:!0}];!t.enableAll&&i.push({[fT]:!0});let r=ze(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let o of Object.values(e))for(let s of o.venues||[])(a||n!=null&&n.includes(s.venueId))&&Un({element:s,name:Is});return{...J}}function J5(t){let{courtId:e,disableNotice:i,force:r}=t,n=Io(t),a=ze(t,[{[pn]:!0,[kz]:!0}]);if(a.error)return a;let o,s;for(let l of Object.values(n)){if(s=khe({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),s.error&&s.error!==Cg)return s;s.success&&(o=!0)}return o?{...J}:s}function khe({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){var u,c,d;let n=rh({tournamentRecord:t,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:o}=fx({tournamentRecord:t,courtId:i}),s=(u=$t({tournamentRecord:t}))==null?void 0:u.appliedPolicies,l=r??((d=(c=s==null?void 0:s[Hc])==null?void 0:c.allowDeletionWithScoresPresent)==null?void 0:d.courts);if(!(o!=null&&o.length)||l){for(let p of o??[]){let m=z5({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(m.error)return m}a&&(a.courts=(a.courts??[]).filter(p=>p.courtId!==i),e||lt({payload:{venue:a,tournamentId:t.tournamentId},topic:dp,key:a.venueId}))}else return vx({matchUpsCount:o.length});return{...J}}function yx(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,o=Io(t);if(!Object.keys(o).length)return{error:Oi};let s,l;for(let u of Object.values(o)){let c=xhe({tournamentRecord:u,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(c!=null&&c.error)return c;s=!0}return s?{...J}:l}function xhe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:ge};if(!n)return{error:Bm};if(!r||typeof r!="object")return{error:Vu};let o=rh({tournamentRecord:t,courtId:n});if(o.error)return o;let{venue:s,court:l}=o,u=Object.keys(Wme()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>u.includes(p)).length)return{error:K0};let c=u.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(r).filter(p=>c.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=gx({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||lt({payload:{venue:s,tournamentId:t.tournamentId},topic:dp,key:s==null?void 0:s.venueId}),{...J,court:Me(l)}}var Fhe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),Lhe=Fhe;function Z5(t){let{modifications:e,venueId:i,force:r}=t,n=Io(t);if(!Object.keys(n).length)return{error:Oi};if(typeof i!="string")return{error:jc};let a,o;for(let s of Object.values(n)){let l=_he({tournamentRecord:s,modifications:e,venueId:i,force:r});if(l.success&&(o=!0),l.error&&(a=l.error),l.error&&l.error!==Gm)return l}return Rb({tournamentRecords:n}),o?{...J}:{error:a}}function _he({tournamentRecord:t,modifications:e,venueId:i,force:r}){var g,v,y,I,b,S,w,U;if(!t)return{error:ge};if(!e||typeof e!="object")return{error:Vu};if(!i)return{error:jc};let n=(g=$t({tournamentRecord:t}))==null?void 0:g.appliedPolicies,a=r??((y=(v=n==null?void 0:n[Hc])==null?void 0:v.allowDeletionWithScoresPresent)==null?void 0:y.venues),{matchUps:o}=Che({tournamentRecord:t,venueId:i}),s=Jl({tournamentRecord:t,venueId:i});if(s.error)return s;let l=s.venue,u=Object.keys(Lhe()).filter(T=>T!=="venueId");if(!Object.keys(e).filter(T=>u.includes(T)).length)return{error:K0};let c=u.filter(T=>!["courts","onlineResources"].includes(T)),d=Object.keys(e).filter(T=>c.includes(T));l&&d.forEach(T=>Object.assign(l,{[T]:e[T]}));let p=((I=l==null?void 0:l.courts)==null?void 0:I.map(T=>T.courtId))??[],m=((b=e.courts)==null?void 0:b.map(T=>T.courtId))||[],h=m.length?p.filter(T=>!m.includes(T)):(e==null?void 0:e.courts)&&p,f=[];if(h!=null&&h.length){let T=(w=(S=l==null?void 0:l.courts)==null?void 0:S.filter(D=>h.includes(D.courtId)))==null?void 0:w.map(D=>{var C;let P=fx({courtId:D.courtId,tournamentRecord:t,venueMatchUps:o});for(let R of P.matchUps??[])f.push({matchUpId:R.matchUpId,drawId:R.drawId});return((C=P.matchUps)==null?void 0:C.length)??0}).reduce((D,P)=>D+P);if(l&&(!T||a))l.courts=(U=l.courts)==null?void 0:U.filter(D=>m.includes(D.courtId)),VI({schedule:{courtId:"",scheduledDate:""},matchUpDetails:f,removePriorValues:!0,tournamentRecord:t});else return vx({matchUpsCount:T})}if(e.courts)for(let T of e.courts){let{courtId:D}=T||{},P=yx({modifications:T,disableNotice:!0,tournamentRecord:t,venueMatchUps:o,courtId:D,force:r});if(P.error===Cg&&(P=$D({disableNotice:!0,tournamentRecord:t,venueId:i,court:T})),P.error)return P}return Rb({tournamentRecord:t}),l&&lt({payload:{venue:l,tournamentId:t.tournamentId},topic:dp,key:l==null?void 0:l.venueId}),{...J,venue:Me(l)}}var jD={};yt(jD,{JSON2CSV:()=>zhe,UUID:()=>Gt,UUIDS:()=>BH,allNumeric:()=>uG,attributeFilter:()=>Im,chunkArray:()=>Pr,chunkByNth:()=>uE,chunkSizeProfile:()=>lG,constantToString:()=>Qr,countValues:()=>one,createMap:()=>dG,dateTime:()=>$H,definedAttributes:()=>Ge,dehydrateMatchUps:()=>Vhe,extractAttributes:()=>VW,flattenJSON:()=>bx,generateDateRange:()=>Df,generateHashCode:()=>hne,generateRange:()=>Se,generateTimeCode:()=>AY,groupValues:()=>oG,hasAttributeValues:()=>mne,instanceCount:()=>wa,intersection:()=>Vi,isConvertableInteger:()=>ot,isNumeric:()=>Li,isOdd:()=>nG,isPowerOf2:()=>Us,makeDeepCopy:()=>Me,matchUpScheduleSort:()=>Bhe,matchUpSort:()=>nh,nearestPowerOf2:()=>rN,nextPowerOf2:()=>Ug,noNulls:()=>ane,noNumeric:()=>cG,numericSort:()=>or,occurrences:()=>lne,overlap:()=>Rn,randomMember:()=>pa,randomPop:()=>fa,shuffleArray:()=>wn,structureSort:()=>Km,subSort:()=>une,undefinedToNull:()=>cE,unique:()=>ct,visualizeScheduledMatchUps:()=>$he});function $he({scheduledMatchUps:t,showGlobalLog:e}){Pse();let i=t==null?void 0:t.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:o}=t.find(s=>s.structureId===n);return{[n]:`${a} ${o}`}})};i==null||i.forEach(n=>{var s;Aa({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let a=t.filter(l=>l.structureId===n),o=((s=Cn({matchUps:a}))==null?void 0:s.roundMatchUps)||[];Object.keys(o).forEach(l=>{Aa({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),o[l].forEach(({matchUpId:u,schedule:c})=>{let d=bi(c.scheduledTime);Aa({matchUpId:u,time:d,date:c.scheduledDate,venue:c.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&Dse()}var{extractTime:IV,timeStringMinutes:yV}=$H;function Bhe(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=yV(IV(i.scheduledTime)),a=yV(IV(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function Vhe({tournamentRecord:t}){if(!t)return{error:ge};if(typeof t!="object"||!t.tournamentId)return{error:oe};let{matchUps:e}=Br({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=jhe({tournamentRecord:t});Hhe(e,i)}return{...J}}function jhe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var Ghe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function Hhe(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,o=e[r]||e[n]||e[a],s=i.matchUpFormat===o?void 0:i.matchUpFormat;for(let l of Object.keys(i))Ghe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function zhe(t,e){if(e&&typeof e!="object")return{error:oe};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:m='"',columnJoiner:h=",",rowJoiner:f=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof h!="string"||typeof f!="string"||typeof g!="string"||typeof m!="string")return{error:oe};i=Object.assign({},...Object.keys(i).reverse().map(A=>({[A]:Array.isArray(i[A])?i[A]:[typeof i[A]=="string"&&i[A]].filter(Boolean)})));let v=t.filter(Boolean).map(A=>bx(A,g)),y=Object.values(i).flat();r&&l.push(...y);let I=v.reduce((A,M)=>Object.keys(M).every(E=>!A.includes(E)&&A.push(E)||!0)&&A,[]).filter(A=>!(l!=null&&l.length)||l.includes(A)),b=Object.assign({},...Object.keys(i).reverse().map(A=>i[A].map(M=>({[M]:A})).flat()).flat()),S=(A,M)=>e!=null&&e.sortOrder?e.sortOrder.includes(A)&&e.sortOrder.includes(M)&&e.sortOrder.indexOf(A)-e.sortOrder.indexOf(M)||!e.sortOrder.includes(M)&&-1:0,w=I.reduce((A,M)=>{let E=b[M];return E?A.includes(E)||A.push(E):A.push(M),A},[]).sort(S);Object.keys(c).forEach(A=>!w.includes(A)&&w.unshift(A)),Object.keys(i).forEach(A=>!w.includes(A)&&w.unshift(A)),typeof p=="object"&&Object.keys(p).forEach(A=>!w.includes(A)&&w.unshift(A));let U=w.map(A=>c[A]||A);if(s)return[U];let T=A=>`${m}${A}${m}`,D=[],P=A=>Object.values(w.reduce((M,E,O)=>{var _;let k=i[E],x=(k!=null&&k.length?A[k.find(L=>A[L])]:A[E])||(p==null?void 0:p[E])||"",F=((_=d[E])==null?void 0:_[x])||x,$=ma(u[E])?u[E](F):F;return M[E]=T($),$&&(D[O]=(D[O]||0)+1),M},{})),C=v.map(P),R=o&&[...D].map((A,M)=>!A&&M).filter(Li).reverse();if(R){let A=M=>M.filter((E,O)=>!R.includes(O));C=C.map(A),U=A(U)}let N=C.map(A=>A.join(h));return a?N.map(A=>{let M=A.split(h);return Object.assign({},...M.map((E,O)=>({[U[O]]:E})))}):n?[U.map(T).join(h),...N].join(f):N.join(f)}function bx(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,bx(t[n],e,i.concat(n))),{})}var{FACTORY:bV}=Gz;function Whe({tournamentRecord:t,value:e}){let{extension:i}=gt({element:t,name:bV}),r={name:bV,value:{...i==null?void 0:i.value,...e}};Lt({element:t,extension:r})}function Q5({timeStamp:t}){let e=zm(),i=AN();return i&&Object.values(e).forEach(r=>{Whe({tournamentRecord:r,value:{version:L0(),timeStamp:t}})}),i}function e7({engineType:t,methodName:e,elapsed:i,params:r,result:n}){var d,p;let a=Fa();if(typeof a!="object")return;let o={method:e},s=(n==null?void 0:n.error)&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&((d=a.params)==null?void 0:d.includes(e)),u=a.params&&!Array.isArray(a.params)||l,c=Array.isArray(a.exclude)&&a.exclude.includes(e);!c&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(o.elapsed=i),!c&&(s||u)&&(o.params=r),!c&&(s||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&((p=a.result)!=null&&p.includes(e)))&&(o.result=n),Object.keys(o).length>1&&NH(o,t)}function wx({methodName:t,params:e,start:i}){let r={error:J0,methodName:t},n=i?Date.now()-i:0;return e7({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function qhe(t,e){var a;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:ge};let i=e.drawId||((a=e.matchUp)==null?void 0:a.drawId);if(i){let{event:o,drawDefinition:s,tournamentId:l}=Wn({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),o&&(e.event=o)}if(e.eventId&&!e.event){let{event:o,tournamentId:s}=Wn({eventId:e.eventId,tournamentRecords:t});if(!o)return{error:lo};e.tournamentId=s,e.event=o}let r=e.tournamentId??Hm();if(!r&&e)return e;let n=t[r];return r&&!n?{error:ge}:(n&&(e.tournamentRecord=n),e)}function Ux(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),o=Hm();i&&(i.activeTournamentId=o);let s=(i==null?void 0:i.tournamentRecord)||kN(o),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||zm(),u=i?Me(i,void 0,!0):void 0,c=i?qhe(l,i):void 0;if(c!=null&&c.error)return c;let d=Yhe({params:c,tournamentRecords:l,tournamentRecord:s,methodName:r,method:e}),p=Date.now()-a;return e7({result:d,methodName:r,elapsed:p,params:u,engineType:n}),d}function Yhe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(Fa())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return tT({engineName:"engine",methodName:r,params:i,err:a})}}function GD(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=vo();for(let o of[...a].sort(Khe)){let s=CH({topic:o});s!=null&&s.length&&wE({topic:o,notices:s})}e&&n&&a.includes(CE)&&wE({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:CE})}var wV={[SA]:5,[UA]:5,[TA]:5,[wA]:5,[bA]:5,[IA]:5,[nW]:5,[aW]:5,[yA]:1,[ST]:1,[nn]:5,[dp]:5,[vA]:4,[hA]:4,[fA]:4,[gA]:4,[UT]:3,[cA]:2};function Khe(t,e){return(wV[e]||0)-(wV[t]||0)}function Xhe({convertExtensions:t,removeExtensions:e}){let i=zm();return{tournamentId:Hm(),tournamentRecords:Me(i,t,!1,e)}}function Jhe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=(t==null?void 0:t.tournamentId)??Hm();if(typeof r!="string")return{};let n=kN(r);return{tournamentRecord:Me(n,e,!1,i)}}function Zhe(){var r;let t=zm(),{extension:e}=gt({name:xd,tournamentRecords:t,discover:!0}),i=((r=e==null?void 0:e.value)==null?void 0:r.tournamentIds)||[];return Object.keys(t).forEach(n=>{i.includes(n)||delete t[n]}),eT(t)}function UV(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Vu}:t!=null&&t.tournamentId?EH(e?Me(t):t):{error:oe}}function jI(t,e=!0){if(typeof t!="object")return{error:Vu};if(bI(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:mE};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},bI(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:mE};return eT(e?Me(t):t)}function Qhe(t,e,i,r,n,a){let o=AH(i,r,n,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(l=>ma(s[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:s[l],...u});if(Fa())return c();try{return c()}catch(d){tT({engineName:"engine",methodName:l,params:u,err:d})}}}),{...J,...t}}function Yh(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function t7(t,e){t.importMethods=(i,r,n,a)=>Qhe(t,e,i,r,n,a),t.getTournament=i=>Jhe(i),t.getState=i=>Xhe({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>L0(),t.reset=()=>(eT({}),Yh(t)),t.devContext=i=>(II(i),Yh(t)),t.getDevContext=i=>Fa(i),t.newTournamentRecord=(i={})=>{let r=LD(i),n=r.tournamentId;return r.error?r:(UV(r),bI(n),{...J,tournamentId:n})},t.setState=(i,r,n)=>{yI(r,n);let a=jI(i,r);return Yh(t,a)},t.setTournamentId=i=>bI(i),t.getTournamentId=()=>Hm(),t.setTournamentRecord=(i,r,n)=>{yI(r,n);let a=UV(i,r);return Yh(t,a)},t.removeTournamentRecord=i=>{let r=MH(i);return Yh(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=Zhe();return Yh(t,i)}}function efe(t,e,i){if(!Array.isArray(e))return{error:oe,message:"directives must be an array"};let r=RH(),n=Date.now(),a=i&&Me(zm(),!1,!0),o=[];for(let u of e){if(typeof u!="object")return{error:oe,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:oe,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!r[c])return wx({methodName:c,start:n,params:p});if(d){let h=o[o.length-1],f=Object.keys(d);for(let g of f)h[g]&&(p[g]=h[g])}let m=Ux(t,r[c],p,c,"sync");if(m!=null&&m.error)return a&&jI(a),{...m,rolledBack:!!a};o.push({...m,methodName:c})}let s=Date.now(),l=Q5({timeStamp:s});return GD({directives:e,mutationStatus:l,timeStamp:s}),Ey(),{success:o.every(u=>u.success),results:o}}function SV(t,e){if(!Nt(e))return{error:oe,message:"args must be an object"};let i=Object.values(e).filter(ma).length;if(i>1)return{message:"there must be only one arg with typeof function",error:oe};let r=i?Object.keys(e).find(m=>ma(e[m])):Ti(e.method)&&e.method;if(!r)return{error:J0};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&Me(zm(),!1,!0),l=n||t[r]||MN()[r];if(!l)return wx({methodName:r,params:o});let u=Ux(t,l,o,r,"sync")??{};u!=null&&u.error&&s&&jI(s);let c=Date.now(),d=Q5({timeStamp:c}),p=(u==null?void 0:u.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&GD({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:c}),(p||!(u!=null&&u.success)||o!=null&&o.doNotNotify)&&Ey(),u}var tfe=(()=>{let t={executionQueue:(e,i)=>efe(t,e,i),execute:e=>SV(t,e)};return t7(t,SV),t})(),Sx=tfe;function TV(t,e){if(!Nt(e))return{error:oe,message:"args must be an object"};let i=Object.values(e).filter(ma).length;if(i>1)return{message:"there must be only one arg with typeof function",error:oe};let r=i?Object.keys(e).find(l=>ma(e[l])):Ti(e.method)&&e.method;if(!r)return{error:J0};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=n||t[r]||MN()[r];return s?Ux(t,s,o,r,"ask"):wx({methodName:r,params:o})}(()=>{let t={execute:e=>TV(t,e)};return t7(t,TV),t})();var em={},mc;function DV(t,e=!0){if(!t)return{error:Xe};if(typeof t!="object")return{error:Vu};if(t.matchUpId)mc=t.matchUpId,em[mc]=e?Me(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(em[i.matchUpId]=e?Me(i):i,mc||(mc=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(em[i.matchUpId]=e?Me(i):i,mc||(mc=i.matchUpId));return e?Me(t):t}function ife(){return em[mc]}function rfe(){return Object.values(em)}function nfe(){mc=void 0,em={}}function afe(t){return Me(em[mc],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}(()=>{let t={getState:n=>afe(n),version:()=>L0(),reset:()=>(nfe(),{...J}),drawId:void 0,error:void 0,success:!1,devContext:n=>(II(n),t),setState:(n,a,o)=>{yI(a,o);let s=DV(n);return e(s)}};function e(n){return n!=null&&n.error?(t.error=n.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=n.drawId),t}return i([FO]),t;function i(n){n.forEach(a=>{Object.keys(a).forEach(o=>{t[o]=s=>{if(Fa())return r({params:s,governor:a,methodName:o});try{return r({params:s,governor:a,methodName:o})}catch(l){tT({engineName:"matchUpEngine",methodName:o,params:s,err:l})}}})})}function r({params:n,governor:a,methodName:o}){t.error=void 0,t.success=!1;let s=(n==null?void 0:n.matchUp)||ife(),l=(n==null?void 0:n.matchUps)||rfe(),u=(n==null?void 0:n.rollbackOnError)&&Me(s,!1,!0);n={...n,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let c=a[o](n);if(c!=null&&c.error)return u&&DV(u),{...c,rolledBack:!!u};let d=(c==null?void 0:c.success)&&(n==null?void 0:n.delayNotify)!==!0&&(n==null?void 0:n.doNotNotify)!==!0;return d&&GD(),(d||!(c!=null&&c.success)||n!=null&&n.doNotNotify)&&Ey(),c}})();var UC=!1;(()=>{let t={version:()=>L0(),setDeepCopy:(r,n)=>(yI(r,n),t),devContext:r=>(II(r),UC=!0,t)};return i([Jk]),t;function e(r,n){let a=r({...n});return a!=null&&a.error||GD(),Ey(),UC&&(II(!1),UC=!1),a}function i(r){r.forEach(n=>{Object.keys(n).forEach(a=>{t[a]=o=>{if(Fa()){let s=e(n[a],o);return!(s!=null&&s.error)&&(o!=null&&o.setState)&&(s!=null&&s.tournamentRecord)&&jI(s.tournamentRecord),s}else try{let s=e(n[a],o);return!(s!=null&&s.error)&&(o!=null&&o.setState)&&(s!=null&&s.tournamentRecord)&&jI(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(o),method:a,error:l})}}})})}})();Sx.importMethods(eG,!0,1);var ofe=Sx,sfe={getTournamentPoints:uD},lfe=sfe,ufe={calculateNewRatings:O3,generateDynamicRatings:k3},cfe=ufe,dfe={...lfe,...cfe};Sx.importMethods(dfe);var i7={};yt(i7,{activeMatchUpStatuses:()=>uA,auditConstants:()=>Upe,completedMatchUpStatuses:()=>gr,directingMatchUpStatuses:()=>Zz,displayConstants:()=>Xde,drawDefinitionConstants:()=>uT,entryStatusConstants:()=>Moe,errorConditionConstants:()=>Nne,eventConstants:()=>Uz,extensionConstants:()=>Gz,flightConstants:()=>Bpe,genderConstants:()=>iT,keyValueConstants:()=>wce,matchUpActionConstants:()=>Oue,matchUpStatusConstants:()=>tW,matchUpTypes:()=>tne,nonDirectingMatchUpStatuses:()=>Qz,particicipantsRequiredMatchUpStatuses:()=>Xz,participantConstants:()=>pW,participantRoles:()=>zA,participantTypes:()=>zv,penaltyConstants:()=>Efe,policyConstants:()=>aoe,positionActionConstants:()=>zle,ratingConstants:()=>oue,recoveryTimeRequiredMatchUpStatuses:()=>voe,requestConstants:()=>Cme,resourceContants:()=>Tae,resultConstants:()=>fne,scaleConstants:()=>toe,scheduleConstants:()=>ise,sortingConstants:()=>Ype,surfaceConstants:()=>xfe,tieFormatConstants:()=>Pae,timeItemConstants:()=>Qoe,topicConstants:()=>yoe,tournamentConstants:()=>O5,upcomingMatchUpStatuses:()=>eW,validMatchUpStatuses:()=>Jz,venueConstants:()=>_fe,weekdayConstants:()=>g4});var pfe="Coaching",mfe="Ball Abuse",hfe="Racket Abuse",ffe="Verbal Abuse",gfe="INELIGIBILITY",vfe="Physical Abuse",Ife="Unsportmanlike Conduct",yfe="Dress Code Violation",bfe="Equipment Violation",wfe="Leaving the court",Ufe="Failure to complete",Sfe="No Show",Tfe="Other",Dfe="REFUSAL_TO_PLAY",Pfe="PROHIBITED_SUBSTANCE",Rfe="Puncuality",Cfe="Failure to sign in",Efe={COACHING:pfe,BALL_ABUSE:mfe,RACKET_ABUSE:hfe,VERBAL_ABUSE:ffe,PHYSICAL_ABUSE:vfe,INELIGIBILITY:gfe,UNSPORTSMANLIKE_CONDUCT:Ife,PROHIBITED_SUBSTANCE:Pfe,DRESS_CODE_VIOLATION:yfe,EQUIMENT_VIOLATION:bfe,LEAVING_THE_COURT:wfe,REFUSAL_TO_PLAY:Dfe,FAILURE_TO_COMPLETE:Ufe,NO_SHOW:Sfe,OTHER:Tfe,PUNCTUALITY:Rfe,FAILUIRE_TO_SIGN_IN:Cfe},Mfe="CLAY",Nfe="HARD",Afe="GRASS",Ofe="CARPET",kfe="ARTIFICIAL",xfe={CLAY:Mfe,HARD:Nfe,GRASS:Afe,CARPET:Ofe,ARTIFICIAL:kfe},Ffe="INDOOR",Lfe="OUTDOOR",_fe={INDOOR:Ffe,OUTDOOR:Lfe};const{AFTER_REST:$fe,FOLLOWED_BY:Bfe,NEXT_AVAILABLE:Vfe,NOT_BEFORE:jfe,TO_BE_ANNOUNCED:Gfe}=i7.timeItemConstants,l1="overlay",Qi="center",PV="header",Dm="right",Hd="left",RV="top",u1="",hU="flex",$s="none",Hfe="buttonBar",CV="roundsColumns",zfe=8,EV="roundsStats",MV="roundsTable",Wfe={[$fe]:"After rest",[Bfe]:"Followed by",[Gfe]:"TBA",[Vfe]:"Next available",[jfe]:"NB"};function ou(t){return typeof t=="function"}function c1(t){return typeof t=="object"&&!Array.isArray(t)}const SC="font-medium";function tm(t){var y;const{target:e,button:i,stateChange:r}=t;let n=0;const a=()=>(n+=1,`Item${n}`),o=document.createElement("div");i.class&&o.classList.add(i.class),o.classList.add("dropdown"),i.id&&(o.id=i.id),i.align===Dm?(o.classList.add("is-right"),o.style.marginLeft="1em"):o.style.marginRight="1em";const s=I=>I.classList.contains("is-active"),l=()=>{s(o)&&o.classList.remove("is-active")},u=I=>{s(I)?I.classList.remove("is-active"):I.classList.add("is-active")};o.onmouseleave=l,o.onclick=()=>u(o);const c=document.createElement("div");c.classList.add("dropdown-trigger");const d=document.createElement("button");d.className="button font-medium",i.intent&&d.classList.add(i.intent),d.setAttribute("aria-haspopup","true");const p=document.createElement("span");ou(i.onClick)&&(p.onclick=i.onClick),p.style.marginRight="1em",p.innerHTML=i.label,d.appendChild(p);const m=document.createElement("span");ou(i.onClick)&&(m.onclick=i.onClick),m.innerHTML=`
      <span class="icon is-small font-medium">
        <i class="fas fa-angle-down font-medium" aria-hidden="true"></i>
      </span>
  `,d.appendChild(m),c.appendChild(d),o.appendChild(c);const h=document.createElement("div");h.classList.add("dropdown-menu"),h.style.zIndex="99998";const f=document.createElement("div");f.classList.add("dropdown-content");const g=()=>{const I=h.querySelectorAll(".dropdown-item");for(const b of Array.from(I))b.classList.remove("is-active")},v=I=>{const b=document.createElement("a");b.className=SC;const S=I.disabled?"0.4":"1";return b.style.textDecoration="none",b.style.opacity=S,I.color&&(b.style.color=I.color),b.classList.add("dropdown-item"),I.isActive&&b.classList.add("is-active"),I.value&&b.setAttribute("value",I.value),I.class&&b.classList.add(I.class),b.onclick=w=>{if(I.disabled)return;I.value&&(d.value=I.value,o.setAttribute("value",I.value)),w.stopPropagation(),ou(I.onClick)&&(ou(r)&&r(),I.onClick(w)),I.close&&l();const U=s(b);g(),U?p.innerHTML=i.label:(i.selection&&u(b),i.modifyLabel&&I.modifyLabel!==!1&&(p.innerHTML=`${i.append?i.label+": ":""}${(I==null?void 0:I.label)||a()}`))},b.innerHTML=(I==null?void 0:I.label)||a(),b};for(const I of i.options||[])if(I.heading){const b=document.createElement("div");b.style.fontWeight="bold",b.classList.add("dropdown-item"),b.classList.add(SC),b.innerHTML=I.heading,f.appendChild(b)}else if(I.divider){const b=document.createElement("hr");b.classList.add("dropdown-divider"),b.classList.add(SC),f.appendChild(b)}else I.hide||f.appendChild(v(I));return(y=i.options)!=null&&y.length&&(i.options[0].value&&o.setAttribute("value",i.options[0].value),h.appendChild(f)),o.appendChild(h),e&&e.appendChild(o),o}function qfe(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}class Ka{constructor(e){this.table=e}reloadData(e,i,r){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,r)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,r){return this.table.deprecationAdvisor.check(e,i,r)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class kr{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,r){var n=e?i.split(e):[i],a=n.length,o;for(let s=0;s<a&&(r=r[n[s]],o=r,!!r);s++);return o}static deepClone(e,i,r=[]){var n={}.__proto__,a=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var o in e){let s=e[o],l,u;s!=null&&typeof s=="object"&&(s.__proto__===n||s.__proto__===a)&&(l=r.findIndex(c=>c.subject===s),l>-1?i[o]=r[l].copy:(u=Object.assign(Array.isArray(s)?[]:{},s),r.unshift({subject:s,copy:u}),i[o]=this.deepClone(s,u,r)))}return i}}let Yfe=class r7 extends Ka{constructor(e,i,r){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=r,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),r=i?e.touches[0].pageX:e.pageX,n=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let a=kr.elOffset(this.container);r-=a.left,n-=a.top}return{x:r,y:n}}elementPositionCoords(e,i="right"){var r=kr.elOffset(e),n,a,o;switch(this.container!==document.body&&(n=kr.elOffset(this.container),r.left-=n.left,r.top-=n.top),i){case"right":a=r.left+e.offsetWidth,o=r.top-1;break;case"bottom":a=r.left,o=r.top+e.offsetHeight;break;case"left":a=r.left,o=r.top-1;break;case"top":a=r.left,o=r.top;break;case"center":a=r.left+e.offsetWidth/2,o=r.top+e.offsetHeight/2;break}return{x:a,y:o,offset:r}}show(e,i){var r,n,a,o,s;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(a=e,s=this.elementPositionCoords(e,i),o=s.offset,r=s.x,n=s.y):typeof e=="number"?(o={top:0,left:0},r=e,n=i):(s=this.containerEventCoords(e),r=s.x,n=s.y,this.reversedX=!1),this.element.style.top=n+"px",this.element.style.left=r+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(r,n,a,o,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,r,n,a){var o=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;(e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",r?this.element.style.right=this.container.offsetWidth-n.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0);let s=Math.max(this.container.offsetHeight,o?this.container.scrollHeight:0);if(i+this.element.offsetHeight>s)if(r)switch(a){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-r.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+r.offsetHeight+1+"px"}else this.element.style.height=s+"px"}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new r7(this.table,e,this),this.childPopup}};class ui extends Ka{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...r)=>(this.table.initGuard(e),i(...r)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,r){return this.table.componentFunctionBinder.bind(e,i,r)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,r;if(this._handler&&(r=this.table.rowManager.displayPipeline.findIndex(n=>n.handler===this._handler),r>-1&&(i=r)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new Yfe(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}}var Kfe={rownum:function(t,e,i,r,n,a){return a.getPosition()}};const df=class df extends ui{constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="accessor"+(n.charAt(0).toUpperCase()+n.slice(1)),o;e.definition[a]&&(o=this.lookupAccessor(e.definition[a]),o&&(i=!0,r[a]={accessor:o,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.accessor=r)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":df.accessors[e]?i=df.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var r="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),n=e.getComponent(),a=kr.deepClone(e.data||{});return this.table.columnManager.traverse(function(o){var s,l,u,c;o.modules.accessor&&(l=o.modules.accessor[r]||o.modules.accessor.accessor||!1,l&&(s=o.getFieldValue(a),s!="undefined"&&(c=o.getComponent(),u=typeof l.params=="function"?l.params(s,a,i,c,n):l.params,o.setFieldValue(a,l.accessor(s,a,i,u,c,n)))))}),a}};Ve(df,"moduleName","accessor"),Ve(df,"accessors",Kfe);let d1=df;var Xfe={method:"GET"};function p1(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(p1(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(p1(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}function Jfe(t){var e=p1(t),i=[];return e.forEach(function(r){i.push(encodeURIComponent(r.key)+"="+encodeURIComponent(r.value))}),i.join("&")}function n7(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+Jfe(i)),t}function Zfe(t,e,i){var r;return new Promise((n,a)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(r=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],r){for(var o in r.headers)e.headers||(e.headers={}),typeof e.headers[o]>"u"&&(e.headers[o]=r.headers[o]);e.body=r.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(s=>{s.ok?s.json().then(l=>{n(l)}).catch(l=>{a(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+s.status,s.statusText),a(s))}).catch(s=>{console.error("Ajax Load Error - Connection Error: ",s),a(s)})):(console.warn("Ajax Load Error - No URL Set"),n([]))})}function m1(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(m1(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(m1(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}var Qfe={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var r=m1(i),n=new FormData;return r.forEach(function(a){n.append(a.key,a.value)}),n}}};const Sl=class Sl extends ui{constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=Sl.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||Sl.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||Sl.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,r,n){var a=this.table.options.ajaxParams;return a&&(typeof a=="function"&&(a=a.call(this.table)),n=Object.assign(Object.assign({},a),n)),n}requestDataCheck(e,i,r,n){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,r,n,a){var o;return!a&&this.requestDataCheck(e)?(e&&this.setUrl(e),o=this.generateConfig(r),this.sendRequest(this.url,i,o)):a}setDefaultConfig(e={}){this.config=Object.assign({},Sl.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,r){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,r,i).then(n=>(this.table.options.ajaxResponse&&(n=this.table.options.ajaxResponse.call(this.table,e,i,n)),n)):Promise.reject()}};Ve(Sl,"moduleName","ajax"),Ve(Sl,"defaultConfig",Xfe),Ve(Sl,"defaultURLGenerator",n7),Ve(Sl,"defaultLoaderPromise",Zfe),Ve(Sl,"contentTypeFormatters",Qfe);let h1=Sl;var ege={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)}},tge={table:function(t){var e=[],i=!0,r=this.table.columnManager.columns,n=[],a=[];return t=t.split(`
`),t.forEach(function(o){e.push(o.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(o){var s=r.find(function(l){return o&&l.definition.title&&o.trim()&&l.definition.title.trim()===o.trim()});s?n.push(s):i=!1}),i||(i=!0,n=[],e[0].forEach(function(o){var s=r.find(function(l){return o&&l.field&&o.trim()&&l.field.trim()===o.trim()});s?n.push(s):i=!1}),i||(n=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(o){var s={};o.forEach(function(l,u){n[u]&&(s[n[u].field]=l)}),a.push(s)}),a):!1}},ige={copyToClipboard:["ctrl + 67","meta + 67"]},rge={copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}},nge={keybindings:{bindings:ige,actions:rge}};const gd=class gd extends ui{constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,r,n;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(n=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),r=this.table.modules.export.generateHTMLTable(n),i=r?this.generatePlainContent(n):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),r=this.table.options.clipboardCopyFormatter("html",r))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),r&&e.clipboardData.setData("text/html",r)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),r&&e.originalEvent.clipboardData.setData("text/html",r)),this.dispatchExternal("clipboardCopied",i,r),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(r=>{var n=[];r.columns.forEach(a=>{var o="";if(a)if(r.type==="group"&&(a.value=a.component.getKey()),a.value===null)o="";else switch(typeof a.value){case"object":o=JSON.stringify(a.value);break;case"undefined":o="";break;default:o=a.value}n.push(o)}),i.push(n.join("	"))}),i.join(`
`)}copy(e,i){var r,n;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),r=window.getSelection(),r.toString()&&i&&(this.customSelection=r.toString()),r.removeAllRanges(),r.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(n=document.body.createTextRange(),n.moveToElementText(this.table.element),n.select()),document.execCommand("copy"),r&&r.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=gd.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=gd.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,r,n;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),r=this.pasteParser.call(this,i),r?(e.preventDefault(),this.table.modExists("mutator")&&(r=this.mutateData(r)),n=this.pasteAction.call(this,r),this.dispatchExternal("clipboardPasted",i,r,n)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(r=>{i.push(this.table.modules.mutator.transformRow(r,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,r=this.confirm("clipboard-paste",[e]);return(r||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}};Ve(gd,"moduleName","clipboard"),Ve(gd,"moduleExtensions",nge),Ve(gd,"pasteActions",ege),Ve(gd,"pasteParsers",tge);let f1=gd;class age{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class a7{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,r)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class _b extends Ka{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var e=this.element,i=this.column.getField(),r={top:"flex-start",bottom:"flex-end",middle:"center"},n={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=r[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=n[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var a=this.column.definition.cssClass.split(" ");a.forEach(o=>{e.classList.add(o)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,r){var n=this.setValueProcessData(e,i,r);n&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,r){var n=!1;return(this.value!==e||r)&&(n=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),n&&this.dispatch("cell-value-changed",this),n}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new a7(this)),this.component}}class o7{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._column.table.componentFunctionBinder.handle("column",i._column,r)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var r=this._column.table.columnManager.findColumn(e);r?this._column.table.columnManager.moveColumn(this._column,r,i):console.warn("Move Error - No matching column found:",r)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var s7={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};const Vp=class Vp extends Ka{constructor(e,i,r){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=r,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((n,a)=>{var o=new Vp(n,this);this.attachColumn(o)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.isRowHeader&&e.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(Vp.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{Vp.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(r=>{this.element.classList.add(r)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var r=document.createElement("input");r.classList.add("tabulator-title-editor"),r.addEventListener("click",n=>{n.stopPropagation(),r.focus()}),r.addEventListener("mousedown",n=>{n.stopPropagation()}),r.addEventListener("change",()=>{e.title=r.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(r),e.field?this.langBind("columns|"+e.field,n=>{r.value=n||e.title||"&nbsp;"}):r.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,n=>{this._formatColumnHeaderTitle(i,n||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var r=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof r){case"object":r instanceof Node?e.appendChild(r):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",r));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=r}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,r=this.fieldStructure,n=r.length,a;for(let o=0;o<n&&(i=i[r[o]],a=i,!!i);o++);return a}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var r=e,n=this.fieldStructure,a=n.length;for(let o=0;o<a;o++)if(o==a-1)r[n[o]]=i;else{if(!r[n[o]])if(typeof i<"u")r[n[o]]={};else break;r=r[n[o]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var r=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=r+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=r-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(n){n.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(r){i.push(r.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(n){n.delete()}),this.dispatch("column-delete",this);var r=this.cells.length;for(let n=0;n<r;n++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new _b(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(n=>{n.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(n=>{var a=n.getWidth();a>i&&(i=a)}),i)){var r=i+1;this.maxInitialWidth&&!e&&(r=Math.min(r,this.maxInitialWidth)),this.setWidthActual(r)}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(r=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>r.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new o7(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof Vp?this.parent.getComponent():!1}};Ve(Vp,"defaultOptionList",s7);let im=Vp;class HD{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class io extends Ka{constructor(e,i,r="row"){super(i.table),this.parent=i,this.data={},this.type=r,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,r=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(r=this.calcMinHeight(),i=this.calcMaxHeight(),e?this.height=Math.max(i,r):this.height=this.manualHeight?this.height:Math.max(i,r)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var e=0;return this.cells.forEach(function(i){var r=i.getHeight();r>e&&(e=r)}),e}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&kr.elVisible(this.element),r={},n;return new Promise((a,o)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(r=Object.assign(r,this.data),r=Object.assign(r,e)),n=this.chain("row-data-changing",[this,r,e],null,e);for(let s in n)this.data[s]=n[s];this.dispatch("row-data-save-after",this);for(let s in e)this.table.columnManager.getColumnsByFieldRoot(s).forEach(u=>{let c=this.getCell(u.getField());if(c){let d=u.getFieldValue(n);c.getValue()!==d&&(c.setValueProcessData(d),i&&c.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),a()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(r){return r.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var r=this.table.rowManager.findRow(e);r?(this.table.rowManager.moveRowActual(this,r,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new HD(this)),this.component}}var oge={avg:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:2;return t.length&&(r=t.reduce(function(a,o){return Number(a)+Number(o)}),r=r/t.length,r=n!==!1?r.toFixed(n):r),parseFloat(r).toString()},max:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a>r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},min:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a<r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},sum:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(a){a=Number(a),r+=isNaN(a)?0:Number(a)}),n!==!1?r.toFixed(n):r},concat:function(t,e,i){var r=0;return t.length&&(r=t.reduce(function(n,a){return String(n)+String(a)})),r},count:function(t,e,i){var r=0;return t.length&&t.forEach(function(n){n&&r++}),r},unique:function(t,e,i){var r=t.filter((n,a)=>(t||n===0)&&t.indexOf(n)===a);return r.length}};const vd=class vd extends ui{constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new im({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,r={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":vd.calculations[i.topCalc]?r.topCalc=vd.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":r.topCalc=i.topCalc;break}r.topCalc&&(e.modules.columnCalcs=r,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":vd.calculations[i.bottomCalc]?r.botCalc=vd.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":r.botCalc=i.bottomCalc;break}r.botCalc&&(e.modules.columnCalcs=r,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,r;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),r=this.generateRow("top",i),this.topRow=r;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(r.getElement()),r.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),r=this.generateRow("bottom",i),this.botRow=r;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(r.getElement()),r.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,r;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),r=this.generateRowData("bottom",i),e.calcs.bottom.updateData(r),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),r=this.generateRowData("top",i),e.calcs.top.updateData(r),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[],r=this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs,n=this.table.modules.dataTree;return e.forEach(a=>{var o;i.push(a.getData()),r&&((o=a.modules.dataTree)!=null&&o.open)&&this.rowsToData(n.getFilteredTreeChildren(a)).forEach(s=>{i.push(a)})}),i}generateRow(e,i){var r=this.generateRowData(e,i),n;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),n=new io(r,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),n.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),n.component=!1,n.getComponent=()=>(n.component||(n.component=new age(n)),n.component),n.generateCells=()=>{var a=[];this.table.columnManager.columnsByIndex.forEach(o=>{this.genColumn.setField(o.getField()),this.genColumn.hozAlign=o.hozAlign,o.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter(o.definition[e+"CalcFormatter"]),params:o.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=o.definition.cssClass;var s=new _b(this.genColumn,n);s.getElement(),s.column=o,s.setWidth(),o.cells.push(s),a.push(s),o.visible||s.hide()}),n.cells=a},n}generateRowData(e,i){var r={},n=e=="top"?this.topCalcs:this.botCalcs,a=e=="top"?"topCalc":"botCalc",o,s;return n.forEach(function(l){var u=[];l.modules.columnCalcs&&l.modules.columnCalcs[a]&&(i.forEach(function(c){u.push(l.getFieldValue(c))}),s=a+"Params",o=typeof l.modules.columnCalcs[s]=="function"?l.modules.columnCalcs[s](u,i):l.modules.columnCalcs[s],l.setFieldValue(r,l.modules.columnCalcs[a](u,i,o)))}),r}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(r=>{e[r.getKey()]=this.getGroupResults(r)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),r=e.getSubGroups(),n={},a={};return r.forEach(o=>{n[o.getKey()]=this.getGroupResults(o)}),a={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:n},a}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}};Ve(vd,"moduleName","columnCalcs"),Ve(vd,"calculations",oge);let g1=vd;class l7 extends ui{constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(r,n){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(r,n){return i.dataTreeStartExpanded[n]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(r=>{this.reinitializeRowChildren(r)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,r){this.redrawNeeded(r)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],r=Array.isArray(i),n=r||!r&&typeof i=="object"&&i!==null;!n&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!n&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:n?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&n?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&n?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:n}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(r){r.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],r=i.getElement(),n=e.modules.dataTree;n.branchEl&&(n.branchEl.parentNode&&n.branchEl.parentNode.removeChild(n.branchEl),n.branchEl=!1),n.controlEl&&(n.controlEl.parentNode&&n.controlEl.parentNode.removeChild(n.controlEl),n.controlEl=!1),this.generateControlElement(e,r),e.getElement().classList.add("tabulator-tree-level-"+n.index),n.index&&(this.branchEl?(n.branchEl=this.branchEl.cloneNode(!0),r.insertBefore(n.branchEl,r.firstChild),this.table.rtl?n.branchEl.style.marginRight=(n.branchEl.offsetWidth+n.branchEl.style.marginLeft)*(n.index-1)+n.index*this.indent+"px":n.branchEl.style.marginLeft=(n.branchEl.offsetWidth+n.branchEl.style.marginRight)*(n.index-1)+n.index*this.indent+"px"):this.table.rtl?r.style.paddingRight=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-right"))+n.index*this.indent+"px":r.style.paddingLeft=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-left"))+n.index*this.indent+"px")}generateControlElement(e,i){var r=e.modules.dataTree,n=r.controlEl;i=i||e.getCells()[0].getElement(),r.children!==!1&&(r.open?(r.controlEl=this.collapseEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.collapseRow(e)})):(r.controlEl=this.expandEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.expandRow(e)})),r.controlEl.addEventListener("mousedown",a=>{a.stopPropagation()}),n&&n.parentNode===i?n.parentNode.replaceChild(r.controlEl,n):i.insertBefore(r.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((r,n)=>{var a,o;i.push(r),r instanceof io&&(r.create(),a=r.modules.dataTree,!a.index&&a.children!==!1&&(o=this.getChildren(r,!1,!0),o.forEach(s=>{s.create(),i.push(s)})))}),i}getChildren(e,i,r){var n=e.modules.dataTree,a=[],o=[];return n.children!==!1&&(n.open||i)&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?a=this.table.modules.filter.filter(n.children):a=n.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(a,r),a.forEach(s=>{o.push(s);var l=this.getChildren(s,!1,!0);l.forEach(u=>{o.push(u)})})),o}generateChildren(e){var i=[],r=e.getData()[this.field];return Array.isArray(r)||(r=[r]),r.forEach(n=>{var a=new io(n||{},this.table.rowManager);a.create(),a.modules.dataTree.index=e.modules.dataTree.index+1,a.modules.dataTree.parent=e,a.modules.dataTree.children&&(a.modules.dataTree.open=this.startOpen(a.getComponent(),a.modules.dataTree.index)),i.push(a)}),i}expandRow(e,i){var r=e.modules.dataTree;r.children!==!1&&(r.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,r=[],n;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?n=this.table.modules.filter.filter(i.children):n=i.children,n.forEach(a=>{a instanceof io&&r.push(a)})),r}rowDelete(e){var i=e.modules.dataTree.parent,r;i&&(r=this.findChildIndex(e,i),r!==!1&&i.data[this.field].splice(r,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,r,n){var a=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof n<"u"&&(a=this.findChildIndex(n,e),a!==!1&&e.data[this.field].splice(r?a:a+1,0,i)),a===!1&&(r?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var r=!1;return typeof e=="object"?e instanceof io?r=e.data:e instanceof HD?r=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(r=i.modules.dataTree.children.find(n=>n instanceof io?n.element===e:!1),r&&(r=r.data)):e===null&&(r=!1):typeof e>"u"?r=!1:r=i.data[this.field].find(n=>n.data[this.table.options.index]==e),r&&(Array.isArray(i.data[this.field])&&(r=i.data[this.field].indexOf(r)),r==-1&&(r=!1)),r}getTreeChildren(e,i,r){var n=e.modules.dataTree,a=[];return n&&n.children&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),n.children.forEach(o=>{o instanceof io&&(a.push(i?o.getComponent():o),r&&this.getTreeChildren(o,i,r).forEach(s=>{a.push(s)}))})),a}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}Ve(l7,"moduleName","dataTree");function sge(t,e={},i){var r=e.delimiter?e.delimiter:",",n=[],a=[];t.forEach(o=>{var s=[];switch(o.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":o.columns.forEach((l,u)=>{l&&l.depth===1&&(a[u]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":o.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}s.push('"'+String(l.value).split('"').join('""')+'"')}}),n.push(s.join(r));break}}),a.length&&n.unshift(a.join(r)),n=n.join(`
`),e.bom&&(n="\uFEFF"+n),i(n,"text/csv")}function lge(t,e,i){var r=[];t.forEach(n=>{var a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(o=>{o&&(a[o.component.getTitleDownload()||o.component.getField()]=o.value)}),r.push(a);break}}),r=JSON.stringify(r,null,"	"),i(r,"application/json")}function uge(t,e={},i){var r=[],n=[],a={},o=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},s=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},u=e.title?e.title:"";l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(p=>{switch(p.type){case"header":r.push(c(p));break;case"group":n.push(c(p,o));break;case"calc":n.push(c(p,s));break;case"row":n.push(c(p));break}});function c(p,m){var h=[];return p.columns.forEach(f=>{var g;if(f){switch(typeof f.value){case"object":f.value=f.value!==null?JSON.stringify(f.value):"";break;case"undefined":f.value="";break}g={content:f.value,colSpan:f.width,rowSpan:f.height},m&&(g.styles=m),h.push(g)}}),h}var d=new jspdf.jsPDF(l);e.autoTable&&(typeof e.autoTable=="function"?a=e.autoTable(d)||{}:a=e.autoTable),u&&(a.didDrawPage=function(p){d.text(u,40,30)}),a.head=r,a.body=n,d.autoTable(a),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function cge(t,e,i){var r=this,n=e.sheetName||"Sheet1",a=XLSX.utils.book_new(),o=new Ka(this),s="compress"in e?e.compress:!0,l=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:s},u;l.type="binary",a.SheetNames=[],a.Sheets={};function c(){var m=[],h=[],f={},g={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((v,y)=>v+(y&&y.width?y.width:1),0):0,r:t.length}};return t.forEach((v,y)=>{var I=[];v.columns.forEach(function(b,S){b?(I.push(!(b.value instanceof Date)&&typeof b.value=="object"?JSON.stringify(b.value):b.value),(b.width>1||b.height>-1)&&(b.height>1||b.width>1)&&h.push({s:{r:y,c:S},e:{r:y+b.height-1,c:S+b.width-1}})):I.push("")}),m.push(I)}),XLSX.utils.sheet_add_aoa(f,m),f["!ref"]=XLSX.utils.encode_range(g),h.length&&(f["!merges"]=h),f}if(e.sheetOnly){i(c());return}if(e.sheets)for(var d in e.sheets)e.sheets[d]===!0?(a.SheetNames.push(d),a.Sheets[d]=c()):(a.SheetNames.push(d),o.commsSend(e.sheets[d],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:r.active,intercept:function(m){a.Sheets[d]=m}}));else a.SheetNames.push(n),a.Sheets[n]=c();e.documentProcessing&&(a=e.documentProcessing(a));function p(m){for(var h=new ArrayBuffer(m.length),f=new Uint8Array(h),g=0;g!=m.length;++g)f[g]=m.charCodeAt(g)&255;return h}u=XLSX.write(a,l),i(p(u),"application/octet-stream")}function dge(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function pge(t,e,i){const r=[];t.forEach(n=>{const a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(o=>{o&&(a[o.component.getTitleDownload()||o.component.getField()]=o.value)}),r.push(JSON.stringify(a));break}}),i(r.join(`
`),"application/x-ndjson")}var mge={csv:sge,json:lge,jsonLines:pge,pdf:uge,xlsx:cge,html:dge};const pf=class pf extends ui{constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,r){return new Blob([i],{type:r})}),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){}downloadToTab(e,i,r,n){this.download(e,i,r,n,!0)}download(e,i,r,n,a){var o=!1;function s(u,c){a?a===!0?this.triggerDownload(u,c,e,i,!0):a(u):this.triggerDownload(u,c,e,i)}if(typeof e=="function"?o=e:pf.downloaders[e]?o=pf.downloaders[e]:console.warn("Download Error - No such download type found: ",e),o){var l=this.generateExportList(n);o.call(this.table,l,r||{},s.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),r=this.table.options.groupHeaderDownload;return r&&!Array.isArray(r)&&(r=[r]),i.forEach(n=>{var a;n.type==="group"&&(a=n.columns[0],r&&r[n.indent]&&(a.value=r[n.indent](a.value,n.component._group.getRowCount(),n.component._group.getData(),n.component)))}),i}triggerDownload(e,i,r,n,a){var o=document.createElement("a"),s=this.table.options.downloadEncoder(e,i);s&&(a?window.open(window.URL.createObjectURL(s)):(n=n||"Tabulator."+(typeof r=="function"?"txt":r),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(s,n):(o.setAttribute("href",window.URL.createObjectURL(s)),o.setAttribute("download",n),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,r){switch(i){case"intercept":this.download(r.type,"",r.options,r.active,r.intercept);break}}};Ve(pf,"moduleName","download"),Ve(pf,"downloaders",mge);let v1=pf;function zD(t,e){var i=e.mask,r=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",n=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",a=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function o(s){var l=i[s];typeof l<"u"&&l!==a&&l!==r&&l!==n&&(t.value=t.value+""+l,o(s+1))}t.addEventListener("keydown",s=>{var l=t.value.length,u=s.key;if(s.keyCode>46&&!s.ctrlKey&&!s.metaKey){if(l>=i.length)return s.preventDefault(),s.stopPropagation(),!1;switch(i[l]){case r:if(u.toUpperCase()==u.toLowerCase())return s.preventDefault(),s.stopPropagation(),!1;break;case n:if(isNaN(u))return s.preventDefault(),s.stopPropagation(),!1;break;case a:break;default:if(u!==i[l])return s.preventDefault(),s.stopPropagation(),!1}}}),t.addEventListener("keyup",s=>{s.keyCode>46&&e.maskAutoFill&&o(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&o(t.value.length)}function hge(t,e,i,r,n){var a=t.getValue(),o=document.createElement("input");if(o.setAttribute("type",n.search?"search":"text"),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+n.elementAttributes["+"+l])):o.setAttribute(l,n.elementAttributes[l]);o.value=typeof a<"u"?a:"",e(function(){t.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%",n.selectContents&&o.select())});function s(l){(a===null||typeof a>"u")&&o.value!==""||o.value!==a?i(o.value)&&(a=o.value):r()}return o.addEventListener("change",s),o.addEventListener("blur",s),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:r();break;case 35:case 36:l.stopPropagation();break}}),n.mask&&zD(o,n),o}function fge(t,e,i,r,n){var a=t.getValue(),o=n.verticalNavigation||"hybrid",s=String(a!==null&&typeof a<"u"?a:""),l=document.createElement("textarea"),u=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+n.elementAttributes["+"+d])):l.setAttribute(d,n.elementAttributes[d]);l.value=s,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),n.selectContents&&l.select())});function c(d){(a===null||typeof a>"u")&&l.value!==""||l.value!==a?(i(l.value)&&(a=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):r()}return l.addEventListener("change",c),l.addEventListener("blur",c),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=u&&(u=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&n.shiftEnterSubmit&&c();break;case 27:r();break;case 38:(o=="editor"||o=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(o=="editor"||o=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),n.mask&&zD(l,n),l}function gge(t,e,i,r,n){var a=t.getValue(),o=n.verticalNavigation||"editor",s=document.createElement("input");if(s.setAttribute("type","number"),typeof n.max<"u"&&s.setAttribute("max",n.max),typeof n.min<"u"&&s.setAttribute("min",n.min),typeof n.step<"u"&&s.setAttribute("step",n.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let c in n.elementAttributes)c.charAt(0)=="+"?(c=c.slice(1),s.setAttribute(c,s.getAttribute(c)+n.elementAttributes["+"+c])):s.setAttribute(c,n.elementAttributes[c]);s.value=a;var l=function(c){u()};e(function(){t.getType()==="cell"&&(s.removeEventListener("blur",l),s.focus({preventScroll:!0}),s.style.height="100%",s.addEventListener("blur",l),n.selectContents&&s.select())});function u(){var c=s.value;!isNaN(c)&&c!==""&&(c=Number(c)),c!==a?i(c)&&(a=c):r()}return s.addEventListener("keydown",function(c){switch(c.keyCode){case 13:u();break;case 27:r();break;case 38:case 40:o=="editor"&&(c.stopImmediatePropagation(),c.stopPropagation());break;case 35:case 36:c.stopPropagation();break}}),n.mask&&zD(s,n),s}function vge(t,e,i,r,n){var a=t.getValue(),o=document.createElement("input");if(o.setAttribute("type","range"),typeof n.max<"u"&&o.setAttribute("max",n.max),typeof n.min<"u"&&o.setAttribute("min",n.min),typeof n.step<"u"&&o.setAttribute("step",n.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+n.elementAttributes["+"+l])):o.setAttribute(l,n.elementAttributes[l]);o.value=a,e(function(){t.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%")});function s(){var l=o.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=a?i(l)&&(a=l):r()}return o.addEventListener("blur",function(l){s()}),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:r();break}}),o}function Ige(t,e,i,r,n){var a=n.format,o=n.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l=t.getValue(),u=document.createElement("input");function c(p){var m;return s.isDateTime(p)?m=p:a==="iso"?m=s.fromISO(String(p)):m=s.fromFormat(String(p),a),m.toFormat("yyyy-MM-dd")}if(u.type="date",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.max&&u.setAttribute("max",a?c(n.max):n.max),n.min&&u.setAttribute("min",a?c(n.min):n.min),n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+n.elementAttributes["+"+p])):u.setAttribute(p,n.elementAttributes[p]);l=typeof l<"u"?l:"",a&&(s?l=c(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=l,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select())});function d(){var p=u.value,m;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&a)switch(m=s.fromFormat(String(p),"yyyy-MM-dd"),a){case!0:p=m;break;case"iso":p=m.toISO();break;default:p=m.toFormat(a)}i(p)&&(l=u.value)}else r()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function yge(t,e,i,r,n){var a=n.format,o=n.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l,u=t.getValue(),c=document.createElement("input");if(c.type="time",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(s?(s.isDateTime(u)?l=u:a==="iso"?l=s.fromISO(String(u)):l=s.fromFormat(String(u),a),u=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()=="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,m;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(m=s.fromFormat(String(p),"hh:mm"),a){case!0:p=m;break;case"iso":p=m.toISO();break;default:p=m.toFormat(a)}i(p)&&(u=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function bge(t,e,i,r,n){var a=n.format,o=n.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l,u=t.getValue(),c=document.createElement("input");if(c.type="datetime-local",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(s?(s.isDateTime(u)?l=u:a==="iso"?l=s.fromISO(String(u)):l=s.fromFormat(String(u),a),u=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,m;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(m=s.fromISO(String(p)),a){case!0:p=m;break;case"iso":p=m.toISO();break;default:p=m.toFormat(a)}i(p)&&(u=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}let wge=class{constructor(e,i,r,n,a,o){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(o),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:n,cancel:a},this._deprecatedOptionsCheck(),this._initializeValue(),r(this._onRendered.bind(this))}_deprecatedOptionsCheck(){}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(r){r.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let r in e)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,i.getAttribute(r)+e["+"+r])):i.setAttribute(r,e[r]);return this.params.mask&&zD(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],r;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",r=Object.keys(e).filter(n=>i.includes(n)).length,r?r>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var r=this.displayItems.find(n=>typeof n.label<"u"&&n.label.toLowerCase().startsWith(this.filterTerm));r&&this._focusItem(r),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],r=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(n=>this.listIteration===r?this._parseList(n):Promise.reject(r))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var r=this.params.filterRemote?{term:i}:{};return e=n7(e,{},r),fetch(e).then(n=>n.ok?n.json().catch(a=>(console.warn("List Ajax Load Error - Invalid JSON returned",a),Promise.reject(a))):(console.error("List Ajax Load Error - Connection Error: "+n.status,n.statusText),Promise.reject(n))).catch(n=>(console.error("List Ajax Load Error - Connection Error: ",n),Promise.reject(n)))}_uniqueColumnValues(e){var i={},r=this.table.getData(this.params.valuesLookup),n;return e?n=this.table.columnManager.getColumnByField(e):n=this.cell.getColumn()._getSelf(),n?r.forEach(a=>{var o=n.getFieldValue(a);o!==null&&typeof o<"u"&&o!==""&&(i[o]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([r,n])=>({label:n,value:r}))),e.forEach(r=>{typeof r!="object"&&(r={label:r,value:r}),this._parseListItem(r,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,r){var n={};e.options?n=this._parseListGroup(e,r+1):(n={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:r,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(n,!0)),i.push(n)}_parseListGroup(e,i){var r={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(n=>{this._parseListItem(n,r.options,i)}),r}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((r,n)=>e(r.label,n.label,r.value,n.value,r.original,n.original)),i.forEach(r=>{r.group&&this._sortGroup(e,r.options)})}_defaultSortFunction(e,i){var r,n,a,o,s=0,l,u=/(\d+)|(\D+)/g,c=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(r=String(e).toLowerCase(),n=String(i).toLowerCase(),r===n)return 0;if(!(c.test(r)&&c.test(n)))return r>n?1:-1;for(r=r.match(u),n=n.match(u),l=r.length>n.length?n.length:r.length;s<l;)if(a=r[s],o=n[s++],a!==o)return isFinite(a)&&isFinite(o)?(a.charAt(0)==="0"&&(a="."+a),o.charAt(0)==="0"&&(o="."+o),a-o):a>o?1:-1;return r.length>n.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(r=>{this._filterItem(e,i,r)})):this.filtered=!1,this.data}_filterItem(e,i,r){var n=!1;return r.group?(r.options.forEach(a=>{this._filterItem(e,i,a)&&(n=!0)}),r.visible=n):r.visible=e(i,r.label,r.value,r.original),r.visible}_defaultFilterFunc(e,i,r,n){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(r).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,r;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,r=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,r instanceof HTMLElement?i.appendChild(r):i.innerHTML=r,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let n in e.elementAttributes)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,this.input.getAttribute(n)+e.elementAttributes["+"+n])):i.setAttribute(n,e.elementAttributes[n]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(n=>{this._buildItem(n)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var r;this.typing=!1,this.params.multiselect?(r=this.currentItems.indexOf(e),r>-1?(this.currentItems.splice(r,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(n=>n.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,r;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(n=>n.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(r=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,r===null||typeof r>"u"||r===""?i=r:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}};function Uge(t,e,i,r,n){var a=new wge(this,t,e,i,r,n);return a.input}function Sge(t,e,i,r,n){var a=this,o=t.getElement(),s=t.getValue(),l=o.getElementsByTagName("svg").length||5,u=o.getElementsByTagName("svg")[0]?o.getElementsByTagName("svg")[0].getAttribute("width"):14,c=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function m(v){c.forEach(function(y,I){I<v?(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-active"):y.classList.replace("tabulator-star-inactive","tabulator-star-active"),y.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-inactive"):y.classList.replace("tabulator-star-active","tabulator-star-inactive"),y.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function h(v){var y=document.createElement("span"),I=p.cloneNode(!0);c.push(I),y.addEventListener("mouseenter",function(b){b.stopPropagation(),b.stopImmediatePropagation(),m(v)}),y.addEventListener("mousemove",function(b){b.stopPropagation(),b.stopImmediatePropagation()}),y.addEventListener("click",function(b){b.stopPropagation(),b.stopImmediatePropagation(),i(v),o.blur()}),y.appendChild(I),d.appendChild(y)}function f(v){s=v,m(v)}if(o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",u),p.setAttribute("height",u),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",n.elementAttributes&&typeof n.elementAttributes=="object")for(let v in n.elementAttributes)v.charAt(0)=="+"?(v=v.slice(1),d.setAttribute(v,d.getAttribute(v)+n.elementAttributes["+"+v])):d.setAttribute(v,n.elementAttributes[v]);for(var g=1;g<=l;g++)h(g);return s=Math.min(parseInt(s),l),m(s),d.addEventListener("mousemove",function(v){m(0)}),d.addEventListener("click",function(v){i(0)}),o.addEventListener("blur",function(v){r()}),o.addEventListener("keydown",function(v){switch(v.keyCode){case 39:f(s+1);break;case 37:f(s-1);break;case 13:i(s);break;case 27:r();break}}),d}function Tge(t,e,i,r,n){var a=t.getElement(),o=typeof n.max>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("max")||100:n.max,s=typeof n.min>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("min")||0:n.min,l=(o-s)/100,u=t.getValue()||0,c=document.createElement("div"),d=document.createElement("div"),p,m;function h(){var f=window.getComputedStyle(a,null),g=l*Math.round(d.offsetWidth/((a.clientWidth-parseInt(f.getPropertyValue("padding-left"))-parseInt(f.getPropertyValue("padding-right")))/100))+s;i(g),a.setAttribute("aria-valuenow",g),a.setAttribute("aria-label",u)}if(c.style.position="absolute",c.style.right="0",c.style.top="0",c.style.bottom="0",c.style.width="5px",c.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",n.elementAttributes&&typeof n.elementAttributes=="object")for(let f in n.elementAttributes)f.charAt(0)=="+"?(f=f.slice(1),d.setAttribute(f,d.getAttribute(f)+n.elementAttributes["+"+f])):d.setAttribute(f,n.elementAttributes[f]);return a.style.padding="4px 4px",u=Math.min(parseFloat(u),o),u=Math.max(parseFloat(u),s),u=Math.round((u-s)/l),d.style.width=u+"%",a.setAttribute("aria-valuemin",s),a.setAttribute("aria-valuemax",o),d.appendChild(c),c.addEventListener("mousedown",function(f){p=f.screenX,m=d.offsetWidth}),c.addEventListener("mouseover",function(){c.style.cursor="ew-resize"}),a.addEventListener("mousemove",function(f){p&&(d.style.width=m+f.screenX-p+"px")}),a.addEventListener("mouseup",function(f){p&&(f.stopPropagation(),f.stopImmediatePropagation(),p=!1,m=!1,h())}),a.addEventListener("keydown",function(f){switch(f.keyCode){case 39:f.preventDefault(),d.style.width=d.clientWidth+a.clientWidth/100+"px";break;case 37:f.preventDefault(),d.style.width=d.clientWidth-a.clientWidth/100+"px";break;case 9:case 13:h();break;case 27:r();break}}),a.addEventListener("blur",function(){r()}),d}function Dge(t,e,i,r,n){var a=t.getValue(),o=document.createElement("input"),s=n.tristate,l=typeof n.indeterminateValue>"u"?null:n.indeterminateValue,u=!1,c=Object.keys(n).includes("trueValue"),d=Object.keys(n).includes("falseValue");if(o.setAttribute("type","checkbox"),o.style.marginTop="5px",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let m in n.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),o.setAttribute(m,o.getAttribute(m)+n.elementAttributes["+"+m])):o.setAttribute(m,n.elementAttributes[m]);o.value=a,s&&(typeof a>"u"||a===l||a==="")&&(u=!0,o.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&o.focus({preventScroll:!0})}),o.checked=c?a===n.trueValue:a===!0||a==="true"||a==="True"||a===1;function p(m){var h=o.checked;return c&&h?h=n.trueValue:d&&!h&&(h=n.falseValue),s?m?u?l:h:o.checked&&!u?(o.checked=!1,o.indeterminate=!0,u=!0,l):(u=!1,h):h}return o.addEventListener("change",function(m){i(p())}),o.addEventListener("blur",function(m){i(p(!0))}),o.addEventListener("keydown",function(m){m.keyCode==13&&i(p()),m.keyCode==27&&r()}),o}var Pge={input:hge,textarea:fge,number:gge,range:vge,date:Ige,time:yge,datetime:bge,list:Uge,star:Sge,progress:Tge,tickCross:Dge};const dI=class dI extends ui{constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.convertEmptyValues=!1,this.editors=dI.editors,this.registerTableOption("editTriggerEvent","focus"),this.registerTableOption("editorEmptyValue"),this.registerTableOption("editorEmptyValueFunc",this.emptyValueCheck.bind(this)),this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("editorEmptyValue"),this.registerColumnOption("editorEmptyValueFunc"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0)),Object.keys(this.table.options).includes("editorEmptyValue")&&(this.convertEmptyValues=!0)}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,r=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||r&&(i.getElement().firstChild.blur(),this.invalidEdit||(r===!0?r=this.table.addRow({}):typeof r=="function"?r=this.table.addRow(r(i.row.getComponent())):r=this.table.addRow(Object.assign({},r)),r.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateLeft(),r)return!0;if(n=this.table.rowManager.prevDisplayRow(e.row,!0),n&&(r=this.findPrevEditableCell(n,n.cells.length),r))return r.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateRight(),r)return!0;if(n=this.table.rowManager.nextDisplayRow(e.row,!0),n&&(r=this.findNextEditableCell(n,-1),r))return r.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findPrevEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findNextEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.prevDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.nextDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var r=!1;if(i<e.cells.length-1)for(var n=i+1;n<e.cells.length;n++){let a=e.cells[n];if(a.column.modules.edit&&kr.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}findPrevEditableCell(e,i){var r=!1;if(i>0)for(var n=i-1;n>=0;n--){let a=e.cells[n];if(a.column.modules.edit&&kr.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i=Object.keys(e.definition).includes("editorEmptyValue"),r={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{},convertEmptyValues:i,editorEmptyValue:e.definition.editorEmptyValue,editorEmptyValueFunc:e.definition.editorEmptyValueFunc};switch(typeof e.definition.editor){case"string":this.editors[e.definition.editor]?r.editor=this.editors[e.definition.editor]:console.warn("Editor Error - No such editor found: ",e.definition.editor);break;case"function":r.editor=e.definition.editor;break;case"boolean":e.definition.editor===!0&&(typeof e.definition.formatter!="function"?this.editors[e.definition.formatter]?r.editor=this.editors[e.definition.formatter]:r.editor=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",e.definition.formatter));break}r.editor&&(e.modules.edit=r)}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,r;if(this.invalidEdit=!1,i){for(this.currentCell=!1,r=i.getElement(),this.dispatch("edit-editor-clear",i,e),r.classList.remove("tabulator-editing");r.firstChild;)r.removeChild(r.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,r=e.getElement(!0);this.updateCellClass(e),r.setAttribute("tabindex",0),r.addEventListener("mousedown",function(n){n.button===2?n.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&r.addEventListener("dblclick",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&r.addEventListener("click",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),this.options("editTriggerEvent")==="focus"&&r.addEventListener("focus",function(n){i.recursionBlock||i.edit(e,n,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,r=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,n=e.row.getElement();n.offsetTop<i?this.table.rowManager.element.scrollTop-=i-n.offsetTop:n.offsetTop+n.offsetHeight>r&&(this.table.rowManager.element.scrollTop+=n.offsetTop+n.offsetHeight-r);var a=this.table.rowManager.element.scrollLeft,o=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,s=e.getElement();this.table.modExists("frozenColumns")&&(a+=parseInt(this.table.modules.frozenColumns.leftMargin||0),o-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(a-=parseInt(this.table.columnManager.renderer.vDomPadLeft),o-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),s.offsetLeft<a?this.table.rowManager.element.scrollLeft-=a-s.offsetLeft:s.offsetLeft+s.offsetWidth>o&&(this.table.rowManager.element.scrollLeft+=s.offsetLeft+s.offsetWidth-o)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,r){var n=this,a=!0,o=function(){},s=e.getElement(),l=!1,u,c,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(v){if(n.currentCell===e&&!l){var y=n.chain("edit-success",[e,v],!0,!0);return y===!0||n.table.options.validationMode==="highlight"?(l=!0,n.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,n.editedCells.indexOf(e)==-1&&n.editedCells.push(e),v=n.transformEmptyValues(v,e),e.setValue(v,!0),y===!0):(l=!0,n.invalidEdit=!0,n.focusCellNoEvent(e,!0),o(),setTimeout(()=>{l=!1},10),!1)}}function m(){n.currentCell===e&&!l&&n.cancelEdit()}function h(v){o=v}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(s),!1;if(i&&i.stopPropagation(),a=this.allowEdit(e),a||r){if(n.cancelEdit(),n.currentCell=e,this.focusScrollAdjust(e),c=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,c)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,c),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",c),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(c):e.column.modules.edit.params,u=e.column.modules.edit.editor.call(n,c,h,p,m,d),this.currentCell&&u!==!1)if(u instanceof Node){for(s.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");s.firstChild;)s.removeChild(s.firstChild);s.appendChild(u),o();for(var f=s.children,g=0;g<f.length;g++)f[g].addEventListener("click",function(v){v.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",u),this.blur(s),!1;else return this.blur(s),!1;return!0}else return this.mouseClick=!1,this.blur(s),!1}emptyValueCheck(e){return e===""||e===null||typeof e>"u"}transformEmptyValues(e,i){var r=i.column.modules.edit,n=r.convertEmptyValues||this.convertEmptyValues,a;return n&&(a=r.editorEmptyValueFunc||this.options("editorEmptyValueFunc"),a&&a(e)&&(e=r.convertEmptyValues?r.editorEmptyValue:this.options("editorEmptyValue"))),e}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}};Ve(dI,"moduleName","edit"),Ve(dI,"editors",Pge);let I1=dI;class NV{constructor(e,i,r,n){this.type=e,this.columns=i,this.component=r||!1,this.indent=n||0}}class TC{constructor(e,i,r,n,a){this.value=e,this.component=i||!1,this.width=r,this.height=n,this.depth=a}}var Rge={},Cge={visible:function(){return this.rowManager.getVisibleRows(!1,!0)},all:function(){return this.rowManager.rows},selected:function(){return this.modules.selectRow.selectedRows},active:function(){return this.options.pagination?this.rowManager.getDisplayRows(this.rowManager.displayRows.length-2):this.rowManager.getDisplayRows()}};const Id=class Id extends ui{constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.colVisPropAttach="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,r,n){var a,o,s,l;return this.cloneTableStyle=i,this.config=e||{},this.colVisProp=n,this.colVisPropAttach=this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1),l=Id.columnLookups[r],l&&(s=l.call(this.table),s=s.filter(u=>this.columnVisCheck(u))),a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(s)):[],s&&(s=s.map(u=>u.getComponent())),o=this.bodyToExportRows(this.rowLookup(r),s),a.concat(o)}generateTable(e,i,r,n){var a=this.generateExportList(e,i,r,n);return this.generateTableElement(a)}rowLookup(e){var i=[],r;return typeof e=="function"?e.call(this.table).forEach(n=>{n=this.table.rowManager.findRow(n),n&&i.push(n)}):(r=Id.rowLookups[e]||Id.rowLookups.active,i=r.call(this.table)),Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(r=>{var n=this.processColumnGroup(r);n&&i.push(n)}),i}processColumnGroup(e){var i=e.columns,r=0,n=e.definition["title"+this.colVisPropAttach]||e.definition.title,a={title:n,column:e,depth:1};if(i.length){if(a.subGroups=[],a.width=0,i.forEach(o=>{var s=this.processColumnGroup(o);s&&(a.width+=s.width,a.subGroups.push(s),s.depth>r&&(r=s.depth))}),a.depth+=r,!a.width)return!1}else if(this.columnVisCheck(e))a.width=1;else return!1;return a}columnVisCheck(e){var i=e.definition[this.colVisProp];return this.config.rowHeaders===!1&&e.isRowHeader?!1:(typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i===!1||i===!0?i:e.visible&&e.field)}headersToExportRows(e){var i=[],r=0,n=[];function a(o,s){var l=r-s;if(typeof i[s]>"u"&&(i[s]=[]),o.height=o.subGroups?1:l-o.depth+1,i[s].push(o),o.height>1)for(let u=1;u<o.height;u++)typeof i[s+u]>"u"&&(i[s+u]=[]),i[s+u].push(!1);if(o.width>1)for(let u=1;u<o.width;u++)i[s].push(!1);o.subGroups&&o.subGroups.forEach(function(u){a(u,s+1)})}return e.forEach(function(o){o.depth>r&&(r=o.depth)}),e.forEach(function(o){a(o,0)}),i.forEach(o=>{var s=[];o.forEach(l=>{if(l){let u=typeof l.title>"u"?"":l.title;s.push(new TC(u,l.column.getComponent(),l.width,l.height,l.depth))}else s.push(null)}),n.push(new NV("header",s))}),n}bodyToExportRows(e,i=[]){var r=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(n=>{this.columnVisCheck(n)&&i.push(n.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(n=>{switch(n.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&n.modules.dataTree.parent)}return!0}),e.forEach((n,a)=>{var o=n.getData(this.colVisProp),s=[],l=0;switch(n.type){case"group":l=n.level,s.push(new TC(n.key,n.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(u=>{s.push(new TC(u._column.getFieldValue(o),u,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=n.modules.dataTree.index);break}r.push(new NV(n.type,s,n.getComponent(),l))}),r}generateTableElement(e){var i=document.createElement("table"),r=document.createElement("thead"),n=document.createElement("tbody"),a=this.lookupTableStyles(),o=this.table.options["rowFormatter"+this.colVisPropAttach],s={};return s.rowFormatter=o!==null?o:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(s.treeElementField=this.table.modules.dataTree.elementField),s.groupHeader=this.table.options["groupHeader"+this.colVisPropAttach],s.groupHeader&&!Array.isArray(s.groupHeader)&&(s.groupHeader=[s.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),r,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,u)=>{let c;switch(l.type){case"header":r.appendChild(this.generateHeaderElement(l,s,a));break;case"group":n.appendChild(this.generateGroupElement(l,s,a));break;case"calc":n.appendChild(this.generateCalcElement(l,s,a));break;case"row":c=this.generateRowElement(l,s,a),this.mapElementStyles(u%2&&a.evenRow?a.evenRow:a.oddRow,c,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n.appendChild(c);break}}),r.innerHTML&&i.appendChild(r),i.appendChild(n),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.styleRowHeader=e.firstRow.getElementsByClassName("tabulator-row-header")[0],e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,r){var n=document.createElement("tr");return e.columns.forEach(a=>{if(a){var o=document.createElement("th"),s=a.component._column.definition.cssClass?a.component._column.definition.cssClass.split(" "):[];o.colSpan=a.width,o.rowSpan=a.height,o.innerHTML=a.value,this.cloneTableStyle&&(o.style.boxSizing="border-box"),s.forEach(function(l){o.classList.add(l)}),this.mapElementStyles(a.component.getElement(),o,["text-align","border-left","border-right","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(a.component._column.contentElement,o,["padding-top","padding-left","padding-right","padding-bottom"]),a.component._column.visible?this.mapElementStyles(a.component.getElement(),o,["width"]):a.component._column.definition.width&&(o.style.width=a.component._column.definition.width+"px"),a.component._column.parent&&a.component._column.parent.isGroup?this.mapElementStyles(a.component._column.parent.groupElement,o,["border-top"]):this.mapElementStyles(a.component.getElement(),o,["border-top"]),a.component._column.isGroup?this.mapElementStyles(a.component.getElement(),o,["border-bottom"]):this.mapElementStyles(this.table.columnManager.getElement(),o,["border-bottom"]),n.appendChild(o)}}),n}generateGroupElement(e,i,r){var n=document.createElement("tr"),a=document.createElement("td"),o=e.columns[0];return n.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?o.value=i.groupHeader[e.indent](o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(o.value=e.component._group.generator(o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),a.colSpan=o.width,a.innerHTML=o.value,n.classList.add("tabulator-print-table-group"),n.classList.add("tabulator-group-level-"+e.indent),o.component.isVisible()&&n.classList.add("tabulator-group-visible"),this.mapElementStyles(r.firstGroup,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(r.firstGroup,a,["padding-top","padding-left","padding-right","padding-bottom"]),n.appendChild(a),n}generateCalcElement(e,i,r){var n=this.generateRowElement(e,i,r);return n.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(r.calcRow,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n}generateRowElement(e,i,r){var n=document.createElement("tr");if(n.classList.add("tabulator-print-table-row"),e.columns.forEach((a,o)=>{if(a){var s=document.createElement("td"),l=a.component._column,u=this.table,c=u.columnManager.findColumnIndex(l),d=a.value,p,m,h={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return s},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return u},getComponent:function(){return h},column:l},f=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(f.forEach(function(g){s.classList.add(g)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(h,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?s.appendChild(d):s.innerHTML=d,m=["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"],l.isRowHeader?(p=r.styleRowHeader,m.push("background-color")):p=r.styleCells&&r.styleCells[c]?r.styleCells[c]:r.firstCell,p&&(this.mapElementStyles(p,s,m),l.definition.align&&(s.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&o==0)&&(e.component._row.modules.dataTree.controlEl&&s.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),s.firstChild),e.component._row.modules.dataTree.branchEl&&s.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),s.firstChild)),n.appendChild(s),h.modules.format&&h.modules.format.renderedCallback&&h.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let a=Object.assign(e.component);a.getElement=function(){return n},i.rowFormatter(e.component)}return n}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,r,n){var a=this.generateExportList(r||this.table.options.htmlOutputConfig,i,e,n||"htmlOutput");return this.generateHTMLTable(a)}mapElementStyles(e,i,r){if(this.cloneTableStyle&&e&&i){var n={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var a=window.getComputedStyle(e);r.forEach(function(o){i.style[n[o]]||(i.style[n[o]]=a.getPropertyValue(o))})}}}};Ve(Id,"moduleName","export"),Ve(Id,"columnLookups",Rge),Ve(Id,"rowLookups",Cge);let y1=Id;var Ege={"=":function(t,e,i,r){return e==t},"<":function(t,e,i,r){return e<t},"<=":function(t,e,i,r){return e<=t},">":function(t,e,i,r){return e>t},">=":function(t,e,i,r){return e>=t},"!=":function(t,e,i,r){return e!=t},regex:function(t,e,i,r){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,r){var n=t.toLowerCase().split(typeof r.separator>"u"?" ":r.separator),a=String(e===null||typeof e>"u"?"":e).toLowerCase(),o=[];return n.forEach(s=>{a.includes(s)&&o.push(!0)}),r.matchAll?o.length===n.length:!!o.length},starts:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,r){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};const dc=class dc extends ui{constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,r,n){return n.filter=this.getFilters(!0,!0),n}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,r,n){this.setFilter(e,i,r,n),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,r,n){this.addFilter(e,i,r,n),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var r=this.table.columnManager.findColumn(e);if(r)this.setHeaderFilterValue(r,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,r){this.removeFilter(e,i,r),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,r){return this.search("rows",e,i,r)}searchData(e,i,r){return this.search("data",e,i,r)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var r=this,n=e.getField();function a(o){var s=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",u="",c;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==o){if(e.modules.filter.prevSuccess=o,e.modules.filter.emptyFunc(o))delete r.headerFilters[n];else{switch(e.modules.filter.value=o,typeof e.definition.headerFilterFunc){case"string":dc.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,c=function(d){var p=e.definition.headerFilterFuncParams||{},m=e.getFieldValue(d);return p=typeof p=="function"?p(o,m,d):p,dc.filters[e.definition.headerFilterFunc](o,m,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":c=function(d){var p=e.definition.headerFilterFuncParams||{},m=e.getFieldValue(d);return p=typeof p=="function"?p(o,m,d):p,e.definition.headerFilterFunc(o,m,d,p)},l=c;break}if(!c)switch(s){case"partial":c=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(o).toLowerCase())>-1:!1},l="like";break;default:c=function(d){return e.getFieldValue(d)==o},l="="}r.headerFilters[n]={value:o,func:c,type:l}}e.modules.filter.value=o,u=JSON.stringify(r.headerFilters),r.prevHeaderFilterChangeCheck!==u&&(r.prevHeaderFilterChangeCheck=u,r.trackChanges(),r.refreshFilter())}return!0}e.modules.filter={success:a,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,r){var n=this,a=e.modules.filter.success,o=e.getField(),s,l,u,c,d,p,m,h;e.modules.filter.value=i;function f(){}function g(v){h=v}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),o){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(v){return!v&&v!==0},s=document.createElement("div"),s.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":n.table.modules.edit.editors[e.definition.headerFilter]?(l=n.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&n.table.modules.edit.editors[e.definition.formatter]?(l=n.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):l=n.table.modules.edit.editors.input;break}if(l){if(c={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return s},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},m=e.definition.headerFilterParams||{},m=typeof m=="function"?m.call(n.table,c):m,u=l.call(this.table.modules.edit,c,g,a,f,m),!u){console.warn("Filter Error - Cannot add filter to "+o+" column, editor returned a value of false");return}if(!(u instanceof Node)){console.warn("Filter Error - Cannot add filter to "+o+" column, editor should return an instance of Node, the editor returned:",u);return}n.langBind("headerFilters|columns|"+e.definition.field,function(v){u.setAttribute("placeholder",typeof v<"u"&&v?v:e.definition.headerFilterPlaceholder||n.langText("headerFilters|default"))}),u.addEventListener("click",function(v){v.stopPropagation(),u.focus()}),u.addEventListener("focus",v=>{var y=this.table.columnManager.contentsElement.scrollLeft,I=this.table.rowManager.element.scrollLeft;y!==I&&(this.table.rowManager.scrollHorizontal(y),this.table.columnManager.scrollHorizontal(y))}),d=!1,p=function(v){d&&clearTimeout(d),d=setTimeout(function(){a(u.value)},n.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=u,e.modules.filter.attrType=u.hasAttribute("type")?u.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=u.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(u.addEventListener("keyup",p),u.addEventListener("search",p),e.modules.filter.attrType=="number"&&u.addEventListener("change",function(v){a(u.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&u.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&u.addEventListener("mousedown",function(v){v.stopPropagation()})),s.appendChild(u),e.contentElement.appendChild(s),r||n.headerFilterColumns.push(e),h&&h()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,r,n){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),this.addFilter(e)}addFilter(e,i,r,n){var a=!1;Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),e.forEach(o=>{o=this.findFilter(o),o&&(this.filterList.push(o),a=!0)}),a&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var r=!1;return typeof e.field=="function"?r=function(n){return e.field(n,e.type||{})}:dc.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?r=function(n){return dc.filters[e.type](e.value,i.getFieldValue(n),n,e.params||{})}:r=function(n){return dc.filters[e.type](e.value,n[e.field],n,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=r,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(r=>{r=this.findFilter(r),r&&i.push(r)}),i.length?i:!1}getFilters(e,i){var r=[];return e&&(r=this.getHeaderFilters()),i&&r.forEach(function(n){typeof n.type=="function"&&(n.type="function")}),r=r.concat(this.filtersToArray(this.filterList,i)),r}filtersToArray(e,i){var r=[];return e.forEach(n=>{var a;Array.isArray(n)?r.push(this.filtersToArray(n,i)):(a={field:n.field,type:n.type,value:n.value},i&&typeof a.type=="function"&&(a.type="function"),r.push(a))}),r}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,r){Array.isArray(e)||(e=[{field:e,type:i,value:r}]),e.forEach(n=>{var a=-1;typeof n.field=="object"?a=this.filterList.findIndex(o=>n===o):a=this.filterList.findIndex(o=>n.field===o.field&&n.type===o.type&&n.value===o.value),a>-1?this.filterList.splice(a,1):console.warn("Filter Error - No matching filter type found, ignoring: ",n.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,r,n){var a=[],o=[];return Array.isArray(i)||(i=[{field:i,type:r,value:n}]),i.forEach(s=>{s=this.findFilter(s),s&&o.push(s)}),this.table.rowManager.rows.forEach(s=>{var l=!0;o.forEach(u=>{this.filterRecurse(u,s.getData())||(l=!1)}),l&&a.push(e==="data"?s.getData("data"):s.getComponent())}),a}filter(e,i){var r=[],n=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(a=>{this.filterRow(a)&&r.push(a)}):r=e.slice(0),this.subscribedExternal("dataFiltered")&&(r.forEach(a=>{n.push(a.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),n)),r}filterRow(e,i){var r=!0,n=e.getData();this.filterList.forEach(o=>{this.filterRecurse(o,n)||(r=!1)});for(var a in this.headerFilters)this.headerFilters[a].func(n)||(r=!1);return r}filterRecurse(e,i){var r=!1;return Array.isArray(e)?e.forEach(n=>{this.filterRecurse(n,i)&&(r=!0)}):r=e.func(i),r}};Ve(dc,"moduleName","filter"),Ve(dc,"filters",Ege);let b1=dc;function Mge(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function Nge(t,e,i){return t.getValue()}function Age(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function Oge(t,e,i){var r=parseFloat(t.getValue()),n="",a,o,s,l,u,c=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",m=e.symbol||"",h=!!e.symbolAfter,f=typeof e.precision<"u"?e.precision:2;if(isNaN(r))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(r<0&&(r=Math.abs(r),n=p),a=f!==!1?r.toFixed(f):r,a=String(a).split("."),o=a[0],s=a.length>1?c+a[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(o);)o=o.replace(l,"$1"+d+"$2");return u=o+s,n===!0?(u="("+u+")",h?u+m:m+u):h?n+u+m:n+m+u}function kge(t,e,i){var r=t.getValue(),n=e.urlPrefix||"",a=e.download,o=r,s=document.createElement("a"),l;function u(c,d){var p=c.shift(),m=d[p];return c.length&&typeof m=="object"?u(c,m):m}if(e.labelField&&(l=t.getData(),o=u(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":o=e.label;break;case"function":o=e.label(t);break}if(o){if(e.urlField&&(l=t.getData(),r=kr.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":r=e.url;break;case"function":r=e.url(t);break}return s.setAttribute("href",n+r),e.target&&s.setAttribute("target",e.target),e.download&&(typeof a=="function"?a=a(t):a=a===!0?"":a,s.setAttribute("download",a)),s.innerHTML=this.emptyToSpace(this.sanitizeHTML(o)),s}else return"&nbsp;"}function xge(t,e,i){var r=document.createElement("img"),n=t.getValue();switch(e.urlPrefix&&(n=e.urlPrefix+t.getValue()),e.urlSuffix&&(n=n+e.urlSuffix),r.setAttribute("src",n),typeof e.height){case"number":r.style.height=e.height+"px";break;case"string":r.style.height=e.height;break}switch(typeof e.width){case"number":r.style.width=e.width+"px";break;case"string":r.style.width=e.width;break}return r.addEventListener("load",function(){t.getRow().normalizeHeight()}),r}function Fge(t,e,i){var r=t.getValue(),n=t.getElement(),a=e.allowEmpty,o=e.allowTruthy,s=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',u=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return s&&r===e.trueValue||!s&&(o&&r||r===!0||r==="true"||r==="True"||r===1||r==="1")?(n.setAttribute("aria-checked",!0),l||""):a&&(r==="null"||r===""||r===null||typeof r>"u")?(n.setAttribute("aria-checked","mixed"),""):(n.setAttribute("aria-checked",!1),u||"")}function Lge(t,e,i){var r=window.DateTime||luxon.DateTime,n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=e.outputFormat||"dd/MM/yyyy HH:mm:ss",o=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=t.getValue();if(typeof r<"u"){var l;return r.isDateTime(s)?l=s:n==="iso"?l=r.fromISO(String(s)):l=r.fromFormat(String(s),n),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(a)):o===!0||!s?s:typeof o=="function"?o(s):o}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function _ge(t,e,i){var r=window.DateTime||luxon.DateTime,n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=typeof e.suffix<"u"?e.suffix:!1,s=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,u=typeof e.date<"u"?e.date:r.now(),c=t.getValue();if(typeof r<"u"){var d;return r.isDateTime(c)?d=c:n==="iso"?d=r.fromISO(String(c)):d=r.fromFormat(String(c),n),d.isValid?l?d.diff(u,s).toHuman()+(o?" "+o:""):parseInt(d.diff(u,s)[s])+(o?" "+o:""):a===!0?c:typeof a=="function"?a(c):a}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function $ge(t,e,i){var r=t.getValue();return typeof e[r]>"u"?(console.warn("Missing display value for "+r),r):e[r]}function Bge(t,e,i){var r=t.getValue(),n=t.getElement(),a=e&&e.stars?e.stars:5,o=document.createElement("span"),s=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',u='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';o.style.verticalAlign="middle",s.setAttribute("width","14"),s.setAttribute("height","14"),s.setAttribute("viewBox","0 0 512 512"),s.setAttribute("xml:space","preserve"),s.style.padding="0 1px",r=r&&!isNaN(r)?parseInt(r):0,r=Math.max(0,Math.min(r,a));for(var c=1;c<=a;c++){var d=s.cloneNode(!0);d.innerHTML=c<=r?l:u,o.appendChild(d)}return n.style.whiteSpace="nowrap",n.style.overflow="hidden",n.style.textOverflow="ellipsis",n.setAttribute("aria-label",r),o}function Vge(t,e,i){var r=this.sanitizeHTML(t.getValue())||0,n=document.createElement("span"),a=e&&e.max?e.max:100,o=e&&e.min?e.min:0,s=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",u,c;if(!(isNaN(r)||typeof t.getValue()>"u")){switch(n.classList.add("tabulator-traffic-light"),c=parseFloat(r)<=a?parseFloat(r):a,c=parseFloat(c)>=o?parseFloat(c):o,u=(a-o)/100,c=Math.round((c-o)/u),typeof s){case"string":l=s;break;case"function":l=s(r);break;case"object":if(Array.isArray(s)){var d=100/s.length,p=Math.floor(c/d);p=Math.min(p,s.length-1),p=Math.max(p,0),l=s[p];break}}return n.style.backgroundColor=l,n}}function jge(t,e={},i){var r=this.sanitizeHTML(t.getValue())||0,n=t.getElement(),a=e.max?e.max:100,o=e.min?e.min:0,s=e.legendAlign?e.legendAlign:"center",l,u,c,d,p;switch(u=parseFloat(r)<=a?parseFloat(r):a,u=parseFloat(u)>=o?parseFloat(u):o,l=(a-o)/100,u=Math.round((u-o)/l),typeof e.color){case"string":c=e.color;break;case"function":c=e.color(r);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,v=Math.floor(u/g);v=Math.min(v,e.color.length-1),v=Math.max(v,0),c=e.color[v];break}default:c="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(r);break;case"boolean":d=r;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(r);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,v=Math.floor(u/g);v=Math.min(v,e.legendColor.length-1),v=Math.max(v,0),p=e.legendColor[v]}break;default:p="#000"}n.style.minWidth="30px",n.style.position="relative",n.setAttribute("aria-label",u);var m=document.createElement("div");m.style.display="inline-block",m.style.width=u+"%",m.style.backgroundColor=c,m.style.height="100%",m.setAttribute("data-max",a),m.setAttribute("data-min",o);var h=document.createElement("div");if(h.style.position="relative",h.style.width="100%",h.style.height="100%",d){var f=document.createElement("div");f.style.position="absolute",f.style.top=0,f.style.left=0,f.style.textAlign=s,f.style.width="100%",f.style.color=p,f.innerHTML=d}return i(function(){if(!(t instanceof a7)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",n.appendChild(g),n=g}n.appendChild(h),h.appendChild(m),d&&h.appendChild(f)}),""}function Gge(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function Hge(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function zge(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function Wge(t,e,i){var r=t.getValue(),n=e.size||15,a=n+"px",o,s,l=e.hasOwnProperty("onValue")?e.onValue:!0,u=e.hasOwnProperty("offValue")?e.offValue:!1,c=e.onTruthy?r:r===l;return o=document.createElement("div"),o.classList.add("tabulator-toggle"),c?(o.classList.add("tabulator-toggle-on"),o.style.flexDirection="row-reverse",e.onColor&&(o.style.background=e.onColor)):e.offColor&&(o.style.background=e.offColor),o.style.width=2.5*n+"px",o.style.borderRadius=a,e.clickable&&o.addEventListener("click",d=>{t.setValue(c?u:l)}),s=document.createElement("div"),s.classList.add("tabulator-toggle-switch"),s.style.height=a,s.style.width=a,s.style.borderRadius=a,o.appendChild(s),o}function qge(t,e,i){var r=document.createElement("span"),n=t.getRow(),a=t.getTable();return n.watchPosition(o=>{e.relativeToPage&&(o+=a.modules.page.getPageSize()*(a.modules.page.getPage()-1)),r.innerText=o}),r}function Yge(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}var Kge={plaintext:Mge,html:Nge,textarea:Age,money:Oge,link:kge,image:xge,tickCross:Fge,datetime:Lge,datetimediff:_ge,lookup:$ge,star:Bge,traffic:Vge,progress:jge,color:Gge,buttonTick:Hge,buttonCross:zge,toggle:Wge,rownum:qge,handle:Yge};const Fs=class Fs extends ui{constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupFormatter(e,"HtmlOutput"))}lookupFormatter(e,i){var r={params:e.definition["formatter"+i+"Params"]||{}},n=e.definition["formatter"+i];switch(typeof n){case"string":Fs.formatters[n]?r.formatter=Fs.formatters[n]:(console.warn("Formatter Error - No such formatter found: ",n),r.formatter=Fs.formatters.plaintext);break;case"function":r.formatter=n;break;default:r.formatter=Fs.formatters.plaintext;break}return r}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,r){var n,a,o,s;return e.definition.titleFormatter?(n=this.getFormatter(e.definition.titleFormatter),o=l=>{e.titleFormatterRendered=l},s={getValue:function(){return i},getElement:function(){return r},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},a=e.definition.titleFormatterParams||{},a=typeof a=="function"?a():a,n.call(this,s,a,o)):i}formatValue(e){var i=e.getComponent(),r=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function n(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,r,n)}formatExportValue(e,i){var r=e.column.modules.format[i],n;if(r){let a=function(o){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=o,e.modules.format.rendered=!1};return n=typeof r.params=="function"?r.params(e.getComponent()):r.params,r.formatter.call(this,e.getComponent(),n,a)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(r){return i[r]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}getFormatter(e){switch(typeof e){case"string":Fs.formatters[e]?e=Fs.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),e=Fs.formatters.plaintext);break;case"function":break;default:e=Fs.formatters.plaintext;break}return e}};Ve(Fs,"moduleName","format"),Ve(Fs,"formatters",Kge);let w1=Fs;class u7 extends ui{constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],r=0,n=0;this.leftColumns.forEach((a,o)=>{if(a.modules.frozen.marginValue=r,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(r+=a.getWidth()),o==this.leftColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup){var s=this.getColGroupParentElement(a);i.includes(s)||(this.layoutElement(s,a),i.push(s)),s.classList.toggle("tabulator-frozen-left",a.modules.frozen.edge&&a.modules.frozen.position==="left"),s.classList.toggle("tabulator-frozen-right",a.modules.frozen.edge&&a.modules.frozen.position==="right")}else this.layoutElement(a.getElement(),a);e&&a.cells.forEach(l=>{this.layoutElement(l.getElement(!0),a)})}),this.rightColumns.forEach((a,o)=>{a.modules.frozen.marginValue=n,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(n+=a.getWidth()),o==this.rightColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup?this.layoutElement(this.getColGroupParentElement(a),a):this.layoutElement(a.getElement(),a),e&&a.cells.forEach(s=>{this.layoutElement(s.getElement(!0),a)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));i.forEach(r=>{r.deinitialize()}),e.forEach(r=>{r.type==="row"&&this.layoutRow(r)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)}),this.rightColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)})}layoutElement(e,i){var r;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?r=i.modules.frozen.position==="left"?"right":"left":r=i.modules.frozen.position,e.style[r]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}getFrozenColumns(){return this.leftColumns.concat(this.rightColumns)}_calcSpace(e,i){var r=0;for(let n=0;n<i;n++)e[n].visible&&(r+=e[n].getWidth());return r}}Ve(u7,"moduleName","frozenColumns");class c7 extends ui{constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,r=typeof i;r==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):r==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(r=>{i.push(r)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(r){var n=i.indexOf(r);n>-1&&i.splice(n,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var r=e.getElement();r.parentNode&&r.parentNode.removeChild(r),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,r)=>{this.table.rowManager.styleRow(i,r)})}}Ve(c7,"moduleName","frozenRows");class Xge{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,r)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class sf{constructor(e,i,r,n,a,o,s){this.groupManager=e,this.parent=i,this.key=n,this.level=r,this.field=a,this.hasSubGroups=r<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=s,this.rows=[],this.groups=[],this.groupList=[],this.generator=o,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=s?s.visible:typeof e.startOpen[r]<"u"?e.startOpen[r]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var r=i+"_"+e,n=new sf(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[r]:!1);this.groups[r]=n,this.groupList.push(n)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var r=this.groupManager.groupIDLookups[i].func(e.getData()),n=i+"_"+r;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[n]&&this.groups[n].addRow(e):(this.groups[n]||this._createGroup(r,i),this.groups[n].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,r){var n=this.conformRowData({});e.updateData(n);var a=this.rows.indexOf(i);a>-1?r?this.rows.splice(a+1,0,e):this.rows.splice(a,0,e):r?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),r=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(r.parentNode&&r.parentNode.removeChild(r),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var r=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(n=>{r.push(n.getData(i||"data"))}),r}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(r=>{r.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var r=i.getHeadersAndRows();r.forEach(n=>{var a=n.getElement();e.parentNode.insertBefore(a,e.nextSibling),n.initialize(),e=a})}):this.rows.forEach(i=>{var r=i.getElement();e.parentNode.insertBefore(r,e.nextSibling),i.initialize(),e=r}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(r){var n=r.getRowGroup(e);n&&(i=n)}):this.rows.find(function(r){return r===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getRows(e,i){var r=[];return i&&this.groupList.length?this.groupList.forEach(n=>{r=r.concat(n.getRows(e,i))}):this.rows.forEach(function(n){r.push(e?n.getComponent():n)}),r}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(r){e.push(r.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,kr.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new Xge(this)),this.component}}class d7 extends ui{constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,r=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(r)&&e.length>r.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(a,o)=>{this.headerGenerator[0]=(s,l,u)=>(typeof s>"u"?"":s)+"<span>("+l+" "+(l===1?a:o.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var n=this.table.columnManager.getRealColumns();n.forEach(a=>{a.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),a.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((a,o)=>{var s,l;typeof a=="function"?s=a:(l=this.table.columnManager.getColumnByField(a),l?s=function(u){return l.getFieldValue(u)}:s=function(u){return u[a]}),this.groupIDLookups.push({field:typeof a=="function"?!1:a,func:s,values:this.allowedValues?this.allowedValues[o]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(a=>{}),this.startOpen=i),r&&(this.headerGenerator=Array.isArray(r)?r:[r])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var r=this.getGroups(!1)[0];i.push(r.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(r=>r.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,r){if(this.table.options.groupBy){this.assignRowToGroup(e);var n=e.modules.group.rows;return n.length>1&&(!i||i&&n.indexOf(i)==-1?r?n[0]!==e&&(i=n[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):n[n.length-1]!==e&&(i=n[n.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,r){if(this.table.options.groupBy){!r&&i instanceof sf&&(i=this.table.rowManager.prevDisplayRow(e)||i);var n=i instanceof sf?i:i.modules.group,a=e instanceof sf?e:e.modules.group;n===a?this.table.rowManager.moveRowInArray(n.rows,e,i,r):(a&&a.removeRow(e),n.insertRow(e,i,r))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(r=>{r.groupList.length?i=i.concat(this.getChildGroups(r)):i.push(r)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(r=>{var n={};n.level=0,n.rowCount=0,n.headerContent="";var a=[];r.hasSubGroups?(a=this.pullGroupListData(r.groupList),n.level=r.level,n.rowCount=a.length-r.groupList.length,n.headerContent=r.generator(r.key,n.rowCount,r.rows,r),i.push(n),i=i.concat(a)):(n.level=r.level,n.headerContent=r.generator(r.key,r.rows.length,r.rows,r),n.rowCount=r.getRows().length,i.push(n),r.getRows().forEach(o=>{i.push(o.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(r=>{var n=r.getRowGroup(e);n&&(i=n)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(r=>{this.createGroup(r,0,i)}),e.forEach(r=>{this.assignRowToExistingGroup(r,i)})):e.forEach(r=>{this.assignRowToGroup(r,i)}),Object.values(i).forEach(r=>{r.wipe(!0)})}createGroup(e,i,r){var n=i+"_"+e,a;r=r||[],a=new sf(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],r[n]),this.groups[n]=a,this.groupList.push(a)}assignRowToExistingGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n="0_"+r;this.groups[n]&&this.groups[n].addRow(e)}assignRowToGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n=!this.groups["0_"+r];return n&&this.createGroup(r,0,i),this.groups["0_"+r].addRow(e),!n}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,r=i.getPath(),n=this.getExpectedPath(e),a;a=r.length==n.length&&r.every((o,s)=>o===n[s]),a||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],r=e.getData();return this.groupIDLookups.forEach(n=>{i.push(n.func(r))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(r=>{i=i.concat(r.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((r,n)=>{this.table.rowManager.styleRow(r,n),e.appendChild(r.getElement()),r.initialize(!0),r.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}Ve(d7,"moduleName","groupRows");var Jge={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},Zge={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},Qge={undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"]},eve={undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))}},tve={keybindings:{bindings:Qge,actions:eve}};const yd=class yd extends ui{constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,r){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:r})}rowAdded(e,i,r,n){this.action("rowAdd",e,{data:i,pos:r,index:n})}rowDeleted(e){var i,r;this.table.options.groupBy?(r=e.getComponent().getGroup()._getSelf().rows,i=r.indexOf(e),i&&(i=r[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,r){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:r}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(r){return r.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return yd.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return yd.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(r){if(r.component instanceof io)r.component===e&&(r.component=i);else if(r.component instanceof _b&&r.component.row===e){var n=r.component.column.getField();n&&(r.component=i.getCell(n))}})}};Ve(yd,"moduleName","history"),Ve(yd,"moduleExtensions",tve),Ve(yd,"undoers",Jge),Ve(yd,"redoers",Zge);let U1=yd;class p7 extends ui{constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,r=e.getElementsByTagName("th"),n=e.getElementsByTagName("tbody")[0],a=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),n=n?n.getElementsByTagName("tr"):[],this._extractOptions(e,i),r.length?this._extractHeaders(r,n):this._generateBlankHeaders(r,n);for(var o=0;o<n.length;o++){var s=n[o],l=s.getElementsByTagName("td"),u={};this.hasIndex||(u[i.index]=o);for(var c=0;c<l.length;c++){var d=l[c];typeof this.fieldIndex[c]<"u"&&(u[this.fieldIndex[c]]=d.innerHTML)}a.push(u)}i.data=a,this.dispatchExternal("htmlImported")}_extractOptions(e,i,r){var n=e.attributes,a=Object.keys(r||i),o={};a.forEach(c=>{o[c.toLowerCase()]=c});for(var s in n){var l=n[s],u;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(u=l.name.replace("tabulator-",""),typeof o[u]<"u"&&(i[o[u]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(r=>r.title===e);return i||!1}_extractHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a=!1,o=this._findCol(n.textContent),s;o?a=!0:o={title:n.textContent.trim()},o.field||(o.field=n.textContent.trim().toLowerCase().replaceAll(" ","_")),s=n.getAttribute("width"),s&&!o.width&&(o.width=s),this._extractOptions(n,o,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[r]=o.field,o.field==this.table.options.index&&(this.hasIndex=!0),a||this.table.options.columns.push(o)}}_generateBlankHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a={title:"",field:"col"+r};this.fieldIndex[r]=a.field;var o=n.getAttribute("width");o&&(a.width=o),this.table.options.columns.push(a)}}}Ve(p7,"moduleName","htmlTableImport");function ive(t){var e=[],i=0,r=0,n=!1;for(let a=0;a<t.length;a++){let o=t[a],s=t[a+1];if(e[i]||(e[i]=[]),e[i][r]||(e[i][r]=""),o=='"'&&n&&s=='"'){e[i][r]+=o,a++;continue}if(o=='"'){n=!n;continue}if(o==","&&!n){r++;continue}if(o=="\r"&&s==`
`&&!n){r=0,i++,a++;continue}if((o=="\r"||o==`
`)&&!n){r=0,i++;continue}e[i][r]+=o}return e}function rve(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function nve(t){return t}function ave(t,e){var i=XLSX.read(t),r=i.Sheets[i.SheetNames[0]];return XLSX.utils.sheet_to_json(r,{})}var ove={csv:ive,json:rve,array:nve,xlsx:ave};const pI=class pI extends ui{constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,r,n,a){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(o=>(console.error("Import Error:",o||"Unable to import data"),Promise.reject(o)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=pI.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i,r){var n=this.lookupImporter(e);if(n)return this.pickFile(i,r).then(this.importData.bind(this,n)).then(this.structureData.bind(this)).then(this.setData.bind(this)).catch(a=>(this.dispatch("import-error",a),this.dispatchExternal("importError",a),console.error("Import Error:",a||"Unable to import file"),Promise.reject(a)))}pickFile(e,i){return new Promise((r,n)=>{var a=document.createElement("input");a.type="file",a.accept=e,a.addEventListener("change",o=>{var s=a.files[0],l=new FileReader;switch(this.dispatch("import-importing",a.files),this.dispatchExternal("importImporting",a.files),i||this.table.options.importReader){case"buffer":l.readAsArrayBuffer(s);break;case"binary":l.readAsBinaryString(s);break;case"url":l.readAsDataURL(s);break;case"text":default:l.readAsText(s)}l.onload=u=>{r(l.result)},l.onerror=u=>{console.warn("File Load Error - Unable to read file"),n()}}),this.dispatch("import-choose"),this.dispatchExternal("importChoose"),a.click()})}importData(e,i){var r=e.call(this.table,i);return r instanceof Promise?r:r?Promise.resolve(r):Promise.reject()}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}structureArrayToObject(e){var i=e.shift(),r=e.map(n=>{var a={};return i.forEach((o,s)=>{a[o]=n[s]}),a});return r}structureArrayToColumns(e){var i=[],r=this.table.getColumns();return r[0]&&e[0][0]&&r[0].getDefinition().title===e[0][0]&&e.shift(),e.forEach(n=>{var a={};n.forEach((o,s)=>{var l=r[s];l&&(a[l.getField()]=o)}),i.push(a)}),i}setData(e){return this.dispatch("import-imported",e),this.dispatchExternal("importImported",e),this.table.setData(e)}};Ve(pI,"moduleName","import"),Ve(pI,"importers",ove);let S1=pI;class m7 extends ui{constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let r in i)i[r]=null})}cellContentsSelectionFixer(e,i){var r;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(r=document.body.createTextRange(),r.moveToElementText(i.getElement()),r.select()):window.getSelection&&(r=document.createRange(),r.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(r))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,r=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let n in this.eventMap)this.eventMap[n]===r&&this.subscribers[n]&&(i=!1);i&&(this.unsubscribe(r+"-touchstart",this.touchSubscribers[r+"-touchstart"]),this.unsubscribe(r+"-touchend",this.touchSubscribers[r+"-touchend"]),delete this.touchSubscribers[r+"-touchstart"],delete this.touchSubscribers[r+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let r in this.eventMap)i[r]&&(this.subscriptionChanged(r,!0),this.columnSubscribers[r]||(this.columnSubscribers[r]=[]),this.columnSubscribers[r].push(e))}handle(e,i,r){this.dispatchEvent(e,i,r)}handleTouch(e,i,r,n){var a=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":a.tap=!0,clearTimeout(a.tapHold),a.tapHold=setTimeout(()=>{clearTimeout(a.tapHold),a.tapHold=null,a.tap=null,clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"TapHold",r,n)},1e3);break;case"end":a.tap&&(a.tap=null,this.dispatchEvent(e+"Tap",r,n)),a.tapDbl?(clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"DblTap",r,n)):a.tapDbl=setTimeout(()=>{clearTimeout(a.tapDbl),a.tapDbl=null},300),clearTimeout(a.tapHold),a.tapHold=null;break}}dispatchEvent(e,i,r){var n=r.getComponent(),a;this.columnSubscribers[e]&&(r instanceof _b?a=r.column.definition[e]:r instanceof im&&(a=r.definition[e]),a&&a(i,n)),this.dispatchExternal(e,i,n)}}Ve(m7,"moduleName","interaction");var sve={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35},lve={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,r=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=r?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)}};const bd=class bd extends ui{constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,bd.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)bd.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(r=>{var n=Array.isArray(r)?r:[r];n.forEach(a=>{this.mapBinding(i,a)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var r={action:bd.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},n=i.toString().toLowerCase().split(" ").join("").split("+");n.forEach(a=>{switch(a){case"ctrl":r.ctrl=!0;break;case"shift":r.shift=!0;break;case"meta":r.meta=!0;break;default:a=isNaN(a)?a.toUpperCase().charCodeAt(0):parseInt(a),r.keys.push(a),this.watchKeys[a]||(this.watchKeys[a]=[]),this.watchKeys[a].push(r)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];n&&(e.pressedKeys.push(r),n.forEach(function(a){e.checkBinding(i,a)}))},this.keydownBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];if(n){var a=e.pressedKeys.indexOf(r);a>-1&&e.pressedKeys.splice(a,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var r=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(n=>{var a=this.pressedKeys.indexOf(n);a==-1&&(r=!1)}),r&&i.action.call(this,e),!0):!1}};Ve(bd,"moduleName","keybindings"),Ve(bd,"bindings",sve),Ve(bd,"actions",lve);let T1=bd;class h7 extends ui{constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadMenuEvent(r.column.definition[e],i,r)}loadMenuTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadMenuEvent(r.definition[e],i,r)}loadMenuEvent(e,i,r){r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent()):e,this.loadMenu(i,r,e)}loadMenu(e,i,r,n,a){var o=!(e instanceof MouseEvent),s=document.createElement("div"),l;if(s.classList.add("tabulator-menu"),o||e.preventDefault(),!(!r||!r.length)){if(n)l=a.child(s);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(s)}r.forEach(u=>{var c=document.createElement("div"),d=u.label,p=u.disabled;u.separator?c.classList.add("tabulator-menu-separator"):(c.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?c.appendChild(d):c.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(c.classList.add("tabulator-menu-item-disabled"),c.addEventListener("click",m=>{m.stopPropagation()})):u.menu&&u.menu.length?c.addEventListener("click",m=>{m.stopPropagation(),this.loadMenu(m,i,u.menu,c,l)}):u.action&&c.addEventListener("click",m=>{u.action(m,i.getComponent())}),u.menu&&u.menu.length&&c.classList.add("tabulator-menu-item-submenu")),s.appendChild(c)}),s.addEventListener("click",u=>{this.rootPopup&&this.rootPopup.hide()}),l.show(n||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",r,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",r,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}Ve(h7,"moduleName","menu");class f7 extends ui{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,r={},n;!e.modules.frozen&&!e.isGroup&&!e.isRowHeader&&(n=e.getElement(),r.mousemove=(function(a){e.parent===i.moving.parent&&((i.touchMove?a.touches[0].pageX:a.pageX)-kr.elOffset(n).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n),i.moveColumn(e,!1)))}).bind(i),n.addEventListener("mousedown",function(a){i.touchMove=!1,a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=r}bindTouchEvents(e){var i=e.getElement(),r=!1,n,a,o,s,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextColumn(),o=n?n.getWidth()/2:0,a=e.prevColumn(),s=a?a.getWidth()/2:0,l=0,u=0,r=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",c=>{var d,p;this.moving&&(this.moveHover(c),r||(r=c.touches[0].pageX),d=c.touches[0].pageX-r,d>0?n&&d-l>o&&(p=n,p!==e&&(r=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):a&&-d-u>s&&(p=a,p!==e&&(r=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(n=p.nextColumn(),l=o,o=n?n.getWidth()/2:0,a=p.prevColumn(),u=s,s=a?a.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(c)})}startMove(e,i){var r=i.getElement(),n=this.table.columnManager.getContentsElement(),a=this.table.columnManager.getHeadersElement();this.table.modules.selectRange&&this.table.modules.selectRange.columnSelection&&this.table.modules.selectRange.mousedown&&this.table.modules.selectRange.selecting==="column"||(this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-kr.elOffset(r).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),n.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=n.clientHeight-a.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e),this.dispatch("column-moving",e,this.moving))}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var r=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(n,a){var o=n.getElement(!0);o.parentNode&&r[a]&&o.parentNode.insertBefore(r[a].getElement(),o.nextSibling)}):e.getCells().forEach(function(n,a){var o=n.getElement(!0);o.parentNode&&r[a]&&o.parentNode.insertBefore(r[a].getElement(),o)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),r=i.scrollLeft,n=(this.touchMove?e.touches[0].pageX:e.pageX)-kr.elOffset(i).left+r,a;this.hoverElement.style.left=n-this.startX+"px",n-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.max(0,r-5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1))),r+i.clientWidth-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.min(i.clientWidth,r+5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1)))}}Ve(f7,"moduleName","moveColumn");var uve={delete:function(t,e,i){t.delete()}},cve={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};const jp=class jp extends ui{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,r={};r.mouseup=(function(n){i.tableRowDrop(n,e)}).bind(i),r.mousemove=(function(n){var a;n.pageY-kr.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a=e.getElement(),a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a=e.getElement(),a.previousSibling&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=r}initializeRow(e){var i=this,r={},n;r.mouseup=(function(a){i.tableRowDrop(a,e)}).bind(i),r.mousemove=(function(a){var o=e.getElement();a.pageY-kr.elOffset(o).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(o.parentNode.insertBefore(i.placeholderElement,o.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(o.parentNode.insertBefore(i.placeholderElement,o),i.moveRow(e,!1))}).bind(i),this.hasHandle||(n=e.getElement(),n.addEventListener("mousedown",function(a){a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=r}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,r=e.getElement(!0);r.addEventListener("mousedown",function(n){n.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(n,e.row)},i.checkPeriod))}),r.addEventListener("mouseup",function(n){n.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,r)}}bindTouchEvents(e,i){var r=!1,n,a,o,s,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextRow(),o=n?n.getHeight()/2:0,a=e.prevRow(),s=a?a.getHeight()/2:0,l=0,u=0,r=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",c=>{var d,p;this.moving&&(c.preventDefault(),this.moveHover(c),r||(r=c.touches[0].pageY),d=c.touches[0].pageY-r,d>0?n&&d-l>o&&(p=n,p!==e&&(r=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):a&&-d-u>s&&(p=a,p!==e&&(r=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(n=p.nextRow(),l=o,o=n?n.getHeight()/2:0,a=p.prevRow(),u=s,s=a?a.getHeight()/2:0))}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(c),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var r=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r)),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var r=this.touchMove?e.touches[0].pageX:e.pageX,n=this.touchMove?e.touches[0].pageY:e.pageY,a,o;a=i.getElement(),this.connection?(o=a.getBoundingClientRect(),this.startX=o.left-r+window.pageXOffset,this.startY=o.top-n+window.pageYOffset):this.startY=n-a.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),r=i.scrollTop,n=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+r;this.hoverElement.style.top=Math.min(n-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,r){this.dispatchExternal("movableRowsElementDrop",e,i,r?r.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(r=>{typeof r=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(r))):this.connectionElements.push(r)}),this.connectionElements.forEach(r=>{var n=a=>{this.elementRowDrop(a,r,this.moving)};r.addEventListener("mouseup",n),r.tabulatorElementDropEvent=n,r.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(r=>{r.type==="row"&&r.modules.moveRow&&r.modules.moveRow.mouseup&&r.getElement().addEventListener("mouseup",r.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,r){var n=!1;if(r){switch(typeof this.table.options.movableRowsSender){case"string":n=jp.senders[this.table.options.movableRowsSender];break;case"function":n=this.table.options.movableRowsSender;break}n?n.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var r=!1,n=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":r=jp.receivers[this.table.options.movableRowsReceiver];break;case"function":r=this.table.options.movableRowsReceiver;break}r?n=r.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),n?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:n})}commsReceived(e,i,r){switch(i){case"connect":return this.connect(e,r.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,r.row,r.success)}}};Ve(jp,"moduleName","moveRow"),Ve(jp,"senders",uve),Ve(jp,"receivers",cve);let D1=jp;var dve={};const mf=class mf extends ui{constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,r){return this.transformRow(i,"data",r)}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="mutator"+(n.charAt(0).toUpperCase()+n.slice(1)),o;e.definition[a]&&(o=this.lookupMutator(e.definition[a]),o&&(i=!0,r[a]={mutator:o,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.mutate=r)}lookupMutator(e){var i=!1;switch(typeof e){case"string":mf.mutators[e]?i=mf.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,r){var n="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),a;return this.enabled&&this.table.columnManager.traverse(o=>{var s,l,u;o.modules.mutate&&(s=o.modules.mutate[n]||o.modules.mutate.mutator||!1,s&&(a=o.getFieldValue(typeof r<"u"?r:e),(i=="data"&&!r||typeof a<"u")&&(u=o.getComponent(),l=typeof s.params=="function"?s.params(a,e,i,u):s.params,o.setFieldValue(e,s.mutator(a,e,i,l,u)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var r=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,n={};if(r)return n=Object.assign(n,e.row.getData()),e.column.setFieldValue(n,i),r.mutator(i,n,"edit",r.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(r=>{var n=e.row.getCell(r);n&&n.setValue(n.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}};Ve(mf,"moduleName","mutator"),Ve(mf,"mutators",dve);let P1=mf;function pve(t,e,i,r,n){var a=document.createElement("span"),o=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{o.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{c.innerHTML=d}),r?(s.innerHTML=" "+e+"-"+Math.min(e+t-1,r)+" ",u.innerHTML=" "+r+" ",a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(u),a.appendChild(c)):(s.innerHTML=" 0 ",a.appendChild(o),a.appendChild(s),a.appendChild(c)),a}function mve(t,e,i,r,n){var a=document.createElement("span"),o=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{o.innerHTML=d}),s.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),u.innerHTML=" "+n+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{c.innerHTML=d}),a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(u),a.appendChild(c),a}var hve={rows:pve,pages:mve};const mI=class mI extends ui{constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var r=this.table.rowManager,n=r.getDisplayRows(),a;return i?n.length?a=n[0]:r.activeRows.length&&(a=r.activeRows[r.activeRows.length-1],i=!1):n.length&&(a=n[n.length-1],i=!(n.length<this.size)),{index:a,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,r,n){return this.initialLoad||(this.progressiveLoad&&!r||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),n.page=this.page,this.size&&(n.size=this.size),n}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var r,n,a;!i&&!this.table.dataLoader.loading&&(r=this.table.rowManager.getElement(),n=r.scrollHeight-r.clientHeight-e,a=this.table.options.progressiveLoadScrollMargin||r.clientHeight*2,n<a&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var r=document.createElement("option");r.value=i,i===!0?this.langBind("pagination|all",function(n){r.innerHTML=n}):r.innerHTML=i,this.pageSizeSelect.appendChild(r)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=mI.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,r;e||(this.langBind("pagination|first",n=>{this.firstBut.innerHTML=n}),this.langBind("pagination|first_title",n=>{this.firstBut.setAttribute("aria-label",n),this.firstBut.setAttribute("title",n)}),this.langBind("pagination|prev",n=>{this.prevBut.innerHTML=n}),this.langBind("pagination|prev_title",n=>{this.prevBut.setAttribute("aria-label",n),this.prevBut.setAttribute("title",n)}),this.langBind("pagination|next",n=>{this.nextBut.innerHTML=n}),this.langBind("pagination|next_title",n=>{this.nextBut.setAttribute("aria-label",n),this.nextBut.setAttribute("title",n)}),this.langBind("pagination|last",n=>{this.lastBut.innerHTML=n}),this.langBind("pagination|last_title",n=>{this.lastBut.setAttribute("aria-label",n),this.lastBut.setAttribute("title",n)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",n=>{this.pageSizeSelect.setAttribute("aria-label",n),this.pageSizeSelect.setAttribute("title",n),i.innerHTML=n}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",n=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(r=document.querySelector(this.table.options.paginationCounterElement),r?r.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),r=i.indexOf(e);if(r>-1){var n=this.size===!0?1:Math.ceil((r+1)/this.size);return this.setPage(n)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,r){var n;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,r=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),n=this.pageCounter.call(this,i,r,this.page,e,this.max),typeof n){case"object":if(n instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(n)}else this.pageCounterElement.innerHTML="",n!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",n);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=n}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),r=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),n=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let a=r;a<=n;a++)a>0&&a<=this.max&&this.pagesElement.appendChild(this._generatePageButton(a));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",r=>{i.setAttribute("aria-label",r+" "+e),i.setAttribute("title",r+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",r=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,r,n,a,o,s=e.filter(l=>l.type==="row");if(this.mode=="local"){r=[],this.setMaxRows(e.length),this.size===!0?(n=0,a=e.length):(n=this.size*(this.page-1),a=n+parseInt(this.size)),this._setPageButtons();for(let l=n;l<a;l++){let u=e[l];u&&(r.push(u),u.type==="row"&&(o||(o=u),i++))}return this._setPageCounter(s.length,i,o?s.indexOf(o)+1:0),r}else return this._setPageButtons(),this._setPageCounter(s.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else this.dispatchExternal("pageLoaded",this.getPage());else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}};Ve(mI,"moduleName","page"),Ve(mI,"pageCounters",hve);let R1=mI;var fve={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,r=t+"-"+e,n=i.indexOf(r+"="),a,o;return n>-1&&(i=i.slice(n),a=i.indexOf(";"),a>-1&&(i=i.slice(0,a)),o=i.replace(r+"=","")),o?JSON.parse(o):!1}},gve={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var r=new Date;r.setDate(r.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+r.toUTCString()}};const Eo=class Eo extends ui{constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,r;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:Eo.readers[this.table.options.persistenceReaderFunc]?this.readFunc=Eo.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):Eo.readers[this.mode]?this.readFunc=Eo.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:Eo.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=Eo.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):Eo.writers[this.mode]?this.writeFunc=Eo.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(r=this.retrieveData("page"),r&&(typeof r.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=r.paginationSize),typeof r.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=r.paginationInitialPage))),this.config.group&&(r=this.retrieveData("group"),r&&(typeof r.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=r.groupBy),typeof r.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=r.groupStartOpen),typeof r.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=r.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,r;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(r=this.load("headerFilter"),r&&(this.table.options.initialHeaderFilter=r))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,r;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),r=this.config.columns===!0?Object.keys(i):this.config.columns,r.forEach(n=>{var a=Object.getOwnPropertyDescriptor(i,n),o=i[n];a&&Object.defineProperty(i,n,{set:s=>{o=s,this.defWatcherBlock||this.save("columns"),a.set&&a.set(s)},get:()=>(a.get&&a.get(),o)})}),this.defWatcherBlock=!1)}load(e,i){var r=this.retrieveData(e);return i&&(r=r?this.mergeDefinition(i,r):i),r}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,r){var n=[];return i=i||[],i.forEach((a,o)=>{var s=this._findColumn(e,a),l;s&&(r?l=Object.keys(a):this.config.columns===!0||this.config.columns==null?(l=Object.keys(s),l.push("width")):l=this.config.columns,l.forEach(u=>{u!=="columns"&&typeof a[u]<"u"&&(s[u]=a[u])}),s.columns&&(s.columns=this.mergeDefinition(s.columns,a.columns)),n.push(s))}),e.forEach((a,o)=>{var s=this._findColumn(i,a);s||(n.length>o?n.splice(o,0,a):n.push(a))}),n}_findColumn(e,i){var r=i.columns?"group":i.field?"field":"object";return e.find(function(n){switch(r){case"group":return n.title===i.title&&n.columns.length===i.columns.length;case"field":return n.field===i.field;case"object":return n===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],r=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(n=>{var a={},o=n.getDefinition(),s;n.isGroup?(a.title=o.title,a.columns=this.parseColumns(n.getColumns())):(a.field=n.getField(),this.config.columns===!0||this.config.columns==null?(s=Object.keys(o),s.push("width"),s.push("visible")):s=this.config.columns,s.forEach(l=>{switch(l){case"width":a.width=n.getWidth();break;case"visible":a.visible=n.visible;break;default:typeof o[l]!="function"&&r.indexOf(l)===-1&&(a[l]=o[l])}})),i.push(a)}),i}};Ve(Eo,"moduleName","persistence"),Ve(Eo,"moduleInitOrder",-10),Ve(Eo,"readers",fve),Ve(Eo,"writers",gve);let C1=Eo;class g7 extends ui{constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,r){this.loadPopupEvent(i,null,e,r)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadPopupEvent(r.column.definition[e],i,r)}loadPopupTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadPopupEvent(r.definition[e],i,r)}loadPopupEvent(e,i,r,n){var a;function o(s){a=s}r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent(),o):e,this.loadPopup(i,r,e,a,n)}loadPopup(e,i,r,n,a){var o=!(e instanceof MouseEvent),s,l;r instanceof HTMLElement?s=r:(s=document.createElement("div"),s.innerHTML=r),s.classList.add("tabulator-popup"),s.addEventListener("click",u=>{u.stopPropagation()}),o||e.preventDefault(),l=this.popup(s),typeof n=="function"&&l.renderCallback(n),e?l.show(e):l.show(i.getElement(),a||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}}Ve(g7,"moduleName","popup");class v7 extends ui{constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,r){var n=window.scrollX,a=window.scrollY,o=document.createElement("div"),s=document.createElement("div"),l=this.table.modules.export.generateTable(typeof r<"u"?r:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),u,c;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(o.classList.add("tabulator-print-header"),u=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof u=="string"?o.innerHTML=u:o.appendChild(u),this.element.appendChild(o)),this.element.appendChild(l),this.table.options.printFooter&&(s.classList.add("tabulator-print-footer"),c=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof c=="string"?s.innerHTML=c:s.appendChild(c),this.element.appendChild(s)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(n,a),this.manualBlock=!1}}Ve(v7,"moduleName","print");class I7 extends ui{constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,r;this.currentVersion++,r=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-push"),n.forEach(o=>{i.table.rowManager.addRowActual(o,!1)}),a=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),a}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-unshift"),n.forEach(o=>{i.table.rowManager.addRowActual(o,!0)}),a=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),a}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-shift"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[0]),n&&n.deleteActual()),a=i.origFuncs.shift.call(e),i.unblock("data-shift")),a}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-pop"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),n&&n.deleteActual()),a=i.origFuncs.pop.call(e),i.unblock("data-pop")),a}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a=n[0]<0?e.length+n[0]:n[0],o=n[1],s=n[2]?n.slice(2):!1,l,u;if(!i.blocked&&r===i.currentVersion){if(i.block("data-splice"),s&&(l=e[a]?i.table.rowManager.getRowFromDataObject(e[a]):!1,l?s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(s=s.slice().reverse(),s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),o!==0){var c=e.slice(a,typeof n[1]>"u"?n[1]:a+o);c.forEach((d,p)=>{var m=i.table.rowManager.getRowFromDataObject(d);m&&m.deleteActual(p!==c.length-1)})}(s||o!==0)&&i.table.rowManager.reRenderInPosition(),u=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return u}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var r in i)this.watchKey(e,i,r);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,r=e.getData()[this.table.options.dataTreeChildField],n={};r&&(n.push=r.push,Object.defineProperty(r,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var a=n.push.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-push")}return a}}),n.unshift=r.unshift,Object.defineProperty(r,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var a=n.unshift.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return a}}),n.shift=r.shift,Object.defineProperty(r,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var a=n.shift.call(r);this.rebuildTree(e),i.unblock("tree-shift")}return a}}),n.pop=r.pop,Object.defineProperty(r,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var a=n.pop.call(r);this.rebuildTree(e),i.unblock("tree-pop")}return a}}),n.splice=r.splice,Object.defineProperty(r,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var a=n.splice.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return a}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,r){var n=this,a=Object.getOwnPropertyDescriptor(i,r),o=i[r],s=this.currentVersion;Object.defineProperty(i,r,{set:l=>{if(o=l,!n.blocked&&s===n.currentVersion){n.block("key");var u={};u[r]=l,e.updateData(u),n.unblock("key")}a.set&&a.set(l)},get:()=>(a.get&&a.get(),o)})}unwatchRow(e){var i=e.getData();for(var r in i)Object.defineProperty(i,r,{value:i[r]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}Ve(I7,"moduleName","reactiveData");class y7 extends ui{constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1),this.registerTableOption("resizableColumnGuide",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(r=>{r.modules.resize&&r.modules.resize.handleEl&&(i&&(r.modules.resize.handleEl.style[e.modules.frozen.position]=i,r.modules.resize.handleEl.style["z-index"]=11),r.element.after(r.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,r,n){var a=this,o=!1,s=r.definition.resizable,l={},u=r.getLastColumn();if(e==="header"&&(o=r.definition.formatter=="textarea"||r.definition.variableHeight,l={variableHeight:o}),(s===!0||s==e)&&this._checkResizability(u)){var c=document.createElement("span");c.className="tabulator-col-resize-handle",c.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){a.startColumn=r,a.initialNextColumn=a.nextColumn=u.nextColumn(),a._mouseDown(p,u,c)};c.addEventListener("mousedown",d),c.addEventListener("touchstart",d,{passive:!0}),c.addEventListener("dblclick",p=>{var m=u.getWidth();p.stopPropagation(),u.reinitializeWidth(!0),m!==u.getWidth()&&(a.dispatch("column-resized",u),a.dispatchExternal("columnResized",u.getComponent()))}),r.modules.frozen&&(c.style.position="sticky",c.style[r.modules.frozen.position]=this.frozenColumnOffset(r)),l.handleEl=c,n.parentNode&&r.visible&&n.after(c)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}resize(e,i){var r=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n=r-this.startX,a=r-this.latestX,o,s;if(this.latestX=r,this.table.rtl&&(n=-n,a=-a),o=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(this.startWidth+n),s=i.width==i.minWidth||i.width==i.maxWidth,a<0&&(this.nextColumn=this.initialNextColumn),this.table.options.resizableColumnFit&&this.nextColumn&&!(o&&s)){let l=this.nextColumn.getWidth();a>0&&l<=this.nextColumn.minWidth&&(this.nextColumn=this.nextColumn.nextColumn()),this.nextColumn&&this.nextColumn.setWidth(this.nextColumn.getWidth()-a)}this.table.columnManager.rerenderColumns(!0),!this.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}calcGuidePosition(e,i,r){var n=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,a=r.getBoundingClientRect().x-this.table.element.getBoundingClientRect().x,o=this.table.element.getBoundingClientRect().x,s=i.element.getBoundingClientRect().left-o,l=n-this.startX,u=Math.max(a+l,s+i.minWidth);return i.maxWidth&&(u=Math.min(u,s+i.maxWidth)),u}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,r){var n=this,a;this.dispatchExternal("columnResizing",i.getComponent()),n.table.options.resizableColumnGuide&&(a=document.createElement("span"),a.classList.add("tabulator-col-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.left=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function o(l){n.table.options.resizableColumnGuide?a.style.left=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function s(l){n.table.options.resizableColumnGuide&&(n.resize(l,i),a.remove()),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!1),n.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",s),document.body.removeEventListener("mousemove",o),r.removeEventListener("touchmove",o),r.removeEventListener("touchend",s),n.table.element.classList.remove("tabulator-block-select"),n.startWidth!==i.getWidth()&&(n.table.columnManager.verticalAlignHeaders(),n.dispatch("column-resized",i),n.dispatchExternal("columnResized",i.getComponent()))}e.stopPropagation(),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!0),n.startX=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n.latestX=n.startX,n.startWidth=i.getWidth(),document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",s),r.addEventListener("touchmove",o,{passive:!0}),r.addEventListener("touchend",s)}}Ve(y7,"moduleName","resizeColumns");class b7 extends ui{constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1),this.registerTableOption("resizableRowGuide",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,r=e.getElement(),n=document.createElement("div");n.className="tabulator-row-resize-handle";var a=document.createElement("div");a.className="tabulator-row-resize-handle prev",n.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){i.startRow=e,i._mouseDown(l,e,n)};n.addEventListener("mousedown",o),n.addEventListener("touchstart",o,{passive:!0}),a.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){var u=i.table.rowManager.prevDisplayRow(e);u&&(i.startRow=u,i._mouseDown(l,u,a))};a.addEventListener("mousedown",s),a.addEventListener("touchstart",s,{passive:!0}),r.appendChild(n),r.appendChild(a)}resize(e,i){i.setHeight(this.startHeight+((typeof e.screenY>"u"?e.touches[0].screenY:e.screenY)-this.startY))}calcGuidePosition(e,i,r){var n=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,a=r.getBoundingClientRect().y-this.table.element.getBoundingClientRect().y,o=this.table.element.getBoundingClientRect().y,s=i.element.getBoundingClientRect().top-o,l=n-this.startY;return Math.max(a+l,s)}_mouseDown(e,i,r){var n=this,a;n.dispatchExternal("rowResizing",i.getComponent()),n.table.options.resizableRowGuide&&(a=document.createElement("span"),a.classList.add("tabulator-row-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.top=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function o(l){n.table.options.resizableRowGuide?a.style.top=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function s(l){n.table.options.resizableRowGuide&&(n.resize(l,i),a.remove()),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",o),r.removeEventListener("touchmove",o),r.removeEventListener("touchend",s),n.table.element.classList.remove("tabulator-block-select"),n.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),n.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,n.startHeight=i.getHeight(),document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",s),r.addEventListener("touchmove",o,{passive:!0}),r.addEventListener("touchend",s)}}Ve(b7,"moduleName","resizeRows");class w7 extends ui{constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.tableHeight!=n||this.tableWidth!=a)&&(this.tableHeight=n,this.tableWidth=a,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.containerHeight!=n||this.containerWidth!=a)&&(this.containerHeight=n,this.containerWidth=a,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}Ve(w7,"moduleName","resizeTable");function vve(t,e,i){var r=document.createElement("div"),n=t.getRow()._row.modules.responsiveLayout;r.classList.add("tabulator-responsive-collapse-toggle"),r.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function a(o){var s=n.element;n.open=o,s&&(n.open?(r.classList.add("open"),s.style.display=""):(r.classList.remove("open"),s.style.display="none"))}return r.addEventListener("click",function(o){o.stopImmediatePropagation(),a(!n.open),t.getTable().rowManager.adjustTableSize()}),a(n.open),r}var Ive={format:{formatters:{responsiveCollapse:vve}}};class E1 extends ui{constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.collapseFormatter&&(this.collapseFormatter=this.collapseFormatter.bind(this.table)),this.table.columnManager.columnsByIndex.forEach((i,r)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=r,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,r)=>{var n=r.modules.responsive.order-i.modules.responsive.order;return n||r.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),r=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(r<0){let n=this.columns[this.index];n?(this.hideColumn(n),this.index++):e=!1}else{let n=this.columns[this.index-1];n&&r>0&&r>=n.getWidth()?(this.showColumn(n),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,r;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);r=this.collapseFormatter(this.generateCollapsedRowData(e)),r&&i.appendChild(r),e.calcHeight(!0)}}generateCollapsedRowData(e){var i=e.getData(),r=[],n;return this.hiddenColumns.forEach(a=>{var o=a.getFieldValue(i);if(a.definition.title&&a.field)if(a.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let s=function(l){l()};n={value:!1,data:{},getValue:function(){return o},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return a.getComponent()},getTable:()=>this.table},r.push({field:a.field,title:a.definition.title,value:a.modules.format.formatter.call(this.table.modules.format,n,a.modules.format.params,s)})}else r.push({field:a.field,title:a.definition.title,value:o})}),r}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(r=>{var n=document.createElement("tr"),a=document.createElement("td"),o=document.createElement("td"),s,l=document.createElement("strong");a.appendChild(l),this.modules.localize.bind("columns|"+r.field,function(u){l.innerHTML=u||r.title}),r.value instanceof Node?(s=document.createElement("div"),s.appendChild(r.value),o.appendChild(s)):o.innerHTML=r.value,n.appendChild(a),n.appendChild(o),i.appendChild(n)}),Object.keys(e).length?i:""}}Ve(E1,"moduleName","responsiveLayout"),Ve(E1,"moduleExtensions",Ive);function yve(t,e,i){var r=document.createElement("input"),n=!1;if(r.type="checkbox",r.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(r.addEventListener("click",o=>{o.stopPropagation()}),typeof t.getRow=="function"){var a=t.getRow();a instanceof HD?(r.addEventListener("change",o=>{this.table.options.selectableRowsRangeMode==="click"&&n?n=!1:a.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&r.addEventListener("click",o=>{n=!0,this.table.modules.selectRow.handleComplexRowClick(a._row,o)}),r.checked=a.isSelected&&a.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(a,r)):r=""}else r.addEventListener("change",o=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(r);return r}var bve={format:{formatters:{rowSelection:yve}}};class M1 extends ui{constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,r){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,r=i.checkRowSelectability(e),n=e.getElement(),a=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",a)};e.modules.select={selected:!1},n.classList.toggle("tabulator-selectable",r),n.classList.toggle("tabulator-unselectable",!r),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?n.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(n.addEventListener("click",function(o){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),n.addEventListener("mousedown",function(o){if(o.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",a),document.body.addEventListener("keyup",a),i.toggleRow(e),!1}),n.addEventListener("mouseenter",function(o){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),n.addEventListener("mouseout",function(o){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var r=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),n=this.table.rowManager.getDisplayRowIndex(e),a=r<=n?r:n,o=r>=n?r:n,s=this.table.rowManager.getDisplayRows().slice(0),l=s.splice(a,o-a+1);i.ctrlKey||i.metaKey?(l.forEach(u=>{u!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(u):this.toggleRow(u))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],r,n;switch(typeof e){case"undefined":r=this.table.rowManager.rows;break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(a=>{n=this._selectRow(a,!0,!0),n&&i.push(n)}),this._rowSelectionChanged(!1,i)):r&&this._selectRow(r,!1,!0)}_selectRow(e,i,r){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!r&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var n=this.table.rowManager.findRow(e);if(n){if(this.selectedRows.indexOf(n)==-1)return n.getElement().classList.add("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!0,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!0),this.selectedRows.push(n),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!0),this.dispatchExternal("rowSelected",n.getComponent()),this._rowSelectionChanged(i,n),n}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var r=[],n,a;switch(typeof e){case"undefined":n=Object.assign([],this.selectedRows);break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(o=>{a=this._deselectRow(o,!0,!0),a&&r.push(a)}),this._rowSelectionChanged(i,[],r)):n&&this._deselectRow(n,i,!0)}_deselectRow(e,i){var r=this,n=r.table.rowManager.findRow(e),a,o;if(n){if(a=r.selectedRows.findIndex(function(s){return s==n}),a>-1)return o=n.getElement(),o&&o.classList.remove("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!1,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!1),r.selectedRows.splice(a,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!1),this.dispatchExternal("rowDeselected",n.getComponent()),r._rowSelectionChanged(i,void 0,n),n}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],r=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(n=>n.getComponent()),Array.isArray(r)||(r=[r]),r=r.map(n=>n.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,r))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var r=this.table.modules.dataTree.getChildren(e,!0,!0);if(i)for(let n of r)this._selectRow(n,!0);else for(let n of r)this._deselectRow(n,!0)}}Ve(M1,"moduleName","selectRow"),Ve(M1,"moduleExtensions",bve);class wve{constructor(e){return this._range=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._range.table.componentFunctionBinder.handle("range",i._range,r)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0,!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}class Uve extends Ka{constructor(e,i,r,n){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(r,n)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,r){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(r)}setStartBound(e){var i,r;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,r=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,r))}setEndBound(e){var i=this._getTableRows().length,r,n,a;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(r=e.row.position-1,n=e.column.getPosition()-1,a=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(r,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&a?this.setEnd(r,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,n):this.setEnd(r,n))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,r=this.table.columnManager.renderer.leftCol,n=this.table.columnManager.renderer.rightCol,a,o,s,l,u,c,d,p,m,h;this.table.options.renderHorizontal==="virtual"&&this.rangeManager.rowHeader&&(n+=1),e==null&&(e=0),i==null&&(i=1/0),r==null&&(r=0),n==null&&(n=1/0),this.overlaps(r,e,n,i)&&(a=Math.max(this.top,e),o=Math.min(this.bottom,i),s=Math.max(this.left,r),l=Math.min(this.right,n),u=this.rangeManager.getCell(a,s),c=this.rangeManager.getCell(o,l),d=u.getElement(),p=c.getElement(),m=u.row.getElement(),h=c.row.getElement(),this.element.classList.add("tabulator-range-active"),this.table.rtl?(this.element.style.right=m.offsetWidth-d.offsetLeft-d.offsetWidth+"px",this.element.style.width=d.offsetLeft+d.offsetWidth-p.offsetLeft+"px"):(this.element.style.left=m.offsetLeft+d.offsetLeft+"px",this.element.style.width=p.offsetLeft+p.offsetWidth-d.offsetLeft+"px"),this.element.style.top=m.offsetTop+"px",this.element.style.height=h.offsetTop+h.offsetHeight-m.offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,r,n){return!(this.left>r||e>this.right||this.top>n||i>this.bottom)}getData(){var e=[],i=this.getRows(),r=this.getColumns();return i.forEach(n=>{var a=n.getData(),o={};r.forEach(s=>{o[s.field]=a[s.field]}),e.push(o)}),e}getCells(e,i){var r=[],n=this.getRows(),a=this.getColumns();return e?r=n.map(o=>{var s=[];return o.getCells().forEach(l=>{a.includes(l.column)&&s.push(i?l.getComponent():l)}),s}):n.forEach(o=>{o.getCells().forEach(s=>{a.includes(s.column)&&r.push(i?s.getComponent():s)})}),r}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(r=>{r.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),r={start:null,end:null};return i.length?(r.start=i[0],r.end=i[i.length-1]):console.warn("No bounds defined on range"),r}getComponent(){return this.component||(this.component=new wve(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}}var Sve={rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},Tve={rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)}},Dve={range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,r=!1,n,a,o,s,l;return l=t.length,i&&(n=i.getBounds(),a=n.start,n.start===n.end&&(r=!0),a&&(e=this.table.rowManager.activeRows.slice(),o=e.indexOf(a.row),r?s=t.length:s=e.indexOf(n.end.row)-o+1,o>-1&&(this.table.blockRedraw(),e=e.slice(o,o+s),e.forEach((u,c)=>{u.updateData(t[c%l])}),this.table.restoreRedraw()))),e}},Pve={range:function(t){var e=[],i=[],r=this.table.modules.selectRange.activeRange,n=!1,a,o,s,l,u;return r&&(a=r.getBounds(),o=a.start,a.start===a.end&&(n=!0),o&&(t=t.split(`
`),t.forEach(function(c){e.push(c.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),u=l.indexOf(o.column),u>-1)))?(n?s=e[0].length:s=l.indexOf(a.end.column)-u+1,l=l.slice(u,u+s),e.forEach(c=>{var d={},p=c.length;l.forEach(function(m,h){d[m.field]=c[h%p]}),i.push(d)}),i):!1}},Rve={range:function(){var t=this.modules.selectRange.selectedColumns();return this.columnManager.rowHeader&&t.unshift(this.columnManager.rowHeader),t}},Cve={range:function(){return this.modules.selectRange.selectedRows()}},Eve={keybindings:{bindings:Sve,actions:Tve},clipboard:{pasteActions:Dve,pasteParsers:Pve},export:{columnLookups:Rve,rowLookups:Cve}};class BU extends ui{constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()),this.options("columns").findIndex(e=>e.frozen)>0&&console.warn("Having frozen column in arbitrary position with selectRange option may result in unpredictable behavior."),this.options("columns").filter(e=>e.frozen)>1&&console.warn("Having multiple frozen columns with selectRange option may result in unpredictable behavior."))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-moving",this.handleColumnMoving.bind(this)),this.subscribe("column-moved",this.handleColumnMoved.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){var e;this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior"))),this.table.modules.frozenColumns&&this.table.modules.frozenColumns.active&&(e=this.table.modules.frozenColumns.getFrozenColumns(),(e.length>1||e.length===1&&e[0]!==this.rowHeader)&&console.warn("Using frozen columns that are not the range header in combination with the selectRange option may result in unpredictable behavior"))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(r=>r.occupiesRow(e.row)):i=this.ranges.filter(r=>r.occupies(e)),i.map(r=>r.getComponent())}rowGetRanges(e){var i=this.ranges.filter(r=>r.occupiesRow(e));return i.map(r=>r.getComponent())}colGetRanges(e){var i=this.ranges.filter(r=>r.occupiesColumn(e));return i.map(r=>r.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;this.restoreFocus();try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(r=>r.occupiesColumn(e)),i&&this.ranges.forEach(r=>{var n=r.getColumns(!0);n.forEach(a=>{a!==e&&a.setWidth(e.width)})}))}handleColumnMoving(e,i){this.resetRanges().setBounds(i),this.overlay.style.visibility="hidden"}handleColumnMoved(e,i,r){this.activeRange.setBounds(e),this.layoutElement()}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||this.table.options.movableColumns&&this.selecting==="column"&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),r=this.ranges.findIndex(n=>n.occupies(e));i.classList.toggle("tabulator-range-selected",r!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=r}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e),i.preventDefault()}keyNavigateRange(e,i,r,n){this.navigate(r,n,i),e.preventDefault()}navigate(e,i,r){var n=!1,a,o,s,l,u,c;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(d=>d===this.activeRange?(d.setEnd(d.start.row,d.start.col),!0):(d.destroy(),!1))),a=this.activeRange,o=i?a.end:a.start,s=o.row,l=o.col,e)switch(r){case"left":l=this.findJumpCellLeft(a.start.row,o.col);break;case"right":l=this.findJumpCellRight(a.start.row,o.col);break;case"up":s=this.findJumpCellUp(o.row,a.start.col);break;case"down":s=this.findJumpCellDown(o.row,a.start.col);break}else{if(i&&(this.selecting==="row"&&(r==="left"||r==="right")||this.selecting==="column"&&(r==="up"||r==="down")))return;switch(r){case"left":l=Math.max(l-1,0);break;case"right":l=Math.min(l+1,this.getTableColumns().length-1);break;case"up":s=Math.max(s-1,0);break;case"down":s=Math.min(s+1,this.getTableRows().length-1);break}}if(this.rowHeader&&l===0&&(l=1),n=l!==o.col||s!==o.row,i||a.setStart(s,l),a.setEnd(s,l),i||(this.selecting="cell"),n)return u=this.getRowByRangePos(a.end.row),c=this.getColumnByRangePos(a.end.col),(r==="left"||r==="right")&&c.getElement().parentNode===null?c.getComponent().scrollTo(void 0,!1):(r==="up"||r==="down")&&u.getElement().parentNode===null?u.getComponent().scrollTo(void 0,!1):this.autoScroll(a,u.getElement(),c.getElement()),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpRow(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(o){return o.getData()[e.getField()]})}findJumpCol(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(o){return e.getData()[o.getField()]})}findJumpItem(e,i,r,n){var a;for(let o of r){let s=n(o);if(e){if(a=o,s)break}else if(i){if(a=o,s)break}else if(s)a=o;else break}return a}findJumpCellLeft(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),o=n[i-1]?this.isEmpty(r.getData()[n[i-1].getField()]):!1,s=this.rowHeader?n.slice(1,i):n.slice(0,i),l=this.findJumpCol(r,s,!0,a,o);return l?l.getPosition()-1:i}findJumpCellRight(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),o=n[i+1]?this.isEmpty(r.getData()[n[i+1].getField()]):!1,s=this.findJumpCol(r,n.slice(i+1,n.length),!1,a,o);return s?s.getPosition()-1:i}findJumpCellUp(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),o=n[e-1]?this.isEmpty(n[e-1].getData()[r.getField()]):!1,s=this.findJumpRow(r,n.slice(0,e),!0,a,o);return s?s.position-1:e}findJumpCellDown(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),o=n[e+1]?this.isEmpty(n[e+1].getData()[r.getField()]):!1,s=this.findJumpRow(r,n.slice(e+1,n.length),!1,a,o);return s?s.position-1:e}newSelection(e,i){var r;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){r=this.resetRanges(),this.selecting="all";var n,a=this.getCell(-1,-1);this.rowHeader?n=this.getCell(0,1):n=this.getCell(0,0),r.setBounds(n,a);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,r){var n=this.table.rowManager.element,a,o,s,l,u;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof r>"u"&&(r=this.getColumnByRangePos(e.end.col).getElement()),this.rowHeader&&(a=this.rowHeader.getElement()),o={left:r.offsetLeft,right:r.offsetLeft+r.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},s={left:n.scrollLeft,right:Math.ceil(n.scrollLeft+n.clientWidth),top:n.scrollTop,bottom:n.scrollTop+n.offsetHeight-this.table.rowManager.scrollbarWidth},a&&(s.left+=a.offsetWidth),l=s.left<o.left&&o.left<s.right&&s.left<o.right&&o.right<s.right,u=s.top<o.top&&o.top<s.bottom&&s.top<o.bottom&&o.bottom<s.bottom,l||(o.left<s.left?(n.scrollLeft=o.left,a&&(n.scrollLeft-=a.offsetWidth)):o.right>s.right&&(n.scrollLeft=o.right-n.clientWidth)),u||(o.top<s.top?n.scrollTop=o.top:o.bottom>s.bottom&&(n.scrollTop=o.bottom-n.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(r=>{r.type==="row"&&(this.layoutRow(r),r.cells.forEach(n=>this.renderCell(n)))}),this.getTableColumns().forEach(r=>{this.layoutColumn(r)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesRow(e));this.selecting==="row"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutColumn(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesColumn(e));this.selecting==="column"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutRanges(){var e,i,r;this.table.initialized&&(e=this.getActiveCell(),e&&(i=e.getElement(),r=e.row.getElement(),this.table.rtl?this.activeRangeCellElement.style.right=r.offsetWidth-i.offsetLeft-i.offsetWidth+"px":this.activeRangeCellElement.style.left=r.offsetLeft+i.offsetLeft+"px",this.activeRangeCellElement.style.top=r.offsetTop+"px",this.activeRangeCellElement.style.width=i.offsetWidth+"px",this.activeRangeCellElement.style.height=r.offsetHeight+"px",this.ranges.forEach(n=>n.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var r;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),r=this.table.rowManager.getRowFromPosition(e+1),r?r.getCells(!1,!0).filter(n=>n.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var r;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),r=new Uve(this.table,this,e,i),this.activeRange=r,this.ranges.push(r),this.rangeContainer.appendChild(r.element),r}resetRanges(){var e,i,r;return this.ranges.forEach(n=>n.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(r=this.table.rowManager.activeRows[0].cells.filter(n=>n.column.visible),i=r[this.rowHeader?1:0],i&&(e.setBounds(i),this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}isEmpty(e){return e==null||e===""}}Ve(BU,"moduleName","selectRange"),Ve(BU,"moduleInitOrder",1),Ve(BU,"moduleExtensions",Eve);function Mve(t,e,i,r,n,a,o){var s=o.alignEmptyValues,l=o.decimalSeparator,u=o.thousandSeparator,c=0;if(t=String(t),e=String(e),u&&(t=t.split(u).join(""),e=e.split(u).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))c=isNaN(e)?0:-1;else if(isNaN(e))c=1;else return t-e;return(s==="top"&&a==="desc"||s==="bottom"&&a==="asc")&&(c*=-1),c}function Nve(t,e,i,r,n,a,o){var s=o.alignEmptyValues,l=0,u;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof o.locale){case"boolean":o.locale&&(u=this.langLocale());break;case"string":u=o.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),u)}return(s==="top"&&a==="desc"||s==="bottom"&&a==="asc")&&(l*=-1),l}function Tx(t,e,i,r,n,a,o){var s=window.DateTime||luxon.DateTime,l=o.format||"dd/MM/yyyy HH:mm:ss",u=o.alignEmptyValues,c=0;if(typeof s<"u"){if(s.isDateTime(t)||(l==="iso"?t=s.fromISO(String(t)):t=s.fromFormat(String(t),l)),s.isDateTime(e)||(l==="iso"?e=s.fromISO(String(e)):e=s.fromFormat(String(e),l)),!t.isValid)c=e.isValid?-1:0;else if(!e.isValid)c=1;else return t-e;return(u==="top"&&a==="desc"||u==="bottom"&&a==="asc")&&(c*=-1),c}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function Ave(t,e,i,r,n,a,o){return o.format||(o.format="dd/MM/yyyy"),Tx.call(this,t,e,i,r,n,a,o)}function Ove(t,e,i,r,n,a,o){return o.format||(o.format="HH:mm"),Tx.call(this,t,e,i,r,n,a,o)}function kve(t,e,i,r,n,a,o){var s=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return s-l}function xve(t,e,i,r,n,a,o){var s=o.type||"length",l=o.alignEmptyValues,u=0;function c(d){var p;switch(s){case"length":p=d.length;break;case"sum":p=d.reduce(function(m,h){return m+h});break;case"max":p=Math.max.apply(null,d);break;case"min":p=Math.min.apply(null,d);break;case"avg":p=d.reduce(function(m,h){return m+h})/d.length;break}return p}if(!Array.isArray(t))u=Array.isArray(e)?-1:0;else if(!Array.isArray(e))u=1;else return c(e)-c(t);return(l==="top"&&a==="desc"||l==="bottom"&&a==="asc")&&(u*=-1),u}function Fve(t,e,i,r,n,a,o){var s=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return s-l}function Lve(t,e,i,r,n,a,o){var s,l,u,c,d=0,p,m=/(\d+)|(\D+)/g,h=/\d/,f=o.alignEmptyValues,g=0;if(!t&&t!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(s=String(t).toLowerCase(),l=String(e).toLowerCase(),s===l)return 0;if(!(h.test(s)&&h.test(l)))return s>l?1:-1;for(s=s.match(m),l=l.match(m),p=s.length>l.length?l.length:s.length;d<p;)if(u=s[d],c=l[d++],u!==c)return isFinite(u)&&isFinite(c)?(u.charAt(0)==="0"&&(u="."+u),c.charAt(0)==="0"&&(c="."+c),u-c):u>c?1:-1;return s.length>l.length}return(f==="top"&&a==="desc"||f==="bottom"&&a==="asc")&&(g*=-1),g}var _ve={number:Mve,string:Nve,date:Ave,time:Ove,datetime:Tx,boolean:kve,array:xve,exists:Fve,alphanum:Lve};const Gp=class Gp extends ui{constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,r,n){var a=this.getSort();return a.forEach(o=>{delete o.column}),n.sort=a,n}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,r,n;switch(typeof e.definition.sorter){case"string":Gp.sorters[e.definition.sorter]?i=Gp.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(r=e.getElement(),r.classList.add("tabulator-sortable"),n=document.createElement("div"),n.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":n.classList.add("tabulator-col-sorter-element");break;case"header":r.classList.add("tabulator-col-sorter-element");break;default:r.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":n.appendChild(this.table.options.headerSortElement);break;default:n.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(n),e.modules.sort.element=n,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&n.addEventListener("mousedown",a=>{a.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?n:r).addEventListener("click",a=>{var o="",s=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?o=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?o=e.modules.sort.dir=="asc"?"desc":"asc":o="none";else switch(e.modules.sort.dir){case"asc":o="desc";break;case"desc":o="asc";break;default:o=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(a.shiftKey||a.ctrlKey)?(s=this.getSort(),l=s.findIndex(u=>u.field===e.getField()),l>-1?(s[l].dir=o,l=s.splice(l,1)[0],o!="none"&&s.push(l)):o!="none"&&s.push({column:e,dir:o}),this.setSort(s)):o=="none"?this.clear():this.setSort(e,o),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(r){r.column&&i.push({column:r.column.getComponent(),field:r.column.getField(),dir:r.dir})}),i}setSort(e,i){var r=this,n=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(a){var o;o=r.table.columnManager.findColumn(a.column),o?(a.column=o,n.push(a),r.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",a.column)}),r.sortList=n,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],r="string",n,a;if(i&&(i=i.getData(),n=e.getField(),n))switch(a=e.getFieldValue(i),typeof a){case"undefined":r="string";break;case"boolean":r="boolean";break;default:!isNaN(a)&&a!==""?r="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(r="alphanum");break}return Gp.sorters[r]}sort(e,i){var r=this,n=this.table.options.sortOrderReverse?r.sortList.slice().reverse():r.sortList,a=[],o=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",r.getSort()),i||r.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(n.forEach(function(s,l){var u;s.column&&(u=s.column.modules.sort,u&&(u.sorter||(u.sorter=r.findSorter(s.column)),s.params=typeof u.params=="function"?u.params(s.column.getComponent(),s.dir):u.params,a.push(s)),i||r.setColumnHeader(s.column,s.dir))}),a.length&&r._sortItems(e,a)):i||n.forEach(function(s,l){r.setColumnHeader(s.column,s.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(s=>{o.push(s.getComponent())}),this.dispatchExternal("dataSorted",r.getSort(),o)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var r=e.modules.sort.element,n;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;r.firstChild;)r.removeChild(r.firstChild);n=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof n=="object"?r.appendChild(n):r.innerHTML=n}}_sortItems(e,i){var r=i.length-1;e.sort((n,a)=>{for(var o,s=r;s>=0;s--){let l=i[s];if(o=this._sortRow(n,a,l.column,l.dir,l.params),o!==0)break}return o})}_sortRow(e,i,r,n,a){var o,s,l=n=="asc"?e:i,u=n=="asc"?i:e;return e=r.getFieldValue(l.getData()),i=r.getFieldValue(u.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",o=l.getComponent(),s=u.getComponent(),r.modules.sort.sorter.call(this,e,i,o,s,r.getComponent(),n,a)}};Ve(Gp,"moduleName","sort"),Ve(Gp,"sorters",_ve);let N1=Gp;class $ve{constructor(e,i){this.columnCount=e,this.rowCount=i,this.columnString=[],this.columns=[],this.rows=[]}genColumns(e){var i=Math.max(this.columnCount,Math.max(...e.map(r=>r.length)));this.columnString=[],this.columns=[];for(let r=1;r<=i;r++)this.incrementChar(this.columnString.length-1),this.columns.push(this.columnString.join(""));return this.columns}genRows(e){var i=Math.max(this.rowCount,e.length);this.rows=[];for(let r=1;r<=i;r++)this.rows.push(r);return this.rows}incrementChar(e){let i=this.columnString[e];i?i!=="Z"?this.columnString[e]=String.fromCharCode(this.columnString[e].charCodeAt(0)+1):(this.columnString[e]="A",e?this.incrementChar(e-1):this.columnString.push("A")):this.columnString.push("A")}setRowCount(e){this.rowCount=e}setColumnCount(e){this.columnCount=e}}class U7{constructor(e){return this._sheet=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._sheet.table.componentFunctionBinder.handle("sheet",i._sheet,r)}})}getTitle(){return this._sheet.title}getKey(){return this._sheet.key}getDefinition(){return this._sheet.getDefinition()}getData(){return this._sheet.getData()}setData(e){return this._sheet.setData(e)}clear(){return this._sheet.clear()}remove(){return this._sheet.remove()}active(){return this._sheet.active()}setTitle(e){return this._sheet.setTitle(e)}setRows(e){return this._sheet.setRows(e)}setColumns(e){return this._sheet.setColumns(e)}}class AV extends Ka{constructor(e,i){super(e.table),this.spreadsheetManager=e,this.definition=i,this.title=this.definition.title||"",this.key=this.definition.key||this.definition.title,this.rowCount=this.definition.rows,this.columnCount=this.definition.columns,this.data=this.definition.data||[],this.element=null,this.isActive=!1,this.grid=new $ve(this.columnCount,this.rowCount),this.defaultColumnDefinition={width:100,headerHozAlign:"center",headerSort:!1},this.columnDefinition=Object.assign(this.defaultColumnDefinition,this.options("spreadsheetColumnDefinition")),this.columnDefs=[],this.rowDefs=[],this.columnFields=[],this.columns=[],this.rows=[],this.scrollTop=null,this.scrollLeft=null,this.initialize(),this.dispatchExternal("sheetAdded",this.getComponent())}initialize(){this.initializeElement(),this.initializeColumns(),this.initializeRows()}reinitialize(){this.initializeColumns(),this.initializeRows()}initializeElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tab"),this.element.innerText=this.title,this.element.addEventListener("click",()=>{this.spreadsheetManager.loadSheet(this)})}initializeColumns(){this.grid.setColumnCount(this.columnCount),this.columnFields=this.grid.genColumns(this.data),this.columnDefs=[],this.columnFields.forEach(e=>{var i=Object.assign({},this.columnDefinition);i.field=e,i.title=e,this.columnDefs.push(i)})}initializeRows(){var e;this.grid.setRowCount(this.rowCount),e=this.grid.genRows(this.data),this.rowDefs=[],e.forEach((i,r)=>{var n={_id:i},a=this.data[r];a&&a.forEach((o,s)=>{var l=this.columnFields[s];l&&(n[l]=o)}),this.rowDefs.push(n)})}unload(){this.isActive=!1,this.scrollTop=this.table.rowManager.scrollTop,this.scrollLeft=this.table.rowManager.scrollLeft,this.data=this.getData(!0),this.element.classList.remove("tabulator-spreadsheet-tab-active")}load(){var e=!this.isActive;this.isActive=!0,this.table.blockRedraw(),this.table.setData([]),this.table.setColumns(this.columnDefs),this.table.setData(this.rowDefs),this.table.restoreRedraw(),e&&this.scrollTop!==null&&(this.table.rowManager.element.scrollLeft=this.scrollLeft,this.table.rowManager.element.scrollTop=this.scrollTop),this.element.classList.add("tabulator-spreadsheet-tab-active"),this.dispatchExternal("sheetLoaded",this.getComponent())}getComponent(){return new U7(this)}getDefinition(){return{title:this.title,key:this.key,rows:this.rowCount,columns:this.columnCount,data:this.getData()}}getData(e){var i=[],r,n,a;return this.rowDefs.forEach(o=>{var s=[];this.columnFields.forEach(l=>{s.push(o[l])}),i.push(s)}),!e&&!this.options("spreadsheetOutputFull")&&(r=i.map(o=>o.findLastIndex(s=>typeof s<"u")+1),n=Math.max(...r),a=r.findLastIndex(o=>o>0)+1,i=i.slice(0,a),i=i.map(o=>o.slice(0,n))),i}setData(e){this.data=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}clear(){this.setData([])}setTitle(e){this.title=e,this.element.innerText=e,this.dispatchExternal("sheetUpdated",this.getComponent())}setRows(e){this.rowCount=e,this.initializeRows(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}setColumns(e){this.columnCount=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}remove(){this.spreadsheetManager.removeSheet(this)}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchExternal("sheetRemoved",this.getComponent())}active(){this.spreadsheetManager.loadSheet(this)}}class S7 extends ui{constructor(e){super(e),this.sheets=[],this.element=null,this.registerTableOption("spreadsheet",!1),this.registerTableOption("spreadsheetRows",50),this.registerTableOption("spreadsheetColumns",50),this.registerTableOption("spreadsheetColumnDefinition",{}),this.registerTableOption("spreadsheetOutputFull",!1),this.registerTableOption("spreadsheetData",!1),this.registerTableOption("spreadsheetSheets",!1),this.registerTableOption("spreadsheetSheetTabs",!1),this.registerTableOption("spreadsheetSheetTabsElement",!1),this.registerTableFunction("setSheets",this.setSheets.bind(this)),this.registerTableFunction("addSheet",this.addSheet.bind(this)),this.registerTableFunction("getSheets",this.getSheets.bind(this)),this.registerTableFunction("getSheetDefinitions",this.getSheetDefinitions.bind(this)),this.registerTableFunction("setSheetData",this.setSheetData.bind(this)),this.registerTableFunction("getSheet",this.getSheet.bind(this)),this.registerTableFunction("getSheetData",this.getSheetData.bind(this)),this.registerTableFunction("clearSheet",this.clearSheet.bind(this)),this.registerTableFunction("removeSheet",this.removeSheetFunc.bind(this)),this.registerTableFunction("activeSheet",this.activeSheetFunc.bind(this))}initialize(){this.options("spreadsheet")&&(this.subscribe("table-initialized",this.tableInitialized.bind(this)),this.subscribe("data-loaded",this.loadRemoteData.bind(this)),this.table.options.index="_id",this.options("spreadsheetData")&&this.options("spreadsheetSheets")&&(console.warn("You cannot use spreadsheetData and spreadsheetSheets at the same time, ignoring spreadsheetData"),this.table.options.spreadsheetData=!1),this.compatibilityCheck(),this.options("spreadsheetSheetTabs")&&this.initializeTabset())}compatibilityCheck(){this.options("data")&&console.warn("Do not use the data option when working with spreadsheets, use either spreadsheetData or spreadsheetSheets to pass data into the table"),this.options("pagination")&&console.warn("The spreadsheet module is not compatible with the pagination module"),this.options("groupBy")&&console.warn("The spreadsheet module is not compatible with the row grouping module"),this.options("responsiveCollapse")&&console.warn("The spreadsheet module is not compatible with the responsive collapse module")}initializeTabset(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tabs");var e=this.options("spreadsheetSheetTabsElement");e&&!(e instanceof HTMLElement)&&(e=document.querySelector(e),e||console.warn("Unable to find element matching spreadsheetSheetTabsElement selector:",this.options("spreadsheetSheetTabsElement"))),e?e.appendChild(this.element):this.footerAppend(this.element)}tableInitialized(){this.sheets.length?this.loadSheet(this.sheets[0]):this.options("spreadsheetSheets")?this.loadSheets(this.options("spreadsheetSheets")):this.options("spreadsheetData")&&this.loadData(this.options("spreadsheetData"))}loadRemoteData(e,i,r){return console.log("data",e,i,r),Array.isArray(e)?(this.table.dataLoader.clearAlert(),this.dispatchExternal("dataLoaded",e),!e.length||Array.isArray(e[0])?this.loadData(e):this.loadSheets(e)):console.error(`Spreadsheet Loading Error - Unable to process remote data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e),!1}loadData(e){var i={data:e};this.loadSheet(this.newSheet(i))}destroySheets(){this.sheets.forEach(e=>{e.destroy()}),this.sheets=[],this.activeSheet=null}loadSheets(e){Array.isArray(e)||(e=[]),this.destroySheets(),e.forEach(i=>{this.newSheet(i)}),this.loadSheet(this.sheets[0])}loadSheet(e){this.activeSheet!==e&&(this.activeSheet&&this.activeSheet.unload(),this.activeSheet=e,e.load())}newSheet(e={}){var i;return e.rows||(e.rows=this.options("spreadsheetRows")),e.columns||(e.columns=this.options("spreadsheetColumns")),i=new AV(this,e),this.sheets.push(i),this.element&&this.element.appendChild(i.element),i}removeSheet(e){var i=this.sheets.indexOf(e),r;this.sheets.length>1?i>-1&&(this.sheets.splice(i,1),e.destroy(),this.activeSheet===e&&(r=this.sheets[i-1]||this.sheets[0],r?this.loadSheet(r):this.activeSheet=null)):console.warn("Unable to remove sheet, at least one sheet must be active")}lookupSheet(e){return e?e instanceof AV?e:e instanceof U7?e._sheet:this.sheets.find(i=>i.key===e)||!1:this.activeSheet}setSheets(e){return this.loadSheets(e),this.getSheets()}addSheet(e){return this.newSheet(e).getComponent()}getSheetDefinitions(){return this.sheets.map(e=>e.getDefinition())}getSheets(){return this.sheets.map(e=>e.getComponent())}getSheet(e){var i=this.lookupSheet(e);return i?i.getComponent():!1}setSheetData(e,i){e&&!i&&(i=e,e=!1);var r=this.lookupSheet(e);return r?r.setData(i):!1}getSheetData(e){var i=this.lookupSheet(e);return i?i.getData():!1}clearSheet(e){var i=this.lookupSheet(e);return i?i.clear():!1}removeSheetFunc(e){var i=this.lookupSheet(e);i&&this.removeSheet(i)}activeSheetFunc(e){var i=this.lookupSheet(e);return i?this.loadSheet(i):!1}}Ve(S7,"moduleName","spreadsheet");class T7 extends ui{constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,r){var n=e==="tooltip"?r.column.definition.tooltip:r.definition.headerTooltip;n&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,r,n),this.table.options.tooltipDelay))}mouseoutCheck(e,i,r){this.popupInstance||this.clearPopup()}clearPopup(e,i,r){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,r){var n,a,o;function s(l){a=l}typeof r=="function"&&(r=r(e,i.getComponent(),s)),r instanceof HTMLElement?n=r:(n=document.createElement("div"),r===!0&&(i instanceof _b?r=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{n.innerHTML=r=l||i.definition.title}):r=i.definition.title),n.innerHTML=r),(r||r===0||r===!1)&&(n.classList.add("tabulator-tooltip"),n.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(n),typeof a=="function"&&this.popupInstance.renderCallback(a),o=this.popupInstance.containerEventCoords(e),this.popupInstance.show(o.x+15,o.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}}Ve(T7,"moduleName","tooltip");var Bve={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(/^[a-z0-9]+$/i);return r.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(i);return r.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=!0,n=t.getData(),a=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(o){var s=o.getData();s!==n&&e==a.getFieldValue(s)&&(r=!1)}),r},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};const hI=class hI extends ui{constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,r){var n=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return n!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,n)}),n}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(r=>{r=r.getComponent();var n=r.validate();n!==!0&&(i=i.concat(n))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,r=[],n;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(a=>{n=i._extractValidator(a),n&&r.push(n)}):(n=this._extractValidator(e.definition.validator),n&&r.push(n)),e.modules.validate=r.length?r:!1)}_extractValidator(e){var i,r,n;switch(typeof e){case"string":return n=e.indexOf(":"),n>-1?(i=e.substring(0,n),r=e.substring(n+1)):i=e,this._buildValidator(i,r);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var r=typeof e=="function"?e:hI.validators[e];return r?{type:typeof e=="function"?"function":e,func:r,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,r){var n=this,a=[],o=this.invalidCells.indexOf(i);return e&&e.forEach(s=>{s.func.call(n,i.getComponent(),r,s.params)||a.push({type:s.type,parameters:s.params})}),i.modules.validate||(i.modules.validate={}),a.length?(i.modules.validate.invalid=a,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),o==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),o>-1&&this.invalidCells.splice(o,1)),a.length?a:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}};Ve(hI,"moduleName","validate"),Ve(hI,"validators",Bve);let A1=hI;var DC=Object.freeze({__proto__:null,AccessorModule:d1,AjaxModule:h1,ClipboardModule:f1,ColumnCalcsModule:g1,DataTreeModule:l7,DownloadModule:v1,EditModule:I1,ExportModule:y1,FilterModule:b1,FormatModule:w1,FrozenColumnsModule:u7,FrozenRowsModule:c7,GroupRowsModule:d7,HistoryModule:U1,HtmlTableImportModule:p7,ImportModule:S1,InteractionModule:m7,KeybindingsModule:T1,MenuModule:h7,MoveColumnsModule:f7,MoveRowsModule:D1,MutatorModule:P1,PageModule:R1,PersistenceModule:C1,PopupModule:g7,PrintModule:v7,ReactiveDataModule:I7,ResizeColumnsModule:y7,ResizeRowsModule:b7,ResizeTableModule:w7,ResponsiveLayoutModule:E1,SelectRangeModule:BU,SelectRowModule:M1,SortModule:N1,SpreadsheetModule:S7,TooltipModule:T7,ValidateModule:A1}),Vve={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{}};class D7{constructor(e,i,r={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},r)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var r=Object.assign({},this.registeredDefaults),n=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(r,e);for(let a in i)r.hasOwnProperty(a)||(n&&console.warn("Invalid "+this.msgType+" option:",a),r[a]=i.key);for(let a in r)a in i?r[a]=i[a]:Array.isArray(r[a])?r[a]=Object.assign([],r[a]):typeof r[a]=="object"&&r[a]!==null?r[a]=Object.assign({},r[a]):typeof r[a]>"u"&&delete r[a];return r}}class WD extends Ka{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,r){var n=this.rows().indexOf(e),a=e.getElement(),o=0;return new Promise((s,l)=>{if(n>-1){if(typeof r>"u"&&(r=this.table.options.scrollToRowIfVisible),!r&&kr.elVisible(a)&&(o=kr.elOffset(a).top-kr.elOffset(this.elementVertical).top,o>0&&o<this.elementVertical.clientHeight-a.offsetHeight))return s(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(a.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-a.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-a.offsetTop)+a.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+a.offsetHeight;break;case"top":this.elementVertical.scrollTop=a.offsetTop;break}s()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class jve extends WD{constructor(e){super(e)}renderRowCells(e,i){const r=document.createDocumentFragment();e.cells.forEach(n=>{r.appendChild(n.getElement())}),e.element.appendChild(r),i||e.cells.forEach(n=>{n.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class Gve extends WD{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var r=i.getWidth();r>e&&(e=r)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var r={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},n=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(a=>{var o={},s;a.visible&&(a.modules.frozen||(s=a.getWidth(),o.leftPos=n,o.rightPos=n+s,o.width=s,this.isFitData&&(o.fitDataCheck=a.modules.vdomHoz?a.modules.vdomHoz.fitDataCheck:!0),n+s>this.vDomScrollPosLeft&&n<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=n),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=s),this.columns.push(a),a.modules.vdomHoz=o,n+=s))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(r))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(r=>{i.appendChild(r.getElement())}),e.element.appendChild(i),e.cells.forEach(r=>{r.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++)this.columns[i].reinitializeWidth()}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,r;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(n=>{!n.definition.width&&n.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){r=i.getElement(),i.generateCells(),this.tableElement.appendChild(r);for(let n=0;n<i.cells.length;n++){let a=i.cells[n];r.appendChild(a.getElement()),a.column.reinitializeWidth()}r.parentNode.removeChild(r),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((r,n)=>{r!==this.columns[n]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));e.forEach(r=>{this.reinitializeRow(r,!0)}),i.forEach(r=>{r.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,r){for(let n=e;n<i;n++){let a=this.columns[n];a.modules.vdomHoz.leftPos+=r,a.modules.vdomHoz.rightPos+=r}}addColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol+1];r&&r.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);n.getElement().insertBefore(a.getElement(),n.getCell(this.columns[this.rightCol]).getElement().nextSibling),a.cellRendered()}}),this.fitDataColActualWidthCheck(r),this.rightCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=r.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol-1];if(r)if(r.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(a=>{if(a.type!=="group"){var o=a.getCell(r);a.getElement().insertBefore(o.getElement(),a.getCell(this.columns[this.leftCol]).getElement()),o.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(a=>{a.type!=="group"&&(a.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=r.getWidth();let n=this.fitDataColActualWidthCheck(r);n&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+n,this.vDomPadRight-=n)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol];r&&r.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(o){console.warn("Could not removeColRight",o.message)}}}),this.vDomPadRight+=r.getWidth(),this.rightCol--,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol];r&&r.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(o){console.warn("Could not removeColLeft",o.message)}}}),this.vDomPadLeft+=r.getWidth(),this.leftCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,r;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),r=i-e.modules.vdomHoz.width,r&&(e.modules.vdomHoz.rightPos+=r,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,r)),e.modules.vdomHoz.fitDataCheck=!1),r}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let r=e.getCell(i);e.getElement().appendChild(r.getElement()),r.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var r=e.getElement();r.firstChild;)r.removeChild(r.firstChild);this.initializeRow(e)}}}class Hve extends Ka{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new D7(this.table,"column definition",s7),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:Gve,basic:jve};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],r={},n=this.table.options.autoColumns==="full"?e:[e[0]],a=this.table.options.autoColumnsDefinitions;if(e&&e.length){if(n.forEach(o=>{Object.keys(o).forEach((s,l)=>{let u=o[s],c;r[s]?r[s]!==!0&&typeof u<"u"&&(r[s].sorter=this.calculateSorterFromValue(u),r[s]=!0):(c={field:s,title:s,sorter:this.calculateSorterFromValue(u)},i.splice(l,0,c),r[s]=typeof u>"u"?c:!0)})}),a)switch(typeof a){case"function":this.table.options.columns=a.call(this.table,i);break;case"object":Array.isArray(a)?i.forEach(o=>{var s=a.find(l=>l.field===o.field);s&&Object.assign(o,s)}):i.forEach(o=>{a[o.field]&&Object.assign(o,a[o.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}calculateSorterFromValue(e){var i;switch(typeof e){case"undefined":i="string";break;case"boolean":i="boolean";break;case"number":i="number";break;case"object":Array.isArray(e)?i="array":i="string";break;default:!isNaN(e)&&e!==""?i="number":e.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?i="alphanum":i="string";break}return i}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.dispatchExternal("columnsLoading"),this.table.options.rowHeader&&(this.rowHeader=new im(this.table.options.rowHeader===!0?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),e.forEach((r,n)=>{this._addColumn(r)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.subscribedExternal("columnsLoaded")&&this.dispatchExternal("columnsLoaded",this.getComponents()),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,r){var n=new im(e,this),a=n.getElement(),o=r&&this.findColumnIndex(r);if(i&&this.rowHeader&&(!r||r===this.rowHeader)&&(i=!1,r=this.rowHeader,o=0),r&&o>-1){var s=r.getTopColumn(),l=this.columns.indexOf(s),u=s.getElement();i?(this.columns.splice(l,0,n),u.parentNode.insertBefore(a,u)):(this.columns.splice(l+1,0,n),u.parentNode.insertBefore(a,u.nextSibling))}else i?(this.columns.unshift(n),this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)):(this.columns.push(n),this.headersElement.appendChild(n.getElement()));return n.columnRendered(),n}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var r=i.getHeight();r>e&&(e=r)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof im)return e;if(e instanceof o7)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}),i.find(n=>n.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(r=>{var n=this.table.options.nestedFieldSeparator?r.split(this.table.options.nestedFieldSeparator)[0]:r;n===e&&i.push(this.columnsByField[r])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,r)=>{e(i,r)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(r=>{(!e||e&&r.visible)&&i.push(r.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],r=e?this.columns:this.columnsByIndex;return r.forEach(n=>{i.push(n.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,r){i.element.parentNode.insertBefore(e.element,i.element),r&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,r),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,r){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,r):this._moveColumnInArray(this.columns,e,i,r),this._moveColumnInArray(this.columnsByIndex,e,i,r,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,r),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,r,n,a){var o=e.indexOf(i),s,l=[];o>-1&&(e.splice(o,1),s=e.indexOf(r),s>-1?n&&(s=s+1):s=o,e.splice(s,0,i),a&&(l=this.chain("column-moving-rows",[i,r,n],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(u){if(u.cells.length){var c=u.cells.splice(o,1)[0];u.cells.splice(s,0,c)}})))}scrollToColumn(e,i,r){var n=0,a=e.getLeftOffset(),o=0,s=e.getElement();return new Promise((l,u)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof r>"u"&&(r=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":o=-this.element.clientWidth/2;break;case"right":o=s.clientWidth-this.headersElement.clientWidth;break}if(!r&&a>0&&a+s.offsetWidth<this.element.clientWidth)return!1;n=a+o,n=Math.max(Math.min(n,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(n),this.scrollHorizontal(n),l()}else console.warn("Scroll Error - Column not visible"),u("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(r=>{i.push(r.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(r){var n,a,o;r.visible&&(n=r.definition.width||0,a=parseInt(r.minWidth),typeof n=="string"?n.indexOf("%")>-1?o=e/100*parseInt(n):o=parseInt(n):o=n,i+=o>a?o:a)}),i}addColumn(e,i,r){return new Promise((n,a)=>{var o=this._addColumn(e,i,r);this._reIndexColumns(),this.dispatch("column-add",e,i,r),this.layoutMode()!="fitColumns"&&o.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),n(o)})}deregisterColumn(e){var i=e.getField(),r;i&&delete this.columnsByField[i],r=this.columnsByIndex.indexOf(e),r>-1&&this.columnsByIndex.splice(r,1),r=this.columns.indexOf(e),r>-1&&this.columns.splice(r,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){kr.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class zve extends WD{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,r=document.createDocumentFragment(),n=this.rows();n.forEach((a,o)=>{this.styleRow(a,o),a.initialize(!1,!0),a.type!=="group"&&(i=!1),r.appendChild(a.getElement())}),e.appendChild(r),n.forEach(a=>{a.rendered(),a.heightInitialized||a.calcHeight(!0)}),n.forEach(a=>{a.heightInitialized||a.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=kr.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=kr.elOffset(i).top-kr.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class Wve extends WD{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,r=!1,n=!1,a=this.table.rowManager.scrollLeft,o=this.rows(),s=this.vDomTop;s<=this.vDomBottom;s++)if(o[s]){var l=i-o[s].getElement().offsetTop;if(n===!1||Math.abs(l)<n)n=l,r=s;else break}o.forEach(u=>{u.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(r===!1?this.rows.length-1:r,!0,n||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(a)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var r=e-this.vDomScrollPosTop,n=e-this.vDomScrollPosBottom,a=this.vDomWindowBuffer*2,o=this.rows();if(this.scrollTop=e,-r>a||n>a){var s=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*o.length)),this.scrollColumns(s)}else i?(r<0&&this._addTopRow(o,-r),n<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(o,-n):this.vDomScrollPosBottom=this.scrollTop)):(n>=0&&this._addBottomRow(o,n),r>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(o,r):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,r=this.elementVertical.clientHeight+i,n=!1,a=0,o=0,s=this.rows();if(e)a=this.vDomTop,o=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(s[l])if(n)if(r-s[l].getElement().offsetTop>=0)o=l;else break;else if(i-s[l].getElement().offsetTop>=0)a=l;else if(n=!0,r-s[l].getElement().offsetTop>=0)o=l;else break;return s.slice(a,o+1)}_virtualRenderFill(e,i,r){var n=this.tableElement,a=this.elementVertical,o=0,s=0,l=0,u=0,c=0,d=0,p=this.rows(),m=p.length,h=0,f,g,v=[],y=0,I=0,b=this.table.rowManager.fixedHeight,S=this.elementVertical.clientHeight,w=this.table.options.rowHeight,U=!0;if(e=e||0,r=r||0,!e)this.clear();else{for(;n.firstChild;)n.removeChild(n.firstChild);u=(m-e+1)*this.vDomRowHeight,u<S&&(e-=Math.ceil((S-u)/this.vDomRowHeight),e<0&&(e=0)),o=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=o}if(m&&kr.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,b||this.table.options.maxHeight?(w&&(I=S/w+this.vDomWindowBuffer/w),I=Math.max(this.vDomWindowMinTotalRows,Math.ceil(I))):I=m;(I==m||s<=S+this.vDomWindowBuffer||y<this.vDomWindowMinTotalRows)&&this.vDomBottom<m-1;){for(v=[],g=document.createDocumentFragment(),d=0;d<I&&this.vDomBottom<m-1;)h=this.vDomBottom+1,f=p[h],this.styleRow(f,h),f.initialize(!1,!0),!f.heightInitialized&&!this.table.options.rowHeight&&f.clearCellHeight(),g.appendChild(f.getElement()),v.push(f),this.vDomBottom++,d++;if(!v.length)break;n.appendChild(g),v.forEach(T=>{T.rendered(),T.heightInitialized||T.calcHeight(!0)}),v.forEach(T=>{T.heightInitialized||T.setCellHeight()}),v.forEach(T=>{l=T.getHeight(),y<o?c+=l:s+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),y++}),U=this.table.rowManager.adjustTableSize(),S=this.elementVertical.clientHeight,U&&(b||this.table.options.maxHeight)&&(w=s/y,I=Math.max(this.vDomWindowMinTotalRows,Math.ceil(S/w+this.vDomWindowBuffer/w)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+r:this.scrollTop-c,this.vDomBottomPad=this.vDomBottom==m-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-s-c,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((s+c)/y),this.vDomBottomPad=this.vDomRowHeight*(m-this.vDomBottom-1),this.vDomScrollHeight=c+s+this.vDomBottomPad-S),n.style.paddingTop=this.vDomTopPad+"px",n.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+c+r-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-S:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-S),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-S),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,a.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var r=this.tableElement,n=[],a=0,o=this.vDomTop-1,s=0,l=!0;l;)if(this.vDomTop){let u=e[o],c,d;u&&s<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,o),r.insertBefore(u.getElement(),r.firstChild),(!u.initialized||!u.heightInitialized)&&n.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomTop--,o--,s++):l=!1):l=!1}else l=!1;for(let u of n)u.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomTopPad-=a,this.vDomTopPad<0&&(this.vDomTopPad=o*this.vDomRowHeight),o<1&&(this.vDomTopPad=0),r.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=a)}_removeTopRow(e,i){for(var r=[],n=0,a=0,o=!0;o;){let s=e[this.vDomTop],l;s&&a<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,n+=l,r.push(s),a++):o=!1):o=!1}for(let s of r){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomTopPad+=n,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?n:n+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var r=this.tableElement,n=[],a=0,o=this.vDomBottom+1,s=0,l=!0;l;){let u=e[o],c,d;u&&s<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,o),r.appendChild(u.getElement()),(!u.initialized||!u.heightInitialized)&&n.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomBottom++,o++,s++):l=!1):l=!1}for(let u of n)u.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomBottomPad-=a,(this.vDomBottomPad<0||o==e.length-1)&&(this.vDomBottomPad=0),r.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=a)}_removeBottomRow(e,i){for(var r=[],n=0,a=0,o=!0;o;){let s=e[this.vDomBottom],l;s&&a<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,n+=l,r.push(s),a++):o=!1):o=!1}for(let s of r){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomBottomPad+=n,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=n)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class qve extends Ka{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let r=document.createElement("div");r.classList.add("tabulator-placeholder-contents"),r.innerHTML=e,i.appendChild(r),this.placeholderContents=r}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,r=this.element.scrollTop,n=this.scrollTop>r;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=r&&(this.scrollTop=r,this.renderer.scrollRows(r,n),this.dispatch("scroll-vertical",r,n),this.dispatchExternal("scrollVertical",r,n))})}findRow(e){if(typeof e=="object"){if(e instanceof io)return e;if(e instanceof HD)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(r=>r.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(r=>r.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(r=>r.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.type==="row"&&i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,r){return this.renderer.scrollToRowPosition(e,i,r)}setData(e,i,r){return new Promise((n,a)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&r&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),n()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((r,n)=>{if(r&&typeof r=="object"){var a=new io(r,this);this.rows.push(a)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",r)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var r=this.rows.indexOf(e),n=this.activeRows.indexOf(e);n>-1&&this.activeRows.splice(n,1),r>-1&&this.rows.splice(r,1),this.setActiveRows(this.activeRows),this.displayRowIterator(a=>{var o=a.indexOf(e);o>-1&&a.splice(o,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,r,n){var a=this.addRowActual(e,i,r,n);return a}addRows(e,i,r,n){var a=[];return new Promise((o,s)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof r>"u"&&i||typeof r<"u"&&!i)&&e.reverse(),e.forEach((l,u)=>{var c=this.addRow(l,i,r,!0);a.push(c),this.dispatch("row-added",c,l,i,r)}),this.refreshActiveData(n?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),o(a)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,r,n){var a=e instanceof io?e:new io(e||{},this),o=this.findAddRowPos(i),s=-1,l,u;return r||(u=this.chain("row-adding-position",[a,o],null,{index:r,top:o}),r=u.index,o=u.top),typeof r<"u"&&(r=this.findRow(r)),r=this.chain("row-adding-index",[a,r,o],null,r),r&&(s=this.rows.indexOf(r)),r&&s>-1?(l=this.activeRows.indexOf(r),this.displayRowIterator(function(c){var d=c.indexOf(r);d>-1&&c.splice(o?d:d+1,0,a)}),l>-1&&this.activeRows.splice(o?l:l+1,0,a),this.rows.splice(o?s:s+1,0,a)):o?(this.displayRowIterator(function(c){c.unshift(a)}),this.activeRows.unshift(a),this.rows.unshift(a)):(this.displayRowIterator(function(c){c.push(a)}),this.activeRows.push(a),this.rows.push(a)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",a.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),n||this.reRenderInPosition(),a}moveRow(e,i,r){this.dispatch("row-move",e,i,r),this.moveRowActual(e,i,r),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,r),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,r){this.moveRowInArray(this.rows,e,i,r),this.moveRowInArray(this.activeRows,e,i,r),this.displayRowIterator(n=>{this.moveRowInArray(n,e,i,r)}),this.dispatch("row-moving",e,i,r)}moveRowInArray(e,i,r,n){var a,o,s,l;if(i!==r&&(a=e.indexOf(i),a>-1&&(e.splice(a,1),o=e.indexOf(r),o>-1?n?e.splice(o+1,0,i):e.splice(o,0,i):e.splice(a,0,i)),e===this.getDisplayRows())){s=a<o?a:o,l=o>a?o:a+1;for(let u=s;u<=l;u++)e[u]&&this.styleRow(e[u],u)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r!==!1&&r<this.displayRowsCount-1&&(n=this.getDisplayRows()[r+1]),n&&(!(n instanceof io)||n.type!="row")?this.nextDisplayRow(n,i):n}prevDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r&&(n=this.getDisplayRows()[r-1]),i&&n&&(!(n instanceof io)||n.type!="row")?this.prevDisplayRow(n,i):n}findRowIndex(e,i){var r;return e=this.findRow(e),e&&(r=i.indexOf(e),r>-1)?r:!1}getData(e,i){var r=[],n=this.getRows(e);return n.forEach(function(a){a.type=="row"&&r.push(a.getData(i||"data"))}),r}getComponents(e){var i=[],r=this.getRows(e);return r.forEach(function(n){i.push(n.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,r){var n=this.table,a="",o=0,s=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(o=this.dataPipeline.findIndex(l=>l.handler===e),o>-1)a="dataPipeline",i&&(o==this.dataPipeline.length-1?a="display":o++);else if(o=this.displayPipeline.findIndex(l=>l.handler===e),o>-1)a="displayPipeline",i&&(o==this.displayPipeline.length-1?a="end":o++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else a=e||"all",o=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===a&&o<this.redrawBlockRestoreConfig.index||s.indexOf(a)<s.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:r,stage:a,index:o});return}else kr.elVisible(this.element)?r?this.reRenderInPosition(this.refreshPipelines.bind(this,e,a,o,r)):(this.refreshPipelines(e,a,o,r),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),n.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,a,o,r),this.dispatch("data-refreshed")}}refreshPipelines(e,i,r,n){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let a=r;a<this.dataPipeline.length;a++){let o=this.dataPipeline[a].handler(this.activeRowsPipeline[a].slice(0));this.activeRowsPipeline[a+1]=o||this.activeRowsPipeline[a].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":r=0,this.resetDisplayRows();case"displayPipeline":for(let a=r;a<this.displayPipeline.length;a++){let o=this.displayPipeline[a].handler((a?this.getDisplayRows(a-1):this.activeRows).slice(0),n);this.setDisplayRows(o||this.getDisplayRows(a-1).slice(0),a)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(r=>{r.type==="row"&&(r.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var r=Object.assign([],this.renderer.visibleRows(!i));return e&&(r=this.chain("rows-visible",[i],r,r)),r}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:Wve,basic:zve};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}normalizeHeight(){this.activeRows.forEach(function(e){e.normalizeHeight()})}adjustTableSize(){let e=this.element.clientHeight,i,r=!1;if(this.renderer.verticalFillMode==="fill"){let n=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const a="calc(100% - "+n+"px)";this.element.style.minHeight=i||"calc(100% - "+n+"px)",this.element.style.height=a,this.element.style.maxHeight=a}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-n+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(r=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),r}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class Yve extends Ka{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){if(this.table.options.footerElement)switch(typeof this.table.options.footerElement){case"string":this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement;break}}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class Kve extends Ka{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,r){this.pseudoTrackers[e].target!==r&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=r,this.dispatch(e+"-mouseenter",i,r))}pseudoMouseLeave(e,i){var r=Object.keys(this.pseudoTrackers),n={row:["cell"],cell:["row"]};r=r.filter(a=>{var o=n[e];return a!==e&&(!o||o&&!o.includes(a))}),r.forEach(a=>{var o=this.pseudoTrackers[a].target;this.pseudoTrackers[a].target&&(this.dispatch(a+"-mouseleave",i,o),this.pseudoTrackers[a].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let r of i)for(let n of e){let a=r+"-"+n;this.subscriptionChange(a,this.subscriptionChanged.bind(this,r,n))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,r){var n=this.listeners[i].components,a=n.indexOf(e),o=!1;r?a===-1&&(n.push(e),o=!0):this.subscribed(e+"-"+i)||a>-1&&(n.splice(a,1),o=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),o&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var r=i.composedPath&&i.composedPath()||i.path,n=this.findTargets(r);n=this.bindComponents(e,n),this.triggerEvents(e,i,n),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(n).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let r=Object.keys(this.componentMap);for(let n of e){let a=n.classList?[...n.classList]:[];if(a.filter(l=>this.abortClasses.includes(l)).length)break;let s=a.filter(l=>r.includes(l));for(let l of s)i[this.componentMap[l]]||(i[this.componentMap[l]]=n)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var r=Object.keys(i).reverse(),n=this.listeners[e],a={},o={};for(let s of r){let l,u=i[s],c=this.previousTargets[s];if(c&&c.target===u)l=c.component;else switch(s){case"row":case"group":(n.components.includes("row")||n.components.includes("cell")||n.components.includes("group"))&&(l=this.table.rowManager.getVisibleRows(!0).find(p=>p.getElement()===u),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[s]=!1));break;case"column":n.components.includes("column")&&(l=this.table.columnManager.findColumn(u));break;case"cell":n.components.includes("cell")&&(a.row instanceof io?l=a.row.findCell(u):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}l&&(a[s]=l,o[s]={target:u,component:l})}return this.previousTargets=o,a}triggerEvents(e,i,r){var n=this.listeners[e];for(let a in r)r[a]&&n.components.includes(a)&&this.dispatch(a+"-"+e,i,r[a])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class Xve{constructor(e){this.table=e,this.bindings={}}bind(e,i,r){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,r):this.bindings[e][i]=r}handle(e,i,r){if(this.bindings[e]&&this.bindings[e][r]&&typeof this.bindings[e][r].bind=="function")return this.bindings[e][r].bind(null,i);r!=="then"&&typeof r=="string"&&!r.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+r+" function, have you checked that you have the correct Tabulator module installed?")}}class Jve extends Ka{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,r,n,a,o){var s=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,r,a])){this.loading=!0,a||this.alertLoader(),i=this.chain("data-params",[e,r,a],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,r,a],!1,Promise.resolve([]));return l.then(u=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(u)&&typeof u=="object"&&(u=this.mapParams(u,this.objectInvert(this.table.options.dataReceiveParams)));var c=this.chain("data-loaded",[u],null,u);s==this.requestOrder?(this.clearAlert(),c!==!1&&(this.dispatchExternal("dataLoaded",c),this.table.rowManager.setData(c,n,typeof o>"u"?!n:o))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(u=>{console.error("Data Load Error: ",u),this.dispatchExternal("dataLoadError",u),a||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,n,typeof o>"u"?!n:o),Promise.resolve()}mapParams(e,i){var r={};for(let n in e)r[i.hasOwnProperty(n)?i[n]:n]=e[n];return r}objectInvert(e){var i={};for(let r in e)i[e[r]]=r;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class Zve{constructor(e,i,r){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=r?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=r}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e])if(i)if(r=this.events[e].findIndex(n=>n===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),r;return this.events[i]&&this.events[i].forEach((n,a)=>{let o=n.apply(this.table,e);a||(r=o)}),r}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class Qve{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,r=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:r}),this.events[e].sort((n,a)=>n.priority-a.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e]){if(i)if(r=this.events[e].findIndex(n=>n.callback===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,r,n){var a=r;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((o,s)=>{a=o.callback.apply(this,i.concat([a]))}),a):typeof n=="function"?n():n}_confirm(e,i){var r=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((n,a)=>{n.callback.apply(this,i)&&(r=!0)}),r}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(r=>{r.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class eIe extends Ka{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,r){var n="";return typeof this.options(e)<"u"?(n="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(n=n+", Please use the %c"+i+"%c option instead",this._warnUser(n,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),r&&(this.table.options[i]=this.table.options[e])):this._warnUser(n,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}function tIe(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function OV(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function iIe(t,e){var i=0,r=this.table.rowManager.element.clientWidth,n=0,a=!1;t.forEach((o,s)=>{o.widthFixed||o.reinitializeWidth(),(this.table.options.responsiveLayout?o.modules.responsive.visible:o.visible)&&(a=o),o.visible&&(i+=o.getWidth())}),a?(n=r-i+a.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(a.setWidth(0),this.table.modules.responsiveLayout.update()),n>0?a.setWidth(n):a.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function rIe(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,r=0,n=0,a=0,o=0,s=[],l=[],u=0,c=0,d=0;function p(h){var f;return typeof h=="string"?h.indexOf("%")>-1?f=i/100*parseInt(h):f=parseInt(h):f=h,f}function m(h,f,g,v){var y=[],I=0,b=0,S=0,w=a,U=0,T=0,D=[];function P(R){return g*(R.column.definition.widthGrow||1)}function C(R){return p(R.width)-g*(R.column.definition.widthShrink||0)}return h.forEach(function(R,N){var A=v?C(R):P(R);R.column.minWidth>=A?y.push(R):R.column.maxWidth&&R.column.maxWidth<A?(R.width=R.column.maxWidth,f-=R.column.maxWidth,w-=v?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1,w&&(g=Math.floor(f/w))):(D.push(R),T+=v?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1)}),y.length?(y.forEach(function(R){I+=v?R.width-R.column.minWidth:R.column.minWidth,R.width=R.column.minWidth}),b=f-I,S=T?Math.floor(b/T):b,U=m(D,b,S,v)):(U=T?f-Math.floor(f/T)*T:f,D.forEach(function(R){R.width=v?C(R):P(R)})),U}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(h){var f,g,v;h.visible&&(f=h.definition.width,g=parseInt(h.minWidth),f?(v=p(f),r+=v>g?v:g,h.definition.widthShrink&&(l.push({column:h,width:v>g?v:g}),u+=h.definition.widthShrink)):(s.push({column:h,width:0}),a+=h.definition.widthGrow||1))}),n=i-r,o=Math.floor(n/a),d=m(s,n,o,!1),s.length&&d>0&&(s[s.length-1].width+=d),s.forEach(function(h){n-=h.width}),c=Math.abs(d)+n,c>0&&u&&(d=m(l,c,Math.floor(c/u),!0)),d&&l.length&&(l[l.length-1].width-=d),s.forEach(function(h){h.column.setWidth(h.width)}),l.forEach(function(h){h.column.setWidth(h.width)})}var nIe={fitData:tIe,fitDataFill:OV,fitDataTable:OV,fitDataStretch:iIe,fitColumns:rIe};const hf=class hf extends ui{constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;hf.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){this.dispatch("layout-refreshing"),hf.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),this.dispatch("layout-refreshed")}};Ve(hf,"moduleName","layout"),Ve(hf,"modes",nIe);let O1=hf;var aIe={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};const fI=class fI extends ui{constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=kr.deepClone(fI.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let r in i)e[r]&&typeof e[r]=="object"?this._setLangProp(e[r],i[r]):e[r]=i[r]}setLocale(e){e=e||"default";function i(r,n){for(var a in r)typeof r[a]=="object"?(n[a]||(n[a]={}),i(r[a],n[a])):n[a]=r[a]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let r=e.split("-")[0];this.langList[r]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,r),e=r):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=kr.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var r=i?e+"|"+i:e,n=r.split("|"),a=this._getLangElement(n,this.locale);return a||""}_getLangElement(e,i){var r=this.lang;return e.forEach(function(n){var a;r&&(a=r[n],typeof a<"u"?r=a:r=!1)}),r}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}};Ve(fI,"moduleName","localize"),Ve(fI,"langs",aIe);let k1=fI;class P7 extends ui{constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],r;return r=this.table.constructor.registry.lookupTable(e),r.forEach(n=>{this.table!==n&&i.push(n)}),i}send(e,i,r,n){var a=this.getConnections(e);a.forEach(o=>{o.tableComms(this.table.element,i,r,n)}),!a.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,r,n){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,r,n);console.warn("Inter-table Comms Error - no such module:",i)}}Ve(P7,"moduleName","comms");var oIe=Object.freeze({__proto__:null,CommsModule:P7,LayoutModule:O1,LocalizeModule:k1});const ps=class ps{static findTable(e){var i=ps.registry.lookupTable(e,!0);return Array.isArray(i)&&!i.length?!1:i}};Ve(ps,"registry",{tables:[],register(e){ps.registry.tables.push(e)},deregister(e){var i=ps.registry.tables.indexOf(e);i>-1&&ps.registry.tables.splice(i,1)},lookupTable(e,i){var r=[],n,a;if(typeof e=="string"){if(n=document.querySelectorAll(e),n.length)for(var o=0;o<n.length;o++)a=ps.registry.matchElement(n[o]),a&&r.push(a)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof ps?(a=ps.registry.matchElement(e),a&&r.push(a)):Array.isArray(e)?e.forEach(function(s){r=r.concat(ps.registry.lookupTable(s))}):i||console.warn("Table Connection Error - Invalid Selector",e);return r},matchElement(e){return ps.registry.tables.find(function(i){return e instanceof ps?i===e:i.element===e})}});let x1=ps;const ar=class ar extends x1{constructor(){super()}static initializeModuleBinder(e){ar.modulesRegistered||(ar.modulesRegistered=!0,ar._registerModules(oIe,!0),e&&ar._registerModules(e))}static _extendModule(e,i,r){if(ar.moduleBindings[e]){var n=ar.moduleBindings[e][i];if(n)if(typeof r=="object")for(let a in r)n[a]=r[a];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",i)}else console.warn("Module Error - module does not exist:",e)}static _registerModules(e,i){var r=Object.values(e);i&&r.forEach(n=>{n.prototype.moduleCore=!0}),ar._registerModule(r)}static _registerModule(e){Array.isArray(e)||(e=[e]),e.forEach(i=>{ar._registerModuleBinding(i),ar._registerModuleExtensions(i)})}static _registerModuleBinding(e){e.moduleName?ar.moduleBindings[e.moduleName]=e:console.error("Unable to bind module, no moduleName defined",e.moduleName)}static _registerModuleExtensions(e){var i=e.moduleExtensions;if(e.moduleExtensions)for(let r in i){let n=i[r];if(ar.moduleBindings[r])for(let a in n)ar._extendModule(r,a,n[a]);else{ar.moduleExtensions[r]||(ar.moduleExtensions[r]={});for(let a in n)ar.moduleExtensions[r][a]||(ar.moduleExtensions[r][a]={}),Object.assign(ar.moduleExtensions[r][a],n[a])}}ar._extendModuleFromQueue(e)}static _extendModuleFromQueue(e){var i=ar.moduleExtensions[e.moduleName];if(i)for(let r in i)ar._extendModule(e.moduleName,r,i[r])}_bindModules(){var e=[],i=[],r=[];this.modules={};for(var n in ar.moduleBindings){let a=ar.moduleBindings[n],o=new a(this);this.modules[n]=o,a.prototype.moduleCore?this.modulesCore.push(o):a.moduleInitOrder?a.moduleInitOrder<0?e.push(o):i.push(o):r.push(o)}e.sort((a,o)=>a.moduleInitOrder>o.moduleInitOrder?1:-1),i.sort((a,o)=>a.moduleInitOrder>o.moduleInitOrder?1:-1),this.modulesRegular=e.concat(r.concat(i))}};Ve(ar,"moduleBindings",{}),Ve(ar,"moduleExtensions",{}),Ve(ar,"modulesRegistered",!1),Ve(ar,"defaultModules",!1);let F1=ar;class sIe extends Ka{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}const pc=class pc extends F1{static extendModule(){pc.initializeModuleBinder(),pc._extendModule(...arguments)}static registerModule(){pc.initializeModuleBinder(),pc._registerModule(...arguments)}constructor(e,i,r){super(),pc.initializeModuleBinder(r),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new Xve(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new eIe(this),this.optionsList=new D7(this,"table constructor"),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new Hve(this),this.rowManager=new qve(this),this.footerManager=new Yve(this),this.dataLoader=new Jve(this),this.alertManager=new sIe(this),this._bindModules(),this.options=this.optionsList.generate(pc.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new Zve(this,this.options,this.options.debugEventsExternal),this.eventBus=new Qve(this.options.debugEventsInternal),this.interactionMonitor=new Kve(this),this.dataLoader.initialize(),this.footerManager.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,r;if(e.tagName==="TABLE"){this.originalElement=this.element,r=document.createElement("div");var n=e.attributes;for(var a in n)typeof n[a]=="object"&&r.setAttribute(n[a].name,n[a].value);e.parentNode.replaceChild(r,e),this.element=e=r}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(r=>{r.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(r=>{r.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var e=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var r,n;return this.options.debugInitialization&&!this.initialized&&(e||(r=new Error().stack.split(`
`),n=r[0]=="Error"?r[2]:r[1],n[0]==" "?e=n.trim().split(" ")[1].split(".")[1]:e=n.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,r){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,r,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,r){return this.initGuard(),this.dataLoader.load(e,i,r,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((r,n)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var o=this.rowManager.findRow(a[this.options.index]);o?(i++,o.updateData(a).then(()=>{i--,i||r()}).catch(s=>{n("Update Error - Unable to update row",a,s)})):n("Update Error - Unable to find row",a)}):(console.warn("Update Error - No data provided"),n("Update Error - No data provided"))})}addData(e,i,r){return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,r).then(o=>{var s=[];o.forEach(function(l){s.push(l.getComponent())}),n(s)}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}updateOrAddData(e){var i=[],r=0;return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(o=>{var s=this.rowManager.findRow(o[this.options.index]);r++,s?s.updateData(o).then(()=>{r--,i.push(s.getComponent()),r||n(i)}):this.rowManager.addRows(o).then(l=>{r--,i.push(l[0].getComponent()),r||n(i)})}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let r of e){let n=this.rowManager.findRow(r,!0);if(n)i.push(n);else return console.error("Delete Error - No matching row found:",r),Promise.reject("Delete Error - No matching row found")}return i.sort((r,n)=>this.rowManager.rows.indexOf(r)>this.rowManager.rows.indexOf(n)?1:-1),i.forEach(r=>{r.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,r){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,r,!0).then(n=>n[0].getComponent())}updateOrAddRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>r.getComponent()):this.rowManager.addRows(i).then(n=>n[0].getComponent())}updateRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>Promise.resolve(r.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,r){var n=this.rowManager.findRow(e);return n?this.rowManager.scrollToRow(n,i,r):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,r){var n=this.rowManager.findRow(e);this.initGuard(),n?n.moveToRow(i,r):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,r){var n=this.columnManager.findColumn(r);return this.initGuard(),this.columnManager.addColumn(e,i,n).then(a=>a.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var r=this.columnManager.findColumn(e);return this.initGuard(),r?r.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,r){var n=this.columnManager.findColumn(e),a=this.columnManager.findColumn(i);this.initGuard(),n?a?this.columnManager.moveColumn(n,a,r):console.warn("Move Error - No matching column found:",a):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,r){return new Promise((n,a)=>{var o=this.columnManager.findColumn(e);return o?this.columnManager.scrollToColumn(o,i,r):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}};Ve(pc,"defaultOptions",Vve);let L1=pc;var xv=L1;class lIe extends xv{static extendModule(){xv.initializeModuleBinder(DC),xv._extendModule(...arguments)}static registerModule(){xv.initializeModuleBinder(DC),xv._registerModule(...arguments)}constructor(e,i,r){super(e,i,DC)}}var $b=lIe;function qD({anchorId:t}){const e=$b.findTable(`#${t}`)[0];e&&e.destroy()}function uIe(t,e){return t?jD.dateTime.convertTime(t,e):""}function R7(t){var R;const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const r=t.getValue(),{potentialParticipants:n,eventName:a="",roundName:o="",schedule:s={},winningSide:l,matchUpId:u,sides:c}=r||{},{courtOrder:d="",scheduledTime:p="",courtId:m="",timeModifiers:h,venueId:f=""}=s;if(e.setAttribute("courtOrder",d),e.setAttribute("courtId",m),e.setAttribute("venueId",f),e.className="schedule-cell dragdrop",e.ondragover=N=>N.preventDefault(),u&&(e.draggable=!0,e.id=u,l&&e.classList.add("matchup-complete")),!u)return e;const g=`${a} ${o}`,v=N=>{var A,M;return((M=(A=N.person)==null?void 0:A.standardFamilyName)==null?void 0:M.toUpperCase())||N.participantName},y=n==null?void 0:n.map(N=>N==null?void 0:N.map(A=>`<span class='potential nowrap'>${v(A)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),I=N=>{var M,E;const A=(E=(M=c==null?void 0:c.find(O=>N===O.sideNumber))==null?void 0:M.participant)==null?void 0:E.participantName;if(A)return l===N?`<span style='font-weight: bold'>${A}</span>`:A},b=I(1)||(y==null?void 0:y.shift())||"Unkown",S=I(2)||(y==null?void 0:y.shift())||"Unknown";e.id=u;const w=document.createElement("div");w.className="header flexrow",w.innerHTML=((h==null?void 0:h[0])&&Wfe[h[0]]+"&nbsp;"||"")+uIe(p,!1),e.appendChild(w);const U=document.createElement("div");U.className="catround",U.innerHTML=g,e.appendChild(U);const T=document.createElement("div");T.className="scheduled_teams";const D=document.createElement("div");D.className="scheduled_team",D.style.fontSize="1em",D.innerHTML=b,T.appendChild(D);const P=document.createElement("div");P.className="divider",P.innerHTML="vs.",T.appendChild(P);const C=document.createElement("div");if(C.className="scheduled_team",C.style.fontSize="1em",C.innerHTML=S,T.appendChild(C),l){const N=document.createElement("div");N.innerHTML=((R=r.score)==null?void 0:R.scoreStringSide1)||"",T.appendChild(N)}return e.appendChild(T),e}function cIe({count:t}){return t>0?jD.generateRange(0,t).map(()=>({headerHozAlign:Qi,formatter:R7,headerSort:!1,resizable:!1,minWidth:150})):[]}function dIe(){function t(e){e.getElement().style.backgroundColor="white";const i=document.createElement("span"),r=e.getRow().getData();return i.innerHTML=r.rowNumber,i}return{formatter:t,headerSort:!1,resizable:!1,hozAlign:Qi,frozen:!0,width:55}}function pIe({courtsData:t,courtPrefix:e}){const i=zfe-(t==null?void 0:t.length)||0,r=i<=0?1:i,n=cIe({count:r}),a=dIe(),o=(s,l)=>({field:`${e}${l}`,title:s.courtName,headerHozAlign:Qi,formatter:R7,headerSort:!1,resizable:!1,hozAlign:Qi,minWidth:150});return[a].concat(t==null?void 0:t.map(o),n)}var mIe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hIe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var C7={exports:{}};(function(t,e){(function(i,r){t.exports=r()})(mIe,function(){var i=1e3,r=6e4,n=36e5,a="millisecond",o="second",s="minute",l="hour",u="day",c="week",d="month",p="quarter",m="year",h="date",f="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(A){var M=["th","st","nd","rd"],E=A%100;return"["+A+(M[(E-20)%10]||M[E]||M[0])+"]"}},I=function(A,M,E){var O=String(A);return!O||O.length>=M?A:""+Array(M+1-O.length).join(E)+A},b={s:I,z:function(A){var M=-A.utcOffset(),E=Math.abs(M),O=Math.floor(E/60),k=E%60;return(M<=0?"+":"-")+I(O,2,"0")+":"+I(k,2,"0")},m:function A(M,E){if(M.date()<E.date())return-A(E,M);var O=12*(E.year()-M.year())+(E.month()-M.month()),k=M.clone().add(O,d),x=E-k<0,F=M.clone().add(O+(x?-1:1),d);return+(-(O+(E-k)/(x?k-F:F-k))||0)},a:function(A){return A<0?Math.ceil(A)||0:Math.floor(A)},p:function(A){return{M:d,y:m,w:c,d:u,D:h,h:l,m:s,s:o,ms:a,Q:p}[A]||String(A||"").toLowerCase().replace(/s$/,"")},u:function(A){return A===void 0}},S="en",w={};w[S]=y;var U="$isDayjsObject",T=function(A){return A instanceof R||!(!A||!A[U])},D=function A(M,E,O){var k;if(!M)return S;if(typeof M=="string"){var x=M.toLowerCase();w[x]&&(k=x),E&&(w[x]=E,k=x);var F=M.split("-");if(!k&&F.length>1)return A(F[0])}else{var $=M.name;w[$]=M,k=$}return!O&&k&&(S=k),k||!O&&S},P=function(A,M){if(T(A))return A.clone();var E=typeof M=="object"?M:{};return E.date=A,E.args=arguments,new R(E)},C=b;C.l=D,C.i=T,C.w=function(A,M){return P(A,{locale:M.$L,utc:M.$u,x:M.$x,$offset:M.$offset})};var R=function(){function A(E){this.$L=D(E.locale,null,!0),this.parse(E),this.$x=this.$x||E.x||{},this[U]=!0}var M=A.prototype;return M.parse=function(E){this.$d=function(O){var k=O.date,x=O.utc;if(k===null)return new Date(NaN);if(C.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var F=k.match(g);if(F){var $=F[2]-1||0,_=(F[7]||"0").substring(0,3);return x?new Date(Date.UTC(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)):new Date(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)}}return new Date(k)}(E),this.init()},M.init=function(){var E=this.$d;this.$y=E.getFullYear(),this.$M=E.getMonth(),this.$D=E.getDate(),this.$W=E.getDay(),this.$H=E.getHours(),this.$m=E.getMinutes(),this.$s=E.getSeconds(),this.$ms=E.getMilliseconds()},M.$utils=function(){return C},M.isValid=function(){return this.$d.toString()!==f},M.isSame=function(E,O){var k=P(E);return this.startOf(O)<=k&&k<=this.endOf(O)},M.isAfter=function(E,O){return P(E)<this.startOf(O)},M.isBefore=function(E,O){return this.endOf(O)<P(E)},M.$g=function(E,O,k){return C.u(E)?this[O]:this.set(k,E)},M.unix=function(){return Math.floor(this.valueOf()/1e3)},M.valueOf=function(){return this.$d.getTime()},M.startOf=function(E,O){var k=this,x=!!C.u(O)||O,F=C.p(E),$=function(q,W){var Y=C.w(k.$u?Date.UTC(k.$y,W,q):new Date(k.$y,W,q),k);return x?Y:Y.endOf(u)},_=function(q,W){return C.w(k.toDate()[q].apply(k.toDate("s"),(x?[0,0,0,0]:[23,59,59,999]).slice(W)),k)},L=this.$W,B=this.$M,V=this.$D,G="set"+(this.$u?"UTC":"");switch(F){case m:return x?$(1,0):$(31,11);case d:return x?$(1,B):$(0,B+1);case c:var j=this.$locale().weekStart||0,z=(L<j?L+7:L)-j;return $(x?V-z:V+(6-z),B);case u:case h:return _(G+"Hours",0);case l:return _(G+"Minutes",1);case s:return _(G+"Seconds",2);case o:return _(G+"Milliseconds",3);default:return this.clone()}},M.endOf=function(E){return this.startOf(E,!1)},M.$set=function(E,O){var k,x=C.p(E),F="set"+(this.$u?"UTC":""),$=(k={},k[u]=F+"Date",k[h]=F+"Date",k[d]=F+"Month",k[m]=F+"FullYear",k[l]=F+"Hours",k[s]=F+"Minutes",k[o]=F+"Seconds",k[a]=F+"Milliseconds",k)[x],_=x===u?this.$D+(O-this.$W):O;if(x===d||x===m){var L=this.clone().set(h,1);L.$d[$](_),L.init(),this.$d=L.set(h,Math.min(this.$D,L.daysInMonth())).$d}else $&&this.$d[$](_);return this.init(),this},M.set=function(E,O){return this.clone().$set(E,O)},M.get=function(E){return this[C.p(E)]()},M.add=function(E,O){var k,x=this;E=Number(E);var F=C.p(O),$=function(B){var V=P(x);return C.w(V.date(V.date()+Math.round(B*E)),x)};if(F===d)return this.set(d,this.$M+E);if(F===m)return this.set(m,this.$y+E);if(F===u)return $(1);if(F===c)return $(7);var _=(k={},k[s]=r,k[l]=n,k[o]=i,k)[F]||1,L=this.$d.getTime()+E*_;return C.w(L,this)},M.subtract=function(E,O){return this.add(-1*E,O)},M.format=function(E){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||f;var x=E||"YYYY-MM-DDTHH:mm:ssZ",F=C.z(this),$=this.$H,_=this.$m,L=this.$M,B=k.weekdays,V=k.months,G=k.meridiem,j=function(W,Y,re,K){return W&&(W[Y]||W(O,x))||re[Y].slice(0,K)},z=function(W){return C.s($%12||12,W,"0")},q=G||function(W,Y,re){var K=W<12?"AM":"PM";return re?K.toLowerCase():K};return x.replace(v,function(W,Y){return Y||function(re){switch(re){case"YY":return String(O.$y).slice(-2);case"YYYY":return C.s(O.$y,4,"0");case"M":return L+1;case"MM":return C.s(L+1,2,"0");case"MMM":return j(k.monthsShort,L,V,3);case"MMMM":return j(V,L);case"D":return O.$D;case"DD":return C.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return j(k.weekdaysMin,O.$W,B,2);case"ddd":return j(k.weekdaysShort,O.$W,B,3);case"dddd":return B[O.$W];case"H":return String($);case"HH":return C.s($,2,"0");case"h":return z(1);case"hh":return z(2);case"a":return q($,_,!0);case"A":return q($,_,!1);case"m":return String(_);case"mm":return C.s(_,2,"0");case"s":return String(O.$s);case"ss":return C.s(O.$s,2,"0");case"SSS":return C.s(O.$ms,3,"0");case"Z":return F}return null}(W)||F.replace(":","")})},M.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},M.diff=function(E,O,k){var x,F=this,$=C.p(O),_=P(E),L=(_.utcOffset()-this.utcOffset())*r,B=this-_,V=function(){return C.m(F,_)};switch($){case m:x=V()/12;break;case d:x=V();break;case p:x=V()/3;break;case c:x=(B-L)/6048e5;break;case u:x=(B-L)/864e5;break;case l:x=B/n;break;case s:x=B/r;break;case o:x=B/i;break;default:x=B}return k?x:C.a(x)},M.daysInMonth=function(){return this.endOf(d).$D},M.$locale=function(){return w[this.$L]},M.locale=function(E,O){if(!E)return this.$L;var k=this.clone(),x=D(E,O,!0);return x&&(k.$L=x),k},M.clone=function(){return C.w(this.$d,this)},M.toDate=function(){return new Date(this.valueOf())},M.toJSON=function(){return this.isValid()?this.toISOString():null},M.toISOString=function(){return this.$d.toISOString()},M.toString=function(){return this.$d.toUTCString()},A}(),N=R.prototype;return P.prototype=N,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",u],["$M",d],["$y",m],["$D",h]].forEach(function(A){N[A[1]]=function(M){return this.$g(M,A[0],A[1])}}),P.extend=function(A,M){return A.$i||(A(M,R,P),A.$i=!0),P},P.locale=D,P.isDayjs=T,P.unix=function(A){return P(1e3*A)},P.en=w[S],P.Ls=w,P.p={},P})})(C7);var fIe=C7.exports;const gIe=hIe(fIe);function vIe(t){const{dateMatchUps:e=[],completedMatchUps:i=[],groupInfo:r}=(t==null?void 0:t.data)??{},n=e.concat(...i),a=n.reduce((I,b)=>{var w;const S=(w=b==null?void 0:b.schedule)==null?void 0:w.scheduledDate;return S&&!I.includes(S)&&I.push(S),I},[]),o=a[0];let s;const l=({scheduledDate:I})=>{var T;const b=(T=t==null?void 0:t.data)==null?void 0:T.courtsData.map(D=>{const{matchUps:P,...C}=D;return{...C,matchUps:P.filter(R=>{var N;return((N=R.schedule)==null?void 0:N.scheduledDate)===I})}}),S="C|",w=cx.courtGridRows({courtsData:b,courtPrefix:S,minRowsCount:10}).rows,U=pIe({courtsData:b,courtPrefix:S});return w==null||w.forEach((D,P)=>{D.rowId=`rowId-${P+1}`,D.rowNumber=P+1}),{rows:w,columns:U,courtsCount:(b==null?void 0:b.length)??0,courtsData:b,groupInfo:r}},u=({scheduledDate:I})=>{const{rows:b}=l({scheduledDate:I});s==null||s.replaceData(b),s.matchUps=n},c=I=>gIe(I).format("dddd MMM D"),d=a.map(I=>({onClick:()=>u({scheduledDate:I}),label:c(I),value:I,close:!0})),p={label:c(o),options:d,id:"dateSelector",modifyLabel:!0,selection:!0},m=document.getElementById("scheduleHeader");qfe(m);const h=tm({button:p});m.appendChild(h),qD({anchorId:"tournamentSchedule"});const f=document.getElementById("tournamentSchedule"),{rows:g=[],columns:v=[],courtsCount:y}=l({scheduledDate:o});return s=new $b(f,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:g,columns:v}),{table:s,courtsCount:y}}function IIe(){return"tmxToken"}function E7(t,e){return function(){return t.apply(e,arguments)}}const{toString:yIe}=Object.prototype,{getPrototypeOf:Dx}=Object,YD=(t=>e=>{const i=yIe.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Ku=t=>(t=t.toLowerCase(),e=>YD(e)===t),KD=t=>e=>typeof e===t,{isArray:ev}=Array,GI=KD("undefined");function bIe(t){return t!==null&&!GI(t)&&t.constructor!==null&&!GI(t.constructor)&&Ws(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const M7=Ku("ArrayBuffer");function wIe(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&M7(t.buffer),e}const UIe=KD("string"),Ws=KD("function"),N7=KD("number"),XD=t=>t!==null&&typeof t=="object",SIe=t=>t===!0||t===!1,VU=t=>{if(YD(t)!=="object")return!1;const e=Dx(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},TIe=Ku("Date"),DIe=Ku("File"),PIe=Ku("Blob"),RIe=Ku("FileList"),CIe=t=>XD(t)&&Ws(t.pipe),EIe=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Ws(t.append)&&((e=YD(t))==="formdata"||e==="object"&&Ws(t.toString)&&t.toString()==="[object FormData]"))},MIe=Ku("URLSearchParams"),NIe=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Bb(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let r,n;if(typeof t!="object"&&(t=[t]),ev(t))for(r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else{const a=i?Object.getOwnPropertyNames(t):Object.keys(t),o=a.length;let s;for(r=0;r<o;r++)s=a[r],e.call(null,t[s],s,t)}}function A7(t,e){e=e.toLowerCase();const i=Object.keys(t);let r=i.length,n;for(;r-- >0;)if(n=i[r],e===n.toLowerCase())return n;return null}const O7=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,k7=t=>!GI(t)&&t!==O7;function _1(){const{caseless:t}=k7(this)&&this||{},e={},i=(r,n)=>{const a=t&&A7(e,n)||n;VU(e[a])&&VU(r)?e[a]=_1(e[a],r):VU(r)?e[a]=_1({},r):ev(r)?e[a]=r.slice():e[a]=r};for(let r=0,n=arguments.length;r<n;r++)arguments[r]&&Bb(arguments[r],i);return e}const AIe=(t,e,i,{allOwnKeys:r}={})=>(Bb(e,(n,a)=>{i&&Ws(n)?t[a]=E7(n,i):t[a]=n},{allOwnKeys:r}),t),OIe=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),kIe=(t,e,i,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},xIe=(t,e,i,r)=>{let n,a,o;const s={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),a=n.length;a-- >0;)o=n[a],(!r||r(o,t,e))&&!s[o]&&(e[o]=t[o],s[o]=!0);t=i!==!1&&Dx(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},FIe=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const r=t.indexOf(e,i);return r!==-1&&r===i},LIe=t=>{if(!t)return null;if(ev(t))return t;let e=t.length;if(!N7(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},_Ie=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&Dx(Uint8Array)),$Ie=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let n;for(;(n=r.next())&&!n.done;){const a=n.value;e.call(t,a[0],a[1])}},BIe=(t,e)=>{let i;const r=[];for(;(i=t.exec(e))!==null;)r.push(i);return r},VIe=Ku("HTMLFormElement"),jIe=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,r,n){return r.toUpperCase()+n}),kV=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),GIe=Ku("RegExp"),x7=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),r={};Bb(i,(n,a)=>{let o;(o=e(n,a,t))!==!1&&(r[a]=o||n)}),Object.defineProperties(t,r)},HIe=t=>{x7(t,(e,i)=>{if(Ws(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const r=t[i];if(Ws(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},zIe=(t,e)=>{const i={},r=n=>{n.forEach(a=>{i[a]=!0})};return ev(t)?r(t):r(String(t).split(e)),i},WIe=()=>{},qIe=(t,e)=>(t=+t,Number.isFinite(t)?t:e),PC="abcdefghijklmnopqrstuvwxyz",xV="0123456789",F7={DIGIT:xV,ALPHA:PC,ALPHA_DIGIT:PC+PC.toUpperCase()+xV},YIe=(t=16,e=F7.ALPHA_DIGIT)=>{let i="";const{length:r}=e;for(;t--;)i+=e[Math.random()*r|0];return i};function KIe(t){return!!(t&&Ws(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const XIe=t=>{const e=new Array(10),i=(r,n)=>{if(XD(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[n]=r;const a=ev(r)?[]:{};return Bb(r,(o,s)=>{const l=i(o,n+1);!GI(l)&&(a[s]=l)}),e[n]=void 0,a}}return r};return i(t,0)},JIe=Ku("AsyncFunction"),ZIe=t=>t&&(XD(t)||Ws(t))&&Ws(t.then)&&Ws(t.catch),ye={isArray:ev,isArrayBuffer:M7,isBuffer:bIe,isFormData:EIe,isArrayBufferView:wIe,isString:UIe,isNumber:N7,isBoolean:SIe,isObject:XD,isPlainObject:VU,isUndefined:GI,isDate:TIe,isFile:DIe,isBlob:PIe,isRegExp:GIe,isFunction:Ws,isStream:CIe,isURLSearchParams:MIe,isTypedArray:_Ie,isFileList:RIe,forEach:Bb,merge:_1,extend:AIe,trim:NIe,stripBOM:OIe,inherits:kIe,toFlatObject:xIe,kindOf:YD,kindOfTest:Ku,endsWith:FIe,toArray:LIe,forEachEntry:$Ie,matchAll:BIe,isHTMLForm:VIe,hasOwnProperty:kV,hasOwnProp:kV,reduceDescriptors:x7,freezeMethods:HIe,toObjectSet:zIe,toCamelCase:jIe,noop:WIe,toFiniteNumber:qIe,findKey:A7,global:O7,isContextDefined:k7,ALPHABET:F7,generateString:YIe,isSpecCompliantForm:KIe,toJSONObject:XIe,isAsyncFn:JIe,isThenable:ZIe};function Fi(t,e,i,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),r&&(this.request=r),n&&(this.response=n)}ye.inherits(Fi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ye.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const L7=Fi.prototype,_7={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{_7[t]={value:t}});Object.defineProperties(Fi,_7);Object.defineProperty(L7,"isAxiosError",{value:!0});Fi.from=(t,e,i,r,n,a)=>{const o=Object.create(L7);return ye.toFlatObject(t,o,function(l){return l!==Error.prototype},s=>s!=="isAxiosError"),Fi.call(o,t.message,e,i,r,n),o.cause=t,o.name=t.name,a&&Object.assign(o,a),o};const QIe=null;function $1(t){return ye.isPlainObject(t)||ye.isArray(t)}function $7(t){return ye.endsWith(t,"[]")?t.slice(0,-2):t}function FV(t,e,i){return t?t.concat(e).map(function(n,a){return n=$7(n),!i&&a?"["+n+"]":n}).join(i?".":""):e}function eye(t){return ye.isArray(t)&&!t.some($1)}const tye=ye.toFlatObject(ye,{},null,function(e){return/^is[A-Z]/.test(e)});function JD(t,e,i){if(!ye.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=ye.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(f,g){return!ye.isUndefined(g[f])});const r=i.metaTokens,n=i.visitor||c,a=i.dots,o=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&ye.isSpecCompliantForm(e);if(!ye.isFunction(n))throw new TypeError("visitor must be a function");function u(h){if(h===null)return"";if(ye.isDate(h))return h.toISOString();if(!l&&ye.isBlob(h))throw new Fi("Blob is not supported. Use a Buffer instead.");return ye.isArrayBuffer(h)||ye.isTypedArray(h)?l&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function c(h,f,g){let v=h;if(h&&!g&&typeof h=="object"){if(ye.endsWith(f,"{}"))f=r?f:f.slice(0,-2),h=JSON.stringify(h);else if(ye.isArray(h)&&eye(h)||(ye.isFileList(h)||ye.endsWith(f,"[]"))&&(v=ye.toArray(h)))return f=$7(f),v.forEach(function(I,b){!(ye.isUndefined(I)||I===null)&&e.append(o===!0?FV([f],b,a):o===null?f:f+"[]",u(I))}),!1}return $1(h)?!0:(e.append(FV(g,f,a),u(h)),!1)}const d=[],p=Object.assign(tye,{defaultVisitor:c,convertValue:u,isVisitable:$1});function m(h,f){if(!ye.isUndefined(h)){if(d.indexOf(h)!==-1)throw Error("Circular reference detected in "+f.join("."));d.push(h),ye.forEach(h,function(v,y){(!(ye.isUndefined(v)||v===null)&&n.call(e,v,ye.isString(y)?y.trim():y,f,p))===!0&&m(v,f?f.concat(y):[y])}),d.pop()}}if(!ye.isObject(t))throw new TypeError("data must be an object");return m(t),e}function LV(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function Px(t,e){this._pairs=[],t&&JD(t,this,e)}const B7=Px.prototype;B7.append=function(e,i){this._pairs.push([e,i])};B7.toString=function(e){const i=e?function(r){return e.call(this,r,LV)}:LV;return this._pairs.map(function(n){return i(n[0])+"="+i(n[1])},"").join("&")};function iye(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function V7(t,e,i){if(!e)return t;const r=i&&i.encode||iye,n=i&&i.serialize;let a;if(n?a=n(e,i):a=ye.isURLSearchParams(e)?e.toString():new Px(e,i).toString(r),a){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class _V{constructor(){this.handlers=[]}use(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ye.forEach(this.handlers,function(r){r!==null&&e(r)})}}const j7={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},rye=typeof URLSearchParams<"u"?URLSearchParams:Px,nye=typeof FormData<"u"?FormData:null,aye=typeof Blob<"u"?Blob:null,oye={isBrowser:!0,classes:{URLSearchParams:rye,FormData:nye,Blob:aye},protocols:["http","https","file","blob","url","data"]},G7=typeof window<"u"&&typeof document<"u",sye=(t=>G7&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator<"u"&&navigator.product),lye=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",uye=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:G7,hasStandardBrowserEnv:sye,hasStandardBrowserWebWorkerEnv:lye},Symbol.toStringTag,{value:"Module"})),su={...uye,...oye};function cye(t,e){return JD(t,new su.classes.URLSearchParams,Object.assign({visitor:function(i,r,n,a){return su.isNode&&ye.isBuffer(i)?(this.append(r,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function dye(t){return ye.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function pye(t){const e={},i=Object.keys(t);let r;const n=i.length;let a;for(r=0;r<n;r++)a=i[r],e[a]=t[a];return e}function H7(t){function e(i,r,n,a){let o=i[a++];if(o==="__proto__")return!0;const s=Number.isFinite(+o),l=a>=i.length;return o=!o&&ye.isArray(n)?n.length:o,l?(ye.hasOwnProp(n,o)?n[o]=[n[o],r]:n[o]=r,!s):((!n[o]||!ye.isObject(n[o]))&&(n[o]=[]),e(i,r,n[o],a)&&ye.isArray(n[o])&&(n[o]=pye(n[o])),!s)}if(ye.isFormData(t)&&ye.isFunction(t.entries)){const i={};return ye.forEachEntry(t,(r,n)=>{e(dye(r),n,i,0)}),i}return null}function mye(t,e,i){if(ye.isString(t))try{return(e||JSON.parse)(t),ye.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(t)}const Rx={transitional:j7,adapter:["xhr","http"],transformRequest:[function(e,i){const r=i.getContentType()||"",n=r.indexOf("application/json")>-1,a=ye.isObject(e);if(a&&ye.isHTMLForm(e)&&(e=new FormData(e)),ye.isFormData(e))return n?JSON.stringify(H7(e)):e;if(ye.isArrayBuffer(e)||ye.isBuffer(e)||ye.isStream(e)||ye.isFile(e)||ye.isBlob(e))return e;if(ye.isArrayBufferView(e))return e.buffer;if(ye.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return cye(e,this.formSerializer).toString();if((s=ye.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return JD(s?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||n?(i.setContentType("application/json",!1),mye(e)):e}],transformResponse:[function(e){const i=this.transitional||Rx.transitional,r=i&&i.forcedJSONParsing,n=this.responseType==="json";if(e&&ye.isString(e)&&(r&&!this.responseType||n)){const o=!(i&&i.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(s){if(o)throw s.name==="SyntaxError"?Fi.from(s,Fi.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:su.classes.FormData,Blob:su.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ye.forEach(["delete","get","head","post","put","patch"],t=>{Rx.headers[t]={}});const Cx=Rx,hye=ye.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),fye=t=>{const e={};let i,r,n;return t&&t.split(`
`).forEach(function(o){n=o.indexOf(":"),i=o.substring(0,n).trim().toLowerCase(),r=o.substring(n+1).trim(),!(!i||e[i]&&hye[i])&&(i==="set-cookie"?e[i]?e[i].push(r):e[i]=[r]:e[i]=e[i]?e[i]+", "+r:r)}),e},$V=Symbol("internals");function Fv(t){return t&&String(t).trim().toLowerCase()}function jU(t){return t===!1||t==null?t:ye.isArray(t)?t.map(jU):String(t)}function gye(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=i.exec(t);)e[r[1]]=r[2];return e}const vye=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function RC(t,e,i,r,n){if(ye.isFunction(r))return r.call(this,e,i);if(n&&(e=i),!!ye.isString(e)){if(ye.isString(r))return e.indexOf(r)!==-1;if(ye.isRegExp(r))return r.test(e)}}function Iye(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,r)=>i.toUpperCase()+r)}function yye(t,e){const i=ye.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+i,{value:function(n,a,o){return this[r].call(this,e,n,a,o)},configurable:!0})})}class ZD{constructor(e){e&&this.set(e)}set(e,i,r){const n=this;function a(s,l,u){const c=Fv(l);if(!c)throw new Error("header name must be a non-empty string");const d=ye.findKey(n,c);(!d||n[d]===void 0||u===!0||u===void 0&&n[d]!==!1)&&(n[d||l]=jU(s))}const o=(s,l)=>ye.forEach(s,(u,c)=>a(u,c,l));return ye.isPlainObject(e)||e instanceof this.constructor?o(e,i):ye.isString(e)&&(e=e.trim())&&!vye(e)?o(fye(e),i):e!=null&&a(i,e,r),this}get(e,i){if(e=Fv(e),e){const r=ye.findKey(this,e);if(r){const n=this[r];if(!i)return n;if(i===!0)return gye(n);if(ye.isFunction(i))return i.call(this,n,r);if(ye.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=Fv(e),e){const r=ye.findKey(this,e);return!!(r&&this[r]!==void 0&&(!i||RC(this,this[r],r,i)))}return!1}delete(e,i){const r=this;let n=!1;function a(o){if(o=Fv(o),o){const s=ye.findKey(r,o);s&&(!i||RC(r,r[s],s,i))&&(delete r[s],n=!0)}}return ye.isArray(e)?e.forEach(a):a(e),n}clear(e){const i=Object.keys(this);let r=i.length,n=!1;for(;r--;){const a=i[r];(!e||RC(this,this[a],a,e,!0))&&(delete this[a],n=!0)}return n}normalize(e){const i=this,r={};return ye.forEach(this,(n,a)=>{const o=ye.findKey(r,a);if(o){i[o]=jU(n),delete i[a];return}const s=e?Iye(a):String(a).trim();s!==a&&delete i[a],i[s]=jU(n),r[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return ye.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=e&&ye.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const r=new this(e);return i.forEach(n=>r.set(n)),r}static accessor(e){const r=(this[$V]=this[$V]={accessors:{}}).accessors,n=this.prototype;function a(o){const s=Fv(o);r[s]||(yye(n,o),r[s]=!0)}return ye.isArray(e)?e.forEach(a):a(e),this}}ZD.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ye.reduceDescriptors(ZD.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[i]=r}}});ye.freezeMethods(ZD);const vc=ZD;function CC(t,e){const i=this||Cx,r=e||i,n=vc.from(r.headers);let a=r.data;return ye.forEach(t,function(s){a=s.call(i,a,n.normalize(),e?e.status:void 0)}),n.normalize(),a}function z7(t){return!!(t&&t.__CANCEL__)}function Vb(t,e,i){Fi.call(this,t??"canceled",Fi.ERR_CANCELED,e,i),this.name="CanceledError"}ye.inherits(Vb,Fi,{__CANCEL__:!0});function bye(t,e,i){const r=i.config.validateStatus;!i.status||!r||r(i.status)?t(i):e(new Fi("Request failed with status code "+i.status,[Fi.ERR_BAD_REQUEST,Fi.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}const wye=su.hasStandardBrowserEnv?{write(t,e,i,r,n,a){const o=[t+"="+encodeURIComponent(e)];ye.isNumber(i)&&o.push("expires="+new Date(i).toGMTString()),ye.isString(r)&&o.push("path="+r),ye.isString(n)&&o.push("domain="+n),a===!0&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Uye(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Sye(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function W7(t,e){return t&&!Uye(e)?Sye(t,e):e}const Tye=su.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");let r;function n(a){let o=a;return e&&(i.setAttribute("href",o),o=i.href),i.setAttribute("href",o),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return r=n(window.location.href),function(o){const s=ye.isString(o)?n(o):o;return s.protocol===r.protocol&&s.host===r.host}}():function(){return function(){return!0}}();function Dye(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Pye(t,e){t=t||10;const i=new Array(t),r=new Array(t);let n=0,a=0,o;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=r[a];o||(o=u),i[n]=l,r[n]=u;let d=a,p=0;for(;d!==n;)p+=i[d++],d=d%t;if(n=(n+1)%t,n===a&&(a=(a+1)%t),u-o<e)return;const m=c&&u-c;return m?Math.round(p*1e3/m):void 0}}function BV(t,e){let i=0;const r=Pye(50,250);return n=>{const a=n.loaded,o=n.lengthComputable?n.total:void 0,s=a-i,l=r(s),u=a<=o;i=a;const c={loaded:a,total:o,progress:o?a/o:void 0,bytes:s,rate:l||void 0,estimated:l&&o&&u?(o-a)/l:void 0,event:n};c[e?"download":"upload"]=!0,t(c)}}const Rye=typeof XMLHttpRequest<"u",Cye=Rye&&function(t){return new Promise(function(i,r){let n=t.data;const a=vc.from(t.headers).normalize();let{responseType:o,withXSRFToken:s}=t,l;function u(){t.cancelToken&&t.cancelToken.unsubscribe(l),t.signal&&t.signal.removeEventListener("abort",l)}let c;if(ye.isFormData(n)){if(su.hasStandardBrowserEnv||su.hasStandardBrowserWebWorkerEnv)a.setContentType(!1);else if((c=a.getContentType())!==!1){const[f,...g]=c?c.split(";").map(v=>v.trim()).filter(Boolean):[];a.setContentType([f||"multipart/form-data",...g].join("; "))}}let d=new XMLHttpRequest;if(t.auth){const f=t.auth.username||"",g=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";a.set("Authorization","Basic "+btoa(f+":"+g))}const p=W7(t.baseURL,t.url);d.open(t.method.toUpperCase(),V7(p,t.params,t.paramsSerializer),!0),d.timeout=t.timeout;function m(){if(!d)return;const f=vc.from("getAllResponseHeaders"in d&&d.getAllResponseHeaders()),v={data:!o||o==="text"||o==="json"?d.responseText:d.response,status:d.status,statusText:d.statusText,headers:f,config:t,request:d};bye(function(I){i(I),u()},function(I){r(I),u()},v),d=null}if("onloadend"in d?d.onloadend=m:d.onreadystatechange=function(){!d||d.readyState!==4||d.status===0&&!(d.responseURL&&d.responseURL.indexOf("file:")===0)||setTimeout(m)},d.onabort=function(){d&&(r(new Fi("Request aborted",Fi.ECONNABORTED,t,d)),d=null)},d.onerror=function(){r(new Fi("Network Error",Fi.ERR_NETWORK,t,d)),d=null},d.ontimeout=function(){let g=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const v=t.transitional||j7;t.timeoutErrorMessage&&(g=t.timeoutErrorMessage),r(new Fi(g,v.clarifyTimeoutError?Fi.ETIMEDOUT:Fi.ECONNABORTED,t,d)),d=null},su.hasStandardBrowserEnv&&(s&&ye.isFunction(s)&&(s=s(t)),s||s!==!1&&Tye(p))){const f=t.xsrfHeaderName&&t.xsrfCookieName&&wye.read(t.xsrfCookieName);f&&a.set(t.xsrfHeaderName,f)}n===void 0&&a.setContentType(null),"setRequestHeader"in d&&ye.forEach(a.toJSON(),function(g,v){d.setRequestHeader(v,g)}),ye.isUndefined(t.withCredentials)||(d.withCredentials=!!t.withCredentials),o&&o!=="json"&&(d.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&d.addEventListener("progress",BV(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&d.upload&&d.upload.addEventListener("progress",BV(t.onUploadProgress)),(t.cancelToken||t.signal)&&(l=f=>{d&&(r(!f||f.type?new Vb(null,t,d):f),d.abort(),d=null)},t.cancelToken&&t.cancelToken.subscribe(l),t.signal&&(t.signal.aborted?l():t.signal.addEventListener("abort",l)));const h=Dye(p);if(h&&su.protocols.indexOf(h)===-1){r(new Fi("Unsupported protocol "+h+":",Fi.ERR_BAD_REQUEST,t));return}d.send(n||null)})},B1={http:QIe,xhr:Cye};ye.forEach(B1,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const VV=t=>`- ${t}`,Eye=t=>ye.isFunction(t)||t===null||t===!1,q7={getAdapter:t=>{t=ye.isArray(t)?t:[t];const{length:e}=t;let i,r;const n={};for(let a=0;a<e;a++){i=t[a];let o;if(r=i,!Eye(i)&&(r=B1[(o=String(i)).toLowerCase()],r===void 0))throw new Fi(`Unknown adapter '${o}'`);if(r)break;n[o||"#"+a]=r}if(!r){const a=Object.entries(n).map(([s,l])=>`adapter ${s} `+(l===!1?"is not supported by the environment":"is not available in the build"));let o=e?a.length>1?`since :
`+a.map(VV).join(`
`):" "+VV(a[0]):"as no adapter specified";throw new Fi("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return r},adapters:B1};function EC(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Vb(null,t)}function jV(t){return EC(t),t.headers=vc.from(t.headers),t.data=CC.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),q7.getAdapter(t.adapter||Cx.adapter)(t).then(function(r){return EC(t),r.data=CC.call(t,t.transformResponse,r),r.headers=vc.from(r.headers),r},function(r){return z7(r)||(EC(t),r&&r.response&&(r.response.data=CC.call(t,t.transformResponse,r.response),r.response.headers=vc.from(r.response.headers))),Promise.reject(r)})}const GV=t=>t instanceof vc?{...t}:t;function Wf(t,e){e=e||{};const i={};function r(u,c,d){return ye.isPlainObject(u)&&ye.isPlainObject(c)?ye.merge.call({caseless:d},u,c):ye.isPlainObject(c)?ye.merge({},c):ye.isArray(c)?c.slice():c}function n(u,c,d){if(ye.isUndefined(c)){if(!ye.isUndefined(u))return r(void 0,u,d)}else return r(u,c,d)}function a(u,c){if(!ye.isUndefined(c))return r(void 0,c)}function o(u,c){if(ye.isUndefined(c)){if(!ye.isUndefined(u))return r(void 0,u)}else return r(void 0,c)}function s(u,c,d){if(d in e)return r(u,c);if(d in t)return r(void 0,u)}const l={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(u,c)=>n(GV(u),GV(c),!0)};return ye.forEach(Object.keys(Object.assign({},t,e)),function(c){const d=l[c]||n,p=d(t[c],e[c],c);ye.isUndefined(p)&&d!==s||(i[c]=p)}),i}const Y7="1.6.8",Ex={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Ex[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const HV={};Ex.transitional=function(e,i,r){function n(a,o){return"[Axios v"+Y7+"] Transitional option '"+a+"'"+o+(r?". "+r:"")}return(a,o,s)=>{if(e===!1)throw new Fi(n(o," has been removed"+(i?" in "+i:"")),Fi.ERR_DEPRECATED);return i&&!HV[o]&&(HV[o]=!0,console.warn(n(o," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(a,o,s):!0}};function Mye(t,e,i){if(typeof t!="object")throw new Fi("options must be an object",Fi.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let n=r.length;for(;n-- >0;){const a=r[n],o=e[a];if(o){const s=t[a],l=s===void 0||o(s,a,t);if(l!==!0)throw new Fi("option "+a+" must be "+l,Fi.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new Fi("Unknown option "+a,Fi.ERR_BAD_OPTION)}}const V1={assertOptions:Mye,validators:Ex},ud=V1.validators;class qS{constructor(e){this.defaults=e,this.interceptors={request:new _V,response:new _V}}async request(e,i){try{return await this._request(e,i)}catch(r){if(r instanceof Error){let n;Error.captureStackTrace?Error.captureStackTrace(n={}):n=new Error;const a=n.stack?n.stack.replace(/^.+\n/,""):"";r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}throw r}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=Wf(this.defaults,i);const{transitional:r,paramsSerializer:n,headers:a}=i;r!==void 0&&V1.assertOptions(r,{silentJSONParsing:ud.transitional(ud.boolean),forcedJSONParsing:ud.transitional(ud.boolean),clarifyTimeoutError:ud.transitional(ud.boolean)},!1),n!=null&&(ye.isFunction(n)?i.paramsSerializer={serialize:n}:V1.assertOptions(n,{encode:ud.function,serialize:ud.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let o=a&&ye.merge(a.common,a[i.method]);a&&ye.forEach(["delete","get","head","post","put","patch","common"],h=>{delete a[h]}),i.headers=vc.concat(o,a);const s=[];let l=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(i)===!1||(l=l&&f.synchronous,s.unshift(f.fulfilled,f.rejected))});const u=[];this.interceptors.response.forEach(function(f){u.push(f.fulfilled,f.rejected)});let c,d=0,p;if(!l){const h=[jV.bind(this),void 0];for(h.unshift.apply(h,s),h.push.apply(h,u),p=h.length,c=Promise.resolve(i);d<p;)c=c.then(h[d++],h[d++]);return c}p=s.length;let m=i;for(d=0;d<p;){const h=s[d++],f=s[d++];try{m=h(m)}catch(g){f.call(this,g);break}}try{c=jV.call(this,m)}catch(h){return Promise.reject(h)}for(d=0,p=u.length;d<p;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=Wf(this.defaults,e);const i=W7(e.baseURL,e.url);return V7(i,e.params,e.paramsSerializer)}}ye.forEach(["delete","get","head","options"],function(e){qS.prototype[e]=function(i,r){return this.request(Wf(r||{},{method:e,url:i,data:(r||{}).data}))}});ye.forEach(["post","put","patch"],function(e){function i(r){return function(a,o,s){return this.request(Wf(s||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}qS.prototype[e]=i(),qS.prototype[e+"Form"]=i(!0)});const GU=qS;class Mx{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const r=this;this.promise.then(n=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](n);r._listeners=null}),this.promise.then=n=>{let a;const o=new Promise(s=>{r.subscribe(s),a=s}).then(n);return o.cancel=function(){r.unsubscribe(a)},o},e(function(a,o,s){r.reason||(r.reason=new Vb(a,o,s),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}static source(){let e;return{token:new Mx(function(n){e=n}),cancel:e}}}const Nye=Mx;function Aye(t){return function(i){return t.apply(null,i)}}function Oye(t){return ye.isObject(t)&&t.isAxiosError===!0}const j1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(j1).forEach(([t,e])=>{j1[e]=t});const kye=j1;function K7(t){const e=new GU(t),i=E7(GU.prototype.request,e);return ye.extend(i,GU.prototype,e,{allOwnKeys:!0}),ye.extend(i,e,null,{allOwnKeys:!0}),i.create=function(n){return K7(Wf(t,n))},i}const Mn=K7(Cx);Mn.Axios=GU;Mn.CanceledError=Vb;Mn.CancelToken=Nye;Mn.isCancel=z7;Mn.VERSION=Y7;Mn.toFormData=JD;Mn.AxiosError=Fi;Mn.Cancel=Mn.CanceledError;Mn.all=function(e){return Promise.all(e)};Mn.spread=Aye;Mn.isAxiosError=Oye;Mn.mergeConfig=Wf;Mn.AxiosHeaders=vc;Mn.formToJSON=t=>H7(ye.isHTMLForm(t)?new FormData(t):t);Mn.getAdapter=q7.getAdapter;Mn.HttpStatusCode=kye;Mn.default=Mn;const X7=IIe();window.location.host.includes("localhost")||window.location.hostname;var Xj;const xye=((Xj=window.dev)==null?void 0:Xj.baseURL)||"http://localhost:3123",jb=Mn.create({baseURL:xye});jb.interceptors.request.use(t=>{const e=localStorage.getItem(X7);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));jb.interceptors.response.use(t=>t,t=>{var e;if(t.message==="Network Error"&&console.log("network error"),t.response){((e=t.response)==null?void 0:e.status)===401&&J7();const i=t.response.data.message||t.response.data.error||t.response.data;console.log({message:i})}});const Fye=()=>{const t=localStorage.getItem(X7);jb.defaults.headers.common.Authorization=`Bearer ${t}`},J7=()=>{jb.defaults.headers.common.Authorization=void 0},tv={...jb,addAuthorization:Fye,removeAuthorization:J7},Nx="Missing tournamentId";async function Z7(t){if(!(t!=null&&t.tournamentId))throw new Error(Nx);return await tv.post("/factory/tournamentinfo",t)}async function G1({providerAbbr:t}){if(!t)throw new Error("missing provicerAbbr");return await tv.post("/provider/calendar",{providerAbbr:t})}async function Q7(t){if(!(t!=null&&t.tournamentId))throw new Error(Nx);if(!(t!=null&&t.eventId))throw new Error("missing eventId");return await tv.post("/factory/eventdata",t)}async function Lye(t){if(!(t!=null&&t.tournamentId))throw new Error(Nx);return Object.assign(t,{courtCompletedMatchUps:!0,withCourtGridRows:!0,usePublishState:!0,minCourtGridRows:10,nextMatchUps:!0}),await tv.post("/factory/scheduledmatchUps",{params:t})}async function _ye(){return await tv.get("/factory/version")}function Jv(t){return`tournament_${t.toLowerCase()}`}function Ax(t){return`tab_tournament_${t.toLowerCase()}`}const Pm={},H1=["Info","Events","Schedule","Matches","Players","Stats"];function z1(t){t==="Schedule"&&Lye({tournamentId:Pm.tournamentId}).then(e=>{const i=e==null?void 0:e.data;vIe({data:i})}),Pm.tab=t,H1.forEach(e=>{const i=document.getElementById(Jv(e));i.style.display=e===t?"block":"none"})}function MC(t){const e=document.getElementById(Ax(t));e.style.display="block"}function NC(t){const e=document.getElementById(Ax(t));e.style.display=$s}const $ye=()=>{const t=document.createElement("div");t.className="container";const e=document.createElement("section");e.className="hero";const i=document.createElement("div");i.className="hero-body",i.id="tournament-hero";const r=document.createElement("div");r.className="columns";const n=document.createElement("div");n.className="column is-one-quarter has-text-centered",n.id=Qj,r.appendChild(n);const a=document.createElement("div");a.className="column has-text-centered",a.id=Jj,r.appendChild(a),i.appendChild(r),e.appendChild(i),t.appendChild(e);const o=document.createElement("div"),s=document.createElement("div");t.appendChild(o),t.appendChild(s),H1.forEach(u=>{const c=document.createElement("section");c.className="section is-fluid is-centered",c.style.display="none",c.style.width="100%",c.id=Jv(u),s.appendChild(c)}),o.className="tabs is-centered";const l=document.createElement("ul");return H1.forEach(u=>{const c=document.createElement("li");c.id=Ax(u),c.style.display="none",c.className="menu";const d=document.createElement("a");d.textContent=u,d.onclick=()=>z1(u),c.appendChild(d),l.appendChild(c)}),o.appendChild(l),t};function Bye(){const t=document.createElement("div");t.className="main noselect";const e=document.createElement("nav");e.className="navbar";const i=document.createElement("div");i.className="navbar-brand";const r=document.createElement("div");r.onclick=()=>window.history.back(),r.className="navbar-item",r.innerHTML="<<",r.id="back",i.appendChild(r),e.appendChild(i),t.appendChild(e);const n=document.createElement("div");n.style.display="none",n.id=Sy;const a=document.createElement("div");a.style.display="none",a.id=tN;const o=document.createElement("div");o.className="controlBar flexcol flexgrow flexcenter",o.id=Zj,a.appendChild(o);const s=document.createElement("div");s.className="flexcol flexgrow flexcenter box",s.id=lE,a.appendChild(s);const l=document.createElement("div");return l.style.backgroundColor="white",l.style.display="none",l.id=F0,l.appendChild($ye()),t.appendChild(a),t.appendChild(l),t.appendChild(n),t}function HU(t){Qre.forEach(e=>{const i=document.querySelector(`#${e}`);i&&(i.style.display=e===t?"block":"none")})}function Vye(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=i=>r=>i(r).then(n=>console.log(n.data),n=>console.log(n));jye({...{getServerFactoryVersion:i=>t(_ye)(i),getProviderCalendar:i=>t(G1)(i),getTournamentInfo:i=>t(Z7)(i),getEventData:i=>t(Q7(i))},baseApi:tv,context:Pm})}function jye(t){if(typeof(window==null?void 0:window.dev)=="object")try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch{console.log("production environment")}}function Gye(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.onunhandledrejection=t=>{t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?console.warn("popup blocked"):console.warn("Unhandled rejection:",e&&(e.stack||e))}}const Hye="1.2.2",AC=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function OC(t,e,i,r){t.addEventListener?t.addEventListener(e,i,r):t.attachEvent&&t.attachEvent("on".concat(e),i)}function Lv(t,e,i,r){t.removeEventListener?t.removeEventListener(e,i,r):t.detachEvent&&t.detachEvent("on".concat(e),i)}function eK(t,e){const i=e.slice(0,e.length-1);for(let r=0;r<i.length;r++)i[r]=t[i[r].toLowerCase()];return i}function tK(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function zye(t,e){const i=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let n=!0;for(let a=0;a<i.length;a++)r.indexOf(i[a])===-1&&(n=!1);return n}const HI={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":AC?173:189,"=":AC?61:187,";":AC?59:186,"'":222,"[":219,"]":221,"\\":220},Cu={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},W1={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},da={16:!1,18:!1,17:!1,91:!1},Jr={};for(let t=1;t<20;t++)HI["f".concat(t)]=111+t;let Ur=[],Zv=null,iK="all";const cc=new Map,Gb=t=>HI[t.toLowerCase()]||Cu[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),Wye=t=>Object.keys(HI).find(e=>HI[e]===t),qye=t=>Object.keys(Cu).find(e=>Cu[e]===t);function rK(t){iK=t||"all"}function zI(){return iK||"all"}function Yye(){return Ur.slice(0)}function Kye(){return Ur.map(t=>Wye(t)||qye(t)||String.fromCharCode(t))}function Xye(){const t=[];return Object.keys(Jr).forEach(e=>{Jr[e].forEach(i=>{let{key:r,scope:n,mods:a,shortcut:o}=i;t.push({scope:n,shortcut:o,mods:a,keys:r.split("+").map(s=>Gb(s))})})}),t}function Jye(t){const e=t.target||t.srcElement,{tagName:i}=e;let r=!0;const n=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(n||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(r=!1),r}function Zye(t){return typeof t=="string"&&(t=Gb(t)),Ur.indexOf(t)!==-1}function Qye(t,e){let i,r;t||(t=zI());for(const n in Jr)if(Object.prototype.hasOwnProperty.call(Jr,n))for(i=Jr[n],r=0;r<i.length;)i[r].scope===t?i.splice(r,1).forEach(o=>{let{element:s}=o;return Ox(s)}):r++;zI()===t&&rK(e||"all")}function ebe(t){let e=t.keyCode||t.which||t.charCode;const i=Ur.indexOf(e);if(i>=0&&Ur.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&Ur.splice(0,Ur.length),(e===93||e===224)&&(e=91),e in da){da[e]=!1;for(const r in Cu)Cu[r]===e&&(lu[r]=!1)}}function nK(t){if(typeof t>"u")Object.keys(Jr).forEach(n=>{Array.isArray(Jr[n])&&Jr[n].forEach(a=>fU(a)),delete Jr[n]}),Ox(null);else if(Array.isArray(t))t.forEach(n=>{n.key&&fU(n)});else if(typeof t=="object")t.key&&fU(t);else if(typeof t=="string"){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];let[n,a]=i;typeof n=="function"&&(a=n,n=""),fU({key:t,scope:n,method:a,splitKey:"+"})}}const fU=t=>{let{key:e,scope:i,method:r,splitKey:n="+"}=t;tK(e).forEach(o=>{const s=o.split(n),l=s.length,u=s[l-1],c=u==="*"?"*":Gb(u);if(!Jr[c])return;i||(i=zI());const d=l>1?eK(Cu,s):[],p=[];Jr[c]=Jr[c].filter(m=>{const f=(r?m.method===r:!0)&&m.scope===i&&zye(m.mods,d);return f&&p.push(m.element),!f}),p.forEach(m=>Ox(m))})};function zV(t,e,i,r){if(e.element!==r)return;let n;if(e.scope===i||e.scope==="all"){n=e.mods.length>0;for(const a in da)Object.prototype.hasOwnProperty.call(da,a)&&(!da[a]&&e.mods.indexOf(+a)>-1||da[a]&&e.mods.indexOf(+a)===-1)&&(n=!1);(e.mods.length===0&&!da[16]&&!da[18]&&!da[17]&&!da[91]||n||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Ur),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function WV(t,e){const i=Jr["*"];let r=t.keyCode||t.which||t.charCode;if(!lu.filter.call(this,t))return;if((r===93||r===224)&&(r=91),Ur.indexOf(r)===-1&&r!==229&&Ur.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(s=>{const l=W1[s];t[s]&&Ur.indexOf(l)===-1?Ur.push(l):!t[s]&&Ur.indexOf(l)>-1?Ur.splice(Ur.indexOf(l),1):s==="metaKey"&&t[s]&&Ur.length===3&&(t.ctrlKey||t.shiftKey||t.altKey||(Ur=Ur.slice(Ur.indexOf(l))))}),r in da){da[r]=!0;for(const s in Cu)Cu[s]===r&&(lu[s]=!0);if(!i)return}for(const s in da)Object.prototype.hasOwnProperty.call(da,s)&&(da[s]=t[W1[s]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Ur.indexOf(17)===-1&&Ur.push(17),Ur.indexOf(18)===-1&&Ur.push(18),da[17]=!0,da[18]=!0);const n=zI();if(i)for(let s=0;s<i.length;s++)i[s].scope===n&&(t.type==="keydown"&&i[s].keydown||t.type==="keyup"&&i[s].keyup)&&zV(t,i[s],n,e);if(!(r in Jr))return;const a=Jr[r],o=a.length;for(let s=0;s<o;s++)if((t.type==="keydown"&&a[s].keydown||t.type==="keyup"&&a[s].keyup)&&a[s].key){const l=a[s],{splitKey:u}=l,c=l.key.split(u),d=[];for(let p=0;p<c.length;p++)d.push(Gb(c[p]));d.sort().join("")===Ur.sort().join("")&&zV(t,l,n,e)}}function lu(t,e,i){Ur=[];const r=tK(t);let n=[],a="all",o=document,s=0,l=!1,u=!0,c="+",d=!1,p=!1;for(i===void 0&&typeof e=="function"&&(i=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(a=e.scope),e.element&&(o=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(u=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(c=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(a=e),p&&nK(t,a);s<r.length;s++)t=r[s].split(c),n=[],t.length>1&&(n=eK(Cu,t)),t=t[t.length-1],t=t==="*"?"*":Gb(t),t in Jr||(Jr[t]=[]),Jr[t].push({keyup:l,keydown:u,scope:a,mods:n,shortcut:r[s],method:i,key:r[s],splitKey:c,element:o});if(typeof o<"u"&&window){if(!cc.has(o)){const m=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return WV(f,o)},h=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;WV(f,o),ebe(f)};cc.set(o,{keydownListener:m,keyupListenr:h,capture:d}),OC(o,"keydown",m,d),OC(o,"keyup",h,d)}if(!Zv){const m=()=>{Ur=[]};Zv={listener:m,capture:d},OC(window,"focus",m,d)}}}function tbe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(Jr).forEach(i=>{Jr[i].filter(n=>n.scope===e&&n.shortcut===t).forEach(n=>{n&&n.method&&n.method()})})}function Ox(t){const e=Object.values(Jr).flat();if(e.findIndex(r=>{let{element:n}=r;return n===t})<0){const{keydownListener:r,keyupListenr:n,capture:a}=cc.get(t)||{};r&&n&&(Lv(t,"keyup",n,a),Lv(t,"keydown",r,a),cc.delete(t))}if((e.length<=0||cc.size<=0)&&(Object.keys(cc).forEach(n=>{const{keydownListener:a,keyupListenr:o,capture:s}=cc.get(n)||{};a&&o&&(Lv(n,"keyup",o,s),Lv(n,"keydown",a,s),cc.delete(n))}),cc.clear(),Object.keys(Jr).forEach(n=>delete Jr[n]),Zv)){const{listener:n,capture:a}=Zv;Lv(window,"focus",n,a),Zv=null}}const kC={getPressedKeyString:Kye,setScope:rK,getScope:zI,deleteScope:Qye,getPressedKeyCodes:Yye,getAllKeyCodes:Xye,isPressed:Zye,filter:Jye,trigger:tbe,unbind:nK,keyMap:HI,modifier:Cu,modifierMap:W1};for(const t in kC)Object.prototype.hasOwnProperty.call(kC,t)&&(lu[t]=kC[t]);if(typeof window<"u"){const t=window.hotkeys;lu.noConflict=e=>(e&&window.hotkeys===lu&&(window.hotkeys=t),lu),window.hotkeys=lu}const gU=[];function ibe(){console.log(`%cversion: ${Hye}`,"color: lightblue"),lu("shift+1,shift+3,esc,/",(t,e)=>{t.preventDefault();const r=lu.shift?e.key.split(e.splitKey)[1]:e.key;r==="/"&&gU.splice(0,gU.length),gU.push(r),gU.join("")==="esc13"&&Vye()}),HU(Sy),Gye()}const rbe=t=>{let e;const i=Array.isArray(t)?t:[t];return r=>{if(e&&i.forEach(n=>n.removeFilter(e)),r){const n=r==null?void 0:r.toLowerCase();e=a=>{var o;return(o=a.searchText)==null?void 0:o.includes(n)},i.forEach(a=>a.addFilter(e))}else e=void 0}},aK=t=>(e,i)=>{const r=e.getDefinition();return t.includes(r.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"};function nbe(t,e,i,r){const n=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${n})</span>`}function abe(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}var qV,nr="colors",eo="sizes",at="space",obe={gap:at,gridGap:at,columnGap:at,gridColumnGap:at,rowGap:at,gridRowGap:at,inset:at,insetBlock:at,insetBlockEnd:at,insetBlockStart:at,insetInline:at,insetInlineEnd:at,insetInlineStart:at,margin:at,marginTop:at,marginRight:at,marginBottom:at,marginLeft:at,marginBlock:at,marginBlockEnd:at,marginBlockStart:at,marginInline:at,marginInlineEnd:at,marginInlineStart:at,padding:at,paddingTop:at,paddingRight:at,paddingBottom:at,paddingLeft:at,paddingBlock:at,paddingBlockEnd:at,paddingBlockStart:at,paddingInline:at,paddingInlineEnd:at,paddingInlineStart:at,top:at,right:at,bottom:at,left:at,scrollMargin:at,scrollMarginTop:at,scrollMarginRight:at,scrollMarginBottom:at,scrollMarginLeft:at,scrollMarginX:at,scrollMarginY:at,scrollMarginBlock:at,scrollMarginBlockEnd:at,scrollMarginBlockStart:at,scrollMarginInline:at,scrollMarginInlineEnd:at,scrollMarginInlineStart:at,scrollPadding:at,scrollPaddingTop:at,scrollPaddingRight:at,scrollPaddingBottom:at,scrollPaddingLeft:at,scrollPaddingX:at,scrollPaddingY:at,scrollPaddingBlock:at,scrollPaddingBlockEnd:at,scrollPaddingBlockStart:at,scrollPaddingInline:at,scrollPaddingInlineEnd:at,scrollPaddingInlineStart:at,fontSize:"fontSizes",background:nr,backgroundColor:nr,backgroundImage:nr,borderImage:nr,border:nr,borderBlock:nr,borderBlockEnd:nr,borderBlockStart:nr,borderBottom:nr,borderBottomColor:nr,borderColor:nr,borderInline:nr,borderInlineEnd:nr,borderInlineStart:nr,borderLeft:nr,borderLeftColor:nr,borderRight:nr,borderRightColor:nr,borderTop:nr,borderTopColor:nr,caretColor:nr,color:nr,columnRuleColor:nr,fill:nr,outline:nr,outlineColor:nr,stroke:nr,textDecorationColor:nr,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:eo,minBlockSize:eo,maxBlockSize:eo,inlineSize:eo,minInlineSize:eo,maxInlineSize:eo,width:eo,minWidth:eo,maxWidth:eo,height:eo,minHeight:eo,maxHeight:eo,flexBasis:eo,gridTemplateColumns:eo,gridTemplateRows:eo,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},sbe=(t,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,Hb=()=>{const t=Object.create(null);return(e,i,...r)=>{const n=(a=>JSON.stringify(a,sbe))(e);return n in t?t[n]:t[n]=i(e,...r)}},zU=Symbol.for("sxs.internal"),kx=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),YV=t=>{for(const e in t)return!0;return!1},{hasOwnProperty:lbe}=Object.prototype,q1=t=>t.includes("-")?t:t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),ube=/\s+(?![^()]*\))/,Kh=t=>e=>t(...typeof e=="string"?String(e).split(ube):[e]),KV={appearance:t=>({WebkitAppearance:t,appearance:t}),backfaceVisibility:t=>({WebkitBackfaceVisibility:t,backfaceVisibility:t}),backdropFilter:t=>({WebkitBackdropFilter:t,backdropFilter:t}),backgroundClip:t=>({WebkitBackgroundClip:t,backgroundClip:t}),boxDecorationBreak:t=>({WebkitBoxDecorationBreak:t,boxDecorationBreak:t}),clipPath:t=>({WebkitClipPath:t,clipPath:t}),content:t=>({content:t.includes('"')||t.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(t)?t:`"${t}"`}),hyphens:t=>({WebkitHyphens:t,hyphens:t}),maskImage:t=>({WebkitMaskImage:t,maskImage:t}),maskSize:t=>({WebkitMaskSize:t,maskSize:t}),tabSize:t=>({MozTabSize:t,tabSize:t}),textSizeAdjust:t=>({WebkitTextSizeAdjust:t,textSizeAdjust:t}),userSelect:t=>({WebkitUserSelect:t,userSelect:t}),marginBlock:Kh((t,e)=>({marginBlockStart:t,marginBlockEnd:e||t})),marginInline:Kh((t,e)=>({marginInlineStart:t,marginInlineEnd:e||t})),maxSize:Kh((t,e)=>({maxBlockSize:t,maxInlineSize:e||t})),minSize:Kh((t,e)=>({minBlockSize:t,minInlineSize:e||t})),paddingBlock:Kh((t,e)=>({paddingBlockStart:t,paddingBlockEnd:e||t})),paddingInline:Kh((t,e)=>({paddingInlineStart:t,paddingInlineEnd:e||t}))},xC=/([\d.]+)([^]*)/,cbe=(t,e)=>t.length?t.reduce((i,r)=>(i.push(...e.map(n=>n.includes("&")?n.replace(/&/g,/[ +>|~]/.test(r)&&/&.*&/.test(n)?`:is(${r})`:r):r+" "+n)),i),[]):e,dbe=(t,e)=>t in pbe&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(i,r,n,a)=>r+(n==="stretch"?`-moz-available${a};${q1(t)}:${r}-webkit-fill-available`:`-moz-fit-content${a};${q1(t)}:${r}fit-content`)+a):String(e),pbe={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},Mc=t=>t?t+"-":"",oK=(t,e,i)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(r,n,a,o,s)=>o=="$"==!!a?r:(n||o=="--"?"calc(":"")+"var(--"+(o==="$"?Mc(e)+(s.includes("$")?"":Mc(i))+s.replace(/\$/g,"-"):s)+")"+(n||o=="--"?"*"+(n||"")+(a||"1")+")":"")),mbe=/\s*,\s*(?![^()]*\))/,hbe=Object.prototype.toString,lf=(t,e,i,r,n)=>{let a,o,s;const l=(u,c,d)=>{let p,m;const h=f=>{for(p in f){const y=p.charCodeAt(0)===64,I=y&&Array.isArray(f[p])?f[p]:[f[p]];for(m of I){const b=/[A-Z]/.test(v=p)?v:v.replace(/-[^]/g,w=>w[1].toUpperCase()),S=typeof m=="object"&&m&&m.toString===hbe&&(!r.utils[b]||!c.length);if(b in r.utils&&!S){const w=r.utils[b];if(w!==o){o=w,h(w(m)),o=null;continue}}else if(b in KV){const w=KV[b];if(w!==s){s=w,h(w(m)),s=null;continue}}if(y&&(g=p.slice(1)in r.media?"@media "+r.media[p.slice(1)]:p,p=g.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(w,U,T,D,P,C)=>{const R=xC.test(U),N=.0625*(R?-1:1),[A,M]=R?[D,U]:[U,D];return"("+(T[0]==="="?"":T[0]===">"===R?"max-":"min-")+A+":"+(T[0]!=="="&&T.length===1?M.replace(xC,(E,O,k)=>Number(O)+N*(T===">"?1:-1)+k):M)+(P?") and ("+(P[0]===">"?"min-":"max-")+A+":"+(P.length===1?C.replace(xC,(E,O,k)=>Number(O)+N*(P===">"?-1:1)+k):C):"")+")"})),S){const w=y?d.concat(p):[...d],U=y?[...c]:cbe(c,p.split(mbe));a!==void 0&&n(XV(...a)),a=void 0,l(m,U,w)}else a===void 0&&(a=[[],c,d]),p=y||p.charCodeAt(0)!==36?p:`--${Mc(r.prefix)}${p.slice(1).replace(/\$/g,"-")}`,m=S?m:typeof m=="number"?m&&b in fbe?String(m)+"px":String(m):oK(dbe(b,m??""),r.prefix,r.themeMap[b]),a[0].push(`${y?`${p} `:`${q1(p)}:`}${m}`)}}var g,v};h(u),a!==void 0&&n(XV(...a)),a=void 0};l(t,e,i)},XV=(t,e,i)=>`${i.map(r=>`${r}{`).join("")}${e.length?`${e.join(",")}{`:""}${t.join(";")}${e.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,fbe={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},JV=t=>String.fromCharCode(t+(t>25?39:97)),rm=t=>(e=>{let i,r="";for(i=Math.abs(e);i>52;i=i/52|0)r=JV(i%52)+r;return JV(i%52)+r})(((e,i)=>{let r=i.length;for(;r;)e=33*e^i.charCodeAt(--r);return e})(5381,JSON.stringify(t))>>>0),Vv=["themed","global","styled","onevar","resonevar","allvar","inline"],gbe=t=>{if(t.href&&!t.href.startsWith(location.origin))return!1;try{return!!t.cssRules}catch{return!1}},vbe=t=>{let e;const i=()=>{const{cssRules:n}=e.sheet;return[].map.call(n,(a,o)=>{const{cssText:s}=a;let l="";if(s.startsWith("--sxs"))return"";if(n[o-1]&&(l=n[o-1].cssText).startsWith("--sxs")){if(!a.cssRules.length)return"";for(const u in e.rules)if(e.rules[u].group===a)return`--sxs{--sxs:${[...e.rules[u].cache].join(" ")}}${s}`;return a.cssRules.length?`${l}${s}`:""}return s}).join("")},r=()=>{if(e){const{rules:s,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const u in s)delete s[u]}const n=Object(t).styleSheets||[];for(const s of n)if(gbe(s)){for(let l=0,u=s.cssRules;u[l];++l){const c=Object(u[l]);if(c.type!==1)continue;const d=Object(u[l+1]);if(d.type!==4)continue;++l;const{cssText:p}=c;if(!p.startsWith("--sxs"))continue;const m=p.slice(14,-3).trim().split(/\s+/),h=Vv[m[0]];h&&(e||(e={sheet:s,reset:r,rules:{},toString:i}),e.rules[h]={group:d,index:l,cache:new Set(m)})}if(e)break}if(!e){const s=(l,u)=>({type:u,cssRules:[],insertRule(c,d){this.cssRules.splice(d,0,s(c,{import:3,undefined:1}[(c.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,c=>c.cssText).join("")}}`:l}});e={sheet:t?(t.head||t).appendChild(document.createElement("style")).sheet:s("","text/css"),rules:{},reset:r,toString:i}}const{sheet:a,rules:o}=e;for(let s=Vv.length-1;s>=0;--s){const l=Vv[s];if(!o[l]){const u=Vv[s+1],c=o[u]?o[u].index:a.cssRules.length;a.insertRule("@media{}",c),a.insertRule(`--sxs{--sxs:${s}}`,c),o[l]={group:a.cssRules[c+1],index:c,cache:new Set([s])}}Ibe(o[l])}};return r(),e},Ibe=t=>{const e=t.group;let i=e.cssRules.length;t.apply=r=>{try{e.insertRule(r,i),++i}catch{}}},_v=Symbol(),ybe=Hb(),bbe=(t,e)=>ybe(t,()=>(...i)=>{let r={type:null,composers:new Set};for(const n of i)if(n!=null)if(n[zU]){r.type==null&&(r.type=n[zU].type);for(const a of n[zU].composers)r.composers.add(a)}else n.constructor!==Object||n.$$typeof?r.type==null&&(r.type=n):r.composers.add(wbe(n,t));return r.type==null&&(r.type="span"),r.composers.size||r.composers.add(["PJLV",{},[],[],{},[]]),Ube(t,r,e)}),wbe=({variants:t,compoundVariants:e,defaultVariants:i,...r},n)=>{const a=`${Mc(n.prefix)}c-${rm(r)}`,o=[],s=[],l=Object.create(null),u=[];for(const p in i)l[p]=String(i[p]);if(typeof t=="object"&&t)for(const p in t){c=l,d=p,lbe.call(c,d)||(l[p]="undefined");const m=t[p];for(const h in m){const f={[p]:String(h)};String(h)==="undefined"&&u.push(p);const g=m[h],v=[f,g,!YV(g)];o.push(v)}}var c,d;if(typeof e=="object"&&e)for(const p of e){let{css:m,...h}=p;m=typeof m=="object"&&m||{};for(const g in h)h[g]=String(h[g]);const f=[h,m,!YV(m)];s.push(f)}return[a,r,o,s,l,u]},Ube=(t,e,i)=>{const[r,n,a,o]=Sbe(e.composers),s=typeof e.type=="function"||e.type.$$typeof?(d=>{function p(){for(let m=0;m<p[_v].length;m++){const[h,f]=p[_v][m];d.rules[h].apply(f)}return p[_v]=[],null}return p[_v]=[],p.rules={},Vv.forEach(m=>p.rules[m]={apply:h=>p[_v].push([m,h])}),p})(i):null,l=(s||i).rules,u=`.${r}${n.length>1?`:where(.${n.slice(1).join(".")})`:""}`,c=d=>{d=typeof d=="object"&&d||Tbe;const{css:p,...m}=d,h={};for(const v in a)if(delete m[v],v in d){let y=d[v];typeof y=="object"&&y?h[v]={"@initial":a[v],...y}:(y=String(y),h[v]=y!=="undefined"||o.has(v)?y:a[v])}else h[v]=a[v];const f=new Set([...n]);for(const[v,y,I,b]of e.composers){i.rules.styled.cache.has(v)||(i.rules.styled.cache.add(v),lf(y,[`.${v}`],[],t,U=>{l.styled.apply(U)}));const S=ZV(I,h,t.media),w=ZV(b,h,t.media,!0);for(const U of S)if(U!==void 0)for(const[T,D,P]of U){const C=`${v}-${rm(D)}-${T}`;f.add(C);const R=(P?i.rules.resonevar:i.rules.onevar).cache,N=P?l.resonevar:l.onevar;R.has(C)||(R.add(C),lf(D,[`.${C}`],[],t,A=>{N.apply(A)}))}for(const U of w)if(U!==void 0)for(const[T,D]of U){const P=`${v}-${rm(D)}-${T}`;f.add(P),i.rules.allvar.cache.has(P)||(i.rules.allvar.cache.add(P),lf(D,[`.${P}`],[],t,C=>{l.allvar.apply(C)}))}}if(typeof p=="object"&&p){const v=`${r}-i${rm(p)}-css`;f.add(v),i.rules.inline.cache.has(v)||(i.rules.inline.cache.add(v),lf(p,[`.${v}`],[],t,y=>{l.inline.apply(y)}))}for(const v of String(d.className||"").trim().split(/\s+/))v&&f.add(v);const g=m.className=[...f].join(" ");return{type:e.type,className:g,selector:u,props:m,toString:()=>g,deferredInjector:s}};return kx(c,{className:r,selector:u,[zU]:e,toString:()=>(i.rules.styled.cache.has(r)||c(),r)})},Sbe=t=>{let e="";const i=[],r={},n=[];for(const[a,,,,o,s]of t){e===""&&(e=a),i.push(a),n.push(...s);for(const l in o){const u=o[l];(r[l]===void 0||u!=="undefined"||s.includes(u))&&(r[l]=u)}}return[e,i,r,new Set(n)]},ZV=(t,e,i,r)=>{const n=[];e:for(let[a,o,s]of t){if(s)continue;let l,u=0,c=!1;for(l in a){const d=a[l];let p=e[l];if(p!==d){if(typeof p!="object"||!p)continue e;{let m,h,f=0;for(const g in p){if(d===String(p[g])){if(g!=="@initial"){const v=g.slice(1);(h=h||[]).push(v in i?i[v]:g.replace(/^@media ?/,"")),c=!0}u+=f,m=!0}++f}if(h&&h.length&&(o={["@media "+h.join(", ")]:o}),!m)continue e}}}(n[u]=n[u]||[]).push([r?"cv":`${l}-${a[l]}`,o,c])}return n},Tbe={},Dbe=Hb(),Pbe=(t,e)=>Dbe(t,()=>(...i)=>{const r=()=>{for(let n of i){n=typeof n=="object"&&n||{};let a=rm(n);if(!e.rules.global.cache.has(a)){if(e.rules.global.cache.add(a),"@import"in n){let o=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let s of[].concat(n["@import"]))s=s.includes('"')||s.includes("'")?s:`"${s}"`,e.sheet.insertRule(`@import ${s};`,o++);delete n["@import"]}lf(n,[],[],t,o=>{e.rules.global.apply(o)})}}return""};return kx(r,{toString:r})}),Rbe=Hb(),Cbe=(t,e)=>Rbe(t,()=>i=>{const r=`${Mc(t.prefix)}k-${rm(i)}`,n=()=>{if(!e.rules.global.cache.has(r)){e.rules.global.cache.add(r);const a=[];lf(i,[],[],t,s=>a.push(s));const o=`@keyframes ${r}{${a.join("")}}`;e.rules.global.apply(o)}return r};return kx(n,{get name(){return n()},toString:n})}),Ebe=class{constructor(t,e,i,r){this.token=t==null?"":String(t),this.value=e==null?"":String(e),this.scale=i==null?"":String(i),this.prefix=r==null?"":String(r)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+Mc(this.prefix)+Mc(this.scale)+this.token}toString(){return this.computedValue}},Mbe=Hb(),Nbe=(t,e)=>Mbe(t,()=>(i,r)=>{r=typeof i=="object"&&i||Object(r);const n=`.${i=(i=typeof i=="string"?i:"")||`${Mc(t.prefix)}t-${rm(r)}`}`,a={},o=[];for(const l in r){a[l]={};for(const u in r[l]){const c=`--${Mc(t.prefix)}${l}-${u}`,d=oK(String(r[l][u]),t.prefix,l);a[l][u]=new Ebe(u,d,l,t.prefix),o.push(`${c}:${d}`)}}const s=()=>{if(o.length&&!e.rules.themed.cache.has(i)){e.rules.themed.cache.add(i);const l=`${r===t.theme?":root,":""}.${i}{${o.join(";")}}`;e.rules.themed.apply(l)}return i};return{...a,get className(){return s()},selector:n,toString:s}}),Abe=Hb(),sK=t=>{let e=!1;const i=Abe(t,r=>{e=!0;const n="prefix"in(r=typeof r=="object"&&r||{})?String(r.prefix):"",a=typeof r.media=="object"&&r.media||{},o=typeof r.root=="object"?r.root||null:globalThis.document||null,s=typeof r.theme=="object"&&r.theme||{},l={prefix:n,media:a,theme:s,themeMap:typeof r.themeMap=="object"&&r.themeMap||{...obe},utils:typeof r.utils=="object"&&r.utils||{}},u=vbe(o),c={css:bbe(l,u),globalCss:Pbe(l,u),keyframes:Cbe(l,u),createTheme:Nbe(l,u),reset(){u.reset(),c.theme.toString()},theme:{},sheet:u,config:l,prefix:n,getCssText:u.toString,toString:u.toString};return String(c.theme=c.createTheme(s)),c});return e||i.reset(),i},Obe=()=>qV||(qV=sK()),Yt=(...t)=>Obe().css(...t);function kbe({variant:t}){return Yt({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:t})}const xbe=Yt({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),Fbe=Yt({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),Lbe=Yt({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});function _be({drawPosition:t,sideNumber:e}){return Yt({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:e,css:t&&{"&:before":{backgroundColor:"$backgroundColor",content:`${t}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}function $be({winnerChevron:t,isDoubles:e}){const i=(e?.4:.3)*2;return Yt({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:t?"winner":void 0})}const xx=Yt({fontSize:"smaller",color:"gray"});var Bbe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lK(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var uK={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var a="",o=0;o<arguments.length;o++){var s=arguments[o];s&&(a=n(a,r(s)))}return a}function r(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return i.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var o="";for(var s in a)e.call(a,s)&&a[s]&&(o=n(o,s));return o}function n(a,o){return o?a?a+" "+o:a+o:a}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(uK);var Vbe=uK.exports;const bp=lK(Vbe);function jbe({individualParticipant:t,className:e}){var i,r;const{city:n,state:a,countryCode:o}=((r=(i=t==null?void 0:t.person)==null?void 0:i.addresses)==null?void 0:r[0])||{},s=[n,a,o].filter(Boolean).join(", ")||" ",l=document.createElement("div");return l.className=bp(xx(),e),l.innerHTML=s,l}const Gbe=Yt({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),Hbe=Yt({display:"block"}),zbe=Yt({position:"fixed",right:0,left:0}),Wbe=Yt({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),qbe=Yt({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),Ybe=Yt({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),Kbe=Yt({fontWeight:"600",fontSize:"20px"}),QV=Yt({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),e2="Nothing to see here";function vs(t){return typeof t=="function"}function WU(t){return typeof t=="string"}function t2(t){return Array.isArray(t)}function FC(t){return typeof t=="object"&&!Array.isArray(t)}function Xbe(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const i2=(()=>{const t=zbe(),e={},i=".5";let r=[],n,a=[],o=[],s;const l=f=>{if(f){let g;o=o.filter(v=>(v.id===f&&(g=v),v.id!==f)),g&&document.body.removeChild(g)}else{const g=o.pop();g&&document.body.removeChild(g)}},u=()=>{s&&(s.style.opacity=0,s.style.display="none")},c=f=>{const g=o.length;if(f&&e[g]===!1)return;const v=a.pop(),y=r.pop();vs(v)&&v({content:y}),document.body.classList.remove(t),document.body.style.top=null,window.scrollTo({top:n,behavior:"instant"}),u(),l()},d=()=>{s=document.createElement("div"),s.className=Gbe(),s.id="cmdl-backdrop",s.onclick=()=>c(!0),document.body.appendChild(s)},p=({config:f})=>{n=window.scrollY,document.body.classList.add(t),document.body.style.top=`-${n}px`,s||d(),s.style.display="",(f==null?void 0:f.backdrop)!==!1&&(s.style.backgroundColor="rgba(0, 0, 0, 0.2)",s.style.transition="opacity 0.15s linear",s.style.opacity=1)},m=({config:f,attr:g,attrs:v,unit:y="em",value:I})=>{var b;let S;return WU(g)?S=Y1({element:f,attr:g}):t2(v)&&(S=(b=v.map(w=>Y1({element:f,attr:w})).filter(Boolean))==null?void 0:b[0]),S!==void 0&&(I=S),isNaN(I)?I:`${I}${y}`},h=({buttons:f,config:g,modalNumber:v})=>{var y,I;const b=document.createElement("div");b.className=QV(),b.style.padding=m({config:g,attrs:["footer.padding","padding"],value:i});const S={label:((y=g==null?void 0:g.dictionary)==null?void 0:y.close)||"Close",onClick:i2.close,intent:"is-info"};for(const w of f){if(w.hide)continue;const U={...S};FC(w)&&Object.assign(U,w);const T=document.createElement("button");U.disabled!==void 0&&(T.disabled=U.disabled),U.id&&(T.id=U.id),T.className=((I=U==null?void 0:U.footer)==null?void 0:I.className)||"button font-medium",T.classList.add(U.intent),T.style="margin-right: .5em;",T.innerHTML=U.label||U.text,T.onclick=D=>{D.stopPropagation(),vs(U.onClick)&&U.onClick({e:D,content:r[v]}),U.close!==!1&&(vs(U.close)&&U.close(),i2.close())},b.appendChild(T)}return b};return{close:c,open:({title:f="",content:g,buttons:v,footer:y,config:I,onClose:b}={})=>{p({config:I}),a.push(b);const S=o.length+1;e[S]=I==null?void 0:I.clickAway;const w=document.createElement("section"),U=`cmdl-${S}`;w.className=Hbe(),w.role="dialog",w.tabIndex=-1,w.id=U;const T=document.createElement("div");T.className=Wbe(),T.style.maxWidth=`${(I==null?void 0:I.maxWidth)||450}px`,T.onclick=()=>c(!0);const D=document.createElement("div");D.className=qbe(),D.onclick=k=>k.stopPropagation();const P=document.createElement("div"),C=document.createElement("div");P.appendChild(C),D.appendChild(P);const R=({title:k,config:x})=>{P.className=k?Ybe():"",P.style.padding=m({config:x,attrs:["title.padding","padding"],value:i}),C.className=k?Kbe():"",C.innerHTML=k};f&&R({title:f});const N=document.createElement("div");D.appendChild(N);const A=({content:k,config:x})=>{N.style.fontSize=m({config:x,attr:"fontSize",value:"15px"}),N.style.position="relative",N.style.padding=m({config:x,attrs:["content.padding","padding"],value:i}),vs(k)?r[S]=k(N):FC(k)?N.appendChild(k):WU(k)?N.innerHTML=k:N.innerHTML=e2};if(A({content:g,config:I}),t2(v))y=h({buttons:v,config:I,modalNumber:S}),D.appendChild(y);else if(y){const k=document.createElement("div");k.className=QV(),k.style.padding=m({config:I,attrs:["footer.padding","padding"]}),FC(y)?k.appendChild(y):WU(y)?k.innerHTML=y:k.innerHTML=e2,D.appendChild(k)}T.appendChild(D),w.appendChild(T),document.body.appendChild(w),o.push(w);const M=({content:k,config:x})=>{r[S]=void 0,Xbe(N),A({content:k,config:x})},E=({buttons:k,config:x})=>{D.removeChild(y),y=h({buttons:k,config:x,modalNumber:S}),D.appendChild(y)},O=({onClose:k})=>{a.length=0,a.push(k)};return{setContent:M,setButtons:E,update:({content:k,buttons:x,title:F,config:$,onClose:_})=>{I=$||I,k&&M({content:k,config:I}),x&&E({buttons:x,config:I}),_&&O({onClose:_}),F&&R({title:F,config:I})}}}}})();function Y1({element:t,attr:e}){if(!WU(e))return;const i=e.split(".");for(const r of i)if(t=t==null?void 0:t[r],!t)return;return t}function Jbe({individualParticipant:t,attribute:e,className:i}){const r=t==null?void 0:t.person,n=Y1({element:r,attr:e});if(!n)return;const a=document.createElement("div");return a.className=bp(xx(),i),a.innerHTML=n,a}function Zbe({individualParticipant:t,className:e}){var i;const r=(i=t==null?void 0:t.teams)==null?void 0:i[0],n=(r==null?void 0:r.participantName)||" ",a=document.createElement("div");return a.className=bp(xx(),e),a.classList.add("tmx-tm"),a.setAttribute("id",r==null?void 0:r.participantId),a.innerHTML=n,a}function Qbe(t){var e,i,r,n;const a=(i=(e=t==null?void 0:t.composition)==null?void 0:e.configuration)==null?void 0:i.participantDetail;if(a==="TEAM")return Zbe(t);if(((n=(r=t==null?void 0:t.composition)==null?void 0:r.configuration)==null?void 0:n.showAddress)??a==="ADDRESS")return jbe(t);if(a){const o=Jbe({...t,attribute:a});if(o)return o}return document.createElement("div")}const ewe=Yt({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});function twe({className:t,composition:e,side:i}){const r=(i==null?void 0:i.seedValue)==="~"?"":(i==null?void 0:i.seedValue)!==void 0&&i.seedValue||(i==null?void 0:i.seedNumber);if(!r)return"";const n=(e==null?void 0:e.configuration)||{},{bracketedSeeds:a}=n,o=typeof a=="boolean"&&["(",")"]||a==="square"&&["[","]"]||["",""],s=`${o[0]}${r}${o[1]}`,l=n.seedingElement==="sup"?"sup":"span",u=document.createElement(l);return u.className=t,u.innerHTML=s,u}const iwe=Yt({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});function rwe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n}){var a,o,s,l,u,c,d;const p=e==null?void 0:e.configuration,m=((a=p==null?void 0:p.scaleAttributes)==null?void 0:a.eventType)||(r==null?void 0:r.matchUpType)||"SINGLES",h=t==null?void 0:t.rankings,f=t==null?void 0:t.ratings,g=p==null?void 0:p.scaleAttributes,v=g==null?void 0:g.scaleType,y=g==null?void 0:g.scaleName,I=g==null?void 0:g.accessor,b=v==="RATING"?f:h,S=(s=(o=b==null?void 0:b.SINGLES)==null?void 0:o.find(N=>(N==null?void 0:N.scaleName)===y))==null?void 0:s.scaleValue,w=(u=(l=b==null?void 0:b.DOUBLES)==null?void 0:l.find(N=>(N==null?void 0:N.scaleName)===y))==null?void 0:u.scaleValue,U=S&&I?S[I]:S||"",T=w&&I?w[I]:w||"",D=m==="SINGLES"?U:T,P=(c=p==null?void 0:p.scaleAttributes)==null?void 0:c.fallback,C=!n&&(D||P&&(U||T)),R=document.createElement("span");return C&&(R.className=bp(i,iwe({color:(d=p==null?void 0:p.scaleAttributes)==null?void 0:d.scaleColor}))),R.innerHTML=C||"",R}var nwe=Object.defineProperty,bt=(t,e)=>{for(var i in e)nwe(t,i,{get:e[i],enumerable:!0})};function QD(){return"2.1.29"}var cK={};bt(cK,{competitionGovernor:()=>dK,drawsGovernor:()=>aX,entriesGovernor:()=>gee,eventGovernor:()=>See,generationGovernor:()=>Bee,matchUpFormatGovernor:()=>Jee,matchUpGovernor:()=>Zee,mocksGovernor:()=>A$,participantGovernor:()=>zte,policyGovernor:()=>jQ,publishingGovernor:()=>hie,queryGovernor:()=>qQ,reportGovernor:()=>Sie,scheduleGovernor:()=>Tie,scoreGovernor:()=>v_,tieFormatGovernor:()=>Fie,tournamentGovernor:()=>zie,venueGovernor:()=>nre});var dK={};bt(dK,{getLinkedTournamentIds:()=>sw,getTournamentIds:()=>aw,linkTournaments:()=>tX,mutate:()=>pK,query:()=>nX,unlinkTournament:()=>rX,unlinkTournaments:()=>iX});var pK={};bt(pK,{linkTournaments:()=>tX,unlinkTournament:()=>rX,unlinkTournaments:()=>iX});var nm="SINGLES",ii="SINGLES",zd="DOUBLES",ei="DOUBLES",Ba="TEAM",fi="TEAM",awe={SINGLES_MATCHUP:nm,SINGLES:ii,DOUBLES_MATCHUP:zd,DOUBLES:ei,TEAM_MATCHUP:Ba,TEAM:fi},mK={[ii]:[ii,"S"],[ei]:[ei,"D"],[fi]:[fi,"T"],S:[ii,"S"],D:[ei,"D"],T:[fi,"T"]};function lr(t,e){return(t??0)-(e??0)}function Qe(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function Cs(t){return isNaN(t)?!1:t&&(t&t-1)===0}function r2(t){if(!t.length)return;let e=[...t].sort(lr),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function owe(t){if(!Cs(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function Fx(t){return isNaN(t)?0:t%2&&t+1||t}function Lx(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function _i(t){return!isNaN(parseFloat(t))}function hK(t){let e=Qe(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function iv(t){if(isNaN(t))return!1;for(;!Cs(t);)t++;return t}function ro(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function st(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function swe(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function lwe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function fK(t,e,i,r,n=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=fK(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),r&&(s=lwe(s,r)),parseFloat(s.toFixed(n))}function YS(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function dt(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function uwe(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function Tn(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function qf(t){return st(t)?t:1/0}function Pa(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function cwe(t){return gK(Pa(t))}function gK(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function dwe(t,e,i){return i.indexOf(t)===e}function vK(t){return t.filter(dwe)}function ga(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Lo(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Te(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function qs(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function ji(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function n2(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function Nn(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function pwe(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function mwe(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function Cr(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function IK(t,[e,...i]){return t.length?[t.slice(0,e),...IK(t.slice(e),[...i,e])]:[]}function hwe(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function yK(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function bK(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function K1(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let o=i?!!(Math.floor(a/e)%2):!1,s=a%e,l=o?e-1-s:s;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function fwe(t,e=1){if(!Array.isArray(t)||!t.every(st))return[];let i=Math.min(...t,e),r=Math.max(...t);return Te(i,r+1).filter(n=>!t.includes(n))}function ha(t){return typeof t=="function"}function Di(t){return typeof t=="string"}function At(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function gwe(t,e){if(!At(t)||!At(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function wK(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(At).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var vwe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function X1(t,e){if(t===void 0)return null;if(!At(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>X1(a))}:{[n]:e?r(t[n]):X1(t[n])}))}function J1(t){return Array.isArray(t)?t.length+t.map(J1).reduce((e,i)=>e+i,0):At(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>J1(t[e])).reduce((e,i)=>e+i,0):0}function Iwe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=J1(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function eP(t,e){return!Array.isArray(t)||!Di(e)?!1:ji(t,mK[e]).length}var Z={success:!0},UK="error",ywe={SUCCESS:Z,ERROR:UK};function SK({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:o}=n;if(typeof a!="number"||typeof o!="number"||o>e||o<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==dt(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...Z}}var bwe={};bt(bwe,{addNotice:()=>ut,callListener:()=>sM,createInstanceState:()=>tUe,cycleMutationStatus:()=>pF,deepCopyEnabled:()=>dF,deleteNotice:()=>mF,deleteNotices:()=>Xb,disableNotifications:()=>k9,enableNotifications:()=>KU,getDevContext:()=>ja,getMethods:()=>L9,getNotices:()=>_9,getProvider:()=>lM,getTopics:()=>So,getTournamentId:()=>yh,getTournamentRecord:()=>hF,getTournamentRecords:()=>bh,globalLog:()=>V9,handleCaughtError:()=>vP,hasTopic:()=>fP,removeTournamentRecord:()=>B9,setDeepCopy:()=>KI,setDevContext:()=>YI,setGlobalLog:()=>O9,setGlobalMethods:()=>x9,setGlobalSubscriptions:()=>rUe,setMethods:()=>F9,setStateMethods:()=>j9,setStateProvider:()=>eUe,setSubscriptions:()=>nUe,setTournamentId:()=>XI,setTournamentRecord:()=>$9,setTournamentRecords:()=>gP,timeKeeper:()=>iUe});var Z1={message:"Chronological error; time violation.",code:"ANACHRONISM"},WI={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},TK={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},Q1={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},ki={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},ve={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},zb={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},Yf={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},am={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},$e={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},DK={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Va={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},wp={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},_x={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},$x={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},Kf={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},PK={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},RK={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},wwe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},Bx={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},Wb={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},tP={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},Uwe={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},rv={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},nv={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},Vx={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},iP={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},jx={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},qb={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},xs={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},CK={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},EK={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},MK={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},NK={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},AK={message:"Invalid action",code:"ERR_INVALID_ACTION"},eM={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},OK={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},kK={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},xK={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},Gx={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},FK={message:"Existing round",code:"ERR_EXISTING_ROUND"},Swe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},Xa={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Ni={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},Hx={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Up={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},LK={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Gl={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},vi={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},mo={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},_K={message:"Event exists",code:"ERR_EXISTING_EVENT"},$K={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},BK={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},zx={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},VK={message:"Missing stage",code:"ERR_MISSING_STAGE"},Sp={message:"Invalid stage",code:"ERR_INVALID_STAGE"},jK={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},GK={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},HK={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},tM={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},Yb={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},qU={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},av={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Nl={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},Wx={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},qx={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},zK={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},ov={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},bn={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},hh={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},hn={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Xu={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},sa={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},la={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},Yx={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},rP={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},Twe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},WK={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},Kx={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},qK={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},Xx={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},Dwe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},Xf={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},Pwe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},Jx={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},Rwe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},nP={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},Cwe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},Ewe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},fh={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Je={message:"Missing value",code:"ERR_MISSING_VALUE"},YK={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},KK={message:"Missing date",code:"ERR_MISSING_DATE"},XK={message:"No valid dates",code:"ERR_NO_VALID_DATES"},KS={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},YU={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},JK={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},xr={message:"Invalid Date",code:"ERR_INVALID_DATE"},No={message:"Invalid time",code:"ERR_INVALID_TIME"},ZK={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},iM={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},QK={message:"Invalid score",code:"ERR_INVALID_SCORE"},aP={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},Mwe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},Zx={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},e9={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},oP={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},rM={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},sP={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},gh={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Es={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},ya={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},t9={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Ms={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},i9={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},vh={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},Kb={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},hr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Wi={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},r9={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},Nwe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},n9={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Zc={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},a9={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},o9={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},s9={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},sv={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},lP={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},Qx={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},nM={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},l9={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},Awe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},Owe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},u9={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},c9={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},aM={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},d9={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},eF={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},p9={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},tF={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},Jf={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},m9={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},lv={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},h9={message:"Court exists",code:"ERR_EXISTING_COURT"},f9={message:"Venue exists",code:"ERR_EXISTING_VENUE"},Ih={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Qc={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},g9={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},iF={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},v9={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},I9={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},kwe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},rF={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},y9={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},nF={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},aF={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},uP={message:"Missing context",code:"ERR_MISSING_CONTEXT"},b9={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},Rm={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},w9={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},uv={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},U9={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},cP={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},S9={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},T9={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Ju={message:"Invalid object",code:"ERR_INVALID_OBJECT"},Qv={message:"Invalid gender",code:"ERR_INVALID_GENDER"},qI={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},se={message:"Invalid values",code:"ERR_INVALID_VALUES"},D9={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},oF={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},P9={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},dP={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},sF={message:"Value unchanged",code:"ABORT_UNCHANGED"},Vr={message:"Not found",code:"ERR_NOT_FOUND"},pP={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},R9={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},lF={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},C9={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},E9={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},oM={message:"Existing stage",code:"ERR_EXISTING_STAGE"},uF={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},mP={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},M9={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},hP={message:"Scores present",code:"ERR_SCORES_PRESENT"},xwe={ANACHRONISM:Z1,CANNOT_CHANGE_WINNING_SIDE:sP,CANNOT_MODIFY_TIEFORMAT:Zx,CANNOT_MODIFY_PARTICIPANT_TYPE:e9,CANNOT_REMOVE_MAIN_STRUCTURE:TK,CANNOT_REMOVE_PARTICIPANTS:oP,CATEGORY_MISMATCH:rM,COURT_EXISTS:h9,COURT_NOT_FOUND:lv,DRAW_DEFINITION_NOT_FOUND:Va,DRAW_ID_EXISTS:CK,DRAW_POSITION_ACTIVE:tP,DRAW_POSITION_ASSIGNED:Kf,DRAW_POSITION_NOT_CLEARED:RK,DRAW_POSITION_NOT_FOUND:wwe,DRAW_SIZE_MISMATCH:jx,DUPLICATE_ENTRY:WI,DUPLICATE_VALUE:D9,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:c9,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:u9,EVENT_EXISTS:_K,EVENT_NOT_FOUND:mo,EXISTING_DRAW_DEFINITIONS:DK,EXISTING_END_TIME:iF,EXISTING_FLIGHT:R9,EXISTING_MATCHUP_ID:E9,EXISTING_OUTCOME:C9,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:sv,EXISTING_PARTICIPANT:lP,EXISTING_POLICY_TYPE:Xx,EXISTING_PROFILE:lF,EXISTING_ROUND:FK,EXISTING_STAGE:oM,EXISTING_STRUCTURE:uF,INCOMPATIBLE_MATCHUP_STATUS:qU,INCOMPLETE_SOURCE_STRUCTURE:_x,INSUFFICIENT_DRAW_POSITIONS:eF,INVALID_ACTION:AK,INVALID_ASSIGNMENT:eM,INVALID_BOOKINGS:KS,INVALID_CATEGORY:qI,INVALID_COLLECTION_DEFINITION:T9,INVALID_CONFIGURATION:S9,INVALID_DATE_AVAILABILITY:YU,INVALID_DATE:xr,INVALID_DRAW_DEFINITION:am,INVALID_DRAW_POSITION_FOR_SEEDING:$x,INVALID_DRAW_POSITION:rv,INVALID_DRAW_SIZE:iP,INVALID_END_TIME:g9,INVALID_ENTRIES:BK,INVALID_EVENT_TYPE:Gl,INVALID_GAME_SCORES:iM,INVALID_GENDER:Qv,INVALID_MATCHUP_FORMAT:Wx,INVALID_MATCHUP_STATUS:av,INVALID_MATCHUP_STATUS_BYE:HK,INVALID_MATCHUP:la,INVALID_OBJECT:Ju,INVALID_PARTICIPANT_ID:Es,INVALID_PARTICIPANT_IDS:ya,INVALID_PARTICIPANT_ROLE:t9,INVALID_PARTICIPANT_SEEDING:EK,INVALID_PARTICIPANT_TYPE:Ms,INVALID_PARTICIPANT:gh,INVALID_POLICY_DEFINITION:qK,INVALID_RECORDS:Q1,INVALID_SCALE_ITEM:Rm,INVALID_SEED_NUMBER:kK,INVALID_SEED_POSITION:xK,INVALID_SET_NUMBER:Rwe,INVALID_SIDE_NUMBER:Jx,INVALID_SCORE:QK,INVALID_STAGE:Sp,INVALID_START_TIME:I9,INVALID_STRUCTURE:wp,INVALID_STOP_TIME:v9,INVALID_TIE_FORMAT:Nl,INVALID_TIME:No,INVALID_TIME_ITEM:rF,INVALID_TOURNAMENT_DATES:ZK,INVALID_TOURNAMENT_RECORD:zb,INVALID_VALUES:se,INVALID_WINNING_SIDE:aP,MATCHUP_NOT_FOUND:hn,METHOD_NOT_FOUND:mP,MISSING_ASSIGNMENTS:zx,MISSING_ASYNC_STATE_PROVIDER:y9,MISSING_AVOIDANCE_POLICY:WK,MISSING_BIRTH_DATE:YK,MISSING_COLLECTION_DEFINITION:zK,MISSING_COURT_ID:fh,MISSING_COURTS_INFO:m9,MISSING_DATE_AVAILABILITY:JK,MISSING_DATE:KK,MISSING_DRAW_DEFINITION:$e,MISSING_DRAW_ID:xs,MISSING_DRAW_POSITION:nv,MISSING_DRAW_POSITIONS:Wb,MISSING_DRAW_SIZE:qb,MISSING_ENTRIES:$K,MISSING_EVENT:vi,MISSING_MATCHUP_FORMAT:qx,MISSING_MATCHUP_ID:bn,MISSING_MATCHUP_IDS:hh,MISSING_MATCHUP:sa,MISSING_MATCHUPS:Xu,MISSING_PARTICIPANT_COUNT:a9,MISSING_PARTICIPANT_ID:hr,MISSING_PARTICIPANT_IDS:Zc,MISSING_PARTICIPANT_ROLE:i9,MISSING_PARTICIPANT:vh,MISSING_PARTICIPANTS:Kb,MISSING_PENALTY_ID:tF,MISSING_PENALTY_TYPE:p9,MISSING_PERSON_DETAILS:s9,MISSING_POLICY_ATTRIBUTES:Kx,MISSING_POLICY_DEFINITION:rP,MISSING_POLICY_TYPE:Yx,MISSING_POSITION_ASSIGNMENTS:GK,MISSING_ROUND_NUMBER:Swe,MISSING_SCHEDULE:b9,MISSING_SCORING_POLICY:Pwe,MISSING_SEED_ASSIGNMENTS:OK,MISSING_SEEDCOUNT_THRESHOLDS:NK,MISSING_SEEDING_POLICY:Twe,MISSING_SET_NUMBER:Cwe,MISSING_SET_OBJECT:nP,MISSING_SIDE_NUMBER:Ewe,MISSING_STAGE:VK,MISSING_STRUCTURE_ID:Xa,MISSING_STRUCTURE:Up,MISSING_STRUCTURES:Hx,MISSING_TARGET_LINK:Gx,MISSING_TIE_FORMAT:ov,MISSING_TIME_ITEM:nF,MISSING_TIME_ITEMS:aF,MISSING_TOURNAMENT_ID:Yf,MISSING_TOURNAMENT_RECORD:ve,MISSING_TOURNAMENT_RECORDS:ki,MISSING_VALUE:Je,MISSING_VENUE_ID:Qc,MODIFICATIONS_FAILED:w9,NO_CANDIDATES:cP,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:d9,NO_MODIFICATIONS_APPLIED:uv,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:aM,NO_PARTICIPANT_REMOVED:n9,NO_VALID_ACTIONS:P9,NO_VALID_ATTRIBUTES:dP,NO_VALID_DATES:XK,NOT_FOUND:Vr,NOT_IMPLEMENTED:pP,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:Qx,PARTICIPANT_ID_EXISTS:r9,PARTICIPANT_NOT_CHECKED_IN:o9,PARTICIPANT_NOT_FOUND:Wi,PARTICIPANT_PAIR_EXISTS:Nwe,PENALTY_NOT_FOUND:Jf,POLICY_NOT_ATTACHED:Dwe,POLICY_NOT_FOUND:Xf,SCHEDULE_NOT_CLEARED:PK,SCHEDULED_MATCHUPS:M9,SCORES_PRESENT:hP,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:MK,STAGE_SEQUENCE_LIMIT:jK,STRUCTURE_NOT_FOUND:Ni,TEAM_NOT_FOUND:oF,UNABLE_TO_ASSIGN_COURT:U9,UNLINKED_STRUCTURES:LK,UNRECOGNIZED_DRAW_TYPE:Bx,UNRECOGNIZED_MATCHUP_FORMAT:Yb,UNRECOGNIZED_MATCHUP_STATUS:tM,VALUE_UNCHANGED:sF,VENUE_EXISTS:f9},Ri={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},N9={addNotice:qwe,callListener:Zwe,cycleMutationStatus:Wwe,deleteNotice:Xwe,deleteNotices:Kwe,disableNotifications:Fwe,enableNotifications:Lwe,getMethods:cF,getNotices:Ywe,getTopics:Jwe,getTournamentId:A9,getTournamentRecord:_we,getTournamentRecords:$we,removeTournamentRecord:Gwe,setMethods:zwe,setSubscriptions:Hwe,setTournamentId:Vwe,setTournamentRecord:Bwe,setTournamentRecords:jwe,handleCaughtError:Qwe};function Fwe(){Ri.disableNotifications=!0}function Lwe(){Ri.disableNotifications=!1}function A9(){return Ri.tournamentId}function _we(t){return Ri.tournamentRecords[t]}function $we(){return Ri.tournamentRecords}function Bwe(t){let e=t==null?void 0:t.tournamentId;return e?(Ri.tournamentRecords[e]=t,{success:!0}):{error:zb}}function Vwe(t){return t?Ri.tournamentRecords[t]?(Ri.tournamentId=t,{success:!0}):{error:ve}:(Ri.tournamentId=void 0,{success:!0})}function jwe(t){Ri.tournamentRecords=t;let e=Object.keys(t);e.length===1?Ri.tournamentId=e[0]:e.length||(Ri.tournamentId=void 0)}function Gwe(t){if(typeof t!="string")return{error:se};if(!Ri.tournamentRecords[t])return{error:Vr};delete Ri.tournamentRecords[t];let e=Object.keys(Ri.tournamentRecords);return e.length===1?Ri.tournamentId=e[0]:e.length||(Ri.tournamentId=void 0),{success:!0}}function Hwe(t){return typeof t.subscriptions!="object"?{error:se}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?Ri.subscriptions[e]=t.subscriptions[e]:delete Ri.subscriptions[e]}),{...Z})}function zwe(t){return typeof t!="object"?{error:se}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(Ri.methods[e]=t[e])}),{...Z})}function Wwe(){let t=Ri.modified;return Ri.modified=!1,t}function qwe({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(Ri.disableNotifications||(Ri.modified=!0),!(Ri.disableNotifications||!Ri.subscriptions[t]&&!r)))return i&&(Ri.notices=Ri.notices.filter(n=>!(n.topic===t&&n.key===i))),Ri.notices.push({topic:t,payload:e,key:i}),{...Z}}function cF(){return Ri.methods??{}}function Ywe({topic:t}){return Ri.notices.filter(e=>e.topic===t).map(e=>e.payload)}function Kwe(){Ri.notices=[]}function Xwe({topic:t,key:e}){Ri.notices=Ri.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function Jwe(){return{topics:Object.keys(Ri.subscriptions)}}function Zwe({topic:t,notices:e},i){let r=Ri.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i==null?void 0:i[t];n&&typeof n=="function"&&n(e)}function Qwe({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:A9(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var ni={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},jr=N9,a2=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function eUe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(ji(Object.keys(t),a2).length!==a2.length)throw new Error("Global state provider is missing required methods");return jr=t,{success:!0}}function tUe(){if(jr.createInstanceState){try{jr.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:y9}}function ja(t){return!t||typeof t!="object"?ni.devContext??!1:typeof ni.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=ni.devContext)==null?void 0:i[e])===t[e]})&&ni.devContext}function iUe(t="reset",e="default"){var i,r;let n=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(ni.timers).filter(a=>a!=="default"||ni.timers[a].startTime).map(a=>{let o=ni.timers[a],s=o.state==="stopped"?0:(n-((o==null?void 0:o.startTime)??0))/1e3,l=o.elapsedTime+s;return{state:ni.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=ni.timers[e].state==="stopped"?0:(n-(((i=ni.timers[e])==null?void 0:i.startTime)??0))/1e3,o=ni.timers[e].elapsedTime+a;return{state:ni.timers[e].state,elapsedTime:o.toFixed(2),timer:e}}}if(!ni.timers[e]||t==="reset"){if(e==="allTimers")return ni.timers={default:{elapsedTime:0}},!0;ni.timers[e]={startTime:n,state:"active",elapsedTime:0}}return ni.timers[e].elapsedTime||(ni.timers[e].elapsedTime=0),t==="stop"&&ni.timers[e].state!=="stopped"&&(ni.timers[e].state="stopped")&&(ni.timers[e].elapsedTime+=(n-(((r=ni.timers[e])==null?void 0:r.startTime)??0))/1e3),t==="start"&&(ni.timers[e].startTime=n)&&(ni.timers[e].state="active"),ni.timers[e]}function O9(t){ha(t)?ni.globalLog=t:delete ni.globalLog}function YI(t){ni.devContext=t}function k9(){jr.disableNotifications()}function KU(){jr.enableNotifications()}function KI(t,e){typeof t=="boolean"&&(ni.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(ni.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(ni.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(ni.deepCopyAttributes.stringify=e.stringify),e.threshold&&(ni.deepCopyAttributes.threshold=e.threshold))}function dF(){return{enabled:ni.deepCopy,...ni.deepCopyAttributes}}function rUe(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{ni.globalSubscriptions[e]=t.subscriptions[e]}),{...Z}):{error:Je,info:"missing subscriptions"}}function nUe(t){return t!=null&&t.subscriptions?jr.setSubscriptions({subscriptions:t.subscriptions}):{error:Je,info:"missing subscriptions"}}function x9(t){return t?typeof t!="object"?{error:se}:(Object.keys(t).forEach(e=>{ha(t[e])&&(ni.globalMethods[e]=t[e])}),{...Z}):{error:Je,info:"missing method declarations"}}function F9(t){return t?typeof t!="object"?{error:se}:jr.setMethods(t):{error:Je,info:"missing method declarations"}}function pF(){return jr.cycleMutationStatus()}function ut(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=ni.globalSubscriptions[t.topic];return jr.addNotice(t,e)}function L9(){return{...ni.globalMethods,...jr.getMethods()}}function _9(t){return jr.getNotices(t)}function mF({key:t,topic:e}){return jr.deleteNotice({key:t,topic:e})}function Xb(){return jr.deleteNotices()}function So(){return jr.getTopics()}function fP(t){var e,i;return(i=(e=So())==null?void 0:e.topics)==null?void 0:i.includes(t)}async function sM(t){return jr.callListener(t,ni.globalSubscriptions)}function yh(){return jr.getTournamentId()}function hF(t){return jr.getTournamentRecord(t)}function bh(){return jr.getTournamentRecords()}function $9(t){return jr.setTournamentRecord(t)}function gP(t){return jr.setTournamentRecords(t)}function XI(t){return jr.setTournamentId(t)}function B9(t){return jr.removeTournamentRecord(t)}function lM(){return jr}function vP({engineName:t,methodName:e,params:i,err:r}){let n=ha(jr.handleCaughtError)&&jr.handleCaughtError||N9.handleCaughtError,{tournamentRecord:a,...o}=i;return n({params:o,engineName:t,methodName:e,err:r})}function V9(t,e){if(ni.globalLog)try{ni.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),O9()}else console.log(e,t)}function j9(t,e,i,r){if(!At(t))return{error:se};_i||(i=1);let n=Array.isArray(e)?e:[],a={},o=(s,l=0)=>{Object.keys(s).forEach(u=>{ha(s[u])?a[u]=s[u]:At(s[u])&&(e===!0||n!=null&&n.includes(u))&&(i===void 0||l<i)&&o(s[u],l+1)})};return o(t),r?x9(a):F9(a),{methods:a}}function aUe(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function He(t,e,i,r){var n;if(typeof t!="object"||t===null)return t;(n=dF())!=null&&n.enabled||(r=!0);let a=["",void 0,null];e&&a.push(!1);let o=aUe(t,a,i);return Object.assign({},...o.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(l=>He(l))}:{[s]:r?t[s]:He(t[s])}))}function te({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,He(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...Z}),e??{success:!0}}var Ns="ANY",Zt="MALE",jn="MIXED",Sd="OTHER",mi="FEMALE",fF={ANY:Ns,MALE:Zt,FEMALE:mi,MIXED:jn,OTHER:Sd},oUe="MIXED events can not contain mixed singles or { gender: ANY } collections",sUe="events with { gender: ANY } can not contain MIXED singles collections";function IP(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&[Zt,mi].includes(i)&&i!==n?te({result:{valid:!1,error:Qv},context:{gender:n},stack:e}):i===jn&&(n===Ns||n===jn&&r!==ei)?te({result:{error:Qv,valid:!1},info:oUe,stack:e}):i===Ns&&n===jn&&r!==ei?te({result:{error:Qv,valid:!1},info:sUe,stack:e}):{valid:!0}}var lUe="normal",o2="timed",uUe="final",gF="NOAD",XU="SET",cUe={S:lUe,F:uUe};function yP(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&t!=null&&t.setFormat)return dUe(t,e)}function JI(t){return!isNaN(Number(t))&&Number(t)}function G9(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function dUe(t,e){var i;let r=JI(t.bestOf)||void 0,n=JI(t.exactly)||void 0,a=r||n;if((i=t.setFormat)!=null&&i.timed&&t.simplified&&a===1)return G9(t.setFormat);let o=a&&`${XU}${a}`||"",s=s2(t.setFormat,e),l=s&&`S:${s}`||"",u=s2(t.finalSetFormat,e),c=a&&a>1&&u&&s!==u&&`F:${u}`||"";if(o&&s)return[o,l,c].filter(d=>d).join("-")}function s2(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return G9(t);if(t.tiebreakSet)return l2(t.tiebreakSet);let i=JI(t.setTo);if(i){let r=t.NoAD&&gF||"",n=l2(t.tiebreakFormat),a=n&&`/${n}`||"",o=JI(t.tiebreakAt),s=o&&(o!==i||e)&&`@${o}`||"";if(n!==!1)return`${i}${r}${a}${s}`}}}function l2(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&JI(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?gF:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Ln(t){if(Di(t)){let e=t.startsWith("T")&&o2||t.startsWith(XU)&&XU||"";if(e===o2){let i=z9(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e===XU)return pUe(t)}}function pUe(t){let e=t.split("-"),i=Jb(e[0].slice(3)),r=i===1||i%2!==0?i:void 0,n=i!==1&&i%2===0?i:void 0,a=e&&u2(e[1]),o=e&&u2(e[2]),s=a&&a.timed||o&&o.timed,l=r&&r<6||s&&n,u=!e[2]||o,c=a,d=He({setFormat:a,exactly:n,bestOf:r});if(o&&(d.finalSetFormat=o),l&&c&&u)return d}function u2(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=cUe[e[0]],r=e[1];if(i&&r){if(r.startsWith("TB")){let h=c2(r);return h===!1?!1:typeof h=="object"?{tiebreakSet:h}:void 0}if(r.startsWith("T"))return z9(r);let n=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=n&&W9(n[2])||!1,o=!(n!=null&&n[2])||a,s=n?Jb(n[1]):void 0,l=H9(r),u=l!==!1,c=u&&l||s,d=c2(r.split("/")[1]),p=d!==!1,m={setTo:s};return a&&(m.NoAD=!0),d?(m.tiebreakFormat=d,m.tiebreakAt=c):m.noTiebreak=!0,s&&o&&p&&u&&m||!1}}}function H9(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?Jb(i[1]):i[1])||!1}function c2(t){if(t)if(t.startsWith("TB")){let e=H9(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),r=i==null?void 0:i[1],n=i&&W9(i[2]),a=!(i!=null&&i[2])||n,o=Jb(r);if(o&&a){let s={tiebreakTo:o};return e&&typeof e=="string"&&!st(e)&&(s.modifier=e),n&&(s.NoAD=!0),s}else return!1}else return!1}function z9(t){var e;let i=t.slice(1),r=i.match(/^(\d+)(@?[A-Za-z]*)/),n=Jb(r==null?void 0:r[1]);if(!n)return;let a={timed:!0,minutes:n},o=r==null?void 0:r[2],s=[void 0,"P","G"].includes(o);if(o&&!s){let l=(e=i.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:e[3];return l?(a.modifier=l,a):void 0}return o&&(a.based=r[2]),a}function W9(t){return t&&t.indexOf(gF)>=0}function Jb(t){return isNaN(Number(t))?0:Number(t)}function Ra({matchUpFormat:t}){if(!Di(t)||t==="")return!1;let e=Ln(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),r=i==null?void 0:i[1],n=i==null?void 0:i[2],a=i==null?void 0:i[3],o=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o==null?void 0:o[1],l=o==null?void 0:o[2],u=o==null?void 0:o[3];return yP(e,!!(i&&n&&r===a||o&&l&&s===u))===t}var XS=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,q9=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,al=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Td=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function JS(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=mt(t.scheduledTime)),!e)return;let i=Ui(t.scheduledTime),r=mt(e);return r&&i&&(r+=`T${i}`),r}function mUe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function cv(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Td.test(wh(t,!0,!0)))}function ba(t){return Wd(t)||XS.test(t)}function hUe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return fUe(i,{displaySeconds:!1})}function fUe(t,e){let i=parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e!=null&&e.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(oo).join(":")}var vF=t=>{let e=ZI(t)||Wd(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${oo(r)}-${oo(e.getUTCDate())}`};function gUe(t){let e=ZI(t)||Wd(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Go(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),o=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,o].join(e):i==="MDY"?[n,a,o].join(e):i==="YDM"?[o,a,n].join(e):i==="DYM"?[a,o,n].join(e):i==="MYD"?[n,o,a].join(e):[o,n,a].join(e)}function ZS(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function vUe(t){return ZS(t).getTime()}function ZI(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function Zf(t,e){if(!ba(t)||!ba(e))return[];let i=mt(t)+"T00:00",r=mt(e)+"T00:00",n=new Date(i),a=new Date(r),o=ZI(a)&&ZI(n)&&u(n,a),s=[],l=0;if(o){let c=n,d=c.getTime();for(;d<=a.getTime()&&l<300;)l+=1,s.push(new Date(c)),d=c.setDate(c.getDate()+1)}return s.map(c=>Go(c));function u(c,d){return c<=d}}var IUe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Wd(t){return typeof t!="string"?!1:IUe.test(t)}function IF(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!isNaN(parseInt(r)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function xt(t){let e=Ui(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>parseInt(n));return i*60+r}function yUe(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[oo(e),oo(i)].join(":")}function QS(t){return IF(t)?t.split(":").slice(0,2).map(oo).join(":"):void 0}function Ui(t){return Wd(t)&&t.indexOf("T")>0?QS(t.split("T").reverse()[0]):QS(t)}function mt(t){return Wd(t)||al.test(t)?t.split("T")[0]:void 0}function jv(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),mt(i.toISOString())}function e0(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function bUe(t){let e=e0(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(oo).join(":")}function wUe(t){var e;let i=e0(t);if(!(typeof i=="object"&&!Object.keys(i).length))return i.ampm?t:(i.hours>12?(i.hours-=12,i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),((e=i.hours)==null?void 0:e[0])==="0"&&(i.hours=i.hours.slice(1)),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}function wh(t,e,i){let r=mt(t),n=Ui(t),a=r?n:t;return t?e&&(r&&i&&t||bUe(a))||wUe(a):void 0}function Y9(t,e){let i=e0(t),r=e0(e);if(parseInt(i.hours)<parseInt(r.hours))return-1;if(parseInt(i.hours)>parseInt(r.hours))return 1;if(i.hours===r.hours){if(parseInt(i.minutes)<parseInt(r.minutes))return-1;if(parseInt(i.minutes)>parseInt(r.minutes))return 1}return 0}function yF(t,e=7){let i=mt(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return Go(n)}function UUe(t){return yF(t)}function SUe(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),Go(n,i)}function TUe(t,e,i){let r=new Date(t,0);return Go(new Date(r.setDate(e)),i)}function rr(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(oo),n=ZS(e).setHours(i,r,0,0);return ZS(n)}function Zb(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function ra(t,e){let i=Ui(t);if(!i)return"00:00";let r=isNaN(e)?0:e;return Ui(bF(rr(i),r).toISOString())}function bF(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function oo(t){return t.toString()[1]?t:"0"+t}function Hl(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var K9={addDays:yF,addWeek:UUe,addMinutesToTimeString:ra,convertTime:wh,getIsoDateString:JS,getUTCdateString:vF,DateHHMM:hUe,extractDate:mt,extractTime:Ui,formatDate:Go,getDateByWeek:SUe,isISODateString:Wd,isDate:ZI,isTimeString:IF,offsetDate:ZS,offsetTime:vUe,sameDay:Hl,timeStringMinutes:xt,timeToDate:rr,timeUTC:gUe,validTimeValue:cv,validDateString:XS,timeValidation:Td,dateValidation:al},DUe=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),PUe=t=>t.filter(Boolean).every(_i);function Cm(t){let e=t.category;if(typeof e!="object")return{error:qI};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o}=e,s=e.categoryName,l;if(!DUe([i,r,n,s],"string")||!PUe([a,o]))return{error:qI};let u=t.consideredDate??mt(new Date().toLocaleDateString("sv"));if(!ba(u))return{error:xr};let[c]=u.split("-").slice(0,3).map(x=>parseInt(x)),d=jv(u,-1),[p,m]=d.split("-").slice(1,3).map(x=>parseInt(x)),h=`${oo(p)}-${oo(m)}`,f=jv(u,1),[g,v]=f.split("-").slice(1,3).map(x=>parseInt(x)),y=`${oo(g)}-${oo(v)}`,I=o&&jv(u,-1*365*o),b=a&&jv(u,-1*365*a),S=[],w=x=>!S.includes(x)&&S.push(x);i=i??s;let U=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,D=i==null?void 0:i.includes("-"),P=D&&(i==null?void 0:i.match(T)),C=i==null?void 0:i.match(U),R=(x,F)=>`${x}-${F}`,N=x=>{let F=c-x,$=R(F,y);e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x-1&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=x-1)},A=x=>{let F=c-x-1,$=R(F,y);e.ageMin&&e.ageMin>x&&w(`Invalid submitted ageMin: ${o}`),e.ageMax&&e.ageMax>x&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=x)},M=x=>{let F=c-x,$=R(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x+1&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=x+1)},E=x=>{let F=c-x-1,$=R(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=x)},O=x=>{let[F,$,_]=(x.match(U)||[]).slice(1),L=parseInt($);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(L)):F==="O"&&M(L),_==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),A(L)):_==="O"&&E(L),r=r??I,n=n??b};if(P){if(r=void 0,n=void 0,a=void 0,o=void 0,e.ageMin){let $=c-e.ageMin;r=R($,h)}if(e.ageMax){let $=c-e.ageMax-1;n=R($,y)}let[x,F]=((i==null?void 0:i.match(T))??[]).slice(1).map($=>parseInt($));x<=F?(o=x,a=F,l=!0):w(`Invalid combined age range ${i}`)}else D?i==null||i.split("-").forEach(O):C?O(i):(o&&M(o),a&&A(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),o=void 0);let k=He({consideredDate:u,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o});return S.length&&(k.errors=S),k}function QI({category:t}){if(!At(t))return{error:se};let e=Cm({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!_i(i)?te({result:{error:se},context:{ratingMax:i}}):r&&!_i(r)?te({result:{error:se},context:{ratingMin:r}}):{...e}}function Qb({childCategory:t,withDetails:e,category:i}){let r=QI({category:i}),n=QI({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),o=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),s=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),u=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=He({invalidRatingRange:u,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:o,invalidAgeMin:a,valid:!u&&!s&&!l&&!c&&!o&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function ew({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:o}){a=a??(o==null?void 0:o.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),te({result:{errors:l,error:Ju},stack:s});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:m,matchUpFormat:h,matchUpValue:f,matchUpType:g,scoreValue:v,setValue:y,category:I,gender:b}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof m!="number"&&l.push(`matchUpCount is not type number: ${m}`),g&&!eP([ii,ei],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(u!=null&&u.length)].concat([f,d,v,y].map(st)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),f&&typeof f!="number"&&l.push(`matchUpValue is not type number: ${f}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&m){let S=SK({collectionValueProfiles:u,matchUpCount:m});S.errors&&l.push(...S.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),h&&!Ra({matchUpFormat:h})&&l.push(`Invalid matchUpFormat: ${h}`),r){let S=IP({referenceGender:a,matchUpType:g,gender:b});if(S.error)return te({context:{referenceGender:a,gender:b},result:S,stack:s})}if(t&&n&&I){let S=Qb({category:n,childCategory:I});if(!S.valid)return te({result:{error:qI},context:S,stack:s})}return l.length?te({result:{errors:l,error:T9},stack:s}):{valid:!0}}function qn(t){var e,i,r,n;let a=!!((t==null?void 0:t.enforceCategory)!==!1&&t!=null&&t.category),o=!!((t==null?void 0:t.enforceGender)!==!1&&t!=null&&t.gender),s=t==null?void 0:t.checkCollectionIds,l=t==null?void 0:t.tieFormat,u=t==null?void 0:t.event,c="validateTieFormat",d=[],p=RUe({...t,stack:c});if(p!=null&&p.error)return p;let m,h=l.collectionDefinitions.every(I=>{let{setValue:b,scoreValue:S,collectionValue:w}=I;(b||S)&&!w&&(m=!0);let{valid:U,errors:T}=ew({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:I,checkCollectionIds:s,checkCategory:a,checkGender:o,event:u});return U?!0:(Array.isArray(T)&&d.push(...T),!1)}),f=typeof((e=l.winCriteria)==null?void 0:e.valueGoal)=="number"&&((i=l.winCriteria)==null?void 0:i.valueGoal)>0&&!m||((r=l.winCriteria)==null?void 0:r.aggregateValue);if(!(f||(n=l.winCriteria)!=null&&n.aggregateValue))return m?d.push("aggregateValue is required"):d.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),te({context:{tieFormat:l,errors:d,aggregateValueImperative:m},result:{error:Nl},stack:c});let g=l.collectionDefinitions.map(({collectionId:I})=>I),v=!s||g.length===dt(g).length,y=h&&f&&v;return y?{valid:y,errors:d}:te({result:{error:Nl},context:{tieFormat:l,errors:d},stack:c})}function RUe(t){let{tieFormat:e,stack:i}=t;return!t||!e||!At(e)?te({result:{error:Nl},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):At(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...Z}:te({result:{error:Nl},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):te({result:{error:Nl},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var Qf="resourceSubType",eg="resourceType",tg="identifier",CUe={RESOURCE_SUB_TYPE:Qf,RESOURCE_TYPE:eg,IDENTIFIER:tg};function Ne(t,e,i,r,n=0){if(lM().makeDeepCopy)return lM().makeDeepCopy(t,e,i,r);let a=dF(),{stringify:o,toJSON:s,ignore:l,modulate:u}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||ha(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&n>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(m=>!i||!l||Array.isArray(l)&&!l.includes(m)||ha(l)&&!l(m)),p=(m,h)=>{c[m]=ha(h==null?void 0:h.toString)?h.toString():JSON.stringify(h)};for(let m of d){let h=t[m],f=ha(u)?u(h):void 0;if(f!==void 0)c[m]=f;else if(e&&m==="extensions"&&Array.isArray(h)){let g=wF(h);Object.assign(c,...g)}else r&&m==="extensions"?c[m]=[]:Array.isArray(o)&&o.includes(m)?p(m,h):Array.isArray(s)&&s.includes(m)&&ha(h==null?void 0:h.toJSON)?c[m]=h.toJSON():h===null?c[m]=void 0:mUe(h)?c[m]=new Date(h).toISOString():c[m]=Ne(h,e,i,r,n+1)}return c}function wF(t){return t==null?void 0:t.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function X9(t=1,e){return Te(0,t).map(()=>Ht(e))}function Ht(t){let e=[];for(let s=0;s<256;s++)e[s]=(s<16?"0":"")+s.toString(16);let i=Math.random()*4294967295|0,r=Math.random()*4294967295|0,n=Math.random()*4294967295|0,a=Math.random()*4294967295|0,o=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${o.replace(/-/g,"")}`:o}var J9={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},Z9={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},Q9={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},e8={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},t8={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},i8={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},r8={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},n8={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},a8={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},o8={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Ho="SET3-S:6/TB7",EUe="SET3-S:6NOAD",s8="SET3-S:6/TB7-F:TB10",MUe="SET3-S:4/TB7",NUe="SET3-S:4/TB5@3",AUe="SET1-S:T20",OUe="SET1-S:8/TB7",kUe="SET1-S:8/TB7@7",xUe={FORMAT_STANDARD:Ho,FORMAT_STANDARD_NOAD:EUe,FORMAT_ATP_DOUBLES:s8,FORMAT_SHORT_SETS:MUe,FORMAT_FAST4:NUe,FORMAT_PRO_SET:OUe,FORMAT_COLLEGE_PRO_SET:kUe,TIMED20:AUe},l8={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},u8={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},c8={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},d8={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},p8={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},m8={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},h8={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},t0="COLLEGE_DEFAULT",uM="COLLEGE_JUCO",cM="COLLEGE_D3",f8="DOMINANT_DUO",g8="DOMINANT_DUO_MIXED",v8="LAVER_CUP",I8="TEAM_DOUBLES_3_AGGREGATION",y8="TIME_TENNIS_DUAL",b8="TIME_TENNIS_PRO_CIRCUIT",w8="USTA_BREWER_CUP",U8="USTA_OZAKI_CUP",S8="USTA_COLLEGE",T8="USTA_GOLD_TEAM_CHALLENGE",D8="USTA_LEVEL_1",P8="USTA_INTERSECTIONAL",R8="USTA_SECTION_BATTLE",C8="USTA_SOUTHERN_LEVEL_5",E8="USTA_TOC",M8="USTA_WTT_ITT",N8="USTA_ZONAL",FUe={COLLEGE_D3:cM,COLLEGE_DEFAULT:t0,COLLEGE_JUCO:uM,DOMINANT_DUO:f8,DOMINANT_DUO_MIXED:g8,LAVER_CUP:v8,TEAM_DOUBLES_3_AGGREGATION:I8,TIME_TENNIS_DUAL:y8,TIME_TENNIS_PRO_CIRCUIT:b8,USTA_BREWER_CUP:w8,USTA_OZAKI_CUP:U8,USTA_COLLEGE:S8,USTA_GOLD_TEAM_CHALLENGE:T8,USTA_INTERSECTIONAL:P8,USTA_LEVEL_1:D8,USTA_SECTION_BATTLE:R8,USTA_SOUTHERN_LEVEL_5:C8,USTA_TOC:E8,USTA_WTT_ITT:M8,USTA_ZONAL:N8},A8="STANDARD",d2={[A8]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[cM]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Ho,matchUpCount:6,matchUpValue:1},tieFormatName:cM,valueGoal:5},[t0]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:Ho,matchUpCount:6,matchUpValue:1},tieFormatName:t0,valueGoal:4},[uM]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Ho,matchUpCount:6,matchUpValue:1},tieFormatName:uM,valueGoal:5},[v8]:m8,[f8]:l8,[g8]:r8,[I8]:Z9,[y8]:n8,[b8]:i8,[w8]:a8,[U8]:o8,[S8]:u8,[T8]:J9,[P8]:t8,[D8]:c8,[R8]:e8,[C8]:Q9,[M8]:d8,[E8]:h8,[N8]:p8},LUe=t=>{let e=t!=null&&t.namedFormat&&Object.keys(d2).includes(t.namedFormat)?t.namedFormat:A8,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],r,{category:n,gender:a}=(t==null?void 0:t.event)??{},o=Ne(d2[e],!1,!0),s=l=>{var u,c;if(!(t!=null&&t.isMock)&&!((u=t==null?void 0:t.event)!=null&&u.isMock)||!t.event)return(i==null?void 0:i.pop())??Ht();let d=(c=t==null?void 0:t.event)==null?void 0:c.eventId;return i.pop()??`${d}-COL-${l+1}`};return o.hydrate?(r={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:s8,collectionName:"Doubles",matchUpType:ei,...o.doubles},{collectionId:s(1),matchUpFormat:Ho,collectionName:"Singles",matchUpType:ii,...o.singles}]},o.tieFormatName&&(r.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((l,u)=>l.collectionId=s(u)),r=o),t!=null&&t.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},Eu=LUe,ol="SINGLES",Em="SINGLES",ho="DOUBLES",Mu="DOUBLES",ur="TEAM",Ca="TEAM",_Ue="AGE",$Ue="RATING",BUe="BOTH",VUe={AGE:_Ue,BOTH:BUe,DOUBLES:ho,DOUBLES_EVENT:Mu,RATING:$Ue,SINGLES:ol,SINGLES_EVENT:Em,TEAM_EVENT:Ca,TEAM:ur},Ae="MAIN",Ke="QUALIFYING",an="CONSOLATION",Fr="VOLUNTARY_CONSOLATION",Bi="PLAY_OFF",bP=[Ae,Ke,an,Bi,Fr],Mm={[Ke]:1,[Ae]:2,[Bi]:3,[an]:3,[Fr]:4},O8="finishingPositions",k8="aggregateEventStructures",x8={[Ae]:1,[Bi]:2,[an]:3,[Ke]:4,[Fr]:5},jUe={[Bi]:1,[Ae]:2,[an]:3,[Ke]:4,[Fr]:5},wP="CLUSTER",GUe="SEPARATE",qd="WATERFALL",UP="ITEM",_n="CONTAINER",fs="DRAW",SP="RANDOM",_o="TOP_DOWN",Yd="BOTTOM_UP",Nu="POSITION",Au="WINNER",zl="LOSER",sl="FIRST_MATCHUP",Ga="AD_HOC",HUe="AD_HOC",dv="FEED_IN",ig="COMPASS",rg="OLYMPIC",zUe="SINGLE_ELIMINATION",Ys="SINGLE_ELIMINATION",tw="DOUBLE_ELIMINATION",ng="FIRST_MATCH_LOSER_CONSOLATION",iw="FIRST_ROUND_LOSER_CONSOLATION",Tp="LUCKY_DRAW",TP="CURTIS_CONSOLATION",WUe="CURTIS_CONSOLATION",UF="FEED_IN_CHAMPIONSHIP_TO_SF",ey="FEED_IN_CHAMPIONSHIP_TO_SF",SF="FEED_IN_CHAMPIONSHIP_TO_QF",ty="FEED_IN_CHAMPIONSHIP_TO_QF",TF="FEED_IN_CHAMPIONSHIP_TO_R16",iy="FEED_IN_CHAMPIONSHIP_TO_R16",F8="MODIFIED_FEED_IN_CHAMPIONSHIP",ry="MODIFIED_FEED_IN_CHAMPIONSHIP",rw="FEED_IN_CHAMPIONSHIP",qUe="DOUBLE_ROUND_ROBIN",ts="ROUND_ROBIN",Wl="ROUND_ROBIN_WITH_PLAYOFF",L8="DECIDER",_8="BACKDRAW",DF={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},PF={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Kd="WIN_RATIO",Uh="ROUND_OUTCOME",$8=[ig,TP,ty,iy,ey,rw,SF,TF,UF,ng,iw,Tp,ry,rg,Bi,Wl],YUe=[Ga,ig,TP,tw,ty,iy,ey,rw,dv,ng,iw,Tp,ry,rg,Bi,ts,Wl,Ys],B8={MAIN:Ae,QUALIFYING:Ke,CONSOLATION:an,ITEM:UP,CONTAINER:_n,FIRST_MATCHUP:sl,WINNER:Au,LOSER:zl,AD_HOC:Ga,FEED_IN:dv,FLEX_ROUNDS:HUe,COMPASS:ig,PLAY_OFF:Bi,OLYMPIC:rg,KNOCKOUT:zUe,SINGLE_ELIMINATION:Ys,DOUBLE_ELIMINATION:tw,CURTIS:TP,FICSF:UF,FICQF:SF,FICR16:TF,MFIC:F8,VOLUNTARY_CONSOLATION:Fr,FIRST_MATCH_LOSER_CONSOLATION:ng,FIRST_ROUND_LOSER_CONSOLATION:iw,MODIFIED_FEED_IN_CHAMPIONSHIP:ry,FEED_IN_CHAMPIONSHIP_TO_R16:iy,FEED_IN_CHAMPIONSHIP_TO_QF:ty,FEED_IN_CHAMPIONSHIP_TO_SF:ey,FEED_IN_CHAMPIONSHIP:rw,LUCKY_DRAW:Tp,ROUND_ROBIN_WITH_PLAYOFF:Wl,ROUND_ROBIN:ts,DECIDER:L8,BACKDRAW:_8,COMPASS_ATTRIBUTES:DF,OLYMPIC_ATTRIBUTES:PF,DRAW:fs,RANDOM:SP,TOP_DOWN:_o,BOTTOM_UP:Yd,WATERFALL:qd,WIN_RATIO:Kd,ROUND_OUTCOME:Uh,MULTI_STRUCTURE_DRAWS:$8,generatedDrawTypes:YUe,stageOrder:Mm,finishOrder:x8,AGGREGATE_EVENT_STRUCTURES:k8,FINISHING_POSITIONS:O8},KUe=B8,fn="tournamentRecords",RF="policyDefinitions",wr="tournamentRecord",CF="onlineResource",$n="drawDefinition",V8="tieFormatName",EF="matchUpFormat",ql="participantId",j8="scheduleDates",XUe="tournamentId",JUe="scheduleDate",ZUe="roundNumber",DP="structureId",MF="participant",nw="matchUpIds",G8="entryStage",QUe="policyType",H8="structures",NF="eventType",vl="matchUpId",PP="tieFormat",RP="inContext",CP="structure",EP="courtIds",eSe="personId",MP="venueIds",AF="matchUps",z8="courtId",W8="eventId",Ql="matchUp",q8="drawId",zo="error",ed="event",pv="param",OF="uuids",tSe="averageMatchUpMinutes",iSe="recoveryMinutes",rSe="periodLength",nSe="number",ta="object",cn="array",Xr="_validate",Y8="_message",Ha="_invalid",Jn="_ofType",kF="_anyOf",ag="_oneOf",p2={[CF]:t=>ji(Object.keys(t),[Qf,eg,tg]).length===3,[V8]:t=>t&&Eu({namedFormat:t}),[OF]:t=>!t||Array.isArray(t)&&t.every(Di),[PP]:t=>!qn({tieFormat:t}).error,[NF]:t=>[ol,ho,ur].includes(t),[G8]:t=>bP.includes(t)},aSe={[fn]:ki,[wr]:ve,[RF]:rP,[$n]:$e,[ql]:hr,[EF]:qx,[XUe]:Yf,[DP]:Xa,[nw]:hh,[MF]:vh,[CF]:Ju,[NF]:Gl,[H8]:Hx,[vl]:bn,[PP]:Nl,[CP]:Up,[z8]:fh,[AF]:Xu,[W8]:mo,[Ql]:sa,[EP]:Je,[MP]:Je,[q8]:xs,[ed]:vi},oSe={[fn]:ta,[RF]:ta,[wr]:ta,[$n]:ta,[CF]:ta,[j8]:cn,[MF]:ta,[nw]:cn,[H8]:cn,[PP]:ta,[CP]:ta,[EP]:cn,[MP]:cn,[AF]:cn,[Ql]:ta,[ed]:ta,[OF]:cn};function We(t,e,i){if(!t&&!At(t))return{error:se};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:se};let{paramError:r,errorParam:n}=uSe(t,e);if(!r)return{valid:!0};let a=r[Xr]&&(r[zo]||r[Ha])||(t==null?void 0:t[n])===void 0&&(r[zo]||r[Ha]||aSe[n]||se)||se,o=n??(r[ag]&&Object.keys(r[ag]).join(", "));return te({info:{param:o,message:r[Y8]},result:{error:a},stack:i})}function K8(t,e){let i=Object.keys(t),r=Object.keys(e);return ji(i,r)}function sSe(t,e){if(!e)return;let i=K8(t,e);return i.length!==1?{error:se}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function lSe(t,e){if(!e)return;let i=K8(t,e).filter(r=>t[r]);return i.length<1?{error:se}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function uSe(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:o,_validate:s,_info:l,...u})=>{let c=a&&sSe(t,a);if(c!=null&&c.error)return c.error;c&&Object.assign(u,c);let d=o&&lSe(t,o);if(d!=null&&d.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(h=>typeof u[h]=="boolean"),m=p.find(h=>{let f=s&&!ha(s),g=t[h]!==void 0&&!s&&cSe(t,h,n),v=u[h]&&[void 0,null].includes(t[h]),y=f||g||v||s&&t[h]!==void 0&&!dSe(t[h],s)||p2[h]&&!p2[h](t[h]);return y&&(i=h,r=l),y});return!p.length||m}),errorParam:i,paramInfo:r}}function cSe(t,e,i){return i=i||oSe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function dSe(t,e){return ha(e)?e(t):!0}var xF="DYNAMIC",Nc="RANKING",Ic="RATING",Xd="SCALE",Al="SEEDING",pSe={RANKING:Nc,RATING:Ic,SCALE:Xd,SEEDING:Al};function mv(t){var e;let i=We(t,[{[MF]:!0}]);if(i.error)return i;let r=(e=t.participant.timeItems)==null?void 0:e.filter(({itemType:a})=>(a==null?void 0:a.startsWith(Xd))&&[Nc,Ic,Al].includes(a.split(".")[1])),n={ratings:{},rankings:{},seedings:{}};if(r!=null&&r.length){let a=s=>r.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,u)=>new Date(l.createdAt||void 0).getTime()-new Date(u.createdAt||void 0).getTime()).pop(),o=dt(r.map(({itemType:s})=>s));for(let s of o){let l=a(s);if(l){let[,u,c,d,p]=l.itemType.split("."),m=p?`${d}.${p}`:d,h=u===Al&&"seedings"||u===Nc&&"rankings"||"ratings";n[h][c]||(n[h][c]=[]),n[h][c].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:m})}}}return{...Z,...n}}function Nm(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,o,s){if(!a||!o)return;let l=Object.keys(a),u=Object.keys(o),c=Object.assign({},...u.filter(m=>m.indexOf("||")).map(m=>m.split("||").map(h=>({[h]:m}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let m of l)if(d.indexOf(m)>=0||p){let h=c[m]||m,f=o[h]||p,g=a[m];if(typeof f=="object"&&typeof g!="function"&&!Array.isArray(f))if(Array.isArray(g)){let v=g.map(y=>{let I={};return n(y,f,I)!==!1?I:void 0}).filter(Boolean);s[m]=v}else g&&(s[m]={},n(g,f,s[m]));else{let v=a[m];if(Array.isArray(f)&&!f.includes(v))return!1;(o[m]||p&&o[m]!==!1)&&(s[m]=v)}}}}var dM="voluntaryConsolation",uu="competitiveBands",FF="roundRobinTally",Ou="positionActions",Lr="matchUpActions",JU="rankingPoints",og="roundNaming",hv="participant",ny="progression",td="scheduling",ay="avoidance",mSe="participant",hSe="display",fo="scoring",Ao="seeding",sg="feedIn",fSe="audit",i0="draws",gSe={POLICY_TYPE_VOLUNTARY_CONSOLATION:dM,POLICY_TYPE_COMPETITIVE_BANDS:uu,POLICY_TYPE_ROUND_ROBIN_TALLY:FF,POLICY_TYPE_POSITION_ACTIONS:Ou,POLICY_TYPE_MATCHUP_ACTIONS:Lr,POLICY_TYPE_RANKING_POINTS:JU,POLICY_TYPE_ROUND_NAMING:og,POLICY_TYPE_PARTICIPANT:hv,POLICY_TYPE_PROGRESSION:ny,POLICY_TYPE_SCHEDULING:td,POLICY_TYPE_AVOIDANCE:ay,POLICY_TYPE_DISPLAY:hSe,POLICY_TYPE_PRIVACY:mSe,POLICY_TYPE_FEED_IN:sg,POLICY_TYPE_SCORING:fo,POLICY_TYPE_SEEDING:Ao,POLICY_TYPE_AUDIT:fSe,POLICY_TYPE_DRAWS:i0};function Ac({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let o=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),s=Ne(o,!1,n);if(s){let l=e==null?void 0:e[hv];if(i!=null&&i.withScaleValues){let{ratings:u,rankings:c}=mv({participant:s});s.rankings=c,s.ratings=u}if(l!=null&&l.participant)return Nm({template:l.participant,source:s})}return s}var vSe="element required",ISe="missing name";function Dn(t){if(!t||typeof t!="object")return{error:Je};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:se};if(!(t!=null&&t.name))return{error:Je,info:ISe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=Dn({element:i,name:t.name});if(r.error)return te({result:r,stack:"removeExtension"})}return{...Z}}return{error:Je,info:vSe}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...Z}):{...Z,info:Vr}}function ll({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function _t(t){if(typeof t!="object")return{error:Je};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return te({result:{error:se},stack:e});if(!ll({extension:t.extension}))return te({result:{error:se,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=_t({extension:t.extension,element:r});if(n.error)return te({result:n,stack:e})}return{...Z}}else return te({result:{error:Je},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...Z}}function LF(t){return!t||typeof t!="object"?{error:Je}:t.tournamentRecord?_t({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:ve}}function NP(t){return!t||typeof t!="object"?{error:Je}:t.drawDefinition?_t({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:Va}}function id(t){return!t||typeof t!="object"?{error:Je}:t.event?_t({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:mo}}function X8(t){var e;if(!t||typeof t!="object")return{error:Je};if(!t.participantId)return{error:hr};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],r=Ac({participantId:t.participantId,tournamentParticipants:i});return r?_t({creationTime:t.creationTime,extension:t.extension,element:r}):{error:Wi}}function _F(t){return!t||typeof t!="object"?{error:Je}:t.tournamentRecord?Dn({element:t.tournamentRecord,name:t.name}):{error:ve}}function J8(t){return!t||typeof t!="object"?{error:Je}:t.drawDefinition?Dn({element:t.drawDefinition,name:t.name}):{error:Va}}function AP(t){return!t||typeof t!="object"?{error:Je}:t!=null&&t.event?Dn({element:t.event,name:t.name}):{error:mo}}function Z8(t){var e;if(!t||typeof t!="object")return{error:Je};if(!t.participantId)return{error:hr};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],r=Ac({participantId:t.participantId,tournamentParticipants:i});return r?Dn({element:r,name:t.name}):{error:Wi}}function aw({tournamentRecords:t}){return{tournamentIds:At(t)?Object.keys(t):[],...Z}}var ySe="extensionQueries";function vt({discover:t,element:e,name:i,...r}){var n;if(!e||!i){if(t&&r){let o=Object.keys(r).filter(u=>typeof t=="boolean"||Array.isArray(t)&&t.includes(u)).find(u=>{var c;return Array.isArray((c=r[u])==null?void 0:c.extensions)?r[u].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=o&&r[o];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(u=>{var c;return(c=u.extensions)==null?void 0:c.length}));let l=(n=s==null?void 0:s.extensions)==null?void 0:n.find(u=>(u==null?void 0:u.name)===i);return{extension:l,info:l?void 0:Vr}}return te({result:{error:Je},stack:ySe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let a=e.extensions.find(o=>(o==null?void 0:o.name)===i);return{extension:a,info:a?void 0:Vr}}var bSe="activeSuspension",oy="appliedPolicies",Q8="context",OP="delegatedOutcome",bs="disabled",Am="disableAutoCalc",kP="disableLinks",r0="display",Rd="drawDeletions",wSe="drawProfile",n0="entryProfile",USe="eventProfile",SSe="eventWithdrawalRequests",TSe="factory",is="flightProfile",pM="groupingAttribute",ku="lineUps",Jd="linkedTournamentsIds",xP="matchUpHistory",$F="participantRepresentatives",fv="personRequests",If="positionActions",DSe="rankingPoints",PSe="registration",Il="roundTarget",ow="scheduleLimits",xu="scheduleTiming",Om="schedulingProfile",RSe="statusDetail",lg="subOrder",Oc="tally",eI="tieFormatModification",eX={ACTIVE_SUSPENSION:bSe,APPLIED_POLICIES:oy,CONTEXT:Q8,DELEGATED_OUTCOME:OP,DISABLED:bs,DISABLE_LINKS:kP,DISABLE_AUTO_CALC:Am,DISPLAY:r0,DRAW_DELETIONS:Rd,DRAW_PROFILE:wSe,ENTRY_PROFILE:n0,EVENT_PROFILE:USe,EVENT_WITHDRAWAL_REQUESTS:SSe,FLIGHT_PROFILE:is,GROUPING_ATTRIBUTE:pM,LINEUPS:ku,LINKED_TOURNAMENTS:Jd,MATCHUP_HISTORY:xP,PARTICIPANT_REPRESENTATIVES:$F,PERSON_REQUESTS:fv,POSITION_ACTIONS:If,RANKING_POINTS:DSe,REGISTRATION:PSe,ROUND_TARGET:Il,SCHEDULE_LIMITS:ow,SCHEDULE_TIMING:xu,SCHEDULING_PROFILE:Om,STATUS_DETAIL:RSe,SUB_ORDER:lg,TALLY:Oc,TIE_FORMAT_MODIFICATIONS:eI,FACTORY:TSe},m2=[OP,bs,Am,kP,is,ku,Jd,xP,$F,fv,Il,ow,xu,Om,lg,Oc,eI];function tX({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let e=aw({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?_t({tournamentRecords:t,discover:!0,extension:{name:Jd,value:{tournamentIds:i}}}):{...Z}}function iX({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let e=Dn({name:Jd,tournamentRecords:t,discover:!0});return te({result:e,stack:"unlinkTournaments"})}function rX({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:se};if(!e)return{error:Yf};let i=aw({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:Yf};let n;return r.every(a=>{var o;let s=t[a],{extension:l}=vt({element:s,name:Jd});if(!l)return!0;let u=((o=l==null?void 0:l.value)==null?void 0:o.tournamentIds)||[];if(!(u!=null&&u.length)||u.length===1&&u.includes(e)||a===e){let p=_F({name:Jd,tournamentRecord:s});return p.error&&(n=p.error),p.success}let c=u.filter(p=>p!==e);l.value={tournamentIds:c};let d=LF({tournamentRecord:s,extension:l});return d.error&&(n=d.error),d.success}),n?{error:n}:{...Z}}var nX={};bt(nX,{getLinkedTournamentIds:()=>sw,getTournamentIds:()=>aw});function sw({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:ki}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var i;let r=t[e],n=r==null?void 0:r.tournamentId,{extension:a}=vt({element:r,name:Jd}),o=(((i=a==null?void 0:a.value)==null?void 0:i.tournamentIds)||[]).filter(s=>s!==n);return{[e]:o}}))}}var aX={};bt(aX,{adHocPositionSwap:()=>KJ,addAdHocMatchUps:()=>lR,addDrawDefinitionTimeItem:()=>VL,addFinishingRounds:()=>Uw,addGoesTo:()=>ep,addPlayoffStructures:()=>sR,addQualifyingStructure:()=>YJ,addVoluntaryConsolationStage:()=>jJ,addVoluntaryConsolationStructure:()=>EL,allPlayoffPositionsFilled:()=>$L,alternateDrawPositionAssignment:()=>NJ,assignDrawPosition:()=>wZ,assignDrawPositionBye:()=>Qa,attachConsolationStructures:()=>vZ,attachPlayoffStructures:()=>n_,attachQualifyingStructure:()=>BL,attachStructures:()=>oR,autoSeeding:()=>PCe,automatedPlayoffPositioning:()=>Sv,automatedPositioning:()=>Aw,checkValidEntries:()=>dR,deleteAdHocMatchUps:()=>SZ,drawMatic:()=>R_,findDrawDefinition:()=>u_,generateAdHocMatchUps:()=>pR,generateAdHocRounds:()=>P_,generateAndPopulatePlayoffStructures:()=>i_,generateDrawDefinition:()=>Xw,generateDrawMaticRound:()=>g_,generateDrawStructuresAndLinks:()=>m_,generateDrawTypeAndModifyDrawDefinition:()=>h_,generateQualifyingStructure:()=>qL,generateVoluntaryConsolation:()=>YZ,getAssignedParticipantIds:()=>Np,getAvailableMatchUpsCount:()=>uR,getAvailablePlayoffProfiles:()=>kw,getDrawDefinitionTimeItem:()=>sL,getDrawParticipantRepresentativeIds:()=>s_,getDrawStructures:()=>rs,getDrawTypeCoercion:()=>jw,getEligibleVoluntaryConsolationParticipants:()=>o_,getMatchUpsMap:()=>ln,getParticipantIdFinishingPositions:()=>l_,getPositionAssignments:()=>my,getPositionsPlayedOff:()=>Tv,getSeedingThresholds:()=>OL,getSeedsCount:()=>Gw,getStructureSeedAssignments:()=>go,getTeamLineUp:()=>Qd,getValidGroupSizes:()=>Mw,isAdHoc:()=>Yn,isCompletedStructure:()=>_c,isValidForQualifying:()=>p_,luckyLoserDrawPositionAssignment:()=>TJ,modifyDrawDefinition:()=>IZ,modifyDrawName:()=>a_,modifySeedAssignment:()=>AJ,mutate:()=>oX,positionActions:()=>d_,pruneDrawDefinition:()=>bZ,qualifierDrawPositionAssignment:()=>MJ,query:()=>PZ,removeDrawPositionAssignment:()=>dy,removeRoundMatchUps:()=>TZ,removeSeededParticipant:()=>qJ,removeStructure:()=>BJ,renameStructures:()=>$J,resetDrawDefinition:()=>yZ,resetVoluntaryConsolationStructure:()=>UX,setDrawParticipantRepresentativeIds:()=>sX,setPositionAssignments:()=>CJ,setStructureOrder:()=>LJ,setSubOrder:()=>DZ,shiftAdHocRounds:()=>RJ,swapAdHocRounds:()=>EJ,swapDrawPositionAssignments:()=>zJ,updateTeamLineUp:()=>Lh,withdrawParticipantAtDrawPosition:()=>gJ});var oX={};bt(oX,{adHocPositionSwap:()=>KJ,addAdHocMatchUps:()=>lR,addDrawDefinitionTimeItem:()=>VL,addPlayoffStructures:()=>sR,addQualifyingStructure:()=>YJ,addVoluntaryConsolationStage:()=>jJ,addVoluntaryConsolationStructure:()=>EL,alternateDrawPositionAssignment:()=>NJ,assignDrawPosition:()=>wZ,assignDrawPositionBye:()=>Qa,attachConsolationStructures:()=>vZ,attachPlayoffStructures:()=>n_,attachQualifyingStructure:()=>BL,attachStructures:()=>oR,automatedPlayoffPositioning:()=>Sv,automatedPositioning:()=>Aw,deleteAdHocMatchUps:()=>SZ,luckyLoserDrawPositionAssignment:()=>TJ,modifyDrawDefinition:()=>IZ,modifyDrawName:()=>a_,modifySeedAssignment:()=>AJ,pruneDrawDefinition:()=>bZ,qualifierDrawPositionAssignment:()=>MJ,removeDrawPositionAssignment:()=>dy,removeRoundMatchUps:()=>TZ,removeSeededParticipant:()=>qJ,removeStructure:()=>BJ,renameStructures:()=>$J,resetDrawDefinition:()=>yZ,resetVoluntaryConsolationStructure:()=>UX,setDrawParticipantRepresentativeIds:()=>sX,setPositionAssignments:()=>CJ,setStructureOrder:()=>LJ,setSubOrder:()=>DZ,shiftAdHocRounds:()=>RJ,swapAdHocRounds:()=>EJ,swapDrawPositionAssignments:()=>zJ,updateTeamLineUp:()=>Lh,withdrawParticipantAtDrawPosition:()=>gJ});var BF=t=>e=>t[e],VF=(t=[])=>t.map(Dr).filter(Boolean),mM=(t=[])=>t.map(Tt).filter(Boolean),Tt=(t={})=>BF(t)("participantId"),Dr=(t={})=>BF(t)("matchUpId"),sy=(t={})=>BF(t)("drawId");function sX({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:Va};if(!Array.isArray(t))return{error:se};let i=mM((e==null?void 0:e.entries)||[]);return t.length&&ji(t,i).length<t.length?{error:se}:NP({drawDefinition:e,extension:{name:$F,value:t}})}var ua="ABANDONED",Sh="AWAITING_RESULT",jt="BYE",yl="CANCELLED",Ki="COMPLETED",gv="DEAD_RUBBER",Pt="DEFAULTED",dr="DOUBLE_DEFAULT",tr="DOUBLE_WALKOVER",us="IN_PROGRESS",Ea="INCOMPLETE",jF="NOT_PLAYED",Hr="RETIRED",rd="SUSPENDED",Zi="TO_BE_PLAYED",Ft="WALKOVER",CSe=[Sh,Ki,Pt,us,Ea,Hr,rd],lX=[Sh,Ki,Pt,tr,dr,us,Ea,Hr,rd,Ft],uX=[ua,Sh,jt,yl,Ki,gv,Pt,tr,dr,us,Ea,jF,Hr,rd,Zi,Ft],cX=[jt,tr,dr,Ki,Pt,Hr,Ft],dX=[ua,Sh,yl,gv,us,Ea,jF,rd,Zi,void 0],Ir=[yl,ua,Ki,gv,Pt,tr,dr,Hr,Ft],GF=[ua,Ki,Pt,tr,dr,us,Hr,Ft],pX=[us,Ea,rd,Zi],mX={ABANDONED:ua,AWAITING_RESULT:Sh,BYE:jt,CANCELLED:yl,COMPLETED:Ki,DEAD_RUBBER:gv,DEFAULTED:Pt,DOUBLE_WALKOVER:tr,DOUBLE_DEFAULT:dr,IN_PROGRESS:us,INCOMPLETE:Ea,NOT_PLAYED:jF,RETIRED:Hr,SUSPENDED:rd,TO_BE_PLAYED:Zi,WALKOVER:Ft};function Th(t,e,i){var r,n;let a=m=>{var h,f;return(f=(h=vt({element:m,name:Il}))==null?void 0:h.extension)==null?void 0:f.value},o=i==null?void 0:i.deprioritizeCompleted,s=(i==null?void 0:i.mode)===k8&&jUe,l=(i==null?void 0:i.mode)===O8&&x8,u=l||s||Mm,c=m=>(m==null?void 0:m.stage)===Ae&&(m==null?void 0:m.stageSequence)===1,d=m=>c(m)?-1:u[m==null?void 0:m.stage],p=m=>m==null?void 0:m.matchUps.every(({matchUpStatus:h})=>Ir.includes(h)?1:-1);return o&&p(t)-p(e)||s&&d(t)-d(e)||((t==null?void 0:t.stage)&&u[t.stage]||0)-((e==null?void 0:e.stage)&&u[e.stage]||0)||(a(t)||0)-(a(e)||0)||!l&&!s&&(((r=e==null?void 0:e.positionAssignments)==null?void 0:r.length)??1/0)-(((n=t==null?void 0:t.positionAssignments)==null?void 0:n.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(a0(t)||0)-(a0(e)||0)}function a0(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var r;let n=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).reduce((a,o)=>a+o,0);return!e||n<e?n:e},void 0)}function tt(t){let e=We(t,[{[$n]:!0,[DP]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=rs({drawDefinition:i}),a=n==null?void 0:n.map(l=>l.structures?[...l.structures].concat(l):l).flat(),o=a==null?void 0:a.find(l=>l.structureId===r);if(!o)return{error:Ni};let s=o.structureType===UP?a==null?void 0:a.find(l=>{var u;return(u=l.structures)==null?void 0:u.some(c=>c.structureId===r)}):void 0;return{structure:o,containingStructure:s}}function rs({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:o,stage:s}){var l;let u=!e&&$e||!(e!=null&&e.structures)&&Hx||void 0;if(u)return{error:u,structures:[],stageStructures:{}};let c=f=>{var g,v;let y=(v=(g=vt({element:f,name:Il}))==null?void 0:g.extension)==null?void 0:v.value;return!n||n===y},d=((l=e==null?void 0:e.structures)==null?void 0:l.filter(m).filter(h).filter(c).sort((f,g)=>Th(f,g,a)))??[],p=t?Object.assign({},...bP.map(f=>{let g=d==null?void 0:d.filter(v=>v.stage===f);return(g==null?void 0:g.length)&&{[f]:g}}).filter(Boolean)):{};return{structures:d,stageStructures:p};function m(f){return!s&&!Array.isArray(o)||s&&f.stage===s||Array.isArray(o)&&o.includes(f.stage)}function h(f){return!r&&!Array.isArray(i)||r&&f.stageSequence===r||Array.isArray(i)&&i.includes(f.stageSequence)}}function hX({drawDefinition:t}){if(!t)return{error:$e};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=oi({structure:i}),a=(n==null?void 0:n.map(Tt).filter(Boolean))??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function oi({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:$e};if({structure:i,error:r}=tt({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>oi({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=GK,{positionAssignments:n,error:r}}function Er({drawDefinition:t,structureId:e,structure:i}){var r;let n=((r=oi({drawDefinition:t,structureId:e,structure:i}))==null?void 0:r.positionAssignments)||[],a=n==null?void 0:n.filter(c=>c.participantId??c.bye??c.qualifier),o=n&&(n==null?void 0:n.length)===(a==null?void 0:a.length),s=n==null?void 0:n.filter(c=>!c.participantId&&!c.bye&&!c.qualifier),l=n==null?void 0:n.filter(c=>!c.participantId&&c.bye),u=n==null?void 0:n.filter(c=>!c.participantId&&c.qualifier);return{allPositionsAssigned:o,positionAssignments:n,unassignedPositions:s,assignedPositions:a,qualifierPositions:u,byePositions:l}}var HF="addDrawDefinition",FP="addMatchUps",kc="addParticipants",zF="addScaleItems",fX="addEvent",WF="addVenue",fu="audit",qF="dataIssue",YF="deleteParticipants",KF="deleteVenue",XF="deletedDrawIds",JF="deletedMatchUpIds",ZF="modifyDrawDefinition",gX="modifyDrawEntries",vX="modifyEventEntries",QF="modifyMatchUp",on="modifyParticipants",eL="modifyPositionAssignments",tL="modifySeedAssignments",Dp="modifyTournamentDetail",Pp="modifyVenue",hM="mutations",fM="publishEvent",IX="publishEventSeeding",yX="publishOrderOfPlay",bX="publishParticipants",iL="unPublishEvent",rL="unPublishEventSeeding",nL="unPublishOrderOfPlay",ESe="unPublishParticipants",LP="updateInContextMatchUp",MSe={ADD_DRAW_DEFINITION:HF,ADD_MATCHUPS:FP,ADD_PARTICIPANTS:kc,ADD_SCALE_ITEMS:zF,ADD_EVENT:fX,ADD_VENUE:WF,AUDIT:fu,DATA_ISSUE:qF,DELETE_PARTICIPANTS:YF,DELETE_VENUE:KF,DELETED_DRAW_IDS:XF,DELETED_MATCHUP_IDS:JF,MODIFY_DRAW_DEFINITION:ZF,MODIFY_DRAW_ENTRIES:gX,MODIFY_EVENT_ENTRIES:vX,MODIFY_MATCHUP:QF,MODIFY_PARTICIPANTS:on,MODIFY_POSITION_ASSIGNMENTS:eL,MODIFY_SEED_ASSIGNMENTS:tL,MODIFY_TOURNAMENT_DETAIL:Dp,MODIFY_VENUE:Pp,MUTATIONS:hM,PUBLISH_EVENT_SEEDING:IX,PUBLISH_EVENT:fM,PUBLISH_ORDER_OF_PLAY:yX,PUBLISH_PARTICIPANTS:bX,UNPUBLISH_EVENT_SEEDING:rL,UNPUBLISH_EVENT:iL,UNPUBLISH_ORDER_OF_PLAY:nL,UPDATE_INCONTEXT_MATCHUP:LP};function _P(t,e){var i;if(!t)return{error:$e};let r=Date.now();t.updatedAt&&r===new Date(t.updatedAt).getTime()&&(r+=1);let n=new Date(r).toISOString(),a=e==null?void 0:e.filter(Boolean);return t.updatedAt=n,(i=t.structures)==null||i.filter(Boolean).forEach(o=>{(!(a!=null&&a.length)||a!=null&&a.includes(o.structureId))&&(o.updatedAt=n)}),{...Z}}function xc({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&_P(t),ut({payload:{matchUps:i,tournamentId:e,eventId:r},topic:FP}),{...Z}}function Zu({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&_P(t),ut({topic:JF,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)mF({key:a});return{...Z}}function Ct({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&li({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),ut({topic:QF,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...Z}):(console.log(sa),{error:sa})}function NSe({tournamentId:t,inContextMatchUp:e}){return e?(ut({payload:{inContextMatchUp:e,tournamentId:t},topic:LP,key:e.matchUpId}),{...Z}):{error:sa}}function lw({tournamentId:t,eventId:e,drawDefinition:i}){return i?(_P(i),ut({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:HF,key:i.drawId}),{...Z}):(console.log($e),{error:$e})}function ASe({tournamentId:t,eventId:e,drawId:i}){return ut({payload:{drawId:i,tournamentId:t,eventId:e},topic:XF,key:i}),mF({key:i}),{...Z}}function li({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(_P(t,i),ut({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:ZF,key:t.drawId}),{...Z}):{error:$e}}function wX({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:$e};if(!i)return{error:Up};let n=i.seedAssignments,a=i.structureId,o=t.drawId;return ut({payload:{tournamentId:e,eventId:r,drawId:o,structureId:a,seedAssignments:n},topic:tL,key:t.drawId}),li({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...Z}}function Fc({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:$e};if(!i)return{error:Up};let n=oi({structure:i}),a=i.structureId,o=t.drawId,s=r==null?void 0:r.eventId;return ut({topic:eL,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:s,drawId:o},key:a}),li({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:s}),{...Z}}function UX({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){var n,a;if(!e)return{error:$e};let o=(n=e.structures)==null?void 0:n.find(l=>l.stage===Fr);if(!o)return{error:Ni};let s=((a=o.matchUps)==null?void 0:a.map(({matchUpId:l})=>l))||[];return o.positionAssignments=[],o.seedAssignments=[],o.matchUps=[],Zu({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:s,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==Fr)),li({tournamentId:t==null?void 0:t.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:e,structureIds:[o.structureId]}),{...Z}}function aL({drawPositions:t,structure:e}){var i;if([Ke,Ae].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:r}=oi({structure:e});(i=r==null?void 0:r.filter(({drawPosition:n})=>t==null?void 0:t.includes(n)))==null||i.forEach(n=>{_t({element:n,extension:{name:kP,value:!0}})})}function $P(t){var e,i;let{appliedPolicies:r,positionAction:n,drawDefinition:a}=t;if(((e=r==null?void 0:r.audit)==null?void 0:e[If])===!1)return;let{extension:o}=vt({name:If,element:a}),s=Array.isArray(o==null?void 0:o.value)?(o==null?void 0:o.value)??[]:[];if(!(s!=null&&s.length)){let u=a.structures.find(c=>c.stage===Ae);if(u){let c=(i=oi({structure:u}).positionAssignments)==null?void 0:i.map(({drawPosition:d,participantId:p,bye:m,qualifier:h})=>({drawPosition:d,participantId:p,qualifier:h,bye:m}));s.push({name:"initialMainAssignments",initialAssignments:c})}}let l={value:s.concat(n),name:If};_t({element:a,extension:l})}function vv({tournamentRecord:t,drawDefinition:e,event:i}){var r;let n=((r=(t==null?void 0:t.events)||i&&[i])==null?void 0:r.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],a={},o={},s=n.map(l=>{var u;return(u=l==null?void 0:l.structures)==null?void 0:u.filter(c=>c==null?void 0:c.structures)}).flat().filter(Boolean);for(let l of s){let{structures:u,structureId:c}=l??{};u&&c&&(a[c]=u==null?void 0:u.map(d=>d.structureId))&&u.forEach(d=>o[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:a,containerStructures:o}}function BP(t){var e;let{sides:i,matchUpType:r}=t||{},n=(e=t.potentialParticipants)!=null&&e.length?t.potentialParticipants.flat().map(o=>r===ei?(o==null?void 0:o.individualParticipantIds)||[]:o.participantId).flat():[],a=(i||[]).map(o=>{var s;return r===ei&&(((s=o==null?void 0:o.participant)==null?void 0:s.individualParticipantIds)||[])||(o==null?void 0:o.participantId)&&[o.participantId]||[]}).flat();return{individualParticipantIds:a.concat(n).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:n}}function To(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var uw="SIGN_IN_STATUS",SX="SIGNED_OUT",ly="SIGNED_IN",Gn="TEAM",Dt="INDIVIDUAL",Ja="GROUP",ft="PAIR",Xt="TEAM",tI={TEAM_PARTICIPANT:Gn,INDIVIDUAL:Dt,GROUP:Ja,TEAM:Xt,PAIR:ft},OSe={INDIVIDUAL:Dt,GROUP:Ja,PAIR:ft,TEAM:Xt,SIGN_IN_STATUS:uw,SIGNED_OUT:SX,SIGNED_IN:ly};function oL({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?Ne(e,t==null?void 0:t.convertExtensions,!0):e,a=n.filter(l=>l.participantType===Xt),o=n.filter(l=>l.participantType===Ja),s=n.filter(l=>l.participantType===ft);return n.forEach(l=>{if(l.participantType===Dt){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{var p;d===u&&!((p=l.teamParticipantIds)!=null&&p.includes(c.participantId))&&(l.teamParticipantIds.push(c.participantId),r.get(c.participantId)||r.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),s.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),o.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}function TX(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function kSe(t){let e=Object.assign({},...yc.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return TX(e[t])}var yc=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function DX({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n==null?void 0:n.map(({person:s})=>s)].flat().filter(Boolean);function o(s){let{nationalityCode:l}=s||{};if(l){let u=yc.find(({iso:c})=>c===l);i&&u!=null&&u.ioc&&!s.iocNationalityCode&&(s.iocNationalityCode=u.ioc),e&&u!=null&&u.iso2&&!s.iso2NationalityCode&&(s.iso2NationalityCode=u.iso2),u!=null&&u.label&&!s.countryName&&(s.countryName=u.label)}}a.forEach(o)}function xSe({participantMap:t,template:e}){var i;let r=Object.values(t);for(let n of r){let a=n.participant;if((i=a.individualParticipantIds)!=null&&i.length){a.individualParticipants=[];for(let o of a.individualParticipantIds){let s=t[o].participant;a.individualParticipants.push(e?Nm({template:e,source:s}):s)}}}}function nd(t){var e;let{tournamentRecord:i,participantId:r}=t,n=t.tournamentRecords||i&&{[i.tournamentId]:i}||{};for(let a of Object.values(n)){let o=(e=a.participants)==null?void 0:e.find(s=>s.participantId===r);if(o)return{participant:o,tournamentId:a.tournamentId}}return{error:Wi}}function PX(t){let{tournamentRecord:e,participantId:i}=t;if(i){let r=nd({tournamentRecord:e,participantId:i});return r.participant??r}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Je}}function Do(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=PX(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:se,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:aF};let a=n.timeItems.filter(s=>(s==null?void 0:s.itemType)===r).filter(s=>!(i!=null&&i.length)||i.some(l=>{var u;return(u=s==null?void 0:s.itemSubTypes)==null?void 0:u.includes(l)})).sort((s,l)=>{let u=new Date(s.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),o=Ne(a.pop(),!1,!0);if(o){let s={timeItem:o,...Z};return e&&Object.assign(s,{previousItems:a}),s}else return{info:Vr}}function sL({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:xs};if(!e.timeItems)return{info:Vr};let{timeItem:n,previousItems:a,info:o}=Do({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function cw({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:vi};if(!r.timeItems)return{info:Vr};let{timeItem:n,previousItems:a,info:o}=Do({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:o}}function VP({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:ve};if(!e.timeItems)return{info:Vr};let{timeItem:n,previousItems:a,info:o}=Do({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function lL({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:ve};if(!i)return{error:hr};let a=nd({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:o}=a;if(!(o!=null&&o.timeItems))return{info:Vr};let{timeItem:s,previousItems:l,info:u}=Do({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return s&&{timeItem:s,previousItems:l}||{info:u}}var FSe={[Ja]:"groupParticipantIds",[ft]:"pairParticipantIds",[Xt]:"teamParticipantIds"},LSe={[Ja]:"groups",[Xt]:"teams"};function RX({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,internalUse:a,withISO2:o,withIOC:s}){let l=[],u={};for(let c of i.participants??[]){let d=c==null?void 0:c.participantId;d&&BSe({participantMap:u,participantId:d})}for(let c of i.participants??[]){let d=Ne(c,e,a),{participantId:p,individualParticipantIds:m,participantType:h}=d;if(!u[p]){l.push(p);continue}if(Object.assign(u[p].participant,d),m){let f=$Se({individualParticipantIds:m,participantCopy:d,participantMap:u,participantType:h,participantId:p});f.missingParticipantIds.length&&l.push(...f.missingParticipantIds)}if(r&&(u[p].participant.signedIn=_Se(d)),n){let{ratings:f,rankings:g,seedings:v}=mv({participant:d});u[p].participant.seedings=v,u[p].participant.rankings=g,u[p].participant.ratings=f}(s||o)&&DX({participant:u[p].participant,withISO2:o,withIOC:s})}if(t){let c=At(t)?t:void 0;xSe({participantMap:u,template:c})}return{missingParticipantIds:l,participantMap:u}}function _Se(t){let{timeItem:e}=Do({itemType:uw,element:t});return(e==null?void 0:e.itemValue)===ly}function $Se({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){var a;let o=[];for(let s of t){let l=(a=i[s])==null?void 0:a.participant;if(!l){o.push(s);continue}if(l[FSe[r]].push(n),[Xt,Ja].includes(r)){let{participantRoleResponsibilities:u,participantOtherName:c,participantName:d,participantId:p,teamId:m}=e,h=LSe[r];l[h].push({participantRoleResponsibilities:u,participantOtherName:c,participantName:d,participantId:p,teamId:m})}if(r===ft){let u=t.find(c=>c!==s);i[s].pairIdMap[n]=u,i[s].pairIdMap[u]=n}}return{missingParticipantIds:o}}function BSe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[ii]:{...i},[ei]:{...i},[Xt]:{...i},...i}}}function Dh({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){var a;if(e)return{participantMap:(a=RX({...t,...r,tournamentRecord:i}))==null?void 0:a.participantMap};let o=Ne(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&o.forEach(l=>DX({participant:l,...t}));let s;if((n||t!=null&&t.withGroupings)&&o!=null&&o.length&&({participantsWithGroupings:o,groupInfo:s}=oL({participantsProfile:t,deepCopy:!1,participants:o})),(t==null?void 0:t.withScaleValues)&&(o==null?void 0:o.length))for(let l of o){let{ratings:u,rankings:c}=mv({participant:l});l.rankings=c,l.ratings=u}return{participants:o,groupInfo:s}}function Bt({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:Yx};let o={};return i&&s(i),a&&s(a),r&&s(r),n&&s(n),{appliedPolicies:o,...Z};function s(l){var u,c;let d=(c=(u=l==null?void 0:l.extensions)==null?void 0:u.find(p=>p.name===oy))==null?void 0:c.value;if(d)for(let p of Object.keys(d))(t?e.includes(p):!e.length||e.includes(p))&&(o[p]=Ne(d[p],!1,!0))}}function Qu({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:Yx};let{appliedPolicies:a}=Bt({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),o={};for(let s of t){let l=a==null?void 0:a[s];l&&(o[s]=l)}return Object.keys(o).length?{policyDefinitions:o}:{info:Xf.message}}var CX="WALKOVER",h2="RETIRED",uL="COMPETITIVE",uy="ROUTINE",cy="DECISIVE",ZU="winRatio",VSe={[uu]:{policyName:"Competitive Bands Default",profileBands:{[cy]:20,[uy]:50}}},cL=VSe;function ec({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let o=Qu({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[uu])??(o==null?void 0:o[uu])??cL[uu];a.policies[uu]=s}return a}function Rp({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:ve};let{appliedPolicies:a}=Bt({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a!=null&&a[i]?{policy:a[i]}:{info:Xf==null?void 0:Xf.message}}function dw({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){var n,a,o,s,l,u;e=e??((n=r==null?void 0:r.category)==null?void 0:n.categoryName)??((a=r==null?void 0:r.category)==null?void 0:a.ageCategoryCode),i=i??((o=r==null?void 0:r.category)==null?void 0:o.categoryType)??((s=r==null?void 0:r.category)==null?void 0:s.subType);let{policy:c}=Rp({policyType:td,tournamentRecord:t,event:r}),d=(l=t?vt({element:t,name:xu}).extension:void 0)==null?void 0:l.value,p=(u=r&&vt({name:xu,element:r}).extension)==null?void 0:u.value;return{scheduleTiming:{tournamentScheduling:d,eventScheduling:p,categoryName:e,categoryType:i,policy:c}}}function dL({drawDefinition:t,attributes:e}){let{extension:i}=vt({element:t,name:n0}),r=(i==null?void 0:i.value)||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:n0,value:r},NP({drawDefinition:t,extension:i}),{entryProfile:r}}function pw({drawDefinition:t}){let{extension:e}=vt({element:t,name:n0});return{entryProfile:(e==null?void 0:e.value)||{}}}var Wo="ALTERNATE",mw="CONFIRMED",ca="DIRECT_ACCEPTANCE",hw="FEED_IN",fw="JUNIOR_EXEMPT",Fu="LUCKY_LOSER",gw="ORGANISER_ACCEPTANCE",vw="QUALIFIER",jSe="REGISTERED",Iw="SPECIAL_EXEMPT",Po="UNGROUPED",Cp="UNPAIRED",ug="WILDCARD",Yl="WITHDRAWN",QU=[mw,ca,fw,gw,Iw],EX=[hw,Fu,vw],Ep=[mw,ca,hw,fw,gw,Iw,ug],cs=[mw,ca,fw,Fu,vw,gw,Iw,ug],MX=[Wo,mw,ca,hw,fw,Fu,gw,vw,jSe,Iw,Po,Cp,ug,Yl],GSe={ALTERNATE:Wo,CONFIRMED:mw,DIRECT_ACCEPTANCE:ca,DIRECT_ENTRY_STATUSES:Ep,DRAW_SPECIFIC_STATUSES:EX,EQUIVALENT_ACCEPTANCE_STATUSES:QU,FEED_IN:hw,JUNIOR_EXEMPT:fw,LUCKY_LOSER:Fu,ORGANISER_ACCEPTANCE:gw,QUALIFIER:vw,SPECIAL_EXEMPT:Iw,STRUCTURE_SELECTED_STATUSES:cs,UNGROUPED:Po,UNPAIRED:Cp,VALID_ENTRY_STATUSES:MX,WILDCARD:ug,WITHDRAWN:Yl};function pL({stage:t,drawDefinition:e}){let{entryProfile:i}=pw({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&bP.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return dL({drawDefinition:e,attributes:n}),!0}return r}function HSe({stage:t,drawDefinition:e}){var i;let{entryProfile:r}=pw({drawDefinition:e});return((i=r[t])==null?void 0:i.alternates)||0}function zSe({stage:t,drawDefinition:e}){var i;let{entryProfile:r}=pw({drawDefinition:e});return((i=r[t])==null?void 0:i.wildcardsCount)||0}function gM({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function Ph({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:o,stages:s,stage:l}){var u;let c=((u=i.entries)==null?void 0:u.reduce((d,p)=>{var m,h;let f=(h=(m=vt({name:Il,element:p}))==null?void 0:m.extension)==null?void 0:h.value,g=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),v=!n||p.entryStatus&&n.includes(p.entryStatus),y=p.entryStageSequence??1;return g&&(!r||y===r)&&v&&(!o||!f||o===f)?d.concat(p):d},[]))??[];if(a&&l===Bi){let{playoffEntries:d,error:p}=WSe({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:c).filter(m=>!e||m.placementGroup===e)}return c}function WSe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===Nu&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:o}=n.source,{structure:s}=tt({drawDefinition:e,structureId:o});(s==null?void 0:s.structureType)===_n&&(s.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(f=>{var g;let{participantId:v}=f,y=(g=vt({element:f,name:Oc}).extension)==null?void 0:g.value;return y&&v?{[v]:y}:void 0}).filter(Boolean)),m=Object.keys(p).reduce((f,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return f.includes(y)||f.push(y),f},[]).length===Object.keys(p).length,h=Object.keys(p).filter(f=>{let g=p[f],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||m)&&h.forEach(f=>{let g=p[f],{groupOrder:v,provisionalOrder:y,GEMscore:I}=g,b=v||t&&y,S=[...a??[]].sort(lr).indexOf(b)+1;r.push({entryStage:Bi,entryStatus:hw,placementGroup:S,groupingValue:d,participantId:f,GEMscore:I})})})}return{playoffEntries:r}}function qSe({stage:t,drawDefinition:e}){return Ep.reduce((i,r)=>(gM({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function go({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){var a;let o,s=[];n||({structure:n,error:o}=tt({drawDefinition:i,structureId:r}));let l=oi({structure:n}).positionAssignments;if(o||!n)return{seedAssignments:[],error:Ni};r||(r=n.structureId);let{stage:u,stageSequence:c}=n,d=u===Bi&&i&&Ph({provisionalPositioning:t,drawDefinition:i,stageSequence:c,structureId:r,stage:u}),p=d?d.filter(f=>f.placementGroup===1).sort((f,g)=>f.GEMscore<g.GEMscore&&1||f.GEMscore>g.GEMscore&&-1||0).map((f,g)=>{let v=g+1;return{participantId:f.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],m=p==null?void 0:p.slice(0,e?p.length:l.length/2);m.length?s=m:n.seedAssignments?s=n.seedAssignments:o=OK;let h=n.seedLimit??((a=n==null?void 0:n.positionAssignments)==null?void 0:a.length);return{seedAssignments:s,stageSequence:c,seedLimit:h,stage:u,error:o}}function _s(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function iI({item:t,drawDefinition:e,structure:i,event:r}){var n,a,o;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((n=e.tieFormats)==null?void 0:n.find(s=>t.tieFormatId===s.tieFormatId))||(r.tieFormat?r.tieFormat:(a=r.tieFormats)==null?void 0:a.find(s=>t.tieFormatId===s.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(o=e.tieFormats)==null?void 0:o.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function In({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:iI({item:i,drawDefinition:t,structure:e,event:r})||iI({item:e,drawDefinition:t,structure:e,event:r})||_s(t)||_s(r)}}function YSe({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function ln({drawDefinition:t,structure:e}){let i={},r=[];return((t==null?void 0:t.structures)??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:o,structures:s}=n,l=Array.isArray(s);if(l)l&&s.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=o;i[a]={matchUps:u,itemStructureIds:[]},u==null||u.forEach(c=>{r.push(c),c.tieMatchUps&&r.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function Zd({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=(e==null?void 0:e.mappedMatchUps)??t;let n=t[i],a=((n==null?void 0:n.itemStructureIds)||[]).map(o=>{let{matchUps:s,structureName:l}=t[o];return r?s.map(u=>Object.assign(Ne(u,!0,!0),{containerStructureId:i,structureId:o,structureName:l})):s}).flat();return((n==null?void 0:n.matchUps)||[]).concat(...a)}function NX({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=Cr(t,t.length/e).map(n=>n.reduce((a,o)=>a+o)),r=i.slice().sort(lr);return i.map(n=>r.indexOf(n)+1)}function jP(t){if(!At(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>st(a)||a===void 0||a===null);return r&&n}function Ro(t){return Array.isArray(t)?t.every(jP):!1}function An({matchUps:t=[],interpolate:e}){var i;if(!Ro(t))return{roundMatchUps:[],error:se};let r=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?Qe(m.roundNumber):m.roundNumber;return!m.roundNumber||p.includes(h)?p:p.concat(h)},[]).sort(lr).map(p=>{let m=t.filter(g=>g.roundNumber===p),h=m.find(({matchUpType:g})=>g===fi)?m.filter(({matchUpType:g})=>g===fi):m,f=g=>g.sort((v,y)=>lr(v.roundPosition,y.roundPosition));return{[p]:f(h)}}),n=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?Qe(m.roundNumber):m.roundNumber;return p[h]||(p[h]=He({abbreviatedRoundName:m.abbreviatedRoundName,finishingRound:m.finishingRound,roundName:m.roundName})),p},{}),a=Object.assign({},...r);if(e){let p=Math.max(...Object.keys(a).map(h=>Qe(h)).filter(h=>!isNaN(h))),m=(i=a[p])==null?void 0:i.length;if(m>1&&Cs(m)){let h=p+1,f=h+m/2;Te(h,f).forEach((g,v)=>{a[g]=Te(0,m/(2+v*2)).map(()=>({}))})}}let o=0,s=Object.assign({},...Object.keys(a).map(p=>{var m,h,f;let g=(m=a[p])==null?void 0:m.length,v=(f=(h=a[p])==null?void 0:h.filter(I=>{var b;return!Ir.includes(I.matchUpStatus)&&!((b=I.score)!=null&&b.scoreStringSide1)}))==null?void 0:f.length,y=g&&g===v;return o=Math.max(o,g),{[p]:{matchUpsCount:g,inactiveCount:v,inactiveRound:y}}})),l=0,u=0,c=Object.keys(a).map(p=>Qe(p)).filter(p=>!isNaN(p));c.forEach(p=>{var m,h,f,g,v;let y=a[p].sort((b,S)=>b.roundPosition-S.roundPosition),I=y.map(b=>(b==null?void 0:b.drawPositions)||[]).flat();if(s[p].roundNumber=p,s[p].roundFactor=s[p].matchUpsCount?o/s[p].matchUpsCount:1,s[p].finishingRound=(m=n[p])==null?void 0:m.finishingRound,s[p].roundName=(h=n[p])==null?void 0:h.roundName,s[p].abbreviatedRoundName=(f=n[p])==null?void 0:f.abbreviatedRoundName,s[p].finishingPositionRange=(v=(g=a[p])==null?void 0:g[0])==null?void 0:v.finishingPositionRange,p===1||!s[p-1]){let b=I.sort(lr),S=Cr(b,2);s[p].drawPositions=b,s[p].pairedDrawPositions=S}else{let b=s[p-1],S=b.drawPositions,w=b.matchUpsCount/s[p].matchUpsCount,U=Cr(S,w),T=y.map(D=>{let{roundPosition:P}=D,C=[...D.drawPositions||[],void 0,void 0].slice(0,2);if(!P)return C;let R=(C==null?void 0:C.filter(Boolean))||[];if(!(R!=null&&R.length))return[void 0,void 0];if(p<3&&(R==null?void 0:R.length)===2)return C==null?void 0:C.slice().sort(lr);let N=ji(S,R).length!==(R==null?void 0:R.length);if(R!=null&&R.length&&N)return(R==null?void 0:R.length)===1?[R[0],void 0]:C==null?void 0:C.slice().sort(lr);let A=(P-1)*2;return U.slice(A,A+2).map(M=>R==null?void 0:R.find(E=>M.includes(E)))});s[p].drawPositions=T==null?void 0:T.flat(),s[p].pairedDrawPositions=T}s[p+1]&&s[p+1].matchUpsCount===s[p].matchUpsCount&&(s[p+1].feedRound=!0,s[p+1].feedRoundIndex=u,s[p].preFeedRound=!0,u+=1),s[p]&&!s[p].feedRound&&(s[p].roundIndex=l,l+=1)});let d=!!Object.values(s).find(({matchUpsCount:p})=>!Cs(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:d,maxMatchUpsCount:o,roundMatchUps:a,roundNumbers:c,roundProfile:s,...Z}}function eS(t){if(!Array.isArray(t))return"";let e=t.filter(_i);return e.length?dt([Math.min(...e),Math.max(...e)]).join("-"):""}function KSe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:$e};if(!e)return{error:Xa};let{structure:r}=tt({drawDefinition:t,structureId:e});if((r==null?void 0:r.stage)!==an)return{error:Sp,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=(n==null?void 0:n.filter(d=>d.target.structureId===e))||[],o=(a==null?void 0:a.reduce((d,p)=>{let{structureId:m}=p.source;return d.includes(m)?d:d.concat(m)},[]))||[],s=Object.assign({},...o.map(d=>{let p=Zd({structureId:d,matchUpsMap:i}),m=An({matchUps:p}).roundProfile;return{[d]:m}})),l=Zd({matchUpsMap:i,structureId:e}),{roundProfile:u}=An({matchUps:l}),c={};return a==null||a.forEach(d=>{var p,m,h;let{structureId:f,roundNumber:g}=d.source,{feedProfile:v,groupedOrder:y,positionInterleave:I,roundNumber:b}=d.target,S=s[f],w=(p=S[1])==null?void 0:p.drawPositions,U=(m=S[g])==null?void 0:m.matchUpsCount;if(!U)return;let T=U?w.length/U:0,D=w.length/T,P=w.slice(),C=NX({roundPositionsCount:D,groupedOrder:y}),R=(C==null?void 0:C.length)||1;if(R<=D){let M=w.length/R,E=Cr(P,M);v===Yd&&E.forEach(O=>O.reverse()),P=(C==null?void 0:C.length)&&(C==null?void 0:C.map(O=>E[O-1]).flat())||P}let N=Cr(P,T);if(I){let M=Te(0,I.interleave).map(()=>{}),E=Te(0,I.offset).map(()=>{});N=N.map(k=>[k,...M]),N.unshift(E),N=N.flat(1);let O=N.length-I.offset;N=N.slice(0,O)}c[b]||(c[b]={});let A=(h=u==null?void 0:u[b])!=null&&h.feedRound?2:1;N.forEach((M,E)=>{let O=1+E*A;c[b][O]||(c[b][O]=eS(M))})}),{sourceDrawPositionRanges:c}}function AX({drawDefinition:t}){if(typeof t!="object")return{error:am};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((o,s)=>{let{stage:l}=s;return o[l]?o[l].push(s):o[l]=[s],o},{});for(let o of Object.keys(n)){let s=n[o].find(({stageSequence:u})=>u===1);if(!s)continue;let{structureId:l}=s;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:o})}return{exitProfiles:e};function a({exitProfiles:o,exitProfile:s,structureId:l,targetRound:u,aggregator:c,stage:d}){o[l]||(o[l]=[]),s==="0"&&[an,Bi].includes(d)||o[l].push(s);let p=r.filter(m=>m.source.structureId===l&&m.source.roundNumber>=u);for(let m of p){let h=m.source.roundNumber,f=m.target.roundNumber,g=m.target.structureId,v=i.find(I=>I.structureId===g).stage,y=[v,g,f,h].join("|");if(c[y])return;c[y]=!0,a({exitProfile:`${s}-${h}`,structureId:g,exitProfiles:o,targetRound:f,aggregator:c,stage:v})}}}function XSe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){var n;if(!t)return{error:$e};if(!i)return{error:Xa};if(!e){let s=Zd({matchUpsMap:r,structureId:i});if({roundProfile:e}=An({matchUps:s}),!e)return{error:Je}}let a=(Math.min(...((n=e==null?void 0:e[1])==null?void 0:n.drawPositions)??[])||1)-1,o=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(o||[]).map(s=>{var l,u;let c=(l=e==null?void 0:e[s])==null?void 0:l.matchUpsCount,d=((u=e==null?void 0:e[1])==null?void 0:u.drawPositions)??[],p=Cr(d,d.length/c),m=p.map(eS),h=p.map(I=>I.map(b=>b-a)).map(eS),f=o.map(I=>{var b;if(I>s)return;let S=((b=e==null?void 0:e[I])==null?void 0:b.drawPositions)??[];return Cr(S,S.length/c)}).filter(Boolean),g=Te(0,c).map(I=>f.map(b=>b[I]).flat().filter(Boolean).sort(lr)).map(I=>dt(I)),v=g.map(I=>hwe(I).map(eS).join(", ")),y=Object.assign({},...Te(0,c).map(I=>({[I+1]:{firstRoundDrawPositionsRange:m[I],firstRoundOffsetDrawPositionsRange:h[I],possibleDrawPositions:g[I],drawPositionsRange:v[I]}})));return{[s]:y}}))}}function mL({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){var n;if(!i)return!1;r=r??i.matchUps??[],t=t??An({matchUps:r}).roundsNotPowerOf2;let a=!!((n=i.positionAssignments)!=null&&n.find(({drawPosition:o})=>o))||!!(r!=null&&r.find(({drawPositions:o})=>o==null?void 0:o.length));return(!(e!=null&&e.drawType)||e.drawType!==Tp)&&!(i!=null&&i.structures)&&t&&a}function Yn({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(n=>n==null?void 0:n.roundPosition)),r=!!(e!=null&&e.find(n=>{var a;return(a=n==null?void 0:n.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==Fr&&(!e.length||!i&&!r)}var hL={[og]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Ae]:"",[Bi]:"P",[Ke]:"Q",[an]:"C"}}},JSe=hL;function ZSe({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){var n,a,o;let{roundProfile:s,roundMatchUps:l}=An({matchUps:r}),{structureAbbreviation:u,stage:c}=i,d=Yn({structure:i}),p=mL({structure:i}),m=i.structures,h={},f=hL[og],g=i.stage===Ke,v=g?Math.max(...((e==null?void 0:e.structures)??[]).filter(M=>M.stage===Ke).map(({stageSequence:M})=>M??1),0):0,y=(i.stageSequence??1)<v?i.stageSequence??1:"",I=y&&(((n=t==null?void 0:t.affixes)==null?void 0:n.preQualifying)||f.affixes.preQualifying)||"",b=(t==null?void 0:t.roundNamingMap)||f.roundNamingMap||{},S=(t==null?void 0:t.abbreviatedRoundNamingMap)||f.abbreviatedRoundNamingMap||{},w=((a=t==null?void 0:t.affixes)==null?void 0:a.preFeedRound)||f.affixes.preFeedRound,U=((o=t==null?void 0:t.affixes)==null?void 0:o.roundNumber)||f.affixes.roundNumber,T=((t==null?void 0:t.namingConventions)||f.namingConventions).round,D=c&&c!==Ae?c[0]:"",P=(t==null?void 0:t.stageConstants)||f.stageConstants,C=c&&(P==null?void 0:P[c])||D,R=`${I}${C}${y}`,N=s?Object.keys(s):[],A=g&&P!=null&&P[Ke]?`${P==null?void 0:P[Ke]}-`:"";if(m||d||p)Object.assign(h,...N.map(M=>{let E=`${A}${T} ${M}`,O=`${U}${M}`;return{[M]:{roundName:E,abbreviatedRoundName:O}}}));else{let M=g&&((t==null?void 0:t.qualifyingFinishMap)||(f==null?void 0:f.qualifyingFinishMap)||{});Object.assign(h,...N.map(E=>{if(!(s!=null&&s[E]))return;let{matchUpsCount:O,preFeedRound:k}=s[E],x=O*2,F=(M==null?void 0:M[s==null?void 0:s[E].finishingRound])||M&&`${U}${x}`||b[O]||`${U}${x}`,$=k?`-${w}`:"",_=`${F}${$}`,L=[R,u,_].filter(Boolean).join("-"),B=`${S[O]||`${U}${x}`}${$}`,V=[R,u,B].filter(Boolean).join("-");return{[E]:{abbreviatedRoundName:V,roundName:L}}}))}return{roundNamingProfile:h,roundProfile:s,roundMatchUps:l}}var QSe=(t,e)=>(t||0)+(e||0);function OX(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&CX||i<=e[cy]&&cy||i<=e[uy]&&uy||uL}function kX({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(QSe)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function e0e(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function xX(t){return t.map(e0e).sort().map(e=>parseFloat(e.toFixed(2)))}function yw({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:sa};let{score:r,winningSide:n}=i;if(!n)return{error:se};let a=!e&&t&&Rp({policyType:uu,tournamentRecord:t}).policy,o=e||(a==null?void 0:a.profileBands)||cL[uu].profileBands,s=kX({score:r}),l=xX([s]),u=OX(l,o),c=Array.isArray(l)?l[0]:l;return{...Z,competitiveness:u,pctSpread:c}}function FX({matchUp:t}){var e,i,r;if(!t)return{error:sa};if(t&&!t.sides)return{error:la};if(t&&!t.hasContext)return{error:uP};let n=(e=t.sides??[])==null?void 0:e.map(u=>u==null?void 0:u.participantId).filter(Boolean),a=((i=t.sides)==null?void 0:i.filter(u=>{var c;return((c=u.participant)==null?void 0:c.participantType)===Dt}).map(u=>u.participantId).filter(Boolean))??[],o=(((r=t.sides??[])==null?void 0:r.map(u=>{var c;return(c=u.participant)==null?void 0:c.individualParticipants}).filter(Boolean))??[]).map(u=>(u??[]).map(c=>c==null?void 0:c.participantId).filter(Boolean)),s=[...a,...o.flat()].filter(Boolean)??[],l=dt(s.concat(n)).filter(Boolean)??[];return{nestedIndividualParticipantIds:o,allRelevantParticipantIds:l,individualParticipantIds:s,sideParticipantIds:n,...Z}}var o0="CHECK_IN",s0="CHECK_OUT",t0e="SCHEDULE",Rh="SCHEDULE.ASSIGNMENT.VENUE",Kl="SCHEDULE.ALLOCATION.COURTS",Lc="SCHEDULE.ASSIGNMENT.COURT",GP="SCHEDULE.COURT.ORDER",Ch="SCHEDULE.DATE",i0e="COMPLETED.DATE",fL="HOME_PARTICIPANT_ID",gL="SCHEDULE.ASSIGN.OFFICIAL",Eh="SCHEDULE.TIME.SCHEDULED",gs="SCHEDULE.TIME.START",gu="SCHEDULE.TIME.STOP",Ol="SCHEDULE.TIME.RESUME",Lu="SCHEDULE.TIME.END",HP="SCHEDULE.TIME.MODIFIERS",LX="TO_BE_ANNOUNCED",_X="NEXT_AVAILABLE",$X="FOLLOWED_BY",BX="AFTER_REST",VX="RAIN_DELAY",r0e="NOT_BEFORE",vM=[LX,_X,$X,BX,VX],n0e="ELIGIBILITY",a0e="REGISTRATION",o0e="SUSPENSION",s0e="MEDICAL",l0e="PENALTY",jX="SCALE",GX="RATING",HX="RANKING",vL="SEEDING",ad="PUBLISH",Za="PUBLIC",od="STATUS",u0e="MODIFICATION",c0e="RETRIEVAL",d0e="other",p0e={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:vM,AFTER_REST:BX,ALLOCATE_COURTS:Kl,ASSIGN_COURT:Lc,ASSIGN_OFFICIAL:gL,ASSIGN_VENUE:Rh,CHECK_IN:o0,CHECK_OUT:s0,COMPLETED_DATE:i0e,COURT_ORDER:GP,ELIGIBILITY:n0e,END_TIME:Lu,FOLLOWED_BY:$X,MEDICAL:s0e,MODIFICATION:u0e,NEXT_AVAILABLE:_X,NOT_BEFORE:r0e,OTHER:d0e,PENALTY:l0e,PUBLIC:Za,PUBLISH:ad,RANKING:HX,RATING:GX,RAIN_DELAY:VX,REGISTRATION:a0e,RESUME_TIME:Ol,RETRIEVAL:c0e,SCALE:jX,SCHEDULE:t0e,SCHEDULED_DATE:Ch,SCHEDULED_TIME:Eh,SEEDING:vL,START_TIME:gs,STATUS:od,STOP_TIME:gu,SUSPENSION:o0e,TIME_MODIFIERS:HP,TO_BE_ANNOUNCED:LX};function Mh({matchUp:t}){if(!t)return{error:sa};if(!t.hasContext)return{error:uP};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:la};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=FX({matchUp:t}),n=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[o0,s0].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(s=>s.itemValue).filter(s=>n.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===o0);e==null||e.forEach((s,l)=>{let u=r==null?void 0:r[l],c=(s==null?void 0:s.length)&&s.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),r==null||r.forEach((s,l)=>{a.includes(s)&&((e==null?void 0:e[l])??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let o=r==null?void 0:r.reduce((s,l)=>a.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...Z}}var Xi=t=>e=>{let i=At(e)&&(e==null?void 0:e.matchUpType)||Di(e)&&e;return i&&mK[t].includes(i)};function rI(t){var e;let{matchUpAverageTimes:i,matchUpFormat:r}=t||{},n=(i==null?void 0:i.map(({matchUpFormatCodes:o})=>o==null?void 0:o.filter(s=>s===r)).flat().filter(Boolean).sort((o,s)=>((o==null?void 0:o.length)||0)-((s==null?void 0:s.length)||0)))||[],a=n.includes(r)?r:n[0];return(e=i==null?void 0:i.find(({matchUpFormatCodes:o,averageTimes:s})=>(o==null?void 0:o.find(l=>a===l))&&s))==null?void 0:e.averageTimes}function nI(t){var e;let{matchUpRecoveryTimes:i,averageMinutes:r,matchUpFormat:n}=t||{};return(e=i==null?void 0:i.find(({matchUpFormatCodes:a,averageTimes:o,recoveryTimes:s})=>{if(o&&r){let{greaterThan:l=0,lessThan:u=360}=o;if(r>l&&r<u)return!0}return(a==null?void 0:a.find(l=>l===n))&&s}))==null?void 0:e.recoveryTimes}function zX({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>{var o,s;return(((o=a.categoryNames)==null?void 0:o.length)||0)-(((s=n.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:n,categoryNames:a})=>!(a!=null&&a.length)&&!(n!=null&&n.length)||(a==null?void 0:a.includes(e))||(n==null?void 0:n.includes(i)))).find(Boolean)}function m0e({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:o,policy:s}){var l;let u=(e==null?void 0:e.matchUpRecoveryTimes)&&nI({...e,averageMinutes:i,matchUpFormat:n}),c=(t==null?void 0:t.matchUpRecoveryTimes)&&nI({...t,averageMinutes:i,matchUpFormat:n}),d=(s==null?void 0:s.matchUpRecoveryTimes)&&nI({...s,averageMinutes:i,matchUpFormat:n}),p=[u,c,d,(l=s==null?void 0:s.defaultTimes)==null?void 0:l.recoveryTimes,r==null?void 0:r.recoveryTimes];return zX({categoryName:a,categoryType:o,timesBlockArray:p})}function h0e({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:o}){var s;let l=(a==null?void 0:a.matchUpAverageTimes)&&rI({...a,matchUpFormat:t}),u=(n==null?void 0:n.matchUpAverageTimes)&&rI({...n,matchUpFormat:t}),c=(o==null?void 0:o.matchUpAverageTimes)&&rI({...o,matchUpFormat:t}),d=[l,u,c,(s=o==null?void 0:o.defaultTimes)==null?void 0:s.averageTimes,r==null?void 0:r.averageTimes];return zX({categoryName:e,categoryType:i,timesBlockArray:d})}var WX="DOUBLES_SINGLES",qX="SINGLES_DOUBLES",qo="total",IM="participantConflict",lc="matchUpConflict",YX="ISSUE_IDS",pd="CONFLICT",md="WARNING",yM="ERROR",bM="ISSUE",tS="STATE",f0e={SINGLES_DOUBLES:qX,DOUBLES_SINGLES:WX,TOTAL:qo,CONFLICT_MATCHUP_ORDER:lc,CONFLICT_PARTICIPANTS:IM,SCHEDULE_ISSUE_IDS:YX,SCHEDULE_CONFLICT:pd,SCHEDULE_WARNING:md,SCHEDULE_ERROR:yM,SCHEDULE_ISSUE:bM,SCHEDULE_STATE:tS};function bw({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:s}){if(!i)return{error:ve};o=o??(s==null?void 0:s.eventType)??Em;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=dw({tournamentRecord:i,categoryName:n,categoryType:a,event:s}),c={...u,matchUpFormat:r,categoryType:a,defaultTiming:l};return zP({eventType:o,timingDetails:c})}function zP({timingDetails:t,eventType:e}){let i=h0e(t),r=Object.keys((i==null?void 0:i.minutes)||{}),n=(i==null?void 0:i.minutes)&&((r==null?void 0:r.includes(e))&&i.minutes[e]||i.minutes.default),a=m0e({...t,averageMinutes:n}),o=Object.keys((a==null?void 0:a.minutes)||{}),s=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),l=Xi(Em)(e)?qX:WX,u=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(l))&&a.minutes[l]||s);return{averageMinutes:n,recoveryMinutes:s,typeChangeRecoveryMinutes:u}}function LC(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Mp({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>LC(n)-LC(a)).pop(),r=i&&LC(i);return{itemValue:i==null?void 0:i.itemValue,timeStamp:r}}function KX({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Mp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Eh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function Nh({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Mp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Ch});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function Lp(t){if(q9.test(t)){let e=vF();return new Date(`${e}T${t}`)}else return new Date(t)}function g0e({matchUp:t}){if(!t)return{error:sa};if(!t.timeItems)return{error:aF};let e=t.timeItems.filter(r=>[gs,gu,Ol,Lu].includes(r==null?void 0:r.itemType)).sort((r,n)=>Lp(r.itemValue).getTime()-Lp(n.itemValue).getTime()),i=e.reduce((r,n)=>{var a,o;let s,l=(a=n==null?void 0:n.itemType)==null?void 0:a.split("."),u=`SCHEDULE.TIME.${((o=n==null?void 0:n.itemType)==null?void 0:o.startsWith("SCHEDULE.TIME"))&&l[2]}`;switch(u){case gs:s=0;break;case Lu:if(r.lastValue&&[gs,Ol].includes(r.lastType)){let c=Lp(n.itemValue).getTime()-Lp(r.lastValue).getTime();s=r.milliseconds+c}else s=r.milliseconds;break;case gu:if([gs,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let c=Lp(n.itemValue).getTime()-Lp(r.lastValue).getTime();s=r.milliseconds+c}else s=r.milliseconds;break;default:s=r.milliseconds;break}return{milliseconds:s,lastType:u,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([gs,Ol].includes(i.lastType)){let r=new Date().getTime()-Lp(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:v0e(i.milliseconds),relevantTimeItems:e}}function v0e(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function I0e({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],r=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{startTime:(e=i.reduce((n,a)=>{let o=a.itemType===gs&&a;return o&&(!n||r(o)<r(n))?o:n},void 0))==null?void 0:e.itemValue}}function ww(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:se};let n=To(t);i.venueId||(i.venueId=Ht());let a;for(let o of Object.values(n)){let s=y0e({disableNotice:!0,tournamentRecord:o,context:r,venue:i});if(s!=null&&s.error)return s;a=s.venue}return e||ut({topic:WF,payload:{venue:i}}),He({...Z,venue:a})}function y0e({tournamentRecord:t,disableNotice:e,context:i,venue:r}){return t?r?(t.venues||(t.venues=[]),r.venueId||(r.venueId=Ht()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0)?{error:f9}:(i&&_t({element:r,extension:{value:i,name:Q8}}),t.venues.push(r),e||ut({payload:{venue:r,tournamentId:t.tournamentId},topic:WF}),{...Z,venue:Ne(r)})):{error:Je,info:"missing venue"}:{error:ve}}function eu({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:ve};if(!i)return{error:Qc};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(sw({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let o=t[a],s=eu({tournamentRecord:o,venueId:i});if(s.success&&s.venue)return ww({tournamentRecord:e,venue:s.venue}),{...Z,venue:r}}}return r?{...Z,venue:r}:{error:Ih}}function IL({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=eu({tournamentRecords:i,tournamentRecord:r,venueId:n});return Ne(a,t,!0)}function Ah({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:ve};if(!i)return{error:fh};let r="findCourt",n,a;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(s=>{s.courtId===i&&(n=s,a=o)})}),n)return{...Z,court:n,venue:a};if(t){let o=(sw({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of o){let l=t[s],u=Ah({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&ww({tournamentRecord:e,venue:u.venue}),{...Z,court:n,venue:a}}}return te({result:{error:lv},stack:r})}function yL(t){return Ne(Ah(t),!1,!0)}function WP({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:ve};if(!i)return{error:fh};let r=Ah({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f})=>({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f}))(r.court);return{...Z,courtInfo:Ne(n,!1,e)}}function cg(t){var e;let i=We(t,[{[wr]:!0},{venueId:!0,[zo]:Qc}]);if(i.error)return i;let{tournamentRecord:r,venueId:n}=t,a=eu({tournamentRecord:r,venueId:n});if(a.error)return a;let o=(((e=a.venue)==null?void 0:e.courts)??[]).map(u=>(({courtInfo:c})=>({...c}))(WP({courtId:u.courtId,internalUse:!0,tournamentRecord:r}))),s=a.venue&&(({venueId:u,venueName:c,venueAbbreviation:d})=>({venueAbbreviation:d,venueName:c,venueId:u}))(a.venue),l=s&&{...s,courtsInfo:o};return{...Z,venueData:Ne(l,!1,!0)}}function b0e({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],r=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{endTime:(e=i.reduce((n,a)=>{let o=a.itemType===Lu&&a;return o&&(!n||r(o)>r(n))?o:n},void 0))==null?void 0:e.itemValue}}function Hi({event:t,eventId:e}){var i,r;if(!t)return{error:vi};let n=(i=vt({name:is,element:t}))==null?void 0:i.extension,a=e?Ne(n==null?void 0:n.value,!1,!0):n==null?void 0:n.value;return e&&((r=t.drawDefinitions)==null||r.forEach(o=>{var s;(s=a==null?void 0:a.flights)==null||s.forEach(l=>{l.drawId===o.drawId&&Object.assign(l,{drawDefinition:o})})})),{flightProfile:a}}function Kn(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},o=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(o).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(r){let u,c=s.find(d=>{var p,m,h;let f=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===r);if(f)u=f,l=a[d.eventId].tournamentId;else{let g=(h=(m=d&&((p=Hi({event:d}))==null?void 0:p.flightProfile))==null?void 0:m.flights)==null?void 0:h.find(v=>v.drawId===r);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:r}}return f});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=s.find(c=>(c==null?void 0:c.eventId)===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...te({result:{error:mo},stack:n})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...te({result:{error:Va},context:{drawId:r,eventId:i},stack:n})}}function qP(t){var e,i,r,n,a,o,s,l,u,c;let d=t.event,p=t.matchUpType,{scheduleVisibilityFilters:m,afterRecoveryTimes:h,tournamentRecord:f,usePublishState:g,scheduleTiming:v,matchUpFormat:y,publishStatus:I,matchUp:b}=t;if(!b)return{error:sa};if(h&&!b.matchUpType&&!t.matchUpType&&(d||f)&&b.drawId){let M=t.drawDefinition||((e=d==null?void 0:d.drawDefinitions)==null?void 0:e.find(O=>O.drawId===b.drawId));!M&&f&&({drawDefinition:M,event:d}=Kn({drawId:b.drawId,tournamentRecord:f}));let E=b.structureId&&((i=M==null?void 0:M.structures)==null?void 0:i.find(({structureId:O})=>O===b.structureId));p=t.matchUpType||(E==null?void 0:E.matchUpType)||(M==null?void 0:M.matchUpType)||(d==null?void 0:d.eventType)!==ur&&(d==null?void 0:d.eventType)}let{milliseconds:S,time:w}=g0e({matchUp:b}),{startTime:U}=I0e({matchUp:b}),{endTime:T}=b0e({matchUp:b}),D,{eventIds:P,drawIds:C}=m??{};if((!P||P.includes(b.eventId))&&(!C||C.includes(b.drawId))){let M=ne=>ne.createdAt?new Date(ne.createdAt).getTime():0,E=new Map,O=((r=b.timeItems)==null?void 0:r.toSorted((ne,de)=>M(ne)-M(de)))??[];for(let ne of O)E.set(ne.itemType,ne.itemValue);let k=E.get(fL),x=E.get(Kl),F=E.get(Eh),$=E.get(HP),_=E.get(Ch),L=E.get(gL),B=E.get(GP),V=E.get(Rh),G=E.get(Lc),j,z,q,W,Y,re=b.matchUpType??p;if(v&&F&&h&&re){let ne={matchUpFormat:b.matchUpFormat??y,...v};({averageMinutes:z=0,recoveryMinutes:q=0,typeChangeRecoveryMinutes:W=0}=zP({timingDetails:ne,eventType:re})),(z||q)&&(j=T?ra(Ui(T),q):ra(F,z+q)),W&&(Y=T?ra(Ui(T),W):ra(F,z+W))}!_&&F&&(_=mt(F));let K=JS({scheduledDate:_,scheduledTime:F}),H={},Q=((n=f&&V&&cg({tournamentRecord:f,venueId:V}))==null?void 0:n.venueData)||{};V&&(H[V]=Q);let{venueName:X,venueAbbreviation:ie,courtsInfo:ae}=Q,le=(a=G&&(ae==null?void 0:ae.find(ne=>ne.courtId===G)))==null?void 0:a.courtName;for(let ne of x||[]){if(!f)break;ne.venueId&&!H[ne.venueid]&&(H[ne.venueId]=(o=cg({venueId:ne.venueId,tournamentRecord:f}))==null?void 0:o.venueData);let de=H[ne.venueId];ne.venueName=de==null?void 0:de.venueName;let Ie=(s=de==null?void 0:de.courtsInfo)==null?void 0:s.find(ce=>ce.courtId===ne.courtId);ne.courtName=Ie==null?void 0:Ie.courtName}D=He({typeChangeTimeAfterRecovery:Y,timeAfterRecovery:j,scheduledDate:_,scheduledTime:F,isoDateString:K,homeParticipantId:k,venueAbbreviation:ie,allocatedCourts:x,timeModifiers:$,venueName:X,venueId:V,courtOrder:B,courtName:le,courtId:G,official:L,typeChangeRecoveryMinutes:W,recoveryMinutes:q,averageMinutes:z,milliseconds:S,startTime:U,endTime:T,time:w})}else D=He({milliseconds:S,startTime:U,endTime:T,time:w});let{scheduledDate:R}=Nh({matchUp:b}),{scheduledTime:N}=KX({matchUp:b});if(g&&(l=I==null?void 0:I.displaySettings)!=null&&l.draws){let M=I.displaySettings.draws,E=(u=(M==null?void 0:M[b.drawId])??(M==null?void 0:M.default))==null?void 0:u.scheduleDetails;if(E){let O=(c=E.find(k=>{var x;return R&&((x=k.dates)==null?void 0:x.includes(R))})??E.find(k=>{var x;return!((x=k.dates)!=null&&x.length)}))==null?void 0:c.attributes;if(O){let k=Object.assign({},...Object.keys(D).map(x=>({[x]:!0})),O);D=Nm({source:D,template:k})}}}let A=b.matchUpStatus&&Ir.includes(b.matchUpStatus)&&(mt(T)||mt(R)||mt(N))||void 0;return{schedule:D,endDate:A}}function w0e({drawPositions:t,roundProfile:e,roundNumber:i}){var r;let n=[void 0,void 0];if(bK(t))return{orderedDrawPositions:n,displayOrder:n};let a=e==null?void 0:e[i],o=((r=a==null?void 0:a.pairedDrawPositions)==null?void 0:r.find(l=>Nn(l||[],t.filter(Boolean))))??n,s=a==null?void 0:a.feedRound;if(yK(t)){let l=[...t].sort(lr);return{orderedDrawPositions:l.length===2?l:o,displayOrder:s?l:o}}if(s){let l=[t.find(u=>!isNaN(Qe(u))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:o,displayOrder:o}}function l0({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=s=>s===void 0?-1:s,o=i.map(s=>{let{collectionAssignments:l,participantId:u}=s,c=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((s,l)=>a(s.substitutionOrder)-a(l.substitutionOrder));for(let s of o){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=s;r.includes(l)||(u&&n.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),r=r.filter(d=>d!==u),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function ns({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:ve};if(!Array.isArray(i)||i.length>2)return{error:ya};if(!i.length)return te({result:{error:Zc},stack:r});t=t??(e==null?void 0:e.participants)??[];let n=t.filter(s=>s.participantType===ft&&ji(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),a=n[0];if(!a)return te({result:{error:Wi},stack:r});let o=Ne(n.slice(1),!1,!0);return{participant:Ne(a),duplicatedPairParticipants:o,...Z}}function Qd({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:$e};if(typeof e!="string")return{error:hr};let{extension:i}=vt({element:t,name:ku});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function U0e({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:m})=>{var h,f,g,v;let{assignedParticipantIds:y,substitutions:I}=l0({collectionPosition:i,collectionId:o,lineUp:p});if(l===ei){if((y==null?void 0:y.length)<=2){let b=(f=(h=n==null?void 0:n[y[0]])==null?void 0:h.pairIdMap)==null?void 0:f[y[1]],S=(v=b&&((g=n[b])==null?void 0:g.participant)||ns({participantIds:y,tournamentParticipants:t}).participant)==null?void 0:v.participantId;return{[d]:{participantId:S,teamParticipant:m,substitutions:I}}}else if((y==null?void 0:y.length)>2)return{[d]:{teamParticipant:m,substitutions:I}}}else{let b=y==null?void 0:y[0];return b&&{[d]:{participantId:b,teamParticipant:m,substitutions:I}}}};if(!(r!=null&&r.length)){let d=(s==null?void 0:s.map(p=>{var m;let{teamParticipant:h,sideNumber:f}=p,g=p.lineUp||((m=Qd({participantId:h.teamParticipantId,drawDefinition:a}))==null?void 0:m.lineUp);return u({attribute:f,lineUp:g,teamParticipant:h})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=(r==null?void 0:r.map(d=>{var p,m,h;let f=(p=e.find(I=>I.drawPosition===d))==null?void 0:p.participantId,g=s==null?void 0:s.find(I=>(I==null?void 0:I.drawPosition)===d),v=(g==null?void 0:g.teamParticipant)||f&&((m=n==null?void 0:n[f])==null?void 0:m.participant)||(t==null?void 0:t.find(({participantId:I})=>I===f)),y=(g==null?void 0:g.lineUp)||((h=Qd({participantId:f,drawDefinition:a}))==null?void 0:h.lineUp);return u({attribute:d,lineUp:y,teamParticipant:v})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function YP(t){var e,i,r;let n=We(t,[{[Ql]:!0}]);if(n.error)return n;let a=t==null?void 0:t.matchUp,o=a==null?void 0:a.matchUpType;if(!o&&(e=a==null?void 0:a.sides)!=null&&e.length){let s=(r=(i=a.sides.find(({participant:l})=>l))==null?void 0:i.participant)==null?void 0:r.participantType;o=s===Dt&&ii||s===ft&&ei||s===Xt&&Xt||void 0}return{matchUpType:o}}function S0e({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:o,sideNumber:s}){var l,u,c,d;let p=i.find(v=>v.drawPosition&&v.drawPosition===a),m=a&&t,h=s&&e,f=m?(l=m[a])==null?void 0:l.participantId:p==null?void 0:p.participantId,g=p?T0e({displaySideNumber:r,seedAssignments:n,participantId:f,assignment:p,sideNumber:s}):{...h==null?void 0:h[s]};if(o&&(s===1?Object.assign(g,{participantFed:!0}):Object.assign(g,{participantAdvanced:!0})),a&&m){let v=(u=m[a])==null?void 0:u.teamParticipant,y=(c=m[a])==null?void 0:c.participant,I=(d=m[a])==null?void 0:d.substitutions;y&&(g.participant=y),I&&(g.substitutions=I),v&&(g.teamParticipant=v)}return g}function T0e({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let o=D0e({seedAssignments:e,participantId:i});Object.assign(a,o,{participantId:i}),o!=null&&o.seedNumber&&(o==null?void 0:o.seedValue)===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function D0e({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}function XX({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:o,initialRoundOfPlay:s,additionalContext:l,roundNamingProfile:u,tournamentRecord:c,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:m,seedAssignments:h,usePublishState:f,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:I,drawDefinition:b,publishStatus:S,scoringActive:w,matchUpTieId:U,isRoundRobin:T,roundProfile:D,sideLineUps:P,structure:C,context:R,matchUp:N,event:A}){var M,E,O,k,x,F,$,_,L,B,V,G,j,z,q;l=l??{};let W=(M=In({drawDefinition:b,structure:C,matchUp:N,event:A}))==null?void 0:M.tieFormat,{roundOffset:Y,structureId:re,structureName:K,stage:H,stageSequence:Q}=C,{drawId:X,drawName:ie,drawType:ae}=b??{},le=W==null?void 0:W.collectionDefinitions,ne=N.collectionId&&(le==null?void 0:le.find(be=>be.collectionId===N.collectionId)),de=N.collectionId?ne==null?void 0:ne.matchUpFormat:N.matchUpFormat??(C==null?void 0:C.matchUpFormat)??(b==null?void 0:b.matchUpFormat)??(A==null?void 0:A.matchUpFormat),Ie=N.matchUpType||(ne==null?void 0:ne.matchUpType)||(C==null?void 0:C.matchUpType)||(b==null?void 0:b.matchUpType)||!Xi(ur)(A==null?void 0:A.eventType)&&(A==null?void 0:A.eventType),ce=m?jt:N.matchUpStatus,{schedule:ke,endDate:Pe}=qP({scheduleVisibilityFilters:t,afterRecoveryTimes:o,tournamentRecord:c,usePublishState:f,scheduleTiming:y,drawDefinition:b,matchUpFormat:de,publishStatus:S,matchUpType:Ie,matchUp:N,event:A}),it=d??N.drawPositions??[],{collectionPosition:It,collectionId:me,roundPosition:fe}=N,pe=N.roundNumber??l.roundNumber,Fe=me?U0e({tournamentParticipants:i,positionAssignments:r,collectionPosition:It,participantMap:g,drawDefinition:b,drawPositions:it,collectionId:me,sideLineUps:P,matchUpType:Ie}):void 0,De=((E=u==null?void 0:u[pe])==null?void 0:E.roundName)||l.roundName,je=((O=u==null?void 0:u[pe])==null?void 0:O.abbreviatedRoundName)||l.abbreviatedRoundName,ue=(k=D==null?void 0:D[pe])==null?void 0:k.feedRound,he=(x=D==null?void 0:D[pe])==null?void 0:x.preFeedRound,Re=(F=D==null?void 0:D[pe])==null?void 0:F.roundFactor,xe=n==null?void 0:n[pe],Ce=fe?xe==null?void 0:xe[fe]:void 0,we=e==null?void 0:e[pe],Ue=ne!=null&&ne.category?{...(R==null?void 0:R.category)||{},...ne.category}:(R==null?void 0:R.category)??(A==null?void 0:A.category),wt=(($=N.processCodes)==null?void 0:$.length)&&N.processCodes||((_=ne==null?void 0:ne.processCodes)==null?void 0:_.length)&&(ne==null?void 0:ne.processCodes)||((L=C==null?void 0:C.processCodes)==null?void 0:L.length)&&(C==null?void 0:C.processCodes)||((B=b==null?void 0:b.processCodes)==null?void 0:B.length)&&(b==null?void 0:b.processCodes)||((V=A==null?void 0:A.processCodes)==null?void 0:V.length)&&(A==null?void 0:A.processCodes)||(c==null?void 0:c.processCodes),Le=(I==null?void 0:I.withCompetitiveness)&&yw({...v,matchUp:N}),rt=N.finishingPositionRange??l.finishingPositionRange,Ci=be=>He(be,void 0,!0),Be={...Ci(R),...Ci({matchUpFormat:N.matchUpType===ur?void 0:de,tieFormat:N.matchUpType!==ur?void 0:W,gender:(ne==null?void 0:ne.gender)??(A==null?void 0:A.gender),roundOfPlay:H!==Ke&&st(s)&&s+(pe||0),endDate:N.endDate??Pe,discipline:A==null?void 0:A.discipline,category:Ue,finishingPositionRange:rt,abbreviatedRoundName:je,drawPositionsRange:Ce,competitiveProfile:Le,structureName:K,stageSequence:Q,drawPositions:it,matchUpStatus:ce,processCodes:wt,isRoundRobin:T,matchUpTieId:U,preFeedRound:he,matchUpType:Ie,roundFactor:Re,roundOffset:Y,structureId:re,roundNumber:pe,feedRound:ue,roundName:De,drawName:ie,drawType:ae,schedule:ke,drawId:X,stage:H}),...Ne(Ci(N),!0,!0)};if(de&&(G=N.score)!=null&&G.scoreStringSide1){let be=Ln(de),{bestOf:Et,finalSetFormat:Ee,setFormat:qe}=be??{};(Ee!=null&&Ee.tiebreakSet||qe!=null&&qe.tiebreakSet||qe!=null&&qe.timed)&&(Be.score.sets=Be.score.sets.sort((Ot,ci)=>Ot.setNumber-ci.setNumber).map((Ot,ci)=>(ci+1===Et?(Ee!=null&&Ee.tiebreakSet||Ee!=null&&Ee.timed)&&(Ot.tiebreakSet=!0):(qe!=null&&qe.tiebreakSet||qe!=null&&qe.timed)&&(Ot.tiebreakSet=!0),Ot)))}if(Array.isArray(it)){let{orderedDrawPositions:be,displayOrder:Et}=w0e({drawPositions:it,roundProfile:D,roundNumber:pe}),Ee=(j=D==null?void 0:D[pe])==null?void 0:j.feedRound,qe=Et[0]!==be[0],Ot=be.concat(void 0,void 0).slice(0,2).map((ci,yi)=>{var xi;let di=yi+1,gn=qe?3-di:di,zr=S0e({...Fe,positionAssignments:r,displaySideNumber:gn,seedAssignments:h,drawPosition:ci,isFeedRound:Ee,sideNumber:di}),iu=(xi=N.sides)==null?void 0:xi.find(aC=>aC.sideNumber===di),sU=fe?(fe-1)*2+yi+1:void 0,lU=sU?we==null?void 0:we[sU]:void 0;return Ci({sourceDrawPositionRange:lU,...iu,...zr})});Object.assign(Be,Ne({sides:Ot},!0,!0))}if(i&&Be.sides&&a!==!1){let be=p==null?void 0:p[hv],Et=Ee=>{var qe;let Ot=(qe=g==null?void 0:g[Ee])==null?void 0:qe.participant;return Ot&&Nm({template:be==null?void 0:be.participant,source:Ot})};if(Be.sides.filter(Boolean).forEach(Ee=>{var qe,Ot,ci,yi;if(Ee.participantId){let xi=Ne(Et(Ee.participantId)||(i?Ac({policyDefinitions:p,participantId:Ee.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:I}):void 0),void 0,!0);if(xi){if(b!=null&&b.entries){let di=b.entries.find(zr=>zr.participantId===Ee.participantId),gn=(qe=A==null?void 0:A.entries)==null?void 0:qe.find(zr=>zr.participantId===Ee.participantId);xi.entryStatus=(di==null?void 0:di.entryStatus)||(gn==null?void 0:gn.entryStatus),di!=null&&di.entryStage&&(xi.entryStage=di.entryStage)}Object.assign(Ee,{participant:xi})}}if((ci=(Ot=Ee==null?void 0:Ee.participant)==null?void 0:Ot.individualParticipantIds)!=null&&ci.length&&!((yi=Ee.participant.individualParticipants)!=null&&yi.length)){let xi=Ee.participant.individualParticipantIds.map(di=>Et(di)||(i?Ac({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:I,participantId:di}):void 0));Object.assign(Ee.participant,{individualParticipants:xi})}}),!Be.matchUpType){let{matchUpType:Ee}=YP({matchUp:Be});Ee&&Object.assign(Be,{matchUpType:Ee})}if(I!=null&&I.inferGender&&(!Be.gender||Be.gender===jn)&&((z=Be.sides)==null?void 0:z.length)===2&&Be.matchUpType!==ur){let Ee=Be.sides.map(qe=>{var Ot,ci,yi,xi;if(Xi(ii)(Be.matchUpType))return(ci=(Ot=qe.participant)==null?void 0:Ot.person)==null?void 0:ci.sex;if(((xi=(yi=qe.participant)==null?void 0:yi.individualParticipants)==null?void 0:xi.length)===2){let di=dt(qe.participant.individualParticipants.map(gn=>{var zr;return(zr=gn.person)==null?void 0:zr.sex})).filter(Boolean);if(di.length===1)return di[0]}});if(Ee.filter(Boolean).length===2&&dt(Ee).length===1){let qe=Ee[0];Be.inferredGender=qe}}}if(Be.tieMatchUps){let be=Be.matchUpStatus===jt,Et=(q=Be.sides)==null?void 0:q.map(({participant:Ee,drawPosition:qe,sideNumber:Ot,lineUp:ci})=>{let yi=(Ee==null?void 0:Ee.participantType)===ur&&Ee;return{teamParticipant:yi&&He({participantRoleResponsibilities:yi.participantRoleResponsibilities,participantOtherName:yi.participanOthertName,participantName:yi.participantName,participantId:yi.participantId,teamId:yi.teamId}),drawPosition:qe,sideNumber:Ot,lineUp:ci}});Be.tieMatchUps=Be.tieMatchUps.map(Ee=>{let qe=Be.matchUpId,Ot={finishingPositionRange:Be.finishingPositionRange,abbreviatedRoundName:je,roundNumber:pe,roundName:De};return XX({tieDrawPositions:it,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:Et,drawPositionsRanges:n,initialRoundOfPlay:s,roundNamingProfile:u,additionalContext:Ot,appliedPolicies:p,isCollectionBye:be,usePublishState:f,publishStatus:S,matchUpTieId:qe,isRoundRobin:T,roundProfile:D,matchUp:Ee,event:A,tournamentParticipants:i,positionAssignments:r,tournamentRecord:c,seedAssignments:h,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:I,drawDefinition:b,scoringActive:w,structure:C,context:R})})}let nt=Be.sides&&Be.sides.filter(be=>be==null?void 0:be.participantId).length===2,Ii=!Be.winningSide;if(Object.assign(Be,{readyToScore:w&&nt&&Ii,hasContext:!0}),nt){let{allParticipantsCheckedIn:be,checkedInParticipantIds:Et}=Mh({matchUp:Be});Object.assign(Be,{allParticipantsCheckedIn:be,checkedInParticipantIds:Et})}return Array.isArray(I==null?void 0:I.exclude)&&(I==null||I.exclude.forEach(be=>delete Be[be])),Be}function P0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Mp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Kl});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:Ne(r,!1,!0)}:e}function R0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Mp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Lc});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function C0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Mp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Rh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function cu(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:o,matchUpFormats:s,roundPositions:l,matchUpFormat:u,collectionIds:c,isMatchUpTie:d,roundNumbers:p,matchUpIds:m,roundNames:h,filterMatchUpTypes:f=!0,filterMatchUpIds:g=!0,stageSequences:v,scheduledDates:y,scheduledDate:I,participantIds:b,processContext:S,tournamentIds:w,matchUpTypes:U,structureIds:T,readyToScore:D,courtIds:P,eventIds:C,venueIds:R,drawIds:N,stages:A}=t,M=Array.isArray(b)?b.filter(Boolean):[],E=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],k=Array.isArray(A)?A.filter(Boolean):[],x=Array.isArray(v)?v.filter(Boolean):[],F=Array.isArray(c)?c.filter(Boolean):[],$=Array.isArray(h)?h.filter(Boolean):[],_=Array.isArray(p)?p.filter(Boolean):[],L=Array.isArray(l)?l.filter(Boolean):[],B=Array.isArray(m)&&g?m.filter(Boolean):[],V=Array.isArray(U)&&f?U.filter(Boolean):[],G=Array.isArray(P)?P.filter(Boolean):[],j=Array.isArray(R)?R.filter(Boolean):[],z=Array.isArray(s)&&s.filter(Boolean)||typeof u=="string"&&[u]||[],q=Array.isArray(y)&&y.filter(Boolean)||typeof I=="string"&&I.length&&[I]||[],W=Array.isArray(w)?w.filter(Boolean):[],Y=Array.isArray(C)?C.filter(Boolean):[],re=Array.isArray(N)?N.filter(Boolean):[],K=Array.isArray(T)?T.filter(Boolean):[];return e.filter(H=>{var Q;if(D&&!Xi(Ba)(H)&&!H.readyToScore||H.winningSide&&o&&![1,2].includes(H.winningSide)||d!==void 0&&(d&&!H.tieMatchUps||!d&&H.tieMatchUps)||n!==void 0&&(n&&!H.collectionId||!n&&H.collectionId)||k.length&&!k.includes(H.stage)||x.length&&!x.includes(H.stageSequence)||F.length&&(!H.collectionId||!F.includes(H.collectionId))||$.length&&(!H.roundName||!$.includes(H.roundName))||_.length&&(!H.roundNumber||!_.includes(H.roundNumber))||L.length&&(!H.roundPosition||!L.includes(H.roundPosition))||E.length&&(!H.matchUpStatus||!E.includes(H.matchUpStatus))||O.length&&H.matchUpStatus&&O.includes(H.matchUpStatus)||B.length&&!B.includes(H.matchUpId)||V.length&&(!H.matchUpType||!eP(V,H.matchUpType))||z.length&&(!H.matchUpFormat||!z.includes(H.matchUpFormat)))return!1;if(q!=null&&q.length){let{scheduledTime:X}=KX({matchUp:H}),{scheduledDate:ie}=Nh({matchUp:H}),ae=mt(X)||ie;if(!q.find(le=>Hl(le,ae)))return!1}if(G.length){let{courtId:X}=R0e({matchUp:H}),{allocatedCourts:ie}=P0e({matchUp:H}),ae=ie==null?void 0:ie.map(({courtId:le})=>le);if(!G.filter(Boolean).includes(X)||ae!=null&&ae.includes(X))return!1}if(j.length){let{venueId:X}=C0e({matchUp:H});if(!j.filter(Boolean).includes(X))return!1}if(S){if(W.length&&!W.includes(H.tournamentId)||Y.length&&!Y.includes(H.eventId)||re.length&&!re.includes(H.drawId)||K.length&&!K.includes(H.structureId))return!1;let X=((Q=H.sides)==null?void 0:Q.map(({participantId:ie})=>ie).filter(Boolean))??[];if(r&&X.length<r||M.length&&!M.some(ie=>X.includes(ie)))return!1}return!0})}function qt(t){var e,i,r,n,a,o,s;let{provisionalPositioning:l,tournamentRecord:u,contextFilters:c,matchUpFilters:d,contextProfile:p,drawDefinition:m,context:h={},structure:f,inContext:g,event:v}=t,{seedAssignments:y,contextContent:I,exitProfiles:b,matchUpsMap:S}=t,w={},U={};if(!f)return{collectionPositionMatchUps:w,error:Up,roundMatchUps:U,matchUps:[]};let T=Array.isArray(d==null?void 0:d.eventIds)?d==null?void 0:d.eventIds.filter(Boolean):[],D=Array.isArray(d==null?void 0:d.structureIds)?d==null?void 0:d.structureIds.filter(Boolean):[],P=Array.isArray(d==null?void 0:d.drawIds)?d==null?void 0:d.drawIds.filter(Boolean):[],C=!(h!=null&&h.eventId)||!(T!=null&&T.length)&&!((e=c==null?void 0:c.eventIds)!=null&&e.filter(Boolean).length)||(T==null?void 0:T.includes(h.eventId))||((i=c==null?void 0:c.eventIds)==null?void 0:i.includes(h.eventId)),R=!(D!=null&&D.length)||D.includes(f.structureId),N=!m||!(P!=null&&P.length)||P.includes(m.drawId);if(!C||!R||!N)return{collectionPositionMatchUps:w,roundMatchUps:U,matchUps:[]};p&&!I&&(I=ec({tournamentRecord:u,contextProfile:p,drawDefinition:m}));let{appliedPolicies:A}=Bt({drawDefinition:m}),M={...t.tournamentAppliedPolicies,...A,...t.policyDefinitions},E=(r=M==null?void 0:M.scoring)==null?void 0:r.structures,O=f.stage&&((n=E==null?void 0:E.stage)==null?void 0:n[f.stage]),k=f.stageSequence&&((a=O==null?void 0:O.stageSequence)==null?void 0:a[f.stageSequence]),x=((o=M==null?void 0:M.scoring)==null?void 0:o.requireAllPositionsAssigned)||(O==null?void 0:O.requireAllPositionsAssigned)||(k==null?void 0:k.requireAllPositionsAssigned);S||(S=ln({drawDefinition:m,structure:f}));let{positionAssignments:F,allPositionsAssigned:$}=Er({structure:f}),_=!x||$,{seedAssignments:L}=go({provisionalPositioning:l,drawDefinition:m,structure:f});y=y??L;let{structureId:B}=f;b=b||m&&AX({drawDefinition:m}).exitProfiles;let V=b==null?void 0:b[B],G=(V==null?void 0:V.length)&&(V[0].split("-").map(K=>parseInt(K)).reduce((K,H)=>K+H)||0),j=!!f.structures,z=Zd({matchUpsMap:S,structureId:B,inContext:g}),q=M==null?void 0:M[og],W=ZSe({roundNamingPolicy:q,drawDefinition:m,structure:f,matchUps:z}),{roundNamingProfile:Y,roundProfile:re}=W;if(U=(W==null?void 0:W.roundMatchUps)??[],d&&(z=cu({matchUps:z,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),g){let{sourceDrawPositionRanges:K}=KSe({drawDefinition:m,matchUpsMap:S,structureId:B}),H=m?XSe({drawDefinition:m,roundProfile:re,matchUpsMap:S,structureId:B}).drawPositionsRanges:void 0;z=z.map(Q=>XX({tournamentParticipants:t.tournamentParticipants??(u==null?void 0:u.participants),scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,participantMap:t.participantMap,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:K,positionAssignments:F,drawPositionsRanges:H,initialRoundOfPlay:G,roundNamingProfile:Y,tournamentRecord:u,appliedPolicies:M,seedAssignments:y,contextContent:I,contextProfile:p,drawDefinition:m,scoringActive:_,isRoundRobin:j,roundProfile:re,structure:f,context:h,matchUp:Q,event:v})),(z==null?void 0:z.filter(Q=>Array.isArray(Q.tieMatchUps))).forEach(Q=>{let X=Q.tieMatchUps;z=z.concat(...X)}),c&&(z=cu({processContext:!0,...c,matchUps:z}))}else(z==null?void 0:z.filter(K=>Array.isArray(K.tieMatchUps))).forEach(K=>{let H=K.tieMatchUps;z=z.concat(...H)});return d&&(z=cu({matchUps:z,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(z=cu({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:z})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||g)&&(U=An({matchUps:z}).roundMatchUps??[]),(s=In({drawDefinition:m,structure:f,event:v}))!=null&&s.tieFormat&&({collectionPositionMatchUps:w}=YSe({matchUps:z})),{collectionPositionMatchUps:w,roundMatchUps:U,isRoundRobin:j,roundProfile:re,matchUpsMap:S,matchUps:z}}function Cd({matchUp:t}){return t?Ir.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function KP({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:m,publishStatus:h,contextProfile:f,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structureId:I,inContext:b,structure:S,context:w,event:U}){!S&&I&&({structure:S}=tt({drawDefinition:g,structureId:I}));let T=qt({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:m,publishStatus:h,contextProfile:f,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structure:S,inContext:b,context:w,event:U}),D=[],P=[],C=[],R=[],N=[];if(T.error)return T;let{matchUps:A}=T,{assignedPositions:M}=Er({structure:S}),E=M==null?void 0:M.filter(k=>k.participantId).map(k=>k.drawPosition),O;return A.filter(k=>{var x;let F=((x=u==null?void 0:u.matchUpTypes)==null?void 0:x.length)===1&&u.matchUpTypes[0]===fi;return!(k.matchUpType!==fi&&F)}).forEach(k=>{var x,F,$,_;if(k.matchUpStatus===ua){D.push(k);return}k.matchUpType===fi&&(O=!0);let L=k.collectionId,B=L&&((x=k.sides)==null?void 0:x.every(W=>W.participantId)),V=!L&&((F=k.drawPositions)==null?void 0:F.filter(Boolean).length)===2,G=!L&&(($=k.drawPositions)==null?void 0:$.every(W=>E==null?void 0:E.includes(W))),j=M==null?void 0:M.filter(W=>W.bye).map(W=>W.drawPosition),z=!L&&((_=k.drawPositions)==null?void 0:_.find(W=>j==null?void 0:j.includes(W))),q=pX.includes(k.matchUpStatus)&&(B||V&&(!t||G));return z?N.push(k):Cd({matchUp:k})?P.push(k):q?C.push(k):R.push(k)}),{includesTeamMatchUps:O,abandonedMatchUps:D,completedMatchUps:P,upcomingMatchUps:C,pendingMatchUps:R,byeMatchUps:N,structure:S}}function E0e({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:$e};if(!i)return{error:Xa};let{links:r}=Iv({drawDefinition:t,structureId:i}),n=r.source.reduce((o,s)=>!s.source.roundNumber||s.source.roundNumber===e?o.concat(s):o,[]),a=r.target.reduce((o,s)=>!s.target.roundNumber||s.target.roundNumber===e?o.concat(s):o,[]);return{links:{source:n,target:a}}}function _C({finishingPositions:t,linkCondition:e,linkType:i,source:r}){var n;let a=r.find(o=>{var s,l;let u=!((s=o.source)!=null&&s.finishingPositions)||!t||Nn(t,(l=o.source)==null?void 0:l.finishingPositions);return e===o.linkCondition&&u&&o.linkType===i});return[Au,zl].includes(a==null?void 0:a.linkType)&&!((n=a==null?void 0:a.source)!=null&&n.roundNumber)?te({result:{error:se},stack:"getTargetLink",context:a}):a}function Iv({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>{var a,o;return((a=n.source)==null?void 0:a.structureId)===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),((o=n.target)==null?void 0:o.structureId)===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r},{source:[],target:[]})}:{error:Xa}:{error:$e}}function M0e({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(o=>o.roundNumber===i&&!o.matchUpTieId),a=t.filter(o=>o.roundNumber===i+1&&!o.matchUpTieId);if(a.length){let o;return a.length===n.length?o=a.find(s=>s.roundPosition===r):a.length===n.length/2&&(o=a.find(s=>s.roundPosition===Math.ceil(r/2))),{matchUp:o}}return{message:"no progression found"}}function $C({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){var a;if(!n)return{error:Gx};let{target:{structureId:o,feedProfile:s,groupedOrder:l,roundNumber:u,positionInterleave:c}}=n,{structure:d}=tt({drawDefinition:r,structureId:o}),{positionAssignments:p}=oi({structure:d}),m=(e==null?void 0:e.filter(P=>P.structureId===(d==null?void 0:d.structureId))).filter(P=>P.roundNumber===u&&!P.matchUpTieId),h=m.length,f=Te(1,h+1),g=h/t,v=Math.ceil(g*i),y=1-i%2;if(c!=null&&c.interleave&&g!==.5){let P=c.offset+(i-1)*c.interleave,C=i+P;v=Math.ceil(C/2),y=1-C%2}let I=f,b=f[v-1],S=NX({roundPositionsCount:f.length,groupedOrder:l}),w=(S==null?void 0:S.length)||1;if(w<=f.length){let P=h/w,C=Cr(f,P);s===Yd&&C.forEach(R=>R.reverse()),I=(S==null?void 0:S.length)&&(S==null?void 0:S.map(R=>C[R-1]).flat())||I}s===_o?b=I[v-1]:s===Yd?((!(S!=null&&S.length)||w>f.length)&&(v=m.length+1-v),b=I[v-1]):s===SP&&ja()&&console.log(pP,{feedProfile:s});let U=b&&m.reduce((P,C)=>C.roundPosition===b?C:P,void 0),T;U!=null&&U.feedRound?(y=0,T=Math.min(...(U.drawPositions||[]).filter(Boolean))):T=((a=U==null?void 0:U.drawPositions)==null?void 0:a.length)===2&&(U==null?void 0:U.drawPositions[y]);let D=p==null?void 0:p.find(({drawPosition:P})=>P===T);if(D){let{extension:P}=vt({element:D,name:kP});if(P!=null&&P.value)return{disabledDrawPosition:T}}return{matchUp:U,targetDrawPosition:T,matchUpDrawPositionIndex:y}}function On({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(s=>s.matchUpId===n));let{structure:o}=tt({structureId:a==null?void 0:a.structureId,drawDefinition:r});return(o==null?void 0:o.finishingPosition)===Uh?N0e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:o,matchUp:a}):A0e({matchUp:a})}function N0e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){var a,o,s;let{winnerMatchUpId:l,loserMatchUpId:u}=n,{links:c}=E0e({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),d=c==null?void 0:c.source,p=_C({source:d,linkType:Au}),m=_C({linkCondition:sl,linkType:zl,source:d}),h=_C({source:d,linkType:zl}),f=m&&h;h||(h=m);let g=(a=p==null?void 0:p.target)==null?void 0:a.feedProfile,v=(o=h==null?void 0:h.target)==null?void 0:o.feedProfile,y=(s=m==null?void 0:m.target)==null?void 0:s.feedProfile,I,b,S,w,U,T,D,P,C,R;if(e&&(l||u)&&(D=l&&g!==fs&&t.find(({matchUpId:M})=>M===l),w=u&&v!==fs&&t.find(({matchUpId:M})=>M===u),D||w))return{matchUp:n,targetLinks:{loserTargetLink:h,winnerTargetLink:p},targetMatchUps:{loserMatchUp:w,winnerMatchUp:D}};let{roundPosition:N}=n;R=R||t.filter(M=>M.structureId===r.structureId);let A=R.reduce((M,E)=>E.roundNumber===n.roundNumber&&!E.matchUpTieId?M+1:M,0);return h&&!w&&v!==fs&&({matchUpDrawPositionIndex:T,targetDrawPosition:U,matchUp:w}=$C({targetLink:h,sourceRoundMatchUpCount:A,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),f&&y!==fs&&({matchUpDrawPositionIndex:S,targetDrawPosition:b,matchUp:I}=$C({targetLink:m,sourceRoundMatchUpCount:A,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),p&&!D&&g!==fs&&({matchUpDrawPositionIndex:C,targetDrawPosition:P,matchUp:D}=$C({targetLink:p,sourceRoundMatchUpCount:A,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),D||(R=R||t.filter(M=>M.structureId===r.structureId),{matchUp:D}=M0e({structureMatchUps:R,matchUp:n})),He({matchUp:n,targetLinks:{loserTargetLink:h,winnerTargetLink:p,byeTargetLink:m},targetMatchUps:{winnerMatchUpDrawPositionIndex:C,loserMatchUpDrawPositionIndex:T,byeMatchUpDrawPositionIndex:S,winnerTargetDrawPosition:P,loserTargetDrawPosition:U,byeTargetDrawPosition:b,winnerMatchUp:D,loserMatchUp:w,byeMatchUp:I},targetMatchUpIds:!!(l||u)})}function A0e({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function O0e({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{var n,a,o,s,l,u;let{matchUpId:c,structureId:d,drawPositions:p=[]}=r,{structure:m}=tt({drawDefinition:t,structureId:d});if((m==null?void 0:m.finishingPosition)===Kd){let{roundNumber:h}=r,f=h&&Qe(h)+1,g=m.matchUps??[],{roundMatchUps:v}=An({matchUps:g});if(f&&v!=null&&v[f]){let y=[...p].sort(lr).map((I,b)=>{let S=v[f].find(w=>{var U;return(U=w.drawPositions)==null?void 0:U.includes(I)});return{matchUpId:S==null?void 0:S.matchUpId,roundNumber:f,schedule:S==null?void 0:S.schedule,sideNumber:b+1,structureName:m.structureName}});Object.assign(r,{sidesTo:y})}}else{let h=On({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:c}),{winnerMatchUp:f}=h.targetMatchUps,{loserMatchUp:g}=h.targetMatchUps;!r.winnerMatchUpId&&f&&(r.winnerMatchUpId=f.matchUpId),!r.loserMatchUpId&&g&&(r.loserMatchUpId=g.matchUpId);let v=BC({upcomingMatchUp:f}),y=BC({upcomingMatchUp:g});if(r.matchUpStatus!==jt&&(g==null?void 0:g.matchUpStatus)===jt){let{matchUp:b}=JX({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=b&&BC({upcomingMatchUp:b})||y}let I=(n=r.schedule)==null?void 0:n.timeAfterRecovery;if(I&&((a=v==null?void 0:v.schedule)!=null&&a.scheduledTime&&xt(v.schedule.scheduledTime)<xt(I)&&(i[v.matchUpId]=r.matchUpId,v.schedule.scheduleConflict=r.matchUpId),(o=y==null?void 0:y.schedule)!=null&&o.scheduledTime&&xt(y.schedule.scheduledTime)<xt(I)&&(i[y.matchUpId]=r.matchUpId,y.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:v,loserTo:y}),(s=r.drawPositions)==null?void 0:s.filter(Boolean).length){let b=((u=(l=h.targetLinks)==null?void 0:l.loserTargetLink)==null?void 0:u.linkCondition)===sl,S=k0e(r);if(S.length){let w=mM(f==null?void 0:f.sides),U=mM(g==null?void 0:g.sides),T=S.find(({participantId:P})=>w.includes(P))?[]:S,D=S.find(({participantId:P})=>U.includes(P))?[]:S;g&&b&&D.length<2&&D.push({bye:!0,tbd:!0}),T!=null&&T.length&&f&&(!h.targetMatchUpIds&&f&&(f=e.find(({matchUpId:P})=>P===f.matchUpId)),f.potentialParticipants||(f.potentialParticipants=[]),f.potentialParticipants.push(T)),D!=null&&D.length&&g&&(h.targetMatchUpIds||(f=e.find(({matchUpId:P})=>P===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(D))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function k0e(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:r,qualifier:n})=>i||r&&{participantId:r}||n&&{qualifier:n}).filter(Boolean))||[]}function JX({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var r;let{matchUpId:n,matchUpStatus:a,structureId:o}=t||{};if(!t||!o||(t==null?void 0:t.matchUpStatus)===Zi)return{matchUp:t};if(a===jt){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((r=On({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:n}))==null?void 0:r.targetMatchUps)||{},JX({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function BC(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o}))(t.upcomingMatchUp)}function fr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=yv(t);if(i.error)return te({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:o,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...o??[],...s??[]),matchUpsMap:l}}function yv(t){if(!(t!=null&&t.drawDefinition))return{error:$e};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:m,scheduleTiming:h,participantMap:f,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:I,inContext:b,context:S,event:w}=t,U=[],T=[],D=[],P=[],C=[];v&&!i&&(i=ec({policyDefinitions:u,tournamentRecord:c,contextProfile:v,event:w}));let R;!(e!=null&&e.length)&&c&&(e=c==null?void 0:c.participants,(b||s!=null&&s.withGroupings)&&e!=null&&e.length&&({participantsWithGroupings:e,groupInfo:R}=oL({participants:e,participantsProfile:s})));let{structures:N}=rs({drawDefinition:y});if(!N)return{error:Ni};r||(r=ln({drawDefinition:y}));let A=y&&AX({drawDefinition:y}).exitProfiles;N.forEach(O=>{let{byeMatchUps:k=[],pendingMatchUps:x=[],upcomingMatchUps:F=[],completedMatchUps:$=[],abandonedMatchUps:_=[]}=KP({matchUpFilters:I?void 0:m,contextFilters:I?void 0:p,inContext:b||I||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:f,scheduleTiming:h,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:A,matchUpsMap:r,structure:O,context:S,event:w});U=U.concat(..._),T=T.concat(...$),D=D.concat(...F),P=P.concat(...x),C=C.concat(...k)});let M=O=>(!m&&!I&&!p||(m&&(O=cu({matchUps:O,...m})),p&&(O=cu({matchUps:O,...p,processContext:!0}))),O),E={abandonedMatchUps:M(U),completedMatchUps:M(T),upcomingMatchUps:M(D),pendingMatchUps:M(P),byeMatchUps:M(C),matchUpsMap:r,...Z,groupInfo:R};if(I){let O=typeof I=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:k,completed:x,upcoming:F,pending:$,bye:_}=O,L=[].concat(...k&&U||[],...x&&T||[],...F&&D||[],...$&&P||[],..._&&C||[]);O0e({inContextDrawMatchUps:L,drawDefinition:y})}return E}function tu(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextFilters:d,contextProfile:p,matchUpFilters:m,nextMatchUps:h,inContext:f,context:g,event:v}=t;if(!v)return{error:vi};let{eventId:y,eventName:I,endDate:b,eventType:S,category:w,gender:U,matchUpFormat:T}=v??{},D={...g,...He({indoorOutDoor:v.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),surfaceCategory:v.surfaceCategory??(c==null?void 0:c.surfaceCategory),endDate:v.endDate??(c==null?void 0:c.endDate),tournamentId:c==null?void 0:c.tournamentId,matchUpFormat:T,eventName:I,eventType:S,category:w,eventId:y,gender:U})};b&&(D.endDate=b),p&&!i&&(i=ec({policyDefinitions:l,tournamentRecord:c,contextProfile:p,event:v}));let P;if(!(e!=null&&e.length)&&!r&&c){let N=Dh({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:p,inContext:f});r=N.participantMap,e=N.participants??[],P=N.groupInfo}let C=v.drawDefinitions??[],R=dw({tournamentRecord:c,event:v}).scheduleTiming;return{matchUps:C.flatMap(N=>{let{matchUps:A}=fr({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:D,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,contextFilters:d,contextProfile:p,drawDefinition:N,contextContent:i,matchUpFilters:m,participantMap:r,scheduleTiming:R,nextMatchUps:h,inContext:f,event:v});return A??[]}),groupInfo:P}}function Gr(t){let e=We(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:ve};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,contextProfile:d,matchUpFilters:p,contextFilters:m,nextMatchUps:h,context:f}=t,g=t.tournamentId??u.tournamentId,v=(u==null?void 0:u.events)??[];r||({participants:r,participantMap:i}=Dh({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,contextProfile:d,inContext:c}));let{appliedPolicies:y}=Bt({tournamentRecord:u}),I={...f,tournamentId:g,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},b=ec({policyDefinitions:l,tournamentRecord:u,contextProfile:d});return{matchUps:v.flatMap(S=>{var w;return I.eventDrawsCount=((w=S.drawDefinitions)==null?void 0:w.length)??0,tu({context:I,scheduleVisibilityFilters:n,tournamentAppliedPolicies:y,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,contextContent:b,contextFilters:m,contextProfile:d,matchUpFilters:p,participantMap:i,nextMatchUps:h,participants:r,inContext:c,event:S}).matchUps??[]}).concat(...u.matchUps??[])}}function As({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof r!="object"||!Object.keys(r).length)return{error:ki};let u=Object.keys(r).map(c=>{let d=r[c];return Gr({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:d,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}).matchUps??[]}).flat();return{...Z,matchUps:u}}function Oh(t,e){return x0e(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function x0e(t,e){return(Mm[t==null?void 0:t.stage]||0)-(Mm[e==null?void 0:e.stage]||0)}function Pn(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:m,drawDefinition:h,nextMatchUps:f,inContext:g,context:v,event:y}=t,{eventId:I,eventName:b,endDate:S,eventType:w,category:U,gender:T,matchUpFormat:D}=y??{},P={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(c==null?void 0:c.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(c==null?void 0:c.indoorOutdoor),matchUpFormat:D,eventType:w,eventName:b,category:U,eventId:I,endDate:S,gender:T},C;return!(e!=null&&e.length)&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:C}=Dh({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:m,inContext:g})),m&&!r&&(r=ec({policyDefinitions:l,tournamentRecord:c,contextProfile:m,drawDefinition:h,event:y})),{...fr({context:P,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,drawDefinition:h,contextContent:r,contextFilters:p,contextProfile:m,matchUpFilters:d,participantMap:i,nextMatchUps:f,inContext:g,event:y}),groupInfo:C}}function om({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Ne(t),r=e.split("."),n=[],a;s({targetElement:i,attributes:r});let o={value:a};return n.length&&(o.values=n),o;function s({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,m]of u.entries())if(l!=null&&l[m]){let h=u.slice(p+1);h.length?Array.isArray(l[m])?l[m].forEach(f=>s({targetElement:f,attributes:h})):(l=l[m],d({targetElement:l,index:p})):(a||(a=l[m]),n.includes(l[m])||n.push(l[m]))}function d({targetElement:p,index:m}){if(p&&m===u.length-1&&["string","number"].includes(typeof p)){let h=c?p.slice(0,c):p;a?n.includes(h)||n.push(h):(a=h,n.push(h))}}}}var ZX=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(r=>{var n;return{[r]:(n=om({element:e,accessor:r}))==null?void 0:n.value}})||typeof t=="object"&&Object.keys(t).map(r=>{var n;return{[r]:(n=om({element:e,accessor:r}))==null?void 0:n.value}})||((i=typeof t=="string"&&om({element:e,accessor:t}))==null?void 0:i.value)},Ma=ZX;function Uw({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:o,fmlc:s}){var l;if(!Ro(a))return[];let{roundProfile:u,roundNumbers:c=[]}=An({interpolate:!0,matchUps:a});r=r??Math.max(...c,0);let d=n?r-n:0,p=d&&((l=u==null?void 0:u[r-d])==null?void 0:l.matchUpsCount),m=u&&Object.values(u).map(Ma("matchUpsCount")),h=(v,y)=>{let I=Math.min(...v);p&&y&&I===1&&(I=p);let b=Math.max(...v);return e&&b>e&&(b=e),[I,b]},f=u&&Object.assign({},...c.map(v=>{let y=(r??0)+1-v-d,I=u[v].matchUpsCount,b={finishingPositionRange:{},finishingRound:y},S=m==null?void 0:m.slice(v-1).reduce((N,A)=>N+(A||0),0),w=s&&v!==1,U=1+t+(w?i??0:0),T=1,D=Te(U,o?U+I*2:S+U+T),P=S+T-I,C=h(D.slice(P)),R=h(D.slice(0,P),!0);return b.finishingPositionRange={loser:C,winner:R},{[v]:b}})),g=ja({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&f[v.roundNumber];g&&!y&&console.log({roundFinishingData:f,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),a}function ep({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var r;if(!e)return{error:$e};let n={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=fr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((r=e==null?void 0:e.structures)==null?void 0:r.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];Uw({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:o,structureId:s}=a,l=On({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:o}),{winnerMatchUp:u,loserMatchUp:c}=l.targetMatchUps,d=u==null?void 0:u.matchUpId,p=c==null?void 0:c.matchUpId,m=Zd({matchUpsMap:i,structureId:s}).find(h=>h.matchUpId===o);if(m&&(d&&(n.winnerMatchUpIds[m.matchUpId]=d,Object.assign(m,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(n.loserMatchUpIds[m.matchUpId]=p,a.loserMatchUpId=p,m.loserMatchUpId=p,a.finishingPositionRange))){let h=c.finishingPositionRange&&[...a.finishingPositionRange.loser,...c.finishingPositionRange.loser],f=h&&[Math.min(...h),Math.max(...h)];a.finishingPositionRange.loser=f,m.finishingPositionRange.loser=f}}),{inContextDrawMatchUps:t,goesToMap:n}}function ds(t){var e;let i=To(t),r=t.matchUps??[],n=t.drawIds??[],{includeParticipantDependencies:a,tournamentRecord:o,drawDefinition:s}=t;if(!Array.isArray(r))return{error:Xu};if(!Array.isArray(n))return{error:xs};let l=(e=t.matchUpIds)!=null&&e.length?t.matchUpIds:r.map(I=>I.matchUpId);if(!Array.isArray(l))return{error:hh};let u={},c={},d={},p={};o&&!Object.keys(i).length&&(i={[o.tournamentId]:o});let m=Object.values(i),h=m.reduce((I,b)=>I.concat(b.events??[]).map(S=>(S.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:I})=>I===Nu),f=r;if(h.length){f=As({nextMatchUps:!0,tournamentRecords:i}).matchUps;let I=h.reduce((b,S)=>{var w,U;let T=(w=S.source)==null?void 0:w.structureId,D=(U=S.target)==null?void 0:U.structureId;return T&&D&&(d[D]=T),T&&!b.includes(T)&&b.push(T),b},[]);for(let b of I)u[b]=[];for(let b of f??[]){let S=b.containerStructureId||b.structureId;I.includes(S)&&u[S].push(b.matchUpId)}}let g=I=>{c[I]||(c[I]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},p[I]=[])},v=(I,b)=>{c[I].matchUpIds.forEach(S=>{c[b].matchUpIds.push(S)}),c[b].matchUpIds.push(I),c[I].dependentMatchUpIds.push(b),a&&c[I].participantIds.forEach(S=>c[b].participantIds.push(S))},y=I=>{let b=Object.keys(u).length;for(let S of I||[]){let{matchUpId:w,winnerMatchUpId:U,loserMatchUpId:T}=S;if(!l.length||l.includes(w)){if(g(w),a){let{individualParticipantIds:C}=BP(S);c[w].participantIds=C}U&&(g(U),v(w,U),p[U].push(w)),T&&(g(T),v(w,T),p[T].push(w)),c[w].sources.push(p[w]);let D=p[w].map(C=>c[C].sources[0]).flat(),P=p[w].map(C=>c[C].sources[1]).flat();if(c[w].sources.push(D,P),b){let C=S.containerStructureId||S.structureId,R=d[C];if(u[R])for(let N of u[R])g(N),v(N,w),p[N].push(w)}}}};if(s)ep({drawDefinition:s}),f!=null&&f.length||(f=Pn({drawDefinition:s}).matchUps),y(f);else{if(f!=null&&f.length||(f=As({nextMatchUps:!0,tournamentRecords:i}).matchUps),!n.length){let I=m!=null&&m.length?m.map(({events:b=[]})=>b.map(({drawDefinitions:S=[]})=>S.map(({drawId:w})=>w))).flat(1/0):[];I&&(n=I)}for(let I of n){let b=f==null?void 0:f.filter(S=>S.drawId===I).sort(Oh);if(!(b!=null&&b.find(({roundPosition:S})=>!S))){let S=b==null?void 0:b.find(({tournamentId:U})=>U),{drawDefinition:w}=Kn({tournamentRecord:i[S==null?void 0:S.tournamentId],drawId:I});w&&ep({drawDefinition:w})}y(b)}}return{positionDependencies:u,matchUpDependencies:c,sourceMatchUpIds:p,matchUps:f,...Z}}function yr(t){var e,i;let r=t==null?void 0:t.matchUp,n=(t==null?void 0:t.score)||(r==null?void 0:r.score),a=(e=n==null?void 0:n.sets)==null?void 0:e[0],{side1Score:o,side2Score:s,side1TiebreakScore:l,side2TiebreakScore:u,side1PointScore:c,side2PointScore:d}=a||{},p=o||s||l||u||c||d;return!!(((i=n==null?void 0:n.sets)==null?void 0:i.length)>1||p)}function Sw({matchUpStatus:t}){return cX.includes(t)}function F0e({matchUpStatus:t}){return GF.includes(t)}function wM({matchUpStatus:t}){return dX.includes(t)}function bL({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){var a;let o=r==null?void 0:r.find(({participantId:l})=>l),s=(a=i==null?void 0:i.filter(bL))==null?void 0:a.length;return yr({score:n})||s||e&&o||t&&F0e({matchUpStatus:t})&&![Pt,Ft,us].includes(t)}function Tw(t){var e;let{drawDefinition:i,findContainer:r,structureId:n,event:a}=t,o=t.structure,s={isCollectionMatchUp:!1},{containedStructures:l}=vv({drawDefinition:i}),u=n?l[n]||[]:[];if(!o){let T=tt({drawDefinition:i,structureId:n});if(T.error)return T;o=r?T.containingStructure??T.structure:T.structure}if(Yn({structure:o}))return{structure:o,isAdHoc:!0,error:rv};let{matchUps:c}=fr({inContext:!0,matchUpFilters:s,drawDefinition:i,event:a}),d=c==null?void 0:c.filter(T=>T.structureId===n||u.includes(T.structureId)),{matchUpDependencies:p}=ds({drawIds:[i.drawId],matchUps:c,drawDefinition:i}),m=[],h=[],f={},g=[];for(let T of c??[]){if(T.structureId===n||u.includes(T.structureId)){h.push(...T.drawPositions??[]);let D=T.roundNumber;for(let P of(T.drawPositions??[]).filter(Boolean))(!f[P]||D&&f[P]>D)&&(f[P]=D)}bL(T)&&(g.push(T),m.push(T.matchUpId,...((e=p==null?void 0:p[T==null?void 0:T.matchUpId])==null?void 0:e.matchUpIds)||[]))}let v=dt(h.filter(Boolean)).sort(lr),y=dt(m),I=dt(d==null?void 0:d.map(({matchUpId:T,drawPositions:D})=>y.includes(T)?D:[]).flat().filter(Boolean)).sort(lr),{positionAssignments:b}=oi({drawDefinition:i,structure:o}),S=b==null?void 0:b.filter(T=>T.bye).map(T=>T.drawPosition),w=b==null?void 0:b.filter(T=>T.qualifier).map(T=>T.drawPosition),U=(v==null?void 0:v.filter(T=>!I.includes(T)))||[];return{allDrawPositions:v,inContextStructureMatchUps:d,drawPositionInitialRounds:f,activeDependentMatchUpIds:y,qualifyingDrawPositions:w,inactiveDrawPositions:U,positionAssignments:b,activeDrawPositions:I,byeDrawPositions:S,activeMatchUps:g,structure:o}}function km({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(lr)[0]}}var ac={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},u0=[];function Oa(t,e){Di(t)&&(t={method:t}),(e||ja())&&u0.push(t)}function L0e(t){let e=u0.slice();return t&&(u0.length=0),e}function _0e(t){let e=L0e(t).map(i=>{let{color:r,keyColors:n,method:a,newline:o}=i,s=Object.keys(ac).includes(r)?ac[r]:ac.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=n&&Object.keys(n).includes(c)&&ac[n[c]]?ac[n[c]]:ac.brightwhite;return`${ac.white}${c}: ${d}${i[c]}`}).join(", "),u=(a==null?void 0:a.length)<15?"		":"	";return[o?`
`:"",s,a,u,ac.white,l,ac.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function $0e(){u0.length=0}function Qa({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUpsMap:a,structureId:o,structure:s,event:l}){var u,c,d;if(!r)return{error:$e};if(s||({structure:s}=tt({drawDefinition:r,structureId:o})),!s)return{error:Ni};o||({structureId:o}=s);let p="assignDrawPositionBye";Oa({method:p,color:"cyan",drawPosition:n}),a||(a=ln({drawDefinition:r}));let{positionAssignments:m}=oi({structure:s}),{activeDrawPositions:h}=Tw({drawDefinition:r,structureId:o});if((u=m==null?void 0:m.find(R=>R.drawPosition===n))!=null&&u.bye)return{...Z};if(h!=null&&h.includes(n))return{error:tP};let f=m==null?void 0:m.find(R=>R.drawPosition===n);if(!f)return{error:rv};let{filled:g,containsBye:v,assignedParticipantId:y}=B0e(f);if(v)return{...Z};if(g&&!v)return te({result:{error:Kf},stack:p});let I=Bt({tournamentRecord:i,drawDefinition:r,event:l}).appliedPolicies??{},b=fr({inContext:!0,drawDefinition:r,matchUpsMap:a}).matchUps??[],S={isCollectionMatchUp:!1},{matchUps:w}=qt({provisionalPositioning:t,drawDefinition:r,matchUpFilters:S,matchUpsMap:a,structure:s});if(m==null||m.forEach(R=>{R.drawPosition===n&&(R.bye=!0)}),s.structureType===_n)return V0e({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:w}),Fc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),f2({assignedParticipantId:y,isPositionAction:e,appliedPolicies:I,drawDefinition:r,drawPosition:n,structureId:o,stack:p});let{roundProfile:U,roundMatchUps:T}=An({matchUps:w}),D=(c=U&&Object.keys(U).map(R=>parseInt(R)).reverse())==null?void 0:c.find(R=>{var N;return(N=U==null?void 0:U[R].drawPositions)==null?void 0:N.includes(n)}),P=D?T==null?void 0:T[D].find(({drawPositions:R})=>R==null?void 0:R.includes(n)):void 0;P&&QX({tournamentRecord:i,drawDefinition:r,matchUp:P,event:l});let C=(d=P==null?void 0:P.drawPositions)==null?void 0:d.find(R=>R!==n);if(P&&C){let R=wL({sourceDrawPositions:P.drawPositions,matchUpId:P.matchUpId,inContextDrawMatchUps:b,drawPositionToAdvance:C,tournamentRecord:i,drawDefinition:r,matchUpsMap:a});if(R.error)return R}return Fc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),f2({assignedParticipantId:y,isPositionAction:e,appliedPolicies:I,drawDefinition:r,drawPosition:n,structureId:o,stack:p})}function f2({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:o}){return e&&$P({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:o}}),te({result:{...Z},stack:o})}function B0e(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:r,filled:e||i||r}}function QX({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:jt,score:void 0,winningSide:void 0}),Ct({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(n==null?void 0:n.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function V0e({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{var o;(o=a.drawPositions)!=null&&o.includes(i)&&QX({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function wL({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:o,event:s}){var l,u;Oa({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let c=a.drawMatchUps.find(S=>S.matchUpId===o),d=(l=e.find(S=>S.matchUpId===o))==null?void 0:l.structureId,{structure:p}=tt({drawDefinition:n,structureId:d}),{positionAssignments:m}=oi({structure:p}),h=m==null?void 0:m.filter(S=>S.bye).map(S=>S.drawPosition),f=(u=c==null?void 0:c.drawPositions)==null?void 0:u.find(S=>S!==t),g=f&&(h==null?void 0:h.includes(f)),{targetLinks:{loserTargetLink:v},targetMatchUps:{loserMatchUp:y,winnerMatchUp:I,loserTargetDrawPosition:b}}=On({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:o});if(I&&I.structureId===(p==null?void 0:p.structureId)&&j0e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:I,matchUpsMap:a,event:s}),y&&g&&y.structureId!==(p==null?void 0:p.structureId)){let{roundNumber:S}=y;if(S===1){let w=Qa({structureId:v.target.structureId,drawPosition:b,tournamentRecord:r,drawDefinition:n,event:s});if(w.error)return w}else eJ({loserTargetDrawPosition:b,tournamentRecord:r,loserTargetLink:v,drawDefinition:n,loserMatchUp:y,matchUpsMap:a,event:s})}return{...Z}}function j0e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:o,event:s}){var l,u,c,d,p,m;let h="advanceWinner",f=o.drawMatchUps.find(F=>F.matchUpId===a.matchUpId),g=(l=e.find(F=>F.matchUpId===a.matchUpId))==null?void 0:l.structureId,{structure:v}=tt({drawDefinition:n,structureId:g}),{positionAssignments:y}=oi({structure:v}),I=(u=y==null?void 0:y.find(({drawPosition:F})=>F===t))==null?void 0:u.bye,b=(c=f.drawPositions)==null?void 0:c.filter(Boolean),S=y==null?void 0:y.filter(F=>b==null?void 0:b.includes(F.drawPosition)),w=y==null?void 0:y.find(({drawPosition:F})=>F===t),U=i==null?void 0:i.find(F=>F!==t),T=(d=U&&(S==null?void 0:S.find(({drawPosition:F})=>F===U)))==null?void 0:d.bye,D=I&&T;if(D&&console.log({isByeAdvancedBye:D}),(b==null?void 0:b.length)>1&&I&&!T)return te({result:{error:Kf},stack:h});let P=b==null?void 0:b.find(F=>F!==t),C=D,R=[...(f.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),N=R.map(F=>!F&&!C||F===t?(C=!0,t):F).sort(lr);if(!C)return console.log("@@@@@@@",{advancingAssignmentIsBye:w,drawPositionToAdvance:t,existingAssignments:S}),te({result:{error:Kf},stack:h});let A=(p=y==null?void 0:y.find(({drawPosition:F})=>F===P))==null?void 0:p.bye,M=(m=y==null?void 0:y.find(({drawPosition:F})=>F===t))==null?void 0:m.bye;Object.assign(f,{matchUpStatus:M||A?jt:Zi,score:void 0,winningSide:void 0,drawPositions:N});let E=f.drawPositions.find(F=>!R.includes(F));Oa({method:h,color:"brightyellow",changedDrawPosition:E,pairedDrawPositionIsBye:A,drawPositionIsBye:M}),Ct({tournamentId:r==null?void 0:r.tournamentId,matchUp:f,eventId:s==null?void 0:s.eventId,context:h,drawDefinition:n});let{targetLinks:{loserTargetLink:O},targetMatchUps:{loserMatchUp:k,loserTargetDrawPosition:x}}=On({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(A||M){let F=A?t:P;if(F)wL({drawPositionToAdvance:F,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:o});else if(M&&O&&k)if(k.feedRound)eJ({loserTargetDrawPosition:x,tournamentRecord:r,loserTargetLink:O,drawDefinition:n,loserMatchUp:k,matchUpsMap:o});else{let $=1-a.roundPosition%2,_=k.drawPositions[$],L=Qa({structureId:O.target.structureId,drawPosition:_,tournamentRecord:r,drawDefinition:n,event:s});if(L.error)return L}}}function eJ({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){let{roundNumber:s}=n;Oa({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[n.structureId].matchUps,{initialRoundNumber:u}=km({drawPosition:t,matchUps:l});if(u===s){let c=Qa({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:o});if(c.error)return c}}function tJ({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:o}=qt({drawDefinition:i,matchUpsMap:r,structure:n,event:a});o.forEach(s=>{let l=t.filter(({drawPosition:u})=>{var c;return(c=s.drawPositions)==null?void 0:c.includes(u)}).filter(u=>u.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?jt:Zi}),Ct({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:s}))})}function Dw(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=t,{structure:u}=tt({drawDefinition:a,structureId:o}),c=(Er({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(c&&i&&!r&&(r=c==null?void 0:c.drawPosition),!r)return{error:nv};i||(i=c==null?void 0:c.participantId);let{activeDrawPositions:d}=Tw({drawDefinition:a,structureId:o});return d.includes(r)?{error:tP}:(e||({matchUps:e}=fr({inContext:!0,drawDefinition:a,matchUpsMap:s})),UM({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:o,drawPosition:r,matchUpsMap:s,event:l}).drawPositionCleared?(Fc({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:u,event:l}),{...Z,participantId:i}):{error:RK})}function UM({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:o}){var s,l;let{structure:u}=tt({drawDefinition:i,structureId:a});if(!u)return{error:Ni};let c=Er({drawDefinition:i,structure:u}).positionAssignments||[],d=c.some(I=>{if(I.drawPosition===r)return delete I.participantId,delete I.qualifier,delete I.bye,!0});if(u.structureType===_n)return tJ({positionAssignments:c,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:u}),{drawPositionCleared:d,...Z};let p={isCollectionMatchUp:!1},{matchUps:m}=qt({drawDefinition:i,matchUpFilters:p,matchUpsMap:n,structure:u,event:o}),{roundProfile:h,roundMatchUps:f}=An({matchUps:m}),g=(s=h&&Object.keys(h))==null?void 0:s.map(I=>Qe(I)),v=r,y=(l=g==null?void 0:g.map(I=>{var b,S,w,U;let T=(S=(b=h==null?void 0:h[I])==null?void 0:b.pairedDrawPositions)==null?void 0:S.find(E=>E.includes(v)),D=T==null?void 0:T.find(E=>E!==v),P=c.find(E=>E.drawPosition===D),C=h==null?void 0:h[I+1],R=P==null?void 0:P.bye,N=(w=C==null?void 0:C.pairedDrawPositions)==null?void 0:w.find(E=>E.includes(D)),A=R&&N&&C&&((U=C.drawPositions)==null?void 0:U.includes(D)),M=T&&{pairedDrawPositionByeAdvancedPair:!A&&N,pairedDrawPosition:D,targetDrawPosition:v,relevantPair:T,roundNumber:I};return A&&(v=D),M}).filter(I=>I==null?void 0:I.targetDrawPosition))==null?void 0:l.reduce((I,b)=>{let{roundNumber:S,relevantPair:w,targetDrawPosition:U,pairedDrawPosition:T,pairedDrawPositionByeAdvancedPair:D}=b,P={roundNumber:S,targetDrawPosition:U,relevantPair:w},C=D&&{roundNumber:S+1,targetDrawPosition:T,relevantPair:D,subsequentRoundRemoval:!0},R=[P,C].filter(Boolean);return I.concat(...R)},[]);return y==null||y.forEach(({roundNumber:I,targetDrawPosition:b,relevantPair:S})=>{let w=f==null?void 0:f[I].find(U=>{var T;return Nn((T=U.drawPositions)==null?void 0:T.filter(Boolean),S.filter(Boolean))});w&&(G0e({inContextDrawMatchUps:t,targetDrawPosition:b,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:I,matchUpsMap:n}),iJ({inContextDrawMatchUps:t,positionAssignments:c,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:r,matchUpsMap:n,structure:u,event:o}))}),{tasks:y,drawPositionCleared:d,positionAssignments:c}}function G0e({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:o}){let{structure:s}=tt({drawDefinition:r,structureId:o});if(!s)return{error:Ni};if(s.structureType===_n)return;n=n||ln({drawDefinition:r});let l=((n==null?void 0:n.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:u}=km({drawPosition:e,matchUps:l}),c=l==null?void 0:l.filter(p=>{var m;return p.roundNumber>=a&&p.roundNumber!==u&&((m=p.drawPositions)==null?void 0:m.includes(e))}),d=oi({drawDefinition:r,structureId:o}).positionAssignments??[];return c==null||c.forEach(p=>iJ({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:s})),{...Z}}function iJ({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var u,c,d,p,m;let h="removeDrawPosition",f=(u=n.drawPositions)==null?void 0:u.slice(),g=n.matchUpStatus,v=n.winningSide;o=o??ln({drawDefinition:r});let y=o.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:I}=km({drawPosition:a,matchUps:y});if(n.roundNumber&&I&&n.roundNumber>I){let R=(n.drawPositions??[]).map(N=>N===a?void 0:N);n.drawPositions=R}if(n.matchUpType===fi){let R=(((c=t==null?void 0:t.find(N=>N.matchUpId===n.matchUpId))==null?void 0:c.sides)??[]).reduce((N,A,M)=>A.drawPosition===a?M:N,void 0);R!==void 0&&(p=(d=n.sides)==null?void 0:d[R])!=null&&p.lineUp&&((m=n.sides)==null||delete m[R].lineUp,Ct({tournamentId:i==null?void 0:i.tournamentId,context:`${h}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:n,drawDefinition:r}))}let b=On({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:S},targetMatchUps:{loserMatchUp:w,winnerMatchUp:U,loserMatchUpDrawPositionIndex:T}}=b,D=e.filter(({drawPosition:R})=>{var N;return(N=n.drawPositions)==null?void 0:N.includes(R)}).filter(R=>R.bye).length,P=D&&jt||n.matchUpStatus&&[Pt,Ft].includes(n.matchUpStatus)&&n.matcHUpStatus||Zi;n.matchUpStatus=P,n.matchUpStatus&&[Ft,Pt].includes(n.matchUpStatus)&&(n.winningSide=void 0);let C=f==null?void 0:f.find(R=>{var N;return!((N=n.drawPositions)!=null&&N.includes(R))});if(f!=null&&f.includes(a)&&g===n.matchUpStatus&&v===n.winningSide||(C&&Oa({method:h,color:"brightyellow",removedDrawPosition:C}),Ct({tournamentId:i==null?void 0:i.tournamentId,context:`${h}-${a}`,eventId:l==null?void 0:l.eventId,matchUp:n,drawDefinition:r})),w&&w.structureId!==b.matchUp.structureId&&!D){let{drawPositions:R,roundNumber:N}=w;if(N===1){let A=R[T];UM({structureId:w.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o})}else{let A=Math.min(...R.filter(Boolean)),M=H0e({loserMatchUpDrawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:w,matchUpsMap:o,event:l});if(M.error)return te({result:M,stack:h});let E=((o==null?void 0:o.mappedMatchUps)||{})[w.structureId].matchUps,{initialRoundNumber:O}=km({drawPosition:A,matchUps:E});O===1&&(Oa({method:h,color:"brightyellow",loserMatchUpDrawPosition:A}),UM({structureId:w.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o}))}}return U&&U.structureId!==b.matchUp.structureId&&S.target.feedProfile,{...Z}}function H0e({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){var s;let{structure:l}=tt({structureId:n.structureId,drawDefinition:r}),{positionAssignments:u}=oi({structure:l});if((s=u==null?void 0:u.find(c=>c.drawPosition===t))!=null&&s.bye){let c=Dw({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:o});if(c.error)return c}return{...Z}}function Np({drawDefinition:t,stages:e}){if(!t)return{error:$e};let i=((t==null?void 0:t.structures)??[]).filter(n=>!(e!=null&&e.length)||n.stage&&e.includes(n.stage)),r=dt(i.map(n=>{let{positionAssignments:a}=oi({structure:n});return a?a.map(Tt):[]}).flat().filter(Boolean));return{...Z,assignedParticipantIds:r}}function ws(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:o}=n,s=`_${a||Ae}${o||""}`;return r[s]||(r[s]=[]),r[s].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let o=a+1;return{...n,entryPosition:o}})).flat()}function fd(t){return[Cp,Po].includes(t)}function c0({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:u,stage:c,event:d}){var p,m,h,f,g,v,y,I,b,S,w,U;if(!n||!Array.isArray(n))return{error:Es,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:vi};if(a&&!MX.includes(a))return{error:nM};if(o&&!bP.includes(o))return{error:Sp};let T="modifyEntriesStatus",D=[];if(!a&&!s)return te({result:{error:Je},info:"Missing entryStatus",stack:T});if(s&&!ll({extension:s,requiredAttributes:["name"]}))return te({result:{error:se},info:"Invalid extension",context:{extension:s},stack:T});let P=[];(p=d==null?void 0:d.drawDefinitions)==null||p.forEach($=>{let _=Np({stages:c&&[c],drawDefinition:$}).assignedParticipantIds??[];P.push(..._)});let C=(i==null?void 0:i.participants)??[];if(!n.every($=>{var _;let L=(_=Ac({tournamentParticipants:C,participantId:$}))==null?void 0:_.participantType;return!(L&&[ft,Gn].includes(L)&&fd(a))&&!(a&&d!=null&&d.eventType&&L===Dt&&[ho,Ca].includes(d.eventType)&&[Wo,...QU].includes(a))}))return{error:nM};let R=d&&Hi({event:d}).flightProfile,N=(m=R==null?void 0:R.flights)==null?void 0:m.find($=>$.drawId===u),A=$=>{let _=($||[]).filter(B=>!c||!B.entryStage||c===B.entryStage).filter(({participantId:B})=>n.includes(B)),L=B=>a&&P.includes(B.participantId)&&!(QU.includes(B.entryStatus)&&QU.includes(a));return _.every(B=>L(B)&&!e?!1:(a&&(B.entryStatus=a,delete B.entryPosition),o&&(B.entryStage=o,delete B.entryPosition),s&&(s.value?_t({element:B,extension:s}):Dn({element:B,name:s.name})),!0))?{...Z}:{error:sv}},M=({flight:$,drawDefinition:_})=>{d&&(d.entries=ws({entries:d.entries??[]})),$&&($.drawEntries=ws({entries:$.drawEntries})),_&&(_.entries=ws({entries:_.entries}))},E=$=>{let{flight:_,drawDefinition:L}=$,B="updateDrawEntries";if(_){let V=A(_.drawEntries);if(V.error)return te({result:V,stack:B})}if(L){let V=A(L.entries);if(V.error)return te({result:V,stack:B});D.includes(L.drawId)||D.push(L.drawId)}return{...Z}},O=((h=d==null?void 0:d.entries)==null?void 0:h.find(({entryPosition:$})=>$))??(((f=N==null?void 0:N.drawEntries)==null?void 0:f.find(({entryPosition:$})=>$))||((g=r==null?void 0:r.entries)==null?void 0:g.find(({entryPosition:$})=>$)));if(t&&!O&&M({flight:N,drawDefinition:r}),N||r){let $=E({flight:N,drawDefinition:r});if($.error)return te({result:$,stack:T})}let k=((v=d==null?void 0:d.drawDefinitions)==null?void 0:v.map(({drawId:$})=>$))??[],x=((y=R==null?void 0:R.flights)==null?void 0:y.filter($=>!k.includes($.drawId)))||[];for(let $ of x){let _=$&&E({flight:$});if(_!=null&&_.error)return te({result:_,stack:T})}let F=((I=R==null?void 0:R.flights)==null?void 0:I.length)===1&&(((b=d==null?void 0:d.drawDefinitions)==null?void 0:b.length)??0)<=((S=R==null?void 0:R.flights)==null?void 0:S.length);if(!N&&!r&&a&&EX.includes(a))return{error:c9};if(!N&&!r||a===Yl||l&&F){let $=A(d==null?void 0:d.entries);if($!=null&&$.error)return te({result:$,stack:T});let _;if(a===Yl&&((w=R==null?void 0:R.flights)==null||w.every(L=>{let B=A(L.drawEntries);return B.error?(_=B.error,!1):(L.drawEntries=L.drawEntries.filter(({participantId:V})=>!n.includes(V)),!0)}),(U=d==null?void 0:d.drawDefinitions)==null||U.every(L=>{var B;let V=A(L.entries);return V.error?(_=V.error,!1):(L.entries=(B=L.entries)==null?void 0:B.filter(({participantId:G})=>!n.includes(G)),!0)})),_)return te({result:{error:_},stack:T})}t&&M({flight:N,drawDefinition:r});for(let $ of(d==null?void 0:d.drawDefinitions)??[])D.length&&!D.includes($.drawId)||li({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:$});return{...Z}}function kl({requireTimeStamp:t,scaleAttributes:e,participant:i}){var r,n;if(!i)return{error:vh};if(!At(e))return{error:se};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=e,u=[Xd,o,s,l].join("."),c=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===u).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(c){let[d,p,m,h]=((r=c.itemType)==null?void 0:r.split("."))??[];if(d!==Xd)return{error:Rm};let f=((n=a&&om({element:c.itemValue,accessor:a}))==null?void 0:n.value)||c.itemValue,g={eventType:m,scaleDate:c.itemDate,scaleValue:f,scaleName:h,scaleType:p};return{...Z,scaleItem:g}}}return{...Z,scaleItem:void 0}}function z0e({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){var a,o,s;let l={},u=m=>[Xd,Al,n.eventType,m].join("."),c=Object.assign({},...(r.timeItems||[]).filter(({itemType:m})=>m.split(".")[1]===Al).map(({itemType:m,itemValue:h})=>({[m]:h}))),d=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(u),p=ji(Object.keys(c),d);if((!e||!Object.keys(c).length&&!((a=t==null?void 0:t.drawIds)!=null&&a.length)||p.length)&&p.length){if(t!=null&&t.stageSeedingScaleNames){let m=Object.keys(t.stageSeedingScaleNames).map(f=>{let g=u(t.stageSeedingScaleNames[f]),v=c[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);l.seedAssignments=h}else if(p){let m=p.map(h=>c[h]);l.seedValue=m.pop()}}else if(!e&&typeof i=="object"){let m=Object.keys(i).map(f=>{let g=u(i[f]),v=c[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);l.seedAssignments=h}else{let{categoryName:m,ageCategoryCode:h}=n.category||{},f=[h,n.eventId,m].filter(Boolean),g;for(let v of f){let y={eventType:n.eventType,scaleType:Al,scaleName:v},I=kl({scaleAttributes:y,participant:r});if(I.scaleItem){g=I.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((s=(o=t==null?void 0:t.published)==null?void 0:o.drawIds)!=null&&s.length))){let v=g.scaleValue;l.seedValue=v}}return l}function W0e({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...wF(d??[])):{},m=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:o,eventId:a});i.events[a]=He(m,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function rJ(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||r===jt||e[i].scheduleItems.push({...c,scheduledDate:mt(c==null?void 0:c.scheduledDate),scheduledTime:Ui(c==null?void 0:c.scheduledTime),checkScoreHasValue:yr({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,drawId:d})}function Pw(t){var e,i,r;let n=We(t,[{[wr]:!0}]);if(n.error)return n;let{tournamentRecord:a,status:o=Za}=t,s=`${ad}.${od}`;return Ne((r=(i=(e=VP({tournamentRecord:a,itemType:s}))==null?void 0:e.timeItem)==null?void 0:i.itemValue)==null?void 0:r[o],!1,!0)}function q0e(t){let{tournamentId:e}=t??{};return!!e}function Co({event:t,status:e=Za}){var i,r,n;let a=`${ad}.${od}`;return(n=(r=(i=cw({itemType:a,event:t}))==null?void 0:i.timeItem)==null?void 0:r.itemValue)==null?void 0:n[e]}function UL({drawDetails:t,drawId:e}){var i,r;return(r=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:r.published}function kh(t){var e,i,r,n,a,o,s,l,u;let{tournamentRecord:c,drawDefinition:d,eventIds:p,eventId:m,drawIds:h,drawId:f,event:g}=t??{};if(c&&!q0e(c))return{error:se};if(m&&!g)return{error:mo};if(Array.isArray(p)&&p!=null&&p.length){let b={};for(let S of p){if(!Di(S))return{error:se};let w=(e=Kn({tournamentRecord:c,eventId:S}))==null?void 0:e.event;if(!w)return{error:mo};let U=VC({event:w});b[S]=U}return{...Z,publishState:b}}if(g){let b=VC({event:g}),S={};if(f)return d?{publishState:{status:{published:!!((i=b.status.publishedDrawIds)!=null&&i.includes(f)),drawDetail:(r=b.status.drawDetails)==null?void 0:r[f]},...Z}}:{error:Va};if(Array.isArray(h)&&h!=null&&h.length){let w=((n=g.drawDefinitions)==null?void 0:n.map(sy))??[];for(let U of h){if(!Di(U))return{error:se};if(!w.includes(U))return{error:Va};S[U]={status:{published:!!b.status.publishedDrawIds.includes(U),drawDetail:(a=b.status.drawDetails)==null?void 0:a[U]}}}}else S=b;return{...Z,publishState:S}}let v=[],y=!1,I={};for(let b of(c==null?void 0:c.events)??[]){let S=VC({event:b});I[b.eventId]=S,S.status.published&&(v.push(b.eventId),y=!0);for(let{drawId:w}of b.drawDefinitions??[]){let U=(s=(o=S.status)==null?void 0:o.publishedDrawIds)==null?void 0:s.includes(w);U&&(I[w]={status:{published:U}})}}if(c){let b=Pw({tournamentRecord:c});I.tournament=b??{},((l=b==null?void 0:b.orderOfPlay)!=null&&l.published||(u=b==null?void 0:b.participants)!=null&&u.published)&&(y=!0),I.tournament.status={published:y,publishedEventIds:v}}return{...Z,publishState:I}}function VC({event:t}){var e;let i=Co({event:t});if(!i)return{status:{published:!1}};let r={published:void 0,seedingScaleNames:[],drawIds:[]};i.seeding&&Object.assign(r,i.seeding);let n=i.drawDetails??{};for(let l of((e=t.drawDefinitions)==null?void 0:e.map(sy))||[])n[l]||(n[l]={publishingDetail:{published:!1}});let a=n&&Object.keys(n).length&&Object.keys(n).filter(l=>UL({drawDetails:n,drawId:l})),o=a!=null&&a.length?a:i.drawIds??[];if(o!=null&&o.length&&!(a!=null&&a.length))for(let l of o)n[l]={publishingDetail:{published:!0}};let s=(o==null?void 0:o.length)>0;return{status:{publishedDrawIds:o,publishedSeeding:r,drawDetails:n,published:s}}}function XP(t,e){return(t||"").localeCompare(e||"")}function Y0e({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:r,matchUpStatus:n,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:u,drawId:c,stage:d}){let p=e[a],m=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:c});let h=p.structureParticipation[l],{winner:f,loser:g}=t,v=r?f:g;r&&(h.winCount+=1,n===Ft&&(h.walkoverWinCount+=1),n===Pt&&(h.defaultWinCount+=1)),v&&(!h.finishingPositionRange||m(v)<m(h.finishingPositionRange))&&(h.finishingPositionRange=v),i&&((!h.finishingRound||i<h.finishingRound)&&(h.finishingMatchUpId=u,h.finishingRound=i,h.roundNumber=s),i===1&&(h.participantWon=r))}function g2(t){var e,i,r,n,a,o,s,l,u,c;let{withScheduleItems:d,scheduleAnalysis:p,withTeamMatchUps:m,participantMap:h,withOpponents:f,withMatchUps:g,withEvents:v,withDraws:y,finishingPositionRange:I,finishingRound:b,matchUpStatus:S,stageSequence:w,roundNumber:U,structureId:T,score:D,stage:P,withRankingProfile:C,tieWinningSide:R,roundPosition:N,matchUpTieId:A,matchUpSides:M,collectionId:E,matchUpType:O,winningSide:k,matchUpId:x,schedule:F,eventId:$,drawId:_,sides:L}=t,B=f&&(L==null?void 0:L.length)===2&&Object.assign({},...L.map(({sideNumber:V},G)=>{let j=L[1-G].participantId;return V&&{[V]:j}}).filter(Boolean));for(let V of L){let{participantId:G,sideNumber:j,bye:z}=V;if(z)continue;let q=k===j,W=K=>{var H,Q;let X=(H=h[K])==null?void 0:H.participant,ie=X==null?void 0:X.participantType,ae=[{participantId:K,participantType:ie}];if(ie!==Gn)for(let le of(X==null?void 0:X.individualParticipantIds)||[]){let ne=(Q=h[le])==null?void 0:Q.participant;ae.push({participantType:ne==null?void 0:ne.participantType,participantId:le})}return ae},Y=(K,H)=>{if(g){if(h[K].matchUps[x]={participantWon:q,matchUpType:O,structureId:T,sideNumber:j,matchUpId:x,eventId:$,drawId:_,stage:P},f){let Q=W(H);h[K].matchUps[x].opponentParticipantInfo=Q}E&&(h[K].matchUps[x].collectionId=E)}f&&H&&(h[K].opponents[H]={participantId:H,matchUpId:x,eventId:$,drawId:_}),C&&Y0e({finishingPositionRange:I,participantMap:h,participantWon:q,finishingRound:b,matchUpStatus:S,participantId:K,stageSequence:w,roundNumber:U,structureId:T,matchUpId:x,drawId:_,stage:P}),(p||d)&&rJ({participantMap:h,participantId:K,matchUpStatus:S,roundPosition:N,matchUpType:O,roundNumber:U,structureId:T,matchUpId:x,schedule:F,drawId:_,score:D})},re=({participant:K,partnerParticipantId:H})=>{var Q,X,ie;let ae=(le,ne)=>{le&&(le.partnerParticipantIds||(le.partnerParticipantIds=[]),le.partnerParticipantIds.includes(ne)||le.partnerParticipantIds.push(ne))};y&&ae((Q=K==null?void 0:K.draws)==null?void 0:Q[_],H),v&&ae((X=K==null?void 0:K.events)==null?void 0:X[$],H),g&&ae((ie=K==null?void 0:K.matchUps)==null?void 0:ie[x],H)};if(G&&h[G]){let K=B==null?void 0:B[j];Y(G,K);let H=((e=h[G])==null?void 0:e.participant.participantType)===ft,Q=((i=h[G])==null?void 0:i.participant.individualParticipantIds)||[];if(A){if(m){let X=ie=>h[ie].matchUps[A]={participantWon:R===j,matchUpId:A,matchUpType:fi,sideNumber:j};X(G),Q.forEach(X)}if(y&&!h[G].draws[_]){let X=(n=(r=M.find(le=>le.sideNumber===j))==null?void 0:r.participant)==null?void 0:n.participantId,ie=(s=(o=(a=h[X])==null?void 0:a.draws)==null?void 0:o[_])==null?void 0:s.entryStatus,ae=le=>h[le].draws[_]={entryStatus:ie,eventId:$,drawId:_};ae(G),Q.forEach(ae)}}if(H&&(Q.forEach(X=>h[X]&&Y(X,K)),Q.forEach((X,ie)=>{let ae=Q[1-ie],le=h[X];le&&re({participant:le,partnerParticipantId:ae})}),v&&M)){let X=(u=(l=M.find(ie=>ie.sideNumber===j))==null?void 0:l.participant)==null?void 0:u.participantId;if(X){let ie=(c=h[X])==null?void 0:c.events[$];ie?(h[G].events[$]={...ie},Q.forEach(ae=>h[ae].events[$]={...ie})):console.log("Missing teamEntry",{eventId:$,teamParticipantId:X})}}if(k){let X=ie=>{q?(h[ie].counters[O].wins+=1,h[ie].counters.wins+=1,S===Ft&&(h[ie].counters[O].walkoverWins+=1,h[ie].counters.walkoverWins+=1),S===Pt&&(h[ie].counters[O].defaultWins+=1,h[ie].counters.defaultWins+=1)):(h[ie].counters[O].losses+=1,h[ie].counters.losses+=1,S===Ft&&(h[ie].counters[O].walkovers+=1,h[ie].counters.walkovers+=1),S===Pt&&(h[ie].counters[O].defaults+=1,h[ie].counters.defaults+=1))};X(G),Q.forEach(X)}}}}function K0e(t){var e,i,r,n,a,o,s;let{participantFilters:l,convertExtensions:u,policyDefinitions:c,tournamentRecord:d,usePublishState:p,participantMap:m,contextProfile:h,withPotentialMatchUps:f,withRankingProfile:g,withScheduleItems:v,scheduleAnalysis:y,withTeamMatchUps:I,withStatistics:b,withOpponents:S,withMatchUps:w,withSeeding:U,withEvents:T,withDraws:D}=t,P=l==null?void 0:l.participantIds,C=F=>{var $,_;let L=[F];return(_=($=m[F])==null?void 0:$.participant.individualParticipantIds)==null||_.forEach(B=>L.push(B)),L.some(B=>!(P!=null&&P.length)||P.includes(B))?L:[]},R={withMatchUps:w||g,withEvents:T||g,withDraws:D||g,withPotentialMatchUps:f,withRankingProfile:g,withScheduleItems:v,scheduleAnalysis:y,withTeamMatchUps:I,withStatistics:b,participantMap:m,withOpponents:S,withSeeding:U},N=[],A={},M=[],E={},O={},k={},x=({eventType:F,scaleNames:$,participantId:_})=>{var L,B,V,G,j;return(j=(G=(V=(B=(L=m[_])==null?void 0:L.participant)==null?void 0:B.rankings)==null?void 0:V[F])==null?void 0:G.find(z=>$.includes(z.scaleName)))==null?void 0:j.scaleValue};for(let F of(d==null?void 0:d.events)||[]){if(l!=null&&l.eventIds&&!l.eventIds.includes(F.eventId))continue;let{drawDefinitions:$=[],extensions:_=[],eventType:L,eventName:B,category:V,entries:G,eventId:j,gender:z}=F,{flightProfile:q}=Hi({event:F}),W=(q==null?void 0:q.flights)??[],Y=kh({event:F}).publishState;Y&&(E[j]=Y);let re=(e=Y==null?void 0:Y.status)==null?void 0:e.publishedSeeding;if(T||U||g){let H=u?Object.assign({},...wF(_??[])):{};O[j]={...H,eventName:B,eventType:L,category:V,eventId:j,gender:z};let Q=[V==null?void 0:V.categoryName,V==null?void 0:V.ageCategoryCode].filter(Boolean);for(let X of G){let{participantId:ie}=X;if(!ie||!m[ie])continue;let ae=x({eventType:L,scaleNames:Q,participantId:ie}),le,ne;if(U){let Ie=m[ie].participant;({seedAssignments:le,seedValue:ne}=z0e({publishedSeeding:re,usePublishState:p,withSeeding:U,participant:Ie,event:F}))}let de=Ie=>{var ce,ke;if((ke=(ce=m[Ie])==null?void 0:ce.events)!=null&&ke[j])return;let Pe=m[Ie];W0e({convertExtensions:u,seedAssignments:le,participant:Pe,withSeeding:U,seedValue:ne,eventId:j,ranking:ae,entry:X})};de(ie),(m[ie].participant.individualParticipantIds||[]).forEach(de)}}let K=(i=E==null?void 0:E[j])==null?void 0:i.publishedSeeding;if(D||g||U){let H=X=>X?Object.assign({},...X.map(({participantId:ie,seedValue:ae,seedNumber:le})=>({[ie]:{seedValue:ae,seedNumber:le}}))):void 0,Q=dt([...$.map(sy),...W.map(sy)]);for(let X of Q){let ie=$.find(we=>we.drawId===X),ae=[V==null?void 0:V.categoryName,V==null?void 0:V.ageCategoryCode].filter(Boolean),{structures:le=[],drawOrder:ne,drawName:de,drawType:Ie}=ie??{},ce=W==null?void 0:W.find(we=>we.drawId===X),ke=(ie==null?void 0:ie.entries)||(ce==null?void 0:ce.drawEntries),Pe=ce==null?void 0:ce.flightNumber,it=((ie==null?void 0:ie.structures)||[]).sort((we,Ue)=>Th(we,Ue)).map(({structureId:we,structures:Ue})=>[we,...(Ue||[]).map(({structureId:wt})=>wt)]).flat(1/0),It,me,fe,pe,Fe=0,De=le.filter(({stage:we,stageSequence:Ue})=>we===Ae&&Ue===1||we===Ke).flatMap(we=>{let{positionAssignments:Ue}=oi({structure:we}),{seedAssignments:wt,stageSequence:Le,stage:rt}=we;return rt===Ae?(Fe=(Ue==null?void 0:Ue.length)??0,fe=Ue,pe=wt):Le===1&&(It=Ue,me=wt),Ue}).map(({participantId:we})=>we).filter(Boolean),je=H(pe),ue=H(me),he=ie?ke.filter(({participantId:we})=>De.includes(we)):ke,Re=!p||(K==null?void 0:K.published)&&(((r=K==null?void 0:K.drawIds)==null?void 0:r.length)===0||((n=K==null?void 0:K.drawIds)==null?void 0:n.includes(X)));for(let we of he){if(!m[we.participantId])continue;let{entryStatus:Ue,entryStage:wt,entryPosition:Le,participantId:rt}=we,Ci=x({participantId:rt,scaleNames:ae,eventType:L}),Be=nt=>{var Ii,be,Et,Ee,qe;if(!m[nt]||(Ii=m[nt].draws)!=null&&Ii[X])return;let Ot=U&&Re,ci=Ot?{}:void 0,yi=Ot?((be=je==null?void 0:je[rt])==null?void 0:be.seedValue)||((Et=je==null?void 0:je[rt])==null?void 0:Et.seedNumber):void 0,xi=yi?je==null?void 0:je[rt]:void 0,di=Ot?((Ee=ue==null?void 0:ue[rt])==null?void 0:Ee.seedValue)||((qe=ue==null?void 0:ue[rt])==null?void 0:qe.seedNumber):void 0,gn=di?ue==null?void 0:ue[rt]:void 0;ci&&yi&&(ci[Ae]=xi),ci&&di&&(ci[Ke]=gn);let zr=yi||di;zr&&(m[nt].participant.seedings[L]||(m[nt].participant.seedings[L]=[]),xi&&m[nt].participant.seedings[L].push({...xi,scaleName:X}),gn&&m[nt].participant.seedings[L].push({...gn,scaleName:X}),ci&&(m[nt].events[j].seedAssignments||(m[nt].events[j].seedAssignments={}),Object.keys(ci).forEach(iu=>m[nt].events[j].seedAssignments[iu]=ci[iu]))),(D||g)&&(m[nt].draws[X]=He({seedAssignments:ci,entryPosition:Le,entryStatus:Ue,entryStage:wt,seedValue:zr,eventId:j,ranking:Ci,drawId:X},!1,!1,!0))};[Po,Cp].includes(Ue)||(Be(rt),(a=m[rt].participant.individualParticipantIds||[])==null||a.forEach(Be))}let xe=((ie==null?void 0:ie.structures)??[]).reduce((we,Ue)=>(we.includes(Ue.stage)||we.push(Ue.stage),we),[]),Ce=((ie==null?void 0:ie.links)??[]).length;k[X]={qualifyingPositionAssignments:It,qualifyingSeedAssignments:me,mainPositionAssignments:fe,qualifyingSeedingMap:ue,mainSeedAssignments:pe,orderedStructureIds:it,mainSeedingMap:je,flightNumber:Pe,linksCount:Ce,drawOrder:ne,drawName:de,drawType:Ie,drawSize:Fe,drawId:X,stages:xe}}}if(g||y||I||b||S||w||D){let H=!!y||f,Q=((o=tu({afterRecoveryTimes:!!y,policyDefinitions:c,tournamentRecord:d,inContext:!0,contextProfile:h,participantMap:m,nextMatchUps:H,event:F}))==null?void 0:o.matchUps)??[];for(let X of Q){let{finishingPositionRange:ie,potentialParticipants:ae,tieMatchUps:le=[],sides:ne=[],winningSide:de,matchUpType:Ie,matchUpId:ce,eventId:ke,drawId:Pe,collectionId:it,stageSequence:It,finishingRound:me,matchUpStatus:fe,roundPosition:pe,roundNumber:Fe,structureId:De,schedule:je,score:ue,stage:he}=X;A[ce]=X;let Re={finishingPositionRange:ie,finishingRound:me,stageSequence:It,roundPosition:pe,collectionId:it,roundNumber:Fe,structureId:De,schedule:je,eventId:ke,drawId:Pe,score:ue,stage:he};g2({...Re,...R,matchUpStatus:fe,winningSide:de,matchUpType:Ie,matchUpId:ce,sides:ne});for(let xe of le){let{winningSide:Ce,sides:we=[],matchUpId:Ue,matchUpStatus:wt,matchUpType:Le}=xe;g2({...Re,...R,winningSide:Ce,tieWinningSide:de,matchUpTieId:ce,matchUpId:Ue,sides:we,matchUpSides:ne,matchUpStatus:wt,matchUpType:Le})}Array.isArray(ae)&&(H||y||v)&&((s=ae.flat().map(Tt).filter(Boolean))==null||s.forEach(xe=>{var Ce;(Ce=C(xe))==null||Ce.forEach(we=>{m[we]&&(m[we].potentialMatchUps[ce]=He({tournamentId:d==null?void 0:d.tournamentId,matchUpId:ce,eventId:ke,drawId:Pe}))}),(y||v)&&rJ({potential:!0,participantMap:m,participantId:xe,matchUpStatus:fe,roundPosition:pe,structureId:De,matchUpType:Ie,roundNumber:Fe,matchUpId:ce,schedule:je,drawId:Pe,score:ue})}))}M.push(...Q)}}if(b||g||y){let F=Object.values(m);for(let $ of F){let{wins:_,losses:L,[ii]:{wins:B,losses:V},[ei]:{wins:G,losses:j}}=$.counters,z=(q,W,Y)=>{let re=W+Y,K=W,H=re&&K/re;$.statistics[q]={denominator:re,numerator:K,statValue:H,statCode:q}};if(b&&(z(ZU,_,L),z(`${ZU}.${ii}`,B,V),z(`${ZU}.${ei}`,G,j)),g){let q=(W=[])=>Math.abs(W[0]-W[1]);for(let W of Object.keys($.draws)){let{orderedStructureIds:Y=[],flightNumber:re}=k[W]||{};if($.structureParticipation&&Y.length){let K,H=0,Q=Y.map(X=>{let ie=$.structureParticipation[X];if(!ie)return;K||(K=ie==null?void 0:ie.finishingPositionRange),q(K)>q(ie==null?void 0:ie.finishingPositionRange)&&(K=ie==null?void 0:ie.finishingPositionRange);let ae=ie.stage!==Ke;return ae&&(H+=1),He({...ie,participationOrder:ae?H:void 0,flightNumber:re})}).filter(Boolean);$.draws[W]&&($.draws[W].finishingPositionRange=K,$.draws[W].structureParticipation=Q)}}}if(y){let q=At(y)?y.scheduledMinutesDifference:0,W=$.scheduleItems||[],Y=$.potentialMatchUps||{},re=W.reduce((H,Q)=>{let{scheduledDate:X,scheduledTime:ie}=Q;return H[X]||(H[X]=[]),ie&&H[X].push(Q),H},{});Object.values(re).forEach(H=>H.sort(Y9));for(let H of W){let{typeChangeTimeAfterRecovery:Q,timeAfterRecovery:X,scheduledDate:ie,scheduledTime:ae}=H,le=re[ie],ne=xt(ae);for(let de of le){if(de.matchUpId===H.matchUpId||[Ft,Pt].includes(de.matchUpStatus)&&!de.checkScoreHasValue)continue;let Ie=H.matchUpType!==de.matchUpType&&Q||X,ce=H.drawId===de.drawId,ke=Y[H.matchUpId]&&Y[de.matchUpId],Pe=xt(de.scheduledTime),it=Math.abs(Pe-ne),It=Pe>=ne;if((q&&!isNaN(q)?it<=q:It&&xt(de.scheduledTime)<xt(Ie))&&!(ke&&ce)&&It){let me=[H.matchUpId,de.matchUpId].sort(XP).join("|");$.scheduleConflicts[me]={priorScheduledMatchUpId:H.matchUpId,matchUpIdWithConflict:de.matchUpId}}}}let K=$.participant.participantId;Object.keys($.scheduleConflicts).length&&N.push(K),m[K].scheduleConflicts=$.scheduleConflicts}}}return{participantIdsWithConflicts:N,eventsPublishStatuses:E,derivedEventInfo:O,derivedDrawInfo:k,mappedMatchUps:A,participantMap:m,matchUps:M}}function Rw({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var r;if(!Object.keys(t).length)return i;let{accessorValues:n,drawEntryStatuses:a,positionedParticipants:o,eventEntryStatuses:s,participantRoles:l,participantRoleResponsibilities:u,participantTypes:c,participantIds:d,signInStatus:p,enableOrFiltering:m,eventIds:h,genders:f}=t,g=Ul(h)&&((r=e==null?void 0:e.events)==null?void 0:r.filter(S=>h==null?void 0:h.includes(S.eventId)))||(e==null?void 0:e.events)||[],v=a&&X0e({drawEntryStatuses:a,tournamentEvents:g}),y=s&&J0e({eventEntryStatuses:s,tournamentEvents:g}),I=o!==void 0&&[!0,!1].includes(o)&&g.reduce((S,w)=>S.concat(...(w.drawDefinitions||[]).map(U=>hX({drawDefinition:U}).allPositionedParticipantIds).filter(Boolean)),[]),b=S=>n==null?void 0:n.reduce((w,U)=>{let{accessor:T,value:D}=U,{values:P}=om({element:S,accessor:T});return w&&(P==null?void 0:P.includes(D))},!0);if(i=i==null?void 0:i.filter(S=>{var w,U;let T=(U=(w=Do({element:S,itemType:uw}))==null?void 0:w.timeItem)==null?void 0:U.itemValue,{participantRoleResponsibilities:D,participantType:P,participantRole:C,participantId:R,person:N}=S,A=Array.isArray(f)&&(f==null?void 0:f.length)&&(N==null?void 0:N.sex)&&f.includes(N.sex);return m?f&&A||o&&I.includes(R)||o===!1&&!I.includes(R)||(v==null?void 0:v.includes(R))||(y==null?void 0:y.includes(R))||(d==null?void 0:d.includes(R))||p&&T===p||c&&P&&Ul(c)&&c.includes(P)||l&&C&&Ul(l)&&l.includes(C)||u&&Ul(D)&&Ul(u)&&u.find(M=>D==null?void 0:D.includes(M))||(n==null?void 0:n.length)&&Ul(n)&&b(S):(!f||A)&&(o===void 0||o&&I.includes(R)||o===!1&&!I.includes(R))&&(!v||v.includes(R))&&(!y||y.includes(R))&&(!d||d.includes(R))&&(!p||T===p)&&(!c||P&&Ul(c)&&c.includes(P))&&(!l||C&&Ul(l)&&l.includes(C))&&(!u||Ul(D)&&Ul(u)&&u.find(M=>D==null?void 0:D.includes(M)))&&(!(n!=null&&n.length)||Ul(n)&&b(S))}),g.length&&h){let S=g.filter(w=>h.includes(w.eventId)).map(w=>{let U=(w.entries||[]).map(D=>D.participantId);if(Xi(ol)(w.eventType))return U;let T=((e==null?void 0:e.participants)??[]).filter(D=>U.includes(D.participantId)).map(D=>D.individualParticipantIds).flat(1);return U.concat(...T)}).flat(1);i=i==null?void 0:i.filter(w=>S.includes(w.participantId))}return i}function Ul(t){return t&&Array.isArray(t)&&t.length}function X0e({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return dt(e.reduce((r,n)=>{var a,o;let{flightProfile:s}=Hi({event:n}),l=((a=s==null?void 0:s.flights)==null?void 0:a.map(({drawEntries:c})=>Array.isArray(c)?c.filter(i).map(Tt):[]).flat())||[],u=((o=n.drawDefinitions)==null?void 0:o.map(({entries:c})=>c?c.filter(i).map(Tt):[]))||[];return r.concat(...l,...u)},[]))}function J0e({eventEntryStatuses:t,tournamentEvents:e}){return dt(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Tt);return i.concat(...n)},[]))}function Ai(t){var e;let{withIndividualParticipants:i,participantFilters:r={},withPotentialMatchUps:n,withRankingProfile:a,convertExtensions:o,policyDefinitions:s,withScheduleItems:l,tournamentRecord:u,scheduleAnalysis:c,withSignInStatus:d,withTeamMatchUps:p,withScaleValues:m,usePublishState:h,contextProfile:f,withStatistics:g,withOpponents:v,withMatchUps:y,internalUse:I,withSeeding:b,withEvents:S,withDraws:w,withISO2:U,withIOC:T}=t;if(!u)return{error:ve};(y||a)&&ds({tournamentRecord:u});let D=RX({convertExtensions:o,tournamentRecord:u,withSignInStatus:d,withScaleValues:m,internalUse:I,withISO2:U,withIOC:T}),{participantMap:P}=D,C=K0e({withMatchUps:y??a,withEvents:S??a,withDraws:w??a,withPotentialMatchUps:n,participantFilters:r,withRankingProfile:a,convertExtensions:o,withScheduleItems:l,policyDefinitions:s,tournamentRecord:u,scheduleAnalysis:c,withTeamMatchUps:p,usePublishState:h,withStatistics:g,participantMap:P,withOpponents:v,contextProfile:f,withSeeding:b}),{participantIdsWithConflicts:R,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:M,mappedMatchUps:E}=C,O=C.matchUps;P=C.participantMap;let k=c??n,x=({potentialMatchUps:V,scheduleConflicts:G,scheduleItems:j,participant:z,statistics:q,opponents:W,matchUps:Y,events:re,draws:K})=>{let H=Object.values(K),Q=Object.values(W);return v&&(H==null||H.forEach(X=>{X.opponents=Q.filter(ie=>ie.drawId===X.drawId)})),He({...z,scheduleConflicts:c?Object.values(G):void 0,draws:w||a?H:void 0,events:S||a?Object.values(re):void 0,matchUps:y||a?Object.values(Y):void 0,opponents:v?Q:void 0,potentialMatchUps:k?Object.values(V):void 0,statistics:g?Object.values(q):void 0,scheduleItems:l?j:void 0},!1,!1,!0)},F=new Map;for(let V of Object.keys(P))F.set(V,x(P[V]));let $=[...F.values()],_=(e=s==null?void 0:s[hv])==null?void 0:e.participant,L=Rw({participants:$,participantFilters:r,tournamentRecord:u});if(i){let V=At(i)?i:void 0;for(let G of L)for(let j of G.individualParticipantIds??[]){let z=P[G.participantId].participant;z!=null&&z.individualParticipants||(z.individualParticipants=[]),G.individualParticipants||(G.individualParticipants=[]);let q=F.get(j),W=V?Nm({template:V,source:q}):q;z!=null&&z.individualParticipants&&z.individualParticipants.push(W),G.individualParticipants.push(W)}}let B=_?L.map(V=>Nm({source:V,template:_})):L;return{participantMap:t.returnParticipantMap!==!1?P:void 0,mappedMatchUps:t.returnMatchUps!==!1?E:void 0,matchUps:t.returnMatchUps!==!1?O:void 0,missingParticipantIds:D.missingParticipantIds,participantIdsWithConflicts:R,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:M,participants:B,...Z}}function sm({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){var n;if(!e)return{error:$e};let a=(n=e.entries)==null?void 0:n.find(o=>o.participantId===t&&(!i||i===o.entryStatus)&&(!r||r===o.entryStage));return t&&a}function bv(t){var e,i,r,n,a,o,s,l,u;let{provisionalPositioning:c,drawDefinition:d,stageSequence:p,structureId:m,stage:h}=t;if(!d)return{error:$e};let{entryProfile:f}=pw({drawDefinition:d}),g=h&&p&&((r=(i=(e=f==null?void 0:f[h])==null?void 0:e.stageSequence)==null?void 0:i[p])==null?void 0:r.qualifiersCount)||h&&((n=f==null?void 0:f[h])==null?void 0:n.qualifiersCount)||0,v={};if(!m)return{qualifiersCount:g,roundQualifiersCounts:v};let{structure:y}=tt({drawDefinition:d,structureId:m}),I=(a=d.links)==null?void 0:a.filter(w=>{var U;return((U=w==null?void 0:w.target)==null?void 0:U.structureId)===(y==null?void 0:y.structureId)}),b=0;if(I!=null&&I.length)for(let w of I){let U=(o=tt({structureId:w.source.structureId,drawDefinition:d}))==null?void 0:o.structure;if((U==null?void 0:U.stage)===Ke){let T=w.source.roundNumber,D=w.target.roundNumber,P=0;if(U.structureType===_n){let C=((s=U.structures)==null?void 0:s.length)??0,R=((l=w.source.finishingPositions)==null?void 0:l.length)??0;P=C*R}else P=((u=qt({matchUpFilters:{roundNumbers:[T]},structure:U,afterRecoveryTimes:!1,provisionalPositioning:c,inContext:!1}).matchUps)==null?void 0:u.length)||0;v[D]||(v[D]=0),v[D]+=P,b+=P}}let S=Object.keys(v);if(S.length<=1){let w=S[0]||1;v[w]=Math.max(v[w]||0,g)}return b=Math.max(b,g),{qualifiersCount:b,roundQualifiersCounts:v}}function d0({stage:t,drawDefinition:e}){var i;let{entryProfile:r}=pw({drawDefinition:e});return((i=r==null?void 0:r[t])==null?void 0:i.drawSize)||0}function Z0e(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=d0({stage:n,drawDefinition:i}),{qualifiersCount:o}=bv({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-o}function nJ({stage:t,drawDefinition:e}){return!!(t===Fr||pL({stage:t,drawDefinition:e})&&d0({stage:t,drawDefinition:e}))}function aJ({entryStatus:t=ca,drawDefinition:e,stageSequence:i,stage:r}){if(t===Wo)return HSe({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...Z}:{error:u9};let n=Z0e({drawDefinition:e,stageSequence:i,stage:r}),a=zSe({drawDefinition:e,stage:r}),o=gM({entryStatus:ug,drawDefinition:e,stage:r}),s=gM({entryStatus:ca,drawDefinition:e,stage:r}),l=o+s,u=l>=n,c=n-l;return r!==Fr&&u?{error:aM}:t===ug?o<a?{...Z}:{error:aM}:{positionsAvailable:c,...Z}}function SL(t){let e=We(t,[{[$n]:!0,[G8]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=ca,entryStageSequence:n,entryStage:a=Ae,ignoreStageSpace:o,drawDefinition:s,entryPosition:l,participant:u,roundTarget:c,extensions:d,extension:p,drawType:m,event:h}=t,f="addDrawEntry";if(m!==Ga&&!nJ({stage:a,drawDefinition:s}))return te({result:{error:Sp},stack:f});let g=aJ({stageSequence:n,stage:a,drawDefinition:s,entryStatus:r});if(!o&&!g.success&&(!m||m!==Ga))return{error:g.error};if(p&&!ll({extension:p}))return te({result:{error:se},info:"Invalid extension",context:{extension:p},stack:f});let v=t.participantId||(u==null?void 0:u.participantId);if(!v)return te({result:{error:hr},stack:f});let y=r===Fu&&sm({participantId:v,drawDefinition:s,entryStatus:r}),I=a===Fr&&sm({participantId:v,drawDefinition:s,entryStage:a}),b=sm({participantId:v,drawDefinition:s}),S=r!==Fu&&a!==Fr&&b;if(S)return i?(ut({payload:{drawId:s.drawId,eventId:h==null?void 0:h.eventId,error:WI,participantId:v},topic:qF}),{...Z}):te({result:{error:WI},context:{participantId:v},stack:f});if(y||I)return te({context:{invalidEntry:S,invalidLuckyLoser:y,invalidVoluntaryConsolation:I},result:{error:lP},stack:f});let w=He({entryStageSequence:n,participantId:v,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&_t({element:w,extension:p}),c&&_t({extension:{name:"roundEntry",value:c},element:w}),s.entries||(s.entries=[]),s.entries.push(w),li({drawDefinition:s}),{...Z}}function Q0e(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=ca,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:o,drawDefinition:s,stageSequence:l,stage:u=Ae,roundTarget:c,extension:d,event:p}=t;if(!u)return{error:VK};if(!s)return{error:$e};if(!Array.isArray(o))return{error:ya};if(!nJ({stage:u,drawDefinition:s}))return{error:Sp};if(d&&!ll({extension:d}))return te({result:{error:se},info:"Invalid extension",context:{extension:d},stack:e});let m=aJ({drawDefinition:s,stageSequence:l,entryStatus:r,stage:u});if(!a&&!m.success)return{error:m.error};let h=m.positionsAvailable??0;if(!a&&u!==Fr&&h<o.length)return{error:Qx};let f=[],g=s.drawId,v=p==null?void 0:p.eventId,y=o.reduce((I,b)=>{let S=r===Fu&&sm({participantId:b,drawDefinition:s,entryStatus:r}),w=u===Fr&&sm({entryStage:u,drawDefinition:s,participantId:b}),U=sm({participantId:b,drawDefinition:s});return r!==Fu&&u!==Fr&&U&&(f.push(b),i&&ut({payload:{error:WI,participantId:b,eventId:v,drawId:g},topic:qF})),S||w?I.concat(b):I},[]);return f.length&&!i?te({context:{eventId:v,drawId:g,duplicateEntries:f},result:{error:WI},stack:e}):(o.filter(I=>I&&!y.includes(I)).forEach(I=>{let b={entryStageSequence:l,entryStage:u,participantId:I,entryStatus:r};d&&_t({element:b,extension:d}),c&&_t({extension:{name:Il,value:c},element:b}),s.entries||(s.entries=[]),s.entries.push(b)}),n&&(s.entries=ws({entries:s.entries})),li({drawDefinition:s}),y!=null&&y.length||f!=null&&f.length?{info:"some participantIds could not be added",participantIdsNotAdded:y,duplicateEntries:f,...Z}:{...Z})}function TL({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,entryStage:l,extension:u,drawId:c,event:d}){if(!(n!=null&&n.length))return{error:Zc};if(!d)return{error:mo};if(!c)return{error:xs};let p=(d.entries||[]).map(Tt);if(n.filter(f=>!p.includes(f)).length)return{error:$K};if(a){let f=Q0e({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,extension:u});if(f.error)return f}let{flightProfile:m}=Hi({event:d}),h=m==null?void 0:m.flights.find(f=>f.drawId===c);return h!=null&&h.drawEntries&&(n.forEach(f=>{let g=o===Fu&&jC({participantId:f,entryStatus:o,flight:h}),v=l===Fr&&jC({participantId:f,entryStage:l,flight:h});!(o!==Fu&&l!==Fr&&jC({flight:h,participantId:f}))&&!g&&!v&&h.drawEntries.push({participantId:f,entryStatus:o,entryStage:l})}),e&&(h.drawEntries=ws({entries:h.drawEntries}))),{...Z}}function jC({participantId:t,entryStatus:e,entryStage:i,flight:r}){var n;let a=(n=r.drawEntries)==null?void 0:n.find(o=>o.participantId===t&&(!e||e===o.entryStatus)&&(!i||i===o.entryStage));return t&&a}function Cw({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){var a,o,s,l;let u="removeEventEntries";if(!(n!=null&&n.eventId))return{error:vi};if(!Array.isArray(e)||e.some(f=>!Di(f)))return te({result:{error:Es},stack:u});let c=(n.drawDefinitions??[]).flatMap(f=>Np({drawDefinition:f}).assignedParticipantIds??[]),d=((i==null?void 0:i.length)&&((a=n.entries)==null?void 0:a.filter(f=>f.entryStatus&&i.includes(f.entryStatus)))||[]).map(Tt).filter(f=>!c.includes(f)),p=(r&&((o=n.entries)==null?void 0:o.filter(f=>f.entryStage&&f.entryStage===r))||[]).map(Tt).filter(f=>!c.includes(f));if(e.length?e=e.filter(f=>(!(i!=null&&i.length)||d.includes(f))&&(!r||p.includes(f))):d.length&&p.length?e=ji(d,p):d.length?e=d:p.length&&(e=p),(e==null?void 0:e.length)&&c.some(f=>e.includes(f)))return te({result:{error:sv},stack:u});if(!(e!=null&&e.length))return{...Z,participantIdsRemoved:[]};let m=[];n.entries=(n.entries??[]).filter(f=>{let g=!e.includes(f==null?void 0:f.participantId);return g||m.push(f.participantId),g}),t&&(n.entries=ws({entries:n.entries}));let{flightProfile:h}=Hi({event:n});return(s=h==null?void 0:h.flights)==null||s.forEach(f=>{f.drawEntries=(f.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(l=n.drawDefinitions)==null||l.forEach(f=>{f.entries=(f.entries??[]).filter(g=>!e.includes(g.participantId))}),{...Z,participantIdsRemoved:m}}var oJ={[Lr]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},wv=oJ;function Ks(t){var e,i;let{suppressDuplicateEntries:r=!0,entryStatus:n=ca,autoEntryPositions:a=!0,enforceGender:o=!0,entryStageSequence:s,policyDefinitions:l,entryStage:u=Ae,tournamentRecord:c,ignoreStageSpace:d,drawDefinition:p,roundTarget:m,extensions:h,extension:f,drawId:g,event:v}=t,y="addEventEntries";if(!Array.isArray(t.participantIds))return te({result:{error:ya},stack:y});let I=dt(t.participantIds??[]);if(!v)return{error:vi};if(!(I!=null&&I.length))return te({result:{error:Zc},stack:y});if(!(v!=null&&v.eventId))return{error:mo};let b=Bt({tournamentRecord:c,event:v}).appliedPolicies??{},S=(l==null?void 0:l[Lr])??(b==null?void 0:b[Lr])??wv[Lr],w=(o??((e=S==null?void 0:S.participants)==null?void 0:e.enforceGender))!==!1,U=[],T=[];if(h&&(!Array.isArray(h)||!h.every(O=>ll({extension:O})))||f&&!ll({extension:f}))return te({context:He({extension:f,extensions:h}),result:{error:se},info:"Invalid extension(s)",stack:y});let D=!!c,P=[],C,R=((i=c==null?void 0:c.participants)==null?void 0:i.filter(O=>{var k,x,F;if(!I.includes(O.participantId))return!1;let $=Xi(ii)(v.eventType)&&O.participantType===Dt&&!fd(n),_=v.eventType===ei&&O.participantType===ft;return $&&(!v.gender||!w||[jn,Ns].includes(v.gender)||v.gender===((k=O.person)==null?void 0:k.sex))||_&&!fd(n)||v.eventType===ei&&O.participantType===Dt&&fd(n)?!0:$&&v.gender&&w&&![jn,Ns].includes(v.gender)&&v.gender!==((x=O.person)==null?void 0:x.sex)?(P.push({participantId:O.participantId,sex:(F=O.person)==null?void 0:F.sex}),!1):v.eventType===Xt&&(O.participantType===Xt||fd(n)&&O.participantType===Dt)}).map(O=>O.participantId))??[],N=I.filter(O=>!D||R.includes(O));v.entries||(v.entries=[]);let A=v.entries.map(O=>{var k;return O.participantId||((k=O.participant)==null?void 0:k.participantId)});if(N.forEach(O=>{var k;if(!A.includes(O)){let x=He({participantId:O,entryStatus:n,entryStage:u,extensions:h});f&&_t({element:x,extension:f}),m&&_t({extension:{name:Il,value:m},element:x}),s&&(x.entryStageSequence=s),U.push(x.participantId),(k=v.entries)==null||k.push(x)}}),g&&!fd(u)){let O=TL({participantIds:N,suppressDuplicateEntries:r,autoEntryPositions:a,entryStageSequence:s,ignoreStageSpace:d,drawDefinition:p,entryStatus:n,roundTarget:m,entryStage:u,extension:f,drawId:g,event:v});O.error&&(C=O.error)}if(v.eventType&&[Mu,Ca].includes(v.eventType)){let O=(v.entries||[]).map($=>$.participantId),k=(v.entries||[]).filter($=>fd($.entryStatus)).map($=>$.participantId),x=((c==null?void 0:c.participants)??[]).filter($=>O.includes($.participantId)&&$.participantType&&[ft,Xt].includes($.participantType)).map($=>$.individualParticipantIds).flat(1/0),F=k.filter($=>x.includes($));F.length&&(T.push(...F),Cw({participantIds:F,autoEntryPositions:!1,event:v}))}if(N.length!==I.length)return te({context:{mismatchedGender:P,gender:v.gender},result:{error:ya},stack:y});a&&(v.entries=ws({entries:v.entries||[]}));let M=U.length,E=T.length;return te({result:{...Z,addedEntriesCount:M,removedEntriesCount:E},stack:y,info:C})}var sJ="ADMINISTRATION",eTe="CAPTAIN",tTe="COACH",en="COMPETITOR",lJ="MEDIA",uJ="MEDICAL",DL="OFFICIAL",cJ="OTHER",dJ="SECURITY",PL={ADMINISTRATION:sJ,CAPTAIN:eTe,COACH:tTe,COMPETITOR:en,MEDIA:lJ,MEDICAL:uJ,OFFICIAL:DL,OTHER:cJ,SECURITY:dJ};function RL({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return te({result:{error:ve},stack:a});if(!i||!e)return te({result:{error:Je},stack:a});let o=(r.participants??[]).find(c=>c.participantId===i);if(!o)return te({result:{error:Wi},stack:a});if(![Xt,Ja].includes(o.participantType))return te({result:{participantType:o.participantType,error:Ms},stack:a});let s=pJ({individualParticipantIds:e,groupingParticipant:o,tournamentRecord:r,suppressErrors:n}),{removed:l,error:u}=s;if(u)return te({result:s,stack:a});if(t)for(let c of r.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(m=>!d.includes(m));Ks({participantIds:p,entryStatus:Po,tournamentRecord:r,event:c})}}return l&&ut({topic:on,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...Z,...s}}function pJ({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){var o,s;let l=[];if(!e)return{removed:l};let u=[],c=[];a||({participants:a,mappedMatchUps:n}=Ai({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let d=(s=(o=a==null?void 0:a.find(({participantId:h})=>h===e.participantId))==null?void 0:o.events)==null?void 0:s.map(({eventId:h})=>h),p=(e.individualParticipantIds??[]).filter(h=>{var f;let g=t==null?void 0:t.includes(h),v=g&&((f=a==null?void 0:a.find(I=>I.participantId===h))==null?void 0:f.matchUps.filter(({eventId:I})=>d.includes(I)).map(({matchUpId:I})=>n==null?void 0:n[I]).filter(({winningSide:I,score:b})=>I||yr({score:b}))),y=g&&!(v!=null&&v.length);if(g&&!y&&c.push(h),y){l.push(h);for(let I of i.events??[])for(let b of I.drawDefinitions??[]){let{extension:S}=vt({element:b,name:ku}),w=S==null?void 0:S.value[e.participantId];S&&w&&(S.value[e.participantId]=w.filter(T=>T.participantId!==h),_t({element:b,extension:S}),lw({drawDefinition:b}));let U=Pn({drawDefinition:b,inContext:!1}).matchUps??[];for(let T of U){let D=T.sides??[];for(let P of D){let C=P.lineUp??[];C.find(R=>R.participantId===h)&&(P.lineUp=C.filter(R=>R.participantId!==h),Ct({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:b,matchUp:T}))}}}}else u.push(h);return!y});e.individualParticipantIds=p;let m={groupingParticipantId:e.participantId,cannotRemove:c,notRemoved:u,removed:l};return c.length&&!r&&{...m,cannotRemove:c,error:oP}||m}function JP({participantRole:t=en,individualParticipantIds:e=[],groupingTypes:i=[Gn,Ja],tournamentRecord:r}){if(!r)return{error:ve};let n=r.participants??[],{participants:a,mappedMatchUps:o}=Ai({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),s=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=pJ({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:o,participants:a});u&&s++}),s?Z:{error:n9}}function xh(t){var e,i;let r=We(t,[{[wr]:!0},{participantIds:!0,[Jn]:cn,[zo]:Zc}]);if(r.error)return r;let{addIndividualParticipantsToEvents:n,tournamentRecord:a,participantIds:o}=t,s=((e=a.participants)==null?void 0:e.length)||0;if(!s)return{...Z};let l=(i=a.events||[])==null?void 0:i.filter(({eventType:g})=>g===ur).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),u=Ai({participantFilters:{participantIds:o},tournamentRecord:a,withDraws:!0}).participants??[],c=g=>{let v=(Gr({matchUpFilters:{drawIds:g,matchUpTypes:[ei]},tournamentRecord:a}).matchUps??[]).flatMap(({sides:y})=>y==null?void 0:y.map(({participantId:I})=>I||[])).filter(Boolean);return ji(v,o)},d=l!=null&&l.length?c(l):[],p=u.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(l!=null&&l.length)||!(l!=null&&l.includes(y.drawId)))&&y.positionAssignments).length});if(d!=null&&d.length||p.length)return{error:sv};let m={},h={};for(let g of a.events||[]){let v=Cw({participantIds:o,event:g});if(v.error)return v;m[g.eventId]=v.participantIdsRemoved}a.participants=(a.participants??[]).filter(g=>{var v,y;let I=o.includes(g.participantId)||g.participantType===ft&&((v=g.individualParticipantIds)==null?void 0:v.some(b=>o.includes(b)));if(!I&&g.participantType===ur&&(y=g.individualParticipantIds)!=null&&y.some(b=>o.includes(b))&&(g.individualParticipantIds=g.individualParticipantIds.filter(b=>!o.includes(b))),I&&n&&g.participantType&&[ft,Xt].includes(g.participantType))for(let b of g.individualParticipantIds||[])o.includes(b)||(h[g.participantId]||(h[g.participantId]=[]),h[g.participantId].push(b));return!I});let f=s-a.participants.length;if(JP({individualParticipantIds:o,tournamentRecord:a}),n)for(let g of a.events||[]){let v=m[g.eventId].map(y=>h[y]||[]).flat();Ks({participantIds:v,entryStatus:Po,tournamentRecord:a,event:g})}return f&&ut({payload:{participantIds:o,tournamentId:a.tournamentId},topic:YF}),f?{...Z,participantsRemovedCount:f}:{error:oP}}function mJ({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){var o;let s=n.entries??[];if(r){let{flightProfile:u}=Hi({event:n}),c=(o=u==null?void 0:u.flights)==null?void 0:o.find(d=>d.drawId===r);c?s=c.drawEntries:e.entries&&(s=e==null?void 0:e.entries)}let l=s.filter(u=>(!(i!=null&&i.length)||!u.entryStatus||i.includes(u.entryStatus))&&(!a||!u.entryStage||u.entryStage===a)&&(!t||u.entryStatus&&cs.includes(u.entryStatus)));return{entries:s,stageEntries:l}}function hJ({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:o}){var s;let l="destroyGroupEntry";if(!e)return{error:ve};if(!r)return te({result:{error:hr},stack:l});if(!o)return{error:vi};if(!o.eventType||![Mu,Ca].includes(o.eventType))return te({result:{error:Gl},stack:l});let u=e.participants??[],c=u.find(y=>y.participantId===r);if(!c)return te({result:{error:Wi},stack:l});if(!c.participantType||![ft,Gn].includes(c.participantType)||c.participantType===Gn&&o.eventType!==Ca||c.participantType===ft&&o.eventType!==Mu)return{error:Ms};let d=(o.entries??[]).find(y=>y.participantId===r);if(!d)return{error:l9};let{stageEntries:p}=mJ({selected:!1,drawDefinition:i,drawId:n,event:o,stage:a}),m=p.map(Tt),h=u.filter(({participantId:y})=>m.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),f=(s=c.individualParticipantIds)==null?void 0:s.filter(y=>qs(y,h).length===1),g=Cw({participantIds:[r],event:o});if(g.error||f!=null&&f.length&&(g=Ks({participantIds:f,entryStatus:Po,entryStage:d.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:o}),g.error))return g;let v;return t&&xh({participantIds:[r],tournamentRecord:e}).success&&(v=!0),{...Z,participantRemoved:v}}function CL({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return hJ({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function fJ(t){if(!t.tournamentRecord)return{error:ve};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let o=hJ({participantId:a,...i});o.success&&(r+=1),o.error&&n.push(o.error)}return r?{destroyedCount:r,...Z}:{error:n}}function dy(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:o,drawId:s}=t,l="removeDrawPositionAssignment",u=Dw(t);if(u.error)return te({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:m}=t,h=Bt({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([Wo,Yl].includes(a)&&c){let{tournamentRecord:g}=t,{participant:v}=nd({tournamentRecord:g,participantId:c}),{participantType:y,individualParticipantIds:I}=v??{};if(n&&y===ft){let b=CL({tournamentRecord:g,drawDefinition:r,participantId:c,event:p});if(b.error)return te({result:b,stack:l});I&&c0({participantIds:I,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:s,event:p})}else c0({participantIds:[c],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:s,event:p})}if(i){let g=Qa({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:m,matchUpsMap:o,event:p});if(g.error)return te({result:g,stack:l})}let{structure:f}=tt({drawDefinition:r,structureId:m});return aL({structure:f,drawPositions:[d]}),$P({appliedPolicies:h,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:m}}),u}function gJ(t){return Object.assign(t,{entryStatus:Yl}),dy(t)}function SM(t){return Di(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function tn(t){return Di(t)?SM(t.replace(/_/g," ")):""}var bc=({finishingPosition:t=Uh,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:r=[],stageSequence:n=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:u,matchUpType:c,matchUps:d=[],structureId:p,roundOffset:m,roundLimit:h,stageOrder:f,structures:g,stage:v})=>{let y={structureId:p??Ht(),structureAbbreviation:i,finishingPosition:t,seedAssignments:r,matchUpFormat:s,stageSequence:n,structureName:u};a&&(y.structureOrder=a),l&&(y.structureType=l),o&&(typeof o=="string"?y.seedingProfile=o:typeof o=="object"&&typeof o.positioning=="string"&&(y.seedingProfile=o.positioning)),c&&(y.matchUpType=c),m&&(y.roundOffset=m),f&&(y.stageOrder=f),h&&(y.roundLimit=h),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let I=d.flatMap(({drawPositions:b})=>b).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=dt(I).sort((b,S)=>b-S).map(b=>({drawPosition:b}))),y},so=bc;function EL({structureName:t=tn(Fr),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:$e};let a=so({stage:Fr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),li({drawDefinition:i,structureIds:[a.structureId]}),{...Z}}function ML({drawPositions:t}){if(!(t!=null&&t.length))return{error:Wb};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=dt(i.map(ZP)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function ZP(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(lr).join("|")}function vJ({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,m)=>m),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),o=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{n[p].push([a[v],o[v]])});let m=a.shift(),h=a.pop(),f=o.shift();a=[m,f,...a].filter(Boolean),o=[...o,h].filter(Boolean)});let s=a.shift(),l=a.pop(),u=o.shift();a=[s,u,...a].filter(Boolean),o=[...o,l].filter(Boolean);let c=d=>d[0].reduce((p,m)=>p+m);return[...n].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(m=>m<=t)).map(p=>{let m=p.map(h=>h+e);return ZP(m)}))}function iTe({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Je}}var rTe={getRoundRobinGroupMatchUps:ML,determineRoundNumber:iTe,drawPositionsHash:ZP,groupRounds:vJ};function Ew(t){var e;let{groupNameBase:i="Group",playoffAttributes:r,stageSequence:n=1,structureOptions:a,appliedPolicies:o,seedingProfile:s,stage:l=Ae,matchUpType:u,roundTarget:c,structureId:d,groupNames:p,drawSize:m,idPrefix:h,isMock:f,uuids:g}=t,v=t.structureName??((e=r==null?void 0:r[0])==null?void 0:e.name)??tn(Ae),{groupCount:y,groupSize:I}=nTe({structureOptions:a,appliedPolicies:o,drawSize:m}),b=Kd,S,w=Te(1,y+1).map(T=>{let D=aTe({groupSize:I,structureOrder:T,matchUpType:u,drawSize:m,idPrefix:h,isMock:f});S=Array.isArray(D)?Math.max(...D.map(({roundNumber:C})=>C??0)):0;let P=(p==null?void 0:p[T-1])??`${i} ${T}`;return bc({structureId:g==null?void 0:g.pop(),structureType:UP,finishingPosition:b,structureOrder:T,structureName:P,matchUps:D})}),U=bc({structureId:d??(g==null?void 0:g.pop()),structureType:_n,finishingPosition:b,seedingProfile:s,structureName:v,stageSequence:n,structures:w,stage:l});return c&&_t({extension:{name:Il,value:c},element:U}),{structures:[U],maxRoundNumber:S,groupCount:y,links:[],groupSize:I,...Z}}function nTe({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e==null?void 0:e.groupSize,n=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=Mw({groupSizeLimit:n,drawSize:i}),o=a&&Math.max(...a);r&&a!=null&&a.includes(r)||(r&&r>4||!(a!=null&&a.includes(4))?r=o:r=4);let s=Math.ceil(i/r);return{groupSize:r,groupCount:s}}function Mw(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=Te(3,e+1).filter(n=>{let a=Math.ceil(i/n),o=a*n-i,s=Math.ceil(i/a),l=Math.ceil(o/a);return(!o||o<n)&&s===n&&s>=3&&l<2});return{...Z,validGroupSizes:r}}function aTe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:o}){let s=(t-1)*i,l=Te(1+s,i+1+s),u=ML({drawPositions:l}).uniqueMatchUpGroupings??[],c=vJ({groupSize:i,drawPositionOffset:s});return u.map(p).sort((m,h)=>(m.roundNumber??1/0)-(h.roundNumber??1/0));function d(m){return c.reduce((h,f,g)=>f.includes(m)?g+1:h,void 0)}function p(m){let h=ZP(m),f=d(h),g=[1,r],v=oTe({structureOrder:t,drawPositions:m,roundNumber:f,idPrefix:n,uuids:o}),y={matchUpStatus:f?Zi:jt,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:m,roundNumber:f,matchUpId:v};return a&&(y.isMock=!0),y}}function oTe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:(n==null?void 0:n.pop())||Ht()}function NL(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!st(i))return{seedBlocks:void 0,...te({result:{error:se},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=iv(i);if(e){let m=Math.min(e,n),h=[],f=1;for(Te(0,m).forEach(()=>{h.push([f]),f++});f<n;){let g=Te(f,f+m);f+=m,h.push(g)}return{...Z,seedBlocks:h}}let a=Te(1,n+1),o=[],s=n/2;for(;s>1;){let m=Cr(a,s),h=m.length;m.forEach((f,g)=>{let v,y=g<h/2,I=g%2===0,b=f[0],S=f[f.length-1];r&&h>4?h===8?v=y?S:b:v=I?b:S:v=y?b:S,Nn(f,o)||o.push(v)}),s=s/2}let l=a.filter(m=>!o.includes(m));for(;l.length;)l.length%2===0?o.push(l.pop()):o.push(l.shift());let u=Te(0,20).map(m=>Math.pow(2,m));u.unshift(1);let c=u.indexOf(n),d=0,p=[];return Te(0,c).forEach(m=>{p.push(o.slice(d,d+u[m])),d+=u[m]}),{...Z,seedBlocks:p}}function AL({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!st(e))return{seedGroups:void 0,...te({result:{error:se},context:{drawSize:e},stack:i})};if(t){if(!st(t))return{seedGroups:void 0,...te({context:{roundRobinGroupsCount:t},result:{error:se},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:Te(0,n).map(()=>{let a=Te(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=NL({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function OL({roundRobinGroupsCount:t,participantsCount:e}){var i;if(t){let{validGroupSizes:a}=Mw({drawSize:e});if(!((i=a==null?void 0:a.map(o=>Math.ceil(e/o)))!=null&&i.includes(t)))return te({context:{roundRobinGroupsCount:t},result:{error:se}})}let{seedGroups:r}=AL({drawSize:e,roundRobinGroupsCount:t}),n=(r==null?void 0:r.map(a=>Math.min(...a)))||[];return{...Z,seedingThresholds:n}}function dg(t){if(!t)return 1/0;if(st(t))return Qe(t);let e=t.split("-")[0];return st(e)?Qe(e):1/0}function sTe({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(lr),e.reverse(),e}function lTe({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function uTe({positioning:t,size:e}){let i=sTe({size:e}),r=[],n=[],a=p=>p[0],o=p=>p[p.length-1],s=(p,m)=>(t&&[wP,qd].includes(t)&&m%2?o(p):a(p))||a(p),l=(p,m)=>{if(p.every(h=>!n.includes(h))){let h=s(p,m);return n.push(h),h}},u=p=>{let m=p.filter(h=>!n.includes(h));if(m.length)return n.push(...m),m},c=(p,m)=>{let h=s(p,m);if(!n.includes(h))return n.push(h),h},d=Te(1,e+1);for(let p of i)if(p===1){let m=Cr(d,2),h=m.map(l).filter(Boolean);h.length&&r.push(h);let f=m.flatMap(u).filter(Boolean);f.length&&r.push(f)}else{let m=Cr(d,p).map(c).filter(Boolean);m.length&&r.push(m)}return{divisions:i,divisionGroupings:r}}function Fh({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:o}){var s;let l=[];if(!o)return{error:Up};let{matchUps:u,roundMatchUps:c}=qt({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:d}=go({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:o}),{positionAssignments:p}=Er({structure:o}),m=p==null?void 0:p.length,h=(d==null?void 0:d.length)??0,f=[],g=Object.keys(c).map(O=>parseInt(O)).sort((O,k)=>O-k).map(O=>{let k=c[O].map(F=>F.drawPositions).flat(1/0).filter(Boolean),x=k.filter(F=>!f.includes(F));return f=f.concat(...k),x}).filter(O=>O.length).reverse(),v=g.pop()??[],y=v&&Math.min(...v)-1||0;r=r??((s=i==null?void 0:i.seeding)==null?void 0:s.seedingProfile);let I=(v==null?void 0:v.length)||0,b=g.filter(O=>O.filter(k=>k<=h).length),{stage:S,structureType:w,roundLimit:U}=o,T=w===_n,D=!T&&(g==null?void 0:g.length),P=!T&&S===Ke&&U,C=b.flat(1/0),R=D?C==null?void 0:C.length:0,N=a?m:h,A=mL({drawDefinition:n,structure:o,matchUps:u}),M=A?0:!D&&N||N&&C.length<N&&N-C.length||0;if(P){let O=o!=null&&o.matchUps?o.matchUps.filter(({roundNumber:x})=>x===o.roundLimit).length:0,k=v.length/O;if(!D){let x=Nw(r),F=Cr(v,k),$=1,_=Te(0,F[0].length).map(()=>{let L=Te($,$+F.length);return $+=F.length,L});({validSeedBlocks:l}=IJ({drawPositionBlocks:F,nonRandom:r==null?void 0:r.nonRandom,positioning:x,seedGroups:_}))}}else T?{validSeedBlocks:l}=cTe({nonRandom:r==null?void 0:r.nonRandom,seedingProfile:r,structure:o}):D?l=b.map(O=>({seedNumbers:O,drawPositions:O})):A&&Cr(v,2).map((O,k)=>({drawPositions:[O[0]],seedNumbers:[k+1]})).forEach(O=>l.push(O));if(!T&&!A&&!P){let{blocks:O}=dTe({drawPositionOffset:y,seedNumberOffset:R,seedCountGoal:M,seedingProfile:r,baseDrawSize:I});O.forEach(k=>l.push(k))}let E=l.flatMap(O=>O.drawPositions).reduce((O,k)=>(v==null?void 0:v.includes(k))&&O,!0);return!A&&!D&&!T&&!E?{error:xK,validSeedBlocks:[],isContainer:T,isFeedIn:D}:{isLuckyStructure:A,validSeedBlocks:l,isContainer:T,isFeedIn:D}}function cTe({seedingProfile:t,structure:e,nonRandom:i}){var r;let n=e.structures||[],a=n.length,o=(r=oi({structure:e}))==null?void 0:r.positionAssignments,s=Nw(t),l=(o==null?void 0:o.length)??0,{seedGroups:u}=AL({roundRobinGroupsCount:a,drawSize:l}),c=n.map(d=>{var p;return(p=oi({structure:d}).positionAssignments)==null?void 0:p.map(m=>m.drawPosition)});return IJ({drawPositionBlocks:c,positioning:s,seedGroups:u,nonRandom:i})}function IJ({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=uTe({size:i.length,positioning:e}),o=[];return i.forEach((s,l)=>{let u=lTe({blockPattern:a,index:l});s.forEach((c,d)=>{let p=l%2?t.length-d-1:d,m=t[p].slice().filter((f,g)=>u.includes(g+1)&&f);e!==qd?m=r?m:Tn(m):l%2&&m.reverse();let h=m.find(f=>!o.includes(f));h&&(o.push(h),n.push({drawPositions:[h],seedNumbers:[c]}))})}),{validSeedBlocks:n}}function dTe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:o}=t,s=1,l=[],{seedBlocks:u}=NL({cluster:Nw(n)===wP,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let d of u){if(s+1>a)break;let p=d.map(h=>h+e),m=c(s+1,d.length).map(h=>+h+r);s+=d.length,l.push({drawPositions:p,seedNumbers:m})}return{blocks:l};function c(d,p){return Array.from(new Array(p),(m,h)=>h+d)}}function p0({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){var o,s,l,u,c,d;let{structure:p}=tt({drawDefinition:e,structureId:n});t||(t=Bt({drawDefinition:e}).appliedPolicies);let m=i==null?void 0:i.validSeedBlocks;return!m&&p&&(m=(o=Fh({appliedPolicies:t,drawDefinition:e,structure:p}))==null?void 0:o.validSeedBlocks),(l=(s=t==null?void 0:t.seeding)==null?void 0:s.validSeedPositions)!=null&&l.ignore?!0:(c=(u=t==null?void 0:t.seeding)==null?void 0:u.validSeedPositions)!=null&&c.strict?(((d=m.find(h=>h.seedNumbers.includes(a)))==null?void 0:d.drawPositions)||[]).includes(r):[].concat(...m.map(h=>h.drawPositions)).includes(r)}function yJ(t){var e,i,r;let{provisionalPositioning:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,structureId:l,randomize:u}=t,{structure:c}=tt({drawDefinition:a,structureId:l}),{seedAssignments:d}=go({returnAllProxies:t.returnAllProxies,provisionalPositioning:n,drawDefinition:a,structure:c}),{positionAssignments:p}=Er({structure:c}),m=(e=p==null?void 0:p.filter(M=>M.participantId??M.bye??M.qualifier))==null?void 0:e.map(M=>M.drawPosition).filter(Boolean),{appliedPolicies:h}=Bt({drawDefinition:a}),f=((s==null?void 0:s.validSeedBlocks)||c&&((i=Fh({returnAllProxies:t.returnAllProxies,provisionalPositioning:n,appliedPolicies:h,drawDefinition:a,seedingProfile:o,structure:c}))==null?void 0:i.validSeedBlocks)||[]).filter(M=>M.drawPositions.filter(E=>!(m!=null&&m.includes(E))).length)[0],g=d==null?void 0:d.map(M=>M.participantId).filter(Boolean),v=p==null?void 0:p.map(M=>M.participantId).filter(Boolean),y=g==null?void 0:g.filter(M=>v==null?void 0:v.includes(M)),I=g==null?void 0:g.filter(M=>!(v!=null&&v.includes(M))),b=d==null?void 0:d.filter(M=>I==null?void 0:I.includes(M.participantId)),S=d==null?void 0:d.filter(M=>!M.participantId),w=(b!=null&&b.length&&b.length>0?b.length:(S==null?void 0:S.length)??0)&&(f==null?void 0:f.drawPositions.filter(M=>!(m!=null&&m.includes(M))))||[],U=u?Tn(w):w,T=[],D=U.map(()=>{var M;let E=(M=A(b,T))==null?void 0:M.participantId;return E&&T.push(E),E}).filter(Boolean),P=d==null?void 0:d.filter(M=>y==null?void 0:y.includes(M.participantId)).map(M=>M.seedNumber),C=((f==null?void 0:f.seedNumbers)||[]).filter(M=>!(P!=null&&P.includes(M))),R=d==null?void 0:d.filter(M=>C.includes(M.seedNumber)).map(M=>M.participantId),N=(r=h==null?void 0:h.seeding)==null?void 0:r.duplicateSeedNumbers;return{nextSeedBlock:f,unplacedSeedParticipantIds:N===void 0||N?D:R,unplacedSeedNumbers:C,unfilledPositions:U,unplacedSeedAssignments:b};function A(M,E){let O=M.filter(F=>!E.includes(F.participantId)),k=Math.min(...O.map(F=>dg(F.seedValue))),x=O.filter(F=>dg(F.seedValue)===k);return Tn(x).pop()}}function Nw(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function Uv({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:u,event:c}){var d,p,m;let h="assignSeed",{structure:f}=tt({drawDefinition:i,structureId:o}),{positionAssignments:g}=Er({structure:f}),v=go({provisionalPositioning:t,drawDefinition:i,structure:f}).seedAssignments,y=v.map(T=>T.seedNumber),I=sm({drawDefinition:i,participantId:n});if(n&&!I)return te({result:{error:Es},context:{participantId:n},stack:h});let b=c?(p=(d=Hi({event:c}).flightProfile)==null?void 0:d.flights)==null?void 0:p.length:0,S=b&&b>1,w=(m=g==null?void 0:g.find(T=>T.participantId===n))==null?void 0:m.drawPosition;if(w&&!p0({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s}))return te({result:{error:$x},context:{assignedDrawPosition:w},info:"invalid seed position",stack:h});y.includes(s)||v.push({seedNumber:s,seedValue:l});let U;return v.forEach(T=>{T.participantId===n&&T.seedNumber!==s&&(T.participantId=void 0),T.seedNumber===s&&(T.participantId=n,!(r!=null&&r.groupSeedingThreshold)&&!S&&(T.seedValue=l??s),U=!0)}),U?(wX({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:f,eventId:u}),{...Z}):te({result:{error:kK},stack:h})}function kL({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:o}){var s,l,u,c;let d=(l=(s=t==null?void 0:t.sides)==null?void 0:s[e])==null?void 0:l.sideNumber,p=d&&((u=a.sides)==null?void 0:u.find(g=>g.sideNumber===d)),{extension:m}=vt({element:n,name:ku}),h=(m==null?void 0:m.value)||{},f=Ne(h[i],!1,!0);if(p)(c=a==null?void 0:a.sides)==null||c.forEach(g=>{g.sideNumber===d&&(g.lineUp=f)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(I=>I.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===d);g&&(g.lineUp=f)}Ct({tournamentId:r==null?void 0:r.tournamentId,context:"updateSidLineUp",eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUp:a})}function bJ(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,o=i.roundNumber>1&&i.roundNumber-1,s=Zd({structureId:r.structureId,matchUpsMap:n});!e&&a&&(e=s.find(({drawPositions:h,roundNumber:f})=>f===o&&(h==null?void 0:h.includes(a))));let l=e==null?void 0:e.roundPosition,u=l%2?1:-1,c=l+u,d=o&&s.find(({roundNumber:h,roundPosition:f})=>h===o&&f===c),p=d==null?void 0:d.matchUpStatus,m=[tr,dr].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:m}}function pTe({drawPosition:t,drawPositions:e}){let i=!1,r=!!(e!=null&&e.includes(t));return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(lr).filter(Boolean),positionAdded:i,positionAssigned:r}}function wJ({structureId:t,matchUpsMap:e,matchUp:i}){let r=i==null?void 0:i.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:Zd({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:s})=>o===(i==null?void 0:i.roundNumber)&&s===a)}}function UJ({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:o}=wJ({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:r});if(a&&o){let s=o==null?void 0:o.matchUpId,l=t.find(c=>c.matchUpId===s),u=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(c=>{let d=Di(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function iS({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,o)=>{var s;return(s=a.drawPositions)!=null&&s.includes(e)?o+1:n},void 0)}function pg({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:u}){var c,d,p,m;let h="assignMatchUpDrawPosition";s||(s=ln({drawDefinition:n})),t||(t=fr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[]);let f=t.find(E=>E.matchUpId===l),g=f==null?void 0:f.structureId,v=(c=n==null?void 0:n.structures)==null?void 0:c.find(E=>E.structureId===g);if(!v)return{error:Ni};let y=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(E=>E.matchUpId===l),I=(y==null?void 0:y.drawPositions)??[],{positionAdded:b,positionAssigned:S,updatedDrawPositions:w}=pTe({drawPositions:I,drawPosition:o}),{positionAssignments:U}=oi({drawDefinition:n,structure:v}),T=(p=U==null?void 0:U.filter(E=>w.includes(E.drawPosition)))==null?void 0:p.find(({bye:E})=>E),D=(y==null?void 0:y.matchUpStatus)&&[Ft,Pt].includes(y.matchUpStatus)&&w.filter(Boolean).length<2;if(a=T&&jt||a||D&&y.matchUpStatus||(y==null?void 0:y.matchUpStatus)&&[tr,dr].includes(y.matchUpStatus)&&y.matchUpStatus||Zi,y&&b){t=fr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[];let E=D&&iS({inContextDrawMatchUps:t,drawPosition:o,matchUpId:l})||void 0;y!=null&&y.matchUpStatusCodes&&UJ({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:s,matchUp:y}),Object.assign(y,{drawPositions:w,winningSide:E,matchUpStatus:a}),Ct({tournamentId:i==null?void 0:i.tournamentId,eventId:f==null?void 0:f.eventId,context:h,drawDefinition:n,matchUp:y})}let P=On({inContextDrawMatchUps:t,inContextMatchUp:f,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:C,loserMatchUp:R,loserTargetDrawPosition:N},targetLinks:{loserTargetLink:A}}=P,M=Zd({structureId:v.structureId,matchUpsMap:s});if(S&&T){if(C)if([jt,tr,dr].includes(a)){let E=pg({matchUpId:C.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(E.error)return E}else{let{structureId:E}=C;E!==v.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(C&&f&&!f.feedRound){let{pairedPreviousMatchUpIsDoubleExit:E}=bJ({targetMatchUp:y,drawPosition:o,matchUpsMap:s,structure:v});if(E){let O=pg({matchUpId:C.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(O.error)return O}}if((y==null?void 0:y.matchUpType)===fi){let E=t==null?void 0:t.find(({matchUpId:x})=>x===y.matchUpId),O=((E==null?void 0:E.sides)??[]).reduce((x,F,$)=>F.drawPosition===o?$:x,void 0),k=(m=U==null?void 0:U.find(x=>x.drawPosition===o))==null?void 0:m.participantId;k&&O!==void 0&&kL({inContextTargetMatchUp:E,drawPositionSideIndex:O,teamParticipantId:k,tournamentRecord:i,drawDefinition:n,matchUp:y})}if((A==null?void 0:A.linkCondition)===sl&&w.filter(Boolean).length===2&&!T&&M.filter(({drawPositions:E,roundNumber:O})=>O===1&&Nn(E,w)).every(({matchUpStatus:E})=>[Ki,Hr].includes(E))&&R){let{structureId:E}=R,O=Qa({drawPosition:N,tournamentRecord:i,drawDefinition:n,structureId:E,matchUpsMap:s,event:u});if(O.error)return O}return S?{...Z}:te({result:{error:Kf},context:{drawPosition:o},stack:h})}function SJ({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){var a,o,s,l;let u=((s=(o=(a=vv({drawDefinition:e}))==null?void 0:a.containedStructures)==null?void 0:o[n.structureId])==null?void 0:s.map(({structureId:h})=>h))||[];u.push(n==null?void 0:n.structureId);let c=(i==null?void 0:i.map(({drawPosition:h})=>h))||[],d=(t==null?void 0:t.filter(h=>u.includes(h.structureId)&&ji(h.drawPositions??[],c).length))??[],p=d.map(({matchUpId:h})=>h),m=((l=r==null?void 0:r.drawMatchUps)==null?void 0:l.filter(h=>p.includes(h.matchUpId)))??[];return{drawPositions:c,matchUps:m,targetMatchUps:d}}function xL({lineUp:t}){if(!Array.isArray(t))return;let e={};return dt(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:o}=l0({collectionPosition:a,collectionId:r,lineUp:t});o.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function tp(t){return`${t} must be an array`}function QP({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(tp("lineUp")),{valid:!1,errors:i,error:se};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:o,collectionAssignments:s}=a;return o?typeof o!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(tp("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=dt(t.map(Tt)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?se:void 0}}function Lh({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:$e};if(typeof e!="string")return{error:hr};let n=QP({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=vt({element:t,name:ku}),o=(a==null?void 0:a.value)||{};return o[e]=xL({lineUp:r}),_t({element:t,extension:{name:ku,value:o}}),lw({drawDefinition:t}),{...Z}}function FL({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:o,event:s}){if(!r)return{error:$e};let{drawPositions:l,matchUps:u,targetMatchUps:c}=SJ({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:o});for(let d of c)d.matchUpType===Ba&&(d.sides??[]).forEach((p,m)=>{var h;if(p!=null&&p.drawPosition&&l!=null&&l.includes(p.drawPosition)){let f=u.find(({matchUpId:g})=>g===d.matchUpId);if((h=f==null?void 0:f.sides)!=null&&h[m]){if(delete f.sides[m].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&Lh({drawDefinition:r,participantId:v,lineUp:[],tieFormat:g})}Ct({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:r,matchUp:f})}}});return{...Z}}function ul({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){var m,h,f,g,v;let y="assignDrawPosition";if(!s&&!i)return te({result:{error:hr},stack:y});c=c??ln({drawDefinition:a}),e||({matchUps:e}=fr({inContext:!0,drawDefinition:a,matchUpsMap:c}));let I=tt({drawDefinition:a,structureId:d});if(I.error)return te({result:I,stack:y});let{structure:b}=I;if(!b)return{error:Ni};if(Yn({structure:b}))return te({result:{error:la},stack:y});let{seedAssignments:S}=go({provisionalPositioning:t,drawDefinition:a,structure:b}),w=(m=S==null?void 0:S.find(M=>M.participantId===s))==null?void 0:m.seedNumber,{appliedPolicies:U}=Bt({tournamentRecord:n,drawDefinition:a,structure:b,event:p});if(w&&!p0({seedNumber:w,appliedPolicies:U,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return te({result:{error:$x},context:{drawPosition:u},stack:y});let T=Er({structure:b}).positionAssignments||[],D=T==null?void 0:T.find(M=>M.drawPosition===u);if(!D)return te({result:{error:rv},context:{drawPosition:u},stack:y});if(T!=null&&T.map(Tt).includes(s))return te({result:{error:sv},context:{drawPosition:u},stack:y});let{containsParticipant:P,containsBye:C}=A(D);if(C){let M=Dw({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(M.error)return te({result:M,stack:y})}if(P&&D.participantId!==s){let{activeDrawPositions:M}=Tw({drawDefinition:a,structureId:d});if(M.includes(u))return te({result:{error:tP},stack:y});FL({assignments:[D],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:b})}if(D.participantId=s,i&&(D.qualifier=!0),b.stage===Ae&&(!b.stageSequence||b.stageSequence>1)||b.stage&&[an,Bi].includes(b.stage)){let M=b.stage===Ke?Ke:Ae,E=(((f=(h=a.structures)==null?void 0:h.find(O=>(O==null?void 0:O.stage)===M&&(O==null?void 0:O.stageSequence)===1))==null?void 0:f.seedAssignments)??[]).find(O=>O.participantId===s);if(E!=null&&E.participantId){let{participantId:O,seedNumber:k,seedValue:x}=E;Uv({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:O,seedNumber:k,seedValue:x,structureId:d,event:p})}}if(b.structureType!==_n)mTe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:b,event:p});else{tJ({positionAssignments:T,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:b});let{drawPositions:M,matchUps:E,targetMatchUps:O}=SJ({assignments:[D],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:b});if(M&&(E==null?void 0:E.length)===1&&E[0].matchUpType===fi){let k=((O==null?void 0:O[0].sides)??[]).reduce((x,F,$)=>M!=null&&M.includes(F.drawPosition)?$:x,void 0);kL({inContextTargetMatchUp:O[0],teamParticipantId:s,matchUp:E[0],drawPositionSideIndex:k,tournamentRecord:n,drawDefinition:a})}}let R=(g=a.entries)==null?void 0:g.find(M=>M.participantId===s),N=(v=p==null?void 0:p.entries)==null?void 0:v.find(M=>M.participantId===s);return!R&&N&&SL({entryStatus:N.entryStatus,entryStage:b.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:s,event:p}),Fc({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:b,event:p}),{positionAssignments:T,...Z};function A(M){let E=M.bye,O=M.qualifier,k=M.participantId;return{containsBye:E,containsQualifier:O,containsParticipant:k,filled:E||O||k}}}function mTe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=qt({provisionalPositioning:t,matchUpFilters:u,drawDefinition:n,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:d}=An({matchUps:c}),{initialRoundNumber:p}=km({drawPosition:a,matchUps:c}),m=p&&(d==null?void 0:d[p].find(h=>{var f;return(f=h.drawPositions)==null?void 0:f.includes(a)}));if(m){let h=pg({matchUpId:m.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o});if(h.error)return te({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:h})}return{...Z}}function LL(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:$e};let d=Bt({tournamentRecord:n,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:m}=t;m||(m=ln({drawDefinition:a}),Object.assign(t,{matchUpsMap:m})),p||({matchUps:p}=fr({inContext:!0,drawDefinition:a,matchUpsMap:m}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:h}=oi({drawDefinition:a,structureId:l}),f=h==null?void 0:h.find(b=>b.drawPosition===s);if(f!=null&&f.participantId){let b=f.participantId,S=ul({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:u});return S.success?I({appliedPolicies:d,removedParticipantId:b}):te({result:S,stack:c})}let g=Dw({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:m,event:u});if(g.error)return te({result:g,stack:c});let v=g.participantId,y=ul({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:u});if(!y.success)return te({result:y,stack:c});return I({appliedPolicies:d,removedParticipantId:v});function I({appliedPolicies:b,removedParticipantId:S}){let{structure:w}=tt({drawDefinition:a,structureId:l});aL({drawPositions:[s],structure:w});let U={[e]:o,name:r,drawPosition:s,structureId:l};return $P({appliedPolicies:b,drawDefinition:a,positionAction:U}),te({context:{removedParticipantId:S},result:{...Z},stack:c})}}function hTe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return LL({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function TJ(t){return hTe(t)}function DJ({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let o of i.matchUps)e[o.matchUpId]&&(o.roundNumber=e[o.matchUpId],Ct({tournamentId:r==null?void 0:r.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:n,matchUp:o}))}function PJ(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=We(t,i);if(r.error)return r;let n=tt(t);if(n.error)return n;let a=n.structure;if(!Yn({structure:a}))return te({result:{error:wp,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=An({matchUps:a==null?void 0:a.matchUps});return s!=null&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Xu}}function RJ(t){var e;let i=PJ(t,[{targetRoundNumber:!0,roundNumber:!0,[Jn]:nSe}]);if(i.error)return i;let{structure:r,roundMatchUps:n,roundNumbers:a}=i,{targetRoundNumber:o,roundNumber:s}=t;if(!(a!=null&&a.includes(s))||!(a!=null&&a.includes(o)))return te({result:{error:se},info:"roundNumbers must be valid rounds"});let l=o>s,u=l?Te(s+1,o+1):Te(o,s),c={};return u.forEach(d=>((n==null?void 0:n[d])??[]).forEach(({matchUpId:p})=>{c[p]=d-(l?1:-1)})),(e=n==null?void 0:n[s])==null||e.forEach(({matchUpId:d})=>c[d]=o),DJ({params:t,modMap:c,structure:r}),{...Z}}function CJ({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){var a;if(!r)return{error:$e};if(!Array.isArray(t))return{error:se};let o="setPositionAssignments";for(let l of t){let{structureId:u,positionAssignments:c}=l;if(!c)continue;let d=tt({drawDefinition:r,structureId:u});if(d.error)return d;let p=d.structure;if(!p)return{error:Ni};let m=(a=oi({structure:p}).positionAssignments)==null?void 0:a.map(({drawPosition:v})=>v),h=c==null?void 0:c.map(({drawPosition:v})=>v);if(ji(m,h).length!==(m==null?void 0:m.length))return te({result:{error:se},info:"drawPositions do not match",stack:o});let f=ln({drawDefinition:r}),{matchUps:g}=fr({inContext:!0,drawDefinition:r,matchUpsMap:f});for(let v of c||[]){let{drawPosition:y,participantId:I,bye:b,qualifier:S}=v;if(b){let w=Qa({tournamentRecord:i,drawDefinition:r,drawPosition:y,matchUpsMap:f,structureId:u,structure:p,event:n});if(w!=null&&w.error)return w}else if(S)c.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(I){let w=ul({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:r,participantId:I,drawPosition:y,matchUpsMap:f,structureId:u,event:n});if(w!=null&&w.error)return w}}Fc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:p,event:n})}let s=t.map(({structureId:l})=>l);return li({tournamentId:i==null?void 0:i.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:r,structureIds:s}),{...Z}}function EJ(t){let e=PJ(t,[{roundNumbers:!0,[Jn]:cn,[Xr]:o=>o.length===2&&o.every(_i)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(o=>n==null?void 0:n.includes(o)))return te({result:{error:se,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((o,s)=>((r==null?void 0:r[o])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-s]})),DJ({params:t,modMap:a,structure:i}),{...Z}}function fTe({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return LL({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function MJ(t){return fTe(t)}function NJ({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return LL({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function AJ({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:o}){if(!i)return{error:$e};if(!n)return{error:Xa};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===r);if(e&&!s)return{error:Es};let{structure:l}=tt({drawDefinition:i,structureId:n});if(!l)return{error:Ni};if(!(!t||_i(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>_i(p)&&Qe(p)>0)))return{error:se};let{seedAssignments:u}=go({drawDefinition:i,structure:l}),c=u==null?void 0:u.map(p=>p.seedNumber),d=u==null?void 0:u.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(m=>parseInt(m)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return wX({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:i,structure:l}),{...Z}}function OJ({drawDefinition:t,structureId:e}){if(!t)return{error:$e};let{structure:i}=tt({drawDefinition:t,structureId:e}),r=((t==null?void 0:t.links)||[]).filter(n=>{var a;return((a=n.source)==null?void 0:a.structureId)===e}).map(n=>{var a;return(a=n.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(n=>r.includes(n.structureId)),structure:i}}function eR({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:o}){if(!a)return{error:vi};let s={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=rs({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:r,stages:n,stage:o});if(l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function _L({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:o}){if(!e)return{error:ve};let s={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=eR({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:u,stage:o});if(c&&l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function _c(t){if(!(t!=null&&t.drawDefinition))return!1;let e=KP(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r==null?void 0:r.filter(({matchUpType:o})=>o===fi),n=n==null?void 0:n.filter(({matchUpType:o})=>o===fi),a=a==null?void 0:a.filter(({matchUpType:o})=>o===fi)),!!(r!=null&&r.length&&!(n!=null&&n.length)&&!(a!=null&&a.length))}function $L(t){var e,i;let{drawDefinition:r,structureId:n}=t;if(!r)return{error:$e};let{playoffStructures:a}=OJ({drawDefinition:r,structureId:n});if(!(a!=null&&a.length))return!1;let o=((i=(e=r==null?void 0:r.entries)==null?void 0:e.filter(l=>(l==null?void 0:l.entryStatus)&&cs.includes(l.entryStatus)))==null?void 0:i.length)??0,s=0;return(a||[]).reduce((l,u)=>{var c;return!!((c=oi({structure:u}).positionAssignments??[])!=null&&c.filter(d=>(d.participantId&&s++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!a.length)||s===o}function TM({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i!=null&&i[n]){let o=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(s=>{let l=TM({accessors:o,significantCharacters:t,value:s});r.push(...l)});else if(i=i[n],o.length){let s=TM({accessors:o,significantCharacters:t,value:i});r.push(...s)}else a({value:i})}function a({value:o}){if(o&&["string","number"].includes(typeof o)){let s=t?o.slice(0,t):o;r.push(s)}}return r}function gTe({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:Kx};if(!Array.isArray(r))return{error:Kb};let n={};return t.forEach(a=>{let o=r.find(l=>l.participantId===a),{values:s}=kJ({policyAttributes:e,idCollections:i,participants:r,participant:o});s&&s.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function kJ({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:Kx};if(!r)return{error:vh};let n=[];return t.forEach(a=>{let{directive:o,groupings:s,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");n.push(...TM({significantCharacters:u,value:r,accessors:c}))}else if(o){let c=a==null?void 0:a.includeIds,d=((e==null?void 0:e[o])||[]).filter(p=>!c||c.includes(p));d!=null&&d.length&&i!=null&&i.length&&d.forEach(p=>{var m;let h=i.find(f=>f.participantId===p);if((m=h==null?void 0:h.individualParticipantIds)!=null&&m.includes(r.participantId)){let f=h==null?void 0:h.participantId;n.push(f)}})}else s&&Object.keys(s).forEach(c=>{s[c].includes(r.participantId)&&n.push(c)})}),{values:dt(n)}}function v2({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let o=n[a.participantId],{values:s}=kJ({participants:e,policyAttributes:i,idCollections:r,participant:o});return{...a,values:s}})}function xJ({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r==null?void 0:r.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,o=t?t[a]||[]:[],s=!!i.some(l=>o.includes(l));return{[n]:{participantGroups:o,includesGroupsToAvoid:s}}}))}function vTe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=xJ(t);return i.map(a=>{let o=e.filter(u=>a.includes(u)),s=n(o),l=o.filter(u=>!s.includes(u)).filter(u=>{var c;let d=I2(u);return!((c=r[d])!=null&&c.includesGroupsToAvoid)});return{unassigned:o,unpaired:s,pairedNoConflict:l}});function n(a){return a.filter(s=>!o(s));function o(s){let l=I2(s);return!a.includes(l)}}}function ITe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=xJ(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),o=a.length===n.length?a:[],s=n.filter(l=>{var u;return(u=r[l])==null?void 0:u.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:o,pairedNoConflict:s?[]:a,conflictsCount:s}})}function I2(t){return Number(t%2?t+1:t-1)}function yTe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function bTe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let o=r.map(s=>a?ITe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):vTe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:u}}else{let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length);return{unassigned:s,unpaired:l,pairedNoConflict:u}}}function FJ({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function wTe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){var a;let o=Object.assign({},...Object.keys(r).map(c=>[c,r[c].filter(d=>e.includes(d))]).filter(c=>c[1].length).map(([c,d])=>({[c]:d}))),s=Object.keys(o).reduce((c,d)=>o[d].length>c?o[d].length:c,0),l=Object.keys(o).filter(c=>o[c].length===s),u=Lo(i?l:Object.keys(o));return n=t&&(a=o[n])!=null&&a.length?n:u,{participantId:n&&o[n]?Lo(o[n]):Lo(e),groupKey:n}}function UTe({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function STe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:o,groupKey:s}){let l=n.reduce((T,D)=>D.length>T?D.length:T,0)<=2,u=FJ({positionAssignments:t,participantIds:e}),c=UTe({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=wTe({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:o,groupKey:s}),m=yTe({participantId:d,allGroups:o}),h=bTe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:m,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:c}),{unassigned:f,unpaired:g,pairedNoConflict:v}=h,y=(v==null?void 0:v.length)&&v[0],I=(g==null?void 0:g.length)&&g[0],b=a&&y?y:I,S=a?I:y,w=(b==null?void 0:b.length)&&b||(S==null?void 0:S.length)&&S,U;if(w!=null&&w.length){let T=ga(w);U=ga(T)}else{let T=ga(f[0]);U=ga(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:U}}function m0({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(s=>s.drawPosition),a=ML({drawPositions:n}).uniqueMatchUpGroupings??[],o=Object.assign({},...r.map(s=>({[s.drawPosition]:s})));a.forEach(s=>{Nn(o[s[0]].values||[],o[s[1]].values||[])&&(i.push(s),r.conflict=!0)})}):e.forEach(r=>{var n,a;Nn(((n=r[0])==null?void 0:n.values)||[],((a=r[1])==null?void 0:a.values)||[])&&(i.push(r),r.conflict=!0)}),i}function TTe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.map(a=>{let o=a.map(s=>s.drawPosition);return a.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(u=>!(o!=null&&o.includes(u))).filter(u=>{let c=i.find(f=>f.includes(u)).find(f=>f!==u),d=t.find(f=>f.drawPosition===c),p=m0({isRoundRobin:n,groupedParticipants:[[s,d]]}),m=[t.find(f=>f.drawPosition===u),d],h=m0({isRoundRobin:n,groupedParticipants:[m]});return!p.length&&!h.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function y2(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(I=>I==null?void 0:I.length).filter(Boolean)),p=d>2,m=Ne(e,!1,!0).filter(I=>!I.qualifier),h=e.filter(I=>!I.participantId&&(!I.bye||(n==null?void 0:n.includes(I.drawPosition)))).map(I=>I.drawPosition);Te(0,r).forEach(()=>{let{newGroupKey:I,selectedParticipantId:b,targetDrawPosition:S}=STe({...t,candidatePositionAssignments:m,allGroups:l,groupKey:c});c=I,m.forEach(w=>{w.drawPosition===S&&(w.participantId=b)})});let f=v2({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Cr(f,d),v=m0({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let I=TTe({positionedParticipants:f,potentialDrawPositions:h,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(I.length){let b=DTe({candidatePositionAssignments:m,swapOptions:I});b.error&&console.log({result:b}),f=v2({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Cr(f,d),v=m0({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return m.forEach(I=>{if(I.bye&&I.participantId){let b=eM;u.push(b)}if(I.qualifier&&I.participantId){let b=eM;u.push(b)}}),{positionAssignments:m,conflicts:v.length,groupedParticipants:g,errors:u}}function DTe({candidatePositionAssignments:t,swapOptions:e}){let i=ga(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=ga(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===r),o=t.find(u=>u.drawPosition===n)??{},s={participantId:o==null?void 0:o.participantId,qualifier:o==null?void 0:o.qualifier,bye:o==null?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...Z}}function PTe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){var m;if(!c)return{error:WK};let{candidatesCount:h=1,policyAttributes:f,targetDivisions:g}=c,{roundsToSeparate:v}=c,y="randomUnseededSeparation",{structure:I}=tt({drawDefinition:a,structureId:u}),{matchUps:b}=qt({provisionalPositioning:t,matchUpsMap:l,structure:I,event:p});if(g&&Cs(g)&&!v){let _=owe(g)||0,L=b.reduce((B,V)=>V.roundNumber>B?V.roundNumber:B,0);v=L<_?1:L-_+1}let{positionAssignments:S}=Er({structure:I}),w=oL({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,U=S==null?void 0:S.filter(_=>!_.participantId),T=S==null?void 0:S.map(_=>_.drawPosition),D=(I==null?void 0:I.structureType)===_n,P=D?{structure:I,matchUps:b,allDrawPositions:T,roundsToSeparate:v}:{matchUps:b,allDrawPositions:T,roundsToSeparate:v},{drawPositionGroups:C,drawPositionChunks:R}=D?RTe(P):CTe(P),N={groupParticipants:s.filter(_=>_.participantType===Ja).map(_=>_.participantId),teamParticipants:s.filter(_=>_.participantType===Xt).map(_=>_.participantId),pairParticipants:s.filter(_=>_.participantType===ft).map(_=>_.participantId)},A=gTe({targetParticipantIds:e,policyAttributes:f,idCollections:N,participants:s});if(A.error)return te({result:A,stack:y});let M=Object.assign({},...e.map(_=>{let L=Object.keys(A).filter(B=>(A[B]??[]).includes(_));return{[_]:L}})),E=FJ({participantIds:e,positionAssignments:S});if(E.length>((U==null?void 0:U.length)||0))return{error:eF};let O,k=E.length,x=Te(0,h).map(()=>y2({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:k,pairedPriority:!1,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:R,drawPositionGroups:C,policyAttributes:f,idCollections:N,allGroups:A,drawSize:d}));if(O=x.reduce((_,L)=>!_||(L.conflicts||0)<(_.conflicts||0)?L:_,void 0),!O||O.conflicts){let _=Te(0,h).map(()=>y2({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:k,pairedPriority:!0,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:R,drawPositionGroups:C,policyAttributes:f,idCollections:N,allGroups:A,drawSize:d}));O=x.concat(..._).filter(L=>{var B;return!((B=L.errors)!=null&&B.length)}).reduce((L,B)=>!L||(B.conflicts||0)<(L.conflicts||0)?B:L,void 0)}if(!O)return{error:cP};let F=(((m=oi({structure:I}))==null?void 0:m.positionAssignments)??[]).filter(_=>_.participantId).map(_=>_.participantId),$=O.positionAssignments.filter(_=>!F.includes(_.participantId));for(let _ of $)if(_.bye){let L=Qa({tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,..._});if(L.error)return te({result:L,stack:y})}else if(_.participantId){let L=ul({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,..._});if(L.error)return te({result:L,stack:y,context:{assignment:_}})}return{...Z}}function RTe(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function CTe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),n=r.flat().sort(lr),a=Math.max(...n),o=t.filter(c=>c>a),s=n.length,l=Te(s===2?1:2,s).filter(c=>c===Lx(c)),u=l.slice(0,e||l.length).reverse().map(c=>Cr(n,c));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:r,drawPositionChunks:u}}function ETe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){var m,h;let f="positionUnseededParticipants";c||({structure:c}=tt({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:g}=Er({structure:c}),{seedAssignments:v}=go({provisionalPositioning:t,drawDefinition:a,structure:c}),y=v==null?void 0:v.map(C=>C.participantId).filter(Boolean),{stage:I,stageSequence:b}=c,S=I===Ke?(h=(m=vt({element:c,name:Il}))==null?void 0:m.extension)==null?void 0:h.value:void 0,w=Ph({provisionalPositioning:t,drawDefinition:a,stageSequence:b,entryStatuses:Ep,structureId:u,roundTarget:S,stage:I}),U=w.filter(C=>!(y!=null&&y.includes(C.participantId))).map(C=>C.participantId),T=g==null?void 0:g.filter(C=>!C.participantId&&!C.bye&&!C.qualifier).map(C=>C.drawPosition);if(!r&&U.length>((T==null?void 0:T.length)||0))return te({result:{error:eF},context:{unseededParticipantsCount:U.length,unfilledDrawPositionsCount:T==null?void 0:T.length},stack:f});let{appliedPolicies:D}=Bt({tournamentRecord:n,drawDefinition:a,event:p}),P=D==null?void 0:D[ay];if(c.stage===Bi){let C=w.reduce((R,N)=>(R[N.groupingValue]||(R[N.groupingValue]=[]),R[N.groupingValue].push(N.participantId),R),{});Object.keys(C).length&&(P||(P={policyName:"Playoff Avoidance"}),P.policyAttributes||(P.policyAttributes=[]),P.policyAttributes.push({groupings:C}))}return P&&s?PTe({provisionalPositioning:t,unseededParticipantIds:U,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:P,drawSize:d,entries:w}):MTe({provisionalPositioning:t,unseededParticipantIds:U,inContextDrawMatchUps:e,unfilledDrawPositions:T,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function MTe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?Tn(r):r.reverse();for(let m of e){let h=p.pop();if(!n||h){let f=ul({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:m,drawPosition:h,matchUpsMap:l,structureId:u,event:d});if(f!=null&&f.error&&console.log("!!!!!",{result:f}),f==null?void 0:f.error)return te({result:f,stack:"randomUnseededDistribution"})}}return{...Z}}function NTe(t){let e=t.structure??tt(t).structure,i="positionQualifiers",r=[];if(e.stage===an)return te({result:{error:Sp},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:o}=ATe(t);for(let s of Object.keys(n)){let l=a==null?void 0:a.filter(u=>o[s].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(n[s]>(l||0))return te({result:{error:d9},context:{unfilledDrawPositions:l},stack:i});Te(0,n[s]).forEach(()=>{let u=ga(l);r.push(u),a==null||a.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...Z,qualifierDrawPositions:r}}function ATe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=tt({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=Er({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:o,roundQualifiersCounts:s}=bv({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(s?Object.keys(s):[]).map(f=>Qe(f)),{matchUps:u}=qt({structure:e}),{roundProfile:c}=An({matchUps:u}),d=Object.assign({},...l.filter(f=>c==null?void 0:c[f]).map(f=>{var g,v;return{[f]:((v=(g=c==null?void 0:c[f])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=r==null?void 0:r.filter(f=>f.qualifier).map(f=>f.drawPosition),m=o-((p==null?void 0:p.length)??0),h=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(f=>{let g=r==null?void 0:r.filter(v=>{var y,I;return v.qualifier&&((I=(y=d[f])==null?void 0:y.drawPositions)==null?void 0:I.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[f]:((s==null?void 0:s[f])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:m,placedQualifiersCount:h,roundQualifiersCounts:s,positionAssignments:r,roundDrawPositions:d,qualifiersCount:o}}function b2({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:m}){let h=[],f=[],g=0;if(p||({structure:p}=tt({drawDefinition:a,structureId:c})),c||(c=p==null?void 0:p.structureId),r||(r=Bt({drawDefinition:a}).appliedPolicies),!n){let v=p&&Fh({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:o,structure:p});v!=null&&v.error&&f.push(v.error),n=v==null?void 0:v.validSeedBlocks}return u=u??(n==null?void 0:n.length)??0,Te(0,u).forEach(()=>{if(g<(u||0)){let v=OTe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:c,matchUpsMap:d,event:m});v!=null&&v.success&&(g++,h.push(...v.seedPositions??[])),v.error&&f.push({seedPositionError:v.error})}}),f.length?{error:f}:{...Z,seedPositions:h}}function OTe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=yJ({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:s,event:u}),{appliedPolicies:p}=Bt({drawDefinition:r}),{avoidance:m}=p??{};m&&o&&(c==null?void 0:c.length)>2;let h=[];for(let f of c){let g=d.pop();if(!g)return{error:nv};h.push(g);let v=ul({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:f,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:s,event:u});if(!v.success)return v}return{...Z,seedPositions:h}}function kTe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=Er({structure:i}),{seedAssignments:n}=go({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(o=>o.participantId).map(o=>({[o.participantId]:o})));return r==null?void 0:r.map(o=>a[o.participantId]?{...o,seedNumber:a[o.participantId].seedNumber,seedValue:a[o.participantId].seedValue}:"").filter(Boolean)}function xTe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>{if(i-r.length>a.drawPositions.length)r.push(...a.drawPositions);else{let o=DM(Cr(a.drawPositions,2)),s,l=t[r.length];for(;s=rS(o,l);)r.push(s),l=t[r.length]}});let n=r.map(a=>Array.isArray(a)?Tn(a):a).flat(1/0);return hK(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function rS(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return rS(e?n:t[Math.round(Math.random())],e)}return i<r?rS(t[1],e):rS(t[0],e)}function DM(t){let e=Math.floor(t.length/2);return t.length>2?[DM(t.slice(0,e)),DM(t.slice(e))]:t}function FTe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:o,structure:s}){var l;a||(a=Fh({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:s}));let{isFeedIn:u,isLuckyStructure:c,isContainer:d}=a,{validSeedBlocks:p}=a;(l=i==null?void 0:i.seeding)!=null&&l.containerByesIgnoreSeeding&&(p=[]);let m=kTe({provisionalPositioning:t,drawDefinition:r,structure:s})??[],h=dt([].concat(...e.map(S=>S.drawPositions))),f=m.filter(S=>h.includes(S.drawPosition)),g=(S,w)=>dg(S.seedValue)-dg(w.seedValue),v=p.reduce((S,w)=>{let U=f.filter(T=>{var D;return(D=w.drawPositions)==null?void 0:D.includes(T.drawPosition)}).sort(g);return S.concat(...U)},[]).map(S=>S.drawPosition),y=xTe({orderedSortedFirstRoundSeededDrawPositions:v,validSeedBlocks:p,byesToPlace:o}),I=w2({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,o),b=w2({orderedSeedDrawPositions:y,relevantMatchUps:e}).slice(0,o);return{strictSeedOrderByePositions:I,blockSeedOrderByePositions:b,isLuckyStructure:c,positionedSeeds:m,isContainer:d,isFeedIn:u}}function w2({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r==null?void 0:r.sort((n,a)=>n-a)).filter(r=>(r==null?void 0:r[0])+1===(r==null?void 0:r[1]));return t.map(r=>i.find(n=>n==null?void 0:n.includes(r))).filter(Boolean).map(r=>r==null?void 0:r.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function LTe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:o,isFeedIn:s}){var l,u;let c=(l=r==null?void 0:r.seeding)==null?void 0:l.seedingProfile,d=o.stage===Ke,{positionAssignments:p}=Er({structure:o}),m=p==null?void 0:p.filter(O=>O.participantId).map(O=>O.drawPosition),h={isCollectionMatchUp:!1},{matchUps:f,roundMatchUps:g}=qt({provisionalPositioning:t,matchUpFilters:h,structure:o}),v=(g==null?void 0:g[1])||[],y=o.structureType===_n?f:v,I=dt([].concat(...y.map(O=>O.drawPositions))),b=Math.min(...I)-1,S=m==null?void 0:m.filter(O=>I.includes(O)),w=O=>{let k=Math.ceil(O.length/2),x=[O.slice(0,k),O.slice(k)],F=x.map(z=>[].concat(...z.flat(1/0)).length),$=Math.min(...F.flat(1/0)),_=Math.max(...F.flat(1/0)),L=F.indexOf(_),B=$!==_,V=Tn(x),[G,j]=!$||B?[x[L],x[1-L]]:[V[0],V[1]];return{greaterHalf:G,lesserHalf:j}},U=O=>{let{greaterHalf:k,lesserHalf:x}=w(O),{greaterHalf:F,lesserHalf:$}=w(k),_=Tn(F.flat(1/0)).pop(),L=F.flat().filter(B=>B!==_);return{newlyFilteredChunks:[...x,...$,L],drawPosition:_}},T=O=>!e.includes(O),D=O=>!(S!=null&&S.includes(O)),P=O=>{let k=Cr(O.sort(lr),Math.ceil(O.length/4)).map($=>$.filter(D)),x=[].concat(...k.flat(1/0)).length,F=[];for(let $=0;$<x;$++){let{newlyFilteredChunks:_,drawPosition:L}=U(k);F.push(L),k=_}return F},{validSeedBlocks:C}=Fh({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:o}),R=C==null?void 0:C.map(O=>{var k;return(k=O.drawPositions)==null?void 0:k.map(x=>x+b)}),N;if(s){let O=I.length,{seedBlocks:k}=NL({cluster:Nw(c)===wP,participantsCount:O});N=k.map(x=>x.map(F=>F+b)).map(P).filter(x=>x.length)}else d?N=R==null?void 0:R.map(O=>O.filter(D)):N=R==null?void 0:R.map(P).filter(O=>O.length);let A=y.map(O=>O.drawPositions).map(O=>O==null?void 0:O.sort((k,x)=>k-x)).filter(O=>(O==null?void 0:O[0])+1===(O==null?void 0:O[1])),M=O=>A.reduce((k,x)=>x.includes(O)?x.reduce((F,$)=>$!==O?$:F,void 0):k,void 0),E=N.map(O=>O.map(M)).flat(1/0).filter(D).filter(T).filter(Boolean);if(d&&!o.structures){let O=a%4,k=E.slice(0,O),x=(u=g[o.roundLimit])==null?void 0:u.length,F=Cr(E.slice(O),x).map(Tn).flat();E=k.concat(F)}return{unseededByePositions:E}}function _Te({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){var a;let o={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:l}=qt({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:o,matchUpsMap:i,structure:r,event:n}),u=(l==null?void 0:l[1])||[],c=(r==null?void 0:r.structureType)===_n,d=c?s:u,p=c?((a=r==null?void 0:r.structures)==null?void 0:a.length)||0:s.length,{structureId:m,stage:h,stageSequence:f}=r,g=Ph({entryStatuses:cs,provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:m,stage:h}),{qualifiersCount:v}=bv({provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:m,stage:h}),y=g.length+v,{positionAssignments:I,unassignedPositions:b}=Er({structure:r}),S=b==null?void 0:b.map(C=>C.drawPosition),w=I==null?void 0:I.filter(C=>C.bye).length,U=I==null?void 0:I.filter(C=>C.bye).map(C=>C.drawPosition),T=d.map(C=>C.drawPositions).filter(C=>C==null?void 0:C.reduce((R,N)=>!(U!=null&&U.includes(N))&&R,!0)).flat(1/0).filter(C=>S==null?void 0:S.includes(C)),D=I==null?void 0:I.length,P=D?D-y:0;return P>p&&r.stageSequence===1&&r.stage!==an&&(P=p),{placedByes:w,byesCount:P,relevantMatchUps:d,placedByePositions:U,roundMatchUps:l,positionsToAvoidDoubleBye:T}}function U2({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:u,seedsOnly:c,event:d}){var p;l||({structure:l}=tt({drawDefinition:r,structureId:s})),s||(s=l==null?void 0:l.structureId);let m=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===Ke),{byesCount:h,placedByes:f,relevantMatchUps:g}=_Te({provisionalPositioning:t,drawDefinition:r,matchUpsMap:o,structure:l,event:d}),v=h-(f||0);if(v<=0)return{...Z};let{strictSeedOrderByePositions:y,blockSeedOrderByePositions:I,isLuckyStructure:b,isFeedIn:S}=FTe({provisionalPositioning:t,relevantMatchUps:g,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:v,structure:l}),w=(l==null?void 0:l.structureType)&&[_n,UP].includes(l.structureType)&&((p=i==null?void 0:i.seeding)==null?void 0:p.containerByesIgnoreSeeding),U=m&&I!=null&&I.length?I:y,{unseededByePositions:T}=LTe({provisionalPositioning:t,seedOrderByePositions:U,isLuckyStructure:b,appliedPolicies:i,drawDefinition:r,seedLimit:u,structure:l,isFeedIn:S}),D=N=>N%2,P=(N,A)=>(N||[]).every(M=>D(M)?A!==M+1:A!==M-1),C=[].concat(...U);if(!c)for(;T.length;){let N=T.find(A=>P(C,A));N?(C.push(N),T=T.filter(A=>A!==N)):(C.push(...T),T=[])}w&&(C=Tn(C),ja({ignoreSeededByes:w})&&console.log({byePositions:C}));let R=C.slice(0,v);for(let N of R){let A=Qa({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:d});if(A!=null&&A.error)return A}return{...Z,unseededByePositions:T,byeDrawPositions:R}}function Aw(t){var e,i,r,n;let{drawDefinition:a}=t,{applyPositioning:o=!0,provisionalPositioning:s,multipleStructures:l,placeByes:u=!0,tournamentRecord:c,placementGroup:d,seedingProfile:p,structureId:m,seedLimit:h,seedsOnly:f,drawType:g,drawSize:v,event:y}=t,I=[];o||(k9(),a=Ne(a,!1,!0));let b=x=>(o||KU(),te({result:x,stack:"automatedPositioning"})),S=x=>(o||KU(),x),w=tt({drawDefinition:a,structureId:m});if(w.error)return b(w);let U=w.structure;if(!U)return{error:Ni};let T=t.appliedPolicies||((e=Bt({drawDefinition:a,structure:U,event:y}))==null?void 0:e.appliedPolicies),{qualifiersCount:D}=bv({stageSequence:U.stageSequence,provisionalPositioning:s,stage:U.stage,drawDefinition:a,structureId:m}),P=Ep;if(!((i=Ph({stageSequence:U.stageSequence,provisionalPositioning:s,stage:U.stage,placementGroup:d,drawDefinition:a,entryStatuses:P,structureId:m}))!=null&&i.length)&&!D)return S({...Z});let C=t.matchUpsMap??ln({drawDefinition:a}),R=t.inContextDrawMatchUps??((r=fr({inContext:!0,drawDefinition:a,matchUpsMap:C}))==null?void 0:r.matchUps),N=[],A=Fh({provisionalPositioning:s,appliedPolicies:T,drawDefinition:a,seedingProfile:p,structure:U});if(A.error)return A;let{validSeedBlocks:M}=A;I.push({validSeedBlocks:M});let E=t.participants||(c?(n=Ai({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:c}))==null?void 0:n.participants:[]);if(Nw(U.seedingProfile||p)===qd){let x=u?U2({provisionalPositioning:s,tournamentRecord:c,appliedPolicies:T,drawDefinition:a,seedBlockInfo:A,matchUpsMap:C,structure:U,seedLimit:h,seedsOnly:f,event:y}):void 0;if(x!=null&&x.error)return b(x);N=x.unseededByePositions,I.push({action:"positionByes",unseededByePositions:N});let F=U.seedingProfile?{positioning:U.seedingProfile}:p;if(x=b2({seedingProfile:F,provisionalPositioning:s,inContextDrawMatchUps:R,tournamentRecord:c,appliedPolicies:T,validSeedBlocks:M,drawDefinition:a,seedBlockInfo:A,participants:E,matchUpsMap:C,structure:U,event:y}),x.error)return b(x);I.push({seedPositions:x.seedPositions,action:"positionSeedBlocks"})}else{if(g!==Tp){let F=U.seedingProfile?{positioning:U.seedingProfile}:p,$=b2({seedingProfile:F,provisionalPositioning:s,inContextDrawMatchUps:R,tournamentRecord:c,appliedPolicies:T,validSeedBlocks:M,drawDefinition:a,seedBlockInfo:A,participants:E,matchUpsMap:C,structure:U,event:y});if($.error)return b($);I.push({action:"positionSeedBlocks",seedPositions:$.seedPositions})}let x=u?U2({provisionalPositioning:s,tournamentRecord:c,appliedPolicies:T,drawDefinition:a,seedBlockInfo:A,matchUpsMap:C,structure:U,seedLimit:h,seedsOnly:f,event:y}):void 0;if(x!=null&&x.error)return b(x);N=x==null?void 0:x.unseededByePositions,I.push({action:"positionByes",byeDrawPositions:x==null?void 0:x.byeDrawPositions,unseededByePositions:N})}let O={};if(!f){let x=NTe({inContextDrawMatchUps:R,tournamentRecord:c,appliedPolicies:T,validSeedBlocks:M,drawDefinition:a,seedBlockInfo:A,participants:E,matchUpsMap:C,structure:U});if(x.error||(x.conflicts&&(O.qualifierConflicts=x.conflicts),I.push({action:"positionQualifiers",qualifierDrawPositions:x.qualifierDrawPositions}),x=ETe({provisionalPositioning:s,inContextDrawMatchUps:R,unseededByePositions:N,multipleStructures:l,tournamentRecord:c,drawDefinition:a,seedBlockInfo:A,participants:E,matchUpsMap:C,structureId:m,structure:U,drawSize:v,event:y}),x.error))return b(x);x.conflicts&&(O.unseededConflicts=x.conflicts),I.push({action:"positionUnseededParticipants"})}let{positionAssignments:k}=oi({drawDefinition:a,structure:U});return li({drawDefinition:a,structureIds:[m]}),o||KU(),{positionAssignments:k,conflicts:O,...Z,positioningReport:I}}function Sv(t){var e;let{applyPositioning:i=!0,provisionalPositioning:r,tournamentRecord:n,drawDefinition:a,seedingProfile:o,structureId:s,placeByes:l,seedsOnly:u}=t;if(!a)return{error:Va};if(!_c({drawDefinition:a,structureId:s})&&!r)return{error:_x};let c=(e=OJ({drawDefinition:a,structureId:s}).playoffStructures)==null?void 0:e.sort((m,h)=>a0(m)-a0(h)),d=[],p=[];if(c)for(let m of c){let{structureId:h}=m,f=Aw({structureId:h,provisionalPositioning:r,applyPositioning:i,tournamentRecord:n,drawDefinition:a,seedingProfile:o,placeByes:l,seedsOnly:u});if(f.error)return f;f.positionAssignments&&d.push({positionAssignments:f.positionAssignments,structureId:h}),f.positioningReport&&p.push(f.positioningReport)}return{...Z,structurePositionAssignments:d,positioningReports:p}}function LJ({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>st(i)))&&te({result:{error:se},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>qf(i.structureOrder)-qf(r.structureOrder)),{...Z}):{error:$e}}function tR({drawDefinition:t}){var e,i,r,n,a,o,s;let l=t.structures??[],u=t.links??[],c=new Map,d=U=>{let T=c.get(U)||c.set(U,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&c.get(U);if(T&&!(T!=null&&T.stage)){let D=l.find(P=>P.structureId===U);T.stage=D==null?void 0:D.stage}return T},p={},m={},h=u.map(U=>{let T=U.source.structureId,D=U.target.structureId,P=d(T),C=d(D);return[Yd,_o,SP,qd].includes(U.target.feedProfile)?(P==null||P.targets.push(D),C==null||C.sources.push(T)):U.target.feedProfile===fs&&(C==null||C.drawSources.push(T),P==null||P.drawTargets.push(D)),m[D]=m[D]||U.target.feedProfile===fs,p[D]=dt([...p[D]||[],T]).filter(Boolean),[U.source.structureId,U.target.structureId]});for(let U of c.keys()){let T=c.get(U);if(T){let D=T.targets??[];for(;D.length;){let P=D.pop(),C=P&&c[P];(e=C==null?void 0:C.targets)!=null&&e.length?D.push(...C.targets):C&&(T.rootStage=C.stage)}if(T.rootStage||(T.rootStage=T.stage),!((i=T.targets)!=null&&i.length)){let P=T.sources??[];for(;P.length;){let C=P.pop(),R=C&&c[C];if((r=R==null?void 0:R.sources)!=null&&r.length){for(let N of R.sources)(n=T.progeny)!=null&&n.includes(N)||(a=T.progeny)==null||a.push(N);P.push(...R.sources)}}}}}let f=0;for(let U of c.keys()){let T=c.get(U);if(T&&T.rootStage===Ke){let D=[(o=T.drawTargets)==null?void 0:o[0]],P=0;for(;D.length;){P+=1;let C=D.pop(),R=C?c.get(C):void 0;(s=R==null?void 0:R.drawTargets)!=null&&s.length&&D.push(R.drawTargets[0])}T.distanceFromMain=P,P>f&&(f=P)}}let g=h.length;Te(0,Math.ceil(g/2)).forEach(()=>{h=Te(0,g).map(U=>{let T=h[U],D=h.reduce((P,C)=>Nn(T,C)?P.concat(...C):P,[])||[];return dt(T.concat(...D))})});let v=h[0],y=(U,T)=>ji(U,T).length===U.length,I=h.slice(1).reduce((U,T)=>U&&y(T,v),!0),b=[v].filter(Boolean),S=[v].filter(Boolean);l.forEach(U=>{let{structureId:T,stage:D}=U;b.find(P=>P.includes(T))||(b.push([T]),D!==Fr&&S.push([T]))});let w=I&&S.length===1;return!(u!=null&&u.length)&&l.length===1&&d(l[0].structureId),{structureProfiles:Object.fromEntries(c),allStructuresLinked:w,maxQualifyingDepth:f,sourceStructureIds:p,hasDrawFeedProfile:m,structureGroups:b}}function _J({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=tR({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...Z}}function BL(t){let e=We(t,[{[wr]:!0,[$n]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return $Te({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function $Te(t){var e;let i=We(t,[{[$n]:!0,[CP]:!0},{link:!0,[Jn]:ta,[UK]:Gx}]);if(i.error)return i;let{drawDefinition:r,tournamentId:n,structure:a,eventId:o,link:s}=t,l=s.target.structureId,u=tt({drawDefinition:r,structureId:l});if(u.error)return te({stack:"attachQualifyingStructure",context:{targetStructureId:l},result:u});r.structures||(r.structures=[]),r.links||(r.links=[]),r.structures.push(a),r.links.push(s),_J({drawDefinition:r});let c=((e=qt({structure:a}))==null?void 0:e.matchUps)||[];return xc({drawDefinition:r,tournamentId:n,matchUps:c,eventId:o}),li({drawDefinition:r,structureIds:[a.structureId]}),{...Z}}function $J({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:se};if(!t)return{error:$e};let i=Object.assign({},...e.map(r=>{if(!At(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Je};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let o=i[a.structureId];o&&(a.structureName=o)}}return{...Z}}function VL({drawDefinition:t,timeItem:e}){if(!t)return{error:Va};if(!e)return{error:nF};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:rF};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),lw({drawDefinition:t}),{...Z}}function BJ(t){var e;let{tournamentRecord:i,drawDefinition:r,structureId:n,event:a}=t,o=We(t,[{drawDefinition:!0,structureId:!0}]);if(o.error)return o;let s=r.structures??[],l=s.find(y=>y.structureId===n);if(!l)return{error:Ni};let u=s.find(({stage:y,stageSequence:I})=>y===Ae&&I===1),c=n===(u==null?void 0:u.structureId),d=s.filter(({stage:y})=>y===Ke).map(Ma("structureId"));if(c&&!d.length)return{error:TK};let p=d.includes(n),m=BTe({isQualifyingStructure:p,structure:l,...t});if(m!=null&&m.error)return m;let{structureIdsToRemove:h,relatedStructureIdsMap:f}=jTe({qualifyingStructureIds:d,isQualifyingStructure:p,isMainStageSequence1:c,mainStageSequence1:u,drawDefinition:r,structureId:n}),{removedMatchUpIds:g,removedStructureIds:v}=GTe({relatedStructureIdsMap:f,qualifyingStructureIds:d,isMainStageSequence1:c,mainStageSequence1:u,drawDefinition:r,structureIdsToRemove:h,structureId:n});if(VTe({removedMatchUpIds:g,drawDefinition:r}),c){let y=(e=u.matchUps??[])==null?void 0:e.map(Ma("matchUpId"));g.push(...y),u.positionAssignments=[],u.seedAssignments=[],u.matchUps=[],u.extensions&&(u.extensions=[])}return p&&_J({drawDefinition:r}),Zu({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:g,action:"removeStructure",eventId:a==null?void 0:a.eventId,drawDefinition:r}),li({drawDefinition:r,eventId:a==null?void 0:a.eventId}),{...Z,removedMatchUpIds:g,removedStructureIds:v}}function BTe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:o}){var s,l,u,c,d,p;let m=[r];if(t){let h=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},f=(s=h(r))==null?void 0:s.source.structureId;for(;f;)m.push(f),f=(l=h(f))==null?void 0:l.source.structureId}if((u=fr({matchUpFilters:{structureIds:m},drawDefinition:i}).matchUps)!=null&&u.some(({score:h})=>yr({score:h}))){let h=(c=Bt({tournamentRecord:e,drawDefinition:i,structure:n,event:a}))==null?void 0:c.appliedPolicies;if(!(o??((p=(d=h==null?void 0:h[fo])==null?void 0:d.allowDeletionWithScoresPresent)==null?void 0:p.structures)))return{error:hP}}return{...Z}}function VTe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=fr({drawDefinition:e});i==null||i.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function jTe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let o=(n.structures??[]).map(Ma("structureId")),s=c=>{var d;return((d=n.links)==null?void 0:d.map(p=>p.source.structureId===c&&p.target.structureId!==(r==null?void 0:r.structureId)&&p.target.structureId).filter(Boolean))??[]},l=c=>{var d;return((d=n.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===c&&p.source.structureId).filter(Boolean))??[]},u=new Map;return o.forEach(c=>u.set(c,e?l(c):s(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function GTe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;a!=null&&a.length;){let u=a.pop();l.push(...WTe({idBeingRemoved:u,drawDefinition:n}));let c=zTe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:n,structureId:o});s.push(...c.removedStructureIds);let d=HTe({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:u,structureId:o});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function HTe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){var n;return t&&((n=e.get(t))==null?void 0:n.filter(a=>a!==(i==null?void 0:i.structureId)||r===i.structureId))}function zTe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){var a;let o=[];return r.links=((a=r.links)==null?void 0:a.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&o.push(i),s.structureId!==i))),{removedStructureIds:o}}function WTe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=tt({structureId:t,drawDefinition:e}),r=qt({structure:i}).matchUps;return VF(r)}function h0({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:$e};if(!pL({drawDefinition:e,stage:r}))return{error:Sp};let n=qSe({drawDefinition:e,stage:r}),{qualifiersCount:a}=bv({drawDefinition:e,stageSequence:t,stage:r}),o=n+a;if(i<o)return{error:jx};let{entryProfile:s}=dL({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return li({drawDefinition:e}),{...Z,entryProfile:s}}function VJ({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?pL({drawDefinition:e,stage:i})?i!==Ae?{error:jx,info:"qualifiersCount can only be set for main stage"}:(dL({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),li({drawDefinition:e}),{...Z}):{error:Sp}:{error:$e}}function qTe({drawDefinition:t,drawSize:e}){if(!t)return{error:$e};let i=h0({stage:Fr,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(li({drawDefinition:t}),{...Z})}function jJ(t){return qTe(t)}var YTe="qualifierDrawPositionAssignment",KTe="withdrawParticipantAtDrawPosition",XTe="alternateDrawPositionAssignment",JTe="luckyLoserDrawPositionAssignment",S2="removeDrawPositionAssignment",GJ="swapDrawPositionAssignments",ZTe="modifyPairAssignment",QTe="adHocPositionSwap",eDe="modifyParticipantOtherName",T2="assignDrawPosition",tDe="removeSeededParticipant",iDe="assignDrawPositionBye",rDe="modifySeedAssignment",HJ="addPenalty",jL="MODIFY_PAIR",iR="QUALIFIER",GL="ALTERNATE",HL="WITHDRAW",xm="ASSIGN",PM="REMOVE",zL="LUCKY",aI="REMOVE_SEED",rR="SWAP",py="NICKNAME",lm="SEED_VALUE",Fm="PENALTY",f0="BYE",nDe={MODIFY_PAIR_ASSIGNMENT:jL,QUALIFYING_PARTICIPANT:iR,ALTERNATE_PARTICIPANT:GL,WITHDRAW_PARTICIPANT:HL,ASSIGN_PARTICIPANT:xm,LUCKY_PARTICIPANT:zL,REMOVE_ASSIGNMENT:PM,SWAP_PARTICIPANTS:rR,ADD_NICKNAME:py,REMOVE_SEED:aI,ADD_PENALTY:Fm,ASSIGN_BYE:f0,SEED_VALUE:lm};function zJ({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:$e};if(!r)return{error:Xa};if((i==null?void 0:i.length)!==2)return{error:se,drawPositions:i};let a=ln({drawDefinition:e}),{matchUps:o}=fr({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:s}=tt({drawDefinition:e,structureId:r});if(!s)return{error:Ni};let l=Bt({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},u;if(s.structureType===_n?u=sDe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}):u=aDe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}),u.error)return u;if(aL({structure:s,drawPositions:i}),$P({appliedPolicies:l,drawDefinition:e,positionAction:{name:GJ,drawPositions:i,structureId:r}}),Fc({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:n}),n.eventType===Ca){let c=qt({matchUpFilters:{matchUpTypes:[Ba]},inContext:!0,structure:s}).matchUps.filter(p=>{var m;return(m=p.drawPositions)==null?void 0:m.some(h=>i.includes(h))}),d=qt({matchUpFilters:{matchUpTypes:[Ba]},structure:s}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(m=>{var h;let f=m==null?void 0:m.drawPosition;if(i.includes(f)){let g=m.participantId,v=d.find(({matchUpId:I})=>I===p.matchUpId),y=(h=p==null?void 0:p.sides)==null?void 0:h.reduce((I,b,S)=>b.drawPosition===f?S:I,void 0);kL({inContextTargetMatchUp:p,drawPositionSideIndex:y,teamParticipantId:g,tournamentRecord:t,drawDefinition:e,matchUp:v,event:n})}})})}return li({drawDefinition:e,structureIds:[r]}),{...Z}}function aDe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){let s=a==null?void 0:a.positionAssignments.filter(u=>r==null?void 0:r.includes(u.drawPosition));if(!s)return{error:se,structure:a,info:"Missing positionAssignments"};if(s.filter(({bye:u})=>u).length===2)return{...Z};if(s.filter(({qualifier:u})=>u).length===2)return{...Z};let l=s.some(({qualifier:u})=>u);return s.some(({bye:u})=>u)&&!l?WJ({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o}):oDe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o})}function WJ({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=r.find(({bye:h})=>h),l=r.find(({participantId:h})=>h),u=s.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,m=dy({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return m.error||(m=dy({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),m.error)||(Qa({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:o}),m=ul({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:n,event:o}),m.error)?m:{...Z}}function oDe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=Object.assign({},...r.map((l,u)=>{let{drawPosition:c}=l,d={...r[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>s[l.drawPosition]||l),FL({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:o}),{...Z}}function sDe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){var s;let l=(s=a.structures)==null?void 0:s.reduce((c,d)=>{let p=d==null?void 0:d.positionAssignments.filter(m=>r==null?void 0:r.includes(m.drawPosition));return p&&c.push(...p),c},[]);if(l.filter(({bye:c})=>c).length===2)return{...Z};if(l.filter(({qualifier:c})=>c).length===2)return{...Z};FL({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:l,structure:a,event:o});let u=l.some(({qualifier:c})=>c);if(l.some(({bye:c})=>c)&&!u)WJ({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:l,matchUpsMap:n,structure:a,event:o});else{let c=Ne(l,!1,!0);l.forEach((d,p)=>{let m=c[1-p].participantId;d.qualifier=c[1-p].qualifier,d.participantId=m})}return{...Z}}function qJ({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){var n;let a="removeSeededParticipant";if(!t)return{error:ve};if(!e)return{error:$e};let o=(e.structures??[]).find(s=>s.structureId===r);return o?!o.stage||![Ae,Ke].includes(o.stage)||o.stage===Ae&&o.stageSequence!==1?te({result:{error:wp},stack:a}):(n=o.seedAssignments)!=null&&n.find(s=>s.participantId===i)?{...Z}:te({info:"participant not seeded",result:{error:Vr},context:{participantId:i}}):te({result:{error:Ni},stack:a})}function Ow({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=Au}){return!r||!n?{error:Xa}:{link:He({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:fs,roundNumber:t,structureId:n}})}}function WL({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:(r==null?void 0:r.pop())||Ht()}function g0({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:o,nodes:s}){let l=0,u=[],c=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let m=s==null?void 0:s[l],h=s==null?void 0:s[l+1];d&&(m.roundNumber=d),h&&d&&(h.roundNumber=d);let f=WL({roundPosition:c,roundNumber:i,idPrefix:n,uuids:o}),g={roundPosition:c,children:[m,h],matchUpId:f};u.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:Zi,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),r.push(v),c++,l+=2}return{roundNodes:u,matchUps:r}}function cl({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:u}){if(isNaN(s)||s<2||r&&s<=r)return{matchUps:[],roundsCount:0};if(r&&(!Cs(s)||s%r)){let g=r;for(;g<s;)g=2*g;s=g}let c=r&&!(s%2)&&(!isNaN(r)||i&&!isNaN(i))&&(s/r===Math.round(s/r)||i&&s/i===Math.round(s/i));if(!Cs(s)&&!c)return{matchUps:[],roundsCount:0};let d=Te(1,s+1).map(g=>({drawPosition:g})),p,m=[],h=1;for({roundNodes:p,matchUps:m}=g0({matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,nodes:d,uuids:u}),h++,a=a??i;p.length>1;)r&&p.length===r&&(a=h-1),{roundNodes:p,matchUps:m}=g0({nodes:p,matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,uuids:u}),h++;let f=h-1;return m=Uw({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:f,roundLimit:a,matchUps:m}),a?m=m.filter(g=>a&&(g.roundNumber??0)<=a):a=h-1,{drawSize:s,matchUps:m,roundsCount:f,roundLimit:a}}function qL(t){var e,i,r,n,a,o;let s="generateQualifyingStructure";if(!t.drawDefinition)return te({result:{error:$e},stack:s});if(t.drawSize&&!st(t.drawSize)||t.participantsCount&&!st(t.participantsCount)||t.qualifyingPositions&&!st(t.qualifyingPositions))return te({result:{error:se},stack:s});let l=t.drawSize??Fx(t.participantsCount),{qualifyingRoundNumber:u,qualifyingPositions:c,targetStructureId:d,structureOptions:p,appliedPolicies:m,drawDefinition:h,matchUpFormat:f,structureName:g,structureId:v,roundTarget:y,drawType:I,idPrefix:b,isMock:S,uuids:w}=t;if(!t.drawSize)return te({result:{error:qb},context:{drawSize:l},stack:s});if(c&&c>=t.drawSize)return te({result:{error:se},context:{drawSize:l,qualifyingPositions:c},stack:s});let U,T,D,P,C=0,R,N=1,{structureProfiles:A}=tR({drawDefinition:h}),M=A[d];if(!M)return te({result:{error:Ni},context:{targetStructureId:d},stack:s});let E=h.matchUpType,O=y?`${y}-`:"",k=M.stage===Ke,x=((i=(e=m==null?void 0:m[og])==null?void 0:e.namingConventions)==null?void 0:i.pre)??((n=(r=JSe[og])==null?void 0:r.namingConventions)==null?void 0:n.pre),F=k&&x?`${x}-`:"",$=g??(O?`${F}${tn(Ke)} ${O}`:`${F}${tn(Ke)}`);if(I===ts){let{maxRoundNumber:B,structures:V,groupCount:G}=Ew({structureName:g??$,structureId:v??(w==null?void 0:w.pop()),stage:Ke,structureOptions:p,appliedPolicies:m,stageSequence:N,matchUpType:E,roundTarget:y,idPrefix:b,drawSize:l,isMock:S,uuids:w});C=G,U=B,D=V[0],R=[1]}else({drawSize:l,matchUps:P,roundLimit:U,roundsCount:T}=cl({qualifyingRoundNumber:u,qualifyingPositions:c,matchUpType:E,idPrefix:b,drawSize:l,isMock:S,uuids:w})),U||(U=T),D=so({structureName:g??$,structureId:v??(w==null?void 0:w.pop()),qualifyingRoundNumber:U,stage:Ke,matchUpFormat:f,stageSequence:N,matchUpType:E,roundLimit:U,matchUps:P}),y&&_t({extension:{name:Il,value:y},element:D}),C=(a=P==null?void 0:P.filter(B=>B.roundNumber===U))==null?void 0:a.length;let _=I===ts?Nu:Au,L=D&&U&&((o=Ow({sourceStructureId:D.structureId,sourceRoundNumber:U,targetStructureId:d,finishingPositions:R,linkType:_}))==null?void 0:o.link);return{qualifyingDrawPositionsCount:l,qualifiersCount:C,...Z,structure:D,link:L}}function YJ(t){if(!t.tournamentRecord)return{error:ve};let e=lDe(t);return e.error,e}function lDe(t){if(!t.drawDefinition)return{error:$e};if(!t.targetStructureId)return{error:Xa};let e=qL(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:se}:BL({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function KJ(t){var e;let i=We(t,[{[$n]:!0,[DP]:!0,[vl]:!0},{[ZUe]:!0,[Xr]:p=>Number.isInteger(p)&&p>0},{[Xr]:p=>Array.isArray(p)&&p.length===2&&p.every(Di),[Ha]:ya,participantIds:!0}]);if(i.error)return i;let{drawDefinition:r,structureId:n,tournamentRecord:a,event:o}=t,{structure:s}=tt({drawDefinition:r,structureId:n});if(!s)return{error:Ni};if(!Yn({structure:s}))return{error:wp};let l=p=>{var m;return(m=p.sides)==null?void 0:m.map(h=>h.participantId).some(h=>t.participantIds.includes(h))},u=p=>p.roundNumber===t.roundNumber,c=p=>!yr(p),d=((s==null?void 0:s.matchUps)??[]).filter(u).filter(c).filter(l);if(d.length!==2)return{error:ya};for(let p of d){let m=(e=p==null?void 0:p.sides)==null?void 0:e.find(h=>t.participantIds.includes(h==null?void 0:h.participantId));if(m){let h=t.participantIds.find(f=>f!==(m==null?void 0:m.participantId));m.participantId=h,Ct({tournamentId:a==null?void 0:a.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUp:p})}}return li({drawDefinition:r,structureIds:[n]}),{...Z}}function uDe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:o,uuids:s,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Te(0,c).map(f=>d?d+f:void 0),m=[];for(let f=0;f<c;f++){let g=p.shift(),v={drawPosition:g,fed:u+1,feed:!0},y=l[f];y.roundNumber=i-1;let I=WL({roundPosition:y.roundPosition,roundNumber:i,idPrefix:n,uuids:s}),b={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Zi,roundNumber:i,matchUpId:I};t&&(b.matchUpType=r),o&&(b.isMock=!0),a.push(b);let S={children:[y,v]};m.push(S)}let h=e?e-c:void 0;return{roundNodes:m,matchUps:a,drawPosition:h}}function $c(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:m,uuids:h,fmlc:f}=t;a=a??A(e);let g=cDe({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((M,E)=>M+E,0);else if(e){let M=e-a;i=g.filter(E=>E<=M?(M-=E,!0):!1),y=i.reduce((E,O)=>E+O,0),r=i.length}else n>=v?r=0:u&&(r=v-u,n=0),i=g.filter((M,E)=>u&&!r||r&&E>=n+r||E<n?0:M),y=i.reduce((M,E)=>M+E,0),r=i.length;let I=[...g,...i].sort((M,E)=>E-M),b=I.length,S=[...(l??[]).map(M=>M-1),...(o??[]).map(M=>b-M)].map(M=>I[M]).reduce((M,E)=>M+E,0);y=y-S;let w=0,U=[],T,D=1,P=Te(0,a).map((M,E)=>({drawPosition:E+1+y})),C=y+1;for(let M of g){if({roundNodes:T,matchUps:U}=g0({matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:m,nodes:P,uuids:h}),D++,i.includes(M)){let E=Pa(i)[M],O=Te(0,E),k=b+1-D,x=(o==null?void 0:o.includes(k))??(l==null?void 0:l.includes(D));O.forEach(()=>{({roundNodes:T,matchUps:U,drawPosition:C}=uDe({drawPosition:!x&&C||void 0,nodes:T,matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:m,uuids:h,fed:w})),D++,w+=1})}P=T}b!==D-1&&console.log("ERROR");let R=a-y;U=Uw({finishingPositionOffset:c?R:s,positionsFed:y,roundsCount:b,matchUps:U,fmlc:f});let N=T!=null&&T.length?T[0]:T;return N&&(N.roundNumber=D-1,N.matchUps=U),{draw:N,matchUps:U,roundsCount:b};function A(M){let E=Lx(M);return E>M?E/2:E}}function cDe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Te(0,e).reverse().map(i=>Math.pow(2,i))}function yf(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:m,sequenceLimit:h,stage:f=Ae,drawSize:g,idPrefix:v,isMock:y,uuids:I}=t;if(!(!o||!u||o!=null&&o[l])||g<2||h&&s>h)return{};let b=[],S=[],w=[],U=t.matchUpType??(p==null?void 0:p.matchUpType),T=e+1,D=e+g,P=`${T}-${D}`,C=o==null?void 0:o[l],R=r&&`${r} `||"",N=(o==null?void 0:o[P])??(n==null?void 0:n[P]),A=t.structureName||(N==null?void 0:N.name)||(C==null?void 0:C.name)&&(i?`${R}${C==null?void 0:C.name}`:C.name)||`${R}${P}`,M=(N==null?void 0:N.abbreviation)??(C==null?void 0:C.abbreviation),E=t.structureId??(C==null?void 0:C.structureId)??(I==null?void 0:I.pop()),O={idPrefix:v&&`${v}-${A}-RP`,finishingPositionOffset:e,matchUpType:U,drawSize:g,isMock:y,uuids:I},{matchUps:k}=m?$c(O):cl(O),x=so({structureAbbreviation:M,stageSequence:s,structureName:A,matchUpType:U,roundOffset:d,structureId:E,matchUps:k,stage:f});b.push(...k),S.push(x);let F=Math.ceil(Math.log(g)/Math.log(2)),$=c?Math.min(c-d,F):(!a||T<a)&&F||0;return g>2&&Te(1,$+1).forEach(L=>_(L)),{structureId:x.structureId,matchUps:b,structureName:A,structures:S,links:w,...Z};function _(L){let B=g/Math.pow(2,L);if(B<2)return;let V=g/Math.pow(2,L)+e;if(a&&V+1>a)return;let{structures:G,structureId:j,matchUps:z,links:q}=yf({finishingPositionOffset:V,exitProfile:`${l}-${L}`,roundOffset:d+L,stageSequence:s+1,drawSize:B,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:h,matchUpType:U,idPrefix:v,uuids:I,stage:f});if(x.structureId&&j){let W={linkType:zl,source:{roundNumber:L,structureId:x.structureId},target:{roundNumber:1,feedProfile:_o,structureId:j}};q&&x&&q.push(W),q!=null&&q.length&&w.push(...q)}return G!=null&&G.length&&S.push(...G),z!=null&&z.length&&b.push(...z),{structureId:j,childLinks:q,structures:S}}}function YL({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=tt({drawDefinition:t,structureId:i});if(r.error)return te({result:r});let{matchUps:n}=qt({structure:r.structure,matchUpsMap:e});return{...An({matchUps:n}),matchUps:n,matchUpsMap:e}}function D2({finishingPositions:t,drawDefinition:e,structureId:i}){var r;let{roundProfile:n}=YL({drawDefinition:e,structureId:i});return(r=n&&Object.keys(n))==null?void 0:r.reduce((a,o)=>(XJ(n==null?void 0:n[o]).forEach(s=>{t.forEach(l=>{dDe({position:l,rangeDefinition:s})&&(a[l]={roundNumber:o})})}),a),{})}function dDe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return Te(i,(r||i)+1).includes(t)}function XJ(t){var e,i;return[dt(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),dt(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function pDe(t){return XJ(t).map(e=>Te(e[0],e[1]&&e[1]+1||e[0]+1))}function Tv({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:se,context:{structureIds:e}};if(!t)return{error:$e};e=e??(t.structures??[]).filter(a=>a.stage!==Ke).map(({structureId:a})=>a);let r=e.map(a=>{var o;let{roundProfile:s}=YL({drawDefinition:t,matchUpsMap:i,structureId:a});return(o=s&&Object.values(s))==null?void 0:o.map(pDe).flat()}).flat(),n=r.filter(a=>(a==null?void 0:a.length)===1).sort(lr).flat();return{positionsNotPlayedOff:dt(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function JJ({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:$e};if(!r)return{error:Xa};if(!e)return{error:Je,info:"missing playoffPositions"};let n=Tv({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,o=e.filter(v=>!a.includes(v)),s=D2({finishingPositions:o,drawDefinition:i,structureId:r}),l=Object.values(s).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>Qe(v)).filter(v=>!t.includes(v)),u=D2({finishingPositions:a,drawDefinition:i,structureId:r}),c=u?Object.values(u):[],d=u?c.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>Qe(v)):[],p=l.filter(v=>!d.includes(v)).sort(lr),{roundProfile:m}=YL({drawDefinition:i,structureId:r}),h=p.map(v=>{let y=m==null?void 0:m[v].finishingPositionRange.loser,[I,b]=y??[0,0];return Te(I,(b||I)+1)}).flat().sort(lr),{playoffRoundsRanges:f}=mDe({playoffSourceRounds:p,roundProfile:m}),g=[...p,...d];return{playoffPositionsReturned:h,playedOffSourceRounds:d,playoffRoundsRanges:f,playoffSourceRounds:p,sourceRounds:g,roundProfile:m}}function mDe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,o=Te(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:o,roundNumber:i}})}}function kw({drawDefinition:t,structureId:e}){if(!t)return{error:$e};let{matchUps:i,matchUpsMap:r}=Pn({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=Tv({drawDefinition:t,matchUpsMap:r}),{structures:o}=rs({drawDefinition:t}),s=o.filter(u=>!e&&u.stage!==Fr||u.structureId===e),l={};for(let u of s){let c=u==null?void 0:u.structureId,d=hDe({playoffPositions:n,drawDefinition:t,structure:u,matchUps:i}),{error:p,...m}=d;if(p)return d;l[c]={structureId:c,...m}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function hDe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){var n,a,o,s,l,u,c,d,p;let m=i==null?void 0:i.structureId,{links:h}=Iv({drawDefinition:e,structureId:m});if(i.structureType===_n||i.structures){let w=(a=(n=oi({structure:i}))==null?void 0:n.positionAssignments)==null?void 0:a.length,U=i.structures.length,T=(w??0)/U,D=((o=h.source)==null?void 0:o.flatMap(({source:x})=>(x==null?void 0:x.finishingPositions)||[]))||[],P=Te(1,T+1).filter(x=>!D.includes(x)),C=((l=(s=r.find(x=>x.containerStructureId===m&&x.finishingPositionRange))==null?void 0:s.finishingPositionRange)==null?void 0:l.winner)||[0,1],R=h==null?void 0:h.source.map(({target:x})=>x.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:A=[]}=Tv({structureIds:R,drawDefinition:e}),M=[...N,...A],E=Te(C[0],C[1]+1).filter(x=>!M.includes(x)),O=Cr(E,E.length/P.length),k=P.map((x,F)=>{let $=O[F],_=[Math.min(...$||[]),Math.max(...$||[])].join("-");return{finishingPosition:x,finishingPositions:$,finishingPositionRange:_}});return{positionsNotPlayedOff:E,playoffFinishingPositionRanges:k,finishingPositionsAvailable:P,finishingPositionsPlayedOff:D,positionsPlayedOff:N,groupCount:U,groupSize:T}}let f=((u=h==null?void 0:h.source)==null?void 0:u.filter(w=>w.linkCondition!==sl).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],g=((c=h==null?void 0:h.source)==null?void 0:c.filter(w=>w.linkCondition===sl).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],v=JJ({excludeRoundNumbers:f,playoffPositions:t,drawDefinition:e,structureId:m}),y=v!=null&&v.playoffSourceRounds?[...(v==null?void 0:v.playoffSourceRounds)||[]]:void 0,I=[...(v==null?void 0:v.playoffRoundsRanges)||[]],{roundProfile:b,error:S}=v;for(let w of g){let U=h==null?void 0:h.source.find(R=>R.source.roundNumber===w),T=U==null?void 0:U.target.roundNumber,D=U==null?void 0:U.target.structureId,P=r.filter(({roundNumber:R,structureId:N})=>N===D&&R===T),C=P.filter(({sides:R})=>R.find(N=>N.participantFed&&!N.participantId)).length;if(y&&C===P.length){y.push(w);let R=(p=(d=b==null?void 0:b[w])==null?void 0:d.finishingPositionRange)==null?void 0:p.loser;if(R){let N=Math.min(...R),A=N+C,M=Te(N,A),E={finishingPositionRange:[N,A-1].join("-"),finishingPositions:M,roundNumber:w};I.push(E)}}}return y&&y.sort(lr),I.sort((w,U)=>w.roundNumber-U.roundNumber),{playoffRounds:y,playoffRoundsRanges:I,error:S}}function fDe({playoffGroups:t,drawDefinition:e,structureId:i}){var r,n;if(!e)return{error:$e};if(!Di(i)||!Array.isArray(t))return{error:se};let a=t.map(({finishingPositions:o})=>o).flat();return{positionRangeMap:(n=(r=kw({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:r.filter(o=>a.includes(o.finishingPosition)))==null?void 0:n.reduce((o,s)=>(o[s.finishingPosition]=s,o),{})}}function ZJ(t){var e,i;let{finishingPositionOffset:r=0,playoffAttributes:n,stageSequence:a=1,staggeredEntry:o,structureName:s,stage:l=Ae,matchUpType:u,structureId:c,idPrefix:d,drawSize:p,isMock:m,uuids:h}=t,f={finishingPositionOffset:r,matchUpType:u,drawSize:p,idPrefix:d,isMock:m,uuids:h},{matchUps:g}=o?$c(f):cl(f),v=so({structureName:s||((e=n==null?void 0:n[0])==null?void 0:e.name)||tn(Ae),structureId:c||(h==null?void 0:h.pop()),stageSequence:a,matchUpType:u,matchUps:g,stage:l}),y=[v],I=[];if(p>2){let b=p/2,{matchUps:S}=cl({finishingPositionOffset:r+b,idPrefix:d&&`${d}-c`,drawSize:b,matchUpType:u,isMock:m}),w=tn(an),U=((i=n==null?void 0:n["0-1"])==null?void 0:i.name)??t.consolationStructureName??(s?`${s} ${w}`:w),T=so({structureName:U,matchUps:S,structureId:h==null?void 0:h.pop(),stage:an,stageSequence:1,matchUpType:u});y.push(T);let D={linkType:zl,source:{roundNumber:1,structureId:v.structureId},target:{roundNumber:1,feedProfile:_o,structureId:T.structureId}};I.push(D)}return{...Z,structures:y,links:I}}function QJ({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let o=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),s=(n==null?void 0:n.roundGroupedOrder)||[],l=n==null?void 0:n.roundFeedProfiles;return Te(1+e,r+1+e).map(u=>{let c=l!=null&&l[u-1]?l[u-1]:u%2&&_o||Yd,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:zl,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},m=s[u-1];return m&&(p.target.groupedOrder=m),ja()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=sl,p.target.feedProfile=_o),o.includes(d)?p:void 0}).filter(Boolean)}function eZ(t){var e,i;let{playoffStructureNameBase:r,finishingPositionOffset:n,stageSequence:a=1,playoffAttributes:o,structureNameMap:s,staggeredEntry:l,stage:u=Ae,matchUpType:c,structureId:d,drawSize:p,idPrefix:m,isMock:h,uuids:f}=t,g={finishingPositionOffset:n,matchUpType:c,drawSize:p,idPrefix:m,isMock:h,uuids:f},{matchUps:v,roundsCount:y}=l?$c(g):cl(g),I=t.structureName??((e=o==null?void 0:o[0])==null?void 0:e.name)??tn(Ae),b=bc({structureId:d||(f==null?void 0:f.pop()),structureName:I,stageSequence:a,matchUpType:c,matchUps:v,stage:u}),S=[b],w=[];if(p>2){let U=[0,2].slice(0,p/16).map((T,D)=>{let P=D+1,{consolationStructure:C}=gDe({idPrefix:m&&`${m}-c${D}`,structureId:f==null?void 0:f.pop(),playoffStructureNameBase:r,playoffAttributes:o,structureNameMap:s,stageSequence:P,roundOffset:T,matchUpType:c,drawSize:p,isMock:h,index:D,uuids:f});S.push(C);let R=QJ({consolationStructure:C,roundsCount:2,mainStructure:b,roundOffset:T});return{consolationStructure:C,links:R}}).map(T=>T.links).flat();if(w.push(...U),p>=4&&p<=16||p>32){let{matchUps:T}=cl({idPrefix:m&&`${m}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:c,isMock:h}),D=((i=o==null?void 0:o["3-4"])==null?void 0:i.name)??tn(Bi),P=(s==null?void 0:s[D])||D,C=r?`${r} ${P}`:P,R=bc({structureId:f==null?void 0:f.pop(),matchUps:T,stageSequence:2,stage:Bi,structureName:C,matchUpType:c}),N={linkType:zl,source:{roundNumber:y-1,structureId:b.structureId},target:{structureId:R.structureId,feedProfile:_o,roundNumber:1}};S.push(R),w.push(N)}}return{structures:S,links:w,...Z}}function gDe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:u,index:c,uuids:d}){var p,m;let h=l/(2*Math.pow(2,n)),{matchUps:f,roundsCount:g}=$c({finishingPositionOffset:h,baseDrawSize:h,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:u,uuids:d}),v=c===0&&((p=i==null?void 0:i["0-1"])==null?void 0:p.name)||c===1&&((m=i==null?void 0:i["0-3"])==null?void 0:m.name)||`${tn(an)} ${c+1}`,y=(r==null?void 0:r[v])||v,I=t?`${t} ${y}`:y;return{consolationStructure:bc({matchUps:f,stage:an,structureName:I,stageSequence:e,matchUpType:a,structureId:o}),consolationRoundsCount:g}}function $p(t){var e,i,r,n;let{finishingPositionOffset:a,stageSequence:o=1,playoffAttributes:s,feedsFromFinal:l,staggeredEntry:u,structureName:c,stage:d=Ae,structureId:p,matchUpType:m,skipRounds:h,feedRounds:f,idPrefix:g,drawSize:v,isMock:y,uuids:I,fmlc:b}=t,S=t.feedPolicy||((e=t.policyDefinitions)==null?void 0:e[sg])||((i=t.appliedPolicies)==null?void 0:i[sg]),w={finishingPositionOffset:a,matchUpType:m,skipRounds:h,drawSize:v,idPrefix:g,isMock:y,uuids:I},{matchUps:U}=u?$c(w):cl(w),T=so({structureName:c||((r=s==null?void 0:s[0])==null?void 0:r.name)||tn(Ae),structureId:p||(I==null?void 0:I.pop()),stageSequence:o,matchUpType:m,matchUps:U,stage:d}),D=[T],P=[],C=v/2,{matchUps:R,roundsCount:N}=$c({finishingPositionOffset:C,idPrefix:g&&`${g}-c`,isConsolation:!0,feedsFromFinal:l,baseDrawSize:C,matchUpType:m,feedRounds:f,skipRounds:h,isMock:y,uuids:I,fmlc:b});if(v>2){let A=((n=s==null?void 0:s["0-1"])==null?void 0:n.name)??tn(an),M=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${A}`:A,E=so({matchUps:R,structureId:I==null?void 0:I.pop(),stage:an,stageSequence:1,structureName:M,matchUpType:m});D.push(E);let O=QJ({consolationStructure:E,mainStructure:T,roundsCount:N,feedPolicy:S,fmlc:b});P.push(...O)}return{...Z,structures:D,links:P}}function tZ({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:m}){var h,f,g,v,y,I;u=u||(n==null?void 0:n[sg]);let b="processPlayoffGroups",S=0,w=[],U=[],T=[],{error:D,positionRangeMap:P}=fDe({structureId:r,drawDefinition:o,playoffGroups:s});if(D)return te({result:{error:D},stack:b});if(!(!P||s!=null&&s.every(C=>{let{finishingPositions:R=[]}=C;if(!R.length)return!1;let N=[...R].sort(lr).map((A,M)=>(R[M+1]||A)-A).every(A=>A<2);return(!t||N)&&R.every(A=>P[A])})))return te({context:{validFinishingPositions:Object.values(P)},result:{error:se},stack:b});for(let C of s){let R=C.finishingPositions,N=P&&R.map($=>{var _;return(_=P[$])==null?void 0:_.finishingPositions}).flat(),A=c*R.length,M=iv(A),E=M===2&&Ys||C.drawType||Ys;N&&(S=Math.min(...N)-1);let O=N&&`${Math.min(...N)}-${Math.max(...N)}`,k=C.structureName||O&&((f=(h=C.playoffAttributes)==null?void 0:h[O])==null?void 0:f.name)||((v=(g=C.playoffAttributes)==null?void 0:g[0])==null?void 0:v.name),x={addNameBaseToAttributeName:C.addNameBaseToAttributeName,playoffStructureNameBase:C.playoffStructureNameBase,finishingPositionNaming:C.finishingPositionNaming,finishingPositionLimit:C.finishingPositionLimit,structureId:C.structureId??(m==null?void 0:m.pop()),playoffAttributes:C.playoffAttributes,structureNameMap:C.structureNameMap,sequenceLimit:C.sequenceLimit,structureName:k,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:S,stage:Bi,stageSequence:a,matchUpType:l,drawSize:M,isMock:p,uuids:m},F=({playoffStructures:$,playoffLinks:_})=>{let[L]=$,B=vU({playoffStructureId:L.structureId,finishingPositions:R,sourceStructureId:r});T.push(B),T.push(..._),U.push(...$),w.push({structureId:L.structureId,finishingPositions:R}),S+=A};if(E===Ys){let{matchUps:$}=cl({finishingPositionLimit:S+A,idPrefix:d&&`${d}-po`,finishingPositionOffset:S,matchUpType:l,drawSize:M,isMock:p,uuids:m}),_=so({structureId:C.structureId??(m==null?void 0:m.pop()),matchUpFormat:e,stage:Bi,structureName:k,stageSequence:a,matchUps:$});U.push(_);let L=vU({playoffStructureId:_.structureId,finishingPositions:R,sourceStructureId:r});T.push(L),S+=A,w.push({structureId:_.structureId,finishingPositions:R})}else if([ig,rg,Bi].includes(E)){let $={playoffAttributes:C.playoffAttributes??i,playoffStructureNameBase:C.playoffStructureNameBase,structureId:C.structureId??(m==null?void 0:m.pop()),structureName:C.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:S,stage:Bi,roundOffset:0,stageSequence:a,drawSize:M,isMock:p,uuids:m};E===ig?Object.assign($,{playoffAttributes:(C==null?void 0:C.playoffAttributes)??i??DF,roundOffsetLimit:3}):E===rg&&Object.assign($,{playoffAttributes:(C==null?void 0:C.playoffAttributes)??i??PF,roundOffsetLimit:2});let _=yf($);if(_.error)return _;if((y=_.links)!=null&&y.length&&T.push(..._.links),(I=_.structures)!=null&&I.length&&U.push(..._.structures),U.sort(Th),_.structureId){let L=vU({playoffStructureId:_.structureId,finishingPositions:R,sourceStructureId:r});T.push(L),w.push({structureId:_.structureId,finishingPositions:R})}S+=A}else if([ng,rw,iy,ty,ey,ry].includes(E)){let $=[m==null?void 0:m.pop(),m==null?void 0:m.pop()],_={playoffStructureNameBase:C.playoffStructureNameBase,structureId:C.structureId??(m==null?void 0:m.pop()),playoffAttributes:C.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:S,uuids:$,stage:Bi,structureName:k,matchUpType:l,feedPolicy:u,drawSize:M,isMock:p},L={[ng]:{fmlc:!0,feedRounds:1},[ry]:{feedRounds:1},[iy]:{feedsFromFinal:3},[ty]:{feedsFromFinal:2},[ey]:{feedsFromFinal:1}};Object.assign(_,L[E]||{});let{structures:B,links:V}=$p(_),[G]=B,j=vU({playoffStructureId:G.structureId,finishingPositions:R,sourceStructureId:r});T.push(j),T.push(...V),U.push(...B),w.push({structureId:G.structureId,finishingPositions:R}),S+=A}else if([ts].includes(E)){let{structures:$,links:_}=Ew({...x,structureOptions:C.structureOptions||{groupSize:4}});F({playoffStructures:$,playoffLinks:_})}else if([iw].includes(E)){let{structures:$,links:_}=ZJ(x);F({playoffStructures:$,playoffLinks:_})}else if([WUe].includes(E)){let{structures:$,links:_}=eZ(x);F({playoffStructures:$,playoffLinks:_})}else if([Ga].includes(E)){let $=so({structureId:C.structureId??(m==null?void 0:m.pop()),structureName:C.structureName,finishingPosition:ZU,stage:Bi,stageSequence:a,matchUps:[]});F({playoffStructures:[$],playoffLinks:[]})}}return{finishingPositionTargets:w,positionRangeMap:P,structures:U,links:T}}function vU({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:Nu,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:fs,roundNumber:1}}}function xw({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>Fw({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function Fw({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:u}=e||{},c=i??o??0,d=p=>{if(!n&&!(r!=null&&r.isMock))return(a==null?void 0:a.pop())??Ht();let m=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${r==null?void 0:r.matchUpId}-${m}-TMU-${p+1}`};return Te(0,c).map(p=>{let m=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Zi,collectionPosition:m,collectionId:l,processCodes:u,matchUpType:s,isMock:n}})}function vDe(t){var e,i,r;let n="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return te({result:{error:Je},info:"playoffGroups required",stack:n});let{sourceStructureId:a,requireSequential:o,tournamentRecord:s,drawDefinition:l,playoffGroups:u,groupCount:c,groupSize:d,event:p}=t,m=tZ({requireSequential:o,sourceStructureId:a,playoffGroups:u,groupCount:c,groupSize:d,...t});if(m.error)return te({result:m,stack:n});let{structures:h=[],links:f=[],finishingPositionTargets:g,positionRangeMap:v}=m,y=g==null?void 0:g.map(({finishingPositions:C})=>C).flat().map(C=>v[C].finishingPositions).flat();l.structures.push(...h),l.links.push(...f);let{matchUps:I,matchUpsMap:b}=fr({inContext:!0,drawDefinition:l}),S=h.map(({structureId:C})=>C),w=I==null?void 0:I.filter(({structureId:C})=>S.includes(C)).map(Dr),U=(e=b==null?void 0:b.drawMatchUps)==null?void 0:e.filter(({matchUpId:C})=>w==null?void 0:w.includes(C));if(U!=null&&U.length){let C=(i=In({drawDefinition:l,event:p}))==null?void 0:i.tieFormat;C&&U.forEach(R=>{let{tieMatchUps:N}=xw({isMock:t.isMock,tieFormat:C,matchUp:R});Object.assign(R,{tieMatchUps:N,matchUpType:Ba})})}let{positionAssignments:T}=oi({structureId:a,drawDefinition:l}),D={};T==null||T.forEach(C=>{var R,N,A;let M=(A=(N=(R=vt({element:C,name:Oc}))==null?void 0:R.extension)==null?void 0:N.value)==null?void 0:A.groupOrder;M&&(D[M]||(D[M]=[]),D[M].push(C.participantId))});let P=Sv({provisionalPositioning:t.provisionalPositioning,structureId:a,applyPositioning:!0,event:t.event,tournamentRecord:s,drawDefinition:l});return P.error&&((r=P.error)==null?void 0:r.code)!==_x.code?te({result:P,stack:n}):{structures:h,links:f,positionsPlayedOff:y,drawDefinition:l,...Z}}function uf({value:t,sourceRange:e,targetRange:i}){let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),o=Math.max(...i);return(t-r)*(o-a)/(n-r)+a}var xo="ELO",iZ="NTRP",IDe="TRN",rZ="UTR",KL="WTN",yDe={ELO:xo,NTRP:iZ,TRN:IDe,UTR:rZ,WTN:KL},bDe={[xo]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[iZ]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[rZ]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[KL]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Sr=bDe;function wDe({sourceRatingType:t,sourceRating:e}){let i=Sr[t].range,r=i[0]>i[1],n=Sr[xo].range;return uf({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function UDe({targetRatingType:t,sourceRating:e}){let i=Sr[t].decimalsCount||0,r=Sr[t].range,n=r[0]>r[1],a=Math.max(...r),o=Sr[xo].range,s=uf({targetRange:r,sourceRange:o,value:e}),l=parseFloat(s.toFixed(i));return n?a-l:l}function P2(t){var e;let i=We(t,[{ratings:!0,[Jn]:ta}]);if(i.error)return i;let r=t.matchUpType&&[ii,ei].includes(t.matchUpType)?t.matchUpType:ii,n=Object.keys(Sr),a=t.targetRatingType&&n.includes(t.targetRatingType)?t.targetRatingType:xo,o=t.ratings[r]?t.ratings[r].reduce((p,m)=>p.includes(m.scaleName)?p:p.concat(m.scaleName),[]):[];if(!o)return{error:Vr};let s=((e=t.ratings[r])==null?void 0:e.find(p=>p.scaleName===a))??t.ratings[r][0];if(o[0]===a)return s;let l=s.scaleName,u=Sr[s.scaleName].accessor,c=u?s.scaleValue[u]:s.scaleValue,d=wDe({sourceRatingType:l,sourceRating:c});return{convertedRating:UDe({targetRatingType:a,sourceRating:d}),sourceRating:c}}function SDe({participantResults:t,sides:e,score:i}){var r,n;let a=e.find(({sideNumber:u})=>u===1),o=e.find(({sideNumber:u})=>u===2),s=(r=a==null?void 0:a.participant)==null?void 0:r.ratings,l=(n=o==null?void 0:o.participant)==null?void 0:n.ratings;if(s!=null&&s[ii]&&l!=null&&l[ii]){let u=xo,{convertedRating:c}=P2({ratings:s,targetRatingType:u}),{convertedRating:d}=P2({ratings:l,targetRatingType:u}),{side1pressure:p,side2pressure:m}=TDe({side1ConvertedRating:c,side2ConvertedRating:d,score:i});p&&t[a==null?void 0:a.participantId].pressureScores.push(p),m&&t[o==null?void 0:o.participantId].pressureScores.push(m);let h=Math.max(...Sr[xo].range),f=YS((d-c)/h),g=YS((c-d)/h);t[a==null?void 0:a.participantId].ratingVariation.push(f),t[o==null?void 0:o.participantId].ratingVariation.push(g)}}function TDe({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){var r,n;let a=t>e?t:e,o=t>e?e:t,s=Math.abs(t-e),l=Sr[xo].range,u=Math.max(...l),c=(u-a)*0,d=(a+c)/u*s,p=(r=i==null?void 0:i.sets)==null?void 0:r.reduce((b,S)=>b+((S==null?void 0:S.side1Score)??0),0),m=(n=i==null?void 0:i.sets)==null?void 0:n.reduce((b,S)=>b+(S.side2Score??0),0),h=t>e?2:1,f=(p||0)*(o+(h===1?d:0)),g=(m||0)*(o+(h===2?d:0)),v=f+g,y=v?YS(f/v):0,I=v?YS(g/v):0;return{side1pressure:y,side2pressure:I}}function XL({winningSide:t,matchUpFormat:e=Ho,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],o=n==null?void 0:n.sets,s=typeof t=="number"&&t-1,l=Ln(e),u=JL((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===Pt&&r!=null&&r.setsCreditForDefaults||i===Ft&&r!=null&&r.setsCreditForWalkovers))a[s]=u;else for(let c of o||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof s=="number"&&i===Hr&&(+a[1-s]===u&&(a[1-s]-=1),r!=null&&r.setsCreditForRetirements&&(a[s]=u)),a}function nZ({matchUpFormat:t=Ho,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){var a,o;let{sets:s}=n||{};if(!s)return[0,0];let l=typeof e=="number"&&e-1,u=Ln(t),c=(u==null?void 0:u.bestOf)??1,d=JL(c),p=((a=u==null?void 0:u.setFormat)==null?void 0:a.tiebreakAt)||0,m=[[],[]];if(typeof l=="number"&&(i===Pt&&r!=null&&r.gamesCreditForDefaults||i===Ft&&r!=null&&r.gamesCreditForWalkovers)){let h=((o=u==null?void 0:u.setFormat)==null?void 0:o.setTo)||0,f=d*h;m[l].push(f)}else s.forEach((h,f)=>{var g;let v=(h.setNumber||f+1)>d&&u!=null&&u.finalSetFormat?"finalSetFormat":"setFormat",y=(g=u==null?void 0:u[v])==null?void 0:g.based,I=u==null?void 0:u[v].tiebreakSet,{side1Score:b,side2Score:S}=h;R2(y)&&(m[0].push(Qe(b||0)),m[1].push(Qe(S||0))),I&&h.winningSide&&(r==null?void 0:r.gamesCreditForTiebreakSets)!==!1&&m[h.winningSide-1].push(1)});if(i===Hr&&typeof l=="number"){let h=s.length>d&&u!=null&&u.finalSetFormat?"finalSetFormat":"setFormat",f=u==null?void 0:u[h];if(R2(f.based)){let g=(f==null?void 0:f.setTo)||0,v=I=>{if(!(!u||I===""))return+I===p-1||+I===p?Qe(p||0)+1:+I<p?g:p},y=XL({winningSide:e,score:{sets:s},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(m.map(I=>I[l]<=I[1-l]).reduce((I,b)=>I+(b?1:0),0)>y[1-l]){let I=m[l].length,b=v(m[1-l][I-1]);b&&(m[l][I-1]=b)}d>m[l].length&&r!=null&&r.gamesCreditForRetirements&&m[l].push(g)}}return[m[0].reduce((h,f)=>h+f,0),m[1].reduce((h,f)=>h+f,0)]}function aZ({matchUpFormat:t,score:e}){var i;let r=t?Ln(t):void 0,n=(r==null?void 0:r.bestOf)??1,a=JL(n),o=[0,0],s=[0,0];return(i=e==null?void 0:e.sets)==null||i.forEach((l,u)=>{var c;let d=(l.setNumber||u+1)>a&&r!=null&&r.finalSetFormat?"finalSetFormat":"setFormat",p=(c=r==null?void 0:r[d])==null?void 0:c.based;if(oZ(p)){let{side1Score:m,side2Score:h}=l;m&&(s[0]+=Qe(m||0)),h&&(s[1]+=Qe(h||0))}else l.side1TiebreakScore&&(s[0]+=Qe(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(s[1]+=Qe(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(o[l.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:o}}function JL(t){return t&&Math.ceil(t/2)||1}function oZ(t){return t==="P"}function R2(t){return!oZ(t)}function DDe({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:r,totalSets:n}){var a;let o=e&&Ln(e)||{},s=o.bestOf,l=s&&Math.ceil(s/2)||1,u=(a=o.setFormat)==null?void 0:a.setTo;Object.keys(t).forEach(c=>{let d=t[c].setsWon,p=t[c].setsLost,m=i!=null&&i.groupTotalSetsPlayed?n:r*(l||0)||d+p,h=Math.round(d/m*1e3)/1e3;(h===1/0||isNaN(h))&&(h=m);let f=t[c].tieMatchUpsWon,g=t[c].tieMatchUpsLost,v=f+g,y=Math.round(f/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=f);let I=t[c].matchUpsWon,b=t[c].matchUpsLost,S=I+b,w=Math.round(I/S*1e3)/1e3;(w===1/0||isNaN(w))&&(w=I);let U=t[c].gamesWon||0,T=t[c].gamesLost||0,D=(r||0)*(l||0)*(u||0),P=Math.max(D,U+T),C=Math.round(U/P*1e3)/1e3;(C===1/0||isNaN(C))&&(C=0);let R=t[c].pointsWon+t[c].pointsLost,N=Math.round(t[c].pointsWon/R*1e3)/1e3;(N===1/0||isNaN(N))&&(N=0),t[c].setsWon=d,t[c].setsLost=p,t[c].setsPct=h,t[c].tieMatchUpsWon=f,t[c].tieMatchUpsPct=y,t[c].matchUpsPct=w,t[c].gamesWon=U,t[c].gamesLost=T,t[c].gamesPct=C,t[c].pointsPct=N,t[c].result=`${t[c].matchUpsWon}/${t[c].matchUpsLost}`})}function Lw({participantIds:t,pressureRating:e,matchUpFormat:i,tallyPolicy:r,perPlayer:n,matchUps:a}){var o,s,l,u,c,d,p;let m={},h=(r==null?void 0:r.excludeMatchUpStatuses)||[],f=a==null?void 0:a.filter(v=>(v.tieMatchUps||!h.includes(v.matchUpStatus))&&(!(t!=null&&t.length)||ji(t,[cf(v,0),cf(v,1)]).length===2)),g=(o=f==null?void 0:f.flatMap(({score:v,tieMatchUps:y})=>{var I;return y?y.filter(({matchUpStatus:b})=>!h.includes(b)).flatMap(({score:b})=>{var S;return((S=b==null?void 0:b.sets)==null?void 0:S.length)??0}):((I=v==null?void 0:v.sets)==null?void 0:I.length)??0}))==null?void 0:o.reduce((v,y)=>v+y,0);for(let v of f??[]){let{matchUpStatus:y,tieMatchUps:I,tieFormat:b,score:S,winningSide:w,sides:U}=v,T=b&&v._disableAutoCalc&&b.collectionDefinitions.every(({scoreValue:N})=>N),D=w&&PDe(v),P=w&&RDe(v);if(!D&&!P)if(y&&Ir.includes(y)){let N=cf(v,0),A=cf(v,1);N&&(uc(m,N),m[N].matchUpsCancelled+=1),A&&(uc(m,A),m[A].matchUpsCancelled+=1)}else if(I!=null&&I.length){n=0;for(let N of I){if(N.winningSide){let A=(s=U==null?void 0:U.find(({sideNumber:E})=>E===N.winningSide))==null?void 0:s.participantId,M=(l=U==null?void 0:U.find(({sideNumber:E})=>E===N.winningSide))==null?void 0:l.participantId;A&&M&&(uc(m,A),uc(m,M),m[A].tieMatchUpsWon+=1,m[M].tieMatchUpsLost+=1,Xi(ii)(N.matchUpType)?(m[A].tieSinglesWon+=1,m[M].tieSinglesLost+=1):Xi(ei)(N.matchUpType)&&(m[A].tieDoublesWon+=1,m[M].tieDoublesLost+=1))}C2({score:N.score,manualGamesOverride:T,participantResults:m,sides:U})}}else C2({manualGamesOverride:T,participantResults:m,score:S,sides:U});else if(uc(m,D),uc(m,P),I==null?void 0:I.length){n=0;for(let N of I){let{matchUpType:A}=N,M=Xi(ei)(A),E=Xi(ii)(A);N.winningSide&&(N.winningSide===w?(D&&(m[D].tieMatchUpsWon+=1,E&&(m[D].tieSinglesWon+=1),M&&(m[D].tieDoublesWon+=1)),P&&(m[P].tieMatchUpsLost+=1,E&&(m[P].tieSinglesLost+=1),M&&(m[P].tieDoublesLost+=1))):N.winningSide!==w&&(P&&(m[P].tieMatchUpsWon+=1,E&&(m[P].tieSinglesWon+=1),M&&(m[P].tieDoublesWon+=1)),D&&(m[D].tieMatchUpsLost+=1,E&&(m[D].tieSinglesLost+=1),M&&(m[D].tieDoublesLost+=1)))),E2({matchUpFormat:N.matchUpFormat,matchUpStatus:N.matchUpStatus,matchUpType:N.matchUpType,score:N.score,sides:N.sides,winningParticipantId:D,losingParticipantId:P,manualGamesOverride:T,participantResults:m,isTieMatchUp:!0,pressureRating:e,tallyPolicy:r,winningSide:w})}sZ({winningParticipantId:D,losingParticipantId:P,participantResults:m,matchUpStatus:y})}else E2({matchUpFormat:v.matchUpFormat??i,matchUpType:v.matchUpType,isTieMatchUp:void 0,winningParticipantId:D,manualGamesOverride:T,losingParticipantId:P,participantResults:m,pressureRating:e,matchUpStatus:y,tallyPolicy:r,winningSide:w,score:S,sides:U});let C=(u=S==null?void 0:S.sets)==null?void 0:u.reduce((N,A)=>N+((A==null?void 0:A.side1Score)??0),0),R=(c=S==null?void 0:S.sets)==null?void 0:c.reduce((N,A)=>N+(A.side2Score??0),0);if(T){let N=(d=U==null?void 0:U.find(({sideNumber:M})=>M===1))==null?void 0:d.participantId,A=(p=U==null?void 0:U.find(({sideNumber:M})=>M===2))==null?void 0:p.participantId;uc(m,N),uc(m,A),N&&(m[N].gamesWon+=C,m[N].gamesLost+=R),A&&(m[A].gamesWon+=R,m[A].gamesLost+=C)}}return DDe({participantResults:m,matchUpFormat:i,tallyPolicy:r,perPlayer:n,totalSets:g}),{participantResults:m}}function PDe(t){let e=t.winningSide-1;return cf(t,e)}function RDe(t){let e=1-(t.winningSide-1);return cf(t,e)}function cf(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function uc(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function C2({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],o=[0,0];for(let l of n||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(o[u-1]+=1),a[0].push(Qe(c||0)),a[1].push(Qe(d||0))}let s=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];r.forEach((l,u)=>{let{participantId:c}=l;c&&(uc(e,c),e[c].setsWon+=o[u],e[c].setsLost+=o[1-u],t||(e[c].gamesWon+=s[u],e[c].gamesLost+=s[1-u]))})}function E2({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:o,isTieMatchUp:s,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let m=c&&c-1,h=1-m;n&&l===ii&&SDe({participantResults:r,sides:p,score:d}),s||sZ({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:o});let f=XL({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=nZ({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:v}=aZ({score:d,matchUpFormat:a});t&&(r[t].setsWon+=f[m],r[t].setsLost+=f[h],e||(r[t].gamesWon+=g[m],r[t].gamesLost+=g[h]),r[t].pointsWon+=v[m],r[t].pointsLost+=v[h]),i&&(r[i].setsWon+=f[h],r[i].setsLost+=f[m],e||(r[i].gamesWon+=g[h],r[i].gamesLost+=g[m]),r[i].pointsWon+=v[h],r[i].pointsLost+=v[m])}function sZ({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===Ft&&(i[e].walkovers+=1),r===Pt&&(i[e].defaults+=1),r===Hr&&(i[e].retirements+=1),[Pt,Hr,Ft].includes(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function CDe({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(o=>{o.participantId&&o.participant&&(r[o.participantId]=o.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,o)=>{var s,l;if((s=a.excludedDirectives)!=null&&s.length){let u=a.excludedDirectives.map(({attribute:p})=>p).join(", "),c=`${u.length} directives were excluded due to participants limit}`;n.push(c);let d=`Excluded: ${u}`;n.push(d)}else{let u=(f,g)=>parseFloat(a.reversed?f:g)-parseFloat(a.reversed?g:f),c=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=f=>{f.groups&&Object.keys(f.groups).sort(u).forEach(g=>{let v=f.groups[g].map(I=>r[I]).join(", "),y=`${g} ${f.attribute}: ${v}`;n.push(y)})},p=a.reversed?" in reverse order":"",m=a.groups?"grouped":"separated",h=`Step ${o+1}: ${c} particiants were ${m}${p} by ${a.attribute}`;if(n.push(h),a.idsFilter){let f=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;n.push(f)}d(a)}n.push("----------------------")}),n.push("Final Order:"),e.forEach(a=>{let{participantId:o,resolved:s}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[o]} => resolved: ${!!s}`)}),n.join(`\r
`)}function lZ({participantResults:t,participantIds:e,attribute:i}){return uZ({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:o}=n,s=o==null?void 0:o[i];return!isNaN(s)&&a&&(r[s]?r[s].push(a):r[s]=[a]),r},{})}function uZ(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var EDe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],GC={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function M2(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!MDe(t))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n==null?void 0:n.groupOrderKey)?n.groupOrderKey:"matchUpsWon",s=lZ({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l=Object.keys(s).map(g=>parseFloat(g)).sort((g,v)=>v-g).map(g=>s[g]).map(g=>{let v=cZ({participantIds:g,...t});return a.push(...v.report??[]),v.order}).map((g,v)=>g.map(y=>y.resolved?y:{...y,subGroup:[v].concat(...y.subGroup??[])})).flat(),u,c=0,d=1,p;l.forEach((g,v)=>{var y;v&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let I=parseInt(((y=g.subGroup)==null?void 0:y.join(""))||0);g.resolved?(g.position=v+1,d=g.position):(u&&I>u&&(d+=c,c=0),g.position=d,c+=1),u=I});let m=l.map(({position:g})=>g),h=Pa(m);return l.forEach(g=>{let{participantId:v,position:y}=g||{},I=i[v];g.GEMscore=f(I);let b=h[y];(g==null?void 0:g.position)!==void 0&&(b>1&&(g.ties=b,r&&(g.subOrder=r[v])),g.rankOrder=y,g.groupOrder=y+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function f(g){return(Array.isArray(n==null?void 0:n.GEMscore)?Object.keys(GC).filter(v=>n.GEMscore.includes(v)):Object.keys(GC)).map(v=>(g[v]||0)*Math.pow(10,GC[v].toFixed(3))).reduce((v,y)=>v+y,0)}}function MDe({participantResults:t,participantsCount:e}){let i=uZ({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function NDe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:r,attribute:n,idsFilter:a,matchUps:o,reversed:s}){let{participantResults:l}=Lw({participantIds:a&&e,matchUpFormat:i,tallyPolicy:r,matchUps:o}),u=lZ({participantResults:l,participantIds:e,attribute:n}),c=[{attribute:n,reversed:s,groups:u,idsFilter:a}],d;return Object.keys(u).length>1&&e.length&&(d=Object.keys(u).map(p=>parseFloat(p)).sort((p,m)=>s?p-m:m-p).map(p=>u[p]).map(p=>{let m=cZ({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:r,matchUps:o});return c.push(...m.report??[]),m.order}).map((p,m)=>p.map(h=>h.resolved?h:{...h,subGroup:[m].concat(...h.subGroup??[])})).flat()),{order:d,report:c}}function cZ({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let o=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(n!=null&&n.headToHead)||!n.headToHead.disabled&&!e)){let c=ADe({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:c,headToHeadWinner:d,report:s}}}let u=((n==null?void 0:n.tallyDirectives)||EDe).filter(c=>{let d=!(_i(c.maxParticipants)&&(i==null?void 0:i.length)>c.maxParticipants);return d||o.push(c),d});return o.length&&s.push({excludedDirectives:o,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,disableHeadToHead:m})=>(l=NDe({disableHeadToHead:m,participantIds:i,matchUpFormat:r,tallyPolicy:n,attribute:c,idsFilter:p,matchUps:a,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(c=>({participantId:c})),report:s}}function ADe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function Dv({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:o}){if(!(n!=null&&n.length)||!Ro(n))return{error:Xu};let s=dt(n.map(({structureId:b})=>b));if(s.length!==1)return te({result:{error:se,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:s}});let l=n.filter(b=>b&&b.matchUpStatus!==jt),u=l.length&&dt(l.map(({drawPositions:b})=>b).flat()).length,c=l.filter(b=>Cd({matchUp:b})).length===l.length;c||(o=0);let d=n.every(({matchUpType:b,tieMatchUps:S})=>b===fi&&(S==null?void 0:S.every(w=>Cd({matchUp:w})))),p=t==null?void 0:t[FF],m=n.filter(b=>Cd({matchUp:b})||b.matchUpType===fi),{participantResults:h}=Lw({matchUps:m,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:o}),f,g,{groupOrder:v,report:y}=M2({matchUps:m,participantResults:h,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a});if(i&&ODe({participantResults:h}),c&&v)f=y,g=v,v.forEach(b=>{let{participantId:S,groupOrder:w,rankOrder:U,subOrder:T,ties:D,GEMscore:P}=b,C=h[S];Object.assign(C,{groupOrder:w,rankOrder:U,GEMscore:P,subOrder:T,ties:D})});else{let{groupOrder:b,report:S}=M2({requireCompletion:!1,participantResults:h,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});f=S,g=b,b&&b.forEach(w=>{let{participantId:U,groupOrder:T,GEMscore:D}=w,P=h[U];Object.assign(P,{provisionalOrder:T,GEMscore:D})})}let I={completedTieMatchUps:d,readableReport:"",participantResults:h,bracketComplete:c,order:[],report:f};if((c||d)&&(I.order=g),e||ja({tally:!0})){let b=CDe({matchUps:n,report:f,order:g});ja({tally:!0})&&console.log(b),I.readableReport=b}return I}function ODe({participantResults:t}){let e=n=>n.reduce((a,o)=>a+parseFloat(o),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:o}=a,s=o!=null&&o.length?i(o):0;return{participantId:n,averagePressure:s}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function dZ({positionAssignments:t}){let e=(t||[]).filter(Ma(ql)).map(n=>{let{extension:a}=vt({element:n,name:lg}),o=Qe(a==null?void 0:a.value),s=!isNaN(o)&&o;return s&&{participantId:n.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=Pa(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function ZL({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!Ro(n))return{error:se};if(!t)return{error:se};let{policyDefinitions:o}=Qu({policyTypes:[FF],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:s}=dZ({positionAssignments:t}),l=n.length?Dv({policyDefinitions:o,matchUpFormat:r,subOrderMap:s,matchUps:n}):void 0;if(l!=null&&l.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(m=>{let{participantId:h}=m;if(p.includes(h)){let f={value:u[h],name:Oc};_t({element:m,extension:f}),u[h].ties||Dn({element:m,name:lg})}else Dn({element:m,name:Oc}),Dn({element:m,name:lg})}),li({drawDefinition:i}),{...Z,participantResults:u,bracketComplete:c,report:d}}function pZ({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function Si(t){let e=We(t,[{[$n]:!0,[vl]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:o,matchUpId:s,inContext:l,context:u,event:c}=t,{structures:d=[]}=rs({drawDefinition:a}),p=t.contextContent||n&&ec({contextProfile:n,drawDefinition:a});for(let m of d){let{matchUps:h}=qt({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:o,inContext:l,structure:m,context:u,event:c}),{matchUp:f}=pZ({matchUps:h,matchUpId:s});if(f)return{matchUp:f,structure:m}}return{error:hn}}function nR(t){var e;return!At(t)||!t.notes?{error:Je}:At(t.element)?!Di(t.notes)&&!((e=t.notes)!=null&&e.testing)?{error:se}:(Object.assign(t.element,{notes:t.notes}),{...Z}):{error:se}}function QL(t){return At(t)?At(t.element)?(t.element.notes&&delete t.element.notes,{...Z}):{error:se}:{error:Je}}var aR={matchUpStatus:Zi,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Xs(t){var e,i,r,n,a,o,s,l;let u="modifyMatchUpScore",c=t.matchUpFormat,d=t.matchUp,p,{matchUpStatusCodes:m,tournamentRecord:h,drawDefinition:f,matchUpStatus:g,removeScore:v,winningSide:y,matchUpId:I,event:b,notes:S,score:w}=t,U=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(e=Bt({policyTypes:[fo],tournamentRecord:h,drawDefinition:f,structure:p,event:b}))==null?void 0:e.appliedPolicies,T=d.matchUpType===fi;if(T&&f){if(I&&d.matchUpId!==I){let M=Si({drawDefinition:f,matchUpId:I,event:b});if(!M.matchUp)return{error:hn};({matchUp:d,structure:p}=M)}}else d.matchUpId!==I&&console.log("!!!!!");g&&[Ft,tr].includes(g)||v?Object.assign(d,{...aR}):w&&(d.score=w);let D=g&&(d==null?void 0:d.matchUpStatus)===Pt&&g!==Pt;g&&(d.matchUpStatus=g),c&&(d.matchUpFormat=c),m&&(d.matchUpStatusCodes=m),y&&(d.winningSide=y),t.removeWinningSide&&(d.winningSide=void 0),!p&&f&&({structure:p}=Si({drawDefinition:f,matchUpId:I,event:b})),g&&!d.winningSide&&yr(d)&&!Ir.includes(g)&&![Sh,rd,Ea].includes(g)&&(d.matchUpStatus=us);let P;if((D&&(i=d==null?void 0:d.processCodes)!=null&&i.length||g===Pt)&&(P=(n=(r=U==null?void 0:U[fo])==null?void 0:r.processCodes)==null?void 0:n.incompleteAssignmentsOnDefault),!d.collectionId){let M=(p==null?void 0:p.structureType)===_n,E=Yn({structure:p});if(mL({drawDefinition:f,structure:p})||E||M){let O=F=>{c=T?"SET1-S:T100":c??d.matchUpFormat??(F==null?void 0:F.matchUpFormat)??(f==null?void 0:f.matchUpFormat)??(b==null?void 0:b.matchUpFormat);let $=T?{matchUpTypes:[fi]}:void 0,{matchUps:_}=qt({afterRecoveryTimes:!1,tournamentRecord:h,inContext:!0,matchUpFilters:$,drawDefinition:f,structure:F,event:b});return E&&(F.positionAssignments=dt(_.flatMap(L=>(L.sides??[]).map(B=>B.participantId)).filter(Boolean)).map(L=>({participantId:L}))),ZL({positionAssignments:F.positionAssignments,tournamentRecord:h,drawDefinition:f,matchUpFormat:c,matchUps:_,event:b})},k=M&&p.structures.find(F=>F==null?void 0:F.matchUps.find($=>$.matchUpId===I)),x=O(k||p);if(x.error)return te({result:x,stack:u})}}if(S){let M=nR({element:d,notes:S});if(M.error)return te({result:M,stack:u})}let C=h==null?void 0:h.tournamentId,R=So().topics.includes(LP),N=(R||P)&&ln({drawDefinition:f}),A=N&&((a=fr({matchUpFilters:{matchUpIds:[I]},nextMatchUps:!0,tournamentRecord:h,inContext:!0,drawDefinition:f,matchUpsMap:N}).matchUps)==null?void 0:a[0]);if(R&&A&&NSe({tournamentId:C,inContextMatchUp:A}),Array.isArray(P)&&A&&!((o=A.sides)!=null&&o.every(({participantId:M})=>M)))if(g===Pt)d.processCodes=dt([...d.processCodes??[],...P]);else for(let M of P||[]){let E=M&&((s=d==null?void 0:d.processCodes)==null?void 0:s.lastIndexOf(M));(l=d==null?void 0:d.processCodes)==null||l.splice(E,1)}return Ct({eventId:b==null?void 0:b.eventId,context:u,drawDefinition:f,tournamentId:C,matchUp:d}),{...Z}}function e_(t){var e,i,r,n;let{matchUpStatusCodes:a,matchUpStatus:o,structure:s,matchUp:l,dualMatchUp:u,inContextMatchUp:c,autoCalcDisabled:d}=t,p=Sw({matchUpStatus:o})||[yl,ua].includes(o)&&u||d,m=((e=l==null?void 0:l.sides)==null?void 0:e.map(y=>y.participantId).filter(Boolean).length)||((i=c==null?void 0:c.sides)==null?void 0:i.map(y=>y.participantId).filter(Boolean).length),h="attemptToModifyScore";if(!(Yn({structure:s})&&m===1||o===Pt&&m||kDe({structure:s,matchUp:l,inContextMatchUp:c})||((n=(r=t.appliedPolicies)==null?void 0:r[fo])==null?void 0:n.requireParticipantsForScoring)===!1))return te({result:{error:zx},stack:h});let f=[Ft].includes(o),g=p?o:t.winningSide&&Ki||Ea,v=Xs({...t,matchUpStatusCodes:p&&a||[],matchUpStatus:g,context:h,removeScore:f});return te({result:v,stack:h})}function kDe({structure:t,matchUp:e,inContextMatchUp:i}){var r;let{drawPositions:n}=e,{positionAssignments:a}=Er({structure:t}),o=a==null?void 0:a.filter(l=>(n==null?void 0:n.includes(l.drawPosition))&&l.participantId),s=(r=i==null?void 0:i.sides)==null?void 0:r.every(l=>l.participantId);return(o==null?void 0:o.length)===2||s}function mZ({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>st(r==null?void 0:r.groupValue)&&(r==null?void 0:r.groupNumber)).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>Qe(r));return{groupValueGroups:e,groupValueNumbers:i}}function xDe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(y=>y.collectionId===t.collectionId),o=[0,0],s=[0,0],l=a.every(y=>Ir.includes(y.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:m,scoreValue:h,setValue:f}=t,g=c&&e.includes(c),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),st(p)?a.forEach(y=>{y.winningSide&&(o[y.winningSide-1]+=p)}):st(f)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(S=>{S.winningSide&&(o[S.winningSide-1]+=f)})}):st(h)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(S=>{let{side1TiebreakScore:w=0,side2TiebreakScore:U=0,side1Score:T=0,side2Score:D=0}=S;(y.matchUpStatus===Ki||y.winningSide||S.winningSide)&&(T||D?(o[0]+=T,o[1]+=D):(w||U)&&S.winningSide&&(o[S.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(y=>{if(y.winningSide){let I=y.collectionPosition,b=FDe({collectionDefinition:t,collectionPosition:I});st(b)&&(o[y.winningSide-1]+=b)}}),st(d)){let y;if(m!=null&&m.aggregateValue)l&&(st(p||f||h)&&o[0]!==o[1]?y=o[0]>o[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(m!=null&&m.valueGoal)y=o.reduce((I,b,S)=>b>=m.valueGoal?S+1:I,0);else{let I=Math.floor(t.matchUpCount/2)+1;y=v.reduce((b,S,w)=>S>=I?w+1:b,0)}y&&(g?i[c].values[y-1]+=d:s[y-1]+=d)}else g?(i[c].values[0]+=o[0]||0,i[c].values[1]+=o[1]||0):s=o;g?(i[c].sideWins[0]+=v[0]||0,i[c].sideWins[1]+=v[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):s.forEach((y,I)=>r[I]+=y||0)}function FDe({collectionDefinition:t,collectionPosition:e}){var i,r;return(r=(i=t.collectionValueProfiles||[])==null?void 0:i.find(n=>n.collectionPosition===e))==null?void 0:r.matchUpValue}function _w(t){var e,i,r,n,a;let{sideAdjustments:o=[0,0],separator:s="-",drawDefinition:l,matchUpsMap:u,structure:c,matchUp:d,event:p}=t;if(!Array.isArray(o)||o.length!==2||isNaN(o.reduce((D,P)=>D+P)))return{error:se};if(!d)return{error:sa};let m=((e=In({matchUp:d,drawDefinition:l,structure:c,event:p}))==null?void 0:e.tieFormat)||(t==null?void 0:t.tieFormat);if(!m)return{error:ov};let h=qn({tieFormat:m});if(h.error)return h;let f=(m==null?void 0:m.collectionDefinitions)||[],g=(d==null?void 0:d.tieMatchUps)??[],v=[0,0],{groupValueGroups:y,groupValueNumbers:I}=mZ(m);for(let D of f)xDe({collectionDefinition:D,groupValueNumbers:I,groupValueGroups:y,sideTieValues:v,tieMatchUps:g});for(let D of I){let P=y[D],{allGroupMatchUpsCompleted:C,matchUpCount:R,winCriteria:N,groupValue:A,sideWins:M,values:E}=P,O;if(N!=null&&N.aggregateValue)C&&E[0]!==E[1]&&(O=E[0]>E[1]?1:2);else if(N!=null&&N.valueGoal)O=E.reduce((k,x,F)=>x>=N.valueGoal?F+1:k,void 0);else{let k=Math.floor(R/2)+1;O=M.reduce((x,F,$)=>F>=k?$+1:x,void 0)}O&&(v[O-1]+=A||0)}let b=v.map((D,P)=>(D||0)+o[P]),S={side1Score:b[0],side2Score:b[1],winningSide:void 0},w=b.join(s),U=b.slice().reverse().join(s),T;if(m!=null&&m.winCriteria){let{valueGoal:D,aggregateValue:P,tallyDirectives:C}=m.winCriteria;if(D?T=(i=b.map((R,N)=>({sideNumber:N+1,points:R})).find(({points:R})=>R>=D))==null?void 0:i.sideNumber:P&&g.every(R=>R.matchUpStatus&&Ir.includes(R.matchUpStatus)||R.winningSide)&&b[0]!==b[1]&&(T=b[0]>b[1]?1:2),!T&&C){let R=d.matchUpId,N=d.hasContext?d:((r=u==null?void 0:u.drawMatchUps)==null?void 0:r[R])||l&&((n=Si({inContext:!0,drawDefinition:l,matchUpId:R}))==null?void 0:n.matchUp);if(N){let{completedTieMatchUps:A,order:M}=Dv({matchUps:[N]});if(A&&M!=null&&M.length){let E=M[0].participantId;T=(a=N.sides.find(({participantId:O})=>O===E))==null?void 0:a.sideNumber}}}}return T&&(S.winningSide=T),{scoreStringSide1:w,scoreStringSide2:U,winningSide:T,set:S}}function $w({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){var a,o;if(r){t||(t=(a=Si({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:s}=vt({element:e,name:ku}),l=Ne((s==null?void 0:s.value)||{},!1,!0),u=({displaySideNumber:c,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:c});r.sides=(o=t==null?void 0:t.sides)==null?void 0:o.map(c=>{var d;let p=c.participantId,m=p&&l[p]||void 0,{lineUp:h,...f}=((d=r.sides)==null?void 0:d.find(({sideNumber:v})=>v===c.sideNumber))??{},g=h!=null&&h.length?h:m;return{...u(c),...f,lineUp:g}}),Ct({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function Yr(t){if(t)return Ne(t,!1,!0)}function t_(t){let e=We(t,[{[fn]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:s})=>s),o=n.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...o),i.eventIds.push(...a),i.drawIds.push(...o),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function hZ({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=t_({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&(r==null?void 0:r[n].includes(e))||i&&(r==null?void 0:r[n].includes(i)))}function tc(t){var e,i,r,n;let{exitWhenNoValues:a,drawDefinition:o,matchUpStatus:s,removeScore:l,matchUpsMap:u,matchUpId:c,event:d}=t,p=t.tournamentRecords||t.tournamentRecord&&{[(e=t.tournamentRecord)==null?void 0:e.tournamentId]:t.tournamentRecord}||{},m=t.tournamentId||((i=t.tournamentRecord)==null?void 0:i.tournamentId);p&&hZ({tournamentRecords:p,...t});let h=m&&p[m];if(!h)return{error:ve};let f=Si({drawDefinition:o,event:d,matchUpId:c});if(f.error)return f;if(!f.matchUp)return{error:hn};let{matchUp:g,structure:v}=f;if(!g.tieMatchUps)return{error:la};$w({tournamentId:h==null?void 0:h.tournamentId,eventId:d==null?void 0:d.eventId,dualMatchUp:g,drawDefinition:o});let{extension:y}=vt({name:Am,element:g});if(y!=null&&y.value)if(l)Dn({element:g,name:Am});else return{...Z,score:g.score};let I=(r=In({drawDefinition:o,structure:v,matchUp:g,event:d}))==null?void 0:r.tieFormat;g.tieFormat=Yr(I);let b=_w({drawDefinition:o,matchUpsMap:u,structure:v,matchUp:g,event:d}),{winningSide:S,set:w,scoreStringSide1:U,scoreStringSide2:T}=b,D=(w==null?void 0:w.side1Score)||(w==null?void 0:w.side2Score);if(a&&!g.score&&!D)return{...Z};let P={scoreStringSide1:U,scoreStringSide2:T,sets:w?[w]:[]},C=S&&[1,2].includes(S),R=C&&Ki||bL({matchUpStatus:s??g.matchUpStatus,tieMatchUps:g.tieMatchUps,winningSide:g.winningSide,score:P})&&us||Zi,N=!!(g.winningSide&&!C),A=g.tieMatchUps.find(({score:E,winningSide:O,matchUpStatus:k})=>{var x;return((x=E==null?void 0:E.sets)==null?void 0:x.length)&&(E.sets[0].side1Score||E.sets[0].side2Score)||k&&Ir.includes(k)||O}),M;if(g.tieFormat&&!C&&!A){let E=(n=In({drawDefinition:o,structure:v,event:d}))==null?void 0:n.tieFormat;E&&JSON.stringify(I)===JSON.stringify(E)&&(g.tieFormatId=void 0,g.tieFormat=void 0,M=!0)}return Xs({appliedPolicies:t.appliedPolicies,matchUpStatus:R,score:P,removeWinningSide:N,tournamentRecord:h,drawDefinition:o,removeScore:l,winningSide:S,matchUpId:c,matchUp:g,event:d}),{...Z,score:P,removeWinningSide:N,tieFormatRemoved:M,winningSide:S}}function LDe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){var m,h,f,g,v;let y="directWinner";if(o){let I=u.drawPositions||[],b=I[t],S=o.source.structureId,w=tt({structureId:S,drawDefinition:l});if(w.error)return w;let{structure:U}=w,{positionAssignments:T}=Er({structureId:S,drawDefinition:l}),D=(m=T==null?void 0:T.find(M=>M.drawPosition===n))==null?void 0:m.participantId,P=o.target.structureId,{positionAssignments:C}=Er({structureId:P,drawDefinition:l}),R=(h=C==null?void 0:C.find(M=>M.participantId===D))==null?void 0:h.drawPosition,N=C==null?void 0:C.filter(M=>{let E=I.includes(M.drawPosition),O=!M.participantId&&!M.bye&&!M.qualifier;return E&&O}).map(M=>M.drawPosition),A=N==null?void 0:N.includes(b);if(D&&o.target.roundNumber===1&&A)ul({drawPosition:b,participantId:D,structureId:P,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(D&&N!=null&&N.length){let M=N.pop();M&&ul({participantId:D,structureId:P,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:M,matchUpsMap:d,event:p})}else if(R){let M=pg({drawPosition:R,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(M.error)return te({result:M,stack:y})}else if((U==null?void 0:U.stage)!==Ke){let M="winner target position unavaiallble";return console.log(M),{error:M}}if(U!=null&&U.seedAssignments&&U.structureId!==P){let M=U.seedAssignments.find(({participantId:O})=>O===D),E=M==null?void 0:M.participantId;M&&E&&Uv({eventId:u==null?void 0:u.eventId,structureId:P,...M,tournamentRecord:a,drawDefinition:l,participantId:E})}}else{let I=pg({matchUpId:u.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(I.error)return I}if(c&&i){let I=(f=c.sides)==null?void 0:f.find(b=>b.sideNumber===i);if(I!=null&&I.lineUp){let b=c.roundPosition,S=u.roundPosition,w=b===S&&b!==1||Math.floor(b/2)===S?2:1,U=(g=d==null?void 0:d.drawMatchUps)==null?void 0:g.find(({matchUpId:P})=>P===u.matchUpId),T=[1,2].map(P=>{var C;return{...((C=U.sides)==null?void 0:C.find(R=>R.sideNumber===P))||{},sideNumber:P}});U.sides=T;let D=U.sides.find(P=>P.sideNumber===w);if(D){let P=(v=I.lineUp)==null?void 0:v.filter(C=>C==null?void 0:C.participantId);D.lineUp=xL({lineUp:P}),Ct({tournamentId:a==null?void 0:a.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:U,context:y,drawDefinition:l})}}}return{...Z}}function _De(t){var e,i,r;let{loserMatchUpDrawPositionIndex:n,inContextDrawMatchUps:a,projectedWinningSide:o,sourceMatchUpStatus:s,loserDrawPosition:l,tournamentRecord:u,loserTargetLink:c,drawDefinition:d,loserMatchUp:p,dualMatchUp:m,matchUpsMap:h,event:f}=t,g="directLoser",v=c.linkCondition,y=p.drawPositions||[],I=v===sl&&p.roundNumber===2&&Math.min(...y.filter(Boolean)),b=I||y[n],S=I||y[1-n],w=c.source.structureId,{structure:U}=tt({structureId:w,drawDefinition:d}),{matchUps:T}=qt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:d,structure:U,event:f}),D=T.filter(L=>{var B;return(B=L.drawPositions)==null?void 0:B.includes(l)}).filter(L=>{let B=L.sides.find(G=>G.drawPosition===l),V=L.matchUpStatus===Ft||L.matchUpStatus===Pt&&!yr(L);return(B==null?void 0:B.sideNumber)===L.winningSide&&!V}),P=v===sl&&D.length===0,{positionAssignments:C}=Er({structureId:w,drawDefinition:d}),R=(e=C==null?void 0:C.find(L=>L.drawPosition===l))==null?void 0:e.participantId,N=c.target.structureId,{positionAssignments:A}=Er({structureId:N,drawDefinition:d}),M=A==null?void 0:A.filter(({drawPosition:L})=>y.includes(L));if(M!=null&&M.some(L=>L.participantId===R))return{...Z};let E=M==null?void 0:M.filter(L=>{let B=y.includes(L.drawPosition),V=!L.participantId&&!L.bye&&!L.qualifier;return B&&V}).map(L=>L.drawPosition),O=E==null?void 0:E.includes(b),k=c.target.roundNumber>1&&(E==null?void 0:E.length),x=c.target.roundNumber===1&&O;if(I){let L=F();if(L.error)return te({result:L,stack:g})}else if(x){let L=_();if(L.error)return te({result:L,stack:g})}else if(R&&k){E.sort(lr);let L=E[0],B=ul({participantId:R,structureId:N,drawPosition:L,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:u,drawDefinition:d,matchUpsMap:h,event:f});if(B.error)return te({result:B,stack:g})}else return te({context:{loserDrawPosition:l,loserTargetLink:c,targetDrawPositionIsUnfilled:O},result:{error:O?rv:Uwe},stack:g});if(U!=null&&U.seedAssignments&&U.structureId!==N){let L=U.seedAssignments.find(({participantId:V})=>V===R),B=L==null?void 0:L.participantId;L&&B&&Uv({eventId:p==null?void 0:p.eventId,structureId:N,...L,tournamentRecord:u,drawDefinition:d,participantId:B})}if(m&&o){let L=(i=m.sides)==null?void 0:i.find(B=>B.sideNumber===3-o);if(L!=null&&L.lineUp){let{roundNumber:B,eventId:V}=p,{roundPosition:G}=m,j=B===1?2-G%2:1,z=(r=h==null?void 0:h.drawMatchUps)==null?void 0:r.find(({matchUpId:Y})=>Y===p.matchUpId),q=[1,2].map(Y=>{var re;return{...((re=z.sides)==null?void 0:re.find(K=>K.sideNumber===Y))||{},sideNumber:Y}});z.sides=q;let W=z.sides.find(Y=>Y.sideNumber===j);W&&(W.lineUp=xL({lineUp:L.lineUp}),Ct({tournamentId:u==null?void 0:u.tournamentId,matchUp:z,context:g,drawDefinition:d,eventId:V}))}}return{...Z};function F(){let L="loserLinkFedFMLC";return te(P?{result:_(),stack:L}:{result:$(),stack:L})}function $(){let L=Qa({drawPosition:S,structureId:N,tournamentRecord:u,drawDefinition:d,event:f});return te({result:L,stack:"assignLoserPositionBye"})}function _(){let L=R?ul({drawPosition:b,participantId:R,structureId:N,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:u,drawDefinition:d,matchUpsMap:h,event:f}):{error:hr};return te({result:L,stack:"assignLoserDrawPosition"})}}function fZ(t){var e;let i="directParticipants",r=e_(t);if(r.error)return te({result:r,stack:i});let n=Sw({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:a,projectedWinningSide:o,inContextDrawMatchUps:s,tournamentRecord:l,drawDefinition:u,matchUpStatus:c,dualMatchUp:d,matchUpsMap:p,winningSide:m,targetData:h,matchUpId:f,structure:g,matchUp:v,event:y}=t,I=!!v.collectionId,b=Yn({structure:g}),S=v.drawPositions,w;if(I){let{matchUpTieId:U,matchUpsMap:T}=t,D=tc({appliedPolicies:t.appliedPolicies,matchUpId:U,tournamentRecord:l,drawDefinition:u,matchUpsMap:T,event:y});if(w=D&&{tieMatchUpResult:D},S=(e=s.find(({matchUpId:P})=>P===U))==null?void 0:e.drawPositions,!a)return te({result:{...Z,...w},stack:i})}if(b)return te({result:{...Z,...w},stack:i});if(S){let U=o?o-1:m-1,T=1-U,D=S[U],P=S[T],{targetLinks:{loserTargetLink:C,winnerTargetLink:R,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:A,loserMatchUpDrawPositionIndex:M,winnerMatchUp:E,loserMatchUp:O,byeMatchUp:k}}=h;if(E){let x=LDe({sourceMatchUpStatus:n&&c||Ki,winnerMatchUpDrawPositionIndex:A,sourceMatchUpId:f,inContextDrawMatchUps:s,projectedWinningSide:o,winningDrawPosition:D,tournamentRecord:l,winnerTargetLink:R,drawDefinition:u,winnerMatchUp:E,dualMatchUp:d,matchUpsMap:p,event:y});if(x.error)return te({result:x,stack:i})}if(O){let x=_De({sourceMatchUpStatus:n&&c||Ki,loserMatchUpDrawPositionIndex:M,sourceMatchUpId:f,inContextDrawMatchUps:s,projectedWinningSide:o,loserDrawPosition:P,tournamentRecord:l,loserTargetLink:C,drawDefinition:u,loserMatchUp:O,winningSide:m,matchUpsMap:p,dualMatchUp:d,event:y});if(x.error)return te({result:x,stack:i})}if(k){let x=k.drawPositions||[],F=Math.min(...x.filter(Boolean)),$=N.target.structureId,_=Qa({drawPosition:F,structureId:$,tournamentRecord:l,drawDefinition:u,event:y});if(_.error)return te({result:_,stack:i})}}else return te({result:{error:Wb},stack:i});return te({result:{...Z,...w},stack:i})}function i_(t){var e,i,r,n;let a="genPlayoffStructure";if(!t.drawDefinition)return te({result:{error:$e},stack:a});let o=kw(t);if(o.error)return te({result:o,stack:a});let{structureId:s,addNameBaseToAttributeName:l,playoffStructureNameBase:u,finishingPositionNaming:c,finishingPositionLimit:d,playoffAttributes:p,playoffPositions:m,roundOffsetLimit:h,tournamentRecord:f,exitProfileLimit:g,roundProfiles:v,roundNumbers:y,idPrefix:I,isMock:b,event:S,uuids:w}=t,U=Ne(t.drawDefinition,!1,!0),{structure:T}=tt({structureId:s,drawDefinition:U});if(!T)return te({result:{error:Ni},stack:a});if(T.structureType===_n||T.structures)return vDe({sourceStructureId:T.structureId,...t,...o,drawDefinition:U});let{playoffRoundsRanges:D,playoffRounds:P}=o,{playoffPositionsReturned:C,error:R,playoffSourceRounds:N,playoffRoundsRanges:A}=JJ(t);if(R)return te({result:{error:R},stack:a});let M=(v==null?void 0:v.length)&&Object.assign({},...v),E=y||typeof v=="object"&&v.map(Y=>Object.keys(Y)).flat(),O=Array.isArray(E)&&E.map(Y=>!isNaN(Y)&&Qe(Y)).filter(Boolean);if(O){if(!Array.isArray(O))return te({result:{error:se},context:{validRoundNumbers:O},stack:a});O.forEach(Y=>{if(!(P!=null&&P.includes(Y)))return te({result:{error:se},context:{roundNumber:Y},stack:a})})}m&&m.forEach(Y=>{if(!(C!=null&&C.includes(Y)))return te({result:{error:se},context:{playoffPosition:Y},stack:a})});let k=O||N,x=O?D:A,F=[],$=[];for(let Y of k??[]){let re=x==null?void 0:x.find(ne=>ne.roundNumber===Y);if(!re)return te({result:{error:se},context:{roundNumber:Y},stack:a});let K=re.finishingPositions.length,H=Math.min(...re.finishingPositions)-1,Q=2,X=Y&&(M==null?void 0:M[Y])&&Q+M[Y]-1,ie=yf({exitProfile:`0-${Y}`,addNameBaseToAttributeName:l,playoffStructureNameBase:u,finishingPositionOffset:H,playoffAttributes:p,exitProfileLimit:g,stage:Bi,roundOffset:0,drawDefinition:U,sequenceLimit:X,stageSequence:Q,drawSize:K,idPrefix:I,isMock:b,uuids:w,finishingPositionNaming:c,finishingPositionLimit:d,roundOffsetLimit:h});if(ie.error)return te({result:ie,stack:a});let{structures:ae,links:le}=ie;if(ae!=null&&ae.length&&F.push(...ae),le!=null&&le.length&&$.push(...le),ie.structureId&&Y){let ne={linkType:zl,source:{structureId:s,roundNumber:Y},target:{structureId:ie.structureId,feedProfile:_o,roundNumber:1}};$.push(ne)}}if(!F.length)return te({result:{error:se},info:"No structures generated",stack:a});U.structures.push(...F),U.links.push(...$);let{matchUps:_,matchUpsMap:L}=fr({inContext:!0,drawDefinition:U}),B=F.map(({structureId:Y})=>Y),V=_==null?void 0:_.filter(({structureId:Y})=>B.includes(Y)).map(Dr),G=(e=L==null?void 0:L.drawMatchUps)==null?void 0:e.filter(({matchUpId:Y})=>V==null?void 0:V.includes(Y));if(G!=null&&G.length){let Y=(i=In({drawDefinition:U,event:S}))==null?void 0:i.tieFormat;Y&&G.forEach(re=>{let{tieMatchUps:K}=xw({matchUp:re,tieFormat:Y,isMock:b});Object.assign(re,{tieMatchUps:K,matchUpType:fi})})}(r=_==null?void 0:_.filter(Y=>Cd({matchUp:Y})&&Y.structureId===s))==null||r.forEach(Y=>{let{matchUpId:re,score:K,winningSide:H}=Y,Q=On({inContextDrawMatchUps:_,drawDefinition:U,matchUpId:re}),X=fZ({inContextDrawMatchUps:_,tournamentRecord:f,drawDefinition:U,matchUpsMap:L,winningSide:H,targetData:Q,matchUpId:re,structure:T,matchUp:Y,score:K,event:S});X.error&&console.log(X.error)}),(n=_==null?void 0:_.filter(Y=>Y.matchUpStatus===jt&&Y.structureId===s))==null||n.forEach(Y=>{let{matchUpId:re}=Y,K=On({inContextDrawMatchUps:_,drawDefinition:U,matchUpId:re}),{targetLinks:{loserTargetLink:H},targetMatchUps:{loserMatchUpDrawPositionIndex:Q,loserMatchUp:X}}=K;if(H&&X){let ie=H.target.structureId,ae=X.drawPositions[Q],le=Qa({drawPosition:ae,structureId:ie,tournamentRecord:f,drawDefinition:U,event:S});le.error&&console.log(le.error)}});let j=[],z=ep({inContextDrawMatchUps:_,drawDefinition:U,matchUpsMap:L}).goesToMap,{structure:q}=tt({drawDefinition:t.drawDefinition,structureId:s}),{matchUps:W}=qt({structure:q});return W.forEach(Y=>{var re,K;let H=z==null?void 0:z.loserMatchUpIds[Y.matchUpId];if(H&&Y.loserMatchUpId!==H){Y.loserMatchUpId=H;let X={tournamentId:f==null?void 0:f.tournamentId,eventId:(re=t.event)==null?void 0:re.eventId,context:a,matchUp:Y};j.push(X)}let Q=z==null?void 0:z.winnerMatchUpIds[Y.matchUpId];if(Q&&Y.winnerMatchUpId!==Q){Y.winnerMatchUpId=Q;let X={tournamentId:f==null?void 0:f.tournamentId,eventId:(K=t.event)==null?void 0:K.eventId,context:a,matchUp:Y};j.push(X)}}),{structures:F,matchUpModifications:j,links:$,drawDefinition:U,...Z}}function gZ({element:t}){if(!t)return{error:se};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:se};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function bl(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:nF};let a=PX(t);if(a.error)return a;if(!(At(n)&&Di(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:rF};if(!a.timeItems)a.timeItems=[];else if($De({element:a,duplicateValues:e,timeItem:n}))return{...Z};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let o=new Date().toISOString();Object.assign(n,{createdAt:o})}return r&&(a.timeItems=a.timeItems.filter(({itemType:o})=>n.itemType!==o)),r&&!n.itemValue||a.timeItems.push(n),{...Z}}function $De({element:t,duplicateValues:e,timeItem:i}){var r;let{itemType:n,itemSubTypes:a,itemValue:o}=i,s=n&&((r=Do({itemSubTypes:a,itemType:n,element:t}))==null?void 0:r.timeItem);return s&&JSON.stringify(s==null?void 0:s.itemValue)===JSON.stringify(o)&&!e}function r_({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:ve};if(!n)return{error:hr};let o=nd({tournamentRecord:i,participantId:n});return o.error?o:bl({element:o.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function Bw(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:ve};let o=bl({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(o.error)return o;let s=gZ({element:i});return ut({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:s},topic:Dp}),o}function _h(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?bl({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:mo}}function vZ(t){return oR({...t,itemType:"attachConsolationStructures"})}function n_(t){return oR({...t,itemType:"attachPlayoffStructures"})}function oR({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:o}){var s,l,u;let c="attachStructures";if(!r)return{error:$e};if(!Array.isArray(n)||!Array.isArray(a))return te({result:{error:se},stack:c});let d=I=>{var b;return[I.source.structureId,I.source.roundNumber||((b=I.source.finishingPositions)==null?void 0:b.join("|")),I.target.roundNumber].join("|")},p=(s=r.links)==null?void 0:s.map(d);if(a.some(I=>{let b=d(I);return p==null?void 0:p.includes(b)}))return te({result:{error:uF},info:"playoff structure exists",stack:c});a.length&&((l=r.links)==null||l.push(...a));let m=n.map(({structureId:I})=>I),h=(u=r.structures)==null?void 0:u.map(({structureId:I})=>I);r.structures=(r.structures??[]).map(I=>m.includes(I.structureId)?n.find(({structureId:b})=>b===I.structureId):I);let f=n==null?void 0:n.filter(({structureId:I})=>!(h!=null&&h.includes(I)));f.length&&r.structures.push(...f),ep({drawDefinition:r});let g=n.map(I=>{var b;return((b=qt({structure:I}))==null?void 0:b.matchUps)||[]}).flat();xc({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUps:g});let v=n.map(({structureId:I})=>I);if(li({drawDefinition:r,structureIds:v}),e==null?void 0:e.length){let I={};e.forEach(S=>{var w;let U=(w=S.matchUp)==null?void 0:w.matchUpId;U&&(I[U]=S)});let b=S=>{S.matchUps.forEach(w=>{if(I[w.matchUpId]){let{tieMatchUps:U,...T}=I[w.matchUpId].matchUp;if(Object.assign(w,T),U==null?void 0:U.length){let D={};U.forEach(P=>I[P.matchUpId]=P),w.tieMatchUps.forEach(P=>Object.assign(P,D[P.matchUpId]))}I[w.matchUpId].matchUp=w,Ct(I[w.matchUpId])}})};r.structures.forEach(S=>{if(h!=null&&h.includes(S.structureId))if(S.structures)for(let w of S.structures)b(w);else b(S)})}let y=f.map(Ma("structureId"));if(i){let I={itemValue:{structureIds:v,drawId:r.drawId},itemType:t};bl({element:i,timeItem:I})}return{...Z,addedStructureIds:y}}function sR(t){var e,i;let{structures:r,links:n,matchUpModifications:a,error:o}=i_(t);if(o)return{error:o};let s=t.drawDefinition;return n_({tournamentId:(e=t.tournamentRecord)==null?void 0:e.tournamentId,eventId:((i=t.event)==null?void 0:i.eventId)||t.eventId,matchUpModifications:a,drawDefinition:s,structures:r,links:n})}function ip(t){let e=We(t,[{_anyOf:{[fn]:!1,[wr]:!1,[$n]:!1,[ed]:!1},[RF]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=N2(t,r);if(n.error)return n;i.push(...(n==null?void 0:n.applied)??[]),t.drawDefinition&&li({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ve};for(let a of n){let o=t.tournamentRecords[a],s=N2(t,o);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:ve};return i.length?{...Z,applied:i}:{error:Xx}}function N2(t,e){let i=Bt(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:rP};for(let a of n)if(!i[a]||t.allowReplacement){let o=t.policyDefinitions[a];if(!o)continue;if(!At(o))return{error:se};let{policyName:s,...l}=o;if(!l||!Object.keys(l).length||s&&!Di(s))return{error:se};i[a]=t.policyDefinitions[a],r.push(a)}return r!=null&&r.length?{..._t({element:e,extension:{name:oy,value:i}}),applied:r}:{applied:r,error:Xx}}function a_({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){var o;if(!r||typeof r!="string")return te({result:{error:se},context:{drawName:r}});i||(i=Hi({event:a}).flightProfile);let s=(o=i==null?void 0:i.flights)==null?void 0:o.find(l=>l.drawId===n);if(s){s.drawName=r;let l={name:is,value:{...i,flights:i.flights}};id({event:a,extension:l})}return e&&(e.drawName=r,li({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!s&&!e?{error:$e}:{...Z,flight:s}}function IZ({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){var a;if(!At(i))return{error:se};let o=Hi({event:n}).flightProfile,s=i.drawName&&a_({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:o,drawId:r,event:n});if(s!=null&&s.error)return s==null?void 0:s.error;let l=(s==null?void 0:s.flight)||((a=o==null?void 0:o.flights)==null?void 0:a.find(u=>u.drawId===r));if(!l&&!e)return{error:$e};if(l){let u={name:is,value:{...o,flights:o.flights}};id({event:n,extension:u})}return e&&(i.policyDefinitions&&ip({policyDefinitions:i.policyDefinitions,drawDefinition:e}),li({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...Z}}function yZ({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var r,n;if(!i)return{error:$e};let a=ln({drawDefinition:i}),o=l=>{var u;return(u=a==null?void 0:a.drawMatchUps)==null?void 0:u.find(c=>c.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:u,stage:c,stageSequence:d}=l;u&&(d!==1||![Ke,Ae].includes(c))&&(l.positionAssignments=u.map(h=>(delete h.participantId,h)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:m}=qt({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:a,structure:l});for(let h of p){let{matchUpId:f,roundNumber:g}=h,v=h.sides||[],y=o(f);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==jt&&Object.assign(y,aR),g&&g>1&&((r=y.drawPositions)==null?void 0:r.length)&&!m){let I=v==null?void 0:v.map(({drawPosition:S,participantFed:w})=>!w&&S).filter(Boolean),b=y.drawPositions.map(S=>I.includes(S)?void 0:S);y.drawPositions=b}e?delete y.timeItems:(n=y.timeItems)!=null&&n.length&&(y.timeItems=y.timeItems.filter(I=>I.itemType&&![Kl,Lc,Rh,gL,Ch,Eh].includes(I.itemType))),Ct({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}i.extensions=i.extensions.filter(l=>l.name!==If);let s=(i.structures||[]).map(({structureId:l})=>l);return li({drawDefinition:i,structureIds:s}),{...Z}}function Vw({tournamentRecord:t}){var e;if(!t)return{error:ve};let i={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},r={};return((e=t.events)==null?void 0:e.map(n=>{let a=n.eventId;return r[a]=n,((n==null?void 0:n.drawDefinitions)||[]).map(o=>({drawDefinition:o,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:n,eventId:a})=>{let o=0,s=0,l=0,{allStructuresLinked:u}=tR({drawDefinition:n}),c=r[a],d=((n==null?void 0:n.structures)||[]).map(b=>{let{stage:S,stageSequence:w,structureId:U}=b,T=Mm[S],{inContextStructureMatchUps:D}=Tw({drawDefinition:n,structure:b,event:c}),P=D==null?void 0:D.filter(({winningSide:L})=>L),C=P.filter(Boolean).length||0;s+=C,l+=D.length-s;let R=Math.max(P.filter(({roundNumber:L})=>L===1).map(({roundPosition:L})=>L)),{positionAssignments:N}=oi({structure:b}),A=N==null?void 0:N.filter(({participantId:L})=>L);o+=(A==null?void 0:A.length)??0;let M=((N==null?void 0:N.length)??0)-((A==null?void 0:A.length)??0),{roundMatchUps:E,roundProfile:O,roundNumbers:k,maxMatchUpsCount:x}=An({matchUps:D}),F=O&&Object.keys(O).filter(L=>!O[L].inactiveRound).map(L=>parseInt(L)),$=O&&Object.keys(O).filter(L=>O[L].inactiveRound).map(L=>parseInt(L)),_=O&&Object.values(O).every(L=>L.inactiveRound);return{positionsAssignedCount:(A==null?void 0:A.length)??0,maxWinningSideFirstRoundPosition:R,unassignedPositionsCount:M,inactiveStructure:_,maxMatchUpsCount:x,inactiveRounds:$,roundMatchUps:E,activeRounds:F,roundNumbers:k,roundProfile:O,structureId:U,stageSequence:w,orderNumber:T,stage:S}}),p=d.find(b=>b.orderNumber===2&&b.stageSequence===1),m=d.filter(({inactiveStructure:b})=>!b).length,{links:h}=Iv({structureId:p.structureId,drawDefinition:n}),f=Qe(p.activeRounds[0])===1&&p.activeRounds.length===1&&m===1,g=d==null?void 0:d.every(({inactiveStructure:b})=>b),v=!h.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=n.drawId;o&&!s&&i.positionsNoOutcomes.push(y),g&&i.inactive.push(y),f&&i.matchPlay.push(y),v&&i.canBePruned.push(y);let I={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:o,allStructuresLinked:u,structuresData:d,inactiveDraw:g,isMatchPlay:f,drawId:y};i.drawAnalysis[y]=I}),{...Z,drawsAnalysis:i}}function bZ({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){var n;if(!e)return{error:ve};if(!i)return{error:$e};let a=[],{drawsAnalysis:o}=Vw({tournamentRecord:e});if(o.canBePruned.includes(r)){let s=o.matchPlay.includes(r),l=o.drawAnalysis[r],{structures:[u]}=rs({stageSequence:1,drawDefinition:i,stage:Ae}),c=l.structuresData.find(({structureId:h})=>u.structureId===h),d=(u.matchUps??[]).sort((h,f)=>h.roundPosition-f.roundPosition);a=d.filter(({roundNumber:h})=>!c.inactiveRounds.includes(h));let p=a.map(Dr),m=d.map(Dr).filter(h=>!p.includes(h));if(s){let h=a.filter(({roundNumber:I})=>!c.inactiveRounds.includes(I)).filter(({winningSide:I})=>I),f=h.map(Dr),g=p.filter(I=>!f.includes(I));m.push(...g);let v=h.flatMap(I=>I.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((I,b)=>({[I]:b+1})));if(h.forEach(I=>{t?I.drawPositions=I.drawPositions.map(b=>y[b]):delete I.drawPositions}),t){let I=(n=u==null?void 0:u.positionAssignments)==null?void 0:n.filter(b=>v.includes(b.drawPosition)).map(b=>(b.drawPosition=y[b.drawPosition],b));u.positionAssignments=I}else u.positionAssignments=[];u.matchUps=h,a=h}Zu({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:m,drawDefinition:i}),li({drawDefinition:i})}return{...Z,matchUps:a}}function wZ({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:o,bye:s}){if(!e)return{error:$e};if(!r)return{error:nv};if(!n)return{error:Xa};if(s){let l=Qa({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:o});if(l.error)return l}else{if(a)return{error:pP};{let l=ul({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,event:o});if(l.error)return l}}return{...Z}}function UZ(t){var e,i,r,n,a;let o=t.matchUpIds??[],{drawDefinition:s}=t,l=t.structureId??((i=(e=s==null?void 0:s.structures)==null?void 0:e.find(m=>{var h;return(h=m.matchUps)==null?void 0:h.some(({matchUpId:f})=>o.includes(f))}))==null?void 0:i.structureId)??((n=(r=s==null?void 0:s.structures)==null?void 0:r[0])==null?void 0:n.structureId);if(!l)return{error:Ni};let u=(a=s.structures)==null?void 0:a.find(m=>m.structureId===l);if(!u)return{error:Ni};let c=u==null?void 0:u.matchUps,d=c==null?void 0:c.find(m=>!!m.roundPosition);if(u.structures||d||u.finishingPosition===Uh)return{error:wp};let p=c.filter(({roundNumber:m})=>{var h;return(h=t.roundNumbers)==null?void 0:h.includes(m)}).map(Dr);return o=o.filter(m=>!p.includes(m)),t.roundNumbers&&!o.length&&(o=p),{existingMatchUps:c,matchUpIds:o,structureId:l,structure:u}}function SZ(t){let e=We(t,[{[$n]:!0},{[ag]:{[nw]:!1,roundNumbers:!1},[Ha]:se,[Jn]:cn}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:o,event:s}=t,l=UZ(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,m=[],h=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:I})=>{if(I&&!n)return!1;if(I||yr({score:y})){if(!I&&!i)return!1;m.push(v)}else if(!r)return!1;return p==null?void 0:p.includes(v)}))??[],f=h.map(Dr),g=h.map(({tieMatchUps:v})=>v==null?void 0:v.map(Dr)).filter(Boolean).flat();if(f.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:I})=>!f.includes(I)),Zu({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...f],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:o});let v=dt(u.matchUps.map(Ma("roundNumber"))),y=fwe(v);if(y.length){y.reverse();for(let I of y)u.matchUps.forEach(b=>{b.roundNumber&&b.roundNumber>I&&(b.roundNumber-=1,Ct({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:b}))})}if(m.length){u.positionAssignments=dt(u.matchUps.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U}));let I=(u==null?void 0:u.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(s==null?void 0:s.matchUpFormat),b=l.existingMatchUps.some(U=>U.matchUpType===Ba)?{matchUpTypes:[Ba]}:void 0,{matchUps:S}=qt({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:b,structure:u,event:s});Yn({structure:u})&&(u.positionAssignments=dt(S.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U})));let w=ZL({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:I,matchUps:S,event:s});w.error&&console.log(w)}li({structureIds:[c],eventId:s==null?void 0:s.eventId,drawDefinition:o})}return!f.length&&p.length?{error:hP}:{...Z,deletedMatchUpsCount:[...f,...g].length}}function TZ({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:ve};if(!i)return{error:$e};if(!n)return te({result:{error:Je},info:"roundNumber required"});let o=tt({drawDefinition:i,structureId:r});if(o.error)return o;let s=o.structure;return s!=null&&s.structures?{error:wp}:Yn({structure:s})?BDe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:s}):(console.log("not implemented"),{...Z})}function BDe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let o=(n==null?void 0:n.matchUps)??[],s=[],l=[],u=!1;if(o.reduce((c,d)=>{let p=d==null?void 0:d.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(lr).includes(r)){let c=o.filter(d=>{let p=d.roundNumber===r&&(!Ir.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map(Dr))),!p});l.length&&(Zu({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===r)||(c.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Ct({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),n.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...Z}}function lR(t){var e,i,r,n,a,o;let{suppressNotifications:s,tournamentRecord:l,drawDefinition:u,matchUps:c,event:d}=t;if(typeof u!="object")return{error:$e};let p=t==null?void 0:t.structureId;if(!p&&((e=u.structures)==null?void 0:e.length)===1&&(p=(r=(i=u.structures)==null?void 0:i[0])==null?void 0:r.structureId),typeof p!="string")return{error:Xa};if(!Ro(c))return{error:se,info:tp("matchUps")};let m=(n=u.structures)==null?void 0:n.find(y=>y.structureId===p);if(!m)return{error:Ni};let h=(m==null?void 0:m.matchUps).find(y=>!!y.roundPosition);if(m.structures||h||m.finishingPosition===Uh)return{error:wp};let f=((o=(a=Gr({tournamentRecord:l,inContext:!1}))==null?void 0:a.matchUps)==null?void 0:o.map(Dr))??[],g=c.map(Dr);if(Nn(f,g))return{error:E9,info:"One or more matchUpIds already present in tournamentRecord"};m.matchUps.push(...c);let v=c.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return s||(xc({tournamentId:l==null?void 0:l.tournamentId,matchUps:[...v,...c],eventId:d==null?void 0:d.eventId,drawDefinition:u}),li({drawDefinition:u,structureIds:[p]})),{...Z}}function DZ({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){var o;if(!e)return{error:$e};if(!r)return{error:Xa};if(!i)return{error:nv};let{structure:s}=tt({drawDefinition:e,structureId:r});if(!s)return{error:Ni};let l=s;s.structures&&s.structureType===_n&&(l=(o=s.structures)==null?void 0:o.find(h=>{var f;return(f=h.positionAssignments)==null?void 0:f.find(g=>g.drawPosition===i)}));let u=l==null?void 0:l.positionAssignments,c=u==null?void 0:u.find(h=>h.drawPosition===i);c&&_t({element:c,extension:{name:lg,value:n}});let d=((a==null?void 0:a.eventType)===fi||e.matchUpType===fi||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(s==null?void 0:s.tieFormat)))&&{matchUpTypes:[fi]},{matchUps:p}=qt({structure:l,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:d,event:a}),m=(s==null?void 0:s.matchUpFormat)??e.matchUpFormat;return ZL({positionAssignments:u,tournamentRecord:t,drawDefinition:e,matchUpFormat:m,matchUps:p,event:a}),li({drawDefinition:e,structureIds:[r]}),{...Z}}var PZ={};bt(PZ,{addGoesTo:()=>ep,allPlayoffPositionsFilled:()=>$L,checkValidEntries:()=>dR,findDrawDefinition:()=>u_,getAssignedParticipantIds:()=>Np,getAvailableMatchUpsCount:()=>uR,getAvailablePlayoffProfiles:()=>kw,getDrawDefinitionTimeItem:()=>sL,getDrawParticipantRepresentativeIds:()=>s_,getDrawStructures:()=>rs,getDrawTypeCoercion:()=>jw,getEligibleVoluntaryConsolationParticipants:()=>o_,getMatchUpsMap:()=>ln,getParticipantIdFinishingPositions:()=>l_,getPositionAssignments:()=>my,getPositionsPlayedOff:()=>Tv,getSeedingThresholds:()=>OL,getSeedsCount:()=>Gw,getStructureSeedAssignments:()=>go,getTeamLineUp:()=>Qd,getValidGroupSizes:()=>Mw,isAdHoc:()=>Yn,isCompletedStructure:()=>_c,isValidForQualifying:()=>p_,positionActions:()=>d_});function o_({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:m}){var h,f,g,v,y;if(!s)return{error:$e};let I=[Ae,Bi];i&&I.push(Ke);let b=m!=null&&m.eventType?{matchUpTypes:[m.eventType]}:void 0,S=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,w=e&&m?((h=tu({contextFilters:{stages:I},matchUpFilters:b,tournamentRecord:o,inContext:!0,event:m}))==null?void 0:h.matchUps)??[]:((f=Pn({contextFilters:{stages:I},matchUpFilters:S,tournamentRecord:o,inContext:!0,drawDefinition:s}))==null?void 0:f.matchUps)??[],U=Ph({stage:Fr,drawDefinition:s}).map(({participantId:_})=>_),T={},D={},P={},C={};n||(n=Qu({policyTypes:[dM],tournamentRecord:o,drawDefinition:s,event:m}).policyDefinitions);let R=n==null?void 0:n[dM];t=t.length&&t||(R==null?void 0:R.excludedMatchUpStatuses)||[],e=e??(R==null?void 0:R.includeEventParticipants),d=d??(R==null?void 0:R.allEntries),r=r??(R==null?void 0:R.finishingRoundLimit),a=a??(R==null?void 0:R.roundNumberLimit),l=l??(R==null?void 0:R.matchUpsLimit),u===void 0&&(u=(R==null?void 0:R.requirePlay)!==void 0?R.requirePlay:!0),c===void 0&&(c=(R==null?void 0:R.requireLoss)!==void 0?R.requireLoss:!0),p=p??(R==null?void 0:R.winsLimit);for(let _ of w){if(u&&_.winningSide&&![1,2].includes(_.winningSide)&&_.matchUpStatus!==tr||_.finishingRound&&r&&_.finishingRound>=r||_.finishingRound&&a&&_.finishingRound<=a)continue;let L=(g=_.sides)==null?void 0:g.find(({sideNumber:V})=>_.winningSide&&V===3-_.winningSide),B=(v=_.sides)==null?void 0:v.find(({sideNumber:V})=>_.winningSide&&V===_.winningSide);if((y=_.sides)==null||y.forEach(V=>{var G;let j=(G=V==null?void 0:V.participant)==null?void 0:G.participantId;j&&(P[j]=V.participant,_.matchUpStatus===tr&&!u&&(D[j]=V.participant,T[j]||(T[j]=0),(!_.matchUpStatus||!t.includes(_.matchUpStatus))&&(T[j]+=1)))}),L==null?void 0:L.participant){let V=L.participant.participantId;D[V]=L.participant,T[V]||(T[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(T[V]+=1)}if(B!=null&&B.participant){let V=B.participant.participantId;C[V]||(C[V]=0),C[V]+=1,T[V]||(T[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(T[V]+=1)}}let N=(o==null?void 0:o.participants)&&!u&&!c&&d,A=N?((e&&m?m.entries:s.entries)??[]).filter(_=>![Yl,Po].includes(_.entryStatus)).map(({participantId:_})=>_):[],M=Object.keys(D),E=N?((o==null?void 0:o.participants)??[]).filter(({participantId:_})=>A.includes(_)):c&&Object.values(D)||Object.values(P),O=_=>!c||M.includes(_),k=_=>!u||(T[_]||0)>=0,x=_=>!p||(C[_]||0)<=p,F=_=>!l||T[_]<=l,$=_=>!U.includes(_);return{eligibleParticipants:E.filter(_=>O(_.participantId)&&k(_.participantId)&&x(_.participantId)&&F(_.participantId)&&$(_.participantId)).map(_=>{var L;return{..._,individualParticipants:(L=_.individualParticipantIds)==null?void 0:L.map(B=>{var V;return(V=o==null?void 0:o.participants)==null?void 0:V.find(G=>G.participantId===B)})}}),losingParticipantIds:M,...Z}}function uR(t){var e,i,r,n,a,o,s,l;let u=We(t,[{drawDefinition:!0}]);if(u.error)return u;let{drawDefinition:c,roundNumber:d}=t,p=t.structureId??(((e=c.structures)==null?void 0:e.length)===1&&((r=(i=c.structures)==null?void 0:i[0])==null?void 0:r.structureId));if(typeof p!="string")return{error:Xa};let m=(n=c.structures)==null?void 0:n.find(w=>w.structureId===p);if(!m)return{error:Ni};let h,f=(a=m.matchUps??[])==null?void 0:a.reduce((w,U)=>(U.roundPosition&&(h=!0),((U==null?void 0:U.roundNumber)||0)>w?U.roundNumber:w),0);if(m.structures||h||m.finishingPosition===Uh)return{error:wp};let g=((o=c==null?void 0:c.entries)==null?void 0:o.filter(w=>{let U=w.entryStatus;return cs.includes(U)}))??[],v=Math.floor((g==null?void 0:g.length)/2)||1,y=d??f??1,I=((l=(s=m.matchUps)==null?void 0:s.filter(w=>w.roundNumber===y))==null?void 0:l.length)??0,b=v-I,S=b>0?b:0;return{...Z,availableMatchUpsCount:S,lastRoundNumber:f,roundMatchUpsCount:v}}function s_({drawDefinition:t}){var e;let i=vt({name:"participantRepresentatives",element:t});return i.error?i:{representativeParticipantIds:((e=i.extension)==null?void 0:e.value)||[]}}function VDe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:$e};let r=fr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=Ne(r.matchUps,!1,!0),a=dt(n.reduce((s,l)=>s.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),o=Object.assign({},...a.map(s=>{let l=n.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:a,participantIdMatchUps:o}}function l_({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:$e};let{participantIds:r,participantIdMatchUps:n}=VDe({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(r==null?void 0:r.map(o=>{let s=n[o].filter(d=>[Ki,jt].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(h=>h.bye),m=d.sides.find(h=>h.participantId===o).sideNumber;return(d.winningSide||t&&p&&m)===m?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),u=d=>Math.abs(d[0]-d[1]),c=l.reduce((d,p)=>d&&u(d)<u(p)?d:p,void 0);return{[o]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:c}}}))||[];return Object.assign({},...a)}function sd({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:ve};if(!r)return{error:xs};if(!e&&t){if(typeof i!="string"&&(i=hZ({tournamentRecords:t,drawId:r}),!i))return{error:Yf};if(e=t[i],!e)return{error:ve}}let n=e&&Kn({tournamentRecord:e,drawId:r});return n!=null&&n.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...Z}:te({result:{error:Va},stack:"findDrawDefinition"})}function u_(t){let{drawDefinition:e,error:i}=sd(t);return i?{error:i}:{drawDefinition:Ne(e)}}function RM({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=Iv({drawDefinition:i,structureId:r})||{},o=((a==null?void 0:a.target)||[]).filter(({linkType:s})=>s===n).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:u}=tt({structureId:l,drawDefinition:i});if(!(e&&(u==null?void 0:u.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:o.map(({source:s})=>s.structureId),relevantLinks:o}}function jDe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){var o;let s=((o=a==null?void 0:a.entries)==null?void 0:o.filter(({entryStatus:l})=>[Po,Cp].includes(l)).map(({participantId:l})=>l))||[];if(s.length){let l=r.individualParticipantIds,u=e?t.filter(({participantId:d})=>s.includes(d)):void 0,c=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:He({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:ZTe,availableIndividualParticipantIds:s,availableIndividualParticipants:u,existingIndividualParticipantIds:l,existingIndividualParticipants:c,type:jL},!1,!1,!0)}}return{}}function rp(t){var e,i,r,n,a;let{inContextDrawMatchUps:o,targetData:s,drawDefinition:l,relevantLink:u}=t;if((u==null?void 0:u.linkCondition)===sl&&((e=s==null?void 0:s.matchUp)==null?void 0:e.matchUpStatus)===jt)return!1;let{targetMatchUps:{loserMatchUp:c,winnerMatchUp:d},targetLinks:p}=s,m=c&&On({matchUpId:c.matchUpId,inContextDrawMatchUps:o,drawDefinition:l}),h=(i=m==null?void 0:m.targetMatchUps)==null?void 0:i.loserMatchUp,f=(r=m==null?void 0:m.targetMatchUps)==null?void 0:r.loserMatchUpDrawPositionIndex,g=(n=h==null?void 0:h.sides[f])==null?void 0:n.participant,v=[Pt,Ft].includes(c==null?void 0:c.matchUpStatus)&&!g,y=((a=d==null?void 0:d.drawPositions)==null?void 0:a.filter(Boolean).length)||0;if(c!=null&&c.winningSide&&!v||d!=null&&d.winningSide&&y===2&&(!d.feedRound||![Ft,Pt].includes(d==null?void 0:d.matchUpStatus)))return!0;let I=d&&On({matchUpId:d.matchUpId,inContextDrawMatchUps:o,drawDefinition:l}),b=m&&rp({relevantLink:p==null?void 0:p.loserTargetLink,targetData:m,inContextDrawMatchUps:o,drawDefinition:l});return!!(I&&rp({targetData:I,inContextDrawMatchUps:o,drawDefinition:l})||b)}var RZ={[Ou]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Ke,Ae],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[py,Fm,iR,lm],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},nS="positionAction",CM="matchUpAction";function CZ({actionType:t=nS,appliedPolicies:e,drawDefinition:i,structure:r}){var n,a;let o=t===nS&&Ou||t===CM&&Lr,s=t===nS&&RZ||t===CM&&oJ,l=o&&((e==null?void 0:e[o])||(s==null?void 0:s[o])),u=((a=(n=i.links)==null?void 0:n.filter(m=>{var h;return((h=m==null?void 0:m.target)==null?void 0:h.structureId)===(r==null?void 0:r.structureId)}))==null?void 0:a.map(({target:m})=>m.feedProfile))??[],{enabledStructures:c,disabledStructures:d}=l||{},p=d==null?void 0:d.find(m=>{let{stages:h,stageSequences:f,structureTypes:g,feedProfiles:v}=m;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>u.includes(y)))&&(!(h!=null&&h.length)||Array.isArray(h)&&(h==null?void 0:h.includes(r==null?void 0:r.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(r==null?void 0:r.structureType)))&&(!(f!=null&&f.length)||Array.isArray(f)&&f.includes(r==null?void 0:r.stageSequence))});return{enabledStructures:c,actionsDisabled:p,actionsPolicy:l}}function A2({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function EZ({enabledStructures:t,drawDefinition:e,structure:i}){var r,n;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:a,stageSequence:o,structureType:s}=i||{},l=((n=(r=e.links)==null?void 0:r.filter(u=>{var c;return((c=u==null?void 0:u.target)==null?void 0:c.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:n.map(({target:u})=>u.feedProfile))||[];return{policyActions:t.find(u=>{let{stages:c,stageSequences:d,structureTypes:p,feedProfiles:m}=u||{},h=!(c!=null&&c.length)||Array.isArray(c)&&c.includes(a),f=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(o),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(s),v=!(m!=null&&m.length)||Array.isArray(m)&&m.some(y=>l.includes(y));return f&&g&&v&&u&&h})}}function Qn({action:t,policyActions:e}){var i;let r=!(e!=null&&e.enabledActions)||((i=e==null?void 0:e.disabledActions)==null?void 0:i.length)&&e.disabledActions.includes(t);return r?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!r}var MZ="replaceTieMatchUpParticipantId",NZ="assignTieMatchUpParticipantId",EM="removeTieMatchUpParticipantId",O2="assignMatchUpSideParticipant",GDe="removeMatchUpSideParticipant",AZ="substituteParticipant",MM="REMOVE_SUBSTITUTION",OZ="REPLACE_PARTICIPANT",c_="REMOVE_PARTICIPANT",NM="setMatchUpStatus",AM="SUBSTITUTION",kZ="SCHEDULE",HDe="PENALTY",OM="REFEREE",xZ="STATUS",kM="START",FZ="SCORE",xM="END",zDe={REPLACE_TEAM_POSITION_METHOD:MZ,ASSIGN_TEAM_POSITION_METHOD:NZ,REMOVE_TEAM_POSITION_METHOD:EM,REPLACE_PARTICIPANT:OZ,SUBSTITUTION_METHOD:AZ,REMOVE_SUBSTITUTION:MM,REMOVE_PARTICIPANT:c_,SCHEDULE_METHOD:NM,SUBSTITUTION:AM,SCHEDULE:kZ,PENALTY:HDe,REFEREE:OM,STATUS:xZ,SCORE:FZ,START:kM,END:xM};function WDe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){var m,h,f,g,v,y,I,b,S,w,U,T,D,P,C;let R=[],N=(m=n.sides)==null?void 0:m.find(q=>q.participant),A=n.gender===jn&&n.sideNumber&&((h=n.sides)==null?void 0:h.filter(q=>q.particiapntId).length)===1&&((g=(f=N==null?void 0:N.participant)==null?void 0:f.person)==null?void 0:g.sex),M=n.matchUpType,E=(o??((v=r==null?void 0:r.participants)==null?void 0:v.enforceGender))!==!1?n.gender:void 0,O=(I=(y=n.sides)==null?void 0:y.flatMap(q=>{var W;return((W=q.participant)==null?void 0:W.individualParticipants)||q.participant}).filter(Boolean))==null?void 0:I.map(Tt),k=(b=n.sides)==null?void 0:b.filter(q=>!l||q.sideNumber===l).flatMap(q=>{var W;return((W=q.participant)==null?void 0:W.individualParticipants)||q.participant}).filter(Boolean),x=k==null?void 0:k.map(Tt),F=(w=(S=e==null?void 0:e.find(q=>q.matchUpId===n.matchUpTieId))==null?void 0:S.sides)==null?void 0:w.map(q=>{var W,Y;return(Y=(W=q==null?void 0:q.participant)==null?void 0:W.individualParticipants)==null?void 0:Y.filter(({participantId:re,person:K})=>!(x!=null&&x.includes(re))&&(!E||E===Ns||K.sex===E||E===jn&&!A||A&&K.sex!==A))}),$=l?F==null?void 0:F[l-1]:F==null?void 0:F.map((q,W)=>({participants:q,sideNumber:W+1})),_=l?(U=F==null?void 0:F[l-1])==null?void 0:U.map(Tt):F==null?void 0:F.map((q,W)=>({participants:q==null?void 0:q.map(Tt),sideNumber:W+1})),L=l&&(Xi(nm)(M)&&!(x!=null&&x.length)||Xi(zd)(M)&&((x==null?void 0:x.length)??0)<2)||!l&&(Xi(nm)(M)&&((x==null?void 0:x.length)??0)<2||Xi(zd)(M)&&((x==null?void 0:x.length)??0)<4),B=_==null?void 0:_.filter(q=>!(O!=null&&O.includes(q))),V=$==null?void 0:$.filter(({participantId:q})=>B.includes(q));if(L&&B!=null&&B.length&&R.push({availableParticipantIds:B,method:NZ,availableParticipants:V,type:xm,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),x!=null&&x.length&&(!yr(c)||(T=p==null?void 0:p.substitutions)!=null&&T.length)&&R.push({method:EM,type:c_,existingParticipantIds:x,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),V!=null&&V.length&&(!l&&x!=null&&x.length||l&&p!=null&&p.participant)&&R.push({availableParticipantIds:B,method:MZ,availableParticipants:V,type:OZ,existingParticipantIds:x,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),Qn({policyActions:a,action:MM})&&((D=p==null?void 0:p.substitutions)==null?void 0:D.length)){let q=((P=p.participant)==null?void 0:P.participantType)===Dt&&[p.participantId]||((C=p.participant)==null?void 0:C.participantType)===ft&&p.participant.individualParticipantIds||[],W=p.substitutions.map(Y=>Y.participantId).filter(Y=>q.includes(Y));(!s||W.includes(s))&&R.push({method:EM,type:MM,substitutedParticipantIds:W,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let G=t==null?void 0:t[Lr],j=G==null?void 0:G.substituteWithoutScore,z=G==null?void 0:G.substituteAfterCompleted;if(Qn({policyActions:a,action:AM})&&i.length===2&&(!l&&x!=null&&x.length||l&&p!=null&&p.participant)&&(j||yr(c))&&(z||c.matchUpStatus&&!Ir.includes(c.matchUpStatus))&&k!=null&&k.length&&$.length){let q=k.map(Tt);R.push({info:"list of team players available for substitution",method:AZ,availableParticipantIds:_,existingParticipantIds:q,availableParticipants:$,existingParticipants:k,type:AM,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return R}function qDe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:u,structure:c,drawId:d,event:p}){var m,h,f,g,v;if(i.includes(s))return{};let y=(m=l.find(R=>R.type===xm))==null?void 0:m.availableParticipantIds,I=(h=a==null?void 0:a[Ou])==null?void 0:h.otherFlightEntries,b=(f=a==null?void 0:a[Ou])==null?void 0:f.restrictQualifyingAlternates,S=(o.entries??[]).filter(({entryStage:R})=>!b||(c.stage===Ke?R===Ke:R!==Ke)).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:R})=>R).filter(Boolean),{allPositionedParticipantIds:w}=hX({drawDefinition:o}),U=r.map(R=>R.participantId).filter(Boolean),T=S.filter(R=>c.stage&&[Ke,Ae,Bi].includes(c.stage)?!(w!=null&&w.includes(R)):!U.includes(R)),D=((p==null?void 0:p.entries)??[]).filter(R=>R.entryStatus===Wo&&LZ({restrictQualifyingAlternates:b,structure:c,entry:R})&&(c.stage&&[Ke,Ae,Bi].includes(c.stage)?!(w!=null&&w.includes(R.participantId)):!U.includes(R.participantId))).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(R=>R.participantId),P=dt(T.concat(D));if(I){let R=(v=(g=p?Hi({event:p}).flightProfile:void 0)==null?void 0:g.flights)==null?void 0:v.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(A=>A.participantId&&![Yl,Po,Cp].includes(A.entryStatus)&&!S.includes(A.participantId)).map(({participantId:A})=>A)).flat().filter(Boolean);R!=null&&R.length&&P.push(...R)}y!=null&&y.length&&(P=P.filter(R=>!y.includes(R)));let C=n?t==null?void 0:t.filter(R=>P.includes(R.participantId)):void 0;return C==null||C.forEach(R=>{let N=(o.entries??[]).find(A=>A.participantId===R.participantId);R.entryPosition=N==null?void 0:N.entryPosition}),C==null||C.sort((R,N)=>(R.entryPosition||1/0)-(N.entryPosition||1/0)),P.length?{validAlternatesAction:He({payload:{drawId:d,structureId:u,drawPosition:s},willDisableLinks:e,method:XTe,availableAlternatesParticipantIds:P,type:GL,availableAlternates:C})}:{}}function LZ({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===Ke&&!t||i.entryStage===Ae&&r===an)return!0}function YDe({eventEntries:t,structure:e}){let i=n=>n.entryStatus===Wo&&LZ({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(Tt)}function KDe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:u,drawId:c,event:d}){var p,m,h,f,g,v,y;let I=[],b=(l==null?void 0:l.matchUps)??[],S=(m=(p=u.sides)==null?void 0:p.find(M=>M.sideNumber===o))==null?void 0:m.participantId,w=b.filter(({roundNumber:M})=>M===u.roundNumber),U=((h=n==null?void 0:n.entries)==null?void 0:h.filter(({entryStatus:M})=>M&&Ep.includes(M)).map(Tt))??[],T=w.map(M=>(M.sides??[]).flatMap(Tt)).flat().filter(Boolean),D=U.filter(M=>!i.includes(M)&&(!t||!T.includes(M))),P=e==null?void 0:e.filter(M=>D==null?void 0:D.includes(M.participantId)).map(M=>Ne(M,void 0,!0));P==null||P.forEach(M=>{let E=(n.entries??[]).find(O=>O.participantId===M.participantId);M.entryPosition=E==null?void 0:E.entryPosition}),D.length&&I.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:O2,type:xm,availableParticipantIds:D,participantsAvailable:P});let C=(d==null?void 0:d.entries)??[],R=YDe({eventEntries:C,structure:l}),N=dt(U.concat(R));if(r){let M=(g=(f=d?Hi({event:d}):void 0)==null?void 0:f.flights)==null?void 0:g.filter(E=>E.drawId!==c).flatMap(E=>E.drawEntries.filter(O=>O.participantId&&![Yl,Po,Cp].includes(O.entryStatus)).map(({participantId:O})=>O)).filter(Boolean);M!=null&&M.length&&N.push(...M)}N=N.filter(M=>!i.includes(M)&&!D.includes(M)&&(!t||!T.includes(M)));let A=e==null?void 0:e.filter(M=>N.includes(M.participantId)).map(M=>Ne(M,void 0,!0));if(A==null||A.forEach(M=>{let E=(n.entries??[]).find(O=>O.participantId===M.participantId);M.entryPosition=E==null?void 0:E.entryPosition}),A==null||A.sort((M,E)=>(M.entryPosition||1/0)-(E.entryPosition||1/0)),N.length&&I.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:N,participantsAvailable:A,method:O2,type:Wo}),!yr(u)&&o&&S){I.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:GDe,type:c_});let M=L=>L.sides.map(Tt),E=({matchUpId:L})=>L!==u.matchUpId,O=L=>!yr(L),k=(y=(v=u.sides)==null?void 0:v.find(L=>L.sideNumber!==o))==null?void 0:y.participantId,x=b.filter(({roundNumber:L})=>L!==u.roundNumber).filter(E).map(M),F=[k,...x.filter(L=>L.includes(S)).flat()].filter(Boolean),$=L=>!F.flat().includes(L),_=w.filter(O).filter(E).map(M).flat().filter($);if(_.length){let L=e==null?void 0:e.filter(B=>_.includes(B.participantId)).map(B=>Ne(B,void 0,!0));I.push({payload:{participantIds:[S],roundNumber:u.roundNumber,structureId:a,sideNumber:o,matchUpId:s,drawId:c},swappableParticipantIds:_,method:QTe,type:rR,swappableParticipants:L})}}return I}function cR(t){var e,i,r,n,a,o,s,l,u;if(!t)return{error:se};let{drawDefinition:c,event:d}=t,{restrictAdHocRoundParticipants:p=!0,policyDefinitions:m,enforceGender:h,participantId:f,sideNumber:g,matchUpId:v}=t,y=t.tournamentRecord??(t.tournamentId&&Di(t.tournamentId)&&((e=t.tournamentRecords)==null?void 0:e[t.tournamentId]));if(!y)return{error:ve};if(!v||!Di(v))return{error:bn};if(g&&![1,2].includes(g))return te({result:{error:se},context:{sideNumber:g}});if(!c){let ae=(Gr({tournamentRecord:y}).matchUps??[]).find(ne=>ne.matchUpId===v);d=((y==null?void 0:y.events)??[]).find(ne=>ne.eventId===(ae==null?void 0:ae.eventId));let le=((d==null?void 0:d.drawDefinitions)??[]).find(ne=>ne.drawId===(ae==null?void 0:ae.drawId));le&&(c=le)}if(!c)return{error:$e};let I=Ai({withIndividualParticipants:!0,tournamentRecord:y}).participants,{drawId:b}=c,{matchUp:S,structure:w}=Si({drawDefinition:c,matchUpId:v,event:d});if(!S)return{error:hn};let U=Bt({tournamentRecord:y,drawDefinition:c,structure:w,event:d}).appliedPolicies??{};Object.assign(U,m??{});let T=(i=U==null?void 0:U[Ou])==null?void 0:i.otherFlightEntries,D=(U==null?void 0:U[Lr])??wv[Lr],{enabledStructures:P}=CZ({actionType:CM,appliedPolicies:U,drawDefinition:c,structure:w}),{policyActions:C}=EZ({enabledStructures:P,drawDefinition:c,structure:w}),R=t.matchUpsMap??ln({drawDefinition:c}),N=t.inContextDrawMatchUps??fr({tournamentParticipants:I,inContext:!0,drawDefinition:c,matchUpsMap:R,event:d}).matchUps,A=N==null?void 0:N.find(ae=>ae.matchUpId===v),M=g&&((r=A==null?void 0:A.sides)==null?void 0:r.find(ae=>ae.sideNumber===g)),E=((n=A==null?void 0:A.sides)==null?void 0:n.map(ae=>{var le;return ae.participantId||((le=ae.participant)==null?void 0:le.participantid)}).filter(Boolean))??[],{assignedPositions:O,allPositionsAssigned:k}=Er({structure:w}),{structureId:x}=w??{},F=[];if(!x)return{validActions:F};let $=Yn({structure:w}),_=S.collectionId;if($&&!_){let ae=KDe({restrictAdHocRoundParticipants:p,tournamentParticipants:I,matchUpParticipantIds:E,otherFlightEntries:T,drawDefinition:c,structureId:x,sideNumber:g,matchUpId:v,structure:w,matchUp:S,drawId:b,event:d});F.push(...ae)}let L=_c({drawDefinition:c,structure:w}),B=O==null?void 0:O.filter(ae=>ae.participantId).map(ae=>ae.drawPosition),V=O==null?void 0:O.filter(ae=>ae.bye).map(ae=>ae.drawPosition),G=S.matchUpStatus===jt||!_&&((a=S.drawPositions)==null?void 0:a.reduce((ae,le)=>(V==null?void 0:V.includes(le))||ae,!1));if(G)return{validActions:F,isByeMatchUp:G};Qn({policyActions:C,action:OM})&&F.push({type:OM,payload:{matchUpId:v}});let j=!Sw({matchUpStatus:S.matchUpStatus}),z=(o=U==null?void 0:U.scoring)==null?void 0:o.structures,q=(w==null?void 0:w.stage)&&(z==null?void 0:z.stage)&&(z==null?void 0:z.stage[w.stage]),W=(w==null?void 0:w.stageSequence)&&(q==null?void 0:q.stageSequence)&&q.stageSequence[w.stageSequence],Y=!((s=U==null?void 0:U.scoring)!=null&&s.requireAllPositionsAssigned||q!=null&&q.requireAllPositionsAssigned||W!=null&&W.requireAllPositionsAssigned)||k,re=S.sides&&S.sides.filter(ae=>ae==null?void 0:ae.participantId).length===2,K=S.matchUpStatus&&[tr,dr].includes(S.matchUpStatus),H=On({inContextDrawMatchUps:N,drawDefinition:c,matchUpId:v}),Q=rp({inContextDrawMatchUps:N,drawDefinition:c,targetData:H}),X=(((l=A==null?void 0:A.drawPositions)==null?void 0:l.length)===2&&A.drawPositions.every(ae=>B==null?void 0:B.includes(ae))&&((u=A==null?void 0:A.sides)==null?void 0:u.length)===2&&A.sides.every(({participantId:ae})=>ae)||re)&&!(K&&Q),ie={method:HJ,type:Fm,payload:{drawId:b,matchUpId:v,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(j&&F.push({payload:{drawId:b,matchUpId:v,schedule:{}},method:NM,type:kZ}),Qn({policyActions:C,action:Fm})&&(M!=null&&M.participant||!g&&E!=null&&E.length)&&F.push(ie),j&&X&&F.push({type:xZ}),Y&&X){let{matchUpId:ae,matchUpFormat:le}=S,ne={drawId:b,matchUpId:ae,matchUpFormat:le,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};F.push({info:"set outcome and winningSide",method:NM,type:FZ,payload:ne}),Qn({policyActions:C,action:kM})&&F.push({type:kM}),Qn({policyActions:C,action:xM})&&F.push({type:xM})}if(_&&A){let ae=WDe({specifiedPolicyDefinitions:m,inContextDrawMatchUps:N,matchUpParticipantIds:E,matchUpActionsPolicy:D,inContextMatchUp:A,policyActions:C,enforceGender:h,participantId:f,sideNumber:g,matchUpId:v,matchUp:S,drawId:b,side:M});F.push(...ae)}return{structureIsComplete:L,validActions:F,isDoubleExit:K,...Z}}function XDe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:u,drawId:c,event:d}){var p,m,h,f,g,v,y;if(n.includes(s)||r&&!e)return{};let{sourceStructureIds:I,targetStructureIds:b}=((p=o.links)==null?void 0:p.reduce((T,D)=>{var P,C;let R=(P=D.source)==null?void 0:P.structureId,N=(C=D.target)==null?void 0:C.structureId;return T.sourceStructureIds.includes(R)||T.sourceStructureIds.push(R),T.targetStructureIds.includes(N)||T.targetStructureIds.push(N),T},{sourceStructureIds:[],targetStructureIds:[]}))||{},S=[],w=((m=o.links)==null?void 0:m.filter(T=>{var D;return((D=T.target)==null?void 0:D.structureId)===u.structureId}))??[];for(let T of w){let D=(h=T==null?void 0:T.source)==null?void 0:h.structureId,{structure:P}=tt({structureId:D,drawDefinition:o}),C=(P==null?void 0:P.finishingPosition)===Uh&&((I==null?void 0:I.length)!==1||(b==null?void 0:b.length)!==1),R={};if(C){let{matchUps:M}=qt({drawDefinition:o,structure:u,event:d}),{initialRoundNumber:E}=km({drawPosition:s,matchUps:M}),O=(v=(g=(f=o.links)==null?void 0:f.find(k=>{var x;return((x=k.target)==null?void 0:x.structureId)===(u==null?void 0:u.structureId)&&k.target.roundNumber===E}))==null?void 0:g.source)==null?void 0:v.roundNumber;R.roundNumbers=[O]}let{completedMatchUps:N}=KP({structureId:D,inContext:!0,matchUpFilters:R,drawDefinition:o}),A=a.map(M=>M.participantId).filter(Boolean);(y=N==null?void 0:N.filter(({matchUpType:M,winningSide:E})=>E&&((d==null?void 0:d.eventType)!==ur||M===ur)).map(({winningSide:M,sides:E})=>M&&(E==null?void 0:E[1-(M-1)])).map(Tt).filter(M=>M&&!A.includes(M)))==null||y.forEach(M=>{S.includes(M)||S.push(M)})}let U=t==null?void 0:t.filter(T=>S==null?void 0:S.includes(T.participantId));return U==null||U.forEach(T=>{let D=(o.entries??[]).find(P=>P.participantId===T.participantId);T.entryPosition=D==null?void 0:D.entryPosition}),S!=null&&S.length?{validLuckyLosersAction:{type:zL,method:JTe,availableLuckyLosers:U,availableLuckyLoserParticipantIds:S,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:s}}}:{}}function JDe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:m,event:h}){var f,g,v;let{drawId:y}=u,I=[],b,S,w=[],U=(g=(f=l==null?void 0:l[Ao])==null?void 0:f.validSeedPositions)==null?void 0:g.ignore;if(U||({unplacedSeedParticipantIds:b,unplacedSeedAssignments:S,unfilledPositions:w}=yJ({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:m,event:h})),w!=null&&w.length||(w=o.filter(T=>!T.participantId&&!T.bye&&!T.qualifier).map(T=>T.drawPosition)),d||I.push({payload:{drawId:y,structureId:m,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:iDe,type:f0}),a&&U){let T=o.map(N=>N.participantId).filter(Boolean),D={structureIds:t},{completedMatchUps:P}=yv({inContext:!0,matchUpFilters:D,drawDefinition:u}),C=dt((v=(P??[]).filter(({matchUpType:N})=>(h==null?void 0:h.eventType)!==ur||N===ur))==null?void 0:v.map(({sides:N})=>N==null?void 0:N.map(Tt)).flat().filter(N=>N&&!T.includes(N))),R=s?n==null?void 0:n.filter(N=>C==null?void 0:C.includes(N.participantId)).map(N=>Ne(N,void 0,!0)):void 0;return R==null||R.forEach(N=>{let A=(u.entries??[]).find(M=>M.participantId===N.participantId);N.entryPosition=A==null?void 0:A.entryPosition}),R!=null&&R.length&&I.push(He({payload:{drawId:y,structureId:m,drawPosition:p},willDisableLinks:i,method:T2,type:xm,availableParticipantIds:C,participantsAvailable:R})),{validAssignmentActions:I}}if(w.includes(p)||d){let T;if(S!=null&&S.length){let P=S.filter(C=>b==null?void 0:b.includes(C.participantId));P.sort(ZDe),T=P.map(C=>C.participantId)}else T=e;let D=s?n==null?void 0:n.filter(P=>T.includes(P.participantId)).map(P=>Ne(P,void 0,!0)):void 0;D!=null&&D.length&&I.push(He({payload:{drawId:y,structureId:m,drawPosition:p},willDisableLinks:i,method:T2,type:xm,availableParticipantIds:T,participantsAvailable:D}))}return{validAssignmentActions:I}}function ZDe(t,e){return t.bye||dg(t.seedValue)<dg(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function QDe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var u,c,d;let p=[],m=[],h=[],f=[],g=i.map(T=>T.participantId).filter(Boolean),v=n==null?void 0:n[Ou],y=!(v!=null&&v.disableRoundRestrictions)&&t[o],I=v==null?void 0:v.requireCompletedStructures,{sourceStructureIds:b,relevantLinks:S}=RM({targetRoundNumber:y,linkType:Au,drawDefinition:a,structureId:s})||{};b!=null&&b.length&&f.push(...b);let{sourceStructureIds:w,relevantLinks:U}=RM({targetRoundNumber:y,linkType:Nu,drawDefinition:a,structureId:s})||{};w!=null&&w.length&&f.push(...w);for(let T of S){let D=(u=a.structures)==null?void 0:u.find(C=>C.structureId===T.source.structureId);if((D==null?void 0:D.stage)!==Ke)continue;let P=_c({structureId:T.source.structureId,drawDefinition:a});if(!I||P){let C=D.qualifyingRoundNumber,{matchUps:R}=qt({matchUpFilters:{roundNumbers:[C],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:D});for(let N of R){let A=N.sides.find(E=>(E==null?void 0:E.sideNumber)===N.winningSide),M=N.matchUpStatus===jt&&((c=N.sides)==null?void 0:c.find(({participantId:E})=>E));if(A||M){let{participantId:E,participant:O}=A||M||{};E&&!g.includes(E)&&(O&&r&&p.push(O),m.push(E))}}}}for(let T of U){let D=(d=a.structures)==null?void 0:d.find(C=>C.structureId===T.source.structureId);if((D==null?void 0:D.stage)!==Ke)continue;let P=_c({structureId:T.source.structureId,drawDefinition:a});if(!I||P){let{positionAssignments:C}=oi({structure:D}),R=(C==null?void 0:C.map(N=>{var A;let M=N.participantId,E=(A=vt({element:N,name:Oc}).extension)==null?void 0:A.value;return E?{participantId:M,groupOrder:E==null?void 0:E.groupOrder}:{}}).filter(({groupOrder:N,participantId:A})=>N===1&&!g.includes(A)).map(({participantId:N})=>N))??[];if(R&&m.push(...R),r){let N=e.filter(({participantId:A})=>R.includes(A));p.push(...N)}}}return m.length&&h.push(He({qualifyingParticipants:r?p:void 0,method:YTe,type:iR,qualifyingParticipantIds:m,payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l}})),{validAssignmentActions:h,sourceStructureIds:f}}function ePe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:m,event:h}){if(n.includes(c))return{};let f=P=>!t||P.participantId||P.qualifier||P.bye,g=r==null?void 0:r.filter(P=>P!==c&&!(u&&s.includes(P))),v=(a==null?void 0:a.filter(P=>f(P)&&(g==null?void 0:g.includes(P.drawPosition))))??[],y=v.map(({drawPosition:P})=>P),{matchUps:I}=qt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:h}),b=I.filter(({drawPositions:P})=>Nn(P,y)),S=Object.assign({},...b.map(P=>{var C;return(C=P.sides)==null?void 0:C.filter(({sourceDrawPositionRange:R})=>R).map(({drawPosition:R,sourceDrawPositionRange:N})=>({[R]:N}))}).flat()),w=v.map(P=>P.participantId).filter(Boolean),U=(i??[]).filter(P=>w.includes(P.participantId)),T=Object.assign({},...U.map(P=>({[P.participantId]:P}))),D=v.map(P=>{let C=T==null?void 0:T[P.participantId],R=S[P.drawPosition];return He({...P,participant:o?Ne(C,!1,!0):void 0,sourceDrawPositionRange:R})});return D.length?{validSwapAction:{payload:{drawId:m,structureId:d,drawPositions:[c]},willDisableLinks:e,method:GJ,type:rR,availableAssignments:D}}:{}}function d_(t){var e;let i=We(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(i.error)return i;let{policyDefinitions:r,returnParticipants:n=!0,provisionalPositioning:a,tournamentRecord:o,drawDefinition:s,drawPosition:l,event:u}=t,c=t.tournamentParticipants??(o&&Ai({withIndividualParticipants:!0,tournamentRecord:o}).participants)??[],d=tt({structureId:t.structureId,drawDefinition:s});if(d.error)return d;let p=d.containingStructure||d.structure;if(!p)return{error:Ni};let m=p.structureId;if(d=Tw({drawDefinition:s,structureId:m}),l===void 0&&!d.isAdHoc)return{error:nv};if(d.isAdHoc)return cR(t);if(d.error)return d;let{drawPositionInitialRounds:h,inactiveDrawPositions:f,activeDrawPositions:g,byeDrawPositions:v}=d,y=Bt({tournamentRecord:o,drawDefinition:s,structure:p,event:u}).appliedPolicies??{};Object.assign(y,r??{});let{actionsPolicy:I,enabledStructures:b,actionsDisabled:S}=CZ({actionType:nS,appliedPolicies:y,drawDefinition:s,structure:p}),w=(I==null?void 0:I.activePositionOverrides)||[],{sourceStructureIds:U}=RM({finishingPosition:Kd,targetRoundNumber:1,linkType:Nu,drawDefinition:s,structureId:m})||{},T;U!=null&&U.length&&(T=U.every(q=>_c({structureId:q,drawDefinition:s})));let D=U.length,P=U.length&&!T,{policyActions:C}=EZ({enabledStructures:b,drawDefinition:s,structure:p}),R=![Ke,Ae].includes(p.stage)||p.stageSequence!==1,{drawId:N}=s,A=[],{assignedPositions:M,positionAssignments:E}=Er({structure:p}),O=M==null?void 0:M.find(q=>q.drawPosition===l),k=!!O;if(!((e=E==null?void 0:E.map(q=>q.drawPosition))!=null&&e.includes(l)))return{error:rv};let{stage:x,stageSequence:F}=p,$=[x];x===an&&$.push(Ae),x===Ae&&$.push(an);let _=Ph({entryStatuses:Ep,provisionalPositioning:a,drawDefinition:s,stageSequence:F,structureId:m,stages:$}),L=Np({drawDefinition:s,stages:$}).assignedParticipantIds??[],B=_.filter(q=>!L.includes(q.participantId)).map(q=>q.participantId),V=v.includes(l),G=g.includes(l);if(S)return{info:"Actions Disabled for structure",isActiveDrawPosition:G,isDrawPosition:!0,hasPositionAssigned:k,validActions:[],isByePosition:V};if(Qn({policyActions:C,action:xm})&&!G&&E&&!P&&(!O||V)){let{validAssignmentActions:q}=JDe({positionSourceStructureIds:U,unassignedParticipantIds:B,possiblyDisablingAction:R,isWinRatioFedStructure:D,tournamentParticipants:c,positionAssignments:E,returnParticipants:n,appliedPolicies:y,drawDefinition:s,isByePosition:V,drawPosition:l,structureId:m,event:u});q==null||q.forEach(W=>A.push(W))}if(Qn({policyActions:C,action:iR})&&!G){let{validAssignmentActions:q}=QDe({drawPositionInitialRounds:h,tournamentParticipants:c,positionAssignments:E,returnParticipants:n,appliedPolicies:y,drawDefinition:s,drawPosition:l,structureId:m,drawId:N});q==null||q.forEach(W=>A.push(W))}let{participantId:j}=O||{},z=j&&c.find(q=>q.participantId===j);if(O){Qn({policyActions:C,action:PM})&&!G&&(A.push({type:PM,method:S2,payload:{drawId:N,structureId:m,drawPosition:l},willDisableLinks:R}),V||A.push({type:HL,method:KTe,payload:{drawId:N,structureId:m,drawPosition:l},willDisableLinks:R}),Qn({policyActions:C,action:f0})&&!V&&A.push({type:f0,method:S2,payload:{drawId:N,structureId:m,drawPosition:l,replaceWithBye:!0},willDisableLinks:R}));let q=p.stage===Ke||p.stage===Ae&&p.stageSequence===1;if(!V&&A2({activePositionOverrides:w,activeDrawPositions:g,action:lm})&&Qn({policyActions:C,action:lm})&&p0({drawDefinition:s,structureId:m,drawPosition:l})&&q){let{seedAssignments:W}=go({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:Y,seedValue:re}=(W==null?void 0:W.find(K=>K.participantId===j))??{};A.push({type:lm,method:rDe,participant:z,seedNumber:Y,payload:{drawId:N,structureId:m,participantId:j,seedValue:re}})}if(!V&&A2({activePositionOverrides:w,activeDrawPositions:g,action:aI})&&Qn({policyActions:C,action:aI})&&p0({drawDefinition:s,structureId:m,drawPosition:l})&&q){let{seedAssignments:W}=go({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:Y}=(W==null?void 0:W.find(re=>re.participantId===j))??{};A.push({method:tDe,type:aI,participant:z,seedNumber:Y,payload:{participantId:j,structureId:m,drawId:N}})}if(!V&&j){if(Qn({policyActions:C,action:Fm})){let W={type:Fm,method:HJ,participant:z,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:N}};A.push(W)}if(Qn({policyActions:C,action:py})){let W={type:py,method:eDe,participant:z,payload:{participantId:j,otherName:void 0}};A.push(W)}}if(Qn({policyActions:C,action:rR})){let{validSwapAction:W}=ePe({possiblyDisablingAction:R,tournamentParticipants:c,inactiveDrawPositions:f,activeDrawPositions:g,positionAssignments:E,returnParticipants:n,byeDrawPositions:v,drawDefinition:s,isByePosition:V,drawPosition:l,structureId:m,structure:p,drawId:N});W&&A.push(W)}}if(Qn({policyActions:C,action:GL})&&!P){let{validAlternatesAction:q}=qDe({possiblyDisablingAction:R,tournamentParticipants:c,positionAssignments:E,activeDrawPositions:g,returnParticipants:n,appliedPolicies:y,drawDefinition:s,drawPosition:l,validActions:A,structureId:m,structure:p,drawId:N,event:u});q&&A.push(q)}if(Qn({policyActions:C,action:zL})&&!P&&!G&&E){let{validLuckyLosersAction:q}=XDe({sourceStructuresComplete:T,possiblyDisablingAction:R,isWinRatioFedStructure:D,tournamentParticipants:c,activeDrawPositions:g,positionAssignments:E,drawDefinition:s,drawPosition:l,structureId:m,structure:p,drawId:N});q&&A.push(q)}if((z==null?void 0:z.participantType)===ft&&Qn({policyActions:C,action:jL})){let{validModifyAssignedPairAction:q}=jDe({tournamentParticipants:c,returnParticipants:n,drawPosition:l,participant:z,drawId:N,event:u});q&&A.push(q)}return{isActiveDrawPosition:G,isDrawPosition:!0,hasPositionAssigned:k,isByePosition:V,validActions:A,...Z}}function jw({policyDefinitions:t,appliedPolicies:e,drawType:i}){var r,n;let a=(r=t==null?void 0:t[i0])==null?void 0:r.drawTypeCoercion,o=(n=e==null?void 0:e[i0])==null?void 0:n.drawTypeCoercion;return(typeof a=="boolean"?a:void 0)??(i&&(a==null?void 0:a[i]))??(typeof o=="boolean"?o:void 0)??(i&&(o==null?void 0:o[i]))??!0}function my({tournamentRecord:t,drawDefinition:e,stage:i=Ae,structureId:r,structure:n}){var a;if(!t)return{error:ve};if(!n&&!e)return{error:$e};if(!n&&!r&&((a=e==null?void 0:e.structures)==null?void 0:a.filter(l=>l.stage===i).length)===1&&(n=e.structures.find(l=>l.stage===i)),!n&&!r)return{error:Xa};let{error:o,positionAssignments:s}=oi({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:s??[],structureId:n==null?void 0:n.structureId,error:o}}function p_({structureId:t,drawDefinition:e}){if(!e)return{error:$e};if(!Di(t))return{error:se};let i=Iv({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!ji([Yd,_o,SP,qd],r).length;return{...Z,valid:n}}function _Z({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:se};let i=iv(t);return i?{drawSize:i}:te({result:{error:se},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function Gw(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:o,event:s}=t||{},l="getSeedsCount",u=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let h=Qu({tournamentRecord:a,drawDefinition:o,event:s});if(h.error)return te({result:h,stack:l});i=h.policyDefinitions}let c=st(u);if(u&&!c)return te({result:{error:se},context:{participantsCount:u},stack:l});if(n&&!c)return te({result:{error:a9},stack:l});if(isNaN(r))if(u)({drawSize:r}=_Z({participantsCount:u}));else return te({result:{error:qb},stack:l});let d=n&&u||r;if(d&&d>r)return{error:Qx};let p=i==null?void 0:i[Ao];if(!p)return{error:qK};let m=p.seedsCountThresholds;return m?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:m.filter(h=>e?h.drawSize<=r:r===h.drawSize).reduce((h,f)=>u&&u>=f.minimumParticipantCount?f.seedsCount:h,0)}):{error:NK}}function dR({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:o,event:s}){var l;if((!o||!n)&&i&&({participants:o,participantMap:n}=Ai({tournamentRecord:i})),!o)return{error:Kb};if(!Array.isArray(o))return{error:se};if(!s)return{error:vi};let u=(e==null?void 0:e[Lr])??(r==null?void 0:r[Lr])??wv[Lr],c=(a??((l=u==null?void 0:u.participants)==null?void 0:l.enforceGender))!==!1,{eventType:d,gender:p}=s,m=d===Mu,h=d===Ca&&Xt||m&&ft||Dt,f=Object.assign({},...(t??s.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),g=Object.keys(f),v=o.filter(y=>g.includes(y.participantId)).filter(y=>{let I=tPe({participant:y,participantType:h,eventType:d,entryStatusMap:f}),b=iPe({genderEnforced:c,participantMap:n,eventGender:p,participant:y,isDoubles:m,mismatch:I});return I||!b});if(v.length){let y=v.map(I=>I.participantId);return{error:BK,invalidParticipantIds:y}}return{...Z,valid:!0}}function tPe({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[Mu,Ca].includes(i)&&t.participantType===Dt&&(fd(n)||n===Yl);return t.participantType!==e&&!a}function iPe(t){var e,i,r;let{participant:n,participantMap:a,eventGender:o,mismatch:s,isDoubles:l,genderEnforced:u}=t,c=!s&&l&&dt(((e=n==null?void 0:n.individualParticipantIds)==null?void 0:e.map(h=>{var f,g,v;return(v=(g=(f=a==null?void 0:a[h])==null?void 0:f.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],d=!o||!(c!=null&&c.length)||Ns===o||[Zt,mi].includes(o)&&c[0]===o||jn===o&&(c.length===1&&((i=n.individualParticipantIds)==null?void 0:i.length)===1||c.length===2),p=(r=n==null?void 0:n.person)==null?void 0:r.sex,m=!(n!=null&&n.person)||!o||[Ns,jn].includes(o)||[Zt,mi].includes(o)&&p===o;return!u||d&&m}function $Z({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:r,uuids:n}){var a;let o="generateQualifyingSTructures",s=[],l=[],u=[],c=(g,v)=>g.stageSequence-v.stageSequence,d=(g,v)=>g.roundTarget-v.roundTarget,p=0,m=0,h,f=1;for(let g of t.sort(d)){let v=g.structureProfiles||[];f=g.roundTarget||f;let y=1,I=0,b,S,w;for(let U of(v||[]).sort(c)){let T=Fx(U.drawSize||U.participantsCount),{qualifyingRoundNumber:D,structureOptions:P,matchUpFormat:C,structureName:R,structureId:N,drawType:A}=U,M=U.matchUpType,E=U.qualifyingPositions||rPe({drawSize:T,qualifyingRoundNumber:D}),O,k,x;if(!st(T))return te({result:{error:qb},stack:o});let F=t.length>1?`${f}-`:"",$=v.length>1||F?y:"",_=R||(F||$?`${tn(Ke)} ${F}${$}`:tn(Ke));if(A===ts){let{structures:L,groupCount:B,maxRoundNumber:V}=Ew({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),stage:Ke,structureOptions:P,appliedPolicies:e,stageSequence:y,matchUpType:M,roundTarget:f,drawSize:T,idPrefix:i,isMock:r,uuids:n});I=B,O=V,k=L[0],h=[1]}else({drawSize:T,matchUps:x,roundLimit:O}=cl({qualifyingRoundNumber:D,qualifyingPositions:E,matchUpType:M,drawSize:T,idPrefix:i,isMock:r,uuids:n})),k=so({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),qualifyingRoundNumber:O,stage:Ke,matchUpFormat:C,stageSequence:y,matchUpType:M,roundLimit:O,matchUps:x}),f&&_t({extension:{name:Il,value:f},element:k}),I=((a=x==null?void 0:x.filter(L=>L.roundNumber===O))==null?void 0:a.length)||0;if(y>1){let{link:L}=Ow({sourceStructureId:S,sourceRoundNumber:b,targetStructureId:k.structureId,finishingPositions:w===Nu?[1]:void 0,linkType:w});u.push(L),p+=(T||0)-I}else p+=T||0;w=A===ts?Nu:Au,S=k.structureId,b=O,l.push(k),y+=1}m+=I,s.push({qualifiersCount:I,finalQualifyingRoundNumber:b,finalQualifyingStructureId:S,finishingPositions:h,roundTarget:f,linkType:w}),f+=1}return{qualifiersCount:m,qualifyingDrawPositionsCount:p,qualifyingDetails:s,structures:l,...Z,links:u}}function rPe({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function BZ(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=Qe(t.drawSize),n=e&&t.drawType!==Ga&&(typeof e=="boolean"||e<=2)&&r===2&&Ys||t.drawType||Ys,a=$8.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=Ys;else if(r<4&&i)return{...te({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:iP},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function nPe(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:tn(Ae),...t,stage:Ae},{structures:a,groupCount:o,groupSize:s}=Ew(n);if(o<1)return{error:S9};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:tn(Bi)}],[u]=a,{structures:c,links:d}=tZ({sourceStructureId:u.structureId,requireSequential:r,drawDefinition:e,playoffGroups:l,groupCount:o,groupSize:s,...t});return c&&a.push(...c),{...Z,structures:a,links:d}}function aPe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),n=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),o=r.map((u,c)=>{let d=r.indexOf(u)%2?_o:Yd,p=1+c;return{linkType:zl,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),s={linkType:Au,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:_o,roundNumber:n,structureId:t.structureId}},l=[{linkType:Au,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:_o,roundNumber:1,structureId:i.structureId}},{linkType:zl,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:_o,roundNumber:1,structureId:i.structureId}}];return[...o,s,...l]}function oPe({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let o=[],{matchUps:s}=$c({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=bc({structureName:t||tn(Ae),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:Ae,matchUpType:e,matchUps:s});o.push(l);let u=r/2,{matchUps:c}=$c({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=bc({structureName:tn(_8),matchUps:c,structureId:a==null?void 0:a.pop(),stage:an,stageSequence:2,matchUpType:e});o.push(d);let{matchUps:p}=cl({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),m=bc({structureName:tn(L8),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:Bi,matchUpType:e});o.push(m);let h=aPe({mainStructure:l,consolationStructure:d,deciderStructure:m});return{structures:o,links:h,...Z}}function sPe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:o,isMock:s,uuids:l}=t;if(!st(o)||o<2)return{matchUps:[],roundsCount:0};if(Cs(o))return cl(t);let u=lPe(o),c=u.shift(),d=Te(1,((c==null?void 0:c.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],m=1;({matchUps:p}=g0({roundNumber:m,matchUpType:n,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:l})),m++;let h=t.roundLimit||e;for(let g of u){let v=g.participantsCount/2,y=Te(1,v+1);r&&v===r&&(h=m-1);let I=y.map(b=>{let S=WL({roundPosition:b,roundNumber:m,idPrefix:a,uuids:l});return{roundPosition:b,roundNumber:m,matchUpId:S}});p.push(...I),m++}let f=m-1;return p=Uw({finishingPositionOffset:i,lucky:!0,roundsCount:f,roundLimit:h,matchUps:p}),h&&(p=p.filter(g=>g.roundNumber<=h)),{matchUps:p,roundsCount:f,roundLimit:h}}function lPe(t){let e=Qe(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),o=a===1,s=!!(!o&&a%2);i=!o&&s?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:s})}return n}function VZ(t){var e,i;let{playoffAttributes:r,stageSequence:n=1,stage:a=Ae,matchUpType:o,drawSize:s,uuids:l}=t,u=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,c=t.structureId||u()||(l==null?void 0:l.pop()),d=t.appliedPolicies??Bt(t),p=((e=t.policyDefinitions)==null?void 0:e[sg])||(d==null?void 0:d[sg]);t.skipRounds=t.skipRounds||s<=4&&(p!=null&&p.feedFromMainFinal?0:1)||0;let m=t.structureName??((i=r==null?void 0:r[0])==null?void 0:i.name)??tn(Ae),h=()=>{let{matchUps:f}=cl(t);return{structures:[so({stageSequence:n,structureName:m,matchUpType:o,structureId:c,matchUps:f,stage:a})],links:[],...Z}};return{generators:{[Ga]:()=>({structures:[so({finishingPosition:Kd,stageSequence:n,structureName:m,matchUps:[],matchUpType:o,structureId:c,stage:a})],links:[],...Z}),[Tp]:()=>{let{matchUps:f}=sPe(t);return{structures:[so({stageSequence:n,structureName:m,matchUpType:o,structureId:c,matchUps:f,stage:a})],links:[],...Z}},[Ys]:()=>h(),[tw]:()=>oPe(t),[ig]:()=>yf({...t,roundOffsetLimit:3,playoffAttributes:r??DF}),[rg]:()=>yf({...t,roundOffsetLimit:2,playoffAttributes:r??PF}),[Bi]:()=>yf(t),[dv]:()=>{let{matchUps:f}=$c({drawSize:s,uuids:l,matchUpType:o});return{structures:[so({stageSequence:n,structureName:m,matchUpType:o,structureId:c,stage:Ae,matchUps:f})],links:[],...Z}},[iw]:()=>ZJ(t),[ng]:()=>$p({...t,feedRounds:1,fmlc:!0}),[F8]:()=>$p({...t,feedRounds:1}),[UF]:()=>$p({...t,feedsFromFinal:1}),[SF]:()=>$p({...t,feedsFromFinal:2}),[TF]:()=>$p({...t,feedsFromFinal:3}),[rw]:()=>$p(t),[TP]:()=>eZ(t),[ts]:()=>Ew(t),[Wl]:()=>nPe(t)}}}function m_(t){var e,i,r,n,a;let{enforceMinimumDrawSize:o=!0,overwriteExisting:s,appliedPolicies:l,staggeredEntry:u,drawDefinition:c,tieFormat:d,isMock:p,uuids:m}=t||{},h=Qe(t.drawSize),f=t.drawTypeCoercion??jw({appliedPolicies:l,drawType:t.drawType}),g="generateDrawStructuresAndLinks",v=BZ({drawType:t.drawType,enforceMinimumDrawSize:o,drawTypeCoercion:f,drawSize:h});if(v.error)return v;let y=v.drawType,I=[],b=[],S=(t==null?void 0:t.matchUpType)??ii,w=(e=c==null?void 0:c.structures)==null?void 0:e.filter(({stage:j})=>j===Ke);w&&I.push(...w);let U=w==null?void 0:w.map(({structureId:j})=>j),T=(i=c==null?void 0:c.structures)==null?void 0:i.find(({stage:j,stageSequence:z})=>j===Ae&&z===1),D=(r=c==null?void 0:c.links)==null?void 0:r.filter(j=>j.target.structureId===(T==null?void 0:T.structureId)&&(U==null?void 0:U.includes(j.source.structureId))),P=(j,z)=>{var q;if(j.linkType===Nu&&z!=null&&z.structures){let W=j.source.finishingPositions||[];return z.structures.length*W.length}else if(j.linkType===Au&&(q=z==null?void 0:z.matchUps)!=null&&q.length){let W=j.source.roundNumber;return z.matchUps.filter(({roundNumber:Y})=>Y===W).length}},C=w==null?void 0:w.map(j=>{var z,q,W;let Y=D==null?void 0:D.find(X=>X.target.structureId===j.structureId),re=((q=(z=oi({structure:j}))==null?void 0:z.positionAssignments)==null?void 0:q.length)??0;if(!Y)return re;let K=Y==null?void 0:Y.source.structureId,H=(W=c.structures)==null?void 0:W.find(X=>X.structureId===K),Q=P(Y,H)||0;return re-Q}).filter(Boolean).reduce((j,z)=>j+z,0),R=D==null?void 0:D.map(j=>{let z=j.source.structureId,q=w==null?void 0:w.find(W=>W.structureId===z);return P(j,q)}).filter(Boolean).reduce((j,z)=>j+z,0),N=!!(T&&!((n=T==null?void 0:T.matchUps)!=null&&n.length));if(w!=null&&w.length&&!N)return{error:oM};let A=!(w!=null&&w.length)&&t.qualifyingProfiles,M=(A==null?void 0:A.length)&&$Z({idPrefix:t.idPrefix,qualifyingProfiles:A,appliedPolicies:l,isMock:p,uuids:m});if(M!=null&&M.error)return M;let{qualifyingDrawPositionsCount:E,qualifyingDetails:O,qualifiersCount:k}=M||{qualifyingDrawPositionsCount:C,qualifiersCount:R};E&&(M!=null&&M.structures&&I.push(...M.structures),M!=null&&M.links&&b.push(...M.links)),Object.assign(t,He({drawSize:h,matchUpType:S,tieFormat:d}));let x=y!==Ga&&(!h||h<2||!u&&![dv,Tp].includes(y)&&([Wl,ts].includes(y)&&h<3||![ts,Wl].includes(y)&&!Cs(h)));if(x&&!E)return te({context:{drawSize:h,invalidDrawSize:x},result:{error:iP},stack:g});let{generators:F,error:$}=VZ(t);if($)return{error:$};let _=F[y];if(!_)return{error:Bx};let L=_==null?void 0:_();if(L.error)return L;let{structures:B,links:V}=L;if(B!=null&&B.length){let j=B.find(({stage:z,stageSequence:q})=>z===Ae&&q===1);if(T&&j){if(N){let z=j.structureId;if(j.structureId=T.structureId,V==null?void 0:V.length)for(let q of V)q.source.structureId===z&&(q.source.structureId=T.structureId),q.target.structureId===z&&(q.target.structureId=T.structureId)}else if(!s)return{error:oM}}I.push(...B)}I.sort(Th),V!=null&&V.length&&b.push(...V);let G=L.structures.find(({stage:j,stageSequence:z})=>j===Ae&&z===1);for(let j of O||[]){let{finalQualifyingRoundNumber:z,finalQualifyingStructureId:q,roundTarget:W,finishingPositions:Y,linkType:re}=j,K=G&&((a=Ow({targetStructureId:G.structureId,sourceStructureId:q,sourceRoundNumber:z,finishingPositions:Y,targetEntryRound:W,linkType:re}))==null?void 0:a.link);if(K!=null&&K.error)return K;K&&b.push(K)}return D&&b.push(...D),{...Z,qualifyingResult:{qualifyingDrawPositionsCount:E,qualifiersCount:k},structures:I,links:b}}function h_(t){var e,i;let{modifyOriginal:r=!0,stageSequence:n=1,isMock:a}=t||{},o="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return te({result:{error:$e},stack:o});let s=r?t.drawDefinition:Ne(t.drawDefinition,!1,!0),{tieFormat:l,matchUpType:u}=t;if(l){let S=qn({tieFormat:l});if(S.error)return S}l=Yr(l??((e=In({drawDefinition:s}))==null?void 0:e.tieFormat)),u=u??(s.matchUpType||ii),t.tieFormat=l,t.matchUpType=u;let c=d0({drawDefinition:s,stage:Ae});t.drawSize=t.drawSize??c,!c&&t.drawSize&&h0({drawSize:t.drawSize,drawDefinition:s,stageSequence:n,stage:Ae});let d=ln({drawDefinition:s}).drawMatchUps.map(Dr),p=m_(t);if(p.error)return te({result:p,stack:o});let{structures:m,links:h,qualifyingResult:f}=p;s.structures=m,s.links=h;let g=Math.max(t.qualifiersCount??0,(f==null?void 0:f.qualifiersCount)||0);if(f!=null&&f.qualifyingDrawPositionsCount&&!d0({stage:Ke,drawDefinition:s})){let S=h0({drawSize:f.qualifyingDrawPositionsCount,stage:Ke,drawDefinition:s});if(S.error)return S}if(g){let S=VJ({qualifiersCount:g,drawDefinition:s,stage:Ae});if(S.error)return S}let v=t.drawSize??c;Object.assign(t,He({drawSize:v,matchUpType:u,tieFormat:l}));let{matchUps:y,matchUpsMap:I}=fr({drawDefinition:s});l&&(y==null||y.forEach(S=>{if(!d.includes(S.matchUpId)){let{tieMatchUps:w}=xw({tieFormat:l,matchUp:S,isMock:a});Object.assign(S,{tieMatchUps:w,matchUpType:u})}}));let{inContextDrawMatchUps:b}=ep({drawDefinition:s,matchUpsMap:I});return li({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,drawDefinition:s}),{inContextDrawMatchUps:b,drawDefinition:s,matchUpsMap:I,...Z,structures:m,matchUps:y,links:h}}function Hw(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,o;if(!GZ({scaleItem:n}))return{error:Rm};if(r&&Array.isArray(i.participants)&&(o=i.participants.find(s=>s.participantId===r),o)){if(o.participantType===Gn&&(n==null?void 0:n.eventType)!==Ca)return{error:Rm};let s=HZ({removePriorValues:e,participant:o,scaleItem:n});if(s.error)return s;a=!s.valueChanged;let{topics:l}=So();l.includes(on)&&ut({topic:on,payload:{tournamentId:i.tournamentId,participants:[o]}})}return a&&{...Z,info:sF,existingValue:n==null?void 0:n.scaleValue}||o&&{...Z,newValue:n==null?void 0:n.scaleValue}||{error:Wi}}function jZ(t){var e;let{scaleItemsWithParticipantIds:i=[],removePriorValues:r,tournamentRecord:n,auditData:a,context:o}=t;if(!n)return{error:ve};if(!n.participants)return{error:Kb};let s=0,l={},u=[];for(let p of i){let m=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let h of p.scaleItems)if(GZ({scaleItem:h}))Array.isArray(l[m])||(l[m]=[]),l[m].push(h);else return{error:Rm}}for(let p of n.participants){let{participantId:m}=p||{};if(Array.isArray(l[m]))for(let h of l[m]){if(p.participantType===Gn&&(h==null?void 0:h.eventType)!==Ca)return te({context:{participantId:m,scaleItem:h,participantType:p.participantType},info:"Invalid participantType for eventType",result:{error:Rm}});HZ({participant:p,scaleItem:h,removePriorValues:r}),u.push(p),s++}}let c=s?void 0:uv,{topics:d}=So();if(d.includes(on)&&s&&ut({topic:on,payload:{tournamentId:n.tournamentId,participants:u}}),o){let{eventId:p,drawId:m,...h}=o,f=((e=h.scaleAttributes)==null?void 0:e.scaleType)&&[h.scaleAttributes.scaleType];if(Object.keys(h).length){let g={itemType:zF,itemValue:h};if(f&&(g.itemSubTypes=f),m||p){let{drawDefinition:v,event:y}=Kn({tournamentRecord:n,eventId:p,drawId:m});m&&VL({drawDefinition:v,timeItem:g}),p&&_h({event:y,timeItem:g})}else Bw({tournamentRecord:n,timeItem:g})}}return a&&d.includes(fu)&&ut({topic:fu,payload:a}),He({...Z,modificationsApplied:s,info:c})}function GZ({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e==null?void 0:e.includes(r)).length===i.length}function HZ({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:vh};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(u=>r.includes(u)&&i[u]).length!==n.length)return{error:Rm};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:o}=kl({scaleAttributes:i,participant:e}),s=u=>[void 0,null,""].includes(u),l=!(s(o==null?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o==null?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[Xd,u,c,d].join("."),m=He({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(m.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(h=>h.itemType!==p)),e.timeItems.push(m)}return{...Z,valueChanged:l,newValue:i.scaleValue}}function f_(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=We(t,[{[wr]:!0},{modifiedScaleValues:!0,[Jn]:ta}]);if(n.error)return n;for(let a in i){let o=Hw({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(o.error)return o}return{...Z}}function mg(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:hr};let{participant:a,tournamentId:o}=nd({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...kl({participant:a,scaleAttributes:i}),tournamentId:o}:{error:Wi}}var uPe=(t=0)=>250/Math.pow(t+5,.4),cPe=()=>1;function dPe(t=3,e=2){let i=t/e;return isNaN(i)?rf.kDefault():i}var rf={nSpread:400,diffThreshold:.125,kCalc:uPe,kMultiplier:dPe,kDefault:cPe};function zZ(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=Sr,winnerCountables:n=1,loserCountables:a=0,ratingType:o=xo,maxCountables:s,countables:l}=t||{},u=r==null?void 0:r[o];if(!u)return{error:Je};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,m=d?c.slice().reverse():c,h=(E,O)=>parseFloat(O)>=Math.min(...E)&&parseFloat(O)<=Math.max(...E);(!h(c,e)||!h(c,i))&&(h(c,e)||(e=u.defaultInitialization),h(c,i)||(i=u.defaultInitialization));let f=uf({targetRange:Sr[xo].range,sourceRange:m,value:d?c[0]-e:e}),g=uf({targetRange:Sr[xo].range,sourceRange:m,value:d?c[0]-i:i}),v=(E,O)=>1/(1+Math.pow(10,(O-E)/rf.nSpread)),y=v(f,g),I=v(g,f),b=rf.kCalc(n),S=rf.kCalc(a),w=rf.kMultiplier(s,l),U=f+w*b*(1-y),T=g+w*S*(0-I),D=uf({sourceRange:Sr[xo].range,value:U,targetRange:m}),P=uf({sourceRange:Sr[xo].range,value:T,targetRange:m}),C=d?c[0]-D:D,R=parseFloat(C.toFixed(p)),N=d?c[0]-P:P,A=parseFloat(N.toFixed(p)),M=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(D>P&&M>rf.diffThreshold||R<0||A<0)&&(R=e,A=i),{newWinnerRating:R,newLoserRating:A}}var pPe=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function WZ(t){var e,i;let r=We(t,[{[wr]:!0},{matchUpIds:!0,[Jn]:cn,[zo]:hh},{ratingType:!1,[Xr]:b=>Sr[b]}]);if(r.error)return r;let{updateParticipantRatings:n,removePriorValues:a=!0,tournamentRecord:o,ratingType:s=xo,refreshDynamic:l,considerGames:u,drawDefinition:c,matchUpIds:d,asDynamic:p}=t,m=Sr[s],{accessor:h}=m,f={},g=(t.matchUps||l&&Pn({drawDefinition:c,tournamentRecord:o,inContext:!0,matchUpFilters:{matchUpStatuses:Ir}}).matchUps||Gr({matchUpFilters:{matchUpIds:d,matchUpStatuses:Ir},tournamentRecord:o,inContext:!0}).matchUps)??[],v=`${s}.${xF}`,y=p?v:s;g.sort(Oh);for(let b of g){let{endDate:S,matchUpFormat:w,score:U,sides:T,winningSide:D}=b,P=b.matchUpType,C={eventType:P,scaleName:s,scaleType:Ic},R={scaleName:v,eventType:P,scaleType:Ic},N=Object.assign({},...(T??[]).map(_=>{let{sideNumber:L,participant:B}=_;return L&&{[L]:[B==null?void 0:B.participantId,...(B==null?void 0:B.individualParticipantIds)??[]].filter(Boolean).flat()}})),A=Object.assign({},...Object.values(N).flat().map(_=>{let L=f[_],B=!l||L?mg({scaleAttributes:R,tournamentRecord:o,participantId:_}).scaleItem:void 0,V=mg({tournamentRecord:o,scaleAttributes:C,participantId:_}).scaleItem,G=h?{[h]:void 0}:void 0;return _&&{[_]:B??V??{scaleName:y,eventType:P,scaleDate:S,scaleType:Ic,scaleValue:G}}})),M=w?Ln(w):{},E=(M==null?void 0:M.bestOf)||1,O=(M==null?void 0:M.setsTo)||1,k=u?E&O:E,x=(U==null?void 0:U.sets)&&pPe(U.sets)||D===1&&[1,0]||[0,1],F=D?N[D]:[],$=D?N[3-D]:[];for(let _ of F){let L=(e=A[_])==null?void 0:e.scaleValue,B=typeof L=="object"?L[h]:L;for(let V of $){let G=(i=A[V])==null?void 0:i.scaleValue,j=typeof G=="object"?G[h]:G,z=D?x[D]:[0,0],q=D?x[3-D]:[0,0],{newWinnerRating:W,newLoserRating:Y}=zZ({winnerCountables:z,loserCountables:q,maxCountables:k,winnerRating:B,loserRating:j,ratingType:s}),re=h?{...L,[h]:W}:W,K=h?{...G,[h]:Y}:Y;A[_].scaleValue=re,A[V].scaleValue=K,A[_].scaleName=y,A[V].scaleName=y}}Object.assign(f,A),n&&f_({tournamentRecord:o,modifiedScaleValues:f,removePriorValues:a})}let I=g.map(({matchUpId:b})=>b);return{...Z,modifiedScaleValues:f,outputScaleName:y,processedMatchUpIds:I}}function pR(t){var e;let{matchUpIds:i=[],drawDefinition:r,roundNumber:n,newRound:a,isMock:o,event:s}=t;if(typeof r!="object")return{error:$e};let{participantIdPairings:l,matchUpsCount:u}=t,c=uR(t);if(c.error)return te({result:c});let{lastRoundNumber:d,availableMatchUpsCount:p=0,roundMatchUpsCount:m=0}=c;if(!u)a?u=m:p>0&&(u=p);else if(u>m&&t.restrictMatchUpsCount!==!1)return te({result:{error:se,info:"matchUpsCount error",context:{roundMatchUpsCount:m}}});if(l&&!Array.isArray(l)||u&&!st(u)||i&&!Array.isArray(i)||!l&&!u)return{error:se,info:"matchUpsCount or pairings error"};if(u&&t.restrictMatchUpsCount!==!1&&u>32)return{error:se,info:"matchUpsCount must be less than 33"};if(n&&!t.ignoreLastRoundNumber&&n-1>(d||0))return{error:se,info:"roundNumber error"};let h=n??(a&&(d??0)+1||d||1);l=l??Te(0,u).map(()=>({participantIds:[void 0,void 0]}));let f=v=>{if(!t.idPrefix)return;let y=r.drawId,I=t.idPrefix??"ah";return`${y}-${I}-${h}-${v}`},g=l==null?void 0:l.map((v,y)=>{let I=(v==null?void 0:v.participantIds)??[void 0,void 0];I.push(void 0,void 0);let b=I.slice(0,2).map((w,U)=>He({sideNumber:U+1,participantId:w})),S=i[y]??f(y)??Ht();return{roundNumber:h,matchUpStatus:Zi,matchUpId:S,sides:b}});if(g!=null&&g.length){let v=(e=In({drawDefinition:r,event:s}))==null?void 0:e.tieFormat;v&&g.forEach(y=>{let{tieMatchUps:I}=xw({tieFormat:v,matchUp:y,isMock:o});Object.assign(y,{tieMatchUps:I,matchUpType:fi})})}return{roundNumber:h,matchUpsCount:(g==null?void 0:g.length)??0,matchUps:g,...Z}}function mPe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),o=Object.keys(i),s=[],l=k2({actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),u=[HC(l)];s.push(l);let c=l.value,d=l,p=1,m=0,h=o.length,f;do h-=1,f=o.length*i[o[0]].length;while(f>t&&h>5);let g=[];o.forEach(y=>{i[y].slice(0,h).forEach(I=>{m+=1;let b=um(y,I.opponent);if(!g.includes(b)){let S=k2({stipulated:[[y,I.opponent]],actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!u.includes(HC(S))){u.push(HC(S)),s.push(S);let{maxDelta:w,value:U}=S;w<d.maxDelta&&(d=S),(U<c||U===c&&Math.round(Math.random()))&&(c=U),g.push(b),p+=1}}}),s=s.filter(I=>Math.abs(I.value-c)<5)}),s.sort((y,I)=>y.maxDiff-I.maxDiff);let v=ga(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:m,candidate:v}}function HC(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function k2({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let o=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,m]=d,h=um(p,m),f=i[h];s.push({participantIds:d,value:f}),l+=i[h]}),Cr(t,a).map(d=>Tn(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((m,h)=>o.includes(h)||m,!1)){o.push(...p);let m=d.value;l+=m,s.push({participantIds:p,value:m})}}),s.sort((d,p)=>d.value-p.value);let u=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=um(m,h),g=r[f];return g>d?g:d},0),c=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=um(m,h),g=n[f];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:u,maxDiff:c}}function um(t,e){return[t,e].sort(XP).join("|")}function qZ({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let o=um(a,n);i.includes(o)||i.push(o)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function hPe({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(Tt);if(r.length===2){let[n,a]=r,o=um(n,a);e.includes(o)||e.push(o)}}return{encounters:e}}function fPe({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(o=>r(n,o));i[n]=a.sort((o,s)=>o.value-s.value)}function r(n,a){let o=um(n,a);return{opponent:a,value:e[o]}}return{pairingValues:i}}var gPe=0;function vPe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){var a;let o=((a=Sr[r])==null?void 0:a.defaultInitialization)??gPe;return n.split("|").map(s=>{var l;if(i===ho){let u=(l=t==null?void 0:t.find(c=>c.participantId===s))==null?void 0:l.individualParticipantIds;return u?u==null?void 0:u.map(c=>e[c]||o):o*2}else return e[s]||o})}function IPe(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:o,deltaObjects:s,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;n.forEach(I=>{let b=vPe({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:I}),S=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?S:S*-1)||0,U=Math.abs(b[0]-b[1])+w,T=Math.abs(b[0]-b[1]);s[I]=T,l[I]||(l[I]=0),l[I]+=U?Math.pow(U,2):0});let p=n.map(I=>({pairing:I,value:l[I]})).sort((I,b)=>I.value-b.value),{pairingValues:m}=fPe({possiblePairings:r,valueObjects:l}),{candidate:h,candidatesCount:f,deltaCandidate:g,iterations:v}=mPe({valueSortedPairings:p,maxIterations:a,pairingValues:m,deltaObjects:s,valueObjects:l}),{participantIdPairings:y}=o?g:h;return{participantIdPairings:y,candidatesCount:f,deltaCandidate:g,iterations:v,candidate:h}}var yPe=100,bPe=100,wPe=4e3;function g_(t){var e,i;let{encounterValue:r=yPe,sameTeamValue:n=bPe,maxIterations:a=wPe,updateParticipantRatings:o,generateMatchUps:s=!0,ignoreLastRoundNumber:l,iterationMatchUps:u,tournamentRecord:c,dynamicRatings:d,refreshDynamic:p,participantIds:m,drawDefinition:h,roundNumber:f,structureId:g,matchUpIds:v,eventType:y,scaleName:I,idPrefix:b,isMock:S,salted:w,event:U}=t;if(!h)return{error:$e};if(!t.structure&&!g)return{error:Ni};let T=t.structure||tt({drawDefinition:h,structureId:g}).structure;if(!At(T))return{error:Up};if(!(m!=null&&m.length))return{error:Zc};let D=[...u??[],...(T==null?void 0:T.matchUps)??[]],{encounters:P}=hPe({matchUps:D}),C=(c==null?void 0:c.participants)??[],R={};if(d){let z=dt(T!=null&&T.matchUps?T.matchUps.map(({roundNumber:W})=>W):[]),q=Math.max(...z,0);if(q){let W=(e=T==null?void 0:T.matchUps)==null?void 0:e.filter(({roundNumber:re})=>re===q).map(({matchUpId:re})=>re),Y=WZ({ratingType:I??((i=U==null?void 0:U.category)==null?void 0:i.ratingType),updateParticipantRatings:o,tournamentRecord:c,asDynamic:!0,refreshDynamic:p,drawDefinition:h,matchUpIds:W});if(Y.error)return Y;Y.modifiedScaleValues&&(R=Y.modifiedScaleValues)}}let{valueObjects:N}=UPe({tournamentParticipants:C,encounterValue:r,sameTeamValue:n,encounters:P}),{uniquePairings:A,possiblePairings:M,deltaObjects:E}=qZ({participantIds:m}),O=Object.values(R).length?R:t.adHocRatings,k={tournamentParticipants:C,possiblePairings:M,participantIds:m,uniquePairings:A,drawDefinition:h,maxIterations:a,adHocRatings:O,deltaObjects:E,valueObjects:N,eventType:y,scaleName:I,structure:T,salted:w},{candidatesCount:x,participantIdPairings:F,deltaCandidate:$,iterations:_,candidate:L}=IPe(k);if(!x)return{error:cP};let B,V;if(s){let z=pR({structureId:T==null?void 0:T.structureId,ignoreLastRoundNumber:l,participantIdPairings:F,newRound:!0,drawDefinition:h,roundNumber:f,matchUpIds:v,idPrefix:b,isMock:S,event:U});if(z.error)return z;B=z.roundNumber,V=z.matchUps}let{maxDelta:G,maxDiff:j}=L;return{roundNumber:B,participantIdPairings:F,modifiedScaleValues:R,candidatesCount:x,deltaCandidate:$,...Z,iterations:_,matchUps:V,maxDelta:G,maxDiff:j}}function UPe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let o of t)n[o]||(n[o]=0),n[o]+=i;let a=e==null?void 0:e.filter(({participantType:o})=>o===Xt);if(a)for(let o of a){let s=o.individualParticipantIds??[],{uniquePairings:l}=qZ({participantIds:s});for(let u of l)n[u]||(n[u]=0),n[u]+=r}return{valueObjects:n}}function YZ(t){var e,i,r,n;let{drawType:a=Ys,attachConsolation:o=!0,applyPositioning:s=!0,tournamentRecord:l,staggeredEntry:u,automated:c,placeByes:d,isMock:p,event:m}=t,h=t==null?void 0:t.drawDefinition;if(!h)return{error:$e};let f=Fr,g=Ph({stageSequence:1,drawDefinition:h,stage:f}),v=[ts,tw,Wl].includes(a)?g.length:iv(g.length);if(!u&&a===dv&&g.length<2||a===ts&&g.length<3)return{error:iP};let{tieFormat:y,matchUpType:I}=t;if(y){let M=qn({tieFormat:y});if(M.error)return M}y=Yr(y??((e=In({drawDefinition:h}))==null?void 0:e.tieFormat)),I=I??h.matchUpType??ii;let{structures:b}=rs({stageSequence:1,drawDefinition:h,stage:f});if(b.length>1)return{error:jK};if((r=(i=b==null?void 0:b[0])==null?void 0:i.matchUps)!=null&&r.length)return{error:uF};let S=(n=b==null?void 0:b[0])==null?void 0:n.structureId;Object.assign(t,He({structureName:t.structureName??tn(Fr),structureId:S,matchUpType:I,tieFormat:y,drawSize:v,stage:f}));let w=VZ(t);if(w.error)return w;let U=w.generators[a];if(!U)return{error:Bx};let T=U==null?void 0:U();if(T.error)return T;let{structures:D,links:P}=T,C=D.map(M=>qt({structure:M}).matchUps).flat();y&&C.forEach(M=>{let{tieMatchUps:E}=xw({matchUp:M,tieFormat:y,isMock:p});Object.assign(M,{tieMatchUps:E,matchUpType:I})}),(!s||!o)&&(h=Ne(h,!1,!0)),h.links||(h.links=[]),P.length&&h.links.push(...P);let R=D.map(({structureId:M})=>M);h.structures||(h.structures=[]);let N=h.structures.map(({structureId:M})=>M);h.structures=h.structures.map(M=>R.includes(M.structureId)?D.find(({structureId:E})=>E===M.structureId):M);let A=D.filter(({structureId:M})=>!N.includes(M));return A.length&&h.structures.push(...A),c&&Aw({seedingProfile:t.seedingProfile,applyPositioning:s,tournamentRecord:l,drawDefinition:h,structureId:S,placeByes:d,drawSize:v,event:m}),o&&li({drawDefinition:h}),{links:P,structures:D,...Z}}var v_={};bt(v_,{addGame:()=>iQ,addPoint:()=>tQ,addSet:()=>nQ,addShot:()=>rQ,analyzeScore:()=>S_,analyzeSet:()=>fy,calculateHistoryScore:()=>ZZ,checkScoreHasValue:()=>yr,checkSetIsComplete:()=>fR,clearHistory:()=>eQ,generate:()=>KZ,generateScoreString:()=>xl,generateTieMatchUpScore:()=>_w,getSetComplement:()=>D_,getTiebreakComplement:()=>yR,helpers:()=>lQ,isValidMatchUpFormat:()=>Ra,keyValueScore:()=>kQ,mutate:()=>JZ,parseMatchUpFormat:()=>Ln,parseScoreString:()=>b0,query:()=>$Q,redo:()=>aQ,reverseScore:()=>XZ,setServingSide:()=>QZ,stringifyMatchUpFormat:()=>yP,tidyScore:()=>_Q,umo:()=>sQ,undo:()=>oQ,validateScore:()=>T_,validateTieFormat:()=>qn});var KZ={};bt(KZ,{generateScoreString:()=>xl,generateTieMatchUpScore:()=>_w,reverseScore:()=>XZ});function xl(t){let{winnerFirst:e=!0,addOutcomeString:i,reversed:r=!1,matchUpStatus:n,matchUpFormat:a,autoComplete:o,winningSide:s,sets:l}=t;if(!l)return{error:Je,info:"missing sets"};let u=a&&Ln(a),{bestOf:c,finalSetFormat:d,setFormat:p}=u??{},m=r||!(!e||!s||s===1),h=i?SPe({matchUpStatus:n}):"",f=(l==null?void 0:l.sort(TPe).map(g).filter(Boolean).join(" "))||"";if(!h)return f;if(s===2)return`${h} ${f}`;return`${f} ${h}`;function g(v){let y=c&&v.setNumber===c&&d?d:p,I=$=>_i($==null?void 0:$.side1Score)||_i($==null?void 0:$.side2Score),b=$=>_i($==null?void 0:$.side1TiebreakScore)||_i($==null?void 0:$.side2TiebreakScore),S=(y==null?void 0:y.tiebreakSet)||!I(v)&&b(v),{side1Score:w,side2Score:U,side1TiebreakScore:T,side2TiebreakScore:D}=v,P=T||(_i(T)||o?0:""),C=D||(_i(D)||o?0:"");if(S)return`[${(m?[C,P]:[P,C]).join("-")}]`;let R=Math.min(P,C),N=R===P?1:2,A=R?`(${R})`:"",M=w||(_i(w)||o?0:""),E=U||(_i(U)||o?0:""),O=$=>N===$?A:"",k=`${M}${O(1)}`,x=`${E}${O(2)}`,F=m?`${[x,k].join("-")}`:`${[k,x].join("-")}`;return["-"," "].includes(F)&&(F=""),F}}function SPe({matchUpStatus:t}){let e={[Hr]:"RET",[Ft]:"WO",[dr]:"DF/DF",[tr]:"WO/WO",[rd]:"SUS",[ua]:"ABN",[Pt]:"DEF",[gv]:"DR"};return t&&e[t]||""}function TPe(t,e){return t.setNumber-e.setNumber}function XZ(t){if(!(t!=null&&t.score))return{error:Je};let{sets:e}=t.score,i=e.map(a=>{let{side1TiebreakScore:o,side2TiebreakScore:s,winningSide:l,side1Score:u,side2Score:c,setNumber:d}=a;return He({winningSide:l?3-l:void 0,side1TiebreakScore:s,side2TiebreakScore:o,side1Score:c,side2Score:u,setNumber:d})}),r=xl({sets:i}),n=xl({sets:i,reversed:!0});return{reversedScore:{sets:i,scoreStringSide1:r,scoreStringSide2:n},...Z}}var JZ={};bt(JZ,{addGame:()=>iQ,addPoint:()=>tQ,addSet:()=>nQ,addShot:()=>rQ,calculateHistoryScore:()=>ZZ,clearHistory:()=>eQ,redo:()=>aQ,setServingSide:()=>QZ,umo:()=>sQ,undo:()=>oQ});function Ap({matchUp:t}){let{extension:e}=vt({name:xP,element:t});if(!e)return{error:Vr};let{history:i=[],undoHistory:r=[]}=e.value;return{history:i,undoHistory:r,...Z}}function ZZ(t){var e,i;if(!t)return{error:Je};let{matchUp:r,updateScore:n}=t;if(!r)return{error:sa};let a=((e=Ap({matchUp:r}))==null?void 0:e.history)||[];if(!Array.isArray(a))return{error:se,info:"history is not an array"};let{matchUpFormat:o}=r;if(!o)return{error:qx};if(!Ra({matchUpFormat:o}))return{error:Wx};let s=Ln(o),{bestOf:l,finalSetFormat:u,setFormat:c}=s,d=["0","15","30","40","A","G"],p={sets:[]},m=[],h,f=[0,0],g=1,v=0,y,I=0,b=R=>[1,2].includes(R),S=()=>(v+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:v,games:[]}),w=()=>({winningSide:void 0,points:[]}),U=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),T=U(),D=w(),P=S(),C=0;for(let R of a){C+=1,y=p.sets.length+1===l;let N=y&&u?u:c,{tiebreakAt:A,setTo:M,NoAD:E,tiebbreakFormat:O}=N,k=P.side1Score===A&&P.side1Score===P.side2Score,x=!!N.tiebreakSet,F=x?N.tiebreakSet:O,{tiebreakTo:$,NoAD:_}=F||{},L=()=>{h=void 0,f=[0,0],g=3-g,P.side1TiebreakScore=0,P.side2TiebreakScore=0,P.side1PointScore="",P.side2PointScore="",I=0},B=j=>{P.winningSide=j;let{s:z,...q}=P;p.sets.push(q),T=U(),D=w(),P=S(),L()},V=j=>{D.winningSide=j;let{g:z,...q}=D;P.games.push(q),T=U(),D=w(),L();let W=`side${j}Score`;P[W]+=1},G=j=>{T.winningSide=j;let{p:z,...q}=T;D.points.push(q),T=U(),I=0;let W=()=>f.reduce((re,K)=>re+K)%4/4>.5?g:3-g,Y=j-1;if(k||x){f[Y]+=1,h=W(),P[`side${j}TiebreakScore`]=f[Y],P[`side${3-j}TiebreakScore`]=f[1-Y];let re=_?1:2;if(f[Y]>=$&&f[Y]>=f[1-Y]+re)return V(j),{gameCompleted:!0}}else if(f[1-Y]===4&&f[Y]===3?f[1-Y]-=1:f[Y]+=1,P.side1PointScore=d[f[0]],P.side2PointScore=d[f[1]],f[Y]===5||f[Y]===4&&f[1-Y]<3||E&&f[Y]===4)return V(j),{gameCompleted:!0}};if(b(R.srv)&&(g=R.srv),["p","s","g","o"].includes(R.u)&&m.push(R.u),R.shotOutcome&&(T.shots.push(R),R.shotType==="SERVE"&&["OUT","NET"].includes(R.shotOutcome)&&(I+=1),I===2)){let j=3-g;G(j)}if(b(R.p)||st(R.pointNumber)){let j=R.winningSide||R.p;if((i=G(j))!=null&&i.gameCompleted)continue}if(b(R.g)||st(R.gameNumber)){let j=R.winningSide||R.g;D.winningSide=j;let z=`side${j}Score`,q=`side${3-j}Score`;if(m.length&&(m.includes("p"),m=[]),V(j),P[z]===M&&P[z]-P[q]>=(E?1:2)&&(B(j),y))break}if(b(R.s)||st(R.setNumber)){let j=R.winningSide||R.s;if(B(j),m.length&&(m.includes("p"),m.includes("g"),m=[]),y)break}}return C!==a.length&&console.log({error:"Match completed with excess history"}),(P.side1Score||P.side2Score||P.games.length||P.side1TiebreakScore||P.side2TiebreakScore)&&p.sets.push(P),p.scoreStringSide1=xl({...p,matchUpFormat:o}),p.scoreStringSide2=xl({...p,matchUpFormat:o,reversed:!0}),g=h||g,n&&(r.score=p),{...Z,servingSide:g,score:p}}function Op({undoHistory:t,history:e,matchUp:i}){return _t({element:i,extension:{value:{history:e,undoHistory:t},name:xP}})}function QZ({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:Jx};let{history:i=[]}=Ap({matchUp:t});return i.push({srv:e}),Op({matchUp:t,history:i})}function eQ({matchUp:t}){return Op({matchUp:t})}function tQ({matchUp:t,point:e}){if(!e||!t)return{error:Je};if(typeof e!="object")return{error:se,context:{point:e}};let{history:i=[]}=Ap({matchUp:t});return i.push(e),Op({matchUp:t,history:i})}function iQ({matchUp:t,game:e}){if(typeof e!="object")return{error:se,context:{game:e}};let{history:i=[]}=Ap({matchUp:t});return i.push(e),Op({matchUp:t,history:i})}function rQ({matchUp:t,shot:e}){if(typeof e!="object")return{error:Je};let{history:i=[]}=Ap({matchUp:t});return i.push(e),Op({matchUp:t,history:i})}function nQ({matchUp:t,set:e}){if(typeof e!="object")return{error:Je};let{history:i=[]}=Ap({matchUp:t});return i.push(e),Op({matchUp:t,history:i})}function aQ({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Ap({matchUp:t});return i.length&&e.push(i.pop()),Op({matchUp:t,history:e,undoHistory:i})}function oQ({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Ap({matchUp:t});return i.push(e.pop()),Op({matchUp:t,history:e,undoHistory:i})}var sQ={},lQ={};bt(lQ,{keyValueScore:()=>kQ,parseMatchUpFormat:()=>Ln,stringifyMatchUpFormat:()=>yP,tidyScore:()=>_Q});var cm=" ",FM="DEF",DPe="COMPLETED",uQ="WO",PPe="WO/WO",cQ="ABN",dQ="SUS",pQ="RET",mQ="INT",hQ=[pQ,FM,uQ,PPe,cQ,dQ,mQ],LM="DEFAULTED",fQ="WALKOVER",gQ="ABANDONED",vQ="SUSPENDED",IQ="RETIRED",yQ="INTERRUPTED",RPe=[IQ,LM,fQ],CPe="Enter Score",Lm="()",np="[]",I_=["up","left","shift+tab"],y_=["enter","down","tab","right"],v0="backspace",bQ="r",wQ="s",UQ="a",SQ="d",TQ="w",DQ="i",mR=[bQ,SQ,TQ,UQ,wQ,DQ],hR="space",zC=["[","("],I0=[...I_,...y_,hR,"]"],PQ="-",EPe="/",dm=PQ,Fl=PQ,RQ=[EPe],MPe=0,NPe=["=","+","num_1","num_2","shift+=","shift+-"],b_=["0","1","2","3","4","5","6","7","8","9"].concat(mR),CQ=b_.map(t=>`shift+${t}`),EQ=[dm,v0].concat(I0,RQ),MQ=[b_,CQ,EQ].join(","),APe=[MQ,I_,y_,NPe].join(","),OPe={OUTCOMEKEYS:mR,SIDE1KEYS:b_,SIDE2KEYS:CQ,MODIFIERS:EQ,PROMPT:CPe,MOVEUP:I_,MOVEDOWN:y_,HOTKEYS:APe};function Xh({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=NQ({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==cm?cm:"";return t+r+i}else return i+cm+t}function NQ({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of hQ){let r=t==null?void 0:t.indexOf(i);r===0?t=t.slice(i.length+1).trim()+cm:r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function _M({analysis:t,scoreString:e,sets:i,lowSide:r}){var n,a,o;let s,l;if(!e)return{scoreString:e,sets:i};let{scoreString:u,removed:c}=NQ({scoreString:e});if(e=u,c)return{scoreString:e,sets:i,outcomeRemoved:!0};let d=i[i.length-1]||{},p=Object.values(d).filter(y=>y!==void 0).length;d.setNumber&&p===1&&(i=i.slice(0,i.length-1),d=i[i.length-1]||{});let{tiebreakSet:m}=t.setFormat,{tiebreakTo:h,NoAD:f}=m||{},{isTiebreakEntry:g}=bf({brackets:np,scoreString:e}),v=xPe(e);if(v>=0){s=e.slice(0,v);let{isTiebreakEntry:y}=bf({brackets:Lm,scoreString:s}),{lastOpenBracketIndex:I,isTiebreakEntry:b}=bf({brackets:np,scoreString:s}),S=s&&s[s.length-1].trim(),w=s&&!isNaN(S),U=t.isIncompleteSetScore;if(g&&b){let T=s.slice(I+1).split(Fl),D=(T==null?void 0:T.length)>0&&T[0]!==void 0&&!isNaN(parseInt(T[0]))&&parseInt(T[0])||void 0,P=(T==null?void 0:T.length)>1&&T[1]!==void 0&&parseInt(T[1])||void 0,C=[D,P];if(P){let R=r===1?1:0;C[R]=((C==null?void 0:C[1-R])||0)+(f?1:2),(C[R]||0)<h&&(C[R]=h),s=e.slice(0,I+1),s+=C.join(Fl)}else D!==void 0?(s=e.slice(0,I+1),s+=D):(s=e.slice(0,I),U=!0);d.side1TiebreakScore=C[0]||0,d.side2TiebreakScore=C[1]||0}if(s.length||(s=void 0),U){let T=(n=d.side1Score)==null?void 0:n.toString();if(T){let D=T==null?void 0:T.slice(0,T.length-1);d.side1Score=!isNaN(D)&&parseInt(D)||void 0,d.side1Score===void 0&&(d.side2Score=void 0)}t.isTimedSet?(l=d.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let T=(a=d.side2Score)==null?void 0:a.toString(),D=(o=d.side1Score)==null?void 0:o.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(d.side2Score){let P=T==null?void 0:T.slice(0,T.length-1);d.side2Score=!isNaN(P)&&parseInt(P)||void 0}else{let P=D==null?void 0:D.slice(0,D.length-1);d.side1Score=!isNaN(P)&&parseInt(P)||void 0}t.isTimedSet?d.side1Score?(l=i||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i||[],l[i.length-1]=d),l[l.length-1]&&Object.assign(l[l.length-1],{winningSide:void 0})}else y?(l=i||[],Object.assign(l[l.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(g&&!b?l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i,l[i.length-1]=d),g||(l[l.length-1].side2Score=0,l[l.length-1].winningSide=void 0));return{scoreString:s,sets:l}}return{scoreString:e,sets:i}}function bf({brackets:t=Lm,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...qs(i,n)),o=Math.max(...qs(r,n));return{isTiebreakEntry:a>o,lastOpenBracketIndex:a}}function kPe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=np.split(""),a=t.split(""),o=Math.max(...qs(r,a)),s=Math.max(...qs(n,a)),l=Math.max(...qs(Fl,a));return i&&o>s&&l>o}function xPe(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function AQ(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function x2({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){var n;let a=Ln(t),{bestOf:o}=a,s=Math.ceil(o/2),l=((n=r==null?void 0:r.reduce((u,c)=>{let{winningSide:d}=c;return d&&u[d-1]++,u},[0,0]))==null?void 0:n.indexOf(s))+1||void 0;return RPe.includes(e)&&i&&(l=i),{matchUpWinningSide:l}}function fR({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:o}){var s;if(!o)return{error:Je,info:"missing set"};e=e||i&&Ln(i);let l=n&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:u,side2Score:c}=o,{setTo:d,tiebreakAt:p}=l,m=u||c,h=gR({set:o}),f=Math.abs(u-c),g=u>=d||c>=d,v=r||u>=d&&c>=d||p&&p<d&&(u===p||c===p),y=t||v&&(h===1&&o.side1TiebreakScore>o.side2TiebreakScore||h===2&&o.side2TiebreakScore>o.side1TiebreakScore),I=!v&&l.NoAD||v||r&&(s=l.tiebreakFormat)!=null&&s.NoAD?1:2,b=f>=I;return!!((a&&m||g&&(b||v)||r)&&(!v||y))}function gR({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function w_({analysis:t,set:e}){let i=gR({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return fR({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function FPe({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];r=Qe(r);let{validSide2Score:o,requiresTiebreak:s}=LPe({analysis:t,set:a,value:r});if(o){n=!0,e=(e||"")+r,a.side2Score=r;let l=w_({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,s){let u=Lm.split("")[0];e+=u}else t.isDecidingSet||(e+=cm)}return{sets:i,scoreString:e,updated:n}}function LPe({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:o}=r,{side1Score:s}=e,l,u;return n&&n<a?s===n?l=i<=a:l=i<=n:s===a?o?l=i<a:l=i<=a+1:s===a-1?o?l=i<=a:l=i<=a+1:s===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?u=s===a&&i===n||s===n&&i===a:u=s>=a&&i>=a&&s!==i),{validSide2Score:l,requiresTiebreak:u}}function OQ({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let o;return e===bQ?r?(o=!0,r=Xh({scoreString:r,lowSide:t,outcome:pQ}),n=t===2?1:2,a=IQ):(o=!0,r=Xh({scoreString:r,lowSide:t,outcome:FM}),n=t===2?1:2,a=LM):e===SQ?(o=!0,r=Xh({scoreString:r,lowSide:t,outcome:FM}),n=t===2?1:2,a=LM):e===TQ?(o=!0,i=[],r=uQ,n=t===2?1:2,a=fQ):e===wQ&&r?(o=!0,r=Xh({scoreString:r,lowSide:t,outcome:dQ}),a=vQ,n=void 0):e===UQ?(o=!0,r=Xh({scoreString:r,lowSide:t,outcome:cQ}),a=gQ,n=void 0):e===DQ&&r&&(o=!0,r=Xh({scoreString:r,lowSide:t,outcome:mQ}),a=yQ,n=void 0),{updated:o,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function _Pe(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:o,lowSide:s,value:l}=t,u,c;!(e!=null&&e.length)&&l!==v0&&(e=[{setNumber:1}]);let d=e.length-1;if(mR.includes(l)){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;m&&!h?i="missing side2Score":o.finalSetIsComplete||n?i="final set is already complete":o.isIncompleteSetScore?i="incomplete set scoreString":o.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:u}=OQ({lowSide:s,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===v0){if({scoreString:r,sets:e,outcomeRemoved:c}=_M({analysis:o,scoreString:r,sets:e}),(r==null?void 0:r.trim())===""&&(r=r.trim()),r||(e=[]),c){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;if(m&&h){let f=m>h&&1||h>m&&2||void 0;f&&(p.winningSide=f,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,u=!0}else if(o.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===hR){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p,f=m>h&&1||h>m&&2||void 0;f&&!n&&!o.isIncompleteSetScore&&(e[e.length-1].winningSide=f,e.push({setNumber:e.length+1}),r+=" ",u=!0)}else if(l===dm&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&o.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let m=Qe((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=Qe(m),p=e[d].side1Score.toString(),u=!0}else{let m=Qe((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=Qe(m),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let m=(e.slice(0,d)||[]).filter(h=>h).map(h=>{let{side1Score:f,side2Score:g}=h;return[f,g].join("-")}).join(" ");m?r=m+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:u}}function $Pe({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){var o;let s,l,{tiebreakSet:{tiebreakTo:u,NoAD:c}}=t.setFormat,[d]=np.split("");if(t.isMatchTiebreakEntry||(r+=d),n[t.setNumber-1]){let{lastOpenBracketIndex:p}=bf({brackets:np,scoreString:r}),m=(r.slice((p??0)+1)+(e?"":a)).split(Fl);if((((o=m[i-1])==null?void 0:o.length)||0)>=2)l="tiebreak digit limit";else if(e){i===1&&(m[0]=(m[0]||"")+a),i===2&&(m[1]=(m[1]||"")+a);let h=[m[0]||0,m[1]||0].map(v=>Qe(v)),f=i===1?1:0;h[f]=h[1-f]+(c?1:2),h[f]<u&&(h[f]=u);let g=n[n.length-1];g.side1TiebreakScore=h[0],g.side2TiebreakScore=h[1],r=r.slice(0,(p??0)+1),r+=h.join(Fl),s=!0}else{let h=[m[0]||0,m[1]||0].map(g=>Qe(g)),f=n[n.length-1];f.side1TiebreakScore=h[0],f.side2TiebreakScore=h[1],r+=a,s=!0}}else{let p=AQ({lowValue:Qe(a||0),tiebreakTo:u,NoAD:c}),m=[Qe(a),p];i===2&&m.reverse();let h={side1TiebreakScore:m[0],side2TiebreakScore:m[1],setNumber:(n==null?void 0:n.length)+1||1};n.push(h),r+=m.join(Fl),s=!0}return{info:l,scoreString:r,sets:n,updated:s}}function BPe({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:o}=(t==null?void 0:t.setFormat)||{},s=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(o&&r===n||r>n)return{scoreString:i};let l=h(),u=[r,l];e===2&&u.reverse();let c=Lm.split("")[0],d=u.join(dm)+(s?c:cm);i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},m=w_({analysis:t,set:p});return p.winningSide=m||void 0,{scoreString:i,set:p};function h(){return s?r+1:r+1===n?r+(o?1:2):n}}function VPe({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){var a,o,s;let l=(((a=n==null?void 0:n.filter(_=>_==null?void 0:_.winningSide))==null?void 0:a.length)||0)+(i?0:1),u=Ln(t),c=l===(u==null?void 0:u.bestOf),d=c&&(u==null?void 0:u.finalSetFormat)||(u==null?void 0:u.setFormat)||{},p=d==null?void 0:d.timed,m=c&&n[(u==null?void 0:u.bestOf)-1],h=m==null?void 0:m.winningSide,{isTiebreakEntry:f}=bf({brackets:Lm,scoreString:e}),{isTiebreakEntry:g}=bf({brackets:np,scoreString:e}),v=f||g,y=!!d.tiebreakSet,I=(o=e==null?void 0:e[e.length-1])==null?void 0:o.trim(),b=e&&!isNaN(I),S=!v&&I===dm,w=f&&zC.includes(I),U=g&&zC.includes(I),T=g&&I===Fl,D=e==null?void 0:e.split(""),[P]=np.split(""),C=D&&Math.max(...qs(P,D)),R=D&&Math.max(...qs(Fl,D)),N=D&&R>C,A=(s=n[n.length-1])==null?void 0:s.winningSide,M=(n==null?void 0:n.length)&&!A,E=hQ.find(_=>(e==null?void 0:e.indexOf(_))>=0),O=!isNaN(r),k=r===hR,x=I0.includes(r),F=e==null?void 0:e.split("").find(_=>zC.includes(_)),$=x&&g&&!U&&(T||!kPe({scoreString:e}));return{isTiebreakSetValue:y&&O,matchUpScoringFormat:u,setNumber:l,setFormat:d,matchTiebreakHasJoiner:N,isGameScoreEntry:M,isSpace:k,isCloser:x,isTiebreakCloser:x&&F&&v&&b,isDecidingSet:c,isTiebreakSet:y,isTimedSet:p,isNumericEnding:b,isNumericValue:O,hasOpener:F,hasOutcome:E,finalSet:m,finalSetIsComplete:h,lastSetIsComplete:A,isInvalidSetTiebreakValue:k&&v&&w,isInvalidMatchTiebreakValue:$,isTiebreakEntry:v,isSetTiebreakEntry:f,isMatchTiebreakEntry:g,isIncompleteSetScore:S,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:U,isPartialMatchTiebreakValue:T}}function kQ(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:o}=t,{matchUpFormat:s,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!MQ.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:m}=x2({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=m;let h=VPe({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:s});if(RQ.includes(i)&&(i=dm),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&p&&Qe(i)===0&&(h.isTiebreakCloser=!0),I0.includes(i)&&h.hasOpener&&(i=""),I0.includes(i)&&(i=hR),h.lastSetIsComplete){let f=(r==null?void 0:r.length)&&r[r.length-1];r&&f!==" "&&(r+=" ")}if(h.isTimedSet)({info:d,sets:n,scoreString:r,updated:c,matchUpStatus:o,winningSide:a}=_Pe({analysis:h,lowSide:e,scoreString:r,sets:n,matchUpStatus:o,winningSide:a,value:i}));else if(mR.includes(i))h.finalSetIsComplete||a?d="final set is already complete":!h.isTiebreakEntry&&!h.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:o,winningSide:a,updated:c}=OQ({lowSide:e,sets:n,scoreString:r,matchUpStatus:o,winningSide:a,value:i}):h.isTiebreakEntry||h.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===v0)c=!0,{scoreString:r,sets:n}=_M({analysis:h,scoreString:r,sets:n,lowSide:e}),r||(n=[]),o=void 0,a=void 0;else if(h.hasOutcome)d="has outcome";else if(i===dm&&!h.isMatchTiebreakEntry)(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(c=!0,{scoreString:r,sets:n}=_M({analysis:h,scoreString:r,sets:n,lowSide:e}),o=void 0);else if(i===Fl&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?d="existing joiner":h.isNumericEnding&&(c=!0,r+=Fl);else if([dm,Fl].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:n,scoreString:r,updated:c}=FPe({analysis:h,scoreString:r,sets:n,value:i}));else if(h.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(h.isTiebreakCloser){let f=h.isSetTiebreakEntry?Lm:np,g=f.split("").reverse()[0],v=f.split("")[0],y=n[n.length-1],{tiebreakFormat:I}=h.setFormat,{tiebreakTo:b,NoAD:S}=I||{},w=gR({set:y});if(!h.isTiebreakSet){let T=parseInt(r.split(v).reverse()[0]),D=AQ({lowValue:T,tiebreakTo:b,NoAD:S});w===1?(y.side1TiebreakScore=D,y.side2TiebreakScore=T):(y.side1TiebreakScore=T,y.side2TiebreakScore=D)}r=(r||"")+g,h.isDecidingSet||(r+=cm);let U=w_({analysis:h,set:y});y.winningSide=U||void 0,c=!0}else if(h.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:c}=$Pe({analysis:h,auto:u,lowSide:e,scoreString:r,sets:n,value:i}));else if(h.isSetTiebreakEntry){let[f]=Lm.split(""),g=Math.max(...qs(f,r.split(""))),v=r.slice(g+1),y=v&&Qe(v)===MPe,I=Qe(v?v+i:i),{tiebreakFormat:b}=h.setFormat,{tiebreakTo:S,NoAD:w}=b||{};!y&&v.length<2?w&&I>S-1?d="invalid low value for NoAD tiebreak":(c=!0,r=(r||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)d=`invalid key: ${i}`;else if(h.isGameScoreEntry)d="game scoreString entry";else if(h.lastSetIsComplete||!n.length){c=!0;let{scoreString:f,set:g}=BPe({analysis:h,lowSide:e,scoreString:r,value:Qe(i)});g&&(g.setNumber=(n==null?void 0:n.length)+1||1),n=(n==null?void 0:n.concat(g).filter(Boolean))||[g],r=f||void 0}else console.log("error: unknown outcome")}if(c){n=n==null?void 0:n.filter(Boolean);let{matchUpWinningSide:f}=x2({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=f,f&&(!o||[Zi,Ea].includes(o))?(o=DPe,n=n.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:I,side2TiebreakScore:b}=g;return v||y||I||b})):r&&!a&&![vQ,gQ,yQ].includes(o)&&(o=void 0),{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}return{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}var vR="\\d+-\\d+",hy="\\d+-\\d+\\(\\d+\\)",U_="\\[\\d+-\\d+\\]",jPe="\\d+-\\d+\\(\\d+-\\d+\\)",GPe=new RegExp(`(${vR}),`,"g"),HPe=new RegExp(`(${hy}),`,"g"),zPe=[vR,hy,U_,jPe],WPe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],qPe=WPe.map(t=>{let e=t.split("").map(i=>zPe[i]).join(" ");return new RegExp(`^${e}$`)});function F2(t){return!t||qPe.some(e=>e.test(t))}function YPe(t){let e="[];",i="()",r=e+i,n=[e[0],i[0]],a=Object.assign({},...r.split("").map(l=>({[l]:0}))),o="",s=t.split("").map(l=>{let u=r.includes(l)&&l,c=n.includes(u);if(c&&u)return a[u]+=1,o=u,l;if(!c&&u&&o&&u!==o){a[o]-=1;let d=e.includes(o)&&e||i.includes(o)&&i||"",p=d.split("").find(m=>m!==o);if(d.includes(u))a[o]||(o="");else return a[u]||(o=""),p}return l}).join("");return t!==s?s:t}function aS(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function KPe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function hg(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function y0(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function L2(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function XPe(t){return t.startsWith("(")&&t.endsWith(")")}function JPe({score:t,applied:e}){t=YPe(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let U=w.replace(")",") ");t=t.replace(w,U)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let w of a||[]){let[U]=w.match(n).slice(1),T=U.replace(/ /g,"");t=t.replace(w,`(${T})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(U,T)})}if(o=/\(\((\d)\)\)/g,o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(U,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(w=>{let U=new RegExp(`(\\d+)${w}(\\d+)`,"g"),T=t.match(U);T&&T.forEach(D=>t=t.replace(D,D.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[U]=w.match(/\((\d+), \)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"&&(t=t.replace(w,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(w=>{let[U]=w.match(/\((\d+)\/\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${U})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(w=>{let[U]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${U},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[U]=w.match(/\(\/(\d+)\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&parseInt(U)<6?t=t.replace(w,`(6-${U})`):t=t.replace(w,`(${U})`)});let p,m,h,f,g,v=()=>{g=Pa(t.split("")),m=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],h=g["["]===g["]"]+1,f=m&&!h};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(XPe)?t=w.map(U=>{let T=U.slice(1,U.length-1);return T.length>2?T:U}).join(" "):t=w.join(" ")}v();let I=/[A-Za-z]+/.test(t),b=/\d+/.test(t);if(!I&&!b)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],U=0;for(let T of t.split("").reverse())T===")"&&(U?w.push("("):U+=1),T==="("&&(U-=1),w.push(T);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),f&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),f&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),f){let w="",U=0;for(let T of t.split(""))T==="("&&(U?w+=")":U+=1),T===")"&&(U-=1),w+=T;t=w}v(),h&&!m&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let S=w=>{let U=w.indexOf("("),T=w.indexOf(")");return U>=0&&T>=0&&U<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);S(w)&&(t=w,v())}return{score:t,applied:e}}function IR(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=qs("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,o)=>o%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function ZPe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[GPe,HPe].forEach(i=>{let r=t.match(i);r!=null&&r.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(IR).join(" "),{score:t,applied:e}}function QPe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let m=/^-(\d+)$/;if(m.test(p)){let[h]=p.match(m).slice(1);if(h.length===2)return h.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(aS),a=0,o="";for(let p of n){let m=qs(p,r).filter(v=>!a||v>a)[0],h=r.slice(a,m-1),f=r[m-1],g=e(f);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((I,b)=>+I-+b));if(y===1){let I=[h.join(" "),[f,p].join("")].join(" ");o+=I,a=m+1}else if(y===0){let I=Math.max(...v);if([4,5,6,7,8,9].includes(I)){let b=[6,4].includes(I)?I+1:I-1,S=[I,b].sort().reverse().join("-"),w=[h.join(" "),[S,p].join("")].join(" ");o+=w,a=m+1}}}}if(n.length&&o.length){let p=r.slice(a).join(" ");return o=[o,p].join(" "),{score:o.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((m,h)=>+m-+h,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let s=r.map(p=>KPe(p)&&"bracket"||hg(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,m="";return r.forEach((h,f)=>{s[f]==="bracket"&&p==="set"?(h=i(h),m+=h):m+=` ${h}`,p=s[f]}),{score:m.trim()}}r=t.split(" ");let l,u=r.map(p=>{let m=new RegExp(/^(\d+)-(\d+)$/);if(m.test(p)){let[h,f]=p.match(m).slice(1),g=Math.abs([h,f].reduce((y,I)=>+y-+I)),v=Math.max(h,f);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=qs("tiebreak",u);if(c.length){let p="";r.forEach((m,h)=>{c.includes(h)?p+=`(${m}) `:c.includes(h+1)?p+=`${m}`:p+=`${m} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,m,h]=t.match(d).slice(1),f=Math.max(m,h)>=10;!hg(p)&&f&&(t=t.replace(d,`${p} [${m}-${h}]`))}return u=[],t=t.split(" ").map(p=>{let m=/^\((.*)\)$/,h=m.test(p),f=new RegExp(U_).test(p)&&"super"||new RegExp(hy).test(p)&&"tiebreak"||new RegExp(vR).test(p)&&"standard"||"unknown";return u.push(f),f==="standard"&&h?p.match(m)[1]:p}).join(" "),{score:t}}function eRe({score:t,applied:e}){for(let T of[".",","," ","/"]){let D=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(D.test(t)){let P=t.match(D).slice(1).map(R=>parseInt(R)),C=Math.abs(P[0]-P[1]);C<=10&&C>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,D,P,C,R,N]=t.match(i).slice(1);t=t.replace(i,`${T}${D}-${P} ${C}-${R}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let o=IR(t);o!==t&&(t=o,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[T,D,P]=t.match(s).slice(1),[C,R]=D.split("");t=`${T}-${C} ${R}-${P}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[T,D]=t.match(u).slice(1),P=T.trim(),C=D.trim();if(l.test(P)&&l.test(C)){let R=P.match(l).slice(1,3).join("-"),N=C.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[T,D]=t.match(c).slice(1),P=T.trim(),C=D.trim();if(l.test(P)&&l.test(C)){let R=P.match(l).slice(1,3).join("-"),N=C.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("singleSetCommaSeparationPattern")}let p=0,m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(t)&&p<3;){let[T,D,P]=t.match(m).slice(1),C=D.split(""),R=`${T}-${C[0]} ${C[1]}-${P}`;t=t.replace(m,R),e.push("noSetSeparationPattern"),p+=1}let h=/(^|\s)7-6\s(\d+)\s/g,f=t.match(h);if(f!=null&&f.length){let T=/(^|\s)7-6\s(\d+)\s/;f.forEach(D=>{let P=D.match(T).slice(2)[0];t=t.replace(D,`7-6(${P}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(T=>{let D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(T=>{let D=" "+T.slice(1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let T=t.match(v)[0],D=T.split("/").map(P=>`(${P})`).join(" ")+" ";t=t.replace(T,D),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let I=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(I.test(t)){let T=t.match(I),D=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),P=t;T.forEach(C=>{let[R,N]=C.match(D).slice(1),A=`${R}-${N}`;P=P.replace(C,A)}),t=P,e.push("slashSetPattern")}let b=/(.*)\s(1\d)\s(\d+)$/;if(b.test(t)){let[T,D,P]=t.match(b).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${D}${P}`,e.push("spaceSeparatedSuperPattern"))}let S=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(S)||[]){let[D,P,C,R]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,A]=P.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${D}${P}(${C})${R}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(w)||[]){let D=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[P,C,R]=T.match(D).slice(1),[N,A]=P.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${P}(${C})${R}`),e.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let T of t.match(U)||[]){let D=/(^|\s)(\d \d)\(/,[P,C]=T.match(D).slice(1);t=t.replace(T,`${P}${C.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function tRe({score:t,matchUpStatus:e}){var i;let r=t==null?void 0:t.split(" ");t=r.map(l=>{if(l.endsWith("]")){let u=l.split("[");if(hg(u[0]))return u[0]+`(${u[1].slice(0,u[1].length-1)})`}return l}).join(" ");let n=new RegExp(/(\([\d ]+\))/g);if(n.test(t))for(let l of t.match(n)){let u=(i=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:i[1];if(_i(u)&&(u==null?void 0:u[0])>2){if([2,4].includes(u.length))u=u.split("").join("-");else if(u.length===3){let c=u.indexOf("1");u=y0(u.split(""),c)}}t=t.replace(l,`(${u})`)}r=t==null?void 0:t.split(" ");let a=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),o=r.length-1;t=r.map((l,u)=>{let c=[void 0,"","COMPLETED"].includes(e)||u!==o;if(a.test(l)&&c){let[d,p,m]=Array.from(l.match(a)).slice(1),h=Math.min(p,m);return`${d}(${h})`}return l}).join(" "),r=t==null?void 0:t.split(" "),a=new RegExp(/^(\d{2})\((\d+)\)$/),t=r.map(l=>{if(a.test(l)){let[u,c]=Array.from(l.match(a)).slice(1),d=u.split("");return`${d[0]}-${d[1]}(${c})`}return l}).join(" "),r=t==null?void 0:t.split(" "),a=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=r.map(l=>{if(a.test(l)){let[u,c]=Array.from(l.match(a)).slice(1);return hg(u)?`${u}(${c})`:u}return l}).join(" "),r=t==null?void 0:t.split(" "),a=new RegExp(/^1-0\((\d+)\)$/),t=r.map(l=>{if(a.test(l)){let[u]=l.match(a).slice(1);return`[${u<9?10:parseInt(u)+2}-${u}]`}return l}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let l=t.match(s)[1];t=t.replace(s,`(${l}) `)}return{score:t}}function iRe({score:t,attributes:e,identifier:i}){var r,n,a;if(typeof t!="string")return{score:t,identifier:i};let o=new RegExp(/\([\d,/ ]+\)/g),s=t.match(o);for(let m of s||[]){let h=(n=(r=m.match(/^\((.*)\)$/))==null?void 0:r.slice(1))==null?void 0:n[0],f=t.split(m)[0].split(")").reverse()[0].replace(/\D/g,"");if((h==null?void 0:h.length)===2&&(f==null?void 0:f.length)>=2){let y=f.slice(f.length-2).split("").map(I=>parseInt(I));if(Math.abs(y[0]-y[1])===1)continue}let g=L2(h),v=IR(g);t=t.replace(m,`(${v})`).trim()}let l=new RegExp(/\[[\d,/ ]+\]/g);(a=t.match(l))==null||a.forEach(m=>{let h=L2(m.match(/^\[(.*)\]$/)[1]);t=t.replace(m,`(${h}) `).trim()});let u=[")","]"],c=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&u.some(m=>t.endsWith(m))&&c.some(m=>t.includes(m))){let m="",h=t.split(/[)\]]/).filter(Boolean).map(I=>(I.startsWith(",")&&(I=I.slice(1)),I.trim())),f=h.every(I=>I.includes(",")||aS(I)),g=h.every(I=>I.includes("/")||aS(I)),v=h.every(I=>I.includes("-")||aS(I)),y=f&&","||v&&"-"||g&&"/";if(y){let I;h.forEach(b=>{if(b.startsWith("("))if(I==="set"&&(m+=" "),b.includes(y))m+=b.slice(1).split(y).map(S=>S.trim()).join("-"),I="set";else{let S=b.slice(1);m+=`(${S}) `,I="tiebreak"}else if(b.startsWith("[")){let S=b.slice(1).split(y).map(U=>parseInt(U.trim())),w=Math.min(...S);I==="set"?m+=`(${w}) `:m+=`[${S.join("-")}] `,I="tiebreak"}}),t=m.trim()}}let d=Pa(t.split(""));d["("]===1&&d[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),d["-"]===1&&hg(t)&&_i(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let p=/\(\)/g;return p.test(t)&&(t=t.replace(p,"").trim()),{score:t}}function xQ({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let s=`${r[0]}-${r[1]}`;return r[2]&&(s+=` (${r[2]})`),n(),r.push(r),s};n();let o=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let s=e.shift(),l=_i(s)&&parseInt(s),u=r[0]!==void 0&&r[1]!==void 0;if(_i(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,o())){i.push(a()),r=[void 0,void 0];continue}if(u&&e.length===1&&_i(e[0])){let c=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=c,i.push(a()),r=[void 0,void 0]}u&&o()}}return{sets:i}}function $M(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=y0(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=y0(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function FQ(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e==null?void 0:e.toString().split(""),a=n==null?void 0:n.every(s=>_i(s)),o=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let s=a?n.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(xQ({score:e}),s.length,e.length===3&&o(s.slice(0,2))===1){let[l,u,c]=s;e=`${l}-${u}(${c})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,u,c]=s;e=`[${l}${u}-${c}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&o(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,u,c,d]=s,p=Math.min(c,d);e=`${l}-${u}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,u,c,d]=s;e=`[${l}${u}-${c}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,u,c,d]=s;e=`${l}${u} ${c}${d}`,i.push("split4")}else if(e.length===5&&o(s.slice(0,2))===1){let[l,u,c,d,p]=s;e=`${l}-${u}(${c}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&o(s.slice(3))===1){let[l,u,c,d,p]=s;e=`${l}-${u} ${c}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&s[4]===1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d} [${p}${m}-${h}]`,i.push("numericTiebreakPattern6")}else if(o(s.slice(0,2))===1&&o(s.slice(3,5))>1&&o(s.slice(5,7))>1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u}(${c}) ${d}-${p} ${m}-${h}`,i.push("numericTiebreakPattern7")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))===1&&o(s.slice(5,7))>1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d}(${p}) ${m}-${h}`,i.push("numericTiebreakPattern8")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&o(s.slice(4,6))===1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d} ${p}-${m}(${h})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=$M(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=Cr(e.split(""),2).map(g=>g.join("")),u=l.map(g=>{let[v,y]=g.split("").map(S=>parseInt(S)),I=Math.abs(v-y),b=v>y?1:2;return I>1&&b||b*-1}),c=u.reduce((g,v)=>g>0&&v>0,1),d=Pa(u),p=u.map(g=>Math.abs(g)),m=Pa(p),h=u[0]<0,f=!h&&u[1]<0;if(u[0]>0&&u[1]>0&&u[0]!==u[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(c)e=l.join(" "),i.push("chunkSplit");else if(s.length===6){if(d[1]===2||d[2]===2)if(!Object.values(m).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,I,b,S]=s,w=u.reduce((U,T,D)=>T<0?D:U,void 0);if(w===0){let U=Math.min(y,I);e=`${g}-${v}(${U}) ${b}-${S}`,i.push("chunkSplitTiebreak1")}else if(w===1){let U=Math.min(b,S);e=`${g}-${v} ${y}-${I}(${U})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${I}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,y,I,b,S,w,U]=s;h||f?s[5]===1&&(h?e=`${g}-${v}(${y}) ${I}-${b} [${S}${w}-${U}]`:e=`${g}-${v} ${y}-${I}(${b}) [${S}${w}-${U}]`):(u[0],u[1])}}}return{score:e,applied:i,matchUpStatus:r}}function LQ(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let u=l.match(n).slice(1).map(d=>parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,o=e[0]>0&&e[0]===e[1],s=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}function rRe({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),o=a.length;t=a.map((c,d)=>{if(new RegExp(hy).test(c)){let m=c.slice(3),h=c.slice(0,3),f=h.split("-");if(!hg(h)&&!e){let g=Math.max(...f),v=h.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+m}}else if(c.length===2&&_i(c))return c.split("").join("-");c=IR(c);let p=new RegExp(`^${U_}$`).test(c)&&"super"||new RegExp(`^${hy}$`).test(c)&&"tiebreak"||new RegExp(`^${vR}$`).test(c)&&"standard"||"unknown";if(r.push(p),o>1&&p==="standard"&&d<2){let[m,h]=c.split("-"),f=Math.abs(parseInt(m)-parseInt(h)),g=Math.max(m,h),v=Math.min(m,h),y=[parseInt(m),parseInt(h)].indexOf(v);if(g>9&&f>2){let I=g.toString().split(""),b=I.find(S=>parseInt(S)>v||d&&parseInt(S)<=n)??I[0];b&&(c=y?[b,v].join("-"):[v,b].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[m,h]=c.split("-");if(!Math.abs(parseInt(m)-parseInt(h))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:u}=LQ(t);if(u===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function nRe({score:t}){let{setsTied:e,winningSide:i}=LQ(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let s=t.match(r).slice(1)[0],l=s<=8?10:s+2;t=t.replace(r,` [${l}-${s}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(s=>_i(s)))return{score:t};if(o[0]==="76"){let s=o[1].length===2?Math.min(...o[1].split("").map(l=>parseInt(l))):o[1];t=[...n.slice(0,n.length-1),`7-6(${s})`].join(" ")}else{o=o.map(u=>parseInt(u));let s=Math.max(...o),l=Math.abs(o[0]-o[1]);if(s>=10){if(l>2&&o.every(u=>+u>=10)){let u=o.map(c=>c===s?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(o=u)}t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" ")}else n.length===3&&s>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" "))}return{score:t}}function aRe({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function oRe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function sRe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=y0(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=FQ({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function lRe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&$M(t)?{score:$M(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function uRe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function cRe({score:t,profile:e,applied:i}){var r;t=t==null?void 0:t.toString().toLowerCase();let n=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(n.test(t)){let[s]=t.match(n).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let a=(r=e==null?void 0:e.matchUpStatuses)==null?void 0:r.retired,o=["rtd",...Array.isArray(a)?a:[a].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return o?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(o,"").trim(),applied:i}):{score:t}}function dRe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function pRe({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function mRe({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function hRe({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function fRe({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[o,s]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${o}-${s}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>_i(i))&&e.length===4&&(t=e)}return{score:t}}function gRe({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var vRe={handleTiebreakSlashSeparation:hRe,handleSetSlashSeparation:pRe,punctuationAdjustments:JPe,handleGameSeparation:mRe,joinFloatingTiebreak:QPe,handleBracketSpacing:ZPe,handleSpaceSeparator:fRe,separateScoreBlocks:sRe,matchKnownPatterns:eRe,removeDanglingBits:dRe,removeErroneous:lRe,handleWalkover:uRe,properTiebreak:tRe,handleNumeric:FQ,handleRetired:cRe,containedSets:iRe,sensibleSets:rRe,stringScore:aRe,superSquare:nRe,setBuilder:xQ,excisions:gRe,replaceOh:oRe},WC={},IRe=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],yRe=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function _Q(t){if(!t.score)return{error:se};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:o,profile:s}=t,l=[],u,c=[],d,p,m=e,h=g=>{g.forEach(v=>{p=vRe[v]({profile:s,identifier:r,matchUpStatus:u,attributes:d,applied:c,score:m});let y=p.score!==m;y&&l.push({method:v,score:p.score}),a&&(o||y||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},v),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),m=p.score})};h(IRe);let f=F2(m);return f||(m=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),h(yRe),f=F2(m),f||(m="")),c.forEach(g=>{WC[g]||(WC[g]=0),WC[g]+=1}),{matchUpStatus:u==null?void 0:u.toUpperCase(),modifications:l,attributes:d,isValid:f,score:m}}var $Q={};bt($Q,{analyzeScore:()=>S_,analyzeSet:()=>fy,checkScoreHasValue:()=>yr,checkSetIsComplete:()=>fR,getSetComplement:()=>D_,getTiebreakComplement:()=>yR,isValidMatchUpFormat:()=>Ra,parseScoreString:()=>b0,validateScore:()=>T_,validateTieFormat:()=>qn});function S_({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){var a,o;let s=(n==null?void 0:n.sets)??[],l=((s==null?void 0:s.filter(U=>U==null?void 0:U.winningSide))||[]).reduce((U,T)=>{let{winningSide:D}=T;if(!D)return U;let P=D-1;return U[P]++,U},[0,0]),u=r?r-1:void 0,c=u!==void 0?1-u:void 0,d=u!==void 0&&l[u],p=c!==void 0&&l[c],m=e?Ln(e):void 0,h=Math.max(...l),f=Pa(l)[h],g=((a=m==null?void 0:m.setFormat)==null?void 0:a.timed)||((o=m==null?void 0:m.finalSetFormat)==null?void 0:o.timed),v=m==null?void 0:m.bestOf,y=v&&Math.ceil(v/2)||1,I=i??t,b=I&&[Pt,Hr,Ft].includes(I),S=!m||!s.length||s.every((U,T)=>{let D=T+1,P=D===v,C=D===s.length,{side1Score:R,side2Score:N,side1TiebreakScore:A,side2TiebreakScore:M,winningSide:E}=U,O=Math.max(R??0,N??0),k=A??M,{finalSetFormat:x,setFormat:F}=m,$=P&&x||F;if(k){let{tiebreakTo:_,NoAD:L}=($==null?void 0:$.tiebreakFormat)||{},B=Math.max(A??0,M??0);if(L&&B>_||B<_&&E&&(C&&!b||!C))return!1}return $.setTo?!(!$.noTiebreak&&O>$.setTo+1):!0}),w=(!e||h===y)&&f===1&&l.indexOf(h)+1||void 0;return{valid:!!(S&&(r&&d>p&&r===w||r&&b||!r&&!w&&(![Ki,Pt,Hr,Ft].includes(I)||g&&I===Ki)))}}function T_({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:se};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=n,l="scoreString must be a string!";if(o!==void 0&&typeof o!="string")return{error:se,info:l};if(s!==void 0&&typeof s!="string")return{error:se,info:l};if(a!==void 0&&!Array.isArray(a))return{error:se,info:tp("sets")};if(a!=null&&a.length){let u=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(u.length!==dt(u).length)return{error:se,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:m,side1TiebreakScore:h,side2TiebreakScore:f,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:I}=d;if(![[p,m],[h,f],[g,v]].filter(b=>b.some(S=>![void 0,null].includes(S))).every(b=>b.every(S=>st(S))))return{error:se,info:"non-numeric values"};if(![I,y].filter(b=>![void 0,null].includes(b)).every(b=>st(b)))return{error:se,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:se,info:"winningSide must be 1 or 2"}}let{valid:c}=S_({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!c)return{error:QK,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var D_=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let o=Qe(i);(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),n&&n<r&&o>n&&(o=n);let s;return a&&!n?(o>r&&(s=r),s=o<r?r:r-1):s=o+1<r&&r||n&&n<r&&o===n&&r||!n&&o+2||r+1,[e?o:s,e?s:o]},yR=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let o=bRe({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:o,e?o:a]};function bRe(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function b0({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((r,n)=>i({set:r,setNumber:n+1}));function i({set:r,setNumber:n}){let a=/\(([^)]+)\)/,o=/\[([^)]+)\]/,s=a.exec(r),l=o.exec(r),u=(r==null?void 0:r.startsWith("["))&&l&&l[1].split("-").map(I=>parseInt(I)),c=s&&r.replace(s[0],"")||l&&r.replace(l[0],"")||r,d=!u&&c.split("-").map(I=>parseInt(I)),p=u?u[0]>u[1]&&1||u[0]<u[1]&&2||void 0:d[0]>d[1]&&1||d[0]<d[1]&&2||void 0,m=s?s[1]:void 0,h=(m&&yR({lowValue:m,isSide1:p===2,tiebreakTo:t}))??[],[f,g]=d||[],[v,y]=u||h||[];return{side1Score:f,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:y,winningSide:p,setNumber:n}}}function wRe({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=gR({set:n});return fR({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function fy(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:nP};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},o=n||a,s=!!(r&&o&&r===o),l=s&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),u=!!(l!=null&&l.tiebreakSet),c=!!(l!=null&&l.timed),d=!u&&!c,p=!!(r&&o&&r<=o),m=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],h=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],f=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],g=m.filter(k=>k!==void 0).length,v=h.filter(k=>k!==void 0).length,y=f.filter(k=>k!==void 0).length,I=m==null?void 0:m.filter(k=>!isNaN(k)).length,b=f==null?void 0:f.filter(k=>!isNaN(k)).length,{tiebreakAt:S}=l||{},w=S&&m.filter(k=>k>=S).length===2,U=w&&(m[0]>m[1]&&1||m[1]>m[0]&&2||void 0),T=!!(b&&!I),D=!!(e!=null&&e.winningSide),{error:P,result:C}=URe({sideTiebreakScores:f,sideGameScores:m,setFormat:l,setObject:e}),{error:R,result:N}=SRe({sideTiebreakScores:f,setObject:e,setFormat:l}),A=d&&!T&&C||u&&T&&N||c,M=p&&!(u&&!T)&&!(d&&T)&&(!D||A),E=wRe({isTimedSet:c,matchUpScoringFormat:i,isDecidingSet:s,isTiebreakSet:T,setObject:e}),O={expectTiebreakSet:u,expectTimedSet:c,hasTiebreakCondition:w,isCompletedSet:D,isDecidingSet:s,isTiebreakSet:T,isValidSet:M,isValidSetNumber:p,isValidSetOutcome:A,leadingSide:U,setFormat:l,sideGameScores:m,sideGameScoresCount:g,sidePointScores:h,sidePointScoresCount:v,sideTiebreakScores:f,sideTiebreakScoresCount:y,winningSide:E};return(e==null?void 0:e.winningSide)!==void 0&&(T?(O.isValidTiebreakSetOutcome=N,N||(O.tiebreakSetError=R)):(O.isValidStandardSetOutcome=C,C||(O.standardSetError=P))),O}function URe({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:nP};let n=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||n||a)return{result:!1,error:se};if((i==null?void 0:i.filter(U=>!isNaN(U)).length)!==2)return{result:!1,error:iM};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:u}=e||{};if(!(o&&i!=null&&i.find(U=>U>=o)))return{result:!1,error:iM};let c=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!c)return{result:!1,error:aP};let d=(t==null?void 0:t.winningSide)-1,p=1-d,m=i[d],h=i[p],f=m-h;if(!(m>h))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(r==null?void 0:r.filter(U=>!isNaN(U)).length)===2,y=r==null?void 0:r[d],I=r==null?void 0:r[p],b=s&&i.filter(U=>U>=s).length===2;if(g){let{NoAD:U,tiebreakTo:T}=l;if(b){if(f>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&r!=null&&r.find(N=>N>=T)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let D=s<o?o:o+1;if(m>D)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!I||y<I)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let P=U?1:2,C=y-I,R=I>=T-1;if(C&&R&&C<P)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(m>o&&!b)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let S=u?1:2,w=h>=o-1;return f&&w&&!b&&f<S?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:f>S&&m>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function SRe({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:nP};let r=!!(e!=null&&e.tiebreakSet),n=!!(e!=null&&e.timed);if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:aP};let{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:l}=o||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=(t==null?void 0:t.winningSide)-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let m=s?1:2,h=d-p,f=p>=l-1;return h&&f&&h<m?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}function TRe(t){var e,i,r;let{existingDrawDefinition:n,hydrateCollections:a,enforceGender:o,tieFormatName:s,matchUpType:l,eventType:u,isMock:c,event:d}=t,{tieFormat:p,matchUpFormat:m}=t;if(l===ur&&u===ur){let h=(i=(e=n==null?void 0:n.structures)==null?void 0:e.find(({stage:f})=>f===Ae))==null?void 0:i.tieFormat;p=p||h||s&&((r=d==null?void 0:d.tieFormat)==null?void 0:r.tieFormatName)===s&&d.tieFormat||s&&Eu({namedFormat:s,hydrateCollections:a,isMock:c,event:d})||(d==null?void 0:d.tieFormat)||Eu({event:d,isMock:c,hydrateCollections:a}),m=void 0}else m||(p=void 0,d!=null&&d.matchUpFormat||(m=Ho));if(p){let h=qn({gender:d==null?void 0:d.gender,enforceGender:o,tieFormat:p});if(h.error)return h}return{tieFormat:p,matchUpFormat:m}}function DRe(t){var e,i,r,n,a;let o=t.drawDefinition,{existingQualifyingPlaceholderStructureId:s,appliedPolicies:l,drawEntries:u,structureId:c,idPrefix:d,isMock:p,event:m}=t,h=t.qualifyingProfiles,f=h!=null&&h.length?$Z({uuids:t.uuids,qualifyingProfiles:h,appliedPolicies:l,idPrefix:d,isMock:p}):void 0;if(f!=null&&f.error)return f;o.structures=(e=o.structures)==null?void 0:e.filter(({structureId:T})=>T!==s),o.links=(i=o.links)==null?void 0:i.filter(({source:T})=>T.structureId!==s);let{qualifiersCount:g,qualifyingDrawPositionsCount:v,qualifyingDetails:y}=f??{};v&&(f!=null&&f.structures&&((r=o.structures)==null||r.push(...f.structures)),f!=null&&f.links&&((n=o.links)==null||n.push(...f.links)));let I=(a=o.structures)==null?void 0:a.find(({stage:T,stageSequence:D})=>T===Ae&&D===1),{qualifiersCount:b}=bv({stageSequence:1,drawDefinition:o,structureId:c,stage:Ae}),S=Math.max(g??0,b??0),w=VJ({qualifiersCount:S,drawDefinition:o,stage:Ae});if(w.error||(w=h0({drawSize:v,stage:Ke,drawDefinition:o}),w.error))return w;PRe({drawDefinition:o,drawEntries:u,event:m});let U=RRe({mainStructure:I,qualifyingDetails:y,drawDefinition:o});return U.error?U:{drawDefinition:o,structureId:c}}function PRe({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===Ke)){let n={...r,entryStage:r.entryStage??Ae,drawDefinition:t,event:i};SL(n)}}function RRe({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var r;for(let n of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:o,roundTarget:s,finishingPositions:l,linkType:u}=n,c=t&&((r=Ow({targetStructureId:t.structureId,sourceStructureId:o,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:s,linkType:u}))==null?void 0:r.link);if(c!=null&&c.error)return c;c&&(i.links||(i.links=[]),i.links.push(c))}return{error:void 0}}function BQ(t){var e,i;let{participantIds:r}=t,n=((i=(e=t.drawDefinition)==null?void 0:e.entries)==null?void 0:i.filter(a=>{let o=a.entryStatus;return!t.restrictEntryStatus||cs.includes(o)}).map(Tt))??[];if(r){let a=r.filter(o=>!(n!=null&&n.includes(o)));if(a!=null&&a.length)return te({result:{error:Es},info:{invalidParticipantIds:a}})}else r=n;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>r.length-1&&(!t.enableDoubleRobin||t.roundsCount>(r.length-1)*2)?{error:se,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:se,info:"roundsCount must be less than 32"}:{participantIds:r}}function P_(t){var e;let i=[],{roundsCount:r=1,drawDefinition:n,matchUpsCount:a,structureId:o,idPrefix:s,isMock:l,event:u}=t,c,d=BQ(t);if(d.error)return d;for(let p of Te(1,r+1)){let m=pR({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:n,matchUpsCount:a,structureId:o,roundNumber:c,idPrefix:s,isMock:l,event:u});if(m.error)return te({result:m,info:{iteration:p}});(e=m.matchUps)!=null&&e.length&&i.push(...m.matchUps),c=((m==null?void 0:m.roundNumber)??1)+1}return{matchUps:i}}function CRe(t){var e;let{tournamentRecord:i,participantIds:r,scaleName:n,eventType:a,adHocRatings:o={}}=t,s=t.scaleAccessor??((e=Sr[n])==null?void 0:e.accessor),l=i.participants??[];for(let u of r??[]){let c=l==null?void 0:l.find(p=>p.participantId===u),d=_2({scaleName:`${n}.${xF}`,participant:c,eventType:a});!d&&n&&(d=_2({scaleAccessor:s,participant:c,scaleName:n,eventType:a})),d&&!o[u]&&(o[u]=d)}return o}function _2({scaleType:t=Ic,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){var a,o;let s=(o=(a=i&&kl({scaleAttributes:{eventType:n??Em,scaleType:t,scaleName:r},participant:i}))==null?void 0:a.scaleItem)==null?void 0:o.scaleValue;return e&&At(s)?s[e]:s}function R_(t){var e,i;let r=MRe(t);if(r!=null&&r.error)return r;let n=BQ(t);if(n.error)return n;let a=ERe(t);if(a.error)return a;let o=CRe(t),s=((e=t.tournamentRecord)==null?void 0:e.isMock)??t.isMock,l=t.eventType??((i=t.event)==null?void 0:i.eventType),u=[],c=[],d;for(let p of Te(1,(t.roundsCount??1)+1)){let m=g_({...t,participantIds:n.participantIds,structure:a.structure,ignoreLastRoundNumber:!0,iterationMatchUps:u,adHocRatings:o,roundNumber:d,eventType:l,isMock:s});if(m.error)return m;let{matchUps:h,...f}=m;f.modifiedScaleValues&&(o=f.modifiedScaleValues),c.push({...f,iteration:p,matchUpsCount:h==null?void 0:h.length}),d=((f==null?void 0:f.roundNumber)??1)+1,h!=null&&h.length&&u.push(...h)}return{...Z,matchUps:u,roundResults:c}}function ERe(t){var e,i,r;if(t.structureId)return t.structureId;let n=t.drawDefinition,a=(i=(e=n==null?void 0:n.structures)==null?void 0:e.filter(s=>s.stageSequence===1))==null?void 0:i.reduce((s,l)=>{let u=l.stage&&Mm[l.stage];return Yn({structure:l})&&u>(Mm[s==null?void 0:s.stage]||1)?l:s},void 0),o=(r=n==null?void 0:n.structures)==null?void 0:r.find(s=>s.structureId===(a==null?void 0:a.structureId));return o?Yn({structure:o})?{structure:o}:{error:am}:{error:Ni}}function MRe(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:se,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==Ga?{error:am}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:se,info:"Missing Entries"}:{error:void 0}}function NRe(t){var e,i;let{tournamentRecord:r,drawDefinition:n,structureId:a,idPrefix:o,isMock:s,event:l}=t,u=(e=l==null?void 0:l.entries)==null?void 0:e.filter(({entryStage:p,entryStatus:m})=>(!p||p===Ae)&&m&&cs.includes(m)),c=u==null?void 0:u.map(Tt),d=u?Math.floor(u.length/2):0;if(t.automated)return ARe({...t,participantIds:c});{let p=P_({roundsCount:t.roundsCount,drawDefinition:n,matchUpsCount:d,idPrefix:o,isMock:s,event:l});if(p.error)return p;(i=p.matchUps)!=null&&i.length&&lR({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:r,drawDefinition:n,structureId:a,event:l})}return{...Z}}function ARe(t){var e,i;let{restrictEntryStatus:r,generateMatchUps:n,structureId:a,matchUpIds:o,scaleName:s,scaleAccessor:l}=t.drawMatic??{},u=R_({...t,eventType:((e=t.drawMatic)==null?void 0:e.eventType)??t.matchUpType,generateMatchUps:n??!0,scaleAccessor:l??t.scaleAccessor,scaleName:s??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:r,structureId:a,matchUpIds:o});return u.error?u:((i=u==null?void 0:u.matchUps)!=null&&i.length&&lR({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:u.matchUps,event:t.event,structureId:a}),{...Z})}function ORe({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:u}){var c,d;r=r??n;let p=tt({drawDefinition:o,structureId:l});if(p.error)return p;let m=p.structure;if(!m)return{error:Ni};let{positionAssignments:h}=Er({structure:m}),f=(h==null?void 0:h.length)||0;if(u>f)return{error:MK};let g=(c=m.structures)==null?void 0:c.length,v=st(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),y=(d=AL({roundRobinGroupsCount:g,drawSize:f}))==null?void 0:d.seedGroups,{seedsCount:I}=Gw({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:f});return I&&a!=null&&a[Ao]&&u>I&&e&&(u=I),m.seedLimit=u,m.seedAssignments=Te(1,u+1).map(b=>{let S=y==null?void 0:y.find(T=>T.includes(b)),w=S&&Math.min(...S),U=v&&b>=v?w:b;return{participantId:void 0,seedNumber:b,seedValue:U}}),li({drawDefinition:o,structureIds:[l]}),{...Z,seedLimit:u}}function $h({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:o,stage:s}){if(!e)return{error:ve};return a=a??(o==null?void 0:o.entries)??[],{scaledEntries:a.filter(c=>(!s||!c.entryStage||c.entryStage===s)&&(!n||!c.entryStageSequence||c.entryStageSequence===n)&&cs.includes(c.entryStatus)).map(c=>{let{participantId:d}=c,{scaleItem:p}=mg({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...c,...p}}).filter(c=>{let d=c.scaleValue;return!r&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(r||l)};function l(c,d){return t?u(d)-u(c):u(c)-u(d)}function u(c){return parseFloat(c.scaleValue||(t?-1:1e5))}}function VQ(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=rs({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r==null?void 0:r.find(({structureId:m})=>!n.includes(m));if(!a)return te({result:{error:Ni},stack:e});let o=a==null?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:u}=VRe({...t,structureId:o});(t.seededParticipants||t.event||t.seedingScaleName)&&FRe({...t,seedsCount:s,structure:a,structureId:o});let c=t.automated!==!1&&t.drawType!==Ga&&!(t.qualifyingOnly&&t.stage!==Ke),d=((r==null?void 0:r.length)||0)>1,p=c?xRe({...t,multipleStructures:d,seedLimit:u,structureId:o}):{};return p!=null&&p.error?te({result:p,stack:e}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function kRe({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{var a,o;let s=(o=(a=vt({name:Il,element:n}))==null?void 0:a.extension)==null?void 0:o.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!s||s===r)&&Ep.includes(n.entryStatus)})}function xRe(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=Aw({...t,seedsOnly:e});if(i.error)return i;let r=i==null?void 0:i.positionAssignments,n=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function FRe(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(Tt);e?LRe({...t,enteredParticipantIds:a}):(n||i)&&_Re({...t,enteredParticipantIds:a})}function LRe(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:u,event:c}=t,d=u?Fh({provisionalPositioning:e,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:u}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,m)=>p.seedNumber<m.seedNumber?-1:p.seedNumber<m.seedNumber?1:0).forEach(p=>{let{participantId:m,seedNumber:h,seedValue:f}=p;Uv({provisionalPositioning:e,tournamentRecord:n,drawDefinition:o,seedingProfile:s,participantId:m,seedBlockInfo:d,structureId:l,seedNumber:h,seedValue:f,event:c})})}function _Re(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:m}=(d==null?void 0:d.category)||{},h=d==null?void 0:d.eventType,f=$Re({...t,ageCategoryCode:m,categoryName:p,eventType:h})||l&&BRe({...t,ageCategoryCode:m,categoryName:p,eventType:h}),g=(f==null?void 0:f.length)??0;g<e&&(e=g),f==null||f.filter(({participantId:v})=>r.includes(v)).slice(0,a||e).forEach((v,y)=>{let I=y+1,{participantId:b,scaleValue:S}=v,w=(n==null?void 0:n[I])||S||I;Uv({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:u,participantId:b,structureId:c,seedNumber:I,seedValue:w,event:d})})}function $Re(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:o}=t,{categoryName:s,ageCategoryCode:l}=(o==null?void 0:o.category)||{},u=o==null?void 0:o.eventType,c={scaleName:i||s||l||o.eventId,scaleType:Al,eventType:u};return $h({scaleAttributes:c,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function BRe(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:o,ageCategoryCode:s}=(r==null?void 0:r.category)||{},l=r==null?void 0:r.eventType;return $h({scaleAttributes:{scaleName:o||s,scaleType:Nc,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function VRe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=kRe(t);e>i.length&&(e=i.length);let{seedLimit:r}=ORe({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function jRe(t){var e;let i=h_({...t,modifyOriginal:!1});if(i.error)return i;let r=i.drawDefinition,{suppressDuplicateEntries:n=!0,ignoreStageSpace:a,appliedPolicies:o,qualifyingOnly:s,seedingProfile:l,participants:u,drawEntries:c,placeByes:d,drawSize:p,drawType:m,entries:h}=t,f=[],g=[],v=GRe({suppressDuplicateEntries:n,ignoreStageSpace:a,drawDefinition:r,drawEntries:c,drawType:m,entries:h});if(v.error)return v;let y=m===Tp?0:Qe(t.seedsCount??0),I=VQ({...t,qualifyingOnly:!p||s,appliedPolicies:o,drawDefinition:r,seedingProfile:l,participants:u,stage:Ae,seedsCount:y,placeByes:d,drawSize:p,entries:h});if(I.error&&!I.conflicts)return I;(e=I.positioningReport)!=null&&e.length&&f.push({[Ae]:I.positioningReport});let b=I.structureId;return I.conflicts&&(g=I.conflicts),m===Ga&&t.roundsCount&&NRe({...t,drawDefinition:r,structureId:b}),{drawDefinition:r,positioningReports:f,conflicts:g,structureId:b}}function GRe(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let o of a){if(r&&o.entryStage&&o.entryStage!==Ae)continue;let s={...o,ignoreStageSpace:e??n===Ga,entryStage:o.entryStage??Ae,event:t.event,drawDefinition:i,drawType:n},l=SL(s);if(r&&l.error)return l}return{error:void 0}}var HRe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),zRe=HRe;function WRe(t){let{drawId:e=Ht(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=zRe();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function C_(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:o,event:s}=t,l=We(t,[{[$n]:!0,[EF]:!0}]);if(l.error)return l;if(!Ra({matchUpFormat:n}))return{error:Yb};let u="setMatchUpFormat";if(o){let c=Si({drawDefinition:r,matchUpId:o,event:s});if(c.error)return c;let d=c.matchUp;if((d==null?void 0:d.matchUpType)===ur)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:la};d&&(d.matchUpFormat=n,Ct({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:u,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===ur)return{error:Gl};for(let c of e){let d=tt({drawDefinition:r,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if((s==null?void 0:s.eventType)===ur)return{error:Gl};let c=tt({drawDefinition:r,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),li({drawDefinition:r,structureIds:e}),{...Z}}function qRe({tieFormat:t}){let e=qn({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Ht());return{tieFormat:t}}function YRe({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:r,tieFormat:n,event:a}){if((i||n)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&n&&JSON.stringify(a.tieFormat)===JSON.stringify(n))){if(n){let o=qRe({tieFormat:n});if(o.error)return o;e.tieFormat=o.tieFormat??n}else if(i){let o=C_({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}r&&(e.matchUpType=r)}return{error:void 0}}var jQ={};bt(jQ,{attachPolicies:()=>ip,findPolicy:()=>Rp,getAppliedPolicies:()=>Bt,getPolicyDefinitions:()=>Qu,mutate:()=>GQ,query:()=>zQ,removePolicy:()=>HQ});var GQ={};bt(GQ,{attachPolicies:()=>ip,removePolicy:()=>HQ});function HQ(t){let e=We(t,[{[QUe]:!0,_anyOf:{[fn]:!1,[wr]:!1,[$n]:!1,[ed]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return $2(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ve};for(let a of n){let o=t.tournamentRecords[a],s=$2(t,o);if(s.error)return s;i=!0}}else return{error:ve};return i?{...Z}:{error:Xf}}function $2(t,e){let i=Bt(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?_t({element:e,extension:{name:oy,value:i}}):Dn({element:e,name:oy}),{...Z}):{error:Xf}}var zQ={};bt(zQ,{findPolicy:()=>Rp,getAppliedPolicies:()=>Bt,getPolicyDefinitions:()=>Qu});var WQ={[Ao]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Wl]:{positioning:qd},[ts]:{positioning:qd}},positioning:GUe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},BM=WQ;function KRe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return te({info:"policyDefinitions must be an object",result:{error:se},stack:r});let n={[ay]:t==null?void 0:t[ay]};return e?XRe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&ip({drawDefinition:i,policyDefinitions:n}),!(t!=null&&t[Ao])&&!(e!=null&&e[Ao])&&(ip({policyDefinitions:BM,drawDefinition:i}),t&&Object.assign(t,BM)),{error:void 0}}function XRe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e==null?void 0:e[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(ip({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function JRe(t){var e,i,r,n,a;let{tournamentRecord:o,matchUpFormat:s,appliedPolicies:l,policyDefinitions:u,matchUpType:c,tieFormat:d,drawType:p,stack:m,event:h}=t,f=t.drawId?(e=h==null?void 0:h.drawDefinitions)==null?void 0:e.find(w=>w.drawId===t.drawId):void 0;f&&p!==f.drawType&&(f.drawType=p);let g=f??WRe({processCodes:t.processCodes,drawId:t.drawId,drawType:p}),v=YRe({tournamentRecord:o,drawDefinition:g,matchUpFormat:s,matchUpType:c,tieFormat:d,event:h});if(v.error)return te({result:v,stack:m});let y=KRe({appliedPolicies:l,policyDefinitions:u,drawDefinition:g,stack:m});if(y.error)return y;let I=(r=(i=f==null?void 0:f.structures)==null?void 0:i.find(w=>w.stage===Ae&&w.stageSequence===1))==null?void 0:r.structureId,b=f?(n=f.structures)==null?void 0:n.filter(w=>w.stage===Ke):[],S=(b==null?void 0:b.length)===1&&!((a=b[0].matchUps)!=null&&a.length)&&b[0].structureId;return{drawDefinition:g,structureId:I,existingDrawDefinition:f,existingQualifyingPlaceholderStructureId:S}}function ZRe(t){var e,i;let r="generateOrGetExisting",n=[],a=[],o=JRe(t);if(o.error)return te({result:o,stack:r});let s=o.existingDrawDefinition,l=o.drawDefinition??{},u=o.structureId,c=t.drawEntries??t.eventEntries??[],d=o.existingQualifyingPlaceholderStructureId&&DRe({...t,...o})||jRe({...t,...o,entries:c});return d.error?te({result:d,stack:r}):((e=d.positioningReports)!=null&&e.length&&n.push(...d.positioningReports??[]),(i=d.conflicts)!=null&&i.length&&a.push(...d.conflicts??[]),l=d.drawDefinition,u=d.structureId,{existingDrawDefinition:s,positioningReports:n,drawDefinition:l,structureId:u,conflicts:a,entries:c})}function QRe(t){var e,i,r;let{qualifyingPlaceholder:n,qualifyingProfiles:a,existingDrawDefinition:o,positioningReports:s,appliedPolicies:l,qualifyingOnly:u,drawDefinition:c,seedingProfile:d,participants:p,structureId:m,entries:h,stack:f}=t,g=n&&!(a!=null&&a.length)&&!o,v=[];if(a){let y=(w,U)=>w.stageSequence-U.stageSequence,I=(w,U)=>w.roundTarget-U.roundTarget,b=[],S=1;a.sort(I);for(let w of a){if(!Array.isArray(w.structureProfiles))return te({info:tp("structureProfiles"),result:{error:Je},stack:f});S=w.roundTarget||S;let U=((e=w.structureProfiles)==null?void 0:e.sort(y))||[],T=1;for(let D of U){let{qualifyingRoundNumber:P,qualifyingPositions:C,seededParticipants:R,seedingScaleName:N,seedsCount:A=0,seedByRanking:M,placeByes:E,drawSize:O}=D,k=VQ({...t,seedingProfile:D.seedingProfile??d,stageSequence:T,qualifyingRoundNumber:P,preparedStructureIds:b,qualifyingPositions:C,seededParticipants:R,stage:Ke,seedingScaleName:N,appliedPolicies:l,drawDefinition:c,qualifyingOnly:u,seedByRanking:M,participants:p,roundTarget:S,seedsCount:A,placeByes:E,drawSize:O,entries:h});if(k.error)return k;k.structureId&&b.push(k.structureId),T+=1,(i=k.conflicts)!=null&&i.length&&v.push(...k.conflicts),(r=k.positioningReport)!=null&&r.length&&s.push({[Ke]:k.positioningReport})}S+=1}}else if(m&&g){let y=so({structureName:tn(Ke),stage:Ke}),{link:I}=Ow({sourceStructureId:y.structureId,targetStructureId:m,sourceRoundNumber:0,linkType:Nu});c.structures||(c.structures=[]),c.structures.push(y),c.links||(c.links=[]),c.links.push(I)}return{qualifyingConflicts:v,error:void 0}}var qQ={};bt(qQ,{addGoesTo:()=>ep,allCompetitionMatchUps:()=>As,allDrawMatchUps:()=>Pn,allEventMatchUps:()=>tu,allPlayoffPositionsFilled:()=>$L,allTournamentMatchUps:()=>Gr,analyzeDraws:()=>Vw,analyzeMatchUp:()=>vy,analyzeTournament:()=>__,bulkUpdatePublishedEventIds:()=>V_,calculateWinCriteria:()=>Vh,categoryCanContain:()=>Qb,checkMatchUpIsComplete:()=>Cd,checkValidEntries:()=>dR,compareTieFormats:()=>_u,competitionScheduleMatchUps:()=>Kw,courtGridRows:()=>MR,credits:()=>eCe,drawMatchUps:()=>t$,eventMatchUps:()=>OR,filterMatchUps:()=>cu,filterParticipants:()=>Rw,findDrawDefinition:()=>u_,findExtension:()=>vt,findVenue:()=>eu,getAggregateTeamResults:()=>L_,getAllDrawMatchUps:()=>fr,getAllEventData:()=>j_,getAllStructureMatchUps:()=>qt,getAllowedDrawTypes:()=>bR,getAllowedMatchUpFormats:()=>k_,getAppliedPolicies:()=>Bt,getAssignedParticipantIds:()=>Np,getAvailableMatchUpsCount:()=>uR,getAvailablePlayoffProfiles:()=>kw,getCategoryAgeDetails:()=>Cm,getCheckedInParticipantIds:()=>Mh,getCompetitionDateRange:()=>UR,getCompetitionMatchUps:()=>gy,getCompetitionParticipants:()=>E_,getCompetitionPenalties:()=>x_,getCompetitionVenues:()=>zw,getCourtInfo:()=>WP,getCourts:()=>i$,getDrawData:()=>TR,getDrawDefinitionTimeItem:()=>sL,getDrawParticipantRepresentativeIds:()=>s_,getDrawStructures:()=>rs,getDrawTypeCoercion:()=>jw,getEligibleVoluntaryConsolationParticipants:()=>o_,getEntriesAndSeedsCount:()=>NR,getEvent:()=>a$,getEventData:()=>DR,getEventMatchUpFormatTiming:()=>W_,getEventProperties:()=>r$,getEventPublishStatus:()=>Co,getEventStructures:()=>eR,getEventTimeItem:()=>cw,getEvents:()=>n$,getFlightProfile:()=>Hi,getHomeParticipantId:()=>X_,getLinkedTournamentIds:()=>sw,getMatchUpCompetitiveProfile:()=>yw,getMatchUpContextIds:()=>J_,getMatchUpDailyLimits:()=>xR,getMatchUpDailyLimitsUpdate:()=>q_,getMatchUpDependencies:()=>ds,getMatchUpFormat:()=>Z_,getMatchUpFormatTiming:()=>bw,getMatchUpFormatTimingUpdate:()=>z_,getMatchUpScheduleDetails:()=>qP,getMatchUpType:()=>YP,getMatchUpsMap:()=>ln,getMatchUpsStats:()=>Q_,getMatchUpsToSchedule:()=>PR,getMaxEntryPosition:()=>H_,getModifiedMatchUpFormatTiming:()=>AR,getPairedParticipant:()=>ns,getParticipantEventDetails:()=>M_,getParticipantIdFinishingPositions:()=>l_,getParticipantMembership:()=>N_,getParticipantResults:()=>Lw,getParticipantScaleItem:()=>mg,getParticipantSchedules:()=>A_,getParticipantSignInStatus:()=>O_,getParticipantTimeItem:()=>lL,getParticipants:()=>Ai,getPersonRequests:()=>kp,getPolicyDefinitions:()=>Qu,getPositionAssignments:()=>my,getPositionsPlayedOff:()=>Tv,getPredictiveAccuracy:()=>K_,getProfileRounds:()=>ER,getPublishState:()=>kh,getRoundMatchUps:()=>An,getRounds:()=>e$,getScaleValues:()=>mv,getScaledEntries:()=>$h,getScheduledRoundsDetails:()=>Ww,getSchedulingProfile:()=>rc,getSchedulingProfileIssues:()=>G_,getSeedingThresholds:()=>OL,getSeedsCount:()=>Gw,getStructureSeedAssignments:()=>go,getTeamLineUp:()=>Qd,getTieFormat:()=>B_,getTimeItem:()=>Do,getTournamentIds:()=>aw,getTournamentInfo:()=>Bh,getTournamentPenalties:()=>wR,getTournamentPersons:()=>F_,getTournamentPoints:()=>SR,getTournamentPublishStatus:()=>Pw,getTournamentStructures:()=>_L,getTournamentTimeItem:()=>VP,getValidGroupSizes:()=>Mw,getVenueData:()=>cg,getVenuesAndCourts:()=>ic,isAdHoc:()=>Yn,isCompletedStructure:()=>_c,isValidForQualifying:()=>p_,isValidMatchUpFormat:()=>Ra,matchUpActions:()=>cR,participantScaleItem:()=>kl,participantScheduledMatchUps:()=>Y_,positionActions:()=>d_,publicFindCourt:()=>yL,publicFindVenue:()=>IL,tallyParticipantResults:()=>Dv,tieFormatGenderValidityCheck:()=>IP,tournamentMatchUps:()=>kR,validMatchUp:()=>jP,validMatchUps:()=>Ro,validateCollectionDefinition:()=>ew,validateLineUp:()=>QP});function eCe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var YQ={};bt(YQ,{filterParticipants:()=>Rw,getCompetitionParticipants:()=>E_,getPairedParticipant:()=>ns,getParticipantEventDetails:()=>M_,getParticipantMembership:()=>N_,getParticipantScaleItem:()=>mg,getParticipantSchedules:()=>A_,getParticipantSignInStatus:()=>O_,getParticipantTimeItem:()=>lL,getParticipants:()=>Ai,getScaleValues:()=>mv,participantScaleItem:()=>kl,validateLineUp:()=>QP});function E_(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:ki};let i=[],r={},n={},a={},o=[],s={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:m,matchUps:h,derivedEventInfo:f,derivedDrawInfo:g}=Ai({...t,tournamentRecord:u});Object.assign(s,d),Object.assign(r,p),Object.assign(n,f),Object.assign(a,g),i.push(...m??[]),o.push(...h??[]),c==null||c.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:s,participants:i,...Z,matchUps:o}}function M_({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:hr};let i=[e].concat((t.participants??[]).filter(r=>{var n;return(r==null?void 0:r.participantType)&&[Xt,ft].includes(r.participantType)&&((n=r.individualParticipantIds)==null?void 0:n.includes(e))}).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=((r==null?void 0:r.entries)??[]).map(a=>a.participantId);return Nn(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function N_({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:hr};let{participants:i}=Ai({participantFilters:{participantTypes:[Xt,ft,Ja]},tournamentRecord:t});return(i??[]).filter(r=>{var n;return(n=r.individualParticipantIds)==null?void 0:n.includes(e)}).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function A_({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:ve};if(typeof t!="object")return{error:Ju,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=Gr({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),o=ds({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],s={};for(let l of a){let{sides:u}=l,c,d=(u==null?void 0:u.map(m=>{if(m.participant)return[m.participant].concat(...m.participant.individualParticipants||[]);o[l.matchUpId]&&!c&&(c=(o[l.matchUpId]||[]).map(h=>n[h]).filter(({winningSide:h,bye:f})=>!h&&!f))}).filter(Boolean).flat())??[];for(let m of d){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].matchUps.push(l)}let p=(c==null?void 0:c.map(({sides:m})=>m).flat().map(({participant:m})=>m&&[m].concat(...m.individualParticipants||[])).filter(Boolean).flat())||[];for(let m of p){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...Z}}function O_({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:hr};let{participant:i}=nd({tournamentRecord:t,participantId:e});if(!i)return{error:Wi};let{timeItem:r}=Do({itemType:uw,element:i});return r&&r.itemValue===ly&&ly}var KQ={};bt(KQ,{analyzeDraws:()=>Vw,analyzeTournament:()=>__,getAggregateTeamResults:()=>L_,getAllowedDrawTypes:()=>bR,getAllowedMatchUpFormats:()=>k_,getAppliedPolicies:()=>Bt,getCompetitionDateRange:()=>UR,getCompetitionPenalties:()=>x_,getPolicyDefinitions:()=>Qu,getTournamentInfo:()=>Bh,getTournamentPenalties:()=>wR,getTournamentPersons:()=>F_,getTournamentPoints:()=>SR,getTournamentStructures:()=>_L,getTournamentTimeItem:()=>VP});function k_({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:ve};let{appliedPolicies:n}=Bt({tournamentRecord:t});return(((r=n==null?void 0:n[fo])==null?void 0:r.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function bR({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:ve};let{appliedPolicies:n}=Bt({tournamentRecord:t});return(((r=n==null?void 0:n[i0])==null?void 0:r.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function wR({tournamentRecord:t}){if(!t)return{error:ve};let e=((t==null?void 0:t.participants)??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:o}=a||{};i[o]?i[o].participants.push(n):i[o]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function x_({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let e=[];for(let i of Object.values(t)){let{penalties:r}=wR({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function XQ({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:m,notes:h})=>({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:m,notes:h}))(t)}}var tCe={[hv]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},iCe=tCe;function Bh(t){var e,i,r,n;let{tournamentRecord:a}=t??{};if(!a)return{error:ve};let o=(({tournamentId:d,tournamentRank:p,tournamentStatus:m,formalName:h,tournamentName:f,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:I,startDate:b,endDate:S,hostCountryCode:w,venues:U,notes:T,updatedAt:D})=>({tournamentId:d,tournamentRank:p,tournamentStatus:m,formalName:h,tournamentName:f,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:I,startDate:b,endDate:S,hostCountryCode:w,venues:U,notes:T,updatedAt:D}))(a),s=((e=Ai({participantFilters:{participantRoles:[sJ,DL,lJ,uJ,dJ]},policyDefinitions:iCe,tournamentRecord:a}))==null?void 0:e.participants)??[];s&&(o.tournamentContacts=s);let l=(i=kh({tournamentRecord:a}))==null?void 0:i.publishState,u=((n=(r=l==null?void 0:l.tournament)==null?void 0:r.status)==null?void 0:n.publishedEventIds)||[],c=[];for(let d of a.events??[])if(!(t!=null&&t.usePublishState)||u.includes(d.eventId)){let p=XQ({event:d}).eventInfo;p&&c.push(p)}return o.timeItemValues=gZ({element:a}),o.publishState=l==null?void 0:l.tournament,o.eventInfo=c,{tournamentInfo:Ne(He(o),!1,!0),...Z}}function UR({tournamentRecords:t}){if(!At(t))return{error:ki};let e=Object.keys(t??{}).reduce((n,a)=>{let o=t[a],{tournamentInfo:{startDate:s,endDate:l}}=Bh({tournamentRecord:o}),u=s&&new Date(mt(s));(!n.startDate||u&&u<n.startDate)&&(n.startDate=u);let c=l&&new Date(mt(l));return(!n.endDate||c&&c>n.endDate)&&(n.endDate=c),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&mt(e.startDate.toISOString()),r=e.endDate&&mt(e.endDate.toISOString());return!i||!r?{error:KK}:{startDate:i,endDate:r}}function F_({tournamentRecord:t,participantFilters:e}){if(!t)return{error:ve};let i=t.participants||[];e&&(i=Rw({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:o}=a.person;r[o]?r[o].participantIds.push(a.participantId):r[o]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function L_(t){var e,i,r,n,a,o,s,l;let u=We(t,[{[wr]:!0}]);if(u.error)return u;let c=t.finishingPositionRangeBounsPoints||{},d={},p=I=>{var b,S,w;let U=(b=I==null?void 0:I.individualParticipants)==null?void 0:b.map(T=>{var D;return((D=T.teams)==null?void 0:D.length)===1&&T.teams[0]});return((S=I==null?void 0:I.teams)==null?void 0:S.length)===1&&((w=I==null?void 0:I.teams)==null?void 0:w[0])||(U==null?void 0:U[0].participantId)===(U==null?void 0:U[1].participantId)&&(U==null?void 0:U[0])},{matchUps:m,participants:h}=Ai({participantFilters:{participantTypes:[Dt]},withRankingProfile:!0,withStatistics:!0,...t});for(let I of h??[]){if(I.participantType===Gn)continue;((i=(e=I.draws)==null?void 0:e[0])==null?void 0:i.drawId)==="draw-0-3"&&console.log(I.participantType,I.draws[0].finishingPositionRange);let b=p(I);if(b)for(let S of(I==null?void 0:I.draws)??[]){let w=(r=S==null?void 0:S.finishingPositionRange)==null?void 0:r.join("-");if(w&&c!=null&&c[w]){let U=b==null?void 0:b.participantId,T=S==null?void 0:S.drawId,D=`${U}|${T}|${w}`;d[D]=c[w]}}}let f=I=>({teamName:I,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),g=(I,b,S)=>{I[b]===void 0&&(I[b]=0),I[b]+=S},v={},y={};for(let I of m??[]){let{sides:b,matchUpFormat:S}=I,w=S&&Ln(S);if((b==null?void 0:b.length)===2&&(n=w.setFormat)!=null&&n.timed&&(!w.finalSetFormat||(a=w.finalSetFormat)!=null&&a.timed))for(let U of b){let T=p(U.participant),D=T==null?void 0:T.participantId,P=(o=U.participant)==null?void 0:o.participantId,C=T==null?void 0:T.participantName,R=U.sideNumber,N=((s=U.participant)==null?void 0:s.individualParticipantIds)||P&&[P]||[];if(N.forEach(A=>{A&&!v[A]&&(v[A]=f(C))}),D&&R){y[D]||(y[D]=f(C));let A=[...N.map(E=>v[E]),y[D]];I.winningSide&&(R===I.winningSide?A.forEach(E=>g(E,"win",1)):A.forEach(E=>g(E,"loss",1)));let M=((l=I.score)==null?void 0:l.sets)||[];for(let E of M){let O=(E==null?void 0:E[`side${3-R}Score`])||0,k=(E==null?void 0:E[`side${R}Score`])||0,x=k-O;A.forEach(F=>g(F,"pointsPlayed",k+O)),A.forEach(F=>g(F,"points",k)),A.forEach(F=>g(F,"diff",x))}}}}for(let I of Object.keys(d)){let[b]=I.split("|");y[b]&&(y[b].bonus+=d[I],y[b].pointsPct=parseFloat((y[b].points/y[b].pointsPlayed).toFixed(2)),y[b].standingPoints=y[b].win+y[b].bonus)}for(let I of Object.keys(v))v[I].pointsPct=parseFloat((v[I].points/v[I].pointsPlayed).toFixed(2));return{...Z,individualResults:v,teamResults:y}}function rCe(t){var e,i,r,n,a,o,s;let l=((i=(e=t.participants)==null?void 0:e.filter(({participantType:p})=>p===Xt))==null?void 0:i.length)===2,u=((r=t.events)==null?void 0:r.length)===1&&t.events[0],c=((n=u==null?void 0:u.drawDefinitions)==null?void 0:n.length)===1&&u.drawDefinitions[0],d=((s=(o=((a=c==null?void 0:c.structures)==null?void 0:a.length)===1&&c.structures[0])==null?void 0:o.positionAssignments)==null?void 0:s.length)===2;return!!(u.tieFormat&&l&&d)}function __({tournamentRecord:t}){var e;if(!t)return{error:ve};let{drawsAnalysis:i}=Vw({tournamentRecord:t}),r={isDual:rCe(t),drawsAnalysis:i},n=Ai({tournamentRecord:t});return(e=n.missingParticipantIds)!=null&&e.length&&(r.missingParticipantIds=n.missingParticipantIds),{...Z,analysis:r}}function JQ(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function nCe(t){let{participation:e={},awardProfiles:i,startDate:r,eventType:n,drawSize:a,drawType:o,category:s,endDate:l,level:u}=t,{participationOrder:c,flightNumber:d,rankingStage:p}=e,m=h=>!r&&!l||!h.dateRanges?!0:h.dateRanges.some(f=>{let g=!r||!f.startDate||new Date(r)>new Date(f.startDate),v=!l||!f.endDate||new Date(l)<=new Date(f.endDate);return g&&v});return{awardProfile:i.find(h=>{var f,g,v,y,I,b,S,w,U,T;return m(h)&&(!h.maxFlightNumber||d<=h.maxFlightNumber)&&(!((f=h.drawTypes)!=null&&f.length)||((g=h.drawTypes)==null?void 0:g.includes(o)))&&(!((v=h.drawSizes)!=null&&v.length)||h.drawSizes.includes(a))&&(!((y=h.stages)!=null&&y.length)||h.stages.includes(p))&&(!((I=h.levels)!=null&&I.length)||h.levels.includes(u))&&(!h.maxDrawSize||a<=h.maxDrawSize)&&(!h.drawSize||h.drawSize===a)&&(!h.maxLevel||u<=h.maxLevel)&&(!d||!((S=(b=h.flights)==null?void 0:b.flightNumbers)!=null&&S.length)||h.flights.flightNumbers.includes(d))&&(!h.participationOrder||h.participationOrder===c)&&(!((w=h.category)!=null&&w.ageCategoryCodes)||h.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((U=h.eventTypes)!=null&&U.length)||((T=h.eventTypes)==null?void 0:T.includes(n)))})}}function B2({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){var o,s;let l=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(I=>I.flight===g||I.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},u=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(st(g)?g:0),I=JQ(a,g==null?void 0:g.level);return{value:l(v,I)||st(I)&&I||y}},c=0,d,p,m,h,f=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(I=>{var b;return I.drawSize===r||((b=I.drawSizes)==null?void 0:b.includes(r))}),v=i.find(I=>I.drawSize&&I.threshold&&r>I.drawSize),y=i.find(I=>{var b;return!I.drawSize&&!((b=I.drawSizes)!=null&&b.length)});f!==void 0&&(g=g==null?void 0:g[f],v=v==null?void 0:v[f],y=y==null?void 0:y[f]),p=u(g,e).value,m=u(v,e).value,h=u(y,e).value,c=p||m||h,d=p&&g.requireWin||m&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(o=i==null?void 0:i.drawSizes)==null?void 0:o[r],v=i;f!==void 0&&(g=g==null?void 0:g[f],v=v==null?void 0:v[f]),p=u(g,e).value,h=u(v,e).value,c=p||h,d=p?g.requireWin:v==null?void 0:v.requireWin}else st(i)&&f===void 0&&(c=i);return e&&(s=n==null?void 0:n.pct)!=null&&s[e]&&(c=Math.round(c*n.pct[e])),{awardPoints:c,requireWin:d}}function SR({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){var n;if(!i)return{error:ve};let{policyDefinitions:a}=Qu({policyTypes:[JU],tournamentRecord:i}),o=(e==null?void 0:e[JU])??(a==null?void 0:a[JU]);if(!o)return{error:rP};let s=o.awardProfiles,l=o.requireWinFirstRound,u=o.requireWinForPoints,{participants:c,derivedEventInfo:d,derivedDrawInfo:p,mappedMatchUps:m}=Ai({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),h=c==null?void 0:c.filter(y=>{var I;return(I=y.draws)==null?void 0:I.length}),f={},g={},v={};for(let y of h??[]){let{participantType:I,participantId:b,person:S,draws:w}=y;for(let U of w){let{drawId:T,structureParticipation:D,eventId:P}=U,C=d[P],R=p[T],N=R==null?void 0:R.drawType,{category:A,eventType:M}=C||{},E=U.startDate||C.startDate||i.startDate,O=U.endDate||C.endDate||i.endDate;if(M===Ca&&b!==Gn)continue;let k;if(s){let x=u,F=0,$=0,_=0,L;for(let B of D){let{finishingPositionRange:V,participationOrder:G,participantWon:j,flightNumber:z,rankingStage:q,winCount:W}=B;F+=W||0;let Y=R==null?void 0:R.drawSize,{awardProfile:re}=nCe({awardProfiles:s,participation:B,eventType:M,startDate:E,category:A,drawSize:Y,drawType:N,endDate:O,level:r});if(re){if(!Y)continue;let K=Array.isArray(V)&&Math.max(...V),H=dt(V||[]).join("-"),Q=K&&q!==Ke&&(V==null?void 0:V.includes(Y));re.requireWinForPoints!==void 0&&(x=re.requireWinForPoints),re.requireWinFirstRound!==void 0&&(l=re.requireWinFirstRound);let{finishingPositionPoints:X={},finishingPositionRanges:ie,finishingRound:ae,pointsPerWin:le,flights:ne}=re,de=Array.isArray(re.perWinPoints)?(n=re.perWinPoints)==null?void 0:n.find(Pe=>{var it;return(it=Pe.participationOrders)==null?void 0:it.includes(G)}):re.perWinPoints,Ie=X.participationOrders,ce=0,ke;if((!Ie||Ie.includes(G))&&ie&&K){let Pe=ie[K];Pe&&({awardPoints:ce,requireWin:ke}=B2({flightNumber:z,valueObj:Pe,drawSize:Y,flights:ne,level:r}))}if(!ce&&ae&&G===1&&K){let Pe=ae[K];Pe&&({awardPoints:ce,requireWin:ke}=B2({participantWon:j,flightNumber:z,valueObj:Pe,drawSize:Y,flights:ne,level:r}))}if(Q&&l!==void 0&&(x=l),ke!==void 0&&(x=ke),ce>$&&(!x||W)&&($=ce,L=K),!ce&&le&&W&&(_+=W*le,L=H),!ce&&W&&de){let Pe=JQ(r,de==null?void 0:de.level);Pe?_+=W*Pe:de.value&&(_+=W*de.value)}}if(k=$+_,I===Gn){let K=(y.matchUps||[]).filter(({structureId:H})=>H===B.structureId);for(let{matchUpId:H}of K){let Q=m[H],X=Q.sides.find(ie=>ie.participantId===b).sideNumber;if(Q.winningSice===X)for(let ie of Q.tieMatchUps)ie.winningSide}}}if(_||$){let B={winCount:F,positionPoints:$,rangeAccessor:L,perWinPoints:_,eventType:M,drawId:T,points:k},V=S==null?void 0:S.personId;V?(f[V]||(f[V]=[]),f[V].push(B)):I===ft?(v[b]||(v[b]=[]),v[b].push(B)):I===Gn&&(g[b]||(g[b]=[]),g[b].push(B))}}}}return{participantsWithOutcomes:h,personPoints:f,pairPoints:v,teamPoints:g,...Z}}var ZQ={};bt(ZQ,{compareTieFormats:()=>_u,getTieFormat:()=>B_,tieFormatGenderValidityCheck:()=>IP,validateCollectionDefinition:()=>ew});function w0(t){var e;if(!t)return{};let i=[],r=t.tieFormatName,n=(e=t.collectionDefinitions)==null?void 0:e.map(a=>{let{matchUpType:o,matchUpFormat:s,matchUpCount:l,category:u,gender:c}=a;i.includes(s)||i.push(s);let d=u==null?void 0:u.ageCategoryCode;return[l,o===zd?"D":"S",d,s,c].join(";")}).join("|");return{tieFormatName:t&&r||"UNNAMED",matchUpFormats:i,tieFormatDesc:n}}function _u({considerations:t={},descendant:e,ancestor:i}){var r,n;let a={},o={},{matchUpFormats:s,tieFormatDesc:l}=w0(e),{matchUpFormats:u,tieFormatDesc:c}=w0(i),d=dt((s??[]).filter(U=>!(u??[]).includes(U)).concat((u??[]).filter(U=>!(s??[]).includes(U)))),p=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionName:U})=>U).join("|")),m=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")),h=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U}))),f=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U})));a.collectionIds=n2(Object.keys(h),Object.keys(f)),o.collectionIds=n2(Object.keys(f),Object.keys(h)),a.collectionsValue=V2(h),o.collectionsValue=V2(f),a.groupsCount=((r=i==null?void 0:i.collectionGroups)==null?void 0:r.length)??(0-(((n=e==null?void 0:e.collectionGroups)==null?void 0:n.length)??0)||0),o.groupsCount=a.groupsCount?-1*a.groupsCount:0;let g=a.collectionsValue.totalValue-o.collectionsValue.totalValue,v=a.collectionsValue.totalMatchUps-o.collectionsValue.totalMatchUps,y=o.collectionsValue.assignmentValues.length!==a.collectionsValue.assignmentValues.length,I=o.collectionsValue.assignmentValues.some((U,T)=>{let D=a.collectionsValue.assignmentValues[T];return!D||U.valueKey!==D.valueKey||U.value!==D.value?!0:Array.isArray(U.value)?U.value.every((P,C)=>D.value[C]===P):!1}),b=p||m||c!==l||y||I||g!==0,S=[...o.collectionsValue.invalidValues,...a.collectionsValue.invalidValues],w=S.length&&S;return{matchUpFormatDifferences:d,matchUpCountDifference:v,descendantDifferences:a,ancestorDifferences:o,orderDifference:m,valueDifference:g,nameDifference:p,descendantDesc:l,ancestorDesc:c,...Z,different:b,invalid:w}}function V2(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(XP).reduce((n,a)=>{let o=t[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=o,m={collectionValueProfiles:s,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},h=Object.keys(m).filter(g=>![void 0,null].includes(m[g])&&(!Array.isArray(m[g])||m[g].length>0));h.length!==1&&e.push({collectionId:a});let f=h[0];if(f){let g=f==="collectionValueProfiles"?Object.values(s):m[f];i.push({valueKey:f,value:g})}return r+=u,s!=null&&s.length?n+s.reduce((g,v)=>g+v.value,0):u?st(c)?n+c*u:st(d)?n+d*u:st(p)?n+p*u:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function $_(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=QQ(t);return{matchUp:Ne(e,!0,!0),error:i}}function QQ({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:u,drawId:c,event:d}){var p;if(!i)return{error:ve};if(typeof s!="string")return{error:bn};if(!a||!d){let f=(Gr({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find(g=>g.matchUpId===s);if(!f)return{error:hn};({eventId:u,drawId:c}=f),{event:d,drawDefinition:a}=Kn({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:Va};n&&!r&&(r=ec({tournamentRecord:i,contextProfile:n}));let m={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:u??(d==null?void 0:d.eventId),drawId:c},{participants:h=[]}=Dh({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(o){let f=(Pn({context:l?m:void 0,participants:h,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!f)return{error:hn};let g=(p=a==null?void 0:a.structures)==null?void 0:p.find(v=>v.structureId===f.structureId);return{drawDefinition:a,structure:g,matchUp:f}}else{let{matchUp:f,structure:g}=Si({context:l?m:void 0,tournamentParticipants:h,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:s,inContext:l,event:d});return{matchUp:f,structure:g,drawDefinition:a}}}function B_({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:o,event:s}){var l,u,c,d,p;if(!t)return{error:ve};if(!o&&!s&&!i&&!r)return te({result:{error:Je},stack:"getTieFormat"});a&&!s&&(s=(l=t.events)==null?void 0:l.find(y=>y.eventId===a));let m=$_({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:o,event:s});if(r&&m!=null&&m.error)return m;if(!e&&m!=null&&m.drawDefinition&&(e=m==null?void 0:m.drawDefinition),n=n??(m==null?void 0:m.structure),!n&&i&&!r){if(!e)return{error:xs};let y=tt({drawDefinition:e,structureId:i});if(y.error)return y;n=y.structure}let h=((n==null?void 0:n.tieFormat)||(n==null?void 0:n.tieFormatId))&&((u=In({structure:n,drawDefinition:e,event:s}))==null?void 0:u.tieFormat),f=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((c=In({drawDefinition:e,event:s}))==null?void 0:c.tieFormat),g=(d=In({event:s}))==null?void 0:d.tieFormat,v=(p=In({matchUp:m==null?void 0:m.matchUp,drawDefinition:e,structure:n,event:s}))==null?void 0:p.tieFormat;return{...Z,matchUp:m==null?void 0:m.matchUp,structureDefaultTieFormat:Yr(h),eventDefaultTieFormat:Yr(g),drawDefaultTieFormat:Yr(f),tieFormat:Yr(v),structure:n}}var eee={};bt(eee,{bulkUpdatePublishedEventIds:()=>V_,getAllEventData:()=>j_,getCourtInfo:()=>WP,getDrawData:()=>TR,getEventData:()=>DR,getEventPublishStatus:()=>Co,getPublishState:()=>kh,getTournamentPublishStatus:()=>Pw,getVenueData:()=>cg});function V_({tournamentRecord:t,outcomes:e}){var i;if(!t)return{error:ve};if(!(e!=null&&e.length))return{error:Je,info:"Missing outcomes"};let r=e.reduce((a,o)=>{let{drawId:s,eventId:l}=o;return l&&s&&(a[l]?a[l].includes(s)||a[l].push(s):a[l]=[s]),a},{}),n=Object.keys(r);return{publishedEventIds:((i=t.events)==null?void 0:i.filter(a=>n.includes(a.eventId))).filter(a=>{let o=Co({event:a}),{drawDetails:s,drawIds:l}=o??{},{eventId:u}=a;return r[u].filter(c=>{let d=s?Object.keys(o.drawDetails).filter(p=>UL({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(c))||d.includes(c)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:r}}function tee({dates:t=[],extension:e}){var i;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let r=At(e.value)?(i=e.value)==null?void 0:i.dates:void 0;if(Array.isArray(r))return r!=null&&r.length?!!r.filter(n=>!t.length||t.includes(n)).length:!1}function iee({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){var n;let a={...Ne(r,t,!0),venueId:i.venueId},{extension:o}=vt({name:bs,element:r});if(e&&o){let s=At(o.value)?(n=o.value)==null?void 0:n.dates:void 0,l=(o==null?void 0:o.value)===!0?[]:a.dateAvailability.map(u=>{let c=u.date;if(!(!c||s.includes(c)))return u}).filter(Boolean);a.dateAvailability=l}return{inContextCourt:a}}function ic(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},o=[],s=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])if(!(r.length&&!r.includes(p.venueId))){if(i){let{extension:m}=vt({name:bs,element:p});if(m!=null&&m.value)continue}o.includes(p.venueId)||(u.push(Ne(p,e,!0)),o.push(p.venueId));for(let m of p.courts??[])if(!s.includes(m.courtId)){if(i){let{extension:f}=vt({name:bs,element:m});if(tee({extension:f,dates:n}))continue}let{inContextCourt:h}=iee({convertExtensions:e,ignoreDisabled:i,venue:p,court:m});l.push(h),s.push(m.courtId)}}}),{courts:l,venues:u,...Z}}function aCe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:ki};let n=Ne(e.venues??[],t).filter(o=>{if(!i)return o;let{extension:s}=vt({name:bs,element:o});return!(s!=null&&s.value)&&o}).filter(Boolean),a=n.reduce((o,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(u=>{if(!i&&!(r!=null&&r.length))return u;let{extension:c}=vt({name:bs,element:u});return tee({extension:c,dates:r})}).filter(Boolean).map(u=>{let{inContextCourt:c}=iee({convertExtensions:t,ignoreDisabled:i,venue:s,court:u});return c});return l.length?o.concat(l):o},[]);return{venues:n,courts:a}}function zw({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:ki}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:o}=aCe({tournamentRecord:a,dates:i});return o==null||o.forEach(s=>{let{venueId:l,courts:u}=s;(!e||u!=null&&u.length)&&!r.venueIds.includes(l)&&(r.venues.push(s),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function j_({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:ve};let i=t.events||[],r=(t==null?void 0:t.participants)||[],{tournamentInfo:n}=Bh({tournamentRecord:t}),{venues:a}=ic({tournamentRecord:t}),o=i.map(s=>{let{eventId:l}=s,u=XQ({event:s}).eventInfo,c=dw({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(m=>{let h=(({drawId:I,drawName:b,matchUpFormat:S,updatedAt:w})=>({matchUpFormat:S,updatedAt:w,drawName:b,drawId:I}))(m),{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=yv({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:m,event:s});return{drawInfo:h,matchUps:{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=Co({event:s});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:o}}}function ree({publishStatus:t,drawId:e}){var i,r,n;return t!=null&&t.drawDetails?(n=(r=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:r.publishingDetail)==null?void 0:n.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}var nee="PUBLIC",oCe="ADMIN",sCe={PUBLIC_DISPLAY:nee,ADMIN_DISPLAY:oCe};function TR(t){var e,i,r;let{tournamentParticipants:n=[],includePositionAssignments:a,policyDefinitions:o,tournamentRecord:s,inContext:l=!0,usePublishState:u,status:c=Za,pressureRating:d,refreshResults:p,drawDefinition:m,noDeepCopy:h,sortConfig:f,context:g,event:v}=t;if(!m)return{error:$e};let y=(({matchUpFormat:A,updatedAt:M,drawType:E,drawName:O,drawId:k})=>({matchUpFormat:A,updatedAt:M,drawName:O,drawType:E,drawId:k}))(m);y.display=(e=vt({element:m,name:r0}).extension)==null?void 0:e.value;let I={},b,{allStructuresLinked:S,sourceStructureIds:w,hasDrawFeedProfile:U,structureGroups:T}=tR({drawDefinition:m});if(!S)return{error:LK};let D=(t==null?void 0:t.publishStatus)??Co({event:v,status:c}),P=t.eventPublished??!!((r=(i=kh({event:v}).publishState)==null?void 0:i.status)!=null&&r.published),C=!1,R=!1,N=T.map(A=>{let M={},E=A.map(O=>{let{structure:k}=tt({drawDefinition:m,structureId:O}),{seedAssignments:x}=go({drawDefinition:m,structure:k});return(k==null?void 0:k.stage)===Ae&&k.stageSequence===1&&(b=x),(k==null?void 0:k.stage)===Ke&&(I[k.stageSequence??0]=x),k}).sort((O,k)=>Th(O,k,f)).map(O=>{var k,x;if(!O)return;let F=O==null?void 0:O.structureId,$=[];O.stage&&[Ae,an,Bi].includes(O.stage)&&($=b),(O==null?void 0:O.stage)===Ke&&($=I[O.stageSequence??0]);let{matchUps:_,roundMatchUps:L,roundProfile:B}=qt({seedAssignments:(k=O==null?void 0:O.seedAssignments)!=null&&k.length?void 0:$,context:{drawId:y.drawId,...g},tournamentParticipants:n,policyDefinitions:o,tournamentRecord:s,usePublishState:u,publishStatus:D,drawDefinition:m,inContext:l,structure:O,event:v}),{positionAssignments:V}=oi({structure:O}),G=V==null?void 0:V.filter(Ma(ql)).map(W=>{var Y,re;let K=(re=(Y=vt({element:W,name:Oc}))==null?void 0:Y.extension)==null?void 0:re.value,{drawPosition:H,participantId:Q}=W;return R=!0,{participantResult:K,participantId:Q,drawPosition:H}});if(_.length&&(!(G!=null&&G.length)&&t.allParticipantResults||p&&!O.structures)){let{subOrderMap:W}=dZ({positionAssignments:V}),Y=_.some(K=>K.matchUpType===Ba)?_.filter(K=>K.matchUpType===Ba):_,re=Dv({matchUpFormat:O.matchUpFormat,matchUps:Y,policyDefinitions:o,pressureRating:d,subOrderMap:W});G=V==null?void 0:V.filter(Ma(ql)).map(K=>{var H;let{drawPosition:Q,participantId:X}=K;return R=!0,{participantResult:X&&((H=re==null?void 0:re.participantResults)==null?void 0:H[X]),participantId:X,drawPosition:Q}})}let j=O?(({stageSequence:W,structureName:Y,structureType:re,matchUpFormat:K,stage:H})=>({stageSequence:W,structureName:Y,structureType:re,matchUpFormat:K,stage:H}))(O):{},z=(x=vt({element:O,name:r0}).extension)==null?void 0:x.value;j.display=(z==null?void 0:z[nee])??z,j.sourceStructureIds=w[F],j.hasDrawFeedProfile=U[F],j.positionAssignments=V,j.structureActive=_.reduce((W,Y)=>{var re;let K=[tr,dr,us,Ki,yl,Pt,Hr,Ft].includes(Y.matchUpStatus);return W||K||!!Y.winningSide||!!((re=Y.score)!=null&&re.scoreStringSide1)},!1);let q=_.reduce((W,Y)=>W&&[jt,Ki,Hr,Ft,Pt,ua].includes(Y.matchUpStatus),!!_.length);return j.structureCompleted=q,M[F]=q,j.structureActive&&(C=!0),{...j,participantResults:G,seedAssignments:$,roundMatchUps:L,roundProfile:B,structureId:F}});return E.forEach(O=>{var k;a||delete O.positionAssignments,O.sourceStructuresComplete=(k=O.sourceStructureIds)==null?void 0:k.every(x=>M[x])}),E}).flat();return y.drawActive=C,y.participantPlacements=R,y.drawGenerated=N==null?void 0:N.reduce((A,M)=>A||!!(M!=null&&M.roundMatchUps),!1),y.drawCompleted=N==null?void 0:N.reduce((A,M)=>A&&M.structureCompleted,!0),y.drawPublished=u?P&&ree({publishStatus:D,drawId:y.drawId}):void 0,{structures:!u||y.drawPublished?h&&N||Ne(N,!1,!0):void 0,drawInfo:h?y:Ne(y,!1,!0),...Z}}function DR(t){var e,i,r;let{includePositionAssignments:n,participantsProfile:a,policyDefinitions:o,usePublishState:s,status:l=Za,sortConfig:u}=t,c=We(t,[{tournamentRecord:!0},{[kF]:{event:!1,eventId:!1}}]);if(c.error)return c;let d=Ne(t.tournamentRecord,!1,!0),p=t.event?void 0:Kn({tournamentRecord:d,eventId:t.eventId}).event,m=t.event?Ne(t.event,!1,!0):p&&Ne(p,!1,!0)||void 0;if(!m)return{error:mo};let{eventId:h}=m,{tournamentId:f,endDate:g}=d,v=Co({event:m,status:l}),y=kh({event:m}).publishState??{},I=!!((e=y==null?void 0:y.status)!=null&&e.published),{participants:b}=Ai({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:o,...a,tournamentRecord:d}),S=({stage:M,drawId:E})=>{var O,k,x;if(!s)return!0;let F=(k=(O=v==null?void 0:v.drawDetails)==null?void 0:O[E])==null?void 0:k.stageDetails;return!F||!Object.keys(F).length?!0:(x=F[M])==null?void 0:x.published},w=({structureId:M,drawId:E})=>{var O,k,x;if(!s)return!0;let F=(k=(O=v==null?void 0:v.drawDetails)==null?void 0:O[E])==null?void 0:k.structureDetails;return!F||!Object.keys(F).length?!0:(x=F[M])==null?void 0:x.published},U=({drawId:M})=>s?ree({publishStatus:v,drawId:M}):!0,T=({drawId:M,structure:E})=>{var O,k,x,F;if(!s)return E;let $=(F=(x=(k=(O=v==null?void 0:v.drawDetails)==null?void 0:O[M])==null?void 0:k.structureDetails)==null?void 0:x[E.structureId])==null?void 0:F.roundLimit;if(st($)){let _=Te(1,$+1),L={},B={};for(let V of _)E.roundMatchUps[V]&&(L[V]=E.roundMatchUps[V],B[V]=E.roundProfile[V]);E.roundMatchUps=L,E.roundProfile=B}return E},D=m.drawDefinitions||[],P=!s||I?D.filter(U).map(M=>(({drawInfo:E,structures:O})=>({...E,structures:O}))(TR({allParticipantResults:t.allParticipantResults,context:{eventId:h,tournamentId:f,endDate:g},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:n,tournamentParticipants:b,noDeepCopy:!0,policyDefinitions:o,tournamentRecord:d,usePublishState:s,drawDefinition:M,publishStatus:v,sortConfig:u,event:m}))).map(({structures:M,...E})=>{let O=M==null?void 0:M.filter(({stage:k,structureId:x})=>w({structureId:x,drawId:E.drawId})&&S({stage:k,drawId:E.drawId})).map(k=>T({drawId:E.drawId,structure:k}));return{...E,structures:O}}).filter(M=>{var E;return(E=M.structures)==null?void 0:E.length}):void 0,C=(Array.isArray(d.venues)?d.venues:[]).map(M=>(({venueData:E})=>({...E}))(cg({venueId:M.venueId,tournamentRecord:d}))),R=(({eventId:M,eventName:E,eventType:O,eventLevel:k,surfaceCategory:x,matchUpFormat:F,category:$,gender:_,startDate:L,endDate:B,ballType:V,discipline:G})=>({eventId:M,eventName:E,eventType:O,eventLevel:k,surfaceCategory:x,matchUpFormat:F,category:$,gender:_,startDate:L,endDate:B,ballType:V,discipline:G}))(m);R.display=(i=vt({element:m,name:r0}).extension)==null?void 0:i.value;let{tournamentInfo:N}=Bh({tournamentRecord:d}),A={tournamentInfo:N,venuesData:C,eventInfo:R,drawsData:P};return A.eventInfo.publishState=y,A.eventInfo.published=(r=y==null?void 0:y.status)==null?void 0:r.published,{...Z,eventData:A,participants:b}}var aee={};bt(aee,{courtGridRows:()=>MR,findVenue:()=>eu,getMatchUpsToSchedule:()=>PR,getPersonRequests:()=>kp,getProfileRounds:()=>ER,getScheduledRoundsDetails:()=>Ww,getSchedulingProfile:()=>rc,getSchedulingProfileIssues:()=>G_,publicFindCourt:()=>yL});function fg({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){var n,a,o,s;let{individualParticipantIds:l}=BP(r);i=i??((n=r.schedule)==null?void 0:n.timeAfterRecovery);let u=m=>{t[m]||(t[m]=[]),t[m]=dt(t[m].concat(...l))},c=m=>{i&&(!e[m]||i>e[m])&&(e[m]=i)},d=((a=r.winnerTo)==null?void 0:a.matchUpId)||r.winnerMatchUpId;d&&(i&&c(d),u(d));let p=((o=r.loserTo)==null?void 0:o.matchUpId)||r.loserMatchUpId;p&&(i&&c(p),u(p)),(s=r.sidesTo)!=null&&s.length&&r.sidesTo.forEach(({matchUpId:m})=>{m&&(i&&c(m),u(m))})}function PR(t){let e=We(t,[{[AF]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,orderedMatchUpIds:s,clearDate:l,matchUps:u}=t,c=o?Object.keys(o):[],d=(s??[]).map(m=>u.find(h=>h.matchUpId===m)).filter(Boolean).filter(m=>{let h=!l&&(r.includes(m.matchUpId)||c.includes(m.matchUpId)),f=[jt,Pt,Ki,ua,Hr,Ft,tr,dr].includes(m==null?void 0:m.matchUpStatus);return n||!h&&!m.winningSide&&!f}),p=i&&a?d.reduce((m,h)=>{let{drawId:f,tournamentId:g}=h;return m.matchUpMap[g]||(m.matchUpMap[g]={}),m.matchUpMap[g][f]?m.matchUpMap[g][f].push(h):m.matchUpMap[g][f]=[h],fg({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:h}),m},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function RR({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!Ra({matchUpFormat:r}))return{error:Yb};let u=Object.keys(i).filter(d=>!o||d===o),c;return u.forEach(d=>{var p;if(c)return;let m=i[d],h=l?(p=Kn({tournamentRecord:m,eventId:l}))==null?void 0:p.event:void 0;return c=bw({tournamentRecord:m,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:h}),(c==null?void 0:c.averageMinutes)||(c==null?void 0:c.recoveryMinutes)}),{recoveryMinutes:(c==null?void 0:c.recoveryMinutes)||t,averageMinutes:(c==null?void 0:c.averageMinutes)||e,typeChangeRecoveryMinutes:(c==null?void 0:c.typeChangeRecoveryMinutes)||(c==null?void 0:c.recoveryMinutes)||t}}function Ww(t){let e=We(t,[{[kF]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[Jn]:cn}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:ki};let a={},o=[],s=t.rounds.toSorted((h,f)=>(h.sortOrder??0)-(f.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(h=>vv({tournamentRecord:h}).containedStructures)),u=t.matchUps??As({nextMatchUps:!0,tournamentRecords:n}).matchUps,c=0,d={},p={},m={};return{scheduledRoundsDetails:s.flatMap(h=>{var f;let g=h.periodLength||r,v=[];l!=null&&l[h.structureId]?v.push(...l[h.structureId]):v.push(h.structureId);let y=u?cu({tournamentIds:[h.tournamentId],roundNumbers:[h.roundNumber],matchUpIds:h.matchUpIds,eventIds:[h.eventId],drawIds:[h.drawId],processContext:!0,structureIds:v,matchUps:u}).sort(Oh):[],{segmentNumber:I,segmentsCount:b}=h.roundSegment||{};if(st(I)&&Cs(y==null?void 0:y.length)&&Cs(b)&&I>0&&I<=b&&b<(y==null?void 0:y.length)&&!((f=h.matchUpIds)!=null&&f.length)){let T=y.length/b,D=T*(I-1);y=y.slice(D,D+T)}let S=n[h.tournamentId],w=Kn({drawId:h.drawId,tournamentRecord:S}).event,U=[];for(let T of y){let D=T.matchUpFormat;D&&(a[D]||(a[D]=[],a[D].push(T)),U.push(D))}for(let T of U){let{eventType:D,category:P}=w??{},{categoryName:C,ageCategoryCode:R}=P??{},{typeChangeRecoveryMinutes:N,recoveryMinutes:A,averageMinutes:M,error:E}=RR({categoryName:C??R,categoryType:P==null?void 0:P.categoryType,tournamentId:h.tournamentId,eventId:h.eventId,tournamentRecords:n,matchUpFormat:T,eventType:D});if(E)return{error:E,round:h};let O=y.filter(x=>(i||!Ir.includes(x.matchUpStatus))&&x.matchUpStatus!==jt).map(Dr);O.forEach(x=>{m[x]={typeChangeRecoveryMinutes:N,recoveryMinutes:A,averageMinutes:M},d[x]=A,p[x]=M}),o.push(...O),c=Math.max(M||0,c);let k=`${M}|${g}`;return{roundPeriodLength:g,recoveryMinutes:A,averageMinutes:M,matchUpIds:O,hash:k}}}),greatestAverageMinutes:c,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:o,minutesMap:m,...Z}}function oee({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t==null?void 0:t.map(s=>{let l=mt(s==null?void 0:s.scheduleDate);if(!l){n.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let u=((s==null?void 0:s.venues)||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!(e!=null&&e.includes(p))){n.push(`Missing venueId: ${p}`);return}let m=d.filter(h=>{let f=i.includes(h.eventId)&&r.includes(h.drawId);return f||n.push(`Invalid eventId: ${h.eventId} or drawId: ${h.drawId}`),f});if(m.length)return{venueId:p,rounds:m}}).filter(Boolean);return u.length&&l&&{...s,venues:u}}).filter(Boolean),o=n.length;return{updatedSchedulingProfile:a,modifications:o,issues:n}}function CR({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:se};let{venueIds:i,tournamentsMap:r}=uCe({tournamentRecords:t}),n,a,o=e.every(s=>{let{scheduleDate:l,venues:u}=s;return ba(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(m=>{var h,f,g,v;if(!m)return a="empty round",!1;let{roundSegment:y,tournamentId:I,structureId:b,roundNumber:S,eventId:w,drawId:U}=m,T=(v=(g=(f=(h=r==null?void 0:r[I])==null?void 0:h[w])==null?void 0:f[U])==null?void 0:g[b])==null?void 0:v.includes(S);T||(a="Invalid rounds");let{segmentNumber:D,segmentsCount:P}=y||{},C=!y||st(D)&&Cs(P)&&D<=P;return C||(a="Invalid segment"),T&&C}):(n=Ih,!1):(a="rounds should be an array",!1)}):!1});return!o&&!n&&(n=se),{valid:!!o,error:n,info:a}}function lCe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],o=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:c,courts:d})=>(!r||(d==null?void 0:d.length))&&c),u=e==null?void 0:e.tournamentId;return u&&(n.push(u),i[u]={},((e==null?void 0:e.events)||[]).forEach(c=>{let d=c.eventId;o.push(d),i[u][d]={},(c.drawDefinitions||[]).forEach(p=>{let m=p.drawId;s.push(m),i[u][d][m]={};let{structures:h}=rs({drawDefinition:p});(h||[]).forEach(f=>{var g;let v=f.structureId,{matchUps:y}=qt({structure:f}),{roundMatchUps:I}=An({matchUps:y}),b=I&&Object.keys(I).map(S=>parseInt(S));i[u][d][m][v]=b,a.push(v),(g=f.structures)!=null&&g.length&&f.structures.forEach(S=>{a.push(S.structureId),i[u][d][m][S.structureId]=b})})})})),{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}function uCe(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:m,eventIds:h,drawIds:f}=lCe({tournamentRecord:u});return m.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...h),l.drawIds.push(...f),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:r,eventIds:n,drawIds:a}}function rc({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let{extension:i}=vt({element:e,name:Om,tournamentRecords:t,discover:!0}),r=(i==null?void 0:i.value)||[];if(r.length){let{venueIds:n}=zw({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:o}=t_({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:u}=oee({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:o});if(l){r=s;let c=Pv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return c.error?c:{schedulingProfile:r,modifications:l,issues:u}}}return{schedulingProfile:r,modifications:0}}function Pv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=CR({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?_t({tournamentRecords:t,discover:!0,extension:{name:Om,value:i}}):Dn({element:e,name:Om,tournamentRecords:t,discover:!0})}function qw(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=rc({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:r}=zw({tournamentRecords:i}),{eventIds:n,drawIds:a}=t_({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=oee({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return s?{...Pv({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...Z,modifications:s,issues:l}}function G_(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:zb};if(!Array.isArray(e))return{error:se};if(!e.every(ba))return{error:xr};let n=[],a=0,o={},{schedulingProfile:s}=rc({tournamentRecords:i});if(!s)return{issues:n,...Z};let{matchUps:l}=As({nextMatchUps:!0,tournamentRecords:i});for(let c of s){let{scheduleDate:d,venues:p=[]}=c;if(!(e!=null&&e.length)||e.includes(d)){for(let m of p||[])if(m){let{rounds:h}=m,f=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=Ww({tournamentRecords:i,periodLength:r,matchUps:l,rounds:h}),{matchUpDependencies:y}=ds({tournamentRecords:i,matchUps:l}),I=b=>{let S;return v==null||v.find((w,U)=>{let T=w.matchUpIds.includes(b);return T&&(S=U),T}),S};if(g==null||g.forEach((b,S)=>{var w;let U=g.slice(S+1),T=ji(U,((w=y==null?void 0:y[b])==null?void 0:w.matchUpIds)||[]);T.length&&f.push({matchUpId:b,shouldBeAfter:T})}),f.length){a+=f.length;let b=f.map(({matchUpId:S,shouldBeAfter:w})=>{let U=I(S),T=dt(w.map(I));return o[d]||(o[d]={}),o[d][U]||(o[d][U]=[]),T.forEach(D=>{o[d][U].includes(D)||o[d][U].push(D)}),{matchUpId:S,matchUpRoundIndex:U,earlierRoundIndices:T,shouldBeAfter:w}});n.push(...b)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...n.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:m}=c;return{[d]:{earlierRoundIndices:m,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:o,...Z}}function kp(t){let{tournamentRecords:e,requestType:i}=t,r=We(t,[{[fn]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:o}=vt({element:a,name:fv}),s=(o==null?void 0:o.value)||[];for(let l of s){let{personId:u,requests:c}=l||{};n[u]||(n[u]=[]);for(let d of c)i&&d.requestType!==i||n[u].push(d)}}return{personRequests:n,...Z}}function VM(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:o,eventId:s,drawId:l}=t,u=r?e:o,c=[n,s,l,u,a].join("|");return He({structureId:u,roundSegment:i,tournamentId:n,roundNumber:a,eventId:s,drawId:l,id:c})}function j2({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:o,categoryType:s}=n||{},{categoryName:l,ageCategoryCode:u}=o||{},c=Pa(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let m=c[p],h=RR({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:s,eventType:a});if(h.error)return h;let f=h.averageMinutes*m;isNaN(d)||(d+=f)}),{roundMinutes:d}}function cCe(t){return(t||[]).reduce((e,i)=>{var r,n;let a=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).reduce((s,l)=>s+l,0),o=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).join("-")||"";return!e.minFinishingSum||a<e.minFinishingSum?{minFinishingSum:a,winnerFinishingPositionRange:o}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function G2(t){let e=t.length,i=t.filter(({sides:u})=>u==null?void 0:u.some(({bye:c})=>c)).length||0,r=t.filter(({winningSide:u,matchUpStatus:c})=>u||Ir.includes(c)).length||0,n=t.filter(({schedule:u,matchUpStatus:c})=>(u==null?void 0:u.scheduledDate)&&(u==null?void 0:u.scheduledTime)&&c!==jt).length||0,a=e-i,o=a===r,s=a-n,l=a-n;return{unscheduledCount:s,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:o,byeCount:i}}function ER({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:zb};t={[i.tournamentId]:i}}if(e){let a=CR({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=rc({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:Vr};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:o})=>a.map(({rounds:s})=>s.map(l=>{var u;let c=VM(l);return(u=c.roundSegment)!=null&&u.segmentsCount&&(n[c.id]=c.roundSegment.segmentsCount),He({id:r?c.id:void 0,scheduleDate:o,...c})}))).flat(1/0),segmentedRounds:n}}function MR({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:se};let r=i==null?void 0:i.reduce((o,s)=>{let l=s.matchUps||[],u=Math.max(0,...l.map(c=>c.schedule.courtOrder||0));return u>o?u:o},1),n=e?Math.max(e,r):r,a=Te(0,n).map(o=>({matchUps:Te(0,i.length).map(s=>{let l=i[s],{courtId:u,venueId:c}=l;return{schedule:{courtOrder:o+1,venueId:c,courtId:u}}})}));return i.forEach((o,s)=>{var l;for(let u of o.matchUps){let c=(l=u.schedule)==null?void 0:l.courtOrder;c&&(a[c-1].matchUps[s]=u)}}),{courtPrefix:t,rows:a.map((o,s)=>Object.assign({rowId:`rowId-${s+1}`},...o.matchUps.map((l,u)=>({[`${t}${u}`]:l}))))}}var see={};bt(see,{getEntriesAndSeedsCount:()=>NR,getMaxEntryPosition:()=>H_});function NR({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:vi};let{entries:o,stageEntries:s}=mJ({drawDefinition:e,drawId:r,stage:a,event:n}),l=s.length,{drawSize:u}=_Z({participantsCount:l}),c=Gw({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return te({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:o,seedsCount:d,stageEntries:s}}function H_(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>Qe(n||0)),0)}var lee={};bt(lee,{allCompetitionMatchUps:()=>As,allDrawMatchUps:()=>Pn,allEventMatchUps:()=>tu,allTournamentMatchUps:()=>Gr,analyzeMatchUp:()=>vy,calculateWinCriteria:()=>Vh,checkMatchUpIsComplete:()=>Cd,competitionScheduleMatchUps:()=>Kw,drawMatchUps:()=>t$,eventMatchUps:()=>OR,filterMatchUps:()=>cu,getAllDrawMatchUps:()=>fr,getAllStructureMatchUps:()=>qt,getCheckedInParticipantIds:()=>Mh,getCompetitionMatchUps:()=>gy,getEventMatchUpFormatTiming:()=>W_,getHomeParticipantId:()=>X_,getMatchUpCompetitiveProfile:()=>yw,getMatchUpContextIds:()=>J_,getMatchUpDailyLimits:()=>xR,getMatchUpDailyLimitsUpdate:()=>q_,getMatchUpDependencies:()=>ds,getMatchUpFormat:()=>Z_,getMatchUpFormatTiming:()=>bw,getMatchUpFormatTimingUpdate:()=>z_,getMatchUpScheduleDetails:()=>qP,getMatchUpType:()=>YP,getMatchUpsStats:()=>Q_,getModifiedMatchUpFormatTiming:()=>AR,getParticipantResults:()=>Lw,getPredictiveAccuracy:()=>K_,getRoundMatchUps:()=>An,getRounds:()=>e$,isValidMatchUpFormat:()=>Ra,matchUpActions:()=>cR,participantScheduledMatchUps:()=>Y_,tallyParticipantResults:()=>Dv,tournamentMatchUps:()=>kR,validMatchUp:()=>jP,validMatchUps:()=>Ro});function uee({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let i=[],r;for(let n of Object.values(t)){let{extension:a}=vt({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let o=n.events??[];for(let s of o){let{eventId:l}=s,{extension:u}=vt({name:e,element:s});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function z_({tournamentRecords:t}){return uee({extensionName:xu,tournamentRecords:t})}var qC="ADULT",YC="JUNIOR",IU="WHEELCHAIR",cee={[td]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[ei]:30,default:60}}]},defaultDailyLimits:{[ii]:2,[ei]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Ho],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[IU],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[qC,IU],minutes:{default:60,[ei]:30}},{categoryTypes:[YC],minutes:{default:60,[ei]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[qC,IU],minutes:{default:30}},{categoryTypes:[YC],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[qC,YC],minutes:{default:30}},{categoryTypes:[IU],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},dCe=cee;function W_({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:vi};let n=[],a;if(e!=null&&e.length){let d=[];n=e.map(p=>{let m=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(m==null?void 0:m.matchUpFormat)&&Ra({matchUpFormat:m==null?void 0:m.matchUpFormat}))return d.push(m.matchUpFormat),m}).filter(Boolean)}else{let{policy:d}=Rp({policyType:fo,tournamentRecord:t,event:r});if(d!=null&&d.matchUpFormats)n=d==null?void 0:d.matchUpFormats;else{let{extension:p}=vt({name:xu,element:r}),m,h;p!=null&&p.value?{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=p.value:{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=dCe[td],n=dt([...(m||[]).map(f=>f.matchUpFormatCodes),...(h||[]).map(f=>f.matchUpFormatCodes)].flat()).map(f=>({matchUpFormat:f})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=r,u=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:vi};let c=n.map(({matchUpFormat:d,description:p})=>{let m=bw({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:o,event:r});return{matchUpFormat:d,description:p,...m}});return He({eventMatchUpFormatTiming:c,info:a})}function AR(t){let e=We(t,[{[wr]:!0},{[Xr]:f=>Ra({matchUpFormat:f}),[Ha]:Yb,[EF]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=vt({name:xu,element:n}),o=a==null?void 0:a.value,{extension:s}=vt({element:i,name:xu}),l=s==null?void 0:s.value,u=(o==null?void 0:o.matchUpAverageTimes)&&rI({...o,matchUpFormat:r}),c=(l==null?void 0:l.matchUpAverageTimes)&&rI({...l,matchUpFormat:r}),d=[u,c].find(f=>f),p=(o==null?void 0:o.matchUpRecoveryTimes)&&nI({...o,matchUpFormat:r}),m=(l==null?void 0:l.matchUpRecoveryTimes)&&nI({...l,matchUpFormat:r}),h=[p,m].find(f=>f);return{matchUpFormat:r,recoveryTimes:h,averageTimes:d}}function q_({tournamentRecords:t}){return uee({extensionName:ow,tournamentRecords:t})}var Yw=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function Y_({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!Ro(e))return{error:Xu};if(!Array.isArray(t))return{error:se};let i=e.filter(Boolean).filter(({schedule:r})=>Yw({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,o=mt(a==null?void 0:a.scheduledDate),s=Ui(a==null?void 0:a.scheduledTime);return o&&s&&(r[o]?r[o].push(n):r[o]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>{var o,s;return Y9(Ui((o=n.schedule)==null?void 0:o.scheduledTime),Ui((s=a.schedule)==null?void 0:s.scheduledTime))})}),{...Z,scheduledMatchUps:i}}function pCe({tournamentRecords:t}){var e;let i={},r=[];for(let n of Object.values(t))for(let a of n.events??[]){let o=Co({event:a}),s=o==null?void 0:o.drawDetails;At(s)?(Object.assign(i,s),r.push(...Object.keys(s).filter(l=>UL({drawId:l,drawDetails:s})))):(e=o==null?void 0:o.drawIds)!=null&&e.length&&r.push(...o.drawIds)}return{drawIds:r,detailsMap:i}}function U0({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:s,drawId:l,structureId:u,roundNumber:c})=>`${s}|${l}|${u}${c}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let m=r({eventId:l,drawId:u,structureId:c,roundNumber:d});i[m]=p})});let n=[],a={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},u=l.scheduledDate&&mt(l.scheduledDate)||l.scheduledTime&&mt(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(s)}let o=Object.keys(a).sort();for(let s of o){let l=a[s],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},m=p.scheduledTime&&Ui(p.scheduledTime)||"noScheduledTime";u[m]||(u[m]=[]),u[m].push(d)}let c=Object.keys(u).sort();for(let d of c){let p=u[d];p.sort((m,h)=>{let f=i[r(m)]||0,g=i[r(h)]||0;return f-g}),n.push(...p)}}return n}function OR(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:m,contextProfile:h,nextMatchUps:f,tournamentId:g,inContext:v,context:y,event:I}=t;if(!I)return{error:vi};let{eventId:b,eventName:S,endDate:w,eventType:U,category:T,gender:D}=I??{},P={...y,...He({surfaceCategory:I.surfaceCategory??(c==null?void 0:c.surfaceCategory),indoorOutDoor:I.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),tournamentId:g??(c==null?void 0:c.tournamentId),endDate:w??(c==null?void 0:c.endDate),eventName:S,eventType:U,category:T,eventId:b,gender:D})},C;!e&&c&&({participants:e,participantMap:r,groupInfo:C}=Dh({participantsProfile:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextProfile:h,inContext:v})),h&&!i&&(i=ec({policyDefinitions:l,tournamentRecord:c,contextProfile:h,event:I}));let R=Co({event:I});return{...(I.drawDefinitions??[]).reduce((N,A)=>{var M;let E=yv({hydrateParticipants:t.hydrateParticipants,context:P,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:m,participantMap:r,publishStatus:R,contextProfile:h,drawDefinition:A,nextMatchUps:f,inContext:v,event:I});return(M=Object.keys(E))==null||M.forEach(O=>{Array.isArray(E[O])&&(N[O]||(N[O]=[]),N[O]=N[O].concat(E[O]))}),N},{}),...Z,groupInfo:C}}function kR(t){if(!(t!=null&&t.tournamentRecord))return{error:ve};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,inContext:l=!0,usePublishState:u,contextFilters:c,matchUpFilters:d,contextProfile:p,nextMatchUps:m,context:h}=t,f=t.tournamentId??s.tournamentId,g=(s==null?void 0:s.events)??[],{participants:v,participantMap:y,groupInfo:I}=Dh({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:p,inContext:l});p&&!e&&(e=ec({policyDefinitions:a,tournamentRecord:s,contextProfile:p}));let{appliedPolicies:b}=Bt({tournamentRecord:s}),S=(c==null?void 0:c.eventIds)??[];return{...g.filter(w=>!S.includes(w.eventId)).map(w=>{var U,T,D;let P={eventDrawsCount:((T=(U=Hi({event:w}).flightProfile)==null?void 0:U.flights)==null?void 0:T.length)||((D=w.drawDefinitions)==null?void 0:D.length)||0,...h};return OR({hydrateParticipants:t.hydrateParticipants,context:P,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:u,contextFilters:c,contextProfile:p,contextContent:e,matchUpFilters:d,participantMap:y,participants:v,tournamentId:f,nextMatchUps:m,inContext:l,event:w})}).reduce((w,U)=>{var T;return(T=U&&Object.keys(U).filter(D=>!["success","matchUpsMap"].includes(D)))==null||T.forEach(D=>{Array.isArray(U[D])&&(w[D]||(w[D]=[]),w[D]=w[D].concat(U[D]),w.matchUpsCount+=U[D].length)}),w},{matchUpsCount:0}),groupInfo:I}}function gy({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:o,contextFilters:s,nextMatchUps:l,inContext:u}){if(typeof r!="object"||!Object.keys(r).length)return{error:ki};let c=Object.keys(r).map(p=>{let m=r[p];return kR({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:m,usePublishState:a,matchUpFilters:o,contextFilters:s,nextMatchUps:l,inContext:u})}),d={};return{...c.reduce((p,m)=>(Object.keys(m).forEach(h=>{Array.isArray(m[h])&&(p[h]||(p[h]=[]),p[h]=p[h].concat(m[h])),h==="groupInfo"&&Object.assign(d,m[h])}),p),{}),groupInfo:d}}function Kw(t){var e,i,r,n,a,o,s;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:ki};let{courts:l,venues:u}=ic(t),c=rc(t).schedulingProfile,{sortDateMatchUps:d=!0,courtCompletedMatchUps:p,alwaysReturnCompleted:m,activeTournamentId:h,tournamentRecords:f,withCourtGridRows:g,minCourtGridRows:v,usePublishState:y,status:I=Za,sortCourtsData:b}=t,S=h??yh()??Object.keys(f)[0],w=y?Pw({tournamentRecord:f[S],status:I}):void 0,U=m?gy({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Ki]},contextFilters:t.contextFilters}).completedMatchUps:[];if(y&&!((e=w==null?void 0:w.orderOfPlay)!=null&&e.published))return{completedMatchUps:U,dateMatchUps:[],courtsData:[],venues:u};let T,D;y&&({drawIds:T,detailsMap:D}=pCe({tournamentRecords:f})),T!=null&&T.length&&(t.contextFilters||(t.contextFilters={}),(i=t.contextFilters)!=null&&i.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(x=>T.includes(x)):t.contextFilters.drawIds=T),(r=w==null?void 0:w.eventIds)!=null&&r.length&&(t.matchUpFilters||(t.matchUpFilters={}),(n=t.matchUpFilters)!=null&&n.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(x=>w.eventIds.includes(x)):t.matchUpFilters.eventIds=w.eventIds),(a=w==null?void 0:w.scheduledDates)!=null&&a.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(x=>w.scheduledDates.includes(x)):t.matchUpFilters.scheduledDates=w.scheduledDates),m&&(t.matchUpFilters||(t.matchUpFilters={}),(s=(o=t.matchUpFilters)==null?void 0:o.excludeMatchUpStatuses)!=null&&s.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Ki)||t.matchUpFilters.excludeMatchUpStatuses.push(Ki):t.matchUpFilters.excludeMatchUpStatuses=[Ki]);let{completedMatchUps:P,upcomingMatchUps:C,pendingMatchUps:R,groupInfo:N}=gy({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),A=[...C??[],...R??[]];D&&(!(T!=null&&T.length)||Object.keys(D).length)&&(A=A.filter(x=>{var F,$;let{drawId:_,structureId:L,stage:B}=x;if(!(($=(F=D==null?void 0:D[_])==null?void 0:F.publishingDetail)!=null&&$.published))return!1;if(D[_].stageDetails){let V=Object.keys(D[_].stageDetails),G=V.filter(z=>!D[_].stageDetails[z].published),j=V.filter(z=>D[_].stageDetails[z].published);return G.length&&G.includes(B)?!1:j.length&&j.includes(B)?!0:G.length&&!G.includes(B)&&!j.length}if(D[_].structureDetails){let V=Object.keys(D[_].structureDetails),G=V.filter(z=>!D[_].structureDetails[z].published),j=V.filter(z=>D[_].structureDetails[z].published);return G.length&&G.includes(L)?!1:j.length&&j.includes(L)?!0:G.length&&!G.includes(L)&&!j.length}return!0}));let M=d?U0({matchUps:A,schedulingProfile:c}):A,E=l==null?void 0:l.map(x=>{let F=k(x);return{surfaceCategory:(x==null?void 0:x.surfaceCategory)??"",matchUps:F,...x}}),O={completedMatchUps:m?U:P,dateMatchUps:M,courtsData:E,groupInfo:N,venues:u};if(g){let{rows:x,courtPrefix:F}=MR({minRowsCount:v,courtsData:E});O.courtPrefix=F,O.rows=x}return{...O,...Z};function k({courtId:x}){let F=(p?M.concat(P??[]):M).filter($=>{var _,L,B;return((_=$.schedule)==null?void 0:_.courtId)===x||((B=(L=$.schedule)==null?void 0:L.allocatedCourts)==null?void 0:B.map(({courtId:V})=>V).includes(x))});return b?U0({matchUps:F,schedulingProfile:c}):F}}function xR({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:o}=mCe({tournamentRecord:a});r=o}),{matchUpDailyLimits:r}}function mCe(t){var e;let i=We(t,[{[wr]:!0}]);if(i.error)return i;let{tournamentRecord:r}=t,{policy:n}=Rp({policyType:td,tournamentRecord:r}),{extension:a}=vt({element:r,name:ow}),o=(e=a==null?void 0:a.value)==null?void 0:e.dailyLimits,s=n==null?void 0:n.defaultDailyLimits;return{matchUpDailyLimits:o||s}}function K_(t){var e,i,r,n;let{matchUps:a}=t,{singlesForDoubles:o,tournamentRecord:s,drawDefinition:l,excludeMargin:u,exclusionRule:c,zoneDoubling:d,matchUpType:p,scaleName:m,eventId:h,zonePct:f,drawId:g,event:v}=t;if(!s&&!a)return{error:ve};if(p&&![ii,ei].includes(p))return{error:se,info:{matchUpType:p}};if(a&&!Ro(a))return{error:se,context:{matchUps:a}};let y=Sr[m],I=(y==null?void 0:y.ascending)??t.ascending??!1,b=(y==null?void 0:y.accessor)??t.valueAccessor,S=Array.isArray(y==null?void 0:y.range)?Math.abs(y.range[0]-y.range[1]):0,w=st(f)&&S?(f??0/100)*S:t.zoneMargin??S,U={withScaleValues:!0,withCompetitiveness:!0},T={matchUpTypes:p?[p]:[ii,ei]},D=s==null?void 0:s.participants;(e=a==null?void 0:a[0])!=null&&e.hasContext?g?a=a.filter(k=>k.drawId===g):h&&(a=a.filter(k=>k.eventId===h)):a===void 0&&(a=g&&!l&&[]||!g&&h&&!v&&[]||g&&((i=Pn({inContext:!0,drawDefinition:l,contextFilters:T,contextProfile:U,participants:D}))==null?void 0:i.matchUps)||!g&&h&&((r=tu({inContext:!0,contextFilters:T,contextProfile:U,participants:D,event:v}))==null?void 0:r.matchUps)||((n=Gr({tournamentRecord:s,contextFilters:T,contextProfile:U}))==null?void 0:n.matchUps)||[]),p&&(a=a.filter(k=>k.matchUpType===p));let P=a.filter(({winningSide:k,score:x,sides:F,matchUpStatus:$})=>![Hr,Pt,Ft,gv,ua].includes($??"")&&yr({score:x})&&(F==null?void 0:F.length)===2&&k),C=fCe({matchUps:P,excludeMargin:u,exclusionRule:c,valueAccessor:b,ascending:I,scaleName:m}),R=!d||Xi(ii)(p)?w:(w||0)*2,N=w?P.map(({competitiveProfile:k,matchUpType:x,score:F,sides:$})=>{let _=dee({singlesForDoubles:o,valueAccessor:b,matchUpType:x,scaleName:m,sides:$}),L=Math.abs(_[0].value-_[1].value);return{competitiveness:k==null?void 0:k.competitiveness,valuesGap:L,score:F}}).filter(({valuesGap:k})=>k<=R):[],A=hCe({zoneData:N}),M=A&&[].concat(Object.values(A)).flat().length,E=M&&Object.assign({},...Object.keys(A).map(k=>({[k]:Math.round(1e4*A[k].length/M)/100}))),O=P.length-((N==null?void 0:N.length)||0);return{...Z,relevantMatchUps:P,zoneDistribution:E,zoneData:N,accuracy:C,nonZone:O}}function hCe({zoneData:t}){let e={[uL]:[],[uy]:[],[cy]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function dee({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let o=e==null?void 0:e.range.sort(),s=l=>{let u=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&u>=o[0]&&u<=o[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l==null?void 0:l.individualParticipants;if(c!=null&&c.length){let d=[],p=0;for(let m of c){let{scaleValue:h,value:f}=H2({singlesForDoubles:t,valueAccessor:i,participant:m,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:v}=s(h);g&&u.push(v),d.push(h),f&&!isNaN(p)?p+=f:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=H2({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:m,exclusionValue:h}=s(d);return m&&u.push(h),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function H2({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){var a,o,s,l,u;let c=t?ii:i,d=(o=(a=r==null?void 0:r.rankings)==null?void 0:a[c])==null?void 0:o.find(h=>h.scaleName===n),p=(u=((l=(s=r==null?void 0:r.ratings)==null?void 0:s[c])==null?void 0:l.find(h=>h.scaleName===n))||d)==null?void 0:u.scaleValue,m=e?p==null?void 0:p[e]:p;return{scaleValue:p,value:m}}function fCe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let u of a){let{matchUpType:c,sides:d,score:p,winningSide:m}=u;if(!m)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:Je};let h=m-1,f=dee({exclusionRule:e,valueAccessor:i,matchUpType:c,scaleName:n,sides:d});if(e){let S=f.map(({exclusionValues:w})=>w).flat();if(S.length){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:S,winningSide:m,sideValues:f});continue}}if(f.filter(S=>![void 0,"",null].includes(S.value)).length<2){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:m,sideValues:f});continue}let g=f[h].value-f[1-h].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:m,excludeGap:y,sideValues:f,valuesGap:g});continue}let I=r?g:g*-1,b=m===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;I>0?o.affirmative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p}):o.negative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}function Vh({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=mZ({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:o,collectionGroupNumber:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,m=s&&r.includes(s);if(st(p||d))n=!0;else{if(m)continue;if(typeof l=="number"&&st(l))i+=l;else if(Array.isArray(o)&&o!=null&&o.length)for(let h of o)i+=h.matchUpValue;else typeof c=="number"&&st(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...Z}:{valueGoal:Math.floor(i/2)+1,...Z}}function X_(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=We(t,[{[Ql]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:o}=Mp({timeItems:(r==null?void 0:r.timeItems)||[],itemType:fL});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function J_({matchUps:t,matchUpId:e}){if(!Ro(t))return{error:se};let i=t.find(s=>s.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:o}}function Rv(t,e){if(!At(t))return{error:se};if(!Array.isArray(e))return{error:se};let i={};for(let{param:r,error:n,attr:a}of e){let o=gCe({params:t,param:r,attr:a,error:n});if(o!=null&&o.error)return o;i[r]=o}return i}function gCe({params:t,param:e,attr:i,error:r}){if(e===CP&&At(t.drawDefinition)&&Di(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===Ql){let n=QQ({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:Vr,info:{param:e}}}function Z_(t){var e,i;let{structureId:r,matchUpId:n,event:a}=t,o=t.drawDefinition,s=We(t,[{[wr]:!0},{[kF]:{[DP]:!1,[vl]:!1,[q8]:!1,[ed]:!1}}]);if(s[zo])return s;let l=(e=Rv(t,[{[pv]:Ql,[zo]:Je}]))==null?void 0:e.matchUp;if(n&&l!=null&&l.error)return l;!o&&l!=null&&l.drawDefinition&&(o=l==null?void 0:l.drawDefinition);let u=l==null?void 0:l.structure;if(!u&&r&&!n){if(!o)return{error:xs};let h=tt({drawDefinition:o,structureId:r});if(h.error)return h;u=h.structure}let c=u==null?void 0:u.matchUpFormat,d=o==null?void 0:o.matchUpFormat,p=a==null?void 0:a.matchUpFormat,m=((i=l==null?void 0:l.matchUp)==null?void 0:i.matchUpFormat)||c||d||p;return{structureDefaultMatchUpFormat:c,eventDefaultMatchUpFormat:p,drawDefaultMatchUpFormat:d,matchUpFormat:m}}function Q_({profileBands:t,tournamentRecord:e,matchUps:i}){if(!Ro(i))return{error:Xu};let r=!t&&Rp({policyType:uu,tournamentRecord:e}).policy,n=t||(r==null?void 0:r.profileBands)||cL[uu].profileBands,a=i.filter(({winningSide:p})=>p),o=a.map(kX),s=(p,m)=>{let h=OX(m,n);return p[h]+=1,p},l=xX(o).reduce((p,m)=>s(p,m),{[uL]:0,[uy]:0,[cy]:0,[CX]:0}),u=Object.keys(l).reduce((p,m)=>(l[m]||0)+p,0),c=Object.keys(l).map(p=>{let m=parseFloat((l[p]/u).toFixed(4));return{[p]:m*100}}),d=a.filter(({matchUpStatus:p})=>p===h2).length;return c.push({[h2]:parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...Z}}var{stageOrder:z2}=KUe;function vCe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(z2[t==null?void 0:t.stage]||0)-(z2[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function e$({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){var m;if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:se,inContextMatchUps:r};if(o&&!n){if(typeof o!="object")return{error:zb};n={[o.tournamentId]:o}}let h=typeof n!="object"||!Object.keys(n).length;if((d||u||!r||!a&&(t||i||a||s))&&h)return{error:ki};let f=Object.assign({},...Object.values(n??{}).map(({venues:U=[],tournamentId:T})=>({[T]:U==null?void 0:U.map(({venueId:D})=>D)}))),g=Object.values(n??{}).map(({events:U=[],tournamentId:T,startDate:D,endDate:P})=>U.map(C=>({...C,validVenueIds:f[T],startDate:C.startDate??D,endDate:C.endDate??P}))).flat(),{segmentedRounds:v,profileRounds:y}=n&&(t||i||a||s)&&ER({tournamentRecords:n,schedulingProfile:a})||{},I=t&&Object.assign({},...y.map(U=>({[U.id]:U}))),b=r||n&&((m=As({tournamentRecords:n,matchUpFilters:l}))==null?void 0:m.matchUps)||[],S=[],w=b&&Object.values(b.reduce((U,T)=>{var D;let P=VM(T).id,C=v==null?void 0:v[P],R=[...((D=U[P])==null?void 0:D.matchUps)??[],T],{containerStructureId:N,stageSequence:A,structureName:M,tournamentId:E,isRoundRobin:O,matchUpType:k,roundNumber:x,roundOffset:F,structureId:$,eventName:_,roundName:L,drawName:B,eventId:V,drawId:G}=T,j=O?N:$;return{...U,[P]:{id:c?P:void 0,structureId:j,stageSequence:A,segmentsCount:C,structureName:M,tournamentId:E,matchUpType:k,roundNumber:x,roundOffset:F,eventName:_,roundName:L,drawName:B,matchUps:R,eventId:V,drawId:G}}},{})).map(U=>{let{minFinishingSum:T,winnerFinishingPositionRange:D}=cCe(U.matchUps),P=U.segmentsCount;if(P){let k=U.matchUps.length/P;return Cr(U.matchUps.sort((x,F)=>x.roundPosition-F.roundPosition),k).map((x,F)=>{let{unscheduledCount:$,incompleteCount:_,matchUpsCount:L,isScheduled:B,isComplete:V,byeCount:G}=G2(x),j=j2({matchUps:U.matchUps,tournamentRecords:n,events:g,round:U});return He({...U,...p,roundSegment:{segmentsCount:P,segmentNumber:F+1},winnerFinishingPositionRange:D,unscheduledCount:$,incompleteCount:_,minFinishingSum:T,matchUpsCount:L,isScheduled:B,roundTiming:j,isComplete:V,byeCount:G,matchUps:x})})}let{unscheduledCount:C,incompleteCount:R,matchUpsCount:N,isScheduled:A,isComplete:M,byeCount:E}=G2(U.matchUps),O=j2({matchUps:U.matchUps,tournamentRecords:n,events:g,round:U});return He({...U,...p,winnerFinishingPositionRange:D,unscheduledCount:C,incompleteCount:R,minFinishingSum:T,matchUpsCount:N,isScheduled:A,roundTiming:O,isComplete:M,byeCount:E})}).flat().filter(U=>{if(t){let F=mt(t),$=c?U.id:VM(U).id;if(F&&I[$]&&mt(I[$].scheduleDate)===F)return!1}let{isComplete:T,isScheduled:D}=U,P=!i||!T,C=!e||!D,R=d||u?g==null?void 0:g.find(({eventId:F})=>F===U.eventId):void 0,N=(R==null?void 0:R.startDate)??(o==null?void 0:o.startDate),A=(R==null?void 0:R.endDate)??(o==null?void 0:o.endDate),M=!u||!N||new Date(u)>=new Date(N),E=!u||!A||new Date(u)<=new Date(A),O=M&&E,k=!d||(R==null?void 0:R.validVenueIds.includes(d)),x=P&&C&&k&&O;return x||S.push(U),x}).sort(vCe)||[];return{...Z,rounds:w,excludedRounds:S}}function vy(t){var e;let{matchUp:i,sideNumber:r,setNumber:n,isTiebreakValue:a,isPointValue:o}=t||{},{matchUpFormat:s}=t||{};if(!i)return{error:sa};s=s||(i==null?void 0:i.matchUpFormat);let l=Ln(s),u=!!(i!=null&&i.winningSide),c=(e=i.score)==null?void 0:e.sets,d=c==null?void 0:c.length,p=n&&n-1,m=!!(c!=null&&c.find((G,j)=>G.setNumber===n&&j===p)),h=(c==null?void 0:c.filter(G=>G==null?void 0:G.winningSide))||[],f=(h==null?void 0:h.length)||0,g=n&&(c==null?void 0:c.slice(n))||[],v=!!(d&&n&&g!=null&&g.reduce((G,j)=>(!j||!j.side1Score&&!j.side2Score&&!j.side1TiebreakScore&&!j.side2TiebreakScore&&!j.side1PointScore&&!j.side2PointScore)&&G,!0)),y=n<=d&&c.find(G=>G.setNumber===n),I=y&&fy({setObject:y,matchUpScoringFormat:l}),{isCompletedSet:b,sideGameScores:S,sideTiebreakScores:w}=I||{},U=!!(y&&!b&&v||n&&n===d+1&&!u),T=[1,2].includes(r),D=T?r-1:0,P=y&&T&&(!a&&!o&&S[D]!==void 0&&S[D]||a&&w[D]!==void 0&&w[D]),C=!!P,R=h==null?void 0:h.map(G=>fy({setObject:G,matchUpScoringFormat:l}).isValidSetOutcome).reduce((G,j)=>G&&j,!0),N=h.reduce((G,j)=>{let{winningSide:z}=j,q=z-1;return G[q]++,G},[0,0]),A=i==null?void 0:i.winningSide,M=A&&A-1,E=1-M,O=N[M],k=N[E],x=Math.max(...N),F=Pa(N)[x],{bestOf:$,exactly:_}=l??{},L=$&&Math.ceil($/2)||_||1,B=x===L&&F===1&&N.indexOf(x)+1||void 0,V=O>k&&A===B;return{completedSetsHaveValidOutcomes:R,validMatchUpWinningSide:V,calculatedWinningSide:B,matchUpScoringFormat:l,validMatchUpOutcome:B&&R&&V,isLastSetWithValues:v,completedSetsCount:f,isCompletedMatchUp:u,isValidSideNumber:T,hasExistingValue:C,existingValue:P,isExistingSet:m,isActiveSet:U,...I}}function t$({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,tournamentId:v,inContext:y,context:I,event:b}){let{eventId:S,eventName:w,endDate:U,eventType:T,category:D,gender:P}=b??{},C={...I,...He({surfaceCategory:(b==null?void 0:b.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(b==null?void 0:b.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:U??(b==null?void 0:b.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:w,eventType:T,category:D,eventId:S,gender:P})},R;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:R}=Dh({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:h,inContext:y})),b&&h&&!c&&(c=ec({policyDefinitions:a,tournamentRecord:s,contextProfile:h,drawDefinition:f,event:b})),{...yv({context:C,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,inContext:y,event:b}),groupInfo:R}}var pee={};bt(pee,{getCompetitionVenues:()=>zw,getCourts:()=>i$,getVenuesAndCourts:()=>ic,publicFindVenue:()=>IL});function i$({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=Ne(r.courts||[]);return a.forEach(o=>Object.assign(o,{venueId:n})),a}).flat()}:{error:ve}}var mee={};bt(mee,{categoryCanContain:()=>Qb,getCategoryAgeDetails:()=>Cm,getEvent:()=>a$,getEventProperties:()=>r$,getEventStructures:()=>eR,getEventTimeItem:()=>cw,getEvents:()=>n$,getFlightProfile:()=>Hi,getScaledEntries:()=>$h});function r$({tournamentRecord:t,event:e}){var i,r;if(!t)return{error:ve};if(!e)return{error:vi};let n=e.entries||[],a=t.participants||[],o=((i=e.category)==null?void 0:i.categoryName)||((r=e.category)==null?void 0:r.ageCategoryCode),{eventType:s}=e,l=n.map(m=>m.participantId),u=a.filter(m=>l.includes(m.participantId)),c,d,p;return{entryScaleAttributes:u.map(m=>{var h,f,g,v,y,I;let{participantId:b,participantName:S,name:w}=m,U={scaleType:vL,eventType:s,scaleName:o},T=(f=(h=kl({participant:m,scaleAttributes:U}))==null?void 0:h.scaleItem)==null?void 0:f.scaleValue;U={scaleType:HX,eventType:s,scaleName:o};let D=(v=(g=kl({participant:m,scaleAttributes:U}))==null?void 0:g.scaleItem)==null?void 0:v.scaleValue;U={scaleType:GX,eventType:s,scaleName:o};let P=(I=(y=kl({participant:m,scaleAttributes:U}))==null?void 0:y.scaleItem)==null?void 0:I.scaleValue;return c=!!(c||T),d=!!(d||D),p=!!(p||P),{participantId:b,participantName:S||w,seed:T,ranking:D,rating:P}}),hasSeededParticipants:c,hasRankedParticipants:d,hasRatedParticipants:p}}function n$({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:o}){var s,l,u,c;if(!t)return{error:ve};let{tournamentId:d}=t,p=(t.events??[]).filter(({eventId:h})=>!n||Array.isArray(n)&&n.includes(h)).map(h=>{var f;let g=(f=h.drawDefinitions)==null?void 0:f.map(sy);if(a!=null&&a.length&&!ji(a,g).length)return;let v=Ne(h);return r&&Object.assign(v,{tournamentId:d}),o&&Object.assign(v,o),v}).filter(Boolean),m={};if(e){let h=Ai({withScaleValues:!0,tournamentRecord:t}).participantMap,f=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of p){let v=i??g.eventType,y=g.eventId;m[y]||(m[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let I=(g.entries??[]).filter(({entryStatus:P})=>cs.includes(P)).map(Tt),b=P=>{var C,R,N,A,M,E;if((C=P==null?void 0:P.ratings)!=null&&C[v])for(let O of((R=P==null?void 0:P.ratings)==null?void 0:R[v])??[]){let k=O.scaleName;m[y].ratings[k]||(m[y].ratings[k]=[]);let x=(N=Sr[k])==null?void 0:N.accessor;if(x){let F=parseFloat((A=O.scaleValue)==null?void 0:A[x]);F&&m[y].ratings[k].push(F)}}if((M=P==null?void 0:P.rankings)!=null&&M[v])for(let O of((E=P==null?void 0:P.rankings)==null?void 0:E[v])??[]){let k=O.scaleName;m[y].ranking[k]||(m[y].ranking[k]=[]),O.scaleValue&&m[y].ranking[k].push(O.scaleValue)}};for(let P of I){let C=(s=h==null?void 0:h[P])==null?void 0:s.participant;if((C==null?void 0:C.participantType)!==Dt)for(let R of(C==null?void 0:C.individualParticipantIds)??[]){let N=(l=h==null?void 0:h[R])==null?void 0:l.participant;b(N)}else b(C)}let S=m[y].ratings;for(let P of Object.keys(S)){let C=S[P];if(!C.length)continue;let R=(u=r2(C))==null?void 0:u.toFixed(2);m[y].ratingsStats[P]={avg:parseFloat((f(C)/C.length).toFixed(2)),median:R?parseFloat(R):void 0,max:Math.max(...C),min:Math.min(...C)}}let w=(P,C)=>{var R,N;let A=M=>{var E,O,k,x,F,$,_,L,B,V;if((E=m[y].draws)!=null&&E[P]&&(O=M==null?void 0:M.ratings)!=null&&O[v])for(let G of((k=M==null?void 0:M.ratings)==null?void 0:k[v])??[]){let j=G.scaleName;(x=m[y].draws[P])!=null&&x.ratings[j]||(m[y].draws[P].ratings[j]=[]);let z=(F=Sr[j])==null?void 0:F.accessor;if(z){let q=parseFloat(($=G.scaleValue)==null?void 0:$[z]);q&&m[y].draws[P].ratings[j].push(q)}}if((_=m[y].draws)!=null&&_[P]&&(L=M==null?void 0:M.rankings)!=null&&L[v])for(let G of((B=M==null?void 0:M.rankings)==null?void 0:B[v])??[]){let j=G.scaleName;(V=m[y].draws[P])!=null&&V.ranking[j]||(m[y].draws[P].ranking[j]=[]);let z=G.scaleValue;z&&m[y].draws[P].ranking[j].push(z)}};for(let M of C.filter(Boolean)){let E=(R=h==null?void 0:h[M])==null?void 0:R.participant;if((E==null?void 0:E.participantType)!==Dt)for(let O of(E==null?void 0:E.individualParticipantIds)??[]){let k=(N=h==null?void 0:h[O])==null?void 0:N.participant;A(k)}else A(E)}},U=[],T=P=>(a==null?void 0:a.length)&&a.includes(P)||U.includes(P);for(let P of g.drawDefinitions??[]){let C=P.drawId;if(T(C))continue;let R=Np({drawDefinition:P}).assignedParticipantIds??[];m[y].draws[C]||(m[y].draws[C]={ratingsStats:{},ratings:{},ranking:{}}),U.push(C),w(C,R)}let D=Hi({event:g}).flightProfile;for(let P of(D==null?void 0:D.flights)??[]){let C=P.drawId;if(T(C))continue;let R=P.drawEntries.map(Tt);w(C,R)}for(let P of U){let C=m[y].draws[P].ratings;for(let R of Object.keys(C)){let N=C[R];if(!N.length)continue;let A=(c=r2(N))==null?void 0:c.toFixed(2);m[y].draws[P].ratingsStats[R]={avg:parseFloat((f(N)/N.length).toFixed(2)),median:A?parseFloat(A):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return He({eventScaleValues:m,events:p,...Z})}function a$({tournamentRecord:t,drawDefinition:e,context:i,event:r}){var n;if(!t)return{error:ve};if(!r)return{error:vi};let a=Ne(r);i&&Object.assign(a,i);let o=e&&((n=a.drawDefinitions)==null?void 0:n.find(({drawId:s})=>e.drawId===s));return He({drawDefinition:o,event:a})}function ICe(t){var e,i;let r="validateAndDeriveDrawValues",{appliedPolicies:n,policyDefinitions:a}=wCe(t),o=UCe({...t,policyDefinitions:a,appliedPolicies:n}),s=bCe(t),l=SCe({...t,consideredEntries:s,appliedPolicies:n});if(l!=null&&l.error)return te({result:l,stack:r});let u=TCe({...t,consideredEntries:s}),c=yCe({...t,appliedPolicies:n,policyDefinitions:a,drawSize:u});if(c.error)return te({result:c,stack:r});let d=c.drawType;if(isNaN(u)&&d!==Ga)return te({result:{error:qb},stack:r});let p=(a==null?void 0:a[Ao])??(n==null?void 0:n[Ao]),m=t.seedingProfile??((i=(e=p==null?void 0:p.seedingProfile)==null?void 0:e.drawTypes)==null?void 0:i[d??""])??(p==null?void 0:p.seedingProfile);t.seedingProfile&&(a[Ao]||(a[Ao]={...BM[Ao]}),a[Ao].seedingProfile=m);let h=DCe({...t,drawType:d});return h!=null&&h.error?te({result:h,stack:r}):{drawSize:u,drawType:d,enforceGender:o,seedingProfile:m,appliedPolicies:n,policyDefinitions:a}}function yCe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??jw({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),o=BZ({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return o.error?o:{drawType:o.drawType}}function hee(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...cs,vw].includes(e.entryStatus))}function bCe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||hee(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Ae)}function wCe(t){let{tournamentRecord:e,event:i}=t,r=Bt({tournamentRecord:e,event:i}).appliedPolicies??{},n=Ne(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function UCe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var r,n,a,o;return t??((n=(r=e==null?void 0:e[Lr])==null?void 0:r.participants)==null?void 0:n.enforceGender)??((o=(a=i==null?void 0:i[Lr])==null?void 0:a.participants)==null?void 0:o.enforceGender)}function SCe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:o,event:s}=t;return s&&o&&dR({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:o,event:s})}function TCe(t){return!t.drawSize&&t.consideredEntries.length&&![Ga,tw,dv,ts,Wl].includes(t.drawType??"")&&iv(t.consideredEntries.length)||t.drawSize&&Qe(t.drawSize)||!1}function DCe(t){var e,i;let{tournamentRecord:r,event:n,ignoreAllowedDrawTypes:a,drawType:o}=t,s=!a&&r&&bR({tournamentRecord:r,categoryType:(e=n==null?void 0:n.category)==null?void 0:e.categoryType,categoryName:(i=n==null?void 0:n.category)==null?void 0:i.categoryName});return s!=null&&s.length&&!s.includes(o)?{error:Vx}:{...Z}}function Xw(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:o}=Ai({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=hee(r==null?void 0:r.entries)??[],l=ICe({...t,participantMap:o,participants:a,eventEntries:s});if(l.error)return te({result:l,stack:n});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:m,seedingProfile:h}=l,f=r==null?void 0:r.eventType,g=t.matchUpType??f,v=TRe({...t,enforceGender:m,eventType:f,matchUpType:g});if(v.error)return te({result:v,stack:n});let{matchUpFormat:y,tieFormat:I}=v;if(t.drawId&&typeof t.drawId!="string")return te({result:{error:se},stack:n});let b=ZRe({...t,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:y,seedingProfile:h,participants:a,eventEntries:s,matchUpType:g,tieFormat:I,drawSize:d,drawType:p,event:r});if(b.error)return te({result:b,stack:n});let{existingDrawDefinition:S,positioningReports:w,drawDefinition:U,structureId:T,conflicts:D,entries:P}=b;if(!U)return te({result:{error:se},stack:n});let C=QRe({...t,existingDrawDefinition:S,positioningReports:w,appliedPolicies:u,drawDefinition:U,seedingProfile:h,participants:a,structureId:T,entries:P,params:t,stack:n});if(C.error)return C;let{qualifyingConflicts:R}=C;return U.drawName=t.drawName??(p&&tn(p)),d&&typeof e=="object"&&d>=4&&EL({...e,drawDefinition:U,matchUpType:g}),{existingDrawDefinition:!!S,qualifyingConflicts:R,positioningReports:w,drawDefinition:U,structureId:T,...Z,conflicts:D}}function fee({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Je,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:s},l)=>({[s]:l+1})));n=n||t.scaleName;let o=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:a[s],eventType:t.eventType,scaleType:Al,scaleName:n,scaleDate:o}],participantId:s}))}}function PCe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:o,event:s,stage:l,sortDescending:u,scaleSortMethod:c}){let d=NR({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:o,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:m,stageEntries:h}=d;if(!h||!m)return{error:se};let f=$h({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=fee({scaleAttributes:r,scaledEntries:f,stageEntries:h,seedsCount:m,scaleName:n});return{scaleItemsWithParticipantIds:g}}var gee={};bt(gee,{addDrawEntries:()=>TL,addEventEntries:()=>Ks,addEventEntryPairs:()=>wee,destroyPairEntries:()=>fJ,destroyPairEntry:()=>CL,getEntriesAndSeedsCount:()=>NR,getMaxEntryPosition:()=>H_,modifyEntriesStatus:()=>c0,modifyEventEntries:()=>Uee,mutate:()=>vee,promoteAlternate:()=>yee,promoteAlternates:()=>s$,query:()=>see,removeDrawEntries:()=>bee,removeEventEntries:()=>Cw,setEntryPosition:()=>o$,setEntryPositions:()=>Iee});var vee={};bt(vee,{addDrawEntries:()=>TL,addEventEntries:()=>Ks,addEventEntryPairs:()=>wee,destroyPairEntries:()=>fJ,destroyPairEntry:()=>CL,modifyEntriesStatus:()=>c0,modifyEventEntries:()=>Uee,promoteAlternate:()=>yee,promoteAlternates:()=>s$,removeDrawEntries:()=>bee,removeEventEntries:()=>Cw,setEntryPosition:()=>o$,setEntryPositions:()=>Iee});function o$({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let o="setEntryPositions";if(!t)return{error:ve};if(!i)return te({result:{error:hr},stack:o});if(r!==void 0&&!Number.isSafeInteger(r))return{error:se,entryPosition:r};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let s=l=>{l.entries.forEach(u=>{u.entryPosition===r&&u.participantId!==i&&(u.entryPosition+=.1)})};return n||(a!=null&&a.entries&&(s(a),a.entries=ws({entries:a.entries})),e!=null&&e.entries&&(s(e),e.entries=ws({entries:e.entries}))),{...Z}}function Iee({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:se};for(let n of e){let{participantId:a,entryPosition:o}=n,s=o$({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:o,event:r});if(s.error)return s}return r!=null&&r.entries&&(r.entries=ws({entries:r.entries})),i!=null&&i.entries&&(i.entries=ws({entries:i.entries})),{...Z}}function yee(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:se,participantId:e}:s$({...t,participantIds:[e].filter(Boolean)})}function s$({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Ae,eventId:a,event:o}){if(!t)return{error:ve};if(!Array.isArray(i))return{error:se,participantIds:i};if(!o)return{error:vi};let s="promoteAlternates";if(o){let l=W2({element:o,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=W2({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?te({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...Z},stack:s}):l}return{...Z}}function W2({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===Wo),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),o=n.reduce((d,p)=>{let{entryPosition:m}=p;return isNaN(m)&&d||(!d||m<d.entryPosition)&&p||d},void 0),s=a.length?a:[o].filter(Boolean);if(!(s!=null&&s.length))return{error:l9};let l=s.filter(({entryStatus:d})=>d!==Wo);if(l.length)return{error:nM,invalidEntryStatus:l};let u=s.filter(({entryStage:d})=>d&&d!==r);if(u.length)return{error:Awe,invalidStage:u};let c=e&&s.filter(d=>d.stageSequence!==e);if(c!=null&&c.length)return{error:Owe,invalidStageSequence:c};for(let d of s){d.entryStatus=ca;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(h=>{h.entryStatus===Wo&&h.entryPosition>p&&(h.entryPosition=h.entryPosition-1)});let m=Math.max(...i.entries.filter(h=>h.entryStatus===ca&&!isNaN(h.entryPosition)).map(({entryPosition:h})=>Qe(h||0)),0);d.entryPosition=m||0}return{...Z}}function bee({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){var o;if(!a)return{error:vi};if(!r)return{error:xs};if(!(e!=null&&e.length))return{error:Zc};let s=Np({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(Nn(s,e))return{error:sv};let l=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:u}=Hi({event:a}),c=(o=u==null?void 0:u.flights)==null?void 0:o.find(d=>d.drawId===r);return c!=null&&c.drawEntries&&(c.drawEntries=c.drawEntries.filter(l),t&&(c.drawEntries=ws({entries:c.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(l),t&&(i.entries=ws({entries:i.entries}))),{...Z}}function dl(t){var e,i,r,n,a;let o="addParticipant",{allowDuplicateParticipantIdPairs:s,returnParticipant:l,disableNotice:u,pairOverride:c,participant:d}=t,p=t.tournamentId?(e=t.tournamentRecords)==null?void 0:e[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((i=t.tournamentRecords)==null?void 0:i[t.activeTournamentId]));if(!p)return{error:ve};if(!d)return te({result:{error:vh},stack:o});d.participantId||(d.participantId=Ht()),p.participants||(p.participants=[]);let{participantId:m,individualParticipantIds:h}=d;if(p.participants.reduce((b,S)=>S.participantId===m||b,!1))return{error:r9};let{participantType:f,participantRole:g}=d;if(!f||!Object.keys(tI).includes(f))return{error:Ms,participantType:f};if(!g)return{error:i9};let v=p.participants||[],y=v.filter(b=>b.participantType===Dt).map(b=>b.participantId);if(f!==Dt&&d.person)return{error:se,person:d.person};if(h&&!Array.isArray(h))return{error:se,individualParticipantIds:h};if(f===ft){if(d.person)return{error:se,person:d.person};if(d.individualParticipantIds){if(d.individualParticipantIds.length!==2&&!c)return te({info:"PAIR must be 2 individualParticipantIds",result:{error:ya},stack:o});{let w=v.filter(U=>U.participantType===Dt).map(U=>U.participantId);if(!Array.isArray(d.individualParticipantIds))return te({result:{error:ya},stack:o});if(!d.individualParticipantIds.reduce((U,T)=>w.includes(T)&&U,!0))return te({result:{error:ya},stack:o})}}else return te({result:{error:Zc},stack:o});let b=v.filter(w=>w.participantType===ft).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),S=d.participantType===ft&&b.find(w=>ji(w.individualParticipantIds,d.individualParticipantIds).length===2);if(S&&!s)return{...Z,existingParticipant:!0,participant:l&&Ne(S.participant)};if(!d.participantName){let w=v.filter(T=>{var D;return(D=d.individualParticipantIds)==null?void 0:D.includes(T.participantId)}),U=w.map(T=>{var D;return(D=T.person)==null?void 0:D.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(U+="/Unknown"),d.participantName=U}}else if(f===Dt){if(!((r=d.person)!=null&&r.standardFamilyName)||!((n=d.person)!=null&&n.standardGivenName))return{error:s9};if(!d.participantName){let b=`${d.person.standardFamilyName.toUpperCase()}, ${d.person.standardGivenName}`;d.participantName=b}}else if(f&&[Xt,Ja].includes(f)){if(h||(d.individualParticipantIds=[]),(a=d.individualParticipantIds)==null?void 0:a.length)for(let b of d.individualParticipantIds){if(typeof b!="string")return te({result:{participantId:b,error:se},stack:o});if(!y.includes(b))return te({result:{participantId:b,error:Wi},stack:o})}}else return{error:Ms};p.participants.push(d),u||ut({payload:{tournamentId:p.tournamentId,participants:[d]},topic:kc});let I={participant:l&&Ne(d),...Z};return He(I)}function as({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:ve};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=Ht())});let a=r.filter(d=>!n.includes(d.participantId)),o=r.filter(d=>n.includes(d.participantId)),s=a.filter(d=>d.participantType===Dt),l=a.filter(d=>d.participantType!==Dt),u=s.concat(...l),c=[];if(u.length){for(let p of u){let m=dl({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(m.error)return m;m.success&&!m.existingParticipant&&c.push(m.participant)}c.length&&ut({topic:kc,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&Ne(c),addedCount:c.length,...Z};return o.length&&Object.assign(d,{notAdded:o,info:lP}),He(d)}else return{info:"No new participants to add",addedCount:0,...Z}}function wee(t){let e=We(t,[{[wr]:!0,[ed]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=Wo,participantIdPairs:n=[],entryStage:a=Ae,tournamentRecord:o,drawDefinition:s,event:l,uuids:u}=t;if(l.eventType!==ei)return{error:Gl};let c=[],d=new Map;for(let b of o.participants??[]){let{participantType:S,participantId:w,person:U,individualParticipantIds:T}=b;S===Dt&&U!=null&&U.sex?d.set(w,U.sex):S===ft&&T&&c.push(T)}let p=n.filter(b=>{if(b.length!==2)return!0;if(!l.gender||l.gender===Ns)return!1;if(!d.has(b[0])||!d.has(b[1]))return!0;let S=b.map(U=>d.get(U)),w=l.gender===Zt&&(S[0]!==Zt||S[1]!==Zt)||l.gender===mi&&(S[0]!==mi||S[1]!==mi);return l.gender===jn&&(S.sort(XP),(S[0]!==mi||S[1]!==Zt)&&(w=!0)),w});if(p.length)return{error:ya,invalidParticipantIdPairs:p};let m=n.map(b=>({participantId:(u==null?void 0:u.pop())??Ht(),participantRole:en,individualParticipantIds:b,participantType:ft})),h=i?m:m.filter(b=>!c.find(S=>ji(S,b.individualParticipantIds).length===2)),f,g=[];if(h){let b=as({allowDuplicateParticipantIdPairs:i,participants:h,returnParticipants:!0,tournamentRecord:o});if(b.error)return b;g=b.participants||[],f=b.info}let v=n.map(b=>{let S=g.find(U=>ji(U.individualParticipantIds,b).length===2);if(S)return S;let{participant:w}=ns({tournamentRecord:o,participantIds:b});return w}).map(b=>b.participantId),y=Ks({participantIds:v,tournamentRecord:o,drawDefinition:s,entryStatus:r,entryStage:a,event:l});h.length&&ut({payload:{participants:h},topic:kc});let I=h.map(Tt);return{...y,info:f,newParticipantIds:I}}function Uee({entryStatus:t=ca,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Ae,tournamentRecord:n,event:a}){if(!n)return{error:ve};if(!a)return{error:vi};let o=n.participants??[],s=o.filter(f=>f.participantType===Dt).map(f=>f.participantId),l=e.concat(...i).flat(1/0).filter(f=>!s.includes(f));if(l.length)return{error:ya,invalidParticipantIds:l};let u=i.filter(f=>f.length!==2);if(u.length)return{error:ya,invalidParticipantIdPairs:u};let c=o.filter(f=>f.participantType===ft).map(f=>f.individualParticipantIds),d=i.filter(f=>!c.find(g=>ji(g,f).length===2)).map(f=>({participantType:ft,participantRole:en,individualParticipantIds:f})),p=as({participants:d,tournamentRecord:n});if(p.error)return p;let m=i.map(f=>{let{participant:g}=ns({tournamentRecord:n,participantIds:f});return g}).map(f=>({participantId:f,entryStatus:t,entryStage:r})),h=e.map(f=>({entryStatus:Po,participantId:f,entryStage:r}));return a.entries=(a.entries??[]).filter(f=>f.entryStage===r),a.entries=a.entries.concat(...m,...h),{...Z}}var See={};bt(See,{addDrawDefinition:()=>Jw,addEvent:()=>Cv,addFlight:()=>$R,assignSeedPositions:()=>Fee,attachFlightProfile:()=>h$,categoryCanContain:()=>Qb,deleteDrawDefinitions:()=>FR,deleteEvents:()=>_ee,deleteFlightAndFlightDraw:()=>kee,deleteFlightProfileAndFlightDraws:()=>Eee,generate:()=>Tee,generateEventsFromTieFormat:()=>Pee,getCategoryAgeDetails:()=>Cm,getEvent:()=>a$,getEventProperties:()=>r$,getEventStructures:()=>eR,getEventTimeItem:()=>cw,getEvents:()=>n$,getFlightProfile:()=>Hi,getScaledEntries:()=>$h,modifyEvent:()=>$ee,modifyEventMatchUpFormatTiming:()=>Mee,modifyPairAssignment:()=>xee,mutate:()=>Ree,query:()=>mee,refreshEventDrawOrder:()=>m$,removeEventMatchUpFormatTiming:()=>LR,removeScaleValues:()=>f$,removeSeeding:()=>Lee,setEventDates:()=>d$,setEventDisplay:()=>_R,setEventEndDate:()=>c$,setEventStartDate:()=>u$,updateDrawIdsOrder:()=>p$,validateCategory:()=>QI});var Tee={};bt(Tee,{generateEventsFromTieFormat:()=>Pee});function RCe({tournamentId:t,event:e}){return e?(ut({payload:{tournamentId:t,event:e},key:e.eventId,topic:fX}),{...Z}):{error:vi}}var CCe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},ECe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},MCe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},Dee={COLLEGE_D3:CCe,COLLEGE_DEFAULT:ECe,COLLEGE_JUCO:MCe,DOMINANT_DUO:l8,DOMINANT_DUO_MIXED:r8,LAVER_CUP:m8,TEAM_DOUBLES_3_AGGREGATION:Z9,TIME_TENNIS_DUAL:n8,TIME_TENNIS_PRO_CIRCUIT:i8,USTA_BREWER_CUP:a8,USTA_OZAKI_CUP:o8,USTA_COLLEGE:u8,USTA_GOLD_TEAM_CHALLENGE:J9,USTA_INTERSECTIONAL:t8,USTA_LEVEL_1:c8,USTA_SECTION_BATTLE:e8,USTA_SOUTHERN_LEVEL_5:Q9,USTA_TOC:h8,USTA_WTT_ITT:d8,USTA_ZONAL:p8};function Cv({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){var n,a,o,s;if(!e)return{error:ve};if(e.events||(e.events=[]),!r)return{error:vi};let{startDate:l,endDate:u}=e;if(!i&&((n=r.entries)!=null&&n.length||(a=r.drawDefinitions)!=null&&a.length)){let d=He({drawDefinitions:!!((o=r.drawDefinitions)!=null&&o.length),entries:!!((s=r.entries)!=null&&s.length)});return{info:"entries/drawDefinitions cannot exist",error:se,context:d}}let c={eventType:Em,drawDefinitions:[],entries:[],startDate:l,endDate:u,...r};if(r.eventType===Ca){if(r.tieFormat){let d=qn({tieFormat:r.tieFormat});if(d.error)return d}else if(r.tieFormatName){if(!Dee[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:se};let d=Eu({isMock:e==null?void 0:e.isMock,namedFormat:r.tieFormatName,event:r});c.tieFormat=d}}if(c.eventId||(c.eventId=Ht()),e.events.reduce((d,p)=>d||p.eventId===c.eventId,void 0))return{error:_K};{let d=c;if(e.events.push(d),!t){let{topics:p}=So();if(p.includes(FP)){let f=tu({event:r}).matchUps??[];xc({tournamentId:e==null?void 0:e.tournamentId,eventId:r.eventId,matchUps:f})}let{drawDefinitions:m,...h}=r;for(let f of m||[])lw({drawDefinition:f});RCe({tournamentId:e==null?void 0:e.tournamentId,event:h})}return{...Z,event:c}}}function Pee(t){var e,i,r,n;let a=We(t,[{[ag]:{[PP]:!0,[V8]:!0}},{[wr]:!0}]);if(a.error)return a;let o=t.tieFormat||Eu({namedFormat:t.tieFormatName}),s=t.uuids||[X9(o.collectionDefinitions.length)],l={[Zt]:[],[mi]:[]};if(t.addEntriesFromTeams){let c=(i=(e=t.tournamentRecord.participants)==null?void 0:e.filter(d=>d.participantType===Gn))==null?void 0:i.flatMap(d=>d.individualParticipantIds??[]);for(let d of t.tournamentRecord.participants??[])if(c!=null&&c.includes(d.participantId)){let p=(r=d.person)==null?void 0:r.sex;p&&[Zt,mi].includes(p)&&l[p].push(d.participantId)}}let u=[];for(let c of o.collectionDefinitions??[]){let d=((n=s==null?void 0:s.pop())==null?void 0:n.toString())||Ht(),p=c.matchUpType,m=c.gender,h={matchUpFormat:c.matchUpFormat,eventName:c.collectionName,category:c.category,gender:m,eventType:p,eventId:d};if(t.addEntriesFromTeams){let f=p===Mu?Po:t.entryStatus||ca,g=m===jn?[...l[Zt],...l[mi]]:l[m]??[];if(g.length){let v=Ks({participantIds:g,entryStatus:f,event:h});if(v.error)return v}}if(u.push(h),t.addEvents!==!1){let f=Cv({internalUse:!0,tournamentRecord:t.tournamentRecord,event:h});if(f.error)return f}}return{...Z,events:u}}var Ree={};bt(Ree,{addDrawDefinition:()=>Jw,addEvent:()=>Cv,addFlight:()=>$R,assignSeedPositions:()=>Fee,attachFlightProfile:()=>h$,deleteDrawDefinitions:()=>FR,deleteEvents:()=>_ee,deleteFlightAndFlightDraw:()=>kee,deleteFlightProfileAndFlightDraws:()=>Eee,modifyEvent:()=>$ee,modifyEventMatchUpFormatTiming:()=>Mee,modifyPairAssignment:()=>xee,refreshEventDrawOrder:()=>m$,removeEventMatchUpFormatTiming:()=>LR,removeScaleValues:()=>f$,removeSeeding:()=>Lee,setEventDates:()=>d$,setEventDisplay:()=>_R,setEventEndDate:()=>c$,setEventStartDate:()=>u$,updateDrawIdsOrder:()=>p$,validateCategory:()=>QI});function Ev({removePriorValues:t=!0,status:e=Za,statusObject:i,event:r}){if(!At(i))return{error:se};let n=Co({event:r,status:e}),a=`${ad}.${od}`,o={itemValue:{[e]:{...n,...i}},itemType:a};return _h({timeItem:o,removePriorValues:t,event:r})}function Mv(t){var e,i,r,n,a,o,s;let l=We(t,[{[wr]:!0,[ed]:!0},{eventDataParams:!1,[Jn]:ta}]);if(l.error)return l;let{includePositionAssignments:u,removePriorValues:c,tournamentRecord:d,status:p=Za,event:m,drawIdsToRemove:h,drawIdsToAdd:f}=t,{appliedPolicies:g}=Bt({tournamentRecord:d,event:m}),v={...g,...t.policyDefinitions},y=((e=m==null?void 0:m.drawDefinitions)==null?void 0:e.map(({drawId:R})=>R))??[],I=t.drawDetails?Object.keys(t.drawDetails):[],b=I.length?[]:t.drawIds,S=(f??[]).concat(...h??[],...b??[],...I),w=S.filter(R=>!y.includes(R));if(w.length)return te({result:{error:Va},context:{invalidDrawIds:w}});let U=Co({event:m,status:p}),T=Object.keys((U==null?void 0:U.drawDetails)||{}).filter(R=>y.includes(R)).reduce((R,N)=>(R[N]=U.drawDetails[N],R),{});for(let R of y)if((!S.length||S.includes(R))&&(h!=null&&h.includes(R)||b!=null&&b.length&&!b.includes(R)?T[R]={...T[R],publishingDetail:{published:!1}}:(f!=null&&f.includes(R)||b!=null&&b.includes(R)||!(b!=null&&b.length))&&(T[R]={...T[R],publishingDetail:{published:!0}})),(i=t.drawDetails)==null?void 0:i[R]){let N=t.drawDetails[R],A=N.structureDetails??T[R].structureDetails,M=N.stageDetails??T[R].stageDetails??{},{structureIdsToRemove:E=[],structureIdsToAdd:O=[],publishingDetail:k={},stagesToRemove:x=[],stagesToAdd:F=[]}=N;if((O||F)&&(k.published=!0),T[R]={publishingDetail:k,structureDetails:A,stageDetails:M},O.length||E.length){let _=(((n=(r=m==null?void 0:m.drawDefinitions)==null?void 0:r.find(B=>B.drawId===R))==null?void 0:n.structures)??[]).map(({structureId:B})=>B),L=(O??[]).concat(E??[]).filter(B=>!_.includes(B));if(L.length)return te({result:{error:Ni},context:{invalidStructureIds:L}});A=A??{};for(let B of _)E.includes(B)?A[B]={published:!1}:A[B]={published:!0};T[R].structureDetails=A}let $=(((o=(a=m==null?void 0:m.drawDefinitions)==null?void 0:a.find(_=>_.drawId===R))==null?void 0:o.structures)??[]).map(({stage:_})=>_);if(F.length){for(let _ of F)M[_]={published:!0};for(let _ of $)M[_]||(M[_]={published:!1})}if(F.length||x.length){for(let _ of x)M[_]={published:!1};for(let _ of $)M[_]||(M[_]={published:!0})}(F.length||x.length)&&(T[R].stageDetails=M)}Ev({statusObject:{drawDetails:T},removePriorValues:c,status:p,event:m});let{topics:D}=So(),P=D.includes(fM),C=P||t.returnEventData?(s=DR({includePositionAssignments:u,...t.eventDataParams,usePublishState:!0,tournamentRecord:d,policyDefinitions:v,event:m}))==null?void 0:s.eventData:void 0;return P&&ut({payload:{eventData:C,tournamentId:d.tournamentId},topic:fM}),{...Z,eventData:C}}var Cee="deleteDrawDefinitions",jM="autoSchedulingAudit",oS="deleteEvents",NCe={AUTO_SCHEDULING_AUDIT:jM,DELETE_EVENTS:oS,DELETE_DRAW_DEFINITIONS:Cee};function FR(t){var e,i,r,n,a;if(!t.tournamentRecord)return{error:ve};let o="deleteDrawDefinitions",s=t.drawIds??[],l=t.event,{autoPublish:u=!0,tournamentRecord:c,auditData:d,eventId:p,force:m}=t,{appliedPolicies:h}=Bt({tournamentRecord:c,event:l}),f={...h,...t.policyDefinitions},g=Array.isArray(s)?s[0]:void 0;if(!l){let N=Kn({tournamentRecord:c,eventId:p,drawId:g});if(N.error)return N;l=N.event}let v=[],y=[],I=[];if(!(l!=null&&l.drawDefinitions))return te({info:"event has no drawDefinition",result:{...Z},stack:o});let b=l.drawDefinitions.map(({drawId:N})=>N);if(s.length||(s=b),s=s.filter(N=>b.includes(N)),!s.length)return te({info:"nothing to do; no matching drawIds in event.",result:{...Z},stack:o});let S=Ne(Hi({event:l}).flightProfile,!1,!0),w=({participantId:N,drawPosition:A,qualifier:M,bye:E})=>({bye:E,qualifier:M,drawPosition:A,participantId:N}),U=m??((i=(e=h==null?void 0:h[fo])==null?void 0:e.allowDeletionWithScoresPresent)==null?void 0:i.drawDefinitions),T=Co({event:l})??{},D=T.drawIds??(T.drawDetails&&Object.keys(T.drawDetails))??[],P,C=[],R=l.drawDefinitions.filter(N=>{var A,M,E,O,k,x,F,$;if(s.includes(N.drawId)){let _=((A=Pn({event:l,drawDefinition:N}))==null?void 0:A.matchUps)??[];if(_.some(({score:re})=>yr({score:re}))&&!U)return C.push(N.drawId),!0;let{drawId:L,drawType:B,drawName:V}=N,G=(M=S==null?void 0:S.flights)==null?void 0:M.find(re=>re.drawId===N.drawId);G&&(G.drawEntries=(E=G.drawEntries)==null?void 0:E.filter(re=>cs.includes(re.entryStatus))),D.includes(L)&&(D=D.filter(re=>re!==L),P=!0);let j=(k=(O=rs({stageSequence:1,drawDefinition:N,stage:Ae}))==null?void 0:O.structures)==null?void 0:k[0],z=(F=(x=j?my({structureId:j.structureId,tournamentRecord:c,drawDefinition:N}):void 0)==null?void 0:x.positionAssignments)==null?void 0:F.map(w),q=($=rs({stage:Ke,drawDefinition:N}))==null?void 0:$.structures,W=q!=null&&q.length?q.map(re=>{var K;let H=re.stageSequence;return{positionAssignments:(K=my({structureId:re.structureId,tournamentRecord:c,drawDefinition:N}))==null?void 0:K.positionAssignments.map(w),stageSequence:H}}):void 0,Y={action:Cee,payload:{drawDefinitions:[N],eventId:p??(l==null?void 0:l.eventId),auditData:d}};I.push(Y),v.push(He({tournamentId:c.tournamentId,eventId:p??(l==null?void 0:l.eventId),qualifyingPositionAssignments:W,positionAssignments:z,auditData:d,drawType:B,drawName:V,drawId:L})),_==null||_.forEach(({matchUpId:re})=>y.push(re))}return!s.includes(N.drawId)});if(C.length&&!m)return te({context:{drawIdsWithScoresPresent:C},result:{error:hP},stack:o});if(l.drawDefinitions=R,S&&id({event:l,extension:{name:is,value:S}}),qw({tournamentRecord:c}),P){let N={};for(let M of D)N[M]=((r=T.drawDetails)==null?void 0:r[M])??{published:!0};let A=Ev({statusObject:{drawDetails:N},event:l});if(A.error)return{error:A.error}}if(I.length)if(fP(fu)){let N=c.tournamentId;ut({topic:fu,payload:{tournamentId:N,detail:I}});let A=(((a=(n=Do({element:l,itemType:Rd}))==null?void 0:n.timeItem)==null?void 0:a.itemValue)||0)+1;bl({element:l,timeItem:{itemType:Rd,itemValue:A},removePriorValues:!0})}else ACe({appliedPolicies:h,event:l,deletedDrawsDetail:v,auditData:d});if(y.length&&Zu({tournamentId:c==null?void 0:c.tournamentId,matchUpIds:y}),s.forEach(N=>ASe({drawId:N})),u&&P){let N=Mv({...t.eventDataParams,drawIdsToRemove:s,policyDefinitions:f,tournamentRecord:c,event:l});if(N.error)return{...Z,info:N.error}}return{...Z}}function ACe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){var n;if(((n=t==null?void 0:t.audit)==null?void 0:n[Rd])===!1)return;let{extension:a}=vt({name:Rd,element:e}),o={...r,deletedDrawsDetail:i},s={value:Array.isArray(a==null?void 0:a.value)?a==null?void 0:a.value.concat(o):[o],name:Rd};_t({element:e,extension:s})}function Eee({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){var a;if(!e)return{error:ve};if(!r)return{error:vi};let{flightProfile:o}=Hi({event:r});if(o){let s=(a=o.flights)==null?void 0:a.map(({drawId:u})=>u).filter(Boolean),l=FR({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return l.error?l:AP({event:r,name:is})}return{...Z}}function l$(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,o=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(o).length)return{error:ki};let s=Object.keys(o).filter(u=>!n||n===u);if(n&&!s.includes(n))return{error:se};let l;for(let u of s){let c=o[u],{event:d}=Kn({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=OCe({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...Z}:{error:mo}}function OCe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:ve};if(r&&!Array.isArray(r))return{error:se};if(e&&!Array.isArray(e))return{error:se};let a=xu;if(n){let{extension:o}=vt({element:n,name:a}),s=(o==null?void 0:o.value)||{},l=q2({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});_t({element:n,extension:{name:a,value:l}})}else{let{extension:o}=vt({element:t,name:a}),s=(o==null?void 0:o.value)||{},l=q2({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});_t({extension:{name:a,value:l},element:t})}return{...Z}}function q2(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let o=(n==null?void 0:n.length)&&i.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==r)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let s=(a==null?void 0:a.length)&&e.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==r)}:l}).filter(({matchUpFormatCodes:l,averageTimes:u})=>(l==null?void 0:l.length)||u).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:(o==null?void 0:o.length)&&o||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function Mee(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:o,event:s}=t;if(!e)return{error:ve};if(!Ra({matchUpFormat:n}))return{error:se};if(!s)return{error:vi};let{averageTimes:l=[],recoveryTimes:u=[]}=AR({tournamentRecord:e,matchUpFormat:n,event:s}),c=s.category,d=(c==null?void 0:c.categoryName)||(c==null?void 0:c.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},m={categoryNames:[d],minutes:{}},h=I=>{var b,S;if((b=I.categoryTypes)!=null&&b.includes(a)&&console.log("encountered:",{categoryType:a}),!((S=I.categoryNames)!=null&&S.includes(d)&&(I.categoryNames=I.categoryNames.filter(w=>w!==d),p={minutes:I.minutes,categoryNames:[d]},!I.categoryNames.length)))return I},f=r&&!isNaN(Qe(r)),g=i&&!isNaN(Qe(i)),v=l.map(h).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length}),y=u.map(h).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length});return f&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||ii]:r}),v.push(p)),g&&(Object.assign(m.minutes,{[(s==null?void 0:s.eventType)||ii]:i}),y.push(m)),!f&&!g?{error:se}:l$({averageTimes:f&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:n,eventId:o,event:s})}function LR(t){if(t.event)return Y2({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=We(t,[{[fn]:!0,[W8]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=Kn({tournamentRecord:n,eventId:r});if(a)return Y2({event:a})}}return{error:mo}}function Y2({event:t}){return AP({event:t,name:xu})}var kCe="MON",xCe="TUE",FCe="WED",LCe="THU",_Ce="FRI",$Ce="SAT",BCe="SUN",Nee={MON:kCe,TUE:xCe,WED:FCe,THU:LCe,FRI:_Ce,SAT:$Ce,SUN:BCe};function Aee(t){return!Array.isArray(t)||dt(t).length!==t.length?!1:t.every(e=>Object.keys(Nee).includes(e))}function u$({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:ve};if(!e)return{error:vi};if(!al.test(i))return{error:xr};let r=Oee(t);if(r.error)return r;let{tournamentStartDate:n,tournamentEndDate:a}=r,o=new Date(mt(i)).getTime();if(!n||!a||o<n||o>a)return{error:xr};let s=e.endDate&&new Date(mt(e.endDate)).getTime();return s&&o>s&&(e.endDate=i),e.startDate=i,{...Z}}function c$(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:ve};if(!i)return{error:vi};if(!al.test(r))return{error:xr};let n=Oee(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:o}=n,s=new Date(mt(r)).getTime();if(!a||!o||s<a||s>o)return{error:xr};let l=i.startDate&&new Date(mt(i.startDate)).getTime();return l&&s<l&&(i.startDate=r),i.endDate=r,{...Z}}function d$(t){var e;let i=We(t,[{tournamentRecord:!0,event:!0},{[Xr]:u=>al.test(u),[Ha]:xr,startDate:!1,endDate:!1},{[Xr]:u=>u.filter(Boolean).every(c=>al.test(c)),[Ha]:xr,activeDates:!1},{[Xr]:Aee,weekdays:!1}]);if(i.error)return i;let{tournamentRecord:r,weekdays:n,event:a,startDate:o,endDate:s}=t,l=(e=t.activeDates)==null?void 0:e.filter(Boolean);if(o&&s){let u=new Date(mt(o)).getTime(),c=new Date(mt(s)).getTime();if(u>c)return{error:se}}if(l){let u=o||r.startDate,c=s||r.endDate,d=!u||l.every(m=>new Date(m)>=new Date(u)),p=!c||l.every(m=>new Date(m)<=new Date(c));if(!d||!p)return{error:xr}}if(o){let u=u$({tournamentRecord:r,event:a,startDate:o});if(u.error)return u}if(s){let u=c$({tournamentRecord:r,event:a,endDate:s});if(u.error)return u}return l&&(a.activeDates=l),n&&(a.weekdays=n),{...Z}}function Oee(t){let{startDate:e,endDate:i}=t;return!al.test(e)||!al.test(i)?te({result:{error:ZK},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(mt(e)).getTime(),tournamentEndDate:new Date(mt(i)).getTime()}}function p$({event:t,orderedDrawIdsMap:e}){var i,r;if(typeof t!="object")return{error:vi};if(!e)return{error:Je,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:se,info:"orderedDrawIdsMap must be an object"};let n=Object.values(e);if(!n.every(o=>!isNaN(o)))return{error:se,info:"drawOrder must be numeric"};if(dt(n).length!==n.length)return{error:se,info:"drawOrder values must be unique"};if((i=t.drawDefinitions)!=null&&i.length){let o=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&ji(o,s).length!==o.length)return{error:se,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:a}=Hi({event:t});return(r=a==null?void 0:a.flights)==null||r.forEach(o=>{o.flightNumber=e[o.drawId]}),{...Z}}function m$({tournamentRecord:t,event:e}){var i;if(!t)return{error:ve};if(!e)return{error:vi};let{flightProfile:r}=Hi({event:e}),n=(r==null?void 0:r.flights)&&Object.assign({},...r.flights.sort((a,o)=>a.flightNumber-o.flightNumber).map((a,o)=>({[a.drawId]:o+1})))||((i=e.drawDefinitions)==null?void 0:i.length)&&Object.assign({},...e.drawDefinitions.sort((a,o)=>a.drawOrder-o.drawOrder).map((a,o)=>({[a.drawId]:o+1})))||void 0;return n?p$({event:e,orderedDrawIdsMap:n}):{...Z}}function kee({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){var o,s;if(!e)return{error:ve};if(!r)return{error:xs};if(!n)return{error:vi};let{flightProfile:l}=Hi({event:n});if(l&&(o=l.flights)!=null&&o.find(u=>u.drawId===r)){let u=l.flights.filter(d=>d.drawId!==r),c={name:is,value:{...l,flights:u}};id({event:n,extension:c})}if((s=n.drawDefinitions)!=null&&s.find(u=>u.drawId===r)){let u=FR({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(u.error)return u}return m$({tournamentRecord:e,event:n})}function xee(t){var e,i;let r=We(t,[{[ed]:!0,[wr]:!0,[OF]:!1},{replacementIndividualParticipantId:!0,[Xr]:y=>Di(y),existingIndividualParticipantId:!0,[zo]:hr,participantId:!0}]),{replacementIndividualParticipantId:n,existingIndividualParticipantId:a,tournamentRecord:o,drawDefinition:s,participantId:l,event:u,uuids:c}=t;if(r.error)return r;if((u==null?void 0:u.eventType)!==ho)return{error:Gl};if(!(((e=u==null?void 0:u.entries)==null?void 0:e.filter(({entryStatus:y})=>[Po,Cp].includes(y)).map(({participantId:y})=>y))||[]).includes(n))return{error:Es};let d=(o.participants||[]).find(y=>y.participantId===l);if((d==null?void 0:d.participantType)!==ft)return{error:gh,participant:d};let p=d.individualParticipantIds,m=[n,...p.filter(y=>y!==a)],{participant:h}=ns({participantIds:m,tournamentRecord:o}),f;if(h)f=h.participantId;else{let y={participantId:c==null?void 0:c.pop(),participantRole:en,individualParticipantIds:m,participantType:ft},I=dl({participant:y,returnParticipant:!0,tournamentRecord:o});if(I.error)return I;f=I.participant.participantId}let{flightProfile:g}=Hi({event:u});if(s){let y=(i=g==null?void 0:g.flights)==null?void 0:i.find(({drawId:I})=>I===s.drawId);y&&(y.drawEntries=y.drawEntries.map(I=>I.participantId===l?{...I,participantId:f}:I)),s.entries=s.entries.map(I=>I.participantId===l?{...I,participantId:f}:I);for(let I of s.structures||[])if(I.structures){I.positionAssignments=void 0;for(let b of I.structures)b.positionAssignments=b.positionAssignments.map(S=>S.participantId===l?{...S,participantId:f}:S)}else I.positionAssignments&&(I.positionAssignments=I.positionAssignments.map(b=>b.participantId===l?{...b,participantId:f}:b))}u.entries=u.entries.map(y=>y.participantId===l&&{...y,participantId:f}||y.participantId===n&&{...y,participantId:a}||y);let v=o.events.some(({entries:y,eventId:I,drawDefinitions:b})=>u.eventId===I?b.some(({drawId:S,entries:w})=>S===(s==null?void 0:s.drawId)?!1:w==null?void 0:w.find(U=>U.participantId===l)):y==null?void 0:y.find(S=>S.participantId===l));if(!v){let y=xh({addIndividualParticipantsToEvents:!1,participantIds:[l],tournamentRecord:o});if(y.error)return y}return{...Z,participantOtherEntries:v,newPairParticipantId:f}}function Jw(t){var e,i,r,n,a,o,s,l,u,c,d,p;let{flight:m,suppressNotifications:h,modifyEventEntries:f,existingDrawCount:g,allowReplacement:v,checkEntryStatus:y,tournamentRecord:I,drawDefinition:b,event:S}=t;if(!b)return{error:$e};if(!S)return{error:vi};S.drawDefinitions||(S.drawDefinitions=[]);let{drawId:w,drawName:U,entries:T}=b,{entries:D}=S,P=0;if(g!==void 0&&g!==S.drawDefinitions.length)return{error:se,info:"drawDefintions count mismatch"};let{flightProfile:C}=Hi({event:S}),R=m&&((e=C==null?void 0:C.flights)==null?void 0:e.find(B=>B.flightNumber===m.flightNumber)),N=(n=(r=(i=C==null?void 0:C.links)==null?void 0:i.find(B=>{var V;return((V=B==null?void 0:B.target)==null?void 0:V.drawId)===w}))==null?void 0:r.source)==null?void 0:n.drawId;if(N&&!S.drawDefinitions.find(B=>B.drawId===N))return te({result:{error:$e},info:{sourceDrawId:N}});if(R&&R.drawId!==b.drawId)return te({result:{error:am},info:{relevantFlight:R}});let A=T==null?void 0:T.every(({participantId:B,entryStatus:V})=>{let G=R==null?void 0:R.drawEntries.find(j=>j.participantId===B);return!V||(G==null?void 0:G.entryStatus)===V}),M=!y||D&&(T==null?void 0:T.every(({participantId:B,entryStatus:V,entryStage:G})=>{var j;return((j=D.find(z=>z.participantId===B&&(!z.entryStage||z.entryStage===G)))==null?void 0:j.entryStatus)===V}));if(R&&!A)return te({result:{error:am},context:{drawEntriesPresentInFlight:A,matchingEventEntries:M,relevantFlight:R},info:"Draw entries are not present in flight or do not match entryStatuses"});if(f&&(T==null||T.filter(Boolean).forEach(B=>{if(B!=null&&B.entryStatus&&cs.includes(B==null?void 0:B.entryStatus)){let V=D==null?void 0:D.filter(Boolean).find(G=>G.participantId===B.participantId);V&&B.entryStatus&&(V==null?void 0:V.entryStatus)!==B.entryStatus&&(V.entryStatus=B.entryStatus,P+=1)}})),D&&!M)return te({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:M,eventEntries:D},error:am}});let E=((o=(a=C==null?void 0:C.flights)==null?void 0:a.map(({flightNumber:B})=>!isNaN(B)&&Qe(B)))==null?void 0:o.filter(Boolean))||[],O=((s=S.drawDefinitions.map(({drawOrder:B})=>B&&Qe(B)))==null?void 0:s.filter(Boolean))||[],k=Math.max(0,...O,...E)+1,x=(l=C==null?void 0:C.flights)==null?void 0:l.find(B=>B.drawId===w),F;if(x){x.drawName=b.drawName,F={name:is,value:{...C,flights:C.flights}};let B=x.flightNumber;B&&!O.includes(B)?k=B:x.flightNumber=k}else{let B=(C==null?void 0:C.flights)||[];B.push({manuallyAdded:!0,flightNumber:k,drawEntries:T,drawName:U,drawId:w}),F={name:is,value:{...C||{},flights:B}}}id({event:S,extension:F}),Object.assign(b,{drawOrder:k});let $=S.drawDefinitions.find(B=>B.drawId===w),_=I==null?void 0:I.tournamentId,L=S.eventId;if($){if(!v)return{error:CK};let B=((c=(u=Pn({drawDefinition:$}))==null?void 0:u.matchUps)==null?void 0:c.map(Dr))??[],V=(d=Pn({drawDefinition:b}))==null?void 0:d.matchUps;if(!h){B!=null&&B.length&&Zu({matchUpIds:B,action:"modifyDrawDefinition",tournamentId:_,eventId:L}),V!=null&&V.length&&xc({matchUps:V,tournamentId:_,eventId:L}),S.drawDefinitions=S.drawDefinitions.map(j=>j.drawId===w?b:j);let G=(p=b.structures)==null?void 0:p.map(({structureId:j})=>j);li({drawDefinition:b,tournamentId:_,structureIds:G,eventId:L})}}else if(S.drawDefinitions.push(b),!h){let{matchUps:B}=Pn({drawDefinition:b,event:S});B&&xc({tournamentId:I==null?void 0:I.tournamentId,matchUps:B}),lw({drawDefinition:b,tournamentId:_,eventId:L})}return{...Z,modifiedEventEntryStatusCount:P}}function Fee(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:u}=t,c=0;if(!(s!=null&&s.length))return{error:zx};if(!r)return{error:ve};if(!l)return{error:xs};let d=go({provisionalPositioning:e,drawDefinition:n,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:m}=d,h=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:y}=v;m&&y<=m&&(!i||h[y])&&(h[y]=v)});let f=Object.values(h),g=f.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==vK(g).length)return{error:EK};for(let v of f){let y=Uv({...v,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,event:u});if(y!=null&&y.error)return y;y!=null&&y.success&&c++}return c?{...Z,modifications:c}:{error:uv}}function h$({deleteExisting:t,event:e,flightProfile:i}){var r;let n="attachFlightProfile";if(!i)return te({result:{error:Je},stack:n});if(!e)return te({result:{error:vi},stack:n});let{flightProfile:a}=Hi({event:e});return a&&!t?te({result:{error:lF},stack:n}):(r=e.drawDefinitions)!=null&&r.length?te({result:{error:DK},stack:n}):(id({event:e,extension:{name:is,value:i}}),{flightProfile:Ne(i,!1,!0),...Z})}function VCe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var r;if(!t)return{error:ve};if(!i)return{error:Zc};if(!e)return{error:Je,info:"scaleAttributes required"};let{scaleType:n,eventType:a,scaleName:o}=e,s=[jX,n,a,o].join(".");return(r=t.participants)==null||r.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(u=>u&&(u==null?void 0:u.itemType)!==s))}),{...Z}}function f$({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:o}){var s;if(!a)return{error:vi};if(r&&!Array.isArray(r))return te({result:{error:se},info:tp("entryStatus"),stack:"removeScaleValues"});let l=a.entries;if(n){let{flightProfile:c}=Hi({event:a}),d=(s=c==null?void 0:c.flights)==null?void 0:s.find(p=>p.drawId===n);d?l=d.drawEntries:l=i==null?void 0:i.entries}let u=(l||[]).filter(c=>(!o||!c.entryStage||c.entryStage===o)&&(!r||r.includes(c.entryStatus))).map(Tt);return VCe({tournamentRecord:t,scaleAttributes:e,participantIds:u})}function _R({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=Za,event:n}){if(!e)return te({result:{error:ve}});if(!n)return te({result:{error:vi}});if(!At(i))return te({result:{error:Je}});if(At(i.draws))for(let o of Object.keys(i.draws)){let s=i.draws[o].scheduleDetails??[];if(s.length){let l=[];for(let u of s){let c=l.find(d=>gwe(d.attributes,u.attributes));c!=null&&c.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[o].scheduleDetails=l}}let a=Ev({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...Z}}function Lee({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:o}){var s,l;if(!t)return{error:ve};if(!a)return{error:vi};r=r||((s=a.category)==null?void 0:s.categoryName)||((l=a.category)==null?void 0:l.ageCategoryCode);let u={eventType:a.eventType,scaleType:Al,scaleName:r};return f$({tournamentRecord:t,scaleAttributes:u,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:o})}function _ee(t){let e=We(t,[{[wr]:!0},{eventIds:!0,[Jn]:cn}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],o=[],s=[],l=[];if(r.events=(r.events||[]).filter(u=>{if(n.includes(u.eventId)){let p={action:oS,payload:{events:[u]}};a.push(p),o.push({tournamentId:r.tournamentId,eventName:u.eventName,eventType:u.eventType,category:u.category,eventId:u.eventId,gender:u.gender})}let c=u.eventType===ho?(u.entries||[]).map(({entryStatus:p,participantId:m})=>p!==Po&&m).filter(Boolean):[],d=n.includes(u.eventId);return d?l.push(...c):s.push(...c),!d}),i){let u=l.filter(c=>!s.includes(c));r.participants=r.participants.filter(({participantId:c})=>!u.includes(c))}if(qw({tournamentRecord:r}),a.length)if(fP(fu)){let u=r.tournamentId;ut({topic:fu,payload:{type:oS,tournamentId:u,detail:a}})}else Bw({tournamentRecord:r,timeItem:{itemValue:o,itemType:oS}});return{...Z}}function $ee(t){var e,i,r;let n=We(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:ta}]);if(n.error)return n;let{eventUpdates:a,event:o}=t,s="modifyEvent",l=HCe(t),u=zCe({enteredParticipants:l}),{enteredParticipantGenders:c,enteredParticipantTypes:d}=u,p=(i=(e=Hi({event:o}))==null?void 0:e.flightProfile)==null?void 0:i.flights,m=!((r=o.drawDefinitions)!=null&&r.length)&&!(p!=null&&p.length),h=WCe({noFlightsNoDraws:m,enteredParticipantGenders:c,eventUpdates:a,stack:s});if(h.error)return h;let f=qCe({enteredParticipantTypes:d,eventUpdates:a,stack:s});if(f.error)return f;let g=jCe({...t,...u,enteredParticipants:l,stack:s});if(g.error)return g;let v=GCe({...t,stack:s});return v.error?v:(a.eventType&&(o.eventType=a.eventType),a.eventName&&(o.eventName=a.eventName),a.gender&&(o.gender=a.gender),{...Z})}function jCe(t){var e,i,r,n,a,o;let s=(e=t.eventUpdates)==null?void 0:e.category;if(!s)return{...Z};let l=QI({category:s});if(l.error)return l;if(t.event.eventType===ur){let u=((r=(i=t.event)==null?void 0:i.drawDefinitions)==null?void 0:r.map(p=>_s(p)))??[],c=_s(t.event),d=(((n=tu(t))==null?void 0:n.matchUps)??[]).map(p=>_s(p))??[];if(![c,...u,...d].filter(Boolean).every(p=>p.collectionDefinitions.every(m=>!m.category||Qb({category:t.eventUpdates.category,childCategory:m.category}))))return te({result:{error:qI},stack:t.stack})}if((a=t.enteredParticipants)!=null&&a.length){let u=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,c=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,d=t.enteredParticipants.map(h=>h.participantType===Dt?h:h.individualParticpants??[]).flat(),p=Cm({category:s,consideredDate:u}),m=Cm({category:s,consideredDate:c});if(p!=null&&p.ageMinDate||p!=null&&p.ageMaxDate||m!=null&&m.ageMinDate||m!=null&&m.ageMaxDate)for(let h of d){let f=(o=h.person)==null?void 0:o.birthDate;if(!f)return te({result:{error:YK},stack:t.stack});let g=new Date(f).getTime();if(p.ageMinDate||p.ageMaxDate){let v=new Date(p.ageMinDate).getTime(),y=new Date(p.ageMaxDate).getTime();if(g<v||g>y)return te({result:{error:rM},stack:t.stack})}if(m.ageMin||m.ageMax){let v=new Date(m.ageMinDate).getTime(),y=new Date(m.ageMaxDate).getTime();if(g<v||g>y)return te({result:{error:rM},stack:t.stack})}}}return{...Z}}function GCe(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=d$({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:r});if(a.error)return te({result:a,stack:n})}return{...Z}}function HCe(t){var e;let{tournamentRecord:i,event:r}=t,n=((e=r==null?void 0:r.entries)==null?void 0:e.filter(({entryStatus:a})=>{let o=a;return[...cs,Wo].includes(o)}).map(({participantId:a})=>a))??[];return n?Ai({participantFilters:{participantIds:n},withIndividualParticipants:!0,tournamentRecord:i}).participants??[]:[]}function zCe({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{var o,s;let l=(o=a.person)!=null&&o.sex?[a.person.sex]:((s=a.individualParticpants)==null?void 0:s.map(u=>{var c;return(c=u.person)==null?void 0:c.sex}))||[];return e.push(...l),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=dt(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function WCe({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||i.gender===Ns||e.length===1&&e[0]===i.gender||t&&i.gender===jn;return i.gender&&!n?te({context:{gender:i.gender,validGender:n},result:{error:Qv},stack:r}):{...Z}}function qCe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(ur)&&[ur]||t.includes(Dt)&&[ol]||t.includes(ft)&&[ho]||[ho,ol,ur]).includes(e.eventType??"");return e.eventType&&!r?te({context:{participantType:e.eventType,validEventType:r},result:{error:Gl},stack:i}):{...Z}}function $R({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){var o,s,l;let u="addFlight";if(!n)return te({result:{error:vi},stack:u});if(!i)return te({result:{error:Je},stack:u});if(e!=null&&e.length){let g=(n.entries??[]).map(Tt),v=e.map(Tt);if(ji(v,g).length!==v.length)return te({result:{error:se},stack:u})}let c=(o=Hi({event:n}))==null?void 0:o.flightProfile,d=((l=(s=c==null?void 0:c.flights)==null?void 0:s.map(({flightNumber:g})=>!isNaN(g)&&Qe(g)))==null?void 0:l.filter(Boolean))||[],p=Math.max(0,...d)+1,m={drawId:r||Ht(),flightNumber:p,drawEntries:e,drawName:i};if(a&&(m.stage=a),t&&(m.qualifyingPositions=t),((c==null?void 0:c.flights)||[]).find(({drawId:g})=>g===m.drawId))return te({result:{error:R9},stack:u});let h=((c==null?void 0:c.flights)||[]).concat(m),f={name:is,value:{...c||{},flights:h}};return id({event:n,extension:f})}var Bee={};bt(Bee,{drawMatic:()=>R_,garman:()=>qee,generateAdHocMatchUps:()=>pR,generateAdHocRounds:()=>P_,generateAndPopulatePlayoffStructures:()=>i_,generateCourts:()=>g$,generateDrawDefinition:()=>Xw,generateDrawMaticRound:()=>g_,generateDrawStructuresAndLinks:()=>m_,generateDrawTypeAndModifyDrawDefinition:()=>h_,generateFlightProfile:()=>XCe,generateLineUps:()=>Wee,generateQualifyingStructure:()=>qL,generateSeedingScaleItems:()=>fee,generateStatCrew:()=>JCe,generateVoluntaryConsolation:()=>YZ,roundRobinGroups:()=>rTe});var YCe="splitLevelBased",Vee="splitWaterfall",jee="splitShuttle",KCe={SPLIT_LEVEL_BASED:YCe,SPLIT_WATERFALL:Vee,SPLIT_SHUTTLE:jee};function XCe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:m}=t;if(!p)return{error:vi};let h=p.entries??[],{flightProfile:f}=Hi({event:p});if(f&&i&&!o)return{error:lF};let g=t.scaledEntries??$h({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:s,event:p,stage:m}).scaledEntries,v=g.map(Tt),y=Tn(h.filter(({participantId:P})=>!v.includes(P)).filter(P=>(!m||!P.entryStage||P.entryStage===m)&&(!P.entryStatus||Ep.includes(P.entryStatus)))),I=g.concat(...y),b=I.length,S=Math.ceil(b/u),w=Cr(I,S);c===Vee?w=K1(I,u):c===jee&&(w=K1(I,u,!0));function U(P){return(P||[]).map(({participantId:C,scaleValue:R})=>{let N=h.find(A=>A.participantId===C);return N!=null&&N.scaleValue&&R&&(N.scaleValue=R),N}).sort((C,R)=>C.scaleValue-R.scaleValue).map((C,R)=>(C.scaleValue&&(C.seedNumber=R+1),C))}let T=Te(0,u).map(P=>{let C=P+1;return{flightNumber:C,drawId:(d==null?void 0:d.pop())??Ht(),drawEntries:U(w[P]),drawName:(l==null?void 0:l.length)&&l[P]||`${e} ${C}`}}),D={scaleAttributes:n,splitMethod:c,flights:T};if(i){let P=h$({flightProfile:D,deleteExisting:o,event:p});return{splitEntries:ja()&&w||void 0,...P}}else return{flightProfile:D,...Z}}function Gee({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(o=>typeof o=="object"&&Object.keys(o).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return Hee({tagName:e,attributes:n,childArrays:i,childObjects:r})}function Hee(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,o=m=>{let h=Object.keys(m)[0],f=m[h];return{key:h,value:f}},s=r==null?void 0:r.map(({key:m,value:h})=>Hee({tagName:m,childObjects:h.map(o)})).join(`\r
`),l=n==null?void 0:n.map(({key:m,value:h})=>Gee({tagName:m,json:h??[]})).join(`\r
`),u=i==null?void 0:i.map(({key:m,value:h})=>`${m}="${h}"`).join(" "),c=u?` ${u}`:"";if(e==="childArray")return l;let d=l!=null&&l.length?`${a}${l}${a}`:"",p=s!=null&&s.length?`${a}${s}${a}`:"";return`<${e}${c}>${d}${p}</${e}>`}function JCe(t){var e,i,r;let n=We(t,[{[wr]:!0}]);if(n.error)return n;let{tournamentRecord:a}=t,{startDate:o,tournamentId:s,tournamentName:l}=a,{participantMap:u,matchUps:c,mappedMatchUps:d}=Ai({withMatchUps:!0,withEvents:!0,tournamentRecord:a}),p=a.participants.filter(w=>w.participantType===Xt),m=(c==null?void 0:c.filter(w=>w.matchUpType===Xt))??[],h=(m==null?void 0:m.reduce((w,U)=>{let T=(U==null?void 0:U.tieMatchUps)??[];return T&&[...w,...T]},[]))??[],f=(c==null?void 0:c.filter(w=>w.matchUpType===ii))??[],g=(c==null?void 0:c.filter(w=>w.matchUpType===ei))??[],v=h.length===f.length+g.length,y=m.length===1&&v,I={mappedMatchUps:d,participantMap:u,tournamentName:l,tournamentId:s,tournament:v?"N":"Y",startDate:o},b=[],S=[];if(y){let w=m[0],{json:U,xml:T}=K2({teamParticipants:p,teamMatchUp:w,...I,doubles:g,singles:f});S.push(U),b.push(T)}else for(let w of m){let U=(e=w==null?void 0:w.sides)==null?void 0:e.map(({participant:C})=>C==null?void 0:C.participantId).filter(Boolean);if((U==null?void 0:U.length)!==2)continue;let T=U.map(C=>{var R;return C&&((R=u==null?void 0:u[C])==null?void 0:R.participant)}),{xml:D,json:P}=K2({doubles:(i=w.tieMatchUps)==null?void 0:i.filter(C=>C.matchUpType===ei),singles:(r=w.tieMatchUps)==null?void 0:r.filter(C=>C.matchUpType===ii),teamParticipants:T,teamMatchUp:w,...I});S.push(P),b.push(D)}return{json:S,xml:b,...Z}}function K2({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:o,startDate:s,doubles:l,singles:u}){var c,d,p,m;let h=t==null?void 0:t.find(T=>{var D;return(D=T.participantRoleResponsibilities)==null?void 0:D.includes("Home")}),f=t==null?void 0:t.filter(T=>T.participantId!==(h==null?void 0:h.participantId)),g=Go(s,"/","MDY"),v=(h==null?void 0:h.participantName)||((c=f==null?void 0:f[1])==null?void 0:c.participantName),y=(h==null?void 0:h.participantId)||((d=f==null?void 0:f[1])==null?void 0:d.participantId),I=(p=f==null?void 0:f[0])==null?void 0:p.participantName,b=(m=f==null?void 0:f[0])==null?void 0:m.participantId,S={},w=t.map(T=>({team:{...eEe({teamParticipant:T,teamMatchUp:a,uniValues:S,participantMap:i,mappedMatchUps:e,homeid:y})}})),U=He({venue:{tournamentname:o?r:void 0,neutralgame:h?"N":"Y",gameid:n,officials:{},tournament:o,rules:{},homename:v,visname:I,homeid:y,visid:b,date:g},childArray:w,singles_matches:u==null?void 0:u.map(T=>X2({matchUp:T,homeid:y,uniValues:S})),doubles_matches:l==null?void 0:l.map(T=>X2({matchUp:T,homeid:y,uniValues:S}))});return{json:U,xml:Gee({json:U,tagName:"tngame"})}}function ZCe({homeid:t,uniValues:e,participant:i}){var r,n,a,o,s,l,u,c,d,p,m,h,f,g,v;if(!i)return{};let y=((r=i.individualParticipants)==null?void 0:r.length)===2,I=y?dt((n=i.individualParticipants)==null?void 0:n.map(A=>{var M,E;return(E=(M=A.teams)==null?void 0:M[0])==null?void 0:E.participantId})):[],b=y?dt((a=i.individualParticipants)==null?void 0:a.map(A=>{var M,E;return(E=(M=A.teams)==null?void 0:M[0])==null?void 0:E.teamId})):[],S=!y&&((s=(o=i.teams)==null?void 0:o[0])==null?void 0:s.participantId)||(I==null?void 0:I.length)===1&&I[0]||void 0,w=!y&&((u=(l=i.teams)==null?void 0:l[0])==null?void 0:u.teamId)||(b==null?void 0:b.length)===1&&b[0]||S,U=y?void 0:i.participantName,T=(d=(c=i.individualParticipants)==null?void 0:c[0])==null?void 0:d.participantName,D=(m=(p=i.individualParticipants)==null?void 0:p[1])==null?void 0:m.participantName,P=t&&(S===t?"H":"V")||"",C=y?void 0:e[S][i.participantId],R=e[S][(f=(h=i.individualParticipants)==null?void 0:h[0])==null?void 0:f.participantId],N=e[S][(v=(g=i.individualParticipants)==null?void 0:g[1])==null?void 0:v.participantId];return He({vh:P,uni:C,uni_1:R,uni_2:N,team:w,name:U,name_1:T,name_2:D})}function QCe({sets:t,sideNumber:e}){return Object.assign({},...(t==null?void 0:t.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s}=i,l=`set_${r}`,u=`tie_${r}`,c=e===1?n:a,d=e===1?o:s;return{[l]:c,[u]:d}}))??[])}function eEe({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){var o,s,l,u,c,d,p,m,h,f,g,v,y,I;let{participantId:b,participantName:S}=t,w=n&&(b===n?"H":"V")||"",U=(o=i==null?void 0:i[b])==null?void 0:o.matchUps,T=U&&Object.keys(U),D=(l=(s=e==null?void 0:e.sides)==null?void 0:s.find(({participant:k})=>k.participantId===b))==null?void 0:l.sideNumber,P=((d=(c=(u=e==null?void 0:e.score)==null?void 0:u.sets)==null?void 0:c[0])==null?void 0:d[`side${D}Score`])??0;a[b]={};let C={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},R=[],N=[],A=0;for(let k of T??[]){let x=r==null?void 0:r[k],F=(p=x.sides.find(({participant:_})=>_.participantId===b))==null?void 0:p.sideNumber,$=((f=(h=(m=x.score)==null?void 0:m.sets)==null?void 0:h[0])==null?void 0:f[`side${F}Score`])??0;A+=$;for(let _ of x.tieMatchUps??[]){let{matchUpType:L,winningSide:B}=_,V=B&&(B===F?"w":"l")||"";V&&(C[L][V]+=1);let G=V==="w"?"1":"0",j=V==="l"?"1":"0";if(L===ii){let z=N.length+1;N.push({singles_pair:{pair:z,won:G,lost:j,tied:"0"}})}else if(L===ei){let z=R.length+1;R.push({doubles_pair:{pair:z,won:G,lost:j,tied:"0"}})}}}let M=[{singles:{childArray:N,won:C.SINGLES.w,lost:C.SINGLES.l}},{doubles:{childArray:R,won:C.DOUBLES.w,lost:C.DOUBLES.l}}],E=[],O=1;for(let k of t.individualParticipantIds){let x=i==null?void 0:i[k];if(x){let{participant:F,counters:$}=x,_={won:((g=$==null?void 0:$.DOUBLES)==null?void 0:g.wins)||0,lost:((v=$==null?void 0:$.DOUBLES)==null?void 0:v.losses)||0},L={won:((y=$==null?void 0:$.SINGLES)==null?void 0:y.wins)||0,lost:((I=$==null?void 0:$.SINGLES)==null?void 0:I.losses)||0},{participantName:B,participantId:V}=F;a[b][V]=O,E.push({player:{name:B,uni:O,singles:L,doubles:_}})}O+=1}return{vh:w,id:b,name:S,score:P||A,totals:M,childArray:E}}function X2({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:o}=t??{},s=o==null?void 0:o.map(l=>{var u;let{sideNumber:c,participant:d}=l,p=QCe({sets:(u=t.score)==null?void 0:u.sets,sideNumber:c});return{[a===ii?"singles_score":"doubles_score"]:{...ZCe({homeid:e,uniValues:i,participant:d}),...p}}});return{[a===ii?"singles_match":"doubles_match"]:{match:r,order:n,childArray:s}}}var tEe="ASC",zee="ASC",iEe="DESC",GM="DESC",rEe={ASC:tEe,ASCENDING:zee,DESC:iEe,DESCENDING:GM};function Wee(t){var e,i,r,n,a;let{tieFormat:o}=t,{useDefaultEventRanking:s,tournamentRecord:l,drawDefinition:u,scaleAccessor:c,singlesOnly:d,attach:p,event:m}=t;if((m==null?void 0:m.eventType)!==Ca)return{error:Gl};if(!l)return{error:ve};if(!o&&!u)return{error:Va};if(o=o??((e=In({drawDefinition:u,event:m}))==null?void 0:e.tieFormat),qn({tieFormat:o}).error)return{error:Nl};if(typeof c!="object"&&!s)return{error:se,context:{scaleAccessor:c}};let h={},f=((u==null?void 0:u.entries)??(m==null?void 0:m.entries)??[]).filter(E=>(E==null?void 0:E.entryStatus)===ca).map(Tt),{participants:g=[]}=Ai({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:l}),v=g.filter(({participantId:E})=>f.includes(E)),y=E=>E===Nc?"rankings":"ratings",I=((i=m==null?void 0:m.category)==null?void 0:i.categoryName)??((r=m==null?void 0:m.category)==null?void 0:r.ageCategoryCode),{scaleName:b=I,scaleType:S=Nc,sortOrder:w,accessor:U}=c||{},T=y(S),D=(E,O)=>{var k,x,F;let $=(k=E[T])==null?void 0:k[O];if(!$&&s&&($=(x=E[T])==null?void 0:x[nm]),Array.isArray($)){let _=(F=$.find(L=>L.scaleName===b))==null?void 0:F.scaleValue;if(_i(_))return _;if(U&&typeof _=="object")return _[U]}return 0},P=(E,O,k)=>{let x=w===GM?O:E,F=w===GM?E:O;return D(x,k)-D(F,k)},C=(E,O)=>P(E,O,nm),R=(E,O)=>P(E,O,zd),N=[],A=(o==null?void 0:o.collectionDefinitions)??[];for(let E of v){let O=((n=E.individualParticipants)==null?void 0:n.sort(C))??[],k=d?O:((a=E.individualParticipants)==null?void 0:a.sort(R))??[],x={};for(let $ of A){let _=[],{collectionId:L,matchUpCount:B,matchUpType:V,gender:G}=$,j=Xi(nm)(V);Te(0,B).forEach(z=>{let q=j?O:k??[],W=z+1,Y=[];Te(0,j?1:2).forEach(re=>{var K;let H=(K=q==null?void 0:q.find(Q=>{var X;let ie=G&&([Zt,mi].includes(G)&&G||G===jn&&[Zt,mi][re]);return(!ie||ie===((X=Q.person)==null?void 0:X.sex))&&!_.includes(Q.participantId)}))==null?void 0:K.participantId;H&&(Y.push(H),_.push(H),x[H]||(x[H]=[]),x[H].push({collectionPosition:W,collectionId:L}))}),j||N.push(Y)})}let F=Object.keys(x).map($=>({collectionAssignments:x[$],participantId:$}));h[E.participantId]=F}let M=[];for(let E of N){let{participant:O}=ns({tournamentParticipants:g,participantIds:E});if(!O){let k={individualParticipantIds:E,participantRole:en,participantType:ft};M.push(k)}}if(p){for(;M.length;)dl({participant:M.pop(),tournamentRecord:l});_t({element:u,extension:{name:ku,value:h}})}return{...Z,lineUps:h,participantsToAdd:M}}function g$(t){if(!t)return{error:Je};let e=We(t,[{dates:!1,[Xr]:o=>Array.isArray(o)&&o.every(ba)},{uuids:!1,[Xr]:o=>Array.isArray(o)&&o.every(Di)},{startTime:!1,endTime:!1,[Xr]:IF},{idPrefix:!1,namePrefix:!1,[Xr]:Di},{count:!0,[Xr]:_i}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&Zf(i,r)||[],a=Te(1,t.count+1).map(o=>{var s,l;return He({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${o}`)??Ht(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${o}`),dateAvailability:n.map(u=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:u}))})});return{...Z,courts:a}}var qee={};bt(qee,{default:()=>oEe,garman:()=>Xee});function Zw({court:t,date:e}){let i=e&&t.dateAvailability.find(n=>Hl(n.date,e)),r=t.dateAvailability.find(n=>!n.date);return i||r}function Nv(t){let e=We(t,[{courtDate:!0,_ofType:ta}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=rr(r.startTime);(r.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>QS(s.startTime).localeCompare(QS(l.startTime))).forEach(s=>{let l={startTime:Ui(a.toISOString()),endTime:s.startTime};rr(s.startTime)>a&&n.push(l),rr(s.endTime)>a&&(a=rr(s.endTime))});let o={startTime:Ui(a.toISOString()),endTime:r.endTime};return rr(r.endTime)>a&&n.push(o),{timeSlots:n}}function nEe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=o=>{var s;let{timeSlots:l}=Nv({includeBookingTypes:e,courtDate:o});return!!((s=l==null?void 0:l.filter(a))!=null&&s.length)};function a(o){let s=rr(o.startTime),l=rr(o.endTime);return s>i||l<r?!1:Zb(i,l)>=t}return{enoughTime:n}}function Yee(t){let e=We(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:cn}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,o=t.courts,s=rr(n),l=bF(s,i),{enoughTime:u}=nEe({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((o==null?void 0:o.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=Zw({date:a,court:c});return!!(d&&u(d))}))||[]).length,...Z}}function BR(t){var e;let{remainingScheduleTimes:i=[],clearScheduleDates:r,periodLength:n=30,scheduleDate:a,courts:o=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(o)||!o.length)return{error:se,courts:o};if(!Array.isArray(s))return{error:KS};if(!ba(a))return{error:xr};r&&(Array.isArray(r)?r.includes(a)&&(s=[]):s=[]);let{courtBookings:l,unassignedBookings:u}=s.reduce((m,h)=>{let{courtId:f}=h;return f?m.courtBookings[f]?m.courtBookings[f].push(h):m.courtBookings[f]=[h]:m.unassignedBookings.push(h),m},{courtBookings:{},unassignedBookings:[]}),c=o.map((m,h)=>{let{courtId:f,courtName:g}=m,v=l[f]||[],y=Zw({date:a,court:m})||{},{bookings:I=[],startTime:b,endTime:S,date:w}=y,U=[i[h]&&{startTime:b,endTime:i[h]},...Ne(I,!1,!0),...v].filter(Boolean);return{courtId:f,courtName:g,dateAvailability:{bookings:U,startTime:b,endTime:S,date:w}}});u.sort((m,h)=>xt(m.startTime)-xt(h.startTime));let d=()=>c.map(m=>{let h=m.dateAvailability,{timeSlots:f=[]}=Nv({courtDate:h});return{courtName:m.courtName,courtId:m.courtId,timeSlots:f}}).flat(),p=[];for(let m of u){let{startTime:h,endTime:f,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=m,I=xt(h),b=xt(f),S=d().reduce((w,{courtId:U,courtName:T,timeSlots:D})=>{let P;return D.find(({startTime:C,endTime:R})=>{P=xt(C)-I;let N=I>=xt(C);return b<=xt(R)&&w.startDifference!==0&&((P===0||P+n>=0)&&(w.startDifference===void 0||P<w.startDifference)||N)})?{courtName:T,courtId:U,startDifference:P}:w},{});if(S.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:h,endTime:f};p.push(w),(e=c.find(({courtId:U})=>U===S.courtId))==null||e.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:m})}return{virtualCourts:c.map(({courtId:m,courtName:h,dateAvailability:f})=>({dateAvailability:[f],courtName:h,courtId:m})),assignedBookings:p}}function VR({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function Kee(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return Te(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function gg({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,o)=>{let s=Zw({date:t,court:o}),l=n&&((s==null?void 0:s[n])||o[n]);return l&&(!a||e&&xt(l)<xt(a)||i&&xt(l)>xt(a))?l:a},void 0)}function aEe({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||gg({courts:r,scheduleDate:n,startTime:!0}),i=i||gg({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let o=rr(e),s=rr(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let u=Zw({court:l,date:n}),{timeSlots:c}=Nv({courtDate:u});c==null||c.forEach(d=>{let p=rr(d.startTime),m=rr(d.endTime);if(p>s||p<o||m<o)return!1;if(Zb(p,m)>=t){let h=Ui(p.toISOString());(!a||h<a)&&(a=h)}})}}return{firstTimeSlotStartTime:a}}function v$(t){let e=We(t,[{courts:!0,_ofType:cn}]);if(e.error)return e;let{date:i=vF(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:o}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||VR({averageMatchUpMinutes:u}),i=mt(i),r=Ui(r),n=Ui(n);let m=0,h=0,f=0,g=0,v=0;!o&&d&&(o=Kee({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:y}=BR({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:I}=aEe({averageMinutes:u,courts:y,startTime:r,endTime:n,date:i});s&&I&&(r=I||r);let b=xt(r),S=xt(n)-b,w=Math.floor(S/a),U=Te(0,w+1).map(T=>{let D=b+T*a,P=yUe(D),C=Yee({courts:y??[],averageMatchUpMinutes:u,periodStart:P,date:i});if(C.error)return{error:C.error};let{availableToScheduleCount:R=0}=C,N=R>h?R-h:0;v+=T?R:0;let A=T?v/T:R,M=a*A/u,E=T?M*(T-1)+A:A,O=R?h&&E-m||N:0;m=E,h=R,f+=O;let k=Qe(f)-g;return g+=k,{periodStart:P,add:k,availableToScheduleCount:R,newCourts:N,totalMatchUps:g}});return{scheduleTimes:U.reduce((T,D)=>{let P=Te(0,D.add).map(()=>({scheduleTime:D.periodStart}));return T.concat(...P)},[]).flat(),timingProfile:U,totalMatchUps:g}}var Xee={getCourtsAvailableAtPeriodStart:Yee,generateTimeSlots:Nv,getScheduleTimes:v$,courtGenerator:Kee},oEe=Xee,Jee={};bt(Jee,{isValid:()=>Ra,isValidMatchUpFormat:()=>Ra,parse:()=>Ln,stringify:()=>yP});var Zee={};bt(Zee,{allCompetitionMatchUps:()=>As,allDrawMatchUps:()=>Pn,allEventMatchUps:()=>tu,allTournamentMatchUps:()=>Gr,analyzeMatchUp:()=>vy,applyLineUps:()=>wte,assignMatchUpSideParticipant:()=>ete,assignTieMatchUpParticipantId:()=>S0,bulkMatchUpStatusUpdate:()=>vte,calculateWinCriteria:()=>Vh,checkInParticipant:()=>y$,checkMatchUpIsComplete:()=>Cd,checkOutParticipant:()=>I$,competitionScheduleMatchUps:()=>Kw,disableTieAutoCalc:()=>hte,drawMatchUps:()=>t$,enableTieAutoCalc:()=>dte,eventMatchUps:()=>OR,filterMatchUps:()=>cu,findMatchUp:()=>$_,getAllDrawMatchUps:()=>fr,getAllStructureMatchUps:()=>qt,getCheckedInParticipantIds:()=>Mh,getCompetitionMatchUps:()=>gy,getEventMatchUpFormatTiming:()=>W_,getHomeParticipantId:()=>X_,getMatchUpCompetitiveProfile:()=>yw,getMatchUpContextIds:()=>J_,getMatchUpDailyLimits:()=>xR,getMatchUpDailyLimitsUpdate:()=>q_,getMatchUpDependencies:()=>ds,getMatchUpFormat:()=>Z_,getMatchUpFormatTiming:()=>bw,getMatchUpFormatTimingUpdate:()=>z_,getMatchUpScheduleDetails:()=>qP,getMatchUpType:()=>YP,getMatchUpsStats:()=>Q_,getModifiedMatchUpFormatTiming:()=>AR,getParticipantResults:()=>Lw,getPredictiveAccuracy:()=>K_,getRoundMatchUps:()=>An,getRounds:()=>e$,isValidMatchUpFormat:()=>Ra,matchUpActions:()=>cR,mutate:()=>Qee,participantScheduledMatchUps:()=>Y_,query:()=>lee,removeDelegatedOutcome:()=>pte,removeMatchUpSideParticipant:()=>U$,removeTieMatchUpParticipantId:()=>ite,replaceTieMatchUpParticipantId:()=>w$,resetAdHocMatchUps:()=>yte,resetMatchUpLineUps:()=>E$,resetScorecard:()=>N$,resetTieFormat:()=>M$,setDelegatedOutcome:()=>Ite,setMatchUpFormat:()=>fte,setMatchUpStatus:()=>eU,setOrderOfFinish:()=>bte,substituteParticipant:()=>mte,tallyParticipantResults:()=>Dv,toggleParticipantCheckInState:()=>jR,tournamentMatchUps:()=>kR,updateTieMatchUpScore:()=>tc,validMatchUp:()=>jP,validMatchUps:()=>Ro});var Qee={};bt(Qee,{applyLineUps:()=>wte,assignMatchUpSideParticipant:()=>ete,assignTieMatchUpParticipantId:()=>S0,bulkMatchUpStatusUpdate:()=>vte,checkInParticipant:()=>y$,checkOutParticipant:()=>I$,disableTieAutoCalc:()=>hte,enableTieAutoCalc:()=>dte,findMatchUp:()=>$_,removeDelegatedOutcome:()=>pte,removeMatchUpSideParticipant:()=>U$,removeTieMatchUpParticipantId:()=>ite,replaceTieMatchUpParticipantId:()=>w$,resetAdHocMatchUps:()=>yte,resetMatchUpLineUps:()=>E$,resetScorecard:()=>N$,resetTieFormat:()=>M$,setDelegatedOutcome:()=>Ite,setMatchUpFormat:()=>fte,setMatchUpStatus:()=>eU,setOrderOfFinish:()=>bte,substituteParticipant:()=>mte,toggleParticipantCheckInState:()=>jR,updateTieMatchUpScore:()=>tc});function ete({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){var o,s;if(i&&typeof i!="string")return{error:Es};if(!e)return{error:$e};if(!n)return{error:bn};let l=r===void 0;if(l&&(r=1),![1,2].includes(r))return te({result:{error:se,context:{sideNumber:r}}});let{matchUp:u,structure:c}=Si({drawDefinition:e,matchUpId:n,event:a});if(!u)return{error:hn};if(!(!(c!=null&&c.structures)&&!(e.drawType&&e.drawType!==Ga)&&!((o=c==null?void 0:c.matchUps)!=null&&o.find(({roundPosition:d})=>!!d))))return{error:Vx};if(!i&&((s=u==null?void 0:u.score)!=null&&s.scoreStringSide1||Ir.includes(u==null?void 0:u.matchUpstatus)||u!=null&&u.matchUpStatus&&[tr,dr].includes(u.matchUpStatus)))return{error:oP,info:"matchUp has completed status or score"};if(u){if(u.sides=[1,2].map(d=>{var p;let m=((p=u.sides)==null?void 0:p.find(h=>h.sideNumber===d))??{sideNumber:d};return r===d?{...m,participantId:i}:m}),l)for(let d of u.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);Ct({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:u})}return{...Z,sidesSwapped:l}}function Na({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=Si({drawDefinition:r,event:s,matchUpId:a});if(!l)return{error:hn};let u=bl({removePriorValues:t,element:l,duplicateValues:i,timeItem:o});return n||Ct({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),u}function I$(t){var e;let i=[{[wr]:!0},{[$n]:!0},{[ql]:!0},{[vl]:!0}],r=We(t,i);if(r.error)return r;let n=Rv(t,[{[pv]:Ql,attr:{[RP]:!0}}]);if(n.error)return n;let{tournamentRecord:a,drawDefinition:o,participantId:s,matchUpId:l}=t,u=(e=n==null?void 0:n.matchUp)==null?void 0:e.matchUp,{matchUpStatus:c,score:d}=u??{};if(c&&GF.includes(c)||c&&Ir.includes(c)||yr({score:d}))return{error:AK};let p=Mh({matchUp:u});if(p!=null&&p.error)return p;let{checkedInParticipantIds:m,allRelevantParticipantIds:h}=p??{};if(!(h!=null&&h.includes(s)))return{error:Es};if(!(m!=null&&m.includes(s)))return{error:o9};let f=FX({matchUp:u});if(f!=null&&f.error)return f;let{sideParticipantIds:g,nestedIndividualParticipantIds:v}=f??{},y=g==null?void 0:g.indexOf(s);return y!==void 0&&[0,1].includes(y)&&((v==null?void 0:v[y])??[]).forEach(I=>{Na({drawDefinition:o,matchUpId:l,timeItem:{itemType:s0,itemValue:I}})}),Na({tournamentRecord:a,drawDefinition:o,matchUpId:l,timeItem:{itemValue:s,itemType:s0}}),{...Z,checkedOut:!0}}function y$(t){var e;let i=[{[wr]:!0},{[$n]:!0},{[ql]:!0},{[vl]:!0}],r=We(t,i);if(r[zo])return r;let n=Rv(t,[{[pv]:Ql,attr:{[RP]:!0}}]);if(n[zo])return n;let{tournamentRecord:a,drawDefinition:o,participantId:s,matchUpId:l}=t,u=Mh({matchUp:(e=n==null?void 0:n.matchUp)==null?void 0:e.matchUp});if(u!=null&&u.error)return u;let{checkedInParticipantIds:c,allRelevantParticipantIds:d}=u??{};if(!(d!=null&&d.includes(s)))return{[zo]:Es};let p={...Z,checkedIn:!0};return c!=null&&c.includes(s)||Na({tournamentRecord:a,drawDefinition:o,matchUpId:l,timeItem:{itemValue:s,itemType:o0}}),p}function jR(t){var e,i;let r=We(t,[{[ql]:!0,[$n]:!0,[vl]:!0}]);if(r.error)return r;let n=t.tournamentId??t.activeTournamentId,a=t.tournamentRecord??(n&&((e=t.tournamentRecords)==null?void 0:e[n]));if(!a)return{error:ve};let o=(i=Rv(t,[{[pv]:Ql,attr:{[RP]:!0},[zo]:hn}]).matchUp)==null?void 0:i.matchUp;if(!o)return{error:hn};let{checkedInParticipantIds:s=[]}=Mh({matchUp:o}),{participantId:l,matchUpId:u,drawDefinition:c}=t;return l&&s.includes(l)?I$({tournamentRecord:a,drawDefinition:c,participantId:l,matchUpId:u,matchUp:o}):y$({tournamentRecord:a,drawDefinition:c,participantId:l,matchUpId:u,matchUp:o})}function b$({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){var n,a;if(!t)return{error:ve};if(!e)return{error:xs};if(!r)return{error:mo};let o=ln({drawDefinition:e}),{matchUp:s}=Si({matchUpId:i,drawDefinition:e,matchUpsMap:o});if(!s)return{error:hn};let{matchUp:l,structure:u}=Si({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:o,event:r});if(!l)return{error:hn};let{collectionPosition:c,drawPositions:d,collectionId:p,matchUpTieId:m,matchUpType:h}=l;if(h&&!eP([ii,ei],h))return{error:la};let{positionAssignments:f}=oi({structure:u}),g=f==null?void 0:f.filter(T=>d==null?void 0:d.includes(T.drawPosition)),{matchUp:v}=Si({matchUpId:m,drawDefinition:e,matchUpsMap:o}),y=((n=v==null?void 0:v.sides)==null?void 0:n.map(Tt))??[],I=(g==null?void 0:g.map(Tt))??[],b=[...y,...I],{participants:S}=Ai({tournamentRecord:t,participantFilters:{participantTypes:[Xt],participantIds:b}}),{matchUp:w}=Si({matchUpId:m,inContext:!0,drawDefinition:e,matchUpsMap:o}),U=(a=In({matchUp:v,drawDefinition:e,structure:u,event:r}))==null?void 0:a.tieFormat;return{inContextDualMatchUp:w,inContextTieMatchUp:l,relevantAssignments:g,collectionPosition:c,teamParticipants:S,collectionId:p,matchUpType:h,dualMatchUp:v,tieMatchUp:s,tieFormat:U,structure:u,...Z}}function w$(t){var e,i,r,n,a,o,s,l,u,c,d,p,m,h,f,g;let v=b$(t);if(v.error)return v;let y="replaceTieMatchUpParticipantid",{existingParticipantId:I,tournamentRecord:b,newParticipantId:S,drawDefinition:w,substitution:U,event:T}=t;if(!I||!S)return te({result:{error:hr},stack:y});if(I===S)return{...Z};let{inContextDualMatchUp:D,inContextTieMatchUp:P,collectionPosition:C,collectionId:R,dualMatchUp:N,tieMatchUp:A,tieFormat:M}=v,E=P==null?void 0:P.matchUpType,O=(e=P==null?void 0:P.sides)==null?void 0:e.find(H=>{var Q,X,ie;return((Q=H.participant)==null?void 0:Q.participantId)===I||((ie=(X=H.participant)==null?void 0:X.individualParticipantIds)==null?void 0:ie.includes(I))});if(!O)return{error:Wi};let k=((i=Ai({tournamentRecord:b,participantFilters:{participantIds:[I,S]}}))==null?void 0:i.participants)??[];if(k.length!==2)return te({result:{error:hr},stack:y});if(k[0].participantType!==k[1].participantType)return te({result:{error:Ms},stack:y});let{appliedPolicies:x}=Bt({tournamentRecord:b,drawDefinition:w,event:T}),F=((r=t.policyDefinitions)==null?void 0:r[Lr])??(x==null?void 0:x[Lr])??wv[Lr],$=k.find(({participantId:H})=>H===S);if((t.enforceGender??((n=F==null?void 0:F.participants)==null?void 0:n.enforceGender))!==!1&&[Zt,mi].includes(P==null?void 0:P.gender)&&(P==null?void 0:P.gender)!==((a=$==null?void 0:$.person)==null?void 0:a.sex))return{error:gh,info:"Gender mismatch"};let _=(o=F==null?void 0:F.processCodes)==null?void 0:o.substitution;$w({tournamentId:b.tournamentId,eventId:T.eventId,inContextDualMatchUp:D,drawDefinition:w,dualMatchUp:N});let L=(s=N==null?void 0:N.sides)==null?void 0:s.find(({sideNumber:H})=>H===O.sideNumber);if(!L)return te({result:{sideNumber:O.sideNumber,existingParticipantId:I,error:Vr},stack:y});if((u=(l=P==null?void 0:P.sides)==null?void 0:l.flatMap(H=>{var Q,X;return((Q=H.participant)==null?void 0:Q.individualParticipantIds)||((X=H.participant)==null?void 0:X.participantId)||[]}))!=null&&u.includes(S))return te({result:{error:lP},stack:y});let B=(d=(c=D==null?void 0:D.sides)==null?void 0:c.find(({sideNumber:H})=>H===O.sideNumber))==null?void 0:d.participantId,V=L.lineUp,G=V==null?void 0:V.find(({participantId:H})=>S===H),j=V==null?void 0:V.reduce((H,Q)=>Q.substitutionOrder>H?Q.substitutionOrder:H,0),z=(V==null?void 0:V.map(H=>{var Q;let X=Ne(H,!1,!0);if(![I,S].includes(X.participantId))return X;if(!U&&[I,S].includes(X.participantId)&&(X.collectionAssignments=(Q=X.collectionAssignments)==null?void 0:Q.filter(ie=>!(ie.collectionPosition===C&&ie.collectionId===R))),U&&I===X.participantId&&(X.collectionAssignments=X.collectionAssignments.map(ie=>ie.collectionPosition===C&&ie.collectionId===R&&ie.substitutionOrder===void 0?{...ie,substitutionOrder:j}:ie)),X.participantId===S){X.collectionAssignments||(X.collectionAssignments=[]);let ie={collectionId:R,collectionPosition:C};U&&(ie.previousParticipantId=I,ie.substitutionOrder=(j??0)+1),X.collectionAssignments.push(ie)}return X}))??[];if(!G){let H={collectionId:R,collectionPosition:C};U&&(H.substitutionOrder=(j??0)+1,H.previousParticipantId=I);let Q={collectionAssignments:[H],participantId:S};z.push(Q)}let q=E===ei,{assignedParticipantIds:W}=l0({lineUp:V,collectionPosition:C,collectionId:R}),{assignedParticipantIds:Y}=l0({lineUp:z,collectionPosition:C,collectionId:R});if(L.lineUp=z,B&&M){let H=Lh({participantId:B,lineUp:z,drawDefinition:w,tieFormat:M});if(H.error)return te({result:H,stack:y})}else console.log("team participantId not found");let re,K;if(q){let{tournamentRecord:H}=t,Q=ns({participantIds:Y,tournamentRecord:H});if(!Q.participant){let ie=dl({returnParticipant:!0,pairOverride:!0,tournamentRecord:H,participant:{participantRole:en,individualParticipantIds:Y,participantType:ft}});if(ie.error)return te({result:ie,stack:y});re=(p=ie.participant)==null?void 0:p.participantId}Q=ns({participantIds:W,tournamentRecord:H});let X=(m=Q.participant)==null?void 0:m.participantId;X&&xh({participantIds:[X],tournamentRecord:H}).success&&(K=X)}if(U||((h=O.substitutions)==null?void 0:h.length)===1){if(U)_&&A&&(A.processCodes=dt([...(A==null?void 0:A.processCodes)??[],..._]));else for(let H of _||[]){let Q=(f=A==null?void 0:A.processCodes)==null?void 0:f.lastIndexOf(H);Q!==void 0&&((g=A==null?void 0:A.processCodes)==null||g.splice(Q,1))}A&&Ct({tournamentId:b==null?void 0:b.tournamentId,matchUp:A,context:y,drawDefinition:w})}return N&&Ct({tournamentId:b==null?void 0:b.tournamentId,matchUp:N,context:y,drawDefinition:w}),{...Z,modifiedLineUp:z,participantRemoved:K,participantAdded:re}}function tte({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){var o;if(!a||!t||!Array.isArray(n))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:se};let s=(i==null?void 0:i.lineUp)||((o=Qd({participantId:e,drawDefinition:r}))==null?void 0:o.lineUp),l=[],u=[];return{modifiedLineUp:(s==null?void 0:s.map(c=>{var d;if(!n.includes(c.participantId))return c;let p=(d=c.collectionAssignments)==null?void 0:d.filter(m=>{let h=m.collectionId===a&&m.collectionPosition===t;return h&&(m.previousParticipantId&&l.push(m.previousParticipantId),u.push({participantId:c.participantId,...m})),!h});return{participantId:c.participantId,collectionAssignments:p}}).filter(Boolean))||[],assignmentsRemoved:u,previousParticipantIds:l}}function sEe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var r,n;let a=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===ur&&((l=s==null?void 0:s.entries)==null?void 0:l.some(u=>u.participantId===e))}),o=s=>!t.includes(s.participantId);for(let s of a){s.entries=(s.entries||[]).filter(o);let{flightProfile:l}=Hi({event:s});(r=l==null?void 0:l.flights)==null||r.forEach(u=>{u.drawEntries=(u.drawEntries||[]).filter(o)}),(n=s==null?void 0:s.drawDefinitions)==null||n.forEach(u=>{u.entries=(u.entries||[]).filter(o)})}return{...Z}}function GR({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return te({result:{error:ve},stack:n});if(!e||!t)return te({result:{error:Je},stack:n});let a=r.participants??[],o=a.find(d=>d.participantId===e);if(!o)return te({result:{error:Wi},stack:n});if(o!=null&&o.participantType&&![Xt,Ja].includes(o.participantType))return te({context:{participantType:o.participantType},result:{error:Ms},stack:n});let s=t.filter(d=>{var p;return((p=a.find(m=>m.participantId===d))==null?void 0:p.participantType)!==Dt});if(s.length)return te({result:{error:ya,invalidParticipantIds:s},stack:n});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&JP({individualParticipantIds:u,tournamentRecord:r}),o.individualParticipantIds=o.individualParticipantIds.concat(...u));let{topics:c}=So();if(c.includes(on)){let d=a.find(({participantId:p})=>p===e);ut({topic:on,payload:{participants:[d]}})}return sEe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:Ne(o,!1,!0),added:u.length,...Z}}function HR(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:o}=t;if(!n)return{error:ve};if(!o)return{error:vh};if(!o.participantId)return dl({tournamentRecord:n,participant:o});let{participant:s}=nd({participantId:o.participantId,tournamentRecord:n});if(!s)return dl({tournamentRecord:n,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:m,onlineResources:h,contacts:f,person:g}=o;if(m&&s.participantType!==m)return{error:e9};let v={};if(f&&(v.contacts=f),h&&(v.onlineResources=h),c&&Di(c)&&(v.participantOtherName=c),d&&Di(d)&&(v.participantName=d),Array.isArray(u)){let{participants:y}=Ai({participantFilters:{participantTypes:[Dt]},tournamentRecord:n}),I=y==null?void 0:y.map(Tt);if(I){let b=u.filter(S=>Di(S)&&I.includes(S));([Ja,fi].includes(m||s.participantType)||m===ft&&(b.length===2||a))&&(v.individualParticipantIds=b),s.participantType===tI.PAIR&&e&&(v.participantName=lEe({individualParticipants:y,newValues:v}))}}return Object.keys(PL).includes(p)&&(v.participantRole=p),Object.keys(tI).includes(m)&&(v.participantType=m),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===tI.INDIVIDUAL&&g&&uEe({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,He(v)),i&&GR({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),ut({topic:on,payload:{tournamentId:n.tournamentId,participants:[s]}}),{participant:Ne(s),...Z}}function lEe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function uEe({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:l,birthdate:u,tennisId:c,sex:d}=r;d&&Object.keys(fF).includes(d)&&(n.sex=d);let p;if(Di(l)&&(n.personId=l),s&&Di(s)&&(cEe(s)||s==="")&&(n.nationalityCode=s),a&&typeof Di(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),o&&typeof Di(o)&&o.length>1&&(n.standardGivenName=o,p=!0),p&&t){let m=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=m}u&&ba(u)&&(n.birthdate=u),c&&Di(c)&&(n.tennisId=c),Object.assign(e.person,n)}function cEe(t){return yc.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function S0(t){var e,i,r,n,a,o,s,l,u,c,d,p,m,h,f,g,v,y,I,b;let S=b$(t);if(S.error)return S;let w="assignTieMatchUpParticipantId",U=t.teamParticipantId,{tournamentRecord:T,drawDefinition:D,participantId:P,event:C}=t;if(!P)return te({result:{error:hr},stack:w});if(t.sideNumber&&![1,2].includes(t.sideNumber))return te({result:{error:Jx},stack:w});let{inContextDualMatchUp:R,inContextTieMatchUp:N,relevantAssignments:A,collectionPosition:M,teamParticipants:E,collectionId:O,matchUpType:k,dualMatchUp:x,tieFormat:F}=S;if((i=(e=N==null?void 0:N.sides)==null?void 0:e.flatMap(ne=>{var de,Ie;return((de=ne.participant)==null?void 0:de.individualParticipantIds)||((Ie=ne.participant)==null?void 0:Ie.participantId)||[]}))!=null&&i.includes(P))return te({result:{...Z},stack:w});U=U??(t.sideNumber?(n=(r=R==null?void 0:R.sides)==null?void 0:r.find(ne=>ne.sideNumber===t.sideNumber))==null?void 0:n.participantId:void 0);let $=(o=(a=Ai({participantFilters:{participantIds:[P]},tournamentRecord:T}))==null?void 0:a.participants)==null?void 0:o[0];if(!$)return te({result:{error:Wi},stack:w});let{appliedPolicies:_}=Bt({tournamentRecord:T,drawDefinition:D,event:C}),L=((s=t.policyDefinitions)==null?void 0:s[Lr])??(_==null?void 0:_[Lr])??wv[Lr];if((t.enforceGender??((l=L==null?void 0:L.participants)==null?void 0:l.enforceGender))!==!1&&[Zt,mi].includes(N==null?void 0:N.gender)&&(N==null?void 0:N.gender)!==((u=$.person)==null?void 0:u.sex))return{error:gh,info:"Gender mismatch"};let{individualParticipantIds:B,participantType:V}=$;if(Xi(ii)(k)&&V!==Dt)return{error:Ms};let G=V===Dt?[P]:B,j=U&&(E==null?void 0:E.find(({participantId:ne})=>ne===U))||(E==null?void 0:E.find(({individualParticipantIds:ne})=>Nn(G,ne)));if(!j)return{error:oF};if(U||(U=j.participantId),!U)return{error:Wi};let z=(c=A==null?void 0:A.find(ne=>ne.participantId===(j==null?void 0:j.participantId)))==null?void 0:c.drawPosition,q=(p=(d=x==null?void 0:x.sides)==null?void 0:d.find(ne=>ne.participantId===U))==null?void 0:p.sideNumber,W=(h=(m=N==null?void 0:N.sides)==null?void 0:m.find(ne=>z&&ne.drawPosition===z))==null?void 0:h.sideNumber,Y=q??W??t.sideNumber;if(!F)return{error:ov};if(!((f=F.collectionDefinitions)!=null&&f.find(ne=>ne.collectionId===O)))return{error:zK};$w({tournamentId:T.tournamentId,eventId:C.eventId,inContextDualMatchUp:R,drawDefinition:D,dualMatchUp:x});let re=(g=x==null?void 0:x.sides)==null?void 0:g.find(ne=>ne.sideNumber===Y),K=(v=N==null?void 0:N.sides)==null?void 0:v.find(ne=>ne.sideNumber===Y),H=(b=(I=(re==null?void 0:re.lineUp)??((y=Qd({participantId:U,drawDefinition:D}))==null?void 0:y.lineUp))==null?void 0:I.filter(ne=>{var de;return(de=ne.collectionAssignments)==null?void 0:de.find(Ie=>Ie.collectionPosition===M&&Ie.collectionId===O&&!Ie.previousParticipantId)}))==null?void 0:b.map(ne=>ne==null?void 0:ne.participantId),Q=(H==null?void 0:H.length)>1&&H||(V===ft?$.individualParticipantIds:[P]),X=tte({collectionPosition:M,teamParticipantId:U,dualMatchUpSide:re,drawDefinition:D,participantIds:Q,collectionId:O});if(X.error)return te({result:X,stack:w});let{modifiedLineUp:ie}=X,ae;if(k===ei){if(V!==ft){let ne=KC({collectionPosition:M,teamParticipantId:U,drawDefinition:D,modifiedLineUp:ie,participantId:P,collectionId:O,tieFormat:F});if(ne!=null&&ne.error)return te({result:ne,stack:w});if(ne=le({side:K}),ne.error)return ne;ae=ne.deletedParticipantId,re&&(re.lineUp=ie),x&&Ct({tournamentId:T==null?void 0:T.tournamentId,matchUp:x,context:w,drawDefinition:D})}else if(V===ft)for(let ne of Q)KC({collectionPosition:M,teamParticipantId:U,drawDefinition:D,modifiedLineUp:ie,participantId:ne,collectionId:O,tieFormat:F})}else{let ne=KC({collectionPosition:M,teamParticipantId:U,drawDefinition:D,modifiedLineUp:ie,participantId:P,collectionId:O,tieFormat:F});if(ne!=null&&ne.error)return ne}if(re&&(re.lineUp=ie),x&&Ct({tournamentId:T==null?void 0:T.tournamentId,matchUp:x,context:w,drawDefinition:D}),ae){let{error:ne}=xh({participantIds:[ae],tournamentRecord:T});ne&&console.log("cleanup")}return{...Z,modifiedLineUp:ie};function le({side:ne}){let de;if(ne.participant){let Ie=ne.participant.individualParticipantIds||[];if(Ie.filter(Boolean).length===1){let{participant:ce}=ns({participantIds:Ie,tournamentRecord:T});Ie.push(P);let{participant:ke}=ns({participantIds:Ie,tournamentRecord:T});if(!ke&&ce){ce.individualParticipantIds=Ie;let Pe=HR({pairOverride:!0,tournamentRecord:T,participant:ce});if(Pe.error)return Pe}else de=ce==null?void 0:ce.participantId}}else{let Ie=dl({participant:{individualParticipantIds:[P],participantRole:en,participantType:ft},pairOverride:!0,tournamentRecord:T});if(Ie.error)return Ie}return{...Z,deletedParticipantId:de}}}function KC({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:o}){var s,l;let u=(s=Qd({participantId:e,drawDefinition:i}))==null?void 0:s.lineUp,c=(l=r||u)==null?void 0:l.find(p=>(p==null?void 0:p.participantId)===n),d={collectionId:a,collectionPosition:t};if(c)c.collectionAssignments.push(d);else{let p={collectionAssignments:[d],participantId:n};r.push(p)}return Lh({participantId:e,lineUp:r,drawDefinition:i,tieFormat:o})}function ite(t){var e,i,r,n,a,o,s,l,u,c,d,p,m,h,f,g,v,y,I,b,S,w,U;let{tournamentRecord:T,drawDefinition:D,participantId:P,event:C}=t,R="removeTieMatchUpParticiapantId";if(!P)return te({result:{error:hr},stack:R});let N=b$(t);if(N.error)return N;let{appliedPolicies:A}=Bt({tournamentRecord:T,drawDefinition:D,event:C}),M=(r=(i=((e=t.policyDefinitions)==null?void 0:e[Lr])??(A==null?void 0:A[Lr])??wv[Lr])==null?void 0:i.processCodes)==null?void 0:r.substitution,{inContextDualMatchUp:E,inContextTieMatchUp:O,relevantAssignments:k,collectionPosition:x,teamParticipants:F,collectionId:$,matchUpType:_,dualMatchUp:L,tieMatchUp:B,tieFormat:V}=N;if(!L)return te({result:{error:sa},stack:R});let G=(n=O==null?void 0:O.sides)==null?void 0:n.find(H=>{var Q,X,ie;return((Q=H.participant)==null?void 0:Q.participantId)===P||((ie=(X=H.participant)==null?void 0:X.individualParticipantIds)==null?void 0:ie.includes(P))});if(!G)return te({result:{error:Wi},stack:R});let j=((a=t.policyDefinitions)==null?void 0:a[fo])??(A==null?void 0:A[fo]);if(!((o=G.substitutions)!=null&&o.length)&&(yr({score:O==null?void 0:O.score})||O!=null&&O.winningSide)&&(j==null?void 0:j.requireParticipantsForScoring)!==!1)return te({result:{error:C9},stack:R});let z=(l=(s=E==null?void 0:E.sides)==null?void 0:s.find(({sideNumber:H})=>H===G.sideNumber))==null?void 0:l.participantId;if(!z)return te({result:{error:Wi},stack:R});let q=(c=(u=Ai({participantFilters:{participantIds:[P]},tournamentRecord:T}))==null?void 0:u.participants)==null?void 0:c[0];if(!q)return te({result:{error:Wi},stack:R});if(_===ii&&q.participantType===ft)return te({result:{error:gh},stack:R});let W=q.participantType===Dt?[P]:q.individualParticipantIds;$w({tournamentId:T.tournamentId,eventId:C.eventId,inContextDualMatchUp:E,drawDefinition:D,dualMatchUp:L});let Y=(d=L.sides)==null?void 0:d.find(({sideNumber:H})=>H===G.sideNumber);if(!Y&&(((p=L.sides)==null?void 0:p.filter(({lineUp:H})=>!H).length)||0)<2){let H=F==null?void 0:F.map(({participantId:Q})=>{var X;return{drawPosition:(X=k==null?void 0:k.find(ie=>ie.participantId===Q))==null?void 0:X.drawPosition,teamParticipantId:Q}});Y=(m=L.sides)==null?void 0:m.find(Q=>{var X;return((X=H==null?void 0:H.find(({drawPosition:ie})=>ie===Q.drawPosition))==null?void 0:X.teamParticipantId)===z})}if(!Y)return te({result:{error:Wi,context:{participantId:P}}});let{modifiedLineUp:re,previousParticipantIds:K}=tte({collectionPosition:x,teamParticipantId:z,dualMatchUpSide:Y,participantIds:W,drawDefinition:D,collectionId:$});if(Y.lineUp=re,z&&V&&Lh({participantId:z,lineUp:re,drawDefinition:D,tieFormat:V}),_===ei&&q.participantType===Dt){let H=(h=O==null?void 0:O.sides)==null?void 0:h.find(ie=>ie.sideNumber===(Y==null?void 0:Y.sideNumber)),{participantId:Q}=H??{},X=Q&&((g=(f=Ai({participantFilters:{participantIds:[Q]},tournamentRecord:T,withDraws:!0}))==null?void 0:f.participants)==null?void 0:g[0]);if(X){let ie=((v=X==null?void 0:X.individualParticipantIds)==null?void 0:v.filter(ae=>ae!==P))??[];if(K&&ie.push(...K),ie.length>2)return te({result:{error:ya},stack:R});if((y=X.draws)!=null&&y.length){if(ie.length===1){let{participant:ae}=ns({participantIds:ie,tournamentRecord:T});if(!ae){let le=dl({participant:{participantRole:en,individualParticipantIds:ie,participantType:ft},pairOverride:!0,tournamentRecord:T});if(le.error)return te({result:le,stack:R})}}}else if(ie.length){X.individualParticipantIds=ie;let ae=HR({participant:X,pairOverride:!0,tournamentRecord:T});if(ae.error)return te({result:ae,stack:R})}else{let ae=xh({participantIds:[Q],tournamentRecord:T});ae.error&&console.log("cleanup",{result:ae})}}else return te({result:{error:Wi},stack:R})}if(((I=G.substitutions)==null?void 0:I.length)===1&&!((w=(S=(b=O==null?void 0:O.sides)==null?void 0:b.find(H=>H.sideNumber!==G.sideNumber))==null?void 0:S.substitutions)!=null&&w.length)&&(U=B==null?void 0:B.processCodes)!=null&&U.length){for(let H of M||[]){let Q=B.processCodes.lastIndexOf(H);B.processCodes.splice(Q,1)}Ct({tournamentId:T==null?void 0:T.tournamentId,matchUp:B,context:R,drawDefinition:D})}return Ct({tournamentId:T==null?void 0:T.tournamentId,matchUp:L,context:R,drawDefinition:D}),{...Z,modifiedLineUp:re}}function U$(t){var e,i;let r=We(t,[{[wr]:!0,[$n]:!0,[vl]:!0}]);if(r.error)return r;let{drawDefinition:n,sideNumber:a,matchUpId:o,event:s}=t;if(a&&![1,2].includes(a))return{error:se,sideNumber:a};let{matchUp:l,structure:u}=Si({drawDefinition:n,matchUpId:o,event:s});return l?Yn({structure:u})?((e=l.sides)==null||e.forEach(c=>{(!a||c.sideNumber===a)&&delete c.participantId}),Ct({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,context:"assignSideParticipant",drawDefinition:n,matchUp:l}),{...Z}):{error:Vx}:{error:hn}}function dEe({matchUpStatuses:t=[jt,Ft,Pt],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){var n;let a=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),o=(n=a==null?void 0:a.drawPositions)==null?void 0:n.find(d=>d!==i),s=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(o)}).map(d=>d.matchUpStatus),l=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),u=Nn(s||[],t),c=Nn(l||[],t);return{sourceMatchUp:a,winnerHadMatchUpStatus:u,winnerMatchUpStatuses:s,loserHadMatchUpStatus:c,loserMatchUpStatuses:l}}function pEe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=tt({drawDefinition:a,structureId:o});if((d==null?void 0:d.structureType)===_n)return{...Z};u=u??ln({drawDefinition:a});let p=((u==null?void 0:u.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:m}=km({drawPosition:i,matchUps:p}),h=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==m&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:f}=oi({drawDefinition:a,structureId:o});for(let g of h??[])mEe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:f,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:s,matchUpsMap:u,matchUp:g,event:c});return{...Z}}function mEe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:u,event:c}){var d,p,m;let h="removeSubsequentDrawPosition";if(s){let g=(p=(d=t.find(({matchUpId:y})=>u.matchUpId===y).sides)==null?void 0:d.find(y=>y.drawPosition===r))==null?void 0:p.sideNumber,v=(m=u.sides)==null?void 0:m.find(y=>y.sideNumber===g);v&&delete v.lineUp}u.drawPositions=(u.drawPositions||[]).map(g=>g===r?void 0:g).filter(Boolean);let f=e.filter(({drawPosition:g})=>{var v;return(v=u.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return u.matchUpStatus=f&&jt||[Pt,Ft].includes(u.matchUpStatus)&&u.matchUpStatus||Zi,[Ft,Pt].includes(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&UJ({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),Ct({tournamentId:n==null?void 0:n.tournamentId,eventId:c==null?void 0:c.eventId,context:`${h}-${r}`,drawDefinition:o,matchUp:u}),{...Z}}function Av(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,m=Yn({structure:c}),{drawPositions:h,winningSide:f}=l.matchUp||{};if(!m&&!h)return{error:Wb};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:I,winnerMatchUp:b,byeMatchUp:S}}=l,w=Xs({...t,matchUpStatus:a||Zi,removeWinningSide:!0});if(w.error)return w;let U;if(p){let{matchUpTieId:O,matchUpsMap:k}=t;if(U=tc({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:k,event:d}),!e&&!U.removeWinningSide)return{...Z}}if(m)return{...Z};let{matchUps:T}=qt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:o,structure:c}),{positionAssignments:D}=Er({structure:c}),P=f-1,C=1-P,R=h[P],N=h[C],{winnerParticipantId:A,loserParticipantId:M}=(D==null?void 0:D.reduce((O,k)=>(k.drawPosition===N&&(O.loserParticipantId=k.participantId),k.drawPosition===R&&(O.winnerParticipantId=k.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},E=T.filter(O=>{var k;return(k=O.drawPositions)==null?void 0:k.includes(N)});if(b&&rte({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:A,tournamentRecord:r,winnerTargetLink:v,drawDefinition:n,winnerMatchUp:b,dualMatchUp:s,matchUpsMap:o}),I){let{winnerHadMatchUpStatus:O}=dEe({drawPositionMatchUps:E,loserDrawPosition:N,sourceMatchUps:T}),k=g.linkCondition===sl;if(O&&k){let F=Math.min(...I.drawPositions);HM({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:F,matchUpsMap:o,event:d})}let x=hEe({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:M,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:I,dualMatchUp:s,matchUpsMap:o,event:d});if(x.error)return x}if(S){let O=Math.min(...S.drawPositions);HM({sourceMatchUpId:u,targetLink:y,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:o,event:d})}return{...Z,...U&&{tieMatchUpResult:U}}}function rte({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){var p,m;let{structureId:h,roundNumber:f}=l,g="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=tt({drawDefinition:s,structureId:v});if(!y)return{error:Ni};let{positionAssignments:I}=Er({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(D=>D.participantId!==r);let b=(p=I==null?void 0:I.find(D=>D.participantId===r))==null?void 0:p.drawPosition,{matchUps:S}=qt({drawDefinition:s,structure:y,event:d}),w=S.map(D=>D.drawPositions).flat(1/0).filter(Boolean),U=Pa(w);if((b?U[b]:void 0)===1)I==null||I.forEach(D=>{D.participantId===r&&delete D.participantId});else{let D=S.filter(({drawPositions:P})=>P.includes(b));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:D,winnerTargetLink:a})}let T=(m=u==null?void 0:u.drawMatchUps)==null?void 0:m.find(({matchUpId:D})=>D===l.matchUpId);T&&Ct({tournamentId:n==null?void 0:n.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:T,context:g,drawDefinition:s})}return f&&pEe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:c,matchUpsMap:u,roundNumber:f,structureId:h}),{...Z}}function hEe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:u}){var c,d,p;let m="removeDirectedLoser",h=r.target.structureId,{structure:f}=tt({drawDefinition:a,structureId:h});if(!f)return{error:Ni};let{positionAssignments:g}=Er({structure:f}),v=(c=g==null?void 0:g.find(y=>y.participantId===e))==null?void 0:c.drawPosition;if(g==null||g.forEach(y=>{y.participantId===e&&delete y.participantId}),f.seedAssignments=(f.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=o==null?void 0:o.sides.reduce((S,w,U)=>w.drawPosition===v?U:S,void 0),I=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(({matchUpId:S})=>S===o.matchUpId),b=(p=I==null?void 0:I.sides)==null?void 0:p[y];b&&(delete b.lineUp,Ct({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:I,context:m,drawDefinition:a}))}return{...Z}}function HM({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:o}){let s=a.target.structureId,l="removeDirectedBye";Oa({color:"brightyellow",method:l,drawPosition:r});let u=Dw({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:s,event:o});return te({result:u,stack:l})}function fEe(t){var e,i;let{matchUpFormat:r,score:n}=t,a=(e=n==null?void 0:n.sets)==null?void 0:e.length,o=r&&Ln(r),{setFormat:s,finalSetFormat:l,bestOf:u}=o??{};return((i=u&&a===u&&l||s)==null?void 0:i.timed)||!1}function gEe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){var n;let a="attemptToSetMatchUpStatusBYE";if(r!=null&&r.winningSide)return te({result:{error:av},context:{matchUpStatus:jt},stack:a});let{positionAssignments:o}=Er({structure:i}),s=o==null?void 0:o.filter(l=>l.bye).map(l=>l.drawPosition);return(n=r.drawPositions)!=null&&n.some(l=>s==null?void 0:s.includes(l))?(r.matchUpStatus=jt,r.matchUpStatusCodes=[],Ct({tournamentId:t==null?void 0:t.tournamentId,context:a,drawDefinition:e,matchUp:r}),{...Z}):te({result:{error:HK},info:"matchUp does not include BYE",stack:a})}function oI(t){var e,i;let{tournamentRecord:r,appliedPolicies:n,drawDefinition:a,matchUpsMap:o,targetData:s,structure:l,event:u}=t,c="doubleExitAdvancement";if(l.structureType===_n)return te({result:{...Z},stack:c});let{matchUp:d,targetMatchUps:p,targetLinks:m}=s,{loserMatchUp:h,winnerMatchUp:f,loserTargetDrawPosition:g}=p,v=[Ft,Pt].includes(h==null?void 0:h.matchUpStatus)&&!((e=h.sides)!=null&&e.map(y=>y.participantId??y.participant).filter(Boolean).length);if(h&&h.matchUpStatus!==jt){let{loserTargetLink:y}=m;if((i=n==null?void 0:n.progression)!=null&&i.doubleExitPropagateBye){let I=nte({loserTargetDrawPosition:g,tournamentRecord:r,loserTargetLink:y,drawDefinition:a,loserMatchUp:h,matchUpsMap:o,event:u});if(I.error)return te({result:I,stack:c})}else if(!v){let{feedRound:I,drawPositions:b,matchUpId:S}=h,w=I?2:2-b.indexOf(g),U=J2({...t,targetMatchUp:h,walkoverWinningSide:w,tournamentRecord:r,sourceMatchUp:d,matchUpId:S});if(U.error)return te({result:U,stack:c})}}if(f){let y=J2({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:r,sourceMatchUp:d});if(y.error)return te({result:y,stack:c})}return te({result:{...Z},stack:c})}function J2(t){var e,i,r;let{inContextDrawMatchUps:n,tournamentRecord:a,drawDefinition:o,sourceMatchUp:s,targetMatchUp:l,matchUpsMap:u}=t,c=o.structures.find(({structureId:z})=>z===l.structureId),d=t.matchUpStatus===dr?dr:tr,p=t.matchUpStatus===dr?Pt:Ft,m="conditionallyAdvanceDrawPosition",h=u.drawMatchUps.find(z=>z.matchUpId===l.matchUpId);if(!h)return{error:sa};let f=(s==null?void 0:s.drawPositions)||[],g=(e=h.drawPositions)==null?void 0:e.filter(Boolean),v=(s==null?void 0:s.structureId)===l.structureId;if(v&&Nn(f,g)&&(g=g.filter(z=>!f.includes(z))),v&&g.length>1)return te({result:{error:Kf},stack:m});let{pairedPreviousMatchUpIsDoubleExit:y,pairedPreviousMatchUp:I}=bJ(t),b=On({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawDefinition:o}),{targetMatchUps:S,targetLinks:w}=b,{loserTargetDrawPosition:U,winnerMatchUp:T,loserMatchUp:D}=S;if(D){let{loserTargetLink:z}=w,q=nte({loserTargetDrawPosition:U,loserMatchUp:D,tournamentRecord:a,loserTargetLink:z,drawDefinition:o,matchUpsMap:u});if(q.error)return te({result:q,stack:m})}let P=((i=h.drawPositions)==null?void 0:i.filter(Boolean))||[],C=P.length===1,R=t.walkoverWinningSide||C&&iS({drawPosition:P[0],matchUpId:l.matchUpId,inContextDrawMatchUps:n})||void 0,N=[Ft,Pt].includes(h.matchUpStatus)&&!P.length,A=h.finishingRound===1,M=N&&!A?d:p,E=n.find(z=>z.matchUpId===I.matchUpId),O=[],k;s&&((s==null?void 0:s.structureId)===(E==null?void 0:E.structureId)?s.roundPosition<(I==null?void 0:I.roundPosition)?k=1:k=2:l.feedRound?s.structureId===l.structureId?k=2:k=1:R&&(k=3-R));let x=t.matchUpStatus,F=I==null?void 0:I.matchUpStatus;k===1?O=[{matchUpStatus:yU(x),previousMatchUpStatus:x,sideNumber:1},{matchUpStatus:yU(F),previousMatchUpStatus:F,sideNumber:2}]:k===2&&(O=[{matchUpStatus:yU(F),previousMatchUpStatus:F,sideNumber:1},{matchUpStatus:yU(x),previousMatchUpStatus:x,sideNumber:2}]),O.length&&(O=O.map(z=>He(z)));let $=Xs({...t,winningSide:R,matchUp:h,matchUpStatusCodes:O,context:m,matchUpStatus:M});if($.error)return te({result:$,stack:m});if(N)return oI({...t,matchUpStatus:M,targetData:b});if(!T)return te({result:{...Z},stack:m});let _=g.length===2?g[R-1]:g[0],{positionAssignments:L}=oi({structure:c}),B=L==null?void 0:L.find(z=>z.drawPosition===_),V=u.drawMatchUps.find(z=>z.matchUpId===T.matchUpId),G=(r=V==null?void 0:V.drawPositions)==null?void 0:r.filter(Boolean),j=G.length===1;if(_){if(B!=null&&B.bye){let z=On({matchUpId:V.matchUpId,inContextDrawMatchUps:n,drawDefinition:o});if(j){let q=G.filter(Boolean)[0],W=iS({drawPosition:q,matchUpId:V.matchUpId,inContextDrawMatchUps:n}),Y=Xs({appliedPolicies:t.appliedPolicies,matchUpId:V.matchUpId,matchUp:V,matchUpStatus:p,matchUpStatusCodes:[],removeScore:!0,context:m,drawDefinition:o,winningSide:W});return Y.error?te({result:Y,stack:m}):wL({drawPositionToAdvance:q,matchUpId:V.matchUpId,inContextDrawMatchUps:n,drawDefinition:o,matchUpsMap:u})}else if([Ft,Pt].includes(T.matchUpStatus)){let q=oI({...t,matchUpId:V.matchUpId,matchUpStatus:M,targetData:z});if(q.error)return te({result:q,stack:m})}return te({result:{...Z},stack:m})}return pg({matchUpId:T.matchUpId,drawPosition:_,inContextDrawMatchUps:n,drawDefinition:o})}else if(y){if(!V)return{error:sa};if(j){let W=G[0],Y=iS({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawPosition:W});console.log("existing drawPosition is winningSide",{walkoverWinningSide:Y})}let z=[Ft,Pt].includes(V.matchUpStatus)?p:d,q=Xs({matchUpId:V.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:V,matchUpStatusCodes:[],removeScore:!0,context:m,drawDefinition:o,matchUpStatus:z});if(q.error)return te({result:q,stack:m});if(z===d){let W=oI({...t,matchUpId:l.matchUpId,matchUpStatus:z,targetData:b});if(W.error)return W}}return te({result:{...Z},stack:m})}function nte(t){var e;let{loserTargetDrawPosition:i,tournamentRecord:r,loserTargetLink:n,drawDefinition:a,matchUpsMap:o,event:s}=t,l=(e=n==null?void 0:n.target)==null?void 0:e.structureId,{structure:u}=tt({drawDefinition:a,structureId:l});return u?Qa({drawPosition:i,tournamentRecord:r,drawDefinition:a,structureId:l,matchUpsMap:o,event:s}):{error:Up}}function yU(t){return t===tr?Ft:t===dr?Pt:t}function vEe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,o=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=r===jt,u=a.winningSide,c=[tr,dr].includes(r),d=Sw({matchUpStatus:r}),p=wM({matchUpStatus:r}),m=!d&&!p,h=t.matchUpTieId||u&&d&&!c,f=u&&c,g=()=>Xs({...t,removeScore:[yl,Ft].includes(r),matchUpStatus:r||Zi});return m&&{error:tM}||h&&zM(t)||f&&IEe(t)||u&&Av(t)||p&&g()||l&&gEe({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:tM}||c&&yEe(t)||o&&zM(t)||te({result:{error:av},stack:s})}function IEe(t){let e=Av(t);return e.error?e:oI(t)}function yEe(t){let e=zM({...t,removeScore:!0});return e.error?e:oI(t)}function zM(t){var e;let i="scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){let a=Av(t);if(a.error)return te({result:a,stack:i})}let r=!!t.matchUp.collectionId,n=Xs({...t,context:i});if(r){let{matchUpTieId:a,drawDefinition:o,matchUpsMap:s}=t,l=tc({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:o,matchUpsMap:s});if(l.error)return te({result:l,stack:i});Object.assign(n,{tieMatchUpResult:l})}return te({result:n,stack:i})}function bEe({drawDefinition:t,structure:e,matchUp:i}){var r,n,a,o;let{drawPositions:s}=i,{positionAssignments:l}=oi({drawDefinition:t,structure:e}),u=(r=l==null?void 0:l.filter(({drawPosition:p})=>s==null?void 0:s.includes(p)))==null?void 0:r.map(p=>{var m;let{extension:h}=vt({element:p,name:Oc});return(m=h==null?void 0:h.value)==null?void 0:m.groupOrder}),{containerStructures:c}=vv({drawDefinition:t}),d=c[e.structureId];return{structureIds:(o=(a=(n=Iv({drawDefinition:t,structureId:d}))==null?void 0:n.links)==null?void 0:a.source)==null?void 0:o.filter(p=>{var m;return Nn(u,((m=p.source)==null?void 0:m.finishingPositions)||[])}).map(p=>p.source.structureId)}}function ate({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===Kd&&_c({drawDefinition:t,structure:e})){let{structureIds:n}=bEe({drawDefinition:t,structure:e,matchUp:i});n!=null&&n.length&&r.push(...n)}return{connectedStructureIds:r}}function wEe(t){var e,i,r;let n,{inContextDrawMatchUps:a,inContextMatchUp:o,drawDefinition:s,winningSide:l}=t,u=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(u.target.feedProfile===fs){let c=o.sides.find(({sideNumber:p})=>p!==l).participantId,d=a.find(p=>p.structureId===u.target.structureId&&p.roundNumber===u.target.roundNumber&&p.sides.some(({participantId:m})=>m===c));if((d==null?void 0:d.matchUpStatus)===Zi){let p=On({matchUpId:d.matchUpId,inContextDrawMatchUps:a,drawDefinition:s});if(!rp({inContextDrawMatchUps:a,drawDefinition:s,targetData:p})){let{structure:m}=tt({structureId:d.structureId,drawDefinition:s}),h=oi({structure:m}).positionAssignments;for(let f of h||[])if(f.participantId===c){let g=o.sides.find(({sideNumber:v})=>v===l).participantId;if(f.participantId=g,m==null?void 0:m.positionAssignments)m.positionAssignments=h;else if(m!=null&&m.structures){let v=Object.assign({},...(h||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of m.structures)(i=y.positionAssignments)==null||i.forEach(I=>I.participantId=v[I.drawPosition])}Fc({tournamentId:(r=t.tournamentRecord)==null?void 0:r.tournamentId,event:t.event,drawDefinition:s,structure:m}),n=!0}}}}return{...Z,qualifierReplaced:n}}function UEe(t){var e,i,r,n,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:u,winningSide:c}=t,d=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(d.target.feedProfile===fs){let p=(i=l.sides.find(({sideNumber:f})=>f===c))==null?void 0:i.participantId,m=s.filter(f=>f.structureId===d.target.structureId&&f.roundNumber===d.target.roundNumber&&f.sides.some(({participantId:g,qualifier:v})=>v&&!g)),h=Lo(m);if((h==null?void 0:h.matchUpStatus)===Zi){let f=On({matchUpId:h.matchUpId,inContextDrawMatchUps:s,drawDefinition:u});if(!rp({inContextDrawMatchUps:s,drawDefinition:u,targetData:f})){let g=(r=h.sides.find(I=>I.qualifier&&!I.participantId))==null?void 0:r.drawPosition,{structure:v}=tt({structureId:h.structureId,drawDefinition:u});if(!v)return{error:Ni};let y=oi({structure:v}).positionAssignments;for(let I of y||[])if(I.drawPosition===g&&!I.participantId){if(I.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let b=Object.assign({},...(y||[]).map(S=>({[S.drawPosition]:S.participantId})));for(let S of v.structures)(n=S.positionAssignments)==null||n.forEach(w=>w.participantId=b[w.drawPosition])}Fc({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:u,structure:v}),o=!0}}}}return{...Z,qualifierPlaced:o}}function SEe(t){var e,i;let r="attemptToSetWinningSide",n,{appliedPolicies:a,disableAutoCalc:o,drawDefinition:s,dualMatchUp:l,winningSide:u,structure:c,matchUp:d}=t;if(l!=null&&l._disableAutoCalc&&o!==!1)return e_(t);if(d.winningSide&&d.winningSide!==u){let{connectedStructureIds:f}=ate({drawDefinition:s,structure:c,matchUp:d});f.length&&(console.log({connectedStructureIds:f}),n=!0);let g=Av(t);if(g.error)return g}let p=fZ(t);if(p.error)return te({result:p,stack:r});let m,h;return t.qualifierChanging&&(e=a==null?void 0:a[ny])!=null&&e.autoReplaceQualifiers&&(m=wEe(t).qualifierReplaced),t.qualifierAdvancing&&(i=a==null?void 0:a[ny])!=null&&i.autoPlaceQualifiers&&(h=UEe(t).qualifierPlaced),te({result:He({...Z,...p,connectedStructures:n,qualifierReplaced:m,qualifierPlaced:h}),stack:r})}var sS={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function ote(t){var e,i,r,n;let{inContextDrawMatchUps:a,appliedPolicies:o,drawDefinition:s,matchUpsMap:l,targetData:u,matchUp:c}=t,{matchUpId:d}=c,{iteration:p=0}=t;p+=1;let m="removeDoubleExit";Oa({color:"brightyellow",method:m,matchUpId:d,iteration:p,keyColors:sS});let{targetMatchUps:{loserMatchUp:h,winnerMatchUp:f,loserTargetDrawPosition:g},targetLinks:{loserTargetLink:v}}=u;if(f&&f.matchUpStatus!==jt){let{stage:b,roundNumber:S,roundPosition:w,structureName:U}=f;Oa({winner:"winner",roundPosition:w,structureName:U,roundNumber:S,keyColors:sS,stage:b}),Z2({...t,targetMatchUp:f,sourceMatchUp:c,iteration:p})}let y=(h==null?void 0:h.matchUpStatus)===jt&&((h==null?void 0:h.feedRound)||(h==null?void 0:h.roundNumber)===1),I=((i=(e=u==null?void 0:u.targetLinks)==null?void 0:e.loserTargetLink)==null?void 0:i.linkCondition)===sl;if(y&&I){let b=a.filter(({roundNumber:U,structureId:T})=>T===c.structureId&&U===1),S=b.map(({roundPosition:U})=>U),w=Cr(S.sort(),2).find(U=>U.includes(c.roundPosition));if(((r=b.filter(({roundPosition:U})=>w.includes(U)))==null?void 0:r.map(({matchUpStatus:U})=>U)).every(U=>[dr,tr].includes(U)))return te({result:{...Z},stack:m})}if(h&&(h.matchUpStatus!==jt||y)){let b=a.find(({matchUpId:C})=>C===h.matchUpId),{structure:S}=tt({drawDefinition:s,structureId:b.structureId}),{stage:w,roundNumber:U,roundPosition:T,feedRound:D,structureName:P}=h;if(Oa({loser:"loser",roundPosition:T,structureName:P,roundNumber:U,keyColors:sS,feedRound:D,stage:w}),((n=o==null?void 0:o.progression)==null?void 0:n.doubleExitPropagateBye)||y)HM({drawPosition:g,targetLink:v,inContextDrawMatchUps:a,drawDefinition:s,matchUpsMap:l});else{let C=Z2({...t,targetMatchUp:h,structure:S,iteration:p});if(C.error)return te({result:C,stack:m})}}return te({result:{...Z},stack:m})}function Z2(t){var e,i,r,n,a,o;let{inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:u,sourceMatchUp:c,targetMatchUp:d,matchUpsMap:p,structure:m,iteration:h}=t,f="conditionallyRemoveDrawPosition";Oa({method:f,structureName:m==null?void 0:m.structureName,iteration:h});let g=On({matchUpId:d.matchUpId,inContextDrawMatchUps:s,drawDefinition:u}),{targetMatchUps:{winnerMatchUp:v}}=g,y=p==null?void 0:p.drawMatchUps.find(P=>P.matchUpId===d.matchUpId),I=[],b,S,w;if(d.feedRound)w=(i=(e=v==null?void 0:v.drawPositions)==null?void 0:e.filter(Boolean))==null?void 0:i.find(P=>d.drawPositions.includes(P));else if(!c)w=(r=ji((d==null?void 0:d.drawPositions)||[],(v==null?void 0:v.drawPositions)||[]))==null?void 0:r[0];else if(S=(n=wJ({structureId:m.structureId,matchUp:c,matchUpsMap:p}))==null?void 0:n.pairedPreviousMatchUp,b=[tr,dr].includes(S==null?void 0:S.matchUpStatus),I=((a=S==null?void 0:S.drawPositions)==null?void 0:a.filter(Boolean))||[],[...Ir,jt].includes(S==null?void 0:S.matchUpStatus)||(S==null?void 0:S.winningSide)){let P=c.drawPositions||[],C=(o=d.drawPositions)==null?void 0:o.filter(Boolean);Nn(P,C)&&(C=C==null?void 0:C.filter(R=>!P.includes(R))),w=P.concat(I).find(R=>C==null?void 0:C.includes(R))}if(v&&w){let{stage:P,roundNumber:C,roundPosition:R,structureName:N}=v;Oa({method:"removeDirectedWinner",drawPositionToRemove:w,color:"brightgreen",roundPosition:R,structureName:N,roundNumber:C,keyColors:sS,stage:P}),rte({winningDrawPosition:w,winnerMatchUp:v,inContextDrawMatchUps:s,drawDefinition:u,matchUpsMap:p})}let U=ote({targetData:g,matchUp:d,inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:u,matchUpsMap:p,structure:m,iteration:h});if(U.error)return te({result:U,stack:f});let T=TEe({pairedPreviousDoubleExit:b,noContextTargetMatchUp:y}),D=!b;return U=Xs({...t,matchUpId:d.matchUpId,matchUp:y,removeWinningSide:!0,matchUpStatusCodes:[],context:f,matchUpStatus:T,removeScore:D,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),U.error?te({result:U,stack:f}):{...Z}}function TEe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===jt?jt:t?[dr,Pt].includes(e==null?void 0:e.matchUpStatus)?Pt:Ft:Zi}function DEe(t){var e,i,r,n,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:u}=t,c=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(c.target.feedProfile===fs){let d=(r=(i=l.sides)==null?void 0:i.find(({sideNumber:m})=>m===l.winningSide))==null?void 0:r.participantId,p=s.find(m=>{var h;return m.structureId===c.target.structureId&&m.roundNumber===c.target.roundNumber&&((h=m.sides)==null?void 0:h.some(({participantId:f})=>f===d))});if(p&&p.matchUpStatus===Zi){let m=On({matchUpId:p.matchUpId,inContextDrawMatchUps:s,drawDefinition:u});if(!rp({inContextDrawMatchUps:s,drawDefinition:u,targetData:m})){let{structure:h}=tt({structureId:p.structureId,drawDefinition:u}),f=oi({structure:h}).positionAssignments;for(let g of f||[])if(g.participantId===d){if(g.participantId=void 0,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(h==null?void 0:h.structures)||[])(n=y.positionAssignments)==null||n.forEach(I=>I.participantId=v[I.drawPosition])}Fc({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:u,structure:h}),o=!0}}}}return{qualifierRemoved:o}}function PEe(t){var e;let{matchUp:i,matchUpStatus:r,score:n,winningSide:a}=t,o="noDownStreamDependencies";if([tr,dr].includes(i==null?void 0:i.matchUpStatus)&&![tr,dr].includes(r)){let g=ote(t);if(g.error)return te({result:g,stack:o})}let s=r===tr,l=yr({score:n})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!a),u=((e=t==null?void 0:t.inContextMatchUp)==null?void 0:e.collectionId)&&fEe(t.inContextMatchUp),c=t.removeScore||!u&&![Ea,ua].includes(r||Ea),d=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||i.winningSide&&!a&&!yr({score:n}),p=r&&r!==Zi,m=g=>{var v,y;let I,{structure:b,drawDefinition:S,dualMatchUp:w,disableAutoCalc:U}=t;if(w!=null&&w._disableAutoCalc&&U!==!1)return e_({...t,removeWinningSide:d});let{connectedStructureIds:T}=ate({drawDefinition:S,structure:b,matchUp:i});T.length&&(console.log({connectedStructureIds:T}),I=!0),Object.assign(t,{removeScore:g});let D=Av(t);if(D.error)return D;if(t.removingQualifier&&(y=(v=t.appliedPolicies)==null?void 0:v[ny])!=null&&y.autoRemoveQualifiers){let P=DEe(t);return{...Z,connectedStructures:I,...P}}return{...Z,connectedStructures:I}};if(d&&a&&t.isCollectionMatchUp)return Q2(t);let h=[yl,ua].includes(r)&&t.dualWinningSideChange,f=(a||h)&&SEe(t)||l&&m(c)||p&&vEe(t)||d&&m(c)||i&&Q2({...t,removeScore:!0})||{...Z};return te({result:f,stack:o})}function Q2(t){var e;let i="ndd:scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let n=Av(t);if(n.error)return n}let r=Xs({...t,context:i});if(t.isCollectionMatchUp){let{matchUpTieId:n,drawDefinition:a,event:o,matchUpsMap:s}=t,{removeWinningSide:l}=tc({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,drawDefinition:a,matchUpsMap:s,event:o});l&&console.log("REMOVE WINNING SIDE")}return te({result:r,stack:i})}function S$(t){var e,i,r;let n=We(t,[{[wr]:!0,[$n]:!0,[vl]:!0},{homeParticipantId:!0,[zo]:hr}]);if(n.error)return n;let a=Rv(t,[{[pv]:Ql,attr:{[RP]:!0}}]);if(a.error)return a;let o=(r=(i=(e=a==null?void 0:a.matchUp)==null?void 0:e.matchUp)==null?void 0:i.sides)==null?void 0:r.map(m=>m==null?void 0:m.participantId);if(t.homeParticipantId&&!(o!=null&&o.includes(t.homeParticipantId)))return{error:Es};let{disableNotice:s=!0,homeParticipantId:l,removePriorValues:u,tournamentRecord:c,drawDefinition:d,matchUpId:p}=t;return Na({duplicateValues:!1,removePriorValues:u,tournamentRecord:c,drawDefinition:d,disableNotice:s,matchUpId:p,timeItem:{itemType:fL,itemValue:l}})}function ste({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Mp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:HP});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function ld(t){var e;let i="addMatchUpScheduledTime",r=t.matchUp,{removePriorValues:n,tournamentRecord:a,drawDefinition:o,disableNotice:s,scheduledTime:l,matchUpId:u}=t;if(!u)return te({result:{error:bn},stack:i});if(!cv(l))return te({result:{error:No},stack:i});if(!r){let h=Si({drawDefinition:o,matchUpId:u});if(h.error)return te({result:h,stack:i});r=h.matchUp}let c=mt(l),d=Nh({matchUp:r}).scheduledDate,p=c&&!d;if((e=ste({matchUp:r}).timeModifiers||[])!=null&&e.length){let h=lte({disableNotice:!0,removePriorValues:n,tournamentRecord:a,timeModifiers:[],drawDefinition:o,matchUpId:u,matchUp:r});if(h!=null&&h.error)return te({result:h,stack:i})}let m=wh(l,!0,p);return Na({duplicateValues:!1,removePriorValues:n,tournamentRecord:a,drawDefinition:o,disableNotice:s,matchUpId:u,timeItem:{itemType:Eh,itemValue:m}})}function lte({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return te({result:{error:bn},stack:s});if(n!==void 0&&!Array.isArray(n))return te({info:tp("timeModifiers"),result:{error:se},stack:s});if(!o){let d=Si({drawDefinition:i,matchUpId:a});if(d.error)return te({result:d,stack:s});o=d.matchUp}let l=ste({matchUp:o}).timeModifiers||[],u=n.filter(d=>!l.includes(d));if(n.length&&!u.length)return{...Z};if(u.some(d=>vM.includes(d))){l=l.filter(p=>!vM.includes(p));let d=ld({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return te({result:d,stack:s})}let c=n!=null&&n.length?[...u,...l]:void 0;return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:HP,itemValue:c}})}function zR({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:bn};let o=t&&al.test(t);if(t&&!o)return{error:xr};let s={itemValue:mt(t),itemType:Ch};return Na({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s})}function WR({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtIds:s}){var l,u;if(!i&&!e)return{error:ve};if(!o)return{error:bn};let c=Si({drawDefinition:r,matchUpId:o});if(c.error)return c;if(((l=c==null?void 0:c.matchUp)==null?void 0:l.matchUpType)!==Ba)return{error:la};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:se,context:{courtIds:s}};let d;if(s){let p=e||i&&{[i.tournamentId]:i},m=ic({tournamentRecords:p});if(m.error)return m;let h=(u=m.courts)==null?void 0:u.filter(f=>s.includes(f.courtId));if((h==null?void 0:h.length)!==s.length)return{error:se,context:{courtIds:s}};d=h==null?void 0:h.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:Kl,itemDate:a,itemValue:d}})}function Ov({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:o}){if(!i)return{error:ve};if(!a)return{error:bn};if(o){let s=eu({tournamentRecords:e,tournamentRecord:i,venueId:o});if(s.error)return s}return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Rh,itemValue:o}})}function jh({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!e)return{error:ve};if(!o)return{error:bn};if(s){let u=Ah({tournamentRecords:e,tournamentRecord:i,courtId:s});if(u.error)return u;let c=(l=u.venue)==null?void 0:l.venueId;Ov({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,venueId:c})}return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:Lc,itemDate:a,itemValue:s}})}function Vs(t,e){let i=q9.test(t)?t:Ui(t),r=mt(t)||mt(e)||Go(new Date);return new Date(`${r}T${i}`).getTime()}function qR(t){var e;let i="addMatchUpScheduleItems",r=We(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[Jn]:ta}],i);if(r.error)return r;let{matchUpDependencies:n,inContextMatchUps:a}=t,{errorOnAnachronism:o=!1,checkChronology:s=!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,disableNotice:p,drawMatchUps:m,matchUpId:h,schedule:f,event:g}=t,v,y;if(m)v=m.find(E=>E.matchUpId===h);else{let E=Si({drawDefinition:d,event:g,matchUpId:h});if(E.error)return E;v=E.matchUp}let{endTime:I,courtId:b,courtIds:S,courtOrder:w,resumeTime:U,homeParticipantId:T,scheduledDate:D,scheduledTime:P,startTime:C,stopTime:R,timeModifiers:N,venueId:A}=f;s&&(!n||!a)&&({matchUpDependencies:n,matchUps:a}=ds({drawDefinition:d}));let M=(e=n==null?void 0:n[h])==null?void 0:e.matchUpIds;if(f.scheduledDate&&s&&M){let E=a==null?void 0:a.filter(O=>{var k,x;return(((k=O.schedule)==null?void 0:k.scheduledDate)||mt((x=O.schedule)==null?void 0:x.scheduledTime))&&M.includes(O.matchUpId)}).map(({schedule:O})=>{let k=JS(O);return new Date(k).getTime()});if(E!=null&&E.length){let O=JS(f),k=new Date(O).getTime();if(Math.max(...E)>=k){if(o)return te({result:{error:Z1},stack:i});y=Z1}}}if(D!==void 0){let E=zR({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledDate:D,matchUpId:h});if(E!=null&&E.error)return te({result:E,stack:i,context:{scheduledDate:D}})}if(P!==void 0){let E=ld({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledTime:P,matchUpId:h,matchUp:v});if(E!=null&&E.error)return te({result:E,stack:i,context:{scheduledTime:P}})}if(C!==void 0){let E=D$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,startTime:C,event:g});if(E!=null&&E.error)return te({result:E,stack:i,context:{startTime:C}})}if(R!==void 0){let E=R$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,stopTime:R,event:g});if(E!=null&&E.error)return te({result:E,stack:i,context:{stopTime:R}})}if(U!==void 0){let E=C$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,resumeTime:U,matchUpId:h,event:g});if(E!=null&&E.error)return te({result:E,stack:i,context:{resumeTime:U}})}if(I!==void 0){let E=P$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,endTime:I,event:g});if(E!=null&&E.error)return te({result:E,stack:i,context:{endTime:I}})}if(S!==void 0){let E=WR({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,courtIds:S});if(E!=null&&E.error)return te({result:E,stack:i,context:{courtIds:S}})}if(b!==void 0&&D!==void 0){let E=jh({courtDayDate:D,disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:h,courtId:b});if(E!=null&&E.error)return te({result:E,stack:i,context:{courtId:b}})}if(A!==void 0){let E=Ov({disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:h,venueId:A});if(E!=null&&E.error)return te({result:E,stack:i,context:{venueId:A}})}if(w!==void 0&&st(w)){let E=T$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,courtOrder:w,matchUpId:h});if(E!=null&&E.error)return te({result:E,stack:i,context:{courtOrder:w}})}if(N!==void 0){let E=lte({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,timeModifiers:N,matchUpId:h,matchUp:v});if(E!=null&&E.error)return te({result:E,stack:i,context:{timeModifiers:N}})}return Di(T)&&S$({disableNotice:!0,homeParticipantId:T,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h}),p||Ct({tournamentId:c==null?void 0:c.tournamentId,eventId:g==null?void 0:g.eventId,context:i,drawDefinition:d,matchUp:v}),y?{...Z,warnings:[y]}:{...Z}}function T$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:bn};if(n&&!st(n))return{error:se,info:"courtOrder must be numeric"};let o=n&&Qe(n);return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:GP,itemValue:o}})}function ute({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:o}){if(!o)return{error:bn};if(!n)return{error:hr};if(e){let l=Ai({tournamentRecord:e,participantFilters:{participantTypes:[Dt],participantRoles:[DL]}}).participants??[];if(!Ac({tournamentParticipants:l,participantId:n}))return{error:Wi}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(s.itemSubTypes=[a]),Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:o,timeItem:s})}function D$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:o}){if(!n)return{error:bn};if(!cv(a))return{error:No};let{matchUp:s}=Si({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=Nh({matchUp:s}),u=((s==null?void 0:s.timeItems)??[]).filter(c=>[gu,Ol,Lu].includes(c==null?void 0:c.itemType)).map(c=>Vs(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||Vs(a,l)<u){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==gs));let c=wh(a,!0,!0);return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:gs,itemValue:c}})}else return{error:I9}}function P$({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:o,event:s}){if(!a)return{error:bn};if(!cv(o))return{error:No};let{matchUp:l}=Si({drawDefinition:r,event:s,matchUpId:a}),{scheduledDate:u}=Nh({matchUp:l}),c=((l==null?void 0:l.timeItems)??[]).filter(d=>[gs,Ol,gu].includes(d==null?void 0:d.itemType)).map(d=>Vs(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||Vs(o,u)>c){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Lu));let d=wh(o,!0,!0);return Na({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Lu,itemValue:d}})}else return{error:g9}}function R$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:o}){if(!n)return{error:bn};if(!cv(a))return{error:No};let{matchUp:s}=Si({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=Nh({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,f)=>f.itemType===Lu||h,void 0))return{error:iF};let c=u.filter(h=>[gs,Ol,gu].includes(h==null?void 0:h.itemType)).sort((h,f)=>Vs(h.itemValue,l)-Vs(f.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===gu,m=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Vs(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(Vs(a,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:wh(a,!0,!0),itemType:gu};return Na({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:h})}else return{error:v9}}function C$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:o}){if(!a)return{error:bn};if(!cv(n))return{error:No};let{matchUp:s}=Si({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=Nh({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,f)=>f.itemType===Lu||h,void 0))return{error:iF};let c=u.filter(h=>[gs,Ol,gu].includes(h==null?void 0:h.itemType)).sort((h,f)=>Vs(h.itemValue,l)-Vs(f.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===Ol,m=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Vs(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(Vs(n,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:wh(n,!0,!0),itemType:Ol};return Na({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:h})}else return{error:kwe}}function REe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:o,matchUp:s,event:l,score:u}){var c;let d=Ne(n,void 0,!0);for(let m of(d==null?void 0:d.tieMatchUps)||[])m.matchUpId===s.matchUpId&&(m.winningSide=r,m.score=u,!yr({score:u})&&!e?Object.assign(m,{...aR}):e&&(m.matchUpStatus=e));a=a??((c=In({matchUp:s,structure:o,drawDefinition:t,event:l}))==null?void 0:c.tieFormat);let{winningSide:p}=_w({matchUp:d,drawDefinition:t,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:p}}function CEe(t){var e;let{tournamentRecord:i,inContextMatchUp:r,structure:n,drawDefinition:a}=t,o=r.roundNumber,s=r.sides.find(w=>w.sideNumber===r.winningSide),l=r.sides.find(w=>w.sideNumber!==r.winningSide),{drawPosition:u,participantId:c}=s,{drawPosition:d,participantId:p}=l,m="swapWinnerLoser",{matchUps:h}=qt(t),f=h.filter(({drawPositions:w,roundNumber:U})=>(w==null?void 0:w.includes(u))&&U>o);ja({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:f}),f.forEach(w=>{var U,T;w.drawPositions=((U=w.drawPositions)==null?void 0:U.map(D=>D===u?d:D))||[],Ct({tournamentId:i==null?void 0:i.tournamentId,eventId:(T=t.event)==null?void 0:T.eventId,context:m,drawDefinition:a,matchUp:w})});let{stage:g,stageSequence:v}=n,y=a.structures.filter(({stage:w,stageSequence:U})=>w===g&&U>v).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:I,winnerTargetLink:b}}=t.targetData,S=[I==null?void 0:I.target.structureId,(e=b==null?void 0:b.target)==null?void 0:e.structureId].filter(Boolean);return a.structures.filter(({stage:w,structureId:U})=>w!==g&&S.includes(U)).forEach(({stage:w,stageSequence:U,structureId:T})=>{y.includes(T)||y.push(T),a.structures.filter(({stage:D,stageSequence:P})=>D===w&&P>U).forEach(({structureId:D})=>{y.includes(D)||y.push(D)})}),a.structures.filter(({structureId:w})=>y.includes(w)).forEach(w=>{let{positionAssignments:U}=oi({structure:w}),T=U==null?void 0:U.find(({participantId:P})=>P===c),D=U==null?void 0:U.find(({participantId:P})=>P===p);T&&(T.participantId=p),D&&(D.participantId=c)}),Xs({...t,context:m})}function Qw(t){var e,i,r;let n="setMatchUpStatus";t.matchUpStatus&&[Ft,tr].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:a,disableScoreValidation:o,tournamentRecords:s,tournamentRecord:l,disableAutoCalc:u,enableAutoCalc:c,drawDefinition:d,matchUpStatus:p,winningSide:m,matchUpId:h,event:f,score:g}=t;if(!d)return{error:$e};if(p&&[yl,Ea,ua,Zi].includes(p)&&m)return{error:se,winningSide:m,matchUpStatus:p};if(![void 0,...uX].includes(p))return te({result:{error:av},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let v=ln({drawDefinition:d}),{matchUps:y}=fr({nextMatchUps:!0,tournamentRecord:l,inContext:!0,drawDefinition:d,matchUpsMap:v,event:f}),I=v.drawMatchUps.find(B=>B.matchUpId===h),b=y==null?void 0:y.find(B=>B.matchUpId===h);if(!I||!y)return{error:hn};if((I.winningSide||m)&&p===jt)return{context:"Cannot have Bye with winningSide",error:qU,matchUpStatus:p};let S=b==null?void 0:b.structureId,{structure:w}=tt({drawDefinition:d,structureId:S}),U=Xi(fi)(I.matchUpType),T=(e=b==null?void 0:b.drawPositions)==null?void 0:e.filter(Boolean),D=b==null?void 0:b.matchUpTieId,P=On({matchUpId:D||h,inContextDrawMatchUps:y,drawDefinition:d});Object.assign(t,{inContextDrawMatchUps:y,inContextMatchUp:b,matchUpTieId:D,matchUpsMap:v,targetData:P,structure:w,matchUp:I});let C=rp(t),R;if(U){if(u)_t({extension:{name:Am,value:!0},element:I});else if(c){let B=I.winningSide,{winningSide:V,scoreStringSide1:G,scoreStringSide2:j,set:z}=_w({drawDefinition:d,matchUpsMap:v,structure:w,matchUp:I,event:f}),q={scoreStringSide1:G,scoreStringSide2:j,sets:z?[z]:[]};if(R=V!==B,C&&R)return te({stack:"winningSideWithDownstreamDependencies",result:{error:sP},context:{winningSide:m,matchUp:I}});Dn({name:Am,element:I}),Object.assign(t,{winningSide:V,dualWinningSideChange:R,projectedWinningSide:V,score:q})}$w({tournamentId:l==null?void 0:l.tournamentId,inContextDualMatchUp:b,eventId:f==null?void 0:f.eventId,dualMatchUp:I,drawDefinition:d})}if(U&&p&&[Sh].includes(p))return{info:"Not supported for matchUpType: TEAM",error:se};if(g&&!U&&!o){let B=I.matchUpFormat??(w==null?void 0:w.matchUpFormat)??(d==null?void 0:d.matchUpFormat)??(f==null?void 0:f.matchUpFormat),V=T_({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:B,matchUpStatus:p,winningSide:m,score:g});if(V.error)return V}let N=((i=Bt({policyTypes:[ny,fo],tournamentRecord:l,drawDefinition:d,event:f}))==null?void 0:i.appliedPolicies)??{};At(t.policyDefinitions)&&Object.assign(N,t.policyDefinitions);let A=MEe({assignedDrawPositions:T,inContextMatchUp:b,appliedPolicies:N,drawDefinition:d,matchUpStatus:p,structure:w,matchUp:I});if(A!=null&&A.error)return A;let M=(b==null?void 0:b.stage)===Ke&&b.finishingRound===1,E=M&&m,O=M&&I.winningSide&&!m&&(!t.matchUpStatus||t.matchUpStatus&&wM({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!yr({outcome:t.outcome})),k=E&&m!==I.winningSide&&I.winningSide;if(Object.assign(t,{qualifierAdvancing:E,qualifierChanging:k,removingQualifier:O,appliedPolicies:N}),D){let{matchUp:B}=Si({matchUpId:D,inContext:!0,drawDefinition:d,matchUpsMap:v,event:f});if(B){let V=(r=In({matchUp:B,drawDefinition:d,structure:w,event:f}))==null?void 0:r.tieFormat,{projectedWinningSide:G}=REe({drawDefinition:d,matchUpStatus:p,dualMatchUp:B,matchUpsMap:v,winningSide:m,tieFormat:V,structure:w,matchUp:I,event:f,score:g}),j=B.winningSide;R=G!==j;let z=B._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:R,projectedWinningSide:G,autoCalcDisabled:z,matchUpTieId:D,dualMatchUp:B,tieFormat:V})}}let x=Sw({matchUpStatus:p});if(!D){if(C&&!m&&(p&&wM({matchUpStatus:p})||p&&[tr,dr].includes(p)))return{error:qU,activeDownstream:C,winningSide:m};if(m&&m===I.winningSide&&p&&!x)return{context:"winningSide must include directing matchUpStatus",error:qU,directingMatchUpStatus:x,matchUpStatus:p}}let{schedule:F}=t;if(F){let B=qR({disableNotice:!0,tournamentRecords:s,tournamentRecord:l,drawDefinition:d,matchUpId:h,schedule:F});if(B.error)return B}let $=!U&&!R&&m&&I.winningSide&&I.winningSide!==m;if(a&&$&&I.roundPosition)return CEe(t);let _=m&&!D||t.projectedWinningSide;Oa({activeDownstream:C,matchUpWinner:_,method:n,winningSide:m});let L=!C&&PEe(t)||_&&EEe(t)||(x||t.autoCalcDisabled)&&cte(t)||{error:P9};return te({result:L,stack:n})}function EEe(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?cte(t):te({stack:"winningSideWithDownstreamDependencies",result:{error:sP},context:{winningSide:i,matchUp:e}})}function cte(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!yr({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&Zi||t.winningSide&&Ki||Ea:t.matchUpStatus||Ki,o=t.removeScore||[yl,Ft].includes(a)&&![Ea,ua].includes(a),s=Xs({...t,matchUpStatus:a,removeWinningSide:n,context:"sms",removeScore:o});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=tc({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:r});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function MEe({assignedDrawPositions:t,inContextMatchUp:e,appliedPolicies:i,drawDefinition:r,matchUpStatus:n,structure:a,matchUp:o}){var s,l;if(((s=i==null?void 0:i[fo])==null?void 0:s.requireParticipantsForScoring)===!1)return{...Z};let u=(l=e==null?void 0:e.sides)==null?void 0:l.map(p=>p.participantId).filter(Boolean).length,c=o!=null&&o.sides?[]:oi({structureId:a==null?void 0:a.structureId,drawDefinition:r}).positionAssignments,d=u&&u===2||o.collectionId&&Yn({structure:a})&&u&&u>=1||(t==null?void 0:t.length)===2&&(c==null?void 0:c.filter(p=>t.includes(p.drawPosition)).every(p=>p.participantId));return n&&lX.includes(n)&&!d?te({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:n,requiredParticipants:d},result:{error:av}}):{...Z}}function dte({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:$e};let{matchUp:n}=Si({drawDefinition:e,matchUpId:i,event:r});return(n==null?void 0:n.matchUpType)!==Ba?{error:la}:Qw({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function pte({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:$e};if(!i)return{error:bn};let{matchUp:r}=Si({drawDefinition:t,event:e,matchUpId:i});return r?Dn({name:OP,element:r}):{error:hn}}function NEe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:o}){var s,l,u,c,d;let p="substituteParticipant";if(!r)return{error:$e};if(!a)return{error:bn};if(!e||!t)return te({result:{error:hr},stack:p});let{matchUp:m}=Si({drawDefinition:r,matchUpId:a,event:o});if(!m)return{error:hn};if(!m.collectionId)return te({result:{error:la},stack:p});let h=ln({drawDefinition:r}),{matchUps:f}=fr({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:r,matchUpsMap:h}),g=f==null?void 0:f.find(y=>y.matchUpId===a),v=(l=(s=f==null?void 0:f.find(y=>y.matchUpId===(g==null?void 0:g.matchUpTieId)))==null?void 0:s.sides)==null?void 0:l.find(y=>y.participant.individualParticipants.some(({participantId:I})=>I===e));return!v||n&&v.sideNumber!==n?{error:Es}:(d=(c=(u=v.participant)==null?void 0:u.individualParticipants)==null?void 0:c.map(Tt).filter(y=>y!==e))!=null&&d.includes(t)?w$({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:o}):te({result:{error:Es},stack:p})}function mte(t){return NEe(t)}function hte({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:$e};let{matchUp:r}=Si({drawDefinition:t,matchUpId:e,event:i});return _t({extension:{name:Am,value:!0},element:r})}function fte(t){let e="setMatchUpFormat",i=We(t,[{tournamentRecord:!0},{[Xr]:S=>Ra({matchUpFormat:S}),[Ha]:Yb,matchUpFormat:!0}]);if(i.error)return te({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:m,event:h,force:f}=t;if(a&&!Array.isArray(a))return te({result:{error:se,scheduledDates:a},stack:e});if(u&&!eP([ol,ho],u))return te({result:{error:Gl},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],I=t.drawIds||m&&[m].filter(Boolean)||[];if((l||v!=null&&v.length)&&!n)return te({result:{error:$e},stack:e});if(m&&c&&n){let S=C_({tournamentRecord:r,drawDefinition:n,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:c});if(S.error)return S;g+=1}let b=S=>{let w=[];for(let U of S.structures||[]){if(Array.isArray(p)&&!p.includes(U.stage)||Array.isArray(o)&&!o.includes(U.stageSequence)||v!=null&&v.length&&!v.includes(U.structureId))continue;v!=null&&v.length&&U.matchUpFormat!==s&&(U.matchUpFormat=s,w.push(U.structureId),g+=1);let T=((f||a)&&qt({matchUpFilters:{matchUpStatuses:[Zi]},structure:U}).matchUps)??[],D=(a&&qt({matchUpFilters:{matchUpStatuses:[Zi]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:U}).matchUps)??[];if(T!=null&&T.length){let P=D?D.map(Dr):T.map(Dr);for(let C of T)P.includes(C.matchUpId)&&(C.matchUpFormat=a!=null&&a.length?s:void 0,Ct({tournamentId:r==null?void 0:r.tournamentId,eventId:h==null?void 0:h.eventId,context:e,drawDefinition:S,matchUp:C}))}}return!w.length&&S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1),w};for(let S of(r==null?void 0:r.events)||[])if(!(y!=null&&y.length&&!y.includes(S.eventId)||u&&u!==S.eventType||u===ur))if(Array.isArray(o)||Array.isArray(p)||v!=null&&v.length||I!=null&&I.length)for(let w of S.drawDefinitions||[]){if(Array.isArray(I)&&!I.includes(w.drawId))continue;let U=b(w);li({structureIds:U,drawDefinition:w})}else S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1);return g?{...Z,modificationsCount:g}:{...Z,info:uv}}function E$({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){var a,o;if(!i)return{error:$e};let s=(a=Si({drawDefinition:i,matchUpId:r}))==null?void 0:a.matchUp;if(!(s!=null&&s.tieMatchUps))return{error:la};let l=(o=Si({inContext:!0,drawDefinition:i,matchUpId:r,event:n}))==null?void 0:o.matchUp,u=0;return((s==null?void 0:s.sides)||[]).forEach(c=>{c.lineUp&&delete c.lineUp}),((l==null?void 0:l.sides)||[]).forEach(c=>{if(u+=1,t===!1){let d=l==null?void 0:l.tieFormat,p=c.participantId;d&&p&&Lh({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}Ct({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:n==null?void 0:n.eventId,drawDefinition:i,matchUp:s})}),{...Z,modificationsCount:u}}function gte(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}=t;if(!n)return{sets:[]};let a=n.sets||[],o=xl({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:a}),s=xl({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:a}),l=xl({matchUpFormat:e,matchUpStatus:i,winningSide:r,sets:a}),u=o===l?s:o;return r&&(o=r===1?l:u,s=r===2?l:u),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function eU(t){var e,i;let r=We(t,[{[vl]:!0,[$n]:!0}]);if(r.error)return r;let n=To(t);if(!t.drawDefinition){let I=t.tournamentRecord??(t.tournamentId&&n[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=I);let b=Kn({eventId:t.eventId,drawId:t.drawId,tournamentRecord:I});if(b.error)return b;b.drawDefinition&&(t.drawDefinition=b.drawDefinition),t.event=b.event}let{disableScoreValidation:a,policyDefinitions:o,tournamentRecord:s,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpId:d,schedule:p,event:m,notes:h}=t,f=t.matchUpFormat||((e=t.outcome)==null?void 0:e.matchUpFormat),{policy:g}=Rp({policyType:fo,tournamentRecord:s,event:m}),v=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(g==null?void 0:g.allowChangePropagation)!==void 0&&g.allowChangePropagation||void 0,{outcome:y}=t;if(y!=null&&y.winningSide&&![1,2].includes(y.winningSide))return{error:aP};if(f){let I=C_({tournamentRecord:s,drawDefinition:c,matchUpFormat:f,matchUpId:d,event:m});if(I.error)return I}if((i=y==null?void 0:y.score)!=null&&i.sets&&!y.score.scoreStringSide1){let{score:I}=gte(y);y.score=I,y.score.sets=y.score.sets.filter(b=>b.side1Score||b.side2Score||b.side1TiebreakScore||b.side2TiebreakScore)}return Qw({matchUpStatusCodes:y==null?void 0:y.matchUpStatusCodes,matchUpStatus:y==null?void 0:y.matchUpStatus,winningSide:y==null?void 0:y.winningSide,allowChangePropagation:v,disableScoreValidation:a,score:y==null?void 0:y.score,tournamentRecords:n,policyDefinitions:o,tournamentRecord:s,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpFormat:f,matchUpId:d,schedule:p,event:m,notes:h})}function vte(t){if(!(t!=null&&t.outcomes))return{error:Je};if(!Array.isArray(t.outcomes))return{error:Je,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:ve};let o=i.filter(s=>s.tournamentId===n);if(o.length){let s=AEe({outcomes:o,tournamentRecord:a});if(s.error)return s}}return{...Z}}function AEe(t){var e;let{tournamentRecords:i,tournamentRecord:r,outcomes:n,policyDefinitions:a}=t,o={};n.forEach(s=>{let{eventId:l}=s;o[l]||(o[l]=[]),o[l].push(s)});for(let s of Object.keys(o)){let{event:l}=Kn({tournamentRecord:r,eventId:s});for(let u of o[s]){let{drawId:c}=u,d=(e=l==null?void 0:l.drawDefinitions)==null?void 0:e.find(p=>p.drawId===c);if(d&&c){let{matchUpFormat:p,matchUpId:m}=u,h=eU({schedule:u==null?void 0:u.schedule,tournamentRecords:i,policyDefinitions:a,tournamentRecord:r,drawDefinition:d,matchUpFormat:p,matchUpId:m,outcome:u,drawId:c,event:l});if(h.error)return h}}}return{...Z}}function OEe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){var n,a;if(!r&&!t)return{error:$e};if(!i)return{error:Je,info:"missing outcome"};if(!r&&!e)return{error:sa};if(!r){let o=Si({drawDefinition:t,matchUpId:e});if(o.error)return o;r=o.matchUp}return typeof i!="object"||!((n=i.score)!=null&&n.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:se}:_t({element:r,extension:{name:OP,value:i}})}function Ite(t){return OEe(t)}function M$(t){var e,i;let r="resetTieFormat",{drawDefinition:n,event:a,uuids:o}=t,s=We(t,[{[wr]:!0,[vl]:!0}],r);if(s.error)return s;let l=Rv(t,[{[pv]:Ql}]);if(l[zo])return l;let u=(e=t.tournamentRecord)==null?void 0:e.tournamentId,{matchUp:c,structure:d}=(l==null?void 0:l.matchUp)??{};if(!(c!=null&&c.tieMatchUps))return te({result:{error:la},info:"Must be a TEAM matchUp",stack:r});if(!c.tieFormat)return{...Z};let p=(i=In({structure:d,drawDefinition:n,event:a}))==null?void 0:i.tieFormat;if(!p)return te({result:{error:Vr},info:"No inherited tieFormat",stack:r});let m=[],h=[],f=[],g=[];for(let v of p.collectionDefinitions){let{matchUpCount:y,collectionId:I}=v;h.push(I);let b=(c.tieMatchUps||[]).filter(S=>S.collectionId===I);if(b.length>y)b.sort((S,w)=>(S.matchUpStatus===Zi?1:0)-(w.matchUpStatus===Zi?1:0)),f.push(...b.slice(0,y)),m.push(...b.slice(3).map(Dr));else if(f.push(...b),b.length<y){let S=y-b.length,w=Fw({collectionDefinition:v,matchUpsLimit:S,matchUp:c,uuids:o});g.push(...w)}}for(let v of(c==null?void 0:c.tieMatchUps)||[])v.collectionId&&!h.includes(v.collectionId)&&m.push(v.matchUpId);return g.length&&(f.push(...g),xc({eventId:a==null?void 0:a.eventId,matchUps:g,drawDefinition:n,tournamentId:u})),m.length&&Zu({matchUpIds:m,eventId:a==null?void 0:a.eventId,drawDefinition:n,tournamentId:u}),c&&(c.tieMatchUps=f,c.tieFormatId=void 0,c.tieFormat=void 0,Ct({structureId:d==null?void 0:d.structureId,eventId:a==null?void 0:a.eventId,context:r,drawDefinition:n,tournamentId:u,matchUp:c})),{...Z,newMatchUps:g,deletedMatchUpIds:m}}function N$(t){var e,i,r;let{tournamentRecord:n,drawDefinition:a,matchUpId:o,event:s}=t,l="resetScorecard";if(!a)return te({result:{error:$e},stack:l});if(!o)return te({result:{error:bn},stack:l});if(!Di(o))return te({result:{error:se,matchUpId:o},stack:l});let u=ln({drawDefinition:a}),{matchUps:c}=fr({nextMatchUps:!0,inContext:!0,drawDefinition:a,matchUpsMap:u}),d=u.drawMatchUps.find(y=>y.matchUpId===o),p=c==null?void 0:c.find(y=>y.matchUpId===o);if(!d||!c)return{error:hn};if(d.matchUpType!==Ca)return{error:la};let m=On({inContextDrawMatchUps:c,drawDefinition:a,matchUpId:o}),h=p==null?void 0:p.structureId,{structure:f}=tt({drawDefinition:a,structureId:h});if(Object.assign(t,{inContextDrawMatchUps:c,inContextMatchUp:p,matchUpsMap:u,targetData:m,structure:f,matchUp:d}),rp(t))return{error:sP};if((e=d.tieMatchUps)!=null&&e.length)for(let y of d.tieMatchUps){let I=Qw({matchUpId:y.matchUpId,matchUpTieId:o,winningSide:void 0,removeScore:!0,tournamentRecord:n,drawDefinition:a,event:s});if(I.error)return te({result:I,stack:l})}let g=(i=Bt({tournamentRecord:n,drawDefinition:a,event:s}))==null?void 0:i.appliedPolicies,v=tc({event:t.event,removeScore:!0,tournamentRecord:n,appliedPolicies:g,drawDefinition:a,matchUpsMap:u,matchUpId:o});if(v.error)return te({result:v,stack:l});if(t.tiebreakReset&&!v.tieFormatRemoved){let y=(r=In({drawDefinition:a,structure:f,event:s}))==null?void 0:r.tieFormat;if(d.tieFormat&&y){let{matchUpCountDifference:I,descendantDifferences:b,ancestorDifferences:S,valueDifference:w}=_u({descendant:d.tieFormat,ancestor:y});if(b.collectionIds.length===1&&!S.collectionIds.length&&!S.groupsCount&&I===1&&w===1){let U=M$({tournamentRecord:n,drawDefinition:a,matchUpId:o,event:s});if(U.error)return U}}}return{...Z}}function yte(t){let e=We(t,[{[$n]:!0,[ed]:!0},{[ag]:{[nw]:!1,roundNumbers:!1},[Y8]:"At least one must be provided",[Jn]:cn}]);if(e.error)return e;let i=UZ(t);if(i.error)return i;let{matchUpIds:r}=i,n=Xi(Ca)(t.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=t;for(let l of r){if(n){let c=N$({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(c.error||t.removeAssignments&&E$({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return c}let u=Qw({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(u.error)return u;if(t.removeAssignments){let c=U$({...t,matchUpId:l});if(c.error)return c}}return{...Z}}function kEe({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){var r;if(!e)return{error:$e};let n="setOrderOfFinish";if(!Array.isArray(i))return te({info:tp("finishingOrder"),result:{error:se},stack:n});let{completedMatchUps:a,matchUpsMap:o}=yv({inContext:!0,drawDefinition:e}),s=(a==null?void 0:a.map(Dr))??[],l=i.map(Dr),{matchUpTypes:u,roundNumbers:c,structureIds:d,matchUpTieIds:p}=(a??[]).filter(({matchUpId:I})=>l.includes(I)).reduce((I,b)=>{let{matchUpTieId:S,matchUpType:w,roundNumber:U,structureId:T}=b;return I.matchUpTypes.includes(w)||I.matchUpTypes.push(w),I.roundNumbers.includes(U)||I.roundNumbers.push(U),I.structureIds.includes(T)||I.structureIds.push(T),I.matchUpTieIds.includes(S)||I.matchUpTieIds.push(S),I},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(u.length>1||p.length>1||c.length>1||d.length>1)return te({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:se},stack:n});let m,h,f={},g=[],v=[];if(!i.every(({orderOfFinish:I,matchUpId:b})=>(g.push(b),I&&v.push(I),f[b]=I,m=s.includes(b),h=I===void 0||st(I)&&Math.floor(I)>0,m&&h)))return te({result:{error:m?se:av},info:!m&&"matchUps must be completed"||!h&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:n});let y=a==null?void 0:a.filter(I=>I.structureId===d[0]&&I.roundNumber===c[0]&&I.matchUpType===u[0]&&I.matchUpTieId===p[0]&&!g.includes(I.matchUpId));for(let I of y??[]){let{orderOfFinish:b}=I||{};if(b){if(!st(b))return te({context:{orderOfFinish:b,matchUp:I},result:{error:se},stack:n});v.push(b)}}if(vK(v).length!==v.length||Math.max(...v)>v.length)return te({info:"Values not unique or greater than expected number of values",result:{error:se},stack:n});if(d.length){let I=KP({matchUpFilters:{matchUpIds:l},structureId:d[0],drawDefinition:e,matchUpsMap:o});if(I.error)return te({result:I,stack:n});(r=I.completedMatchUps)==null||r.forEach(b=>{b.orderOfFinish=f[b.matchUpId],Ct({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:b})})}return{...Z}}function bte(t){return kEe(t)}function wte(t){var e,i,r,n;let{tournamentRecord:a,drawDefinition:o,matchUpId:s,lineUps:l,event:u}=t,c="applyLineUps",d=We(t,[{[wr]:!0,[$n]:!0,[vl]:!0},{lineUps:!0,[Jn]:cn}],c);if(d.error)return d;let p=a.participants||[],m=Si({tournamentParticipants:p,inContext:!0,drawDefinition:o,matchUpId:s});if(m.error)return m;if(!m.matchUp)return{error:hn};let{matchUp:h,structure:f}=m,{drawPositions:g,matchUpType:v}=h;if(v!==fi)return{error:la};if(!(g!=null&&g.length))return{error:Wb};let y=(e=In({matchUp:h,drawDefinition:o,structure:f,event:u}))==null?void 0:e.tieFormat,I={};for(let S of l){if(!Array.isArray(S))return{error:se,lineUp:S};let w={},U=[];for(let R of S){if(typeof R!="object")return{error:se,lineUpAssignment:R};let{participantId:N,collectionAssignments:A=[]}=R;if(!Array.isArray(A))return{error:se,collectionAssignments:A};let M=p.find(O=>O.participantId===N);if(!M)return{error:Wi};if(M.participantType!==Dt)return{error:Ms};let E=(r=(i=h.sides)==null?void 0:i.find(O=>{var k,x;return(x=(k=O.participant)==null?void 0:k.individualParticipantIds)==null?void 0:x.includes(N)}))==null?void 0:r.sideNumber;E&&U.push(E);for(let O of A){if(typeof O!="object")return{error:se,collectionAssignment:O};let{collectionId:k,collectionPosition:x}=O,F=(n=y==null?void 0:y.collectionDefinitions)==null?void 0:n.find(L=>L.collectionId===k);if(!F)return{error:se,collectionId:k};let $=`${k}-${x}`;w[$]||(w[$]=[]);let _=w[$].length;if(Xi(ii)(F.matchUpType)&&_||F.matchUpType===ei&&_>1)return{info:"Excessive collectionPosition assignments",error:se};w[$].push(N)}}let T=Object.values(w);for(let R of T)if(R.length===2){let{participant:N}=ns({tournamentParticipants:p,participantIds:R});if(!N){let A=dl({participant:{participantType:ft,participantRole:en,individualParticipantIds:R},pairOverride:!0,tournamentRecord:a});if(A.error)return A}}let D=Pa(U),P=(D[1]||0)>(D[2]||0)&&1||(D[2]||0)>(D[1]||0)&&2||void 0,C=Object.keys(I).map(R=>parseInt(R));P&&!C.includes(P)&&(I[P]=S)}if(!Object.keys(I).length)return{error:sF};if(m=Si({drawDefinition:o,matchUpId:s}),m.error)return m;if(!m.matchUp)return{error:hn};let{matchUp:b}=m;b.sides||(b.sides=[]);for(let S of[1,2]){let w=b.sides.find(T=>T.sideNumber===S),U=I[S];if(U)w?w.lineUp=U:b.sides.push({lineUp:U,sideNumber:S});else continue}return Ct({tournamentId:a==null?void 0:a.tournamentId,context:c,drawDefinition:o,matchUp:b}),{...Z}}var A$={};bt(A$,{anonymizeTournamentRecord:()=>Gte,generate:()=>Ute,generateEventWithDraw:()=>ZR,generateOutcome:()=>B$,generateOutcomeFromScoreString:()=>O$,generateParticipants:()=>kv,generateTournamentRecord:()=>Vte,modifyTournamentRecord:()=>Hte,mutate:()=>jte});var Ute={};bt(Ute,{generateEventWithDraw:()=>ZR,generateOutcome:()=>B$,generateOutcomeFromScoreString:()=>O$,generateParticipants:()=>kv,generateTournamentRecord:()=>Vte});function O$(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n}=t;if(!n)return{outcome:{...aR,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:se,winningSide:r};let a=n&&b0({scoreString:n}),o={},s=xl({sets:a,matchUpFormat:e}),l=xl({sets:a,reversed:!0,matchUpFormat:e});return r===2?(o.scoreStringSide1=l,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=l),o.sets=b0({scoreString:o.scoreStringSide1}),He({outcome:{matchUpStatus:i,winningSide:r,score:o}})}function k$({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){var n;let a=(((n=e==null?void 0:e[r.matchUpId])==null?void 0:n.matchUpIds)||[]).filter(o=>i.includes(o)).filter(o=>!t[o]);return{dependenciesScheduled:!(a!=null&&a.length),remainingDependencies:a}}function tU({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function xEe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function Iy({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var u,c;let d=Ui((u=l==null?void 0:l.schedule)==null?void 0:u.endTime),p=d?ra(d,Qe(o)):ra(s,Qe(r)+Qe(o)),m=i&&(d?ra(Ui(d),i):ra(s,Qe(r)+Qe(i))),h=((c=a==null?void 0:a[l.matchUpId])==null?void 0:c.participantIds)||[],f=(l.roundPosition&&t[l.matchUpId]||[]).flat();h.forEach(g=>{tU({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&m||p;f.includes(g)?xEe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),fg({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:p,matchUp:l})}function Ste({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){var a,o,s,l,u;let c,d=(o=(a=n.minutesMap)==null?void 0:a[r])==null?void 0:o.recoveryMinutes,p=(((l=(s=n.minutesMap)==null?void 0:s[r])==null?void 0:l.averageMinutes)||0)+(d||0),m=ra(i,p),h=((u=e==null?void 0:e[r])==null?void 0:u.dependentMatchUpIds)||[];if(h.length){let f=h.reduce((g,v)=>{let y=t[v];if(!y)return g;let I={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||xt(y)<xt(g.scheduleTime)?I:g},{});f.scheduleTime&&xt(m)>xt(f.scheduleTime)&&(c=f)}return{scheduledDependent:c}}function FEe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>{var n;return i===ei&&(((n=r==null?void 0:r.participant)==null?void 0:n.individualParticipants)||[])||(r==null?void 0:r.participant)&&[r.participant]||[]}).flat()}var iU="DO_NOT_SCHEDULE",LEe={DO_NOT_SCHEDULE:iU};function x$({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:o}){let s=FEe(o).map(({person:m})=>m==null?void 0:m.personId);if(i){let m=((o==null?void 0:o.potentialParticipants)||[]).flat().map(({person:h})=>h==null?void 0:h.personId);s.push(...m)}let l=s.map(m=>{var h;return(h=r[m])==null?void 0:h.map(f=>({...f,personId:m}))}).filter(Boolean).flat().filter(m=>m.requestType===iU&&Hl(a,m.date)),u=[],c=o==null?void 0:o.matchUpId,d=rr(Ui(n),mt(a)),p=Ui(bF(d,t).toISOString());for(let m of l){let{requestId:h,startTime:f,endTime:g}=m;(n>f&&n<g||p>f&&p<g)&&(u.push({matchUpId:c,request:m,scheduleTime:n}),e[h]?(e[h].scheduleTimes.includes(n)||e[h].scheduleTimes.push(n),e[h].matchUpIds.includes(c)||e[h].matchUpIds.push(c)):e[h]={request:m,scheduleTimes:[n],matchUpIds:[c]})}return{conflicts:u}}function WM({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=BP(i),o=(t[i.matchUpId]||[]).filter(s=>!Nn(s,a)).flat();[...a,...o].forEach(s=>{if(tU({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[qo]?l[qo]+=r:r>0&&(l[qo]=r),o.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function _Ee({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){var p,m;let h=[];i||(n=d==null?void 0:d.filter(v=>{let y=v.schedule||{},I=v.matchUpStatus===jt;return I&&h.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!I&&Yw({schedule:y})&&(!u||v.schedule.scheduledDate===u)}),i=n.map(Dr));let f=Array.isArray(l)?l.includes(u):l,g=f?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of g){WM({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(p=v.schedule)==null?void 0:p.scheduledTime;if(y){o[v.matchUpId]=y;let I=(m=c==null?void 0:c[v.matchUpId])==null?void 0:m.recoveryMinutes;Iy({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:r,recoveryMinutes:I,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:h,dateScheduledMatchUps:n,clearDate:f}}function YR({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:o,matchUps:s}){if(typeof r!="object")return{error:ki};if(!Ro(s)&&!Array.isArray(i))return{error:Xu};a=a??VR({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:m}=dw({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:m}}})).flat()),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return Yw({schedule:p})&&(!o||d.schedule.scheduledDate===o)}));let c=i==null?void 0:i.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!==jt);return{bookings:c==null?void 0:c.map(({eventId:d,schedule:p,matchUpFormat:m})=>{let{event:h,scheduleTiming:f}=l[d],g=h==null?void 0:h.eventType,v={...f,defaultTiming:u,matchUpFormat:m},{averageMinutes:y,recoveryMinutes:I}=zP({timingDetails:v,eventType:g}),{courtId:b,venueId:S}=p,w=Ui(p.scheduledTime),U=ra(w,y);return{recoveryMinutes:I,averageMinutes:y,periodLength:a,startTime:w,courtId:b,endTime:U,venueId:S}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function $Ee({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),typeof a!="object"||!Object.keys(a).length)return{error:ki};s=s??VR({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:m,venues:h}=ic({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),f=(m==null?void 0:m.filter(S=>!c||c.includes(S.venueId)))??[];u=u??gg({courts:f,scheduleDate:l,startTime:!0}),p=p??gg({courts:f,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=YR({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:c,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:s,startTime:u,bookings:g,endTime:p,courts:f},{scheduleTimes:I}=v$(y),b=(c==null?void 0:c.length)===1&&c[0]||(h==null?void 0:h.length)===1&&h[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(Ma("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:I,venueId:b}}function BEe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,o,s,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(n=n.concat(u.matchUpIds)),u.hash!==l&&!i&&(l=u.hash,r.push({averageMinutes:s,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:n}),n=u.matchUpIds),s=i?e:u.averageMinutes,o=u.recoveryMinutes,a=u.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:o,averageMinutes:s}),{groupedRounds:r}}function Tte({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:m,venues:h}){var f;let g={},v=[],y=[],I=[];for(let b of h){let{rounds:S=[],venueId:w}=b,{scheduledRoundsDetails:U,greatestAverageMinutes:T,orderedMatchUpIds:D,minutesMap:P}=Ww({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:u,matchUps:p,rounds:S});I.push(...D??[]);let{groupedRounds:C}=BEe({scheduledRoundsDetails:U,greatestAverageMinutes:T,garmanSinglePass:!0}),R,N=[];d&&({scheduleTimes:N,dateScheduledMatchUpIds:R}=$Ee({averageMatchUpMinutes:(f=C[0])==null?void 0:f.averageMinutes,scheduleDate:mt(c),venueIds:[b.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:u,matchUps:p}));let A=_Ee({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:R,greatestAverageMinutes:T,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:c,minutesMap:P,matchUps:p});({dateScheduledMatchUpIds:R}=A);let M=A,{byeScheduledMatchUpDetails:E,clearDate:O}=A;E!=null&&E.length&&y.push(...E);let{matchUpsToSchedule:k,matchUpMap:x}=PR({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:R,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:D,clearDate:O,matchUps:p}),F=m.filter($=>$.venueId===w);g[w]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:T,scheduledRoundsDetails:U,dateScheduledMatchUps:M,matchUpsToSchedule:k,scheduleTimes:N,groupedRounds:C,venueCourts:F,minutesMap:P,matchUpMap:x},s||v.push(...R)}return{allDateScheduledByeMatchUpDetails:y,allDateScheduledMatchUpIds:v,venueScheduledRoundDetails:g,allDateMatchUpIds:I}}function VEe(t,e){let i=xt(t.scheduleTime),r=xt(t.timeAfterRecovery),n=xt(e.scheduleTime),a=xt(e.timeAfterRecovery),o=i===n||r===a,s=i>n&&i<a,l=n>i&&n<r,u=r>n&&r<a,c=a>i&&a<r;return He({hasOverlap:o||s||u||l||c,startAisContained:s,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function F$({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){var o,s,l,u,c;let d=(((o=i==null?void 0:i[n.matchUpId])==null?void 0:o.participantIds)||[]).flat(),p=((l=(s=a==null?void 0:a.minutesMap)==null?void 0:s[n.matchUpId])==null?void 0:l.averageMinutes)||0,m=((c=(u=a==null?void 0:a.minutesMap)==null?void 0:u[n.matchUpId])==null?void 0:c.recoveryMinutes)||0,h=d.every(v=>{var y;tU({individualParticipantProfiles:t,participantId:v});let I=t[v];if(!I.timeAfterRecovery)return!0;let b=Ui((y=n==null?void 0:n.schedule)==null?void 0:y.endTime),S=b?ra(b,Qe(m)):ra(r,Qe(p)+Qe(m));return![...Object.keys(I.potentialBookings).filter(w=>w!==n.drawId).map(w=>I.potentialBookings[w]).flat(),...I.bookings].find(w=>VEe({scheduleTime:r,timeAfterRecovery:S},w).hasOverlap)}),f=e[n.matchUpId],g=(f?Zb(rr(f),rr(r),!1):0)>=0;return{enoughTime:h&&g}}function Dte({autoSchedulingAudit:t,tournamentRecords:e}){var i;ut({topic:fu,payload:t});let r=s=>s?Object.values(s).reduce((l,u)=>l+u.length||0,0):0,n=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((u,c)=>u+c.rounds.length,0),0),a={scheduledDatesCount:(i=t.scheduledDates)==null?void 0:i.length,noTimeMatchUpIdsCount:r(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:r(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:r(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:r(t==null?void 0:t.requestConflicts),profileRoundsCount:n},o={itemType:jM,itemValue:a};for(let s of Object.values(e)){let l=s.tournamentId;fP(fu)?ut({payload:{type:jM,tournamentId:l,detail:a},topic:fu}):Bw({tournamentRecord:s,timeItem:o})}}function L$({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=BP(r),{matchUpId:a,matchUpType:o}=r,s=(r.roundPosition&&t[a]||[]).flat(),l=dt(n.concat(...s));return l.forEach(u=>{tU({individualParticipantProfiles:e,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=e[u];if(c)return[o,qo].find(d=>{var p;let m=((p=c.counters)==null?void 0:p[d])||0,h=i[d]||0;return m&&h&&m>=h})}),relevantParticipantIds:l}}function yy({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:u,schedule:c}){var d,p,m;if(!s)return{error:ve};if(!l&&(!u||!Array.isArray(u)))return{error:hh};if(!l&&(!c||typeof c!="object"))return{error:b9};let h,f=[],g=0;if(r&&!n){let I=ds({tournamentRecords:o,tournamentRecord:s});n=I.matchUpDependencies,h=I.matchUps}h||(h=((d=Gr({tournamentRecord:s}))==null?void 0:d.matchUps)??[]);let v=h.reduce((I,b)=>{let{matchUpId:S,drawId:w,matchUpStatus:U}=b;return(e||U!==jt)&&(t||!Ir.includes(U))&&(I[w]?I[w].push(S):I[w]=[S]),I},{}),y=l==null?void 0:l.map(I=>I.matchUpId);for(let I of Object.keys(v)){let{drawDefinition:b}=sd({tournamentRecord:s,drawId:I});if(!b)continue;let S=v[I].filter(U=>(u==null?void 0:u.includes(U))??(y==null?void 0:y.includes(U))),w=Pn({inContext:!1,drawDefinition:b}).matchUps;for(let U of S){let T=((p=l==null?void 0:l.find(P=>P.matchUpId===U))==null?void 0:p.schedule)||c,D=qR({schedule:T,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:h,tournamentRecords:o,tournamentRecord:s,checkChronology:r,drawDefinition:b,drawMatchUps:w,matchUpId:U});if((m=D==null?void 0:D.warnings)!=null&&m.length&&f.push(...D.warnings),D!=null&&D.success&&(g+=1),D.error)return D}}return f.length?{...Z,scheduled:g,warnings:f}:{...Z,scheduled:g}}function rU(t){var e;let{scheduleCompletedMatchUps:i=!1,scheduleByeMatchUps:r=!1,errorOnAnachronism:n,matchUpContextIds:a,removePriorValues:o,tournamentRecords:s,checkChronology:l,matchUpDetails:u,schedule:c}=t;if(t.matchUpIds&&!a)return yy(t);let d=We(t,[{[fn]:!0},{[ag]:{matchUpContextIds:!1,matchUpDetails:!1},[Ha]:se,[Jn]:cn}]);if(d.error)return d;if((!u||a)&&!c)return{error:Je,info:"schedule is required"};let p=[],m=0,{matchUpDependencies:h}=ds({tournamentRecords:s});for(let f of Object.values(s)){let{tournamentId:g}=f,v=a==null?void 0:a.filter(I=>I.tournamentId===g).map(Dr),y=u==null?void 0:u.filter(I=>(I==null?void 0:I.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let I=yy({matchUpDetails:y,scheduleCompletedMatchUps:i,scheduleByeMatchUps:r,matchUpDependencies:h,errorOnAnachronism:n,removePriorValues:o,tournamentRecords:s,tournamentRecord:f,checkChronology:l,matchUpIds:v,schedule:c});if((e=I.warnings)!=null&&e.length&&p.push(...I.warnings),I.scheduled&&(m+=I.scheduled),I.error)return I}}return p.length?{...Z,scheduled:m,warnings:p}:{...Z,scheduled:m}}function jEe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:m,courts:h,dryRun:f}){var g,v,y,I,b,S,w;let U={},T={},D={},P={},C={},R={},N={},A={},M={},E={};for(let x of n){let F=mt(x==null?void 0:x.scheduleDate),$=(x==null?void 0:x.venues)||[],_={},L={},B=(K,H)=>{K.forEach(Q=>{let X=L[Q].counters;X[H]?X[H]+=1:X[H]=1,X[qo]?X[qo]+=1:X[qo]=1})};D[F]={},P[F]={},U[F]={},T[F]={},N[F]=[],A[F]=[],M[F]=[],E[F]=[];let V={};m.forEach(K=>{var H;(H=K.schedule)!=null&&H.scheduledDate&&Hl(F,mt(K.schedule.scheduledDate))&&fg({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:V,matchUp:K})});let{allDateScheduledByeMatchUpDetails:G,venueScheduledRoundDetails:j,allDateMatchUpIds:z}=Tte({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:V,matchUpScheduleTimes:R,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:F,matchUps:m,courts:h,venues:$}),q=10,W=0,Y,re=10;for(;!Y;){for(let{venueId:K}of $){let H=0,Q=j[K];for(;Q.courtsCount&&(g=Q.scheduleTimes)!=null&&g.length&&(v=Q.matchUpsToSchedule)!=null&&v.length&&H<=Q.courtsCount;){let{scheduleTime:X,attempts:ie=0}=Q.scheduleTimes.shift(),ae=Q.matchUpsToSchedule.find(le=>{var ne,de;let{matchUpId:Ie,matchUpType:ce}=le,{participantIdsAtLimit:ke,relevantParticipantIds:Pe}=L$({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpDailyLimits:s,matchUp:le});if(ke.length)return A[F].includes(Ie)||A[F].push(Ie),!1;let{scheduledDependent:it}=Ste({matchUpScheduleTimes:R,matchUpDependencies:o,scheduleTime:X,matchUpId:Ie,details:Q});if(it)return!1;let{dependenciesScheduled:It,remainingDependencies:me}=k$({matchUpScheduleTimes:R,matchUpDependencies:o,allDateMatchUpIds:z,matchUp:le});if(!It)return P[F][Ie]||(P[F][Ie]=[]),P[F][Ie].push({scheduleTime:X,remainingDependencies:me}),!1;let{enoughTime:fe}=F$({individualParticipantProfiles:L,matchUpNotBeforeTimes:V,matchUpDependencies:o,scheduleTime:X,details:Q,matchUp:le});if(!fe)return D[F][Ie]||(D[F][Ie]=[]),D[F][Ie].push({scheduleTime:X}),!1;let pe=Q.greatestAverageMinutes,{conflicts:Fe}=x$({potentials:e,averageMatchUpMinutes:pe,requestConflicts:E,personRequests:d,scheduleTime:X,scheduleDate:F,matchUp:le});if(Fe!=null&&Fe.length)return C[F]||(C[F]=[]),C[F].push(...Fe),!1;B(Pe,ce);let De=(de=(ne=Q.minutesMap)==null?void 0:ne[Ie])==null?void 0:de.recoveryMinutes;return Iy({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpNotBeforeTimes:V,averageMatchUpMinutes:pe,matchUpDependencies:o,recoveryMinutes:De,scheduleTime:X,matchUp:le}),R[Ie]=X,!0});Q.matchUpsToSchedule=Q.matchUpsToSchedule.filter(({matchUpId:le})=>le!==(ae==null?void 0:ae.matchUpId)),ae?H+=1:(T[F][K]||(T[F][K]=[]),T[F][K].push({scheduleTime:X,attempts:ie+1}))}(y=Q.matchUpsToSchedule)!=null&&y.length&&(T[F][K]=(I=T[F][K])==null?void 0:I.filter(X=>{let ie=X.attempts<q;return ie&&Q.scheduleTimes.push(X),!ie})),(!((b=Q.scheduleTimes)!=null&&b.length)||!((S=Q.matchUpsToSchedule)!=null&&S.length))&&(Q.complete=!0)}W+=1,Y=$.every(({venueId:K})=>j[K].complete)||W===re}for(let{venueId:K}of $){let H=j[K].matchUpMap;Object.keys(H).forEach(Q=>{let X=u[Q];X&&Object.keys(H[Q]).forEach(ie=>{let{drawDefinition:ae}=sd({tournamentRecord:X,drawId:ie});ae&&H[Q][ie].forEach(({matchUpId:le})=>{let ne=R[le];if(ne){let de=ne.split(":").map(oo).join(":"),Ie=`${mt(F)}T${de}`;f?N[F].push(le):(ld({drawDefinition:ae,scheduledTime:Ie,matchUpId:le}).success&&N[F].push(le),K&&Ov({tournamentRecord:X,drawDefinition:ae,matchUpId:le,venueId:K}))}})})}),M[F]=j[K].matchUpsToSchedule.map(Dr),U[F][K]=j[K].scheduleTimes.sort((Q,X)=>xt(Q.scheduleTime)-xt(X.scheduleTime))}!f&&G!=null&&G.length&&rU({matchUpDetails:G,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let K of x.venues)for(let H of K.rounds){let Q=(((w=H.matchUps)==null?void 0:w.map(({matchUpId:ie})=>ie))||[]).filter(ie=>N[F].includes(ie));H.canScheduledMatchUpIds=Q;let X=Math.round(Q.length/H.matchUpsCount*1e4)/100;(X===1/0||isNaN(X))&&(X=0),H.possibleToSchedulePct=X,H.matchUpsCount===Q.length&&(H.possibleToSchedule=!0)}}let O=n.map(({scheduleDate:x})=>x),k={timeStamp:Date.now(),overLimitMatchUpIds:A,scheduledMatchUpIds:N,schedulingProfile:c,noTimeMatchUpIds:M,requestConflicts:E,scheduledDates:O};return Dte({tournamentRecords:u,autoSchedulingAudit:k}),{...Z,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:U,dateSchedulingProfiles:n,skippedScheduleTimes:T,recoveryTimeDeferredMatchUpIds:D,dependencyDeferredMatchUpIds:P,matchUpScheduleTimes:R,overLimitMatchUpIds:A,scheduledMatchUpIds:N,noTimeMatchUpIds:M,requestConflicts:E,scheduledDates:O}}function ej({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Je,stack:"getEarliestCourtTime"};let a=gg({scheduleDate:n,courts:[r],startTime:!0}),o=gg({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||o;let s=Zw({court:r,date:n}),{timeSlots:l}=Nv({courtDate:s}),u=rr(e),c=rr(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let m=rr(p.startTime),h=rr(p.endTime);if(m>c||h<u)return d;let f=u>m?u:m;if(Zb(f,h)>=t){let g=Ui(f.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:o}}function GEe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:m=[],courts:h,dryRun:f}){var g,v;let y={},I={},b={},S={},w={},U={},T={},D={},P={};for(let N of n??[]){let A=mt(N==null?void 0:N.scheduleDate),M=(N==null?void 0:N.venues)||[],E={},O={},k=(K,H)=>{K.forEach(Q=>{let X=O[Q].counters;X[H]?X[H]+=1:X[H]=1,X[qo]?X[qo]+=1:X[qo]=1})};y[A]={},I[A]={},U[A]=[],T[A]=[],D[A]=[],P[A]=[];let x={};m==null||m.forEach(K=>{var H;(H=K.schedule)!=null&&H.scheduledDate&&Hl(A,mt(K.schedule.scheduledDate))&&fg({matchUpPotentialParticipantIds:E,matchUpNotBeforeTimes:x,matchUp:K})});let{allDateScheduledByeMatchUpDetails:F,allDateScheduledMatchUpIds:$,venueScheduledRoundDetails:_,allDateMatchUpIds:L}=Tte({matchUpPotentialParticipantIds:E,individualParticipantProfiles:O,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:x,matchUpScheduleTimes:w,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:A,matchUps:m,courts:h,venues:M}),B=m==null?void 0:m.filter(({matchUpId:K})=>$.includes(K)),{bookings:V}=YR({dateScheduledMatchUps:B,tournamentRecords:u,scheduleDate:A,periodLength:c}),{virtualCourts:G}=BR({scheduleDate:A,periodLength:c,bookings:V,courts:h}),j=G==null?void 0:G.reduce((K,H)=>{let{earliestCourtTime:Q,courtEndTime:X}=ej({date:A,averageMinutes:0,court:H});return(!K.startTime||rr(Q)<rr(K.startTime))&&(K.startTime=Q),(!K.endTime||rr(X)>rr(K.endTime))&&(K.endTime=X),K},{}),z=j.startTime,q=({courtId:K,booking:H})=>{var Q;return(Q=G==null?void 0:G.find(X=>X.courtId===K))==null?void 0:Q.dateAvailability[0].bookings.push(H)},W=10,Y=0,re;for(;!re;){for(let{venueId:K}of M){let H=_[K],Q=H.matchUpsToSchedule.length,X=[],ie=[],ae,le=0;for(;!ae;){for(let ne of H.matchUpsToSchedule){if(ie.length===H.courtsCount||X.length===H.courtsCount){ae=!0;break}let{matchUpId:de,matchUpType:Ie}=ne,{participantIdsAtLimit:ce,relevantParticipantIds:ke}=L$({matchUpPotentialParticipantIds:E,individualParticipantProfiles:O,matchUpDailyLimits:s,matchUp:ne});if(ce.length){T[A].includes(de)||T[A].push(de);continue}let{dependenciesScheduled:Pe,remainingDependencies:it}=k$({matchUpScheduleTimes:w,matchUpDependencies:o,allDateMatchUpIds:L,matchUp:ne});if(!Pe){I[A][de]||(I[A][de]=[]),I[A][de].push({remainingDependencies:it});continue}let It=[],me=G==null?void 0:G.reduce((fe,pe)=>{var Fe,De,je,ue;if(ie.includes(pe.courtId))return fe;let{earliestCourtTime:he}=ej({averageMinutes:H.greatestAverageMinutes,startTime:z,date:A,court:pe});if(fe.scheduleTime&&xt(he)>=xt(fe.scheduleTime))return fe;let{scheduledDependent:Re}=Ste({matchUpScheduleTimes:w,matchUpDependencies:o,scheduleTime:he,matchUpId:de,details:H});if(Re)return fe;let{enoughTime:xe}=F$({individualParticipantProfiles:O,matchUpNotBeforeTimes:x,matchUpDependencies:o,scheduleTime:he,details:H,matchUp:ne});if(!xe)return y[A][de]||(y[A][de]=[]),y[A][de].includes(he)||y[A][de].push(he),fe;let Ce=((De=(Fe=H.minutesMap)==null?void 0:Fe[de])==null?void 0:De.averageMinutes)||H.greatestAverageMinutes,{conflicts:we}=x$({potentials:e,averageMatchUpMinutes:Ce,requestConflicts:P,personRequests:p,scheduleTime:he,scheduleDate:A,matchUp:ne});if(we!=null&&we.length)return It.push(...we),!1;k(ke,Ie);let Ue=(ue=(je=H.minutesMap)==null?void 0:je[de])==null?void 0:ue.recoveryMinutes;return Iy({matchUpPotentialParticipantIds:E,individualParticipantProfiles:O,matchUpNotBeforeTimes:x,averageMatchUpMinutes:Ce,matchUpDependencies:o,recoveryMinutes:Ue,scheduleTime:he,matchUp:ne}),(!fe.scheduleTime||xt(he)<xt(fe.scheduleTime))&&(fe.averageMatchUpMinutes=Ce,fe.recoveryMinutes=Ue,fe.scheduleTime=he,fe.courtName=pe.courtName,fe.courtId=pe.courtId),fe},{});if(me.scheduleTime){let{averageMatchUpMinutes:fe,recoveryMinutes:pe,scheduleTime:Fe,courtId:De}=me;w[de]=Fe,S[de]=De,X.push(de),ie.push(De);let je=Fe,ue=ra(je,fe);q({courtId:De,booking:{averageMatchUpMinutes:fe,recoveryMinutes:pe,periodLength:c,matchUpId:de,startTime:je,courtId:De,endTime:ue,venueId:K}}),H.matchUpsToSchedule=H.matchUpsToSchedule.filter(he=>he.matchUpId!==de)}else It!=null&&It.length&&(b[A]||(b[A]=[]),b[A].push(...It))}(ie.length===H.courtsCount||X.length===H.courtsCount||!H.matchUpsToSchedule.length)&&(ae=!0),H.matchUpsToSchedule.length&&X<H.courtsCount&&(rr(z)<rr(j.endTime)?z=ra(z,c):(ae=!0,H.complete=!0)),le+=1,!ae&&le>=Q&&(ae=!0)}(g=H.matchUpsToSchedule)!=null&&g.length||(H.complete=!0)}Y+=1,re=M.every(({venueId:K})=>_[K].complete)||Y===W}for(let{venueId:K}of M){let H=_[K].matchUpMap;Object.keys(H).forEach(Q=>{let X=u[Q];X&&Object.keys(H[Q]).forEach(ie=>{let{drawDefinition:ae}=sd({tournamentRecord:X,drawId:ie});ae&&H[Q][ie].forEach(({matchUpId:le})=>{let ne=w[le],de=S[le];if(ne){let Ie=ne.split(":").map(oo).join(":"),ce=`${mt(A)}T${Ie}`;f||(ld({drawDefinition:ae,scheduledTime:ce,matchUpId:le}),jh({courtDayDate:A,tournamentRecords:u,tournamentRecord:X,drawDefinition:ae,matchUpId:le,courtId:de})),U[A].push(le)}})})}),D[A]=_[K].matchUpsToSchedule.map(Dr)}!f&&F!=null&&F.length&&rU({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let K of N.venues)for(let H of K.rounds){let Q=(v=(H.matchUps??[]).map(({matchUpId:ie})=>ie))==null?void 0:v.filter(ie=>U[A].includes(ie));H.canScheduledMatchUpIds=Q;let X=Math.round(((Q==null?void 0:Q.length)||0)/H.matchUpsCount*1e4)/100;(X===1/0||isNaN(X))&&(X=void 0),H.possibleToSchedulePct=X,H.matchUpsCount===(Q==null?void 0:Q.length)&&(H.possibleToSchedule=!0)}}let C=(n??[]).map(({scheduleDate:N})=>N),R={timeStamp:Date.now(),overLimitMatchUpIds:T,scheduledMatchUpIds:U,schedulingProfile:d,noTimeMatchUpIds:D,requestConflicts:P,scheduledDates:C};return Dte({tournamentRecords:u,autoSchedulingAudit:R}),{...Z,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:w,overLimitMatchUpIds:T,scheduledMatchUpIds:U,noTimeMatchUpIds:D,requestConflicts:P,scheduledDates:C}}function KR(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=Ir,scheduledDates:r,venueIds:n}=t,a=To(t),o=At(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(o!=null&&o.length))return{error:ki};let s=0;for(let l of o){let u=a[l],c=HEe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:r,venueIds:n});if(c.error)return c;s+=c.clearedScheduleCount??0}return{...Z,clearedScheduleCount:s}}function HEe({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=Ir,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:ve};if(!Array.isArray(e)||!Array.isArray(n))return{error:se};n.length&&t.push("venueId");let a=Gr({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],o={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&Yw({schedule:c,scheduleAttributes:t})&&(!(n!=null&&n.length)||n.includes(c.venueId))&&(o[d]||(o[d]=[]),o[d].push(p))});let s=i.tournamentId,l=0;for(let u in o){let{event:c,drawDefinition:d}=Kn({tournamentRecord:i,drawId:u}),p=Pn({drawDefinition:d,matchUpFilters:{matchUpIds:o[u]}}).matchUps??[];for(let m of p){let h=!1;m.timeItems=(m.timeItems??[]).filter(f=>{let g=(f==null?void 0:f.itemType)&&![Kl,Lc,Rh,GP,Ch,Eh].includes(f==null?void 0:f.itemType);return g||(h=!0),g}),h&&(Ct({context:"clear schedules",eventId:c==null?void 0:c.eventId,drawDefinition:d,tournamentId:s,matchUp:m}),l+=1)}}return{...Z,clearedScheduleCount:l}}function XR(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:u}=t,c=We(t,[{[fn]:!0},{[Xr]:D=>!D||Array.isArray(D)&&D.every(ba),[j8]:!1,[Jn]:cn}]);if(c.error)return c;let d=rc({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...Z};let{modifications:p,issues:m=[],schedulingProfile:h=[]}=d,f=Object.assign({},...Object.values(a).map(D=>vv({tournamentRecord:D}).containedStructures)),g=n.map(D=>{if(ba(D))return mt(D)}).filter(Boolean),v=h.map(D=>D.scheduleDate).map(D=>ba(D)&&mt(D)).filter(D=>D&&(!n.length||g.includes(D)));if(!v.length)return{error:XK};if(r&&!l){let D=Array.isArray(r)?r:[];KR({tournamentRecords:a,scheduledDates:D})}let y=ic({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:I}=As({matchUpFilters:{matchUpTypes:[ii,ei]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:b}=ds({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:I}),{matchUpDailyLimits:S}=xR({tournamentRecords:a}),{personRequests:w}=kp({requestType:iU,tournamentRecords:a}),U=h.filter(D=>{let P=mt(D==null?void 0:D.scheduleDate);return v.includes(P)}).sort((D,P)=>new Date(D.scheduleDate).getTime()-new Date(P.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:m,dateSchedulingProfiles:U,containedStructureIds:f,matchUpDependencies:b,matchUpDailyLimits:S,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:h,personRequests:w,periodLength:o,useGarman:s,matchUps:I,dryRun:l,courts:y};return u?GEe(T):jEe(T)}function JR(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};return n.tournamentId||(n.tournamentId=Ht()),n.startDate&&!Wd(n.startDate)&&!XS.test(n.startDate)?{error:xr}:n.endDate&&!Wd(n.endDate)&&!XS.test(n.endDate)?{error:xr}:(n.extensions&&(n.extensions=n.extensions.filter(ll)),{...n})}function _$({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:o}){var s,l;if(!i)return{error:ve};let u={},c=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===Dt&&v===en),d=0;for(let g of c){let v=a&&((s=om({element:g,accessor:a}))==null?void 0:s.value)||r&&((l=g.person)==null?void 0:l[r])||e&&g[e];if(v){if(!Object.keys(u).includes(v)){u[v]={participantName:(n==null?void 0:n[d])??v,participantId:(o==null?void 0:o.pop())??Ht(),individualParticipantIds:[],participantRole:en,participantType:Xt};let y={value:r??e,name:pM};_t({element:u[v],extension:y}),d+=1}u[v].individualParticipantIds.push(g.participantId)}}let p=Object.keys(u),m=(i.participants??[]).map(g=>{if(g.participantType!==Xt||g.participantRole!==en)return;let{extension:v}=vt({name:pM,element:g}),y=v==null?void 0:v.value;if(p.includes(y))return g.participantId}).filter(Boolean),h=0,f=[];return Object.keys(u).forEach(g=>{let v=u[g],{participantId:y}=v;m.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),f.push(v),h++)}),t&&h?(ut({payload:{tournamentId:i.tournamentId,participants:f},topic:kc}),{...Z,participantsAdded:h}):f.length?{...Z,newParticipants:f}:{error:Mwe}}var zEe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],WEe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function Pte({count:t=1,participantsCount:e=32}={}){let i=Tn(WEe),r=i.slice(0,t);return{cities:Te(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Lo(r))}}function Rte({count:t=1,participantsCount:e=32}={}){let i=Tn(zEe),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:Te(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Lo(r))}}function Cte({count:t=1,participantsCount:e=32}={}){let i=Te(0,t).map(()=>Te(0,5).map(()=>ro(0,9)).join(""));return{postalCodes:Te(0,e).map(r=>r<t?i[r]:Lo(i))}}function T0({idPrefix:t,participantType:e,index:i,uuids:r}){let n=Di(e)?e[0]:"X";return t?`${t}-${n}-${i}`:(r==null?void 0:r.pop())||Ht()}function Ete(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r==null?void 0:r[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:n}}var qEe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function XC(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![Zt,mi].includes(i))return{personData:[],error:se};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:o}=qEe,s=yc.map(({iso:f})=>f).filter(Boolean),l=Math.ceil(r/n.length),u=Math.ceil(r/a.length),c=Math.ceil(r/o.length),d=Te(0,l).flatMap(()=>{let f=Ne(n,!1,!0);return Te(0,n.length).map(()=>ga(f))}),p=Te(0,u).flatMap(()=>{let f=Ne(a,!1,!0);return Te(0,a.length).map(()=>ga(f))}),m=Te(0,c).flatMap(()=>{let f=Ne(o,!1,!0);return Te(0,o.length).map(()=>ga(f))}),h={};for(let f=0;f<r;f++){let g=d.pop(),v=i||Lo([Zt,mi]),y=v===Zt?m.pop():p.pop(),I=Lo(s);h[`${y}${g}`]={nationalityCode:I,sex:v,firstName:y,lastName:g}}return{personData:Object.values(h).slice(0,e)}}function Mte(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:o,category:s,sex:l}=t||{};if(isNaN(e))return{error:se};let u=(a==null?void 0:a[Zt])||l===Zt&&e||0,c=(a==null?void 0:a[mi])||l===mi&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&XC({count:u,sex:Zt}).personData||[],m=c&&XC({count:c,sex:mi}).personData||[],h=[...p,...m,...d&&XC({count:d}).personData||[]],f=h.filter(T=>!l||u&&c||T.sex===l),g=[];if(Array.isArray(o)){let T=o.filter(D=>typeof D.firstName!="string"||typeof D.lastName!="string"||D.sex&&![Zt,mi].includes(D.sex)||D.nationalityCode&&(typeof D.nationalityCode!="string"||D.nationalityCode.length>3||!yc.find(({iso:P,ioc:C})=>[P,C].includes(D.nationalityCode)))?!1:(D.nationalityCode&&g.push(D.nationalityCode),!0));if(T.length)f=T;else return{error:se}}let v=o?f:Tn(f);if(v.length<e){let{maleFirstNames:T,maleLastNames:D,femaleFirstNames:P,femaleLastNames:C,nationalityCodes:R}=h.reduce((N,A)=>{let{firstName:M,lastName:E,nationalityCode:O}=A;return A.sex===Zt?(N.maleFirstNames.includes(M)||N.maleFirstNames.push(M),N.maleLastNames.includes(E)||N.maleLastNames.push(E)):(N.femaleFirstNames.includes(M)||N.femaleFirstNames.push(M),N.femaleLastNames.includes(E)||N.femaleLastNames.push(E)),N.nationalityCodes.includes(O)||N.nationalityCodes.push(O),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Te(0,e-v.length).forEach(()=>{let N=l||Lo([Zt,mi]),A=Lo(R),M=Lo(N===Zt?T:P),E=Lo(N===Zt?D:C),O={firstName:M,lastName:E,sex:N,nationalityCode:A};v.push(O)})}let{ageMinDate:y,ageMaxDate:I}=Cm({consideredDate:r,category:s}),b=Qe((y==null?void 0:y.slice(0,4))||0)||Qe((I==null?void 0:I.slice(0,4))||0)-3,S=Qe((I==null?void 0:I.slice(0,4))||0)||Qe((y==null?void 0:y.slice(0,4))||0)+3,w=(y||I)&&[b,S],U=v.slice(0,e).map((T,D)=>{let[P,C]=w||[],R=w&&ga(Te(P,C)),N=ga(Te(0,365)),A=R&&TUe(R,N);return Object.assign(He({extensions:i||[{name:"regionCode",value:D+1}],birthDate:A,isMock:n}),T)});return{persons:U.length&&U||v[0],nationalityCodes:g}}var YEe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function D0({nameRoot:t="TEAM",count:e=1}={}){let i=Tn(YEe).slice(0,e);return i.length<e&&Te(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function kv(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=Sr,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:o,categories:s,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:m,teamSize:h=8,personIds:f,idPrefix:g,uuids:v,personExtensions:y,addressProps:I,gendersCount:b,matchUpType:S,personData:w,sex:U,inContext:T,withISO2:D,withIOC:P,scaleAllParticipants:C}=t,R=m===ft||S===zd,N=m===Xt||S===Xt;i&&(!Array.isArray(i)||!i.every(ce=>_i(ce))||i.length!==2)&&(i=void 0),e=C?p:e;let A=1e3,M=e&&e>A?e:A;i=i||[1,M],i[1]+=1;let E=p*(R&&2||N&&(h??8)||1),O=Mte({count:E,personExtensions:y,consideredDate:o,gendersCount:b,personData:w,category:l,sex:U});if(O.error)return O;let{nationalityCodes:k,persons:x}=O,F={},$={},_={},L={},B=ce=>{Object.assign(F,ce.doublesRankings),Object.assign($,ce.singlesRankings),Object.assign(L,ce.doublesRatings),Object.assign(_,ce.singlesRatings)};if(At(l)){let ce=tj({scaledParticipantsCount:e,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:l});B(ce)}Array.isArray(s)&&s.forEach(ce=>{let ke=tj({scaledParticipantsCount:e,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:ce});B(ke)});let V=yc.filter(ce=>c==="IOC"&&ce.ioc||ce.iso);function G(ce){let ke=Math.ceil(E/ce);return n&&ke>n?Math.ceil(E/n):ce}let{postalCodesProfile:j,postalCodesCount:z,statesProfile:q,citiesProfile:W,citiesCount:Y,statesCount:re}=I||{},K=ce=>Object.keys(ce).map(ke=>Te(0,q[ke]).map(()=>ke)).flat(),H=W&&K(W)||(I==null?void 0:I.cities)||Pte({count:Y||E,participantsCount:E}).cities,Q=q&&K(q)||(I==null?void 0:I.states)||Rte({count:re||E,participantsCount:E}).states,X=j&&K(j)||(I==null?void 0:I.postalCodes)||Cte({count:z||E,participantsCount:E}).postalCodes,ie={cities:H,states:Q,postalCodes:X},ae=G(u),le=ae?Tn(V).slice(0,u):d&&V.filter(ce=>d.includes(ce.iso))||V,ne=Tn(Te(0,Math.ceil(E/(ae||1))).map(()=>le).flat(1/0)),de=D0({count:p}).names;return{participants:Te(0,p).map(ce=>{let ke=R&&2||N&&(h??8)||1,Pe=Te(0,ke).map(pe=>{let Fe=ce*ke+pe;return Ie(Fe)}),it=Pe.map(pe=>pe.participantId),It=Pe.map(pe=>pe.person.standardFamilyName).join("/"),me=R?ft:Xt,fe={participantId:T0({participantType:me,index:ce,idPrefix:g,uuids:v}),participantName:R?It:de[ce],participantRole:en,individualParticipantIds:it,participantType:me};return T&&(fe.individualParticipants=Pe),R||N?[fe,...Pe]:Pe}).flat(),...Z};function Ie(ce){let ke=x[ce],{nationalityCode:Pe,participantExtensions:it,participantTimeItems:It,extensions:me,firstName:fe,birthDate:pe,lastName:Fe,personId:De,sex:je}=ke||{},ue=fe||"GivenName",he=Fe||"FamilyName",Re=`${ue} ${he}`,xe=ne[ce],Ce=(k==null?void 0:k.length)&&Pe||xe&&(c==="IOC"?xe.ioc||xe.iso:xe.iso||xe.ioc)||Pe;ne!=null&&ne.length&&!Ce&&!Pe&&console.log("%c Invalid Nationality Code",{participantIndex:ce,country:xe});let we=Ete({...ie,participantIndex:ce,nationalityCode:Ce}),Ue=He({participantId:T0({participantType:Dt,index:ce,idPrefix:g,uuids:v}),extensions:it,timeItems:It,participantRole:en,participantType:Dt,participantName:Re,person:{personId:De||(f==null?void 0:f.length)&&f[ce]||Ht(),birthDate:ba(pe)?pe:void 0,addresses:[we],standardFamilyName:he,standardGivenName:ue,nationalityCode:Ce,extensions:me,sex:je}});if(P&&Ce){let Le=yc.find(({iso:rt})=>rt===Ce);Le!=null&&Le.ioc&&(Ue.person.iocNationalityCode=Le.ioc),Le!=null&&Le.label&&(Ue.person.countryName=Le.label)}if(D&&Ce){let Le=yc.find(({iso:rt})=>rt===Ce);Le!=null&&Le.iso2&&(Ue.person.iso2NationalityCode=Le.iso2),Le!=null&&Le.label&&(Ue.person.countryName=Le.label)}let wt=Le=>{var rt,Ci,Be,nt;let Ii=Le.categoryName||Le.ratingType||Le.ageCategoryCode,be=(rt=$[Ii])==null?void 0:rt[ce],Et=(Ci=F[Ii])==null?void 0:Ci[ce];bU({scaleValue:be,eventType:Em,scaleType:Nc,participant:Ue,category:Le}),bU({scaleValue:Et,eventType:Mu,scaleType:Nc,participant:Ue,category:Le});let Ee=(Be=_[Ii])==null?void 0:Be[ce],qe=(nt=L[Ii])==null?void 0:nt[ce];bU({scaleValue:Ee,eventType:Em,scaleType:Ic,participant:Ue,category:Le}),bU({scaleValue:qe,eventType:Mu,scaleType:Ic,participant:Ue,category:Le})};return Array.isArray(s)?s.forEach(Le=>wt(Le)):l&&wt(l),Ue}}function bU({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,o=[Xd,r,i,a].join("."),s={itemValue:t,itemType:o};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function tj(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,o=e.rankingRange||t.rankingRange||[1,1e3],s={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:m}=e,h=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!m){let[f,g]=o||[];if(l[h]=Tn(Te(f,g)).slice(0,i||ro(20,30)),[ft,Xt].includes(n)){let[v,y]=o||[];s[h]=Tn(Te(v,y)).slice(0,i||ro(20,30))}}if(m&&r[m]){let{ratingMax:f,ratingMin:g,ratingAttributes:v}=e,y={...r[m],...v||{}},{attributes:I={},decimalsCount:b,accessors:S,range:w,step:U}=y,T=N=>{let A={},M=Object.keys(N||{});for(let E of M){let O=N[E];if(typeof O=="object"&&O.generator){let{range:k}=O,[x,F]=k.slice().sort();A[E]=ro(x,F)}else A[E]=O}return A},D=w[0]>w[1]?2:.7,[P,C]=w.slice().sort(),R=Te(0,2e3).map(()=>fK(P,C,D,U,b)).filter(N=>(!f||N<=f)&&(!g||N>=g)).slice(0,i||ro(20,30)).map(N=>S?Object.assign({},...S.map(A=>({[A]:N})),T(I)):N);u[h]=[...a,...R],[ft,Xt].includes(n)&&(c[h]=[...a,...R])}return{singlesRankings:l,doublesRankings:s,singlesRatings:u,doublesRatings:c}}function $$(t){var e,i;let{alternatesCount:r=0,tieFormatName:n,drawSize:a}=t,o=0,s=0,l=0,u=0,c={},d={[Zt]:0,[mi]:0,[jn]:0,[Sd]:0,[Ns]:0};(i=(e=At(t.tieFormat)?t.tieFormat:Eu({namedFormat:n}))==null?void 0:e.collectionDefinitions)==null||i.filter(Boolean).forEach(f=>{let{category:g,collectionId:v,matchUpType:y,matchUpCount:I,gender:b}=f;if([Zt,mi].includes(b)){let S=I*(y===ei?2:1);d[b]<S&&(d[b]=S)}else b===jn&&(d[Zt]<I&&(d[Zt]=I),d[mi]<I&&(d[mi]=I));if(g){let S=JSON.stringify(g);c[S]=g}if(v||(f.collectionId=Ht()),Xi(ei)(y)){let S=I;u+=I,o=Math.max(o,S)}if(Xi(ii)(y)){let S=I;l+=I,s=Math.max(s,S)}});let p=Object.keys(c).length?Math.max(l,u*2):Math.max(s,o*2),m=o*(a+r),h=s*(a+r);return{maxDoublesDraw:m,maxSinglesDraw:h,teamSize:p,genders:d}}function KEe({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=Dt}=t||{},a=r||0,o={[mi]:0,[jn]:0,[Sd]:0,[Zt]:0,[Ns]:0},s=0,l=0,u=0,c=0,d=0,p=({alternatesCount:h=0,uniqueParticipants:f,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:I,category:b,gender:S,stage:w})=>{let U=y===ho,T=y===ur,D=!!(f||w===Ke||b||S);if(T){c=Math.max(c,v+h),I=typeof I=="object"?I:Eu({namedFormat:g});let{teamSize:P,maxDoublesDraw:C,maxSinglesDraw:R,genders:N}=$$({alternatesCount:h,tieFormatName:g,tieFormat:I,drawSize:v});u=Math.max(u,P),l=Math.max(l,R),D||(s=Math.max(s,C)),Object.keys(N).forEach(A=>o[A]+=N[A])}else if(U)if(D){let P=(v+h)*2;d+=P,S&&(o[S]+=P)}else v+h&&v+h>s&&(s=v+h);else if(D){let P=v+h;S&&(o[S]+=P),d+=P}else v&&v>l&&(l=v+h)};if(e==null||e.forEach(h=>{let{tieFormatName:f,tieFormat:g,drawProfiles:v,eventType:y,category:I,gender:b}=h;if(v)for(let S of v){let{tieFormatName:w,tieFormat:U}=S;p({...S,tieFormatName:w||f,tieFormat:U||g,eventType:y,category:I,gender:b})}}),Array.isArray(i))for(let h of i)p(h);let m=Math.max(c*u,s*2,l);return s&&(n=ft),(r||a)<m&&(r=m),r&&s&&[ft,ur].includes(n)&&(l&&Math.floor(l/2)>s?r=Math.floor(l/2):(!l||s*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:c,largestTeamSize:u,participantType:n,gendersCount:o}}function Nte({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if((t==null?void 0:t.participantsCount)===0)return{addedCount:0,...Z};let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=KEe({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t==null?void 0:t.teamKey,p=kv({consideredDate:n,...t,participantsCount:o,participantType:s,gendersCount:c,uuids:a}).participants,m=0,h=as({tournamentRecord:e,participants:p});if(h.error)return h;if(m+=h.addedCount,d){let y=_$({tournamentRecord:e,...d});if(y.error)return y}let f=p.filter(({participantType:y})=>y===Dt).map(Tt),g=t!=null&&t.idPrefix?`${Xt}-${t.idPrefix}`:void 0,v=Te(0,l).map(y=>{let I=f.slice(y*u,(y+1)*u),b=T0({index:y,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:en,individualParticipantIds:I,participantType:Xt,participantId:b}});return h=as({participants:v,tournamentRecord:e}),h.error?h:(m+=h.addedCount,{addedCount:m,...Z})}function Ate({drawProfiles:t,category:e,gender:i}){let r={},n=t==null?void 0:t.reduce((o,s)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=Ae,drawSize:p=0}=s||{};Object.keys(o).includes(d)||(o[d]=0);let m=(u||p)-l;return c||i||e||d===Ke?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=m):o[d]=Math.max(o[d],m),o},{}),a=Object.keys(r);return a.forEach(o=>n[o]+=r[o]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function Ote({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Ae]||0,a=e[Ke]||0;return{stageParticipants:{QUALIFYING:r==null?void 0:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(0,a),MAIN:r==null?void 0:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(a,a+n)}}}var XEe={[Ft]:2,[tr]:1,[dr]:1,[Hr]:1,[Pt]:4};function B$(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=XEe,matchUpFormat:n=Ho,pointsPerMinute:a=1,sideWeight:o=4}=t;if(!Ra({matchUpFormat:n}))return{error:Wx};if(typeof r!="object")return{error:se};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(o))return{error:se};let s=Object.keys(r).filter(P=>Object.keys(mX).includes(P)&&P!==Ki);if(Object.keys(s).reduce((P,C)=>P+r[C],0)>100)return{error:se,matchUpStatusProfile:r};let l=s.reduce((P,C)=>(P.pointer=P.pointer+r[C],P.valueMap.push([P.pointer,C]),P),{pointer:0,valueMap:[]}),u=ro(1,100),c=(l.valueMap.find(P=>u<=P[0])??[100,Ki])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([Ft,Pt].includes(c)){i=i||ro(1,2);let P={score:d,matchUpStatus:c,winningSide:i};if(!(c===Pt&&ro(1,100)>100-e))return{outcome:P}}else if([tr,dr].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=Ln(n),{bestOf:m=1,exactly:h,setFormat:f,finalSetFormat:g}=p??{},v=[],y=ro(0,1),I=i?[i-1]:[...Te(0,o).map(()=>y),1-y],b=[Hr,Pt,Ea,rd].includes(c)&&(ga(Te(1,h||m))||1),S,w=Te(1,(h??m)+1);for(let P of w){let C=P===(h??m),{set:R,incomplete:N,winningSideNumber:A}=JEe({setFormat:C&&g||f,incomplete:b===P,pointsPerMinute:a,matchUpStatus:c,weightedRange:I,setNumber:P});if(v.push(R),N){S=A;break}if(vy({matchUp:{score:{sets:v},matchUpFormat:n}}).calculatedWinningSide)break}let U=vy({matchUp:{score:{sets:v},matchUpFormat:n,winningSide:i}}),T=S?i||S:U.calculatedWinningSide,{score:D}=gte({winningSide:T,score:{sets:v},matchUpStatus:c});return{outcome:{winningSide:T,matchUpStatus:c,score:D}}}function JEe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let o={setNumber:a},{setTo:s,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=n,m=ro(0,t.length-1),h=t[m],f;if(d){let g=p*e,v=Math.round(g*.2),y=g+ga([1,-1])*v,I=swe(y,2),b=[I,y-I];h&&b.reverse(),f=t[m]+1;let S=b[0]>b[1]&&1||b[1]>b[0]&&2||0;if(r){let[T,D]=b;return Object.assign(o,{side1Score:T,side2Score:D}),Ir.includes(i)?{set:o,incomplete:r,winningSideNumber:f}:{set:o,incomplete:r}}S||(b[ro(0,1)]+=1),S=b[0]>b[1]?1:2,S!==f&&b.reverse();let[w,U]=b;return Object.assign(o,{side1Score:w,side2Score:U,winningSide:f}),{set:o}}else{if(r)return o.side1Score=ro(0,u),o.side2Score=ro(0,u),Ir.includes(i)&&(f=t[m]+1),{set:o,incomplete:r,winningSideNumber:f};{let g=Te(1,s+1).map(U=>Te(0,s+2-U).map(()=>U)).flat(),v=g[ro(0,g.length-1)],y=s&&D_({isSide1:!0,tiebreakAt:u,lowValue:v,setTo:s}),I=!y,b=t.length===1&&t[m]+1;if(!I){b?(y[0]>y[1]?1:2)!==b&&y.reverse():h&&y.reverse();let[U,T]=y;Object.assign(o,{side1Score:U,side2Score:T})}let S=fy({matchUpScoringFormat:{setFormat:n},setObject:o}),w;if(S.hasTiebreakCondition||I){let{NoAD:U,tiebreakTo:T}=l||c||{},D=Te(1,T+1).map(R=>Te(0,T+2-R).map(()=>R)).flat(),P=D[ro(0,D.length-1)],C=yR({isSide1:!0,tiebreakNoAd:U,tiebreakTo:T,lowValue:P});if(C)if(I){let R=C[0]>C[1]?1:2;b?R!==b&&C.reverse():h&&C.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=C,w=C[0]>C[1]&&1||C[1]>C[0]&&2||void 0}else S.leadingSide===2?[o.side1TiebreakScore,o.side2TiebreakScore]=C:[o.side2TiebreakScore,o.side1TiebreakScore]=C}o.winningSide=S.winningSide||S.leadingSide||b||w}}return{set:o}}function P0(t){var e,i,r;let{matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:o,tournamentRecord:s,completionGoal:l,drawDefinition:u,event:c}=t;if(!u)return{error:$e};let d=t.matchUpFormat||u.matchUpFormat||(c==null?void 0:c.matchUpFormat),p=u.structures.slice().sort(Th),m=0,{matchUps:h,matchUpsMap:f}=fr({matchUpFilters:{matchUpTypes:[fi],roundNumbers:[1]},contextFilters:{stages:[Ae,Ke]},inContext:!0,drawDefinition:u});if(h!=null&&h.length){let b=((e=c==null?void 0:c.category)==null?void 0:e.ageCategoryCode)||((i=c==null?void 0:c.category)==null?void 0:i.categoryName);if(b){let S=Wee({singlesOnly:!0,tournamentRecord:s,drawDefinition:u,scaleAccessor:{scaleName:b,sortOrder:zee,scaleType:Nc},event:c});if(S.error)return S;let{lineUps:w,participantsToAdd:U}=S;as({tournamentRecord:s,participants:U}),_t({element:u,extension:{name:ku,value:w}})}else{let S=(r=h[0])==null?void 0:r.structureId,{positionAssignments:w}=oi({drawDefinition:u,structureId:S});if(w!=null&&w.length){let{participants:U}=Ai({participantFilters:{participantTypes:[fi]},tournamentRecord:s}),T=D=>{let P=D.tieMatchUps.filter(Xi(ii)),C=D.tieMatchUps.filter(Xi(ei));P.forEach((R,N)=>{let A=R.matchUpId;R.sides.forEach(M=>{var E;let{drawPosition:O}=M,k=U==null?void 0:U.find(x=>{var F;let{participantId:$}=x;return((F=w.find(_=>_.participantId===$))==null?void 0:F.drawPosition)===O});if(k){let x=(E=k.individualParticipantIds)==null?void 0:E[N];x&&S0({teamParticipantId:k.participantId,participantId:x,tournamentRecord:s,drawDefinition:u,tieMatchUpId:A,event:c})}})}),C.forEach((R,N)=>{let A=R.matchUpId;R.sides.forEach(M=>{var E,O;let{drawPosition:k}=M,x=U==null?void 0:U.find(F=>{var $;let{participantId:_}=F;return(($=w.find(L=>L.participantId===_))==null?void 0:$.drawPosition)===k});x&&((O=(E=x.individualParticipantIds)==null?void 0:E.slice(N*2,N*2+2))==null||O.forEach(F=>{S0({teamParticipantId:x.participantId,participantId:F,tournamentRecord:s,drawDefinition:u,tieMatchUpId:A,event:c})}))})})};h.forEach(T)}}}let g=typeof a=="string"&&a,v=g&&Ki,y=p.length===2&&p[0].finishingPosition===Kd&&ji(p.map(({stage:b})=>b),[Ae,Bi]).length===2,I=p.map(({structureId:b})=>b);for(let b of I){if(m>=l)break;let S=u.structures.find(T=>T.structureId===b),w=qt({contextFilters:{matchUpTypes:[ei,ii]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:f,structure:S,event:c}).matchUps;w.length;let U=w.filter(({winningSide:T})=>!T).sort(Oh).map(Dr);for(let T of U){if(!isNaN(l)&&m>=l)break;let{matchUps:D}=qt({matchUpFilters:{matchUpTypes:[ei,ii]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:f,structure:S,event:c}),P=D.find(R=>R.matchUpId===T),C=[tr,dr].includes(P.matchUpStatus);if(P!=null&&P.readyToScore&&!C){let R=ZEe({matchUpStatusProfile:n,tournamentRecord:s,drawDefinition:u,targetMatchUp:P,matchUpFormat:d,matchUpStatus:v,scoreString:g,winningSide:!o&&1,event:c});if(R!=null&&R.error)return R;m+=1}}y&&S.finishingPosition===Kd&&t.completeRoundRobinPlayoffs&&Sv({structureId:S.structureId,applyPositioning:!0,drawDefinition:u})}return{...Z,completedCount:m}}function kte(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus===jt)return;let{matchUpId:d}=a||{},{outcome:p}=O$({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),eU({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function ZEe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:u,event:c}=t;if(l||a)return kte(t);let{matchUpId:d}=s||{},{outcome:p}=B$({matchUpStatusProfile:e,matchUpFormat:o,winningSide:u});return eU({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function xte({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:o}){var s,l,u,c;let d=Hi({event:o}).flightProfile,{eventName:p,eventType:m,category:h}=o,{startDate:f}=r,g=[],v=(h==null?void 0:h.categoryName)||(h==null?void 0:h.ageCategoryCode)||(h==null?void 0:h.ratingType),y=(s=o.drawDefinitions)==null?void 0:s.map(({drawId:I})=>I);if(Array.isArray(d==null?void 0:d.flights))for(let[I,b]of d.flights.entries()){let{drawId:S,stage:w,drawName:U,drawEntries:T}=b;g.push(b.drawId);let D=n[I],{seedsCount:P,generate:C=!0}=D||{};if(C){let R=T.filter(Ma(ql)).map(Ma(ql)),N=v||p;if(r&&P&&P<=R.length&&Te(1,P+1).forEach((k,x)=>{let F={scaleValue:k,scaleName:N,scaleType:Al,eventType:m,scaleDate:f},$=R[x];Hw({tournamentRecord:r,participantId:$,scaleItem:F})}),y==null?void 0:y.includes(S))break;let A=Xw({...D,matchUpType:m,seedingScaleName:N,tournamentRecord:r,drawEntries:T,drawName:U,drawId:S,isMock:a,event:o,stage:w});if(A.error)return{error:A.error,drawIds:[]};let{drawDefinition:M}=A;if(!M)return{error:Va};let E=(l=n[I])==null?void 0:l.drawExtensions;if(Array.isArray(E)&&E.filter(ll).forEach(k=>_t({element:M,extension:k})),A=Jw({suppressNotifications:!0,tournamentRecord:r,drawDefinition:M,event:o}),A.error)return{error:A.error,drawIds:[]};if(D!=null&&D.withPlayoffs){let k=(u=M.structures)==null?void 0:u[0].structureId,x=sR({idPrefix:D.idPrefix,...D.withPlayoffs,tournamentRecord:r,drawDefinition:M,structureId:k,isMock:a,event:o});if(x!=null&&x.error)return x}let O=D==null?void 0:D.completionGoal;if((D==null?void 0:D.automated)!==!1&&(e||O)){let k=D==null?void 0:D.matchUpFormat,x=P0({completeAllMatchUps:!O&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:O,drawDefinition:M,matchUpFormat:k,event:o});if(x.error)return{error:x.error,drawIds:[]};let F=x.completedCount;if((D==null?void 0:D.drawType)===Wl){let $=(c=M.structures)==null?void 0:c.find(B=>B.stage===Ae);if(!$)return{error:Ni};let _=Sv({structureId:$.structureId,tournamentRecord:r,drawDefinition:M,event:o});if(_.error)return{error:_.error,drawIds:[]};let L=O?O-(F??0):void 0;if(_=P0({completeAllMatchUps:!O&&e,completionGoal:O?L:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:M,matchUpFormat:k,event:o}),_.error)return{error:_.error,drawIds:[]}}}}}return{...Z,drawIds:g}}function Fte(t){var e,i;let{participantsProfile:r={},uniqueParticipantsCount:n,ratingsParameters:a,tournamentRecord:o,eventProfile:s,eventIndex:l,event:u,uuids:c}=t,{category:d,gender:p,eventType:m}=u,h=Xi(ol)(m)&&Dt||Xi(ho)(m)&&ft||m,f=n[Ae]||0,g=n[Ke]||0,v=(e=s.drawProfiles)!=null&&e.length?f+g:((i=s.participantsProfile)==null?void 0:i.participantsCount)??0,y=[Zt,mi].includes(p)?p:void 0,I=r!=null&&r.idPrefix?`E-${l}-${r==null?void 0:r.idPrefix}`:void 0,{participants:b}=kv({uuids:s.uuids||c,...r,scaledParticipantsCount:s.scaledParticipantsCount,consideredDate:o==null?void 0:o.startDate,rankingRange:s.rankingRange,participantType:h,participantsCount:v,ratingsParameters:a,category:d,idPrefix:I,sex:y}),S=as({tournamentRecord:o,participants:b});if(S.error)return S;let w=b==null?void 0:b.filter(({participantType:T})=>T===h),U=b==null?void 0:b.map(Tt);return{uniqueDrawParticipants:w,uniqueParticipantIds:U}}function QEe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=Ys,qualifyingPositions:o=0,stage:s=Ae,drawSize:l=0,drawName:u,drawId:c}=r,d=l-o,p=i.slice(0,d).map(Tt);if(p.length){let f=Ks({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:n});if(f.error)return f}let m=p.map(f=>({entryStatus:ca,entryStage:s,participantId:f})),h=$R({drawName:u||a,qualifyingPositions:o,drawEntries:m,drawId:c,event:n,stage:s});return h.error?h:{...Z}}function Lte({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:o,event:s}){let l=0;for(let u of n){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=Ae,drawSize:m=0}=u,h=m-c,f=d||o||a||p===Ke,g=f?t.slice(l,l+h):i[p||Ae]||[];f&&(l+=h);let v=QEe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:u,event:s});if(v.error)return v}return{...Z}}function _te(t){var e;let{allUniqueParticipantIds:i,matchUpStatusProfile:r,participantsProfile:n,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,eventProfile:d,eventIndex:p,publish:m,isMock:h,uuids:f}=t,g=d.gender,v=d.eventName,{eventType:y=ol,policyDefinitions:I,drawProfiles:b=[],eventExtensions:S,surfaceCategory:w,tieFormatName:U,processCodes:T,discipline:D,eventLevel:P,timeItems:C,ballType:R,category:N}=d,A=d.eventId||Ht(),M=d.tieFormat||(y===ur?Eu({namedFormat:U,event:{eventId:A,category:N,gender:g},hydrateCollections:s,isMock:h}):void 0),E=c.participants;for(let W of b)!g&&W.gender&&(g=W==null?void 0:W.gender);let{stageParticipantsCount:O,uniqueParticipantsCount:k,uniqueParticipantStages:x}=Ate({drawProfiles:b,category:N,gender:g}),F=Xi(ol)(y)&&Dt||Xi(ho)(y)&&ft||y,{uniqueDrawParticipants:$=[],uniqueParticipantIds:_=[]}=x?Fte({event:{eventType:y,category:N,gender:g},uniqueParticipantsCount:k,participantsProfile:n,ratingsParameters:u,tournamentRecord:c,eventProfile:d,eventIndex:p,uuids:f}):{},{eventAttributes:L}=d;typeof L!="object"&&(L={});let B=(N==null?void 0:N.categoryName)||(N==null?void 0:N.ageCategoryCode)||(N==null?void 0:N.ratingType);v=v||B||"Generated Event";let V={...L,surfaceCategory:w,processCodes:T,discipline:D,eventLevel:P,eventName:v,eventType:y,tieFormat:M,ballType:R,category:N,eventId:A,gender:g};if(S!=null&&S.length&&Array.isArray(S)){let W=S.filter(ll);W!=null&&W.length&&Object.assign(V,{extensions:W})}if(Array.isArray(C)&&C.forEach(W=>_h({event:z,timeItem:W})),typeof I=="object")for(let W of Object.keys(I))ip({policyDefinitions:{[W]:I[W]},event:V});V.category&&(V.category.categoryName=B);let G,j=Cv({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:V});if(j.error)return j;let z=j==null?void 0:j.event,{stageParticipants:q}=Ote({allUniqueParticipantIds:i,stageParticipantsCount:O,eventParticipantType:F,targetParticipants:E});if(b!=null&&b.length){let W=Lte({uniqueDrawParticipants:$,autoEntryPositions:o,stageParticipants:q,tournamentRecord:c,drawProfiles:b,category:N,gender:g,event:z});if(W.error)return W;let Y=xte({matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawProfiles:b,isMock:h,event:z});if(Y.error)return Y;G=Y.drawIds}else if((e=d==null?void 0:d.participantsProfile)!=null&&e.participantsCount){let W=$.map(Tt);if(W.length){let Y=Ks({participantIds:W,autoEntryPositions:o,tournamentRecord:c,entryStage:Ae,event:z});if(Y.error)return Y}}return m&&Mv({tournamentRecord:c,event:z}),{drawIds:G,eventId:A,uniqueParticipantIds:_}}function V$({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!ba(e))return{error:xr};let n="addSchedulingProfileRound",{extension:a}=vt({name:Om,tournamentRecords:t,discover:!0}),o=(a==null?void 0:a.value)||[],s=o.find(p=>Hl(e,p.scheduleDate));if(!s){let{startDate:p,endDate:m}=UR({tournamentRecords:t}),h=new Date(e);if(p&&h<new Date(p)||m&&h>new Date(m))return{error:xr};s={scheduleDate:e,venues:[]},o.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(m=>!u.includes(m)).sort().map(m=>At(p[m])?c(p[m]):p[m]).flat().join("|");if(l.rounds.find(p=>c(p)===c(r)))return te({result:{error:FK},stack:n});l.rounds.push(r);let d=Pv({tournamentRecords:t,schedulingProfile:o});return d.error?d:{...Z}}function e1e({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:se};let i=vv({tournamentRecord:e}).containedStructures,r=Gr({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let o of t){let{scheduleDate:s,venues:l=[]}=o;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:m,winnerFinishingPositionRange:h,roundSegment:f}=p,g=r.filter(v=>{var y;let I=(h==null?void 0:h.indexOf("-"))>0&&h.split("-").map(S=>+S),b=(y=v.finishingPositionRange)==null?void 0:y.winner;return v.drawId===m&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!b||!I||ji(b,I).length===2||dt(b).length===dt(I).length&&ji(b,I).length===dt(b).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:I,structureName:b,roundName:S}=g,w=g.structureId;y&&!h&&(w=Object.keys(i).find(D=>i[D].includes(w))??w);let U={tournamentId:n,structureId:w,roundNumber:y,roundSegment:f,eventId:v,drawId:m},T=V$({tournamentRecords:{[n]:e},round:U,scheduleDate:s,venueId:d});if(T.error)return T;a.push({structureName:b,roundName:S,drawName:I,...U})}}}}return{scheduledRounds:a}}function ZR(t){var e,i,r;let n=We(t,[{drawProfile:!0,_ofType:ta}]);if(n.error)return n;let{allUniqueParticipantIds:a=[],participantsProfile:o={},matchUpStatusProfile:s,completeAllMatchUps:l,autoEntryPositions:u,hydrateCollections:c,randomWinningSide:d,ratingsParameters:p,tournamentRecord:m,isMock:h=!0,drawProfile:f,startDate:g,drawIndex:v,uuids:y}=t,I=Ne(f,!1,!0),{excessParticipantAlternates:b=!0,matchUpFormat:S=Ho,drawType:w=Ys,tournamentAlternates:U=0,alternatesCount:T=0,qualifyingPositions:D,qualifyingProfiles:P,generate:C=!0,eventExtensions:R,drawExtensions:N,completionGoal:A,tieFormatName:M,buildTeams:E,seedsCount:O,timeItems:k,drawName:x,category:F,idPrefix:$,publish:_,gender:L,stage:B}=I,V=I.drawSize||(I.ignoreDefaults?void 0:32),G=I.eventId||Ht(),j=f.eventType||f.matchUpType||ol,z=j===ho?ft:Dt,q=At(f.tieFormat)&&f.tieFormat||j===Xt&&Eu({event:{eventId:G,category:F,gender:L},namedFormat:M,hydrateCollections:c,isMock:h})||void 0,W=(F==null?void 0:F.categoryName)||(F==null?void 0:F.ageCategoryCode)||(F==null?void 0:F.ratingType),Y=f.eventName||W||`Generated ${j}`,re=(m==null?void 0:m.participants)||[],K=((P==null?void 0:P.map(me=>me.structureProfiles||[]).flat().reduce((me,fe)=>{let pe=!fe.participantsCount||fe.participantsCount>fe.drawSize?fe.drawSize:fe.participantsCount||0;return me+pe},0))||0)*(z===ft?2:1),H=(!f.participantsCount||f.participantsCount>V?V:f.participantsCount)||0,Q={eventName:Y,eventType:j,tieFormat:q,category:F,eventId:G,gender:L};Array.isArray(k)&&k.forEach(me=>_h({event:Q,timeItem:me}));let{eventAttributes:X}=f;if(typeof X!="object"&&(X={}),Object.assign(Q,X),(R==null?void 0:R.length)&&Array.isArray(R)){let me=R.filter(ll);me!=null&&me.length&&Object.assign(Q,{extensions:me})}let ie=[];if((o==null?void 0:o.participantsCount)===0||f.uniqueParticipants||K||!m||L||F){let me=(H||0)+T+K,fe=me,pe={[Zt]:0,[mi]:0},Fe,De;j===Xt&&({teamSize:Fe,genders:De}=$$({alternatesCount:T,tieFormatName:M,tieFormat:q,drawSize:V}),Object.keys(De).forEach(he=>{[Zt,mi].includes(he)&&De[he]&&(pe[he]=V*De[he])}),fe=Fe*((V||0)+K));let je=o!=null&&o.idPrefix?`D-${v}-${o==null?void 0:o.idPrefix}`:void 0,ue=kv({...o,scaledParticipantsCount:f.scaledParticipantsCount||o.scaledParticipantsCount,participantsCount:fe,consideredDate:m==null?void 0:m.startDate,sex:L||(o==null?void 0:o.sex),rankingRange:f.rankingRange,uuids:f.uuids||y,ratingsParameters:p,participantType:z,gendersCount:pe,idPrefix:je,category:F}).participants;if(Q.category&&(Q.category.categoryName=W),m){let he=as({participants:ue,tournamentRecord:m});if(he.error)return he}if(ue.forEach(({participantId:he})=>ie.push(he)),re=ue,j===Xt){let he=De[Zt]?ue.filter(({participantType:Be,person:nt})=>Be===Dt&&(nt==null?void 0:nt.sex)===Zt).map(Tt):[],Re=De[mi]?ue.filter(({participantType:Be,person:nt})=>Be===Dt&&(nt==null?void 0:nt.sex)===mi).map(Tt):[],xe=ue.filter(({participantType:Be})=>Be===Dt).map(Tt).filter(Be=>!he.includes(Be)&&!Re.includes(Be)),Ce=[...I.teamNames??[],...D0({count:me}).names],we=Fe-(De[Zt]+De[mi]),Ue=0,wt=0,Le=0,rt=Te(0,me).map(Be=>{let nt=Re.slice(Ue,Ue+De[mi]),Ii=he.slice(wt,wt+De[Zt]),be=xe.slice(Le,Le+we);Ue+=De[mi],wt+=De[Zt],Le+=we;let Et=E!==!1?[...nt,...Ii,...be]:[];return{participantName:Ce[Be]||`Team ${Be+1}`,participantOtherName:`TM${Be+1}`,participantRole:en,individualParticipantIds:Et,participantType:Xt,participantId:Ht()}}),Ci=as({participants:rt,tournamentRecord:m});if(!Ci.success)return Ci;re=rt}}let ae=me=>{let{participantType:fe}=me;return Xi(ol)(j)&&fe===Dt||Xi(ho)(j)&&fe===ft?!0:j===Xt&&fe===Xt},le=me=>{var fe,pe;return!f.gender||((fe=me.person)==null?void 0:fe.sex)===f.gender?!0:(pe=me.individualParticipantIds)==null?void 0:pe.some(Fe=>{let De=re.find(je=>je.participantId===Fe);return De&&le(De)})},ne=re.filter(ae).filter(le).filter(({participantId:me})=>!a.includes(me)),de=ne.slice(0,H).map(me=>me.participantId);if(h&&de!=null&&de.length){let me=Ks({autoEntryPositions:u,entryStage:B,tournamentRecord:m,participantIds:de,event:Q});if(me.error)return me}let Ie=K?ne.slice(H,H+K).map(me=>me.participantId):0;if(h&&Ie!=null&&Ie.length){let me=0,fe=1,pe=(De,je)=>De.stageSequence-je.stageSequence,Fe=(De,je)=>De.roundTarget-je.roundTarget;for(let De of P.sort(Fe)){fe=De.roundTarget||fe;let je=1,ue;for(let he of De.structureProfiles.sort(pe)){let Re=(he.drawSize||Fx(he.participantsCount))-(ue||0),xe=Ie.slice(me,me+Re),Ce=Ks({entryStage:Ke,entryStageSequence:je,autoEntryPositions:u,tournamentRecord:m,participantIds:xe,roundTarget:fe,event:Q});if(Ce.error)return Ce;ue=he.qualifyingPositions,me+=Re,je+=1}fe+=1}}let ce=b&&((e=m==null?void 0:m.participants)==null?void 0:e.filter(({participantId:me})=>!de.includes(me)).filter(ae).filter(le).slice(0,T||V-H||U).map(me=>me.participantId));if(h&&ce!=null&&ce.length){let me=Ks({participantIds:ce,autoEntryPositions:!1,entryStatus:Wo,tournamentRecord:m,event:Q});if(me.error)return me.error}let ke=W||Y;m&&O&&O<=de.length&&Te(1,O+1).forEach((me,fe)=>{let pe={scaleName:ke,scaleDate:g,scaleType:vL,scaleValue:me,eventType:j},Fe=de[fe];Hw({tournamentRecord:m,participantId:Fe,scaleItem:pe})});let Pe=Xw({...Ne(f,!1,!0),tournamentRecord:m,seedingScaleName:ke,matchUpFormat:S,eventId:G,isMock:h,event:Q});if(Pe.error)return Pe;if(!Pe.drawDefinition)return{error:Va};let{drawDefinition:it}=Pe,It=it.drawId;if(Array.isArray(N)&&N.filter(ll).forEach(me=>_t({element:it,extension:me})),C){if(Jw({drawDefinition:it,event:Q,suppressNotifications:!0}),f.withPlayoffs){let fe=(i=it.structures)==null?void 0:i[0].structureId,pe=sR({...f.withPlayoffs,tournamentRecord:m,drawDefinition:it,structureId:fe,idPrefix:$,isMock:h,event:Q});if(pe!=null&&pe.error)return pe}let me=f.automated===!1;if(h&&!me){let fe=pe=>{var Fe;let De=P0({completeAllMatchUps:pe.completeAllMatchUps,completionGoal:pe.completionGoal,matchUpStatusProfile:s,randomWinningSide:d,tournamentRecord:m,drawDefinition:it,matchUpFormat:S,event:Q});if(De.error)return De;let je=De.completedCount;if(w===Wl){let ue=(Fe=it.structures)==null?void 0:Fe.find(xe=>xe.stage===Ae);if(!ue)return{error:Ni};Sv({structureId:ue.structureId,tournamentRecord:m,drawDefinition:it,event:Q});let he=A?A-(je??0):void 0,Re=P0({completionGoal:A?he:void 0,matchUpStatusProfile:s,completeAllMatchUps:l,randomWinningSide:d,tournamentRecord:m,drawDefinition:it,matchUpFormat:S,event:Q});if(Re.error)return Re}};if(A&&fe({completionGoal:A}),f.outcomes){let{matchUps:pe}=Pn({inContext:!0,drawDefinition:it,event:Q});for(let Fe of f.outcomes){let{matchUpStatus:De=Ki,matchUpStatusCodes:je,stageSequence:ue=1,matchUpIndex:he=0,structureOrder:Re,matchUpFormat:xe,drawPositions:Ce,roundPosition:we,stage:Ue=Ae,roundNumber:wt,winningSide:Le,scoreString:rt}=Fe,Ci=(pe==null?void 0:pe.reduce((be,Et)=>{let{structureId:Ee,matchUpId:qe}=Et;return be[Ee]?be[Ee].push(qe):be[Ee]=[qe],be},{}))??[],Be=Object.assign({},...Object.keys(Ci).map((be,Et)=>({[be]:Et+1}))),nt=(r=pe==null?void 0:pe.filter(be=>(!Ue||be.stage===Ue)&&(!ue||be.stageSequence===ue)&&(!wt||be.roundNumber===wt)&&(!we||be.roundPosition===we)&&(!Re||Be[be.structureId]===Re)&&(!Ce||ji(Ce,be.drawPositions).length===2)))==null?void 0:r[he],Ii=kte({matchUpStatusCodes:je,tournamentRecord:m,drawDefinition:it,targetMatchUp:nt,matchUpFormat:xe,matchUpStatus:De,scoreString:rt,winningSide:Le});if(Ii!=null&&Ii.error)return Ii}}l&&fe({completeAllMatchUps:l})}_&&Mv({tournamentRecord:m,event:Q})}else{let me=$R({drawEntries:it.entries,drawName:x||w,qualifyingPositions:D,drawId:It,event:Q,stage:B});if(me.error)return me}return{...Z,event:He(Q),uniqueParticipantIds:ie,targetParticipants:re,drawDefinition:it,eventId:G,drawId:It}}var $te=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),t1e=$te;function R0(t){return parseInt(t)}function ij({startTime:t="",endTime:e=""}={}){if(!t||!e||!Td.test(t)||!Td.test(e))return!1;let[i,r]=t.split(":").map(R0),[n,a]=e.split(":").map(R0);return n<i?!1:!(i===n&&a<r)}function i1e(t,e){let[i,r]=t.startTime.split(":").map(R0),[n,a]=e.startTime.split(":").map(R0);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function Bte({dateAvailability:t}){if(!t)return{error:JK};if(!Array.isArray(t))return{error:YU};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:YU};let{date:n,startTime:a,endTime:o,bookings:s=[]}=r;if(!a||!o)return{error:YU};if(n&&!al.test(n))return{error:xr,dateAvailability:{date:n},info:e};if(!Td.test(a))return{error:No,dateAvailability:{startTime:a},info:i};if(!Td.test(o))return{error:No,dateAvailability:{endTime:o},info:i};if(a===o)return{error:No,dateAvailability:{startTime:a,endTime:o},info:"startTime and endTime are equivalent"};if(!ij({startTime:a,endTime:o}))return{error:No,dateAvailability:{startTime:a,endTime:o},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:KS};for(let l of s){if(typeof l!="object")return{error:KS};let{startTime:u,endTime:c}=l;if(!Td.test(u))return{error:No,booking:{startTime:u},info:i};if(!Td.test(c))return{error:No,booking:{endTime:c},info:i};if(u===c)return{error:No,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!ij({startTime:u,endTime:c}))return{error:No,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function QR({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=eu({tournamentRecord:t,venueId:i});if(!a)return{error:Ih};a.courts||(a.courts=[]);let o={...$te(),venueId:i,courtId:r};if(o.courtId||(o.courtId=Ht()),a.courts.some(s=>s.courtId===o.courtId))return{error:h9};{let s=((n==null?void 0:n.dateAvailability)||[]).map(c=>{var d;return{...c,date:mt(c.date),startTime:Ui(c.startTime),endTime:Ui(c.endTime),bookings:(d=c.bookings)==null?void 0:d.map(({startTime:p,endTime:m,bookingType:h})=>({startTime:Ui(p),endTime:Ui(m),bookingType:h}))}}),l=Object.keys(o);for(let c of l)if(n!=null&&n[c])if(c==="dateAvailability"){let d=Bte({dateAvailability:s});if(!d.valid&&d.error)return d;o.dateAvailability=s}else o[c]=n[c];let u=o;return a.courts.push(u),e||ut({payload:{venue:a,tournamentId:t.tournamentId},topic:Pp,key:a.venueId}),{...Z,court:Ne(o),venueId:i}}}function j$(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:Qc};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let o of Object.values(r)){let{venue:s}=eu({tournamentRecord:o,venueId:i});if(s){let l=r1e({...t,tournamentRecord:o});for(let u of(l==null?void 0:l.courts)??[])n.push(u==null?void 0:u.courtId);if(l.error)return l;a=!0}}return a?{...Z,courtIds:n}:{error:Ih}}function r1e({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:Qc};let m=eu({tournamentRecord:r,venueId:d});if(m.error)return m;let{venue:h}=m;if(!_i(o)||!n)return{error:m9};o=o??n.length;let f=Te(0,o).map(g=>{let v=a==null?void 0:a[g],y=v?p.map(I=>({date:Go(I),startTime:s,endTime:u,...v})):e;return v&&s&&u&&y.push({startTime:s,endTime:u}),{courtName:n[g]||i&&(h==null?void 0:h.venueAbbreviation)&&`${h==null?void 0:h.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||c&&`${c}-${v+1}`;return QR({disableNotice:!0,tournamentRecord:r,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return f.length!==o?te({info:"not all courts could be generated",result:{error:se}}):(h&&ut({payload:{venue:h,tournamentId:r.tournamentId},topic:Pp,key:h.venueId}),{...Z,courts:Ne(f)})}function G$({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,o=[];for(let[s,l]of i.entries()){let{venueAbbreviation:u,venueId:c=(r==null?void 0:r.pop())??Ht(),dateAvailability:d,startTime:p="07:00",endTime:m="19:00",courtTimings:h,courtsCount:f,courtNames:g,venueName:v,idPrefix:y,courtIds:I}=l,b={venueName:v||`Venue ${s+1}`,venueAbbreviation:u,venueId:c},S=ww({tournamentRecord:t,venue:b});if(S.error){if(e)continue;return S}o.push(c);let w=Zf(n,a),U=!Array.isArray(d)&&[{startTime:p,endTime:m}].concat(w.map(T=>({date:Go(T),startTime:p,endTime:m})));if(f||g){let T=j$({dateAvailability:d||U,tournamentRecord:t,courtTimings:h,courtsCount:f,courtNames:g,startTime:p,idPrefix:y,courtIds:I,endTime:m,venueId:c,dates:w});if(T.error)return T}}return o}function n1e(t){var e,i,r;let{tournamentRecord:n,leagueProfiles:a,eventIds:o,venueIds:s,drawIds:l,allUniqueParticipantIds:u,uuids:c}=t,d=0;for(let m of a){let h=[],{tieFormatName:f=t0,teamProfiles:g=[],teamsCount:v=0,category:y,idPrefix:I,gender:b}=m,S=m.leagueName??m.eventName??`League ${d+1}`,w=m.leagueId??m.eventId??(c==null?void 0:c.pop())??Ht();o.push(w);let U=At(m.tieFormat)&&m.tieFormat||Eu({event:{eventId:w,category:y,gender:b},namedFormat:f,isMock:t.isMock})||void 0;if(!U)return{error:ov};let T=Math.max(v,g.length),D=Te(0,T),{genders:P,teamSize:C}=$$({tieFormat:U,drawSize:T}),R={[mi]:0,[jn]:0,[Sd]:0,[Zt]:0,[Ns]:0};Object.keys(P).forEach(A=>R[A]+=P[A]);for(let A of D){let M=((e=g==null?void 0:g[A])==null?void 0:e.teamName)??`Team ${A+1}`,E=((i=g==null?void 0:g[A])==null?void 0:i.teamId)||(c==null?void 0:c.pop())||Ht(),O=m.startDate??t.startDate,k=kv({...m==null?void 0:m.participantsProfile,participantsCount:C,consideredDate:O,gendersCount:R,category:y,gender:b,uuids:c}).participants,x=k.map(V=>V.participantId),F=Xt,$=E??T0({participantType:F,idPrefix:I,index:A,uuids:c});h.push({participantId:$,entryStatus:ca,entryStage:Ae});let _=((r=g==null?void 0:g[A])==null?void 0:r.venueIds)??[],L={participantId:$,participantRole:en,participantName:M,individualParticipantIds:x,participantType:F,homeVenueIds:_};_.forEach(V=>!s.includes(V)&&s.push(V)),u.push(...x),u.push($);let B=as({participants:[L,...k],tournamentRecord:n});if(B.error)return B}let N={eventName:S,entries:h,eventType:Xt,tieFormat:U,category:y,eventId:w,gender:b};if(n.events||(n.events=[]),n.events.push(N),h.length){let A=(_i(m.roundsCount)&&m.roundsCount)??m.roundsCount===qUe?(T-1)*2:T-1,M=Xw({automated:m.automated,tournamentRecord:n,drawType:Ga,roundsCount:A,drawSize:T,event:N});if(M.error)return M;let{drawDefinition:E}=M;if(E){let O=E==null?void 0:E.drawId;Jw({drawDefinition:E,event:N,suppressNotifications:!0}),l.push(O)}}d++}let p=s.map(m=>({venueId:m}));G$({tournamentRecord:n,ignoreExistingVenues:!0,venueProfiles:p,uuids:c})}var a1e=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function Vte(t){var e,i,r;let{startDate:n,endDate:a}=t??{},{tournamentName:o=ga(a1e),ratingsParameters:s=Sr,tournamentExtensions:l,policyDefinitions:u,schedulingProfile:c,venueProfiles:d,uuids:p}=t??{},m=(t==null?void 0:t.isMock)===!1?void 0:!0;if(n&&!ba(n)||a&&!ba(a))return{error:xr};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:se};if(!n){let S=new Date;n=Go(a??S),a=Go(S.setDate(S.getDate()+7))}if(!a){let S=new Date(n);a=Go(S.setDate(S.getDate()+7))}let h=JR({...t.tournamentAttributes??{},tournamentName:o,startDate:n,endDate:a,isMock:m}),f=d!=null&&d.length?G$({tournamentRecord:h,venueProfiles:d,uuids:p}):[];if(l!=null&&l.length&&Array.isArray(l)){let S=l.filter(w=>ll({extension:w}));S!=null&&S.length&&Object.assign(h,{extensions:S,isMock:m})}if(typeof u=="object")for(let S of Object.keys(u))ip({policyDefinitions:{[S]:u[S]},tournamentRecord:h});if(!((e=t==null?void 0:t.leagueProfiles)!=null&&e.length)||(i=t.eventProfiles)!=null&&i.length||(r=t.drawProfiles)!=null&&r.length||t.participantsProfile){let S=Nte({tournamentRecord:h,...t});if(!S.success)return S}let g=[],v=[],y=[];if(t.leagueProfiles){let S=n1e({allUniqueParticipantIds:g,tournamentRecord:h,...t,eventIds:v,venueIds:f,drawIds:y});if(S!=null&&S.error)return S}if(t.drawProfiles){let S=o1e({allUniqueParticipantIds:g,ratingsParameters:s,tournamentRecord:h,...t,eventIds:v,drawIds:y});if(S!=null&&S.error)return S}if(t.eventProfiles){let S=s1e({allUniqueParticipantIds:g,ratingsParameters:s,tournamentRecord:h,...t,eventIds:v,drawIds:y});if(S!=null&&S.error)return S}let{scheduledRounds:I=void 0,schedulerResult:b={}}=c?l1e({...t,tournamentRecord:h}):{};return pF(),He({...Z,tournamentRecord:h,scheduledRounds:I,schedulerResult:b,eventIds:v,venueIds:f,drawIds:y})}function o1e(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,o=0;for(let s of i){let l=ZR({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:s,drawIndex:o,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if((s==null?void 0:s.addEvent)!==!1){if(l=Cv({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),n.push(c)}p!=null&&p.length&&r.push(...p),o+=1}}function s1e(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let o of e){let s=_te({...t,eventIndex:a,eventProfile:o});if(s.error)return s;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=s;u&&n.push(...u),r.push(l),c!=null&&c.length&&i.push(...c),a+=1}}function l1e(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,o=e1e({schedulingProfile:e,tournamentRecord:i});if(o.error)return o;let s=o.scheduledRounds;if(r){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:XR({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:n}),scheduledRounds:s}}return{scheduledRounds:s}}var jte={};bt(jte,{anonymizeTournamentRecord:()=>Gte,modifyTournamentRecord:()=>Hte});function Gte({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){var o,s,l,u,c;if(!i)return{error:ve};let d=Array.isArray(t)?m2.concat(...t):m2,p=L=>{var B;return Array.isArray(t)?(B=L==null?void 0:L.extensions)==null?void 0:B.filter(V=>d.includes(V.name)):L==null?void 0:L.extensions},m={};i.extensions=p(i);let h=a||Ht();m[i.tournamentId]=h,i.tournamentId=h,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${Go(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let L of i.participants||[]){L.extensions=p(L),L.onlineResources=[];let B=Ht();m[L.participantId]=B,L.participantId=B}for(let L of i.participants||[])Array.isArray(L.individualParticipantIds)&&(L.individualParticipantIds=L.individualParticipantIds.map(B=>m[B]));let f=0;for(let L of i.venues||[]){L.venueAbbreviation=`V${f}`,L.extensions=p(L),L.venueName=`Venue #${f}`,L.onlineResources=[],L.addresses=[];let B=Ht();m[L.venueId]=B,L.isMock=!0,f+=1;let V=0;for(let G of L.courts||[])G.courtName=`V${f}C${V}`,G.extensions=p(G),G.onlineResources=[],G.isMock=!0,V+=1}let g=1;for(let L of i.events||[]){L.extensions=p(L),L.onlineResources=[],L.isMock=!0;let B=Ht();m[L.eventId]=B,L.eventId=B;let V=((o=L.category)==null?void 0:o.categoryName)||((s=L.category)==null?void 0:s.ageCategoryCode)||((l=L.category)==null?void 0:l.ratingType)||L.gender;if(L.eventName=`Event ${g} ${V}`,Array.isArray(L.entries))for(let j of L.entries)j.participantId=m[j.participantId];for(let j of L.drawDefinitions||[]){j.extensions=p(j);let z=Ht();if(m[j.drawId]=z,j.drawId=z,j.isMock=!0,Array.isArray(j.entries))for(let W of j.entries)W.participantId=m[W.participantId];let q=W=>{W.extensions=p(W);let Y=Ht();m[W.structureId]=Y,W.structureId=Y;for(let re of W.positionAssignments||[])re.participantId&&(re.participantId=m[re.participantId]);for(let re of W.seedAssignments||[])re.participantId&&(re.participantId=m[re.participantId]);for(let re of W.matchUps||[]){re.isMock=!0;for(let K of re.sides||[])K.lineUp&&(K.lineUp=K.lineUp.map(({participantId:H,collectionAssignments:Q})=>({participantId:m[H],collectionAssignments:Q})))}};for(let W of j.structures||[])if(q(W),Array.isArray(W.structures))for(let Y of W.structures)q(Y);for(let W of j.links||[])W.source.structureId=m[W.source.structureId],W.target.structureId=m[W.target.structureId]}let{extension:G}=vt({name:is,element:L});Array.isArray((u=G==null?void 0:G.value)==null?void 0:u.flights)&&((c=G==null?void 0:G.value.flights)==null||c.forEach(j=>{if(j.drawId=m[j.drawId],Array.isArray(j.drawEntries))for(let z of j.drawEntries)z.participantId=m[z.participantId]})),g+=1}let v=i.startDate||Go(new Date),y=(i.participants||[]).filter(({participantType:L})=>L===Dt),I=y.reduce((L,B)=>{var V;let G=(V=B.person)==null?void 0:V.sex;return[Zt,mi].includes(G)?L[G]+=1:L[Sd]+=1,L},{[Zt]:0,[mi]:0,[Sd]:0}),b=Object.assign({},...Object.keys(I).map(L=>{var B;return{[L]:((B=Mte({category:{ageCategoryCode:"O18"},count:I[L],addressProps:{citiesCount:10},personExtensions:[],consideredDate:v,sex:L}))==null?void 0:B.persons)||[]}})),S={[Zt]:0,[mi]:0,[Sd]:0},w=y.length,U=y.reduce((L,B)=>{var V,G;let j=((G=(V=B.person)==null?void 0:V.addresses)==null?void 0:G[0])||{},{city:z,state:q,postalCode:W}=j;return L.cities.includes(z)||L.cities.push(z),L.states.includes(q)||L.states.push(q),L.postalCodes.includes(W)||L.postalCodes.push(W),L},{cities:[],postalCodes:[],states:[]}),T=U.postalCodes.length,D=U.cities.length,P=U.states.length,{cities:C}=Pte({count:D||w,participantsCount:w}),{states:R}=Rte({count:P||w,participantsCount:w}),{postalCodes:N}=Cte({count:T||w,participantsCount:w}),A={cities:C,states:R,postalCodes:N};y.forEach((L,B)=>{var V,G;let j=L==null?void 0:L.person,z=(j==null?void 0:j.sex)||Sd,q=(V=mt(j==null?void 0:j.birthDate))==null?void 0:V.split("-")[0],W=S[z],Y=b[z][W];if(S[z]+=1,q){let[,re,K]=((G=Y==null?void 0:Y.birthDate)==null?void 0:G.split("-"))||[],H=[q,re,K].join("-");Y.birthDate=H}if(j!=null&&j.addresses){let re=Ete({...A,participantIndex:B,nationalityCode:Y.nationalityCode});Y.addresses=[re]}Y.personId=(n==null?void 0:n[B])||Ht(),e?(Y.standardFamilyName=Y.lastName,Y.standardGivenName=Y.firstName,L.participantName=`${Y.standardGivenName} ${Y.standardFamilyName}`):(Y.standardFamilyName=j==null?void 0:j.standardFamilyName,Y.standardGivenName=j==null?void 0:j.standardGivenName),delete Y.firstName,delete Y.lastName,Y.extensions=p(j),L.person=Y,m[j==null?void 0:j.personId]=Y.personId}),(i.participants||[]).filter(({participantType:L})=>L===ft).forEach(L=>{let{individualParticipantIds:B}=L;L.participantName=u1e({individualParticipantIds:B,individualParticipants:y})});let M=(i.participants||[]).filter(({participantType:L})=>L===Xt),E=M.length,O=D0({count:E}).names;M.forEach((L,B)=>{L.participantName=O[B]});let k=(i.participants||[]).filter(({participantType:L})=>L===Ja),x=k.length,F=D0({count:x,nameRoot:"Group"}).names;k.forEach((L,B)=>{L.participantName=F[B]});let{extension:$}=vt({element:i,name:Om});Array.isArray($==null?void 0:$.value)&&($==null||$.value.forEach(L=>{L.tournamentId=m[L.tournamentId],L.structureId=m[L.structureId],L.eventId=m[L.eventId],L.drawId=m[L.drawId]}));let{extension:_}=vt({element:i,name:fv});return Array.isArray(_==null?void 0:_.value)&&(_==null||_.value.forEach(L=>{L.personId=m[L.personId]})),{...Z}}function u1e({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function Hte(t){var e,i,r;let{ratingsParameters:n=Sr,participantsProfile:a={},matchUpStatusProfile:o,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:u,randomWinningSide:c,schedulingProfile:d,tournamentRecord:p,autoSchedule:m,eventProfiles:h,periodLength:f,venueProfiles:g,drawProfiles:v,isMock:y,uuids:I}=t;if(!p)return{error:ve};let b=[],S=[],w=[];h==null||h.forEach(R=>{var N;let A=(N=p.events)==null?void 0:N.find((M,E)=>R.eventIndex!==void 0&&E===R.eventIndex||R.eventName&&M.eventName===R.eventName||R.eventId&&M.eventId===R.eventId);A!=null&&A.gender&&(R.gender=A.gender)});let U=((e=p.participants)==null?void 0:e.length)||void 0;U&&a!=null&&a.idPrefix&&(a.idPrefix=`${a.idPrefix}-${U}`);let T=Nte({startDate:p.startDate,participantsProfile:a,tournamentRecord:p,eventProfiles:h,drawProfiles:v,uuids:I});if(!T.success)return T;if(h){let R=((i=p.events)==null?void 0:i.length)||0;for(let N of h){let{ratingsParameters:A}=N,M=(r=p.events)==null?void 0:r.find((E,O)=>N.eventIndex!==void 0&&O===N.eventIndex||N.eventName&&E.eventName===N.eventName||N.eventId&&E.eventId===N.eventId);if(M){let{gender:E,category:O,eventType:k}=M,{drawProfiles:x,publish:F}=N,$=Xi(ol)(k)&&Dt||Xi(ho)(k)&&ft||k;if(x){let{stageParticipantsCount:_,uniqueParticipantsCount:L,uniqueParticipantStages:B}=Ate({drawProfiles:x,category:O,gender:E}),{uniqueDrawParticipants:V=[],uniqueParticipantIds:G=[]}=B?Fte({event:{eventType:k,category:O,gender:E},uniqueParticipantsCount:L,participantsProfile:a,ratingsParameters:A,tournamentRecord:p,eventProfile:N,uuids:I}):{};b.push(...G);let{stageParticipants:j}=Ote({targetParticipants:p.participants||[],allUniqueParticipantIds:b,stageParticipantsCount:_,eventParticipantType:$}),z=Lte({uniqueDrawParticipants:V,autoEntryPositions:l,stageParticipants:j,tournamentRecord:p,drawProfiles:x,category:O,gender:E,event:M});if(z.error||(z=xte({matchUpStatusProfile:o,completeAllMatchUps:s,randomWinningSide:c,tournamentRecord:p,drawProfiles:x,isMock:y,event:M}),z.error))return z;w.push(...z.drawIds)}F&&Mv({tournamentRecord:p,event:M})}else{let E=_te({startDate:p.startDate,allUniqueParticipantIds:b,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,randomWinningSide:c,ratingsParameters:A,tournamentRecord:p,eventProfile:N,eventIndex:R,uuids:I});if(E.error)return E;let{eventId:O,drawIds:k,uniqueParticipantIds:x}=E;k&&w.push(...k),S.push(O),x!=null&&x.length&&b.push(...x),R+=1}}}if(v){let R=(p.events||[]).map(N=>{var A;return((A=N.drawDefinitions)==null?void 0:A.map(()=>1))||[]}).flat().reduce((N,A)=>N+A,0);for(let N of v){let A=ZR({startDate:p.startDate,allUniqueParticipantIds:b,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:u,randomWinningSide:c,ratingsParameters:n,tournamentRecord:p,drawProfile:N,drawIndex:R,uuids:I});if(A.error)return A;let{drawId:M,eventId:E,event:O,uniqueParticipantIds:k}=A;if(A=Cv({tournamentRecord:p,event:O,internalUse:!0}),A.error)return A;M&&w.push(M),S.push(E),k!=null&&k.length&&b.push(...k),R+=1}}let D=g!=null&&g.length?G$({tournamentRecord:p,venueProfiles:g}):[],P,C={};if(d!=null&&d.length){let R={[p.tournamentId]:p},N=Pv({tournamentRecords:R,schedulingProfile:d});if(N.error)return N;if(m){let{tournamentId:A}=p,M={[A]:p};C=XR({tournamentRecords:M,periodLength:f})}}return{totalParticipantsCount:p.participants.length,scheduledRounds:P,schedulerResult:C,...Z,eventIds:S,venueIds:D,drawIds:w}}var zte={};bt(zte,{addDynamicRatings:()=>f_,addIndividualParticipantIds:()=>GR,addParticipant:()=>dl,addParticipants:()=>as,addPenalty:()=>pie,addPersonRequests:()=>Jte,addPersons:()=>mie,createGroupParticipant:()=>rie,createTeamsFromParticipantAttributes:()=>_$,deleteParticipants:()=>xh,filterParticipants:()=>Rw,findParticipant:()=>iie,getCompetitionParticipants:()=>E_,getPairedParticipant:()=>ns,getParticipantEventDetails:()=>M_,getParticipantMembership:()=>N_,getParticipantScaleItem:()=>mg,getParticipantSchedules:()=>A_,getParticipantSignInStatus:()=>O_,getParticipantTimeItem:()=>lL,getParticipants:()=>Ai,getScaleValues:()=>mv,mergeParticipants:()=>die,modifyIndividualParticipantIds:()=>Zte,modifyParticipant:()=>HR,modifyParticipantName:()=>nie,modifyParticipantOtherName:()=>eie,modifyParticipantsSignInStatus:()=>Qte,modifyPenalty:()=>uie,modifyPersonRequests:()=>Kte,mutate:()=>Wte,participantScaleItem:()=>kl,query:()=>YQ,regenerateParticipantNames:()=>tie,removeIndividualParticipantIds:()=>RL,removeParticipantIdsFromAllTeams:()=>JP,removePenalty:()=>sie,removePersonRequests:()=>Xte,removeRatings:()=>oie,scaledTeamAssignment:()=>aie,setParticipantScaleItem:()=>Hw,setParticipantScaleItems:()=>jZ,validateLineUp:()=>QP});var Wte={};bt(Wte,{addDynamicRatings:()=>f_,addIndividualParticipantIds:()=>GR,addParticipant:()=>dl,addParticipants:()=>as,addPenalty:()=>pie,addPersonRequests:()=>Jte,addPersons:()=>mie,createGroupParticipant:()=>rie,createTeamsFromParticipantAttributes:()=>_$,deleteParticipants:()=>xh,findParticipant:()=>iie,mergeParticipants:()=>die,modifyIndividualParticipantIds:()=>Zte,modifyParticipant:()=>HR,modifyParticipantName:()=>nie,modifyParticipantOtherName:()=>eie,modifyParticipantsSignInStatus:()=>Qte,modifyPenalty:()=>uie,modifyPersonRequests:()=>Kte,regenerateParticipantNames:()=>tie,removeIndividualParticipantIds:()=>RL,removeParticipantIdsFromAllTeams:()=>JP,removePenalty:()=>sie,removePersonRequests:()=>Xte,removeRatings:()=>oie,scaledTeamAssignment:()=>aie,setParticipantScaleItem:()=>Hw,setParticipantScaleItems:()=>jZ});function qte(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function Yte({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:o,endTime:s}=n;return n.requestType===iU&&(a=mt(a),o=Ui(o),s=Ui(s),a&&o&&s)?{date:a,startTime:o,endTime:s,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=qte(),t[e].push(n);return{mergeCount:r.length}}function H$(t){let{tournamentRecords:e,personRequests:i}=t,r=We(t,[{[fn]:!0}]);if(r.error)return r;if(!i)return{...Z};let n=Object.values(e);for(let a of n){let o=a.participants??[],s=[];for(let l of Object.keys(i))if(Ac({tournamentParticipants:o,personId:l})){let u=i[l];u.length&&s.push({personId:l,requests:u})}Object.keys(s).length&&_t({element:a,extension:{value:s,name:fv}})}return{...Z}}function Kte(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=We(t,[{[fn]:!0},{requests:!0,[Jn]:cn,[Ha]:se}]);if(n.error)return n;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:o}=kp({tournamentRecords:e}),s=u=>{o&&(o[u]=o[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(r&&o!=null&&o[r])s(r);else if(o)for(let u of Object.keys(o))s(u);let l=i.filter(u=>!u.requestId);return l.length&&Yte({personRequests:o,personId:r,requests:l}),H$({tournamentRecords:e,personRequests:o})}function Xte(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,o=We(t,[{[fn]:!0}]);if(o.error)return o;let{personRequests:s}=kp({tournamentRecords:e}),l=c=>{var d;s&&(s[c]=s[c].filter(p=>(!i||p.requestType!==i)&&(!r||p.requestId!==r)&&(!a||p.date!==a)),(d=s==null?void 0:s[c])!=null&&d.length||delete s[c])},u=!i&&!r&&!n&&!a;if(!u){if(n&&s!=null&&s[n])l(n);else if(s)for(let c of Object.keys(s))l(c)}return u||!s||!Object.keys(s).length?Dn({name:fv,tournamentRecords:e,discover:!0}):H$({tournamentRecords:e,personRequests:s})}function Jte(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=We(t,[{[fn]:!0,[eSe]:!0},{requests:!0,[Jn]:cn,[Ha]:se}]);if(n.error)return n;let{personRequests:a}=kp({tournamentRecords:e}),{mergeCount:o}=Yte({personRequests:a,personId:i,requests:r});return o&&a?H$({tournamentRecords:e,personRequests:a}):{error:se}}function Zte({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return te({result:{error:ve},stack:r});if(!e||!t)return te({result:{error:Je},stack:r});let n=i.participants||[],a=n.find(m=>m.participantId===e);if(!a)return te({result:{error:Wi},stack:r});if(![Xt,Ja].includes(a.participantType))return te({result:{error:Ms},context:{participantType:a.participantType},stack:r});let o=t.filter(m=>{var h;return((h=n.find(f=>f.participantId===m))==null?void 0:h.participantType)!==Dt});if(o.length)return te({result:{error:ya,invalidParticipantIds:o},stack:r});let s=a.individualParticipantIds||[],l=t.filter(m=>!s.includes(m)),u=s.filter(m=>!t.includes(m)),c=GR({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return te({result:c,stack:r});let d=RL({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return te({result:d,stack:r});let{topics:p}=So();if(p.includes(on)){let m=n.find(({participantId:h})=>h===e);ut({topic:on,payload:{tournamentId:i.tournamentId,participants:[m]}})}return{...c,...d}}function Qte({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:Je};if(![ly,SX].includes(i))return{error:se,signInState:i};let r=t.participants||[];if(!r.length)return{error:Kb};let n=r.map(Tt),a=e.filter(u=>!n.includes(u));if(a.length)return{error:se,context:{invalidParticipantIds:a}};let o=[],s=new Date().toISOString();for(let u of r){let{participantId:c}=u;if(e.includes(c)){let d=r_({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:uw,itemValue:i,createdAt:s}});if(d.error)return d;o.push(u)}}let{topics:l}=So();return o.length&&l.includes(on)&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:o}}),{...Z}}function eie({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:ve};if(!e)return{error:hr};let{participant:r}=nd({tournamentRecord:t,participantId:e});if(!r)return{error:Wi};r.participantOtherName=i;let{topics:n}=So();return n.includes(on)&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...Z}}function rj({personFormat:t,person:e}){let i=f=>f.replace(/\W/g,""),r=f=>/^[a-z]*$/.test(i(f)),n=f=>/^[A-Z]*$/.test(i(f)),a=f=>/^[LAST]{4}/.test(i(f)),o=f=>f.toLowerCase().indexOf("l")<f.toLowerCase().indexOf("f"),s=f=>f.indexOf(",")>=0,l=f=>f.toLowerCase().indexOf("f.")>=0,u=f=>f.toLowerCase().indexOf("f")<0,c=f=>f.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=SM((e==null?void 0:e.standardGivenName)??""),m=SM((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${m}`;l(t)&&!s(t)&&!o(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),m=m.toLowerCase()):n(t)?(p=p.toUpperCase(),m=m.toUpperCase()):a(t)&&(m=m.toUpperCase());let h=`${p}${d}${m}`;return u(t)?h=m:o(t)&&(s(t)?h=`${m},${d}${p}`:h=`${m}${d}${p}`),h}function c1e({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,o=r&&i[r];if(r!==Gn&&o){let{personFormat:s,doublesJoiner:l}=o;r===Dt&&(e.participantName=rj({person:a,personFormat:s})),r===ft&&(e.participantName=n==null?void 0:n.map(u=>{var c;let d=(c=t[u])==null?void 0:c.person;return rj({person:d,personFormat:s})}).filter(Boolean).join(l??"/"))}}function tie({tournamentRecord:t,formats:e}){if(!t)return{error:ve};if(!At(e))return{error:Je};let i=t.participants??[],r=wK(i,"participantId");for(let n of i)c1e({participant:n,participantMap:r,formats:e});return{...Z}}function iie(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,o=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Je,stack:"publicFindParticipant"};let s,l;for(let u of Object.values(o)){l=u.tournamentId;let c=u.participants||[];if(s=Ac({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),s)break}return{participant:s,tournamentId:l,...Z}}function rie({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=cJ,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:ve};if(!a)return{error:Je,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:se};let o=(Ai({participantFilters:{participantTypes:[Dt]},tournamentRecord:r}).participants??[]).map(c=>c.participantId);for(let c of t)if(!o.includes(c))return{error:Ms,participantId:c};let s=He({participantId:n||Ht(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:Ja,participantRole:i}),l=dl({participant:s,tournamentRecord:r});if(l.error)return l;let{topics:u}=So();return u.includes(kc)&&ut({topic:kc,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...Z,participant:Ne(s)}}function nie({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:ve};if(!i)return{error:hr};if(!e)return{error:Je,info:"Missing participantName"};let{participant:r}=nd({tournamentRecord:t,participantId:i});if(!r)return{error:Wi};r.participantName=e;let{topics:n}=So();return n.includes(on)&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...Z}}function aie({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:u,eventId:c,event:d}){var p,m,h,f,g;if(!o)return{error:ve};if(!Array.isArray(a)&&!st(u)&&!c||!st(r)||n&&!Array.isArray(n)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:se};if(!s&&!n.length||!n&&!(e&&s))return{error:Je,info:"Missing scaling details"};if(c&&!a){if((d==null?void 0:d.eventType)!==Ca)return{error:Gl};a=(p=d==null?void 0:d.entries)==null?void 0:p.filter(({entryStatus:w})=>w===ca).map(Tt)}if(!(a!=null&&a.length)&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Je};let v=e??n.map(({participantId:w})=>w);i&&(a==null||a.reverse(),r+=1),r>((a==null?void 0:a.length)||0)-1&&(r=0);let y=(a==null?void 0:a.slice(r).concat(...a.slice(0,r)))??[],I=[];for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(y.includes(U)){if(T!==Gn)return{error:Ms,participant:w};I.push(w)}}if(u&&I.length<u){let w=u-((I==null?void 0:I.length)||0),U=l??"Team",T=Te(0,w).map(R=>({participantName:`${U} ${R+1}`,participantType:Gn,participantRole:en})),{participants:D=[]}=as({participants:T,returnParticipants:!0,tournamentRecord:o}),P=D.map(Tt),C=((m=o.participants)==null?void 0:m.filter(({participantId:R})=>P.includes(R)))??[];I.push(...C)}if(!I.length)return{error:oF};if(t)for(let w of I)w.individualParticipantIds=[];else{let w=I.map(U=>U).flat();e!=null&&e.length?v=v.filter(U=>!w.includes(U)):n=n==null?void 0:n.filter(({participantId:U})=>!w.includes(U))}if(!(e!=null&&e.length)&&!(n!=null&&n.length))return{error:cP,info:"Nothing to be done"};if(!n.length){for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(!v.includes(U))continue;if(T!==Dt)return{error:Ms,participant:w};let D=(h=kl({scaleAttributes:s,participant:w}))==null?void 0:h.scaleItem,P=s!=null&&s.accessor?(f=D==null?void 0:D.scaleValue)==null?void 0:f[s==null?void 0:s.accessor]:D==null?void 0:D.scaleValue,C={participantId:U,scaleValue:P};n.push(C)}if(!n.length)return{error:Wi}}n.sort((w,U)=>s!=null&&s.sortOrder?((U==null?void 0:U.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((U==null?void 0:U.scaleValue)||1/0));for(let w of n)if(!w.participantId)return{error:se,scaledParticipant:w};let b=0;for(;b<n.length;){for(let w of I){if(b+1>n.length)break;let U=n[b];w.individualParticipantIds.push(U.participantId),b++}I.reverse()}let S=I.map(Tt);for(let w of o.events??[]){if(w.eventType!==Ca)continue;let U=(w.entries??[]).filter(T=>S.includes(T.participantId));for(let T of U){let D=T.participantId,P=(g=I.find(R=>R.participantId===D))==null?void 0:g.individualParticipantIds;w.entries=(w.entries??[]).filter(R=>!P.includes(R.participantId)),(w.drawDefinitions??[]).forEach(R=>{R.entries=(R.entries??[]).filter(N=>!P.includes(N.participantId))});let{flightProfile:C}=Hi({event:w});((C==null?void 0:C.flights)||[]).forEach(R=>{R.drawEntries=(R.drawEntries||[]).filter(N=>!P.includes(N.participantId))})}}return{...Z,scaledParticipants:n}}function oie(t){let e=We(t,[{[wr]:!0,[NF]:!0},{ratingType:!1,[Xr]:o=>Sr[o]}]);if(e.error)return e;let i=`${t.ratingType}.${xF}`,r=t.asDynamic?i:t.ratingType,n=[Xd,Ic,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let o of a)o.timeItems&&(o.timeItems=o.timeItems.filter(s=>s.itemType!==n));return{...Z}}function sie(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=d1e({...t,tournamentRecord:i});if(r.error&&r.error!==Jf)return r}return{...Z}}function d1e({tournamentRecord:t,penaltyId:e}){if(!t)return{error:ve};if(!e)return{error:tF};let i=(t==null?void 0:t.participants)??[],r=[],n=!1,a;return i.forEach(o=>{let s=!1;o.penalties=(o.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,n||(a=l,n=!0)),s&&r.push(o),l.penaltyId!==e))}),a&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...Z,penalty:a}:{error:Jf}}var p1e=({penaltyId:t=Ht()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),lie=p1e;function uie(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=m1e({...t,tournamentRecord:i});if(r.error&&r.error!==Jf||r.success)return r}return{error:Jf}}function m1e({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:ve};if(!e)return{error:se,modifications:e};if(!i)return{error:tF};let r=(t==null?void 0:t.participants)??[],n=Object.keys(lie()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:dP};let o,s=[];return r.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),o||(o=c)),c)),u&&s.push(l)}),o&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:s}}),o?{...Z,penalty:o}:{error:Jf}}function cie(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:dt(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=dt(t[n].map(o=>JSON.stringify(o)).concat(e[n].map(o=>JSON.stringify(o)))).map(o=>JSON.parse(o));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=cie(t[n],e[n],i):r[n]=e[n];return r},{})}function die({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:ve};e.participants||(e.participants=[]);let r=t.filter(Ma(ql)).map(u=>({[u.participantId]:u})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(u=>{if(n[u.participantId]){let c=cie(u,n[u.participantId],i);return a.push(c),c}return u});let o=e.participants.map(Ma(ql))||[],s=t.filter(({participantId:u})=>!o.includes(u)),{topics:l}=So();return s.length&&(e.participants=e.participants.concat(...s),l.includes(kc)&&ut({topic:kc,payload:{participants:s}})),a.length&&l.includes(on)&&ut({topic:on,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...Z}}function pie(t){var e;let{tournamentRecord:i,participantIds:r}=t,n=t.tournamentRecords??(i&&{[i.tournamentId]:i})??{},a;for(let o of Object.values(n)){let s=(e=Ai({tournamentRecord:o}).participants??[])==null?void 0:e.map(Tt).filter(l=>r.includes(l));s.length&&(a=h1e({...t,penaltyId:t.penaltyId??a,tournamentRecord:o,participantIds:s}).penaltyId)}return a?{...Z,penaltyId:a}:{error:Wi}}function h1e({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:u}){if(!e)return{error:ve};if(!i)return{error:hr};if(!n)return{error:p9};let c=((e==null?void 0:e.participants)??[]).filter(m=>i.includes(m.participantId));if(!c.length)return{error:Wi};let d=new Date().toISOString(),p=Object.assign(lie({penaltyId:o}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:s,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(m=>_t({element:p,extension:m})),c.forEach(m=>{m.penalties||(m.penalties=[]),m.penalties.push(p)}),ut({topic:on,payload:{tournamentId:e.tournamentId,participants:c}}),{...Z,penaltyId:p.penaltyId}}function mie({participantRole:t=en,tournamentRecord:e,persons:i}){var r;if(!e)return{error:ve};if(!Array.isArray(i))return{error:se};if(!Object.keys(PL).includes(t))return{error:t9};let n=(e.participants||[]).map(({person:f})=>f==null?void 0:f.personId).filter(Boolean),a=[],o=i.filter(f=>f&&(!f.personId||!n.includes(f.personId))).map(f=>(f.personId||(f.personId=Ht()),a.push(f.personId),f)),s=(f,g)=>Object.assign({},...Object.keys(f).filter(v=>!g.includes(v)).map(v=>({[v]:f[v]}))),l=o.map(f=>He({extensions:f.participantExtensions,timeItems:f.participantTimeItems,participantType:Dt,participantRole:t,person:s(f,["participantExtensions","participantTimeItems","pairedPersons"])})),u=0,c=0,d=as({participants:l,tournamentRecord:e});if(d.error)return d;c=d.addedCount||0;let p=[],m=((r=Ai({participantFilters:{participantTypes:[Dt]},tournamentRecord:e}))==null?void 0:r.participants)??[];if(t===en&&i.filter(({pairedPersons:f})=>f).forEach(({personId:f,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[f,v.personId].map(I=>Ac({tournamentParticipants:m,personId:I})).filter(Boolean);if(y.length===2){let I=y.map(Tt);p.push(He({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:en,individualParticipantIds:I,participantType:ft}))}})}),p.length){if(d=as({participants:p,tournamentRecord:e}),d.error)return d;u=d.addedCount||0}let h=c+u;return{...Z,addedCount:h,newPersonIds:a}}var hie={};bt(hie,{bulkUpdatePublishedEventIds:()=>V_,getAllEventData:()=>j_,getCourtInfo:()=>WP,getDrawData:()=>TR,getEventData:()=>DR,getEventPublishStatus:()=>Co,getPublishState:()=>kh,getTournamentPublishStatus:()=>Pw,getVenueData:()=>cg,mutate:()=>fie,publishEvent:()=>Mv,publishEventSeeding:()=>gie,publishOrderOfPlay:()=>wie,publishParticipants:()=>bie,query:()=>eee,setEventDisplay:()=>_R,unPublishEvent:()=>Uie,unPublishEventSeeding:()=>vie,unPublishOrderOfPlay:()=>yie,unPublishParticipants:()=>Iie});var fie={};bt(fie,{publishEvent:()=>Mv,publishEventSeeding:()=>gie,publishOrderOfPlay:()=>wie,publishParticipants:()=>bie,setEventDisplay:()=>_R,unPublishEvent:()=>Uie,unPublishEventSeeding:()=>vie,unPublishOrderOfPlay:()=>yie,unPublishParticipants:()=>Iie});function gie({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=Za,drawIds:a=[],event:o}){var s,l,u,c;if(!r)return{error:ve};if(!o)return{error:vi};let d=Co({event:o,status:n}),p=(((s=d==null?void 0:d.seeding)==null?void 0:s.seedingScaleNames)||i)&&{...(l=d==null?void 0:d.seeding)==null?void 0:l.seedingScaleNames,...i},m=(((u=d==null?void 0:d.seeding)==null?void 0:u.stageSeedingScaleNames)||e)&&{...(c=d==null?void 0:d.seeding)==null?void 0:c.stageSeedingScaleNames,...e},h=He({stageSeedingScaleNames:m,seedingScaleNames:p,published:!0,drawIds:a});return Ev({statusObject:{seeding:h},removePriorValues:t,status:n,event:o}),ut({topic:IX,payload:{tournamentId:r.tournamentId,eventId:o.eventId,drawIds:a}}),{...Z}}function vie({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=Za,drawIds:n,stages:a,event:o}){var s,l;if(!i)return{error:ve};if(!o)return{error:vi};let u=Co({event:o});if(u){let c=u.seeding;if(Array.isArray(a)&&c.stageSeedingScaleNames)for(let d of a)c.stageSeedingScaleNames[d]&&delete c.stageSeedingScaleNames[d];Array.isArray(e)&&c!=null&&c.seedingScaleNames&&(c.seedingScaleNames=c.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(n)&&c!=null&&c.drawIds&&(c.drawIds=c.drawIds.filter(d=>!n.includes(d))),(!Object.values(c.stageSeedingScaleNames??{}).length&&!((s=c.seedingScaleNames)!=null&&s.length)&&!((l=c.drawIds)!=null&&l.length)||!a&&!e&&!(n!=null&&n.length))&&(delete c.stageSeedingScaleNames,delete c.seedingScaleNames,delete c.drawIds,c.published=!1),Ev({statusObject:{seeding:c},removePriorValues:t,status:r,event:o})}return ut({topic:rL,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...Z}}function Iie(t){let e=To(t);if(!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=f1e({tournamentRecord:i,...t});if(r.error)return r}return{...Z}}function f1e({removePriorValues:t=!0,tournamentRecord:e,status:i=Za}){if(!e)return{error:ve};let r=`${ad}.${od}`,{timeItem:n}=Do({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].participants,bl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),ut({payload:{tournamentId:e.tournamentId},topic:ESe}),{...Z}}function yie(t){let e=To(t);if(!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=g1e({tournamentRecord:i,...t});if(r.error)return r}return{...Z}}function g1e({removePriorValues:t=!0,tournamentRecord:e,status:i=Za}){if(!e)return{error:ve};let r=`${ad}.${od}`,{timeItem:n}=Do({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,bl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),ut({topic:nL,payload:{tournamentId:e.tournamentId}}),{...Z}}function bie(t){let e=To(t);if(!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=v1e({tournamentRecord:i,...t});if(r.error)return r}return{...Z}}function v1e({removePriorValues:t,tournamentRecord:e,status:i=Za}){if(!e)return{error:ve};let r=`${ad}.${od}`,{timeItem:n}=Do({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i].participants={published:!0},bl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),ut({payload:{tournamentId:e.tournamentId},topic:bX}),{...Z}}function wie(t){let e=To(t);if(!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=I1e({tournamentRecord:i,...t});if(r.error)return r}return{...Z}}function I1e({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=Za,eventIds:n=[]}){if(!i)return{error:ve};let a=`${ad}.${od}`,{timeItem:o}=Do({element:i,itemType:a}),s=(o==null?void 0:o.itemValue)||{[r]:{}};return s[r].orderOfPlay={published:!0,scheduledDates:t,eventIds:n},bl({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:e}),ut({topic:yX,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...Z}}function Uie({removePriorValues:t=!0,tournamentRecord:e,status:i=Za,event:r}){if(!e)return{error:ve};if(!r)return{error:vi};let n=`${ad}.${od}`,{timeItem:a}=cw({itemType:n,event:r}),o=(a==null?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,_h({event:r,timeItem:{itemValue:o,itemType:n},removePriorValues:t}),Ev({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),ut({topic:iL,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...Z}}var Sie={};bt(Sie,{getEntryStatusReports:()=>b1e,getParticipantStats:()=>y1e,getStructureReports:()=>U1e,getVenuesReport:()=>T1e});function y1e({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:o,matchUps:s}){var l,u,c,d,p;if(!n)return{error:ve};if(s&&!Array.isArray(s))return{error:la};if(s=s??Gr({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(s!=null&&s.length))return{error:Xu};let m=[];e&&m.push(e),r&&m.push(r);let h=m.length?{participantIds:m}:{participantTypes:[Gn]},f=Ai({participantFilters:h,tournamentRecord:n}).participants??[];if(!f.every(({participantType:R})=>R===Gn))return{error:ya};m.length||m.push(...f.map(Tt));let g=new Map,v=new Map,y=new Map,I=new Map,b=(R,N="")=>v.get(R)||v.set(R,{participantName:N,participantId:R,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&v.get(R);for(let R of f){let{participantId:N,individualParticipantIds:A}=R;I.set(N,A??[]),b(N,R.participantName)}if(r&&!I.get(r))return te({result:{error:Wi},context:{teamParticipantId:r}});if(e&&!I.get(e))return te({result:{error:Wi},context:{opponentParticipantId:e}});let S=[],w=R=>{let N=[[],[]];for(let M of R){let E=M.participant;if(E!=null&&E.participantName){g.set(E.participantId,{participantName:E.participantName,ratings:E.ratings});let O=v.get(E.participantId);O&&(O.participantName=E.participantName)}}let A=({side:M,individualParticipantIds:E})=>{var O,k,x,F,$;return M.participantId&&(!(E!=null&&E.length)||E.includes(M.participantId))&&[M.participantId]||((k=(O=M.participant)==null?void 0:O.individualParticipantIds)==null?void 0:k.length)&&(!(E!=null&&E.length)||ji(E,(x=M.participant)==null?void 0:x.individualParticipantIds).length===(($=(F=M.participant)==null?void 0:F.individualParticipantIds)==null?void 0:$.length))&&M.participant.individualParticipantIds};if(I.size){let M=(E,O)=>{for(let k of R){if(!k.participant)continue;let x=A({individualParticipantIds:O,side:k});if(x!=null&&x.length){let F=k.sideNumber;if(!F)continue;let $=[E];i&&$.push(...x),N[F-1]=$;let _=v.get(E);for(let L of x.filter(Boolean))_&&!_.competitorIds.includes(L)&&_.competitorIds.push(L)}}};if(r)(!e||R.every(E=>E.participant&&(A({individualParticipantIds:I.get(r),side:E})||A({individualParticipantIds:I.get(e),side:E}))))&&M(r,I.get(r));else for(let[E,O]of I)M(E,O)}else if(i)for(let M of R){if(!M.participant)continue;let E=A({individualParticipantIds:[],side:M}),O=M.sideNumber;O&&(N[O-1]=E)}return N};for(let R of s){if(!At(R))return{error:la};let{matchUpStatus:N,matchUpFormat:A,matchUpType:M,winningSide:E,score:O,sides:k}=R;if(!k||!O||M===Ba||N===jt)continue;let x=w(k);if(!x.filter(Boolean).length)continue;let F=t&&E&&((l=yw({matchUp:R}))==null?void 0:l.competitiveness);S.push(R);let $=XL({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:E,score:O}),_=nZ({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:E,score:O}),{pointsTally:L,tiebreaksTally:B}=aZ({matchUpFormat:A,score:O});x.forEach((V,G)=>{var j;for(let z of V){let q=(j=g.get(z))==null?void 0:j.participantName,W=b(z,q);if(W){let Y=(X,ie)=>ie.forEach((ae,le)=>W[X][le]+=ae),re=G?[...B].reverse():B,K=G?[...L].reverse():L,H=G?[..._].reverse():_,Q=G?[...$].reverse():$;if(Y("tiebreaks",re),Y("points",K),Y("games",H),Y("sets",Q),E){let X=E-1===G?0:1;W.matchUps[X]+=1}if(F){let X=F.toLowerCase();W.competitiveness[X]||(W.competitiveness[X]=[0,0]),W.competitiveness[X][G]+=1}if(N){let X=N.toLowerCase();W.matchUpStatuses[X]||(W.matchUpStatuses[X]=0),W.matchUpStatuses[X]+=1}}}})}let U=["tiebreaks","matchUps","points","games","sets"],T=["competitive","routine","decisive"],D=new Map,P=(R,N)=>(R??0)+(N??0);for(let[R,N]of v.entries()){for(let A of U){let M=N[A].reduce(P);if(M){let E=N[A][0]/M,O=`${A}Ratio`,k=parseFloat(E.toFixed(2));N[O]=k,y.set(R,!0),D.has(O)||D.set(O,[]),(u=D.get(O))==null||u.push(k)}}for(let A of T){let M=(d=(c=N.competitiveness)==null?void 0:c[A])==null?void 0:d.reduce(P);if(M){let E=N.competitiveness[A][0]/M,O=`${A}Ratio`,k=parseFloat(E.toFixed(2));N[O]=k}}}if(!r){let R=(N,A)=>A-N;for(let N of v.values())for(let A of U){let M=`${A}Ratio`;if(typeof N[M]=="number"){let E=(p=D.get(M))==null?void 0:p.sort(R).indexOf(N[M]);if(typeof E=="number"&&E>=0){let O=`${A}Rank`;N[O]=E+1}}}}let C={relevantMatchUps:S,...Z};return r?(C.teamStats=v.get(r),e&&(C.opponentStats=v.get(e))):C.participatingTeamsCount=y.size,C.allParticipantStats=[...v.values()],C}function C0({participant:t,eventType:e}){var i,r,n,a,o,s;let l=(i=t==null?void 0:t.person)==null?void 0:i.personId,u=(n=(r=t==null?void 0:t.person)==null?void 0:r.personOtherIds)==null?void 0:n[0],c=(a=t==null?void 0:t.person)==null?void 0:a.tennisId,d=(s=(o=t==null?void 0:t.ratings)==null?void 0:o[e])==null?void 0:s.find(({scaleName:f})=>f===KL),p=d==null?void 0:d.scaleValue,{wtnRating:m,confidence:h}=p||{};return{timeStamp:d==null?void 0:d.scaleDate,personOtherId:u,confidence:h,wtnRating:m,personId:l,tennisId:c}}function b1e({tournamentRecord:t}){if(!t)return{error:ve};let e=t.tournamentId,{participantMap:i}=Ai({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(Gr({matchUpFilters:{matchUpTypes:[nm,zd]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:m,matchUpType:h})=>m==null?void 0:m.flatMap(f=>{var g,v;return h===zd?(g=f==null?void 0:f.participant)==null?void 0:g.individualParticipantIds:((v=f==null?void 0:f.participant)==null?void 0:v.participantId)||f.participantId}).filter(Boolean)).filter(Boolean),n=[],a={},o={},s={},l=0,u=({id:m,entry:h,eventId:f,eventType:g})=>{var v;let{qualifyingSeeding:y,mainSeeding:I,entryStatus:b,entryStage:S,drawId:w}=h;a[m]||(a[m]=[]);let{participant:U,events:T}=(i==null?void 0:i[m])??{},D=C0({participant:U,eventType:g}),P=(v=T==null?void 0:T[f])==null?void 0:v.ranking;b===HL&&n.push(m),a[m].push({participantType:U==null?void 0:U.participantType,participantId:m,tournamentId:e,eventType:g,eventId:f,drawId:w,entryStatus:b,entryStage:S,...D,ranking:P,mainSeeding:I,qualifyingSeeding:y})};for(let m of t.events??[]){let h={},f=U=>{h[U]||(h[U]={count:0}),h[U].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=m,I=g.flatMap(U=>{let{drawId:T,entries:D}=U;l+=1;let P=({stage:A,stageSequence:M})=>A===Ae&&M===1||A===Ke,C=(U.structures??[]).filter(P).flatMap(({positionAssignments:A})=>A).filter(Boolean).map(({participantId:A})=>A),R=({participantId:A})=>C.includes(A),N=A=>{var M,E,O,k,x,F,$,_;let{participantId:L,entryStatus:B,entryStage:V}=A;f(B);let G=(k=(O=(E=(M=i==null?void 0:i[L])==null?void 0:M.draws)==null?void 0:E[T])==null?void 0:O.seedAssignments)==null?void 0:k[Ae];return{qualifyingSeeding:(_=($=(F=(x=i==null?void 0:i[L])==null?void 0:x.draws)==null?void 0:F[T])==null?void 0:$.seedAssignments)==null?void 0:_[Ke],participantId:L,mainSeeding:G,entryStatus:B,entryStage:V,drawId:T}};return D==null?void 0:D.filter(R).map(N)}),b=U=>{var T;let D=U.participantId,P=(T=i==null?void 0:i[D].participant.individualParticipantIds)==null?void 0:T.filter(C=>r.includes(C));return D&&{[D]:{individualParticipantIds:P}}};v===Mu?(()=>{let U=Object.assign({},...I.map(b).filter(Boolean)),T=D=>{U[D.participantId].individualParticipantIds.forEach(P=>{u({id:P,eventType:v,eventId:y,entry:D})})};I.forEach(T)})():I.forEach(U=>{u({id:U==null?void 0:U.participantId,eventType:v,eventId:y,entry:U})});let S=Object.values(h).reduce((U,T)=>U+T.count,0);Object.keys(h).forEach(U=>{h[U].pct=h[U].count/S*100}),s[y]={tournamentId:e,eventId:y,entries:I,entryStatuses:h};let w=Object.assign({},...cs.flatMap(U=>{var T,D;return[{[U+"_count"]:(T=h[U])==null?void 0:T.count},{[U+"_pct"]:(D=h[U])==null?void 0:D.pct}]}));o[y]={tournamentId:e,eventId:y,...w}}let c=Object.values(i??{}).filter(({participant:{participantType:m,participantRole:h}})=>m===Dt&&h===en),d=c.filter(({participant:m})=>!r.includes(m.participantId)).map(({participant:m})=>m.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function w1e({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=h=>{let f=h==null?void 0:h.matchUpFormat;f&&(n[f]||(n[f]=0),n[f]+=1)},o=e.filter(h=>i?h.eventId===i:h.drawId===r).reduce((h,f)=>(a(f),(f.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>h[g.participantId]=g),h),{}),s=Object.values(o),l=s.map(h=>C0({participant:h,eventType:t})).filter(({wtnRating:h})=>h),u=(s.length-l.length)/s.length*100,c=l.reduce((h,f)=>{let{wtnRating:g,confidence:v}=f;return h.totalWTN+=g,h.totalConfidence+=v,h},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?c.totalWTN/l.length:0,p=l!=null&&l.length?c.totalConfidence/l.length:0,m=Object.values(n).reduce((h,f)=>h+(f||0),0);return{matchUpFormatCounts:n,matchUpsCount:m,avgConfidence:p,pctNoRating:u,avgWTN:d}}function U1e(t){var e;let{tournamentRecord:i,extensionProfiles:r,firstFlightOnly:n}=t;if(!i)return{error:Yf};let a=[],o={},s={},l=[],u=Object.assign({},...(r??[]).map(({name:f,label:g,accessor:v})=>{var y,I,b;let S=(I=(y=vt({element:i,name:f}))==null?void 0:y.extension)==null?void 0:I.value,w=v?(b=om({element:S,accessor:v}))==null?void 0:b.value:S;return{[g||f]:w}})),c=i==null?void 0:i.tournamentId,d=Gr({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],p=f=>{var g,v,y;return(y=(v=(g=Do({itemType:zF,itemSubTypes:[Al],element:{timeItems:f}}))==null?void 0:g.timeItem)==null?void 0:v.itemValue)==null?void 0:y.scaleBasis},m=({positionManipulations:f})=>{f==null||f.forEach(g=>{let{structureId:v,name:y}=g,I=g.drawPositions||[g.drawPosition];o[v]||(o[v]=[]),o[v].push(`${y}: ${I.join("/")}`)})},h=(e=i==null?void 0:i.events)==null?void 0:e.flatMap(({timeItems:f,drawDefinitions:g=[],extensions:v,eventType:y,eventName:I,eventId:b,category:S})=>{var w,U,T,D;let P=(T=(U=(w=v==null?void 0:v.find(k=>k.name===is))==null?void 0:w.value)==null?void 0:U.flights)==null?void 0:T.map(k=>({[k.drawId]:k.flightNumber})),C=P&&Object.assign({},...P),R=v==null?void 0:v.find(k=>k.name===Rd),N=f==null?void 0:f.find(k=>k.itemType===Rd),A=((D=R==null?void 0:R.value)==null?void 0:D.length)||(N==null?void 0:N.itemValue)||0,M=Object.values(C??{}),E=C&&Math.min(...M),O=p(f);return s[b]={seedingBasis:O?JSON.stringify(O):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:A,tournamentId:c,eventId:b},g.filter(k=>!n||!P||C[k.drawId]===E).flatMap(k=>{let{matchUpFormat:x,tieFormat:F,timeItems:$,extensions:_,structures:L,drawName:B,drawType:V,drawId:G}=k,{matchUpFormatCounts:j,matchUpsCount:z,avgConfidence:q,pctNoRating:W,avgWTN:Y}=w1e({eventType:y,matchUps:d,drawId:G}),re=p($)||O,K=S1e({extensions:_}),H=(K==null?void 0:K.length)||0;return m({positionManipulations:K}),s[b].totalPositionManipulations+=H,s[b].generatedDrawsCount+=1,H>s[b].maxPositionManipulations&&(s[b].maxPositionManipulations=H),L==null?void 0:L.filter(Q=>Q.stageSequence===1&&[Ke,Ae,an,Bi].includes(Q.stage)).map(Q=>{var X,ie,ae;let le=[Ae,Bi].includes(Q.stage)?d.find(be=>be.structureId===Q.structureId&&be.finishingRound===1&&be.winningSide):void 0;Q.stage===Ae&&a.push({eventName:I,drawName:B,structureId:Q.structureId});let ne=(ie=(X=le==null?void 0:le.sides)==null?void 0:X.find(be=>be.sideNumber===le.winningSide))==null?void 0:ie.participant,de=(ne==null?void 0:ne.participantType)===Gn&&ne.participantId,Ie=(ne==null?void 0:ne.participantType)===ft?ne.individualParticipants:[],ce=C0({participant:(Ie==null?void 0:Ie[0])||ne,eventType:y}),{personId:ke,personOtherId:Pe,tennisId:it,confidence:It,wtnRating:me}=ce||{},fe=C0({participant:Ie==null?void 0:Ie[1],eventType:y}),{personId:pe,personOtherId:Fe,tennisId:De,confidence:je,wtnRating:ue}=fe||{},{ageCategoryCode:he,categoryName:Re,subType:xe}=S??{},Ce=Q.matchUpFormat||x,we=(j[Ce]||0)/z*100,{tieFormatName:Ue,tieFormatDesc:wt}=w0(F),{tieFormatName:Le,tieFormatDesc:rt}=w0(Q.tieFormat),Ci=wt===rt,Be=!Ci&&Le,nt=Q.tieFormat&&!Ci&&rt,Ii=((ae=K==null?void 0:K.filter(be=>be.structureId===Q.structureId))==null?void 0:ae.length)||0;return{...u,tournamentId:c,eventId:b,structureId:Q.structureId,drawId:G,eventType:y,category:xe,categoryName:Re,ageCategoryCode:he,flightNumber:C[G],drawType:V,stage:Q.stage,seedingBasis:re?JSON.stringify(re):void 0,winningPersonId:ke,winningPersonOtherId:Pe,winningPersonTennisId:it,winningPersonWTNrating:me,winningPersonWTNconfidence:It,winningPerson2Id:pe,winningPerson2OtherId:Fe,winningPerson2TennisId:De,winningPerson2WTNrating:ue,winningPerson2WTNconfidence:je,winningTeamId:de,positionManipulations:Ii,pctNoRating:W,matchUpFormat:Ce,pctInitialMatchUpFormat:we,matchUpsCount:z,drawTieFormatName:Ue,drawTieFormatDesc:wt,tieFormatName:Be,tieFormatDesc:nt,avgConfidence:q,avgWTN:Y}})})});return a.forEach(({eventName:f,drawName:g,structureId:v})=>{var y;(y=o[v])!=null&&y.length&&l.push({eventName:f,drawName:g,actions:o[v]})}),{eventStructureReports:Object.values(s),structureReports:h,flightReports:l}}function S1e({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:r})=>r===If))==null?void 0:e.value)==null?void 0:i.slice(1)}function T1e({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){var a,o;if(!Array.isArray(n))return{error:se,dates:n};if(!Array.isArray(r))return{error:se,venueIds:r};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:ki};if(!n.every(ba))return{error:xr};let s=ic({tournamentRecords:e,ignoreDisabled:t,dates:n});if(s.error)return s;let l=(a=s==null?void 0:s.venues)==null?void 0:a.filter(({venueId:p})=>!(r!=null&&r.length)||r.includes(p)),u=(o=s.courts)==null?void 0:o.reduce((p,m)=>{var h;return(h=m.dateAvailability)==null||h.forEach(f=>{let g=f.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!n.length||n.includes(p)),c={venueIds:l==null?void 0:l.map(({venueId:p})=>p)},{matchUps:d}=As({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:c});return{venuesReport:l==null?void 0:l.map(p=>D1e(u,p,d))}}function D1e(t,e,i){let{venueId:r,courts:n,venueName:a}=e,o={};return t.forEach(s=>{var l;let u=0,c=0,d=0;for(let h of n){let f=h.dateAvailability.find(v=>v.date===s),g=(l=f&&Nv({courtDate:f}).timeSlots)==null?void 0:l.reduce((v,y)=>{let{startTime:I,endTime:b}=y,S=xt(b)-xt(I);return v+S},0);g&&(d+=1),u+=g}let p=i.filter(({schedule:h})=>h.venueId===r&&Hl(s,h.scheduledDate));p.forEach(({schedule:h})=>{let f=Ui(h.scheduledTime),g=ra(f,h.averageMinutes),v=xt(g)-xt(f);c+=v});let m=u?(c/u*100).toFixed(2):"100";o[s]={scheduledMatchUpsCount:p.length,availableCourts:d,availableMinutes:u,scheduledMinutes:c,percentUtilization:m}}),{venueId:r,venueName:a,venueReport:o}}var Tie={};bt(Tie,{addMatchUpCourtOrder:()=>T$,addMatchUpEndTime:()=>P$,addMatchUpOfficial:()=>ute,addMatchUpResumeTime:()=>C$,addMatchUpScheduleItems:()=>qR,addMatchUpScheduledDate:()=>zR,addMatchUpScheduledTime:()=>ld,addMatchUpStartTime:()=>D$,addMatchUpStopTime:()=>R$,addSchedulingProfileRound:()=>V$,allocateTeamMatchUpCourts:()=>WR,assignMatchUpCourt:()=>jh,assignMatchUpVenue:()=>Ov,bulkRescheduleMatchUps:()=>Aie,bulkScheduleMatchUps:()=>rU,bulkScheduleTournamentMatchUps:()=>yy,bulkUpdateCourtAssignments:()=>Cie,calculateScheduleTimes:()=>z$,clearMatchUpSchedule:()=>kie,clearScheduledMatchUps:()=>KR,courtGridRows:()=>MR,findMatchUpFormatTiming:()=>RR,findVenue:()=>eu,generateBookings:()=>YR,generateVirtualCourts:()=>BR,getMatchUpsToSchedule:()=>PR,getPersonRequests:()=>kp,getProfileRounds:()=>ER,getScheduledRoundsDetails:()=>Ww,getSchedulingProfile:()=>rc,getSchedulingProfileIssues:()=>G_,matchUpScheduleChange:()=>Oie,modifyMatchUpFormatTiming:()=>l$,mutate:()=>Die,proAutoSchedule:()=>Rie,proConflicts:()=>Mie,publicFindCourt:()=>yL,query:()=>aee,removeEventMatchUpFormatTiming:()=>LR,removeMatchUpCourtAssignment:()=>Pie,reorderUpcomingMatchUps:()=>Nie,scheduleMatchUps:()=>Eie,scheduleProfileRounds:()=>XR,setMatchUpDailyLimits:()=>xie,setMatchUpHomeParticipantId:()=>S$,setSchedulingProfile:()=>Pv,toggleParticipantCheckInState:()=>jR,validateSchedulingProfile:()=>CR});var Die={};bt(Die,{addMatchUpCourtOrder:()=>T$,addMatchUpEndTime:()=>P$,addMatchUpOfficial:()=>ute,addMatchUpResumeTime:()=>C$,addMatchUpScheduleItems:()=>qR,addMatchUpScheduledDate:()=>zR,addMatchUpScheduledTime:()=>ld,addMatchUpStartTime:()=>D$,addMatchUpStopTime:()=>R$,addSchedulingProfileRound:()=>V$,allocateTeamMatchUpCourts:()=>WR,assignMatchUpCourt:()=>jh,assignMatchUpVenue:()=>Ov,bulkRescheduleMatchUps:()=>Aie,bulkScheduleMatchUps:()=>rU,bulkScheduleTournamentMatchUps:()=>yy,bulkUpdateCourtAssignments:()=>Cie,calculateScheduleTimes:()=>z$,clearMatchUpSchedule:()=>kie,clearScheduledMatchUps:()=>KR,findMatchUpFormatTiming:()=>RR,generateBookings:()=>YR,generateVirtualCourts:()=>BR,matchUpScheduleChange:()=>Oie,modifyMatchUpFormatTiming:()=>l$,proAutoSchedule:()=>Rie,proConflicts:()=>Mie,removeEventMatchUpFormatTiming:()=>LR,removeMatchUpCourtAssignment:()=>Pie,reorderUpcomingMatchUps:()=>Nie,scheduleMatchUps:()=>Eie,scheduleProfileRounds:()=>XR,setMatchUpDailyLimits:()=>xie,setMatchUpHomeParticipantId:()=>S$,setSchedulingProfile:()=>Pv,toggleParticipantCheckInState:()=>jR,validateSchedulingProfile:()=>CR});function z$({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:ki};o=o??VR({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=ic({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),m=d==null?void 0:d.filter(P=>!u||u.includes(P.venueId));l||(l=m==null?void 0:m.reduce((P,C)=>{var R,N;let A=((N=(R=C.dateAvailability)==null?void 0:R.find(M=>!M.date||Hl(s,M.date)))==null?void 0:N.startTime)??C.startTime;return A&&(!P||xt(A)<xt(P))?A:P},void 0)),c||(c=m==null?void 0:m.reduce((P,C)=>{var R,N;let A=((N=(R=C.dateAvailability)==null?void 0:R.find(M=>!M.date||Hl(s,M.date)))==null?void 0:N.endTime)??C.endTime;return A&&(!P||xt(A)>xt(P))?A:P},void 0));let h=Object.values(a),f=Object.assign({},...h.map(P=>(P.events??[]).map(C=>{let{scheduleTiming:R}=dw({tournamentRecord:P,event:C});return{[C.eventId]:{event:C,scheduleTiming:R}}})).flat()),g=Kw({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:u}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],I=[];I.push(...v),I.push(...y);let b={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},S=I==null?void 0:I.map(({eventId:P,schedule:C,matchUpFormat:R})=>{let{event:N,scheduleTiming:A}=f[P],M=N==null?void 0:N.eventType,E={...A,defaultTiming:b,matchUpFormat:R},{averageMinutes:O,recoveryMinutes:k}=zP({eventType:M,timingDetails:E}),{courtId:x,venueId:F}=C,$=Ui(C.scheduledTime),_=ra($,O);return{recoveryMinutes:k,averageMinutes:O,periodLength:o,startTime:$,endTime:_,courtId:x,venueId:F}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:s,clearScheduleDates:n,periodLength:o,startTime:l,endTime:c,bookings:S,courts:m},{scheduleTimes:U}=v$(w),T=(u==null?void 0:u.length)===1&&u[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,D=I.map(Dr);return{venueId:T,scheduleTimes:U,dateScheduledMatchUpIds:D}}function Pie(t){var e;let i=We(t,[{[fn]:!0}]);if(i.error)return i;let{removePriorValues:r,tournamentRecords:n,tournamentId:a,courtDayDate:o,matchUpId:s,courtId:l,drawId:u}=t,c=n[a];if(!c)return{error:ve};let{drawDefinition:d,event:p}=sd({tournamentRecord:c,drawId:u});if(!d)return{error:$e};let m=Si({drawDefinition:d,event:p,matchUpId:s});if(m.error)return m;if(((e=m==null?void 0:m.matchUp)==null?void 0:e.matchUpType)===Ba){let{itemValue:h}=Mp({timeItems:m.matchUp.timeItems??[],itemType:Kl}),f=l&&h.filter(g=>g.courtId!==l);return Na({duplicateValues:!1,removePriorValues:r,tournamentRecord:c,drawDefinition:d,matchUpId:s,timeItem:{itemType:Kl,itemValue:f}})}else return jh({tournamentRecord:c,drawDefinition:d,courtDayDate:o,courtId:"",matchUpId:s})}function Rie({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:r}){if(!Ro(r))return{error:se};if(r.some(({hasContext:m})=>!m))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:uP};let n=Kw({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(n.error)return n;let{rows:a}=n,o=[],s=m=>[(m.sides||[]).map(h=>{var f;return[h.participantId,(f=h.participant)==null?void 0:f.individualParticipantIds]}),(m.potentialParticipants||[]).flat().map(h=>[h.participantId,h.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((m,h)=>{let f=[],g=[];Object.values(h).forEach(y=>{if(At(y)&&(y.matchUpId&&(f.push(y.matchUpId),o.push(y)),y.sides)){let I=s(y);g.push(...I)}});let v=Object.values(h).filter(y=>At(y)&&!y.matchUpId);return m.concat({matchUpIds:f,availableCourts:v,rowId:h.rowId,participantIds:g})},[]);r.filter(({matchUpStatus:m})=>m&&m!==jt&&(t||!Ir.includes(m))).sort(Oh);let u=ds({matchUps:r.concat(o),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,c=[],d=[];for(;r.length&&l.length;){let m=l.shift(),h=[];for(;r.length&&m.availableCourts.length;){let f=r.concat(h).map(T=>T.matchUpId),g=r.shift(),v=g==null?void 0:g.matchUpId,y=v&&u[v].matchUpIds.concat(u[v].dependentMatchUpIds),I=v&&f.some(T=>u[v].matchUpIds.includes(T)),b=v&&d.some(T=>u[v].dependentMatchUpIds.includes(T)),S=m.matchUpIds.some(T=>y.includes(T)),w=s(g),U=m.participantIds.some(T=>w.includes(T));if(g&&!S&&!I&&!U&&!b){let T=m.availableCourts.shift();Object.assign(g.schedule,T.schedule),Object.assign(T,g),c.push(g),m.participantIds.push(...w),m.matchUpIds.push(v)}else g&&h.push(g)}r.push(...h),d.push(...m.matchUpIds)}let p=c.map(({matchUpId:m,tournamentId:h,schedule:f,drawId:g})=>({tournamentId:h,matchUpId:m,drawId:g,schedule:{...f,scheduledDate:i}}));return n=rU({tournamentRecords:e,matchUpDetails:p}),{...n,scheduled:c,notScheduled:r}}function Cie(t){let{courtDayDate:e}=t,i=We(t,[{courtAssignments:!0,[Jn]:cn,[Ha]:Je},{[fn]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,o)=>{let{tournamentId:s}=o;return a[s]||(a[s]=[]),a[s].push(o),a},{}),n;return Object.keys(r).every(a=>{let o=t[fn][a];if(!o)return n={error:ve},!1;let s=r[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(s).every(l=>{let{drawDefinition:u}=Kn({tournamentRecord:o,drawId:l});return u?(s[l].every(c=>{let{matchUpId:d,courtId:p}=c,m=jh({tournamentRecord:o,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(m.success)return m==null?void 0:m.success;n={error:U9}}),!0):(n={error:$e},!1)})}),n||Z}function Eie(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:m=30,scheduleDate:h,matchUpIds:f,venueIds:g,startTime:v,endTime:y,dryRun:I}=t,b=We(t,[{[fn]:!0,[nw]:!0},{[Xr]:ba,[Ha]:xr,[JUe]:!0},{[Xr]:V=>!V||!isNaN(V),[tSe]:!1,[Ha]:se,[iSe]:!1,[rSe]:!1}]);if(b.error)return b;let S=t.competitionMatchUps??As({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??ds({includeParticipantDependencies:!0,matchUps:S,tournamentRecords:e}).matchUpDependencies;S.forEach(V=>{var G;(G=V.schedule)!=null&&G.scheduledDate&&Hl(h,mt(V.schedule.scheduledDate))&&fg({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:V})});let U=f.map(V=>S.find(G=>G.matchUpId===V)).filter(Boolean),{venueId:T,scheduleTimes:D,dateScheduledMatchUpIds:P}=z$({tournamentRecords:e,remainingScheduleTimes:d,startTime:Ui(v),endTime:Ui(y),scheduleDate:mt(h),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:m,venueIds:g}),C={},R=[],N={},A={},M={};S.filter(({matchUpId:V})=>P==null?void 0:P.includes(V)).forEach(V=>{var G;WM({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:V,value:1});let j=(G=V.schedule)==null?void 0:G.scheduledTime;if(j){N[V.matchUpId]=j;let z=a==null?void 0:a[V.matchUpId];Iy({recoveryMinutes:z||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:j,matchUp:V})}});let E=U.filter(V=>{let G=P==null?void 0:P.includes(V.matchUpId),j=[jt,Pt,Ki,ua,Hr,Ft].includes(V==null?void 0:V.matchUpStatus);return!G&&!V.winningSide&&!j}),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:x}=E.reduce((V,G)=>{let{drawId:j,tournamentId:z,matchUpType:q}=G,{participantIdsAtLimit:W,relevantParticipantIds:Y}=L$({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:u,matchUp:G});return W!=null&&W.length?(V.overLimitMatchUpIds.push(G.matchUpId),V.participantIdsAtLimit.push(...W),V):(Y.forEach(re=>{tU({individualParticipantProfiles:s,participantId:re});let K=s[re].counters;K[q]?K[q]+=1:K[q]=1,K[qo]?K[qo]+=1:K[qo]=1}),V.matchUpMap[z]||(V.matchUpMap[z]={}),V.matchUpMap[z][j]?V.matchUpMap[z][j].push(G):V.matchUpMap[z][j]=[G],fg({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:G}),V)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});E=E.filter(({matchUpId:V})=>!k.includes(V));let F=0,$=(D==null?void 0:D.length)??0,{personRequests:_}=kp({tournamentRecords:e,requestType:iU});for(;D!=null&&D.length&&E.length&&F<=$;){F++;let{scheduleTime:V}=D.shift(),G=E.find(j=>{let{matchUpId:z}=j,{dependenciesScheduled:q,remainingDependencies:W}=k$({matchUpScheduleTimes:N,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:j});if(!q)return M[z]||(M[z]=[]),M[z].push({scheduleTime:V,remainingDependencies:W}),!1;let{enoughTime:Y}=F$({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:V,matchUp:j});if(!Y)return A[z]||(A[z]=[]),A[z].push({scheduleTime:V}),!1;let{conflicts:re}=x$({potentials:c,averageMatchUpMinutes:r,requestConflicts:C,personRequests:_,scheduleTime:V,scheduleDate:h,matchUp:j});if(re!=null&&re.length)return!1;let K=a==null?void 0:a[j.matchUpId];return Iy({recoveryMinutes:K||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:V,matchUp:j}),N[j.matchUpId]=V,!0});E=E.filter(({matchUpId:j})=>j!==(G==null?void 0:G.matchUpId)),G||R.push(V)}E.forEach(V=>{WM({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:V})});let L=[];Object.keys(O).forEach(V=>{let G=e[V];G&&Object.keys(O[V]).forEach(j=>{let{drawDefinition:z}=sd({tournamentRecord:G,drawId:j});z&&O[V][j].forEach(({matchUpId:q})=>{let W=N[q];if(W){let Y=W.split(":").map(oo).join(":"),re=`${mt(h)}T${Y}`;I?L.push(q):(ld({drawDefinition:z,matchUpId:q,scheduledTime:re}).success&&L.push(q),T&&Ov({tournamentRecords:e,tournamentRecord:G,drawDefinition:z,matchUpId:q,venueId:T}))}})})});let B=VF(E);return{...Z,requestConflicts:Object.values(C),remainingScheduleTimes:D==null?void 0:D.map(({scheduleTime:V})=>V),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:x,skippedScheduleTimes:R,overLimitMatchUpIds:k,scheduledMatchUpIds:L,noTimeMatchUpIds:B,recoveryTimeDeferred:A,dependencyDeferred:M}}function Mie({tournamentRecords:t,matchUps:e}){if(!Ro(e))return{error:Xu};if(e.some(({matchUpId:m,hasContext:h})=>m&&!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:uP};let i=Math.max(...e.map(({schedule:m})=>(m==null?void 0:m.courtOrder)||1).map(m=>Qe(m))),r=Te(1,i+1).map(m=>e.filter(h=>{var f;return Qe((f=h.schedule)==null?void 0:f.courtOrder)===m})),n={},a={},o={};r.flat().filter(Boolean).sort(Oh).forEach(({schedule:m})=>delete m[tS]);let s=dt(e.map(({drawId:m})=>m)),l=ds({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,u=r.map((m,h)=>m.reduce((f,g)=>{if(!g.matchUpId)return f;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:I,schedule:b,sides:S,potentialParticipants:w}=g,U=b==null?void 0:b.courtId;n[v]=h,a[U]=[],f.matchUpIds.push(v),o[v]=g;let T=l[v].matchUpIds;T.length&&f.sourceMatchUpIds.push(...T);let D=(S==null?void 0:S.map(C=>{var R;return[(R=C.participant)==null?void 0:R.individualParticipantIds,C.participantId]}).flat().filter(Boolean))??[],P=(w==null?void 0:w.flat().map(({individualParticipantIds:C,participantId:R})=>[C,R]).flat().filter(Boolean))||[];return f.participantIds.push(...P,...D),y&&f.targetMatchUpIds.push(y),I&&f.targetMatchUpIds.push(I),f},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),c=(m,h)=>l[m].sources.reduce((f,g,v)=>g.includes(h)&&v+1||f,0),d=u.map(()=>[]),p=(m,h,f,g)=>{if(!o[m].schedule[tS]){o[m].schedule[tS]=h,o[m].schedule[YX]=g,d[n[m]].push({matchUpId:m,issueType:f,issueIds:g,issue:h});let v=o[m].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:m,issue:h,issueType:f,issueIds:g})}};return u.forEach((m,h)=>{let f=h?u[h-1]:void 0,g=u.slice(h+1),v={},y=Pa(m.participantIds),I=Object.keys(y).filter(w=>y[w]>1),b=m.matchUpIds.filter(w=>l[w].participantIds.some(U=>I.includes(U)));b.forEach(w=>{v[w]||(v[w]={}),v[w][pd]||(v[w][pd]=b.filter(U=>U!==w))});let S=f&&m.participantIds.filter(w=>f.participantIds.includes(w));S&&S.forEach(w=>{let U=m.matchUpIds.concat(f.matchUpIds).filter(T=>l[T].participantIds.includes(w));U.forEach(T=>{v[T]||(v[T]={}),v[T][md]||(v[T][md]=U.filter(D=>D!==T))})}),m.matchUpIds.forEach(w=>{var U,T,D,P;let C=l[w].matchUpIds;for(let N of g){let A=N.matchUpIds.filter(M=>C.includes(M));A!=null&&A.length&&(A.forEach(M=>p(M,yM,lc,[w])),p(w,yM,lc,A))}if((U=v[w])!=null&&U[pd]&&p(w,pd,IM,v[w][pd]),m.sourceMatchUpIds.includes(w)){let N=m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w));p(w,pd,lc,N),m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w)).forEach(A=>p(A,pd,lc,[w]))}let R=(T=f==null?void 0:f.matchUpIds)==null?void 0:T.filter(N=>c(w,N)>1);if(R!=null&&R.length&&(p(w,bM,lc,R),R.forEach(N=>p(N,bM,lc,[w]))),(D=v[w])!=null&&D[md]&&p(w,md,IM,v[w][md]),(P=f==null?void 0:f.targetMatchUpIds)==null?void 0:P.includes(w)){let N=o[w].schedule.courtId,A=C.filter(M=>f.matchUpIds.includes(M));A.some(M=>o[M].schedule.courtId===N)||(A.forEach(M=>p(M,md,lc,[w])),p(w,md,lc,A))}})}),{courtIssues:a,rowIssues:d}}function Nie(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return te({result:{error:ki},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return te({result:{error:Je},stack:e});let a=r==null?void 0:r.length;if(!a)return{...Z};let o=0;return r.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,m=u+(n?-1:1);m<0&&(m=a-1),m===a&&(m=0);let h=r[m].schedule.scheduledTime,f=s({tournamentId:c,scheduledTime:h,matchUpId:p,drawId:d});if(f.success)o++;else return f}),o===a?Z:te({result:{error:w9},stack:e});function s({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:m}=sd({tournamentRecord:p,drawId:d});return m?ld({drawDefinition:m,scheduledTime:u,matchUpId:c}):{error:Va}}}function Aie(t){var e,i;let{scheduleChange:r,matchUpIds:n,dryRun:a}=t;if(!n||!Array.isArray(n))return{error:hh};if(typeof r!="object")return{error:se};let o=To(t),s=[],l=[];for(let c of Object.values(o)){let d=P1e({tournamentRecord:c,scheduleChange:r,matchUpIds:n,dryRun:a});if(d.error)return d;Array.isArray(d.notRescheduled)&&l.push(...d.notRescheduled);let p=VF(d.notRescheduled),m=[];(e=d.rescheduled)==null||e.forEach(h=>{let{matchUpId:f}=h;p.includes(f)&&m.push(f),s.push(h)}),m.length&&(l=((i=d==null?void 0:d.notRescheduled)==null?void 0:i.filter(({matchUpId:h})=>!m.includes(h)))||[])}let u=!!(s.length&&!l.length);return{...Z,rescheduled:s,notRescheduled:l,allRescheduled:u}}function P1e({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){var n;if(!t)return{error:ve};if(!i||!Array.isArray(i))return{error:hh};if(typeof e!="object")return{error:se};let a=[],o=[],{minutesChange:s,daysChange:l}=e;if(!s&&!l)return{...Z};if(s&&isNaN(s))return{error:se};if(l&&isNaN(l))return{error:se};let{matchUps:u}=Gr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=({matchUpStatus:S})=>!Ir.includes(S),d=u==null?void 0:u.filter(S=>Yw({schedule:S.schedule})).filter(S=>c({matchUpStatus:S.matchUpStatus}));if(!(d!=null&&d.length))return{...Z};let{tournamentInfo:p}=Bh({tournamentRecord:t}),{startDate:m,endDate:h}=p,f=d==null?void 0:d.reduce((S,w)=>{let{matchUpId:U,drawId:T}=w;return S[T]?S[T].push(U):S[T]=[U],S},{}),g=1440;for(let S of Object.keys(f)){let w=sd({tournamentRecord:t,drawId:S});if(w.error)return w;let U=w.drawDefinition,T=f[S].filter(D=>i.includes(D));for(let D of T)if(D&&U){let P=(n=d.find(E=>E.matchUpId===D))==null?void 0:n.schedule,{scheduledTime:C,scheduledDate:R}=P,N,A,M;if(!N&&l&&R){let E=mt(R);M=jv(E,l),N=new Date(M)<new Date(m)||new Date(M)>new Date(h)}if(s&&C){let E=mt(C),O=xt(Ui(C))+s;if(N=O<0||O>g,!N){let k=ra(C,s),x=E&&M||R===E&&E;A=x?`${x}T${k}`:k}}if(N)o.push(D);else{if(!r){if(A){let E=ld({scheduledTime:A,drawDefinition:U,matchUpId:D});if(E.error)return E}if(M){let E=zR({scheduledDate:M,drawDefinition:U,matchUpId:D});if(E.error)return E}}(A||M)&&a.push(D)}}}let v=Gr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],y=v.filter(({matchUpId:S})=>a.includes(S)),I=v.filter(({matchUpId:S})=>o.includes(S)),b=y.length&&!I.length;return{...Z,rescheduled:y,notRescheduled:I,allRescheduled:b}}function Oie(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:ki};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=r||{},{drawId:d,matchUpId:p,tournamentId:m}=n||{};if(!u&&!p)return te({result:{error:Je},stack:e});let{matchUps:h}=As({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),f=h==null?void 0:h.find(({matchUpId:b})=>b===u),g=h==null?void 0:h.find(({matchUpId:b})=>b===p),v=0;if(o&&u&&!p){let b=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b!=null&&b.success&&v++,b.error)return te({result:b,stack:e})}else if(a&&o&&u&&p){let b=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b.success&&v++,b.error)return te({result:b,stack:e,info:"source"});let S=y({tournamentId:m,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:s});if(S.success&&v++,S.error)return te({result:S,stack:e,info:"target"})}else return{error:Je};return v?Z:te({result:{error:uv},stack:e});function y(b){let{tournamentRecords:S,tournamentId:w,matchUp:U,drawId:T}=b,D=S[w],{drawDefinition:P}=sd({tournamentRecord:D,drawId:T});return U.matchUpType===fi?I({...b,tournamentRecord:D,drawDefinition:P}):jh({...b,tournamentRecord:D,drawDefinition:P})}function I({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,sourceCourtId:T,courtDayDate:D,matchUpId:P,matchUp:C,courtId:R}){let N=[R].concat(C.schedule.allocatedCourts.map(({courtId:A})=>A).filter(A=>A!==T));return WR({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,courtDayDate:D,matchUpId:P,courtIds:N})}}function kie({scheduleAttributes:t=[Kl,Lc,Rh,Ch,Eh,gs,Lu,Ol,gu],tournamentRecord:e,drawDefinition:i,matchUpId:r}){var n,a;let o="clearMatchUpSchedule",s=i?(n=Pn({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:n[0]:(a=Gr({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:a[0];if(!s)return{error:hn};let l=(s.timeItems??[]).filter(u=>(u==null?void 0:u.itemType)&&!t.includes(u==null?void 0:u.itemType));return s.timeItems=l,Ct({tournamentId:e.tournamentId,context:o,drawDefinition:i,matchUp:s}),{...Z}}function xie(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:ki};if(typeof r!="object")return{error:Ju};let a=Object.keys(n).filter(o=>!i||i===o);if(i&&!a.includes(i))return{error:se};for(let o of a){let s=n[o],l=_t({extension:{name:ow,value:{dailyLimits:r}},element:s});if(l.error)return l}return{...Z}}var Fie={};bt(Fie,{addCollectionDefinition:()=>Y$,addCollectionGroup:()=>jie,aggregateTieFormats:()=>Hie,compareTieFormats:()=>_u,getTieFormat:()=>B_,modifyCollectionDefinition:()=>W$,modifyTieFormat:()=>Gie,mutate:()=>Lie,orderCollectionDefinitions:()=>Bie,query:()=>ZQ,removeCollectionDefinition:()=>q$,removeCollectionGroup:()=>$ie,tieFormatGenderValidityCheck:()=>IP,validateCollectionDefinition:()=>ew});var Lie={};bt(Lie,{addCollectionDefinition:()=>Y$,addCollectionGroup:()=>jie,aggregateTieFormats:()=>Hie,modifyCollectionDefinition:()=>W$,modifyTieFormat:()=>Gie,orderCollectionDefinitions:()=>Bie,removeCollectionDefinition:()=>q$,removeCollectionGroup:()=>$ie});function ap({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:o}){var s;let l="getTieFormat",u;if(e=(r==null?void 0:r.structureId)??e,i=(n==null?void 0:n.matchUpId)??i,(i||e)&&!t)return{error:$e};if(a&&o)u=_s(o);else if(i){if(t&&(!n||!r)){let c=Si({drawDefinition:t,matchUpId:i});if(c.error)return c;if(((s=c.matchUp)==null?void 0:s.matchUpType)!==Ba)return te({result:{error:la},stack:l});r||(r=c.structure),n||(n=c.matchUp)}u=iI({item:n,drawDefinition:t,structure:r,event:o})||iI({item:r,drawDefinition:t,structure:r,event:o})||_s(t)||_s(o)}else if(t&&e){if(!r){let c=tt({drawDefinition:t,structureId:e});if(c.error)return c;r=c==null?void 0:c.structure}u=iI({item:r,drawDefinition:t,structure:r,event:o})||_s(t)||_s(o)}else u=_s(t)||_s(o);return u?{...Z,structure:r,tieFormat:u,matchUp:n}:te({result:{error:ov},stack:l})}function E0({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![Ir].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==us&&!yr(t))}function JC({from:t,to:e}){let i=Object.keys(t),r=ji(i,Object.keys(e)).length===i.length,n=i.filter(o=>t[o]!==e[o]).map(o=>({countChange:e[o]-t[o],collectionId:o})),a=i.every(o=>t[o]===e[o]);return{equivalent:r&&a,matchUpsCountChanges:n}}function R1e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:o,event:s,uuids:l}){var u,c,d,p;let m="updateTieFormat",h=e==null?void 0:e.tournamentId,f=0,g=0,v=0,y=0,I=n==null?void 0:n.collectionDefinitions.reduce((P,C)=>(P[C.collectionId]=(P[C.collectionId]||0)+C.matchUpCount,P),{}),b=({tieFormat:P})=>{let C=P==null?void 0:P.collectionDefinitions.reduce((R,N)=>(R[N.collectionId]=(R[N.collectionId]||0)+N.matchUpCount,R),{});return JC({from:C,to:I}).equivalent},S=(u=ap({drawDefinition:i}))==null?void 0:u.tieFormat,w=(c=ap({event:s}))==null?void 0:c.tieFormat;if(s&&a){for(let P of s.drawDefinitions??[])U({drawDefinition:P});s.tieFormat=Yr(n),y+=1}else if(o){if(!o.tieMatchUps)return te({result:{error:la},stack:m});let P=Pa((d=o.tieMatchUps)==null?void 0:d.map(({collectionId:M})=>M)),C=JC({to:I,from:P}),{changes:R,changesArePossible:N,cannotChangeReaon:A}=nj({matchUp:o,check:C});if(C.equivalent)if(E0({matchUp:o,updateInProgressMatchUps:t}))o.tieFormat=Yr(n),y+=1;else return te({result:{error:Zx},info:"matchUp is IN_PROGRESS or COMPLETE",stack:m});else if(N)D({tieFormat:n,matchUp:o,changes:R,uuids:l});else return te({context:{collectionMap:I,matchUpMap:P},result:{error:Nl},info:A||"specified changes not possible",stack:m});g+=1,Ct({eventId:s==null?void 0:s.eventId,context:m,drawDefinition:i,tournamentId:h,matchUp:o})}else if(r){let P=(p=T({inheritedTieFormat:S??w,structure:r}))==null?void 0:p.modifiedMatchUpsCount;P&&(g+=P,f+=1,y+=1);let C=!r.tieFormat||_u({ancestor:r.tieFormat,descendant:n}).different;C&&(r.tieFormat=Yr(n),f+=1,y+=1),(P||C)&&i&&li({structureIds:[r.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)U({drawDefinition:i}),i.tieFormat=Yr(n),y+=1;else return{error:$e};return{modifiedStructuresCount:f,modifiedMatchUpsCount:g,addedMatchUpsCount:v,modifiedCount:y,...Z,tieFormat:n};function U({drawDefinition:P}){var C;let R=P.structures||[],N=[];for(let A of R){if(A.tieFormat)continue;let M=(C=T({inheritedTieFormat:w,structure:A}))==null?void 0:C.modifiedMatchUpsCount;if(M){f+=1,g+=M;let E=A.structureId;N.push(E)}}return li({structureIds:N,eventId:s==null?void 0:s.eventId,drawDefinition:P}),N.length}function T({inheritedTieFormat:P,structure:C}){var R,N;let A=0,M=((R=qt({matchUpFilters:{matchUpTypes:[fi]},structure:C}))==null?void 0:R.matchUps)||[];for(let E of M){let O=E0({matchUp:E,updateInProgressMatchUps:t}),k=!1,x=Pa((N=E.tieMatchUps)==null?void 0:N.map(({collectionId:$})=>$)),F=JC({from:x,to:I});if(F.equivalent)E.tieFormat&&b(E)&&O&&(E.tieFormat=Yr(n),k=!0);else{let{changes:$,changesArePossible:_}=nj({matchUp:E,check:F});if(_&&!E.tieFormat)D({changes:$,matchUp:E,tieFormat:n,uuids:l});else if(P)(!E.tieFormat||_u({ancestor:P,descendant:E.tieFormat}).different)&&(E.tieFormat=P,k=!0);else return te({result:{error:ov},stack:m})}k&&(A+=1,Ct({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:m,eventId:a,matchUp:E}))}return{modifiedMatchUpsCount:A}}function D({uuids:P,matchUp:C,tieFormat:R,changes:N}){C.tieFormat=Yr(R);let A=[],M=[];return N.forEach(E=>{if(E.countChange>0){let O=Math.max(0,...C.tieMatchUps.filter(F=>F.collectionId===E.collectionId).map(Ma("collectionPosition"))),k=R.collectionDefinitions.find(F=>F.collectionId===E.collectionId),x=Fw({matchUpsLimit:E.countChange,collectionPositionOffset:O,collectionDefinition:k,matchUp:C,uuids:P});M.push(...Ne(x,!1,!0)),v+=M.length,C.tieMatchUps.push(...x)}else{let O=E.toBePlayedTieMatchUpIds.slice(0,Math.abs(E.countChange));console.log("remove",O.length),A.push(...O),C.tieMatchUps=C.tieMatchUps.filter(({matchUpId:k})=>!O.includes(k))}}),M.length&&xc({matchUps:M,drawDefinition:i,tournamentId:h,eventId:a}),A.length&&Zu({matchUpIds:A,action:"updateTieFormat",drawDefinition:i,tournamentId:h,eventId:a}),{matchUpIdsRemoved:A,matchUpsAdded:M}}}function nj({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let o=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===Zi).map(Ma("matchUpId")),s=o.length+a>=0||a>0;return!s&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:o,collectionId:n,countChange:a}),s}),changes:r,cannotChangeReaon:i}}function eC({appliedPolicies:t,drawDefinition:e,auditData:i}){var r;if(!((r=t==null?void 0:t.audit)!=null&&r[eI]))return;let{extension:n}=vt({name:eI,element:e}),a={value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(i):[i],name:eI};_t({element:e,extension:a})}function W$({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:m,gender:h,event:f,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b}){let S="modifyCollectionDefinition";if(o&&!Ra({matchUpFormat:o}))return te({result:{error:se},context:{matchUpFormat:o},stack:S});if(r&&typeof r!="string")return te({result:{error:se},context:{collectionName:r},stack:S});if(h&&!Object.values(fF).includes(h))return te({result:{error:se},context:{gender:h},stack:S});if(p&&typeof p!="object")return te({result:{error:se},context:{category:p},stack:S});let w={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b};if(!Object.values(w).filter(Boolean).length&&!i&&!r&&!o&&!s&&!u)return te({result:{error:Je},stack:S});if(Object.values(w).filter(Boolean).length>1)return te({info:"Only one value assignment allowed per collectionDefinition",result:{error:se},stack:S});let U=ap({drawDefinition:a,structureId:c,matchUpId:d,eventId:m,event:f});if(U.error)return te({result:U,stack:S});let{matchUp:T,structure:D,tieFormat:P}=U,C=Yr(P),R=P==null?void 0:P.collectionDefinitions.find(L=>L.collectionId===l),N=C==null?void 0:C.collectionDefinitions.find(L=>L.collectionId===l);if(!R)return te({info:"source collectionDefinition",result:{error:Vr},context:{collectionId:l},stack:S});let A=v??y??I??b;if(g!=null&&g.length){let L=SK({matchUpCount:s??(R==null?void 0:R.matchUpCount)??0,collectionValueProfiles:g});if(L.errors)return te({result:{error:se},info:L.errors,stack:S})}else if(A&&!st(A))return te({result:{error:se},info:"value is not an integer",context:{value:A},stack:S});let M=(L,B)=>ji(Object.keys(L),Object.keys(B)).length===Object.keys(L).length&&ji(Object.values(L),Object.values(B)).length===Object.values(L).length,E=g&&(!R.collectionValueProfiles||!M(R.collectionValueProfiles,g)),O=st(v)&&R.collectionValue!==v||st(y)&&R.matchUpValue!==y||st(I)&&R.scoreValue!==I||st(b)&&R.setValue!==b||E,k=[];if(O&&(N.collectionValueProfiles=void 0,N.collectionValue=void 0,N.matchUpValue=void 0,N.scoreValue=void 0,N.setValue=void 0,Object.assign(N,w),k.push({collectionId:l,...He(w)})),(st(I)||st(b))&&N.collectionGroupNumber){let L=N.collectionGroupNumber;C.collectionDefinitions=C.collectionDefinitions.map(B=>{let{collectionGroupNumber:V,...G}=B;return V===L?G:B}),C.collectionGroups=C.collectionGroups.filter(({groupNumber:B})=>B!==L),k.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:x,valueGoal:F}=Vh(C),$=He({aggregateValue:x,valueGoal:F});if(($.aggregateValue!==(P==null?void 0:P.winCriteria.aggregateValue)||$.valueGoal!==(P==null?void 0:P.winCriteria.valueGoal))&&(C.winCriteria=$,k.push({collectionId:l,winCriteria:$})),st(i)&&R.collectionOrder!==i&&(N.collectionOrder=i,k.push({collectionId:l,collectionOrder:i})),r&&R.collectionName!==r&&(N.collectionName=r,k.push({collectionId:l,collectionName:r})),o&&R.matchUpFormat!==o&&(N.matchUpFormat=o,k.push({collectionId:l,matchUpFormat:o})),st(s)&&R.matchUpCount!==s&&(N.matchUpCount=s,k.push({collectionId:l,matchUpCount:s})),u&&R.matchUpType!==u)return te({result:{error:pP},context:{matchUpType:u},stack:S});p&&R.category!==p&&(N.category=p,k.push({collectionId:l,category:p})),h&&R.gender!==h&&(N.gender=h,k.push({collectionId:l,gender:h}));let _=He(C);if(U=qn({tieFormat:_}),U.error)return te({result:U,stack:S});if(!k.length)return te({result:{...Z,modifications:k}});if((P==null?void 0:P.tieFormatName)!==n?(_.tieFormatName=n,k.push({tieFormatName:n})):k.length&&(delete _.tieFormatName,k.push("tieFormatName removed: modifications without new tieFormatName")),U=R1e({tieFormat:_,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:D,eventId:m,matchUp:T,event:f}),!U.error){let{appliedPolicies:L}=Bt({tournamentRecord:e}),B=He({collectionDefinition:N,drawId:a==null?void 0:a.drawId,action:S,structureId:c,matchUpId:d,eventId:m});eC({appliedPolicies:L,drawDefinition:a,auditData:B})}return te({result:{...U,modifications:k},stack:S})}function C1e({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){var o,s;let l=[];return n&&a?l=[a]:i&&r?l=((o=qt({matchUpFilters:{matchUpTypes:[fi]},structure:r}))==null?void 0:o.matchUps)??[]:e&&(l=((s=Pn({matchUpFilters:{matchUpTypes:[fi]},drawDefinition:e}))==null?void 0:s.matchUps)??[]),{targetMatchUps:l.filter(u=>!u.winningSide&&u.matchUpStatus!==Ki&&(t||u.matchUpStatus!==us&&!yr(u)))}}function E1e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let o of r){let s=!!o.tieFormat;s&&(o.tieFormat=Yr(n));let l;if(t){let u=Bt({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=tc({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}s&&!l&&Ct({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:o,drawDefinition:i})}return{...Z}}function _ie({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:m,valueGoal:h}=Vh(l);l.winCriteria=He({aggregateValue:m,valueGoal:h}),(e&&e!==h||m&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:f}=C1e({updateInProgressMatchUps:t,drawDefinition:a,structureId:o,structure:s,matchUpId:u,matchUp:c});E1e({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:f,drawDefinition:a,tieFormat:l,event:p});let g=He(l),v=qn({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:$e};return li({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...Z}}function $ie({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:u}){if(!e)return{error:Je};if(isNaN(e))return{error:se};let c="removeCollectionGroup",d=s?void 0:ap({drawDefinition:r,structureId:a,matchUpId:o,eventId:l,event:u});if(d!=null&&d.error)return te({result:d,stack:c});let p=d==null?void 0:d.structure;s=s??(d==null?void 0:d.matchUp);let m=d==null?void 0:d.tieFormat,h=m==null?void 0:m.winCriteria.valueGoal,f=m==null?void 0:m.winCriteria.aggregateValue,g=Yr(m);if(d=qn({tieFormat:g}),d.error)return te({result:d,stack:c});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(y=>{let{collectionGroupNumber:I,...b}=y;return I!==e?y:(v.push(y.collectionId),b)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:y})=>y!==e),d=_ie({updateInProgressMatchUps:t,originalValueGoal:h,wasAggregateValue:f,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:o,matchUp:s,eventId:l,event:u}),!d.error){let{appliedPolicies:y}=Bt({tournamentRecord:i}),I=He({drawId:r==null?void 0:r.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:o,eventId:l});eC({appliedPolicies:y,drawDefinition:r,auditData:I})}return te({result:{...d,modifiedCollectionIds:v},stack:c})}function vg({tieFormat:t,orderMap:e}){var i;let r=Yr(t);return r.collectionDefinitions.forEach(n=>{let a=e[n.collectionId];a&&(n.collectionOrder=a)}),(i=r.collectionDefinitions)==null||i.sort((n,a)=>qf(n.collectionOrder)-qf(a.collectionOrder)),r}function Bie({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:o,event:s}){if(typeof n!="object"||!Object.values(n).every(l=>st(l)))return te({result:{error:se},context:{orderMap:n}});if(a&&s!=null&&s.tieFormat)aj({tournamentRecord:t,event:s,orderMap:n});else if(r){let l=e&&Si({drawDefinition:e,matchUpId:r});if(l!=null&&l.error)return l;if(o=l.matchUp,!o)return{error:sa};o!=null&&o.tieFormat&&(o.tieFormat=vg({tieFormat:o.tieFormat,orderMap:n}),Ct({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:o}))}else if(i){let l=tt({drawDefinition:e,structureId:i});if(l.error)return l;let u=l.structure;if(u!=null&&u.tieFormat)u.tieFormat=vg({tieFormat:u.tieFormat,orderMap:n}),Vie({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:n}),li({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)qM({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else if(s!=null&&s.tieFormat)aj({structureIds:[i],tournamentRecord:t,orderMap:n,event:s});else return{error:Vr}}else if(e!=null&&e.tieFormat)qM({tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else return{error:Vr};return{...Z}}function aj({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=vg({tieFormat:r.tieFormat,orderMap:i});e!=null&&e.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])qM({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function qM({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??(n==null?void 0:n.tieFormat),o=vg({tieFormat:a,orderMap:r});i!=null&&i.length||(e.tieFormat=o);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=vg({tieFormat:l.tieFormat??e.tieFormat??(n==null?void 0:n.tieFormat),orderMap:r})),Vie({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),s.push(l.structureId));li({drawDefinition:e,structureIds:s})}function Vie({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){var a;let o=(a=qt({matchUpFilters:{matchUpTypes:[fi]},structure:i}))==null?void 0:a.matchUps;for(let s of o)s.tieFormat&&(s.tieFormat=vg({tieFormat:s.tieFormat,orderMap:r}),Ct({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function q$({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:u,event:c}){var d,p,m,h,f;let g="removeCollectionDefinition",v=u?void 0:ap({drawDefinition:r,structureId:o,matchUpId:s,eventId:l,event:c});if(v!=null&&v.error)return te({result:v,stack:g});let y=v==null?void 0:v.structure;u=u??(v==null?void 0:v.matchUp);let I=v==null?void 0:v.tieFormat,b=Yr(I);if(v=qn({tieFormat:b}),v.error)return te({result:v,stack:g});let S=(d=b==null?void 0:b.collectionDefinitions)==null?void 0:d.find(E=>E.collectionId===a);if(!S)return te({result:{error:Vr,collectionId:a}});b.collectionDefinitions=b.collectionDefinitions.filter(E=>E.collectionId!==a),S.collectionGroupNumber&&(b.collectionDefinitions=b.collectionDefinitions.map(E=>{let{collectionGroupNumber:O,...k}=E;return k}),b.collectionGroups=b.collectionGroups.filter(({groupNumber:E})=>E!==S.collectionGroupNumber));let{aggregateValue:w,valueGoal:U}=Vh(b);b.winCriteria=He({aggregateValue:w,valueGoal:U});let T=I==null?void 0:I.winCriteria.valueGoal,D=I==null?void 0:I.winCriteria.aggregateValue;(T&&T!==U||w&&!D)&&(n?b.tieFormatName=n:delete b.tieFormatName);let P=[];s&&u?P=[u]:o&&y?P=((p=qt({matchUpFilters:{matchUpTypes:[fi]},structure:y}))==null?void 0:p.matchUps)??[]:r?P=((m=Pn({matchUpFilters:{matchUpTypes:[fi]},drawDefinition:r}))==null?void 0:m.matchUps)??[]:c&&(P=((h=tu({matchUpFilters:{matchUpTypes:[fi]},drawDefinition:r}))==null?void 0:h.matchUps)??[]);let C=(P||[]).filter(E=>{var O,k,x;let F=(k=(O=E.tieMatchUps)==null?void 0:O.filter(_=>_.collectionId===a))==null?void 0:k.some(yr),$=e&&E.tieFormat?(x=_u({descendant:E.tieFormat,ancestor:b}))==null?void 0:x.different:!1;return t&&!F||!E.winningSide&&E.matchUpStatus!==Ki&&(t||E.matchUpStatus!==us&&!yr(E)&&!$)});if(!C.length)return{error:uv};let{appliedPolicies:R}=Bt({tournamentRecord:i});if(s&&u&&t){let E=(f=u.tieMatchUps)==null?void 0:f.filter(O=>O.collectionId===a);for(let O of E??[]){let k=Qw({matchUpId:O.matchUpId,tieMatchUpId:u==null?void 0:u.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:R,drawDefinition:r,event:c});if(k.error||(k=Si({drawDefinition:r,matchUpId:s}),k.error))return k;u=k==null?void 0:k.matchUp}}let N=[];for(let E of C){for(let O of(E==null?void 0:E.sides)??[])O.lineUp=(O.lineUp??[]).map(k=>({participantId:k.participantId,collectionAssignments:((k==null?void 0:k.collectionAssignments)??[]).filter(x=>x.collectionId!==a)}));if(E.tieMatchUps=(E.tieMatchUps??[]).filter(O=>{let k=O.collectionId===a;return k&&N.push(O.matchUpId),!k}),E.tieFormat&&(E.tieFormat=Yr(b)),t){let O=tc({matchUpId:E.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:R,drawDefinition:r,event:c});if(O.error)return O}Ct({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,drawDefinition:r,context:g,matchUp:E})}N.length&&Zu({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:N,eventId:c==null?void 0:c.eventId,drawDefinition:r});let A=He(b);if(v=qn({tieFormat:A}),v.error)return te({result:v,stack:g});if(l&&c)c.tieFormat=A;else if(s&&u)u.tieFormat=A;else if(y)y.tieFormat=A;else if(r)r.tieFormat=A;else if(!u||!r)return{error:$e};li({drawDefinition:r,eventId:c==null?void 0:c.eventId});let M=He({drawId:r==null?void 0:r.drawId,action:g,collectionId:a,structureId:o,matchUpId:s,eventId:l});return eC({appliedPolicies:R,drawDefinition:r,auditData:M}),{tieFormat:A,deletedMatchUpIds:N,targetMatchUps:C,...Z}}function jie({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(n))return te({result:{error:Je},stack:d});let p=l?void 0:ap({drawDefinition:r,structureId:o,matchUpId:s,eventId:u,event:c});if(p!=null&&p.error)return te({result:p,stack:d});let m=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,f=h==null?void 0:h.winCriteria.valueGoal,g=Yr(h);if(p=qn({tieFormat:g}),p.error)return te({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:I,collectionGroupNumber:b}=y;if(b&&n.includes(I))return te({info:"collectionIds cannot be part of other collectionGroups",result:{error:se},stack:d})}let v=(g.collectionGroups||[]).reduce((y,I)=>I.groupNumber>y?I.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>n.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],_ie({updateInProgressMatchUps:t,originalValueGoal:f,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:o,structure:m,tieFormat:g,matchUpId:s,matchUp:l,eventId:u,event:c})}function Y$({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:m,uuids:h,event:f}){var g,v;let y="addCollectionDefinition",I=Bt({tournamentRecord:r,drawDefinition:s,event:f}).appliedPolicies??{},b=(n==null?void 0:n[Lr])??(I==null?void 0:I[Lr]);a=a??((g=b==null?void 0:b.participants)==null?void 0:g.enforceCategory);let S=(u??((v=b==null?void 0:b.participants)==null?void 0:v.enforceGender))!==!1,w=!!((i??(f==null?void 0:f.category))&&a!==!1),U=!!((o??(f==null?void 0:f.gender))&&S),T=ew({referenceCategory:i??(f==null?void 0:f.category),collectionDefinition:e,referenceGender:o,checkCategory:w,checkGender:U,event:f});if(T.error)return te({result:T,stack:y});let D=p!=null&&p.tieFormat?void 0:ap({drawDefinition:s,structureId:c,matchUpId:d,eventId:m,event:f});if(D!=null&&D.error)return te({result:{error:D.error},stack:y});let P=D==null?void 0:D.structure;p=p??(D==null?void 0:D.matchUp);let C=(p==null?void 0:p.tieFormat)??(D==null?void 0:D.tieFormat),R=Yr(C);if(D=qn({tieFormat:R}),D==null?void 0:D.error)return te({result:{error:D.error},stack:y});if(!e.collectionId)e.collectionId=Ht();else if(R.collectionDefinitions.map(({collectionId:_})=>_).includes(e.collectionId))return te({context:{collectionId:e.collectionId},result:{error:D9}});R.collectionDefinitions.push(e),R.collectionDefinitions.sort((_,L)=>(_.collectionOrder||0)-(L.collectionOrder||0)).forEach((_,L)=>_.collectionOrder=L+1);let{aggregateValue:N,valueGoal:A}=Vh(R);R.winCriteria=He({aggregateValue:N,valueGoal:A});let M=C==null?void 0:C.winCriteria.valueGoal,E=C==null?void 0:C.winCriteria.aggregateValue;(M&&M!==A||N&&!E)&&(l?R.tieFormatName=l:delete R.tieFormatName);let O=[],k=[],x=[],F=He(R);if(D=qn({tieFormat:F}),D==null?void 0:D.error)return te({result:{error:D.error},stack:y});if(m&&f){f.tieFormat=F;for(let _ of f.drawDefinitions??[])if(!_.tieFormat)for(let L of _.structures??[]){if(L.tieFormat)continue;let B=ZC({updateInProgressMatchUps:t,collectionDefinition:e,structure:L,uuids:h});k.push(...B.newMatchUps),x.push(...B.targetMatchUps),O.push(L.structureId)}wU({modifiedMatchUps:x,eventId:f==null?void 0:f.eventId,modifiedStructureIds:O,tournamentRecord:r,drawDefinition:s,addedMatchUps:k,stack:y})}else if(c&&P){P.tieFormat=F;let _=ZC({updateInProgressMatchUps:t,collectionDefinition:e,structure:P,uuids:h});k.push(..._.newMatchUps),x=_.targetMatchUps,wU({modifiedMatchUps:x,eventId:f==null?void 0:f.eventId,modifiedStructureIds:O,tournamentRecord:r,drawDefinition:s,addedMatchUps:k,stack:y})}else if(d&&p){if(!E0({matchUp:p,updateInProgressMatchUps:t}))return te({result:{error:Zx},stack:y});p.tieFormat=F;let _=Fw({collectionDefinition:e,matchUp:p,uuids:h});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(..._),k.push(..._),wU({modifiedMatchUps:[p],eventId:f==null?void 0:f.eventId,modifiedStructureIds:O,tournamentRecord:r,drawDefinition:s,addedMatchUps:k,stack:y})}else if(s){s.tieFormat=F;for(let _ of s.structures??[]){let L=ZC({updateInProgressMatchUps:t,collectionDefinition:e,structure:_,uuids:h});O.push(_.structureId),k.push(...L.newMatchUps),x.push(...L.targetMatchUps)}wU({modifiedMatchUps:x,eventId:f==null?void 0:f.eventId,tournamentRecord:r,drawDefinition:s,addedMatchUps:k,stack:y})}else return{error:$e};let $=He({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:y,structureId:c,matchUpId:d,eventId:m});return eC({appliedPolicies:I,drawDefinition:s,auditData:$}),{tieFormat:F,targetMatchUps:x,addedMatchUps:k,...Z}}function ZC({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){var n;let a=[],o=((n=qt({matchUpFilters:{matchUpTypes:[fi]},structure:i}))==null?void 0:n.matchUps).filter(s=>E0({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of o){let l=Fw({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),a.push(...l)}return{newMatchUps:a,targetMatchUps:o}}function wU({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:o}){xc({tournamentId:e==null?void 0:e.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i==null||i.forEach(s=>{Ct({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:r,context:o,matchUp:s,eventId:a})}),li({structureIds:t,drawDefinition:r,eventId:a})}function Gie({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!qn({tieFormat:i}).valid)return te({result:{error:Nl},info:"falied validation",stack:d});let p=ap({drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:c});if(p.error)return te({result:p,stack:d});let{matchUp:m,tieFormat:h}=p,f=Yr(h),g=_u({descendant:i,ancestor:f,considerations:n});if(g.invalid)return te({context:{invalid:g.invalid},result:{error:Nl},stack:d});if(!(g!=null&&g.different))return te({result:{...Z},info:"Nothing to do",stack:d});let v=f.collectionDefinitions.map(({collectionId:D})=>D),y=i.collectionDefinitions.map(({collectionId:D})=>D),I=v.filter(D=>!y.includes(D)),b=i.collectionDefinitions.filter(({collectionId:D})=>!v.includes(D)),S=b.map(Ma("collectionId")),w=[],U,T=i.tieFormatName;for(let D of i.collectionDefinitions){if(S.includes(D.collectionId))continue;let P=W$({updateInProgressMatchUps:t,...D,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:c});if(P.modifications&&w.push(...P.modifications),P.error)return te({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of b){let P=Y$({updateInProgressMatchUps:t,collectionDefinition:D,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:o,matchUpId:s,matchUp:m,eventId:l,uuids:u,event:c});if(P.error)return te({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of I){let P=q$({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:D,structureId:o,matchUpId:s,eventId:l,matchUp:m,event:c});if(P.error)return te({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}return(h==null?void 0:h.tieFormatName)!==T?(U.tieFormatName=T,w.push({tieFormatName:T})):(w.length||S.length||I.length)&&(delete U.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),U.collectionDefinitions=U.collectionDefinitions.sort((D,P)=>qf(D.collectionOrder)-qf(P.collectionOrder)).map((D,P)=>({...D,collectionOrder:P+1})),{processedTieFormat:Yr(U),modifications:w,...Z}}function Hie({tournamentRecord:t}){if(!t)return{error:ve};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=c=>{if(!c.tieFormat)return;let d;for(let p of r)_u({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)c.tieFormatId=d,delete c.tieFormat;else{let p=Ne(c.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=Ht()),c.tieFormatId=p.tieFormatId,delete c.tieFormat,r.push(p),e+=1}},a=i.eventType;n({tieFormat:i.tieFormat,eventType:a});for(let c of i.drawDefinitions??[]){n({tieFormat:c.tieFormat,eventType:a});for(let d of c.structures??[])n({tieFormat:d.tieFormat,eventType:a})}let o=(c,d)=>{var p;let m=(p=l.matchUps)==null?void 0:p.find(h=>h.matchUpId===c);m&&(m.tieFormatId=d,delete m.tieFormat,Ct({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:m}))},s=c=>{let d=Ne(c.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Ht()),r.push(d),e+=1,o(c.matchUpId,d.tieFormatId)},l=tu({matchUpFilters:{matchUpTypes:[Ba]},event:i}),u=l.matchUps??[];for(let c of u){let d;for(let p of r)c.tieFormat&&_u({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?o(c.matchUpId,d):s(c)}r.length&&(i.tieFormats=r)}return{...Z,addedCount:e}}var zie={};bt(zie,{addDrawDefinitionExtension:()=>NP,addEventExtension:()=>id,addEventTimeItem:()=>_h,addExtension:()=>_t,addNotes:()=>nR,addOnlineResource:()=>Zie,addParticipantExtension:()=>X8,addParticipantTimeItem:()=>r_,addTimeItem:()=>bl,addTournamentExtension:()=>LF,addTournamentTimeItem:()=>Bw,analyzeDraws:()=>Vw,analyzeTournament:()=>__,copyTournamentRecord:()=>qie,createTournamentRecord:()=>JR,generate:()=>Wie,getAggregateTeamResults:()=>L_,getAllowedDrawTypes:()=>bR,getAllowedMatchUpFormats:()=>k_,getAppliedPolicies:()=>Bt,getCompetitionDateRange:()=>UR,getCompetitionPenalties:()=>x_,getPolicyDefinitions:()=>Qu,getTournamentInfo:()=>Bh,getTournamentPenalties:()=>wR,getTournamentPersons:()=>F_,getTournamentPoints:()=>SR,getTournamentStructures:()=>_L,getTournamentTimeItem:()=>VP,mutate:()=>Yie,query:()=>KQ,removeDrawDefinitionExtension:()=>J8,removeEventExtension:()=>AP,removeExtension:()=>Dn,removeNotes:()=>QL,removeOnlineResource:()=>Jie,removeParticipantExtension:()=>Z8,removeTournamentExtension:()=>_F,setTournamentCategories:()=>tre,setTournamentDates:()=>tC,setTournamentEndDate:()=>rre,setTournamentName:()=>Qie,setTournamentNotes:()=>ere,setTournamentStartDate:()=>ire,setTournamentStatus:()=>Xie});var Wie={};bt(Wie,{copyTournamentRecord:()=>qie,createTournamentRecord:()=>JR});function qie(t){var e,i;let r=We(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(r.error)return r;let{startDate:n,endDate:a}=t.tournamentRecord,o=24*60*60*1e3,s=(n&&a?new Date(mt(a)).getTime()-new Date(mt(n)).getTime():0)/o,l=t.endDate||yF(t.startDate,s),u=h=>h==null?void 0:h.filter(({itemType:f})=>{var g;return(g=t.itemTypeList)==null?void 0:g.includes(f)}),c=h=>h==null?void 0:h.filter(({name:f})=>{var g;return(g=t.extensionList)==null?void 0:g.includes(f)}),d=h=>{let{timeItems:f,extensions:g,...v}=h;return Ne({...v,timeItems:u(f),extensions:c(g)},!1,!0)},p=h=>{let{drawDefinitions:f,timeItems:g,extensions:v,startDate:y,endDate:I,...b}=h;return Ne({extensions:c(v),timeItems:u(g),startDate:t.startDate,endDate:l,...b},!1,!0)},m={participants:t.copyParticipants?((e=t.tournamentRecord.participants)==null?void 0:e.map(d))??[]:[],parentOrganisation:Ne({...t.tournamentRecord.parentOrganisation},!1,!0),venues:Ne(t.tournamentRecord.venues??[],!1,!0),extensions:c(t.tournamentRecord.extensions),timeItems:u(t.tournamentRecord.timeItems),events:((i=t.tournamentRecord.events)==null?void 0:i.map(p))??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:Ht(),endDate:l};return{...Z,tournamentRecord:m}}var Yie={};bt(Yie,{addDrawDefinitionExtension:()=>NP,addEventExtension:()=>id,addEventTimeItem:()=>_h,addExtension:()=>_t,addNotes:()=>nR,addOnlineResource:()=>Zie,addParticipantExtension:()=>X8,addParticipantTimeItem:()=>r_,addTimeItem:()=>bl,addTournamentExtension:()=>LF,addTournamentTimeItem:()=>Bw,removeDrawDefinitionExtension:()=>J8,removeEventExtension:()=>AP,removeExtension:()=>Dn,removeNotes:()=>QL,removeOnlineResource:()=>Jie,removeParticipantExtension:()=>Z8,removeTournamentExtension:()=>_F,setTournamentCategories:()=>tre,setTournamentDates:()=>tC,setTournamentEndDate:()=>rre,setTournamentName:()=>Qie,setTournamentNotes:()=>ere,setTournamentStartDate:()=>ire,setTournamentStatus:()=>Xie});var M1e="ABANDONED",N1e="ACTIVE",A1e="CANCELLED",O1e="COMPLETED",k1e="IN_PROGRESS",Kie={ABANDONED:M1e,ACTIVE:N1e,CANCELLED:A1e,COMPLETED:O1e,IN_PROGRESS:k1e};function Xie({tournamentRecord:t,status:e}){return t?e&&!Object.keys(Kie).includes(e)?{error:se,info:"Unknown status"}:(t.tournamentStatus=e,{...Z}):{error:ve}}function Jie(t){var e,i,r;let n=We(t,[{tournamentRecord:!0,onlineResource:!0}]);if(n.error)return n;let{tournamentRecord:a,onlineResource:o,organisationId:s,participantId:l,personId:u,courtId:c,venueId:d}=t;if(s){if(((e=a.parentOrganisation)==null?void 0:e.parentOrganisationId)!==s)return te({result:{error:Vr}});Jh({element:a.parentOrganisation,onlineResource:o})}else if(l||u){let p=(a.participants??[]).find(m=>{var h;return u&&((h=m.person)==null?void 0:h.personId)===u||m.participantId===l});if(!p)return te(u?{result:{error:Vr}}:{result:{error:Wi}});if(u){if(((i=p.person)==null?void 0:i.personId)!==u)return te({result:{error:gh}});Jh({element:p.person,onlineResource:o})}else Jh({element:p,onlineResource:o})}else if(c){let p=(r=(a.venues??[]).filter(m=>!d||m.venueId===d).flatMap(m=>(m.courts??[]).filter(h=>h.courtId===c)))==null?void 0:r[0];if(!p)return te({result:{error:lv}});Jh({element:p,onlineResource:o})}else if(d){let p=(a.venues??[]).find(m=>m.venueId===d);if(!p)return te({result:{error:Ih}});Jh({element:p,onlineResource:o})}else Jh({element:a,onlineResource:o}),ut({payload:{parentOrganisation:a.parentOrganisation,onlineResources:a.onlineResources,tournamentId:a.tournamentId},topic:Dp});return{...Z}}function Jh({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!((r==null?void 0:r[Qf])===e[Qf]&&(r==null?void 0:r[eg])===e[eg]&&(r==null?void 0:r[tg])===e[tg]));t.onlineResources=i}function Zie(t){var e,i,r;let n=We(t,[{tournamentRecord:!0,onlineResource:!0}]);if(n.error)return n;let{tournamentRecord:a,onlineResource:o,organisationId:s,participantId:l,personId:u,courtId:c,venueId:d}=t;if(s){if(((e=a.parentOrganisation)==null?void 0:e.parentOrganisationId)!==s)return te({result:{error:Vr}});Zh({element:a.parentOrganisation,onlineResource:o})}else if(l||u){let p=(a.participants??[]).find(m=>{var h;return u&&((h=m.person)==null?void 0:h.personId)===u||m.participantId===l});if(!p)return te(u?{result:{error:Vr}}:{result:{error:Wi}});if(u){if(((i=p.person)==null?void 0:i.personId)!==u)return te({result:{error:gh}});Zh({element:p.person,onlineResource:o})}else Zh({element:p,onlineResource:o})}else if(c){let p=(r=(a.venues??[]).filter(m=>!d||m.venueId===d).flatMap(m=>(m.courts??[]).filter(h=>h.courtId===c)))==null?void 0:r[0];if(!p)return te({result:{error:lv}});Zh({element:p,onlineResource:o})}else if(d){let p=(a.venues??[]).find(m=>m.venueId===d);if(!p)return te({result:{error:Ih}});Zh({element:p,onlineResource:o})}else Zh({element:a,onlineResource:o}),ut({payload:{parentOrganisation:a.parentOrganisation,onlineResources:a.onlineResources,tournamentId:a.tournamentId},topic:Dp});return{...Z}}function Zh({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>(r==null?void 0:r[Qf])!==e[Qf]&&(r==null?void 0:r[eg])!==e[eg]&&(r==null?void 0:r[tg])!==e[tg]);return i.push(e),t.onlineResources=i,{...Z}}function Qie({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:ve};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&ut({topic:Dp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...Z}}function ere({tournamentRecord:t,notes:e}){if(!t)return{error:ve};let i=e?nR({element:t,notes:e}):QL({element:t});return i.error?i:(ut({topic:Dp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...Z})}function tre({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,ut({topic:Dp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...Z}):{error:ve}}function x1e({tournamentRecord:t}){var e,i;if(!t)return{error:ve};let{startDate:r,endDate:n}=t,a=Zf(r,n),o=[];for(let s of t.venues||[])(e=s==null?void 0:s.courts)!=null&&e.length&&o.push(...s.courts);for(let s of o){let{startTime:l,endTime:u}=(s.dateAvailability??[]).reduce((p,m)=>{let h=xt(p.startTime),f=xt(p.endTime);return m.startTime&&xt(m.startTime)<h&&(p.startTime=m.startTime),m.endTime&&xt(m.endTime)>f&&(p.endTime=m.endTime),p},{startTime:"08:00",endTime:"18:00"}),c=a.map(p=>{var m;return((m=s.dateAvailability)==null?void 0:m.find(h=>h.date===p))??{date:p,startTime:l,endTime:u}}),d=(i=s.dateAvailability)==null?void 0:i.find(p=>!p.date);d&&c.unshift(d),s.dateAvailability=c}return{...Z}}function tC(t){var e,i;let{tournamentRecord:r,startDate:n,endDate:a,weekdays:o}=t,s=(e=t.activeDates)==null?void 0:e.filter(Boolean),l=We(t,[{tournamentRecord:!0},{[Xr]:f=>al.test(f),[Ha]:xr,startDate:!1,endDate:!1},{[Xr]:f=>f.filter(Boolean).every(g=>al.test(g)),[Ha]:xr,activeDates:!1},{[Xr]:Aee,weekdays:!1}]);if(l.error)return l;if(a&&n&&new Date(a)<new Date(n))return{error:se};if(a&&n&&new Date(n)>new Date(a))return{error:se};if(s!=null&&s.length){let f=n||r.startDate,g=a||r.endDate,v=!f||s.every(I=>new Date(I)>=new Date(f)),y=!g||s.every(I=>new Date(I)<=new Date(g));if(!v||!y)return{error:xr}}let u;(n&&r.startDate&&new Date(n)>new Date(r.startDate)||a&&r.endDate&&new Date(a)<new Date(r.endDate))&&(u=!0);let c=Zf(r.startDate,r.endDate);n&&(r.startDate=n),a&&(r.endDate=a);let d=Zf(r.startDate,r.endDate),p=c.filter(f=>!d.includes(f)),m=d.filter(f=>!c.includes(f));for(let f of r.events??[])n&&f.startDate&&new Date(f.startDate)<new Date(n)&&(f.startDate=n),a&&f.startDate&&new Date(f.startDate)>new Date(a)&&(f.startDate=n??a),a&&f.endDate&&new Date(f.endDate)>new Date(a)&&(f.endDate=a),n&&f.endDate&&new Date(f.endDate)<new Date(n)&&(f.endDate=a??n);n&&r.endDate&&new Date(n)>new Date(r.endDate)&&(r.endDate=n),a&&r.startDate&&new Date(a)<new Date(r.startDate)&&(r.startDate=a),s&&(r.activeDates=s),o&&(r.weekdays=o);let h=u&&((i=F1e({tournamentRecord:r}))==null?void 0:i.unscheduledMatchUpIds);return x1e({tournamentRecord:r}),ut({payload:He({parentOrganisation:r.parentOrganisation,tournamentId:r.tournamentId,activeDates:s,startDate:n,weekdays:o,endDate:a}),topic:Dp}),{...Z,unscheduledMatchUpIds:h,datesAdded:m,datesRemoved:p}}function ire({tournamentRecord:t,startDate:e}){return e?tC({tournamentRecord:t,startDate:e}):{error:xr}}function rre({tournamentRecord:t,endDate:e}){return e?tC({tournamentRecord:t,endDate:e}):{error:xr}}function F1e({tournamentRecord:t}){let e=Gr({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let o of e){let{schedule:s,matchUpId:l}=o;if(s&&s.scheduledDate){let u=new Date(s.scheduledDate);(i&&u<i||r&&u>r)&&(a.push(l),n.includes(s.scheduledDate)||n.push(s.scheduledDate))}}return n.length&&!KR({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:PK}:{unscheduledMatchUpIds:a}}var nre={};bt(nre,{addCourt:()=>QR,addCourts:()=>j$,addVenue:()=>ww,deleteCourt:()=>mre,deleteVenue:()=>Z$,deleteVenues:()=>lre,disableCourts:()=>ure,disableVenues:()=>cre,enableCourts:()=>dre,enableVenues:()=>pre,generate:()=>are,generateCourts:()=>g$,getCompetitionVenues:()=>zw,getCourts:()=>i$,getVenuesAndCourts:()=>ic,modifyCourt:()=>Q$,modifyCourtAvailability:()=>X$,modifyVenue:()=>hre,mutate:()=>ore,publicFindVenue:()=>IL,query:()=>pee});var are={};bt(are,{generateCourts:()=>g$});var ore={};bt(ore,{addCourt:()=>QR,addCourts:()=>j$,addVenue:()=>ww,deleteCourt:()=>mre,deleteVenue:()=>Z$,deleteVenues:()=>lre,disableCourts:()=>ure,disableVenues:()=>cre,enableCourts:()=>dre,enableVenues:()=>pre,modifyCourt:()=>Q$,modifyCourtAvailability:()=>X$,modifyVenue:()=>hre});function K$(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:ve};if(!(t!=null&&t.courtId))return{error:fh};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:o}=rc({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:s}=Gr({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{var m,h,f;let g=(h=(m=p.schedule)==null?void 0:m.allocatedCourts)==null?void 0:h.map(({courtId:v})=>v);return((f=p.schedule)==null?void 0:f.courtId)===c||(g==null?void 0:g.includes(c))});return U0({matchUps:d,schedulingProfile:o})}}function L1e({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:ve};if(!r)return{error:Qc};let{schedulingProfile:n}=rc({tournamentRecord:e}),{matchUps:a}=Gr({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:o({matchUps:a,venueId:r})};function o({matchUps:s,venueId:l}){let u=s.filter(c=>{var d,p,m;let h=(p=(d=c.schedule)==null?void 0:d.allocatedCourts)==null?void 0:p.map(({venueId:f})=>f);return((m=c.schedule)==null?void 0:m.venueId)===l||(h==null?void 0:h.includes(l))});return U0({matchUps:u,schedulingProfile:n})}}function X$({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){var o,s,l;if(!t)return{error:ve};if(!n)return{error:fh};let u=Bte({dateAvailability:e});if(u.error)return u;let{updatedDateAvailability:c,totalMergeCount:d}=_1e(e);e=c;let p=Ah({tournamentRecord:t,courtId:n});if(p.error)return p;let{court:m,venue:h}=p,{matchUps:f}=K$({tournamentRecord:t,venueMatchUps:r,courtId:n});if(f!=null&&f.length){let g=(o=Bt({tournamentRecord:t}))==null?void 0:o.appliedPolicies,v=a??((l=(s=g==null?void 0:g[td])==null?void 0:s.allowDeletionWithScoresPresent)==null?void 0:l.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return m&&(m.dateAvailability=e,!i&&h&&ut({payload:{venue:h,tournamentId:t.tournamentId},topic:Pp,key:h.venueId})),{...Z,totalMergeCount:d}}function _1e(t){let e=0,i=t.reduce((n,a)=>{let{date:o,startTime:s,endTime:l,bookings:u}=a;return n[o]||(n[o]=[]),n[o].push({startTime:s,endTime:l,bookings:u}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(i1e);let{mergedAvailability:a,mergeCount:o}=$1e(i[n]);r.push(...a.map(s=>({date:n,...s}))),e+=o}),{updatedDateAvailability:r,totalMergeCount:e}}function $1e(t){let e,i,r,n=t.length,a=0,o=[];for(;t.length&&n;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(n-=1,!e)e=u,r=d,i=c;else if(Zb(rr(i),rr(u),!1)>0){let p={startTime:e,endTime:i};r!=null&&r.length&&(p.bookings=r),o.push(p),e=u,r=d,i=c}else d&&(r?r.push(d):r=d),i=c,a+=1}let s={startTime:e,endTime:i};return r!=null&&r.length&&(s.bookings=r),o.push(s),{mergedAvailability:o,mergeCount:a}}function J$({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:M9,info:e}}function sre({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:bn};if(!e&&!r)return{error:xs};let a;if(!e){if(!t)return{error:ve};({drawDefinition:e}=Kn({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=Si({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:ve};let o=Gr({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=pZ({matchUps:o,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(o=>[Lc,Kl].includes(o.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:o})=>![Lc,Kl].includes(o)),Ct({tournamentId:t==null?void 0:t.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...Z}):{error:hn}}function Z$(t){var e,i,r;if(typeof(t==null?void 0:t.venueId)!="string")return{error:Qc};let{tournamentRecord:n,venueId:a,force:o}=t,s=t.tournamentRecords||n&&{[n.tournamentId]:n}||{};if(!Object.keys(s).length)return{error:ve};let l=As({tournamentRecords:s,contextFilters:{venueIds:[a]}}).matchUps??[],u=(e=Bt({tournamentRecord:n}))==null?void 0:e.appliedPolicies,c=o??((r=(i=u==null?void 0:u[td])==null?void 0:i.allowDeletionWithScoresPresent)==null?void 0:r.venues);if(!l.length||c)for(let d of Object.values(s)){for(let m of l){let h=sre({matchUpId:m.matchUpId,drawId:m.drawId,tournamentRecord:d});if(h.error)return h}let p;d.venues=(d.venues??[]).filter(m=>(m==null?void 0:m.venueId)!==a?!0:(p=!0,!1)),p&&ut({payload:{venueId:a,tournamentId:d.tournamentId},topic:KF,key:a})}else return J$({matchUpsCount:l.length});return qw({tournamentRecords:s}),{...Z}}function lre({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:se};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,o=Z$({tournamentRecord:t,venueId:a,force:i});if(o.error)return o}}return{...Z}}function ure(t){let{courtIds:e,dates:i}=t,r=To(t),n=[{[fn]:!0,[EP]:!0}],a=We(t,n);if(a.error)return a;for(let o of Object.values(r))B1e({tournamentRecord:o,courtIds:e,dates:i});return{...Z}}function B1e({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>_t({extension:{value:r,name:bs},creationTime:!1,element:a});for(let a of t.venues||[])for(let o of a.courts||[])if(e!=null&&e.includes(o.courtId)){let s=n(o);if(s.error)return s}return{...Z}}function cre(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[fn]:!0,[MP]:!0}],a=We(t,n);if(a.error)return a;let o=Object.keys(e).filter(s=>!i||s===i);for(let s of o){let l=e[s];V1e({tournamentRecord:l,venueIds:r})}return{...Z}}function V1e({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let r=_t({creationTime:!1,element:i,extension:{name:bs,value:!0}});if(r.error)return r}return{...Z}}function dre(t){let e=To(t),i=[{[fn]:!0}];!t.enableAll&&i.push({[EP]:!0});let r=We(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:o}=t;for(let s of Object.values(e))j1e({tournamentRecord:s,courtIds:a,enableAll:n,dates:o});return{...Z}}function j1e({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(r)){let{extension:o}=vt({element:a,name:bs});if(o){let s=o.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!r.includes(l))),_t({extension:{name:bs,value:s},creationTime:!1,element:a})}}else Dn({element:a,name:bs});return{...Z}}function pre(t){let e=To(t),i=[{[fn]:!0}];!t.enableAll&&i.push({[MP]:!0});let r=We(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let o of Object.values(e))for(let s of o.venues||[])(a||n!=null&&n.includes(s.venueId))&&Dn({element:s,name:bs});return{...Z}}function mre(t){let{courtId:e,disableNotice:i,force:r}=t,n=To(t),a=We(t,[{[fn]:!0,[z8]:!0}]);if(a.error)return a;let o,s;for(let l of Object.values(n)){if(s=G1e({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),s.error&&s.error!==lv)return s;s.success&&(o=!0)}return o?{...Z}:s}function G1e({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){var n,a,o;let s=Ah({tournamentRecord:t,courtId:i});if(s.error)return s;let l=s.venue,{matchUps:u}=K$({tournamentRecord:t,courtId:i}),c=(n=Bt({tournamentRecord:t}))==null?void 0:n.appliedPolicies,d=r??((o=(a=c==null?void 0:c[td])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:o.courts);if(!(u!=null&&u.length)||d){for(let p of u??[]){let m=sre({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(m.error)return m}l&&(l.courts=(l.courts??[]).filter(p=>p.courtId!==i),e||ut({payload:{venue:l,tournamentId:t.tournamentId},topic:Pp,key:l.venueId}))}else return J$({matchUpsCount:u.length});return{...Z}}function Q$(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,o=To(t);if(!Object.keys(o).length)return{error:ki};let s,l;for(let u of Object.values(o)){let c=H1e({tournamentRecord:u,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(c!=null&&c.error)return c;s=!0}return s?{...Z}:l}function H1e({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:ve};if(!n)return{error:fh};if(!r||typeof r!="object")return{error:Ju};let o=Ah({tournamentRecord:t,courtId:n});if(o.error)return o;let{venue:s,court:l}=o,u=Object.keys(t1e()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>u.includes(p)).length)return{error:dP};let c=u.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(r).filter(p=>c.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=X$({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||ut({payload:{venue:s,tournamentId:t.tournamentId},topic:Pp,key:s==null?void 0:s.venueId}),{...Z,court:Ne(l)}}var z1e=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),W1e=z1e;function hre(t){let{modifications:e,venueId:i,force:r}=t,n=To(t);if(!Object.keys(n).length)return{error:ki};if(typeof i!="string")return{error:Qc};let a,o;for(let s of Object.values(n)){let l=q1e({tournamentRecord:s,modifications:e,venueId:i,force:r});if(l.success&&(o=!0),l.error&&(a=l.error),l.error&&l.error!==Ih)return l}return qw({tournamentRecords:n}),o?{...Z}:{error:a}}function q1e({tournamentRecord:t,modifications:e,venueId:i,force:r}){var n,a,o,s,l,u,c,d;if(!t)return{error:ve};if(!e||typeof e!="object")return{error:Ju};if(!i)return{error:Qc};let p=(n=Bt({tournamentRecord:t}))==null?void 0:n.appliedPolicies,m=r??((o=(a=p==null?void 0:p[td])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:o.venues),{matchUps:h}=L1e({tournamentRecord:t,venueId:i}),f=eu({tournamentRecord:t,venueId:i});if(f.error)return f;let g=f.venue,v=Object.keys(W1e()).filter(T=>T!=="venueId");if(!Object.keys(e).filter(T=>v.includes(T)).length)return{error:dP};let y=v.filter(T=>!["courts","onlineResources"].includes(T)),I=Object.keys(e).filter(T=>y.includes(T));g&&I.forEach(T=>Object.assign(g,{[T]:e[T]}));let b=((s=g==null?void 0:g.courts)==null?void 0:s.map(T=>T.courtId))??[],S=((l=e.courts)==null?void 0:l.map(T=>T.courtId))||[],w=S.length?b.filter(T=>!S.includes(T)):(e==null?void 0:e.courts)&&b,U=[];if(w!=null&&w.length){let T=(c=(u=g==null?void 0:g.courts)==null?void 0:u.filter(D=>w.includes(D.courtId)))==null?void 0:c.map(D=>{var P;let C=K$({courtId:D.courtId,tournamentRecord:t,venueMatchUps:h});for(let R of C.matchUps??[])U.push({matchUpId:R.matchUpId,drawId:R.drawId});return((P=C.matchUps)==null?void 0:P.length)??0}).reduce((D,P)=>D+P);if(g&&(!T||m))g.courts=(d=g.courts)==null?void 0:d.filter(D=>S.includes(D.courtId)),yy({schedule:{courtId:"",scheduledDate:""},matchUpDetails:U,removePriorValues:!0,tournamentRecord:t});else return J$({matchUpsCount:T})}if(e.courts)for(let T of e.courts){let{courtId:D}=T||{},P=Q$({modifications:T,disableNotice:!0,tournamentRecord:t,venueMatchUps:h,courtId:D,force:r});if(P.error===lv&&(P=QR({disableNotice:!0,tournamentRecord:t,venueId:i,court:T})),P.error)return P}return qw({tournamentRecord:t}),g&&ut({payload:{venue:g,tournamentId:t.tournamentId},topic:Pp,key:g==null?void 0:g.venueId}),{...Z,venue:Ne(g)}}var eB={};bt(eB,{JSON2CSV:()=>eMe,UUID:()=>Ht,UUIDS:()=>X9,allNumeric:()=>yK,attributeFilter:()=>Nm,chunkArray:()=>Cr,chunkByNth:()=>K1,chunkSizeProfile:()=>IK,constantToString:()=>tn,countValues:()=>cwe,createMap:()=>wK,dateTime:()=>K9,definedAttributes:()=>He,dehydrateMatchUps:()=>X1e,extractAttributes:()=>ZX,flattenJSON:()=>tB,generateDateRange:()=>Zf,generateHashCode:()=>Iwe,generateRange:()=>Te,generateTimeCode:()=>qte,groupValues:()=>gK,hasAttributeValues:()=>vwe,instanceCount:()=>Pa,intersection:()=>ji,isConvertableInteger:()=>st,isNumeric:()=>_i,isOdd:()=>hK,isPowerOf2:()=>Cs,makeDeepCopy:()=>Ne,matchUpScheduleSort:()=>K1e,matchUpSort:()=>Oh,nearestPowerOf2:()=>Lx,nextPowerOf2:()=>iv,noNulls:()=>uwe,noNumeric:()=>bK,numericSort:()=>lr,occurrences:()=>pwe,overlap:()=>Nn,randomMember:()=>Lo,randomPop:()=>ga,shuffleArray:()=>Tn,structureSort:()=>Th,subSort:()=>mwe,undefinedToNull:()=>X1,unique:()=>dt,visualizeScheduledMatchUps:()=>Y1e});function Y1e({scheduledMatchUps:t,showGlobalLog:e}){$0e();let i=t==null?void 0:t.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:o}=t.find(s=>s.structureId===n);return{[n]:`${a} ${o}`}})};i==null||i.forEach(n=>{var a;Oa({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let o=t.filter(l=>l.structureId===n),s=((a=An({matchUps:o}))==null?void 0:a.roundMatchUps)||[];Object.keys(s).forEach(l=>{Oa({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),s[l].forEach(({matchUpId:u,schedule:c})=>{let d=Ui(c.scheduledTime);Oa({matchUpId:u,time:d,date:c.scheduledDate,venue:c.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&_0e()}var{extractTime:oj,timeStringMinutes:sj}=K9;function K1e(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=sj(oj(i.scheduledTime)),a=sj(oj(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function X1e({tournamentRecord:t}){if(!t)return{error:ve};if(typeof t!="object"||!t.tournamentId)return{error:se};let{matchUps:e}=Gr({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=J1e({tournamentRecord:t});Q1e(e,i)}return{...Z}}function J1e({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var Z1e=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function Q1e(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,o=e[r]||e[n]||e[a],s=i.matchUpFormat===o?void 0:i.matchUpFormat;for(let l of Object.keys(i))Z1e.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function eMe(t,e){if(e&&typeof e!="object")return{error:se};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:m='"',columnJoiner:h=",",rowJoiner:f=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof h!="string"||typeof f!="string"||typeof g!="string"||typeof m!="string")return{error:se};i=Object.assign({},...Object.keys(i).reverse().map(A=>({[A]:Array.isArray(i[A])?i[A]:[typeof i[A]=="string"&&i[A]].filter(Boolean)})));let v=t.filter(Boolean).map(A=>tB(A,g)),y=Object.values(i).flat();r&&l.push(...y);let I=v.reduce((A,M)=>Object.keys(M).every(E=>!A.includes(E)&&A.push(E)||!0)&&A,[]).filter(A=>!(l!=null&&l.length)||l.includes(A)),b=Object.assign({},...Object.keys(i).reverse().map(A=>i[A].map(M=>({[M]:A})).flat()).flat()),S=(A,M)=>e!=null&&e.sortOrder?e.sortOrder.includes(A)&&e.sortOrder.includes(M)&&e.sortOrder.indexOf(A)-e.sortOrder.indexOf(M)||!e.sortOrder.includes(M)&&-1:0,w=I.reduce((A,M)=>{let E=b[M];return E?A.includes(E)||A.push(E):A.push(M),A},[]).sort(S);Object.keys(c).forEach(A=>!w.includes(A)&&w.unshift(A)),Object.keys(i).forEach(A=>!w.includes(A)&&w.unshift(A)),typeof p=="object"&&Object.keys(p).forEach(A=>!w.includes(A)&&w.unshift(A));let U=w.map(A=>c[A]||A);if(s)return[U];let T=A=>`${m}${A}${m}`,D=[],P=A=>Object.values(w.reduce((M,E,O)=>{var k;let x=i[E],F=(x!=null&&x.length?A[x.find(L=>A[L])]:A[E])||(p==null?void 0:p[E])||"",$=((k=d[E])==null?void 0:k[F])||F,_=ha(u[E])?u[E]($):$;return M[E]=T(_),_&&(D[O]=(D[O]||0)+1),M},{})),C=v.map(P),R=o&&[...D].map((A,M)=>!A&&M).filter(_i).reverse();if(R){let A=M=>M.filter((E,O)=>!R.includes(O));C=C.map(A),U=A(U)}let N=C.map(A=>A.join(h));return a?N.map(A=>{let M=A.split(h);return Object.assign({},...M.map((E,O)=>({[U[O]]:E})))}):n?[U.map(T).join(h),...N].join(f):N.join(f)}function tB(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,tB(t[n],e,i.concat(n))),{})}var{FACTORY:lj}=eX;function tMe({tournamentRecord:t,value:e}){let{extension:i}=vt({element:t,name:lj}),r={name:lj,value:{...i==null?void 0:i.value,...e}};_t({element:t,extension:r})}function fre({timeStamp:t}){let e=bh(),i=pF();return i&&Object.values(e).forEach(r=>{tMe({tournamentRecord:r,value:{version:QD(),timeStamp:t}})}),i}function gre({engineType:t,methodName:e,elapsed:i,params:r,result:n}){var a,o;let s=ja();if(typeof s!="object")return;let l={method:e},u=(n==null?void 0:n.error)&&(s.errors===!0||Array.isArray(s.errors)&&s.errors.includes(e)),c=Array.isArray(s.params)&&((a=s.params)==null?void 0:a.includes(e)),d=s.params&&!Array.isArray(s.params)||c,p=Array.isArray(s.exclude)&&s.exclude.includes(e);!p&&![void 0,!1].includes(s.perf)&&!isNaN(s.perf)&&i>=s.perf&&(l.elapsed=i),!p&&(u||d)&&(l.params=r),!p&&(u||s.result&&!Array.isArray(s.result)&&(!Array.isArray(s.params)||c)||Array.isArray(s.result)&&(o=s.result)!=null&&o.includes(e))&&(l.result=n),Object.keys(l).length>1&&V9(l,t)}function iB({methodName:t,params:e,start:i}){let r={error:mP,methodName:t},n=i?Date.now()-i:0;return gre({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function iMe(t,e){var i;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:ve};let r=e.drawId||((i=e.matchUp)==null?void 0:i.drawId);if(r){let{event:o,drawDefinition:s,tournamentId:l}=Kn({tournamentRecords:t,drawId:r});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),o&&(e.event=o)}if(e.eventId&&!e.event){let{event:o,tournamentId:s}=Kn({eventId:e.eventId,tournamentRecords:t});if(!o)return{error:mo};e.tournamentId=s,e.event=o}let n=e.tournamentId??yh();if(!n&&e)return e;let a=t[n];return n&&!a?{error:ve}:(a&&(e.tournamentRecord=a),e)}function rB(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),o=yh();i&&(i.activeTournamentId=o);let s=(i==null?void 0:i.tournamentRecord)||hF(o),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||bh(),u=i?Ne(i,void 0,!0):void 0,c=i?iMe(l,i):void 0;if(c!=null&&c.error)return c;let d=rMe({params:c,tournamentRecords:l,tournamentRecord:s,methodName:r,method:e}),p=Date.now()-a;return gre({result:d,methodName:r,elapsed:p,params:u,engineType:n}),d}function rMe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(ja())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return vP({engineName:"engine",methodName:r,params:i,err:a})}}function iC(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=So();for(let o of[...a].sort(nMe)){let s=_9({topic:o});s!=null&&s.length&&sM({topic:o,notices:s})}e&&n&&a.includes(hM)&&sM({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:hM})}var uj={[rL]:5,[iL]:5,[nL]:5,[tL]:5,[eL]:5,[ZF]:5,[gX]:5,[vX]:5,[QF]:1,[LP]:1,[on]:5,[Pp]:5,[JF]:4,[YF]:4,[KF]:4,[XF]:4,[FP]:3,[HF]:2};function nMe(t,e){return(uj[e]||0)-(uj[t]||0)}function aMe({convertExtensions:t,removeExtensions:e}){let i=bh();return{tournamentId:yh(),tournamentRecords:Ne(i,t,!1,e)}}function oMe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=(t==null?void 0:t.tournamentId)??yh();if(typeof r!="string")return{};let n=hF(r);return{tournamentRecord:Ne(n,e,!1,i)}}function sMe(){var t;let e=bh(),{extension:i}=vt({name:Jd,tournamentRecords:e,discover:!0}),r=((t=i==null?void 0:i.value)==null?void 0:t.tournamentIds)||[];return Object.keys(e).forEach(n=>{r.includes(n)||delete e[n]}),gP(e)}function cj(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Ju}:t!=null&&t.tournamentId?$9(e?Ne(t):t):{error:se}}function by(t,e=!0){if(typeof t!="object")return{error:Ju};if(XI(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:Q1};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},XI(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:Q1};return gP(e?Ne(t):t)}function lMe(t,e,i,r,n,a){let o=j9(i,r,n,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(l=>ha(s[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:s[l],...u});if(ja())return c();try{return c()}catch(d){vP({engineName:"engine",methodName:l,params:u,err:d})}}}),{...Z,...t}}function Qh(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function vre(t,e){t.importMethods=(i,r,n,a)=>lMe(t,e,i,r,n,a),t.getTournament=i=>oMe(i),t.getState=i=>aMe({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>QD(),t.reset=()=>(gP({}),Qh(t)),t.devContext=i=>(YI(i),Qh(t)),t.getDevContext=i=>ja(i),t.newTournamentRecord=(i={})=>{let r=JR(i),n=r.tournamentId;return r.error?r:(cj(r),XI(n),{...Z,tournamentId:n})},t.setState=(i,r,n)=>{KI(r,n);let a=by(i,r);return Qh(t,a)},t.setTournamentId=i=>XI(i),t.getTournamentId=()=>yh(),t.setTournamentRecord=(i,r,n)=>{KI(r,n);let a=cj(i,r);return Qh(t,a)},t.removeTournamentRecord=i=>{let r=B9(i);return Qh(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=sMe();return Qh(t,i)}}function uMe(t,e,i){if(!Array.isArray(e))return{error:se,message:"directives must be an array"};let r=L9(),n=Date.now(),a=i&&Ne(bh(),!1,!0),o=[];for(let u of e){if(typeof u!="object")return{error:se,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:se,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!r[c])return iB({methodName:c,start:n,params:p});if(d){let h=o[o.length-1],f=Object.keys(d);for(let g of f)h[g]&&(p[g]=h[g])}let m=rB(t,r[c],p,c,"sync");if(m!=null&&m.error)return a&&by(a),{...m,rolledBack:!!a};o.push({...m,methodName:c})}let s=Date.now(),l=fre({timeStamp:s});return iC({directives:e,mutationStatus:l,timeStamp:s}),Xb(),{success:o.every(u=>u.success),results:o}}function dj(t,e){if(!At(e))return{error:se,message:"args must be an object"};let i=Object.values(e).filter(ha).length;if(i>1)return{message:"there must be only one arg with typeof function",error:se};let r=i?Object.keys(e).find(m=>ha(e[m])):Di(e.method)&&e.method;if(!r)return{error:mP};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&Ne(bh(),!1,!0),l=n||t[r]||cF()[r];if(!l)return iB({methodName:r,params:o});let u=rB(t,l,o,r,"sync")??{};u!=null&&u.error&&s&&by(s);let c=Date.now(),d=fre({timeStamp:c}),p=(u==null?void 0:u.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&iC({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:c}),(p||!(u!=null&&u.success)||o!=null&&o.doNotNotify)&&Xb(),u}var cMe=(()=>{let t={executionQueue:(e,i)=>uMe(t,e,i),execute:e=>dj(t,e)};return vre(t,dj),t})(),nB=cMe;function pj(t,e){if(!At(e))return{error:se,message:"args must be an object"};let i=Object.values(e).filter(ha).length;if(i>1)return{message:"there must be only one arg with typeof function",error:se};let r=i?Object.keys(e).find(l=>ha(e[l])):Di(e.method)&&e.method;if(!r)return{error:mP};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=n||t[r]||cF()[r];return s?rB(t,s,o,r,"ask"):iB({methodName:r,params:o})}(()=>{let t={execute:e=>pj(t,e)};return vre(t,pj),t})();var pm={},hc;function mj(t,e=!0){if(!t)return{error:Je};if(typeof t!="object")return{error:Ju};if(t.matchUpId)hc=t.matchUpId,pm[hc]=e?Ne(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(pm[i.matchUpId]=e?Ne(i):i,hc||(hc=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(pm[i.matchUpId]=e?Ne(i):i,hc||(hc=i.matchUpId));return e?Ne(t):t}function dMe(){return pm[hc]}function pMe(){return Object.values(pm)}function mMe(){hc=void 0,pm={}}function hMe(t){return Ne(pm[hc],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}(()=>{let t={getState:n=>hMe(n),version:()=>QD(),reset:()=>(mMe(),{...Z}),drawId:void 0,error:void 0,success:!1,devContext:n=>(YI(n),t),setState:(n,a,o)=>{KI(a,o);let s=mj(n);return e(s)}};function e(n){return n!=null&&n.error?(t.error=n.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=n.drawId),t}return i([v_]),t;function i(n){n.forEach(a=>{Object.keys(a).forEach(o=>{t[o]=s=>{if(ja())return r({params:s,governor:a,methodName:o});try{return r({params:s,governor:a,methodName:o})}catch(l){vP({engineName:"matchUpEngine",methodName:o,params:s,err:l})}}})})}function r({params:n,governor:a,methodName:o}){t.error=void 0,t.success=!1;let s=(n==null?void 0:n.matchUp)||dMe(),l=(n==null?void 0:n.matchUps)||pMe(),u=(n==null?void 0:n.rollbackOnError)&&Ne(s,!1,!0);n={...n,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let c=a[o](n);if(c!=null&&c.error)return u&&mj(u),{...c,rolledBack:!!u};let d=(c==null?void 0:c.success)&&(n==null?void 0:n.delayNotify)!==!0&&(n==null?void 0:n.doNotNotify)!==!0;return d&&iC(),(d||!(c!=null&&c.success)||n!=null&&n.doNotNotify)&&Xb(),c}})();var QC=!1;(()=>{let t={version:()=>QD(),setDeepCopy:(r,n)=>(KI(r,n),t),devContext:r=>(YI(r),QC=!0,t)};return i([A$]),t;function e(r,n){let a=r({...n});return a!=null&&a.error||iC(),Xb(),QC&&(YI(!1),QC=!1),a}function i(r){r.forEach(n=>{Object.keys(n).forEach(a=>{t[a]=o=>{if(ja()){let s=e(n[a],o);return!(s!=null&&s.error)&&o!=null&&o.setState&&s!=null&&s.tournamentRecord&&by(s.tournamentRecord),s}else try{let s=e(n[a],o);return!(s!=null&&s.error)&&o!=null&&o.setState&&s!=null&&s.tournamentRecord&&by(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(o),method:a,error:l})}}})})}})();nB.importMethods(cK,!0,1);var Ire=nB,fMe={getTournamentPoints:SR},gMe=fMe,vMe={calculateNewRatings:zZ,generateDynamicRatings:WZ},IMe=vMe,yMe={...gMe,...IMe};nB.importMethods(yMe);var bMe={[ay]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},wMe={[Ou]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[lm,aI]}},UMe={[Ou]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[lm,py,Fm],disabledActions:[]}]}},SMe={[Ou]:{policyName:"positionActionsDisabled",enabledStructures:!1}},TMe={[hv]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},DMe={[fo]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:Ho,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[Ae]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[ua]:[],[yl]:[],[Pt]:[],[Ea]:[],[Hr]:[],[Ft]:[]}}},eE="Personal circumstance",PMe={[fo]:{requireAllPositionsAssigned:!1,stage:{[Ae]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Ho,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Ho,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[ua]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[yl]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[Ea]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[Pt]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[Ft]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:eE,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[Hr]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:eE,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[Yl]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:eE,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},RMe={[Ao]:{seedingProfile:{positioning:wP},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},CMe={POLICY_AVOIDANCE_COUNTRY:bMe,POLICY_POSITION_ACTIONS_DEFAULT:RZ,POLICY_POSITION_ACTIONS_DISABLED:SMe,POLICY_POSITION_ACTIONS_NO_MOVEMENT:UMe,POLICY_POSITION_ACTIONS_UNRESTRICTED:wMe,POLICY_PRIVACY_DEFAULT:TMe,POLICY_ROUND_NAMING_DEFAULT:hL,POLICY_SCHEDULING_DEFAULT:cee,POLICY_SCORING_DEFAULT:DMe,POLICY_SCORING_USTA:PMe,POLICY_SEEDING_ITF:RMe,POLICY_SEEDING_DEFAULT:WQ},EMe={ratingsParameters:Sr,matchUpFormats:xUe,countryToFlag:TX,tieFormats:Dee,countries:yc,policies:CMe,flagIOC:kSe},MMe={};bt(MMe,{activeMatchUpStatuses:()=>GF,auditConstants:()=>NCe,completedMatchUpStatuses:()=>Ir,directingMatchUpStatuses:()=>cX,displayConstants:()=>sCe,drawDefinitionConstants:()=>B8,entryStatusConstants:()=>GSe,errorConditionConstants:()=>xwe,eventConstants:()=>VUe,extensionConstants:()=>eX,flightConstants:()=>KCe,genderConstants:()=>fF,keyValueConstants:()=>OPe,matchUpActionConstants:()=>zDe,matchUpStatusConstants:()=>mX,matchUpTypes:()=>awe,nonDirectingMatchUpStatuses:()=>dX,particicipantsRequiredMatchUpStatuses:()=>lX,participantConstants:()=>OSe,participantRoles:()=>PL,participantTypes:()=>tI,penaltyConstants:()=>YMe,policyConstants:()=>gSe,positionActionConstants:()=>nDe,ratingConstants:()=>yDe,recoveryTimeRequiredMatchUpStatuses:()=>CSe,requestConstants:()=>LEe,resourceContants:()=>CUe,resultConstants:()=>ywe,scaleConstants:()=>pSe,scheduleConstants:()=>f0e,sortingConstants:()=>rEe,surfaceConstants:()=>eNe,tieFormatConstants:()=>FUe,timeItemConstants:()=>p0e,topicConstants:()=>MSe,tournamentConstants:()=>Kie,upcomingMatchUpStatuses:()=>pX,validMatchUpStatuses:()=>uX,venueConstants:()=>rNe,weekdayConstants:()=>Nee});var NMe="Coaching",AMe="Ball Abuse",OMe="Racket Abuse",kMe="Verbal Abuse",xMe="INELIGIBILITY",FMe="Physical Abuse",LMe="Unsportmanlike Conduct",_Me="Dress Code Violation",$Me="Equipment Violation",BMe="Leaving the court",VMe="Failure to complete",jMe="No Show",GMe="Other",HMe="REFUSAL_TO_PLAY",zMe="PROHIBITED_SUBSTANCE",WMe="Puncuality",qMe="Failure to sign in",YMe={COACHING:NMe,BALL_ABUSE:AMe,RACKET_ABUSE:OMe,VERBAL_ABUSE:kMe,PHYSICAL_ABUSE:FMe,INELIGIBILITY:xMe,UNSPORTSMANLIKE_CONDUCT:LMe,PROHIBITED_SUBSTANCE:zMe,DRESS_CODE_VIOLATION:_Me,EQUIMENT_VIOLATION:$Me,LEAVING_THE_COURT:BMe,REFUSAL_TO_PLAY:HMe,FAILURE_TO_COMPLETE:VMe,NO_SHOW:jMe,OTHER:GMe,PUNCTUALITY:WMe,FAILUIRE_TO_SIGN_IN:qMe},KMe="CLAY",XMe="HARD",JMe="GRASS",ZMe="CARPET",QMe="ARTIFICIAL",eNe={CLAY:KMe,HARD:XMe,GRASS:JMe,CARPET:ZMe,ARTIFICIAL:QMe},tNe="INDOOR",iNe="OUTDOOR",rNe={INDOOR:tNe,OUTDOOR:iNe};const nNe=Yt({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function aNe({matchUp:t,individualParticipant:e,spacer:i}){var r,n,a;const o=((r=e==null?void 0:e.person)==null?void 0:r.iso2NationalityCode)||"",s=o?(n=EMe.countryToFlag(o))==null?void 0:n.slice(0,4):"",l=document.createElement("span"),u=(a=t==null?void 0:t.matchUpType)==null?void 0:a.toLowerCase();return i||(l.className=nNe({variant:u})),l.innerHTML=i?"":s,l}function tE({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n,side:a,type:o}){if(o==="scale")return rwe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n});const s=(e==null?void 0:e.configuration)||{},l=document.createElement("div");return o==="flag"&&s.flags&&aNe({className:i,matchUp:r,individualParticipant:t,spacer:n})||o==="seeding"&&twe({className:i,composition:e,matchUp:r,side:a})||l}const oNe="Qualifier",sNe="BYE",lNe="TBD";function hj(t){var e,i,r,n;const{isWinningSide:a,side:o,sideNumber:s,individualParticipant:l,matchUp:u,composition:c}=t||{},d=a?"winner":void 0,p=t.eventHandlers||{},m=c==null?void 0:c.configuration,h={QUALIFIER:((e=m==null?void 0:m.placeHolders)==null?void 0:e.qualifier)||oNe,BYE:((i=m==null?void 0:m.placeHolders)==null?void 0:i.bye)||sNe,TBD:((r=m==null?void 0:m.placeHolders)==null?void 0:r.tbd)||lNe},f=l==null?void 0:l.participantName,g=U=>{vs(p==null?void 0:p.participantClick)&&(U.stopPropagation(),p.participantClick({individualParticipant:l,pointerEvent:U,matchUp:u,side:o}))},v=document.createElement("div");v.classList.add("tmx-i"),v.setAttribute("sideNumber",s),v.setAttribute("id",l==null?void 0:l.participantId),v.onclick=g;const y=document.createElement("div");y.className=xbe({variant:d});const I=(m==null?void 0:m.flags)&&tE({...t,type:"flag"});if(I)y.appendChild(I);else{const U=tE({type:"scale",...t});U&&y.appendChild(U)}const b=document.createElement("div");if(b.className=Fbe({variant:d}),f){const U=document.createElement("span");if(a&&m!=null&&m.winnerColor)U.style.color=typeof m.winnerColor=="string"?m.winnerColor:"green";else if(m!=null&&m.genderColor){const T=(n=l==null?void 0:l.person)==null?void 0:n.sex,D=T==="MALE"&&"#2E86C1"||T==="FEMALE"&&"#AA336A"||"";U.style.color=typeof m.genderColor=="string"?m.genderColor:D}U.innerHTML=f,b.appendChild(U)}else{const U=document.createElement("abbr");U.className=kbe({variant:m.showAddress?"showAddress":""}),U.innerHTML=(o==null?void 0:o.bye)&&h.BYE||(o==null?void 0:o.qualifier)&&h.QUALIFIER||h.TBD,b.appendChild(U)}const S=tE({...t,className:ewe(),type:"seeding"});S&&b.appendChild(S),y.appendChild(b),v.appendChild(y);const w=Qbe(t);return v.appendChild(w),{element:v}}const uNe=Yt({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{defaulted:{backgroundColor:"#df164c"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}});function cNe({matchUpStatus:t}){const e=t==null?void 0:t.toLowerCase(),i=["WALKOVER","DOUBLE_WALKOVER"].includes(t)?"WO":(t==null?void 0:t.slice(0,3))||"",r=document.createElement("div");r.className=uNe({variant:e});const n=document.createElement("abbr");return n.setAttribute("title",t),n.style.textDecoration="none",n.style.borderBottom="none",n.innerHTML=i,r.appendChild(n),r}function dNe(t){return t instanceof Element||t}const pNe=Yt({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});function mNe({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=pNe(),e}const hNe=Yt({flexDirection:"column",position:"relative",display:"flex"}),fNe=Yt({alignItems:"stretch",display:"flex"}),gNe=Yt({marginInlineEnd:".25rem",color:"green"});function vNe({dim:t="20px"}={}){const e=gNe();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}function yre({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:r,participant:n,placeholder:a,sideNumber:o,matchUp:s}){var l,u,c;const{winningSide:d,matchUpType:p,isRoundRobin:m,matchUpStatus:h}=s||{},f=r==null?void 0:r.configuration;let g;const v=o?(l=s==null?void 0:s.sides)==null?void 0:l.find(A=>A.sideNumber===o):void 0;n||(n=v==null?void 0:v.participant,g=f!=null&&f.allDrawPositions||f!=null&&f.drawPositions&&v!=null&&v.drawPosition&&((s==null?void 0:s.roundNumber)===t||v!=null&&v.participantFed||m)?v==null?void 0:v.drawPosition:"");const y=p==="DOUBLES",I=y?(u=n==null?void 0:n.individualParticipants)==null?void 0:u[0]:n,b=y&&((c=n==null?void 0:n.individualParticipants)==null?void 0:c[1]),S=o===d||h==="BYE"&&n,w=(f==null?void 0:f.winnerChevron)&&S,U=f==null?void 0:f.teamLogo,T=["RETIRED","DOUBLE_WALKOVER","WALKOVER","DEFAULTED"].includes(h)&&!S,D=f==null?void 0:f.gameScoreOnly,P=document.createElement("div");if(P.className=i&&_be({drawPosition:g,sideNumber:o}),P.classList.add("tmx-p"),P.setAttribute("id",n==null?void 0:n.participantId),U){const A=mNe({teamLogo:U});P.appendChild(A)}const C=document.createElement("div");C.className=Lbe({variant:y?"doubles":"singles"});const R=document.createElement("div");R.className=$be({winnerChevron:w,isDoubles:y});const N=hj({individualParticipant:I,eventHandlers:e,isWinningSide:S,composition:r,sideNumber:o,matchUp:s,side:v}).element;if(R.appendChild(N),b){const A=hj({individualParticipant:b,eventHandlers:e,isWinningSide:S,composition:r,sideNumber:o,matchUp:s,side:v}).element;R.appendChild(A)}else y&&a&&dNe(a)&&R.appendChild(a);if(C.appendChild(R),P.appendChild(C),i){const A=document.createElement("div");if(S&&!D){const M=vNe();typeof M=="string"?A.innerHTML=M:A.appendChild(M)}else if(T){const M=cNe({matchUpStatus:h});A.appendChild(M)}P.appendChild(A)}return P}const INe=Yt({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",height:"1.5em"});function yNe({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:r,context:n}){var a;const o=document.createElement("div");o.className=INe(),o.classList.add("tmx-rh"),o.setAttribute("roundNumber",r);const s=vs(t==null?void 0:t.roundHeaderClick);s&&(o.onclick=d=>t.roundHeaderClick({roundNumber:r,roundProfile:i,roundMatchUps:e,context:n,pointerEvent:d}));const l=s?"⋮":"",u=(a=i==null?void 0:i[r])==null?void 0:a.roundName,c=u&&` <div style="display: flex; flex-direction: row; justify-content: space-between">
        <div>${u}</div>
        <div style="font-weight: bold">${l}</div>
      </div>
  `;return o.innerHTML=c||"",o}const bre=Yt({flexDirection:"column",display:"flex"}),bNe=Yt({flexDirection:"row",display:"flex"}),wre=Yt({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),wNe=Yt({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),UNe=Yt({fontWeight:"bold",color:"blue",height:"1em"}),fj=Yt({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),SNe=Yt({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});function TNe(){return Yt({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0})}const DNe=Yt({});function PNe({configuration:t}){const e={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(t!=null&&t.matchUpHover){const i=typeof t.matchUpHover=="string"?t.matchUpHover:"cyan";e["&:hover"]={backgroundColor:i}}else e["&:hover"]={borderColor:"$borderHover"};return Yt(e)}function RNe({variant:t}){return Yt({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:t})}const CNe=Yt({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),ENe=Yt({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),gj=Yt({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function MNe({eventHandlers:t,entryStatus:e,sideNumber:i,className:r,matchUp:n}){const a=document.createElement("div");vs(t==null?void 0:t.centerInfoClick)&&(a.onclick=c=>t.centerInfoClick({matchUp:n,sideNumber:i,pointerEvent:c})),a.className=bp(RNe({variant:i}),r),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",i);const o=document.createElement("div");o.className=CNe();const s=document.createElement("div");s.className=ENe();const l=document.createElement("div");l.className=gj(),l.innerHTML=e?"Entry status:&nbsp;":"",s.appendChild(l);const u=document.createElement("div");return u.className=gj(),u.innerHTML=e||"",s.appendChild(u),o.appendChild(s),a.appendChild(o),{element:a}}const sI={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};function NNe({composition:t,isDoubles:e,roundFactor:i=1}){const r=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),n=(t==null?void 0:t.configuration)||{},a=(n==null?void 0:n.connectorWidth)||16,o=n.centerInfo?sI.centerInfo*r:0,s=n.scheduleInfo?sI.scheduleInfo*r:0,l=(60+(n.showAddress?r:0))*(e?1.3:1)+o,u=l*i,c=(l+s)*i;return Yt({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:u,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:c}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}const Ure=t=>Yt({display:"flex",alignItems:"center",height:t,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),ANe=Yt({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),Sre=Yt({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),ONe=Yt({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function kNe({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=Sre(),e.value=t,e}function xNe({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:r}){const n=r===(i==null?void 0:i.winningSide)||i!=null&&i.winningSide?"loser":void 0,a=r===2?i.side2Score:i.side1Score,o=i.side2TiebreakScore||i.side1TiebreakScore,s=r===2?i.side2TiebreakScore:i.side1TiebreakScore,l=a===void 0&&s,u=l||a,c=e&&i.setNumber%2?"lightgray":"transparent",d=i.editing?i.editing===r:void 0;let p;if(d)p=kNe({value:u});else if(p=document.createElement("p"),p.className=Sre({variant:n}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=c,p.innerHTML=isNaN(u)?"":u,!t){const m=document.createElement("span");m.className=ANe(),m.innerHTML=o&&!l?s:"",p.appendChild(m)}return p}function FNe({participantHeight:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:n}){var a,o,s,l;const u=(a=i==null?void 0:i.configuration)==null?void 0:a.winnerChevron,c=(o=i==null?void 0:i.configuration)==null?void 0:o.gameScoreOnly,d=((s=n==null?void 0:n.score)==null?void 0:s.sets)||[],p=(l=i==null?void 0:i.configuration)==null?void 0:l.scoreBox,m=r===2?t:t-1,h=Ure(m),f=y=>{vs(e==null?void 0:e.scoreClick)&&(y.stopPropagation(),e.scoreClick({pointerEvent:y,matchUp:n}))},g=document.createElement("div");g.className=h({sideNumber:!p&&r,fontSize:"5px"}),g.classList.add("sideScore"),g.classList.add("tmx-scr"),g.onclick=f;const v=document.createElement("div");v.className=ONe();for(const y of d||[]){const I=xNe({gameScoreOnly:c,scoreStripes:u,sideNumber:r,set:y});v.appendChild(I)}return g.appendChild(v),g}const LNe=Yt({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var Tre={exports:{}};(function(t,e){(function(i,r){t.exports=r()})(Bbe,function(){var i=1e3,r=6e4,n=36e5,a="millisecond",o="second",s="minute",l="hour",u="day",c="week",d="month",p="quarter",m="year",h="date",f="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(A){var M=["th","st","nd","rd"],E=A%100;return"["+A+(M[(E-20)%10]||M[E]||M[0])+"]"}},I=function(A,M,E){var O=String(A);return!O||O.length>=M?A:""+Array(M+1-O.length).join(E)+A},b={s:I,z:function(A){var M=-A.utcOffset(),E=Math.abs(M),O=Math.floor(E/60),k=E%60;return(M<=0?"+":"-")+I(O,2,"0")+":"+I(k,2,"0")},m:function A(M,E){if(M.date()<E.date())return-A(E,M);var O=12*(E.year()-M.year())+(E.month()-M.month()),k=M.clone().add(O,d),x=E-k<0,F=M.clone().add(O+(x?-1:1),d);return+(-(O+(E-k)/(x?k-F:F-k))||0)},a:function(A){return A<0?Math.ceil(A)||0:Math.floor(A)},p:function(A){return{M:d,y:m,w:c,d:u,D:h,h:l,m:s,s:o,ms:a,Q:p}[A]||String(A||"").toLowerCase().replace(/s$/,"")},u:function(A){return A===void 0}},S="en",w={};w[S]=y;var U="$isDayjsObject",T=function(A){return A instanceof R||!(!A||!A[U])},D=function A(M,E,O){var k;if(!M)return S;if(typeof M=="string"){var x=M.toLowerCase();w[x]&&(k=x),E&&(w[x]=E,k=x);var F=M.split("-");if(!k&&F.length>1)return A(F[0])}else{var $=M.name;w[$]=M,k=$}return!O&&k&&(S=k),k||!O&&S},P=function(A,M){if(T(A))return A.clone();var E=typeof M=="object"?M:{};return E.date=A,E.args=arguments,new R(E)},C=b;C.l=D,C.i=T,C.w=function(A,M){return P(A,{locale:M.$L,utc:M.$u,x:M.$x,$offset:M.$offset})};var R=function(){function A(E){this.$L=D(E.locale,null,!0),this.parse(E),this.$x=this.$x||E.x||{},this[U]=!0}var M=A.prototype;return M.parse=function(E){this.$d=function(O){var k=O.date,x=O.utc;if(k===null)return new Date(NaN);if(C.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var F=k.match(g);if(F){var $=F[2]-1||0,_=(F[7]||"0").substring(0,3);return x?new Date(Date.UTC(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)):new Date(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)}}return new Date(k)}(E),this.init()},M.init=function(){var E=this.$d;this.$y=E.getFullYear(),this.$M=E.getMonth(),this.$D=E.getDate(),this.$W=E.getDay(),this.$H=E.getHours(),this.$m=E.getMinutes(),this.$s=E.getSeconds(),this.$ms=E.getMilliseconds()},M.$utils=function(){return C},M.isValid=function(){return this.$d.toString()!==f},M.isSame=function(E,O){var k=P(E);return this.startOf(O)<=k&&k<=this.endOf(O)},M.isAfter=function(E,O){return P(E)<this.startOf(O)},M.isBefore=function(E,O){return this.endOf(O)<P(E)},M.$g=function(E,O,k){return C.u(E)?this[O]:this.set(k,E)},M.unix=function(){return Math.floor(this.valueOf()/1e3)},M.valueOf=function(){return this.$d.getTime()},M.startOf=function(E,O){var k=this,x=!!C.u(O)||O,F=C.p(E),$=function(q,W){var Y=C.w(k.$u?Date.UTC(k.$y,W,q):new Date(k.$y,W,q),k);return x?Y:Y.endOf(u)},_=function(q,W){return C.w(k.toDate()[q].apply(k.toDate("s"),(x?[0,0,0,0]:[23,59,59,999]).slice(W)),k)},L=this.$W,B=this.$M,V=this.$D,G="set"+(this.$u?"UTC":"");switch(F){case m:return x?$(1,0):$(31,11);case d:return x?$(1,B):$(0,B+1);case c:var j=this.$locale().weekStart||0,z=(L<j?L+7:L)-j;return $(x?V-z:V+(6-z),B);case u:case h:return _(G+"Hours",0);case l:return _(G+"Minutes",1);case s:return _(G+"Seconds",2);case o:return _(G+"Milliseconds",3);default:return this.clone()}},M.endOf=function(E){return this.startOf(E,!1)},M.$set=function(E,O){var k,x=C.p(E),F="set"+(this.$u?"UTC":""),$=(k={},k[u]=F+"Date",k[h]=F+"Date",k[d]=F+"Month",k[m]=F+"FullYear",k[l]=F+"Hours",k[s]=F+"Minutes",k[o]=F+"Seconds",k[a]=F+"Milliseconds",k)[x],_=x===u?this.$D+(O-this.$W):O;if(x===d||x===m){var L=this.clone().set(h,1);L.$d[$](_),L.init(),this.$d=L.set(h,Math.min(this.$D,L.daysInMonth())).$d}else $&&this.$d[$](_);return this.init(),this},M.set=function(E,O){return this.clone().$set(E,O)},M.get=function(E){return this[C.p(E)]()},M.add=function(E,O){var k,x=this;E=Number(E);var F=C.p(O),$=function(B){var V=P(x);return C.w(V.date(V.date()+Math.round(B*E)),x)};if(F===d)return this.set(d,this.$M+E);if(F===m)return this.set(m,this.$y+E);if(F===u)return $(1);if(F===c)return $(7);var _=(k={},k[s]=r,k[l]=n,k[o]=i,k)[F]||1,L=this.$d.getTime()+E*_;return C.w(L,this)},M.subtract=function(E,O){return this.add(-1*E,O)},M.format=function(E){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||f;var x=E||"YYYY-MM-DDTHH:mm:ssZ",F=C.z(this),$=this.$H,_=this.$m,L=this.$M,B=k.weekdays,V=k.months,G=k.meridiem,j=function(W,Y,re,K){return W&&(W[Y]||W(O,x))||re[Y].slice(0,K)},z=function(W){return C.s($%12||12,W,"0")},q=G||function(W,Y,re){var K=W<12?"AM":"PM";return re?K.toLowerCase():K};return x.replace(v,function(W,Y){return Y||function(re){switch(re){case"YY":return String(O.$y).slice(-2);case"YYYY":return C.s(O.$y,4,"0");case"M":return L+1;case"MM":return C.s(L+1,2,"0");case"MMM":return j(k.monthsShort,L,V,3);case"MMMM":return j(V,L);case"D":return O.$D;case"DD":return C.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return j(k.weekdaysMin,O.$W,B,2);case"ddd":return j(k.weekdaysShort,O.$W,B,3);case"dddd":return B[O.$W];case"H":return String($);case"HH":return C.s($,2,"0");case"h":return z(1);case"hh":return z(2);case"a":return q($,_,!0);case"A":return q($,_,!1);case"m":return String(_);case"mm":return C.s(_,2,"0");case"s":return String(O.$s);case"ss":return C.s(O.$s,2,"0");case"SSS":return C.s(O.$ms,3,"0");case"Z":return F}return null}(W)||F.replace(":","")})},M.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},M.diff=function(E,O,k){var x,F=this,$=C.p(O),_=P(E),L=(_.utcOffset()-this.utcOffset())*r,B=this-_,V=function(){return C.m(F,_)};switch($){case m:x=V()/12;break;case d:x=V();break;case p:x=V()/3;break;case c:x=(B-L)/6048e5;break;case u:x=(B-L)/864e5;break;case l:x=B/n;break;case s:x=B/r;break;case o:x=B/i;break;default:x=B}return k?x:C.a(x)},M.daysInMonth=function(){return this.endOf(d).$D},M.$locale=function(){return w[this.$L]},M.locale=function(E,O){if(!E)return this.$L;var k=this.clone(),x=D(E,O,!0);return x&&(k.$L=x),k},M.clone=function(){return C.w(this.$d,this)},M.toDate=function(){return new Date(this.valueOf())},M.toJSON=function(){return this.isValid()?this.toISOString():null},M.toISOString=function(){return this.$d.toISOString()},M.toString=function(){return this.$d.toUTCString()},A}(),N=R.prototype;return P.prototype=N,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",u],["$M",d],["$y",m],["$D",h]].forEach(function(A){N[A[1]]=function(M){return this.$g(M,A[0],A[1])}}),P.extend=function(A,M){return A.$i||(A(M,R,P),A.$i=!0),P},P.locale=D,P.isDayjs=T,P.unix=function(A){return P(1e3*A)},P.en=w[S],P.Ls=w,P.p={},P})})(Tre);var _Ne=Tre.exports;const $Ne=lK(_Ne);function BNe({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:r,venueAbbreviation:n,courtName:a}=(t==null?void 0:t.schedule)||{},{dateTime:{extractDate:o,extractTime:s}}=eB,l=s(i);let u=o(r),c="ddd D MMMM";l&&(c+=", hh:mm A",u+=`T${l}`);const d=r?$Ne(u).format(c):"Not scheduled",p=n&&(a==null?void 0:a.toString().startsWith(n))&&a||n&&a&&`${n} ${a}`||a||n||"",m=document.createElement("div");m.className=LNe(),m.classList.add("tmx-sch"),vs(e==null?void 0:e.scheduleClick)&&(m.onclick=y=>e.scheduleClick({matchUp:t,pointerEvent:y}));const h=document.createElement("div");h.innerHTML=d,m.append(h);const f=y=>{vs(e==null?void 0:e.venueClick)&&(y.stopPropagation(),e.venueClick({pointerEvent:y,matchUp:t}))},g=document.createElement("div");g.style="display: flex; flex-direction: row";const v=document.createElement("div");if(v.style.paddingRight=".2rem",v.onclick=f,v.innerHTML=p,g.append(v),m.append(g),m.onclick){const y=document.createElement("div");y.innerHTML="⋮",g.append(y)}return m}function vj({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:r,className:n,matchUp:a}){var o,s;const l=(i==null?void 0:i.configuration)||{},u=l==null?void 0:l.scheduleInfo,c=(o=a==null?void 0:a.score)==null?void 0:o.scoreStringSide1,d=((s=i==null?void 0:i.configuration)==null?void 0:s.scoreBox)&&c,p=(a==null?void 0:a.readyToScore)&&(e==null?void 0:e.scoreClick)&&!Ire.checkScoreHasValue({matchUp:a}),m=document.createElement("div");if(m.className=bp(hNe(),n),m.classList.add("tmx-sd"),m.setAttribute("sideNumber",r),u&&r===1){const g=BNe({matchUp:a,eventHandlers:e});m.appendChild(g)}const h=document.createElement("div");h.className=fNe();const f=yre({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:a});if(h.appendChild(f),d){const g=document.createElement("div");g.style.border="1px solid lightgray",h.appendChild(g)}if(c){const g=FNe({eventHandlers:e,composition:i,sideNumber:r,matchUp:a});h.appendChild(g)}if(p){const g=Ure(),v=I=>{vs(e==null?void 0:e.scoreClick)&&(event.stopPropagation(),e.scoreClick({pointerEvent:I,matchUp:a}))},y=document.createElement("div");y.className=g({sideNumber:!d&&r,fontSize:"small"}),y.onclick=v,y.innerHTML="[Score]",h.appendChild(y)}return m.appendChild(h),m}function VNe(t){const{composition:e,initialRoundNumber:i=1,matchUp:r,moiety:n,selectedMatchUpId:a,searchActive:o}=t,{roundFactor:s,roundNumber:l,finishingRound:u,matchUpType:c,preFeedRound:d,stage:p}=r,m=t.isFinalRound||parseInt(u)===1,h=p==="QUALIFYING"&&m,f=m,g=parseInt(l)===i,v=c==="DOUBLES",y=(o||r.isRoundRobin||r.collectionId||t.isLucky||t.isAdHoc)&&"mr"||f&&"noProgression"||(h||d)&&"m0"||n&&"m1"||"m2",I=NNe({composition:e,isDoubles:v,roundFactor:s})({isFirstRound:g,link:y}),b=(e==null?void 0:e.configuration)||{},{resultsInfo:S,centerInfo:w}=b||{},U=t.eventHandlers||{},T=A=>{vs(U==null?void 0:U.matchUpClick)&&U.matchUpClick({pointerEvent:A,matchUp:r})},D=document.createElement("div");D.className=bp(e.theme,t==null?void 0:t.className,"matchup",DNe()),D.classList.add("tmx-m"),D.setAttribute("id",r==null?void 0:r.matchUpId),D.onclick=T;const P=document.createElement("div");P.className=PNe({configuration:b});const C=({sideNumber:A})=>{var M,E,O;const k=(O=(E=(M=r==null?void 0:r.sides.find(x=>x.sideNumber===A))==null?void 0:M.participant)==null?void 0:E.entryStatus)==null?void 0:O.replace("_"," ");return MNe({eventHandlers:U,entryStatus:k,sideNumber:A,className:A===2&&I,matchUp:r})},R=vj({initialRoundNumber:i,eventHandlers:U,sideNumber:1,composition:e,matchUp:r}),N=vj({className:!w&&I,initialRoundNumber:i,eventHandlers:U,sideNumber:2,composition:e,matchUp:r});if(P.appendChild(R),w){const A=C({sideNumber:1}),M=C({sideNumber:2});P.appendChild(A.element),P.appendChild(M.element)}if(P.appendChild(N),S){const A=jNe({score:r.score});P.appendChild(A)}if(D.appendChild(P),a===r.matchUpId){const A=document.createElement("div");A.className=TNe(),D.appendChild(A)}return D}function jNe({score:t}){var e;const i=(e=t==null?void 0:t.sets)==null?void 0:e.filter(Boolean).sort((o,s)=>(o.setNumber||0)-(s.setNumber||0)),r=i==null?void 0:i[i.length-1],n=(r==null?void 0:r.side1PointsScore)||(r==null?void 0:r.side2PointsScore),a=document.createElement("div");if(a.className=SNe(),n){const o=document.createElement("div");o.className=fj({variant:"points"}),o.innerHTML="PTS",a.appendChild(o)}for(const o of i||[]){const s=document.createElement("div");s.setAttribute("key",o.setNumber),s.className=fj({variant:"set"}),s.innerHTML=o.setNumber,a.appendChild(s)}return a}function GNe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,isRoundRobin:n,searchActive:a,composition:o,roundFactor:s,roundNumber:l,roundProfile:u,minWidth:c,matchUps:d,context:p,isLucky:m}){const h=d.filter(P=>P.roundNumber===l).sort((P,C)=>(P.roundPosition||0)-(C.roundPosition||0)),f=h.every(({roundPosition:P,drawPositions:C})=>!P&&!C),g=(o==null?void 0:o.configuration)||{},v=document.createElement("div");if(v.className=bre(),v.classList.add("tmx-rd"),v.setAttribute("roundNumber",l),g.roundHeader){const P=yNe({roundProfile:u,roundMatchUps:h,roundNumber:l,eventHandlers:i,context:p});v.appendChild(P)}const y=document.createElement("div");y.className=wre({variant:f?"adHoc":void 0}),c&&(y.style.minWidth=c);let I,b,S;if(n){const P=R=>R.reduce((N,A)=>A+N,0);h.sort((R,N)=>{const A=P(R.drawPositions)-P(N.drawPositions),M=Math.min(...R.drawPositions??[])-Math.min(...N.drawPositions??[]);return A||M});const C=h.reduce((R,N)=>(R[N.structureId]=N.structureName,R),{});I=Object.values(C),b=Object.keys(C),S=Object.keys(eB.instanceCount(h.map(({structureId:R})=>R))).length}else f&&h.sort((P,C)=>(P.roundOrder??0)-(C.roundOrder??0));const w=S&&h.length/S,U=Object.keys(u).map(P=>parseInt(P)),T=U.indexOf(l),D=T===0&&"first"||T===U.length-1&&"last";return h.forEach((P,C)=>{const R=w&&!(C%w),N=w&&Math.floor(C/w),A=w&&I[N];if(R){const O=document.createElement("div");O.className=wNe({variant:N,roundOrder:D}),y.appendChild(O);const k=document.createElement("div");if(k.className=UNe(),vs(i==null?void 0:i.groupHeaderClick)){const{drawId:x,containerStructureId:F}=h[0];y.onclick=$=>i.groupHeaderClick({structureId:b[N],containerStructureId:F,pointerEvent:$,drawId:x})}l===t&&(k.innerHTML=A),y.appendChild(k)}const M=C%2===0;s?P.roundFactor=s:t>1&&(P.roundFactor=Math.pow(2,l-t));const E=VNe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,searchActive:a,composition:o,isAdHoc:f,isLucky:m,matchUp:P,moiety:M});y.appendChild(E)}),v.appendChild(y),v}function HNe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:r,composition:n,structureId:a,finalColumn:o,matchUps:s,minWidth:l,context:u}){var c;const{roundNumbers:d,roundProfile:p,hasOddMatchUpsCount:m,isNotEliminationStructure:h}=Ire.getRoundMatchUps({matchUps:s});a=a||(u==null?void 0:u.structureId)||((c=s==null?void 0:s[0])==null?void 0:c.structureId);const f=s.some(({isRoundRobin:I})=>I),g=m||h,v=document.createElement("div");v.className=bNe(),v.classList.add("tmx-str"),v.setAttribute("id",a);const y=Math.max(...d);for(const I of d){if(I<t)continue;const b=GNe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:I===y,isRoundRobin:f,searchActive:r,composition:n,roundNumber:I,roundProfile:p,matchUps:s,minWidth:l,context:u,isLucky:g});v.appendChild(b)}if(o){const I=document.createElement("div");I.className=bre();const b=document.createElement("div");b.className=wre(),b.appendChild(o),I.appendChild(b),v.appendChild(I)}return v}const Ij=Yt({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});function zNe({content:t,theme:e}){const i=document.createElement("div");return i.className=e?bp(Ij(),e):Ij(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}const{createTheme:Gh}=sK({theme:{lineHeights:{scheduleInfo:`${sI.scheduleInfo}rem`,centerInfo:`${sI.centerInfo}rem`,gameScore:`${sI.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),yj=Gh("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),WNe=Gh("wimbledon-theme",{borderWidths:{borderInlineStart:"10px"},colors:{connector:"transparent",borderHover:"darkgrey",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),qNe=Gh("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),YNe=Gh("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),bj=Gh("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),KNe=Gh("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),XNe=Gh("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}}),JNe={Australian:{configuration:{flags:!0},theme:yj},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:bj},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:bj},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:qNe},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:WNe},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:YNe},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:XNe},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:yj},Night:{configuration:{flags:!0},theme:KNe}},{MALE:ZNe,FEMALE:QNe}=iT,{PAIR:eAe}=pW,tAe="utr",iAe={utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},Dre=t=>(e,i,r)=>{var d;const n=e.getColumn().getDefinition(),a=n.field==="side1"&&1||n.field==="side2"&&2,o=document.createElement("div"),s=e.getRow().getData(),l=s.winningSide,u=e.getValue(),c=s.participant||u.participant||s.person&&s;if(c){const p=iAe[tAe],m=f=>yre({eventHandlers:{participantClick:g=>ou(t)&&t({...g,event:g.pointerEvent,cell:e})},composition:{configuration:{participantDetail:"TEAM",winnerColor:!0,genderColor:!0,scaleAttributes:p,flag:!1}},matchUp:s.matchUp,participant:f,placeholder:i,sideNumber:a}),h=f=>{const g=document.createElement("div");return g.className="flexrow flexjustifystart",f.individualParticipants.forEach((v,y)=>{if(g.appendChild(m(v)),!y){const I=document.createElement("span");I.style.width="1em",I.innerHTML="&nbsp;",g.appendChild(I)}}),g};return r==="sideBySide"&&c.participantType===eAe?h(c):m(c)}if(l){const p=n.field===s.winningSide;o.style.color=p?"green":"red"}else{const p=(u==null?void 0:u.sex)||((d=s==null?void 0:s.person)==null?void 0:d.sex),m=p===ZNe&&"#2E86C1"||p===QNe&&"#AA336A"||"";o.style.color=m}return o.innerHTML=(c1(u)?u.participantName:u)||"",o};function rAe(t){var o;const e=t.getRow().getData();if(!((o=e.competitiveProfile)!=null&&o.competitiveness))return"";const{competitiveProfile:i,score:r}=e,n=document.createElement("span"),a={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(r){const{competitiveness:s}=i;n.style.fontSize="smaller",n.style.color=a[s],n.innerHTML=s}return n}function nAe(t){const e=t.getRow().getData();if(!e.readyToScore)return"";const i=e.matchUp.matchUpStatus==="WALKOVER",r=document.createElement("span");return r.classList.add("scoreCell"),e.score?(r.style.fontSize="smaller",r.innerHTML=e.score):i?r.innerHTML="WO":(r.style.fontSize="smaller",r.style.color="blue",r.innerHTML="--- --- ---"),r}function YM(t,e){var n,a,o,s;const i=(t==null?void 0:t.person)||((n=t==null?void 0:t.participant)==null?void 0:n.person),r=(e==null?void 0:e.person)||((a=e==null?void 0:e.participant)==null?void 0:a.person);return i||r?i!=null&&i.standardFamilyName&&!(r!=null&&r.standardFamilyName)||r!=null&&r.standardFamilyName&&!(i!=null&&i.standardFamilyName)||!(i!=null&&i.standardFamilyName)&&!(r!=null&&r.standardFamilyName)?1:(o=i.standardFamilyName)==null?void 0:o.localeCompare(r==null?void 0:r.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!(t!=null&&t.participantName)&&!(e!=null&&e.participantName)?1:(s=t==null?void 0:t.participantName)==null?void 0:s.localeCompare(e==null?void 0:e.participantName)}function aAe(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}function oAe({data:t}){const e=t.some(r=>r.courtName),i=r=>{const n=document.createElement("div");n.className="has-text-warning-dark",n.innerHTML="Select participant";const a=()=>console.log("boo");return r.getValue().participantName&&Dre(a)(r,n)};return[{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:Qi,minWidth:50,width:50},{formatter:"rownum",headerSort:!1,hozAlign:Hd,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"scheduledDate",title:"Date",width:110},{visible:!!e,field:"courtName",title:"Court",width:100},{field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:i,sorter:YM,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:i,sorter:YM,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{formatter:nAe,sorter:aAe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:abe,formatter:rAe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:Hd,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70}]}var sAe=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};const{TEAM:lAe}=Uz,wj=t=>{var M,E,O,k,x;const{potentialParticipants:e,structureName:i,matchUpType:r,roundNumber:n,matchUpId:a,roundName:o,schedule:s,eventId:l,drawId:u,sides:c,...d}=t,{scheduledDate:p,scheduleTime:m,courtName:h}=s||{},f=F=>{var $;return(($=F.person)==null?void 0:$.standardFamilyName)||F.participantName},g=(e==null?void 0:e.map(F=>({participantName:F.map(f).filter(Boolean).join(" or ")})))||[],v=((M=c==null?void 0:c[0])==null?void 0:M.participant)||g.shift(),y=((E=c==null?void 0:c[1])==null?void 0:E.participant)||g.shift(),I={participantName:v==null?void 0:v.participantName,sex:(O=v==null?void 0:v.person)==null?void 0:O.sex,participant:v},b={participantName:y==null?void 0:y.participantName,sex:(k=y==null?void 0:y.person)==null?void 0:k.sex,participant:y},S=c.flatMap(({participant:F})=>{var $;return($=F==null?void 0:F.individualParticipantIds)!=null&&$.length?F.individualParticipantIds:F==null?void 0:F.participantId}).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,U=!!d.winningSide,T=!!(d.winningSide||d.readyToScore),D=(x=d.score)==null?void 0:x.scoreStringSide1,P=c.flatMap(F=>{var _,L,B;const $=(_=F.participant)==null?void 0:_.person;return $?[$.standardGivenName,$.standardFamilyName]:(B=(L=F.participant)==null?void 0:L.individualParticipants)==null?void 0:B.map(({person:V})=>[V.standardGivenName,V.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),C=sAe([P,v==null?void 0:v.participantName,y==null?void 0:y.participantName].filter(Boolean).join(" ")).toLowerCase(),R=t.collectionId?lAe:r,N=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,A={score:D,matchUpStatus:t.matchUpStatus,readyToScore:T,complete:U,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:S,flight:t.drawName,competitiveProfile:N,structureName:i,scheduledDate:p,readyToScore:T,scheduleTime:m,matchUpType:r,scoreDetail:A,winningSide:w,roundNumber:n,searchText:C,courtName:h,eventType:R,matchUpId:a,roundName:o,complete:U,eventId:l,matchUp:t,drawId:u,side1:I,side2:b,score:D}},{CONTAINER:uAe}=uT;async function cAe(t){const{drawId:e,structureId:i,eventData:r}=t;let n,a,o,s,l=t.matchUps;const u=()=>{var I,b;const v=(I=r==null?void 0:r.drawsData)==null?void 0:I.find(S=>S.drawId===e);return a=(b=v==null?void 0:v.structures)==null?void 0:b.find(S=>S.structureId===i),s=(a==null?void 0:a.structureType)===uAe,(a!=null&&a.roundMatchUps?Object.values((a==null?void 0:a.roundMatchUps)||{}).flat():[]).filter(({matchUpStatus:S})=>S!=="BYE").filter(({sides:S})=>!o||S.find(w=>{var U,T;return(T=(U=w.participant)==null?void 0:U.participantName)==null?void 0:T.toLowerCase().includes(o==null?void 0:o.toLowerCase())}))};l||(l=await u()),r&&l.forEach(v=>v.eventName=r.eventInfo.eventName);const c=()=>l.map(wj),d=()=>u().map(wj),p=v=>{v.participantFilter&&(o=v.participantFilter),n.replaceData(d())},m=c(),h=oAe({data:m}),f=s?["roundName","structureName"]:["roundName"];return(v=>{qD({anchorId:"flightDisplay"});const y=document.getElementById("flightDisplay");n=new $b(y,{groupHeader:[nbe,I=>I],headerSortElement:aK(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:f,columns:h,data:v})})(m),{table:n,replaceTableData:p}}const dAe=t=>t.reduce((e,i)=>e+parseFloat(i),0),Uj=t=>parseFloat((dAe(t)/t.length).toFixed(2));function Sj(t){var p,m;const{participantResult:e,drawPosition:i,participantId:r,participantMap:n}=t,a=(p=e==null?void 0:e.ratingVariation)!=null&&p.length?Uj(e.ratingVariation):0,o=(m=e==null?void 0:e.pressureScores)!=null&&m.length?Uj(e.pressureScores):0,s=`${(e==null?void 0:e.pointsWon)||0}/${(e==null?void 0:e.pointsLost)||0}`,l=`${(e==null?void 0:e.gamesWon)||0}/${(e==null?void 0:e.gamesLost)||0}`,u=`${(e==null?void 0:e.setsWon)||0}/${(e==null?void 0:e.setsLost)||0}`,c=(e==null?void 0:e.groupOrder)||(e==null?void 0:e.provisionalOrder),d=n[r];return{participantName:d.participantName,groupName:d.groupName,...e,averageVariation:a,averagePressure:o,participantId:r,pointsResult:s,drawPosition:i,participant:d,gamesResult:l,setsResult:u,order:c}}function M0(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:t-e}function ef(t){const e=t.getValue();return e&&`${(parseFloat(e)*100).toFixed(0)}%`}function Tj(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:e-t}function pAe({isAdHoc:t}){return[{formatter:Dre(({event:e,cell:i,...r})=>console.log("cell clicked",{event:e,cell:i,undefined:void 0,params:r})),sorter:YM,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,title:"Name",widthGrow:2,frozen:!0},{headerHozAlign:Qi,headerWordWrap:!0,title:"Match W/L",hozAlign:Qi,maxWidth:80,field:"result"},{formatter:ef,headerHozAlign:Qi,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:Qi,maxWidth:80},{headerHozAlign:Qi,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:Qi,maxWidth:80},{formatter:ef,headerHozAlign:Qi,headerWordWrap:!0,title:"Set Win%",hozAlign:Qi,field:"setsPct",maxWidth:80},{headerHozAlign:Qi,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:Qi,maxWidth:80},{formatter:ef,headerHozAlign:Qi,headerWordWrap:!0,title:"Game Win%",hozAlign:Qi,field:"gamesPct",maxWidth:80},{headerHozAlign:Qi,headerWordWrap:!0,field:"pointsResult",title:"Points W/L",hozAlign:Qi,maxWidth:80},{formatter:ef,headerHozAlign:Qi,headerWordWrap:!0,title:"Points Win%",field:"pointsPct",hozAlign:Qi,maxWidth:80},{formatter:ef,field:"averagePressure",headerHozAlign:Qi,sorter:Tj,hozAlign:Qi,maxWidth:70,title:"PS"},{formatter:ef,field:"averageVariation",headerHozAlign:Qi,sorter:Tj,hozAlign:Qi,maxWidth:70,title:"RV"},{headerHozAlign:Qi,field:"pressureOrder",sorter:M0,hozAlign:Qi,visible:t,title:"Order",maxWidth:80},{headerHozAlign:Qi,sorter:M0,visible:!t,hozAlign:Qi,title:"Order",field:"order",maxWidth:80},{field:"groupName",visible:!1,title:"Group"}]}async function mAe({drawId:t,structureId:e,eventData:i,participants:r=[]}){var b,S;let n,a,o;const s=(b=i==null?void 0:i.drawsData)==null?void 0:b.find(w=>w.drawId===t);let l=(S=s==null?void 0:s.structures)==null?void 0:S.find(w=>w.structureId===e);const u=wT.isAdHoc({structure:l}),c=w=>(w??[]).reduce((U,T)=>(U[T.participantId]=T,U),{}),d={},p=()=>{var T,D;const w=(T=i==null?void 0:i.drawsData)==null?void 0:T.find(P=>P.drawId===t);return l=(D=w==null?void 0:w.structures)==null?void 0:D.find(P=>P.structureId===e),o||(o=c(r)),(l!=null&&l.roundMatchUps?Object.values(l.roundMatchUps).flat():[]).forEach(({sides:P,structureName:C,structureId:R})=>{d[R]=C,P.forEach(N=>{N.participantId&&(o[N.participantId].groupName=C)})}),((l==null?void 0:l.participantResults)??[]).filter(P=>{var R;const C=o[P.participantId];return!a||((R=C==null?void 0:C.participantName)==null?void 0:R.toLowerCase().includes(a==null?void 0:a.toLowerCase()))})},m=p(),h=()=>m==null?void 0:m.map(w=>Sj({...w,participantMap:o})).sort((w,U)=>u?M0(w.pressureOrder,U.pressureOrder):M0(w.order,U.order)),f=()=>{var w;return(w=p())==null?void 0:w.map(U=>Sj({...U,participantMap:o}))},g=w=>{(w==null?void 0:w.participantFilter)!==void 0&&(a=w.participantFilter),n.replaceData(f())},v=h(),y=pAe({isAdHoc:u});return(w=>{qD({anchorId:"flightDisplay"});const U=document.getElementById("flightDisplay"),T=Object.values(d).length>1?["groupName"]:void 0;n=new $b(U,{headerSortElement:aK(["averageVariation","averagePressure","participantName","gamesResult","matchUpsPct","setsResult","gamesPct","setsPct","result","order"]),height:window.innerHeight*.85,groupHeader:[D=>D],placeholder:"No participants",renderHorizontal:"virtual",index:"matchUpId",groupBy:T,columns:y,data:w})})(v),{table:n,replaceTableData:g}}const{CONTAINER:hAe}=uT;function fAe(t){const{callback:e,structure:i,existingView:r}=t,n=l=>r!==l&&ou(e)&&e({refresh:!0,view:l}),a=(i==null?void 0:i.structureType)===hAe,o=ofe.isAdHoc({structure:i}),s=[];return r!==CV&&s.push({onClick:()=>n(CV),label:o?"Columns":"Draw",close:!0}),r!==MV&&s.push({onClick:()=>n(MV),label:"Table view",close:!0}),(o||a)&&r!==EV&&s.push({onClick:()=>n(EV),label:"Statistics",close:!0}),{label:"Display",id:"roundDisplayButton",options:s,selection:!1,location:Dm,align:Dm}}function Dj({tournamentId:t,eventId:e,header:i,flightDisplay:r,displayFormat:n}){const a=()=>{var s;return(s=document.getElementById("structureButton"))==null?void 0:s.remove()},o=()=>{var s;return(s=document.getElementById("roundDisplayButton"))==null?void 0:s.remove()};Q7({tournamentId:t,eventId:e}).then(s=>{var v,y,I;const l=((v=s==null?void 0:s.data)==null?void 0:v.eventData)||(s==null?void 0:s.data),u=((y=s==null?void 0:s.data)==null?void 0:y.participants)||[];window!=null&&window.dev&&(window.dev.eventData=l.drawsData);const c=b=>Object.values(b.roundMatchUps||{}).flat(),d=b=>{var S;return(S=b.structures)==null?void 0:S.some(w=>c(w).length>0)},p=l==null?void 0:l.drawsData.filter(d),m=b=>{var P,C;const S=p[b];if(!S)return;const w=S.drawId,U=({view:R})=>{R&&(n=R),m(b)},T=R=>{var L,B;const N=(L=S.structures)==null?void 0:L[R];o();const A=fAe({callback:U,structure:N}),M=tm({button:A});i.appendChild(M);const E=N.structureId,O=Object.values(N.roundMatchUps||{}).flat();wT.isAdHoc({structure:N})&&O.sort(jD.matchUpScheduleSort),r.innerHTML=S.drawName,Hp(r);const x={...(B=l==null?void 0:l.eventInfo)==null?void 0:B.display,...S==null?void 0:S.display,...N==null?void 0:N.display},F=x==null?void 0:x.compositionName,$=x==null?void 0:x.configuration,_=JNe[F??"National"];if(Object.assign(_.configuration,$),_.configuration.genderColor=!0,console.log({display:x,composition:_,configuration:$}),n==="roundsColumns"){const V=zNe({content:HNe({context:{drawId:w,structureId:E},matchUps:O,composition:_,structure:N}),theme:_.theme});r.appendChild(V)}else n==="roundsStats"?mAe({drawId:w,structureId:E,eventData:l,participants:u}):cAe({drawId:w,structureId:E,eventData:l})};if(((P=S.structures)==null?void 0:P.length)>1){const R=S.structures.map(({structureName:M},E)=>({onClick:()=>T(E),label:M,close:!0})),N={label:S.structures[0].structureName,options:R,id:"structureButton",modifyLabel:!0,selection:!0,location:Hd},A=tm({button:N});i.appendChild(A)}(C=S.structures)!=null&&C[0]&&T(0)},h=p.map(({drawName:b},S)=>({onClick:()=>m(S),label:b,close:!0})),f={label:(I=p==null?void 0:p[0])==null?void 0:I.drawName,options:h,modifyLabel:!0,id:"flightButton",selection:!0,location:Hd},g=tm({button:f,stateChange:a});i.appendChild(g),m(0)})}function Hp(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}function gAe(t,e,i,r,n){if(n){const a=e.target.value;n(a)?(r.innerHTML="",r.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(r.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),r.classList.add("is-danger"))}}var Yo="top",pl="bottom",ml="right",Ko="left",aB="auto",nU=[Yo,pl,ml,Ko],Ig="start",wy="end",vAe="clippingParents",Pre="viewport",$v="popper",IAe="reference",Pj=nU.reduce(function(t,e){return t.concat([e+"-"+Ig,e+"-"+wy])},[]),Rre=[].concat(nU,[aB]).reduce(function(t,e){return t.concat([e,e+"-"+Ig,e+"-"+wy])},[]),yAe="beforeRead",bAe="read",wAe="afterRead",UAe="beforeMain",SAe="main",TAe="afterMain",DAe="beforeWrite",PAe="write",RAe="afterWrite",CAe=[yAe,bAe,wAe,UAe,SAe,TAe,DAe,PAe,RAe];function $u(t){return t?(t.nodeName||"").toLowerCase():null}function Os(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function _m(t){var e=Os(t).Element;return t instanceof e||t instanceof Element}function Js(t){var e=Os(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function oB(t){if(typeof ShadowRoot>"u")return!1;var e=Os(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function EAe(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var r=e.styles[i]||{},n=e.attributes[i]||{},a=e.elements[i];!Js(a)||!$u(a)||(Object.assign(a.style,r),Object.keys(n).forEach(function(o){var s=n[o];s===!1?a.removeAttribute(o):a.setAttribute(o,s===!0?"":s)}))})}function MAe(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(r){var n=e.elements[r],a=e.attributes[r]||{},o=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:i[r]),s=o.reduce(function(l,u){return l[u]="",l},{});!Js(n)||!$u(n)||(Object.assign(n.style,s),Object.keys(a).forEach(function(l){n.removeAttribute(l)}))})}}const Cre={name:"applyStyles",enabled:!0,phase:"write",fn:EAe,effect:MAe,requires:["computeStyles"]};function vu(t){return t.split("-")[0]}var mm=Math.max,N0=Math.min,yg=Math.round;function KM(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Ere(){return!/^((?!chrome|android).)*safari/i.test(KM())}function bg(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var r=t.getBoundingClientRect(),n=1,a=1;e&&Js(t)&&(n=t.offsetWidth>0&&yg(r.width)/t.offsetWidth||1,a=t.offsetHeight>0&&yg(r.height)/t.offsetHeight||1);var o=_m(t)?Os(t):window,s=o.visualViewport,l=!Ere()&&i,u=(r.left+(l&&s?s.offsetLeft:0))/n,c=(r.top+(l&&s?s.offsetTop:0))/a,d=r.width/n,p=r.height/a;return{width:d,height:p,top:c,right:u+d,bottom:c+p,left:u,x:u,y:c}}function sB(t){var e=bg(t),i=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:r}}function Mre(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&oB(i)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Bc(t){return Os(t).getComputedStyle(t)}function NAe(t){return["table","td","th"].indexOf($u(t))>=0}function xp(t){return((_m(t)?t.ownerDocument:t.document)||window.document).documentElement}function rC(t){return $u(t)==="html"?t:t.assignedSlot||t.parentNode||(oB(t)?t.host:null)||xp(t)}function Rj(t){return!Js(t)||Bc(t).position==="fixed"?null:t.offsetParent}function AAe(t){var e=/firefox/i.test(KM()),i=/Trident/i.test(KM());if(i&&Js(t)){var r=Bc(t);if(r.position==="fixed")return null}var n=rC(t);for(oB(n)&&(n=n.host);Js(n)&&["html","body"].indexOf($u(n))<0;){var a=Bc(n);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return n;n=n.parentNode}return null}function aU(t){for(var e=Os(t),i=Rj(t);i&&NAe(i)&&Bc(i).position==="static";)i=Rj(i);return i&&($u(i)==="html"||$u(i)==="body"&&Bc(i).position==="static")?e:i||AAe(t)||e}function lB(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function lI(t,e,i){return mm(t,N0(e,i))}function OAe(t,e,i){var r=lI(t,e,i);return r>i?i:r}function Nre(){return{top:0,right:0,bottom:0,left:0}}function Are(t){return Object.assign({},Nre(),t)}function Ore(t,e){return e.reduce(function(i,r){return i[r]=t,i},{})}var kAe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Are(typeof e!="number"?e:Ore(e,nU))};function xAe(t){var e,i=t.state,r=t.name,n=t.options,a=i.elements.arrow,o=i.modifiersData.popperOffsets,s=vu(i.placement),l=lB(s),u=[Ko,ml].indexOf(s)>=0,c=u?"height":"width";if(!(!a||!o)){var d=kAe(n.padding,i),p=sB(a),m=l==="y"?Yo:Ko,h=l==="y"?pl:ml,f=i.rects.reference[c]+i.rects.reference[l]-o[l]-i.rects.popper[c],g=o[l]-i.rects.reference[l],v=aU(a),y=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,I=f/2-g/2,b=d[m],S=y-p[c]-d[h],w=y/2-p[c]/2+I,U=lI(b,w,S),T=l;i.modifiersData[r]=(e={},e[T]=U,e.centerOffset=U-w,e)}}function FAe(t){var e=t.state,i=t.options,r=i.element,n=r===void 0?"[data-popper-arrow]":r;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||Mre(e.elements.popper,n)&&(e.elements.arrow=n))}const LAe={name:"arrow",enabled:!0,phase:"main",fn:xAe,effect:FAe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function wg(t){return t.split("-")[1]}var _Ae={top:"auto",right:"auto",bottom:"auto",left:"auto"};function $Ae(t,e){var i=t.x,r=t.y,n=e.devicePixelRatio||1;return{x:yg(i*n)/n||0,y:yg(r*n)/n||0}}function Cj(t){var e,i=t.popper,r=t.popperRect,n=t.placement,a=t.variation,o=t.offsets,s=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,d=t.isFixed,p=o.x,m=p===void 0?0:p,h=o.y,f=h===void 0?0:h,g=typeof c=="function"?c({x:m,y:f}):{x:m,y:f};m=g.x,f=g.y;var v=o.hasOwnProperty("x"),y=o.hasOwnProperty("y"),I=Ko,b=Yo,S=window;if(u){var w=aU(i),U="clientHeight",T="clientWidth";if(w===Os(i)&&(w=xp(i),Bc(w).position!=="static"&&s==="absolute"&&(U="scrollHeight",T="scrollWidth")),w=w,n===Yo||(n===Ko||n===ml)&&a===wy){b=pl;var D=d&&w===S&&S.visualViewport?S.visualViewport.height:w[U];f-=D-r.height,f*=l?1:-1}if(n===Ko||(n===Yo||n===pl)&&a===wy){I=ml;var P=d&&w===S&&S.visualViewport?S.visualViewport.width:w[T];m-=P-r.width,m*=l?1:-1}}var C=Object.assign({position:s},u&&_Ae),R=c===!0?$Ae({x:m,y:f},Os(i)):{x:m,y:f};if(m=R.x,f=R.y,l){var N;return Object.assign({},C,(N={},N[b]=y?"0":"",N[I]=v?"0":"",N.transform=(S.devicePixelRatio||1)<=1?"translate("+m+"px, "+f+"px)":"translate3d("+m+"px, "+f+"px, 0)",N))}return Object.assign({},C,(e={},e[b]=y?f+"px":"",e[I]=v?m+"px":"",e.transform="",e))}function BAe(t){var e=t.state,i=t.options,r=i.gpuAcceleration,n=r===void 0?!0:r,a=i.adaptive,o=a===void 0?!0:a,s=i.roundOffsets,l=s===void 0?!0:s,u={placement:vu(e.placement),variation:wg(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Cj(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Cj(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const VAe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:BAe,data:{}};var UU={passive:!0};function jAe(t){var e=t.state,i=t.instance,r=t.options,n=r.scroll,a=n===void 0?!0:n,o=r.resize,s=o===void 0?!0:o,l=Os(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",i.update,UU)}),s&&l.addEventListener("resize",i.update,UU),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",i.update,UU)}),s&&l.removeEventListener("resize",i.update,UU)}}const GAe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:jAe,data:{}};var HAe={left:"right",right:"left",bottom:"top",top:"bottom"};function lS(t){return t.replace(/left|right|bottom|top/g,function(e){return HAe[e]})}var zAe={start:"end",end:"start"};function Ej(t){return t.replace(/start|end/g,function(e){return zAe[e]})}function uB(t){var e=Os(t),i=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:i,scrollTop:r}}function cB(t){return bg(xp(t)).left+uB(t).scrollLeft}function WAe(t,e){var i=Os(t),r=xp(t),n=i.visualViewport,a=r.clientWidth,o=r.clientHeight,s=0,l=0;if(n){a=n.width,o=n.height;var u=Ere();(u||!u&&e==="fixed")&&(s=n.offsetLeft,l=n.offsetTop)}return{width:a,height:o,x:s+cB(t),y:l}}function qAe(t){var e,i=xp(t),r=uB(t),n=(e=t.ownerDocument)==null?void 0:e.body,a=mm(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),o=mm(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),s=-r.scrollLeft+cB(t),l=-r.scrollTop;return Bc(n||i).direction==="rtl"&&(s+=mm(i.clientWidth,n?n.clientWidth:0)-a),{width:a,height:o,x:s,y:l}}function dB(t){var e=Bc(t),i=e.overflow,r=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function kre(t){return["html","body","#document"].indexOf($u(t))>=0?t.ownerDocument.body:Js(t)&&dB(t)?t:kre(rC(t))}function uI(t,e){var i;e===void 0&&(e=[]);var r=kre(t),n=r===((i=t.ownerDocument)==null?void 0:i.body),a=Os(r),o=n?[a].concat(a.visualViewport||[],dB(r)?r:[]):r,s=e.concat(o);return n?s:s.concat(uI(rC(o)))}function XM(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function YAe(t,e){var i=bg(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function Mj(t,e,i){return e===Pre?XM(WAe(t,i)):_m(e)?YAe(e,i):XM(qAe(xp(t)))}function KAe(t){var e=uI(rC(t)),i=["absolute","fixed"].indexOf(Bc(t).position)>=0,r=i&&Js(t)?aU(t):t;return _m(r)?e.filter(function(n){return _m(n)&&Mre(n,r)&&$u(n)!=="body"}):[]}function XAe(t,e,i,r){var n=e==="clippingParents"?KAe(t):[].concat(e),a=[].concat(n,[i]),o=a[0],s=a.reduce(function(l,u){var c=Mj(t,u,r);return l.top=mm(c.top,l.top),l.right=N0(c.right,l.right),l.bottom=N0(c.bottom,l.bottom),l.left=mm(c.left,l.left),l},Mj(t,o,r));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function xre(t){var e=t.reference,i=t.element,r=t.placement,n=r?vu(r):null,a=r?wg(r):null,o=e.x+e.width/2-i.width/2,s=e.y+e.height/2-i.height/2,l;switch(n){case Yo:l={x:o,y:e.y-i.height};break;case pl:l={x:o,y:e.y+e.height};break;case ml:l={x:e.x+e.width,y:s};break;case Ko:l={x:e.x-i.width,y:s};break;default:l={x:e.x,y:e.y}}var u=n?lB(n):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case Ig:l[u]=l[u]-(e[c]/2-i[c]/2);break;case wy:l[u]=l[u]+(e[c]/2-i[c]/2);break}}return l}function Uy(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=r===void 0?t.placement:r,a=i.strategy,o=a===void 0?t.strategy:a,s=i.boundary,l=s===void 0?vAe:s,u=i.rootBoundary,c=u===void 0?Pre:u,d=i.elementContext,p=d===void 0?$v:d,m=i.altBoundary,h=m===void 0?!1:m,f=i.padding,g=f===void 0?0:f,v=Are(typeof g!="number"?g:Ore(g,nU)),y=p===$v?IAe:$v,I=t.rects.popper,b=t.elements[h?y:p],S=XAe(_m(b)?b:b.contextElement||xp(t.elements.popper),l,c,o),w=bg(t.elements.reference),U=xre({reference:w,element:I,strategy:"absolute",placement:n}),T=XM(Object.assign({},I,U)),D=p===$v?T:w,P={top:S.top-D.top+v.top,bottom:D.bottom-S.bottom+v.bottom,left:S.left-D.left+v.left,right:D.right-S.right+v.right},C=t.modifiersData.offset;if(p===$v&&C){var R=C[n];Object.keys(P).forEach(function(N){var A=[ml,pl].indexOf(N)>=0?1:-1,M=[Yo,pl].indexOf(N)>=0?"y":"x";P[N]+=R[M]*A})}return P}function JAe(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=i.boundary,a=i.rootBoundary,o=i.padding,s=i.flipVariations,l=i.allowedAutoPlacements,u=l===void 0?Rre:l,c=wg(r),d=c?s?Pj:Pj.filter(function(h){return wg(h)===c}):nU,p=d.filter(function(h){return u.indexOf(h)>=0});p.length===0&&(p=d);var m=p.reduce(function(h,f){return h[f]=Uy(t,{placement:f,boundary:n,rootBoundary:a,padding:o})[vu(f)],h},{});return Object.keys(m).sort(function(h,f){return m[h]-m[f]})}function ZAe(t){if(vu(t)===aB)return[];var e=lS(t);return[Ej(t),e,Ej(e)]}function QAe(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var n=i.mainAxis,a=n===void 0?!0:n,o=i.altAxis,s=o===void 0?!0:o,l=i.fallbackPlacements,u=i.padding,c=i.boundary,d=i.rootBoundary,p=i.altBoundary,m=i.flipVariations,h=m===void 0?!0:m,f=i.allowedAutoPlacements,g=e.options.placement,v=vu(g),y=v===g,I=l||(y||!h?[lS(g)]:ZAe(g)),b=[g].concat(I).reduce(function(B,V){return B.concat(vu(V)===aB?JAe(e,{placement:V,boundary:c,rootBoundary:d,padding:u,flipVariations:h,allowedAutoPlacements:f}):V)},[]),S=e.rects.reference,w=e.rects.popper,U=new Map,T=!0,D=b[0],P=0;P<b.length;P++){var C=b[P],R=vu(C),N=wg(C)===Ig,A=[Yo,pl].indexOf(R)>=0,M=A?"width":"height",E=Uy(e,{placement:C,boundary:c,rootBoundary:d,altBoundary:p,padding:u}),O=A?N?ml:Ko:N?pl:Yo;S[M]>w[M]&&(O=lS(O));var k=lS(O),x=[];if(a&&x.push(E[R]<=0),s&&x.push(E[O]<=0,E[k]<=0),x.every(function(B){return B})){D=C,T=!1;break}U.set(C,x)}if(T)for(var F=h?3:1,$=function(V){var G=b.find(function(j){var z=U.get(j);if(z)return z.slice(0,V).every(function(q){return q})});if(G)return D=G,"break"},_=F;_>0;_--){var L=$(_);if(L==="break")break}e.placement!==D&&(e.modifiersData[r]._skip=!0,e.placement=D,e.reset=!0)}}const eOe={name:"flip",enabled:!0,phase:"main",fn:QAe,requiresIfExists:["offset"],data:{_skip:!1}};function Nj(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function Aj(t){return[Yo,ml,pl,Ko].some(function(e){return t[e]>=0})}function tOe(t){var e=t.state,i=t.name,r=e.rects.reference,n=e.rects.popper,a=e.modifiersData.preventOverflow,o=Uy(e,{elementContext:"reference"}),s=Uy(e,{altBoundary:!0}),l=Nj(o,r),u=Nj(s,n,a),c=Aj(l),d=Aj(u);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":d})}const iOe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:tOe};function rOe(t,e,i){var r=vu(t),n=[Ko,Yo].indexOf(r)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,o=a[0],s=a[1];return o=o||0,s=(s||0)*n,[Ko,ml].indexOf(r)>=0?{x:s,y:o}:{x:o,y:s}}function nOe(t){var e=t.state,i=t.options,r=t.name,n=i.offset,a=n===void 0?[0,0]:n,o=Rre.reduce(function(c,d){return c[d]=rOe(d,e.rects,a),c},{}),s=o[e.placement],l=s.x,u=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[r]=o}const aOe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:nOe};function oOe(t){var e=t.state,i=t.name;e.modifiersData[i]=xre({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const sOe={name:"popperOffsets",enabled:!0,phase:"read",fn:oOe,data:{}};function lOe(t){return t==="x"?"y":"x"}function uOe(t){var e=t.state,i=t.options,r=t.name,n=i.mainAxis,a=n===void 0?!0:n,o=i.altAxis,s=o===void 0?!1:o,l=i.boundary,u=i.rootBoundary,c=i.altBoundary,d=i.padding,p=i.tether,m=p===void 0?!0:p,h=i.tetherOffset,f=h===void 0?0:h,g=Uy(e,{boundary:l,rootBoundary:u,padding:d,altBoundary:c}),v=vu(e.placement),y=wg(e.placement),I=!y,b=lB(v),S=lOe(b),w=e.modifiersData.popperOffsets,U=e.rects.reference,T=e.rects.popper,D=typeof f=="function"?f(Object.assign({},e.rects,{placement:e.placement})):f,P=typeof D=="number"?{mainAxis:D,altAxis:D}:Object.assign({mainAxis:0,altAxis:0},D),C=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,R={x:0,y:0};if(w){if(a){var N,A=b==="y"?Yo:Ko,M=b==="y"?pl:ml,E=b==="y"?"height":"width",O=w[b],k=O+g[A],x=O-g[M],F=m?-T[E]/2:0,$=y===Ig?U[E]:T[E],_=y===Ig?-T[E]:-U[E],L=e.elements.arrow,B=m&&L?sB(L):{width:0,height:0},V=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Nre(),G=V[A],j=V[M],z=lI(0,U[E],B[E]),q=I?U[E]/2-F-z-G-P.mainAxis:$-z-G-P.mainAxis,W=I?-U[E]/2+F+z+j+P.mainAxis:_+z+j+P.mainAxis,Y=e.elements.arrow&&aU(e.elements.arrow),re=Y?b==="y"?Y.clientTop||0:Y.clientLeft||0:0,K=(N=C==null?void 0:C[b])!=null?N:0,H=O+q-K-re,Q=O+W-K,X=lI(m?N0(k,H):k,O,m?mm(x,Q):x);w[b]=X,R[b]=X-O}if(s){var ie,ae=b==="x"?Yo:Ko,le=b==="x"?pl:ml,ne=w[S],de=S==="y"?"height":"width",Ie=ne+g[ae],ce=ne-g[le],ke=[Yo,Ko].indexOf(v)!==-1,Pe=(ie=C==null?void 0:C[S])!=null?ie:0,it=ke?Ie:ne-U[de]-T[de]-Pe+P.altAxis,It=ke?ne+U[de]+T[de]-Pe-P.altAxis:ce,me=m&&ke?OAe(it,ne,It):lI(m?it:Ie,ne,m?It:ce);w[S]=me,R[S]=me-ne}e.modifiersData[r]=R}}const cOe={name:"preventOverflow",enabled:!0,phase:"main",fn:uOe,requiresIfExists:["offset"]};function dOe(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function pOe(t){return t===Os(t)||!Js(t)?uB(t):dOe(t)}function mOe(t){var e=t.getBoundingClientRect(),i=yg(e.width)/t.offsetWidth||1,r=yg(e.height)/t.offsetHeight||1;return i!==1||r!==1}function hOe(t,e,i){i===void 0&&(i=!1);var r=Js(e),n=Js(e)&&mOe(e),a=xp(e),o=bg(t,n,i),s={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&(($u(e)!=="body"||dB(a))&&(s=pOe(e)),Js(e)?(l=bg(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=cB(a))),{x:o.left+s.scrollLeft-l.x,y:o.top+s.scrollTop-l.y,width:o.width,height:o.height}}function fOe(t){var e=new Map,i=new Set,r=[];t.forEach(function(a){e.set(a.name,a)});function n(a){i.add(a.name);var o=[].concat(a.requires||[],a.requiresIfExists||[]);o.forEach(function(s){if(!i.has(s)){var l=e.get(s);l&&n(l)}}),r.push(a)}return t.forEach(function(a){i.has(a.name)||n(a)}),r}function gOe(t){var e=fOe(t);return CAe.reduce(function(i,r){return i.concat(e.filter(function(n){return n.phase===r}))},[])}function vOe(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function IOe(t){var e=t.reduce(function(i,r){var n=i[r.name];return i[r.name]=n?Object.assign({},n,r,{options:Object.assign({},n.options,r.options),data:Object.assign({},n.data,r.data)}):r,i},{});return Object.keys(e).map(function(i){return e[i]})}var Oj={placement:"bottom",modifiers:[],strategy:"absolute"};function kj(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function yOe(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,r=i===void 0?[]:i,n=e.defaultOptions,a=n===void 0?Oj:n;return function(s,l,u){u===void 0&&(u=a);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},Oj,a),modifiersData:{},elements:{reference:s,popper:l},attributes:{},styles:{}},d=[],p=!1,m={state:c,setOptions:function(v){var y=typeof v=="function"?v(c.options):v;f(),c.options=Object.assign({},a,c.options,y),c.scrollParents={reference:_m(s)?uI(s):s.contextElement?uI(s.contextElement):[],popper:uI(l)};var I=gOe(IOe([].concat(r,c.options.modifiers)));return c.orderedModifiers=I.filter(function(b){return b.enabled}),h(),m.update()},forceUpdate:function(){if(!p){var v=c.elements,y=v.reference,I=v.popper;if(kj(y,I)){c.rects={reference:hOe(y,aU(I),c.options.strategy==="fixed"),popper:sB(I)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(P){return c.modifiersData[P.name]=Object.assign({},P.data)});for(var b=0;b<c.orderedModifiers.length;b++){if(c.reset===!0){c.reset=!1,b=-1;continue}var S=c.orderedModifiers[b],w=S.fn,U=S.options,T=U===void 0?{}:U,D=S.name;typeof w=="function"&&(c=w({state:c,options:T,name:D,instance:m})||c)}}}},update:vOe(function(){return new Promise(function(g){m.forceUpdate(),g(c)})}),destroy:function(){f(),p=!0}};if(!kj(s,l))return m;m.setOptions(u).then(function(g){!p&&u.onFirstUpdate&&u.onFirstUpdate(g)});function h(){c.orderedModifiers.forEach(function(g){var v=g.name,y=g.options,I=y===void 0?{}:y,b=g.effect;if(typeof b=="function"){var S=b({state:c,name:v,instance:m,options:I}),w=function(){};d.push(S||w)}})}function f(){d.forEach(function(g){return g()}),d=[]}return m}}var bOe=[GAe,sOe,VAe,Cre,aOe,eOe,cOe,LAe,iOe],wOe=yOe({defaultModifiers:bOe}),UOe="tippy-box",Fre="tippy-content",SOe="tippy-backdrop",Lre="tippy-arrow",_re="tippy-svg-arrow",Bp={passive:!0,capture:!0},$re=function(){return document.body};function iE(t,e,i){if(Array.isArray(t)){var r=t[e];return r??(Array.isArray(i)?i[e]:i)}return t}function pB(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function Bre(t,e){return typeof t=="function"?t.apply(void 0,e):t}function xj(t,e){if(e===0)return t;var i;return function(r){clearTimeout(i),i=setTimeout(function(){t(r)},e)}}function TOe(t){return t.split(/\s+/).filter(Boolean)}function nf(t){return[].concat(t)}function Fj(t,e){t.indexOf(e)===-1&&t.push(e)}function DOe(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function POe(t){return t.split("-")[0]}function A0(t){return[].slice.call(t)}function Lj(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function cI(){return document.createElement("div")}function nC(t){return["Element","Fragment"].some(function(e){return pB(t,e)})}function ROe(t){return pB(t,"NodeList")}function COe(t){return pB(t,"MouseEvent")}function EOe(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function MOe(t){return nC(t)?[t]:ROe(t)?A0(t):Array.isArray(t)?t:A0(document.querySelectorAll(t))}function rE(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function _j(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function NOe(t){var e,i=nf(t),r=i[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function AOe(t,e){var i=e.clientX,r=e.clientY;return t.every(function(n){var a=n.popperRect,o=n.popperState,s=n.props,l=s.interactiveBorder,u=POe(o.placement),c=o.modifiersData.offset;if(!c)return!0;var d=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,m=u==="right"?c.left.x:0,h=u==="left"?c.right.x:0,f=a.top-r+d>l,g=r-a.bottom-p>l,v=a.left-i+m>l,y=i-a.right-h>l;return f||g||v||y})}function nE(t,e,i){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(n){t[r](n,i)})}function $j(t,e){for(var i=e;i;){var r;if(t.contains(i))return!0;i=i.getRootNode==null||(r=i.getRootNode())==null?void 0:r.host}return!1}var ru={isTouch:!1},Bj=0;function OOe(){ru.isTouch||(ru.isTouch=!0,window.performance&&document.addEventListener("mousemove",Vre))}function Vre(){var t=performance.now();t-Bj<20&&(ru.isTouch=!1,document.removeEventListener("mousemove",Vre)),Bj=t}function kOe(){var t=document.activeElement;if(EOe(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function xOe(){document.addEventListener("touchstart",OOe,Bp),window.addEventListener("blur",kOe)}var FOe=typeof window<"u"&&typeof document<"u",LOe=FOe?!!window.msCrypto:!1,_Oe={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},$Oe={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Tl=Object.assign({appendTo:$re,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},_Oe,$Oe),BOe=Object.keys(Tl),VOe=function(e){var i=Object.keys(e);i.forEach(function(r){Tl[r]=e[r]})};function jre(t){var e=t.plugins||[],i=e.reduce(function(r,n){var a=n.name,o=n.defaultValue;if(a){var s;r[a]=t[a]!==void 0?t[a]:(s=Tl[a])!=null?s:o}return r},{});return Object.assign({},t,i)}function jOe(t,e){var i=e?Object.keys(jre(Object.assign({},Tl,{plugins:e}))):BOe,r=i.reduce(function(n,a){var o=(t.getAttribute("data-tippy-"+a)||"").trim();if(!o)return n;if(a==="content")n[a]=o;else try{n[a]=JSON.parse(o)}catch{n[a]=o}return n},{});return r}function Vj(t,e){var i=Object.assign({},e,{content:Bre(e.content,[t])},e.ignoreAttributes?{}:jOe(t,e.plugins));return i.aria=Object.assign({},Tl.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var GOe=function(){return"innerHTML"};function JM(t,e){t[GOe()]=e}function jj(t){var e=cI();return t===!0?e.className=Lre:(e.className=_re,nC(t)?e.appendChild(t):JM(e,t)),e}function Gj(t,e){nC(e.content)?(JM(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?JM(t,e.content):t.textContent=e.content)}function ZM(t){var e=t.firstElementChild,i=A0(e.children);return{box:e,content:i.find(function(r){return r.classList.contains(Fre)}),arrow:i.find(function(r){return r.classList.contains(Lre)||r.classList.contains(_re)}),backdrop:i.find(function(r){return r.classList.contains(SOe)})}}function Gre(t){var e=cI(),i=cI();i.className=UOe,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=cI();r.className=Fre,r.setAttribute("data-state","hidden"),Gj(r,t.props),e.appendChild(i),i.appendChild(r),n(t.props,t.props);function n(a,o){var s=ZM(e),l=s.box,u=s.content,c=s.arrow;o.theme?l.setAttribute("data-theme",o.theme):l.removeAttribute("data-theme"),typeof o.animation=="string"?l.setAttribute("data-animation",o.animation):l.removeAttribute("data-animation"),o.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?l.setAttribute("role",o.role):l.removeAttribute("role"),(a.content!==o.content||a.allowHTML!==o.allowHTML)&&Gj(u,t.props),o.arrow?c?a.arrow!==o.arrow&&(l.removeChild(c),l.appendChild(jj(o.arrow))):l.appendChild(jj(o.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:n}}Gre.$$tippy=!0;var HOe=1,SU=[],aE=[];function zOe(t,e){var i=Vj(t,Object.assign({},Tl,jre(Lj(e)))),r,n,a,o=!1,s=!1,l=!1,u=!1,c,d,p,m=[],h=xj(H,i.interactiveDebounce),f,g=HOe++,v=null,y=DOe(i.plugins),I={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},b={id:g,reference:t,popper:cI(),popperInstance:v,props:i,state:I,plugins:y,clearDelayTimeouts:it,setProps:It,setContent:me,show:fe,hide:pe,hideWithInteractivity:Fe,enable:ke,disable:Pe,unmount:De,destroy:je};if(!i.render)return b;var S=i.render(b),w=S.popper,U=S.onUpdate;w.setAttribute("data-tippy-root",""),w.id="tippy-"+b.id,b.popper=w,t._tippy=b,w._tippy=b;var T=y.map(function(ue){return ue.fn(b)}),D=t.hasAttribute("aria-expanded");return Y(),F(),O(),k("onCreate",[b]),i.showOnCreate&&Ie(),w.addEventListener("mouseenter",function(){b.props.interactive&&b.state.isVisible&&b.clearDelayTimeouts()}),w.addEventListener("mouseleave",function(){b.props.interactive&&b.props.trigger.indexOf("mouseenter")>=0&&A().addEventListener("mousemove",h)}),b;function P(){var ue=b.props.touch;return Array.isArray(ue)?ue:[ue,0]}function C(){return P()[0]==="hold"}function R(){var ue;return!!((ue=b.props.render)!=null&&ue.$$tippy)}function N(){return f||t}function A(){var ue=N().parentNode;return ue?NOe(ue):document}function M(){return ZM(w)}function E(ue){return b.state.isMounted&&!b.state.isVisible||ru.isTouch||c&&c.type==="focus"?0:iE(b.props.delay,ue?0:1,Tl.delay)}function O(ue){ue===void 0&&(ue=!1),w.style.pointerEvents=b.props.interactive&&!ue?"":"none",w.style.zIndex=""+b.props.zIndex}function k(ue,he,Re){if(Re===void 0&&(Re=!0),T.forEach(function(Ce){Ce[ue]&&Ce[ue].apply(Ce,he)}),Re){var xe;(xe=b.props)[ue].apply(xe,he)}}function x(){var ue=b.props.aria;if(ue.content){var he="aria-"+ue.content,Re=w.id,xe=nf(b.props.triggerTarget||t);xe.forEach(function(Ce){var we=Ce.getAttribute(he);if(b.state.isVisible)Ce.setAttribute(he,we?we+" "+Re:Re);else{var Ue=we&&we.replace(Re,"").trim();Ue?Ce.setAttribute(he,Ue):Ce.removeAttribute(he)}})}}function F(){if(!(D||!b.props.aria.expanded)){var ue=nf(b.props.triggerTarget||t);ue.forEach(function(he){b.props.interactive?he.setAttribute("aria-expanded",b.state.isVisible&&he===N()?"true":"false"):he.removeAttribute("aria-expanded")})}}function $(){A().removeEventListener("mousemove",h),SU=SU.filter(function(ue){return ue!==h})}function _(ue){if(!(ru.isTouch&&(l||ue.type==="mousedown"))){var he=ue.composedPath&&ue.composedPath()[0]||ue.target;if(!(b.props.interactive&&$j(w,he))){if(nf(b.props.triggerTarget||t).some(function(Re){return $j(Re,he)})){if(ru.isTouch||b.state.isVisible&&b.props.trigger.indexOf("click")>=0)return}else k("onClickOutside",[b,ue]);b.props.hideOnClick===!0&&(b.clearDelayTimeouts(),b.hide(),s=!0,setTimeout(function(){s=!1}),b.state.isMounted||G())}}}function L(){l=!0}function B(){l=!1}function V(){var ue=A();ue.addEventListener("mousedown",_,!0),ue.addEventListener("touchend",_,Bp),ue.addEventListener("touchstart",B,Bp),ue.addEventListener("touchmove",L,Bp)}function G(){var ue=A();ue.removeEventListener("mousedown",_,!0),ue.removeEventListener("touchend",_,Bp),ue.removeEventListener("touchstart",B,Bp),ue.removeEventListener("touchmove",L,Bp)}function j(ue,he){q(ue,function(){!b.state.isVisible&&w.parentNode&&w.parentNode.contains(w)&&he()})}function z(ue,he){q(ue,he)}function q(ue,he){var Re=M().box;function xe(Ce){Ce.target===Re&&(nE(Re,"remove",xe),he())}if(ue===0)return he();nE(Re,"remove",d),nE(Re,"add",xe),d=xe}function W(ue,he,Re){Re===void 0&&(Re=!1);var xe=nf(b.props.triggerTarget||t);xe.forEach(function(Ce){Ce.addEventListener(ue,he,Re),m.push({node:Ce,eventType:ue,handler:he,options:Re})})}function Y(){C()&&(W("touchstart",K,{passive:!0}),W("touchend",Q,{passive:!0})),TOe(b.props.trigger).forEach(function(ue){if(ue!=="manual")switch(W(ue,K),ue){case"mouseenter":W("mouseleave",Q);break;case"focus":W(LOe?"focusout":"blur",X);break;case"focusin":W("focusout",X);break}})}function re(){m.forEach(function(ue){var he=ue.node,Re=ue.eventType,xe=ue.handler,Ce=ue.options;he.removeEventListener(Re,xe,Ce)}),m=[]}function K(ue){var he,Re=!1;if(!(!b.state.isEnabled||ie(ue)||s)){var xe=((he=c)==null?void 0:he.type)==="focus";c=ue,f=ue.currentTarget,F(),!b.state.isVisible&&COe(ue)&&SU.forEach(function(Ce){return Ce(ue)}),ue.type==="click"&&(b.props.trigger.indexOf("mouseenter")<0||o)&&b.props.hideOnClick!==!1&&b.state.isVisible?Re=!0:Ie(ue),ue.type==="click"&&(o=!Re),Re&&!xe&&ce(ue)}}function H(ue){var he=ue.target,Re=N().contains(he)||w.contains(he);if(!(ue.type==="mousemove"&&Re)){var xe=de().concat(w).map(function(Ce){var we,Ue=Ce._tippy,wt=(we=Ue.popperInstance)==null?void 0:we.state;return wt?{popperRect:Ce.getBoundingClientRect(),popperState:wt,props:i}:null}).filter(Boolean);AOe(xe,ue)&&($(),ce(ue))}}function Q(ue){var he=ie(ue)||b.props.trigger.indexOf("click")>=0&&o;if(!he){if(b.props.interactive){b.hideWithInteractivity(ue);return}ce(ue)}}function X(ue){b.props.trigger.indexOf("focusin")<0&&ue.target!==N()||b.props.interactive&&ue.relatedTarget&&w.contains(ue.relatedTarget)||ce(ue)}function ie(ue){return ru.isTouch?C()!==ue.type.indexOf("touch")>=0:!1}function ae(){le();var ue=b.props,he=ue.popperOptions,Re=ue.placement,xe=ue.offset,Ce=ue.getReferenceClientRect,we=ue.moveTransition,Ue=R()?ZM(w).arrow:null,wt=Ce?{getBoundingClientRect:Ce,contextElement:Ce.contextElement||N()}:t,Le={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Be){var nt=Be.state;if(R()){var Ii=M(),be=Ii.box;["placement","reference-hidden","escaped"].forEach(function(Et){Et==="placement"?be.setAttribute("data-placement",nt.placement):nt.attributes.popper["data-popper-"+Et]?be.setAttribute("data-"+Et,""):be.removeAttribute("data-"+Et)}),nt.attributes.popper={}}}},rt=[{name:"offset",options:{offset:xe}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!we}},Le];R()&&Ue&&rt.push({name:"arrow",options:{element:Ue,padding:3}}),rt.push.apply(rt,(he==null?void 0:he.modifiers)||[]),b.popperInstance=wOe(wt,w,Object.assign({},he,{placement:Re,onFirstUpdate:p,modifiers:rt}))}function le(){b.popperInstance&&(b.popperInstance.destroy(),b.popperInstance=null)}function ne(){var ue=b.props.appendTo,he,Re=N();b.props.interactive&&ue===$re||ue==="parent"?he=Re.parentNode:he=Bre(ue,[Re]),he.contains(w)||he.appendChild(w),b.state.isMounted=!0,ae()}function de(){return A0(w.querySelectorAll("[data-tippy-root]"))}function Ie(ue){b.clearDelayTimeouts(),ue&&k("onTrigger",[b,ue]),V();var he=E(!0),Re=P(),xe=Re[0],Ce=Re[1];ru.isTouch&&xe==="hold"&&Ce&&(he=Ce),he?r=setTimeout(function(){b.show()},he):b.show()}function ce(ue){if(b.clearDelayTimeouts(),k("onUntrigger",[b,ue]),!b.state.isVisible){G();return}if(!(b.props.trigger.indexOf("mouseenter")>=0&&b.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(ue.type)>=0&&o)){var he=E(!1);he?n=setTimeout(function(){b.state.isVisible&&b.hide()},he):a=requestAnimationFrame(function(){b.hide()})}}function ke(){b.state.isEnabled=!0}function Pe(){b.hide(),b.state.isEnabled=!1}function it(){clearTimeout(r),clearTimeout(n),cancelAnimationFrame(a)}function It(ue){if(!b.state.isDestroyed){k("onBeforeUpdate",[b,ue]),re();var he=b.props,Re=Vj(t,Object.assign({},he,Lj(ue),{ignoreAttributes:!0}));b.props=Re,Y(),he.interactiveDebounce!==Re.interactiveDebounce&&($(),h=xj(H,Re.interactiveDebounce)),he.triggerTarget&&!Re.triggerTarget?nf(he.triggerTarget).forEach(function(xe){xe.removeAttribute("aria-expanded")}):Re.triggerTarget&&t.removeAttribute("aria-expanded"),F(),O(),U&&U(he,Re),b.popperInstance&&(ae(),de().forEach(function(xe){requestAnimationFrame(xe._tippy.popperInstance.forceUpdate)})),k("onAfterUpdate",[b,ue])}}function me(ue){b.setProps({content:ue})}function fe(){var ue=b.state.isVisible,he=b.state.isDestroyed,Re=!b.state.isEnabled,xe=ru.isTouch&&!b.props.touch,Ce=iE(b.props.duration,0,Tl.duration);if(!(ue||he||Re||xe)&&!N().hasAttribute("disabled")&&(k("onShow",[b],!1),b.props.onShow(b)!==!1)){if(b.state.isVisible=!0,R()&&(w.style.visibility="visible"),O(),V(),b.state.isMounted||(w.style.transition="none"),R()){var we=M(),Ue=we.box,wt=we.content;rE([Ue,wt],0)}p=function(){var rt;if(!(!b.state.isVisible||u)){if(u=!0,w.offsetHeight,w.style.transition=b.props.moveTransition,R()&&b.props.animation){var Ci=M(),Be=Ci.box,nt=Ci.content;rE([Be,nt],Ce),_j([Be,nt],"visible")}x(),F(),Fj(aE,b),(rt=b.popperInstance)==null||rt.forceUpdate(),k("onMount",[b]),b.props.animation&&R()&&z(Ce,function(){b.state.isShown=!0,k("onShown",[b])})}},ne()}}function pe(){var ue=!b.state.isVisible,he=b.state.isDestroyed,Re=!b.state.isEnabled,xe=iE(b.props.duration,1,Tl.duration);if(!(ue||he||Re)&&(k("onHide",[b],!1),b.props.onHide(b)!==!1)){if(b.state.isVisible=!1,b.state.isShown=!1,u=!1,o=!1,R()&&(w.style.visibility="hidden"),$(),G(),O(!0),R()){var Ce=M(),we=Ce.box,Ue=Ce.content;b.props.animation&&(rE([we,Ue],xe),_j([we,Ue],"hidden"))}x(),F(),b.props.animation?R()&&j(xe,b.unmount):b.unmount()}}function Fe(ue){A().addEventListener("mousemove",h),Fj(SU,h),h(ue)}function De(){b.state.isVisible&&b.hide(),b.state.isMounted&&(le(),de().forEach(function(ue){ue._tippy.unmount()}),w.parentNode&&w.parentNode.removeChild(w),aE=aE.filter(function(ue){return ue!==b}),b.state.isMounted=!1,k("onHidden",[b]))}function je(){b.state.isDestroyed||(b.clearDelayTimeouts(),b.unmount(),re(),delete t._tippy,b.state.isDestroyed=!0,k("onDestroy",[b]))}}function oU(t,e){e===void 0&&(e={});var i=Tl.plugins.concat(e.plugins||[]);xOe();var r=Object.assign({},e,{plugins:i}),n=MOe(t),a=n.reduce(function(o,s){var l=s&&zOe(s,r);return l&&o.push(l),o},[]);return nC(t)?a[0]:a}oU.defaultProps=Tl;oU.setDefaultProps=VOe;oU.currentInput=ru;Object.assign({},Cre,{effect:function(e){var i=e.state,r={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,r.popper),i.styles=r,i.elements.arrow&&Object.assign(i.elements.arrow.style,r.arrow)}});oU.setDefaultProps({render:Gre});function Hj(t){var i;const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===Dm?e.style.marginLeft="1em":e.style.marginRight="1em",t.intent&&e.classList.add(t.intent),(i=t.toolTip)!=null&&i.content&&oU(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=$s),e}const WOe=({target:t})=>(e=[])=>{t.style.backgroundColor=e!=null&&e.length?"lightgray":u1;const i=(r,n,a)=>{const o=t.getElementsByClassName(`options_${r}`)[0];o&&(o.style.display=e!=null&&e.length?n:a)};i(l1,hU,$s),i(Hd,$s,hU),i(Qi,$s,hU),i(Dm,$s,hU)};function qOe(t){var v;const{table:e,targetClassName:i,items:r=[],onSelection:n}=t,a=!!t.target,o=t.target||i&&((v=document.getElementsByClassName(i))==null?void 0:v[0]);if(!o)return{};let s=0,l=0;const u={},c={};let d;if(a){Hp(o);const y=YOe();Object.assign(u,y.elements),o.appendChild(y.anchor)}const p=Object.assign({},...[l1,Hd,Qi,Dm,PV].map(y=>{var b;const I=(b=o.getElementsByClassName(`options_${y}`))==null?void 0:b[0];return Hp(I),{[y]:I}}).filter(Boolean)),m=WOe({target:o}),h=(y,I)=>{ou(I.onClick)&&(y.stopPropagation(),!I.disabled&&I.onClick(y,e),I.stateChange&&m())},f={onClick:()=>{},location:Dm};for(const y of r){const I={...f};c1(y)&&Object.assign(I,y);const b=p[I.location];if(!b){console.log(I.location,p);continue}if(I.location===l1&&(s+=1),I.location===PV){if(ou(I.headerClick)){const S=o.getElementsByClassName("panelHeader")[0];S&&(S.onclick=I.headerClick)}l+=1}if(!I.hide&&(I.input||I.placeholder||I.search)){const S=document.createElement("p");S.style.marginRight="1em",S.className=`control ${I.search?"has-icons-left has-icons-right":""}`;const w=document.createElement("input");if(I.focus&&(d=w),w.className="input font-medium",w.setAttribute("type","text"),w.setAttribute("autocomplete","cc-number"),w.setAttribute("placeholder",y.placeholder||u1),I.id&&(c[I.id]=w),I.id&&w.setAttribute("id",I.id),I.onKeyDown&&w.addEventListener("keydown",U=>I.onKeyDown(U,I)),I.onChange&&w.addEventListener("change",U=>I.onChange(U,I)),I.onKeyUp&&w.addEventListener("keyup",U=>{I.clearSearch&&U.key==="Escape"&&(U.stopPropagation(),w.value="",I.clearSearch()),I.onKeyUp(U,I)}),I.class&&w.classList.add(I.class),I.visible===!1&&(S.style.display=$s),I.value&&(w.value=I.value),S.appendChild(w),I.search){const U=document.createElement("span");if(U.className="icon is-small is-left font-medium",U.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',S.appendChild(U),ou(I.clearSearch)){const T=document.createElement("span");T.className="icon is-small is-right font-medium",T.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',T.onclick=D=>{D.stopPropagation(),w.value="",I.clearSearch()},S.appendChild(T)}}if(y.validator){const U=document.createElement("p");U.className="help font-medium",S.appendChild(U),w.addEventListener("input",T=>gAe(y,T,w,U,y.validator))}I.id&&(u[I.id]=S,S.id=I.id),b==null||b.appendChild(S);continue}if(!I.hide&&I.text){const S=document.createElement("div");S.className="font-medium",I.id&&(u[I.id]=S,S.id=I.id),S.innerHTML=I.text,S.onclick=w=>h(w,I),b==null||b.appendChild(S);continue}if(!(!I.id&&(!(I!=null&&I.label)||I.hide))){if(I.options){const S=tm({target:b,button:I,stateChange:m});I.visible===!1&&(S.style.display=$s),I.id&&(u[I.id]=S)}else if(c1(I.selection)){const{selection:{options:S,actions:w},actionPlacement:U,threshold:T=8,...D}=I;if((S==null?void 0:S.length)<T){S.length&&(U===RV?S.unshift({divider:!0}):S.push({divider:!0})),w.forEach(R=>{const{label:N,...A}=R,M={...A,label:`<p style="font-weight: bold">${N}</p>`};U===RV?S.unshift(M):S.push(M)});const P={...D,options:S},C=tm({target:b,button:P,stateChange:m});P.visible===!1&&(C.style.display=$s),P.id&&(u[I.id]=C)}else{const P=Hj(I);P.onclick=C=>{C.stopPropagation()},I.id&&(u[I.id]=P),b==null||b.appendChild(P)}}else{const S=Hj(I);S.onclick=w=>h(w,I),I.id&&(u[I.id]=S),b==null||b.appendChild(S)}(!(I!=null&&I.label)||I.hide)&&(u[I.id].style.display=$s)}}const g=o.getElementsByClassName("panelHeader")[0];return g&&(g.style.display=l?u1:$s),e==null||e.on("rowSelectionChanged",(y,I)=>{ou(n)&&n(I),s&&m(I)}),m(),d&&setTimeout(()=>d.focus(),200),{elements:u,inputs:c}}function YOe(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=$s,t.appendChild(e);const i=document.createElement("div");i.className=Hfe,i.style.flexWrap="wrap-reverse;";const r={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};r.optionsOverlay.className="options_overlay",r.optionsCenter.className="options_center",r.optionsRight.className="options_right",r.optionsLeft.className="options_left";for(const n of Object.values(r))i.appendChild(n);return t.appendChild(i),{elements:r,anchor:t,header:e}}function KOe(t){const e=rbe(t),i=[{onKeyDown:n=>n.keyCode===8&&n.target.value.length===1&&e(""),onChange:n=>e(n.target.value),onKeyUp:n=>e(n.target.value),clearSearch:()=>e(""),placeholder:"Search tournaments",location:Hd,search:!0}],r=document.getElementById(Zj);qOe({target:r,items:i})}function XOe(t){var u,c;const e=document.createElement("span"),i=document.createElement("table"),r=t.getValue();i.style.width="400px";const n="4em",a=document.createElement("tr"),o=r.tournamentImageURL||((c=(u=r.onlineResources)==null?void 0:u.find(({name:d,resourceType:p})=>d==="tournamentImage"&&p==="URL"))==null?void 0:c.identifier),s=o?`<img src='${o}' style='width: ${n}' alt=''>`:"",l=`<td style='min-width: ${n}'>${s}</td><td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${r.tournamentName}</strong></div><div style='margin-left: 1em'>${r.startDate} / ${r.endDate}</div></td>`;return a.innerHTML=l,i.appendChild(a),e.appendChild(i),e}function JOe(){return[{formatter:XOe,cellClick:(e,i)=>{const r=i.getRow().getData().tournamentId;if(r){const n=`/${F0}/${r}`;Pm.router.navigate(n)}},field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3}]}function ZOe({providerAbbr:t}){const e=s=>console.log("Network error",{error:s});let i;const r=({providerAbbr:s})=>{setTimeout(()=>{const u=c=>{var d;return((d=c==null?void 0:c.data)==null?void 0:d.calendar)&&i.replaceData(c.data.calendar)};G1({providerAbbr:s}).then(u,e)},1e3)},n=JOe(),a=s=>{qD({anchorId:lE});const l=document.getElementById(lE);i=new $b(l,{height:window.innerHeight*.9,placeholder:"No tournaments",index:"tournament.tournamentId",headerVisible:!1,layout:"fitColumns",reactiveData:!0,data:s,columns:n}),i.on("tableBuilt",()=>{KOe(i)})},o=s=>{s.tournaments.sort((l,u)=>new Date(u.tournament.startDate).getTime()-new Date(l.tournament.startDate).getTime()),a(s.tournaments)};if(t){const s=l=>{var u;(u=l==null?void 0:l.data)!=null&&u.calendar&&o(l.data.calendar)};G1({providerAbbr:t}).then(s,e)}return{table:i,replaceTableData:r}}function QOe({startDate:t,endDate:e}){const i=new Date(t),r=new Date(e),n=["January","February","March","April","May","June","July","August","September","October","November","December"],a=i.getDate()===r.getDate(),o=i.getFullYear()===r.getFullYear(),s=o&&i.getMonth()===r.getMonth(),l=u=>[u.getFullYear(),u.getMonth()+1,u.getDate()].join("/");return a&&o&&s?`${n[i.getMonth()]} ${i.getDate()}, ${i.getFullYear()}`:o&&s?`${n[i.getMonth()]} ${i.getDate()}-${r.getDate()}, ${i.getFullYear()}`:o?`${n[i.getMonth()]} ${i.getDate()} - ${n[r.getMonth()]} ${r.getDate()}, ${i.getFullYear()}`:`${l(i)} - ${l(r)}`}async function eke(t){var o,s,l,u,c;const e=document.getElementById(Zre);Hp(e);const i=((o=t==null?void 0:t.data)==null?void 0:o.tournamentInfo)??{},r=(s=i.onlineResources)==null?void 0:s.find(d=>d.name==="tournamentImage"),n=document.getElementById(Qj);if(r!=null&&r.identifier?n.innerHTML=`<img src="${r.identifier}" alt="${i.name}" style="max-height: 20em" />`:Hp(n),i.tournamentName){const d=document.getElementById(Jj),p=`<h1>${i.tournamentName}</h1>`,m=`<h2>${QOe(i)}</h2>`;d.innerHTML=`${p}${m}`}const a=document.getElementById(Jv("Info"));if(i.notes?(a.innerHTML=i.notes,z1("Info"),MC("Info")):(Hp(a),NC("Info")),(l=i.eventInfo)!=null&&l.length){const d=i.tournamentId,p=document.getElementById(Jv("Events"));Hp(p);const m=document.createElement("div"),h=document.createElement("div");h.id="flightDisplay";const f=i.eventInfo.map(({eventId:b,eventName:S})=>({onClick:()=>Dj({tournamentId:d,eventId:b,header:m,flightDisplay:h,displayFormat:"roundsColumns"}),label:S,close:!0})),g={label:i.eventInfo[0].eventName,options:f,id:"eventButton",modifyLabel:!0,selection:!0,location:Hd},y=tm({button:g,stateChange:()=>{var b,S;(b=document.getElementById("structureButton"))==null||b.remove(),(S=document.getElementById("flightButton"))==null||S.remove()}}),I=i.eventInfo[0].eventId;m.className="block",m.appendChild(y),p.appendChild(m),p.appendChild(h),Dj({tournamentId:d,eventId:I,header:m,flightDisplay:h,displayFormat:"roundsColumns"}),MC("Events"),Pm.tab||z1("Events")}else NC("Events");if((c=(u=i.publishState)==null?void 0:u.orderOfPlay)!=null&&c.published){const d=document.getElementById(Jv("Schedule")),p=document.createElement("div");p.style.width="100%",p.className="block",p.id="scheduleHeader",d.appendChild(p);const m=document.createElement("div");m.id="tournamentSchedule",d.appendChild(m),MC("Schedule")}else NC("Schedule")}const tke=""+new URL("courthive-transparent-logo-ScJ-jfxv.png",import.meta.url).href;function ike(){document.querySelector(`#${Sy}`).innerHTML=`
  <div>
    <a href="https://courthive.com" target="_blank">
      <img src="${tke}" class="logo" alt="Vite logo" />
    </a>
    <h1 class="name">CourtHive</h1>
  </div>
`}var rke=/([:*])(\w+)/g,nke="([^/]+)",ake=/\*/g,oke="?(?:.*)",ske=/\/\?/g,lke="/?([^/]+|)",uke="(?:/^|^)",cke="";function Hre(t){return t===void 0&&(t="/"),hB()?location.pathname+location.search+location.hash:t}function Wr(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function O0(t){return typeof t=="string"}function dke(t){return typeof t=="function"}function k0(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function pke(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,r,n){return i===null&&(i={}),i[e[n]]=decodeURIComponent(r),i},null)}function x0(t){var e=Wr(t).split(/\?(.*)?$/);return[Wr(e[0]),e.slice(1).join("")]}function mB(t){for(var e={},i=t.split("&"),r=0;r<i.length;r++){var n=i[r].split("=");if(n[0]!==""){var a=decodeURIComponent(n[0]);e[a]?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(decodeURIComponent(n[1]||""))):e[a]=decodeURIComponent(n[1]||"")}}return e}function zre(t,e){var i=x0(Wr(t.currentLocationPath)),r=i[0],n=i[1],a=n===""?null:mB(n),o=[],s;if(O0(e.path)){if(s=uke+Wr(e.path).replace(rke,function(d,p,m){return o.push(m),nke}).replace(ake,oke).replace(ske,lke)+"$",Wr(e.path)===""&&Wr(r)==="")return{url:r,queryString:n,hashString:k0(t.to),route:e,data:null,params:a}}else s=e.path;var l=new RegExp(s,cke),u=r.match(l);if(u){var c=O0(e.path)?pke(u,o):u.groups?u.groups:u.slice(1);return{url:Wr(r.replace(new RegExp("^"+t.instance.root),"")),queryString:n,hashString:k0(t.to),route:e,data:c,params:a}}return!1}function Wre(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function Hh(t,e){return typeof t[e]>"u"||t[e]===!0}function mke(t){if(!t)return{};var e=t.split(","),i={},r;return e.forEach(function(n){var a=n.split(":").map(function(o){return o.replace(/(^ +| +$)/g,"")});switch(a[0]){case"historyAPIMethod":i.historyAPIMethod=a[1];break;case"resolveOptionsStrategy":r||(r={}),r.strategy=a[1];break;case"resolveOptionsHash":r||(r={}),r.hash=a[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[a[0]]=a[1]==="true";break}}),r&&(i.resolveOptions=r),i}function hB(){return typeof window<"u"}function hke(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(r){i[r]&&(e[r]||(e[r]=[]),e[r].push(i[r]))})}),e}function du(t,e,i){var r=e||{},n=0;(function a(){if(!t[n]){i&&i(r);return}Array.isArray(t[n])?(t.splice.apply(t,[n,1].concat(t[n][0](r)?t[n][1]:t[n][2])),a()):t[n](r,function(o){typeof o>"u"||o===!0?(n+=1,a()):i&&i(r)})})()}du.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function zj(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=Hre(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function oE(t,e){for(var i=0;i<t.instance.routes.length;i++){var r=t.instance.routes[i],n=zre(t,r);if(n&&(t.matches||(t.matches=[]),t.matches.push(n),t.resolveOptions.strategy==="ONE")){e();return}}e()}function fke(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function gke(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var Wj=hB(),vke=Wre();function Ike(t,e){if(Hh(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),r=Wj&&t.resolveOptions&&t.resolveOptions.hash===!0;vke?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",r?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!r){var n=location.hash;location.hash="",location.hash=n}t.instance.__freezeListening=!1},1))):Wj&&(window.location.href=t.to)}e()}function qre(t,e){var i=t.instance;if(!i.lastResolved()){e();return}du(i.lastResolved().map(function(r){return function(n,a){if(!r.route.hooks||!r.route.hooks.leave){a();return}var o=!1,s=t.instance.matchLocation(r.route.path,t.currentLocationPath,!1);if(r.route.path!=="*")o=!s;else{var l=t.matches?t.matches.find(function(u){return r.route.path===u.route.path}):!1;o=!l}if(Hh(t.navigateOptions,"callHooks")&&o){du(r.route.hooks.leave.map(function(u){return function(c,d){return u(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return a()}]));return}else a()}}),{},function(){return e()})}function yke(t,e){t.match.route.hooks&&t.match.route.hooks.before&&Hh(t.navigateOptions,"callHooks")?du(t.match.route.hooks.before.map(function(i){return function(n,a){return i(function(o){o===!1?t.instance.__markAsClean(t):a()},t.match)}}).concat([function(){return e()}])):e()}function bke(t,e){Hh(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function wke(t,e){t.match.route.hooks&&t.match.route.hooks.after&&Hh(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function Uke(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(r){r.route.hooks&&r.route.hooks.already&&Hh(t.navigateOptions,"callHooks")&&r.route.hooks.already.forEach(function(n){return n(t.match)})}),e(!1);return}e()}function Ske(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var r=x0(t.currentLocationPath),n=r[0],a=r[1],o=k0(t.to);i.path=Wr(n);var s={url:i.path,queryString:a,hashString:o,data:null,route:i,params:a!==""?mB(a):null};t.matches=[s],t.match=s}e()}function Tke(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function Dke(t,e){t.instance._setCurrent(null),e()}function Yre(t,e){Hh(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var Kre=[Uke,yke,bke,wke],qj=[qre,Ske,du.if(function(t){var e=t.notFoundHandled;return e},Kre.concat([Yre]),[Tke,Dke])];function QM(){return QM=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},QM.apply(this,arguments)}function Yj(t,e){var i=0;function r(){if(i===t.matches.length){Yre(t,e);return}du(Kre,QM({},t,{match:t.matches[i]}),function(){i+=1,r()})}qre(t,r)}function sE(t){t.instance.__markAsClean(t)}function eN(){return eN=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},eN.apply(this,arguments)}var Kj="[data-navigo]";function Pke(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:Kj},r=this,n="/",a=null,o=[],s=!1,l,u=Wre(),c=hB();t?n=Wr(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d(F){return F.indexOf("#")>=0&&(i.hash===!0?F=F.split("#")[1]||"/":F=F.split("#")[0]),F}function p(F){return Wr(n+"/"+Wr(F))}function m(F,$,_,L){return F=O0(F)?p(F):F,{name:L||Wr(String(F)),path:F,handler:$,hooks:hke(_)}}function h(F,$,_){var L=this;return typeof F=="object"&&!(F instanceof RegExp)?(Object.keys(F).forEach(function(B){if(typeof F[B]=="function")L.on(B,F[B]);else{var V=F[B],G=V.uses,j=V.as,z=V.hooks;o.push(m(B,G,[l,z],j))}}),this):(typeof F=="function"&&(_=$,$=F,F=n),o.push(m(F,$,[l,_])),this)}function f(F,$){if(r.__dirty){r.__waiting.push(function(){return r.resolve(F,$)});return}else r.__dirty=!0;F=F?Wr(n)+"/"+Wr(F):void 0;var _={instance:r,to:F,currentLocationPath:F,navigateOptions:{},resolveOptions:eN({},i,$)};return du([zj,oE,du.if(function(L){var B=L.matches;return B&&B.length>0},Yj,qj)],_,sE),_.matches?_.matches:!1}function g(F,$){if(r.__dirty){r.__waiting.push(function(){return r.navigate(F,$)});return}else r.__dirty=!0;F=Wr(n)+"/"+Wr(F);var _={instance:r,to:F,navigateOptions:$||{},resolveOptions:$&&$.resolveOptions?$.resolveOptions:i,currentLocationPath:d(F)};du([fke,gke,oE,du.if(function(L){var B=L.matches;return B&&B.length>0},Yj,qj),Ike,sE],_,sE)}function v(F,$,_){var L=C(F,$);return L!==null?(g(L.replace(new RegExp("^/?"+n),""),_),!0):!1}function y(F){return this.routes=o=o.filter(function($){return O0(F)?Wr($.path)!==Wr(F):dke(F)?F!==$.handler:String($.path)!==String(F)}),this}function I(){u&&(this.__popstateListener=function(){r.__freezeListening||f()},window.addEventListener("popstate",this.__popstateListener))}function b(){this.routes=o=[],u&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=s=!0}function S(F,$){return r._notFoundRoute=m("*",F,[l,$],"__NOT_FOUND__"),this}function w(){if(c)return U().forEach(function(F){if(F.getAttribute("data-navigo")==="false"||F.getAttribute("target")==="_blank"){F.hasListenerAttached&&F.removeEventListener("click",F.navigoHandler);return}F.hasListenerAttached||(F.hasListenerAttached=!0,F.navigoHandler=function($){if(($.ctrlKey||$.metaKey)&&$.target.tagName.toLowerCase()==="a")return!1;var _=F.getAttribute("href");if(typeof _>"u"||_===null)return!1;if(_.match(/^(http|https)/)&&typeof URL<"u")try{var L=new URL(_);_=L.pathname+L.search}catch{}var B=mke(F.getAttribute("data-navigo-options"));s||($.preventDefault(),$.stopPropagation(),r.navigate(Wr(_),B))},F.addEventListener("click",F.navigoHandler))}),r}function U(){return c?[].slice.call(document.querySelectorAll(i.linksSelector||Kj)):[]}function T(F){return"/"+n+"/"+Wr(F)}function D(F){return l=F,this}function P(){return a}function C(F,$,_){var L=o.find(function(G){return G.name===F}),B=null;if(L){if(B=L.path,$)for(var V in $)B=B.replace(":"+V,$[V]);B=B.match(/^\//)?B:"/"+B}return B&&_&&!_.includeRoot&&(B=B.replace(new RegExp("^/"+n),"")),B}function R(F){return F.getAttribute("href")}function N(F){var $=x0(Wr(F)),_=$[0],L=$[1],B=L===""?null:mB(L),V=k0(F),G=m(_,function(){},[l],_);return{url:_,queryString:L,hashString:V,route:G,data:null,params:B}}function A(){return N(Wr(Hre(n)).replace(new RegExp("^"+n),""))}function M(F){var $={instance:r,currentLocationPath:F,to:F,navigateOptions:{},resolveOptions:i};return oE($,function(){}),$.matches?$.matches:!1}function E(F,$,_){typeof $<"u"&&(typeof _>"u"||_)&&($=p($));var L={instance:r,to:$,currentLocationPath:$};zj(L,function(){}),typeof F=="string"&&(F=typeof _>"u"||_?p(F):F);var B=zre(L,{name:String(F),path:F,handler:function(){},hooks:{}});return B||!1}function O(F,$,_){return typeof $=="string"&&($=k($)),$?($.hooks[F]||($.hooks[F]=[]),$.hooks[F].push(_),function(){$.hooks[F]=$.hooks[F].filter(function(L){return L!==_})}):(console.warn("Route doesn't exists: "+$),function(){})}function k(F){return typeof F=="string"?o.find(function($){return $.name===p(F)}):o.find(function($){return $.handler===F})}function x(F){F.instance.__dirty=!1,F.instance.__waiting.length>0&&F.instance.__waiting.shift()()}this.root=n,this.routes=o,this.destroyed=s,this.current=a,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=x,this.on=h,this.off=y,this.resolve=f,this.navigate=g,this.navigateByName=v,this.destroy=b,this.notFound=S,this.updatePageLinks=w,this.link=T,this.hooks=D,this.extractGETParameters=function(F){return x0(d(F))},this.lastResolved=P,this.generate=C,this.getLinkPath=R,this.match=M,this.matchLocation=E,this.getCurrentLocation=A,this.addBeforeHook=O.bind(this,"before"),this.addAfterHook=O.bind(this,"after"),this.addAlreadyHook=O.bind(this,"already"),this.addLeaveHook=O.bind(this,"leave"),this.getRoute=k,this._pathToMatchObject=N,this._clean=Wr,this._checkForAHash=d,this._setCurrent=function(F){return a=r.current=F},I.call(this),w.call(this)}var Rke={};function Cke(){window.location.host.startsWith("localhost")||Rke.PUBLIC_URL;const t=document.getElementById("back"),e=!0,i=new Pke("/",{hash:e});return i.on("/",()=>{t.style.display="none",HU(Sy),ike()}),i.on("/tournaments/:providerAbbr",({data:r})=>{t.style.display="none";const n=r.providerAbbr.toUpperCase();HU(tN),ZOe({providerAbbr:n})}),i.on("/tournament/:tournamentId",({data:r})=>{t.style.display="block";const n=r.tournamentId;Pm.tournamentId=n,HU(F0),Z7({tournamentId:n}).then(eke)}),i.notFound(()=>{i.navigate("/")}),i.resolve(),i}const Eke=document.body;Eke.appendChild(Bye());ibe();Pm.router=Cke();
//# sourceMappingURL=index-CnenlQ9r.js.map
