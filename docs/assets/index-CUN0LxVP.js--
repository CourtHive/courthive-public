var Eme=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Stt=Eme((iit,Gy)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const L6="tournament_title_block",_6="tournaments_control",vO="tournaments_table",Rme="tournament_events",$6="tournament_logo",r1="tournaments",aR="tournament",Vw="splash",Cme=[r1,aR,Vw],Lt=t=>typeof t=="string",Uy=()=>{let t,e;const i=new Promise((r,n)=>{t=r,e=n});return i.resolve=t,i.reject=e,i},lW=t=>t==null?"":""+t,Mme=(t,e,i)=>{t.forEach(r=>{e[r]&&(i[r]=e[r])})},Nme=/###/g,uW=t=>t&&t.indexOf("###")>-1?t.replace(Nme,"."):t,cW=t=>!t||Lt(t),Hy=(t,e,i)=>{const r=Lt(e)?e.split("."):e;let n=0;for(;n<r.length-1;){if(cW(t))return{};const a=uW(r[n]);!t[a]&&i&&(t[a]=new i),Object.prototype.hasOwnProperty.call(t,a)?t=t[a]:t={},++n}return cW(t)?{}:{obj:t,k:uW(r[n])}},dW=(t,e,i)=>{const{obj:r,k:n}=Hy(t,e,Object);if(r!==void 0||e.length===1){r[n]=i;return}let a=e[e.length-1],s=e.slice(0,e.length-1),o=Hy(t,s,Object);for(;o.obj===void 0&&s.length;)a=`${s[s.length-1]}.${a}`,s=s.slice(0,s.length-1),o=Hy(t,s,Object),o?.obj&&typeof o.obj[`${o.k}.${a}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${a}`]=i},Ame=(t,e,i,r)=>{const{obj:n,k:a}=Hy(t,e,Object);n[a]=n[a]||[],n[a].push(i)},JD=(t,e)=>{const{obj:i,k:r}=Hy(t,e);if(i&&Object.prototype.hasOwnProperty.call(i,r))return i[r]},kme=(t,e,i)=>{const r=JD(t,i);return r!==void 0?r:JD(e,i)},B6=(t,e,i)=>{for(const r in e)r!=="__proto__"&&r!=="constructor"&&(r in t?Lt(t[r])||t[r]instanceof String||Lt(e[r])||e[r]instanceof String?i&&(t[r]=e[r]):B6(t[r],e[r],i):t[r]=e[r]);return t},$f=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var Ome={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const xme=t=>Lt(t)?t.replace(/[&<>"'\/]/g,e=>Ome[e]):t;class Fme{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const i=this.regExpMap.get(e);if(i!==void 0)return i;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}const Lme=[" ",",","?","!",";"],_me=new Fme(20),$me=(t,e,i)=>{e=e||"",i=i||"";const r=Lme.filter(s=>e.indexOf(s)<0&&i.indexOf(s)<0);if(r.length===0)return!0;const n=_me.getRegExp(`(${r.map(s=>s==="?"?"\\?":s).join("|")})`);let a=!n.test(t);if(!a){const s=t.indexOf(i);s>0&&!n.test(t.substring(0,s))&&(a=!0)}return a},yO=(t,e,i=".")=>{if(!t)return;if(t[e])return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0;const r=e.split(i);let n=t;for(let a=0;a<r.length;){if(!n||typeof n!="object")return;let s,o="";for(let l=a;l<r.length;++l)if(l!==a&&(o+=i),o+=r[l],s=n[o],s!==void 0){if(["string","number","boolean"].indexOf(typeof s)>-1&&l<r.length-1)continue;a+=l-a+1;break}n=s}return n},Pb=t=>t?.replace("_","-"),Bme={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){console?.[t]?.apply?.(console,e)}};class QD{constructor(e,i={}){this.init(e,i)}init(e,i={}){this.prefix=i.prefix||"i18next:",this.logger=e||Bme,this.options=i,this.debug=i.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,i,r,n){return n&&!this.debug?null:(Lt(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[i](e))}create(e){return new QD(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new QD(this.logger,e)}}var Ku=new QD;class sR{constructor(){this.observers={}}on(e,i){return e.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const n=this.observers[r].get(i)||0;this.observers[r].set(i,n+1)}),this}off(e,i){if(this.observers[e]){if(!i){delete this.observers[e];return}this.observers[e].delete(i)}}emit(e,...i){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([n,a])=>{for(let s=0;s<a;s++)n(...i)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([n,a])=>{for(let s=0;s<a;s++)n.apply(n,[e,...i])})}}class pW extends sR{constructor(e,i={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=i,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const i=this.options.ns.indexOf(e);i>-1&&this.options.ns.splice(i,1)}getResource(e,i,r,n={}){const a=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,s=n.ignoreJSONStructure!==void 0?n.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;e.indexOf(".")>-1?o=e.split("."):(o=[e,i],r&&(Array.isArray(r)?o.push(...r):Lt(r)&&a?o.push(...r.split(a)):o.push(r)));const l=JD(this.data,o);return!l&&!i&&!r&&e.indexOf(".")>-1&&(e=o[0],i=o[1],r=o.slice(2).join(".")),l||!s||!Lt(r)?l:yO(this.data?.[e]?.[i],r,a)}addResource(e,i,r,n,a={silent:!1}){const s=a.keySeparator!==void 0?a.keySeparator:this.options.keySeparator;let o=[e,i];r&&(o=o.concat(s?r.split(s):r)),e.indexOf(".")>-1&&(o=e.split("."),n=i,i=o[1]),this.addNamespaces(i),dW(this.data,o,n),a.silent||this.emit("added",e,i,r,n)}addResources(e,i,r,n={silent:!1}){for(const a in r)(Lt(r[a])||Array.isArray(r[a]))&&this.addResource(e,i,a,r[a],{silent:!0});n.silent||this.emit("added",e,i,r)}addResourceBundle(e,i,r,n,a,s={silent:!1,skipCopy:!1}){let o=[e,i];e.indexOf(".")>-1&&(o=e.split("."),n=r,r=i,i=o[1]),this.addNamespaces(i);let l=JD(this.data,o)||{};s.skipCopy||(r=JSON.parse(JSON.stringify(r))),n?B6(l,r,a):l={...l,...r},dW(this.data,o,l),s.silent||this.emit("added",e,i,r)}removeResourceBundle(e,i){this.hasResourceBundle(e,i)&&delete this.data[e][i],this.removeNamespaces(i),this.emit("removed",e,i)}hasResourceBundle(e,i){return this.getResource(e,i)!==void 0}getResourceBundle(e,i){return i||(i=this.options.defaultNS),this.getResource(e,i)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const i=this.getDataByLanguage(e);return!!(i&&Object.keys(i)||[]).find(n=>i[n]&&Object.keys(i[n]).length>0)}toJSON(){return this.data}}var V6={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,i,r,n){return t.forEach(a=>{e=this.processors[a]?.process(e,i,r,n)??e}),e}};const j6=Symbol("i18next/PATH_KEY");function Vme(){const t=[],e=Object.create(null);let i;return e.get=(r,n)=>(i?.revoke?.(),n===j6?t:(t.push(n),i=Proxy.revocable(r,e),i.proxy)),Proxy.revocable(Object.create(null),e).proxy}function bO(t,e){const{[j6]:i}=t(Vme());return i.join(e?.keySeparator??".")}const fW={},XA=t=>!Lt(t)&&typeof t!="boolean"&&typeof t!="number";class ZD extends sR{constructor(e,i={}){super(),Mme(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=i,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Ku.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,i={interpolation:{}}){const r={...i};if(e==null)return!1;const n=this.resolve(e,r);if(n?.res===void 0)return!1;const a=XA(n.res);return!(r.returnObjects===!1&&a)}extractFromKey(e,i){let r=i.nsSeparator!==void 0?i.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const n=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let a=i.ns||this.options.defaultNS||[];const s=r&&e.indexOf(r)>-1,o=!this.options.userDefinedKeySeparator&&!i.keySeparator&&!this.options.userDefinedNsSeparator&&!i.nsSeparator&&!$me(e,r,n);if(s&&!o){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:Lt(a)?[a]:a};const u=e.split(r);(r!==n||r===n&&this.options.ns.indexOf(u[0])>-1)&&(a=u.shift()),e=u.join(n)}return{key:e,namespaces:Lt(a)?[a]:a}}translate(e,i,r){let n=typeof i=="object"?{...i}:i;if(typeof n!="object"&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),typeof n=="object"&&(n={...n}),n||(n={}),e==null)return"";typeof e=="function"&&(e=bO(e,{...this.options,...n})),Array.isArray(e)||(e=[String(e)]);const a=n.returnDetails!==void 0?n.returnDetails:this.options.returnDetails,s=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,{key:o,namespaces:l}=this.extractFromKey(e[e.length-1],n),u=l[l.length-1];let c=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;c===void 0&&(c=":");const d=n.lng||this.language,p=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(d?.toLowerCase()==="cimode")return p?a?{res:`${u}${c}${o}`,usedKey:o,exactUsedKey:o,usedLng:d,usedNS:u,usedParams:this.getUsedParamsDetails(n)}:`${u}${c}${o}`:a?{res:o,usedKey:o,exactUsedKey:o,usedLng:d,usedNS:u,usedParams:this.getUsedParamsDetails(n)}:o;const f=this.resolve(e,n);let h=f?.res;const m=f?.usedKey||o,g=f?.exactUsedKey||o,I=["[object Number]","[object Function]","[object RegExp]"],v=n.joinArrays!==void 0?n.joinArrays:this.options.joinArrays,w=!this.i18nFormat||this.i18nFormat.handleAsObject,y=n.count!==void 0&&!Lt(n.count),b=ZD.hasDefaultValue(n),S=y?this.pluralResolver.getSuffix(d,n.count,n):"",U=n.ordinal&&y?this.pluralResolver.getSuffix(d,n.count,{ordinal:!1}):"",T=y&&!n.ordinal&&n.count===0,D=T&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${S}`]||n[`defaultValue${U}`]||n.defaultValue;let P=h;w&&!h&&b&&(P=D);const E=XA(P),R=Object.prototype.toString.apply(P);if(w&&P&&E&&I.indexOf(R)<0&&!(Lt(v)&&Array.isArray(P))){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const C=this.options.returnedObjectHandler?this.options.returnedObjectHandler(m,P,{...n,ns:l}):`key '${o} (${this.language})' returned an object instead of string.`;return a?(f.res=C,f.usedParams=this.getUsedParamsDetails(n),f):C}if(s){const C=Array.isArray(P),M=C?[]:{},N=C?g:m;for(const A in P)if(Object.prototype.hasOwnProperty.call(P,A)){const O=`${N}${s}${A}`;b&&!h?M[A]=this.translate(O,{...n,defaultValue:XA(D)?D[A]:void 0,joinArrays:!1,ns:l}):M[A]=this.translate(O,{...n,joinArrays:!1,ns:l}),M[A]===O&&(M[A]=P[A])}h=M}}else if(w&&Lt(v)&&Array.isArray(h))h=h.join(v),h&&(h=this.extendTranslation(h,e,n,r));else{let C=!1,M=!1;!this.isValidLookup(h)&&b&&(C=!0,h=D),this.isValidLookup(h)||(M=!0,h=o);const A=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&M?void 0:h,O=b&&D!==h&&this.options.updateMissing;if(M||C||O){if(this.logger.log(O?"updateKey":"missingKey",d,u,o,O?D:h),s){const L=this.resolve(o,{...n,keySeparator:!1});L&&L.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let k=[];const F=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if(this.options.saveMissingTo==="fallback"&&F&&F[0])for(let L=0;L<F.length;L++)k.push(F[L]);else this.options.saveMissingTo==="all"?k=this.languageUtils.toResolveHierarchy(n.lng||this.language):k.push(n.lng||this.language);const x=(L,$,V)=>{const _=b&&V!==h?V:A;this.options.missingKeyHandler?this.options.missingKeyHandler(L,u,$,_,O,n):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(L,u,$,_,O,n),this.emit("missingKey",L,u,$,h)};this.options.saveMissing&&(this.options.saveMissingPlurals&&y?k.forEach(L=>{const $=this.pluralResolver.getSuffixes(L,n);T&&n[`defaultValue${this.options.pluralSeparator}zero`]&&$.indexOf(`${this.options.pluralSeparator}zero`)<0&&$.push(`${this.options.pluralSeparator}zero`),$.forEach(V=>{x([L],o+V,n[`defaultValue${V}`]||D)})}):x(k,o,D))}h=this.extendTranslation(h,e,n,f,r),M&&h===o&&this.options.appendNamespaceToMissingKey&&(h=`${u}${c}${o}`),(M||C)&&this.options.parseMissingKeyHandler&&(h=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${u}${c}${o}`:o,C?h:void 0,n))}return a?(f.res=h,f.usedParams=this.getUsedParamsDetails(n),f):h}extendTranslation(e,i,r,n,a){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const l=Lt(e)&&(r?.interpolation?.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let u;if(l){const d=e.match(this.interpolator.nestingRegexp);u=d&&d.length}let c=r.replace&&!Lt(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(c={...this.options.interpolation.defaultVariables,...c}),e=this.interpolator.interpolate(e,c,r.lng||this.language||n.usedLng,r),l){const d=e.match(this.interpolator.nestingRegexp),p=d&&d.length;u<p&&(r.nest=!1)}!r.lng&&n&&n.res&&(r.lng=this.language||n.usedLng),r.nest!==!1&&(e=this.interpolator.nest(e,(...d)=>a?.[0]===d[0]&&!r.context?(this.logger.warn(`It seems you are nesting recursively key: ${d[0]} in key: ${i[0]}`),null):this.translate(...d,i),r)),r.interpolation&&this.interpolator.reset()}const s=r.postProcess||this.options.postProcess,o=Lt(s)?[s]:s;return e!=null&&o?.length&&r.applyPostProcessor!==!1&&(e=V6.handle(o,e,i,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...n,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e,i={}){let r,n,a,s,o;return Lt(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(r))return;const u=this.extractFromKey(l,i),c=u.key;n=c;let d=u.namespaces;this.options.fallbackNS&&(d=d.concat(this.options.fallbackNS));const p=i.count!==void 0&&!Lt(i.count),f=p&&!i.ordinal&&i.count===0,h=i.context!==void 0&&(Lt(i.context)||typeof i.context=="number")&&i.context!=="",m=i.lngs?i.lngs:this.languageUtils.toResolveHierarchy(i.lng||this.language,i.fallbackLng);d.forEach(g=>{this.isValidLookup(r)||(o=g,!fW[`${m[0]}-${g}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(o)&&(fW[`${m[0]}-${g}`]=!0,this.logger.warn(`key "${n}" for languages "${m.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),m.forEach(I=>{if(this.isValidLookup(r))return;s=I;const v=[c];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(v,c,I,g,i);else{let y;p&&(y=this.pluralResolver.getSuffix(I,i.count,i));const b=`${this.options.pluralSeparator}zero`,S=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(p&&(i.ordinal&&y.indexOf(S)===0&&v.push(c+y.replace(S,this.options.pluralSeparator)),v.push(c+y),f&&v.push(c+b)),h){const U=`${c}${this.options.contextSeparator||"_"}${i.context}`;v.push(U),p&&(i.ordinal&&y.indexOf(S)===0&&v.push(U+y.replace(S,this.options.pluralSeparator)),v.push(U+y),f&&v.push(U+b))}}let w;for(;w=v.pop();)this.isValidLookup(r)||(a=w,r=this.getResource(I,g,w,i))}))})}),{res:r,usedKey:n,exactUsedKey:a,usedLng:s,usedNS:o}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,i,r,n={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,i,r,n):this.resourceStore.getResource(e,i,r,n)}getUsedParamsDetails(e={}){const i=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!Lt(e.replace);let n=r?e.replace:e;if(r&&typeof e.count<"u"&&(n.count=e.count),this.options.interpolation.defaultVariables&&(n={...this.options.interpolation.defaultVariables,...n}),!r){n={...n};for(const a of i)delete n[a]}return n}static hasDefaultValue(e){const i="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&i===r.substring(0,i.length)&&e[r]!==void 0)return!0;return!1}}class hW{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Ku.create("languageUtils")}getScriptPartFromCode(e){if(e=Pb(e),!e||e.indexOf("-")<0)return null;const i=e.split("-");return i.length===2||(i.pop(),i[i.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(i.join("-"))}getLanguagePartFromCode(e){if(e=Pb(e),!e||e.indexOf("-")<0)return e;const i=e.split("-");return this.formatLanguageCode(i[0])}formatLanguageCode(e){if(Lt(e)&&e.indexOf("-")>-1){let i;try{i=Intl.getCanonicalLocales(e)[0]}catch{}return i&&this.options.lowerCaseLng&&(i=i.toLowerCase()),i||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let i;return e.forEach(r=>{if(i)return;const n=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(n))&&(i=n)}),!i&&this.options.supportedLngs&&e.forEach(r=>{if(i)return;const n=this.getScriptPartFromCode(r);if(this.isSupportedCode(n))return i=n;const a=this.getLanguagePartFromCode(r);if(this.isSupportedCode(a))return i=a;i=this.options.supportedLngs.find(s=>{if(s===a)return s;if(!(s.indexOf("-")<0&&a.indexOf("-")<0)&&(s.indexOf("-")>0&&a.indexOf("-")<0&&s.substring(0,s.indexOf("-"))===a||s.indexOf(a)===0&&a.length>1))return s})}),i||(i=this.getFallbackCodes(this.options.fallbackLng)[0]),i}getFallbackCodes(e,i){if(!e)return[];if(typeof e=="function"&&(e=e(i)),Lt(e)&&(e=[e]),Array.isArray(e))return e;if(!i)return e.default||[];let r=e[i];return r||(r=e[this.getScriptPartFromCode(i)]),r||(r=e[this.formatLanguageCode(i)]),r||(r=e[this.getLanguagePartFromCode(i)]),r||(r=e.default),r||[]}toResolveHierarchy(e,i){const r=this.getFallbackCodes((i===!1?[]:i)||this.options.fallbackLng||[],e),n=[],a=s=>{s&&(this.isSupportedCode(s)?n.push(s):this.logger.warn(`rejecting language code not found in supportedLngs: ${s}`))};return Lt(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&a(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&a(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&a(this.getLanguagePartFromCode(e))):Lt(e)&&a(this.formatLanguageCode(e)),r.forEach(s=>{n.indexOf(s)<0&&a(this.formatLanguageCode(s))}),n}}const mW={zero:0,one:1,two:2,few:3,many:4,other:5},gW={select:t=>t===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class jme{constructor(e,i={}){this.languageUtils=e,this.options=i,this.logger=Ku.create("pluralResolver"),this.pluralRulesCache={}}clearCache(){this.pluralRulesCache={}}getRule(e,i={}){const r=Pb(e==="dev"?"en":e),n=i.ordinal?"ordinal":"cardinal",a=JSON.stringify({cleanedCode:r,type:n});if(a in this.pluralRulesCache)return this.pluralRulesCache[a];let s;try{s=new Intl.PluralRules(r,{type:n})}catch{if(typeof Intl>"u")return this.logger.error("No Intl support, please use an Intl polyfill!"),gW;if(!e.match(/-|_/))return gW;const l=this.languageUtils.getLanguagePartFromCode(e);s=this.getRule(l,i)}return this.pluralRulesCache[a]=s,s}needsPlural(e,i={}){let r=this.getRule(e,i);return r||(r=this.getRule("dev",i)),r?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,i,r={}){return this.getSuffixes(e,r).map(n=>`${i}${n}`)}getSuffixes(e,i={}){let r=this.getRule(e,i);return r||(r=this.getRule("dev",i)),r?r.resolvedOptions().pluralCategories.sort((n,a)=>mW[n]-mW[a]).map(n=>`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${n}`):[]}getSuffix(e,i,r={}){const n=this.getRule(e,r);return n?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${n.select(i)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",i,r))}}const IW=(t,e,i,r=".",n=!0)=>{let a=kme(t,e,i);return!a&&n&&Lt(i)&&(a=yO(t,i,r),a===void 0&&(a=yO(e,i,r))),a},JA=t=>t.replace(/\$/g,"$$$$");class vW{constructor(e={}){this.logger=Ku.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(i=>i),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:i,escapeValue:r,useRawValueToEscape:n,prefix:a,prefixEscaped:s,suffix:o,suffixEscaped:l,formatSeparator:u,unescapeSuffix:c,unescapePrefix:d,nestingPrefix:p,nestingPrefixEscaped:f,nestingSuffix:h,nestingSuffixEscaped:m,nestingOptionsSeparator:g,maxReplaces:I,alwaysFormat:v}=e.interpolation;this.escape=i!==void 0?i:xme,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=n!==void 0?n:!1,this.prefix=a?$f(a):s||"{{",this.suffix=o?$f(o):l||"}}",this.formatSeparator=u||",",this.unescapePrefix=c?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=p?$f(p):f||$f("$t("),this.nestingSuffix=h?$f(h):m||$f(")"),this.nestingOptionsSeparator=g||",",this.maxReplaces=I||1e3,this.alwaysFormat=v!==void 0?v:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(i,r)=>i?.source===r?(i.lastIndex=0,i):new RegExp(r,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,i,r,n){let a,s,o;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},u=f=>{if(f.indexOf(this.formatSeparator)<0){const I=IW(i,l,f,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(I,void 0,r,{...n,...i,interpolationkey:f}):I}const h=f.split(this.formatSeparator),m=h.shift().trim(),g=h.join(this.formatSeparator).trim();return this.format(IW(i,l,m,this.options.keySeparator,this.options.ignoreJSONStructure),g,r,{...n,...i,interpolationkey:m})};this.resetRegExp();const c=n?.missingInterpolationHandler||this.options.missingInterpolationHandler,d=n?.interpolation?.skipOnVariables!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:f=>JA(f)},{regex:this.regexp,safeValue:f=>this.escapeValue?JA(this.escape(f)):JA(f)}].forEach(f=>{for(o=0;a=f.regex.exec(e);){const h=a[1].trim();if(s=u(h),s===void 0)if(typeof c=="function"){const g=c(e,a,n);s=Lt(g)?g:""}else if(n&&Object.prototype.hasOwnProperty.call(n,h))s="";else if(d){s=a[0];continue}else this.logger.warn(`missed to pass in variable ${h} for interpolating ${e}`),s="";else!Lt(s)&&!this.useRawValueToEscape&&(s=lW(s));const m=f.safeValue(s);if(e=e.replace(a[0],m),d?(f.regex.lastIndex+=s.length,f.regex.lastIndex-=a[0].length):f.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),e}nest(e,i,r={}){let n,a,s;const o=(l,u)=>{const c=this.nestingOptionsSeparator;if(l.indexOf(c)<0)return l;const d=l.split(new RegExp(`${$f(c)}[ ]*{`));let p=`{${d[1]}`;l=d[0],p=this.interpolate(p,s);const f=p.match(/'/g),h=p.match(/"/g);((f?.length??0)%2===0&&!h||(h?.length??0)%2!==0)&&(p=p.replace(/'/g,'"'));try{s=JSON.parse(p),u&&(s={...u,...s})}catch(m){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,m),`${l}${c}${p}`}return s.defaultValue&&s.defaultValue.indexOf(this.prefix)>-1&&delete s.defaultValue,l};for(;n=this.nestingRegexp.exec(e);){let l=[];s={...r},s=s.replace&&!Lt(s.replace)?s.replace:s,s.applyPostProcessor=!1,delete s.defaultValue;const u=/{.*}/.test(n[1])?n[1].lastIndexOf("}")+1:n[1].indexOf(this.formatSeparator);if(u!==-1&&(l=n[1].slice(u).split(this.formatSeparator).map(c=>c.trim()).filter(Boolean),n[1]=n[1].slice(0,u)),a=i(o.call(this,n[1].trim(),s),s),a&&n[0]===e&&!Lt(a))return a;Lt(a)||(a=lW(a)),a||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${e}`),a=""),l.length&&(a=l.reduce((c,d)=>this.format(c,d,r.lng,{...r,interpolationkey:n[1].trim()}),a.trim())),e=e.replace(n[0],a),this.regexp.lastIndex=0}return e}}const Gme=t=>{let e=t.toLowerCase().trim();const i={};if(t.indexOf("(")>-1){const r=t.split("(");e=r[0].toLowerCase().trim();const n=r[1].substring(0,r[1].length-1);e==="currency"&&n.indexOf(":")<0?i.currency||(i.currency=n.trim()):e==="relativetime"&&n.indexOf(":")<0?i.range||(i.range=n.trim()):n.split(";").forEach(s=>{if(s){const[o,...l]=s.split(":"),u=l.join(":").trim().replace(/^'+|'+$/g,""),c=o.trim();i[c]||(i[c]=u),u==="false"&&(i[c]=!1),u==="true"&&(i[c]=!0),isNaN(u)||(i[c]=parseInt(u,10))}})}return{formatName:e,formatOptions:i}},yW=t=>{const e={};return(i,r,n)=>{let a=n;n&&n.interpolationkey&&n.formatParams&&n.formatParams[n.interpolationkey]&&n[n.interpolationkey]&&(a={...a,[n.interpolationkey]:void 0});const s=r+JSON.stringify(a);let o=e[s];return o||(o=t(Pb(r),n),e[s]=o),o(i)}},Hme=t=>(e,i,r)=>t(Pb(i),r)(e);class Wme{constructor(e={}){this.logger=Ku.create("formatter"),this.options=e,this.init(e)}init(e,i={interpolation:{}}){this.formatSeparator=i.interpolation.formatSeparator||",";const r=i.cacheInBuiltFormats?yW:Hme;this.formats={number:r((n,a)=>{const s=new Intl.NumberFormat(n,{...a});return o=>s.format(o)}),currency:r((n,a)=>{const s=new Intl.NumberFormat(n,{...a,style:"currency"});return o=>s.format(o)}),datetime:r((n,a)=>{const s=new Intl.DateTimeFormat(n,{...a});return o=>s.format(o)}),relativetime:r((n,a)=>{const s=new Intl.RelativeTimeFormat(n,{...a});return o=>s.format(o,a.range||"day")}),list:r((n,a)=>{const s=new Intl.ListFormat(n,{...a});return o=>s.format(o)})}}add(e,i){this.formats[e.toLowerCase().trim()]=i}addCached(e,i){this.formats[e.toLowerCase().trim()]=yW(i)}format(e,i,r,n={}){const a=i.split(this.formatSeparator);if(a.length>1&&a[0].indexOf("(")>1&&a[0].indexOf(")")<0&&a.find(o=>o.indexOf(")")>-1)){const o=a.findIndex(l=>l.indexOf(")")>-1);a[0]=[a[0],...a.splice(1,o)].join(this.formatSeparator)}return a.reduce((o,l)=>{const{formatName:u,formatOptions:c}=Gme(l);if(this.formats[u]){let d=o;try{const p=n?.formatParams?.[n.interpolationkey]||{},f=p.locale||p.lng||n.locale||n.lng||r;d=this.formats[u](o,f,{...c,...n,...p})}catch(p){this.logger.warn(p)}return d}else this.logger.warn(`there was no format function for ${u}`);return o},e)}}const zme=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class qme extends sR{constructor(e,i,r,n={}){super(),this.backend=e,this.store=i,this.services=r,this.languageUtils=r.languageUtils,this.options=n,this.logger=Ku.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=n.maxParallelReads||10,this.readingCalls=0,this.maxRetries=n.maxRetries>=0?n.maxRetries:5,this.retryTimeout=n.retryTimeout>=1?n.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(r,n.backend,n)}queueLoad(e,i,r,n){const a={},s={},o={},l={};return e.forEach(u=>{let c=!0;i.forEach(d=>{const p=`${u}|${d}`;!r.reload&&this.store.hasResourceBundle(u,d)?this.state[p]=2:this.state[p]<0||(this.state[p]===1?s[p]===void 0&&(s[p]=!0):(this.state[p]=1,c=!1,s[p]===void 0&&(s[p]=!0),a[p]===void 0&&(a[p]=!0),l[d]===void 0&&(l[d]=!0)))}),c||(o[u]=!0)}),(Object.keys(a).length||Object.keys(s).length)&&this.queue.push({pending:s,pendingCount:Object.keys(s).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(a),pending:Object.keys(s),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}loaded(e,i,r){const n=e.split("|"),a=n[0],s=n[1];i&&this.emit("failedLoading",a,s,i),!i&&r&&this.store.addResourceBundle(a,s,r,void 0,void 0,{skipCopy:!0}),this.state[e]=i?-1:2,i&&r&&(this.state[e]=0);const o={};this.queue.forEach(l=>{Ame(l.loaded,[a],s),zme(l,e),i&&l.errors.push(i),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(u=>{o[u]||(o[u]={});const c=l.loaded[u];c.length&&c.forEach(d=>{o[u][d]===void 0&&(o[u][d]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(l=>!l.done)}read(e,i,r,n=0,a=this.retryTimeout,s){if(!e.length)return s(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:i,fcName:r,tried:n,wait:a,callback:s});return}this.readingCalls++;const o=(u,c)=>{if(this.readingCalls--,this.waitingReads.length>0){const d=this.waitingReads.shift();this.read(d.lng,d.ns,d.fcName,d.tried,d.wait,d.callback)}if(u&&c&&n<this.maxRetries){setTimeout(()=>{this.read.call(this,e,i,r,n+1,a*2,s)},a);return}s(u,c)},l=this.backend[r].bind(this.backend);if(l.length===2){try{const u=l(e,i);u&&typeof u.then=="function"?u.then(c=>o(null,c)).catch(o):o(null,u)}catch(u){o(u)}return}return l(e,i,o)}prepareLoading(e,i,r={},n){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();Lt(e)&&(e=this.languageUtils.toResolveHierarchy(e)),Lt(i)&&(i=[i]);const a=this.queueLoad(e,i,r,n);if(!a.toLoad.length)return a.pending.length||n(),null;a.toLoad.forEach(s=>{this.loadOne(s)})}load(e,i,r){this.prepareLoading(e,i,{},r)}reload(e,i,r){this.prepareLoading(e,i,{reload:!0},r)}loadOne(e,i=""){const r=e.split("|"),n=r[0],a=r[1];this.read(n,a,"read",void 0,void 0,(s,o)=>{s&&this.logger.warn(`${i}loading namespace ${a} for language ${n} failed`,s),!s&&o&&this.logger.log(`${i}loaded namespace ${a} for language ${n}`,o),this.loaded(e,s,o)})}saveMissing(e,i,r,n,a,s={},o=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(i)){this.logger.warn(`did not save key "${r}" as the namespace "${i}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if(this.backend?.create){const l={...s,isUpdate:a},u=this.backend.create.bind(this.backend);if(u.length<6)try{let c;u.length===5?c=u(e,i,r,n,l):c=u(e,i,r,n),c&&typeof c.then=="function"?c.then(d=>o(null,d)).catch(o):o(null,c)}catch(c){o(c)}else u(e,i,r,n,o,l)}!e||!e[0]||this.store.addResource(e[0],i,r,n)}}}const QA=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),Lt(t[1])&&(e.defaultValue=t[1]),Lt(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const i=t[3]||t[2];Object.keys(i).forEach(r=>{e[r]=i[r]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),bW=t=>(Lt(t.ns)&&(t.ns=[t.ns]),Lt(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),Lt(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs?.indexOf?.("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),typeof t.initImmediate=="boolean"&&(t.initAsync=t.initImmediate),t),LT=()=>{},Yme=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(i=>{typeof t[i]=="function"&&(t[i]=t[i].bind(t))})},G6="__i18next_supportNoticeShown",Kme=()=>typeof globalThis<"u"&&!!globalThis[G6],Xme=()=>{typeof globalThis<"u"&&(globalThis[G6]=!0)},Jme=t=>!!(t?.modules?.backend?.name?.indexOf("Locize")>0||t?.modules?.backend?.constructor?.name?.indexOf("Locize")>0||t?.options?.backend?.backends&&t.options.backend.backends.some(e=>e?.name?.indexOf("Locize")>0||e?.constructor?.name?.indexOf("Locize")>0)||t?.options?.backend?.projectId||t?.options?.backend?.backendOptions&&t.options.backend.backendOptions.some(e=>e?.projectId));class Wy extends sR{constructor(e={},i){if(super(),this.options=bW(e),this.services={},this.logger=Ku,this.modules={external:[]},Yme(this),i&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,i),this;setTimeout(()=>{this.init(e,i)},0)}}init(e={},i){this.isInitializing=!0,typeof e=="function"&&(i=e,e={}),e.defaultNS==null&&e.ns&&(Lt(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const r=QA();this.options={...r,...this.options,...bW(e)},this.options.interpolation={...r.interpolation,...this.options.interpolation},e.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=e.nsSeparator),typeof this.options.overloadTranslationOptionHandler!="function"&&(this.options.overloadTranslationOptionHandler=r.overloadTranslationOptionHandler),this.options.showSupportNotice!==!1&&!Jme(this)&&!Kme()&&(typeof console<"u"&&typeof console.info<"u"&&console.info("ðŸŒ i18next is maintained with support from Locize â€” consider powering your project with managed localization (AI, CDN, integrations): https://locize.com ðŸ’™"),Xme());const n=u=>u?typeof u=="function"?new u:u:null;if(!this.options.isClone){this.modules.logger?Ku.init(n(this.modules.logger),this.options):Ku.init(null,this.options);let u;this.modules.formatter?u=this.modules.formatter:u=Wme;const c=new hW(this.options);this.store=new pW(this.options.resources,this.options);const d=this.services;d.logger=Ku,d.resourceStore=this.store,d.languageUtils=c,d.pluralResolver=new jme(c,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==r.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),u&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(d.formatter=n(u),d.formatter.init&&d.formatter.init(d,this.options),this.options.interpolation.format=d.formatter.format.bind(d.formatter)),d.interpolator=new vW(this.options),d.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},d.backendConnector=new qme(n(this.modules.backend),d.resourceStore,d,this.options),d.backendConnector.on("*",(f,...h)=>{this.emit(f,...h)}),this.modules.languageDetector&&(d.languageDetector=n(this.modules.languageDetector),d.languageDetector.init&&d.languageDetector.init(d,this.options.detection,this.options)),this.modules.i18nFormat&&(d.i18nFormat=n(this.modules.i18nFormat),d.i18nFormat.init&&d.i18nFormat.init(this)),this.translator=new ZD(this.services,this.options),this.translator.on("*",(f,...h)=>{this.emit(f,...h)}),this.modules.external.forEach(f=>{f.init&&f.init(this)})}if(this.format=this.options.interpolation.format,i||(i=LT),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const u=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);u.length>0&&u[0]!=="dev"&&(this.options.lng=u[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(u=>{this[u]=(...c)=>this.store[u](...c)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(u=>{this[u]=(...c)=>(this.store[u](...c),this)});const o=Uy(),l=()=>{const u=(c,d)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(d),i(c,d)};if(this.languages&&!this.isInitialized)return u(null,this.t.bind(this));this.changeLanguage(this.options.lng,u)};return this.options.resources||!this.options.initAsync?l():setTimeout(l,0),o}loadResources(e,i=LT){let r=i;const n=Lt(e)?e:this.language;if(typeof e=="function"&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if(n?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const a=[],s=o=>{if(!o||o==="cimode")return;this.services.languageUtils.toResolveHierarchy(o).forEach(u=>{u!=="cimode"&&a.indexOf(u)<0&&a.push(u)})};n?s(n):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>s(l)),this.options.preload?.forEach?.(o=>s(o)),this.services.backendConnector.load(a,this.options.ns,o=>{!o&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(o)})}else r(null)}reloadResources(e,i,r){const n=Uy();return typeof e=="function"&&(r=e,e=void 0),typeof i=="function"&&(r=i,i=void 0),e||(e=this.languages),i||(i=this.options.ns),r||(r=LT),this.services.backendConnector.reload(e,i,a=>{n.resolve(),r(a)}),n}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&V6.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1)){for(let i=0;i<this.languages.length;i++){const r=this.languages[i];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,i){this.isLanguageChangingTo=e;const r=Uy();this.emit("languageChanging",e);const n=o=>{this.language=o,this.languages=this.services.languageUtils.toResolveHierarchy(o),this.resolvedLanguage=void 0,this.setResolvedLanguage(o)},a=(o,l)=>{l?this.isLanguageChangingTo===e&&(n(l),this.translator.changeLanguage(l),this.isLanguageChangingTo=void 0,this.emit("languageChanged",l),this.logger.log("languageChanged",l)):this.isLanguageChangingTo=void 0,r.resolve((...u)=>this.t(...u)),i&&i(o,(...u)=>this.t(...u))},s=o=>{!e&&!o&&this.services.languageDetector&&(o=[]);const l=Lt(o)?o:o&&o[0],u=this.store.hasLanguageSomeTranslations(l)?l:this.services.languageUtils.getBestMatchFromCodes(Lt(o)?[o]:o);u&&(this.language||n(u),this.translator.language||this.translator.changeLanguage(u),this.services.languageDetector?.cacheUserLanguage?.(u)),this.loadResources(u,c=>{a(c,u)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?s(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(s):this.services.languageDetector.detect(s):s(e),r}getFixedT(e,i,r){const n=(a,s,...o)=>{let l;typeof s!="object"?l=this.options.overloadTranslationOptionHandler([a,s].concat(o)):l={...s},l.lng=l.lng||n.lng,l.lngs=l.lngs||n.lngs,l.ns=l.ns||n.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||r||n.keyPrefix);const u=this.options.keySeparator||".";let c;return l.keyPrefix&&Array.isArray(a)?c=a.map(d=>(typeof d=="function"&&(d=bO(d,{...this.options,...s})),`${l.keyPrefix}${u}${d}`)):(typeof a=="function"&&(a=bO(a,{...this.options,...s})),c=l.keyPrefix?`${l.keyPrefix}${u}${a}`:a),this.t(c,l)};return Lt(e)?n.lng=e:n.lngs=e,n.ns=i,n.keyPrefix=r,n}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,i={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=i.lng||this.resolvedLanguage||this.languages[0],n=this.options?this.options.fallbackLng:!1,a=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const s=(o,l)=>{const u=this.services.backendConnector.state[`${o}|${l}`];return u===-1||u===0||u===2};if(i.precheck){const o=i.precheck(this,s);if(o!==void 0)return o}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||s(r,e)&&(!n||s(a,e)))}loadNamespaces(e,i){const r=Uy();return this.options.ns?(Lt(e)&&(e=[e]),e.forEach(n=>{this.options.ns.indexOf(n)<0&&this.options.ns.push(n)}),this.loadResources(n=>{r.resolve(),i&&i(n)}),r):(i&&i(),Promise.resolve())}loadLanguages(e,i){const r=Uy();Lt(e)&&(e=[e]);const n=this.options.preload||[],a=e.filter(s=>n.indexOf(s)<0&&this.services.languageUtils.isSupportedCode(s));return a.length?(this.options.preload=n.concat(a),this.loadResources(s=>{r.resolve(),i&&i(s)}),r):(i&&i(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const n=new Intl.Locale(e);if(n&&n.getTextInfo){const a=n.getTextInfo();if(a&&a.direction)return a.direction}}catch{}const i=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=this.services?.languageUtils||new hW(QA());return e.toLowerCase().indexOf("-latn")>1?"ltr":i.indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},i){const r=new Wy(e,i);return r.createInstance=Wy.createInstance,r}cloneInstance(e={},i=LT){const r=e.forkResourceStore;r&&delete e.forkResourceStore;const n={...this.options,...e,isClone:!0},a=new Wy(n);if((e.debug!==void 0||e.prefix!==void 0)&&(a.logger=a.logger.clone(e)),["store","services","language"].forEach(o=>{a[o]=this[o]}),a.services={...this.services},a.services.utils={hasLoadedNamespace:a.hasLoadedNamespace.bind(a)},r){const o=Object.keys(this.store.data).reduce((l,u)=>(l[u]={...this.store.data[u]},l[u]=Object.keys(l[u]).reduce((c,d)=>(c[d]={...l[u][d]},c),l[u]),l),{});a.store=new pW(o,n),a.services.resourceStore=a.store}if(e.interpolation){const l={...QA().interpolation,...this.options.interpolation,...e.interpolation},u={...n,interpolation:l};a.services.interpolator=new vW(u)}return a.translator=new ZD(a.services,n),a.translator.on("*",(o,...l)=>{a.emit(o,...l)}),a.init(n,i),a.translator.options=n,a.translator.backendConnector.services.utils={hasLoadedNamespace:a.hasLoadedNamespace.bind(a)},a}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Fn=Wy.createInstance();Fn.createInstance;Fn.dir;Fn.init;Fn.loadResources;Fn.reloadResources;Fn.use;Fn.changeLanguage;Fn.getFixedT;Fn.t;Fn.exists;Fn.setDefaultNamespace;Fn.hasLoadedNamespace;Fn.loadNamespaces;Fn.loadLanguages;const Qme={info:"Info",events:"Events",schedule:"Schedule",matches:"Matches",players:"Players",stats:"Stats"},Zme={name:"Name",country:"Country",events:"Events",rank:"Rank",noParticipants:"No participants"},ege={court:"Court",time:"Time",event:"Event",round:"Round",matchUp:"Match"},tge={label:"Display",columns:"Columns",draw:"Draw",tableView:"Table view",statistics:"Statistics"},ige={toggleDark:"Toggle dark mode"},rge={select:"Select language"},nge={tabs:Qme,players:Zme,schedule:ege,display:tge,theme:ige,language:rge},age={info:"Info",events:"Ã‰preuves",schedule:"Programme",matches:"Matchs",players:"Joueurs",stats:"Stats"},sge={name:"Nom",country:"Pays",events:"Ã‰preuves",rank:"Classement",noParticipants:"Aucun participant"},oge={court:"Court",time:"Heure",event:"Ã‰preuve",round:"Tour",matchUp:"Match"},lge={label:"Affichage",columns:"Colonnes",draw:"Tableau",tableView:"Vue tableau",statistics:"Statistiques"},uge={toggleDark:"Basculer le mode sombre"},cge={select:"Choisir la langue"},dge={tabs:age,players:sge,schedule:oge,display:lge,theme:uge,language:cge},pge={info:"Info",events:"Eventos",schedule:"Horario",matches:"Partidos",players:"Jugadores",stats:"Stats"},fge={name:"Nombre",country:"PaÃ­s",events:"Eventos",rank:"Ranking",noParticipants:"Sin participantes"},hge={court:"Cancha",time:"Hora",event:"Evento",round:"Ronda",matchUp:"Partido"},mge={label:"VisualizaciÃ³n",columns:"Columnas",draw:"Cuadro",tableView:"Vista de tabla",statistics:"EstadÃ­sticas"},gge={toggleDark:"Alternar modo oscuro"},Ige={select:"Seleccionar idioma"},vge={tabs:pge,players:fge,schedule:hge,display:mge,theme:gge,language:Ige},yge={info:"Info",events:"Eventos",schedule:"ProgramaÃ§Ã£o",matches:"Partidas",players:"Jogadores",stats:"Stats"},bge={name:"Nome",country:"PaÃ­s",events:"Eventos",rank:"Ranking",noParticipants:"Sem participantes"},wge={court:"Quadra",time:"Hora",event:"Evento",round:"Rodada",matchUp:"Partida"},Sge={label:"ExibiÃ§Ã£o",columns:"Colunas",draw:"Chave",tableView:"Vista de tabela",statistics:"EstatÃ­sticas"},Uge={toggleDark:"Alternar modo escuro"},Tge={select:"Selecionar idioma"},Dge={tabs:yge,players:bge,schedule:wge,display:Sge,theme:Uge,language:Tge},Pge={info:"Info",events:"Bewerbe",schedule:"Spielplan",matches:"Spiele",players:"Spieler",stats:"Stats"},Ege={name:"Name",country:"Land",events:"Bewerbe",rank:"Rang",noParticipants:"Keine Teilnehmer"},Rge={court:"Platz",time:"Zeit",event:"Bewerb",round:"Runde",matchUp:"Spiel"},Cge={label:"Anzeige",columns:"Spalten",draw:"Auslosung",tableView:"Tabellenansicht",statistics:"Statistiken"},Mge={toggleDark:"Dunkelmodus umschalten"},Nge={select:"Sprache wÃ¤hlen"},Age={tabs:Pge,players:Ege,schedule:Rge,display:Cge,theme:Mge,language:Nge},kge={info:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",events:"Ø§Ù„Ø£Ø­Ø¯Ø§Ø«",schedule:"Ø§Ù„Ø¬Ø¯ÙˆÙ„",matches:"Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª",players:"Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†",stats:"Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª"},Oge={name:"Ø§Ù„Ø§Ø³Ù…",country:"Ø§Ù„Ø¨Ù„Ø¯",events:"Ø§Ù„Ø£Ø­Ø¯Ø§Ø«",rank:"Ø§Ù„ØªØ±ØªÙŠØ¨",noParticipants:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒÙˆÙ†"},xge={court:"Ø§Ù„Ù…Ù„Ø¹Ø¨",time:"Ø§Ù„ÙˆÙ‚Øª",event:"Ø­Ø¯Ø«",round:"Ø¬ÙˆÙ„Ø©",matchUp:"Ù…Ø¨Ø§Ø±Ø§Ø©"},Fge={label:"Ø§Ù„Ø¹Ø±Ø¶",columns:"Ø£Ø¹Ù…Ø¯Ø©",draw:"Ø§Ù„Ù‚Ø±Ø¹Ø©",tableView:"Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„",statistics:"Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª"},Lge={toggleDark:"ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†"},_ge={select:"Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©"},$ge={tabs:kge,players:Oge,schedule:xge,display:Fge,theme:Lge,language:_ge},Bge={info:"ä¿¡æ¯",events:"èµ›äº‹",schedule:"èµ›ç¨‹",matches:"æ¯”èµ›",players:"é€‰æ‰‹",stats:"ç»Ÿè®¡"},Vge={name:"å§“å",country:"å›½å®¶",events:"èµ›äº‹",rank:"æŽ’å",noParticipants:"æš‚æ— å‚èµ›é€‰æ‰‹"},jge={court:"çƒåœº",time:"æ—¶é—´",event:"èµ›äº‹",round:"è½®æ¬¡",matchUp:"æ¯”èµ›"},Gge={label:"æ˜¾ç¤º",columns:"åˆ—",draw:"ç­¾è¡¨",tableView:"è¡¨æ ¼è§†å›¾",statistics:"ç»Ÿè®¡æ•°æ®"},Hge={toggleDark:"åˆ‡æ¢æ·±è‰²æ¨¡å¼"},Wge={select:"é€‰æ‹©è¯­è¨€"},zge={tabs:Bge,players:Vge,schedule:jge,display:Gge,theme:Hge,language:Wge},n1="chp_language";function qge(){return localStorage.getItem(n1)||"en"}function Yge(t){localStorage.setItem(n1,t)}function Kge(){return!!localStorage.getItem(n1)}Fn.init({lng:qge(),fallbackLng:"en",interpolation:{escapeValue:!1},resources:{en:{translation:nge},fr:{translation:dge},es:{translation:vge},"pt-BR":{translation:Dge},de:{translation:Age},ar:{translation:$ge},"zh-CN":{translation:zge}}});const bo=Fn.t.bind(Fn),Xge=[{code:"en",label:"English"},{code:"fr",label:"FranÃ§ais"},{code:"es",label:"EspaÃ±ol"},{code:"pt-BR",label:"PortuguÃªs"},{code:"de",label:"Deutsch"},{code:"ar",label:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"},{code:"zh-CN",label:"ç®€ä½“ä¸­æ–‡"}];let zy=null,qy=null;function ZA(){zy&&(zy.remove(),zy=null),qy&&(document.removeEventListener("click",qy),qy=null)}function Jge(t){if(zy){ZA();return}const e=document.createElement("div");e.className="language-dropdown";for(const i of Xge){const r=document.createElement("button");r.className="language-dropdown-item",Fn.language===i.code&&r.classList.add("active"),r.textContent=i.label,r.addEventListener("click",n=>{n.stopPropagation(),Yge(i.code),Fn.changeLanguage(i.code),ZA(),window.location.reload()}),e.appendChild(r)}t.style.position="relative",t.appendChild(e),zy=e,qy=i=>{t.contains(i.target)||ZA()},setTimeout(()=>{document.addEventListener("click",qy)},0)}var Qge=Object.defineProperty,pt=(t,e)=>{for(var i in e)Qge(t,i,{get:e[i],enumerable:!0})};function oR(){return"2.4.6-beta.11"}var H6={};pt(H6,{competitionGovernor:()=>W6,drawsGovernor:()=>HR,entriesGovernor:()=>EJ,eventGovernor:()=>OJ,generationGovernor:()=>XJ,matchUpFormatGovernor:()=>sQ,matchUpGovernor:()=>oQ,mocksGovernor:()=>I$,participantGovernor:()=>tZ,policyGovernor:()=>rJ,publishingGovernor:()=>TZ,queryGovernor:()=>oJ,rankingGovernor:()=>N$,reportGovernor:()=>_Z,scheduleGovernor:()=>A$,scoreGovernor:()=>B0,temporalGovernor:()=>See,tieFormatGovernor:()=>QZ,tournamentGovernor:()=>oee,venueGovernor:()=>Jee});var W6={};pt(W6,{getLinkedTournamentIds:()=>uS,getTournamentIds:()=>oS,linkTournaments:()=>K5,mutate:()=>z6,query:()=>Q5,unlinkTournament:()=>J5,unlinkTournaments:()=>X5});var z6={};pt(z6,{linkTournaments:()=>K5,unlinkTournament:()=>J5,unlinkTournaments:()=>X5});var oh="SINGLES",zt="SINGLES",Rp="DOUBLES",Bt="DOUBLES",Va="TEAM",ei="TEAM",Zge={SINGLES_MATCHUP:oh,SINGLES:zt,DOUBLES_MATCHUP:Rp,DOUBLES:Bt,TEAM_MATCHUP:Va,TEAM:ei},q6={[zt]:[zt,"S"],[Bt]:[Bt,"D"],[ei]:[ei,"T"],S:[zt,"S"],D:[Bt,"D"],T:[ei,"T"]};function ar(t,e){return(t??0)-(e??0)}function Ye(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function va(t){return typeof t=="function"}function ni(t){return typeof t=="string"}function St(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function eIe(t,e){if(!St(t)||!St(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function Y6(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(St).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var tIe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function wO(t,e){if(t===void 0)return null;if(!St(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>wO(a))}:{[n]:e?r(t[n]):wO(t[n])}))}function SO(t){return Array.isArray(t)?t.length+t.map(SO).reduce((e,i)=>e+i,0):St(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>SO(t[e])).reduce((e,i)=>e+i,0):0}function iIe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=SO(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function Mo(t){return Number.isNaN(Number(t))?!1:t>0&&(t&t-1)===0}function wW(t){if(!t.length)return;let e=[...t].sort(ar),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function rIe(t){if(t===1||Number.isNaN(Number(t))||!Mo(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function a1(t){return Number.isNaN(Number(t))?0:t%2&&t+1||t}function s1(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Mi(t){return!Number.isNaN(Number.parseFloat(t))}function K6(t){let e=Ye(t);if(!Number.isNaN(e))return e===0?!1:(e&-e)===1}function nv(t){if(Number.isNaN(Number(t)))return!1;for(;!Mo(t);)t++;return t}function ea(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function ut(t){return ni(t)&&!t.trim().length?!1:Number.isSafeInteger(typeof t=="string"?+t:t)}function nIe(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function aIe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function X6(t,e,i,r,n=2){let a=1-Math.random(),s=1-Math.random(),o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=X6(t,e,i):(o=Math.pow(o,i),o*=e-t,o+=t),r&&(o=aIe(o,r)),Number.parseFloat(o.toFixed(n))}function eP(t,e=2){return Number.parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function ot(t){return Array.isArray(t)?t?.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function sIe(t){return Array.isArray(t)?t?.map(e=>e===null?void 0:e):t}function Rn(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function eI(t){return ut(t)?t:1/0}function Ta(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function oIe(t){return J6(Ta(t))}function J6(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function lIe(t,e,i){return i.indexOf(t)===e}function Q6(t){return t.filter(lIe)}function ba(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Ia(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Re(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function tl(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function Fi(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function SW(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function Ln(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function uIe(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function cIe(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function br(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function Z6(t,[e,...i]){return t.length?[t.slice(0,e),...Z6(t.slice(e),[...i,e])]:[]}function dIe(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function e4(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function t4(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function UO(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let s=i?!!(Math.floor(a/e)%2):!1,o=a%e,l=s?e-1-o:o;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function pIe(t,e=1){if(!Array.isArray(t)||!t.every(ut))return[];let i=Math.min(...t,e),r=Math.max(...t);return Re(i,r+1).filter(n=>!t.includes(n))}function lh(t,e){return!Array.isArray(t)||!ni(e)?!1:Fi(t,q6[e]).length}var H={success:!0},i4="error",fIe={SUCCESS:H,ERROR:i4};function r4({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:s}=n;if(typeof a!="number"||typeof s!="number"||s>e||s<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==ot(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...H}}var hIe={};pt(hIe,{addNotice:()=>nt,callListener:()=>kO,createInstanceState:()=>JIe,cycleMutationStatus:()=>O1,deepCopyEnabled:()=>k1,deleteNotice:()=>x1,deleteNotices:()=>Xw,disableNotifications:()=>DK,enableNotifications:()=>bR,getDevContext:()=>ua,getMethods:()=>RK,getNotices:()=>CK,getProvider:()=>OO,getTopics:()=>bs,getTournamentId:()=>pm,getTournamentRecord:()=>F1,getTournamentRecords:()=>fm,globalLog:()=>AK,handleCaughtError:()=>SR,hasTopic:()=>Jw,removeTournamentRecord:()=>NK,setDeepCopy:()=>Mb,setDevContext:()=>Cb,setGlobalLog:()=>TK,setGlobalMethods:()=>PK,setGlobalSubscriptions:()=>ZIe,setMethods:()=>EK,setStateMethods:()=>kK,setStateProvider:()=>XIe,setSubscriptions:()=>eve,setTournamentId:()=>Nb,setTournamentRecord:()=>MK,setTournamentRecords:()=>wR,timeKeeper:()=>QIe});var TO={message:"Chronological error; time violation.",code:"ANACHRONISM"},Eb={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},n4={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},DO={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Ri={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},ge={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},jw={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},tI={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},uh={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},_e={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},a4={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},ja={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},af={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},o1={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},l1={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},iI={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},s4={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},o4={message:"Schedule conflict: court slot already occupied",code:"ERR_SCHEDULE_CONFLICT_DOUBLE_BOOKING"},l4={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},mIe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},u1={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},Gw={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},Hw={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},gIe={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},lm={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},av={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},c1={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},lR={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},u4={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},Ww={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Vo={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},c4={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},d4={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},p4={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},f4={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},h4={message:"Invalid action",code:"ERR_INVALID_ACTION"},PO={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},m4={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},g4={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},I4={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},d1={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},v4={message:"Existing round",code:"ERR_EXISTING_ROUND"},IIe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},Ka={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},vi={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},p1={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},sf={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},f1={message:"Missing MAIN structure",code:"ERR_MISSING_MAIN_STRUCTURE"},y4={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},uu={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},ui={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},ds={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},b4={message:"Event exists",code:"ERR_EXISTING_EVENT"},w4={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},S4={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},h1={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},U4={message:"Missing stage",code:"ERR_MISSING_STAGE"},of={message:"Invalid stage",code:"ERR_INVALID_STAGE"},T4={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},D4={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},P4={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},EO={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},zw={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},pD={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},vIe={message:"Propagated exits downstream",code:"ERR_PROPAGATED_EXITS_DOWNSTREAM"},sv={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Kl={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},E4={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},R4={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},C4={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},ov={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Tn={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},um={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},cn={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Ou={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},oa={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},la={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},m1={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},uR={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},yIe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},M4={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},g1={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},N4={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},I1={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},bIe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},qw={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},wIe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},A4={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},SIe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},cR={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},UIe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},TIe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},cm={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Xe={message:"Missing value",code:"ERR_MISSING_VALUE"},k4={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},O4={message:"Missing date",code:"ERR_MISSING_DATE"},x4={message:"No valid dates",code:"ERR_NO_VALID_DATES"},tP={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},fD={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},F4={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},qi={message:"Invalid Date",code:"ERR_INVALID_DATE"},Ms={message:"Invalid time",code:"ERR_INVALID_TIME"},L4={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},DIe={message:"Missing date range",info:"Event or tournament must have start and end dates",code:"ERR_MISSING_DATE_RANGE"},dR={message:"Invalid Time Zone",code:"ERR_INVALID_TIME_ZONE"},Ng={message:"Invalid embargo: must be an ISO 8601 datetime with timezone (Z or Â±HH:MM offset)",code:"ERR_INVALID_EMBARGO"},RO={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},_4={message:"Invalid score",code:"ERR_INVALID_SCORE"},pR={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},PIe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},v1={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},$4={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},fR={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},B4={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},hR={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Cp={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},No={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Sa={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},V4={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Ao={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},j4={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},dm={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},Yw={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},ur={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},G4={message:"Missing qualified participants",code:"ERR_MISSING_QUALIFIED_PARTICIPANTS"},ji={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},H4={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},EIe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},W4={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Bd={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},z4={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},q4={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},Y4={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},lv={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},mR={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},y1={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},CO={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},K4={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},RIe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},CIe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},X4={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},J4={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},MO={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},b1={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},w1={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},Q4={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},S1={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},rI={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},Z4={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},fc={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},eK={message:"Court exists",code:"ERR_EXISTING_COURT"},NO={message:"Booking not found",code:"ERR_NOT_FOUND_BOOKING"},tK={message:"Existing matchUps conflict with booking",code:"ERR_EXISTING_MATCHUPS"},iK={message:"Venue exists",code:"ERR_EXISTING_VENUE"},lf={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Vd={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},rK={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},U1={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},nK={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},aK={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},MIe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},T1={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},sK={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},D1={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},P1={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},gR={message:"Missing context",code:"ERR_MISSING_CONTEXT"},oK={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},kh={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},lK={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},uv={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},uK={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},IR={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},cK={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},dK={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},_c={message:"Invalid object",code:"ERR_INVALID_OBJECT"},Yy={message:"Invalid gender",code:"ERR_INVALID_GENDER"},Rb={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},ie={message:"Invalid values",code:"ERR_INVALID_VALUES"},pK={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},E1={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},fK={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},vR={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},R1={message:"Value unchanged",code:"ABORT_UNCHANGED"},Vr={message:"Not found",code:"ERR_NOT_FOUND"},C1={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},hK={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},M1={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},mK={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},gK={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},AO={message:"Existing stage",code:"ERR_EXISTING_STAGE"},N1={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},yR={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},IK={message:"Mutation blocked by active lock",code:"ERR_MUTATION_LOCKED"},vK={message:"Active mutation lock already exists for scope",code:"ERR_EXISTING_MUTATION_LOCK"},yK={message:"Mutation lock not found",code:"ERR_NOT_FOUND_MUTATION_LOCK"},bK={message:"Lock token does not match",code:"ERR_UNAUTHORIZED_LOCK_OPERATION"},wK={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},Kw={message:"Scores present",code:"ERR_SCORES_PRESENT"},NIe={ANACHRONISM:TO,BOOKING_NOT_FOUND:NO,CANNOT_CHANGE_WINNING_SIDE:hR,CANNOT_MODIFY_TIEFORMAT:v1,CANNOT_MODIFY_PARTICIPANT_TYPE:$4,CANNOT_REMOVE_MAIN_STRUCTURE:n4,CANNOT_REMOVE_PARTICIPANTS:fR,CATEGORY_MISMATCH:B4,COURT_EXISTS:eK,COURT_NOT_FOUND:fc,EXISTING_MATCHUPS:tK,DRAW_DEFINITION_NOT_FOUND:ja,DRAW_ID_EXISTS:c4,DRAW_POSITION_ACTIVE:Hw,DRAW_POSITION_ASSIGNED:iI,DRAW_POSITION_NOT_CLEARED:l4,DRAW_POSITION_NOT_FOUND:mIe,DRAW_SIZE_MISMATCH:u4,DUPLICATE_ENTRY:Eb,DUPLICATE_VALUE:pK,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:J4,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:X4,EVENT_EXISTS:b4,EVENT_NOT_FOUND:ds,EXISTING_DRAW_DEFINITIONS:a4,EXISTING_END_TIME:U1,EXISTING_FLIGHT:hK,EXISTING_MATCHUP_ID:gK,EXISTING_OUTCOME:mK,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:lv,EXISTING_PARTICIPANT:mR,EXISTING_POLICY_TYPE:I1,EXISTING_PROFILE:M1,EXISTING_ROUND:v4,EXISTING_STAGE:AO,EXISTING_STRUCTURE:N1,INCOMPATIBLE_MATCHUP_STATUS:pD,INCOMPLETE_SOURCE_STRUCTURE:o1,INSUFFICIENT_DRAW_POSITIONS:w1,INVALID_ACTION:h4,INVALID_ASSIGNMENT:PO,INVALID_BOOKINGS:tP,INVALID_CATEGORY:Rb,INVALID_COLLECTION_DEFINITION:dK,INVALID_CONFIGURATION:cK,INVALID_DATE_AVAILABILITY:fD,INVALID_DATE:qi,INVALID_DRAW_DEFINITION:uh,INVALID_DRAW_POSITION_FOR_SEEDING:l1,INVALID_DRAW_POSITION:lm,INVALID_DRAW_SIZE:lR,INVALID_END_TIME:rK,INVALID_ENTRIES:S4,INVALID_EVENT_TYPE:uu,INVALID_GAME_SCORES:RO,INVALID_GENDER:Yy,INVALID_MATCHUP_FORMAT:E4,INVALID_MATCHUP_STATUS:sv,INVALID_MATCHUP_STATUS_BYE:P4,INVALID_MATCHUP:la,INVALID_OBJECT:_c,INVALID_PARTICIPANT_ID:No,INVALID_PARTICIPANT_IDS:Sa,INVALID_PARTICIPANT_ROLE:V4,INVALID_PARTICIPANT_SEEDING:d4,INVALID_PARTICIPANT_TYPE:Ao,INVALID_PARTICIPANT:Cp,INVALID_POLICY_DEFINITION:N4,INVALID_RECORDS:DO,INVALID_SCALE_ITEM:kh,INVALID_SEED_NUMBER:g4,INVALID_SEED_POSITION:I4,INVALID_SET_NUMBER:SIe,INVALID_SIDE_NUMBER:A4,INVALID_SCORE:_4,INVALID_STAGE:of,INVALID_START_TIME:aK,INVALID_STRUCTURE:af,INVALID_STOP_TIME:nK,INVALID_TIE_FORMAT:Kl,INVALID_TIME:Ms,INVALID_TIME_ITEM:T1,INVALID_TOURNAMENT_DATES:L4,INVALID_TOURNAMENT_RECORD:jw,INVALID_VALUES:ie,INVALID_WINNING_SIDE:pR,MATCHUP_NOT_FOUND:cn,METHOD_NOT_FOUND:yR,MUTATION_LOCKED:IK,MUTATION_LOCK_EXISTS:vK,MUTATION_LOCK_NOT_FOUND:yK,MISSING_ASSIGNMENTS:h1,MISSING_ASYNC_STATE_PROVIDER:sK,MISSING_AVOIDANCE_POLICY:M4,MISSING_BIRTH_DATE:k4,MISSING_COLLECTION_DEFINITION:C4,MISSING_COURT_ID:cm,MISSING_COURTS_INFO:Z4,MISSING_DATE_AVAILABILITY:F4,MISSING_DATE:O4,MISSING_DRAW_DEFINITION:_e,MISSING_DRAW_ID:Vo,MISSING_DRAW_POSITION:av,MISSING_DRAW_POSITIONS:Gw,MISSING_DRAW_SIZE:Ww,MISSING_ENTRIES:w4,MISSING_EVENT:ui,MISSING_QUALIFIED_PARTICIPANTS:G4,MISSING_MATCHUP_FORMAT:R4,MISSING_MATCHUP_ID:Tn,MISSING_MATCHUP_IDS:um,MISSING_MATCHUP:oa,MISSING_MATCHUPS:Ou,MISSING_PARTICIPANT_COUNT:z4,MISSING_PARTICIPANT_ID:ur,MISSING_PARTICIPANT_IDS:Bd,MISSING_PARTICIPANT_ROLE:j4,MISSING_PARTICIPANT:dm,MISSING_PARTICIPANTS:Yw,MISSING_PENALTY_ID:S1,MISSING_PENALTY_TYPE:Q4,MISSING_PERSON_DETAILS:Y4,MISSING_POLICY_ATTRIBUTES:g1,MISSING_POLICY_DEFINITION:uR,MISSING_POLICY_TYPE:m1,MISSING_POSITION_ASSIGNMENTS:D4,MISSING_ROUND_NUMBER:IIe,MISSING_SCHEDULE:oK,MISSING_SCORING_POLICY:wIe,MISSING_SEED_ASSIGNMENTS:m4,MISSING_SEEDCOUNT_THRESHOLDS:f4,MISSING_SEEDING_POLICY:yIe,MISSING_SET_NUMBER:UIe,MISSING_SET_OBJECT:cR,MISSING_SIDE_NUMBER:TIe,MISSING_STAGE:U4,MISSING_STRUCTURE_ID:Ka,MISSING_STRUCTURE:sf,MISSING_MAIN_STRUCTURE:f1,MISSING_STRUCTURES:p1,MISSING_TARGET_LINK:d1,MISSING_TIE_FORMAT:ov,MISSING_TIME_ITEM:D1,MISSING_TIME_ITEMS:P1,MISSING_TOURNAMENT_ID:tI,MISSING_TOURNAMENT_RECORD:ge,MISSING_TOURNAMENT_RECORDS:Ri,MISSING_VALUE:Xe,MISSING_VENUE_ID:Vd,MODIFICATIONS_FAILED:lK,NO_CANDIDATES:IR,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:b1,NO_MODIFICATIONS_APPLIED:uv,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:MO,NO_PARTICIPANT_REMOVED:W4,NO_VALID_ACTIONS:fK,NO_VALID_ATTRIBUTES:vR,NO_VALID_DATES:x4,NOT_FOUND:Vr,NOT_IMPLEMENTED:C1,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:y1,PARTICIPANT_ID_EXISTS:H4,PARTICIPANT_NOT_CHECKED_IN:q4,PARTICIPANT_NOT_FOUND:ji,PARTICIPANT_PAIR_EXISTS:EIe,PENALTY_NOT_FOUND:rI,POLICY_NOT_ATTACHED:bIe,POLICY_NOT_FOUND:qw,SCHEDULE_NOT_CLEARED:s4,SCHEDULE_CONFLICT_DOUBLE_BOOKING:o4,SCHEDULED_MATCHUPS:wK,SCORES_PRESENT:Kw,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:p4,STAGE_SEQUENCE_LIMIT:T4,STRUCTURE_NOT_FOUND:vi,TEAM_NOT_FOUND:E1,UNABLE_TO_ASSIGN_COURT:uK,UNAUTHORIZED_LOCK_OPERATION:bK,UNLINKED_STRUCTURES:y4,UNRECOGNIZED_DRAW_TYPE:u1,UNRECOGNIZED_MATCHUP_FORMAT:zw,UNRECOGNIZED_MATCHUP_STATUS:EO,VALUE_UNCHANGED:R1,VENUE_EXISTS:iK},gi={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},SK={addNotice:GIe,callListener:YIe,cycleMutationStatus:jIe,deleteNotice:zIe,deleteNotices:WIe,disableNotifications:AIe,enableNotifications:kIe,getMethods:A1,getNotices:HIe,getTopics:qIe,getTournamentId:UK,getTournamentRecord:OIe,getTournamentRecords:xIe,removeTournamentRecord:$Ie,setMethods:VIe,setSubscriptions:BIe,setTournamentId:LIe,setTournamentRecord:FIe,setTournamentRecords:_Ie,handleCaughtError:KIe};function AIe(){gi.disableNotifications=!0}function kIe(){gi.disableNotifications=!1}function UK(){return gi.tournamentId}function OIe(t){return gi.tournamentRecords[t]}function xIe(){return gi.tournamentRecords}function FIe(t){let e=t?.tournamentId;return e?(gi.tournamentRecords[e]=t,{success:!0}):{error:jw}}function LIe(t){return t?gi.tournamentRecords[t]?(gi.tournamentId=t,{success:!0}):{error:ge}:(gi.tournamentId=void 0,{success:!0})}function _Ie(t){gi.tournamentRecords=t;let e=Object.keys(t);e.length===1?gi.tournamentId=e[0]:e.length||(gi.tournamentId=void 0)}function $Ie(t){if(typeof t!="string")return{error:ie};if(!gi.tournamentRecords[t])return{error:Vr};delete gi.tournamentRecords[t];let e=Object.keys(gi.tournamentRecords);return e.length===1?gi.tournamentId=e[0]:e.length||(gi.tournamentId=void 0),{success:!0}}function BIe(t){return t.subscriptions===null||Object.keys(t.subscriptions).length===0?(gi.subscriptions={},{...H}):typeof t.subscriptions!="object"?{error:ie}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?gi.subscriptions[e]=t.subscriptions[e]:delete gi.subscriptions[e]}),{...H})}function VIe(t){return typeof t!="object"?{error:ie}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(gi.methods[e]=t[e])}),{...H})}function jIe(){let t=gi.modified;return gi.modified=!1,t}function GIe({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(gi.disableNotifications||(gi.modified=!0),!(gi.disableNotifications||!gi.subscriptions[t]&&!r)))return i&&(gi.notices=gi.notices.filter(n=>!(n.topic===t&&n.key===i))),gi.notices.push({topic:t,payload:e,key:i}),{...H}}function A1(){return gi.methods??{}}function HIe({topic:t}){return gi.notices.filter(e=>e.topic===t).map(e=>e.payload)}function WIe(){gi.notices=[]}function zIe({topic:t,key:e}){gi.notices=gi.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function qIe(){return{topics:Object.keys(gi.subscriptions)}}function YIe({topic:t,notices:e},i){let r=gi.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i?.[t];n&&typeof n=="function"&&n(e)}function KIe({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:UK(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var Jt={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Ar=SK,UW=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function XIe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Fi(Object.keys(t),UW).length!==UW.length)throw new Error("Global state provider is missing required methods");return Ar=t,{success:!0}}function JIe(){if(Ar.createInstanceState){try{Ar.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:sK}}function ua(t){return!t||typeof t!="object"?Jt.devContext??!1:typeof Jt.devContext!="object"?!1:Object.keys(t).every(e=>Jt.devContext?.[e]===t[e])&&Jt.devContext}function QIe(t="reset",e="default"){let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Jt.timers).filter(r=>r!=="default"||Jt.timers[r].startTime).map(r=>{let n=Jt.timers[r],a=n.state==="stopped"?0:(i-(n?.startTime??0))/1e3,s=n.elapsedTime+a;return{state:Jt.timers[r].state,elapsedTime:s.toFixed(2),timer:r}});{let r=Jt.timers[e].state==="stopped"?0:(i-(Jt.timers[e]?.startTime??0))/1e3,n=Jt.timers[e].elapsedTime+r;return{state:Jt.timers[e].state,elapsedTime:n.toFixed(2),timer:e}}}if(!Jt.timers[e]||t==="reset"){if(e==="allTimers")return Jt.timers={default:{elapsedTime:0}},!0;Jt.timers[e]={startTime:i,state:"active",elapsedTime:0}}return Jt.timers[e].elapsedTime||(Jt.timers[e].elapsedTime=0),t==="stop"&&Jt.timers[e].state!=="stopped"&&(Jt.timers[e].state="stopped")&&(Jt.timers[e].elapsedTime+=(i-(Jt.timers[e]?.startTime??0))/1e3),t==="start"&&(Jt.timers[e].startTime=i)&&(Jt.timers[e].state="active"),Jt.timers[e]}function TK(t){va(t)?Jt.globalLog=t:delete Jt.globalLog}function Cb(t){Jt.devContext=t}function DK(){Ar.disableNotifications()}function bR(){Ar.enableNotifications()}function Mb(t,e){typeof t=="boolean"&&(Jt.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Jt.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Jt.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Jt.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Jt.deepCopyAttributes.threshold=e.threshold))}function k1(){return{enabled:Jt.deepCopy,...Jt.deepCopyAttributes}}function ZIe(t){return t?.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Jt.globalSubscriptions[e]=t.subscriptions[e]}),{...H}):{error:Xe,info:"missing subscriptions"}}function eve(t){return t?.subscriptions?Ar.setSubscriptions({subscriptions:t.subscriptions}):{error:Xe,info:"missing subscriptions"}}function PK(t){return t?typeof t!="object"?{error:ie}:(Object.keys(t).forEach(e=>{va(t[e])&&(Jt.globalMethods[e]=t[e])}),{...H}):{error:Xe,info:"missing method declarations"}}function EK(t){return t?typeof t!="object"?{error:ie}:Ar.setMethods(t):{error:Xe,info:"missing method declarations"}}function O1(){return Ar.cycleMutationStatus()}function nt(t){if(typeof t?.topic!="string")return;let e=Jt.globalSubscriptions[t.topic];return Ar.addNotice(t,e)}function RK(){return{...Jt.globalMethods,...Ar.getMethods()}}function CK(t){return Ar.getNotices(t)}function x1({key:t,topic:e}){return Ar.deleteNotice({key:t,topic:e})}function Xw(){return Ar.deleteNotices()}function bs(){return Ar.getTopics()}function Jw(t){return bs()?.topics?.includes(t)}async function kO(t){return Ar.callListener(t,Jt.globalSubscriptions)}function pm(){return Ar.getTournamentId()}function F1(t){return Ar.getTournamentRecord(t)}function fm(){return Ar.getTournamentRecords()}function MK(t){return Ar.setTournamentRecord(t)}function wR(t){return Ar.setTournamentRecords(t)}function Nb(t){return Ar.setTournamentId(t)}function NK(t){return Ar.removeTournamentRecord(t)}function OO(){return Ar}function SR({engineName:t,methodName:e,params:i,err:r}){let n=va(Ar.handleCaughtError)&&Ar.handleCaughtError||SK.handleCaughtError,{tournamentRecord:a,...s}=i;return n({params:s,engineName:t,methodName:e,err:r})}function AK(t,e){if(Jt.globalLog)try{Jt.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),TK()}else console.log(e,t)}function kK(t,e,i,r){if(!St(t))return{error:ie};Mi||(i=1);let n=Array.isArray(e)?e:[],a={},s=(o,l=0)=>{Object.keys(o).forEach(u=>{va(o[u])?a[u]=o[u]:St(o[u])&&(e===!0||n?.includes(u))&&(i===void 0||l<i)&&s(o[u],l+1)})};return s(t),r?PK(a):EK(a),{methods:a}}function tve(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function Ve(t,e,i,r){if(typeof t!="object"||t===null)return t;k1()?.enabled||(r=!0);let n=["",void 0,null];e&&n.push(!1);let a=tve(t,n,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(o=>Ve(o))}:{[s]:r?t[s]:Ve(t[s])}))}function z({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e?.stack)&&(e.stack=[]),e&&Array.isArray(e?.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&(e.context||(e.context={}),Object.assign(e.context,Ve(t))),e&&!e?.error&&!e?.success&&Object.assign(e,{...H}),e??{success:!0}}var Lr="FEMALE",Xu="OTHER",hm="MIXED",Zi="MALE",UR={FEMALE_ABBR:"F",OTHER_ABBR:"O",MIXED_ABBR:"X",MALE_ABBR:"M",ANY_ABBR:"A",FEMALE:Lr,MIXED:hm,OTHER:Xu,MALE:Zi,ANY:"ANY"};function fp(t){return[Lr,"F"].includes(t)}function eh(t){return[Zi,"M"].includes(t)}function $a(t){return[hm,"X"].includes(t)}function cu(t){return["ANY","A"].includes(t)}function ln(t){if(t){if(fp(t))return Lr;if($a(t))return hm;if(eh(t))return Zi;if(cu(t))return"ANY"}return Xu}function cl(t){return fp(t)||eh(t)}var ive="MIXED events can not contain mixed singles or { gender: ANY } collections",rve="events with { gender: ANY } can not contain MIXED singles collections";function TR(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&cl(i)&&ln(i)!==ln(n)?z({result:{valid:!1,error:Yy},context:{gender:n},stack:e}):$a(i)&&(cu(n)||$a(n)&&r!==Bt)?z({result:{error:Yy,valid:!1},info:ive,stack:e}):cu(i)&&$a(n)&&r!==Bt?z({result:{error:Yy,valid:!1},info:rve,stack:e}):{valid:!0}}var nve="normal",TW="timed",ave="final",L1="NOAD",OK=["SET","HAL","QTR","PER","INN","RND","FRM","MAP","MAT"],xK="CONSECUTIVE",FK="TRADITIONAL",sve={S:nve,F:ave,G:"game"};function DR(t,e){if(St(t)&&(t?.bestOf||t?.exactly)&&t?.setFormat)return lve(t,e)}function Ab(t){return!Number.isNaN(Number(t))&&Number(t)}function LK(t){let e=`T${t.minutes}`;return t.based==="P"&&(e+="P"),t.tiebreakFormat?.tiebreakTo&&(e+=`/TB${t.tiebreakFormat.tiebreakTo}`),t.modifier&&(e+=`@${t.modifier}`),e}function ove(t){let e=t?.deuceAfter?`${t.deuceAfter}D`:"";if(t?.type===FK)return`TN${e}`;if(t?.type===xK&&Number.isInteger(t.count))return`${t.count}C${e}`}function lve(t,e){let i=Ab(t.bestOf)||void 0,r=Ab(t.exactly)||void 0,n=i||r;if(t.setFormat?.timed&&t.simplified&&n===1)return LK(t.setFormat);let a=t.matchRoot||"SET",s=r&&r!==1?"X":"",o=t.aggregate?"A":"",l=n&&`${a}${n}${s}${o}`||"",u=DW(t.setFormat,e),c=u&&`S:${u}`||"",d=DW(t.finalSetFormat,e),p=n&&n>1&&d&&u!==d&&`F:${d}`||"",f=t.gameFormat?`G:${ove(t.gameFormat)}`:"";if(l&&u)return[l,c,f,p].filter(Boolean).join("-")}function DW(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return LK(t);if(t.tiebreakSet)return PW(t.tiebreakSet);let i=Ab(t.setTo);if(i){let r=t.NoAD&&L1||"",n=PW(t.tiebreakFormat),a=n&&`/${n}`||"",s=Ab(t.tiebreakAt),o=s&&(s!==i||e)&&`@${s}`||"";if(n!==!1)return`${i}${r}${a}${o}`}}}function PW(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&Ab(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?L1:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Ki(t){if(ni(t)){let e=t.startsWith("T")&&TW||OK.some(i=>t.startsWith(i))&&"SET"||"";if(e===TW){let i=BK(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e==="SET")return dve(t)}}function uve(t){let e=OK.find(u=>t.startsWith(u));if(!e)return;let i=t.slice(e.length),r=/^(\d+)([A-Z]*)$/.exec(i);if(!r)return;let n=nI(r[1]);if(!n)return;let a=r[2],s=!1,o=!1,l=[];for(let u of a)u==="X"?s=!0:u==="A"?o=!0:l.push(u);return{matchRoot:e,count:n,exactly:s,aggregate:o,matchMods:l}}function cve(t){let e=/^(.+?)(\d+D)$/.exec(t),i=e?e[1]:t,r=e?Number(e[2].slice(0,-1)):void 0;if(r!==void 0&&(r<1||!Number.isInteger(r)))return;if(i==="TN"){let a={type:FK};return r&&(a.deuceAfter=r),a}let n=/^([1-9]\d*)C$/.exec(i);if(n){let a={type:xK,count:Number(n[1])};return r&&(a.deuceAfter=r),a}}function dve(t){let e=t.split("-"),i=uve(e[0]);if(!i)return;let{matchRoot:r,count:n,exactly:a,aggregate:s,matchMods:o}=i,l=a&&n!==1?void 0:n,u=a&&n!==1?n:void 0,c,d,p,f=0,h=0,m=0;for(let v=1;v<e.length;v++){let w=e[v].indexOf(":");if(w<0)return;let y=e[v].slice(0,w),b=e[v].slice(w+1);if(!(y in sve))return;if(y==="S"){if(f++,f>1)return;c=EW(e[v],b)}else if(y==="F"){if(h++,h>1)return;d=EW(e[v],b)}else if(y==="G"&&(m++,m>1||(p=cve(b),!p)))return}let g=c&&c.timed||d&&d.timed;if(r==="SET"&&!(l&&l<6||g&&u)||!c||!(!d||d))return;let I=Ve({setFormat:c,exactly:u,bestOf:l});return r!=="SET"&&(I.matchRoot=r),s&&(I.aggregate=!0),o.length>0&&(I.matchMods=o),d&&(I.finalSetFormat=d),p&&(I.gameFormat=p),I}function EW(t,e){return e.startsWith("TB")?pve(e):e.startsWith("T")?BK(e):fve(t,e)}function pve(t){let e=$K(t);return e===!1?!1:typeof e=="object"?{tiebreakSet:e}:void 0}function fve(t,e){let i=/^[FS]:(\d+)([A-Za-z]*)/.exec(t),r=i&&VK(i[2])||!1,n=!i?.[2]||r,a=i?nI(i[1]):void 0,s=_K(e),o=s!==!1,l=o&&s||a,u=$K(e.split("/")[1]);return!a||!n||u===!1||!o?!1:hve(a,r,u,l)}function hve(t,e,i,r){let n={setTo:t};return e&&(n.NoAD=!0),i?(n.tiebreakFormat=i,n.tiebreakAt=r):n.noTiebreak=!0,n}function _K(t,e=!0){let i=t?.indexOf("@")>0&&t.split("@");if(i)return(e?nI(i[1]):i[1])||!1}function $K(t){if(t)return t.startsWith("TB")?mve(t):!1}function mve(t){let e=_K(t,!1),i=/^TB(\d+)([A-Za-z]*)/.exec(t),r=i?.[1],n=i&&VK(i[2]),a=!i?.[2]||n,s=nI(r);if(!s||!a)return!1;let o={tiebreakTo:s};return e&&typeof e=="string"&&!ut(e)&&(o.modifier=e),n&&(o.NoAD=!0),o}function BK(t){let e=t.slice(1),i=/^(\d+)([PG])?(?:\/TB(\d+))?(@[A-Za-z]+)?$/.exec(e),r=nI(i?.[1]);if(!r)return;let n={timed:!0,minutes:r},a=i?.[2];a==="P"?n.based="P":a==="G"&&(n.based="G");let s=i?.[3];if(s){let u=nI(s);u&&(n.tiebreakFormat={tiebreakTo:u})}let o=i?.[4],l=[void 0,"P","G",""].includes(o);if(o&&!l){let u=/^(\d+)([PGA])?(?:\/TB\d+)?(@)([A-Za-z]+)$/.exec(e)?.[4];return u?(n.modifier=u,n):void 0}return o&&(n.based=o),n}function VK(t){return t?.includes(L1)}function nI(t){let e=Number(t);return Number.isNaN(e)?0:e}function gve(t){return t.replaceAll(/T(\d+)G(?=\/TB|@|-|$)/g,"T$1")}function Ga({matchUpFormat:t}){if(!ni(t)||t==="")return!1;let e=Ki(t),i=/-S:(\d+)\/TB(\d{1,2})@?(\d?)/.exec(t),r=i?.[1],n=i?.[2],a=i?.[3],s=/-F:(\d+)\/TB(\d{1,2})@?(\d?)/.exec(t),o=s?.[1],l=s?.[2],u=s?.[3];return DR(e,!!(i&&n&&r===a||s&&l&&o===u))===gve(t)}var Ky=/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1])$/,jK=/^((0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)([.,]\d{3})?$/,dl=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))([ T](0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/,hp=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))?([ T]?(0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/;function iP(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Qe(t.scheduledTime)),!e)return;let i=di(t.scheduledTime),r=Qe(e);return r&&i&&(r+=`T${i}`),r}function Ive(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function cv(t){let e=typeof t=="string"?t?.split(" "):[];if(t&&e?.length>1&&!["AM","PM"].includes(e[1].toUpperCase()))return!1;let i=mm(t,!0,!0);return!!(!t||i&&hp.test(i))}function Cn(t){return Xl(t)||Ky.test(t)}function vve(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+3600*e.getHours();return yve(i,{displaySeconds:!1})}function yve(t,e){let i=Number.parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e?.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(os).join(":")}var _1=t=>{let e=kb(t)||Xl(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${os(r)}-${os(e.getUTCDate())}`};function bve(t){let e=kb(t)||Xl(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function _s(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&!t.includes("T")&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),s=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,s].join(e):i==="MDY"?[n,a,s].join(e):i==="YDM"?[s,a,n].join(e):i==="DYM"?[a,s,n].join(e):i==="MYD"?[n,s,a].join(e):[s,n,a].join(e)}function rP(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function wve(t){return rP(t).getTime()}function kb(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!Number.isNaN(Number(t))&&new Date(t)||!1;return e&&!Number.isNaN(Number(e.valueOf()))}function Sve(t,e){return t<=e}function aI(t,e){if(!Cn(t)||!Cn(e))return[];let i=Qe(t)+"T00:00",r=Qe(e)+"T00:00",n=new Date(i),a=new Date(r),s=kb(a)&&kb(n)&&Sve(n,a),o=[],l=0;if(s){let u=n,c=u.getTime();for(;c<=a.getTime()&&l<300;)l+=1,o.push(new Date(u)),c=u.setDate(u.getDate()+1)}return o.map(u=>_s(u))}var Uve=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Xl(t){return typeof t!="string"?!1:Uve.test(t)}function ld(t){return typeof t!="string"||!Xl(t)?!1:/([zZ]|[+-]\d{2}:?\d{2})$/.test(t)}function $1(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!Number.isNaN(Number.parseInt(r)));return!(e.length<2||!i||Number.parseInt(e[0])>23||Number.parseInt(e[1])>60)}function Mt(t){let e=di(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>Number.parseInt(n));return i*60+r}function Tve(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[os(e),os(i)].join(":")}function nP(t){return $1(t)?t.split(":").slice(0,2).map(os).join(":"):void 0}function di(t){return Xl(t)&&t.indexOf("T")>0?nP(t.split("T").reverse()[0]):nP(t)}function Qe(t){return Xl(t)||dl.test(t)?t.split("T")[0]:""}function ky(t,e){let i=new Date(t);return i.setUTCDate(i.getUTCDate()+e),Qe(i.toISOString())}function aP(t){t=typeof t=="string"?t:"00:00";let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,Number.isNaN(Number.parseInt(i.hours))||Number.isNaN(Number.parseInt(i.minutes))||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function Dve(t){let e=aP(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&Number.parseInt(e.hours)<12&&(e.hours=(e.hours&&Number.parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(os).join(":")}function Pve(t){let e=aP(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),e.hours?.[0]==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function mm(t,e,i){let r=Qe(t),n=di(t),a=r?n:t;return t?e&&(r&&i&&t||Dve(a))||Pve(a):void 0}function GK(t,e){let i=aP(t),r=aP(e);if(Number.parseInt(i.hours)<Number.parseInt(r.hours))return-1;if(Number.parseInt(i.hours)>Number.parseInt(r.hours))return 1;if(i.hours===r.hours){if(Number.parseInt(i.minutes)<Number.parseInt(r.minutes))return-1;if(Number.parseInt(i.minutes)>Number.parseInt(r.minutes))return 1}return 0}function B1(t,e=7){let i=Qe(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return _s(n)}function Eve(t){return B1(t)}function Rve(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),_s(n,i)}function Cve(t,e,i){let r=new Date(t,0);return _s(new Date(r.setDate(e)),i)}function tr(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(os),n=rP(e).setHours(i,r,0,0);return rP(n)}function Qw(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function ra(t,e){let i=di(t);if(!i)return"00:00";let r=Number.isNaN(e)?0:e;return di(V1(tr(i),r).toISOString())||"00:00"}function V1(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function os(t){return t.toString()[1]?t:"0"+t}function du(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var HK={addDays:B1,addWeek:Eve,addMinutesToTimeString:ra,convertTime:mm,getIsoDateString:iP,getUTCdateString:_1,DateHHMM:vve,extractDate:Qe,extractTime:di,formatDate:_s,getDateByWeek:Rve,isISODateString:Xl,isValidEmbargoDate:ld,isDate:kb,isTimeString:$1,offsetDate:rP,offsetTime:wve,sameDay:du,timeStringMinutes:Mt,timeToDate:tr,timeUTC:bve,validTimeValue:cv,validDateString:Ky,timeValidation:hp,dateValidation:dl},Mve=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),Nve=t=>t.filter(Boolean).every(Mi);function fg(t,e){return`${t}-${e}`}function Mp(t){let e=t.category;if(typeof e!="object"||!e)return{error:Rb};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s}=e,o=e.categoryName,l;if(!(Mve([i,r,n,o],"string")&&Nve([a,s])&&[r,n].filter(Boolean).every(Cn)))return{error:Rb};let u=t.consideredDate??Qe(new Date().toLocaleDateString("sv"));if(!u||!Cn(u))return{error:qi};let[c]=u.split("-").slice(0,3).map(L=>Number.parseInt(L)),d=ky(u,-1);if(!d)return{error:qi};let[p,f]=d.split("-").slice(1,3).map(L=>Number.parseInt(L)),h=`${os(p)}-${os(f)}`,m=ky(u,1);if(!m)return{error:qi};let[g,I]=m.split("-").slice(1,3).map(L=>Number.parseInt(L)),v=`${os(g)}-${os(I)}`,w=s&&ky(u,-1*365*s),y=a&&ky(u,-1*365*a),b=[],S=L=>!b.includes(L)&&b.push(L);i=i??o;let U=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,D=i?.includes("-"),P=D&&i?.match(T),E=i?.match(U);function R(L){let $=c-L,V=fg($,v);e.ageMinDate&&e.ageMinDate!==V&&S(`Invalid submitted ageMinDate: ${n}`),n=V,i&&(e.ageMax&&e.ageMax!==L-1&&(S(`Invalid submitted ageMax: ${a}`),y=void 0),a=L-1)}function C(L){let $=c-L-1,V=fg($,v);e.ageMin&&e.ageMin>L&&S(`Invalid submitted ageMin: ${s}`),e.ageMax&&e.ageMax>L&&S(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==V&&S(`Invalid submitted ageMinDate: ${n}`),n=V,i&&(e.ageMax&&e.ageMax!==L&&(S(`Invalid submitted ageMax: ${a}`),w=void 0),a=L)}function M(L){let $=c-L,V=fg($,h);e.ageMaxDate&&e.ageMaxDate!==V&&S(`Invalid submitted ageMaxDate: ${r}`),r=V,i&&(e.ageMin&&e.ageMin!==L+1&&(S(`Invalid submitted ageMin: ${s}`),w=void 0),s=L+1)}function N(L){let $=c-L-1,V=fg($,h);e.ageMaxDate&&e.ageMaxDate!==V&&S(`Invalid submitted ageMaxDate: ${r}`),r=V,i&&(e.ageMin&&e.ageMin!==L&&(S(`Invalid submitted ageMin: ${s}`),w=void 0),s=L)}function A(L){let $=U.exec(L)||[],[V,_,B]=$.slice(1),G=Number.parseInt(_);V==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),R(G)):V==="O"&&M(G),B==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),C(G)):B==="O"&&N(G),r=(r??w)||void 0,n=(n??y)||void 0}function O(){if(r=void 0,n=void 0,a=void 0,s=void 0,e.ageMin){let V=c-e.ageMin;r=fg(V,h)}if(e.ageMax){let V=c-e.ageMax-1;n=fg(V,v)}let[L,$]=(i?.match(T)??[]).slice(1).map(V=>Number.parseInt(V));L<=$?(s=L,a=$,l=!0):S(`Invalid combined age range ${i}`)}function k(){s&&M(s),a&&C(a)}function F(){P?O():D?i?.split("-").forEach(A):E&&i?A(i):k()}F(),a&&e?.ageMin&&e?.ageMin>a&&(S(`Invalid submitted ageMin: ${e?.ageMin}`),s=void 0);let x=Ve({consideredDate:u,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s});return b.length&&(x.errors=b),x}function Ob({category:t}){if(!St(t))return{error:ie};let e=Mp({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!Mi(i)?z({result:{error:ie},context:{ratingMax:i}}):r&&!Mi(r)?z({result:{error:ie},context:{ratingMin:r}}):{...e}}function Zw({childCategory:t,withDetails:e,category:i}){let r=Ob({category:i}),n=Ob({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),s=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),o=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),u=i?.ratingType&&t?.ratingType&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=i?.ballType&&t?.ballType&&i.ballType!==t.ballType,d=Ve({invalidRatingRange:u,invalidAgeMinDate:o,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:s,invalidAgeMin:a,valid:!u&&!o&&!l&&!c&&!s&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function eS({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:s}){a=a??s?.gender;let o="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),z({result:{errors:l,error:_c},stack:o});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:f,matchUpFormat:h,matchUpValue:m,matchUpType:g,scoreValue:I,setValue:v,category:w,gender:y}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof f!="number"&&l.push(`matchUpCount is not type number: ${f}`),g&&!lh([zt,Bt],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!u?.length].concat([m,d,I,v].map(ut)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&f){let b=r4({collectionValueProfiles:u,matchUpCount:f});b.errors&&l.push(...b.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),h&&!Ga({matchUpFormat:h})&&l.push(`Invalid matchUpFormat: ${h}`),r){let b=TR({referenceGender:a,matchUpType:g,gender:y});if(b.error)return z({context:{referenceGender:a,gender:y},result:b,stack:o})}if(t&&n&&w){let b=Zw({category:n,childCategory:w});if(!b.valid)return z({result:{error:Rb},context:b,stack:o})}return l.length?z({result:{errors:l,error:dK},stack:o}):{valid:!0}}function Hn(t){let e=!!(t?.enforceCategory!==!1&&t?.category),i=!!(t?.enforceGender!==!1&&t?.gender),r=t?.checkCollectionIds,n=t?.tieFormat,a=t?.event,s="validateTieFormat",o=[],l=Ave({...t,stack:s});if(l?.error)return l;let u,c=n.collectionDefinitions.every(g=>{let{setValue:I,scoreValue:v,collectionValue:w}=g;(I||v)&&!w&&(u=!0);let{valid:y,errors:b}=eS({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:g,checkCollectionIds:r,checkCategory:e,checkGender:i,event:a});return y?!0:(Array.isArray(b)&&o.push(...b),!1)}),d=typeof n.winCriteria?.valueGoal=="number"&&n.winCriteria?.valueGoal>0&&!u||n.winCriteria?.aggregateValue;if(!(d||n.winCriteria?.aggregateValue))return u?o.push("aggregateValue is required"):o.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),z({context:{tieFormat:n,errors:o,aggregateValueImperative:u},result:{error:Kl},stack:s});let p=n.collectionDefinitions.map(({collectionId:g})=>g),f=!r||p.length===ot(p).length,h=c&&d&&f;return h?{valid:h,errors:o}:z({result:{error:Kl},context:{tieFormat:n,errors:o},stack:s})}function Ave(t){let{tieFormat:e,stack:i}=t;return!t||!e||!St(e)?z({result:{error:Kl},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):St(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...H}:z({result:{error:Kl},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):z({result:{error:Kl},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var sP="resourceSubType",oP="resourceType",sI="identifier",xO="name",kve={RESOURCE_SUB_TYPE:sP,RESOURCE_TYPE:oP,IDENTIFIER:sI,NAME:xO};function Oe(t,e,i,r,n=0){if(OO().makeDeepCopy)return OO().makeDeepCopy(t,e,i,r);let a=k1(),{stringify:s,toJSON:o,ignore:l,modulate:u}=a||{};if(!a?.enabled&&!i||typeof t!="object"||va(t)||t===null||typeof a?.threshold=="number"&&n>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(f=>!i||!l||Array.isArray(l)&&!l.includes(f)||va(l)&&!l(f)),p=(f,h)=>{c[f]=va(h?.toString)?h.toString():JSON.stringify(h)};for(let f of d){let h=t[f],m=va(u)?u(h):void 0;if(m!==void 0)c[f]=m;else if(e&&f==="extensions"&&Array.isArray(h)){let g=j1(h);Object.assign(c,...g)}else r&&f==="extensions"?c[f]=[]:Array.isArray(s)&&s.includes(f)?p(f,h):Array.isArray(o)&&o.includes(f)&&va(h?.toJSON)?c[f]=h.toJSON():h===null?c[f]=void 0:Ive(h)?c[f]=new Date(h).toISOString():c[f]=Oe(h,e,i,r,n+1)}return c}function j1(t){return t?.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function WK(t=1,e){return Re(0,t).map(()=>Pt(e))}function Pt(t){let e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);let i=Math.trunc(Math.random()*4294967295),r=Math.trunc(Math.random()*4294967295),n=Math.trunc(Math.random()*4294967295),a=Math.trunc(Math.random()*4294967295),s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${s.replaceAll("-","")}`:s}var zK={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},qK={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},YK={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},KK={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},XK={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},JK={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},QK={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},ZK={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},e5={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},t5={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},ac="SET3-S:6/TB7",Ove="SET3-S:6/TB7-F:TB10",i5={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},r5={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},n5={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},a5={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},s5={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},o5={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},l5={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},lP="COLLEGE_DEFAULT",FO="COLLEGE_JUCO",LO="COLLEGE_D3",u5="DOMINANT_DUO",c5="DOMINANT_DUO_MIXED",d5="LAVER_CUP",p5="TEAM_DOUBLES_3_AGGREGATION",f5="TIME_TENNIS_DUAL",h5="TIME_TENNIS_PRO_CIRCUIT",m5="USTA_BREWER_CUP",g5="USTA_OZAKI_CUP",I5="USTA_COLLEGE",v5="USTA_GOLD_TEAM_CHALLENGE",y5="USTA_LEVEL_1",b5="USTA_INTERSECTIONAL",w5="USTA_SECTION_BATTLE",S5="USTA_SOUTHERN_LEVEL_5",U5="USTA_TOC",T5="USTA_WTT_ITT",D5="USTA_ZONAL",xve={COLLEGE_D3:LO,COLLEGE_DEFAULT:lP,COLLEGE_JUCO:FO,DOMINANT_DUO:u5,DOMINANT_DUO_MIXED:c5,LAVER_CUP:d5,TEAM_DOUBLES_3_AGGREGATION:p5,TIME_TENNIS_DUAL:f5,TIME_TENNIS_PRO_CIRCUIT:h5,USTA_BREWER_CUP:m5,USTA_OZAKI_CUP:g5,USTA_COLLEGE:I5,USTA_GOLD_TEAM_CHALLENGE:v5,USTA_INTERSECTIONAL:b5,USTA_LEVEL_1:y5,USTA_SECTION_BATTLE:w5,USTA_SOUTHERN_LEVEL_5:S5,USTA_TOC:U5,USTA_WTT_ITT:T5,USTA_ZONAL:D5},P5="STANDARD",RW={[P5]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[LO]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:ac,matchUpCount:6,matchUpValue:1},tieFormatName:LO,valueGoal:5},[lP]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:ac,matchUpCount:6,matchUpValue:1},tieFormatName:lP,valueGoal:4},[FO]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:ac,matchUpCount:6,matchUpValue:1},tieFormatName:FO,valueGoal:5},[d5]:o5,[u5]:i5,[c5]:QK,[p5]:qK,[f5]:ZK,[h5]:JK,[m5]:e5,[g5]:t5,[I5]:r5,[v5]:zK,[b5]:XK,[y5]:n5,[w5]:KK,[S5]:YK,[T5]:a5,[U5]:l5,[D5]:s5},Fve=t=>{let e=t?.namedFormat&&Object.keys(RW).includes(t.namedFormat)?t.namedFormat:P5,i=Array.isArray(t?.uuids)?t?.uuids:[],r,{category:n,gender:a}=t?.event??{},s=Oe(RW[e],!1,!0),o=l=>{if(!t?.isMock&&!t?.event?.isMock||!t.event)return i?.pop()??Pt();let u=t?.event?.eventId;return i.pop()??`${u}-COL-${l+1}`};return s.hydrate?(r={winCriteria:{valueGoal:s.valueGoal},collectionDefinitions:[{collectionId:o(0),matchUpFormat:Ove,collectionName:"Doubles",matchUpType:Bt,...s.doubles},{collectionId:o(1),matchUpFormat:ac,collectionName:"Singles",matchUpType:zt,...s.singles}]},s.tieFormatName&&(r.tieFormatName=s.tieFormatName)):(s.collectionDefinitions.forEach((l,u)=>l.collectionId=o(u)),r=s),t?.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},hc=Fve,pl="SINGLES",Oh="SINGLES",ps="DOUBLES",mc="DOUBLES",sr="TEAM",Da="TEAM",Lve="RATING",_ve="BOTH",G1={AGE:"AGE",BOTH:_ve,DOUBLES:ps,DOUBLES_EVENT:mc,RATING:Lve,SINGLES:pl,SINGLES_EVENT:Oh,TEAM_EVENT:Da,TEAM:sr},Fe="MAIN",We="QUALIFYING",en="CONSOLATION",Rr="VOLUNTARY_CONSOLATION",Ai="PLAY_OFF",PR=[Fe,We,en,Ai,Rr],xh={[We]:1,[Fe]:2,[Ai]:3,[en]:3,[Rr]:4},E5="finishingPositions",R5="aggregateEventStructures",C5={[Fe]:1,[Ai]:2,[en]:3,[We]:4,[Rr]:5},$ve={[Ai]:1,[Fe]:2,[en]:3,[We]:4,[Rr]:5},ER="CLUSTER",RR="ADJACENT",M5="SEPARATE",Np="WATERFALL",CR="ITEM",hn="CONTAINER",ks="DRAW",MR="RANDOM",Os="TOP_DOWN",Ap="BOTTOM_UP",pu="POSITION",fu="WINNER",hu="LOSER",fl="FIRST_MATCHUP",ca="AD_HOC",Bve="AD_HOC",dv="FEED_IN",oI="COMPASS",lI="OLYMPIC",Vve="SINGLE_ELIMINATION",il="SINGLE_ELIMINATION",tS="DOUBLE_ELIMINATION",uI="FIRST_MATCH_LOSER_CONSOLATION",iS="FIRST_ROUND_LOSER_CONSOLATION",uf="LUCKY_DRAW",NR="CURTIS_CONSOLATION",jve="CURTIS_CONSOLATION",H1="FEED_IN_CHAMPIONSHIP_TO_SF",xb="FEED_IN_CHAMPIONSHIP_TO_SF",W1="FEED_IN_CHAMPIONSHIP_TO_QF",Fb="FEED_IN_CHAMPIONSHIP_TO_QF",z1="FEED_IN_CHAMPIONSHIP_TO_R16",Lb="FEED_IN_CHAMPIONSHIP_TO_R16",N5="MODIFIED_FEED_IN_CHAMPIONSHIP",_b="MODIFIED_FEED_IN_CHAMPIONSHIP",rS="FEED_IN_CHAMPIONSHIP",nS="PLAYOFF",AR="CUSTOM",Gve="DOUBLE_ROUND_ROBIN",Zs="ROUND_ROBIN",mu="ROUND_ROBIN_WITH_PLAYOFF",A5="DECIDER",k5="BACKDRAW",q1={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},Y1={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},kp="WIN_RATIO",gm="ROUND_OUTCOME",O5=[oI,NR,Fb,Lb,xb,rS,W1,z1,H1,uI,iS,uf,_b,lI,nS,mu],Hve=[ca,oI,NR,tS,Fb,Lb,xb,rS,dv,uI,iS,uf,_b,lI,nS,Zs,mu,il,AR],kR={MAIN:Fe,QUALIFYING:We,CONSOLATION:en,ITEM:CR,CONTAINER:hn,FIRST_MATCHUP:fl,WINNER:fu,LOSER:hu,AD_HOC:ca,FEED_IN:dv,FLEX_ROUNDS:Bve,COMPASS:oI,PLAY_OFF:Ai,PLAYOFF:nS,OLYMPIC:lI,KNOCKOUT:Vve,SINGLE_ELIMINATION:il,DOUBLE_ELIMINATION:tS,CURTIS:NR,FICSF:H1,FICQF:W1,FICR16:z1,MFIC:N5,VOLUNTARY_CONSOLATION:Rr,FIRST_MATCH_LOSER_CONSOLATION:uI,FIRST_ROUND_LOSER_CONSOLATION:iS,MODIFIED_FEED_IN_CHAMPIONSHIP:_b,FEED_IN_CHAMPIONSHIP_TO_R16:Lb,FEED_IN_CHAMPIONSHIP_TO_QF:Fb,FEED_IN_CHAMPIONSHIP_TO_SF:xb,FEED_IN_CHAMPIONSHIP:rS,LUCKY_DRAW:uf,CUSTOM:AR,ROUND_ROBIN_WITH_PLAYOFF:mu,ROUND_ROBIN:Zs,DECIDER:A5,BACKDRAW:k5,COMPASS_ATTRIBUTES:q1,OLYMPIC_ATTRIBUTES:Y1,DRAW:ks,RANDOM:MR,TOP_DOWN:Os,BOTTOM_UP:Ap,CLUSTER:ER,ADJACENT:RR,SEPARATE:M5,WATERFALL:Np,WIN_RATIO:kp,ROUND_OUTCOME:gm,MULTI_STRUCTURE_DRAWS:O5,generatedDrawTypes:Hve,stageOrder:xh,finishOrder:C5,AGGREGATE_EVENT_STRUCTURES:R5,FINISHING_POSITIONS:E5},Wve=kR,dn="tournamentRecords",K1="policyDefinitions",mr="tournamentRecord",X1="onlineResource",mn="drawDefinition",x5="tieFormatName",J1="matchUpFormat",gu="participantId",F5="scheduleDates",zve="tournamentId",qve="scheduleDate",Yve="roundNumber",OR="structureId",Q1="participant",aS="matchUpIds",L5="entryStage",Kve="policyType",_5="structures",Z1="eventType",Nl="matchUpId",xR="tieFormat",FR="inContext",LR="structure",_R="courtIds",Xve="personId",$R="venueIds",eL="matchUps",$5="courtId",B5="eventId",xu="matchUp",V5="drawId",$s="error",$c="event",pv="param",tL="uuids",Jve="averageMatchUpMinutes",Qve="recoveryMinutes",Zve="periodLength",eye="number",Qn="object",sn="array",qr="_validate",j5="_message",Ha="_invalid",Xn="_ofType",iL="_anyOf",cI="_oneOf",CW={[X1]:t=>Fi(Object.keys(t),[sP,oP,sI]).length===3,[x5]:t=>t&&hc({namedFormat:t}),[tL]:t=>!t||Array.isArray(t)&&t.every(ni),[xR]:t=>!Hn({tieFormat:t}).error,[Z1]:t=>[pl,ps,sr].includes(t),[L5]:t=>PR.includes(t)},tye={[dn]:Ri,[mr]:ge,[K1]:uR,[mn]:_e,[gu]:ur,[J1]:R4,[zve]:tI,[OR]:Ka,[aS]:um,[Q1]:dm,[X1]:_c,[Z1]:uu,[_5]:p1,[Nl]:Tn,[xR]:Kl,[LR]:sf,[$5]:cm,[eL]:Ou,[B5]:ds,[xu]:oa,[_R]:Xe,[$R]:Xe,[V5]:Vo,[$c]:ui},iye={[dn]:Qn,[K1]:Qn,[mr]:Qn,[mn]:Qn,[X1]:Qn,[F5]:sn,[Q1]:Qn,[aS]:sn,[_5]:sn,[xR]:Qn,[LR]:Qn,[_R]:sn,[$R]:sn,[eL]:sn,[xu]:Qn,[$c]:Qn,[tL]:sn};function Ge(t,e,i){if(!t&&!St(t))return{error:ie};if(!e?.length||t?._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:ie};let{paramError:r,errorParam:n}=aye(t,e);if(!r)return{valid:!0};let a=r[qr]&&(r[$s]||r[Ha])||t?.[n]===void 0&&(r[$s]||r[Ha]||tye[n]||ie)||ie,s=n??(r[cI]&&Object.keys(r[cI]).join(", "));return z({info:{param:s,message:r[j5]},result:{error:a},stack:i})}function G5(t,e){let i=Object.keys(t),r=Object.keys(e);return Fi(i,r)}function rye(t,e){if(!e)return;let i=G5(t,e);return i.length!==1?{error:ie}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function nye(t,e){if(!e)return;let i=G5(t,e).filter(r=>t[r]);return i.length<1?{error:ie}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function aye(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:s,_validate:o,_info:l,...u})=>{let c=a&&rye(t,a);if(c?.error)return c.error;c&&Object.assign(u,c);let d=s&&nye(t,s);if(d?.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(h=>typeof u[h]=="boolean"),f=p.find(h=>{let m=o&&!va(o),g=t[h]!==void 0&&!o&&sye(t,h,n),I=u[h]&&[void 0,null].includes(t[h]),v=m||g||I||o&&t[h]!==void 0&&!oye(t[h],o)||CW[h]&&!CW[h](t[h]);return v&&(i=h,r=l),v});return!p.length||f}),errorParam:i,paramInfo:r}}function sye(t,e,i){return i=i||iye[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function oye(t,e){return va(e)?e(t):!0}var rL="DYNAMIC",Iu="RANKING",fd="RATING",vd="SCALE",Jl="SEEDING",lye={RANKING:Iu,RATING:fd,SCALE:vd,SEEDING:Jl};function fv(t){let e=Ge(t,[{[Q1]:!0}]);if(e.error)return e;let i=t.participant.timeItems?.filter(({itemType:n})=>n?.startsWith(vd)&&[Iu,fd,Jl].includes(n.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(i?.length){let n=s=>i.filter(o=>o?.itemType===s).sort((o,l)=>new Date(o.createdAt||void 0).getTime()-new Date(l.createdAt||void 0).getTime()).pop(),a=ot(i.map(({itemType:s})=>s));for(let s of a){let o=n(s);if(o){let[,l,u,c,d]=o.itemType.split("."),p=d?`${c}.${d}`:c,f=l===Jl&&"seedings"||l===Iu&&"rankings"||"ratings";r[f][u]||(r[f][u]=[]),r[f][u].push({scaleValue:o.itemValue,scaleDate:o.itemDate,scaleName:p})}}}return{...H,...r}}function Fh(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,s,o){if(!a||!s)return;let l=Object.keys(a),u=Object.keys(s),c=Object.assign({},...u.filter(f=>f.indexOf("||")).map(f=>f.split("||").map(h=>({[h]:f}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let f of l)if(d.indexOf(f)>=0||p){let h=c[f]||f,m=s[h]||p,g=a[f];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let I=g.map(v=>{let w={};return n(v,m,w)!==!1?w:void 0}).filter(Boolean);o[f]=I}else g&&(o[f]={},n(g,m,o[f]));else{let I=a[f];if(Array.isArray(m)&&!m.includes(I))return!1;(s[f]||p&&s[f]!==!1)&&(o[f]=I)}}}}var _O="voluntaryConsolation",Ju="competitiveBands",nL="roundRobinTally",Op="positionActions",Cr="matchUpActions",hD="rankingPoints",gc="roundNaming",sS="participant",$b="progression",jd="scheduling",uP="avoidance",uye="participant",cye="display",ko="scoring",yo="seeding",dI="feedIn",dye="audit",cP="draws",pye={POLICY_TYPE_VOLUNTARY_CONSOLATION:_O,POLICY_TYPE_COMPETITIVE_BANDS:Ju,POLICY_TYPE_ROUND_ROBIN_TALLY:nL,POLICY_TYPE_POSITION_ACTIONS:Op,POLICY_TYPE_MATCHUP_ACTIONS:Cr,POLICY_TYPE_RANKING_POINTS:hD,POLICY_TYPE_ROUND_NAMING:gc,POLICY_TYPE_PARTICIPANT:sS,POLICY_TYPE_PROGRESSION:$b,POLICY_TYPE_SCHEDULING:jd,POLICY_TYPE_AVOIDANCE:uP,POLICY_TYPE_DISPLAY:cye,POLICY_TYPE_PRIVACY:uye,POLICY_TYPE_FEED_IN:dI,POLICY_TYPE_SCORING:ko,POLICY_TYPE_SEEDING:yo,POLICY_TYPE_AUDIT:dye,POLICY_TYPE_DRAWS:cP};function yd({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let s=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),o=Oe(s,!1,n);if(o){let l=e?.[sS];if(i?.withScaleValues){let{ratings:u,rankings:c}=fv({participant:o});o.rankings=c,o.ratings=u}if(l?.participant)return Fh({template:l.participant,source:o})}return o}var fye="element required",hye="missing name";function Mn(t){if(!t||typeof t!="object")return{error:Xe};if(t.element&&typeof t?.element!="object")return{error:ie};if(!t?.name)return{error:Xe,info:hye};if(!t?.element){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=Mn({element:i,name:t.name});if(r.error)return z({result:r,stack:"removeExtension"})}return{...H}}return{error:Xe,info:fye}}return t?.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>e?.name!==t.name),{...H}):{...H,info:Vr}}function hl({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function gt(t){if(typeof t!="object")return{error:Xe};let e="addExtension";if(t?.element&&typeof t.element!="object")return z({result:{error:ie},stack:e});if(!hl({extension:t.extension}))return z({result:{error:ie,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=gt({extension:t.extension,element:r});if(n.error)return z({result:n,stack:e})}return{...H}}else return z({result:{error:Xe},stack:e});if(t.element.extensions||(t.element.extensions=[]),t?.creationTime??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...H}}function aL(t){return!t||typeof t!="object"?{error:Xe}:t.tournamentRecord?gt({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:ge}}function BR(t){return!t||typeof t!="object"?{error:Xe}:t.drawDefinition?gt({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:ja}}function Gd(t){return!t||typeof t!="object"?{error:Xe}:t.event?gt({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:ds}}function H5(t){if(!t||typeof t!="object")return{error:Xe};if(!t.participantId)return{error:ur};let e=t.tournamentRecord?.participants||[],i=yd({participantId:t.participantId,tournamentParticipants:e});return i?gt({creationTime:t.creationTime,extension:t.extension,element:i}):{error:ji}}function sL(t){return!t||typeof t!="object"?{error:Xe}:t.tournamentRecord?Mn({element:t.tournamentRecord,name:t.name}):{error:ge}}function W5(t){return!t||typeof t!="object"?{error:Xe}:t.drawDefinition?Mn({element:t.drawDefinition,name:t.name}):{error:ja}}function VR(t){return!t||typeof t!="object"?{error:Xe}:t?.event?Mn({element:t.event,name:t.name}):{error:ds}}function z5(t){if(!t||typeof t!="object")return{error:Xe};if(!t.participantId)return{error:ur};let e=t.tournamentRecord?.participants||[],i=yd({participantId:t.participantId,tournamentParticipants:e});return i?Mn({element:i,name:t.name}):{error:ji}}function oS({tournamentRecords:t}){return{tournamentIds:St(t)?Object.keys(t):[],...H}}var mye="extensionQueries";function it({discover:t,element:e,name:i,...r}){if(!e||!i){if(t&&r){let a=Object.keys(r).filter(l=>typeof t=="boolean"||Array.isArray(t)&&t.includes(l)).find(l=>Array.isArray(r[l]?.extensions)?r[l].extensions.find(u=>u?.name===i):!1),s=a&&r[a];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(l=>l.extensions?.length));let o=s?.extensions?.find(l=>l?.name===i);return{extension:o,info:o?void 0:Vr}}return z({result:{error:Xe},stack:mye})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let n=e.extensions.find(a=>a?.name===i);return{extension:n,info:n?void 0:Vr}}var gye="activeSuspension",Bb="appliedPolicies",q5="context",jR="delegatedOutcome",To="disabled",Lh="disableAutoCalc",GR="disableLinks",dP="display",yp="drawDeletions",Iye="drawProfile",pP="entryProfile",vye="eventProfile",yye="eventWithdrawalRequests",bye="factory",eo="flightProfile",$O="groupingAttribute",Ic="lineUps",xp="linkedTournamentsIds",Pn="mutationLocks",oL="participantRepresentatives",hv="personRequests",qg="positionActions",wye="rankingPoints",Sye="registration",Al="roundTarget",lS="scheduleLimits",vc="scheduleTiming",_h="schedulingProfile",Uye="statusDetail",pI="subOrder",yc="tally",Xy="tieFormatModification",Y5={ACTIVE_SUSPENSION:gye,APPLIED_POLICIES:Bb,CONTEXT:q5,DELEGATED_OUTCOME:jR,DISABLED:To,DISABLE_LINKS:GR,DISABLE_AUTO_CALC:Lh,DISPLAY:dP,DRAW_DELETIONS:yp,DRAW_PROFILE:Iye,ENTRY_PROFILE:pP,EVENT_PROFILE:vye,EVENT_WITHDRAWAL_REQUESTS:yye,FLIGHT_PROFILE:eo,GROUPING_ATTRIBUTE:$O,LINEUPS:Ic,LINKED_TOURNAMENTS:xp,MUTATION_LOCKS:Pn,PARTICIPANT_REPRESENTATIVES:oL,PERSON_REQUESTS:hv,POSITION_ACTIONS:qg,RANKING_POINTS:wye,REGISTRATION:Sye,ROUND_TARGET:Al,SCHEDULE_LIMITS:lS,SCHEDULE_TIMING:vc,SCHEDULING_PROFILE:_h,STATUS_DETAIL:Uye,SUB_ORDER:pI,TALLY:yc,TIE_FORMAT_MODIFICATIONS:Xy,FACTORY:bye},MW=[jR,To,Lh,GR,eo,Ic,xp,Pn,oL,hv,Al,lS,vc,_h,pI,yc,Xy];function K5({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ri};let e=oS({tournamentRecords:t}),{tournamentIds:i}=e;return i?.length>1?gt({tournamentRecords:t,discover:!0,extension:{name:xp,value:{tournamentIds:i}}}):{...H}}function X5({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ri};let e=Mn({name:xp,tournamentRecords:t,discover:!0});return z({result:e,stack:"unlinkTournaments"})}function J5({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:ie};if(!e)return{error:tI};let i=oS({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:tI};let n;return r.every(a=>{let s=t[a],{extension:o}=it({element:s,name:xp});if(!o)return!0;let l=o?.value?.tournamentIds||[];if(!l?.length||l.length===1&&l.includes(e)||a===e){let d=sL({name:xp,tournamentRecord:s});return d.error&&(n=d.error),d.success}let u=l.filter(d=>d!==e);o.value={tournamentIds:u};let c=aL({tournamentRecord:s,extension:o});return c.error&&(n=c.error),c.success}),n?{error:n}:{...H}}var Q5={};pt(Q5,{getLinkedTournamentIds:()=>uS,getTournamentIds:()=>oS});function uS({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Ri}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{let i=t[e],r=i?.tournamentId,{extension:n}=it({element:i,name:xp}),a=(n?.value?.tournamentIds||[]).filter(s=>s!==r);return{[e]:a}}))}}var HR={};pt(HR,{adHocPositionSwap:()=>f9,addAdHocMatchUps:()=>yC,addDrawDefinitionTimeItem:()=>p0,addFinishingRounds:()=>DS,addGoesTo:()=>Lp,addPlayoffStructures:()=>vC,addQualifyingStructure:()=>p9,addVoluntaryConsolationStage:()=>a9,addVoluntaryConsolationStructure:()=>ZL,allPlayoffPositionsFilled:()=>u0,alternateDrawPositionAssignment:()=>W8,assignDrawPosition:()=>C9,assignDrawPositionBye:()=>Za,attachConsolationStructures:()=>D9,attachPlayoffStructures:()=>P0,attachQualifyingStructure:()=>d0,attachStructures:()=>IC,autoSeeding:()=>mRe,automatedPlayoffPositioning:()=>Tv,automatedPositioning:()=>OS,buildDrawHierarchy:()=>fRe,checkValidEntries:()=>UC,deleteAdHocMatchUps:()=>N9,drawMatic:()=>u_,findDrawDefinition:()=>N0,generateAdHocMatchUps:()=>TC,generateAdHocRounds:()=>l_,generateAndPopulatePlayoffStructures:()=>T0,generateDrawDefinition:()=>JS,generateDrawMaticRound:()=>$0,generateDrawStructuresAndLinks:()=>F0,generateDrawTypeAndModifyDrawDefinition:()=>L0,generateQualifyingStructure:()=>v0,generateVoluntaryConsolation:()=>lX,getAssignedParticipantIds:()=>If,getAvailableMatchUpsCount:()=>bC,getAvailablePlayoffProfiles:()=>LS,getDrawDefinitionTimeItem:()=>EL,getDrawParticipantRepresentativeIds:()=>C0,getDrawStructures:()=>to,getDrawTypeCoercion:()=>HS,getEligibleVoluntaryConsolationParticipants:()=>R0,getMatchUpsMap:()=>Or,getParticipantIdFinishingPositions:()=>M0,getPositionAssignments:()=>vI,getPositionsPlayedOff:()=>Dv,getRandomQualifierList:()=>O0,getSeedingThresholds:()=>r0,getSeedsCount:()=>WS,getStructureSeedAssignments:()=>ms,getTeamLineUp:()=>Fp,getValidGroupSizes:()=>AS,isAdHoc:()=>Wn,isCompletedStructure:()=>yu,isValidForQualifying:()=>x0,luckyLoserDrawPositionAssignment:()=>$8,modifyDrawDefinition:()=>P9,modifyDrawName:()=>E0,modifySeedAssignment:()=>Q8,mutate:()=>Z5,positionActions:()=>k0,pruneDrawDefinition:()=>R9,qualifierDrawPositionAssignment:()=>c0,qualifierProgression:()=>Z8,query:()=>O9,removeDrawPositionAssignment:()=>Hb,removeRoundMatchUps:()=>A9,removeSeededParticipant:()=>d9,removeStructure:()=>r9,renameStructures:()=>i9,resetDrawDefinition:()=>E9,resetQualifyingStructure:()=>s9,resetVoluntaryConsolationStructure:()=>I7,setDrawParticipantRepresentativeIds:()=>e7,setPositionAssignments:()=>G8,setStructureOrder:()=>e9,setSubOrder:()=>k9,shiftAdHocRounds:()=>j8,swapAdHocRounds:()=>H8,swapDrawPositionAssignments:()=>u9,updateTeamLineUp:()=>Cm,withdrawParticipantAtDrawPosition:()=>N8});var Z5={};pt(Z5,{adHocPositionSwap:()=>f9,addAdHocMatchUps:()=>yC,addDrawDefinitionTimeItem:()=>p0,addPlayoffStructures:()=>vC,addQualifyingStructure:()=>p9,addVoluntaryConsolationStage:()=>a9,addVoluntaryConsolationStructure:()=>ZL,alternateDrawPositionAssignment:()=>W8,assignDrawPosition:()=>C9,assignDrawPositionBye:()=>Za,attachConsolationStructures:()=>D9,attachPlayoffStructures:()=>P0,attachQualifyingStructure:()=>d0,attachStructures:()=>IC,automatedPlayoffPositioning:()=>Tv,automatedPositioning:()=>OS,deleteAdHocMatchUps:()=>N9,luckyLoserDrawPositionAssignment:()=>$8,modifyDrawDefinition:()=>P9,modifyDrawName:()=>E0,modifySeedAssignment:()=>Q8,pruneDrawDefinition:()=>R9,qualifierDrawPositionAssignment:()=>c0,qualifierProgression:()=>Z8,removeDrawPositionAssignment:()=>Hb,removeRoundMatchUps:()=>A9,removeSeededParticipant:()=>d9,removeStructure:()=>r9,renameStructures:()=>i9,resetDrawDefinition:()=>E9,resetQualifyingStructure:()=>s9,resetVoluntaryConsolationStructure:()=>I7,setDrawParticipantRepresentativeIds:()=>e7,setPositionAssignments:()=>G8,setStructureOrder:()=>e9,setSubOrder:()=>k9,shiftAdHocRounds:()=>j8,swapAdHocRounds:()=>H8,swapDrawPositionAssignments:()=>u9,updateTeamLineUp:()=>Cm,withdrawParticipantAtDrawPosition:()=>N8});var lL=t=>e=>t[e],uL=(t=[])=>t.map(vr).filter(Boolean),BO=(t=[])=>t.map(bt).filter(Boolean),bt=(t={})=>lL(t)("participantId"),vr=(t={})=>lL(t)("matchUpId"),fI=(t={})=>lL(t)("drawId");function e7({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:ja};if(!Array.isArray(t))return{error:ie};let i=BO(e?.entries||[]);return t.length&&Fi(t,i).length<t.length?{error:ie}:BR({drawDefinition:e,extension:{name:oL,value:t}})}var fs="ABANDONED",Im="AWAITING_RESULT",Bc="CANCELLED",Oi="COMPLETED",mv="DEAD_RUBBER",Zt="DEFAULTED",Wi="DOUBLE_DEFAULT",Si="DOUBLE_WALKOVER",uo="IN_PROGRESS",hs="INCOMPLETE",cL="NOT_PLAYED",jr="RETIRED",Hd="SUSPENDED",Li="TO_BE_PLAYED",mi="WALKOVER",Tye=[Im,Oi,Zt,uo,hs,jr,Hd],t7=[Im,Oi,Zt,Si,Wi,uo,hs,jr,Hd,mi],i7=[fs,Im,"BYE",Bc,Oi,mv,Zt,Si,Wi,uo,hs,cL,jr,Hd,Li,mi],r7=["BYE",Si,Wi,Oi,Zt,jr,mi],n7=[fs,Im,Bc,mv,uo,hs,cL,Hd,Li,void 0],Ji=[Bc,fs,Oi,mv,Zt,Si,Wi,jr,mi],dL=[fs,Oi,Zt,Si,Wi,uo,jr,mi],a7=[uo,hs,Hd,Li],s7={ABANDONED:fs,AWAITING_RESULT:Im,BYE:"BYE",CANCELLED:Bc,COMPLETED:Oi,DEAD_RUBBER:mv,DEFAULTED:Zt,DOUBLE_WALKOVER:Si,DOUBLE_DEFAULT:Wi,IN_PROGRESS:uo,INCOMPLETE:hs,NOT_PLAYED:cL,RETIRED:jr,SUSPENDED:Hd,TO_BE_PLAYED:Li,WALKOVER:mi};function vm(t,e,i){let r=d=>it({element:d,name:Al})?.extension?.value,n=i?.deprioritizeCompleted,a=i?.mode===R5&&$ve,s=i?.mode===E5&&C5,o=s||a||xh,l=d=>d?.stage===Fe&&d?.stageSequence===1,u=d=>l(d)?-1:o[d?.stage],c=d=>d?.matchUps.every(({matchUpStatus:p})=>Ji.includes(p)?1:-1);return n&&c(t)-c(e)||a&&u(t)-u(e)||(t?.stage&&o[t.stage]||0)-(e?.stage&&o[e.stage]||0)||(r(t)||0)-(r(e)||0)||!s&&!a&&(e?.positionAssignments?.length??1/0)-(t?.positionAssignments?.length??1/0)||(t?.stageSequence??0)-(e?.stageSequence??0)||(fP(t)||0)-(fP(e)||0)}function fP(t){return(t?.matchUps||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((n,a)=>n+a,0);return!e||r<e?r:e},void 0)}function et(t){let e=Ge(t,[{[mn]:!0,[OR]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=to({drawDefinition:i}),a=n?.flatMap(l=>l.structures?[...l.structures].concat(l):l),s=a?.find(l=>l.structureId===r);if(!s)return{error:vi};let o=s.structureType===CR?a?.find(l=>l.structures?.some(u=>u.structureId===r)):void 0;return{structure:s,containingStructure:o}}function to({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:s,stage:o}){let l=!e&&_e||!e?.structures&&p1||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let u=h=>{let m=it({element:h,name:Al})?.extension?.value;return!n||n===m},c=e?.structures?.filter(p).filter(f).filter(u).sort((h,m)=>vm(h,m,a))??[],d=t?Object.assign({},...PR.map(h=>{let m=c?.filter(g=>g.stage===h);return m?.length&&{[h]:m}}).filter(Boolean)):{};return{structures:c,stageStructures:d};function p(h){return!o&&!Array.isArray(s)||o&&h.stage===o||Array.isArray(s)&&s.includes(h.stage)}function f(h){return!r&&!Array.isArray(i)||r&&h.stageSequence===r||Array.isArray(i)&&i.includes(h.stageSequence)}}function o7({drawDefinition:t}){if(!t)return{error:_e};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=Kt({structure:i}),a=n?.map(bt).filter(Boolean)??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Kt({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:_e};if({structure:i,error:r}=et({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>Kt({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=D4,{positionAssignments:n,error:r}}function cr({drawDefinition:t,structureId:e,structure:i}){let r=Kt({drawDefinition:t,structureId:e,structure:i})?.positionAssignments||[],n=r?.filter(u=>u.participantId??u.bye??u.qualifier),a=r&&r?.length===n?.length,s=r?.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),o=r?.filter(u=>!u.participantId&&u.bye),l=r?.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:s,assignedPositions:n,qualifierPositions:l,byePositions:o}}var pL="addDrawDefinition",WR="addMatchUps",bd="addParticipants",fL="addScaleItems",l7="addEvent",u7="addVenue",sc="audit",hL="dataIssue",mL="deleteParticipants",gL="deleteVenue",IL="deletedDrawIds",vL="deletedMatchUpIds",yL="modifyDrawDefinition",c7="modifyDrawEntries",d7="modifyEventEntries",bL="modifyMatchUp",tn="modifyParticipants",wL="modifyPositionAssignments",SL="modifySeedAssignments",cf="modifyTournamentDetail",Vc="modifyVenue",VO="mutations",jO="publishEvent",p7="publishEventSeeding",f7="publishOrderOfPlay",h7="publishParticipants",UL="unPublishEvent",TL="unPublishEventSeeding",DL="unPublishOrderOfPlay",m7="unPublishParticipants",hP="unPublishTournament",zR="updateInContextMatchUp",Dye={ADD_DRAW_DEFINITION:pL,ADD_MATCHUPS:WR,ADD_PARTICIPANTS:bd,ADD_SCALE_ITEMS:fL,ADD_EVENT:l7,ADD_VENUE:u7,AUDIT:sc,DATA_ISSUE:hL,DELETE_PARTICIPANTS:mL,DELETE_VENUE:gL,DELETED_DRAW_IDS:IL,DELETED_MATCHUP_IDS:vL,MODIFY_DRAW_DEFINITION:yL,MODIFY_DRAW_ENTRIES:c7,MODIFY_EVENT_ENTRIES:d7,MODIFY_MATCHUP:bL,MODIFY_PARTICIPANTS:tn,MODIFY_POSITION_ASSIGNMENTS:wL,MODIFY_SEED_ASSIGNMENTS:SL,MODIFY_TOURNAMENT_DETAIL:cf,MODIFY_VENUE:Vc,MUTATIONS:VO,PUBLISH_EVENT_SEEDING:p7,PUBLISH_EVENT:jO,PUBLISH_ORDER_OF_PLAY:f7,PUBLISH_PARTICIPANTS:h7,UNPUBLISH_EVENT_SEEDING:TL,UNPUBLISH_EVENT:UL,UNPUBLISH_ORDER_OF_PLAY:DL,UNPUBLISH_PARTICIPANTS:m7,UNPUBLISH_TOURNAMENT:hP,UPDATE_INCONTEXT_MATCHUP:zR};function qR(t,e){if(!t)return{error:_e};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=e?.filter(Boolean);return t.updatedAt=r,t.structures?.filter(Boolean).forEach(a=>{(!n?.length||n?.includes(a.structureId))&&(a.updatedAt=r)}),{...H}}function wd({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&qR(t),nt({payload:{matchUps:i,tournamentId:e,eventId:r},topic:WR}),{...H}}function Fu({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&qR(t),nt({topic:vL,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)x1({key:a});return{...H}}function Tt({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&ii({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),nt({topic:bL,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...H}):(console.log(oa),{error:oa})}function Pye({tournamentId:t,inContextMatchUp:e}){return e?(nt({payload:{inContextMatchUp:e,tournamentId:t},topic:zR,key:e.matchUpId}),{...H}):{error:oa}}function cS({tournamentId:t,eventId:e,drawDefinition:i}){return i?(qR(i),nt({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:pL,key:i.drawId}),{...H}):(console.log(_e),{error:_e})}function Eye({tournamentId:t,eventId:e,drawId:i}){return nt({payload:{drawId:i,tournamentId:t,eventId:e},topic:IL,key:i}),x1({key:i}),{...H}}function ii({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(qR(t,i),nt({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:yL,key:t.drawId}),{...H}):{error:_e}}function g7({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:_e};if(!i)return{error:sf};let n=i.seedAssignments,a=i.structureId,s=t.drawId;return nt({payload:{tournamentId:e,eventId:r,drawId:s,structureId:a,seedAssignments:n},topic:SL,key:t.drawId}),ii({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...H}}function bc({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:_e};if(!i)return{error:sf};let n=Kt({structure:i}),a=i.structureId,s=t.drawId,o=r?.eventId;return nt({topic:wL,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:o,drawId:s},key:a}),ii({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:o}),{...H}}function I7({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){if(!e)return{error:_e};let n=e.structures?.find(s=>s.stage===Rr);if(!n)return{error:vi};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],Fu({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(s=>s.entryStage!==Rr)),ii({tournamentId:t?.tournamentId,eventId:r?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...H}}function PL({drawPositions:t,structure:e}){if([We,Fe].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Kt({structure:e});i?.filter(({drawPosition:r})=>t?.includes(r))?.forEach(r=>{gt({element:r,extension:{name:GR,value:!0}})})}function dS(t){let{appliedPolicies:e,positionAction:i,drawDefinition:r}=t;if(e?.audit?.[qg]===!1)return;let{extension:n}=it({name:qg,element:r}),a=Array.isArray(n?.value)?n?.value??[]:[];if(!a?.length){let o=r.structures.find(l=>l.stage===Fe);if(o){let l=Kt({structure:o}).positionAssignments?.map(({drawPosition:u,participantId:c,bye:d,qualifier:p})=>({drawPosition:u,participantId:c,qualifier:p,bye:d}));a.push({name:"initialMainAssignments",initialAssignments:l})}}let s={value:a.concat(i),name:qg};gt({element:r,extension:s})}function gv({tournamentRecord:t,drawDefinition:e,event:i}){let r=(t?.events||i&&[i])?.map(o=>o?.drawDefinitions).flat().filter(Boolean)||e&&[e]||[],n={},a={},s=r.map(o=>o?.structures?.filter(l=>l?.structures)).flat().filter(Boolean);for(let o of s){let{structures:l,structureId:u}=o??{};l&&u&&(n[u]=l?.map(c=>c.structureId))&&l.forEach(c=>a[c.structureId]=o?.structureId)}return{containedStructures:n,containerStructures:a}}function YR(t){let{sides:e,matchUpType:i}=t||{},r=t.potentialParticipants?.length?t.potentialParticipants.flat().map(a=>i===Bt?a?.individualParticipantIds||[]:a.participantId).flat():[],n=(e||[]).map(a=>i===Bt&&(a?.participant?.individualParticipantIds||[])||a?.participantId&&[a.participantId]||[]).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function ws(t){return t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var pS="SIGN_IN_STATUS",v7="SIGNED_OUT",Vb="SIGNED_IN",jn="TEAM",vt="INDIVIDUAL",Xa="GROUP",ht="PAIR",_t="TEAM",Jy={TEAM_PARTICIPANT:jn,INDIVIDUAL:vt,GROUP:Xa,TEAM:_t,PAIR:ht},y7={INDIVIDUAL:vt,GROUP:Xa,PAIR:ht,TEAM:_t,SIGN_IN_STATUS:pS,SIGNED_OUT:v7,SIGNED_IN:Vb};function KR({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?Oe(e,t?.convertExtensions,!0):e,a=n.filter(l=>l.participantType===_t),s=n.filter(l=>l.participantType===Xa),o=n.filter(l=>l.participantType===ht);return n.forEach(l=>{if(l.participantType===vt){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.teamParticipantIds?.includes(c.participantId)&&(l.teamParticipantIds.push(c.participantId),r.get(c.participantId)||r.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),o.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),s.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}var ch=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function b7({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n?.map(({person:o})=>o)].flat().filter(Boolean);function s(o){let{nationalityCode:l}=o||{};if(l){let u=ch.find(({iso:c})=>c===l);i&&u?.ioc&&!o.iocNationalityCode&&(o.iocNationalityCode=u.ioc),e&&u?.iso2&&!o.iso2NationalityCode&&(o.iso2NationalityCode=u.iso2),u?.label&&!o.countryName&&(o.countryName=u.label)}}a.forEach(s)}function Rye({participantMap:t,template:e}){let i=Object.values(t);for(let r of i){let n=r.participant;if(n.individualParticipantIds?.length){n.individualParticipants=[];for(let a of n.individualParticipantIds){let s=t[a].participant;n.individualParticipants.push(e?Fh({template:e,source:s}):s)}}}}function Wd(t){let{tournamentRecord:e,participantId:i}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let n of Object.values(r)){let a=n.participants?.find(s=>s.participantId===i);if(a)return{participant:a,tournamentId:n.tournamentId}}return{error:ji}}function w7(t){let{tournamentRecord:e,participantId:i}=t;if(i){let n=Wd({tournamentRecord:e,participantId:i});return n.participant??n}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Xe}}function Ss(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=w7(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:ie,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:P1};let a=n.timeItems.filter(o=>o?.itemType===r).filter(o=>!i?.length||i.some(l=>o?.itemSubTypes?.includes(l))).sort((o,l)=>{let u=new Date(o.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),s=Oe(a.pop(),!1,!0);if(s){let o={timeItem:s,...H};return e&&Object.assign(o,{previousItems:a}),o}else return{info:Vr}}function EL({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:Vo};if(!e.timeItems)return{info:Vr};let{timeItem:n,previousItems:a,info:s}=Ss({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function fS({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:ui};if(!r.timeItems)return{info:Vr};let{timeItem:n,previousItems:a,info:s}=Ss({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:s}}function XR({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:ge};if(!e.timeItems)return{info:Vr};let{timeItem:n,previousItems:a,info:s}=Ss({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function RL({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:ge};if(!i)return{error:ur};let a=Wd({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:s}=a;if(!s?.timeItems)return{info:Vr};let{timeItem:o,previousItems:l,info:u}=Ss({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return o&&{timeItem:o,previousItems:l}||{info:u}}var Cye={[Xa]:"groupParticipantIds",[ht]:"pairParticipantIds",[_t]:"teamParticipantIds"},Mye={[Xa]:"groups",[_t]:"teams"};function S7({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,withGroupings:a,internalUse:s,withISO2:o,withIOC:l}){let u=[],c={};for(let p of i.participants??[]){let f=p?.participantId;f&&kye({participantMap:c,participantId:f})}for(let p of i.participants??[]){let f=Oe(p,e,s),{participantId:h,individualParticipantIds:m,participantType:g}=f;if(!c[h]){u.push(h);continue}if(Object.assign(c[h].participant,f),m){let I=Aye({individualParticipantIds:m,participantCopy:f,participantMap:c,participantType:g,participantId:h});I.missingParticipantIds.length&&u.push(...I.missingParticipantIds)}if(r&&(c[h].participant.signedIn=Nye(f)),n){let{ratings:I,rankings:v,seedings:w}=fv({participant:f});c[h].participant.seedings=w,c[h].participant.rankings=v,c[h].participant.ratings=I}(l||o)&&b7({participant:c[h].participant,withISO2:o,withIOC:l})}if(t){let p=St(t)?t:void 0;Rye({participantMap:c,template:p})}let d;return a&&(d=KR({participants:Object.values(c).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:u,participantMap:c,groupInfo:d}}function Nye(t){let{timeItem:e}=Ss({itemType:pS,element:t});return e?.itemValue===Vb}function Aye({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){let a=[];for(let s of t){let o=i[s]?.participant;if(!o){a.push(s);continue}if(o[Cye[r]].push(n),[_t,Xa].includes(r)){let{participantRoleResponsibilities:l,participantOtherName:u,participantName:c,participantId:d,teamId:p}=e,f=Mye[r];o[f].push({participantRoleResponsibilities:l,participantOtherName:u,participantName:c,participantId:d,teamId:p})}if(r===ht){let l=t.find(u=>u!==s);i[s].pairIdMap[n]=l,i[s].pairIdMap[l]=n}}return{missingParticipantIds:a}}function kye({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[zt]:{...i},[Bt]:{...i},[_t]:{...i},...i}}}function df({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){if(e)return S7({...t,...r,tournamentRecord:i});let a=Oe(i.participants,!1,!0)||[];(t?.withIOC||t?.withISO2)&&a.forEach(o=>b7({participant:o,...t}));let s;if((n||t?.withGroupings)&&a?.length&&({participantsWithGroupings:a,groupInfo:s}=KR({participantsProfile:t,deepCopy:!1,participants:a})),t?.withScaleValues&&a?.length)for(let o of a){let{ratings:l,rankings:u}=fv({participant:o});o.rankings=u,o.ratings=l}return{participants:a,groupInfo:s}}function Rt({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:m1};let s={};return i&&o(i),a&&o(a),r&&o(r),n&&o(n),{appliedPolicies:s,...H};function o(l){let u=l?.extensions?.find(c=>c.name===Bb)?.value;if(u)for(let c of Object.keys(u))(t?e.includes(c):!e.length||e.includes(c))&&(s[c]=Oe(u[c],!1,!0))}}function jc({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:m1};let{appliedPolicies:a}=Rt({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),s={};for(let o of t){let l=a?.[o];l&&(s[o]=l)}return Object.keys(s).length?{policyDefinitions:s}:{info:qw.message}}var U7="WALKOVER",NW="RETIRED",CL="COMPETITIVE",jb="ROUTINE",Gb="DECISIVE",mD="winRatio",Oye={[Ju]:{policyName:"Competitive Bands Default",profileBands:{[Gb]:20,[jb]:50}}},ML=Oye;function Gc({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let s=jc({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let o=t?.[Ju]??s?.[Ju]??ML[Ju];a.policies[Ju]=o}return a}function pf({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:ge};let{appliedPolicies:a}=Rt({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a?.[i]?{policy:a[i]}:{info:qw?.message}}function hS({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){e=e??r?.category?.categoryName??r?.category?.ageCategoryCode,i=i??r?.category?.categoryType??r?.category?.subType;let{policy:n}=pf({policyType:jd,tournamentRecord:t,event:r}),a=(t?it({element:t,name:vc}).extension:void 0)?.value,s=(r&&it({name:vc,element:r}).extension)?.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:s,categoryName:e,categoryType:i,policy:n}}}function NL({drawDefinition:t,attributes:e}){let{extension:i}=it({element:t,name:pP}),r=i?.value||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:pP,value:r},BR({drawDefinition:t,extension:i}),{entryProfile:r}}function mS({drawDefinition:t}){let{extension:e}=it({element:t,name:pP});return{entryProfile:e?.value||{}}}var Bs="ALTERNATE",gS="CONFIRMED",da="DIRECT_ACCEPTANCE",IS="FEED_IN",vS="JUNIOR_EXEMPT",wc="LUCKY_LOSER",yS="ORGANISER_ACCEPTANCE",bS="QUALIFIER",xye="REGISTERED",wS="SPECIAL_EXEMPT",Us="UNGROUPED",ff="UNPAIRED",hI="WILDCARD",Sc="WITHDRAWN",gD=[gS,da,vS,yS,wS],T7=[IS,wc,bS],hf=[gS,da,IS,vS,yS,wS,hI],co=[gS,da,vS,wc,bS,yS,wS,hI],D7=[Bs,gS,da,IS,vS,wc,yS,bS,xye,wS,Us,ff,hI,Sc],Fye={ALTERNATE:Bs,CONFIRMED:gS,DIRECT_ACCEPTANCE:da,DIRECT_ENTRY_STATUSES:hf,DRAW_SPECIFIC_STATUSES:T7,EQUIVALENT_ACCEPTANCE_STATUSES:gD,FEED_IN:IS,JUNIOR_EXEMPT:vS,LUCKY_LOSER:wc,ORGANISER_ACCEPTANCE:yS,QUALIFIER:bS,SPECIAL_EXEMPT:wS,STRUCTURE_SELECTED_STATUSES:co,UNGROUPED:Us,UNPAIRED:ff,VALID_ENTRY_STATUSES:D7,WILDCARD:hI,WITHDRAWN:Sc};function AL({stage:t,drawDefinition:e}){let{entryProfile:i}=mS({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&PR.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return NL({drawDefinition:e,attributes:n}),!0}return r}function Lye({stage:t,drawDefinition:e}){let{entryProfile:i}=mS({drawDefinition:e});return i[t]?.alternates||0}function _ye({stage:t,drawDefinition:e}){let{entryProfile:i}=mS({drawDefinition:e});return i[t]?.wildcardsCount||0}function GO({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function ym({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:s,stages:o,stage:l}){let u=i.entries?.reduce((c,d)=>{let p=it({name:Al,element:d})?.extension?.value,f=l&&d.entryStage===l||o?.length&&d.entryStage&&o.includes(d.entryStage),h=!n||d.entryStatus&&n.includes(d.entryStatus),m=d.entryStageSequence??1;return f&&(!r||m===r)&&h&&(!s||!p||s===p)?c.concat(d):c},[])??[];if(a&&l===Ai){let{playoffEntries:c,error:d}=$ye({provisionalPositioning:t,drawDefinition:i,structureId:a});return d&&console.log("playoff entries error"),(c?.length?c:u).filter(p=>!e||p.placementGroup===e)}return u}function $ye({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===pu&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:s}=n.source,{structure:o}=et({drawDefinition:e,structureId:s});o?.structureType===hn&&(o.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(m=>{let{participantId:g}=m,I=it({element:m,name:yc}).extension?.value;return I&&g?{[g]:I}:void 0}).filter(Boolean)),f=Object.keys(p).reduce((m,g)=>{let I=p[g],v=I.groupOrder||t&&I.provisionalOrder;return m.includes(v)||m.push(v),m},[]).length===Object.keys(p).length,h=Object.keys(p).filter(m=>{let g=p[m],I=g.groupOrder||t&&g.provisionalOrder;return a?.includes(I)});(!t||f)&&h.forEach(m=>{let g=p[m],{groupOrder:I,provisionalOrder:v,GEMscore:w}=g,y=I||t&&v,b=[...a??[]].sort(ar).indexOf(y)+1;r.push({entryStage:Ai,entryStatus:IS,placementGroup:b,groupingValue:d,participantId:m,GEMscore:w})})})}return{playoffEntries:r}}function Bye({stage:t,drawDefinition:e}){return hf.reduce((i,r)=>(GO({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function ms({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){let a,s=[];n||({structure:n,error:a}=et({drawDefinition:i,structureId:r}));let o=Kt({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:vi};r||(r=n.structureId);let{stage:l,stageSequence:u}=n,c=l===Ai&&i&&ym({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:r,stage:l}),d=c?c.filter(h=>h.placementGroup===1).sort((h,m)=>h.GEMscore<m.GEMscore&&1||h.GEMscore>m.GEMscore&&-1||0).map((h,m)=>{let g=m+1;return{participantId:h.participantId,seedValue:g,seedProxy:!0,seedNumber:g}}):[],p=d?.slice(0,e?d.length:o.length/2);p.length?s=p:n.seedAssignments?s=n.seedAssignments:a=m4;let f=n.seedLimit??n?.positionAssignments?.length;return{seedAssignments:s,stageSequence:u,seedLimit:f,stage:l,error:a}}function zo(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function Qy({item:t,drawDefinition:e,structure:i,event:r}){if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:e.tieFormats?.find(a=>t.tieFormatId===a.tieFormatId)||(r.tieFormat?r.tieFormat:r.tieFormats?.find(a=>t.tieFormatId===a.tieFormatId));if(i?.tieFormat)return i.tieFormat;if(i?.tieFormatId){let n=e.tieFormats?.find(a=>i.tieFormatId===a.tieFormatId);if(n)return n}}}function yn({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:Qy({item:i,drawDefinition:t,structure:e,event:r})||Qy({item:e,drawDefinition:t,structure:e,event:r})||zo(t)||zo(r)}}function Vye({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function Or({drawDefinition:t,structure:e}){let i={},r=[];return(t?.structures??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:s,structures:o}=n,l=Array.isArray(o);if(l)l&&o.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=s;i[a]={matchUps:u,itemStructureIds:[]},u?.forEach(c=>{r.push(c),c.tieMatchUps&&r.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function Sd({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=e?.mappedMatchUps??t;let n=t[i],a=(n?.itemStructureIds||[]).map(s=>{let{matchUps:o,structureName:l}=t[s];return r?o.map(u=>Object.assign(Oe(u,!0,!0),{containerStructureId:i,structureId:s,structureName:l})):o}).flat();return(n?.matchUps||[]).concat(...a)}function P7({groupedOrder:t,roundPositionsCount:e}){if(!t||t?.length<=e)return t;let i=br(t,t.length/e).map(n=>n.reduce((a,s)=>a+s)),r=i.slice().sort(ar);return i.map(n=>r.indexOf(n)+1)}function JR(t){if(!St(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>ut(a)||a===void 0||a===null);return r&&n}function Ja(t){return Array.isArray(t)?t.every(JR):!1}function jye(t,e){return e?.find(i=>t.includes(i))}function wn({matchUps:t=[],interpolate:e}){if(!Ja(t))return{roundMatchUps:[],error:ie};let i=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?Ye(p.roundNumber):p.roundNumber;return!p.roundNumber||d.includes(f)?d:d.concat(f)},[]).sort(ar).map(d=>{let p=t.filter(m=>m.roundNumber===d),f=p.find(({matchUpType:m})=>m===ei)?p.filter(({matchUpType:m})=>m===ei):p,h=m=>m.sort((g,I)=>ar(g.roundPosition,I.roundPosition));return{[d]:h(f)}}),r=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?Ye(p.roundNumber):p.roundNumber;return d[f]||(d[f]=Ve({abbreviatedRoundName:p.abbreviatedRoundName,finishingRound:p.finishingRound,roundName:p.roundName})),d},{}),n=Object.assign({},...i);if(e){let d=Math.max(...Object.keys(n).map(f=>Ye(f)).filter(f=>!Number.isNaN(f))),p=n[d]?.length;if(p>1&&Mo(p)){let f=d+1,h=f+p/2;Re(f,h).forEach((m,g)=>{n[m]=Re(0,p/(2+g*2)).map(()=>({}))})}}let a=0,s=Object.assign({},...Object.keys(n).map(d=>{let p=n[d]?.length,f=n[d]?.filter(m=>!Ji.includes(m.matchUpStatus)&&!m.score?.scoreStringSide1)?.length,h=p&&p===f;return a=Math.max(a,p),{[d]:{matchUpsCount:p,inactiveCount:f,inactiveRound:h}}})),o=0,l=0,u=Object.keys(n).map(d=>Ye(d)).filter(d=>!Number.isNaN(d));u.forEach(d=>{let p=n[d].sort((h,m)=>h.roundPosition-m.roundPosition),f=p.flatMap(h=>h?.drawPositions||[]);if(s[d].roundNumber=d,s[d].roundFactor=s[d].matchUpsCount?a/s[d].matchUpsCount:1,s[d].finishingRound=r[d]?.finishingRound,s[d].roundName=r[d]?.roundName,s[d].abbreviatedRoundName=r[d]?.abbreviatedRoundName,s[d].finishingPositionRange=n[d]?.[0]?.finishingPositionRange,d===1||!s[d-1]){let h=f.sort(ar),m=br(h,2);s[d].drawPositions=h,s[d].pairedDrawPositions=m}else{let h=s[d-1],m=h.drawPositions,g=h.matchUpsCount/s[d].matchUpsCount,I=br(m,g),v=p.map(w=>{let{roundPosition:y}=w,b=[...w.drawPositions||[],void 0,void 0].slice(0,2);if(!y)return b;let S=b?.filter(Boolean)||[];if(!S?.length)return[void 0,void 0];if(d<3&&S?.length===2)return b?.slice().sort(ar);let U=Fi(m,S).length!==S?.length;if(S?.length&&U)return S?.length===1?[S[0],void 0]:b?.slice().sort(ar);let T=(y-1)*2;return I.slice(T,T+2).map(D=>jye(D,S))});s[d].drawPositions=v?.flat(),s[d].pairedDrawPositions=v}s[d+1]?.matchUpsCount===s[d].matchUpsCount&&(s[d+1].feedRound=!0,s[d+1].feedRoundIndex=l,s[d].preFeedRound=!0,l+=1),s[d]&&!s[d].feedRound&&(s[d].roundIndex=o,o+=1)});let c=!!Object.values(s).some(({matchUpsCount:d})=>!Mo(d));return{hasNoRoundPositions:t.some(d=>!d.roundPosition),roundsNotPowerOf2:c,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:u,roundProfile:s,...H}}function ID(t){if(!Array.isArray(t))return"";let e=t.filter(Mi);return e.length?ot([Math.min(...e),Math.max(...e)]).join("-"):""}function Gye({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:_e};if(!e)return{error:Ka};let{structure:r}=et({drawDefinition:t,structureId:e});if(r?.stage!==en)return{error:of,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=n?.filter(d=>d.target.structureId===e)||[],s=a?.reduce((d,p)=>{let{structureId:f}=p.source;return d.includes(f)?d:d.concat(f)},[])||[],o=Object.assign({},...s.map(d=>{let p=Sd({structureId:d,matchUpsMap:i}),f=wn({matchUps:p}).roundProfile;return{[d]:f}})),l=Sd({matchUpsMap:i,structureId:e}),{roundProfile:u}=wn({matchUps:l}),c={};return a?.forEach(d=>{let{structureId:p,roundNumber:f}=d.source,{feedProfile:h,groupedOrder:m,positionInterleave:g,roundNumber:I}=d.target,v=o[p],w=v[1]?.drawPositions,y=v[f]?.matchUpsCount;if(!y)return;let b=y?w.length/y:0,S=w.length/b,U=w.slice(),T=P7({roundPositionsCount:S,groupedOrder:m}),D=T?.length||1;if(D<=S){let R=w.length/D,C=br(U,R);h===Ap&&C.forEach(M=>M.reverse()),U=T?.length&&T?.map(M=>C[M-1]).flat()||C.flat()}let P=br(U,b);if(g){let R=Re(0,g.interleave).map(()=>{}),C=Re(0,g.offset).map(()=>{});P=P.map(N=>[N,...R]),P.unshift(C),P=P.flat(1);let M=P.length-g.offset;P=P.slice(0,M)}c[I]||(c[I]={});let E=u?.[I]?.feedRound?2:1;P.forEach((R,C)=>{let M=1+C*E;c[I][M]||(c[I][M]=ID(R))})}),{sourceDrawPositionRanges:c}}function E7({drawDefinition:t}){if(typeof t!="object")return{error:uh};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((s,o)=>{let{stage:l}=o;return s[l]?s[l].push(o):s[l]=[o],s},{});for(let s of Object.keys(n)){let o=n[s].find(({stageSequence:u})=>u===1);if(!o)continue;let{structureId:l}=o;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:s})}return{exitProfiles:e};function a({exitProfiles:s,exitProfile:o,structureId:l,targetRound:u,aggregator:c,stage:d}){s[l]||(s[l]=[]),o==="0"&&[en,Ai].includes(d)||s[l].push(o);let p=r.filter(f=>f.source.structureId===l&&f.source.roundNumber>=u);for(let f of p){let h=f.source.roundNumber,m=f.target.roundNumber,g=f.target.structureId,I=i.find(w=>w.structureId===g).stage,v=[I,g,m,h].join("|");if(c[v])return;c[v]=!0,a({exitProfile:`${o}-${h}`,structureId:g,exitProfiles:s,targetRound:m,aggregator:c,stage:I})}}}function Hye({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){if(!t)return{error:_e};if(!i)return{error:Ka};if(!e){let s=Sd({matchUpsMap:r,structureId:i});if({roundProfile:e}=wn({matchUps:s}),!e)return{error:Xe}}let n=(Math.min(...e?.[1]?.drawPositions??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{let o=e?.[s]?.matchUpsCount,l=e?.[1]?.drawPositions??[],u=br(l,l.length/o),c=u.map(ID),d=u.map(g=>g.map(I=>I-n)).map(ID),p=a.map(g=>{if(g>s)return;let I=e?.[g]?.drawPositions??[];return br(I,I.length/o)}).filter(Boolean),f=Re(0,o).map(g=>p.map(I=>I[g]).flat().filter(Boolean).sort(ar)).map(g=>ot(g)),h=f.map(g=>dIe(g).map(ID).join(", ")),m=Object.assign({},...Re(0,o).map(g=>({[g+1]:{firstRoundDrawPositionsRange:c[g],firstRoundOffsetDrawPositionsRange:d[g],possibleDrawPositions:f[g],drawPositionsRange:h[g]}})));return{[s]:m}}))}}function kL({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){if(!i)return!1;r=r??i.matchUps??[],t=t??wn({matchUps:r}).roundsNotPowerOf2;let n=!!i.positionAssignments?.find(({drawPosition:a})=>a)||!!r?.find(({drawPositions:a})=>a?.length);return(!e?.drawType||e.drawType!==uf)&&!i?.structures&&t&&n}function Wn({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!e?.find(n=>n?.roundPosition),r=!!e?.find(n=>n?.drawPositions?.length);return!t?.structures&&t?.stage!==Rr&&(!e.length||!i&&!r)}var R7={[gc]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Fe]:"",[Ai]:"P",[We]:"Q",[en]:"C"}}},Wye=R7;function C7({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){let{roundProfile:n,roundMatchUps:a}=wn({matchUps:r}),{structureAbbreviation:s,stage:o}=i,l=Wn({structure:i}),u=kL({structure:i}),c=i.structures,d={},p=R7[gc],f=i.stage===We,h=f?Math.max(...(e?.structures??[]).filter(R=>R.stage===We).map(({stageSequence:R})=>R??1),0):0,m=(i.stageSequence??1)<h?i.stageSequence??1:"",g=m&&(t?.affixes?.preQualifying||p.affixes.preQualifying)||"",I=t?.roundNamingMap||p.roundNamingMap||{},v=t?.abbreviatedRoundNamingMap||p.abbreviatedRoundNamingMap||{},w=t?.affixes?.preFeedRound||p.affixes.preFeedRound,y=t?.affixes?.roundNumber||p.affixes.roundNumber,b=(t?.namingConventions||p.namingConventions).round,S=o&&o!==Fe?o[0]:"",U=t?.stageConstants||p.stageConstants,T=o&&U?.[o]||S,D=`${g}${T}${m}`,P=n?Object.keys(n):[],E=f&&U?.[We]?`${U?.[We]}-`:"";if(c||l||u)Object.assign(d,...P.map(R=>{let C=`${E}${b} ${R}`,M=`${y}${R}`;return{[R]:{roundName:C,abbreviatedRoundName:M}}}));else{let R=f&&(t?.qualifyingFinishMap||p?.qualifyingFinishMap||{});Object.assign(d,...P.map(C=>{if(!n?.[C])return;let{matchUpsCount:M,preFeedRound:N}=n[C],A=M*2,O=R?.[n?.[C].finishingRound]||R&&`${y}${A}`||I[M]||`${y}${A}`,k=N?`-${w}`:"",F=`${O}${k}`,x=[D,s,F].filter(Boolean).join("-"),L=`${v[M]||`${y}${A}`}${k}`,$=[D,s,L].filter(Boolean).join("-");return{[C]:{abbreviatedRoundName:$,roundName:x}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}var zye=(t,e)=>(t||0)+(e||0);function M7(t,e){let i=Array.isArray(t)?t[0]:t;return Number.isNaN(i)&&U7||i<=e[Gb]&&Gb||i<=e[jb]&&jb||CL}function N7({score:t}){let e=t?.sets||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(zye)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function qye(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function A7(t){return t.map(qye).sort().map(e=>parseFloat(e.toFixed(2)))}function SS({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:oa};let{score:r,winningSide:n}=i;if(!n)return{error:ie};let a=!e&&t&&pf({policyType:Ju,tournamentRecord:t}).policy,s=e||a?.profileBands||ML[Ju].profileBands,o=N7({score:r}),l=A7([o]),u=M7(l,s),c=Array.isArray(l)?l[0]:l;return{...H,competitiveness:u,pctSpread:c}}function k7({matchUp:t}){if(!t)return{error:oa};if(t&&!t.sides)return{error:la};if(t&&!t.hasContext)return{error:gR};let e=(t.sides??[])?.map(s=>s?.participantId).filter(Boolean),i=t.sides?.filter(s=>s.participant?.participantType===vt).map(s=>s.participantId).filter(Boolean)??[],r=((t.sides??[])?.map(s=>s.participant?.individualParticipants).filter(Boolean)??[]).map(s=>(s??[]).map(o=>o?.participantId).filter(Boolean)),n=[...i,...r.flat()].filter(Boolean)??[],a=ot(n.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:a,individualParticipantIds:n,sideParticipantIds:e,...H}}var mP="CHECK_IN",gP="CHECK_OUT",Yye="SCHEDULE",bm="SCHEDULE.ASSIGNMENT.VENUE",vu="SCHEDULE.ALLOCATION.COURTS",Ud="SCHEDULE.ASSIGNMENT.COURT",QR="SCHEDULE.COURT.ORDER",wm="SCHEDULE.DATE",Kye="COMPLETED.DATE",OL="HOME_PARTICIPANT_ID",xL="SCHEDULE.ASSIGN.OFFICIAL",Sm="SCHEDULE.TIME.SCHEDULED",wo="SCHEDULE.TIME.START",oc="SCHEDULE.TIME.STOP",Ql="SCHEDULE.TIME.RESUME",Uc="SCHEDULE.TIME.END",ZR="SCHEDULE.TIME.MODIFIERS",O7="TO_BE_ANNOUNCED",x7="NEXT_AVAILABLE",F7="FOLLOWED_BY",L7="AFTER_REST",_7="RAIN_DELAY",Xye="NOT_BEFORE",HO=[O7,x7,F7,L7,_7],Jye="ELIGIBILITY",Qye="REGISTRATION",Zye="SUSPENSION",ebe="MEDICAL",tbe="PENALTY",$7="SCALE",B7="RATING",V7="RANKING",FL="SEEDING",zd="PUBLISH",Qa="PUBLIC",qd="STATUS",ibe="MODIFICATION",rbe="RETRIEVAL",nbe="other",abe={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:HO,AFTER_REST:L7,ALLOCATE_COURTS:vu,ASSIGN_COURT:Ud,ASSIGN_OFFICIAL:xL,ASSIGN_VENUE:bm,CHECK_IN:mP,CHECK_OUT:gP,COMPLETED_DATE:Kye,COURT_ORDER:QR,ELIGIBILITY:Jye,END_TIME:Uc,FOLLOWED_BY:F7,MEDICAL:ebe,MODIFICATION:ibe,NEXT_AVAILABLE:x7,NOT_BEFORE:Xye,OTHER:nbe,PENALTY:tbe,PUBLIC:Qa,PUBLISH:zd,RANKING:V7,RATING:B7,RAIN_DELAY:_7,REGISTRATION:Qye,RESUME_TIME:Ql,RETRIEVAL:rbe,SCALE:$7,SCHEDULE:Yye,SCHEDULED_DATE:wm,SCHEDULED_TIME:Sm,SEEDING:FL,START_TIME:wo,STATUS:qd,STOP_TIME:oc,SUSPENSION:Zye,TIME_MODIFIERS:ZR,TO_BE_ANNOUNCED:O7};function Um({matchUp:t}){if(!t)return{error:oa};if(!t.hasContext)return{error:gR};if(!t.sides||t?.sides.filter(Boolean).length!==2)return{error:la};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=k7({matchUp:t}),n=(t.timeItems??[]).filter(o=>o?.itemType&&[mP,gP].includes(o.itemType)).sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(o=>o.itemValue).filter(o=>n.filter(l=>l?.itemValue===o).reverse()[0].itemType===mP);e?.forEach((o,l)=>{let u=r?.[l],c=o?.length&&o.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),r?.forEach((o,l)=>{a.includes(o)&&(e?.[l]??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let s=r?.reduce((o,l)=>a.includes(l)&&o,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:s,checkedInParticipantIds:a,...H}}var Ti=t=>e=>{let i=St(e)&&e?.matchUpType||ni(e)&&e;return i&&q6[t].includes(i)};function Zy(t){let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},r=e?.map(({matchUpFormatCodes:a})=>a?.filter(s=>s===i)).flat().filter(Boolean).sort((a,s)=>(a?.length||0)-(s?.length||0))||[],n=r.includes(i)?i:r[0];return e?.find(({matchUpFormatCodes:a,averageTimes:s})=>a?.find(o=>n===o)&&s)?.averageTimes}function eb(t){let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:r}=t||{};return e?.find(({matchUpFormatCodes:n,averageTimes:a,recoveryTimes:s})=>{if(a&&i){let{greaterThan:o=0,lessThan:l=360}=a;if(i>o&&i<l)return!0}return n?.find(o=>o===r)&&s})?.recoveryTimes}function j7({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>(a.categoryNames?.length||0)-(n.categoryNames?.length||0)).find(({categoryTypes:n,categoryNames:a})=>!a?.length&&!n?.length||a?.includes(e)||n?.includes(i))).find(Boolean)}function sbe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:s,policy:o}){let l=e?.matchUpRecoveryTimes&&eb({...e,averageMinutes:i,matchUpFormat:n}),u=t?.matchUpRecoveryTimes&&eb({...t,averageMinutes:i,matchUpFormat:n}),c=o?.matchUpRecoveryTimes&&eb({...o,averageMinutes:i,matchUpFormat:n}),d=[l,u,c,o?.defaultTimes?.recoveryTimes,r?.recoveryTimes];return j7({categoryName:a,categoryType:s,timesBlockArray:d})}function obe({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:s}){let o=a?.matchUpAverageTimes&&Zy({...a,matchUpFormat:t}),l=n?.matchUpAverageTimes&&Zy({...n,matchUpFormat:t}),u=s?.matchUpAverageTimes&&Zy({...s,matchUpFormat:t}),c=[o,l,u,s?.defaultTimes?.averageTimes,r?.averageTimes];return j7({categoryName:e,categoryType:i,timesBlockArray:c})}var G7="DOUBLES_SINGLES",H7="SINGLES_DOUBLES",Vs="total",WO="participantConflict",zO="potentialParticipantConflict",as="matchUpConflict",W7="courtDoubleBooking",z7="positionLinkConflict",q7="ISSUE_IDS",Bl="CONFLICT",Vl="WARNING",Oy="ERROR",xy="ISSUE",vD="STATE",lbe="BLOCKED",ube="PRACTICE",cbe="MAINTENANCE",dbe={SINGLES_DOUBLES:H7,DOUBLES_SINGLES:G7,TOTAL:Vs,CONFLICT_MATCHUP_ORDER:as,CONFLICT_PARTICIPANTS:WO,CONFLICT_POTENTIAL_PARTICIPANTS:zO,CONFLICT_COURT_DOUBLE_BOOKING:W7,CONFLICT_POSITION_LINK:z7,SCHEDULE_ISSUE_IDS:q7,SCHEDULE_CONFLICT:Bl,SCHEDULE_WARNING:Vl,SCHEDULE_ERROR:Oy,SCHEDULE_ISSUE:xy,SCHEDULE_STATE:vD,BLOCKED:lbe,PRACTICE:ube,MAINTENANCE:cbe};function US({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:o}){if(!i)return{error:ge};s=s??o?.eventType??Oh;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=hS({tournamentRecord:i,categoryName:n,categoryType:a,event:o}),c={...u,matchUpFormat:r,categoryType:a,defaultTiming:l};return eC({eventType:s,timingDetails:c})}function eC({timingDetails:t,eventType:e}){let i=obe(t),r=Object.keys(i?.minutes||{}),n=i?.minutes&&(r?.includes(e)&&i.minutes[e]||i.minutes.default),a=sbe({...t,averageMinutes:n}),s=Object.keys(a?.minutes||{}),o=a?.minutes&&(s?.includes(e)&&a.minutes[e]||a.minutes.default),l=Ti(Oh)(e)?H7:G7,u=a?.minutes&&(s?.includes(l)&&a.minutes[l]||o);return{averageMinutes:n,recoveryMinutes:o,typeChangeRecoveryMinutes:u}}function ek(t){return t.createdAt?new Date(t.createdAt).getTime():0}function mf({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>ek(n)-ek(a)).pop(),r=i&&ek(i);return{itemValue:i?.itemValue,timeStamp:r}}function LL({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=mf({timeItems:i?.timeItems||[],itemType:Sm});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function gf({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=mf({timeItems:i?.timeItems||[],itemType:wm});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function Bf(t){if(jK.test(t)){let e=_1();return new Date(`${e}T${t}`)}else return new Date(t)}function pbe({matchUp:t}){if(!t)return{error:oa};if(!t.timeItems)return{error:P1};let e=t.timeItems.filter(r=>[wo,oc,Ql,Uc].includes(r?.itemType)).sort((r,n)=>Bf(r.itemValue).getTime()-Bf(n.itemValue).getTime()),i=e.reduce((r,n)=>{let a,s=n?.itemType?.split("."),o=`SCHEDULE.TIME.${n?.itemType?.startsWith("SCHEDULE.TIME")&&s[2]}`;switch(o){case wo:a=0;break;case Uc:if(r.lastValue&&[wo,Ql].includes(r.lastType)){let l=Bf(n.itemValue).getTime()-Bf(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;case oc:if([wo,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let l=Bf(n.itemValue).getTime()-Bf(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;default:a=r.milliseconds;break}return{milliseconds:a,lastType:o,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([wo,Ql].includes(i.lastType)){let r=new Date().getTime()-Bf(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:fbe(i.milliseconds),relevantTimeItems:e}}function fbe(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function hbe({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:e.reduce((r,n)=>{let a=n.itemType===wo&&n;return a&&(!r||i(a)<i(r))?a:r},void 0)?.itemValue}}function IP(t){return parseInt(t)}function vP({startTime:t="",endTime:e=""}={}){if(!t||!e||!hp.test(t)||!hp.test(e))return!1;let[i,r]=t.split(":").map(IP),[n,a]=e.split(":").map(IP);return n<i?!1:!(i===n&&a<r)}function mbe(t,e){let[i,r]=t.startTime.split(":").map(IP),[n,a]=e.startTime.split(":").map(IP);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function tC({dateAvailability:t}){if(!t)return{error:F4};if(!Array.isArray(t))return{error:fD};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:fD};let{date:n,startTime:a,endTime:s,bookings:o=[]}=r;if(!a||!s)return{error:fD};if(n&&!dl.test(n))return{error:qi,dateAvailability:{date:n},info:e};if(!hp.test(a))return{error:Ms,dateAvailability:{startTime:a},info:i};if(!hp.test(s))return{error:Ms,dateAvailability:{endTime:s},info:i};if(a===s)return{error:Ms,dateAvailability:{startTime:a,endTime:s},info:"startTime and endTime are equivalent"};if(!vP({startTime:a,endTime:s}))return{error:Ms,dateAvailability:{startTime:a,endTime:s},info:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:tP};for(let l of o){if(typeof l!="object")return{error:tP};let{startTime:u,endTime:c}=l;if(!hp.test(u))return{error:Ms,booking:{startTime:u},info:i};if(!hp.test(c))return{error:Ms,booking:{endTime:c},info:i};if(u===c)return{error:Ms,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!vP({startTime:u,endTime:c}))return{error:Ms,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function Y7({tournamentRecord:t}){for(let e of t.venues??[])e.isPrimary&&delete e.isPrimary}function TS(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:ie};let n=ws(t);i.venueId||(i.venueId=Pt());let a;for(let s of Object.values(n)){let o=gbe({disableNotice:!0,tournamentRecord:s,context:r,venue:i});if(o?.error)return o;a=o.venue}return e||nt({topic:u7,payload:{venue:i}}),Ve({...H,venue:a})}function gbe({tournamentRecord:t,disableNotice:e,context:i,venue:r}){if(!t)return{error:ge};if(!r)return{error:Xe,info:"missing venue"};if(t.venues||(t.venues=[]),r.venueId||(r.venueId=Pt()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0))return{error:iK};if(r.dateAvailability?.length){let n=tC({dateAvailability:r.dateAvailability});if(n.error)return n}if(r.defaultStartTime||r.defaultEndTime){if(!r.defaultStartTime||!r.defaultEndTime)return{error:ie,info:"both defaultStartTime and defaultEndTime are required"};if(!vP({startTime:r.defaultStartTime,endTime:r.defaultEndTime}))return{error:ie,info:"defaultEndTime must be after defaultStartTime"}}return i&&gt({element:r,extension:{value:i,name:q5}}),r.isPrimary&&Y7({tournamentRecord:t}),t.venues.push(r),{...H,venue:Oe(r)}}function po({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:ge};if(!i)return{error:Vd};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(uS({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let s=t[a],o=po({tournamentRecord:s,venueId:i});if(o.success&&o.venue)return TS({tournamentRecord:e,venue:o.venue}),{...H,venue:r}}}return r?{...H,venue:r}:{error:lf}}function _L({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=po({tournamentRecords:i,tournamentRecord:r,venueId:n});return Oe(a,t,!0)}function Yd({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:ge};if(!i)return{error:cm};let r="findCourt",n,a;if((e.venues??[]).forEach(s=>{(s.courts??[]).forEach(o=>{o.courtId===i&&(n=o,a=s)})}),n)return{...H,court:n,venue:a};if(t){let s=(uS({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of s){let l=t[o],u=Yd({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&TS({tournamentRecord:e,venue:u.venue}),{...H,court:n,venue:a}}}return z({result:{error:fc},stack:r})}function $L(t){return Oe(Yd(t),!1,!0)}function iC({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:ge};if(!i)return{error:cm};let r=Yd({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:h,notes:m})=>({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:h,notes:m}))(r.court);return{...H,courtInfo:Oe(n,!1,e)}}function mI(t){let e=Ge(t,[{[mr]:!0},{venueId:!0,[$s]:Vd}]);if(e.error)return e;let{tournamentRecord:i,venueId:r}=t,n=po({tournamentRecord:i,venueId:r});if(n.error)return n;let a=(n.venue?.courts??[]).map(l=>(({courtInfo:u})=>({...u}))(iC({courtId:l.courtId,internalUse:!0,tournamentRecord:i}))),s=n.venue&&(({venueId:l,venueName:u,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:u,venueId:l}))(n.venue),o=s&&{...s,courtsInfo:a};return{...H,venueData:Oe(o,!1,!0)}}function Ibe({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:e.reduce((r,n)=>{let a=n.itemType===Uc&&n;return a&&(!r||i(a)>i(r))?a:r},void 0)?.itemValue}}function Bi({event:t,eventId:e}){if(!t)return{error:ui};let i=it({name:eo,element:t})?.extension,r=e?Oe(i?.value,!1,!0):i?.value;return e&&t.drawDefinitions?.forEach(n=>{r?.flights?.forEach(a=>{a.drawId===n.drawId&&Object.assign(a,{drawDefinition:n})})}),{flightProfile:r}}function zn(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},s=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},o=Object.values(s).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(r){let u,c=o.find(d=>{let p=(d?.drawDefinitions??[]).find(f=>f.drawId===r);if(p)u=p,l=a[d.eventId].tournamentId;else{let f=(d&&Bi({event:d})?.flightProfile)?.flights?.find(h=>h.drawId===r);if(f)return l=a[d.eventId].tournamentId,{entries:f.drawEntries,drawName:f.drawName,tournamentId:l,drawId:r}}return p});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=o.find(c=>c?.eventId===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...z({result:{error:ds},stack:n})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...z({result:{error:ja},context:{drawId:r,eventId:i},stack:n})}}function rC(t){let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:s,scheduleTiming:o,matchUpFormat:l,publishStatus:u,matchUp:c}=t;if(!c)return{error:oa};if(n&&!c.matchUpType&&!t.matchUpType&&(e||a)&&c.drawId){let b=t.drawDefinition||e?.drawDefinitions?.find(U=>U.drawId===c.drawId);!b&&a&&({drawDefinition:b,event:e}=zn({drawId:c.drawId,tournamentRecord:a}));let S=c.structureId&&b?.structures?.find(({structureId:U})=>U===c.structureId);i=t.matchUpType||S?.matchUpType||b?.matchUpType||e?.eventType!==sr&&e?.eventType}let{milliseconds:d,time:p}=pbe({matchUp:c}),{startTime:f}=hbe({matchUp:c}),{endTime:h}=Ibe({matchUp:c}),m,{eventIds:g,drawIds:I}=r??{};if((!g||g.includes(c.eventId))&&(!I||I.includes(c.drawId))){let b=X=>X.createdAt?new Date(X.createdAt).getTime():0,S=new Map,U=c.timeItems?.toSorted((X,Z)=>b(X)-b(Z))??[];for(let X of U)S.set(X.itemType,X.itemValue);let T=S.get(OL),D=S.get(vu),P=S.get(Sm),E=S.get(ZR),R=S.get(wm),C=S.get(xL),M=S.get(QR),N=S.get(bm),A=S.get(Ud),O,k,F,x,L,$=c.matchUpType??i;if(o&&P&&n&&$){let X={matchUpFormat:c.matchUpFormat??l,...o};({averageMinutes:k=0,recoveryMinutes:F=0,typeChangeRecoveryMinutes:x=0}=eC({timingDetails:X,eventType:$})),(k||F)&&(O=h?ra(di(h),F):ra(P,k+F)),x&&(L=h?ra(di(h),x):ra(P,k+x))}!R&&P&&(R=Qe(P));let V=iP({scheduledDate:R,scheduledTime:P}),_={},B=(a&&N&&mI({tournamentRecord:a,venueId:N}))?.venueData||{};N&&(_[N]=B);let{venueName:G,venueAbbreviation:j,courtsInfo:Y}=B,K=(A&&Y?.find(X=>X.courtId===A))?.courtName;for(let X of D||[]){if(!a)break;X.venueId&&!_[X.venueid]&&(_[X.venueId]=mI({venueId:X.venueId,tournamentRecord:a})?.venueData);let Z=_[X.venueId];X.venueName=Z?.venueName;let Q=Z?.courtsInfo?.find(ae=>ae.courtId===X.courtId);X.courtName=Q?.courtName}m=Ve({typeChangeTimeAfterRecovery:L,timeAfterRecovery:O,scheduledDate:R,scheduledTime:P,isoDateString:V,homeParticipantId:T,venueAbbreviation:j,allocatedCourts:D,timeModifiers:E,venueName:G,venueId:N,courtOrder:M,courtName:K,courtId:A,official:C,typeChangeRecoveryMinutes:x,recoveryMinutes:F,averageMinutes:k,milliseconds:d,startTime:f,endTime:h,time:p})}else m=Ve({milliseconds:d,startTime:f,endTime:h,time:p});let{scheduledDate:v}=gf({matchUp:c}),{scheduledTime:w}=LL({matchUp:c});if(s&&u?.displaySettings?.draws){let b=u.displaySettings.draws,S=(b?.[c.drawId]??b?.default)?.scheduleDetails;if(S){let U=(S.find(T=>v&&T.dates?.includes(v))??S.find(T=>!T.dates?.length))?.attributes;if(U){let T=Object.assign({},...Object.keys(m).map(D=>({[D]:!0})),U);m=Fh({source:m,template:T})}}}let y=c.matchUpStatus&&Ji.includes(c.matchUpStatus)&&(Qe(h)||Qe(v)||Qe(w))||void 0;return{schedule:m,endDate:y}}function vbe({drawPositions:t,roundProfile:e,roundNumber:i}){let r=[void 0,void 0];if(t4(t))return{orderedDrawPositions:r,displayOrder:r};let n=e?.[i],a=n?.pairedDrawPositions?.find(o=>Ln(o||[],t.filter(Boolean)))??r,s=n?.feedRound;if(e4(t)){let o=[...t].sort(ar);return{orderedDrawPositions:o.length===2?o:a,displayOrder:s?o:a}}if(s){let o=[t.find(l=>!isNaN(Ye(l))),void 0];return{orderedDrawPositions:o,displayOrder:o}}return{orderedDrawPositions:a,displayOrder:a}}function yP({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=o=>o===void 0?-1:o,s=i.map(o=>{let{collectionAssignments:l,participantId:u}=o,c=l?.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((o,l)=>a(o.substitutionOrder)-a(l.substitutionOrder));for(let o of s){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=o;r.includes(l)||(u&&n.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),r=r.filter(d=>d!==u),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function io({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:ge};if(!Array.isArray(i)||i.length>2)return{error:Sa};if(!i.length)return z({result:{error:Bd},stack:r});t=t??e?.participants??[];let n=t.filter(o=>o.participantType===ht&&Fi(i,o.individualParticipantIds).length===i.length&&o.individualParticipantIds.length===i.length),a=n[0];if(!a)return z({result:{error:ji},stack:r});let s=Oe(n.slice(1),!1,!0);return{participant:Oe(a),duplicatedPairParticipants:s,...H}}function Fp({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:_e};if(typeof e!="string")return{error:ur};let{extension:i}=it({element:t,name:Ic});return{lineUp:(i?.value||{})[e]}}function ybe({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:s,sideLineUps:o,matchUpType:l}){if(!s||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:f})=>{let{assignedParticipantIds:h,substitutions:m}=yP({collectionPosition:i,collectionId:s,lineUp:p});if(l===Bt){if(h?.length<=2){let g=n?.[h[0]]?.pairIdMap?.[h[1]],I=(g&&n[g]?.participant||io({participantIds:h,tournamentParticipants:t}).participant)?.participantId;return{[d]:{participantId:I,teamParticipant:f,substitutions:m}}}else if(h?.length>2)return{[d]:{teamParticipant:f,substitutions:m}}}else{let g=h?.[0];return g&&{[d]:{participantId:g,teamParticipant:f,substitutions:m}}}};if(!r?.length){let d=o?.map(p=>{let{teamParticipant:f,sideNumber:h}=p,m=p.lineUp||Fp({participantId:f.teamParticipantId,drawDefinition:a})?.lineUp;return u({attribute:h,lineUp:m,teamParticipant:f})}).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=r?.map(d=>{let p=e.find(g=>g.drawPosition===d)?.participantId,f=o?.find(g=>g?.drawPosition===d),h=f?.teamParticipant||p&&n?.[p]?.participant||t?.find(({participantId:g})=>g===p),m=f?.lineUp||Fp({participantId:p,drawDefinition:a})?.lineUp;return u({attribute:d,lineUp:m,teamParticipant:h})}).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function nC(t){let e=Ge(t,[{[xu]:!0}]);if(e.error)return e;let i=t?.matchUp,r=i?.matchUpType;if(!r&&i?.sides?.length){let n=i.sides.find(({participant:a})=>a)?.participant?.participantType;r=n===vt&&zt||n===ht&&Bt||n===_t&&_t||void 0}return{matchUpType:r}}function bbe({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:s,sideNumber:o}){let l=i.find(f=>f.drawPosition&&f.drawPosition===a),u=a&&t,c=o&&e,d=u?u[a]?.participantId:l?.participantId,p=l?wbe({displaySideNumber:r,seedAssignments:n,participantId:d,assignment:l,sideNumber:o}):{...c?.[o]};if(s&&(o===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&u){let f=u[a]?.teamParticipant,h=u[a]?.participant,m=u[a]?.substitutions;h&&(p.participant=h),m&&(p.substitutions=m),f&&(p.teamParticipant=f)}return p}function wbe({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let s=Sbe({seedAssignments:e,participantId:i});Object.assign(a,s,{participantId:i}),s?.seedNumber&&s?.seedValue===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function Sbe({seedAssignments:t,participantId:e}){return t?.find(i=>!i.seedProxy&&i.participantId===e)}function K7({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:s,initialRoundOfPlay:o,additionalContext:l,roundNamingProfile:u,tournamentRecord:c,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:f,seedAssignments:h,usePublishState:m,participantMap:g,contextContent:I,scheduleTiming:v,contextProfile:w,drawDefinition:y,publishStatus:b,scoringActive:S,matchUpTieId:U,isRoundRobin:T,roundProfile:D,sideLineUps:P,structure:E,context:R,matchUp:C,event:M}){l=l??{};let N=yn({drawDefinition:y,structure:E,matchUp:C,event:M})?.tieFormat,{roundOffset:A,structureId:O,structureName:k,stage:F,stageSequence:x}=E,{drawId:L,drawName:$,drawType:V}=y??{},_=N?.collectionDefinitions,B=C.collectionId&&_?.find(J=>J.collectionId===C.collectionId),G=C.collectionId?B?.matchUpFormat:C.matchUpFormat??E?.matchUpFormat??y?.matchUpFormat??M?.matchUpFormat,j=C.matchUpType||B?.matchUpType||E?.matchUpType||y?.matchUpType||!Ti(sr)(M?.eventType)&&M?.eventType,Y=f?"BYE":C.matchUpStatus,{schedule:K,endDate:X}=rC({scheduleVisibilityFilters:t,afterRecoveryTimes:s,tournamentRecord:c,usePublishState:m,scheduleTiming:v,drawDefinition:y,matchUpFormat:G,publishStatus:b,matchUpType:j,matchUp:C,event:M}),Z=d??C.drawPositions??[],{collectionPosition:Q,collectionId:ae,roundPosition:te}=C,ne=C.roundNumber??l.roundNumber,le=ae?ybe({tournamentParticipants:i,positionAssignments:r,collectionPosition:Q,participantMap:g,drawDefinition:y,drawPositions:Z,collectionId:ae,sideLineUps:P,matchUpType:j}):void 0,de=u?.[ne]?.roundName||l.roundName,pe=u?.[ne]?.abbreviatedRoundName||l.abbreviatedRoundName,ve=D?.[ne]?.feedRound,Me=D?.[ne]?.preFeedRound,Ee=D?.[ne]?.roundFactor,Be=n?.[ne],fe=te?Be?.[te]:void 0,Te=e?.[ne],ce=B?.category?{...R?.category,...B.category}:R?.category??M?.category,be=C.processCodes?.length&&C.processCodes||B?.processCodes?.length&&B?.processCodes||E?.processCodes?.length&&E?.processCodes||y?.processCodes?.length&&y?.processCodes||M?.processCodes?.length&&M?.processCodes||c?.processCodes,we=w?.withCompetitiveness&&SS({...I,matchUp:C}),Ae=C.finishingPositionRange??l.finishingPositionRange,ye=F!==We&&ut(o)&&o+(ne||0),Ne=J=>Ve(J,void 0,!0),he={...Ne(R),...Ne({matchUpFormat:j===sr?void 0:G,tieFormat:j===sr?N:void 0,gender:B?.gender??M?.gender,endDate:C.endDate??X,discipline:M?.discipline,category:ce,finishingPositionRange:Ae,abbreviatedRoundName:pe,drawPositionsRange:fe,competitiveProfile:we,structureName:k,stageSequence:x,drawPositions:Z,matchUpStatus:Y,processCodes:be,isRoundRobin:T,matchUpTieId:U,preFeedRound:Me,matchUpType:j,roundFactor:Ee,roundOffset:A,structureId:O,roundNumber:ne,roundOfPlay:ye,feedRound:ve,roundName:de,drawName:$,drawType:V,schedule:K,drawId:L,stage:F}),...Oe(Ne(C),!0,!0)};if(G&&C.score?.scoreStringSide1){let J=Ki(G),{bestOf:se,finalSetFormat:oe,setFormat:ue}=J??{};(oe?.tiebreakSet||ue?.tiebreakSet||ue?.timed)&&(he.score.sets=he.score.sets.sort((ee,Se)=>ee.setNumber-Se.setNumber).map((ee,Se)=>{let Pe=Se+1===se&&oe?oe:ue,st=Pe?.tiebreakSet&&!Pe?.timed,Ue=Pe?.timed;return st?(ee.tiebreakSet=!0,[1,2].includes(ee.winningSide)&&(ee.side1Score=ee.winningSide===1?1:0,ee.side2Score=ee.winningSide===2?1:0)):Ue&&(ee.timed=!0),ee}))}if(Array.isArray(Z)){let{orderedDrawPositions:J,displayOrder:se}=vbe({drawPositions:Z,roundProfile:D,roundNumber:ne}),oe=D?.[ne]?.feedRound,ue=se[0]!==J[0],ee=J.concat(void 0,void 0).slice(0,2).map((Se,Pe)=>{let st=Pe+1,Ue=ue?3-st:st,dt=bbe({...le,positionAssignments:r,displaySideNumber:Ue,seedAssignments:h,drawPosition:Se,isFeedRound:oe,sideNumber:st}),bi=C.sides?.find(li=>li.sideNumber===st),qe=te?(te-1)*2+Pe+1:void 0,wi=qe?Te?.[qe]:void 0;return Ne({sourceDrawPositionRange:wi,...bi,...dt})});Object.assign(he,Oe({sides:ee},!0,!0))}if(i&&he.sides){let J=p?.[sS],se=oe=>{let ue=g?.[oe]?.participant;return ue&&Fh({template:J?.participant,source:ue})};if(he.sides.filter(Boolean).forEach(oe=>{if(oe.participantId){let ue=Oe(se(oe.participantId)||(i?yd({policyDefinitions:p,participantId:oe.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:w}):void 0),void 0,!0);if(ue){let ee,Se;if(y?.entries){let Pe=y.entries.find(Ue=>Ue.participantId===oe.participantId),st=M?.entries?.find(Ue=>Ue.participantId===oe.participantId);ee=Pe?.entryStatus||st?.entryStatus,ue.entryStatus=ee,Pe?.entryStage&&(Se=Pe.entryStage,ue.entryStage=Se)}a===!1?Object.assign(oe,{participant:{entryStage:Se,entryStatus:ee}}):Object.assign(oe,{participant:ue})}}if(oe?.participant?.individualParticipantIds?.length&&!oe.participant.individualParticipants?.length){let ue=oe.participant.individualParticipantIds.map(ee=>se(ee)||(i?yd({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:w,participantId:ee}):void 0));a!==!1&&Object.assign(oe.participant,{individualParticipants:ue})}}),!he.matchUpType){let{matchUpType:oe}=nC({matchUp:he});oe&&Object.assign(he,{matchUpType:oe})}if(w?.inferGender&&(!he.gender||he.gender===hm)&&he.sides?.length===2&&he.matchUpType!==sr){let oe=he.sides.map(ue=>{if(Ti(zt)(he.matchUpType))return ue.participant?.person?.sex;if(ue.participant?.individualParticipants?.length===2){let ee=ot(ue.participant.individualParticipants.map(Se=>Se.person?.sex)).filter(Boolean);if(ee.length===1)return ee[0]}});if(oe.filter(Boolean).length===2&&ot(oe).length===1){let ue=oe[0];he.inferredGender=ue}}}if(he.tieMatchUps){let J=he.matchUpStatus==="BYE",se=he.sides?.map(({participant:oe,drawPosition:ue,sideNumber:ee,lineUp:Se})=>{let Pe=oe?.participantType===sr&&oe;return{teamParticipant:Pe&&Ve({participantRoleResponsibilities:Pe.participantRoleResponsibilities,participantOtherName:Pe.participanOthertName,participantName:Pe.participantName,participantId:Pe.participantId,teamId:Pe.teamId}),drawPosition:ue,sideNumber:ee,lineUp:Se}});he.tieMatchUps=he.tieMatchUps.map(oe=>{let ue=he.matchUpId,ee={finishingPositionRange:he.finishingPositionRange,abbreviatedRoundName:pe,roundNumber:ne,roundName:de};return K7({tieDrawPositions:Z,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:se,drawPositionsRanges:n,initialRoundOfPlay:o,roundNamingProfile:u,additionalContext:ee,appliedPolicies:p,isCollectionBye:J,usePublishState:m,publishStatus:b,matchUpTieId:ue,isRoundRobin:T,roundProfile:D,matchUp:oe,event:M,tournamentParticipants:i,positionAssignments:r,tournamentRecord:c,seedAssignments:h,participantMap:g,contextContent:I,scheduleTiming:v,contextProfile:w,drawDefinition:y,scoringActive:S,structure:E,context:R})})}let De=he.sides?.filter(J=>J?.participantId).length===2,Le=!he.winningSide;if(Object.assign(he,{readyToScore:S&&De&&Le,hasContext:!0}),De){let{allParticipantsCheckedIn:J,checkedInParticipantIds:se}=Um({matchUp:he});Object.assign(he,{allParticipantsCheckedIn:J,checkedInParticipantIds:se})}return Array.isArray(w?.exclude)&&w?.exclude.forEach(J=>delete he[J]),he}function Ube({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=mf({timeItems:i?.timeItems||[],itemType:vu});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:Oe(r,!1,!0)}:e}function Tbe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=mf({timeItems:i?.timeItems||[],itemType:Ud});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function Dbe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=mf({timeItems:i?.timeItems||[],itemType:bm});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function Qu(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:s,matchUpFormats:o,roundPositions:l,matchUpFormat:u,collectionIds:c,isMatchUpTie:d,roundNumbers:p,matchUpIds:f,roundNames:h,filterMatchUpTypes:m=!0,filterMatchUpIds:g=!0,stageSequences:I,scheduledDates:v,scheduledDate:w,participantIds:y,processContext:b,tournamentIds:S,matchUpTypes:U,structureIds:T,readyToScore:D,courtIds:P,eventIds:E,venueIds:R,drawIds:C,stages:M}=t,N=Array.isArray(y)?y.filter(Boolean):[],A=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],k=Array.isArray(M)?M.filter(Boolean):[],F=Array.isArray(I)?I.filter(Boolean):[],x=Array.isArray(c)?c.filter(Boolean):[],L=Array.isArray(h)?h.filter(Boolean):[],$=Array.isArray(p)?p.filter(Boolean):[],V=Array.isArray(l)?l.filter(Boolean):[],_=Array.isArray(f)&&g?f.filter(Boolean):[],B=Array.isArray(U)&&m?U.filter(Boolean):[],G=Array.isArray(P)?P.filter(Boolean):[],j=Array.isArray(R)?R.filter(Boolean):[],Y=Array.isArray(o)&&o.filter(Boolean)||typeof u=="string"&&[u]||[],K=Array.isArray(v)&&v.filter(Boolean)||typeof w=="string"&&w.length&&[w]||[],X=Array.isArray(S)?S.filter(Boolean):[],Z=Array.isArray(E)?E.filter(Boolean):[],Q=Array.isArray(C)?C.filter(Boolean):[],ae=Array.isArray(T)?T.filter(Boolean):[];return e.filter(te=>{if(D&&!Ti(Va)(te)&&!te.readyToScore||te.winningSide&&s&&![1,2].includes(te.winningSide)||d!==void 0&&(d&&!te.tieMatchUps||!d&&te.tieMatchUps)||n!==void 0&&(n&&!te.collectionId||!n&&te.collectionId)||k.length&&!k.includes(te.stage)||F.length&&!F.includes(te.stageSequence)||x.length&&(!te.collectionId||!x.includes(te.collectionId))||L.length&&(!te.roundName||!L.includes(te.roundName))||$.length&&(!te.roundNumber||!$.includes(te.roundNumber))||V.length&&(!te.roundPosition||!V.includes(te.roundPosition))||A.length&&(!te.matchUpStatus||!A.includes(te.matchUpStatus))||O.length&&te.matchUpStatus&&O.includes(te.matchUpStatus)||_.length&&!_.includes(te.matchUpId)||B.length&&(!te.matchUpType||!lh(B,te.matchUpType))||Y.length&&(!te.matchUpFormat||!Y.includes(te.matchUpFormat)))return!1;if(K?.length){let{scheduledTime:ne}=LL({matchUp:te}),{scheduledDate:le}=gf({matchUp:te}),de=Qe(ne)||le;if(!K.some(pe=>du(pe,de)))return!1}if(G.length){let{courtId:ne}=Tbe({matchUp:te}),{allocatedCourts:le}=Ube({matchUp:te}),de=le?.map(({courtId:pe})=>pe);if(!G.filter(Boolean).includes(ne)||de?.includes(ne))return!1}if(j.length){let{venueId:ne}=Dbe({matchUp:te});if(!j.filter(Boolean).includes(ne))return!1}if(b){if(X.length&&!X.includes(te.tournamentId)||Z.length&&!Z.includes(te.eventId)||Q.length&&!Q.includes(te.drawId)||ae.length&&!ae.includes(te.structureId))return!1;let ne=te.sides?.map(({participantId:le})=>le).filter(Boolean)??[];if(r&&ne.length<r||N.length&&!N.some(le=>ne.includes(le)))return!1}return!0})}function kt(t){let{provisionalPositioning:e,tournamentRecord:i,contextFilters:r,matchUpFilters:n,contextProfile:a,drawDefinition:s,context:o={},structure:l,inContext:u,event:c}=t,{seedAssignments:d,contextContent:p,exitProfiles:f,matchUpsMap:h}=t,m={},g={};if(!l)return{collectionPositionMatchUps:m,error:sf,roundMatchUps:g,matchUps:[]};let I=Array.isArray(n?.eventIds)?n?.eventIds.filter(Boolean):[],v=Array.isArray(n?.structureIds)?n?.structureIds.filter(Boolean):[],w=Array.isArray(n?.drawIds)?n?.drawIds.filter(Boolean):[],y=!o?.eventId||!I?.length&&!r?.eventIds?.filter(Boolean).length||I?.includes(o.eventId)||r?.eventIds?.includes(o.eventId),b=!v?.length||v.includes(l.structureId),S=!s||!w?.length||w.includes(s.drawId);if(!y||!b||!S)return{collectionPositionMatchUps:m,roundMatchUps:g,matchUps:[]};a&&!p&&(p=Gc({tournamentRecord:i,contextProfile:a,drawDefinition:s}));let{appliedPolicies:U}=Rt({drawDefinition:s}),T={...t.tournamentAppliedPolicies,...U,...t.policyDefinitions},D=T?.scoring?.structures,P=l.stage&&D?.stage?.[l.stage],E=l.stageSequence&&P?.stageSequence?.[l.stageSequence],R=T?.scoring?.requireAllPositionsAssigned||P?.requireAllPositionsAssigned||E?.requireAllPositionsAssigned;h||(h=Or({drawDefinition:s,structure:l}));let{positionAssignments:C,allPositionsAssigned:M}=cr({structure:l}),N=!R||M,{seedAssignments:A}=ms({provisionalPositioning:e,drawDefinition:s,structure:l});d=d??A;let{structureId:O}=l;f=f||s&&E7({drawDefinition:s}).exitProfiles;let k=f?.[O],F=k?.length&&(k[0].split("-").map(G=>parseInt(G)).reduce((G,j)=>G+j)||0),x=!!l.structures,L=Sd({matchUpsMap:h,structureId:O,inContext:u}),$=T?.[gc],V=C7({roundNamingPolicy:$,drawDefinition:s,structure:l,matchUps:L}),{roundNamingProfile:_,roundProfile:B}=V;if(g=V?.roundMatchUps??[],n&&(L=Qu({matchUps:L,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),u){let{sourceDrawPositionRanges:G}=Gye({drawDefinition:s,matchUpsMap:h,structureId:O}),j=s?Hye({drawDefinition:s,roundProfile:B,matchUpsMap:h,structureId:O}).drawPositionsRanges:void 0,Y=t.tournamentParticipants,K=t.participantMap;!Y?.length&&!K&&i&&({participants:Y=[],participantMap:K}=df({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:u})),L=L.map(X=>K7({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:G,tournamentParticipants:Y,positionAssignments:C,drawPositionsRanges:j,initialRoundOfPlay:F,roundNamingProfile:_,tournamentRecord:i,appliedPolicies:T,seedAssignments:d,contextContent:p,participantMap:K,contextProfile:a,drawDefinition:s,scoringActive:N,isRoundRobin:x,roundProfile:B,structure:l,context:o,matchUp:X,event:c})),(L?.filter(X=>Array.isArray(X.tieMatchUps))).forEach(X=>{let Z=X.tieMatchUps;L=L.concat(...Z)}),r&&(L=Qu({processContext:!0,...r,matchUps:L}))}else(L?.filter(G=>Array.isArray(G.tieMatchUps))).forEach(G=>{let j=G.tieMatchUps;L=L.concat(...j)});return n&&(L=Qu({matchUps:L,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n?.matchUpTypes||n?.matchUpIds)&&(L=Qu({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:L})),(n?.matchUpTypes||n?.matchUpIds||u)&&(g=wn({matchUps:L}).roundMatchUps??[]),yn({drawDefinition:s,structure:l,event:c})?.tieFormat&&({collectionPositionMatchUps:m}=Vye({matchUps:L})),{collectionPositionMatchUps:m,roundMatchUps:g,isRoundRobin:x,roundProfile:B,matchUpsMap:h,matchUps:L}}function bp({matchUp:t}){return t?Ji.includes(t?.matchUpStatus)||t?.winningSide:!1}function aC({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:h,contextProfile:m,drawDefinition:g,exitProfiles:I,matchUpsMap:v,structureId:w,inContext:y,structure:b,context:S,event:U}){!b&&w&&({structure:b}=et({drawDefinition:g,structureId:w}));let T=kt({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:h,contextProfile:m,drawDefinition:g,exitProfiles:I,matchUpsMap:v,structure:b,inContext:y,context:S,event:U}),D=[],P=[],E=[],R=[],C=[];if(T.error)return T;let{matchUps:M}=T,{assignedPositions:N}=cr({structure:b}),A=N?.filter(k=>k.participantId).map(k=>k.drawPosition),O;return M.filter(k=>{let F=u?.matchUpTypes?.length===1&&u.matchUpTypes[0]===ei;return!(k.matchUpType!==ei&&F)}).forEach(k=>{if(k.matchUpStatus===fs){D.push(k);return}k.matchUpType===ei&&(O=!0);let F=!!k.collectionId,x=F&&k.sides?.every(G=>G.participantId),L=!F&&k.drawPositions?.filter(Boolean).length===2,$=!F&&k.drawPositions?.every(G=>A?.includes(G)),V=N?.filter(G=>G.bye).map(G=>G.drawPosition),_=!F&&k.drawPositions?.find(G=>V?.includes(G)),B=a7.includes(k.matchUpStatus)&&(x||L&&(!t||$));return _?C.push(k):bp({matchUp:k})?P.push(k):B?E.push(k):R.push(k)}),{includesTeamMatchUps:O,abandonedMatchUps:D,completedMatchUps:P,upcomingMatchUps:E,pendingMatchUps:R,byeMatchUps:C,structure:b}}function Pbe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:_e};if(!i)return{error:Ka};let{links:r}=Iv({drawDefinition:t,structureId:i}),n=r.source.reduce((s,o)=>!o.source.roundNumber||o.source.roundNumber===e?s.concat(o):s,[]),a=r.target.reduce((s,o)=>!o.target.roundNumber||o.target.roundNumber===e?s.concat(o):s,[]);return{links:{source:n,target:a}}}function tk({finishingPositions:t,linkCondition:e,linkType:i,source:r}){let n=r.find(a=>{let s=!a.source?.finishingPositions||!t||Ln(t,a.source?.finishingPositions);return e===a.linkCondition&&s&&a.linkType===i});return[fu,hu].includes(n?.linkType)&&!n?.source?.roundNumber?z({result:{error:ie},stack:"getTargetLink",context:n}):n}function Iv({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>(n.source?.structureId===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),n.target?.structureId===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r),{source:[],target:[]})}:{error:Ka}:{error:_e}}function Ebe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(s=>s.roundNumber===i&&!s.matchUpTieId),a=t.filter(s=>s.roundNumber===i+1&&!s.matchUpTieId);if(a.length){let s;return a.length===n.length?s=a.find(o=>o.roundPosition===r):a.length===n.length/2&&(s=a.find(o=>o.roundPosition===Math.ceil(r/2))),{matchUp:s}}return{message:"no progression found"}}function ik({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){if(!n)return{error:d1};let{target:{structureId:a,feedProfile:s,groupedOrder:o,roundNumber:l,positionInterleave:u}}=n,{structure:c}=et({drawDefinition:r,structureId:a}),{positionAssignments:d}=Kt({structure:c}),p=(e?.filter(D=>D.structureId===c?.structureId)).filter(D=>D.roundNumber===l&&!D.matchUpTieId),f=p.length,h=Re(1,f+1),m=f/t,g=Math.ceil(m*i),I=1-i%2;if(u?.interleave&&m!==.5){let D=u.offset+(i-1)*u.interleave,P=i+D;g=Math.ceil(P/2),I=1-P%2}let v=h,w=h[g-1],y=P7({roundPositionsCount:h.length,groupedOrder:o}),b=y?.length||1;if(b<=h.length){let D=f/b,P=br(h,D);s===Ap&&P.forEach(E=>E.reverse()),v=y?.length&&y?.map(E=>P[E-1]).flat()||v}s===Os?w=v[g-1]:s===Ap?((!y?.length||b>h.length)&&(g=p.length+1-g),w=v[g-1]):s===MR&&ua()&&console.log(C1,{feedProfile:s});let S=w&&p.reduce((D,P)=>P.roundPosition===w?P:D,void 0),U;S?.feedRound?(I=0,U=Math.min(...(S.drawPositions||[]).filter(Boolean))):U=S?.drawPositions?.length===2&&S?.drawPositions[I];let T=d?.find(({drawPosition:D})=>D===U);if(T){let{extension:D}=it({element:T,name:GR});if(D?.value)return{disabledDrawPosition:U}}return{matchUp:S,targetDrawPosition:U,matchUpDrawPositionIndex:I}}function _n({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(o=>o.matchUpId===n));let{structure:s}=et({structureId:a?.structureId,drawDefinition:r});return s?.finishingPosition===gm?Rbe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:s,matchUp:a}):Cbe({matchUp:a})}function Rbe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){let{winnerMatchUpId:a,loserMatchUpId:s}=n,{links:o}=Pbe({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),l=o?.source,u=tk({source:l,linkType:fu}),c=tk({linkCondition:fl,linkType:hu,source:l}),d=tk({source:l,linkType:hu}),p=c&&d;d||(d=c);let f=u?.target?.feedProfile,h=d?.target?.feedProfile,m=c?.target?.feedProfile,g,I,v,w,y,b,S,U,T,D;if(e&&(a||s)&&(S=a&&f!==ks&&t.find(({matchUpId:R})=>R===a),w=s&&h!==ks&&t.find(({matchUpId:R})=>R===s),S||w))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u},targetMatchUps:{loserMatchUp:w,winnerMatchUp:S}};let{roundPosition:P}=n;D=D||t.filter(R=>R.structureId===r.structureId);let E=D.reduce((R,C)=>C.roundNumber===n.roundNumber&&!C.matchUpTieId?R+1:R,0);return d&&!w&&h!==ks&&({matchUpDrawPositionIndex:b,targetDrawPosition:y,matchUp:w}=ik({targetLink:d,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),p&&m!==ks&&({matchUpDrawPositionIndex:v,targetDrawPosition:I,matchUp:g}=ik({targetLink:c,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),u&&!S&&f!==ks&&({matchUpDrawPositionIndex:T,targetDrawPosition:U,matchUp:S}=ik({targetLink:u,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),S||(D=D||t.filter(R=>R.structureId===r.structureId),{matchUp:S}=Ebe({structureMatchUps:D,matchUp:n})),Ve({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u,byeTargetLink:c},targetMatchUps:{winnerMatchUpDrawPositionIndex:T,loserMatchUpDrawPositionIndex:b,byeMatchUpDrawPositionIndex:v,winnerTargetDrawPosition:U,loserTargetDrawPosition:y,byeTargetDrawPosition:I,winnerMatchUp:S,loserMatchUp:w,byeMatchUp:g},targetMatchUpIds:!!(a||s)})}function Cbe({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function Mbe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{let{matchUpId:n,structureId:a,drawPositions:s=[]}=r,{structure:o}=et({drawDefinition:t,structureId:a});if(o?.finishingPosition===kp){let{roundNumber:l}=r,u=l&&Ye(l)+1,c=o.matchUps??[],{roundMatchUps:d}=wn({matchUps:c});if(u&&d?.[u]){let p=[...s].sort(ar).map((f,h)=>{let m=d[u].find(g=>g.drawPositions?.includes(f));return{matchUpId:m?.matchUpId,roundNumber:u,schedule:m?.schedule,sideNumber:h+1,structureName:o.structureName}});Object.assign(r,{sidesTo:p})}}else{let l=_n({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:n}),{winnerMatchUp:u}=l.targetMatchUps,{loserMatchUp:c}=l.targetMatchUps;!r.winnerMatchUpId&&u&&(r.winnerMatchUpId=u.matchUpId),!r.loserMatchUpId&&c&&(r.loserMatchUpId=c.matchUpId);let d=rk({upcomingMatchUp:u}),p=rk({upcomingMatchUp:c});if(r.matchUpStatus!=="BYE"&&c?.matchUpStatus==="BYE"){let{matchUp:h}=X7({matchUp:c,drawDefinition:t,inContextDrawMatchUps:e})||{};p=h&&rk({upcomingMatchUp:h})||p}let f=r.schedule?.timeAfterRecovery;if(f&&(d?.schedule?.scheduledTime&&Mt(d.schedule.scheduledTime)<Mt(f)&&(i[d.matchUpId]=r.matchUpId,d.schedule.scheduleConflict=r.matchUpId),p?.schedule?.scheduledTime&&Mt(p.schedule.scheduledTime)<Mt(f)&&(i[p.matchUpId]=r.matchUpId,p.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:d,loserTo:p}),r.drawPositions?.filter(Boolean).length){let h=l.targetLinks?.loserTargetLink?.linkCondition===fl,m=Nbe(r);if(m.length){let g=BO(u?.sides),I=BO(c?.sides),v=m.find(({participantId:y})=>g.includes(y))?[]:m,w=m.find(({participantId:y})=>I.includes(y))?[]:m;c&&h&&w.length<2&&w.push({bye:!0,tbd:!0}),v?.length&&u&&(!l.targetMatchUpIds&&u&&(u=e.find(({matchUpId:y})=>y===u.matchUpId)),u.potentialParticipants||(u.potentialParticipants=[]),u.potentialParticipants.push(v)),w?.length&&c&&(l.targetMatchUpIds||(u=e.find(({matchUpId:y})=>y===c.matchUpId)),c.potentialParticipants||(c.potentialParticipants=[]),c.potentialParticipants.push(w))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function Nbe(t){return t?.sides?.map(({participant:e,participantId:i,qualifier:r})=>e||i&&{participantId:i}||r&&{qualifier:r}).filter(Boolean)||[]}function X7({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){let{matchUpId:r,matchUpStatus:n,structureId:a}=t||{};if(!t||!a||t?.matchUpStatus===Li)return{matchUp:t};if(n==="BYE"){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:o})=>o===t.winnerMatchUpId):{winnerMatchUp:s}=_n({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r})?.targetMatchUps||{},X7({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function rk(t){if(t?.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s}))(t.upcomingMatchUp)}function rr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=vv(t);if(i.error)return z({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:s,byeMatchUps:o,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...s??[],...o??[]),matchUpsMap:l}}function vv(t){if(!t?.drawDefinition)return{error:_e};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:s,participantsProfile:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,scheduleTiming:h,participantMap:m,publishStatus:g,contextProfile:I,drawDefinition:v,nextMatchUps:w,inContext:y,context:b,event:S}=t,U=[],T=[],D=[],P=[],E=[];I&&!i&&(i=Gc({policyDefinitions:u,tournamentRecord:c,contextProfile:I,event:S}));let R;!e?.length&&c&&(e=c?.participants,(y||o?.withGroupings)&&e?.length&&({participantsWithGroupings:e,groupInfo:R}=KR({participants:e,participantsProfile:o})));let{structures:C}=to({drawDefinition:v});if(!C)return{error:vi};r||(r=Or({drawDefinition:v}));let M=v&&E7({drawDefinition:v}).exitProfiles;C.forEach(O=>{let{byeMatchUps:k=[],pendingMatchUps:F=[],upcomingMatchUps:x=[],completedMatchUps:L=[],abandonedMatchUps:$=[]}=aC({matchUpFilters:w?void 0:f,contextFilters:w?void 0:p,inContext:y||w||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:h,publishStatus:g,contextProfile:I,drawDefinition:v,exitProfiles:M,matchUpsMap:r,structure:O,context:b,event:S});U=U.concat(...$),T=T.concat(...L),D=D.concat(...x),P=P.concat(...F),E=E.concat(...k)});let N=O=>(!f&&!w&&!p||(f&&(O=Qu({matchUps:O,...f})),p&&(O=Qu({matchUps:O,...p,processContext:!0}))),O),A={abandonedMatchUps:N(U),completedMatchUps:N(T),upcomingMatchUps:N(D),pendingMatchUps:N(P),byeMatchUps:N(E),matchUpsMap:r,...H,groupInfo:R};if(w){let O=typeof w=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:k,completed:F,upcoming:x,pending:L,bye:$}=O,V=[].concat(...k&&U||[],...F&&T||[],...x&&D||[],...L&&P||[],...$&&E||[]);Mbe({inContextDrawMatchUps:V,drawDefinition:v})}return A}function Lu(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:h,nextMatchUps:m,inContext:g,context:I,event:v}=t;if(!v)return{error:ui};let{eventId:w,eventName:y,endDate:b,eventType:S,category:U,gender:T,matchUpFormat:D}=v??{},P={...I,...Ve({indoorOutDoor:v.indoorOutdoor??c?.indoorOutdoor,surfaceCategory:v.surfaceCategory??c?.surfaceCategory,endDate:v.endDate??c?.endDate,tournamentId:c?.tournamentId,matchUpFormat:D,eventName:y,eventType:S,category:U,eventId:w,gender:T})};b&&(P.endDate=b),h&&!i&&(i=Gc({policyDefinitions:l,tournamentRecord:c,contextProfile:h,event:v}));let E;if(!e?.length&&!r&&c){let M=df({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:h,inContext:g});r=M.participantMap,e=M.participants??[],E=M.groupInfo}let R=v.drawDefinitions??[],C=hS({tournamentRecord:c,event:v}).scheduleTiming;return{matchUps:R.flatMap(M=>{let{matchUps:N}=rr({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:P,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextFilters:p,contextProfile:h,drawDefinition:M,contextContent:i,matchUpFilters:f,participantMap:r,scheduleTiming:C,nextMatchUps:m,inContext:g,event:v});return N??[]}),groupInfo:E}}function wr(t){let e=Ge(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!t?.tournamentRecord)return{error:ge};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:s,useParticipantMap:o,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,usePublishState:d,contextProfile:p,matchUpFilters:f,contextFilters:h,nextMatchUps:m,context:g}=t,I=t.tournamentId??u.tournamentId,v=u?.events??[];r||({participants:r,participantMap:i}=df({participantsProfile:a,useParticipantMap:o,tournamentRecord:u,contextProfile:p,inContext:c}));let{appliedPolicies:w}=Rt({tournamentRecord:u}),y={...g,tournamentId:I,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},b=Gc({policyDefinitions:l,tournamentRecord:u,contextProfile:p});return{matchUps:v.flatMap(S=>(y.eventDrawsCount=S.drawDefinitions?.length??0,Lu({context:y,scheduleVisibilityFilters:n,tournamentAppliedPolicies:w,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:b,contextFilters:h,contextProfile:p,matchUpFilters:f,participantMap:i,nextMatchUps:m,participants:r,inContext:c,event:S}).matchUps??[])).concat(...u.matchUps??[])}}function Oo({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}){if(typeof r!="object"||!Object.keys(r).length)return{error:Ri};let c=Object.keys(r).map(d=>{let p=r[d];return wr({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:p,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}).matchUps??[]}).flat();return{...H,matchUps:c}}function Tm(t,e){return Abe(t,e)||(t?.stageSequence||0)-(e?.stageSequence||0)||t?.roundNumber&&e.roundNumber&&t?.roundNumber-e?.roundNumber||(t?.roundPosition??0)-(e?.roundPosition??0)}function Abe(t,e){return(xh[t?.stage]||0)-(xh[e?.stage]||0)}function Nn(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:f,drawDefinition:h,nextMatchUps:m,inContext:g,context:I,event:v}=t,{eventId:w,eventName:y,endDate:b,eventType:S,category:U,gender:T,matchUpFormat:D}=v??{},P={...I,surfaceCategory:v?.surfaceCategory??c?.surfaceCategory,indoorOutDoor:v?.indoorOutdoor??c?.indoorOutdoor,matchUpFormat:D,eventType:S,eventName:y,category:U,eventId:w,endDate:b,gender:T},E;return!e?.length&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:E}=df({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:f,inContext:g})),f&&!r&&(r=Gc({policyDefinitions:l,tournamentRecord:c,contextProfile:f,drawDefinition:h,event:v})),{...rr({context:P,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,drawDefinition:h,contextContent:r,contextFilters:p,contextProfile:f,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:v}),groupInfo:E}}function wp({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Oe(t),r=e.split("."),n=[],a;o({targetElement:i,attributes:r});let s={value:a};return n.length&&(s.values=n),s;function o({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,f]of u.entries())if(l?.[f]){let h=u.slice(p+1);h.length?Array.isArray(l[f])?l[f].forEach(m=>o({targetElement:m,attributes:h})):(l=l[f],d({targetElement:l,index:p})):(a||(a=l[f]),n.includes(l[f])||n.push(l[f]))}function d({targetElement:p,index:f}){if(p&&f===u.length-1&&["string","number"].includes(typeof p)){let h=c?p.slice(0,c):p;a?n.includes(h)||n.push(h):(a=h,n.push(h))}}}}var J7=t=>e=>!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(i=>({[i]:wp({element:e,accessor:i})?.value}))||typeof t=="object"&&Object.keys(t).map(i=>({[i]:wp({element:e,accessor:i})?.value}))||(typeof t=="string"&&wp({element:e,accessor:t}))?.value,Pa=J7;function DS({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:s,fmlc:o}){if(!Ja(a))return[];let{roundProfile:l,roundNumbers:u=[]}=wn({interpolate:!0,matchUps:a});r=r??Math.max(...u,0);let c=n?r-n:0,d=c&&l?.[r-c]?.matchUpsCount,p=l&&Object.values(l).map(Pa("matchUpsCount")),f=(g,I)=>{let v=Math.min(...g);d&&I&&v===1&&(v=d);let w=Math.max(...g);return e&&w>e&&(w=e),[v,w]},h=l&&Object.assign({},...u.map(g=>{let I=(r??0)+1-g-c,v=l[g].matchUpsCount,w={finishingPositionRange:{},finishingRound:I},y=p?.slice(g-1).reduce((R,C)=>R+(C||0),0),b=o&&g!==1,S=1+t+(b?i??0:0),U=1,T=Re(S,s?S+v*2:y+S+U),D=y+U-v,P=f(T.slice(D)),E=f(T.slice(0,D),!0);return w.finishingPositionRange={loser:P,winner:E},{[g]:w}})),m=ua({finishingRound:!0});return a.filter(Boolean).forEach(g=>{let I=g.roundNumber&&h[g.roundNumber];m&&!I&&console.log({roundFinishingData:h,matchUp:g}),g.finishingRound=I?.finishingRound,g.finishingPositionRange=I?.finishingPositionRange}),a}function Lp({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){if(!e)return{error:_e};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=rr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!i?.drawMatchUps.some(n=>n.finishingPositionRange)&&e?.structures?.length===1&&!e?.structures[0].structures){let n=i?.drawMatchUps??[];DS({matchUps:n})}return(t??[]).filter(({collectionId:n})=>!n).forEach(n=>{let{matchUpId:a,structureId:s}=n,o=_n({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:a}),{winnerMatchUp:l,loserMatchUp:u}=o.targetMatchUps,c=l?.matchUpId,d=u?.matchUpId,p=Sd({matchUpsMap:i,structureId:s}).find(f=>f.matchUpId===a);if(p&&(c&&(r.winnerMatchUpIds[p.matchUpId]=c,Object.assign(p,{winnerMatchUpId:c}),Object.assign(n,{winnerMatchUpId:c})),d&&(r.loserMatchUpIds[p.matchUpId]=d,n.loserMatchUpId=d,p.loserMatchUpId=d,n.finishingPositionRange))){let f=u.finishingPositionRange&&[...n.finishingPositionRange.loser,...u.finishingPositionRange.loser],h=f&&[Math.min(...f),Math.max(...f)];n.finishingPositionRange.loser=h,p.finishingPositionRange.loser=h}}),{inContextDrawMatchUps:t,goesToMap:r}}function fo(t){let e=ws(t),i=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:s}=t;if(!Array.isArray(i))return{error:Ou};if(!Array.isArray(r))return{error:Vo};let o=t.matchUpIds?.length?t.matchUpIds:i.map(v=>v.matchUpId);if(!Array.isArray(o))return{error:um};let l={},u={},c={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),f=p.reduce((v,w)=>v.concat(w.events??[]).map(y=>(y.drawDefinitions||[]).map(b=>b.links||[])).flat(1/0),[]).filter(({linkType:v})=>v===pu),h=i;if(f.length){h=Oo({nextMatchUps:!0,tournamentRecords:e}).matchUps;let v=f.reduce((w,y)=>{let b=y.source?.structureId,S=y.target?.structureId;return b&&S&&(c[S]=b),b&&!w.includes(b)&&w.push(b),w},[]);for(let w of v)l[w]=[];for(let w of h??[]){let y=w.containerStructureId||w.structureId;v.includes(y)&&l[y].push(w.matchUpId)}}let m=v=>{u[v]||(u[v]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[v]=[])},g=(v,w)=>{u[v].matchUpIds.forEach(y=>{u[w].matchUpIds.push(y)}),u[w].matchUpIds.push(v),u[v].dependentMatchUpIds.push(w),n&&u[v].participantIds.forEach(y=>u[w].participantIds.push(y))},I=v=>{let w=Object.keys(l).length;for(let y of v||[]){let{matchUpId:b,winnerMatchUpId:S,loserMatchUpId:U}=y;if(!o.length||o.includes(b)){if(m(b),n){let{individualParticipantIds:P}=YR(y);u[b].participantIds=P}S&&(m(S),g(b,S),d[S].push(b)),U&&(m(U),g(b,U),d[U].push(b)),u[b].sources.push(d[b]);let T=d[b].map(P=>u[P].sources[0]).flat(),D=d[b].map(P=>u[P].sources[1]).flat();if(u[b].sources.push(T,D),w){let P=y.containerStructureId||y.structureId,E=c[P];if(l[E])for(let R of l[E])m(R),g(R,b),d[R].push(b)}}}};if(s)Lp({drawDefinition:s}),h?.length||(h=Nn({drawDefinition:s}).matchUps),I(h);else{if(h?.length||(h=Oo({nextMatchUps:!0,tournamentRecords:e}).matchUps),!r.length){let v=p?.length?p.map(({events:w=[]})=>w.map(({drawDefinitions:y=[]})=>y.map(({drawId:b})=>b))).flat(1/0):[];v&&(r=v)}for(let v of r){let w=h?.filter(y=>y.drawId===v).sort(Tm);if(!w?.find(({roundPosition:y})=>!y)){let y=w?.find(({tournamentId:S})=>S),{drawDefinition:b}=zn({tournamentRecord:e[y?.tournamentId],drawId:v});b&&Lp({drawDefinition:b})}I(w)}}return{positionDependencies:l,matchUpDependencies:u,sourceMatchUpIds:d,matchUps:h,...H}}function dr(t){let e=t?.matchUp,i=t?.score||e?.score,r=i?.sets?.[0],{side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o,side1PointScore:l,side2PointScore:u}=r||{},c=n||a||s||o||l||u;return!!(i?.sets?.length>1||c)}function PS({matchUpStatus:t}){return r7.includes(t)}function kbe({matchUpStatus:t}){return dL.includes(t)}function qO({matchUpStatus:t}){return n7.includes(t)}function BL({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){let a=r?.find(({participantId:o})=>o),s=i?.filter(BL)?.length;return dr({score:n})||s||e&&a||t&&kbe({matchUpStatus:t})&&![Zt,mi,uo].includes(t)}function yv(t){let{drawDefinition:e,findContainer:i,structureId:r,event:n}=t,a=t.structure,{containedStructures:s}=gv({drawDefinition:e}),o=r?s[r]||[]:[],l={isCollectionMatchUp:!1};if(!a){let U=et({drawDefinition:e,structureId:r});if(U.error)return U;a=i?U.containingStructure??U.structure:U.structure}if(Wn({structure:a}))return{structure:a,isAdHoc:!0,error:lm};let{matchUps:u}=rr({inContext:!0,matchUpFilters:l,drawDefinition:e,event:n}),c=u?.filter(U=>U.structureId===r||o.includes(U.structureId)),{matchUpDependencies:d}=fo({drawIds:[e.drawId],matchUps:u,drawDefinition:e}),p=[],f=[],h={},m=[];for(let U of u??[]){if(U.structureId===r||o.includes(U.structureId)){f.push(...U.drawPositions??[]);let T=U.roundNumber;for(let D of(U.drawPositions??[]).filter(Boolean))(!h[D]||T&&h[D]>T)&&(h[D]=T)}BL(U)&&(m.push(U),p.push(U.matchUpId,...d?.[U?.matchUpId]?.matchUpIds||[]))}let g=ot(f.filter(Boolean)).sort(ar),I=ot(p),v=ot(c?.map(({matchUpId:U,drawPositions:T})=>I.includes(U)?T:[]).flat().filter(Boolean)).sort(ar),{positionAssignments:w}=Kt({drawDefinition:e,structure:a}),y=w?.filter(U=>U.bye).map(U=>U.drawPosition),b=w?.filter(U=>U.qualifier).map(U=>U.drawPosition),S=g?.filter(U=>!v.includes(U))||[];return{allDrawPositions:g,inContextStructureMatchUps:c,drawPositionInitialRounds:h,activeDependentMatchUpIds:I,qualifyingDrawPositions:b,inactiveDrawPositions:S,positionAssignments:w,activeDrawPositions:v,byeDrawPositions:y,activeMatchUps:m,structure:a}}function $h({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&i?.includes(t)).map(({roundNumber:i})=>i).sort(ar)[0]}}var ed={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},VL=[];function Ht(t,e){ni(t)&&(t={method:t}),(e||ua())&&VL.push(t)}function Obe(t){return VL.slice()}function xbe(t){let e=Obe().map(i=>{let{color:r,keyColors:n,method:a,newline:s}=i,o=Object.keys(ed).includes(r)?ed[r]:ed.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=n&&Object.keys(n).includes(c)&&ed[n[c]]?ed[n[c]]:ed.brightwhite;return`${ed.white}${c}: ${d}${i[c]}`}).join(", "),u=a?.length<15?"		":"	";return[s?`
`:"",o,a,u,ed.white,l,ed.reset,`
`].join("")});e?.length&&console.log(...e)}function Fbe(){VL.length=0}function jL(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,containsParticipant:r,filled:e||i||r}}function $r(t){return[Zt,mi,jr].includes(t)}function Za({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,loserMatchUp:a,matchUpsMap:s,structureId:o,structure:l,event:u}){if(!r)return{error:_e};if(l||({structure:l}=et({drawDefinition:r,structureId:o})),!l)return{error:vi};o||({structureId:o}=l);let c="assignDrawPositionBye";Ht({method:c,color:"cyan",drawPosition:n}),s??=Or({drawDefinition:r});let{positionAssignments:d}=Kt({structure:l}),{activeDrawPositions:p}=yv({drawDefinition:r,structureId:o});if(d?.find(E=>E.drawPosition===n)?.bye)return{...H};let f=!!(a&&s.drawMatchUps.some(E=>E.loserMatchUpId===a?.matchUpId&&$r(E.matchUpStatus)));if(p?.includes(n)&&!f)return{error:Hw};let h=d?.find(E=>E.drawPosition===n);if(!h)return{error:lm};let{filled:m,containsBye:g,containsParticipant:I}=jL(h);if(g)return{...H};if(m&&!g&&!f)return z({result:{error:iI},stack:c});let v=Rt({tournamentRecord:i,drawDefinition:r,event:u}).appliedPolicies??{},w=rr({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[],y={isCollectionMatchUp:!1},{matchUps:b}=kt({provisionalPositioning:t,drawDefinition:r,matchUpFilters:y,matchUpsMap:s,structure:l});if(d?.forEach(E=>{E.drawPosition===n&&(E.bye=!0,f&&(E.participantId=void 0))}),l.structureType===hn)return Lbe({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:b}),bc({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:u}),AW({assignedParticipantId:I,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:c});let{roundProfile:S,roundMatchUps:U}=wn({matchUps:b}),T=(S&&Object.keys(S).map(E=>Number.parseInt(E)).reverse())?.find(E=>S?.[E].drawPositions?.includes(n)),D=T?U?.[T].find(({drawPositions:E})=>E?.includes(n)):void 0;D&&Q7({tournamentRecord:i,drawDefinition:r,matchUp:D,event:u});let P=D?.drawPositions?.find(E=>E!==n);if(D&&P){let E=GL({sourceDrawPositions:D.drawPositions,matchUpId:D.matchUpId,inContextDrawMatchUps:w,drawPositionToAdvance:P,tournamentRecord:i,drawDefinition:r,matchUpsMap:s});if(E.error)return E}return bc({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:u}),AW({assignedParticipantId:I,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:c})}function AW({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&dS({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),z({result:{...H},stack:s})}function Q7({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:"BYE",score:void 0,winningSide:void 0}),Tt({tournamentId:t?.tournamentId,eventId:i??n?.eventId,context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function Lbe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{a.drawPositions?.includes(i)&&Q7({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function GL({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:s,event:o}){Ht({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(w=>w.matchUpId===s),u=e.find(w=>w.matchUpId===s)?.structureId,{structure:c}=et({drawDefinition:n,structureId:u}),{positionAssignments:d}=Kt({structure:c}),p=d?.filter(w=>w.bye).map(w=>w.drawPosition),f=l?.drawPositions?.find(w=>w!==t),h=f&&p?.includes(f),{targetLinks:{loserTargetLink:m},targetMatchUps:{loserMatchUp:g,winnerMatchUp:I,loserTargetDrawPosition:v}}=_n({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:s});if(I&&I.structureId===c?.structureId&&_be({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:I,matchUpsMap:a,event:o}),g&&h&&g.structureId!==c?.structureId){let{roundNumber:w}=g;if(w===1){let y=Za({structureId:m.target.structureId,drawPosition:v,tournamentRecord:r,drawDefinition:n,event:o});if(y.error)return y}else Z7({loserTargetDrawPosition:v,tournamentRecord:r,loserTargetLink:m,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:o})}return{...H}}function _be({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:s,event:o}){let l="advanceWinner",u=s.drawMatchUps.find(M=>M.matchUpId===a.matchUpId),c=e.find(M=>M.matchUpId===a.matchUpId)?.structureId,{structure:d}=et({drawDefinition:n,structureId:c}),{positionAssignments:p}=Kt({structure:d}),f=p?.find(({drawPosition:M})=>M===t)?.bye,h=u.drawPositions?.filter(Boolean),m=p?.filter(M=>h?.includes(M.drawPosition)),g=p?.find(({drawPosition:M})=>M===t),I=i?.find(M=>M!==t),v=(I&&m?.find(({drawPosition:M})=>M===I))?.bye,w=f&&v;if(w&&console.log({isByeAdvancedBye:w}),h?.length>1&&f&&!v)return z({result:{error:iI},stack:l});let y=h?.find(M=>M!==t),b=w,S=[...(u.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),U=S.map(M=>!M&&!b||M===t?(b=!0,t):M).sort(ar);if(!b)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:m}),z({result:{error:iI},stack:l});let T=p?.find(({drawPosition:M})=>M===y)?.bye,D=p?.find(({drawPosition:M})=>M===t)?.bye;Object.assign(u,{matchUpStatus:D||T?"BYE":Li,score:void 0,winningSide:void 0,drawPositions:U});let P=u.drawPositions.find(M=>!S.includes(M));Ht({method:l,color:"brightyellow",changedDrawPosition:P,pairedDrawPositionIsBye:T,drawPositionIsBye:D}),Tt({tournamentId:r?.tournamentId,matchUp:u,eventId:o?.eventId,context:l,drawDefinition:n});let{targetLinks:{loserTargetLink:E},targetMatchUps:{loserMatchUp:R,loserTargetDrawPosition:C}}=_n({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(T||D){let M=T?t:y;if(M)GL({drawPositionToAdvance:M,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:s});else if(D&&E&&R)if(R.feedRound)Z7({loserTargetDrawPosition:C,tournamentRecord:r,loserTargetLink:E,drawDefinition:n,loserMatchUp:R,matchUpsMap:s});else{let N=1-a.roundPosition%2,A=R.drawPositions[N],O=Za({structureId:E.target.structureId,drawPosition:A,tournamentRecord:r,drawDefinition:n,event:o});if(O.error)return O}}}function Z7({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{roundNumber:o}=n;Ht({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=(a?.mappedMatchUps||{})[n.structureId].matchUps,{initialRoundNumber:u}=$h({drawPosition:t,matchUps:l});if(u===o){let c=Za({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:s});if(c.error)return c}}function e8({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:s}=kt({drawDefinition:i,matchUpsMap:r,structure:n,event:a});s.forEach(o=>{let l=t.filter(({drawPosition:u})=>o.drawPositions?.includes(u)).filter(u=>u.bye).length;o.winningSide||(Object.assign(o,{matchUpStatus:l?"BYE":Li}),Tt({tournamentId:e?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:i,matchUp:o}))})}function ES(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:s,matchUpsMap:o,event:l}=t,{structure:u}=et({drawDefinition:a,structureId:s}),c=(cr({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(c&&i&&!r&&(r=c?.drawPosition),!r)return{error:av};i||(i=c?.participantId);let{activeDrawPositions:d}=yv({drawDefinition:a,structureId:s});return d.includes(r)?{error:Hw}:(e||({matchUps:e}=rr({inContext:!0,drawDefinition:a,matchUpsMap:o})),YO({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:s,drawPosition:r,matchUpsMap:o,event:l}).drawPositionCleared?(bc({tournamentId:n?.tournamentId,drawDefinition:a,structure:u,event:l}),{...H,participantId:i}):{error:l4})}function YO({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:s}){let{structure:o}=et({drawDefinition:i,structureId:a});if(!o)return{error:vi};let l=cr({drawDefinition:i,structure:o}).positionAssignments||[],u=l.some(I=>{if(I.drawPosition===r)return delete I.participantId,delete I.qualifier,delete I.bye,!0});if(o.structureType===hn)return e8({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:o}),{drawPositionCleared:u,...H};let c={isCollectionMatchUp:!1},{matchUps:d}=kt({drawDefinition:i,matchUpFilters:c,matchUpsMap:n,structure:o,event:s}),{roundProfile:p,roundMatchUps:f}=wn({matchUps:d}),h=(p&&Object.keys(p))?.map(I=>Ye(I)),m=r,g=h?.map(I=>{let v=p?.[I]?.pairedDrawPositions?.find(P=>P.includes(m)),w=v?.find(P=>P!==m),y=l.find(P=>P.drawPosition===w),b=p?.[I+1],S=y?.bye,U=b?.pairedDrawPositions?.find(P=>P.includes(w)),T=S&&U&&b&&b.drawPositions?.includes(w),D=v&&{pairedDrawPositionByeAdvancedPair:!T&&U,pairedDrawPosition:w,targetDrawPosition:m,relevantPair:v,roundNumber:I};return T&&(m=w),D}).filter(I=>I?.targetDrawPosition)?.reduce((I,v)=>{let{roundNumber:w,relevantPair:y,targetDrawPosition:b,pairedDrawPosition:S,pairedDrawPositionByeAdvancedPair:U}=v,T={roundNumber:w,targetDrawPosition:b,relevantPair:y},D=U&&{roundNumber:w+1,targetDrawPosition:S,relevantPair:U,subsequentRoundRemoval:!0},P=[T,D].filter(Boolean);return I.concat(...P)},[]);return g?.forEach(({roundNumber:I,targetDrawPosition:v,relevantPair:w})=>{let y=f?.[I].find(b=>Ln(b.drawPositions?.filter(Boolean),w.filter(Boolean)));y&&($be({inContextDrawMatchUps:t,targetDrawPosition:v,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:I,matchUpsMap:n}),t8({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:y,drawPosition:r,matchUpsMap:n,structure:o,event:s}))}),{tasks:g,drawPositionCleared:u,positionAssignments:l}}function $be({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:s}){let{structure:o}=et({drawDefinition:r,structureId:s});if(!o)return{error:vi};if(o.structureType===hn)return;n=n||Or({drawDefinition:r});let l=(n?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:u}=$h({drawPosition:e,matchUps:l}),c=l?.filter(p=>p.roundNumber>=a&&p.roundNumber!==u&&p.drawPositions?.includes(e)),d=Kt({drawDefinition:r,structureId:s}).positionAssignments??[];return c?.forEach(p=>t8({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:o})),{...H}}function t8({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u="removeDrawPosition",c=n.drawPositions?.slice(),d=n.matchUpStatus,p=n.winningSide;s=s??Or({drawDefinition:r});let f=s.mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:h}=$h({drawPosition:a,matchUps:f});if(n.roundNumber&&h&&n.roundNumber>h){let U=(n.drawPositions??[]).map(T=>T===a?void 0:T);n.drawPositions=U}if(n.matchUpType===ei){let U=(t?.find(T=>T.matchUpId===n.matchUpId)?.sides??[]).reduce((T,D,P)=>D.drawPosition===a?P:T,void 0);U!==void 0&&n.sides?.[U]?.lineUp&&(delete n.sides?.[U].lineUp,Tt({tournamentId:i?.tournamentId,context:`${u}-TEAM`,eventId:l?.eventId,matchUp:n,drawDefinition:r}))}let m=_n({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:I,winnerMatchUp:v,loserMatchUpDrawPositionIndex:w}}=m,y=e.filter(({drawPosition:U})=>n.drawPositions?.includes(U)).filter(U=>U.bye).length,b=y&&"BYE"||n.matchUpStatus&&$r(n.matchUpStatus)&&n.matcHUpStatus||Li;n.matchUpStatus=b,n.matchUpStatus&&$r(n.matchUpStatus)&&(n.winningSide=void 0);let S=c?.find(U=>!n.drawPositions?.includes(U));if(c?.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(S&&Ht({method:u,color:"brightyellow",removedDrawPosition:S}),Tt({tournamentId:i?.tournamentId,context:`${u}-${a}`,eventId:l?.eventId,matchUp:n,drawDefinition:r})),I&&I.structureId!==m.matchUp.structureId&&!y){let{drawPositions:U,roundNumber:T}=I;if(T===1){let D=U[w];YO({structureId:I.structureId,drawPosition:D,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s})}else{let D=Math.min(...U.filter(Boolean)),P=Bbe({loserMatchUpDrawPosition:D,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:I,matchUpsMap:s,event:l});if(P.error)return z({result:P,stack:u});let E=(s?.mappedMatchUps||{})[I.structureId].matchUps,{initialRoundNumber:R}=$h({drawPosition:D,matchUps:E});R===1&&(Ht({method:u,color:"brightyellow",loserMatchUpDrawPosition:D}),YO({structureId:I.structureId,drawPosition:D,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s}))}}return v&&v.structureId!==m.matchUp.structureId&&g.target.feedProfile,{...H}}function Bbe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{structure:o}=et({structureId:n.structureId,drawDefinition:r}),{positionAssignments:l}=Kt({structure:o});if(l?.find(u=>u.drawPosition===t)?.bye){let u=ES({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:s});if(u.error)return u}return{...H}}function If({drawDefinition:t,stages:e}){if(!t)return{error:_e};let i=(t?.structures??[]).filter(n=>!e?.length||n.stage&&e.includes(n.stage)),r=ot(i.map(n=>{let{positionAssignments:a}=Kt({structure:n});return a?a.map(bt):[]}).flat().filter(Boolean));return{...H,assignedParticipantIds:r}}function Do(t){let e=(t?.entries??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:s}=n,o=`_${a||Fe}${s||""}`;return r[o]||(r[o]=[]),r[o].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let s=a+1;return{...n,entryPosition:s}})).flat()}function mp(t){return[ff,Us].includes(t)}function bP({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:s,extension:o,eventSync:l,drawId:u,stage:c,event:d}){if(!n||!Array.isArray(n))return{error:No,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:ui};if(a&&!D7.includes(a))return{error:CO};if(s&&!PR.includes(s))return{error:of};let p="modifyEntriesStatus",f=[];if(!a&&!o)return z({result:{error:Xe},info:"Missing entryStatus",stack:p});if(o&&!hl({extension:o,requiredAttributes:["name"]}))return z({result:{error:ie},info:"Invalid extension",context:{extension:o},stack:p});let h=[];d?.drawDefinitions?.forEach(D=>{let P=If({stages:c&&[c],drawDefinition:D}).assignedParticipantIds??[];h.push(...P)});let m=i?.participants??[];if(!n.every(D=>{let P=yd({tournamentParticipants:m,participantId:D})?.participantType;return!(P&&[ht,jn].includes(P)&&mp(a))&&!(a&&d?.eventType&&P===vt&&[ps,Da].includes(d.eventType)&&[Bs,...gD].includes(a))}))return{error:CO};let g=d&&Bi({event:d}).flightProfile,I=g?.flights?.find(D=>D.drawId===u),v=D=>{let P=(D||[]).filter(R=>!c||!R.entryStage||c===R.entryStage).filter(({participantId:R})=>n.includes(R)),E=R=>a&&h.includes(R.participantId)&&!(gD.includes(R.entryStatus)&&gD.includes(a));return P.every(R=>E(R)&&!e?!1:(a&&(R.entryStatus=a,delete R.entryPosition),s&&(R.entryStage=s,delete R.entryPosition),o&&(o.value?gt({element:R,extension:o}):Mn({element:R,name:o.name})),!0))?{...H}:{error:lv}},w=({flight:D,drawDefinition:P})=>{d&&(d.entries=Do({entries:d.entries??[]})),D&&(D.drawEntries=Do({entries:D.drawEntries})),P&&(P.entries=Do({entries:P.entries}))},y=D=>{let{flight:P,drawDefinition:E}=D,R="updateDrawEntries";if(P){let C=v(P.drawEntries);if(C.error)return z({result:C,stack:R})}if(E){let C=v(E.entries);if(C.error)return z({result:C,stack:R});f.includes(E.drawId)||f.push(E.drawId)}return{...H}},b=d?.entries?.find(({entryPosition:D})=>D)??(I?.drawEntries?.find(({entryPosition:D})=>D)||r?.entries?.find(({entryPosition:D})=>D));if(t&&!b&&w({flight:I,drawDefinition:r}),I||r){let D=y({flight:I,drawDefinition:r});if(D.error)return z({result:D,stack:p})}let S=d?.drawDefinitions?.map(({drawId:D})=>D)??[],U=g?.flights?.filter(D=>!S.includes(D.drawId))||[];for(let D of U){let P=D&&y({flight:D});if(P?.error)return z({result:P,stack:p})}let T=g?.flights?.length===1&&(d?.drawDefinitions?.length??0)<=g?.flights?.length;if(!I&&!r&&a&&T7.includes(a))return{error:J4};if(!I&&!r||a===Sc||l&&T){let D=v(d?.entries);if(D?.error)return z({result:D,stack:p});let P;if(a===Sc&&(g?.flights?.every(E=>{let R=v(E.drawEntries);return R.error?(P=R.error,!1):(E.drawEntries=E.drawEntries.filter(({participantId:C})=>!n.includes(C)),!0)}),d?.drawDefinitions?.every(E=>{let R=v(E.entries);return R.error?(P=R.error,!1):(E.entries=E.entries?.filter(({participantId:C})=>!n.includes(C)),!0)})),P)return z({result:{error:P},stack:p})}t&&w({flight:I,drawDefinition:r});for(let D of d?.drawDefinitions??[])f.length&&!f.includes(D.drawId)||ii({tournamentId:i.tournamentId,eventId:d?.eventId,drawDefinition:D});return{...H}}function Ag({value:t,sourceRange:e,targetRange:i}){if(!Array.isArray(e)||e.length!==2)return 0;let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),s=Math.max(...i);return(t-r)*(s-a)/(n-r)+a}var i8="NTRP",r8="DUPR",n8="UTR_P",a8="UTPR",s8="SQUASH_LEVELS",o8="US_SQUASH",l8="USATT",u8="ITTF",c8="USAR",Vbe={ELO:"ELO",NTRP:i8,TRN:"TRN",UTR:"UTR",WTN:"WTN",DUPR:r8,UTR_P:n8,UTPR:a8,PSA:"PSA",SQUASH_LEVELS:s8,US_SQUASH:o8,USATT:l8,ITTF:u8,USAR:c8,BWF:"BWF"},jbe={ELO:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!1},[i8]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!1,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!1,range:[1,16]},WTN:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!0,decimalsCount:2,range:[40,1]},[r8]:{defaultInitialization:3.5,accessors:["duprRating","reliabilityScore"],accessor:"duprRating",attributes:{reliabilityScore:{generator:!0,range:[0,100]}},decimalsCount:3,ascending:!1,range:[2,8]},[n8]:{defaultInitialization:5,accessors:["utrpRating","verified"],accessor:"utrpRating",attributes:{verified:{type:"boolean"},provisional:{type:"string"}},decimalsCount:1,ascending:!1,range:[1,10]},[a8]:{defaultInitialization:3.5,accessor:"utprRating",decimalsCount:1,ascending:!1,range:[2,5],deprecated:!0},PSA:{defaultInitialization:500,accessor:"psaPoints",decimalsCount:0,ascending:!1,range:[0,3e3],attributes:{tournaments:{generator:!0,range:[1,20]},divisor:{generator:!0,range:[10,20]}}},[s8]:{defaultInitialization:2e3,accessor:"squashLevel",decimalsCount:0,ascending:!1,range:[0,7e3]},[o8]:{defaultInitialization:3.5,accessor:"usSquashRating",decimalsCount:1,ascending:!1,range:[2,6]},[l8]:{defaultInitialization:1e3,accessor:"usattRating",decimalsCount:0,ascending:!1,range:[200,3e3]},[u8]:{defaultInitialization:500,accessor:"ittfPoints",decimalsCount:0,ascending:!1,range:[0,2e4]},[c8]:{defaultInitialization:1e4,accessor:"usarRanking",decimalsCount:0,ascending:!0,range:[1,25e3]},BWF:{defaultInitialization:5e3,accessor:"bwfPoints",decimalsCount:0,ascending:!0,range:[0,15e4],attributes:{tournaments:{generator:!0,range:[1,10]}}}},Pr=jbe;function Gbe({sourceRatingType:t,sourceRating:e}){let i=Pr[t]?.range,r=i?.[0]>i?.[1],n=Pr.ELO.range;return Ag({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function Hbe({targetRatingType:t,sourceRating:e}){let i=Pr[t]?.decimalsCount||0,r=Pr[t]?.range,n=r?.[0]>r?.[1],a=Math.max(...r),s=Pr.ELO?.range,o=Ag({targetRange:r,sourceRange:s,value:e}),l=Number.parseFloat(o?.toFixed(i))||0;return n?a-l:l}function kW(t){let e=Ge(t,[{ratings:!0,[Xn]:Qn}]);if(e.error)return e;let i=t.matchUpType&&[zt,Bt].includes(t.matchUpType)?t.matchUpType:zt,r=Object.keys(Pr),n=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:"ELO",a=t.ratings[i]?t.ratings[i].reduce((p,f)=>p.includes(f.scaleName)?p:p.concat(f.scaleName),[]):[];if(!a)return{error:Vr};let s=t.ratings[i]?.find(p=>p.scaleName===n)??t.ratings[i]?.[0];if(a[0]===n)return s;let o=s?.scaleName,l=Pr[s?.scaleName]?.accessor,u=l&&s.scaleValue[l]||s?.scaleValue,c=Gbe({sourceRatingType:o,sourceRating:u}),d=Hbe({targetRatingType:n,sourceRating:c});return d?{convertedRating:d,sourceRating:u}:{error:ie}}function Wbe({participantResults:t,sides:e,score:i}){let r=e?.find(({sideNumber:o})=>o===1),n=e?.find(({sideNumber:o})=>o===2),a=r?.participant?.ratings,s=n?.participant?.ratings;if(a?.[zt]&&s?.[zt]){let o="ELO",{convertedRating:l}=kW({ratings:a,targetRatingType:o}),{convertedRating:u}=kW({ratings:s,targetRatingType:o}),{side1pressure:c,side2pressure:d}=zbe({side1ConvertedRating:l,side2ConvertedRating:u,score:i});c&&t[r?.participantId].pressureScores.push(c),d&&t[n?.participantId].pressureScores.push(d);let p=Math.max(...Pr.ELO.range),f=eP((u-l)/p),h=eP((l-u)/p);t[r?.participantId].ratingVariation.push(f),t[n?.participantId].ratingVariation.push(h)}}function zbe({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){let r=Math.max(t,e),n=Math.min(t,e),a=Math.abs(t-e),s=Pr.ELO.range,o=Math.max(...s),l=(o-r)*0,u=(r+l)/o*a,c=i?.sets?.reduce((v,w)=>v+(w?.side1Score??0),0),d=i?.sets?.reduce((v,w)=>v+(w.side2Score??0),0),p=t>e?2:1,f=(c||0)*(n+(p===1?u:0)),h=(d||0)*(n+(p===2?u:0)),m=f+h,g=m?eP(f/m):0,I=m?eP(h/m):0;return{side1pressure:g,side2pressure:I}}function HL({winningSide:t,matchUpFormat:e=ac,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],s=n?.sets,o=typeof t=="number"&&t-1,l=Ki(e),u=WL(l?.bestOf??1);if(typeof o=="number"&&(i===Zt&&r?.setsCreditForDefaults||i===mi&&r?.setsCreditForWalkovers))a[o]=u;else for(let c of s||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof o=="number"&&i===jr&&(+a[1-o]===u&&(a[1-o]-=1),r?.setsCreditForRetirements&&(a[o]=u)),a}function d8({matchUpFormat:t=ac,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){let{sets:a}=n||{};if(!a)return[0,0];let s=typeof e=="number"&&e-1,o=Ki(t),l=o?.bestOf??1,u=WL(l),c=o?.setFormat?.tiebreakAt||0,d=[[],[]];if(typeof s=="number"&&(i===Zt&&r?.gamesCreditForDefaults||i===mi&&r?.gamesCreditForWalkovers)){let p=o?.setFormat?.setTo||0,f=u*p;d[s].push(f)}else a.forEach((p,f)=>{let h=(p.setNumber||f+1)>u&&o?.finalSetFormat?"finalSetFormat":"setFormat",m=o?.[h]?.based,g=o?.[h].tiebreakSet,{side1Score:I,side2Score:v}=p;OW(m)&&!g&&(d[0].push(Ye(I||0)),d[1].push(Ye(v||0))),g&&p.winningSide&&r?.gamesCreditForTiebreakSets!==!1&&d[p.winningSide-1].push(1)});if(i===jr&&typeof s=="number"){let p=a.length>u&&o?.finalSetFormat?"finalSetFormat":"setFormat",f=o?.[p];if(OW(f.based)){let h=f?.setTo||0,m=I=>{if(!(!o||I===""))return+I===c-1||+I===c?Ye(c||0)+1:+I<c?h:c},g=HL({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(d.map(I=>I[s]<=I[1-s]).reduce((I,v)=>I+(v?1:0),0)>g[1-s]){let I=d[s].length,v=m(d[1-s][I-1]);v&&(d[s][I-1]=v)}u>d[s].length&&r?.gamesCreditForRetirements&&d[s].push(h)}}return[d[0].reduce((p,f)=>p+f,0),d[1].reduce((p,f)=>p+f,0)]}function p8({matchUpFormat:t,score:e}){let i=t?Ki(t):void 0,r=i?.bestOf??1,n=WL(r),a=[0,0],s=[0,0];return e?.sets?.forEach((o,l)=>{let u=(o.setNumber||l+1)>n&&i?.finalSetFormat?"finalSetFormat":"setFormat",c=i?.[u]?.based;if(f8(c)){let{side1Score:d,side2Score:p}=o;d&&(s[0]+=Ye(d||0)),p&&(s[1]+=Ye(p||0))}else o.side1TiebreakScore&&(s[0]+=Ye(o.side1TiebreakScore||0)),o.side2TiebreakScore&&(s[1]+=Ye(o.side2TiebreakScore||0)),(o.side1TiebreakScore||o.side2TiebreakScore)&&o.winningSide&&(a[o.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:a}}function WL(t){return t&&Math.ceil(t/2)||1}function f8(t){return t==="P"}function OW(t){return!f8(t)}function qbe({participantResults:t,groupingTotal:e,matchUpFormat:i,tallyPolicy:r,totalGames:n,perPlayer:a,totalSets:s}){let o=i&&Ki(i)||{},l=o.bestOf,u=l&&Math.ceil(l/2)||1,c=o.setFormat?.setTo,d=Math.pow(10,r?.precision||3);Object.keys(t).forEach(p=>{let f=t[p].setsWon,h=t[p].setsLost,m=r?.groupTotalSetsPlayed||e==="setsPct"?s:a*u||f+h,g=Math.round(f/m*d)/d;(g===1/0||Number.isNaN(g))&&(g=m);let I=t[p].tieMatchUpsWon,v=t[p].tieMatchUpsLost,w=I+v,y=Math.round(I/w*d)/d;(y===1/0||Number.isNaN(y))&&(y=I);let b=t[p].matchUpsWon,S=t[p].matchUpsLost,U=b+S,T=Math.round(b/U*d)/d;(T===1/0||Number.isNaN(T))&&(T=b);let D=t[p].gamesWon||0,P=t[p].gamesLost||0,E=(a||0)*u*(c||0),R=r?.groupTotalGamesPlayed||e==="gamesPct"?n:Math.max(E,D+P),C=Math.round(D/R*d)/d;(C===1/0||Number.isNaN(C))&&(C=0);let M=t[p].pointsWon+t[p].pointsLost,N=Math.round(t[p].pointsWon/M*d)/d;(N===1/0||Number.isNaN(N))&&(N=0),t[p].setsWon=f,t[p].setsLost=h,t[p].setsPct=g,t[p].tieMatchUpsWon=I,t[p].tieMatchUpsPct=y,t[p].matchUpsPct=T,t[p].gamesWon=D,t[p].gamesLost=P,t[p].gamesPct=C,t[p].pointsPct=N,t[p].result=`${t[p].matchUpsWon}/${t[p].matchUpsLost}`})}function RS({participantIds:t,pressureRating:e,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,perPlayer:a,matchUps:s}){let o={},l=n?.excludeMatchUpStatuses||[],u=s?.filter(f=>(f.tieMatchUps||!l.includes(f.matchUpStatus))&&(!t?.length||Fi(t,[kg(f,0),kg(f,1)]).length===2)),c=u?.flatMap(({score:f,tieMatchUps:h})=>h?h.filter(({matchUpStatus:m})=>!l.includes(m)).flatMap(({score:m})=>m?.sets?.length??0):f?.sets?.length??0)?.reduce((f,h)=>f+h,0),d=f=>f?.sets?.reduce((h,m)=>h+(m?.side1Score??0)+(m?.side2Score??0),0)??0,p=u?.flatMap(({score:f,tieMatchUps:h})=>h?h.filter(({matchUpStatus:m})=>!l.includes(m)).flatMap(({score:m})=>d(m)):d(f))?.reduce((f,h)=>f+h,0);for(let f of u??[]){let{matchUpStatus:h,tieMatchUps:m,tieFormat:g,score:I,winningSide:v,sides:w}=f,y=g&&f._disableAutoCalc&&g.collectionDefinitions.every(({scoreValue:U})=>U),b=v&&Ybe(f),S=v&&Kbe(f);if(!b&&!S)if(h&&Ji.includes(h)){let U=kg(f,0),T=kg(f,1);U&&(rd(o,U),o[U].matchUpsCancelled+=1),T&&(rd(o,T),o[T].matchUpsCancelled+=1)}else if(m?.length){a=0;for(let U of m){if(U.winningSide){let T=w?.find(({sideNumber:P})=>P===U.winningSide)?.participantId,D=w?.find(({sideNumber:P})=>P===U.winningSide)?.participantId;T&&D&&(rd(o,T),rd(o,D),o[T].tieMatchUpsWon+=1,o[D].tieMatchUpsLost+=1,Ti(zt)(U.matchUpType)?(o[T].tieSinglesWon+=1,o[D].tieSinglesLost+=1):Ti(Bt)(U.matchUpType)&&(o[T].tieDoublesWon+=1,o[D].tieDoublesLost+=1))}xW({score:U.score,manualGamesOverride:y,participantResults:o,sides:w})}}else xW({manualGamesOverride:y,participantResults:o,score:I,sides:w});else if(rd(o,b),rd(o,S),m?.length){a=0;for(let U of m){let{matchUpType:T}=U,D=Ti(Bt)(T),P=Ti(zt)(T);U.winningSide&&(U.winningSide===v?(b&&(o[b].tieMatchUpsWon+=1,P&&(o[b].tieSinglesWon+=1),D&&(o[b].tieDoublesWon+=1)),S&&(o[S].tieMatchUpsLost+=1,P&&(o[S].tieSinglesLost+=1),D&&(o[S].tieDoublesLost+=1))):U.winningSide!==v&&(S&&(o[S].tieMatchUpsWon+=1,P&&(o[S].tieSinglesWon+=1),D&&(o[S].tieDoublesWon+=1)),b&&(o[b].tieMatchUpsLost+=1,P&&(o[b].tieSinglesLost+=1),D&&(o[b].tieDoublesLost+=1)))),FW({matchUpFormat:U.matchUpFormat,matchUpStatus:U.matchUpStatus,matchUpType:U.matchUpType,score:U.score,sides:U.sides,winningParticipantId:b,losingParticipantId:S,manualGamesOverride:y,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:v})}h8({winningParticipantId:b,losingParticipantId:S,participantResults:o,matchUpStatus:h})}else FW({matchUpFormat:f.matchUpFormat??r,matchUpType:f.matchUpType,isTieMatchUp:void 0,winningParticipantId:b,manualGamesOverride:y,losingParticipantId:S,participantResults:o,pressureRating:e,matchUpStatus:h,tallyPolicy:n,winningSide:v,score:I,sides:w});if(y){let U=I?.sets?.reduce((E,R)=>E+(R?.side1Score??0),0),T=I?.sets?.reduce((E,R)=>E+(R.side2Score??0),0),D=w?.find(({sideNumber:E})=>E===1)?.participantId,P=w?.find(({sideNumber:E})=>E===2)?.participantId;rd(o,D),rd(o,P),D&&(o[D].gamesWon+=U,o[D].gamesLost+=T),P&&(o[P].gamesWon+=T,o[P].gamesLost+=U)}}return qbe({participantResults:o,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,totalGames:p,perPlayer:a,totalSets:c}),{participantResults:o}}function Ybe(t){let e=t.winningSide-1;return kg(t,e)}function Kbe(t){let e=1-(t.winningSide-1);return kg(t,e)}function kg(t,e){if(!t?.sides)return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function rd(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function xW({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],s=[0,0];for(let l of n||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(s[u-1]+=1),a[0].push(Ye(c||0)),a[1].push(Ye(d||0))}let o=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];r.forEach((l,u)=>{let{participantId:c}=l;c&&(rd(e,c),e[c].setsWon+=s[u],e[c].setsLost+=s[1-u],t||(e[c].gamesWon+=o[u],e[c].gamesLost+=o[1-u]))})}function FW({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:s,isTieMatchUp:o,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let f=c&&c-1,h=1-f;n&&l===zt&&Wbe({participantResults:r,sides:p,score:d}),o||h8({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:s});let m=HL({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=d8({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:I}=p8({score:d,matchUpFormat:a});t&&(r[t].setsWon+=m[f],r[t].setsLost+=m[h],e||(r[t].gamesWon+=g[f],r[t].gamesLost+=g[h]),r[t].pointsWon+=I[f],r[t].pointsLost+=I[h]),i&&(r[i].setsWon+=m[h],r[i].setsLost+=m[f],e||(r[i].gamesWon+=g[h],r[i].gamesLost+=g[f]),r[i].pointsWon+=I[h],r[i].pointsLost+=I[f])}function h8({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===mi&&(i[e].walkovers+=1),r===Zt&&(i[e].defaults+=1),r===jr&&(i[e].retirements+=1),$r(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function Xbe(t,e,i,r){t.groups&&Object.keys(t.groups).sort(r).forEach(n=>{let a=t.groups[n].map(o=>e[o]).join(", "),s=`${n} ${t.attribute}: ${a}`;i.push(s)})}function Jbe(t,e,i,r){if(t.excludedDirectives?.length){let n=t.excludedDirectives.map(({attribute:o})=>o).join(", "),a=`${n.length} directives were excluded due to participants limit}`;r.push(a);let s=`Excluded: ${n}`;r.push(s)}else{let n=(u,c)=>Number.parseFloat(t.reversed?u:c)-Number.parseFloat(t.reversed?c:u),a=t.groups?Object.values(t.groups).flat(1/0).length:t.participantIds?.length??0,s=t.reversed?" in reverse order":"",o=t.groups?"grouped":"separated",l=`Step ${e+1}: ${a} particiants were ${o}${s} by ${t.attribute}`;if(r.push(l),t.idsFilter){let u=`${t.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(u)}Xbe(t,i,r,n)}r.push("----------------------")}function Qbe({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(s=>{s.participantId&&s.participant&&(r[s.participantId]=s.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,s)=>{Jbe(a,s,r,n)}),n.push("Final Order:"),e.forEach(a=>{let{participantId:s,resolved:o}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[s]} => resolved: ${!!o}`)}),n.join(`\r
`)}function m8({participantResults:t,participantIds:e,attribute:i}){return g8({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:s}=n,o=s?.[i];return!isNaN(o)&&a&&(r[o]?r[o].push(a):r[o]=[a]),r},{})}function g8(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var Zbe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],nk={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function LW(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!ewe(t))return{};let s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n?.groupOrderKey)?n.groupOrderKey:"matchUpsWon",o=m8({participantResults:i,attribute:s});a.push({attribute:s,groups:o});let l=Object.keys(o).map(g=>Number.parseFloat(g)).sort((g,I)=>I-g).map(g=>o[g]).map(g=>{let I=I8({participantIds:g,...t});return a.push(...I.report??[]),I.order}).flatMap((g,I)=>g.map(v=>v.resolved?v:{...v,subGroup:[I].concat(...v.subGroup??[])})),u,c=0,d=1,p;l.forEach((g,I)=>{I&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let v=Number.parseInt(g.subGroup?.join("")||0);g.resolved?(g.position=I+1,d=g.position):(u&&v>u&&(d+=c,c=0),g.position=d,c+=1),u=v});let f=l.map(({position:g})=>g),h=Ta(f);return l.forEach(g=>{let{participantId:I,position:v}=g||{},w=i[I];g.GEMscore=m(w);let y=h[v];g?.position!==void 0&&(y>1&&(g.ties=y,r&&(g.subOrder=r[I])),g.rankOrder=v,g.groupOrder=v+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function m(g){return(Array.isArray(n?.GEMscore)?Object.keys(nk).filter(I=>n.GEMscore.includes(I)):Object.keys(nk)).map(I=>(g[I]||0)*Math.pow(10,nk[I].toFixed(3))).reduce((I,v)=>I+v,0)}}function ewe({participantResults:t,participantsCount:e}){let i=g8({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function twe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,groupTotals:r,tallyPolicy:n,attribute:a,idsFilter:s,matchUps:o,reversed:l}){let{participantResults:u}=RS({participantIds:s&&e,groupingTotal:r&&a,matchUpFormat:i,tallyPolicy:n,matchUps:o}),c=m8({participantResults:u,participantIds:e,attribute:a}),d=[{attribute:a,reversed:l,groups:c,idsFilter:s,groupTotals:r}],p;return Object.keys(c).length>1&&e.length&&(p=Object.keys(c).map(f=>Number.parseFloat(f)).sort((f,h)=>l?f-h:h-f).map(f=>c[f]).map(f=>{let h=I8({participantResults:u,disableHeadToHead:t,participantIds:f,matchUpFormat:i,tallyPolicy:n,matchUps:o});return d.push(...h.report??[]),h.order}).flatMap((f,h)=>f.map(m=>m.resolved?m:{...m,subGroup:[h].concat(...m.subGroup??[])}))),{order:p,report:d}}function I8({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let s=[],o=[],l;if(i?.length===1)return{order:[{resolved:!0,participantId:i[0]}]};if(i?.length===2&&(!n?.headToHead||!n.headToHead.disabled&&!e)){let c=iwe({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return o.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:c,headToHeadWinner:d,report:o}}}let u=(n?.tallyDirectives||Zbe).filter(c=>{let d=!(Mi(c.maxParticipants)&&i?.length>c.maxParticipants);return d||s.push(c),d});return s.length&&o.push({excludedDirectives:s,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,groupTotals:f,disableHeadToHead:h})=>(l=twe({disableHeadToHead:h,participantIds:i,matchUpFormat:r,groupTotals:f,tallyPolicy:n,attribute:c,idsFilter:p,matchUps:a,reversed:d}),o.push(l.report),!l.order)),l.order?{order:l.order,report:o}:{order:i?.map(c=>({participantId:c})),report:o}}function iwe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function Dm({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:s}){if(!n?.length||!Ja(n))return{error:Ou};let o=ot(n.map(({structureId:y})=>y));if(o.length!==1)return z({result:{error:ie,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let l=n.filter(y=>y&&y.matchUpStatus!=="BYE"),u=l.length&&ot(l.flatMap(({drawPositions:y})=>y)).length,c=l.filter(y=>bp({matchUp:y})).length===l.length;c||(s=0);let d=n.every(({matchUpType:y,tieMatchUps:b})=>y===ei&&b?.every(S=>bp({matchUp:S}))),p=t?.[nL],f=n.filter(y=>bp({matchUp:y})??y.matchUpType===ei),{participantResults:h}=RS({matchUps:f,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:s}),m,g,{groupOrder:I,report:v}=LW({matchUps:f,participantResults:h,participantsCount:u,matchUpFormat:r,subOrderMap:a,tallyPolicy:p});if(i&&rwe({participantResults:h}),c&&I)m=v,g=I,I.forEach(y=>{let{participantId:b,groupOrder:S,rankOrder:U,subOrder:T,ties:D,GEMscore:P}=y,E=h[b];Object.assign(E,{groupOrder:S,rankOrder:U,GEMscore:P,subOrder:T,ties:D})});else{let{groupOrder:y,report:b}=LW({requireCompletion:!1,participantResults:h,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});m=b,g=y,y&&y.forEach(S=>{let{participantId:U,groupOrder:T,GEMscore:D}=S,P=h[U];Object.assign(P,{provisionalOrder:T,GEMscore:D})})}let w={completedTieMatchUps:d,readableReport:"",participantResults:h,bracketComplete:c,order:[],report:m};if((c||d)&&(w.order=g),e||ua({tally:!0})){let y=Qbe({matchUps:n,report:m,order:g});ua({tally:!0})&&console.log(y),w.readableReport=y}return w}function rwe({participantResults:t}){let e=n=>n.reduce((a,s)=>a+parseFloat(s),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:s}=a,o=s?.length?i(s):0;return{participantId:n,averagePressure:o}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function Zl({requireTimeStamp:t,scaleAttributes:e,participant:i}){if(!i)return{error:dm};if(!St(e))return{error:ie};if(i.timeItems??=[],Array.isArray(i.timeItems)){let{accessor:r,scaleType:n,eventType:a,scaleName:s}=e,o=[vd,n,a,s].join("."),l=i.timeItems.filter(u=>u?.itemType===o).filter(u=>!t||u?.itemDate).sort((u,c)=>(u.createdAt?new Date(u.createdAt).getTime():0)-(c.createdAt?new Date(c.createdAt).getTime():0)).pop();if(l){let[u,c,d,p]=l.itemType?.split(".")??[];if(u!==vd)return{error:kh};let f=r&&wp({element:l.itemValue,accessor:r}),h=f?.value||l.itemValue,m={rawValue:f&&l.itemValue,eventType:d,scaleDate:l.itemDate,scaleValue:h,scaleName:p,scaleType:c};return{...H,scaleItem:m}}}return{...H,scaleItem:void 0}}function nwe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){let a={},s=c=>[vd,Jl,n.eventType,c].join("."),o=Object.assign({},...(r.timeItems||[]).filter(({itemType:c})=>c.split(".")[1]===Jl).map(({itemType:c,itemValue:d})=>({[c]:d}))),l=(t?.stageSeedingScaleNames&&Object.values(t?.stageSeedingScaleNames)||Array.isArray(t?.seedingScaleNames)&&t.seedingScaleNames||[]).map(s),u=Fi(Object.keys(o),l);if((!e||!Object.keys(o).length&&!t?.drawIds?.length||u.length)&&u.length){if(t?.stageSeedingScaleNames){let c=Object.keys(t.stageSeedingScaleNames).map(p=>{let f=s(t.stageSeedingScaleNames[p]),h=o[f];return[p,h]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...c);a.seedAssignments=d}else if(u){let c=u.map(d=>o[d]);a.seedValue=c.pop()}}else if(!e&&typeof i=="object"){let c=Object.keys(i).map(p=>{let f=s(i[p]),h=o[f];return[p,h]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...c);a.seedAssignments=d}else{let{categoryName:c,ageCategoryCode:d}=n.category||{},p=[d,n.eventId,c].filter(Boolean),f;for(let h of p){let m={eventType:n.eventType,scaleType:Jl,scaleName:h},g=Zl({scaleAttributes:m,participant:r});if(g.scaleItem){f=g.scaleItem;break}}if(f&&(!e||t?.published&&!t?.published?.drawIds?.length)){let h=f.scaleValue;a.seedValue=h}}return a}function zL({positionAssignments:t}){let e=(t||[]).filter(Pa(gu)).map(n=>{let{extension:a}=it({element:n,name:pI}),s=Ye(a?.value),o=!isNaN(s)&&s;return o&&{participantId:n.participantId,subOrder:o}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=Ta(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function awe({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:s,entry:o}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=o,p=d?.length&&t?Object.assign({},...j1(d??[])):{},f=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:s,eventId:a});i.events[a]=Ve(f,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function bv(t){let e=Ge(t,[{[mr]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:r=Qa}=t,n=`${zd}.${qd}`;return Oe(XR({tournamentRecord:i,itemType:n})?.timeItem?.itemValue?.[r],!1,!0)}function swe(t){let{tournamentId:e}=t??{};return!!e}function Oa({event:t,status:e=Qa}){let i=`${zd}.${qd}`;return fS({itemType:i,event:t})?.timeItem?.itemValue?.[e]}function Gf(t){let e=t?.embargo;return!e||!Xl(e)?!1:new Date(e).getTime()>Date.now()}function qo(t){return!!t?.published&&!Gf(t)}function sC({drawDetails:t,drawId:e,ignoreEmbargo:i=!1}){let r=t?.[e]?.publishingDetail;return i?!!r?.published:qo(r)}function Pm(t){let{tournamentRecord:e,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:s,event:o}=t??{};if(e&&!swe(e))return{error:ie};if(n&&!o)return{error:ds};if(Array.isArray(r)&&r?.length){let p={};for(let f of r){if(!ni(f))return{error:ie};let h=zn({tournamentRecord:e,eventId:f})?.event;if(!h)return{error:ds};let m=ak({event:h});p[f]=m}return{...H,publishState:p}}if(o){let p=ak({event:o}),f={};if(s)return i?{publishState:{status:{published:!!p.status.publishedDrawIds?.includes(s),drawDetail:p.status.drawDetails?.[s]},...H}}:{error:ja};if(Array.isArray(a)&&a?.length){let h=o.drawDefinitions?.map(fI)??[];for(let m of a){if(!ni(m))return{error:ie};if(!h.includes(m))return{error:ja};f[m]={status:{published:!!p.status.publishedDrawIds.includes(m),drawDetail:p.status.drawDetails?.[m]}}}}else f=p;return{...H,publishState:f}}let l=[],u=!1,c={};for(let p of e?.events??[]){let f=ak({event:p});c[p.eventId]=f,f.status.published&&(l.push(p.eventId),u=!0);for(let{drawId:h}of p.drawDefinitions??[]){let m=f.status?.publishedDrawIds?.includes(h);m&&(c[h]={status:{published:m}})}}let d=[];if(e){let p=bv({tournamentRecord:e});c.tournament=p??{},(p?.orderOfPlay?.published||p?.participants?.published)&&(u=!0),c.tournament.status={published:u,publishedEventIds:l},p?.orderOfPlay?.embargo&&d.push({type:"orderOfPlay",embargo:p.orderOfPlay.embargo,embargoActive:Gf(p.orderOfPlay)}),p?.participants?.embargo&&d.push({type:"participants",embargo:p.participants.embargo,embargoActive:Gf(p.participants)})}for(let p of e?.events??[]){let f=Oa({event:p})?.drawDetails??{};for(let[h,m]of Object.entries(f)){m?.publishingDetail?.embargo&&d.push({type:"draw",id:h,embargo:m.publishingDetail.embargo,embargoActive:Gf(m.publishingDetail)});for(let[g,I]of Object.entries(m?.stageDetails??{}))I?.embargo&&d.push({type:"stage",id:`${h}:${g}`,embargo:I.embargo,embargoActive:Gf(I)});for(let[g,I]of Object.entries(m?.structureDetails??{}))if(I?.embargo&&d.push({type:"structure",id:g,embargo:I.embargo,embargoActive:Gf(I)}),I?.scheduledRounds)for(let[v,w]of Object.entries(I.scheduledRounds))w?.embargo&&d.push({type:"scheduledRound",id:`${g}:round${v}`,embargo:w.embargo,embargoActive:Gf(w)})}}return d.length&&(c.embargoes=d),{...H,publishState:c}}function ak({event:t}){let e=Oa({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let r=e.drawDetails??{};for(let o of t.drawDefinitions?.map(fI)||[])r[o]||(r[o]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter(o=>sC({drawDetails:r,drawId:o,ignoreEmbargo:!0})),a=n?.length?n:e.drawIds??[];if(a?.length&&!n?.length)for(let o of a)r[o]={publishingDetail:{published:!0}};let s=a?.length>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:r,published:s}}}function v8(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||r==="BYE"||e[i].scheduleItems.push({...c,scheduledDate:Qe(c?.scheduledDate),scheduledTime:di(c?.scheduledTime),checkScoreHasValue:dr({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,drawId:d})}function owe({finishingPositionRange:t={winner:[],loser:[]},collectionPosition:e,participantMap:i,finishingRound:r,participantWon:n,collectionId:a,matchUpStatus:s,participantId:o,stageSequence:l,roundNumber:u,structureId:c,matchUpId:d,drawId:p,stage:f}){let h=i[o],m=y=>Math.abs(y[0]-y[1]);h.structureParticipation[c]||(h.structureParticipation[c]={rankingStage:f,walkoverWinCount:0,defaultWinCount:0,stageSequence:l,winCount:0,structureId:c,drawId:p});let g=h.structureParticipation[c],{winner:I,loser:v}=t,w=n?I:v;n&&(g.winCount+=1,s===mi&&(g.walkoverWinCount+=1),s===Zt&&(g.defaultWinCount+=1)),w&&(!g.finishingPositionRange||m(w)<m(g.finishingPositionRange))&&(g.finishingPositionRange=w),r&&((!g.finishingRound||r<g.finishingRound)&&(g.finishingMatchUpId=d,g.finishingRound=r,g.roundNumber=u),r===1&&(g.participantWon=n)),e&&(g.lineParticipation||(g.lineParticipation=[]),g.lineParticipation.push({collectionPosition:e,collectionId:a,won:n}))}function _W(t){let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:s,withEvents:o,withDraws:l,finishingPositionRange:u,finishingRound:c,matchUpStatus:d,stageSequence:p,roundNumber:f,structureId:h,score:m,stage:g,withRankingProfile:I,collectionPosition:v,tieWinningSide:w,roundPosition:y,matchUpTieId:b,matchUpSides:S,collectionId:U,matchUpType:T,winningSide:D,matchUpId:P,schedule:E,eventId:R,drawId:C,sides:M}=t,N=a&&M?.length===2&&Object.assign({},...M.map(({sideNumber:A},O)=>{let k=M[1-O].participantId;return A&&{[A]:k}}).filter(Boolean));for(let A of M){let{participantId:O,sideNumber:k,bye:F}=A;if(F)continue;let x=D===k,L=_=>{let B=n[_]?.participant,G=B?.participantType,j=[{participantId:_,participantType:G}];if(G!==jn)for(let Y of B?.individualParticipantIds||[]){let K=n[Y]?.participant;j.push({participantType:K?.participantType,participantId:Y})}return j},$=(_,B)=>{if(s){if(n[_].matchUps[P]={participantWon:x,matchUpType:T,structureId:h,sideNumber:k,matchUpId:P,eventId:R,drawId:C,stage:g},a){let G=L(B);n[_].matchUps[P].opponentParticipantInfo=G}U&&(n[_].matchUps[P].collectionId=U)}a&&B&&(n[_].opponents[B]={participantId:B,matchUpId:P,eventId:R,drawId:C}),I&&owe({finishingPositionRange:u,collectionPosition:v,participantMap:n,participantWon:x,collectionId:U,finishingRound:c,matchUpStatus:d,participantId:_,stageSequence:p,roundNumber:f,structureId:h,matchUpId:P,drawId:C,stage:g}),(i||e)&&v8({participantMap:n,participantId:_,matchUpStatus:d,roundPosition:y,matchUpType:T,roundNumber:f,structureId:h,matchUpId:P,schedule:E,drawId:C,score:m})},V=({participant:_,partnerParticipantId:B})=>{let G=(j,Y)=>{j&&(j.partnerParticipantIds||(j.partnerParticipantIds=[]),j.partnerParticipantIds.includes(Y)||j.partnerParticipantIds.push(Y))};l&&G(_?.draws?.[C],B),o&&G(_?.events?.[R],B),s&&G(_?.matchUps?.[P],B)};if(O&&n[O]){let _=N?.[k];$(O,_);let B=n[O]?.participant.participantType===ht,G=n[O]?.participant.individualParticipantIds||[];if(b){if(r){let j=Y=>n[Y].matchUps[b]={participantWon:w===k,matchUpId:b,matchUpType:ei,sideNumber:k};j(O),G.forEach(j)}if(l&&!n[O].draws[C]){let j=S.find(X=>X.sideNumber===k)?.participant?.participantId,Y=n[j]?.draws?.[C]?.entryStatus,K=X=>n[X].draws[C]={entryStatus:Y,eventId:R,drawId:C};K(O),G.forEach(K)}}if(B&&(G.forEach(j=>n[j]&&$(j,_)),G.forEach((j,Y)=>{let K=G[1-Y],X=n[j];X&&V({participant:X,partnerParticipantId:K})}),o&&S)){let j=S.find(Y=>Y.sideNumber===k)?.participant?.participantId;if(j){let Y=n[j]?.events[R];Y?(n[O].events[R]={...Y},G.forEach(K=>n[K].events[R]={...Y})):console.log("Missing teamEntry",{eventId:R,teamParticipantId:j})}}if(D){let j=Y=>{x?(n[Y].counters[T].wins+=1,n[Y].counters.wins+=1,d===mi&&(n[Y].counters[T].walkoverWins+=1,n[Y].counters.walkoverWins+=1),d===Zt&&(n[Y].counters[T].defaultWins+=1,n[Y].counters.defaultWins+=1)):(n[Y].counters[T].losses+=1,n[Y].counters.losses+=1,d===mi&&(n[Y].counters[T].walkovers+=1,n[Y].counters.walkovers+=1),d===Zt&&(n[Y].counters[T].defaults+=1,n[Y].counters.defaults+=1))};j(O),G.forEach(j)}}}}function oC(t,e){return(t||"").localeCompare(e||"")}function lwe(t){let{participantFilters:e,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,contextFilters:s,matchUpFilters:o,participantMap:l,contextProfile:u,withPotentialMatchUps:c,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:h,withStatistics:m,withOpponents:g,withMatchUps:I,withSeeding:v,withEvents:w,withDraws:y}=t,b=e?.participantIds,S=k=>{let F=[k];return l[k]?.participant.individualParticipantIds?.forEach(x=>F.push(x)),F.some(x=>!b?.length||b.includes(x))?F:[]},U={withMatchUps:I||d,withEvents:w||d,withDraws:y||d,withPotentialMatchUps:c,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:h,withStatistics:m,participantMap:l,withOpponents:g,withSeeding:v},T=[],D={},P=[],E={},R={},C={},M={},N={},A=({eventType:k,scaleNames:F,participantId:x})=>l[x]?.participant?.rankings?.[k]?.find(L=>F.includes(L.scaleName))?.scaleValue;for(let k of n?.events||[]){if(e?.eventIds&&!e.eventIds.includes(k.eventId))continue;let{drawDefinitions:F=[],extensions:x=[],wheelchairClass:L,eventType:$,eventName:V,category:_,entries:B,eventId:G,gender:j}=k,{flightProfile:Y}=Bi({event:k}),K=Y?.flights??[],X=Pm({event:k}).publishState;X&&(E[G]=X);let Z=X?.status?.publishedSeeding;if(w||v||d){let ae=i?Object.assign({},...j1(x??[])):{};R[G]={...ae,wheelchairClass:L,eventName:V,eventType:$,category:_,eventId:G,gender:j};let te=[_?.categoryName,_?.ageCategoryCode].filter(Boolean);for(let ne of B){let{participantId:le}=ne;if(!le||!l[le])continue;let de=A({eventType:$,scaleNames:te,participantId:le}),pe,ve;if(v){let Ee=l[le].participant;({seedAssignments:pe,seedValue:ve}=nwe({publishedSeeding:Z,usePublishState:a,withSeeding:v,participant:Ee,event:k}))}let Me=Ee=>{if(l[Ee]?.events?.[G])return;let Be=l[Ee];awe({convertExtensions:i,seedAssignments:pe,participant:Be,withSeeding:v,seedValue:ve,eventId:G,ranking:de,entry:ne})};Me(le),(l[le].participant.individualParticipantIds||[]).forEach(Me)}}let Q=E?.[G]?.publishedSeeding;if(y||d||v){let ae=ne=>ne?Object.assign({},...ne.map(({participantId:le,seedValue:de,seedNumber:pe})=>({[le]:{seedValue:de,seedNumber:pe}}))):void 0,te=ot([...F.map(fI),...K.map(fI)]);for(let ne of te){let le=F.find(ee=>ee.drawId===ne),de=[_?.categoryName,_?.ageCategoryCode].filter(Boolean),{structures:pe=[],drawOrder:ve,drawName:Me,drawType:Ee}=le??{},Be=K?.find(ee=>ee.drawId===ne),fe=le?.entries||Be?.drawEntries,Te=Be?.flightNumber,ce=(le?.structures||[]).sort((ee,Se)=>vm(ee,Se)).map(({structureId:ee,structures:Se})=>[ee,...(Se||[]).map(({structureId:Pe})=>Pe)]).flat(1/0),be,we,Ae,ye,Ne=0,he=new Set(pe.filter(({stage:ee,stageSequence:Se})=>ee===Fe&&Se===1||ee===We).flatMap(ee=>{let{positionAssignments:Se}=Kt({structure:ee}),{seedAssignments:Pe,stageSequence:st,stage:Ue}=ee;return Ue===Fe?(Ne=Se?.length??0,Ae=Se,ye=Pe):st===1&&(be=Se,we=Pe),Se}).map(({participantId:ee})=>ee).filter(Boolean)),De=ae(ye),Le=ae(we),J=le?fe.filter(({participantId:ee})=>he.has(ee)):fe,se=!a||Q?.published&&(Q?.drawIds?.length===0||Q?.drawIds?.includes(ne));for(let ee of J){if(!l[ee.participantId])continue;let{entryStatus:Se,entryStage:Pe,entryPosition:st,participantId:Ue}=ee,dt=A({participantId:Ue,scaleNames:de,eventType:$}),bi=qe=>{if(!l[qe]||l[qe].draws?.[ne])return;let wi=v&&se,li=wi?{}:void 0,an=wi?De?.[Ue]?.seedValue||De?.[Ue]?.seedNumber:void 0,Go=an?De?.[Ue]:void 0,Lf=wi?Le?.[Ue]?.seedValue||Le?.[Ue]?.seedNumber:void 0,_f=Lf?Le?.[Ue]:void 0;li&&an&&(li[Fe]=Go),li&&Lf&&(li[We]=_f);let wy=an||Lf;wy&&(l[qe].participant.seedings[$]||(l[qe].participant.seedings[$]=[]),Go&&l[qe].participant.seedings[$].push({...Go,scaleName:ne}),_f&&l[qe].participant.seedings[$].push({..._f,scaleName:ne}),li&&(l[qe].events[G].seedAssignments||(l[qe].events[G].seedAssignments={}),Object.keys(li).forEach(Sy=>l[qe].events[G].seedAssignments[Sy]=li[Sy]))),(y||d)&&(l[qe].draws[ne]=Ve({seedAssignments:li,entryPosition:st,entryStatus:Se,entryStage:Pe,seedValue:wy,eventId:G,ranking:dt,drawId:ne},!1,!1,!0))};[Us,ff].includes(Se)||(bi(Ue),(l[Ue].participant.individualParticipantIds||[])?.forEach(bi))}let oe=(le?.structures??[]).reduce((ee,Se)=>(ee.includes(Se.stage)||ee.push(Se.stage),ee),[]),ue=(le?.links??[]).length;C[ne]={qualifyingPositionAssignments:be,qualifyingSeedAssignments:we,mainPositionAssignments:Ae,qualifyingSeedingMap:Le,mainSeedAssignments:ye,orderedStructureIds:ce,mainSeedingMap:De,flightNumber:Te,linksCount:ue,drawOrder:ve,drawName:Me,drawType:Ee,drawSize:Ne,drawId:ne,stages:oe}}}if(d||f||h||m||g||I||y){let ae=!!f||c,te=Lu({afterRecoveryTimes:!!f,policyDefinitions:r,tournamentRecord:n,inContext:!0,participantMap:l,contextFilters:s,matchUpFilters:o,contextProfile:u,nextMatchUps:ae,event:k})?.matchUps??[];for(let ne of te){let{finishingPositionRange:le,potentialParticipants:de,tieMatchUps:pe=[],sides:ve=[],winningSide:Me,matchUpType:Ee,matchUpId:Be,eventId:fe,drawId:Te,collectionId:ce,containerStructureId:be,stageSequence:we,finishingRound:Ae,matchUpStatus:ye,roundPosition:Ne,roundNumber:he,structureId:De,schedule:Le,score:J,stage:se}=ne;if(D[Be]=ne,d&&be&&De&&Te&&(M[De]||(M[De]=[]),M[De].push(ne),!N[be])){let ue=F.find(ee=>ee.drawId===Te);ue&&(N[be]={drawDefinition:ue,drawId:Te})}let oe={finishingPositionRange:le,containerStructureId:be,finishingRound:Ae,stageSequence:we,roundPosition:Ne,collectionId:ce,roundNumber:he,structureId:De,schedule:Le,eventId:fe,drawId:Te,score:J,stage:se};_W({...oe,...U,matchUpStatus:ye,winningSide:Me,matchUpType:Ee,matchUpId:Be,sides:ve});for(let ue of pe){let{winningSide:ee,sides:Se=[],matchUpId:Pe,collectionPosition:st,collectionId:Ue,matchUpStatus:dt,matchUpType:bi}=ue;_W({...oe,...U,winningSide:ee,tieWinningSide:Me,matchUpTieId:Be,matchUpId:Pe,sides:Se,collectionId:Ue,collectionPosition:st,matchUpSides:ve,matchUpStatus:dt,matchUpType:bi})}Array.isArray(de)&&(ae||f||p)&&de.flat().map(bt).filter(Boolean)?.forEach(ue=>{S(ue)?.forEach(ee=>{l[ee]&&(l[ee].potentialMatchUps[Be]=Ve({tournamentId:n?.tournamentId,matchUpId:Be,eventId:fe,drawId:Te}))}),(f||p)&&v8({potential:!0,participantMap:l,participantId:ue,matchUpStatus:ye,roundPosition:Ne,structureId:De,matchUpType:Ee,roundNumber:he,matchUpId:Be,schedule:Le,drawId:Te,score:J})})}P.push(...te)}}let O={};if(d)for(let[k,F]of Object.entries(N)){let{drawDefinition:x,drawId:L}=F,$=x.structures?.find(j=>j.structureType===hn&&j.stage===Fe&&j.stageSequence===1);if(!$?.structures)continue;let V=$.structures,_=V.length,B=V.reduce((j,Y)=>j+(Y.positionAssignments?.length||0),0),G=x.structures?.find(j=>j.stage===Ai);O[L]||(O[L]={});for(let j of V){let Y=j.structureId,K=M[Y];if(!K?.length)continue;let X=j.positionAssignments?.length,{subOrderMap:Z}=zL({positionAssignments:j.positionAssignments}),Q=Dm({matchUps:K,subOrderMap:Z});if(Q?.participantResults)for(let[ae,te]of Object.entries(Q.participantResults)){let{groupOrder:ne,provisionalOrder:le}=te,de=ne||le;if(!de)continue;let pe;if(B===X&&de)pe=[de,de];else if(_>1&&de&&!G)pe=[1,_];else if(_>1&&de&&G){let ve=x.links?.find(Me=>Me.source.structureId===k)?.source?.finishingPositions;if(ve){let Me=ve.length*_;if(ve.includes(de))pe=[1,Me];else{let Ee=(X-de)*_;pe=[Me+1,B-Ee]}}}pe&&(O[L][ae]=pe)}}}if(m||d||f){let k=Object.values(l);for(let F of k){let{wins:x,losses:L,[zt]:{wins:$,losses:V},[Bt]:{wins:_,losses:B}}=F.counters,G=(j,Y,K)=>{let X=Y+K,Z=Y,Q=X&&Z/X;F.statistics[j]={denominator:X,numerator:Z,statValue:Q,statCode:j}};if(m&&(G(mD,x,L),G(`${mD}.${zt}`,$,V),G(`${mD}.${Bt}`,_,B)),d){let j=(Y=[])=>Math.abs(Y[0]-Y[1]);for(let Y of Object.keys(F.draws)){let{orderedStructureIds:K=[],flightNumber:X}=C[Y]||{};if(F.structureParticipation&&K.length){let Z,Q=0,ae=K.map(te=>{let ne=F.structureParticipation[te];if(!ne)return;Z||(Z=ne?.finishingPositionRange),j(Z)>j(ne?.finishingPositionRange)&&(Z=ne?.finishingPositionRange);let le=ne.stage!==We;return le&&(Q+=1),Ve({...ne,participationOrder:le?Q:void 0,flightNumber:X})}).filter(Boolean);if(F.draws[Y]){let te=F.participant.participantId,ne=O[Y]?.[te];ne&&(Z=ne),F.draws[Y].finishingPositionRange=Z,F.draws[Y].structureParticipation=ae}}}}if(f){let j=St(f)?f.scheduledMinutesDifference:0,Y=F.scheduleItems||[],K=F.potentialMatchUps||{},X=Y.reduce((Q,ae)=>{let{scheduledDate:te,scheduledTime:ne}=ae;return Q[te]||(Q[te]=[]),ne&&Q[te].push(ae),Q},{});Object.values(X).forEach(Q=>Q.sort(GK));for(let Q of Y){let{typeChangeTimeAfterRecovery:ae,timeAfterRecovery:te,scheduledDate:ne,scheduledTime:le}=Q,de=X[ne],pe=Mt(le);for(let ve of de){if(ve.matchUpId===Q.matchUpId||$r(ve.matchUpStatus)&&!ve.checkScoreHasValue)continue;let Me=Q.matchUpType!==ve.matchUpType&&ae||te,Ee=Q.drawId===ve.drawId,Be=K[Q.matchUpId]&&K[ve.matchUpId],fe=Mt(ve.scheduledTime),Te=Math.abs(fe-pe),ce=fe>=pe;if((j&&!Number.isNaN(j)?Te<=j:ce&&Mt(ve.scheduledTime)<Mt(Me))&&!(Be&&Ee)&&ce){let be=[Q.matchUpId,ve.matchUpId].sort(oC).join("|");F.scheduleConflicts[be]={priorScheduledMatchUpId:Q.matchUpId,matchUpIdWithConflict:ve.matchUpId}}}}let Z=F.participant.participantId;Object.keys(F.scheduleConflicts).length&&T.push(Z),l[Z].scheduleConflicts=F.scheduleConflicts}}}return{participantIdsWithConflicts:T,eventsPublishStatuses:E,derivedEventInfo:R,derivedDrawInfo:C,mappedMatchUps:D,participantMap:l,matchUps:P}}function CS({participantFilters:t={},tournamentRecord:e,participants:i=[]}){if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:s,participantRoles:o,participantRoleResponsibilities:l,participantTypes:u,participantIds:c,signInStatus:d,enableOrFiltering:p,eventIds:f,genders:h}=t,m=_l(f)&&e?.events?.filter(y=>f?.includes(y.eventId))||e?.events||[],g=n&&uwe({drawEntryStatuses:n,tournamentEvents:m}),I=s&&cwe({eventEntryStatuses:s,tournamentEvents:m}),v=a!==void 0&&[!0,!1].includes(a)&&m.reduce((y,b)=>y.concat(...(b.drawDefinitions||[]).map(S=>o7({drawDefinition:S}).allPositionedParticipantIds).filter(Boolean)),[]),w=y=>r?.reduce((b,S)=>{let{accessor:U,value:T}=S,{values:D}=wp({element:y,accessor:U});return b&&D?.includes(T)},!0);if(i=i?.filter(y=>{let b=Ss({element:y,itemType:pS})?.timeItem?.itemValue,{participantRoleResponsibilities:S,participantType:U,participantRole:T,participantId:D,person:P}=y,E=Array.isArray(h)&&h?.length&&P?.sex&&h.includes(P.sex);return p?h&&E||a&&v.includes(D)||a===!1&&!v.includes(D)||g?.includes(D)||I?.includes(D)||c?.includes(D)||d&&b===d||u&&U&&_l(u)&&u.includes(U)||o&&T&&_l(o)&&o.includes(T)||l&&_l(S)&&_l(l)&&l.find(R=>S?.includes(R))||r?.length&&_l(r)&&w(y):(!h||E)&&(a===void 0||a&&v.includes(D)||a===!1&&!v.includes(D))&&(!g||g.includes(D))&&(!I||I.includes(D))&&(!c||c.includes(D))&&(!d||b===d)&&(!u||U&&_l(u)&&u.includes(U))&&(!o||T&&_l(o)&&o.includes(T))&&(!l||_l(S)&&_l(l)&&l.find(R=>S?.includes(R)))&&(!r?.length||_l(r)&&w(y))}),m.length&&f){let y=new Set(m.filter(b=>f.includes(b.eventId)).flatMap(b=>{let S=(b.entries||[]).map(T=>T.participantId);if(Ti(pl)(b.eventType))return S;let U=(e?.participants??[]).filter(T=>S.includes(T.participantId)).flatMap(T=>T.individualParticipantIds);return S.concat(...U)}));i=i?.filter(b=>y.has(b.participantId))}return i}function _l(t){return t&&Array.isArray(t)&&t.length}function uwe({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return ot(e.reduce((r,n)=>{let{flightProfile:a}=Bi({event:n}),s=a?.flights?.flatMap(({drawEntries:l})=>Array.isArray(l)?l.filter(i).map(bt):[])||[],o=n.drawDefinitions?.map(({entries:l})=>l?l.filter(i).map(bt):[])||[];return r.concat(...s,...o)},[]))}function cwe({eventEntryStatuses:t,tournamentEvents:e}){return ot(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(bt);return i.concat(...n)},[]))}function Pi(t){let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:s,withScheduleItems:o,tournamentRecord:l,scheduleAnalysis:u,withSignInStatus:c,withTeamMatchUps:d,withScaleValues:p,usePublishState:f,withStatistics:h,contextFilters:m,matchUpFilters:g,contextProfile:I,withOpponents:v,withMatchUps:w,internalUse:y,withSeeding:b,withEvents:S,withDraws:U,withISO2:T,withIOC:D}=t,P="getParticipants";if(!l)return z({stack:P,result:{error:ge}});(w||n)&&fo({tournamentRecord:l});let E=S7({convertExtensions:a,tournamentRecord:l,withSignInStatus:c,withScaleValues:p,internalUse:y,withISO2:T,withIOC:D}),{participantMap:R}=E,C=lwe({withMatchUps:w??n,withEvents:S??n,withDraws:U??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:o,policyDefinitions:s,tournamentRecord:l,scheduleAnalysis:u,withTeamMatchUps:d,usePublishState:f,withStatistics:h,contextFilters:m,matchUpFilters:g,participantMap:R,withOpponents:v,contextProfile:I,withSeeding:b}),{participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:O,mappedMatchUps:k}=C,F=C.matchUps;R=C.participantMap;let x=u??r,L=({potentialMatchUps:j,scheduleConflicts:Y,scheduleItems:K,participant:X,statistics:Z,opponents:Q,matchUps:ae,events:te,draws:ne})=>{let le=Object.values(ne),de=Object.values(Q);return v&&le?.forEach(pe=>{pe.opponents=de.filter(ve=>ve.drawId===pe.drawId)}),Ve({...X,scheduleConflicts:u?Object.values(Y):void 0,draws:U||n?le:void 0,events:S||n?Object.values(te):void 0,matchUps:w||n?Object.values(ae):void 0,opponents:v?de:void 0,potentialMatchUps:x?Object.values(j):void 0,statistics:h?Object.values(Z):void 0,scheduleItems:o?K:void 0},!1,!1,!0)},$=new Map;for(let j of Object.keys(R))$.set(j,L(R[j]));let V=[...$.values()],_=s?.[sS]?.participant,B=CS({participants:V,participantFilters:i,tournamentRecord:l});if(e){let j=St(e)?e:void 0;for(let Y of B)for(let K of Y.individualParticipantIds??[]){Y.individualParticipants??=[];let X=$.get(K),Z=j?Fh({template:j,source:X}):X;Y.individualParticipants.push(Z)}}let G=_?B.map(j=>Fh({source:j,template:_})):B;return{participantMap:t.returnParticipantMap!==!1?R:void 0,mappedMatchUps:t.returnMatchUps!==!1?k:void 0,matchUps:t.returnMatchUps!==!1?F:void 0,missingParticipantIds:E.missingParticipantIds,participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:O,participants:G,...H}}function Bh(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:ur};let{participant:a,tournamentId:s}=Wd({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...Zl({participant:a,scaleAttributes:i}),tournamentId:s}:{error:ji}}function dwe(t,e){let i=t.startDate||e?.startDate,r=t.endDate||e?.endDate;return!i||!r?{error:DIe}:!Cn(i)||!Cn(r)?{error:qi}:{startDate:i,endDate:r}}function $W(t,e){let i=new Date(Qe(t)),r=new Date(Qe(e)),n=r.getFullYear()-i.getFullYear(),a=r.getMonth()-i.getMonth();return(a<0||a===0&&r.getDate()<i.getDate())&&n--,n}function BW(t,e,i){return!(e!==void 0&&t<e||i!==void 0&&t>i)}function pwe(t){return/^C\d{1,2}-\d{1,2}$/.test(t.ageCategoryCode||"")}function fwe(t,e,i,r){if(pwe(e))return{valid:!0};let n=e.ageMin,a=e.ageMax;if(e.ageCategoryCode&&!n&&!a){let d=Mp({consideredDate:i,category:e});d.error||(n=d.ageMin,a=d.ageMax)}if(!n&&!a)return{valid:!0};let s=t.person?.birthDate;if(!s)return{valid:!1,reason:"Missing birthDate",details:{requiredMin:n,requiredMax:a}};let o=$W(s,i),l=$W(s,r),u=BW(o,n,a),c=BW(l,n,a);if(!u){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${o} at event start (${i}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}if(!c){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${l} at event end (${r}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}return{valid:!0}}function hwe(t,e,i,r){if(!e.ratingMin&&!e.ratingMax)return{valid:!0};if(!e.ratingType)return{valid:!0};let n={scaleType:"RATING",scaleName:e.ratingType,eventType:i.eventType},{scaleItem:a}=Bh({tournamentRecord:r,participantId:t.participantId,scaleAttributes:n});if(!a?.scaleValue)return{valid:!1,reason:`Missing ${e.ratingType} rating`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};let s;if(typeof a.scaleValue=="object"){let o=wp({element:a.scaleValue,accessor:a.scaleValue?.accessor});if(o===void 0)return{valid:!1,reason:`Cannot extract rating value from ${e.ratingType} scale item`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};s=o}else s=a.scaleValue;return e.ratingMin!==void 0&&s<e.ratingMin?{valid:!1,reason:`${e.ratingType} rating ${s} below minimum ${e.ratingMin}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:e.ratingMax!==void 0&&s>e.ratingMax?{valid:!1,reason:`${e.ratingType} rating ${s} above maximum ${e.ratingMax}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:{valid:!0}}function mwe(t){let e=t.person;if(!e)return"Unknown";let i=e.standardGivenName||e.passportGivenName,r=e.standardFamilyName||e.passportFamilyName;return[i,r].filter(Boolean).join(" ")||"Unknown"}function gwe(t,e,i,r,n,a){let s=fwe(t,e,r,n),o=hwe(t,e,i,a);if(!s.valid||!o.valid){let l={participantId:t.participantId,participantName:mwe(t),rejectionReasons:[]};return s.valid||l.rejectionReasons.push({type:"age",reason:s.reason,details:s.details||{}}),o.valid||l.rejectionReasons.push({type:"rating",reason:o.reason,details:o.details||{}}),l}return null}function dh({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){if(!e)return{error:_e};let n=e.entries?.find(a=>a.participantId===t&&(!i||i===a.entryStatus)&&(!r||r===a.entryStage));return t&&n}function Iwe({relevantLinks:t,drawDefinition:e,provisionalPositioning:i,roundQualifiersCounts:r}){let n=0;for(let a of t){let s=et({structureId:a.source.structureId,drawDefinition:e})?.structure;if(s?.stage===We){let o=a.source.roundNumber,l=a.target.roundNumber,u;if(s.structureType===hn){let c=s.structures?.length??0,d=a.source.finishingPositions?.length??0;u=c*d}else u=kt({matchUpFilters:{roundNumbers:[o]},structure:s,afterRecoveryTimes:!1,provisionalPositioning:i,inContext:!1}).matchUps?.length||0;r[l]||(r[l]=0),r[l]+=u,n+=u}}return n}function wv(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=t;if(!i)return{error:_e};let{entryProfile:s}=mS({drawDefinition:i}),o=a&&r&&s?.[a]?.stageSequence?.[r]?.qualifiersCount||a&&s?.[a]?.qualifiersCount||0,l={};if(!n)return{qualifiersCount:o,roundQualifiersCounts:l};let{structure:u}=et({drawDefinition:i,structureId:n}),c=i.links?.filter(f=>f?.target?.structureId===u?.structureId),d=0;c?.length&&(d=Iwe({relevantLinks:c,drawDefinition:i,provisionalPositioning:e,roundQualifiersCounts:l}));let p=Object.keys(l);if(p.length<=1){let f=p[0]||1;l[f]=Math.max(l[f]||0,o)}return d=Math.max(d,o),{qualifiersCount:d,roundQualifiersCounts:l}}function wP({stage:t,drawDefinition:e}){let{entryProfile:i}=mS({drawDefinition:e});return i?.[t]?.drawSize||0}function vwe(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=wP({stage:n,drawDefinition:i}),{qualifiersCount:s}=wv({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-s}function y8({stage:t,drawDefinition:e}){return!!(t===Rr||AL({stage:t,drawDefinition:e})&&wP({stage:t,drawDefinition:e}))}function b8({entryStatus:t=da,drawDefinition:e,stageSequence:i,stage:r}){if(t===Bs)return Lye({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...H}:{error:X4};let n=vwe({drawDefinition:e,stageSequence:i,stage:r}),a=_ye({drawDefinition:e,stage:r}),s=GO({entryStatus:hI,drawDefinition:e,stage:r}),o=GO({entryStatus:da,drawDefinition:e,stage:r}),l=s+o,u=l>=n,c=n-l;return r!==Rr&&u?{error:MO}:t===hI?s<a?{...H}:{error:MO}:{positionsAvailable:c,...H}}function qL(t){let e=Ge(t,[{[mn]:!0,[L5]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=da,entryStageSequence:n,entryStage:a=Fe,ignoreStageSpace:s,drawDefinition:o,entryPosition:l,participant:u,roundTarget:c,extensions:d,extension:p,drawType:f,event:h}=t,m="addDrawEntry";if(f!==ca&&!y8({stage:a,drawDefinition:o}))return z({result:{error:of},stack:m});let g=b8({stageSequence:n,stage:a,drawDefinition:o,entryStatus:r});if(!s&&!g.success&&(!f||f!==ca))return{error:g.error};if(p&&!hl({extension:p}))return z({result:{error:ie},info:"Invalid extension",context:{extension:p},stack:m});let I=t.participantId||u?.participantId;if(!I)return z({result:{error:ur},stack:m});let v=r===wc&&dh({participantId:I,drawDefinition:o,entryStatus:r}),w=a===Rr&&dh({participantId:I,drawDefinition:o,entryStage:a}),y=dh({participantId:I,drawDefinition:o}),b=r!==wc&&a!==Rr&&y;if(b)return i?(nt({payload:{drawId:o.drawId,eventId:h?.eventId,error:Eb,participantId:I},topic:hL}),{...H}):z({result:{error:Eb},context:{participantId:I},stack:m});if(v||w)return z({context:{invalidEntry:b,invalidLuckyLoser:v,invalidVoluntaryConsolation:w},result:{error:mR},stack:m});let S=Ve({entryStageSequence:n,participantId:I,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&gt({element:S,extension:p}),c&&gt({extension:{name:"roundEntry",value:c},element:S}),o.entries??=[],o.entries.push(S),ii({drawDefinition:o}),{...H}}function ywe(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=da,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:s,drawDefinition:o,stageSequence:l,stage:u=Fe,roundTarget:c,extension:d,event:p}=t,f=o.drawType===ca;if(!u)return{error:U4};if(!o)return{error:_e};if(!Array.isArray(s))return{error:Sa};if(!f&&!y8({stage:u,drawDefinition:o}))return{error:of};if(d&&!hl({extension:d}))return z({result:{error:ie},info:"Invalid extension",context:{extension:d},stack:e});let h=b8({drawDefinition:o,stageSequence:l,entryStatus:r,stage:u});if(!a&&!h.success&&!f)return{error:h.error};let m=h.positionsAvailable??0;if(!a&&!f&&u!==Rr&&m<s.length)return{error:y1};let g=[],I=o.drawId,v=p?.eventId,w=s.reduce((y,b)=>{let S=r===wc&&dh({participantId:b,drawDefinition:o,entryStatus:r}),U=u===Rr&&dh({entryStage:u,drawDefinition:o,participantId:b}),T=dh({participantId:b,drawDefinition:o});return r!==wc&&u!==Rr&&T&&(g.push(b),i&&nt({payload:{error:Eb,participantId:b,eventId:v,drawId:I},topic:hL})),S||U?y.concat(b):y},[]);return g.length&&!i?z({context:{eventId:v,drawId:I,duplicateEntries:g},result:{error:Eb},stack:e}):(s.filter(y=>y&&!w.includes(y)).forEach(y=>{let b={entryStageSequence:l,entryStage:u,participantId:y,entryStatus:r};d&&gt({element:b,extension:d}),c&&gt({extension:{name:Al,value:c},element:b}),o.entries??=[],o.entries.push(b)}),n&&(o.entries=Do({entries:o.entries})),ii({drawDefinition:o}),w?.length||g?.length?{info:"some participantIds could not be added",participantIdsNotAdded:w,duplicateEntries:g,...H}:{...H})}function YL({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,entryStage:l,extension:u,drawId:c,event:d}){if(!n?.length)return{error:Bd};if(!d)return{error:ds};if(!c)return{error:Vo};let p=(d.entries||[]).map(bt);if(n.filter(m=>!p.includes(m)).length)return{error:w4};if(a){let m=ywe({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,extension:u});if(m.error)return m}let{flightProfile:f}=Bi({event:d}),h=f?.flights.find(m=>m.drawId===c);return h?.drawEntries&&(n.forEach(m=>{let g=s===wc&&sk({participantId:m,entryStatus:s,flight:h}),I=l===Rr&&sk({participantId:m,entryStage:l,flight:h});!(s!==wc&&l!==Rr&&sk({flight:h,participantId:m}))&&!g&&!I&&h.drawEntries.push({participantId:m,entryStatus:s,entryStage:l})}),e&&(h.drawEntries=Do({entries:h.drawEntries}))),{...H}}function sk({participantId:t,entryStatus:e,entryStage:i,flight:r}){let n=r.drawEntries?.find(a=>a.participantId===t&&(!e||e===a.entryStatus)&&(!i||i===a.entryStage));return t&&n}function MS({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){let a="removeEventEntries";if(!n?.eventId)return{error:ui};if(!Array.isArray(e)||e.some(d=>!ni(d)))return z({result:{error:No},stack:a});let s=(n.drawDefinitions??[]).flatMap(d=>If({drawDefinition:d}).assignedParticipantIds??[]),o=(i?.length&&n.entries?.filter(d=>d.entryStatus&&i.includes(d.entryStatus))||[]).map(bt).filter(d=>!s.includes(d)),l=(r&&n.entries?.filter(d=>d.entryStage&&d.entryStage===r)||[]).map(bt).filter(d=>!s.includes(d));if(e.length?e=e.filter(d=>(!i?.length||o.includes(d))&&(!r||l.includes(d))):o.length&&l.length?e=Fi(o,l):o.length?e=o:l.length&&(e=l),e?.length&&s.some(d=>e.includes(d)))return z({result:{error:lv},stack:a});if(!e?.length)return{...H,participantIdsRemoved:[]};let u=[];n.entries=(n.entries??[]).filter(d=>{let p=!e.includes(d?.participantId);return p||u.push(d.participantId),p}),t&&(n.entries=Do({entries:n.entries}));let{flightProfile:c}=Bi({event:n});return c?.flights?.forEach(d=>{d.drawEntries=(d.drawEntries||[]).filter(p=>!e.includes(p.participantId))}),n.drawDefinitions?.forEach(d=>{d.entries=(d.entries??[]).filter(p=>!e.includes(p.participantId))}),{...H,participantIdsRemoved:u}}var w8={[Cr]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},Sv=w8;function bwe(t,e,i,r){return e.gender&&i&&!($a(e.gender)||cu(e.gender))&&ln(e.gender)!==ln(t.person?.sex)?(r.push({participantId:t.participantId,sex:t.person?.sex}),!1):!0}function wwe({participantIds:t,typedParticipantIds:e,checkTypedParticipants:i}){return t.filter(r=>!i||e.includes(r))}function Swe({tournamentRecord:t,participantIds:e,event:i,entryStatus:r,genderEnforced:n,mismatchedGender:a}){function s(c,d,p){return Ti(zt)(d.eventType)&&c.participantType===vt&&!mp(p)}function o(c,d,p){return d.eventType===Bt&&c.participantType===ht&&!mp(p)}function l(c,d,p,f,h){return d.eventType===Bt&&c.participantType===vt&&mp(p)?d.gender&&f&&!($a(d.gender)||cu(d.gender))&&ln(d.gender)!==ln(c.person?.sex)?(h.push({participantId:c.participantId,sex:c.person?.sex}),!1):!0:!1}function u(c,d,p){return d.eventType===_t&&(c.participantType===_t||mp(p)&&c.participantType===vt)}return t?.participants?.filter(c=>e.includes(c.participantId)?s(c,i,r)&&(!i.gender||!n||$a(i.gender)||cu(i.gender)||ln(i.gender)===ln(c.person?.sex))||o(c,i,r)||l(c,i,r,n,a)?!0:s(c,i,r)&&!bwe(c,i,n,a)?!1:u(c,i,r):!1).map(c=>c.participantId)??[]}function Uwe({typedParticipantIds:t,categoryRejections:e,tournamentRecord:i,startDate:r,endDate:n,event:a}){let s=[];for(let o of t){let l=i.participants?.find(u=>u.participantId===o);if(l)if(a.category){let u=gwe(l,a.category,a,r,n,i);u?e.push(u):s.push(o)}else s.push(o)}return s}function Twe({enforceCategory:t,event:e,tournamentRecord:i,typedParticipantIds:r,categoryRejections:n}){if(t&&e.category&&i){let a=dwe(e,i);if(!("error"in a)){let{startDate:s,endDate:o}=a;return Uwe({typedParticipantIds:r,tournamentRecord:i,event:e,startDate:s,endDate:o,categoryRejections:n})}}return r}function Dwe({validParticipantIds:t,existingIds:e,entryStatus:i,entryStage:r,extensions:n,extension:a,roundTarget:s,entryStageSequence:o,addedParticipantIdEntries:l,event:u}){t.forEach(c=>{if(!e.has(c)){let d=Ve({participantId:c,entryStatus:i,entryStage:r,extensions:n});a&&gt({element:d,extension:a}),s&&gt({extension:{name:Al,value:s},element:d}),o&&(d.entryStageSequence=o),l.push(d.participantId),u.entries?.push(d)}})}function Pwe({tournamentRecord:t,removedEntries:e,event:i}){if(i.eventType&&[mc,Da].includes(i.eventType)){let r=new Set((i.entries||[]).map(l=>l.participantId)),n=(i.entries||[]).filter(l=>mp(l.entryStatus)).map(l=>l.participantId),a=t?.participants??[],s=new Set(a.filter(l=>r.has(l.participantId)&&l.participantType&&[ht,_t].includes(l.participantType)).map(l=>l.individualParticipantIds).flat(1/0)),o=n.filter(l=>s.has(l));o.length&&(e.push(...o),MS({participantIds:o,autoEntryPositions:!1,event:i}))}}function Ewe(t,e){if(!Array.isArray(t.participantIds))return z({result:{error:Sa},stack:e});let i=ot(t.participantIds??[]);return t.event?i?.length?t.event?.eventId?{participantIds:i}:{error:ds}:z({result:{error:Bd},stack:e}):{error:ui}}function Rwe({policyDefinitions:t,tournamentRecord:e,event:i,enforceGender:r}){let n=Rt({tournamentRecord:e,event:i}).appliedPolicies??{},a=t?.[Cr]??n?.[Cr]??Sv[Cr],s=(r??a?.participants?.enforceGender)!==!1;return{matchUpActionsPolicy:a,genderEnforced:s}}function Cwe(t,e,i){return t&&(!Array.isArray(t)||!t.every(r=>hl({extension:r})))||e&&!hl({extension:e})?z({context:Ve({extension:e,extensions:t}),result:{error:ie},info:"Invalid extension(s)",stack:i}):null}function rl(t){let{suppressDuplicateEntries:e=!0,entryStatus:i=da,autoEntryPositions:r=!0,enforceCategory:n=!1,enforceGender:a=!0,entryStageSequence:s,policyDefinitions:o,entryStage:l=Fe,tournamentRecord:u,ignoreStageSpace:c,drawDefinition:d,roundTarget:p,extensions:f,extension:h,drawId:m,event:g}=t,I="addEventEntries",v=Ewe(t,I);if("error"in v)return v;let w="participantIds"in v?v.participantIds:[],y=Cwe(f,h,I);if(y)return y;let{genderEnforced:b}=Rwe({policyDefinitions:o,tournamentRecord:u,event:g,enforceGender:a}),S=[],U=[],T=!!u,D=[],P,E=Swe({tournamentRecord:u,participantIds:w,event:g,entryStatus:i,genderEnforced:b,mismatchedGender:D}),R=[];E=Twe({enforceCategory:n,event:g,tournamentRecord:u,typedParticipantIds:E,categoryRejections:R});let C=wwe({participantIds:w,typedParticipantIds:E,checkTypedParticipants:T});g.entries??=[];let M=new Set(g.entries.map(O=>O.participantId||O.participant?.participantId));if(Dwe({validParticipantIds:C,existingIds:M,entryStatus:i,entryStage:l,extensions:f,extension:h,roundTarget:p,entryStageSequence:s,addedParticipantIdEntries:S,event:g}),m&&!mp(l)){let O=YL({participantIds:C,suppressDuplicateEntries:e,autoEntryPositions:r,entryStageSequence:s,ignoreStageSpace:c,drawDefinition:d,entryStatus:i,roundTarget:p,entryStage:l,extension:h,drawId:m,event:g});O.error&&(P=O.error)}if(Pwe({event:g,tournamentRecord:u,removedEntries:U}),C.length!==w.length)return z({context:Ve({categoryRejections:R.length?R:void 0,mismatchedGender:D.length?D:void 0,gender:g.gender}),result:{error:Sa},stack:I});r&&(g.entries=Do({entries:g.entries||[]}));let N=S.length,A=U.length;return z({result:{...H,addedEntriesCount:N,removedEntriesCount:A,...R.length&&{context:Ve({categoryRejections:R})}},stack:I,info:P})}var S8="ADMINISTRATION",Mwe="CAPTAIN",Nwe="COACH",Xr="COMPETITOR",Awe="DIRECTOR",kwe="HOSPITALITY",U8="MEDIA",T8="MEDICAL",KL="OFFICIAL",D8="OTHER",P8="SECURITY",Owe="STRINGER",xwe="SUPERVISOR",Fwe="TRANSPORT",Lwe="VOLUNTEER",XL={ADMINISTRATION:S8,CAPTAIN:Mwe,COACH:Nwe,COMPETITOR:Xr,DIRECTOR:Awe,HOSPITALITY:kwe,MEDIA:U8,MEDICAL:T8,OFFICIAL:KL,OTHER:D8,SECURITY:P8,STRINGER:Owe,SUPERVISOR:xwe,TRANSPORT:Fwe,VOLUNTEER:Lwe};function JL({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return z({result:{error:ge},stack:a});if(!i||!e)return z({result:{error:Xe},stack:a});let s=(r.participants??[]).find(c=>c.participantId===i);if(!s)return z({result:{error:ji},stack:a});if(![_t,Xa].includes(s.participantType))return z({result:{participantType:s.participantType,error:Ao},stack:a});let o=E8({individualParticipantIds:e,groupingParticipant:s,tournamentRecord:r,suppressErrors:n}),{removed:l,error:u}=o;if(u)return z({result:o,stack:a});if(t)for(let c of r.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l?.filter(f=>!d.includes(f));rl({participantIds:p,entryStatus:Us,tournamentRecord:r,event:c})}}return l&&nt({topic:tn,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...H,...o}}function E8({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){let s=[];if(!e)return{removed:s};let o=[],l=[];a||({participants:a,mappedMatchUps:n}=Pi({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let u=a?.find(({participantId:p})=>p===e.participantId)?.events?.map(({eventId:p})=>p),c=(e.individualParticipantIds??[]).filter(p=>{let f=t?.includes(p),h=f&&a?.find(g=>g.participantId===p)?.matchUps.filter(({eventId:g})=>u.includes(g)).map(({matchUpId:g})=>n?.[g]).filter(({winningSide:g,score:I})=>g||dr({score:I})),m=f&&!h?.length;if(f&&!m&&l.push(p),m){s.push(p);for(let g of i.events??[])for(let I of g.drawDefinitions??[]){let{extension:v}=it({element:I,name:Ic}),w=v?.value[e.participantId];v&&w&&(v.value[e.participantId]=w.filter(b=>b.participantId!==p),gt({element:I,extension:v}),cS({drawDefinition:I}));let y=Nn({drawDefinition:I,inContext:!1}).matchUps??[];for(let b of y){let S=b.sides??[];for(let U of S){let T=U.lineUp??[];T.find(D=>D.participantId===p)&&(U.lineUp=T.filter(D=>D.participantId!==p),Tt({tournamentId:i?.tournamentId,drawDefinition:I,matchUp:b}))}}}}else o.push(p);return!m});e.individualParticipantIds=c;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:o,removed:s};return l.length&&!r&&{...d,cannotRemove:l,error:fR}||d}function lC({participantRole:t=Xr,individualParticipantIds:e=[],groupingTypes:i=[jn,Xa],tournamentRecord:r}){if(!r)return{error:ge};let n=r.participants??[],{participants:a,mappedMatchUps:s}=Pi({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),o=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=E8({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:s,participants:a});u&&o++}),o?H:{error:W4}}function Em(t){let e=Ge(t,[{[mr]:!0},{participantIds:!0,[Xn]:sn,[$s]:Bd}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:r,participantIds:n}=t,a=r.participants?.length||0;if(!a)return{...H};let s=(r.events||[])?.filter(({eventType:h})=>h===sr).map(h=>h?.drawDefinitions?.map(({drawId:m})=>m)).flat(1/0),o=Pi({participantFilters:{participantIds:n},tournamentRecord:r,withDraws:!0}).participants??[],l=h=>{let m=(wr({matchUpFilters:{drawIds:h,matchUpTypes:[Bt]},tournamentRecord:r}).matchUps??[]).flatMap(({sides:g})=>g?.map(({participantId:I})=>I||[])).filter(Boolean);return Fi(m,n)},u=s?.length?l(s):[],c=o.filter(h=>h.draws?.filter(m=>(!s?.length||!s?.includes(m.drawId))&&m.positionAssignments).length);if(u?.length||c.length)return{error:lv};let d={},p={};for(let h of r.events||[]){let m=MS({participantIds:n,event:h});if(m.error)return m;d[h.eventId]=m.participantIdsRemoved}r.participants=(r.participants??[]).filter(h=>{let m=n.includes(h.participantId)||h.participantType===ht&&h.individualParticipantIds?.some(g=>n.includes(g));if(!m&&h.participantType===sr&&h.individualParticipantIds?.some(g=>n.includes(g))&&(h.individualParticipantIds=h.individualParticipantIds.filter(g=>!n.includes(g))),m&&i&&h.participantType&&[ht,_t].includes(h.participantType))for(let g of h.individualParticipantIds||[])n.includes(g)||(p[h.participantId]||(p[h.participantId]=[]),p[h.participantId].push(g));return!m});let f=a-r.participants.length;if(lC({individualParticipantIds:n,tournamentRecord:r}),i)for(let h of r.events||[]){let m=d[h.eventId].map(g=>p[g]||[]).flat();rl({participantIds:m,entryStatus:Us,tournamentRecord:r,event:h})}return f&&nt({payload:{participantIds:n,tournamentId:r.tournamentId},topic:mL}),f?{...H,participantsRemovedCount:f}:{error:fR}}function R8({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){let s=n.entries??[];if(r){let{flightProfile:l}=Bi({event:n}),u=l?.flights?.find(c=>c.drawId===r);u?s=u.drawEntries:e.entries&&(s=e?.entries)}let o=s.filter(l=>(!i?.length||!l.entryStatus||i.includes(l.entryStatus))&&(!a||!l.entryStage||l.entryStage===a)&&(!t||l.entryStatus&&co.includes(l.entryStatus)));return{entries:s,stageEntries:o}}function C8({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:s}){let o="destroyGroupEntry";if(!e)return{error:ge};if(!r)return z({result:{error:ur},stack:o});if(!s)return{error:ui};if(!s.eventType||![mc,Da].includes(s.eventType))return z({result:{error:uu},stack:o});let l=e.participants??[],u=l.find(I=>I.participantId===r);if(!u)return z({result:{error:ji},stack:o});if(!u.participantType||![ht,jn].includes(u.participantType)||u.participantType===jn&&s.eventType!==Da||u.participantType===ht&&s.eventType!==mc)return{error:Ao};let c=(s.entries??[]).find(I=>I.participantId===r);if(!c)return{error:K4};let{stageEntries:d}=R8({selected:!1,drawDefinition:i,drawId:n,event:s,stage:a}),p=d.map(bt),f=l.filter(({participantId:I})=>p.includes(I)).map(({individualParticipantIds:I})=>I).flat().filter(Boolean),h=u.individualParticipantIds?.filter(I=>tl(I,f).length===1),m=MS({participantIds:[r],event:s});if(m.error||h?.length&&(m=rl({participantIds:h,entryStatus:Us,entryStage:c.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:s}),m.error))return m;let g;return t&&Em({participantIds:[r],tournamentRecord:e}).success&&(g=!0),{...H,participantRemoved:g}}function QL({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return C8({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function M8(t){if(!t.tournamentRecord)return{error:ge};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let s=C8({participantId:a,...i});s.success&&(r+=1),s.error&&n.push(s.error)}return r?{destroyedCount:r,...H}:{error:n}}function Hb(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:s,drawId:o}=t,l="removeDrawPositionAssignment",u=ES(t);if(u.error)return z({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:f}=t,h=Rt({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([Bs,Sc].includes(a)&&c){let{tournamentRecord:g}=t,{participant:I}=Wd({tournamentRecord:g,participantId:c}),{participantType:v,individualParticipantIds:w}=I??{};if(n&&v===ht){let y=QL({tournamentRecord:g,drawDefinition:r,participantId:c,event:p});if(y.error)return z({result:y,stack:l});w&&bP({participantIds:w,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}else bP({participantIds:[c],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}if(i){let g=Za({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:f,matchUpsMap:s,event:p});if(g.error)return z({result:g,stack:l})}let{structure:m}=et({drawDefinition:r,structureId:f});return PL({structure:m,drawPositions:[d]}),dS({appliedPolicies:h,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:f}}),u}function N8(t){return Object.assign(t,{entryStatus:Sc}),Hb(t)}var hd=({finishingPosition:t=gm,hasExistingDrawDefinition:e,qualifyingRoundNumber:i,structureAbbreviation:r,seedAssignments:n=[],stageSequence:a=1,qualifyingOnly:s,structureOrder:o,seedingProfile:l,matchUpFormat:u,structureType:c,structureName:d,matchUps:p=[],matchUpType:f,structureId:h,roundOffset:m,roundLimit:g,stageOrder:I,structures:v,tieFormat:w,stage:y})=>{let b={structureId:h??Pt(),structureAbbreviation:r,finishingPosition:t,seedAssignments:n,matchUpFormat:u,stageSequence:a,structureName:d};(s||e&&w)&&(b.tieFormat=w),o&&(b.structureOrder=o),c&&(b.structureType=c),l&&(typeof l=="string"?b.seedingProfile=l:typeof l=="object"&&typeof l.positioning=="string"&&(b.seedingProfile=l.positioning)),f&&(b.matchUpType=f),m&&(b.roundOffset=m),I&&(b.stageOrder=I),g&&(b.roundLimit=g),y&&(b.stage=y),i&&(b.qualifyingRoundNumber=i);let S=p.flatMap(({drawPositions:U})=>U).filter(Boolean);return v?b.structures=v:(b.matchUps=p,b.positionAssignments=ot(S).sort((U,T)=>U-T).map(U=>({drawPosition:U}))),b},ls=hd;function KO(t){return ni(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Jr(t){return ni(t)?KO(t.replace(/_/g," ")):""}function ZL({structureName:t=Jr(Rr),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:_e};let a=ls({stage:Rr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),ii({drawDefinition:i,structureIds:[a.structureId]}),{...H}}function _we({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(ar),e.reverse(),e}function $we({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function Bwe({positioning:t,size:e}){let i=_we({size:e}),r=[],n=[],a=p=>p[0],s=p=>p[p.length-1],o=(p,f)=>(t&&[ER,RR,Np].includes(t)&&f%2?s(p):a(p))||a(p),l=(p,f)=>{if(p.every(h=>!n.includes(h))){let h=o(p,f);return n.push(h),h}},u=p=>{let f=p.filter(h=>!n.includes(h));if(f.length)return n.push(...f),f},c=(p,f)=>{let h=o(p,f);if(!n.includes(h))return n.push(h),h},d=Re(1,e+1);for(let p of i)if(p===1){let f=br(d,2),h=f.map(l).filter(Boolean);h.length&&r.push(h);let m=f.flatMap(u).filter(Boolean);m.length&&r.push(m)}else{let f=br(d,p).map(c).filter(Boolean);f.length&&r.push(f)}return{divisions:i,divisionGroupings:r}}function e0({drawPositions:t}){if(!t?.length)return{error:Gw};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=ot(i.map(uC)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function uC(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(ar).join("|")}function A8({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,f)=>f),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),s=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,I)=>{n[p].push([a[I],s[I]])});let f=a.shift(),h=a.pop(),m=s.shift();a=[f,m,...a].filter(Boolean),s=[...s,h].filter(Boolean)});let o=a.shift(),l=a.pop(),u=s.shift();a=[o,u,...a].filter(Boolean),s=[...s,l].filter(Boolean);let c=d=>d[0].reduce((p,f)=>p+f);return[...n].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(f=>f<=t)).map(p=>{let f=p.map(h=>h+e);return uC(f)}))}function Vwe({rounds:t,hash:e}){return t?.length?t?.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Xe}}var jwe={getRoundRobinGroupMatchUps:e0,determineRoundNumber:Vwe,drawPositionsHash:uC,groupRounds:A8};function NS(t){let{hasExistingDrawDefinition:e,groupNameBase:i="Group",playoffAttributes:r,stageSequence:n=1,structureOptions:a,appliedPolicies:s,qualifyingOnly:o,seedingProfile:l,stage:u=Fe,matchUpType:c,roundTarget:d,structureId:p,groupNames:f,tieFormat:h,drawSize:m,idPrefix:g,isMock:I,uuids:v}=t,w=t.structureName??r?.["0"]?.name??Jr(Fe),{groupCount:y,groupSize:b}=Gwe({structureOptions:a,appliedPolicies:s,drawSize:m}),S=kp,U,T=Re(1,y+1).map(P=>{let E=Hwe({groupSize:b,structureOrder:P,matchUpType:c,drawSize:m,idPrefix:g,isMock:I});U=Array.isArray(E)?Math.max(...E.map(({roundNumber:C})=>C??0)):0;let R=f?.[P-1]??`${i} ${P}`;return hd({structureId:v?.pop(),hasExistingDrawDefinition:e,structureType:CR,finishingPosition:S,qualifyingOnly:o,structureOrder:P,structureName:R,tieFormat:h,matchUps:E})}),D=hd({structureId:p??v?.pop(),hasExistingDrawDefinition:e,structureType:hn,finishingPosition:S,seedingProfile:l,structureName:w,stageSequence:n,structures:T,tieFormat:h,stage:u});return d&&gt({extension:{name:Al,value:d},element:D}),{structures:[D],maxRoundNumber:U,groupCount:y,links:[],groupSize:b,...H}}function Gwe({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e?.groupSize,n=e?.groupSizeLimit||8,{validGroupSizes:a}=AS({groupSizeLimit:n,drawSize:i}),s=a&&Math.max(...a);r&&a?.includes(r)||(r&&r>4||!a?.includes(4)?r=s:r=4);let o=Math.ceil(i/r);return{groupSize:r,groupCount:o}}function AS(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=Re(3,e+1).filter(n=>{let a=Math.ceil(i/n),s=a*n-i,o=Math.ceil(i/a),l=Math.ceil(s/a);return(!s||s<n)&&o===n&&o>=3&&l<2});return{...H,validGroupSizes:r}}function Hwe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:s}){let o=(t-1)*i,l=Re(1+o,i+1+o),u=e0({drawPositions:l}).uniqueMatchUpGroupings??[],c=A8({groupSize:i,drawPositionOffset:o});return u.map(p).sort((f,h)=>(f.roundNumber??1/0)-(h.roundNumber??1/0));function d(f){return c.reduce((h,m,g)=>m.includes(f)?g+1:h,void 0)}function p(f){let h=uC(f),m=d(h),g=[1,r],I=Wwe({structureOrder:t,drawPositions:f,roundNumber:m,idPrefix:n,uuids:s}),v={matchUpStatus:m?Li:"BYE",matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:f,roundNumber:m,matchUpId:I};return a&&(v.isMock=!0),v}}function Wwe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:n?.pop()||Pt()}function t0(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!ut(i))return{seedBlocks:void 0,...z({result:{error:ie},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=nv(i);if(e){let f=Math.min(e,n),h=[],m=1;for(Re(0,f).forEach(()=>{h.push([m]),m++});m<n;){let g=Re(m,m+f);m+=f,h.push(g)}return{...H,seedBlocks:h}}let a=Re(1,n+1),s=[],o=n/2;for(;o>1;){let f=br(a,o),h=f.length;f.forEach((m,g)=>{let I,v=g<h/2,w=g%2===0,y=m[0],b=m[m.length-1];r&&h>4?h===8?I=v?b:y:I=w?y:b:I=v?y:b,Ln(m,s)||s.push(I)}),o=o/2}let l=a.filter(f=>!s.includes(f));for(;l.length;)l.length%2===0?s.push(l.pop()):s.push(l.shift());let u=Re(0,20).map(f=>Math.pow(2,f));u.unshift(1);let c=u.indexOf(n),d=0,p=[];return Re(0,c).forEach(f=>{p.push(s.slice(d,d+u[f])),d+=u[f]}),{...H,seedBlocks:p}}function i0({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!ut(e))return{seedGroups:void 0,...z({result:{error:ie},context:{drawSize:e},stack:i})};if(t){if(!ut(t))return{seedGroups:void 0,...z({context:{roundRobinGroupsCount:t},result:{error:ie},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:Re(0,n).map(()=>{let a=Re(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=t0({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function r0({roundRobinGroupsCount:t,participantsCount:e}){if(t){let{validGroupSizes:n}=AS({drawSize:e});if(!n?.map(a=>Math.ceil(e/a))?.includes(t))return z({context:{roundRobinGroupsCount:t},result:{error:ie}})}let{seedGroups:i}=i0({drawSize:e,roundRobinGroupsCount:t}),r=i?.map(n=>Math.min(...n))||[];return{...H,seedingThresholds:r}}function gI(t){if(!t)return 1/0;if(ut(t))return Ye(t);let e=t.split("-")[0];return ut(e)?Ye(e):1/0}function Rm({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:s}){let o=[];if(!s)return{error:sf};let{matchUps:l,roundMatchUps:u}=kt({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:s}),{seedAssignments:c}=ms({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:s}),{positionAssignments:d}=cr({structure:s}),p=d?.length,f=c?.length??0,h=[],m=Object.keys(u).map(A=>Number.parseInt(A)).sort((A,O)=>A-O).map(A=>{let O=u[A].map(F=>F.drawPositions).flat(1/0).filter(Boolean),k=O.filter(F=>!h.includes(F));return h=h.concat(...O),k}).filter(A=>A.length).reverse(),g=m.pop()??[],I=g&&Math.min(...g)-1||0;r=r??i?.seeding?.seedingProfile;let v=g?.length||0,w=m.filter(A=>A.filter(O=>O<=f).length),{stage:y,structureType:b,roundLimit:S}=s,U=b===hn,T=!U&&m?.length,D=!U&&y===We&&S,P=w.flat(1/0),E=T?P?.length:0,R=a?p:f,C=kL({drawDefinition:n,structure:s,matchUps:l}),M=C?0:!T&&R||R&&P.length<R&&R-P.length||0;if(D){let A=s?.matchUps?s.matchUps.filter(({roundNumber:k})=>k===s.roundLimit).length:0,O=g.length/A;if(!T){let k=kS(r),F=br(g,O),x=1,L=Re(0,F[0].length).map(()=>{let $=Re(x,x+F.length);return x+=F.length,$});({validSeedBlocks:o}=k8({drawPositionBlocks:F,nonRandom:r?.nonRandom,positioning:k,seedGroups:L}))}}else U?{validSeedBlocks:o}=zwe({nonRandom:r?.nonRandom,seedingProfile:r,structure:s}):T?o=w.map(A=>({seedNumbers:A,drawPositions:A})):C&&br(g,2).map((A,O)=>({drawPositions:[A[0]],seedNumbers:[O+1]})).forEach(A=>o.push(A));if(!U&&!C&&!D){let{blocks:A}=qwe({drawPositionOffset:I,seedNumberOffset:E,seedCountGoal:M,seedingProfile:r,baseDrawSize:v});A.forEach(O=>o.push(O))}let N=o.flatMap(A=>A.drawPositions).reduce((A,O)=>g?.includes(O)&&A,!0);return!C&&!T&&!U&&!N?{error:I4,validSeedBlocks:[],isContainer:U,isFeedIn:T}:{isLuckyStructure:C,validSeedBlocks:o,isContainer:U,isFeedIn:T}}function zwe({seedingProfile:t,structure:e,nonRandom:i}){let r=e.structures||[],n=r.length,a=Kt({structure:e})?.positionAssignments,s=kS(t),o=a?.length??0,{seedGroups:l}=i0({roundRobinGroupsCount:n,drawSize:o}),u=r.map(c=>Kt({structure:c}).positionAssignments?.map(d=>d.drawPosition));return k8({drawPositionBlocks:u,positioning:s,seedGroups:l,nonRandom:i})}function k8({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=Bwe({size:i.length,positioning:e}),s=[];return i.forEach((o,l)=>{let u=$we({blockPattern:a,index:l});o.forEach((c,d)=>{let p=l%2?t.length-d-1:d,f=t[p].slice().filter((m,g)=>u.includes(g+1)&&m);e!==Np?f=r?f:Rn(f):l%2&&f.reverse();let h=f.find(m=>!s.includes(m));h&&(s.push(h),n.push({drawPositions:[h],seedNumbers:[c]}))})}),{validSeedBlocks:n}}function qwe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:s}=t,o,l=[],{seedBlocks:u}=t0({cluster:[ER,RR].includes(kS(n)),participantsCount:s,roundRobinGroupsCount:i});o=0;for(let c of u){if(o+1>a)break;let d=c.map(f=>f+e),p=Ywe(o+1,c.length).map(f=>+f+r);o+=c.length,l.push({drawPositions:d,seedNumbers:p})}return{blocks:l}}function Ywe(t,e){return Array.from(new Array(e),(i,r)=>r+t)}function SP({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){let{structure:s}=et({drawDefinition:e,structureId:n});t??=Rt({drawDefinition:e}).appliedPolicies;let o=i?.validSeedBlocks;return!o&&s&&(o=Rm({appliedPolicies:t,drawDefinition:e,structure:s})?.validSeedBlocks),t?.seeding?.validSeedPositions?.ignore?!0:t?.seeding?.validSeedPositions?.strict?(o.find(l=>l.seedNumbers.includes(a))?.drawPositions||[]).includes(r):o.flatMap(l=>l.drawPositions).includes(r)}function O8(t){let{provisionalPositioning:e,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:s}=t,{structure:o}=et({drawDefinition:i,structureId:a}),{seedAssignments:l}=ms({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:o}),{positionAssignments:u}=cr({structure:o}),c=u?.filter(R=>R.participantId??R.bye??R.qualifier)?.map(R=>R.drawPosition).filter(Boolean),{appliedPolicies:d}=Rt({drawDefinition:i}),p=(n?.validSeedBlocks||o&&Rm({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:r,structure:o})?.validSeedBlocks||[]).find(R=>R.drawPositions.filter(C=>!c?.includes(C)).length),f=l?.map(R=>R.participantId).filter(Boolean),h=u?.map(R=>R.participantId).filter(Boolean),m=f?.filter(R=>h?.includes(R)),g=f?.filter(R=>!h?.includes(R)),I=l?.filter(R=>g?.includes(R.participantId)),v=l?.filter(R=>!R.participantId),w=(I?.length&&I.length>0?I.length:v?.length??0)&&p?.drawPositions.filter(R=>!c?.includes(R))||[],y=s?Rn(w):w,b=[],S=y.map(()=>{let R=E(I,b)?.participantId;return R&&b.push(R),R}).filter(Boolean),U=l?.filter(R=>m?.includes(R.participantId)).map(R=>R.seedNumber),T=(p?.seedNumbers||[]).filter(R=>!U?.includes(R)),D=l?.filter(R=>T.includes(R.seedNumber)).map(R=>R.participantId),P=d?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:typeof P!="boolean"||P?S:D,unplacedSeedNumbers:T,unfilledPositions:y,unplacedSeedAssignments:I};function E(R,C){let M=R.filter(O=>!C.includes(O.participantId)),N=Math.min(...M.map(O=>gI(O.seedValue))),A=M.filter(O=>gI(O.seedValue)===N);return Rn(A).pop()}}function kS(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function Uv({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:s,seedNumber:o,seedValue:l,eventId:u,event:c}){let d="assignSeed",{structure:p}=et({drawDefinition:i,structureId:s}),{positionAssignments:f}=cr({structure:p}),h=ms({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,m=h.map(b=>b.seedNumber),g=dh({drawDefinition:i,participantId:n});if(n&&!g)return z({result:{error:No},context:{participantId:n},stack:d});let I=c?Bi({event:c}).flightProfile?.flights?.length:0,v=I&&I>1,w=f?.find(b=>b.participantId===n)?.drawPosition;if(w&&!SP({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:s,seedNumber:o}))return z({result:{error:l1},context:{assignedDrawPosition:w},info:"invalid seed position",stack:d});m.includes(o)||h.push({seedNumber:o,seedValue:l});let y;return h.forEach(b=>{b.participantId===n&&b.seedNumber!==o&&(b.participantId=void 0),b.seedNumber===o&&(b.participantId=n,!r?.groupSeedingThreshold&&!v&&(b.seedValue=l??o),y=!0)}),y?(g7({tournamentId:e?.tournamentId,drawDefinition:i,structure:p,eventId:u}),{...H}):z({result:{error:g4},stack:d})}function n0({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:s}){let o=t?.sides?.[e]?.sideNumber,l=o&&a.sides?.find(p=>p.sideNumber===o),{extension:u}=it({element:n,name:Ic}),c=u?.value||{},d=Oe(c[i],!1,!0);if(l)a?.sides?.forEach(p=>{p.sideNumber===o&&(p.lineUp=d)});else{a.sides=[1,2].map(f=>({...a.sides?.find(h=>h.sideNumber===f)??{},sideNumber:f}));let p=a.sides.find(f=>f.sideNumber===o);p&&(p.lineUp=d)}Tt({tournamentId:r?.tournamentId,context:"updateSidLineUp",eventId:s?.eventId,drawDefinition:n,matchUp:a})}function x8(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,s=i.roundNumber>1&&i.roundNumber-1,o=Sd({structureId:r.structureId,matchUpsMap:n});Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:"brightcyan",keyColors:{structureId:"brightyellow",sourceMatchUpId:"brightmagenta"},structureId:r.structureId?.slice(0,8),targetMatchUpId:i.matchUpId,targetRound:[i.roundNumber,i.roundPosition],previousRoundNumber:s,sourceMatchUpId:e?.matchUpId,sourceStructureId:e?.structureId?.slice(0,8),sourceRound:e?[e.roundNumber,e.roundPosition]:void 0,drawPosition:a,structureMatchUpCount:o?.length}),e&&e.structureId!==r.structureId&&a?(Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"cross_structure_sourceMatchUp_resolving_in_target",originalSourceId:e?.matchUpId,originalSourceStructure:e?.structureId?.slice(0,8),targetStructure:r.structureId?.slice(0,8)}),e=o.find(({drawPositions:h,roundNumber:m})=>m===s&&h?.includes(a)),Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"resolved_cross_structure_sourceMatchUp",resolvedMatchUpId:e?.matchUpId,resolvedRound:e?[e.roundNumber,e.roundPosition]:void 0,resolvedStatus:e?.matchUpStatus})):!e&&a&&(e=o.find(({drawPositions:h,roundNumber:m})=>m===s&&h?.includes(a)),Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"resolved_sourceMatchUp_from_drawPosition",resolvedMatchUpId:e?.matchUpId,resolvedRound:e?[e.roundNumber,e.roundPosition]:void 0,resolvedStatus:e?.matchUpStatus}));let l=e?.roundPosition,u=l%2?1:-1,c=l+u,d=s&&o.find(({roundNumber:h,roundPosition:m})=>h===s&&m===c),p=d?.matchUpStatus,f=[Si,Wi].includes(p);return Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:f?"brightred":"brightgreen",keyColors:{pairedMatchUpId:"brightcyan",isDoubleExit:f?"brightred":"brightgreen"},sourceRoundPosition:l,offset:u,pairedRoundPosition:c,pairedMatchUpId:d?.matchUpId,pairedRound:d?[d.roundNumber,d.roundPosition]:void 0,pairedStatus:p,isDoubleExit:f}),{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:f}}function Kwe({drawPosition:t,drawPositions:e}){let i=!1,r=!!e?.includes(t);return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(ar).filter(Boolean),positionAdded:i,positionAssigned:r}}function F8({structureId:t,matchUpsMap:e,matchUp:i}){let r=i?.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:Sd({matchUpsMap:e,structureId:t}).find(({roundNumber:s,roundPosition:o})=>s===i?.roundNumber&&o===a)}}function L8({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(o=>o.matchUpId===i),{pairedPreviousMatchUp:s}=F8({structureId:a?.structureId,matchUp:a,matchUpsMap:r});if(a&&s){let o=s?.matchUpId,l=t.find(c=>c.matchUpId===o),u=a?.structureId===l?.structureId?a?.roundPosition<l?.roundPosition&&1||2:a.structureId===l?.structureId&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(c=>{let d=ni(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function yD({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,s)=>a.drawPositions?.includes(e)?s+1:n,void 0)}function ph({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:s,matchUpsMap:o,matchUpId:l,event:u}){let c="assignMatchUpDrawPosition";o||(o=Or({drawDefinition:n})),t||(t=rr({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[]);let d=t.find(C=>C.matchUpId===l),p=d?.structureId,f=n?.structures?.find(C=>C.structureId===p);if(!f)return{error:vi};let h=o?.drawMatchUps?.find(C=>C.matchUpId===l),m=h?.drawPositions??[],{positionAdded:g,positionAssigned:I,updatedDrawPositions:v}=Kwe({drawPositions:m,drawPosition:s}),{positionAssignments:w}=Kt({drawDefinition:n,structure:f}),y=w?.filter(C=>v.includes(C.drawPosition))?.find(({bye:C})=>C),b=h?.matchUpStatus&&$r(h.matchUpStatus)&&v.filter(Boolean).length<2;a=y&&"BYE"||a||b&&h.matchUpStatus||h?.matchUpStatus&&[Si,Wi].includes(h.matchUpStatus)&&h.matchUpStatus||Li;let S=!!($r(h?.matchUpStatus)&&h?.winningSide);if(h&&g){t=rr({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[];let C=b&&yD({inContextDrawMatchUps:t,drawPosition:s,matchUpId:l})||S&&h.winningSide||void 0;h?.matchUpStatusCodes&&L8({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:o,matchUp:h}),Object.assign(h,{drawPositions:v,winningSide:C,matchUpStatus:S?h?.matchUpStatus:a}),Tt({tournamentId:i?.tournamentId,eventId:d?.eventId,context:c,drawDefinition:n,matchUp:h})}let U=_n({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:T,loserMatchUp:D,loserTargetDrawPosition:P},targetLinks:{loserTargetLink:E}}=U,R=Sd({structureId:f.structureId,matchUpsMap:o});if(I&&y){if(T)if(["BYE",Si,Wi].includes(a)){let C=ph({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(C.error)return C}else{let{structureId:C}=T;C!==f.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(I&&S){if(T){let C=ph({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(C.error)return C}}else if(T&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:C}=x8({targetMatchUp:h,drawPosition:s,matchUpsMap:o,structure:f});if(C){let M=ph({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(M.error)return M}}if(h?.matchUpType===ei){let C=t?.find(({matchUpId:A})=>A===h.matchUpId),M=(C?.sides??[]).reduce((A,O,k)=>O.drawPosition===s?k:A,void 0),N=w?.find(A=>A.drawPosition===s)?.participantId;N&&M!==void 0&&n0({inContextTargetMatchUp:C,drawPositionSideIndex:M,teamParticipantId:N,tournamentRecord:i,drawDefinition:n,matchUp:h})}if(E?.linkCondition===fl&&v.filter(Boolean).length===2&&!y&&R.filter(({drawPositions:C,roundNumber:M})=>M===1&&Ln(C,v)).every(({matchUpStatus:C})=>[Oi,jr].includes(C))&&D){let{structureId:C}=D,M=Za({drawPosition:P,tournamentRecord:i,drawDefinition:n,structureId:C,matchUpsMap:o,event:u});if(M.error)return M}return I?{...H}:z({result:{error:iI},context:{drawPosition:s},stack:c})}function _8({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){let a=gv({drawDefinition:e})?.containedStructures?.[n.structureId]?.map(({structureId:c})=>c)||[];a.push(n?.structureId);let s=i?.map(({drawPosition:c})=>c)||[],o=t?.filter(c=>a.includes(c.structureId)&&Fi(c.drawPositions??[],s).length)??[],l=o.map(({matchUpId:c})=>c),u=r?.drawMatchUps?.filter(c=>l.includes(c.matchUpId))??[];return{drawPositions:s,matchUps:u,targetMatchUps:o}}function a0({lineUp:t}){if(!Array.isArray(t))return;let e={};return ot(t.flatMap(({collectionAssignments:i})=>i?.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:s}=yP({collectionPosition:a,collectionId:r,lineUp:t});s.forEach(o=>{e[o]||(e[o]=[]),e[o].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function _p(t){return`${t} must be an array`}function cC({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(_p("lineUp")),{valid:!1,errors:i,error:ie};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:s,collectionAssignments:o}=a;return s?typeof s!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(o)?o.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(_p("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=ot(t.map(bt)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?ie:void 0}}function Cm({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:_e};if(typeof e!="string")return{error:ur};let n=cC({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=it({element:t,name:Ic}),s=a?.value||{};return s[e]=a0({lineUp:r}),gt({element:t,extension:{name:Ic,value:s}}),cS({drawDefinition:t}),{...H}}function s0({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:s,event:o}){if(!r)return{error:_e};let{drawPositions:l,matchUps:u,targetMatchUps:c}=_8({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:s});for(let d of c)d.matchUpType===Va&&(d.sides??[]).forEach((p,f)=>{if(p?.drawPosition&&l?.includes(p.drawPosition)){let h=u.find(({matchUpId:m})=>m===d.matchUpId);if(h?.sides?.[f]){if(delete h.sides[f].lineUp,e===!1){let m=d.tieFormat,g=p.participantId;m&&g&&Cm({drawDefinition:r,participantId:g,lineUp:[],tieFormat:m})}Tt({tournamentId:i?.tournamentId,context:"resetLineUps",eventId:o?.eventId,drawDefinition:r,matchUp:h})}}});return{...H}}function ml({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:o,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){let f="assignDrawPosition";if(!o&&!i)return z({result:{error:ur},stack:f});c=c??Or({drawDefinition:a}),e||({matchUps:e}=rr({inContext:!0,drawDefinition:a,matchUpsMap:c}));let h=et({drawDefinition:a,structureId:d});if(h.error)return z({result:h,stack:f});let{structure:m}=h;if(!m)return{error:vi};if(Wn({structure:m}))return z({result:{error:la},stack:f});let{seedAssignments:g}=ms({provisionalPositioning:t,drawDefinition:a,structure:m}),I=g?.find(D=>D.participantId===o)?.seedNumber,{appliedPolicies:v}=Rt({tournamentRecord:n,drawDefinition:a,structure:m,event:p});if(I&&!SP({seedNumber:I,appliedPolicies:v,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return z({result:{error:l1},context:{drawPosition:u},stack:f});let w=cr({structure:m}).positionAssignments||[],y=w?.find(D=>D.drawPosition===u);if(!y)return z({result:{error:lm},context:{drawPosition:u},stack:f});if(w?.map(bt).includes(o))return z({result:{error:lv},context:{drawPosition:u},stack:f});let{containsParticipant:b,containsBye:S}=jL(y);if(S){let D=ES({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(D.error)return z({result:D,stack:f})}if(b&&y.participantId!==o){let{activeDrawPositions:D}=yv({drawDefinition:a,structureId:d});if(D.includes(u))return z({result:{error:Hw},stack:f});s0({assignments:[y],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:m})}if(y.participantId=o,i&&(y.qualifier=!0),m.stage===Fe&&(!m.stageSequence||m.stageSequence>1)||m.stage&&[en,Ai].includes(m.stage)){let D=m.stage===We?We:Fe,P=(a.structures?.find(E=>E?.stage===D&&E?.stageSequence===1)?.seedAssignments??[]).find(E=>E.participantId===o);if(P?.participantId){let{participantId:E,seedNumber:R,seedValue:C}=P;Uv({eventId:p?.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:E,seedNumber:R,seedValue:C,structureId:d,event:p})}}if(m.structureType===hn){e8({positionAssignments:w,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:m});let{drawPositions:D,matchUps:P,targetMatchUps:E}=_8({assignments:[y],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:m});if(D&&P?.length===1&&P[0].matchUpType===ei){let R=(E?.[0].sides??[]).reduce((C,M,N)=>D?.includes(M.drawPosition)?N:C,void 0);n0({inContextTargetMatchUp:E[0],teamParticipantId:o,matchUp:P[0],drawPositionSideIndex:R,tournamentRecord:n,drawDefinition:a})}}else Xwe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:m,event:p});let U=a.entries?.find(D=>D.participantId===o),T=p?.entries?.find(D=>D.participantId===o);return!U&&T&&qL({entryStatus:T.entryStatus,entryStage:m.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:o,event:p}),bc({tournamentId:n?.tournamentId,drawDefinition:a,structure:m,event:p}),{positionAssignments:w,...H}}function Xwe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=kt({provisionalPositioning:t,matchUpFilters:u,drawDefinition:n,matchUpsMap:s,structure:o,event:l}),{roundMatchUps:d}=wn({matchUps:c}),{initialRoundNumber:p}=$h({drawPosition:a,matchUps:c}),f=p&&d?.[p].find(h=>h.drawPositions?.includes(a));if(f){let h=ph({matchUpId:f.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s});if(h.error)return z({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:h})}return{...H}}function o0(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:_e};let d=Rt({tournamentRecord:n,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:f}=t;f||(f=Or({drawDefinition:a}),Object.assign(t,{matchUpsMap:f})),p||({matchUps:p}=rr({inContext:!0,drawDefinition:a,matchUpsMap:f}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:h}=Kt({drawDefinition:a,structureId:l}),m=h?.find(y=>y.drawPosition===o);if(m?.participantId){let y=m.participantId,b=ml({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:u});return b.success?w({appliedPolicies:d,removedParticipantId:y}):z({result:b,stack:c})}let g=ES({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:o,structureId:l,matchUpsMap:f,event:u});if(g.error)return z({result:g,stack:c});let I=g.participantId,v=ml({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:u});if(!v.success)return z({result:v,stack:c});return w({appliedPolicies:d,removedParticipantId:I});function w({appliedPolicies:y,removedParticipantId:b}){let{structure:S}=et({drawDefinition:a,structureId:l});PL({drawPositions:[o],structure:S});let U={[e]:s,name:r,drawPosition:o,structureId:l};return dS({appliedPolicies:y,drawDefinition:a,positionAction:U}),z({context:{removedParticipantId:b},result:{...H},stack:c})}}function Jwe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return o0({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function $8(t){return Jwe(t)}function B8({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let s of i.matchUps)e[s.matchUpId]&&(s.roundNumber=e[s.matchUpId],Tt({tournamentId:r?.tournamentId,eventId:a?.eventId,drawDefinition:n,matchUp:s}))}function V8(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=Ge(t,i);if(r.error)return r;let n=et(t);if(n.error)return n;let a=n.structure;if(!Wn({structure:a}))return z({result:{error:af,message:"structure must be adHoc"}});let{roundMatchUps:s=[],roundNumbers:o}=wn({matchUps:a?.matchUps});return o?.length?{valid:!0,structure:a,roundMatchUps:s,roundNumbers:o}:{error:Ou}}function j8(t){let e=V8(t,[{targetRoundNumber:!0,roundNumber:!0,[Xn]:eye}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e,{targetRoundNumber:a,roundNumber:s}=t;if(!n?.includes(s)||!n?.includes(a))return z({result:{error:ie},info:"roundNumbers must be valid rounds"});let o=a>s,l=o?Re(s+1,a+1):Re(a,s),u={};return l.forEach(c=>(r?.[c]??[]).forEach(({matchUpId:d})=>{u[d]=c-(o?1:-1)})),r?.[s]?.forEach(({matchUpId:c})=>u[c]=a),B8({params:t,modMap:u,structure:i}),{...H}}function G8({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){if(!r)return{error:_e};if(!Array.isArray(t))return{error:ie};let a="setPositionAssignments";for(let o of t){let{structureId:l,positionAssignments:u}=o;if(!u)continue;let c=et({drawDefinition:r,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:vi};let p=Kt({structure:d}).positionAssignments?.map(({drawPosition:g})=>g),f=u?.map(({drawPosition:g})=>g);if(Fi(p,f).length!==p?.length)return z({result:{error:ie},info:"drawPositions do not match",stack:a});let h=Or({drawDefinition:r}),{matchUps:m}=rr({inContext:!0,drawDefinition:r,matchUpsMap:h});for(let g of u||[]){let{drawPosition:I,participantId:v,bye:w,qualifier:y}=g;if(w){let b=Za({tournamentRecord:i,drawDefinition:r,drawPosition:I,matchUpsMap:h,structureId:l,structure:d,event:n});if(b?.error)return b}else if(y)u.forEach(b=>{b.drawPosition===I&&(b.qualifier=!0,delete b.participantId,delete b.bye)});else if(v){let b=ml({provisionalPositioning:e,inContextDrawMatchUps:m,tournamentRecord:i,drawDefinition:r,participantId:v,drawPosition:I,matchUpsMap:h,structureId:l,event:n});if(b?.error)return b}}bc({tournamentId:i?.tournamentId,drawDefinition:r,structure:d,event:n})}let s=t.map(({structureId:o})=>o);return ii({tournamentId:i?.tournamentId,eventId:n?.eventId,drawDefinition:r,structureIds:s}),{...H}}function H8(t){let e=V8(t,[{roundNumbers:!0,[Xn]:sn,[qr]:s=>s.length===2&&s.every(Mi)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(s=>n?.includes(s)))return z({result:{error:ie,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((s,o)=>(r?.[s]??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-o]})),B8({params:t,modMap:a,structure:i}),{...H}}function W8({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return o0({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function z8({drawDefinition:t,structureId:e}){if(!t)return{error:_e};let{structure:i}=et({drawDefinition:t,structureId:e}),r=(t?.links||[]).filter(n=>n.source?.structureId===e).map(n=>n.target?.structureId);return{playoffStructures:(t?.structures||[]).filter(n=>r.includes(n.structureId)),structure:i}}function dC({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:s}){if(!a)return{error:ui};let o={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=to({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:r,stages:n,stage:s});if(l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function l0({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:s}){if(!e)return{error:ge};let o={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=dC({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:u,stage:s});if(c&&l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function yu(t){if(!t?.drawDefinition)return!1;let e=aC(t),i=e?.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r?.filter(({matchUpType:s})=>s===ei),n=n?.filter(({matchUpType:s})=>s===ei),a=a?.filter(({matchUpType:s})=>s===ei)),!!(r?.length&&!n?.length&&!a?.length)}function u0(t){let{drawDefinition:e,structureId:i}=t;if(!e)return{error:_e};let{playoffStructures:r}=z8({drawDefinition:e,structureId:i});if(!r?.length)return!1;let n=e?.entries?.filter(s=>s?.entryStatus&&co.includes(s.entryStatus))?.length??0,a=0;return(r||[]).reduce((s,o)=>!!((Kt({structure:o}).positionAssignments??[])?.filter(l=>(l.participantId&&a++,l?.bye??l?.participantId)).length&&s),!!r.length)||a===n}function XO({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i?.[n]){let s=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(o=>{let l=XO({accessors:s,significantCharacters:t,value:o});r.push(...l)});else if(i=i[n],s.length){let o=XO({accessors:s,significantCharacters:t,value:i});r.push(...o)}else a({value:i})}function a({value:s}){if(s&&["string","number"].includes(typeof s)){let o=t?s.slice(0,t):s;r.push(o)}}return r}function Qwe({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:g1};if(!Array.isArray(r))return{error:Yw};let n={};return t.forEach(a=>{let s=r.find(l=>l.participantId===a),{values:o}=q8({policyAttributes:e,idCollections:i,participants:r,participant:s});o&&o.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function q8({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:g1};if(!r)return{error:dm};let n=[];return t.forEach(a=>{let{directive:s,groupings:o,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");n.push(...XO({significantCharacters:u,value:r,accessors:c}))}else if(s){let c=a?.includeIds,d=(e?.[s]||[]).filter(p=>!c||c.includes(p));d?.length&&i?.length&&d.forEach(p=>{let f=i.find(h=>h.participantId===p);if(f?.individualParticipantIds?.includes(r.participantId)){let h=f?.participantId;n.push(h)}})}else o&&Object.keys(o).forEach(c=>{o[c].includes(r.participantId)&&n.push(c)})}),{values:ot(n)}}function VW({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let s=n[a.participantId],{values:o}=q8({participants:e,policyAttributes:i,idCollections:r,participant:s});return{...a,values:o}})}function Y8({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r?.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,s=t?t[a]||[]:[],o=!!i.some(l=>s.includes(l));return{[n]:{participantGroups:s,includesGroupsToAvoid:o}}}))}function Zwe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=Y8(t);return i.map(a=>{let s=e.filter(u=>a.includes(u)),o=n(s),l=s.filter(u=>!o.includes(u)).filter(u=>{let c=jW(u);return!r[c]?.includesGroupsToAvoid});return{unassigned:s,unpaired:o,pairedNoConflict:l}});function n(a){return a.filter(o=>!s(o));function s(o){let l=jW(o);return!a.includes(l)}}}function eSe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=Y8(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),s=a.length===n.length?a:[],o=n.filter(l=>r[l]?.includesGroupsToAvoid).length;return{unassigned:a,unpaired:s,pairedNoConflict:o?[]:a,conflictsCount:o}})}function jW(t){return Number(t%2?t+1:t-1)}function tSe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function iSe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let s=r.map(o=>a?eSe({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):Zwe({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:o,unpaired:l,pairedNoConflict:u}}else{let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length);return{unassigned:o,unpaired:l,pairedNoConflict:u}}}function K8({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function rSe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){let a=Object.assign({},...Object.keys(r).map(u=>[u,r[u].filter(c=>e.includes(c))]).filter(u=>u[1].length).map(([u,c])=>({[u]:c}))),s=Object.keys(a).reduce((u,c)=>a[c].length>u?a[c].length:u,0),o=Object.keys(a).filter(u=>a[u].length===s),l=Ia(i?o:Object.keys(a));return n=t&&a[n]?.length?n:l,{participantId:n&&a[n]?Ia(a[n]):Ia(e),groupKey:n}}function nSe({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function aSe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:s,groupKey:o}){let l=n.reduce((T,D)=>D.length>T?D.length:T,0)<=2,u=K8({positionAssignments:t,participantIds:e}),c=nSe({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=rSe({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:s,groupKey:o}),f=tSe({participantId:d,allGroups:s}),h=iSe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:f,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:c}),{unassigned:m,unpaired:g,pairedNoConflict:I}=h,v=I?.length&&I[0],w=g?.length&&g[0],y=a&&v?v:w,b=a?w:v,S=y?.length&&y||b?.length&&b,U;if(S?.length){let T=ba(S);U=ba(T)}else{let T=ba(m[0]);U=ba(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:U}}function JO({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(o=>o.drawPosition),a=e0({drawPositions:n}).uniqueMatchUpGroupings??[],s=Object.assign({},...r.map(o=>({[o.drawPosition]:o})));a.forEach(o=>{Ln(s[o[0]].values||[],s[o[1]].values||[])&&(i.push(o),r.conflict=!0)})}):e.forEach(r=>{Ln(r[0]?.values||[],r[1]?.values||[])&&(i.push(r),r.conflict=!0)}),i}function sSe(t,e){let i=t.find(r=>r.includes(e));if(i)return i.find(r=>r!==e)}function GW(t,e){return t.find(i=>i.drawPosition===e)}function oSe({moveableParticipant:t,possibleDrawPosition:e,positionedParticipants:i,drawPositionGroups:r,isRoundRobin:n,getAvoidanceConflicts:a}){let s=sSe(r,e),o=GW(i,s),l=a({isRoundRobin:n,groupedParticipants:[[t,o]]}),u=[GW(i,e),o],c=a({isRoundRobin:n,groupedParticipants:[u]});return!l.length&&!c.length}function lSe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.flatMap(a=>{let s=a.map(o=>o.drawPosition);return a.filter(o=>e.includes(o.drawPosition)).map(o=>{let l=e.filter(u=>!s?.includes(u)).filter(u=>oSe({moveableParticipant:o,possibleDrawPosition:u,positionedParticipants:t,drawPositionGroups:i,isRoundRobin:n,getAvoidanceConflicts:JO}));if(l.length)return{drawPosition:o.drawPosition,possibleDrawPositions:l}}).filter(Boolean)})}function HW(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:s,idCollections:o,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(w=>w?.length).filter(Boolean)),p=d>2,f=Oe(e,!1,!0).filter(w=>!w.qualifier),h=e.filter(w=>!w.participantId&&(!w.bye||n?.includes(w.drawPosition))).map(w=>w.drawPosition);Re(0,r).forEach(()=>{let{newGroupKey:w,selectedParticipantId:y,targetDrawPosition:b}=aSe({...t,candidatePositionAssignments:f,allGroups:l,groupKey:c});c=w,f.forEach(S=>{S.drawPosition===b&&(S.participantId=y)})});let m=VW({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=br(m,d),I=JO({groupedParticipants:g,isRoundRobin:p}),v=0;for(;v<20&&I.length;){let w=lSe({positionedParticipants:m,potentialDrawPositions:h,avoidanceConflicts:I,drawPositionGroups:a,isRoundRobin:p});if(w.length){let y=uSe({candidatePositionAssignments:f,swapOptions:w});y.error&&console.log({result:y}),m=VW({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=br(m,d),I=JO({groupedParticipants:g,isRoundRobin:p}),v++}else v=20}return f.forEach(w=>{if(w.bye&&w.participantId){let y=PO;u.push(y)}if(w.qualifier&&w.participantId){let y=PO;u.push(y)}}),{positionAssignments:f,conflicts:I.length,groupedParticipants:g,errors:u}}function uSe({candidatePositionAssignments:t,swapOptions:e}){let i=ba(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=ba(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===r),s=t.find(u=>u.drawPosition===n)??{},o={participantId:s?.participantId,qualifier:s?.qualifier,bye:s?.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,o),Object.assign(s,l),{...H}}function cSe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){if(!c)return{error:M4};let{candidatesCount:f=1,policyAttributes:h,targetDivisions:m}=c,{roundsToSeparate:g}=c,I="randomUnseededSeparation",{structure:v}=et({drawDefinition:a,structureId:u}),{matchUps:w}=kt({provisionalPositioning:t,matchUpsMap:l,structure:v,event:p});if(m&&Mo(m)&&!g){let L=rIe(m)||0,$=w.reduce((V,_)=>_.roundNumber>V?_.roundNumber:V,0);g=$<L?1:$-L+1}let{positionAssignments:y}=cr({structure:v}),b=KR({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:o}).participantsWithGroupings,S=y?.filter(L=>!L.participantId),U=y?.map(L=>L.drawPosition),T=v?.structureType===hn,D=T?{structure:v,matchUps:w,allDrawPositions:U,roundsToSeparate:g}:{matchUps:w,allDrawPositions:U,roundsToSeparate:g},{drawPositionGroups:P,drawPositionChunks:E}=T?dSe(D):pSe(D),R={groupParticipants:o.filter(L=>L.participantType===Xa).map(L=>L.participantId),teamParticipants:o.filter(L=>L.participantType===_t).map(L=>L.participantId),pairParticipants:o.filter(L=>L.participantType===ht).map(L=>L.participantId)},C=Qwe({targetParticipantIds:e,policyAttributes:h,idCollections:R,participants:o});if(C.error)return z({result:C,stack:I});let M=Object.assign({},...e.map(L=>{let $=Object.keys(C).filter(V=>(C[V]??[]).includes(L));return{[L]:$}})),N=K8({participantIds:e,positionAssignments:y});if(N.length>(S?.length||0))return{error:w1};let A,O=N.length,k=Re(0,f).map(()=>HW({initialPositionAssignments:y,participantsWithGroupings:b,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:P,policyAttributes:h,idCollections:R,allGroups:C,drawSize:d}));if(A=k.reduce((L,$)=>!L||($.conflicts||0)<(L.conflicts||0)?$:L,void 0),!A||A.conflicts){let L=Re(0,f).map(()=>HW({initialPositionAssignments:y,participantsWithGroupings:b,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:P,policyAttributes:h,idCollections:R,allGroups:C,drawSize:d}));A=k.concat(...L).filter($=>!$.errors?.length).reduce(($,V)=>!$||(V.conflicts||0)<($.conflicts||0)?V:$,void 0)}if(!A)return{error:IR};let F=(Kt({structure:v})?.positionAssignments??[]).filter(L=>L.participantId).map(L=>L.participantId),x=A.positionAssignments.filter(L=>!F.includes(L.participantId));for(let L of x)if(L.bye){let $=Za({tournamentRecord:n,drawDefinition:a,structureId:u,matchUpsMap:l,event:p,...L});if($.error)return z({result:$,stack:I})}else if(L.participantId){let $=ml({inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,event:p,...L});if($.error)return z({result:$,stack:I,context:{assignment:L}})}return{...H}}function dSe(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function pSe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),n=r.flat().sort(ar),a=Math.max(...n),s=t.filter(c=>c>a),o=n.length,l=Re(o===2?1:2,o).filter(c=>c===s1(c)),u=l.slice(0,e||l.length).reverse().map(c=>br(n,c));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:r,drawPositionChunks:u}}function fSe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){let f="positionUnseededParticipants";c||({structure:c}=et({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:h}=cr({structure:c}),{seedAssignments:m}=ms({provisionalPositioning:t,drawDefinition:a,structure:c}),g=m?.map(D=>D.participantId).filter(Boolean),{stage:I,stageSequence:v}=c,w=I===We?it({element:c,name:Al})?.extension?.value:void 0,y=ym({provisionalPositioning:t,drawDefinition:a,stageSequence:v,entryStatuses:hf,structureId:u,roundTarget:w,stage:I}),b=y.filter(D=>!g?.includes(D.participantId)).map(D=>D.participantId),S=h?.filter(D=>!D.participantId&&!D.bye&&!D.qualifier).map(D=>D.drawPosition);if(!r&&b.length>(S?.length||0))return z({result:{error:w1},context:{unseededParticipantsCount:b.length,unfilledDrawPositionsCount:S?.length},stack:f});let{appliedPolicies:U}=Rt({tournamentRecord:n,drawDefinition:a,event:p}),T=U?.[uP];if(c.stage===Ai){let D=y.reduce((P,E)=>(P[E.groupingValue]||(P[E.groupingValue]=[]),P[E.groupingValue].push(E.participantId),P),{});Object.keys(D).length&&(T||(T={policyName:"Playoff Avoidance"}),T.policyAttributes||(T.policyAttributes=[]),T.policyAttributes.push({groupings:D}))}return T&&o?cSe({provisionalPositioning:t,unseededParticipantIds:b,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:T,drawSize:d}):hSe({provisionalPositioning:t,unseededParticipantIds:b,inContextDrawMatchUps:e,unfilledDrawPositions:S,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function hSe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?Rn(r):r.reverse();for(let f of e){let h=p.pop();if(!n||h){let m=ml({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,participantId:f,drawPosition:h,matchUpsMap:l,structureId:u,event:d});if(m?.error&&console.log("!!!!!",{result:m}),m?.error)return z({result:m,stack:"randomUnseededDistribution"})}}return{...H}}function mSe(t){let e=t.structure??et(t).structure,i="positionQualifiers",r=[];if(e.stage===en)return z({result:{error:of},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:s}=gSe(t);for(let o of Object.keys(n)){let l=a?.filter(u=>s[o].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(n[o]>(l||0))return z({result:{error:b1},context:{unfilledDrawPositions:l},stack:i});Re(0,n[o]).forEach(()=>{let u=ba(l);r.push(u),a?.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...H,qualifierDrawPositions:r}}function gSe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=et({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=cr({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:s,roundQualifiersCounts:o}=wv({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(o?Object.keys(o):[]).map(m=>Ye(m)),{matchUps:u}=kt({structure:e}),{roundProfile:c}=wn({matchUps:u}),d=Object.assign({},...l.filter(m=>c?.[m]).map(m=>({[m]:c?.[m]?.drawPositions?.filter(Boolean)??[]}))),p=r?.filter(m=>m.qualifier).map(m=>m.drawPosition),f=s-(p?.length??0),h=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=r?.filter(I=>I.qualifier&&d[m]?.drawPositions?.includes(I.drawPosition)).map(I=>I.drawPosition);return{[m]:(o?.[m]??0)-(g?.length??0)}})),unplacedQualifiersCount:f,placedQualifiersCount:h,roundQualifiersCounts:o,positionAssignments:r,roundDrawPositions:d,qualifiersCount:s}}function X8({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:f}){let h=[],m=[],g=0;if(p||({structure:p}=et({drawDefinition:a,structureId:c})),c||(c=p?.structureId),r||(r=Rt({drawDefinition:a}).appliedPolicies),!n){let I=p&&Rm({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:s,structure:p});I?.error&&m.push(I.error),n=I?.validSeedBlocks}return u=u??n?.length??0,Re(0,u).forEach(()=>{if(g<(u||0)){let I=ISe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,structureId:c,matchUpsMap:d,event:f});I?.success&&(g++,h.push(...I.seedPositions??[])),I.error&&m.push({seedPositionError:I.error})}}),m.length?{error:m}:{...H,seedPositions:h}}function ISe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:s,structureId:o,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=O8({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:o}),{appliedPolicies:p}=Rt({drawDefinition:r}),{avoidance:f}=p??{};f&&s&&c?.length>2;let h=[];for(let m of c){let g=d.pop();if(!g)return{error:av};h.push(g);let I=ml({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:m,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:o,event:u});if(!I.success)return I}return{...H,seedPositions:h}}function vSe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=cr({structure:i}),{seedAssignments:n}=ms({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(s=>s.participantId).map(s=>({[s.participantId]:s})));return r?.map(s=>a[s.participantId]?{...s,seedNumber:a[s.participantId].seedNumber,seedValue:a[s.participantId].seedValue}:"").filter(Boolean)}function ySe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>bSe(a,i,r,t));let n=r.map(a=>Array.isArray(a)?Rn(a):a).flat(1/0);return K6(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function bSe(t,e,i,r){if(e-i.length>t.drawPositions.length)i.push(...t.drawPositions);else{let n=QO(br(t.drawPositions,2));wSe(n,i,r)}}function wSe(t,e,i){let r,n=i[e.length];for(;r=bD(t,n);)e.push(r),n=i[e.length]}function bD(t,e){return Array.isArray(t)&&t.length!==2?t.pop():Array.isArray(t[0])?USe(t,e):SSe(t,e)}function SSe(t,e){return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift()}function USe(t,e){let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return bD(e?n:t[Math.round(Math.random())],e)}return i<r?bD(t[1],e):bD(t[0],e)}function QO(t){let e=Math.floor(t.length/2);return t.length>2?[QO(t.slice(0,e)),QO(t.slice(e))]:t}function TSe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:s,structure:o}){a||(a=Rm({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:o}));let{isFeedIn:l,isLuckyStructure:u,isContainer:c}=a,{validSeedBlocks:d}=a;i?.seeding?.containerByesIgnoreSeeding&&(d=[]);let p=vSe({provisionalPositioning:t,drawDefinition:r,structure:o})??[],f=ot([].concat(...e.map(y=>y.drawPositions))),h=p.filter(y=>f.includes(y.drawPosition)),m=(y,b)=>gI(y.seedValue)-gI(b.seedValue),g=d.reduce((y,b)=>{let S=h.filter(U=>b.drawPositions?.includes(U.drawPosition)).sort(m);return y.concat(...S)},[]).map(y=>y.drawPosition),I=ySe({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:s}),v=WW({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,s),w=WW({orderedSeedDrawPositions:I,relevantMatchUps:e}).slice(0,s);return{strictSeedOrderByePositions:v,blockSeedOrderByePositions:w,isLuckyStructure:u,positionedSeeds:p,isContainer:c,isFeedIn:l}}function WW({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r?.sort((n,a)=>n-a)).filter(r=>r?.[0]+1===r?.[1]);return t.map(r=>i.find(n=>n?.includes(r))).filter(Boolean).map(r=>r?.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function DSe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:s,isFeedIn:o}){let l=r?.seeding?.seedingProfile,u=s.stage===We,{positionAssignments:c}=cr({structure:s}),d=c?.filter(N=>N.participantId).map(N=>N.drawPosition),p={isCollectionMatchUp:!1},{matchUps:f,roundMatchUps:h}=kt({provisionalPositioning:t,matchUpFilters:p,structure:s}),m=h?.[1]||[],g=s.structureType===hn?f:m,I=ot([].concat(...g.map(N=>N.drawPositions))),v=Math.min(...I)-1,w=d?.filter(N=>I.includes(N)),y=N=>{let A=Math.ceil(N.length/2),O=[N.slice(0,A),N.slice(A)],k=O.map(G=>[].concat(...G.flat(1/0)).length),F=Math.min(...k.flat(1/0)),x=Math.max(...k.flat(1/0)),L=k.indexOf(x),$=F!==x,V=Rn(O),[_,B]=!F||$?[O[L],O[1-L]]:[V[0],V[1]];return{greaterHalf:_,lesserHalf:B}},b=N=>{let{greaterHalf:A,lesserHalf:O}=y(N),{greaterHalf:k,lesserHalf:F}=y(A),x=Rn(k.flat(1/0)).pop(),L=k.flat().filter($=>$!==x);return{newlyFilteredChunks:[...O,...F,L],drawPosition:x}},S=N=>!e.includes(N),U=N=>!w?.includes(N),T=N=>{let A=br(N.sort(ar),Math.ceil(N.length/4)).map(F=>F.filter(U)),O=[].concat(...A.flat(1/0)).length,k=[];for(let F=0;F<O;F++){let{newlyFilteredChunks:x,drawPosition:L}=b(A);k.push(L),A=x}return k},{validSeedBlocks:D}=Rm({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:s}),P=D?.map(N=>N.drawPositions?.map(A=>A+v)),E;if(o){let N=I.length,{seedBlocks:A}=t0({cluster:[ER,RR].includes(kS(l)),participantsCount:N});E=A.map(O=>O.map(k=>k+v)).map(T).filter(O=>O.length)}else u?E=P?.map(N=>N.filter(U)):E=P?.map(T).filter(N=>N.length);let R=g.map(N=>N.drawPositions).map(N=>N?.sort((A,O)=>A-O)).filter(N=>N?.[0]+1===N?.[1]),C=N=>R.reduce((A,O)=>O.includes(N)?O.reduce((k,F)=>F!==N?F:k,void 0):A,void 0),M=E.map(N=>N.map(C)).flat(1/0).filter(U).filter(S).filter(Boolean);if(u&&!s.structures){let N=a%4,A=M.slice(0,N),O=h[s.roundLimit]?.length,k=br(M.slice(N),O).map(Rn).flat();M=A.concat(k)}return{unseededByePositions:M}}function PSe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){let a={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:o}=kt({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:r,event:n}),l=o?.[1]||[],u=r?.structureType===hn,c=u?s:l,d=u?r?.structures?.length||0:s.length,{structureId:p,stage:f,stageSequence:h}=r,m=ym({entryStatuses:co,provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:f}),{qualifiersCount:g}=wv({provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:f}),I=m.length+g,{positionAssignments:v,unassignedPositions:w}=cr({structure:r}),y=w?.map(P=>P.drawPosition),b=v?.filter(P=>P.bye).length,S=v?.filter(P=>P.bye).map(P=>P.drawPosition),U=c.map(P=>P.drawPositions).filter(P=>P?.reduce((E,R)=>!S?.includes(R)&&E,!0)).flat(1/0).filter(P=>y?.includes(P)),T=v?.length,D=T?T-I:0;return D>d&&r.stageSequence===1&&r.stage!==en&&(D=d),{placedByes:b,byesCount:D,relevantMatchUps:c,placedByePositions:S,roundMatchUps:o,positionsToAvoidDoubleBye:U}}function J8({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:s,structureId:o,structure:l,seedLimit:u,seedsOnly:c,event:d}){l||({structure:l}=et({drawDefinition:r,structureId:o})),o||(o=l?.structureId);let p=!(l?.structures??l?.stage===We),{byesCount:f,placedByes:h,relevantMatchUps:m}=PSe({provisionalPositioning:t,drawDefinition:r,matchUpsMap:s,structure:l,event:d}),g=f-(h||0);if(g<=0)return{...H};let{strictSeedOrderByePositions:I,blockSeedOrderByePositions:v,isLuckyStructure:w,isFeedIn:y}=TSe({provisionalPositioning:t,relevantMatchUps:m,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:l}),b=l?.structureType&&[hn,CR].includes(l.structureType)&&i?.seeding?.containerByesIgnoreSeeding,S=p&&v?.length?v:I,{unseededByePositions:U}=DSe({provisionalPositioning:t,seedOrderByePositions:S,isLuckyStructure:w,appliedPolicies:i,drawDefinition:r,seedLimit:u,structure:l,isFeedIn:y}),T=R=>R%2,D=(R,C)=>(R||[]).every(M=>T(M)?C!==M+1:C!==M-1),P=[].concat(...S);if(!c)for(;U.length;){let R=U.find(C=>D(P,C));R?(P.push(R),U=U.filter(C=>C!==R)):(P.push(...U),U=[])}b&&(P=Rn(P),ua({ignoreSeededByes:b})&&console.log({byePositions:P}));let E=P.slice(0,g);for(let R of E){let C=Za({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:R,matchUpsMap:s,structureId:o,structure:l,event:d});if(C?.error)return C}return{...H,unseededByePositions:U,byeDrawPositions:E}}function Ty(t,e){return e||bR(),z({result:t,stack:"automatedPositioning"})}function ESe(t,e){return e||bR(),t}function RSe(t,e,i,r){let n=et({drawDefinition:e,structureId:i});if(n.error)return{error:n.error};let a=n.structure;if(!a)return{error:vi};let s=t.appliedPolicies||Rt({drawDefinition:e,structure:a,event:r})?.appliedPolicies,{qualifiersCount:o}=wv({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,drawDefinition:e,structureId:i}),l=hf,u=ym({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,placementGroup:t.placementGroup,drawDefinition:e,entryStatuses:l,structureId:i});return{structure:a,appliedPolicies:s,qualifiersCount:o,entries:u}}function CSe({placeByes:t,provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:u,event:c,structureSeedingProfile:d,seedingProfile:p,inContextDrawMatchUps:f,participants:h,positioningReport:m}){let g=t?J8({provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:u,event:c}):void 0;if(g?.error)return{error:g.error};let I=g?.unseededByePositions;return m.push({action:"positionByes",unseededByePositions:I}),g=X8({seedingProfile:d?{positioning:d}:p,provisionalPositioning:e,inContextDrawMatchUps:f,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:a.validSeedBlocks,drawDefinition:n,seedBlockInfo:a,participants:h,matchUpsMap:s,structure:o,event:c}),g.error?{error:g.error}:(m.push({seedPositions:g.seedPositions,action:"positionSeedBlocks"}),{unseededByePositions:I})}function MSe({drawType:t,LUCKY_DRAW:e,structureSeedingProfile:i,seedingProfile:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:u,seedBlockInfo:c,participants:d,matchUpsMap:p,structure:f,event:h,placeByes:m,seedLimit:g,seedsOnly:I,positioningReport:v}){let w;if(t!==e){let b=X8({seedingProfile:i?{positioning:i}:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:u,seedBlockInfo:c,participants:d,matchUpsMap:p,structure:f,event:h});if(b.error)return{error:b.error};v.push({action:"positionSeedBlocks",seedPositions:b.seedPositions})}let y=m?J8({provisionalPositioning:n,tournamentRecord:s,appliedPolicies:o,drawDefinition:u,seedBlockInfo:c,matchUpsMap:p,structure:f,seedLimit:g,seedsOnly:I,event:h}):void 0;return y?.error?{error:y.error}:(w=y?.unseededByePositions,v.push({action:"positionByes",byeDrawPositions:y?.byeDrawPositions,unseededByePositions:w}),{unseededByePositions:w})}function NSe({seedsOnly:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:u,positionQualifiers:c,positionUnseededParticipants:d,provisionalPositioning:p,unseededByePositions:f,multipleStructures:h,structureId:m,drawSize:g,event:I,positioningReport:v,conflicts:w}){if(t)return{};let y=c({inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:u});return y.error?{error:y.error}:(y.conflicts&&(w.qualifierConflicts=y.conflicts),v.push({action:"positionQualifiers",qualifierDrawPositions:y.qualifierDrawPositions}),y=d({provisionalPositioning:p,inContextDrawMatchUps:e,unseededByePositions:f,multipleStructures:h,tournamentRecord:i,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:m,structure:u,drawSize:g,event:I}),y.error?{error:y.error}:(y.conflicts&&(w.unseededConflicts=y.conflicts),v.push({action:"positionUnseededParticipants"}),{}))}function OS(t){let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:s,seedingProfile:o,structureId:l,seedLimit:u,seedsOnly:c,drawType:d,drawSize:p,event:f}=t,h=[];i||(DK(),e=Oe(e,!1,!0));let{structure:m,appliedPolicies:g,qualifiersCount:I,entries:v,error:w}=RSe(t,e,l,f);if(w)return Ty(w,i);if(!v?.length&&!I)return ESe({...H},i);let y=t.matchUpsMap??Or({drawDefinition:e}),b=t.inContextDrawMatchUps??rr({inContext:!0,drawDefinition:e,matchUpsMap:y})?.matchUps,S=Rm({provisionalPositioning:r,appliedPolicies:g,drawDefinition:e,seedingProfile:o,structure:m});if(S.error)return Ty(S,i);let{validSeedBlocks:U}=S;h.push({validSeedBlocks:U});let T=t.participants||(s?Pi({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:s})?.participants:[]),D;if(kS(m.seedingProfile||o)===Np){let C=CSe({placeByes:a,provisionalPositioning:r,tournamentRecord:s,appliedPolicies:g,drawDefinition:e,seedBlockInfo:S,matchUpsMap:y,structure:m,seedLimit:u,seedsOnly:c,event:f,structureSeedingProfile:m.seedingProfile,seedingProfile:o,inContextDrawMatchUps:b,participants:T,positioningReport:h});if(C?.error)return Ty(C.error,i);D=C.unseededByePositions}else{let C=MSe({drawType:d,LUCKY_DRAW:uf,structureSeedingProfile:m.seedingProfile,seedingProfile:o,provisionalPositioning:r,inContextDrawMatchUps:b,tournamentRecord:s,appliedPolicies:g,validSeedBlocks:U,drawDefinition:e,seedBlockInfo:S,participants:T,matchUpsMap:y,structure:m,event:f,placeByes:a,seedLimit:u,seedsOnly:c,positioningReport:h});if(C?.error)return Ty(C.error,i);D=C.unseededByePositions}let P={},E=NSe({seedsOnly:c,inContextDrawMatchUps:b,tournamentRecord:s,appliedPolicies:g,validSeedBlocks:U,drawDefinition:e,seedBlockInfo:S,participants:T,matchUpsMap:y,structure:m,positionQualifiers:mSe,positionUnseededParticipants:fSe,provisionalPositioning:r,unseededByePositions:D,multipleStructures:n,structureId:l,drawSize:p,event:f,positioningReport:h,conflicts:P});if(E?.error)return Ty(E.error,i);let{positionAssignments:R}=Kt({drawDefinition:e,structure:m});return ii({drawDefinition:e,structureIds:[l]}),i||bR(),{positionAssignments:R,conflicts:P,...H,positioningReport:h}}function Tv(t){let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,placeByes:o,seedsOnly:l}=t;if(!n)return{error:ja};if(!yu({drawDefinition:n,structureId:s})&&!i)return{error:o1};let u=z8({drawDefinition:n,structureId:s}).playoffStructures?.sort((p,f)=>fP(p)-fP(f)),c=[],d=[];if(u)for(let p of u){let{structureId:f}=p,h=OS({structureId:f,provisionalPositioning:i,applyPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:o,seedsOnly:l});if(h.error)return h;h.positionAssignments&&c.push({positionAssignments:h.positionAssignments,structureId:f}),h.positioningReport&&d.push(h.positioningReport)}return{...H,structurePositionAssignments:c,positioningReports:d}}function Q8({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:s}){if(!i)return{error:_e};if(!n)return{error:Ka};let o=(e?.participants??[]).find(p=>p.participantId===r);if(e&&!o)return{error:No};let{structure:l}=et({drawDefinition:i,structureId:n});if(!l)return{error:vi};if(!(!t||Mi(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Mi(p)&&Ye(p)>0)))return{error:ie};let{seedAssignments:u}=ms({drawDefinition:i,structure:l}),c=u?.map(p=>p.seedNumber),d=u?.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(f=>parseInt(f)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return g7({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:i,structure:l}),{...H}}function c0({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return o0({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function Wb({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=Iv({drawDefinition:i,structureId:r})||{},s=(a?.target||[]).filter(({linkType:o})=>o===n).filter(({target:o})=>!t||t===o.roundNumber).map(o=>{let l=o.source.structureId,{structure:u}=et({structureId:l,drawDefinition:i});if(!(e&&u?.finishingPosition!==e))return o}).filter(Boolean);return{sourceStructureIds:s.map(({source:o})=>o.structureId),relevantLinks:s}}var ASe=(t,e)=>{let i=[...new Set(e.slice(0,t.length))],r=[...i].sort((o,l)=>o-l),n=new Set,a=[];i.forEach(o=>{let l=t.indexOf(o);if(l!==-1&&!n.has(l))a.push(l),n.add(l);else{let u=r.indexOf(o),c=t.findIndex((d,p)=>!n.has(p));for(;n.has(c)&&c===-1&&n.size<t.length;)c=t.findIndex((d,p)=>!n.has(p)&&p>c);a.push(u),n.add(u)}});let s=t.filter((o,l)=>!n.has(l));return[...a,...s]};function Z8({targetRoundNumber:t=1,tournamentRecord:e,drawDefinition:i,event:r,randomList:n}){let a=Ge({drawDefinition:i,event:r,tournamentRecord:e},[{[mn]:!0,[$c]:!0,[mr]:!0}]);if(a.error)return a;let s=[],o=[],l=i.structures?.find(g=>g.stage===Fe&&g.stageSequence===1);if(!l)return z({result:{error:f1}});let u=(Rt({tournamentRecord:e,drawDefinition:i,structure:l,event:r}).appliedPolicies??{})[Op]?.requireCompletedStructures,{qualifierPositions:c,positionAssignments:d}=cr({structure:l});if(!c.length)return z({result:{error:b1}});let p=Re(0,c.length);n&&(p=ASe(p,n));let f=d.map(g=>g.participantId).filter(Boolean),{relevantLinks:h}=Wb({structureId:l.structureId,targetRoundNumber:t,linkType:fu,drawDefinition:i})||{},{relevantLinks:m}=Wb({structureId:l.structureId,targetRoundNumber:t,linkType:pu,drawDefinition:i})||{};for(let g of h){let I=i.structures?.find(w=>w.structureId===g.source.structureId);if(I?.stage!==We)continue;let v=yu({structureId:g.source.structureId,drawDefinition:i});if(!u||v){let w=I.qualifyingRoundNumber,{matchUps:y}=kt({matchUpFilters:{...w&&{roundNumbers:[w]},isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,inContext:!0,structure:I});for(let b of y){let S=b.matchUpStatus==="BYE"&&b.sides?.find(({participantId:T})=>T),U=b.sides.find(T=>T?.sideNumber===b.winningSide);if(U||S){let{participantId:T}=U||S||{};T&&!f.includes(T)&&o.push(T)}}}}for(let g of m){let I=i?.structures?.find(v=>v.structureId===g.source.structureId);if(I?.stage===We&&yu({structureId:g.source.structureId,drawDefinition:i})){let{positionAssignments:v}=Kt({structure:I}),w=v?.map(y=>{let b=y.participantId,S=it({element:y,name:yc}).extension?.value;return S?{participantId:b,groupOrder:S?.groupOrder}:{}}).filter(({groupOrder:y,participantId:b})=>y===1&&!f.includes(b)).map(({participantId:y})=>y)??[];w&&o.push(...w)}}return o.length?(p.forEach((g,I)=>{let v=o[I],w=c[g].drawPosition;v&&c0({qualifyingParticipantId:v,structureId:l.structureId,drawPosition:w,tournamentRecord:e,drawDefinition:i})?.success&&s.push({participantId:v,drawPosition:w})}),z({result:Ve({...H,assignedParticipants:s})})):z({result:{error:G4}})}function e9({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>ut(i)))&&z({result:{error:ie},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>eI(i.structureOrder)-eI(r.structureOrder)),{...H}):{error:_e}}function pC({drawDefinition:t}){let e=t.structures??[],i=t.links??[],r=new Map,n=g=>{let I=r.get(g)||r.set(g,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(g);if(I&&!I?.stage){let v=e.find(w=>w.structureId===g);I.stage=v?.stage}return I},a={},s={},o=i.map(g=>{let I=g.source.structureId,v=g.target.structureId,w=n(I),y=n(v);return[Ap,Os,MR,Np].includes(g.target.feedProfile)?(w?.targets.push(v),y?.sources.push(I)):g.target.feedProfile===ks&&(y?.drawSources.push(I),w?.drawTargets.push(v)),s[v]=s[v]||g.target.feedProfile===ks,a[v]=ot([...a[v]||[],I]).filter(Boolean),[g.source.structureId,g.target.structureId]});for(let g of r.keys()){let I=r.get(g);if(I){let v=I.targets??[];for(;v.length;){let w=v.pop(),y=w&&r[w];y?.targets?.length?v.push(...y.targets):y&&(I.rootStage=y.stage)}if(I.rootStage||(I.rootStage=I.stage),!I.targets?.length){let w=I.sources??[];for(;w.length;){let y=w.pop(),b=y&&r[y];if(b?.sources?.length){for(let S of b.sources)I.progeny?.includes(S)||I.progeny?.push(S);w.push(...b.sources)}}}}}let l=0;for(let g of r.keys()){let I=r.get(g);if(I&&I.rootStage===We){let v=[I.drawTargets?.[0]],w=0;for(;v.length;){w+=1;let y=v.pop(),b=y?r.get(y):void 0;b?.drawTargets?.length&&v.push(b.drawTargets[0])}I.distanceFromMain=w,w>l&&(l=w)}}let u=o.length;Re(0,Math.ceil(u/2)).forEach(()=>{o=Re(0,u).map(g=>{let I=o[g],v=o.reduce((w,y)=>Ln(I,y)?w.concat(...y):w,[])||[];return ot(I.concat(...v))})});let c=o[0],d=(g,I)=>Fi(g,I).length===g.length,p=o.slice(1).reduce((g,I)=>g&&d(I,c),!0),f=[c].filter(Boolean),h=[c].filter(Boolean);e.forEach(g=>{let{structureId:I,stage:v}=g;f.find(w=>w.includes(I))||(f.push([I]),v!==Rr&&h.push([I]))});let m=p&&h.length===1;return!i?.length&&e.length===1&&n(e[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:m,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:s,structureGroups:f}}function t9({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=pC({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...H}}function d0(t){let e=Ge(t,[{[mr]:!0,[mn]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return kSe({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function kSe(t){let e=Ge(t,[{[mn]:!0,[LR]:!0},{link:!0,[Xn]:Qn,[i4]:d1}]);if(e.error)return e;let{drawDefinition:i,tournamentId:r,structure:n,eventId:a,link:s}=t,o=s.target.structureId,l=et({drawDefinition:i,structureId:o});if(l.error)return z({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(n),i.links.push(s),t9({drawDefinition:i});let u=kt({structure:n})?.matchUps||[];return wd({drawDefinition:i,tournamentId:r,matchUps:u,eventId:a}),ii({drawDefinition:i,structureIds:[n.structureId]}),{...H}}function i9({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:ie};if(!t)return{error:_e};let i=Object.assign({},...e.map(r=>{if(!St(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Xe};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let s=i[a.structureId];s&&(a.structureName=s)}}return{...H}}function p0({drawDefinition:t,timeItem:e}){if(!t)return{error:ja};if(!e)return{error:D1};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:T1};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),cS({drawDefinition:t}),{...H}}function r9(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,event:n}=t,a=Ge(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let s=i.structures??[],o=s.find(I=>I.structureId===r);if(!o)return{error:vi};let l=s.find(({stage:I,stageSequence:v})=>I===Fe&&v===1),u=r===l?.structureId,c=s.filter(({stage:I})=>I===We).map(Pa("structureId"));if(u&&!c.length)return{error:n4};let d=c.includes(r),p=OSe({isQualifyingStructure:d,structure:o,...t});if(p?.error)return p;let{structureIdsToRemove:f,relatedStructureIdsMap:h}=FSe({qualifyingStructureIds:c,isQualifyingStructure:d,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureId:r}),{removedMatchUpIds:m,removedStructureIds:g}=LSe({relatedStructureIdsMap:h,qualifyingStructureIds:c,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:f,structureId:r});if(xSe({removedMatchUpIds:m,drawDefinition:i}),u){let I=(l.matchUps??[])?.map(Pa("matchUpId"));m.push(...I),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&t9({drawDefinition:i}),Fu({tournamentId:e?.tournamentId,matchUpIds:m,action:"removeStructure",eventId:n?.eventId,drawDefinition:i}),ii({drawDefinition:i,eventId:n?.eventId}),{...H,removedMatchUpIds:m,removedStructureIds:g}}function OSe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:s}){let o=[r];if(t){let l=c=>i.links?.find(d=>d.target.structureId===c),u=l(r)?.source.structureId;for(;u;)o.push(u),u=l(u)?.source.structureId}if(rr({matchUpFilters:{structureIds:o},drawDefinition:i}).matchUps?.some(({score:l})=>dr({score:l}))){let l=Rt({tournamentRecord:e,drawDefinition:i,structure:n,event:a})?.appliedPolicies;if(!(s??l?.[ko]?.allowDeletionWithScoresPresent?.structures))return{error:Kw}}return{...H}}function xSe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=rr({drawDefinition:e});i?.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function FSe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let s=(n.structures??[]).map(Pa("structureId")),o=c=>n.links?.map(d=>d.source.structureId===c&&d.target.structureId!==r?.structureId&&d.target.structureId).filter(Boolean)??[],l=c=>n.links?.map(d=>t.includes(d.source.structureId)&&d.target.structureId===c&&d.source.structureId).filter(Boolean)??[],u=new Map;return s.forEach(c=>u.set(c,e?l(c):o(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function LSe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:s}){let o=[],l=[];for(;a?.length;){let u=a.pop();l.push(...BSe({idBeingRemoved:u,drawDefinition:n}));let c=$Se({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:n,structureId:s});o.push(...c.removedStructureIds);let d=_Se({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:u,structureId:s});d?.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:o}}function _Se({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){return t&&e.get(t)?.filter(n=>n!==i?.structureId||r===i.structureId)}function $Se({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){let a=[];return r.links=r.links?.filter(s=>s.source.structureId!==i&&s.target.structureId!==i)??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function BSe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=et({structureId:t,drawDefinition:e}),r=kt({structure:i}).matchUps;return uL(r)}function UP({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:_e};if(!AL({drawDefinition:e,stage:r}))return{error:of};let n=Bye({drawDefinition:e,stage:r}),{qualifiersCount:a}=wv({drawDefinition:e,stageSequence:t,stage:r}),s=n+a;if(i<s)return{error:u4};let{entryProfile:o}=NL({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return ii({drawDefinition:e}),{...H,entryProfile:o}}function n9({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?AL({drawDefinition:e,stage:i})?(NL({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),ii({drawDefinition:e}),{...H}):{error:of}:{error:_e}}function VSe({drawDefinition:t,drawSize:e}){if(!t)return{error:_e};let i=UP({stage:Rr,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(ii({drawDefinition:t}),{...H})}function a9(t){return VSe(t)}function s9({tournamentRecord:t,drawDefinition:e,event:i,structureId:r}){if(!e)return{error:_e};let n=e.structures?.find(s=>s.stage===We&&s.structureId===r);if(!n)return{error:vi};if(n.matchUps?.some(({matchUpStatus:s,score:o})=>dr({score:o})??Ji.includes(s)))return{error:Kw};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],Fu({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),ii({tournamentId:t?.tournamentId,eventId:i?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...H}}var jSe="qualifierDrawPositionAssignment",GSe="withdrawParticipantAtDrawPosition",HSe="alternateDrawPositionAssignment",WSe="luckyLoserDrawPositionAssignment",zW="removeDrawPositionAssignment",o9="swapDrawPositionAssignments",zSe="modifyPairAssignment",qSe="adHocPositionSwap",YSe="modifyParticipantOtherName",qW="assignDrawPosition",KSe="removeSeededParticipant",XSe="assignDrawPositionBye",JSe="modifySeedAssignment",l9="addPenalty",f0="MODIFY_PAIR",fC="QUALIFIER",h0="ALTERNATE",m0="WITHDRAW",Vh="ASSIGN",ZO="REMOVE",g0="LUCKY",wD="REMOVE_SEED",hC="SWAP",TP="NICKNAME",tb="SEED_VALUE",II="PENALTY",QSe={MODIFY_PAIR_ASSIGNMENT:f0,QUALIFYING_PARTICIPANT:fC,ALTERNATE_PARTICIPANT:h0,WITHDRAW_PARTICIPANT:m0,ASSIGN_PARTICIPANT:Vh,LUCKY_PARTICIPANT:g0,REMOVE_ASSIGNMENT:ZO,SWAP_PARTICIPANTS:hC,ADD_NICKNAME:TP,REMOVE_SEED:wD,ADD_PENALTY:II,ASSIGN_BYE:"BYE",SEED_VALUE:tb};function u9({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:_e};if(!r)return{error:Ka};if(i?.length!==2)return{error:ie,drawPositions:i};let a=Or({drawDefinition:e}),{matchUps:s}=rr({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:o}=et({drawDefinition:e,structureId:r});if(!o)return{error:vi};let l=Rt({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},u;if(o.structureType===hn?u=tUe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}):u=ZSe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}),u.error)return u;if(PL({structure:o,drawPositions:i}),dS({appliedPolicies:l,drawDefinition:e,positionAction:{name:o9,drawPositions:i,structureId:r}}),bc({tournamentId:t?.tournamentId,drawDefinition:e,structure:o,event:n}),n.eventType===Da){let c=kt({matchUpFilters:{matchUpTypes:[Va]},inContext:!0,structure:o}).matchUps.filter(p=>p.drawPositions?.some(f=>i.includes(f))),d=kt({matchUpFilters:{matchUpTypes:[Va]},structure:o}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(f=>{let h=f?.drawPosition;if(i.includes(h)){let m=f.participantId,g=d.find(({matchUpId:v})=>v===p.matchUpId),I=p?.sides?.reduce((v,w,y)=>w.drawPosition===h?y:v,void 0);n0({inContextTargetMatchUp:p,drawPositionSideIndex:I,teamParticipantId:m,tournamentRecord:t,drawDefinition:e,matchUp:g,event:n})}})})}return ii({drawDefinition:e,structureIds:[r]}),{...H}}function ZSe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a?.positionAssignments.filter(u=>r?.includes(u.drawPosition));if(!o)return{error:ie,structure:a,info:"Missing positionAssignments"};if(o.filter(({bye:u})=>u).length===2)return{...H};if(o.filter(({qualifier:u})=>u).length===2)return{...H};let l=o.some(({qualifier:u})=>u);return o.some(({bye:u})=>u)&&!l?c9({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s}):eUe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s})}function c9({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=r.find(({bye:h})=>h),l=r.find(({participantId:h})=>h),u=o.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,f=Hb({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return f.error||(f=Hb({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),f.error)||(Za({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:s}),f=ml({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:n,event:s}),f.error)?f:{...H}}function eUe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=Object.assign({},...r.map((l,u)=>{let{drawPosition:c}=l,d={...r[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>o[l.drawPosition]||l),s0({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:s}),{...H}}function tUe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a.structures?.reduce((u,c)=>{let d=c?.positionAssignments.filter(p=>r?.includes(p.drawPosition));return d&&u.push(...d),u},[]);if(o.filter(({bye:u})=>u).length===2)return{...H};if(o.filter(({qualifier:u})=>u).length===2)return{...H};s0({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:o,structure:a,event:s});let l=o.some(({qualifier:u})=>u);if(o.some(({bye:u})=>u)&&!l)c9({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s});else{let u=Oe(o,!1,!0);o.forEach((c,d)=>{let p=u[1-d].participantId;c.qualifier=u[1-d].qualifier,c.participantId=p})}return{...H}}function d9({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){let n="removeSeededParticipant";if(!t)return{error:ge};if(!e)return{error:_e};let a=(e.structures??[]).find(s=>s.structureId===r);return a?!a.stage||![Fe,We].includes(a.stage)||a.stage===Fe&&a.stageSequence!==1?z({result:{error:af},stack:n}):a.seedAssignments?.find(s=>s.participantId===i)?{...H}:z({info:"participant not seeded",result:{error:Vr},context:{participantId:i}}):z({result:{error:vi},stack:n})}function xS({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=fu}){return!r||!n?{error:Ka}:{link:Ve({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:ks,roundNumber:t,structureId:n}})}}function Mm({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>FS({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function FS({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:s,matchUpType:o,collectionId:l,processCodes:u}=e||{},c=i??s??0,d=p=>{if(!n&&!r?.isMock)return a?.pop()??Pt();let f=e?.collectionId;return a?.pop()??`${r?.matchUpId}-${f}-TMU-${p+1}`};return Re(0,c).map(p=>{let f=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Li,collectionPosition:f,collectionId:l,processCodes:u,matchUpType:o,isMock:n}})}function I0({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:r?.pop()||Pt()}function DP({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:s,nodes:o}){let l=0,u=[],c=1,d=i-1,p=o?.length;for(;l<(p||0);){let f=o?.[l],h=o?.[l+1];d&&(f.roundNumber=d),h&&d&&(h.roundNumber=d);let m=I0({roundPosition:c,roundNumber:i,idPrefix:n,uuids:s}),g={roundPosition:c,children:[f,h],matchUpId:m};u.push(g);let I={drawPositions:g.children.map(v=>v?.drawPosition).filter(Boolean),matchUpStatus:Li,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(I.matchUpType=e),a&&(I.isMock=!0),r.push(I),c++,l+=2}return{roundNodes:u,matchUps:r}}function gl({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:s,drawSize:o,isMock:l,uuids:u}){if(isNaN(o)||o<2||r&&o<=r)return{matchUps:[],roundsCount:0};if(r&&(!Mo(o)||o%r)){let g=r;for(;g<o;)g=2*g;o=g}let c=r&&!(o%2)&&(!isNaN(r)||i&&!isNaN(i))&&(o/r===Math.round(o/r)||i&&o/i===Math.round(o/i));if(!Mo(o)&&!c)return{matchUps:[],roundsCount:0};let d=Re(1,o+1).map(g=>({drawPosition:g})),p,f=[],h=1;for({roundNodes:p,matchUps:f}=DP({matchUpType:n,roundNumber:h,idPrefix:s,matchUps:f,isMock:l,nodes:d,uuids:u}),h++,a=a??i;p.length>1;)r&&p.length===r&&(a=h-1),{roundNodes:p,matchUps:f}=DP({nodes:p,matchUpType:n,roundNumber:h,idPrefix:s,matchUps:f,isMock:l,uuids:u}),h++;let m=h-1;return f=DS({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:f}),a?f=f.filter(g=>a&&(g.roundNumber??0)<=a):a=h-1,{drawSize:o,matchUps:f,roundsCount:m,roundLimit:a}}function iUe(t,e){return t.drawDefinition?t.drawSize&&!ut(t.drawSize)||t.participantsCount&&!ut(t.participantsCount)||t.qualifyingPositions&&!ut(t.qualifyingPositions)?z({result:{error:ie},stack:e}):t.drawSize?t.qualifyingPositions&&t.qualifyingPositions>=t.drawSize?z({result:{error:ie},context:{drawSize:t.drawSize,qualifyingPositions:t.qualifyingPositions},stack:e}):null:z({result:{error:Ww},context:{drawSize:t.drawSize},stack:e}):z({result:{error:_e},stack:e})}function rUe(t,e,i){let{structureProfiles:r}=pC({drawDefinition:t});return r[e]||z({result:{error:vi},context:{targetStructureId:e},stack:i})}function nUe(t){let{maxRoundNumber:e,structures:i,groupCount:r}=NS(t);return{qualifiersCount:r,roundLimit:e,structure:i[0],finishingPositions:[1]}}function aUe(t){let{drawSize:e,matchUps:i,roundLimit:r,roundsCount:n}=gl(t);r||(r=n);let a=ls({structureName:t.structureName,structureId:t.structureId,qualifyingRoundNumber:r,stage:We,matchUpFormat:t.matchUpFormat,stageSequence:t.stageSequence,matchUpType:t.matchUpType,roundLimit:r,matchUps:i});t.roundTarget&&gt({extension:{name:Al,value:t.roundTarget},element:a});let s=i?.filter(o=>o.roundNumber===r)?.length??0;return{drawSize:e,structure:a,matchUps:i,roundLimit:r,qualifiersCount:s}}function v0(t){let e="generateQualifyingStructure",i=iUe(t,e);if(i)return i;let r=t.drawSize??a1(t.participantsCount),{hasExistingDrawDefinition:n,qualifyingRoundNumber:a,qualifyingPositions:s,targetStructureId:o,structureOptions:l,appliedPolicies:u,qualifyingOnly:c,drawDefinition:d,matchUpFormat:p,structureName:f,structureId:h,roundTarget:m,tieFormat:g,drawType:I,idPrefix:v,isMock:w,uuids:y}=t,b=rUe(d,o,e);if(b?.error)return b;let S=d.matchUpType,U=1,T=m?`${m}-`:"",D=typeof b=="object"&&"stage"in b&&b.stage===We,P=u?.[gc]?.namingConventions?.pre??Wye[gc]?.namingConventions?.pre,E=D&&P?`${P}-`:"",R=f??(T?`${E}${Jr(We)} ${T}`:`${E}${Jr(We)}`),C,M,N,A,O;if(I===Zs){let x=nUe({structureName:f??R,structureId:h??y?.pop(),hasExistingDrawDefinition:n,stage:We,structureOptions:l,appliedPolicies:u,qualifyingOnly:c,stageSequence:U,matchUpType:S,roundTarget:m,tieFormat:g,idPrefix:v,drawSize:r,isMock:w,uuids:y});A=x.qualifiersCount,N=x.roundLimit,C=x.structure,O=x.finishingPositions}else{let x=aUe({qualifyingRoundNumber:a,qualifyingPositions:s,matchUpType:S,idPrefix:v,drawSize:r,isMock:w,uuids:y,structureName:f??R,structureId:h??y?.pop(),matchUpFormat:p,stageSequence:U,roundTarget:m});r=x.drawSize,C=x.structure,N=x.roundLimit,A=x.qualifiersCount}let k=I===Zs?pu:fu,F=C&&N&&xS({sourceStructureId:C.structureId,sourceRoundNumber:N,targetStructureId:o,finishingPositions:O,linkType:k})?.link;return g&&(M=kt({structure:C})?.matchUps||[],M?.forEach(x=>{let{tieMatchUps:L}=Mm({tieFormat:g,matchUp:x,isMock:w});Object.assign(x,{tieMatchUps:L,matchUpType:S})})),{qualifyingDrawPositionsCount:r,qualifiersCount:A,...H,structure:C,link:F}}function p9(t){if(!t.tournamentRecord)return{error:ge};let e=sUe(t);return e.error,e}function sUe(t){if(!t.drawDefinition)return{error:_e};if(!t.targetStructureId)return{error:Ka};let e=v0(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:ie}:d0({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function f9(t){let e=Ge(t,[{[mn]:!0,[OR]:!0,[Nl]:!0},{[Yve]:!0,[qr]:d=>Number.isInteger(d)&&d>0},{[qr]:d=>Array.isArray(d)&&d.length===2&&d.every(ni),[Ha]:Sa,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=t,{structure:s}=et({drawDefinition:i,structureId:r});if(!s)return{error:vi};if(!Wn({structure:s}))return{error:af};let o=d=>d.sides?.map(p=>p.participantId).some(p=>t.participantIds.includes(p)),l=d=>d.roundNumber===t.roundNumber,u=d=>!dr(d),c=(s?.matchUps??[]).filter(l).filter(u).filter(o);if(c.length!==2)return{error:Sa};for(let d of c){let p=d?.sides?.find(f=>t.participantIds.includes(f?.participantId));if(p){let f=t.participantIds.find(h=>h!==p?.participantId);p.participantId=f,Tt({tournamentId:n?.tournamentId,eventId:a?.eventId,drawDefinition:i,matchUp:d})}}return ii({drawDefinition:i,structureIds:[r]}),{...H}}function oUe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:s,uuids:o,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Re(0,c).map(m=>d?d+m:void 0),f=[];for(let m=0;m<c;m++){let g=p.shift(),I={drawPosition:g,fed:u+1,feed:!0},v=l[m];v.roundNumber=i-1;let w=I0({roundPosition:v.roundPosition,roundNumber:i,idPrefix:n,uuids:o}),y={roundPosition:v.roundPosition,drawPositions:[g],matchUpStatus:Li,roundNumber:i,matchUpId:w};t&&(y.matchUpType=r),s&&(y.isMock=!0),a.push(y);let b={children:[v,I]};f.push(b)}let h=e?e-c:void 0;return{roundNodes:f,matchUps:a,drawPosition:h}}function Td(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:s,finishingPositionOffset:o,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:f,uuids:h,fmlc:m}=t;a=a??M(e);let g=lUe({drawSize:a}),I=g.length,v=0;if(i?.length)v=i.reduce((N,A)=>N+A,0);else if(e){let N=e-a;i=g.filter(A=>A<=N?(N-=A,!0):!1),v=i.reduce((A,O)=>A+O,0),r=i.length}else n>=I?r=0:u&&(r=I-u,n=0),i=g.filter((N,A)=>u&&!r||r&&A>=n+r||A<n?0:N),v=i.reduce((N,A)=>N+A,0),r=i.length;let w=[...g,...i].sort((N,A)=>A-N),y=w.length,b=[...(l??[]).map(N=>N-1),...(s??[]).map(N=>y-N)].map(N=>w[N]).reduce((N,A)=>N+A,0);v=v-b;let S=0,U=[],T,D=1,P=Re(0,a).map((N,A)=>({drawPosition:A+1+v})),E=v+1;for(let N of g){if({roundNodes:T,matchUps:U}=DP({matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:f,nodes:P,uuids:h}),D++,i.includes(N)){let A=Ta(i)[N],O=Re(0,A),k=y+1-D,F=s?.includes(k)??l?.includes(D);O.forEach(()=>{({roundNodes:T,matchUps:U,drawPosition:E}=oUe({drawPosition:!F&&E||void 0,nodes:T,matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:f,uuids:h,fed:S})),D++,S+=1})}P=T}y!==D-1&&console.log("ERROR");let R=a-v;U=DS({finishingPositionOffset:c?R:o,positionsFed:v,roundsCount:y,matchUps:U,fmlc:m});let C=T?.length?T[0]:T;return C&&(C.roundNumber=D-1,C.matchUps=U),{draw:C,matchUps:U,roundsCount:y};function M(N){let A=s1(N);return A>N?A/2:A}}function lUe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Re(0,e).reverse().map(i=>Math.pow(2,i))}function Yg(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,stageSequence:o=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:f,sequenceLimit:h,childStage:m,stage:g=Fe,drawSize:I,idPrefix:v,isMock:w,uuids:y}=t;if(!(!s||!u||s?.[l])||I<2||h&&o>h)return{};let b=[],S=[],U=[],T=t.matchUpType??p?.matchUpType,D=e+1,P=e+I,E=`${D}-${P}`,R=s?.[l],C=r&&`${r} `||"",M=s?.[E]??n?.[E],N=t.structureName||M?.name||R?.name&&(i?`${C}${R?.name}`:R.name)||`${C}${E}`,A=M?.abbreviation??R?.abbreviation,O=t.structureId??R?.structureId??y?.pop(),k={idPrefix:v&&`${v}-${N}-RP`,finishingPositionOffset:e,matchUpType:T,drawSize:I,isMock:w,uuids:y},{matchUps:F}=f?Td(k):gl(k),x=ls({structureAbbreviation:A,stageSequence:o,structureName:N,matchUpType:T,roundOffset:d,structureId:O,matchUps:F,stage:g});b.push(...F),S.push(x);let L=Math.ceil(Math.log(I)/Math.log(2)),$=c?Math.min(c-d,L):(!a||D<a)&&L||0;return I>2&&Re(1,$+1).forEach(_=>V(_)),{structureId:x.structureId,matchUps:b,structureName:N,structures:S,links:U,...H};function V(_){let B=I/Math.pow(2,_);if(B<2)return;let G=I/Math.pow(2,_)+e;if(a&&G+1>a)return;let{structures:j,structureId:Y,matchUps:K,links:X}=Yg({finishingPositionOffset:G,exitProfile:`${l}-${_}`,roundOffset:d+_,stageSequence:o+1,stage:m??g,drawSize:B,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:h,childStage:m,matchUpType:T,idPrefix:v,uuids:y});if(x.structureId&&Y){let Z={linkType:hu,source:{roundNumber:_,structureId:x.structureId},target:{roundNumber:1,feedProfile:Os,structureId:Y}};X&&x&&X.push(Z),X?.length&&U.push(...X)}return j?.length&&S.push(...j),K?.length&&b.push(...K),{structureId:Y,childLinks:X,structures:S}}}function y0({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=et({drawDefinition:t,structureId:i});if(r.error)return z({result:r});let{matchUps:n}=kt({structure:r.structure,matchUpsMap:e});return{...wn({matchUps:n}),matchUps:n,matchUpsMap:e}}function YW({finishingPositions:t,drawDefinition:e,structureId:i}){let{roundProfile:r}=y0({drawDefinition:e,structureId:i});return(r&&Object.keys(r))?.reduce((n,a)=>(h9(r?.[a]).forEach(s=>{t.forEach(o=>{uUe({position:o,rangeDefinition:s})&&(n[o]={roundNumber:a})})}),n),{})}function uUe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return Re(i,(r||i)+1).includes(t)}function h9(t){return[ot(t?.finishingPositionRange?.loser||[]),ot(t?.finishingPositionRange?.winner||[])]}function cUe(t){return h9(t).map(e=>Re(e[0],e[1]&&e[1]+1||e[0]+1))}function Dv({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:ie,context:{structureIds:e}};if(!t)return{error:_e};e=e??(t.structures??[]).filter(a=>a.stage!==We).map(({structureId:a})=>a);let r=e.map(a=>{let{roundProfile:s}=y0({drawDefinition:t,matchUpsMap:i,structureId:a});return(s&&Object.values(s))?.map(cUe).flat()}).flat(),n=r.filter(a=>a?.length===1).sort(ar).flat();return{positionsNotPlayedOff:ot(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function m9({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:_e};if(!r)return{error:Ka};if(!e)return{error:Xe,info:"missing playoffPositions"};let n=Dv({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,s=e.filter(I=>!a.includes(I)),o=YW({finishingPositions:s,drawDefinition:i,structureId:r}),l=Object.values(o).reduce((I,v)=>I.includes(v.roundNumber)?I:I.concat(v.roundNumber),[]).map(I=>Ye(I)).filter(I=>!t.includes(I)),u=YW({finishingPositions:a,drawDefinition:i,structureId:r}),c=u?Object.values(u):[],d=u?c.reduce((I,v)=>I.includes(v.roundNumber)?I:I.concat(v.roundNumber),[]).map(I=>Ye(I)):[],p=l.filter(I=>!d.includes(I)).sort(ar),{roundProfile:f}=y0({drawDefinition:i,structureId:r}),h=p.map(I=>{let v=f?.[I].finishingPositionRange.loser,[w,y]=v??[0,0];return Re(w,(y||w)+1)}).flat().sort(ar),{playoffRoundsRanges:m}=dUe({playoffSourceRounds:p,roundProfile:f}),g=[...p,...d];return{playoffPositionsReturned:h,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:f}}function dUe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,s=Re(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:s,roundNumber:i}})}}function LS({drawDefinition:t,structureId:e}){if(!t)return{error:_e};let{matchUps:i,matchUpsMap:r}=Nn({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=Dv({drawDefinition:t,matchUpsMap:r}),{structures:s}=to({drawDefinition:t}),o=s.filter(u=>!e&&u.stage!==Rr||u.structureId===e),l={};for(let u of o){let c=u?.structureId,d=pUe({playoffPositions:n,drawDefinition:t,structure:u,matchUps:i}),{error:p,...f}=d;if(p)return d;l[c]={structureId:c,...f}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function pUe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){let n=i?.structureId,{links:a}=Iv({drawDefinition:e,structureId:n});if(i.structureType===hn||i.structures){let f=Kt({structure:i})?.positionAssignments?.length,h=i.structures.length,m=(f??0)/h,g=a.source?.flatMap(({source:P})=>P?.finishingPositions||[])||[],I=Re(1,m+1).filter(P=>!g.includes(P)),v=r.find(P=>P.containerStructureId===n&&P.finishingPositionRange)?.finishingPositionRange?.winner||[0,1],w=a?.source.map(({target:P})=>P.structureId),{positionsPlayedOff:y=[],positionsNotPlayedOff:b=[]}=Dv({structureIds:w,drawDefinition:e}),S=new Set([...y,...b]),U=Re(v[0],v[1]+1).filter(P=>!S.has(P)),T=br(U,U.length/I.length),D=I.map((P,E)=>{let R=T[E],C=[Math.min(...R||[]),Math.max(...R||[])].join("-");return{finishingPosition:P,finishingPositions:R,finishingPositionRange:C}});return{positionsNotPlayedOff:U,playoffFinishingPositionRanges:D,finishingPositionsAvailable:I,finishingPositionsPlayedOff:g,positionsPlayedOff:y,groupCount:h,groupSize:m}}let s=a?.source?.filter(f=>f.linkCondition!==fl).map(f=>f.source?.roundNumber)||[],o=a?.source?.filter(f=>f.linkCondition===fl).map(f=>f.source?.roundNumber)||[],l=m9({excludeRoundNumbers:s,playoffPositions:t,drawDefinition:e,structureId:n}),u=l?.playoffSourceRounds?[...l?.playoffSourceRounds||[]]:void 0,c=[...l?.playoffRoundsRanges||[]],{roundProfile:d,error:p}=l;for(let f of o){let h=a?.source.find(w=>w.source.roundNumber===f),m=h?.target.roundNumber,g=h?.target.structureId,I=r.filter(({roundNumber:w,structureId:y})=>y===g&&w===m),v=I.filter(({sides:w})=>w.find(y=>y.participantFed&&!y.participantId)).length;if(u&&v===I.length){u.push(f);let w=d?.[f]?.finishingPositionRange?.loser;if(w){let y=Math.min(...w),b=y+v,S=Re(y,b),U={finishingPositionRange:[y,b-1].join("-"),finishingPositions:S,roundNumber:f};c.push(U)}}}return u&&u.sort(ar),c.sort((f,h)=>f.roundNumber-h.roundNumber),{playoffRounds:u,playoffRoundsRanges:c,error:p}}function fUe({playoffGroups:t,drawDefinition:e,structureId:i}){if(!e)return{error:_e};if(!ni(i)||!Array.isArray(t))return{error:ie};let r=t.map(({finishingPositions:n})=>n).flat();return{positionRangeMap:LS({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges?.filter(n=>r.includes(n.finishingPosition))?.reduce((n,a)=>(n[a.finishingPosition]=a,n),{})}}function g9(t){let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:s=Fe,matchUpType:o,structureId:l,idPrefix:u,drawSize:c,isMock:d,uuids:p}=t,f={finishingPositionOffset:e,matchUpType:o,drawSize:c,idPrefix:u,isMock:d,uuids:p},{matchUps:h}=n?Td(f):gl(f),m=ls({structureName:a||i?.["0"]?.name||Jr(Fe),structureId:l||p?.pop(),stageSequence:r,matchUpType:o,matchUps:h,stage:s}),g=[m],I=[];if(c>2){let v=c/2,{matchUps:w}=gl({finishingPositionOffset:e+v,idPrefix:u&&`${u}-c`,drawSize:v,matchUpType:o,isMock:d}),y=Jr(en),b=i?.["0-1"]?.name??t.consolationStructureName??(a?`${a} ${y}`:y),S=ls({structureName:b,matchUps:w,structureId:p?.pop(),stage:en,stageSequence:1,matchUpType:o});g.push(S);let U={linkType:hu,source:{roundNumber:1,structureId:m.structureId},target:{roundNumber:1,feedProfile:Os,structureId:S.structureId}};I.push(U)}return{...H,structures:g,links:I}}function I9({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let s=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),o=n?.roundGroupedOrder||[],l=n?.roundFeedProfiles;return Re(1+e,r+1+e).map(u=>{let c=l?.[u-1]?l[u-1]:u%2&&Os||Ap,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:hu,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},f=o[u-1];return f&&(p.target.groupedOrder=f),ua()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=fl,p.target.feedProfile=Os),s.includes(d)?p:void 0}).filter(Boolean)}function v9(t){let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:s,stage:o=Fe,matchUpType:l,structureId:u,drawSize:c,idPrefix:d,isMock:p,uuids:f}=t,h={finishingPositionOffset:i,matchUpType:l,drawSize:c,idPrefix:d,isMock:p,uuids:f},{matchUps:m,roundsCount:g}=s?Td(h):gl(h),I=t.structureName??n?.["0"]?.name??Jr(Fe),v=hd({structureId:u||f?.pop(),structureName:I,stageSequence:r,matchUpType:l,matchUps:m,stage:o}),w=[v],y=[];if(c>2){let b=[0,2].slice(0,c/16).map((S,U)=>{let T=U+1,{consolationStructure:D}=hUe({idPrefix:d&&`${d}-c${U}`,structureId:f?.pop(),playoffStructureNameBase:e,playoffAttributes:n,structureNameMap:a,stageSequence:T,roundOffset:S,matchUpType:l,drawSize:c,isMock:p,index:U,uuids:f});w.push(D);let P=I9({consolationStructure:D,roundsCount:2,mainStructure:v,roundOffset:S});return{consolationStructure:D,links:P}}).map(S=>S.links).flat();if(y.push(...b),c>=4&&c<=16||c>32){let{matchUps:S}=gl({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),U=n?.["3-4"]?.name??Jr(Ai),T=a?.[U]||U,D=e?`${e} ${T}`:T,P=hd({structureId:f?.pop(),matchUps:S,stageSequence:2,stage:Ai,structureName:D,matchUpType:l}),E={linkType:hu,source:{roundNumber:g-1,structureId:v.structureId},target:{structureId:P.structureId,feedProfile:Os,roundNumber:1}};w.push(P),y.push(E)}}return{structures:w,links:y,...H}}function hUe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:s,idPrefix:o,drawSize:l,isMock:u,index:c,uuids:d}){let p=l/(2*Math.pow(2,n)),{matchUps:f,roundsCount:h}=Td({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:o,isMock:u,uuids:d}),m=c===0&&i?.["0-1"]?.name||c===1&&i?.["0-3"]?.name||`${Jr(en)} ${c+1}`,g=r?.[m]||m,I=t?`${t} ${g}`:g;return{consolationStructure:hd({matchUps:f,stage:en,structureName:I,stageSequence:e,matchUpType:a,structureId:s}),consolationRoundsCount:h}}function Hf(t){let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:s,stage:o=Fe,structureId:l,matchUpType:u,skipRounds:c,feedRounds:d,idPrefix:p,drawSize:f,isMock:h,uuids:m,fmlc:g}=t,I=t.feedPolicy||t.policyDefinitions?.[dI]||t.appliedPolicies?.[dI],v={finishingPositionOffset:e,matchUpType:u,skipRounds:c,drawSize:f,idPrefix:p,isMock:h,uuids:m},{matchUps:w}=a?Td(v):gl(v),y=ls({structureName:s||r?.["0"]?.name||Jr(Fe),structureId:l||m?.pop(),stageSequence:i,matchUpType:u,matchUps:w,stage:o}),b=[y],S=[],U=f/2,{matchUps:T,roundsCount:D}=Td({finishingPositionOffset:U,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:U,matchUpType:u,feedRounds:d,skipRounds:c,isMock:h,uuids:m,fmlc:g});if(f>2){let P=r?.["0-1"]?.name??Jr(en),E=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${P}`:P,R=ls({matchUps:T,structureId:m?.pop(),stage:en,stageSequence:1,structureName:E,matchUpType:u});b.push(R);let C=I9({consolationStructure:R,mainStructure:y,roundsCount:D,feedPolicy:I,fmlc:g});S.push(...C)}return{...H,structures:b,links:S}}function y9({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:s,playoffGroups:o,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:f}){u=u||n?.[dI];let h="processPlayoffGroups",m=0,g=[],I=[],v=[],{error:w,positionRangeMap:y}=fUe({structureId:r,drawDefinition:s,playoffGroups:o});if(w)return z({result:{error:w},stack:h});if(!(!y||o?.every(b=>{let{finishingPositions:S=[]}=b;if(!S.length)return!1;let U=[...S].sort(ar).map((T,D)=>(S[D+1]||T)-T).every(T=>T<2);return(!t||U)&&S.every(T=>y[T])})))return z({context:{validFinishingPositions:Object.values(y)},result:{error:ie},stack:h});for(let b of o){let S=b.finishingPositions,U=y&&S.flatMap(N=>y[N]?.finishingPositions??[]),T=c*S.length,D=nv(T),P=D===2&&il||b.drawType||il;U&&(m=Math.min(...U)-1);let E=U&&`${Math.min(...U)}-${Math.max(...U)}`,R=b.structureName||E&&b.playoffAttributes?.[E]?.name||b.playoffAttributes?.["0"]?.name,C={addNameBaseToAttributeName:b.addNameBaseToAttributeName,playoffStructureNameBase:b.playoffStructureNameBase,finishingPositionNaming:b.finishingPositionNaming,finishingPositionLimit:b.finishingPositionLimit,structureId:b.structureId??f?.pop(),playoffAttributes:b.playoffAttributes,structureNameMap:b.structureNameMap,sequenceLimit:b.sequenceLimit,structureName:R,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:m,stage:Ai,stageSequence:a,matchUpType:l,drawSize:D,isMock:p,uuids:f},M=({playoffStructures:N,playoffLinks:A})=>{let[O]=N,k=_T({playoffStructureId:O.structureId,finishingPositions:S,sourceStructureId:r});v.push(k,...A),I.push(...N),g.push({structureId:O.structureId,finishingPositions:S}),m+=T};if(P===il){let{matchUps:N}=gl({finishingPositionLimit:m+T,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,matchUpType:l,drawSize:D,isMock:p,uuids:f}),A=ls({structureId:b.structureId??f?.pop(),matchUpFormat:e,stage:Ai,structureName:R,stageSequence:a,matchUps:N});I.push(A);let O=_T({playoffStructureId:A.structureId,finishingPositions:S,sourceStructureId:r});v.push(O),m+=T,g.push({structureId:A.structureId,finishingPositions:S})}else if([oI,lI,nS].includes(P)){let N={playoffAttributes:b.playoffAttributes??i,playoffStructureNameBase:b.playoffStructureNameBase,structureId:b.structureId??f?.pop(),structureName:b.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:m,stage:Ai,roundOffset:0,stageSequence:a,drawSize:D,isMock:p,uuids:f};P===oI?Object.assign(N,{playoffAttributes:b?.playoffAttributes??i??q1,roundOffsetLimit:3}):P===lI&&Object.assign(N,{playoffAttributes:b?.playoffAttributes??i??Y1,roundOffsetLimit:2});let A=Yg(N);if(A.error)return A;if(A.links?.length&&v.push(...A.links),A.structures?.length&&I.push(...A.structures),I.sort(vm),A.structureId){let O=_T({playoffStructureId:A.structureId,finishingPositions:S,sourceStructureId:r});v.push(O),g.push({structureId:A.structureId,finishingPositions:S})}m+=T}else if([uI,rS,Lb,Fb,xb,_b].includes(P)){let N=[f?.pop(),f?.pop()],A={playoffStructureNameBase:b.playoffStructureNameBase,structureId:b.structureId??f?.pop(),playoffAttributes:b.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,uuids:N,stage:Ai,structureName:R,matchUpType:l,feedPolicy:u,drawSize:D,isMock:p},O={[uI]:{fmlc:!0,feedRounds:1},[_b]:{feedRounds:1},[Lb]:{feedsFromFinal:3},[Fb]:{feedsFromFinal:2},[xb]:{feedsFromFinal:1}};Object.assign(A,O[P]||{});let{structures:k,links:F}=Hf(A),[x]=k,L=_T({playoffStructureId:x.structureId,finishingPositions:S,sourceStructureId:r});v.push(L,...F),I.push(...k),g.push({structureId:x.structureId,finishingPositions:S}),m+=T}else if([Zs].includes(P)){let{structures:N,links:A}=NS({...C,structureOptions:b.structureOptions||{groupSize:4}});M({playoffStructures:N,playoffLinks:A})}else if([iS].includes(P)){let{structures:N,links:A}=g9(C);M({playoffStructures:N,playoffLinks:A})}else if([jve].includes(P)){let{structures:N,links:A}=v9(C);M({playoffStructures:N,playoffLinks:A})}else if([ca].includes(P)){let N=ls({structureId:b.structureId??f?.pop(),structureName:b.structureName,finishingPosition:mD,stage:Ai,stageSequence:a,matchUps:[]});M({playoffStructures:[N],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:y,structures:I,links:v}}function _T({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:pu,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:ks,roundNumber:1}}}function mUe(t){let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return z({result:{error:Xe},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:s,groupCount:o,groupSize:l,event:u}=t,c=y9({requireSequential:r,sourceStructureId:i,playoffGroups:s,groupCount:o,...t});if(c.error)return z({result:c,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:f,positionRangeMap:h}=c,m=f?.flatMap(({finishingPositions:T})=>T).flatMap(T=>h[T].finishingPositions);a.structures.push(...d),a.links.push(...p);let{matchUps:g,matchUpsMap:I}=rr({inContext:!0,drawDefinition:a}),v=new Set(d.map(({structureId:T})=>T)),w=g?.filter(({structureId:T})=>v.has(T)).map(vr),y=I?.drawMatchUps?.filter(({matchUpId:T})=>w?.includes(T));if(y?.length){let T=yn({drawDefinition:a,event:u})?.tieFormat;T&&y.forEach(D=>{let{tieMatchUps:P}=Mm({isMock:t.isMock,tieFormat:T,matchUp:D});Object.assign(D,{tieMatchUps:P,matchUpType:Va})})}let{positionAssignments:b}=Kt({structureId:i,drawDefinition:a}),S={};b?.forEach(T=>{let D=it({element:T,name:yc})?.extension?.value?.groupOrder;D&&(S[D]||(S[D]=[]),S[D].push(T.participantId))});let U=Tv({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:n,drawDefinition:a});return U.error&&U.error?.code!==o1.code?z({result:U,stack:e}):{structures:d,links:p,positionsPlayedOff:m,drawDefinition:a,...H}}function b0({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!Ja(n))return{error:ie};if(!t)return{error:ie};let{policyDefinitions:s}=jc({policyTypes:[nL],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:o}=zL({positionAssignments:t}),l=n.length?Dm({policyDefinitions:s,matchUpFormat:r,subOrderMap:o,matchUps:n}):void 0;if(l?.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(f=>{let{participantId:h}=f;if(p.includes(h)){let m={value:u[h],name:yc};gt({element:f,extension:m}),u[h].ties||Mn({element:f,name:pI})}else Mn({element:f,name:yc}),Mn({element:f,name:pI})}),ii({drawDefinition:i}),{...H,participantResults:u,bracketComplete:c,report:d}}function b9({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function pi(t){let e=Ge(t,[{[mn]:!0,[Nl]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:s,matchUpId:o,inContext:l,context:u,event:c}=t,{structures:d=[]}=to({drawDefinition:a}),p=t.contextContent||n&&Gc({contextProfile:n,drawDefinition:a});for(let f of d){let{matchUps:h}=kt({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:s,inContext:l,structure:f,context:u,event:c}),{matchUp:m}=b9({matchUps:h,matchUpId:o});if(m)return{matchUp:m,structure:f}}return{error:cn}}function mC(t){return!St(t)||!t.notes?{error:Xe}:St(t.element)?!ni(t.notes)&&!t.notes?.testing?{error:ie}:(Object.assign(t.element,{notes:t.notes}),{...H}):{error:ie}}function w0(t){return St(t)?St(t.element)?(t.element.notes&&delete t.element.notes,{...H}):{error:ie}:{error:Xe}}var gC={matchUpStatus:Li,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Po(t){let e="modifyMatchUpScore",i=t.matchUpFormat,r=t.matchUp,n,{matchUpStatusCodes:a,tournamentRecord:s,drawDefinition:o,matchUpStatus:l,removeScore:u,winningSide:c,matchUpId:d,event:p,notes:f,score:h}=t,m=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:Rt({policyTypes:[ko],tournamentRecord:s,drawDefinition:o,structure:n,event:p})?.appliedPolicies,g=r.matchUpType===ei;if(g&&o){if(d&&r.matchUpId!==d){let U=pi({drawDefinition:o,matchUpId:d,event:p});if(!U.matchUp)return{error:cn};({matchUp:r,structure:n}=U)}}else r.matchUpId!==d&&console.log("!!!!!");l&&[mi,Si].includes(l)||u?Object.assign(r,{...gC}):h&&(r.score=h);let I=l&&r?.matchUpStatus===Zt&&l!==Zt;l&&(r.matchUpStatus=l),i&&(r.matchUpFormat=i),a&&(r.matchUpStatusCodes=a),c&&(r.winningSide=c),t.removeWinningSide&&(r.winningSide=void 0),!n&&o&&({structure:n}=pi({drawDefinition:o,matchUpId:d,event:p})),l&&!r.winningSide&&dr(r)&&!Ji.includes(l)&&![Im,Hd,hs].includes(l)&&(r.matchUpStatus=uo);let v;if((I&&r?.processCodes?.length||l===Zt)&&(v=m?.[ko]?.processCodes?.incompleteAssignmentsOnDefault),!r.collectionId){let U=n?.structureType===hn,T=Wn({structure:n});if(kL({drawDefinition:o,structure:n})||T||U){let D=R=>{i=g?"SET1-S:T100":i??r.matchUpFormat??R?.matchUpFormat??o?.matchUpFormat??p?.matchUpFormat;let C=g?{matchUpTypes:[ei]}:void 0,{matchUps:M}=kt({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:C,drawDefinition:o,structure:R,event:p});return T&&(R.positionAssignments=ot(M.flatMap(N=>(N.sides??[]).map(A=>A.participantId)).filter(Boolean)).map(N=>({participantId:N}))),b0({positionAssignments:R.positionAssignments,tournamentRecord:s,drawDefinition:o,matchUpFormat:i,matchUps:M,event:p})},P=U&&n.structures.find(R=>R?.matchUps.find(C=>C.matchUpId===d)),E=D(P||n);if(E.error)return z({result:E,stack:e})}}if(f){let U=mC({element:r,notes:f});if(U.error)return z({result:U,stack:e})}let w=s?.tournamentId,y=bs().topics.includes(zR),b=(y||v)&&Or({drawDefinition:o}),S=b&&rr({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:o,matchUpsMap:b}).matchUps?.[0];if(y&&S&&Pye({tournamentId:w,inContextMatchUp:S}),Array.isArray(v)&&S&&!S.sides?.every(({participantId:U})=>U))if(l===Zt)r.processCodes=ot([...r.processCodes??[],...v]);else for(let U of v||[]){let T=U&&r?.processCodes?.lastIndexOf(U);r?.processCodes?.splice(T,1)}return Tt({eventId:p?.eventId,context:e,drawDefinition:o,tournamentId:w,matchUp:r}),{...H}}function S0(t){let{propagateExitStatus:e,matchUpStatusCodes:i,autoCalcDisabled:r,inContextMatchUp:n,matchUpStatus:a,dualMatchUp:s,structure:o,matchUp:l}=t,u=PS({matchUpStatus:a})||[Bc,fs].includes(a)&&s||r,c=l?.sides?.map(m=>m.participantId).filter(Boolean).length||n?.sides?.map(m=>m.participantId).filter(Boolean).length,d="attemptToModifyScore";if(!(Wn({structure:o})&&c===1||a===Zt&&c||gUe({structure:o,matchUp:l,inContextMatchUp:n})||t.appliedPolicies?.[ko]?.requireParticipantsForScoring===!1||$r(a)&&c===1&&e))return z({result:{error:h1},stack:d});let p=[mi].includes(a),f=u?a:t.winningSide&&Oi||hs,h=Po({...t,winningSide:t.winningSide,matchUpStatusCodes:u&&i||[],matchUpStatus:f,removeScore:p});return z({result:h,stack:d})}function gUe({structure:t,matchUp:e,inContextMatchUp:i}){let{drawPositions:r}=e,{positionAssignments:n}=cr({structure:t}),a=n?.filter(o=>r?.includes(o.drawPosition)&&o.participantId),s=i?.sides?.every(o=>o.participantId);return a?.length===2||s}function w9({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>ut(r?.groupValue)&&r?.groupNumber).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>Ye(r));return{groupValueGroups:e,groupValueNumbers:i}}function IUe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(v=>v.collectionId===t.collectionId),s=[0,0],o=[0,0],l=a.every(v=>Ji.includes(v.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:f,scoreValue:h,setValue:m}=t,g=c&&e.includes(c),I=[0,0];if(a.forEach(v=>{v.winningSide&&(I[v.winningSide-1]+=1)}),ut(p)?a.forEach(v=>{v.winningSide&&(s[v.winningSide-1]+=p)}):ut(m)?a.forEach(v=>{v.score?.sets?.forEach(w=>{w.winningSide&&(s[w.winningSide-1]+=m)})}):ut(h)?a.forEach(v=>{v.score?.sets?.forEach(w=>{let{side1TiebreakScore:y=0,side2TiebreakScore:b=0,side1Score:S=0,side2Score:U=0}=w;(v.matchUpStatus===Oi||v.winningSide||w.winningSide)&&(S||U?(s[0]+=S,s[1]+=U):(y||b)&&w.winningSide&&(s[w.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(v=>{if(v.winningSide){let w=v.collectionPosition,y=vUe({collectionDefinition:t,collectionPosition:w});ut(y)&&(s[v.winningSide-1]+=y)}}),ut(d)){let v;if(f?.aggregateValue)l&&(ut(p||m||h)&&s[0]!==s[1]?v=s[0]>s[1]?1:2:I[0]!==I[1]&&(v=I[0]>I[1]?1:2));else if(f?.valueGoal)v=s.reduce((w,y,b)=>y>=f.valueGoal?b+1:w,0);else{let w=Math.floor(t.matchUpCount/2)+1;v=I.reduce((y,b,S)=>b>=w?S+1:y,0)}v&&(g?i[c].values[v-1]+=d:o[v-1]+=d)}else g?(i[c].values[0]+=s[0]||0,i[c].values[1]+=s[1]||0):o=s;g?(i[c].sideWins[0]+=I[0]||0,i[c].sideWins[1]+=I[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):o.forEach((v,w)=>r[w]+=v||0)}function vUe({collectionDefinition:t,collectionPosition:e}){return(t.collectionValueProfiles||[])?.find(i=>i.collectionPosition===e)?.matchUpValue}function _S(t){let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:s,event:o}=t;if(!Array.isArray(e)||e.length!==2||Number.isNaN(e.reduce((y,b)=>y+b)))return{error:ie};if(!s)return{error:oa};let l=yn({matchUp:s,drawDefinition:r,structure:a,event:o})?.tieFormat||t?.tieFormat;if(!l)return{error:ov};let u=Hn({tieFormat:l});if(u.error)return u;let c=l?.collectionDefinitions||[],d=s?.tieMatchUps??[],p=[0,0],{groupValueGroups:f,groupValueNumbers:h}=w9(l);for(let y of c)IUe({collectionDefinition:y,groupValueNumbers:h,groupValueGroups:f,sideTieValues:p,tieMatchUps:d});for(let y of h){let b=f[y],{allGroupMatchUpsCompleted:S,matchUpCount:U,winCriteria:T,groupValue:D,sideWins:P,values:E}=b,R;if(T?.aggregateValue)S&&E[0]!==E[1]&&(R=E[0]>E[1]?1:2);else if(T?.valueGoal)R=E.reduce((C,M,N)=>M>=T.valueGoal?N+1:C,void 0);else{let C=Math.floor(U/2)+1;R=P.reduce((M,N,A)=>N>=C?A+1:M,void 0)}R&&(p[R-1]+=D||0)}let m=p.map((y,b)=>(y||0)+e[b]),g={side1Score:m[0],side2Score:m[1],winningSide:void 0},I=m.join(i),v=m.slice().reverse().join(i),w;if(l?.winCriteria){let{valueGoal:y,aggregateValue:b,tallyDirectives:S}=l.winCriteria;if(y?w=m.map((U,T)=>({sideNumber:T+1,points:U})).find(({points:U})=>U>=y)?.sideNumber:b&&d.every(U=>U.matchUpStatus&&Ji.includes(U.matchUpStatus)||U.winningSide)&&m[0]!==m[1]&&(w=m[0]>m[1]?1:2),!w&&S){let U=s.matchUpId,T=s.hasContext?s:n?.drawMatchUps?.[U]||r&&pi({inContext:!0,drawDefinition:r,matchUpId:U})?.matchUp;if(T){let{completedTieMatchUps:D,order:P}=Dm({matchUps:[T]});if(D&&P?.length){let E=P[0].participantId;w=T.sides.find(({participantId:R})=>R===E)?.sideNumber}}}}return w&&(g.winningSide=w),{scoreStringSide1:I,scoreStringSide2:v,winningSide:w,set:g}}function $S({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){if(r){t||(t=pi({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e})?.matchUp);let{extension:a}=it({element:e,name:Ic}),s=Oe(a?.value||{},!1,!0),o=({displaySideNumber:l,drawPosition:u,sideNumber:c})=>({drawPosition:u,sideNumber:c,displaySideNumber:l});r.sides=t?.sides?.map(l=>{let u=l.participantId,c=u&&s[u]||void 0,{lineUp:d,...p}=r.sides?.find(({sideNumber:h})=>h===l.sideNumber)??{},f=d?.length?d:c;return{...o(l),...p,lineUp:f}}),Tt({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function Wr(t){if(t)return Oe(t,!1,!0)}function U0(t){let e=Ge(t,[{[dn]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:o})=>o),s=n.map(o=>(o.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...s),i.eventIds.push(...a),i.drawIds.push(...s),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function S9({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=U0({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&r?.[n].includes(e)||i&&r?.[n].includes(i))}function Hc(t){let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:s,event:o}=t,l=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord?.tournamentId]:t.tournamentRecord}||{},u=t.tournamentId||t.tournamentRecord?.tournamentId;l&&S9({tournamentRecords:l,...t});let c=u&&l[u];if(!c)return{error:ge};let d=pi({drawDefinition:i,event:o,matchUpId:s});if(d.error)return d;if(!d.matchUp)return{error:cn};let{matchUp:p,structure:f}=d;if(!p.tieMatchUps)return{error:la};$S({tournamentId:c?.tournamentId,eventId:o?.eventId,dualMatchUp:p,drawDefinition:i});let{extension:h}=it({name:Lh,element:p});if(h?.value)if(n)Mn({element:p,name:Lh});else return{...H,score:p.score};let m=yn({drawDefinition:i,structure:f,matchUp:p,event:o})?.tieFormat;p.tieFormat=Wr(m);let g=_S({drawDefinition:i,matchUpsMap:a,structure:f,matchUp:p,event:o}),{winningSide:I,set:v,scoreStringSide1:w,scoreStringSide2:y}=g,b=v?.side1Score||v?.side2Score;if(e&&!p.score&&!b)return{...H};let S={scoreStringSide1:w,scoreStringSide2:y,sets:v?[v]:[]},U=I&&[1,2].includes(I),T=U&&Oi||BL({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:S})&&uo||Li,D=!!(p.winningSide&&!U),P=p.tieMatchUps.find(({score:R,winningSide:C,matchUpStatus:M})=>R?.sets?.length&&(R.sets[0].side1Score||R.sets[0].side2Score)||M&&Ji.includes(M)||C),E;if(p.tieFormat&&!U&&!P){let R=yn({drawDefinition:i,structure:f,event:o})?.tieFormat;R&&JSON.stringify(m)===JSON.stringify(R)&&(p.tieFormatId=void 0,p.tieFormat=void 0,E=!0)}return Po({appliedPolicies:t.appliedPolicies,matchUpStatus:T,score:S,removeWinningSide:D,tournamentRecord:c,drawDefinition:i,removeScore:n,winningSide:I,matchUpId:s,matchUp:p,event:o}),{...H,score:S,removeWinningSide:D,tieFormatRemoved:E,winningSide:I}}function yUe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:s,sourceMatchUpId:o,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){let f="directWinner";if(s){let h=u.drawPositions||[],m=h[t],g=s.source.structureId,I=et({structureId:g,drawDefinition:l});if(I.error)return I;let{structure:v}=I,{positionAssignments:w}=cr({structureId:g,drawDefinition:l}),y=w?.find(P=>P.drawPosition===n)?.participantId,b=s.target.structureId,{positionAssignments:S}=cr({structureId:b,drawDefinition:l}),U=S?.find(P=>P.participantId===y)?.drawPosition,T=S?.filter(P=>{let E=h.includes(P.drawPosition),R=!P.participantId&&!P.bye&&!P.qualifier;return E&&R}).map(P=>P.drawPosition),D=T?.includes(m);if(y&&s.target.roundNumber===1&&D)ml({drawPosition:m,participantId:y,structureId:b,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(y&&T?.length){let P=T.pop();P&&ml({participantId:y,structureId:b,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:P,matchUpsMap:d,event:p})}else if(U){let P=ph({drawPosition:U,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(P.error)return z({result:P,stack:f})}else if(v?.stage!==We){let P="winner target position unavaiallble";console.log(P),z({stack:f,result:{error:P}})}if(v?.seedAssignments&&v.structureId!==b){let P=v.seedAssignments.find(({participantId:R})=>R===y),E=P?.participantId;P&&E&&Uv({eventId:u?.eventId,structureId:b,...P,tournamentRecord:a,drawDefinition:l,participantId:E})}}else{let h=ph({matchUpId:u.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(h.error)return h}if(c&&i){let h=c.sides?.find(m=>m.sideNumber===i);if(h?.lineUp){let m=c.roundPosition,g=u.roundPosition,I=m===g&&m!==1||Math.floor(m/2)===g?2:1,v=d?.drawMatchUps?.find(({matchUpId:b})=>b===u.matchUpId),w=[1,2].map(b=>({...v.sides?.find(S=>S.sideNumber===b)||{},sideNumber:b}));v.sides=w;let y=v.sides.find(b=>b.sideNumber===I);if(y){let b=h.lineUp?.filter(S=>S?.participantId);y.lineUp=a0({lineUp:b}),Tt({tournamentId:a?.tournamentId,eventId:u?.eventId,matchUp:v,context:f,drawDefinition:l})}}}return{...H}}function bUe(t){let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:r,propagateExitStatus:n,sourceMatchUpStatus:a,loserDrawPosition:s,tournamentRecord:o,loserTargetLink:l,drawDefinition:u,loserMatchUp:c,dualMatchUp:d,matchUpsMap:p,event:f}=t,h="directLoser",m=l.linkCondition,g=c.drawPositions||[],I=m===fl&&c.roundNumber===2&&Math.min(...g.filter(Boolean)),v=I||g[e],w=I||g[1-e],y=l.source.structureId,{structure:b}=et({structureId:y,drawDefinition:u}),{matchUps:S}=kt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:u,structure:b,event:f}),U=S.filter(_=>_.drawPositions?.includes(s)).filter(_=>{let B=_.sides.find(j=>j.drawPosition===s),G=_.matchUpStatus===mi||_.matchUpStatus===Zt&&!dr(_);return B?.sideNumber===_.winningSide&&!G}),T=m===fl&&U.length===0,{positionAssignments:D}=cr({structureId:y,drawDefinition:u}),P=D?.find(_=>_.drawPosition===s)?.participantId,E={loserParticipantId:P},R=l.target.structureId,{positionAssignments:C}=cr({structureId:R,drawDefinition:u}),M=C?.filter(({drawPosition:_})=>g.includes(_)),N=M?.some(_=>_.participantId&&P&&_.participantId===P),A=n&&[jr,mi,Zt].includes(a||"");if(N)return{...H,stack:h};let O=M?.filter(_=>{let B=g.includes(_.drawPosition),G=!_.participantId&&!_.bye&&!_.qualifier;return B&&G}).map(_=>_.drawPosition),k=O?.includes(v),F=l.target.roundNumber>1&&O?.length,x=l.target.roundNumber===1&&k;if(I){let _=L();if(_.context&&Object.assign(E,_.context),_.error)return z({result:_,stack:h})}else if(x){let _=V();if(_.context&&Object.assign(E,_.context),_.error)return z({result:_,stack:h})}else if(P&&F){O.sort(ar);let _=O[0],B=ml({participantId:P,structureId:R,drawPosition:_,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:u,matchUpsMap:p,event:f});if(B.error)return z({result:B,stack:h});if(!B.error&&A&&n)return{stack:h,context:{progressExitStatus:!0,loserParticipantId:P}}}else return z({context:{loserDrawPosition:s,loserTargetLink:l,targetDrawPositionIsUnfilled:k},result:{error:k?lm:gIe},stack:h});if(b?.seedAssignments&&b.structureId!==R){let _=b.seedAssignments.find(({participantId:G})=>G===P),B=_?.participantId;_&&B&&Uv({eventId:c?.eventId,structureId:R,..._,tournamentRecord:o,drawDefinition:u,participantId:B})}if(d&&r){let _=d.sides?.find(B=>B.sideNumber===3-r);if(_?.lineUp){let{roundNumber:B,eventId:G}=c,{roundPosition:j}=d,Y=B===1?2-j%2:1,K=p?.drawMatchUps?.find(({matchUpId:Q})=>Q===c.matchUpId),X=[1,2].map(Q=>({...K.sides?.find(ae=>ae.sideNumber===Q)||{},sideNumber:Q}));K.sides=X;let Z=K.sides.find(Q=>Q.sideNumber===Y);Z&&(Z.lineUp=a0({lineUp:_.lineUp}),Tt({tournamentId:o?.tournamentId,matchUp:K,context:h,drawDefinition:u,eventId:G}))}}return z({result:{...H},stack:h,context:E});function L(){let _="loserLinkFedFMLC";return z(T?{result:V(),stack:_}:{result:$(),stack:_})}function $(){let _=Za({drawPosition:w,structureId:R,tournamentRecord:o,drawDefinition:u,event:f});return z({result:_,stack:"assignLoserPositionBye"})}function V(){let _=P?ml({drawPosition:v,participantId:P,structureId:R,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:u,matchUpsMap:p,event:f}):{error:ur};return!_.error&&A&&n?{stack:h,context:{progressExitStatus:!0}}:z({result:_,stack:"assignLoserDrawPosition"})}}function U9(t){let e="directParticipants",i=S0(t);if(i.error)return z({result:i,stack:e});let r=PS({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,matchUpStatusCodes:l,tournamentRecord:u,drawDefinition:c,matchUpStatus:d,dualMatchUp:p,matchUpsMap:f,winningSide:h,targetData:m,matchUpId:g,structure:I,matchUp:v,event:w}=t,y=!!v.collectionId,b=Wn({structure:I}),S=v.drawPositions,U;if(y){let{matchUpTieId:T,matchUpsMap:D}=t,P=Hc({appliedPolicies:t.appliedPolicies,matchUpId:T,tournamentRecord:u,drawDefinition:c,matchUpsMap:D,event:w});if(U=P&&{tieMatchUpResult:P},S=a.find(({matchUpId:E})=>E===T)?.drawPositions,!n)return z({result:{...H,...U},stack:e})}if(b)return z({result:{...H,...U},stack:e});if(S){let T=s?s-1:h-1,D=1-T,P=S[T],E=S[D],R={},{targetLinks:{loserTargetLink:C,winnerTargetLink:M,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:A,loserMatchUpDrawPositionIndex:O,winnerMatchUp:k,loserMatchUp:F,byeMatchUp:x}}=m;if(k){let L=yUe({sourceMatchUpStatus:r&&d||Oi,winnerMatchUpDrawPositionIndex:A,sourceMatchUpId:g,inContextDrawMatchUps:a,projectedWinningSide:s,winningDrawPosition:P,tournamentRecord:u,winnerTargetLink:M,drawDefinition:c,winnerMatchUp:k,dualMatchUp:p,matchUpsMap:f,event:w});if(L.error)return z({result:L,stack:e})}if(F){let L=bUe({sourceMatchUpStatus:r&&d||Oi,loserMatchUpDrawPositionIndex:O,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,loserDrawPosition:E,tournamentRecord:u,loserTargetLink:C,drawDefinition:c,loserMatchUp:F,matchUpsMap:f,dualMatchUp:p,event:w});if(L.context?.progressExitStatus&&Object.assign(R,L.context,{sourceMatchUpStatus:r&&d||Oi,sourceMatchUpStatusCodes:l||[],loserMatchUp:F,matchUpsMap:f}),L.error)return z({result:L,stack:e})}if(x){let L=x.drawPositions||[],$=Math.min(...L.filter(Boolean)),V=N.target.structureId,_=Za({drawPosition:$,structureId:V,tournamentRecord:u,drawDefinition:c,event:w});if(_.error)return z({result:_,stack:e})}return z({result:{...H,...U},stack:e,context:R})}else return z({result:{error:Gw},stack:e})}function T0(t){let e="genPlayoffStructure";if(!t.drawDefinition)return z({result:{error:_e},stack:e});let i=LS(t);if(i.error)return z({result:i,stack:e});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:s,finishingPositionLimit:o,playoffAttributes:l,playoffPositions:u,roundOffsetLimit:c,tournamentRecord:d,exitProfileLimit:p,roundProfiles:f,roundNumbers:h,idPrefix:m,isMock:g,event:I,uuids:v}=t,w=Oe(t.drawDefinition,!1,!0),{structure:y}=et({structureId:r,drawDefinition:w});if(!y)return z({result:{error:vi},stack:e});if(y.structureType===hn||y.structures)return mUe({sourceStructureId:y.structureId,...t,...i,drawDefinition:w});let{playoffRoundsRanges:b,playoffRounds:S}=i,{playoffPositionsReturned:U,error:T,playoffSourceRounds:D,playoffRoundsRanges:P}=m9(t);if(T)return z({result:{error:T},stack:e});let E=f?.length&&Object.assign({},...f),R=h||typeof f=="object"&&f.map(j=>Object.keys(j)).flat(),C=Array.isArray(R)&&R.map(j=>!isNaN(j)&&Ye(j)).filter(Boolean);if(C){if(!Array.isArray(C))return z({result:{error:ie},context:{validRoundNumbers:C},stack:e});C.forEach(j=>{if(!S?.includes(j))return z({result:{error:ie},context:{roundNumber:j},stack:e})})}u&&u.forEach(j=>{if(!U?.includes(j))return z({result:{error:ie},context:{playoffPosition:j},stack:e})});let M=C||D,N=C?b:P,A=[],O=[];for(let j of M??[]){let Y=N?.find(le=>le.roundNumber===j);if(!Y)return z({result:{error:ie},context:{roundNumber:j},stack:e});let K=Y.finishingPositions.length,X=Math.min(...Y.finishingPositions)-1,Z=2,Q=j&&E?.[j]&&Z+E[j]-1,ae=Yg({exitProfile:`0-${j}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:X,playoffAttributes:l,exitProfileLimit:p,stage:Ai,roundOffset:0,drawDefinition:w,sequenceLimit:Q,stageSequence:Z,drawSize:K,idPrefix:m,isMock:g,uuids:v,finishingPositionNaming:s,finishingPositionLimit:o,roundOffsetLimit:c});if(ae.error)return z({result:ae,stack:e});let{structures:te,links:ne}=ae;if(te?.length&&A.push(...te),ne?.length&&O.push(...ne),ae.structureId&&j){let le={linkType:hu,source:{structureId:r,roundNumber:j},target:{structureId:ae.structureId,feedProfile:Os,roundNumber:1}};O.push(le)}}if(!A.length)return z({result:{error:ie},info:"No structures generated",stack:e});w.structures.push(...A),w.links.push(...O);let{matchUps:k,matchUpsMap:F}=rr({inContext:!0,drawDefinition:w}),x=A.map(({structureId:j})=>j),L=k?.filter(({structureId:j})=>x.includes(j)).map(vr),$=F?.drawMatchUps?.filter(({matchUpId:j})=>L?.includes(j));if($?.length){let j=yn({drawDefinition:w,event:I})?.tieFormat;j&&$.forEach(Y=>{let{tieMatchUps:K}=Mm({matchUp:Y,tieFormat:j,isMock:g});Object.assign(Y,{tieMatchUps:K,matchUpType:ei})})}k?.filter(j=>bp({matchUp:j})&&j.structureId===r)?.forEach(j=>{let{matchUpId:Y,score:K,winningSide:X}=j,Z=_n({inContextDrawMatchUps:k,drawDefinition:w,matchUpId:Y}),Q=U9({inContextDrawMatchUps:k,tournamentRecord:d,drawDefinition:w,matchUpsMap:F,winningSide:X,targetData:Z,matchUpId:Y,structure:y,matchUp:j,score:K,event:I});Q.error&&console.log(Q.error)}),k?.filter(j=>j.matchUpStatus==="BYE"&&j.structureId===r)?.forEach(j=>{let{matchUpId:Y}=j,K=_n({inContextDrawMatchUps:k,drawDefinition:w,matchUpId:Y}),{targetLinks:{loserTargetLink:X},targetMatchUps:{loserMatchUpDrawPositionIndex:Z,loserMatchUp:Q}}=K;if(X&&Q){let ae=X.target.structureId,te=Q.drawPositions[Z],ne=Za({drawPosition:te,structureId:ae,tournamentRecord:d,drawDefinition:w,event:I});ne.error&&console.log(ne.error)}});let V=[],_=Lp({inContextDrawMatchUps:k,drawDefinition:w,matchUpsMap:F}).goesToMap,{structure:B}=et({drawDefinition:t.drawDefinition,structureId:r}),{matchUps:G}=kt({structure:B});return G.forEach(j=>{let Y=_?.loserMatchUpIds[j.matchUpId];if(Y&&j.loserMatchUpId!==Y){j.loserMatchUpId=Y;let X={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:j};V.push(X)}let K=_?.winnerMatchUpIds[j.matchUpId];if(K&&j.winnerMatchUpId!==K){j.winnerMatchUpId=K;let X={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:j};V.push(X)}}),{structures:A,matchUpModifications:V,links:O,drawDefinition:w,...H}}function T9({element:t}){if(!t)return{error:ie};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:ie};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function kl(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:D1};let a=w7(t);if(a.error)return a;if(!(St(n)&&ni(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:T1};if(!a.timeItems)a.timeItems=[];else if(wUe({element:a,duplicateValues:e,timeItem:n}))return{...H};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let s=new Date().toISOString();Object.assign(n,{createdAt:s})}return r&&(a.timeItems=a.timeItems.filter(({itemType:s})=>n.itemType!==s)),r&&!n.itemValue||a.timeItems.push(n),{...H}}function wUe({element:t,duplicateValues:e,timeItem:i}){let{itemType:r,itemSubTypes:n,itemValue:a}=i,s=r&&Ss({itemSubTypes:n,itemType:r,element:t})?.timeItem;return s&&JSON.stringify(s?.itemValue)===JSON.stringify(a)&&!e}function D0({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:ge};if(!n)return{error:ur};let s=Wd({tournamentRecord:i,participantId:n});return s.error?s:kl({element:s.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function BS(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:ge};let s=kl({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(s.error)return s;let o=T9({element:i});return nt({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:o},topic:cf}),s}function Nm(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?kl({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:ds}}function D9(t){return IC({...t,itemType:"attachConsolationStructures"})}function P0(t){return IC({...t,itemType:"attachPlayoffStructures"})}function IC({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:s}){let o="attachStructures";if(!r)return{error:_e};if(!Array.isArray(n)||!Array.isArray(a))return z({result:{error:ie},stack:o});let l=g=>[g.source.structureId,g.source.roundNumber||g.source.finishingPositions?.join("|"),g.target.roundNumber].join("|"),u=r.links?.map(l);if(a.some(g=>{let I=l(g);return u?.includes(I)}))return z({result:{error:N1},info:"playoff structure exists",stack:o});a.length&&r.links?.push(...a);let c=n.map(({structureId:g})=>g),d=r.structures?.map(({structureId:g})=>g);r.structures=(r.structures??[]).map(g=>c.includes(g.structureId)?n.find(({structureId:I})=>I===g.structureId):g);let p=n?.filter(({structureId:g})=>!d?.includes(g));p.length&&r.structures.push(...p),Lp({drawDefinition:r});let f=n.map(g=>kt({structure:g})?.matchUps||[]).flat();wd({tournamentId:i?.tournamentId,eventId:s?.eventId,drawDefinition:r,matchUps:f});let h=n.map(({structureId:g})=>g);if(ii({drawDefinition:r,structureIds:h}),e?.length){let g={};e.forEach(v=>{let w=v.matchUp?.matchUpId;w&&(g[w]=v)});let I=v=>{v.matchUps.forEach(w=>{if(g[w.matchUpId]){let{tieMatchUps:y,...b}=g[w.matchUpId].matchUp;if(Object.assign(w,b),y?.length){let S={};y.forEach(U=>g[U.matchUpId]=U),w.tieMatchUps.forEach(U=>Object.assign(U,S[U.matchUpId]))}g[w.matchUpId].matchUp=w,Tt(g[w.matchUpId])}})};r.structures.forEach(v=>{if(d?.includes(v.structureId))if(v.structures)for(let w of v.structures)I(w);else I(v)})}let m=p.map(Pa("structureId"));if(i){let g={itemValue:{structureIds:h,drawId:r.drawId},itemType:t};kl({element:i,timeItem:g})}return{...H,addedStructureIds:m}}function vC(t){let{structures:e,links:i,matchUpModifications:r,error:n}=T0(t);if(n)return{error:n};let a=t.drawDefinition;return P0({tournamentId:t.tournamentRecord?.tournamentId,eventId:t.event?.eventId||t.eventId,matchUpModifications:r,drawDefinition:a,structures:e,links:i})}function $p(t){let e=Ge(t,[{_anyOf:{[dn]:!1,[mr]:!1,[mn]:!1,[$c]:!1},[K1]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=KW(t,r);if(n.error)return n;i.push(...n?.applied??[]),t.drawDefinition&&ii({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ge};for(let a of n){let s=t.tournamentRecords[a],o=KW(t,s);if(o.error)return o;i.push(...o?.applied??[])}}else return{error:ge};return i.length?{...H,applied:i}:{error:I1}}function KW(t,e){let i=Rt(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:uR};for(let a of n)if(!i[a]||t.allowReplacement){let s=t.policyDefinitions[a];if(!s)continue;if(!St(s))return{error:ie};let{policyName:o,...l}=s;if(!l||!Object.keys(l).length||o&&!ni(o))return{error:ie};i[a]=t.policyDefinitions[a],r.push(a)}return r?.length?{...gt({element:e,extension:{name:Bb,value:i}}),applied:r}:{applied:r,error:I1}}function E0({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){if(!r||typeof r!="string")return z({result:{error:ie},context:{drawName:r}});i||(i=Bi({event:a}).flightProfile);let s=i?.flights?.find(o=>o.drawId===n);if(s){s.drawName=r;let o={name:eo,value:{...i,flights:i.flights}};Gd({event:a,extension:o})}return e&&(e.drawName=r,ii({tournamentId:t?.tournamentId,drawDefinition:e})),!s&&!e?{error:_e}:{...H,flight:s}}function P9({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){if(!St(i))return{error:ie};let a=Bi({event:n}).flightProfile,s=i.drawName&&E0({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:r,event:n});if(s?.error)return s?.error;let o=s?.flight||a?.flights?.find(l=>l.drawId===r);if(!o&&!e)return{error:_e};if(o){let l={name:eo,value:{...a,flights:a.flights}};Gd({event:n,extension:l})}return e&&(i.policyDefinitions&&$p({policyDefinitions:i.policyDefinitions,drawDefinition:e}),ii({tournamentId:t?.tournamentId,drawDefinition:e})),{...H}}function E9({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){if(!i)return{error:_e};let r=Or({drawDefinition:i}),n=s=>r?.drawMatchUps?.find(o=>o.matchUpId===s);for(let s of i.structures||[]){let{positionAssignments:o,stage:l,stageSequence:u}=s;o&&(u!==1||![We,Fe].includes(l))&&(s.positionAssignments=o.map(p=>(delete p.participantId,p)),s.seedAssignments=[]);let{matchUps:c,isRoundRobin:d}=kt({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:s});for(let p of c){let{matchUpId:f,roundNumber:h}=p,m=p.sides||[],g=n(f);if(g){if(delete g.extensions,delete g.notes,g.matchUpStatus!=="BYE"&&Object.assign(g,gC),h&&h>1&&g.drawPositions?.length&&!d){let I=m?.map(({drawPosition:w,participantFed:y})=>!y&&w).filter(Boolean),v=g.drawPositions.map(w=>I.includes(w)?void 0:w);g.drawPositions=v}e?delete g.timeItems:g.timeItems?.length&&(g.timeItems=g.timeItems.filter(I=>I.itemType&&![vu,Ud,bm,xL,wm,Sm].includes(I.itemType))),Tt({tournamentId:t?.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:g})}}}i.extensions=i.extensions.filter(s=>s.name!==qg);let a=(i.structures||[]).map(({structureId:s})=>s);return ii({drawDefinition:i,structureIds:a}),{...H}}function VS({tournamentRecord:t}){if(!t)return{error:ge};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return(t.events?.flatMap(r=>{let n=r.eventId;return i[n]=r,(r?.drawDefinitions||[]).map(a=>({drawDefinition:a,eventId:n}))}).filter(Boolean)).forEach(({drawDefinition:r,eventId:n})=>{let a=0,s=0,o=0,{allStructuresLinked:l}=pC({drawDefinition:r}),u=i[n],c=(r?.structures||[]).map(w=>{let{stage:y,stageSequence:b,structureId:S}=w,U=xh[y],{inContextStructureMatchUps:T}=yv({drawDefinition:r,structureId:S,structure:w,event:u}),D=T?.filter(({winningSide:$})=>$),P=D.filter(Boolean).length||0;s+=P,o+=T.length-s;let E=Math.max(D.filter(({roundNumber:$})=>$===1).map(({roundPosition:$})=>$)),{positionAssignments:R}=Kt({structure:w}),C=R?.filter(({participantId:$})=>$);a+=C?.length??0;let M=(R?.length??0)-(C?.length??0),{roundMatchUps:N,roundProfile:A,roundNumbers:O,maxMatchUpsCount:k}=wn({matchUps:T}),F=A&&Object.keys(A).filter($=>!A[$].inactiveRound).map($=>Number.parseInt($)),x=A&&Object.keys(A).filter($=>A[$].inactiveRound).map($=>Number.parseInt($)),L=A&&Object.values(A).every($=>$.inactiveRound);return{positionsAssignedCount:C?.length??0,maxWinningSideFirstRoundPosition:E,unassignedPositionsCount:M,inactiveStructure:L,maxMatchUpsCount:k,inactiveRounds:x,roundMatchUps:N,activeRounds:F,roundNumbers:O,roundProfile:A,structureId:S,stageSequence:b,orderNumber:U,stage:y}}),d=c.find(w=>w.orderNumber===2&&w.stageSequence===1),p=c.filter(({inactiveStructure:w})=>!w).length,{links:f}=Iv({structureId:d.structureId,drawDefinition:r}),h=Ye(d.activeRounds[0])===1&&d.activeRounds.length===1&&p===1,m=c?.every(({inactiveStructure:w})=>w),g=!f.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),I=r.drawId;a&&!s&&e.positionsNoOutcomes.push(I),m&&e.inactive.push(I),h&&e.matchPlay.push(I),g&&e.canBePruned.push(I);let v={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:o,positionsAssignedCount:a,allStructuresLinked:l,structuresData:c,inactiveDraw:m,isMatchPlay:h,drawId:I};e.drawAnalysis[I]=v}),{...H,drawsAnalysis:e}}function R9({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){if(!e)return{error:ge};if(!i)return{error:_e};let n=[],{drawsAnalysis:a}=VS({tournamentRecord:e});if(a.canBePruned.includes(r)){let s=a.matchPlay.includes(r),o=a.drawAnalysis[r],{structures:[l]}=to({stageSequence:1,drawDefinition:i,stage:Fe}),u=o.structuresData.find(({structureId:f})=>l.structureId===f),c=(l.matchUps??[]).sort((f,h)=>f.roundPosition-h.roundPosition);n=c.filter(({roundNumber:f})=>!u.inactiveRounds.includes(f));let d=n.map(vr),p=c.map(vr).filter(f=>!d.includes(f));if(s){let f=n.filter(({roundNumber:v})=>!u.inactiveRounds.includes(v)).filter(({winningSide:v})=>v),h=f.map(vr),m=d.filter(v=>!h.includes(v));p.push(...m);let g=f.flatMap(v=>v.drawPositions??[]).filter(Boolean).flat(),I=Object.assign({},...g.map((v,w)=>({[v]:w+1})));if(f.forEach(v=>{t?v.drawPositions=v.drawPositions.map(w=>I[w]):delete v.drawPositions}),t){let v=l?.positionAssignments?.filter(w=>g.includes(w.drawPosition)).map(w=>(w.drawPosition=I[w.drawPosition],w));l.positionAssignments=v}else l.positionAssignments=[];l.matchUps=f,n=f}Fu({tournamentId:e?.tournamentId,matchUpIds:p,drawDefinition:i}),ii({drawDefinition:i})}return{...H,matchUps:n}}function SUe({isPositionAction:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,loserMatchUp:n,matchUpsMap:a,structureId:s,structure:o,event:l}){if(!i)return{error:_e};if(o||({structure:o}=et({drawDefinition:i,structureId:s})),!o)return{error:vi};s||({structureId:s}=o);let u="assignDrawPositionQualifier";Ht({method:u,color:"cyan",drawPosition:r}),a??=Or({drawDefinition:i});let{positionAssignments:c}=Kt({structure:o}),{activeDrawPositions:d}=yv({drawDefinition:i,structureId:s});if(c?.find(I=>I.drawPosition===r)?.qualifier)return{...H};let p=!!(n&&a.drawMatchUps.some(I=>I.loserMatchUpId===n?.matchUpId&&$r(I.matchUpStatus)));if(d?.includes(r)&&!p)return{error:Hw};let f=c?.find(I=>I.drawPosition===r);if(!f)return{error:lm};let{containsQualifier:h,containsParticipant:m}=jL(f);if(h)return{...H};let g=Rt({tournamentRecord:e,drawDefinition:i,event:l}).appliedPolicies??{};return c?.forEach(I=>{I.drawPosition===r&&(I.qualifier=!0,p&&(I.participantId=void 0,console.log("oddity: invalid participantId on qualifier position cleared")))}),bc({tournamentId:e?.tournamentId,drawDefinition:i,structure:o,event:l}),UUe({assignedParticipantId:m,isPositionAction:t,appliedPolicies:g,drawDefinition:i,drawPosition:r,structureId:s,stack:u})}function UUe({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&dS({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),z({result:{...H},stack:s})}function C9({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:s,bye:o}){if(!e)return{error:_e};if(!r)return{error:av};if(!n)return{error:Ka};if(o){let l=Za({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else if(a){let l=SUe({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else{let l=ml({participantId:i,tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}return{...H}}function M9(t){let e=t.matchUpIds??[],{drawDefinition:i}=t,r=t.structureId??i?.structures?.find(l=>l.matchUps?.some(({matchUpId:u})=>e.includes(u)))?.structureId??i?.structures?.[0]?.structureId;if(!r)return{error:vi};let n=i.structures?.find(l=>l.structureId===r);if(!n)return{error:vi};let a=n?.matchUps,s=a?.find(l=>!!l.roundPosition);if(n.structures||s||n.finishingPosition===gm)return{error:af};let o=a.filter(({roundNumber:l})=>t.roundNumbers?.includes(l)).map(vr);return e=e.filter(l=>!o.includes(l)),t.roundNumbers&&!e.length&&(e=o),{existingMatchUps:a,matchUpIds:e,structureId:r,structure:n}}function N9(t){let e=Ge(t,[{[mn]:!0},{[cI]:{[aS]:!1,roundNumbers:!1},[Ha]:ie,[Xn]:sn}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:s,event:o}=t,l=M9(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,f=[],h=d?.filter(({matchUpId:I,score:v,winningSide:w})=>{if(w&&!n)return!1;if(w||dr({score:v})){if(!w&&!i)return!1;f.push(I)}else if(!r)return!1;return p?.includes(I)})??[],m=h.map(vr),g=h.map(({tieMatchUps:I})=>I?.map(vr)).filter(Boolean).flat();if(m.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:w})=>!m.includes(w)),Fu({tournamentId:a?.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:o?.eventId,drawDefinition:s});let I=ot(u.matchUps.map(Pa("roundNumber"))),v=pIe(I);if(v.length){v.reverse();for(let w of v)u.matchUps.forEach(y=>{y.roundNumber&&y.roundNumber>w&&(y.roundNumber-=1,Tt({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:o?.eventId,drawDefinition:s,matchUp:y}))})}if(f.length){u.positionAssignments=ot(u.matchUps.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U}));let w=u?.matchUpFormat??s?.matchUpFormat??o?.matchUpFormat,y=l.existingMatchUps.some(U=>U.matchUpType===Va)?{matchUpTypes:[Va]}:void 0,{matchUps:b}=kt({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:y,structure:u,event:o});Wn({structure:u})&&(u.positionAssignments=ot(b.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U})));let S=b0({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:s,matchUpFormat:w,matchUps:b,event:o});S.error&&console.log(S)}ii({structureIds:[c],eventId:o?.eventId,drawDefinition:s})}return!m.length&&p.length?{error:Kw}:{...H,deletedMatchUpsCount:[...m,...g].length}}function A9({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:ge};if(!i)return{error:_e};if(!n)return z({result:{error:Xe},info:"roundNumber required"});let s=et({drawDefinition:i,structureId:r});if(s.error)return s;let o=s.structure;return o?.structures?{error:af}:Wn({structure:o})?TUe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:o}):(console.log("not implemented"),{...H})}function TUe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let s=n?.matchUps??[],o=[],l=[],u=!1;if(s.reduce((c,d)=>{let p=d?.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(ar).includes(r)){let c=s.filter(d=>{let p=d.roundNumber===r&&(!Ji.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&o.push(...d.tieMatchUps.map(vr))),!p});l.length&&(Fu({matchUpIds:[...o,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===r)||(c.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Tt({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),n.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...H}}function yC(t){let{suppressNotifications:e,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=t;if(typeof r!="object")return{error:_e};let s=t?.structureId;if(!s&&r.structures?.length===1&&(s=r.structures?.[0]?.structureId),typeof s!="string")return{error:Ka};if(!Ja(n))return{error:ie,info:_p("matchUps")};let o=r.structures?.find(p=>p.structureId===s);if(!o)return{error:vi};let l=(o?.matchUps).find(p=>!!p.roundPosition);if(o.structures||l||o.finishingPosition===gm)return{error:af};let u=wr({tournamentRecord:i,inContext:!1})?.matchUps?.map(vr)??[],c=n.map(vr);if(Ln(u,c))return{error:gK,info:"One or more matchUpIds already present in tournamentRecord"};o.matchUps.push(...n);let d=n.map(({tieMatchUps:p})=>p).filter(Boolean).flat();return e||(wd({tournamentId:i?.tournamentId,matchUps:[...d,...n],eventId:a?.eventId,drawDefinition:r}),ii({drawDefinition:r,structureIds:[s]})),{...H}}function k9({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){if(!e)return{error:_e};if(!r)return{error:Ka};if(!i)return{error:av};let{structure:s}=et({drawDefinition:e,structureId:r});if(!s)return{error:vi};let o=s;s.structures&&s.structureType===hn&&(o=s.structures?.find(f=>f.positionAssignments?.find(h=>h.drawPosition===i)));let l=o?.positionAssignments,u=l?.find(f=>f.drawPosition===i);u&&gt({element:u,extension:{name:pI,value:n}});let c=(a?.eventType===ei||e.matchUpType===ei||(a?.tieFormat??e?.tieFormat??s?.tieFormat))&&{matchUpTypes:[ei]},{matchUps:d}=kt({structure:o,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:c,event:a}),p=s?.matchUpFormat??e.matchUpFormat;return b0({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),ii({drawDefinition:e,structureIds:[r]}),{...H}}var O9={};pt(O9,{addGoesTo:()=>Lp,allPlayoffPositionsFilled:()=>u0,checkValidEntries:()=>UC,findDrawDefinition:()=>N0,getAssignedParticipantIds:()=>If,getAvailableMatchUpsCount:()=>bC,getAvailablePlayoffProfiles:()=>LS,getDrawDefinitionTimeItem:()=>EL,getDrawParticipantRepresentativeIds:()=>C0,getDrawStructures:()=>to,getDrawTypeCoercion:()=>HS,getEligibleVoluntaryConsolationParticipants:()=>R0,getMatchUpsMap:()=>Or,getParticipantIdFinishingPositions:()=>M0,getPositionAssignments:()=>vI,getPositionsPlayedOff:()=>Dv,getRandomQualifierList:()=>O0,getSeedingThresholds:()=>r0,getSeedsCount:()=>WS,getStructureSeedAssignments:()=>ms,getTeamLineUp:()=>Fp,getValidGroupSizes:()=>AS,isAdHoc:()=>Wn,isCompletedStructure:()=>yu,isValidForQualifying:()=>x0,positionActions:()=>k0});function R0({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:s,drawDefinition:o,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:f}){if(!o)return{error:_e};let h=[Fe,Ai];i&&h.push(We);let m=f?.eventType?{matchUpTypes:[f.eventType]}:void 0,g=o?.matchUpType?{matchUpTypes:[o.matchUpType]}:void 0,I=e&&f?Lu({contextFilters:{stages:h},matchUpFilters:m,tournamentRecord:s,inContext:!0,event:f})?.matchUps??[]:Nn({contextFilters:{stages:h},matchUpFilters:g,tournamentRecord:s,inContext:!0,drawDefinition:o})?.matchUps??[],v=ym({stage:Rr,drawDefinition:o}),w=new Set(v.map(({participantId:F})=>F)),y={},b={},S={},U={};n??=jc({policyTypes:[_O],tournamentRecord:s,drawDefinition:o,event:f}).policyDefinitions;let T=n?.[_O];t=t.length&&t||T?.excludedMatchUpStatuses||[],e=e??T?.includeEventParticipants,d=d??T?.allEntries,r=r??T?.finishingRoundLimit,a=a??T?.roundNumberLimit,l=l??T?.matchUpsLimit,u??=T?.requirePlay??!0,c??=T?.requireLoss??!0,p=p??T?.winsLimit;for(let F of I){if(u&&F.winningSide&&![1,2].includes(F.winningSide)&&F.matchUpStatus!==Si||F.finishingRound&&r&&F.finishingRound>=r||F.finishingRound&&a&&F.finishingRound<=a)continue;let x=F.sides?.find(({sideNumber:$})=>F.winningSide&&$===3-F.winningSide),L=F.sides?.find(({sideNumber:$})=>F.winningSide&&$===F.winningSide);if(F.sides?.forEach($=>{let V=$?.participant?.participantId;V&&(S[V]=$.participant,F.matchUpStatus===Si&&!u&&(b[V]=$.participant,y[V]||(y[V]=0),(!F.matchUpStatus||!t.includes(F.matchUpStatus))&&(y[V]+=1)))}),x?.participant){let $=x.participant.participantId;b[$]=x.participant,y[$]||(y[$]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[$]+=1)}if(L?.participant){let $=L.participant.participantId;U[$]||(U[$]=0),U[$]+=1,y[$]||(y[$]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[$]+=1)}}let D=s?.participants&&!u&&!c&&d,P;e&&f?P=f.entries:P=o.entries;let E=D?(P??[]).filter(F=>![Sc,Us].includes(F.entryStatus)).map(({participantId:F})=>F):[],R=Object.keys(b),C=D?(s?.participants??[]).filter(({participantId:F})=>E.includes(F)):c&&Object.values(b)||Object.values(S),M=F=>!c||R.includes(F),N=F=>!u||(y[F]||0)>=0,A=F=>!p||(U[F]||0)<=p,O=F=>!l||y[F]<=l,k=F=>!w.has(F);return{eligibleParticipants:C.filter(F=>M(F.participantId)&&N(F.participantId)&&A(F.participantId)&&O(F.participantId)&&k(F.participantId)).map(F=>({...F,individualParticipants:F.individualParticipantIds?.map(x=>s?.participants?.find(L=>L.participantId===x))})),losingParticipantIds:R,...H}}function bC(t){let e=Ge(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:r}=t,n=t.structureId??(i.structures?.length===1&&i.structures?.[0]?.structureId);if(typeof n!="string")return{error:Ka};let a=i.structures?.find(h=>h.structureId===n);if(!a)return{error:vi};let s,o=(a.matchUps??[])?.reduce((h,m)=>(m.roundPosition&&(s=!0),(m?.roundNumber||0)>h?m.roundNumber:h),0);if(a.structures||s||a.finishingPosition===gm)return{error:af};let l=i?.entries?.filter(h=>{let m=h.entryStatus;return co.includes(m)})??[],u=Math.floor(l?.length/2)||1,c=r??o??1,d=a.matchUps?.filter(h=>h.roundNumber===c)?.length??0,p=u-d,f=p>0?p:0;return{...H,availableMatchUpsCount:f,lastRoundNumber:o,roundMatchUpsCount:u}}function C0({drawDefinition:t}){let e=it({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:e.extension?.value||[]}}function DUe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:_e};let r=rr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=Oe(r.matchUps,!1,!0),a=ot(n.reduce((o,l)=>o.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),s=Object.assign({},...a.map(o=>{let l=n.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(o));return{[o]:l}}));return{participantIds:a,participantIdMatchUps:s}}function vI({tournamentRecord:t,drawDefinition:e,stage:i=Fe,structureId:r,structure:n}){if(!t)return{error:ge};if(!n&&!e)return{error:_e};if(!n&&!r&&e?.structures?.filter(o=>o.stage===i).length===1&&(n=e.structures.find(o=>o.stage===i)),!n&&!r)return{error:Ka};let{error:a,positionAssignments:s}=Kt({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:s??[],structureId:n?.structureId,error:a}}function x9({dates:t=[],extension:e}){if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=St(e.value)?e.value?.dates:void 0;if(Array.isArray(i))return i?.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function PUe({inContextCourt:t,venue:e}){let{defaultStartTime:i,defaultEndTime:r,dateAvailability:n}=e;if(!(i||r||n?.length))return;let a=t.dateAvailability;if(!a?.length){n?.length?t.dateAvailability=n.map(s=>({...s})):i&&r&&(t.dateAvailability=[{startTime:i,endTime:r}]);return}t.dateAvailability=a.map(s=>{let o=EUe({date:s.date,venueDateAvailability:n,defaultStartTime:i,defaultEndTime:r});if(!o)return s;let l=RUe(s.startTime,o.startTime),u=CUe(s.endTime,o.endTime),c=MUe(s.bookings,o.bookings);return{...s,startTime:l,endTime:u,...c.length?{bookings:c}:{}}})}function EUe({date:t,venueDateAvailability:e,defaultStartTime:i,defaultEndTime:r}){if(e?.length){if(t){let a=e.find(s=>s.date===t);if(a)return a}let n=e.find(a=>!a.date);if(n)return n}if(i||r)return{startTime:i,endTime:r}}function RUe(t,e){return t?e?t>e?t:e:t:e}function CUe(t,e){return t?e?t<e?t:e:t:e}function MUe(t,e){let i=[];return t?.length&&i.push(...t),e?.length&&i.push(...e),i}function F9({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){let n={...Oe(r,t,!0),venueId:i.venueId},{extension:a}=it({name:To,element:r});if(e&&a){let s=St(a.value)?a.value?.dates:void 0,o=a?.value===!0?[]:n.dateAvailability.map(l=>{let u=l.date;if(!(!u||s.includes(u)))return l}).filter(Boolean);n.dateAvailability=o}return PUe({inContextCourt:n,venue:i}),{inContextCourt:n}}function NUe(t,e,i){if(e.length&&!e.includes(t.venueId))return!1;if(i){let{extension:r}=it({name:To,element:t});if(r?.value)return!1}return!0}function AUe({venue:t,convertExtensions:e,ignoreDisabled:i,dates:r,uniqueVenueIds:n,venues:a,uniqueCourtIds:s,courts:o}){n.includes(t.venueId)||(a.push(Oe(t,e,!0)),n.push(t.venueId));for(let l of t.courts??[])if(!s.includes(l.courtId)){if(i){let{extension:c}=it({name:To,element:l});if(x9({extension:c,dates:r}))continue}let{inContextCourt:u}=F9({convertExtensions:e,ignoreDisabled:i,venue:t,court:l});o.push(u),s.push(l.courtId)}}function _u(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},s=[],o=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])NUe(p,r,!!i)&&AUe({venue:p,convertExtensions:e,ignoreDisabled:i,dates:n,uniqueVenueIds:s,venues:u,uniqueCourtIds:o,courts:l})}),{courts:l,venues:u,...H}}function kUe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:Ri};let n=Oe(e.venues??[],t).filter(s=>{if(!i)return s;let{extension:o}=it({name:To,element:s});return!o?.value&&s}).filter(Boolean),a=n.reduce((s,o)=>{let l=(o?.courts||[]).filter(u=>{if(!i&&!r?.length)return u;let{extension:c}=it({name:To,element:u});return x9({extension:c,dates:r})}).filter(Boolean).map(u=>{let{inContextCourt:c}=F9({convertExtensions:t,ignoreDisabled:i,venue:o,court:u});return c});return l.length?s.concat(l):s},[]);return{venues:n,courts:a}}function jS({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Ri}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:s}=kUe({tournamentRecord:a,dates:i});return s?.forEach(o=>{let{venueId:l,courts:u}=o;(!e||u?.length)&&!r.venueIds.includes(l)&&(r.venues.push(o),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function L9({event:t}){let{surfaceCategory:e,onlineResources:i,matchUpFormat:r,discipline:n,eventLevel:a,eventName:s,eventType:o,startDate:l,category:u,ballType:c,eventId:d,endDate:p,gender:f,notes:h}=t;return{eventInfo:{drawDefinitionCount:t.drawDefinitions?.length,surfaceCategory:e,onlineResources:i,matchUpFormat:r,discipline:n,eventLevel:a,eventName:s,eventType:o,ballType:c,startDate:l,category:u,endDate:p,eventId:d,gender:f,notes:h}}}var OUe="IN_PROGRESS",xUe="ABANDONED",FUe="CANCELLED",LUe="COMPLETED",_Ue="ACTIVE",_9="tournamentImage",$9={TOURNAMENT_IMAGE_RESOURCE_NAME:_9,IN_PROGRESS:OUe,ABANDONED:xUe,CANCELLED:FUe,COMPLETED:LUe,ACTIVE:_Ue},$Ue={[sS]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},BUe=$Ue;function Am(t){let{tournamentRecord:e,withMatchUpStats:i,withStructureDetails:r,withVenueData:n}=t??{};if(!e)return{error:ge};let a=(({tournamentId:h,tournamentRank:m,tournamentStatus:g,formalName:I,tournamentName:v,promotionalName:w,onlineResources:y,localTimeZone:b,activeDates:S,startDate:U,endDate:T,hostCountryCode:D,venues:P,notes:E,updatedAt:R})=>({tournamentId:h,tournamentRank:m,tournamentStatus:g,formalName:I,tournamentName:v,promotionalName:w,onlineResources:y,localTimeZone:b,activeDates:S,startDate:U,endDate:T,hostCountryCode:D,venues:P,notes:E,updatedAt:R}))(e),s=e.venues?.find(h=>h.isPrimary);s?.addresses?.length&&(a.tournamentAddress=s.addresses[0]);let o=Pi({participantFilters:{participantRoles:[S8,KL,U8,T8,P8]},policyDefinitions:BUe,tournamentRecord:e})?.participants??[];o&&(a.tournamentContacts=o);let l=e?.onlineResources?.find(h=>h.name===_9&&h.resourceType==="URL")?.identifier;l&&(a.imageUrl=l);let u=Pm({tournamentRecord:e})?.publishState,c=u?.tournament?.status?.publishedEventIds||[],d=[];for(let h of e.events??[])if(!t?.usePublishState||c.includes(h.eventId)){let m=L9({event:h}).eventInfo;m&&d.push(m)}a.timeItemValues=T9({element:e}),a.publishState=u?.tournament,a.eventInfo=d;let p=[],f=[];if(i||r)for(let h of e.events??[])for(let m of h.drawDefinitions??[])for(let g of m.structures??[])f.push(...g.matchUps??[]),p.push(Ve({eventId:h.eventId,eventName:h.eventName,eventType:h.eventType,drawId:m.drawId,drawName:m.drawName,drawType:m.drawType,structureId:g.structureId,structureName:g.structureName,stage:g.stage,stageSequence:g.stageSequence,positionAssignments:g.positionAssignments,seedAssignments:g.seedAssignments,matchUpFormat:g.matchUpFormat}));if(r&&(a.structures=p),i){let h=e.participants?.filter(S=>S.participantType===vt).length??0,m=e.participants?.filter(S=>S.participantType===_t).length??0,g=e.events?.length??0,I=f?.filter(S=>S.matchUpStatus!=="BYE"),v=I?.length,w=I?.filter(S=>Ji.includes(S.matchUpStatus)||S.winningSide)?.length,y=I?.filter(S=>gf({matchUp:S})?.scheduledDate||LL({matchUp:S})?.scheduledTime)?.length,b=v>0?Math.round(w/v*100):0;a.matchUpStats={total:v,completed:w,scheduled:y,percentComplete:b},a.individualParticipantCount=h,a.teamParticipantCount=m,a.eventCount=g}if(n){let{venues:h}=_u({tournamentRecord:e});a.venues=h??[]}return{tournamentInfo:Oe(Ve(a),!1,!0),...H}}function B9({publishStatus:t,drawId:e}){return t?.drawDetails?qo(t.drawDetails?.[e]?.publishingDetail):t?.drawIds?t.drawIds.includes(e):!0}var V9="PUBLIC",VUe="ADMIN",jUe={PUBLIC_DISPLAY:V9,ADMIN_DISPLAY:VUe};function wC(t){let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:s,status:o=Qa,pressureRating:l,refreshResults:u,contextProfile:c,drawDefinition:d,noDeepCopy:p,sortConfig:f,context:h,event:m}=t;if(!d)return{error:_e};let{matchUpFormat:g,updatedAt:I,drawType:v,drawName:w,drawId:y}=d,b={matchUpFormat:g,updatedAt:I,drawName:w,drawType:v,drawId:y};b.display=it({element:d,name:dP}).extension?.value;let S={},U,T,{allStructuresLinked:D,sourceStructureIds:P,hasDrawFeedProfile:E,structureGroups:R}=pC({drawDefinition:d});if(!D)return{error:y4};let C=t?.eventPublishState??Pm({event:m}).publishState,M=t?.publishStatus??Oa({event:m,status:o}),N=C?.status?.drawDetails?.[d.drawId],A=!!C?.status?.published,O=N?.structureDetails,k=!1,F=!1,x=R.map(L=>{let $={},V=L.map(_=>{let{structure:B}=et({drawDefinition:d,structureId:_}),{seedAssignments:G}=ms({drawDefinition:d,structure:B});return B?.stage===Fe&&B.stageSequence===1&&(U=G),B?.stage===We&&(S[B.stageSequence??0]=G),B}).sort((_,B)=>vm(_,B,f)).map(_=>{if(!_)return;let B=_?.structureId,G=[];_.stage&&[Fe,en,Ai].includes(_.stage)&&(G=U),_?.stage===We&&(G=S[_.stageSequence??0]);let{matchUps:j,roundMatchUps:Y,roundProfile:K}=kt({seedAssignments:_?.seedAssignments?.length?void 0:G,context:{drawId:b.drawId,...h},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:e,policyDefinitions:r,tournamentRecord:n,usePublishState:s,publishStatus:M,contextProfile:c,drawDefinition:d,inContext:a,structure:_,event:m}),{positionAssignments:X}=Kt({structure:_}),Z=X?.filter(Pa(gu)).map(ne=>{let le=it({element:ne,name:yc})?.extension?.value,{drawPosition:de,participantId:pe}=ne;return F=!0,{participantResult:le,participantId:pe,drawPosition:de}});if(j.length&&(!Z?.length&&t.allParticipantResults||u&&!_.structures)){let{subOrderMap:ne}=zL({positionAssignments:X}),le=j.some(pe=>pe.matchUpType===Va)?j.filter(pe=>pe.matchUpType===Va):j,de=Dm({matchUpFormat:_.matchUpFormat,matchUps:le,policyDefinitions:r,pressureRating:l,subOrderMap:ne});T=de?.report,Z=X?.filter(Pa(gu)).map(pe=>{let{drawPosition:ve,participantId:Me}=pe;return F=!0,{participantResult:Me&&de?.participantResults?.[Me],participantId:Me,drawPosition:ve}})}let Q=_?{stageSequence:_.stageSequence,structureName:_.structureName,structureType:_.structureType,matchUpFormat:_.matchUpFormat,stage:_.stage}:{},ae=it({element:_,name:dP}).extension?.value;Q.display=ae?.[V9]??ae,Q.sourceStructureIds=P[B],Q.hasDrawFeedProfile=E[B],Q.positionAssignments=X,Q.structureActive=j.reduce((ne,le)=>{let de=[Si,Wi,uo,Oi,Bc,Zt,jr,mi].includes(le.matchUpStatus);return ne||de||!!le.winningSide||!!le.score?.scoreStringSide1},!1);let te=j.every(ne=>[...Ji,"BYE"].includes(ne.matchUpStatus));return Q.structureCompleted=te,$[B]=te,Q.structureActive&&(k=!0),{...Q,participantResults:Z,seedAssignments:G,roundMatchUps:Y,roundProfile:K,structureId:B,report:T}});return V.forEach(_=>{i||delete _.positionAssignments,_.sourceStructuresComplete=_.sourceStructureIds?.every(B=>$[B])}),V}).flat().filter(L=>!s||qo(O?.[L?.structureId])||!0);return b.drawActive=k,b.participantPlacements=F,b.drawGenerated=x?.reduce((L,$)=>L||!!$?.roundMatchUps,!1),b.drawCompleted=x?.reduce((L,$)=>L&&$.structureCompleted,!0),b.drawPublished=s?A&&B9({publishStatus:M,drawId:b.drawId}):void 0,{structures:!s||b.drawPublished?p&&x||Oe(x,!1,!0):void 0,drawInfo:p?b:Oe(b,!1,!0),...H}}function GS(t){let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=Qa,contextProfile:s,sortConfig:o}=t,l=Ge(t,[{tournamentRecord:!0},{[iL]:{event:!1,eventId:!1}}]);if(l.error)return l;let u=Oe(t.tournamentRecord,!1,!0),c=t.event==null?zn({tournamentRecord:u,eventId:t.eventId}).event:void 0,d=t.event?Oe(t.event,!1,!0):c&&Oe(c,!1,!0)||void 0;if(!d)return{error:ds};let{eventId:p}=d,{tournamentId:f,endDate:h}=u,m=Oa({event:d,status:a}),g=Pm({event:d}).publishState??{},I=!!g?.status?.published,{participants:v}=Pi({participantFilters:t.participantFilters,withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:u}),w=({stage:C,drawId:M})=>{if(!n)return!0;let N=m?.drawDetails?.[M]?.stageDetails;return!N||!Object.keys(N).length?!0:qo(N[C])},y=({structureId:C,drawId:M})=>{if(!n)return!0;let N=m?.drawDetails?.[M]?.structureDetails;return!N||!Object.keys(N).length?!0:qo(N[C])},b=({drawId:C})=>n?B9({publishStatus:m,drawId:C}):!0,S=({drawId:C,drawType:M,structure:N})=>{if(!n||M!==ca)return N;let A=m?.drawDetails?.[C]?.structureDetails?.[N.structureId]?.roundLimit;if(ut(A)){let O=Re(1,A+1),k={},F={};for(let x of O)N.roundMatchUps[x]&&(k[x]=N.roundMatchUps[x],F[x]=N.roundProfile[x]);N.roundMatchUps=k,N.roundProfile=F}return N},U=d.drawDefinitions||[],T=!n||I?U.filter(b).map(C=>(({drawInfo:M,structures:N})=>({...M,structures:N}))(wC({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:p,tournamentId:f,endDate:h},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:v,eventPublishState:g,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:u,usePublishState:n,contextProfile:s,drawDefinition:C,publishStatus:m,sortConfig:o,event:d}))).map(({structures:C,...M})=>{let N=C?.filter(({stage:A,structureId:O})=>y({structureId:O,drawId:M.drawId})&&w({stage:A,drawId:M.drawId})).map(A=>S({drawId:M.drawId,drawType:M.drawType,structure:A}));return{...M,structures:N}}).filter(C=>C.structures?.length):void 0,D=(Array.isArray(u.venues)?u.venues:[]).map(C=>{let{venueData:M}=mI({venueId:C.venueId,tournamentRecord:u});return{...M}}),P=(({eventId:C,eventName:M,eventType:N,eventLevel:A,surfaceCategory:O,matchUpFormat:k,category:F,gender:x,startDate:L,endDate:$,ballType:V,discipline:_})=>({eventId:C,eventName:M,eventType:N,eventLevel:A,surfaceCategory:O,matchUpFormat:k,category:F,gender:x,startDate:L,endDate:$,ballType:V,discipline:_}))(d);P.display=it({element:d,name:dP}).extension?.value;let{tournamentInfo:E}=Am({tournamentRecord:u}),R={tournamentInfo:E,venuesData:D,eventInfo:P,drawsData:T};return R.eventInfo.publishState=g,R.eventInfo.published=g?.status?.published,{...H,eventData:R,participants:v}}function M0({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i,event:r}){if(!i)return{error:_e};let{participantIds:n,participantIdMatchUps:a}=DUe({tournamentParticipants:e?.participants,drawDefinition:i}),s=Object.values(a).some(p=>p.some(f=>f.containerStructureId)),o=(s&&GS({tournamentRecord:e,event:r}))?.eventData?.drawsData?.find(p=>p.drawId===i.drawId)?.structures,l=i?.structures?.find(p=>p.stage===Fe&&p.stageSequence===1),u=l?.structureType===hn&&l.structures,c=(s?vI({tournamentRecord:e,drawDefinition:i,structureId:l?.structureId})?.positionAssignments:void 0)?.length||0,d=n?.map(p=>{let f=a[p].filter(I=>[Oi,"BYE"].includes(I.matchUpStatus)||I.winningSide),h=f.map(I=>{let v=I.sides.find(y=>y.bye),w=I.sides.find(y=>y.participantId===p).sideNumber;if(I.containerStructureId){let y=GUe({containedStructures:u,drawPositionsCount:c,drawDataStructures:o,drawDefinition:i,participantId:p,matchUp:I});if(y)return y}return(I.winningSide||t&&v&&w)===w?I.finishingPositionRange.winner:I.finishingPositionRange.loser}),m=I=>Math.abs(I[0]-I[1]),g=h.reduce((I,v)=>I&&m(I)<m(v)?I:v,void 0);return{[p]:{finishingPositionRanges:h,finishingPositionRange:g,relevantMatchUps:f}}})||[];return Object.assign({},...d)}function GUe({containedStructures:t,drawPositionsCount:e,drawDataStructures:i,drawDefinition:r,participantId:n,matchUp:a}){let s=t?.find(f=>f.structureId===a.structureId)?.positionAssignments?.length,o=i.find(f=>f.structureId===a.containerStructureId)?.participantResults?.find(f=>f.participantId===n)?.participantResult,{ties:l,groupOrder:u,provisionalOrder:c}=o||{},d=t?.length,p=r.structure?.find(f=>f.stage===Ai);if(ua()&&console.log({drawPositionsCount:e,provisionalOrder:c,bracketsCount:d,bracketSize:s,groupOrder:u,ties:l}),e===s&&u)return[u,u];if(d>1&&u&&!p)return[1,d];if(d>1&&u&&p){let f=r.links?.find(m=>m.source.structureId===a.containerStructureId)?.source?.finishingPositions,h=f.length*d;if(u in f)return[1,h];{let m=(s-u)*d;return[h+1,e-m]}}}function Kd({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:ge};if(!r)return{error:Vo};if(!e&&t){if(typeof i!="string"&&(i=S9({tournamentRecords:t,drawId:r}),!i))return{error:tI};if(e=t[i],!e)return{error:ge}}let n=e&&zn({tournamentRecord:e,drawId:r});return n?.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...H}:z({result:{error:ja},stack:"findDrawDefinition"})}function N0(t){let{drawDefinition:e,error:i}=Kd(t);return i?{error:i}:{drawDefinition:Oe(e)}}function HUe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){let s=a?.entries?.filter(({entryStatus:o})=>[Us,ff].includes(o)).map(({participantId:o})=>o)||[];if(s.length){let o=r.individualParticipantIds,l=e?t.filter(({participantId:c})=>s.includes(c)):void 0,u=e?t.filter(({participantId:c})=>o.includes(c)):void 0;return{validModifyAssignedPairAction:Ve({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:zSe,availableIndividualParticipantIds:s,availableIndividualParticipants:l,existingIndividualParticipantIds:o,existingIndividualParticipants:u,type:f0},!1,!1,!0)}}return{}}function Bp(t){let{inContextDrawMatchUps:e,targetData:i,drawDefinition:r,relevantLink:n}=t;if(n?.linkCondition===fl&&i?.matchUp?.matchUpStatus==="BYE")return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:s},targetLinks:o}=i,l=a&&_n({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),u=l?.targetMatchUps?.loserMatchUp,c=l?.targetMatchUps?.loserMatchUpDrawPositionIndex,d=u?.sides[c]?.participant,p=$r(a?.matchUpStatus),f=p&&!d,h=a?.sides?.filter(w=>w?.participant).length??0,m=a?.winningSide&&p&&h===1,g=s?.drawPositions?.filter(Boolean).length||0;if(!m&&(a?.winningSide&&!f||s?.winningSide&&g===2&&(!s.feedRound||!$r(s?.matchUpStatus))))return!0;let I=s&&_n({matchUpId:s.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),v=l&&Bp({relevantLink:o?.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:r});return!!(I&&Bp({targetData:I,inContextDrawMatchUps:e,drawDefinition:r})||v)}var WUe={[Op]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[We,Fe],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[TP,II,fC,tb],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},SD="positionAction",ex="matchUpAction";function j9({actionType:t=SD,appliedPolicies:e,drawDefinition:i,structure:r}){let n=t===SD&&Op||t===ex&&Cr,a=t===SD&&WUe||t===ex&&w8,s=n&&(e?.[n]||a?.[n]),o=i.links?.filter(d=>d?.target?.structureId===r?.structureId)?.map(({target:d})=>d.feedProfile)??[],{enabledStructures:l,disabledStructures:u}=s||{},c=u?.find(d=>{let{stages:p,stageSequences:f,structureTypes:h,feedProfiles:m}=d;return(!m?.length||Array.isArray(m)&&m.some(g=>o.includes(g)))&&(!p?.length||Array.isArray(p)&&p?.includes(r?.stage))&&(!h?.length||Array.isArray(h)&&h?.includes(r?.structureType))&&(!f?.length||Array.isArray(f)&&f.includes(r?.stageSequence))});return{enabledStructures:l,actionsDisabled:c,actionsPolicy:s}}function zUe({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function G9({enabledStructures:t,drawDefinition:e,structure:i}){if(t===!1)return{};if(!t?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},s=e.links?.filter(o=>o?.target?.structureId===i?.structureId)?.map(({target:o})=>o.feedProfile)||[];return{policyActions:t.find(o=>{let{stages:l,stageSequences:u,structureTypes:c,feedProfiles:d}=o||{},p=!l?.length||Array.isArray(l)&&l.includes(r),f=!u?.length||Array.isArray(u)&&u.includes(n),h=!c?.length||Array.isArray(c)&&c.includes(a),m=!d?.length||Array.isArray(d)&&d.some(g=>s.includes(g));return f&&h&&m&&o&&p})}}function na({action:t,policyActions:e}){let i=!e?.enabledActions||e?.disabledActions?.length&&e.disabledActions.includes(t);return i?!1:(e?.enabledActions.length===0||e?.enabledActions.includes(t))&&!i}var H9="replaceTieMatchUpParticipantId",W9="assignTieMatchUpParticipantId",tx="removeTieMatchUpParticipantId",XW="assignMatchUpSideParticipant",qUe="removeMatchUpSideParticipant",z9="substituteParticipant",ix="REMOVE_SUBSTITUTION",q9="REPLACE_PARTICIPANT",A0="REMOVE_PARTICIPANT",rx="setMatchUpStatus",nx="SUBSTITUTION",Y9="SCHEDULE",YUe="PENALTY",ax="REFEREE",K9="STATUS",sx="START",X9="SCORE",KUe={REPLACE_TEAM_POSITION_METHOD:H9,ASSIGN_TEAM_POSITION_METHOD:W9,REMOVE_TEAM_POSITION_METHOD:tx,REPLACE_PARTICIPANT:q9,SUBSTITUTION_METHOD:z9,REMOVE_SUBSTITUTION:ix,REMOVE_PARTICIPANT:A0,SCHEDULE_METHOD:rx,SUBSTITUTION:nx,SCHEDULE:Y9,PENALTY:YUe,REFEREE:ax,STATUS:K9,SCORE:X9,START:sx,END:"END"};function XUe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:s,participantId:o,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){let f=[],h=n.sides?.find(M=>M.participant),m=$a(n.gender)&&n.sideNumber&&n.sides?.filter(M=>M.particiapntId).length===1&&h?.participant?.person?.sex,g=n.matchUpType,I=(s??r?.participants?.enforceGender)!==!1?n.gender:void 0,v=n.sides?.flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean)?.map(bt),w=n.sides?.filter(M=>!l||M.sideNumber===l).flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean),y=w?.map(bt),b=e?.find(M=>M.matchUpId===n.matchUpTieId)?.sides?.map(M=>M?.participant?.individualParticipants?.filter(({participantId:N,person:A})=>!y?.includes(N)&&(!I||cu(I)||A.sex===I||$a(I)&&!m||m&&A.sex!==m))),S=l?b?.[l-1]:b?.map((M,N)=>({participants:M,sideNumber:N+1})),U=l?b?.[l-1]?.map(bt):b?.map((M,N)=>({participants:M?.map(bt),sideNumber:N+1})),T=l&&(Ti(oh)(g)&&!y?.length||Ti(Rp)(g)&&(y?.length??0)<2)||!l&&(Ti(oh)(g)&&(y?.length??0)<2||Ti(Rp)(g)&&(y?.length??0)<4),D=U?.filter(M=>!v?.includes(M)),P=S?.filter(({participantId:M})=>D.includes(M));if(T&&D?.length&&f.push({availableParticipantIds:D,method:W9,availableParticipants:P,type:Vh,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),y?.length&&(!dr(c)||p?.substitutions?.length)&&f.push({method:tx,type:A0,existingParticipantIds:y,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),P?.length&&(!l&&y?.length||l&&p?.participant)&&f.push({availableParticipantIds:D,method:H9,availableParticipants:P,type:q9,existingParticipantIds:y,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),na({policyActions:a,action:ix})&&p?.substitutions?.length){let M=p.participant?.participantType===vt&&[p.participantId]||p.participant?.participantType===ht&&p.participant.individualParticipantIds||[],N=p.substitutions.map(A=>A.participantId).filter(A=>M.includes(A));(!o||N.includes(o))&&f.push({method:tx,type:ix,substitutedParticipantIds:N,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let E=t?.[Cr],R=E?.substituteWithoutScore,C=E?.substituteAfterCompleted;if(na({policyActions:a,action:nx})&&i.length===2&&(!l&&y?.length||l&&p?.participant)&&(R||dr(c))&&(C||c.matchUpStatus&&!Ji.includes(c.matchUpStatus))&&w?.length&&S.length){let M=w.map(bt);f.push({info:"list of team players available for substitution",method:z9,availableParticipantIds:U,existingParticipantIds:M,availableParticipants:S,existingParticipants:w,type:nx,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return f}function JUe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:s,drawPosition:o,validActions:l,structureId:u,structure:c,drawId:d,event:p}){if(i.includes(o))return{};let f=l.find(U=>U.type===Vh)?.availableParticipantIds,h=a?.[Op]?.otherFlightEntries,m=a?.[Op]?.restrictQualifyingAlternates,g=(s.entries??[]).filter(({entryStage:U})=>!m||(c.stage===We?U===We:U!==We)).sort((U,T)=>(U.entryPosition??1/0)-(T.entryPosition??1/0)).map(({participantId:U})=>U).filter(Boolean),{allPositionedParticipantIds:I}=o7({drawDefinition:s}),v=r.map(U=>U.participantId).filter(Boolean),w=g.filter(U=>c.stage&&[We,Fe,Ai].includes(c.stage)?!I?.includes(U):!v.includes(U)),y=(p?.entries??[]).filter(U=>U.entryStatus===Bs&&J9({restrictQualifyingAlternates:m,structure:c,entry:U})&&(c.stage&&[We,Fe,Ai].includes(c.stage)?!I?.includes(U.participantId):!v.includes(U.participantId))).sort((U,T)=>(U.entryPosition??1/0)-(T.entryPosition??1/0)).map(U=>U.participantId),b=ot(w.concat(y));if(h){let U=(p?Bi({event:p}).flightProfile:void 0)?.flights?.filter(T=>T.drawId!==d).map(T=>T.drawEntries.filter(D=>D.participantId&&![Sc,Us,ff].includes(D.entryStatus)&&!g.includes(D.participantId)).map(({participantId:D})=>D)).flat().filter(Boolean);U?.length&&b.push(...U)}f?.length&&(b=b.filter(U=>!f.includes(U)));let S=n?t?.filter(U=>b.includes(U.participantId)):void 0;return S?.forEach(U=>{let T=(s.entries??[]).find(D=>D.participantId===U.participantId);U.entryPosition=T?.entryPosition}),S?.sort((U,T)=>(U.entryPosition||1/0)-(T.entryPosition||1/0)),b.length?{validAlternatesAction:Ve({payload:{drawId:d,structureId:u,drawPosition:o},willDisableLinks:e,method:HSe,availableAlternatesParticipantIds:b,type:h0,availableAlternates:S})}:{}}function J9({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===We&&!t||i.entryStage===Fe&&r===en)return!0}function QUe({eventEntries:t,structure:e}){let i=n=>n.entryStatus===Bs&&J9({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(bt)}function ZUe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:s,matchUpId:o,structure:l,matchUp:u,drawId:c,event:d}){let p=[],f=l?.matchUps??[],h=u.sides?.find(T=>T.sideNumber===s)?.participantId,m=f.filter(({roundNumber:T})=>T===u.roundNumber),g=n?.entries?.filter(({entryStatus:T})=>T&&hf.includes(T)).map(bt)??[],I=m.map(T=>(T.sides??[]).flatMap(bt)).flat().filter(Boolean),v=g.filter(T=>!i.includes(T)&&(!t||!I.includes(T))),w=e?.filter(T=>v?.includes(T.participantId)).map(T=>Oe(T,void 0,!0));w?.forEach(T=>{let D=(n.entries??[]).find(P=>P.participantId===T.participantId);T.entryPosition=D?.entryPosition}),v.length&&p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:XW,type:Vh,availableParticipantIds:v,participantsAvailable:w});let y=d?.entries??[],b=QUe({eventEntries:y,structure:l}),S=ot(g.concat(b));if(r){let T=(d?Bi({event:d}):void 0)?.flights?.filter(D=>D.drawId!==c).flatMap(D=>D.drawEntries.filter(P=>P.participantId&&![Sc,Us,ff].includes(P.entryStatus)).map(({participantId:P})=>P)).filter(Boolean);T?.length&&S.push(...T)}S=S.filter(T=>!i.includes(T)&&!v.includes(T)&&(!t||!I.includes(T)));let U=e?.filter(T=>S.includes(T.participantId)).map(T=>Oe(T,void 0,!0));if(U?.forEach(T=>{let D=(n.entries??[]).find(P=>P.participantId===T.participantId);T.entryPosition=D?.entryPosition}),U?.sort((T,D)=>(T.entryPosition||1/0)-(D.entryPosition||1/0)),S.length&&p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},availableParticipantIds:S,participantsAvailable:U,method:XW,type:Bs}),!dr(u)&&s&&h){p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:qUe,type:A0});let T=A=>A.sides.map(bt),D=({matchUpId:A})=>A!==u.matchUpId,P=A=>!dr(A),E=u.sides?.find(A=>A.sideNumber!==s)?.participantId,R=f.filter(({roundNumber:A})=>A!==u.roundNumber).filter(D).map(T),C=[E,...R.filter(A=>A.includes(h)).flat()].filter(Boolean),M=A=>!C.flat().includes(A),N=m.filter(P).filter(D).map(T).flat().filter(M);if(N.length){let A=e?.filter(O=>N.includes(O.participantId)).map(O=>Oe(O,void 0,!0));p.push({payload:{participantIds:[h],roundNumber:u.roundNumber,structureId:a,sideNumber:s,matchUpId:o,drawId:c},swappableParticipantIds:N,method:qSe,type:hC,swappableParticipants:A})}}return p}function SC(t){if(!t)return{error:ie};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l}=t,u=t.tournamentRecord??(t.tournamentId&&ni(t.tournamentId)&&t.tournamentRecords?.[t.tournamentId]);if(!u)return{error:ge};if(!l||!ni(l))return{error:Tn};if(o&&![1,2].includes(o))return z({result:{error:ie},context:{sideNumber:o}});if(!e){let K=(wr({tournamentRecord:u}).matchUps??[]).find(Z=>Z.matchUpId===l);i=(u?.events??[]).find(Z=>Z.eventId===K?.eventId);let X=(i?.drawDefinitions??[]).find(Z=>Z.drawId===K?.drawId);X&&(e=X)}if(!e)return{error:_e};let c=Pi({withIndividualParticipants:!0,tournamentRecord:u}).participants,{drawId:d}=e,{matchUp:p,structure:f}=pi({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:cn};let h=Rt({tournamentRecord:u,drawDefinition:e,structure:f,event:i}).appliedPolicies??{};Object.assign(h,n??{});let m=h?.[Op]?.otherFlightEntries,g=h?.[Cr]??Sv[Cr],{enabledStructures:I}=j9({actionType:ex,appliedPolicies:h,drawDefinition:e,structure:f}),{policyActions:v}=G9({enabledStructures:I,drawDefinition:e,structure:f}),w=t.matchUpsMap??Or({drawDefinition:e}),y=t.inContextDrawMatchUps??rr({tournamentParticipants:c,inContext:!0,drawDefinition:e,matchUpsMap:w,event:i}).matchUps,b=y?.find(K=>K.matchUpId===l),S=o&&b?.sides?.find(K=>K.sideNumber===o),U=b?.sides?.map(K=>K.participantId||K.participant?.participantid).filter(Boolean)??[],{assignedPositions:T,allPositionsAssigned:D}=cr({structure:f}),{structureId:P}=f??{},E=[];if(!P)return{validActions:E};let R=Wn({structure:f}),C=!!p.collectionId;if(R&&!C){let K=ZUe({restrictAdHocRoundParticipants:r,tournamentParticipants:c,matchUpParticipantIds:U,otherFlightEntries:m,drawDefinition:e,structureId:P,sideNumber:o,matchUpId:l,structure:f,matchUp:p,drawId:d,event:i});E.push(...K)}let M=yu({drawDefinition:e,structure:f}),N=T?.filter(K=>K.participantId).map(K=>K.drawPosition),A=T?.filter(K=>K.bye).map(K=>K.drawPosition),O=p.matchUpStatus==="BYE"||!C&&p.drawPositions?.reduce((K,X)=>A?.includes(X)||K,!1);if(O)return{validActions:E,isByeMatchUp:O};na({policyActions:v,action:ax})&&E.push({type:ax,payload:{matchUpId:l}});let k=!PS({matchUpStatus:p.matchUpStatus}),F=h?.scoring?.structures,x=f?.stage&&F?.stage?.[f.stage],L=f?.stageSequence&&x?.stageSequence?.[f.stageSequence],$=!(h?.scoring?.requireAllPositionsAssigned||x?.requireAllPositionsAssigned||L?.requireAllPositionsAssigned)||D,V=p.sides?.filter(K=>K?.participantId).length===2,_=p.matchUpStatus&&[Si,Wi].includes(p.matchUpStatus),B=_n({inContextDrawMatchUps:y,drawDefinition:e,matchUpId:l}),G=Bp({inContextDrawMatchUps:y,drawDefinition:e,targetData:B}),j=(b?.drawPositions?.length===2&&b.drawPositions.every(K=>N?.includes(K))&&b?.sides?.length===2&&b.sides.every(({participantId:K})=>K)||V)&&!(_&&G),Y={method:l9,type:II,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(k&&E.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:rx,type:Y9}),na({policyActions:v,action:II})&&(S?.participant||!o&&U?.length)&&E.push(Y),k&&j&&E.push({type:K9}),$&&j){let{matchUpId:K,matchUpFormat:X}=p,Z={drawId:d,matchUpId:K,matchUpFormat:X,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};E.push({info:"set outcome and winningSide",method:rx,type:X9,payload:Z}),na({policyActions:v,action:sx})&&E.push({type:sx}),na({policyActions:v,action:"END"})&&E.push({type:"END"})}if(C&&b){let K=XUe({specifiedPolicyDefinitions:n,inContextDrawMatchUps:y,matchUpParticipantIds:U,matchUpActionsPolicy:g,inContextMatchUp:b,policyActions:v,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l,matchUp:p,drawId:d,side:S});E.push(...K)}return{structureIsComplete:M,validActions:E,isDoubleExit:_,...H}}function eTe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:s,drawPosition:o,structureId:l,structure:u,drawId:c,event:d}){if(n.includes(o)||r&&!e)return{};let{sourceStructureIds:p,targetStructureIds:f}=s.links?.reduce((I,v)=>{let w=v.source?.structureId,y=v.target?.structureId;return I.sourceStructureIds.includes(w)||I.sourceStructureIds.push(w),I.targetStructureIds.includes(y)||I.targetStructureIds.push(y),I},{sourceStructureIds:[],targetStructureIds:[]})||{},h=[],m=s.links?.filter(I=>I.target?.structureId===u.structureId)??[];for(let I of m){let v=I?.source?.structureId,{structure:w}=et({structureId:v,drawDefinition:s}),y=w?.finishingPosition===gm&&(p?.length!==1||f?.length!==1),b={};if(y){let{matchUps:T}=kt({drawDefinition:s,structure:u,event:d}),{initialRoundNumber:D}=$h({drawPosition:o,matchUps:T}),P=s.links?.find(E=>E.target?.structureId===u?.structureId&&E.target.roundNumber===D)?.source?.roundNumber;b.roundNumbers=[P]}let{completedMatchUps:S}=aC({structureId:v,inContext:!0,matchUpFilters:b,drawDefinition:s}),U=a.map(T=>T.participantId).filter(Boolean);S?.filter(({matchUpType:T,winningSide:D})=>D&&(d?.eventType!==sr||T===sr)).map(({winningSide:T,sides:D})=>T&&D?.[1-(T-1)]).map(bt).filter(T=>T&&!U.includes(T))?.forEach(T=>{h.includes(T)||h.push(T)})}let g=t?.filter(I=>h?.includes(I.participantId));return g?.forEach(I=>{let v=(s.entries??[]).find(w=>w.participantId===I.participantId);I.entryPosition=v?.entryPosition}),h?.length?{validLuckyLosersAction:{type:g0,method:WSe,availableLuckyLosers:g,availableLuckyLoserParticipantIds:h,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:o}}}:{}}function tTe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:f,event:h}){let{drawId:m}=u,g=[],I,v,w=[],y=l?.[yo]?.validSeedPositions?.ignore;if(y||({unplacedSeedParticipantIds:I,unplacedSeedAssignments:v,unfilledPositions:w}=O8({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:f})),w?.length||(w=s.filter(b=>!b.participantId&&!b.bye&&!b.qualifier).map(b=>b.drawPosition)),d||g.push({payload:{drawId:m,structureId:f,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:XSe,type:"BYE"}),a&&y){let b=s.map(P=>P.participantId).filter(Boolean),S={structureIds:t},{completedMatchUps:U}=vv({inContext:!0,matchUpFilters:S,drawDefinition:u}),T=ot((U??[]).filter(({matchUpType:P})=>h?.eventType!==sr||P===sr)?.map(({sides:P})=>P?.map(bt)).flat().filter(P=>P&&!b.includes(P))),D=o?n?.filter(P=>T?.includes(P.participantId)).map(P=>Oe(P,void 0,!0)):void 0;return D?.forEach(P=>{let E=(u.entries??[]).find(R=>R.participantId===P.participantId);P.entryPosition=E?.entryPosition}),D?.length&&g.push(Ve({payload:{drawId:m,structureId:f,drawPosition:p},willDisableLinks:i,method:qW,type:Vh,availableParticipantIds:T,participantsAvailable:D})),{validAssignmentActions:g}}if(w.includes(p)||d){let b;if(v?.length){let U=v.filter(T=>I?.includes(T.participantId));U.sort(iTe),b=U.map(T=>T.participantId)}else b=e;let S=o?n?.filter(U=>b.includes(U.participantId)).map(U=>Oe(U,void 0,!0)):void 0;S?.length&&g.push(Ve({payload:{drawId:m,structureId:f,drawPosition:p},willDisableLinks:i,method:qW,type:Vh,availableParticipantIds:b,participantsAvailable:S}))}return{validAssignmentActions:g}}function iTe(t,e){return t.bye||gI(t.seedValue)<gI(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function rTe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:s,structureId:o,drawId:l}){let u=[],c=[],d=[],p=[],f=new Set(i.map(b=>b.participantId).filter(Boolean)),h=n?.[Op],m=!h?.disableRoundRestrictions&&t[s],g=h?.requireCompletedStructures,{sourceStructureIds:I,relevantLinks:v}=Wb({targetRoundNumber:m,linkType:fu,drawDefinition:a,structureId:o})||{};I?.length&&p.push(...I);let{sourceStructureIds:w,relevantLinks:y}=Wb({targetRoundNumber:m,linkType:pu,drawDefinition:a,structureId:o})||{};w?.length&&p.push(...w);for(let b of v){let S=a.structures?.find(T=>T.structureId===b.source.structureId);if(S?.stage!==We)continue;let U=yu({structureId:b.source.structureId,drawDefinition:a});if(!g||U){let T=S.qualifyingRoundNumber,{matchUps:D}=kt({matchUpFilters:{roundNumbers:[T],isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:S});for(let P of D){let E=P.sides.find(C=>C?.sideNumber===P.winningSide),R=P.matchUpStatus==="BYE"&&P.sides?.find(({participantId:C})=>C);if(E||R){let{participantId:C,participant:M}=E||R||{};C&&!f.has(C)&&(M&&r&&u.push(M),c.push(C))}}}}for(let b of y){let S=a.structures?.find(T=>T.structureId===b.source.structureId);if(S?.stage!==We)continue;let U=yu({structureId:b.source.structureId,drawDefinition:a});if(!g||U){let{positionAssignments:T}=Kt({structure:S}),D=T?.map(P=>{let E=P.participantId,R=it({element:P,name:yc}).extension?.value;return R?{participantId:E,groupOrder:R?.groupOrder}:{}}).filter(({groupOrder:P,participantId:E})=>P===1&&!f.has(E)).map(({participantId:P})=>P)??[];if(D&&c.push(...D),r){let P=e.filter(({participantId:E})=>D.includes(E));u.push(...P)}}}return c.length&&d.push(Ve({qualifyingParticipants:r?u:void 0,method:jSe,type:fC,qualifyingParticipantIds:c,payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:o,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function nTe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:s,byeDrawPositions:o,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:f,event:h}){if(n.includes(c))return{};let m=P=>!t||P.participantId||P.qualifier||P.bye,g=r?.filter(P=>P!==c&&!(u&&o.includes(P))),I=a?.filter(P=>m(P)&&g?.includes(P.drawPosition))??[],v=I.map(({drawPosition:P})=>P),{matchUps:w}=kt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:h}),y=w.filter(({drawPositions:P})=>Ln(P,v)),b=Object.assign({},...y.map(P=>P.sides?.filter(({sourceDrawPositionRange:E})=>E).map(({drawPosition:E,sourceDrawPositionRange:R})=>({[E]:R}))).flat()),S=I.map(P=>P.participantId).filter(Boolean),U=(i??[]).filter(P=>S.includes(P.participantId)),T=Object.assign({},...U.map(P=>({[P.participantId]:P}))),D=I.map(P=>{let E=T?.[P.participantId],R=b[P.drawPosition];return Ve({...P,participant:s?Oe(E,!1,!0):void 0,sourceDrawPositionRange:R})});return D.length?{validSwapAction:{payload:{drawId:f,structureId:d,drawPositions:[c]},willDisableLinks:e,method:o9,type:hC,availableAssignments:D}}:{}}function aTe(t,e){return t.filter(i=>!e.includes(i.participantId)).map(i=>i.participantId)}function sTe({validActions:t,policyActions:e,isActiveDrawPosition:i,positionAssignments:r,disablePlacementActions:n,positionAssignment:a,isByePosition:s,getValidAssignmentActions:o,positionSourceStructureIds:l,unassignedParticipantIds:u,possiblyDisablingAction:c,isWinRatioFedStructure:d,tournamentParticipants:p,returnParticipants:f,appliedPolicies:h,drawDefinition:m,drawPosition:g,structureId:I,event:v}){if(na({policyActions:e,action:Vh})&&!i&&r&&!n&&(!a||s)){let{validAssignmentActions:w}=o({positionSourceStructureIds:l,unassignedParticipantIds:u,possiblyDisablingAction:c,isWinRatioFedStructure:d,tournamentParticipants:p,positionAssignments:r,returnParticipants:f,appliedPolicies:h,drawDefinition:m,isByePosition:s,drawPosition:g,structureId:I,event:v});w?.forEach(y=>t.push(y))}}function oTe({validActions:t,policyActions:e,isActiveDrawPosition:i,getValidQualifiersAction:r,drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,drawId:p}){if(na({policyActions:e,action:fC})&&!i){let{validAssignmentActions:f}=r({drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,drawId:p});f?.forEach(h=>t.push(h))}}function lTe({validActions:t,policyActions:e,isActiveDrawPosition:i,drawId:r,structureId:n,drawPosition:a,possiblyDisablingAction:s,isByePosition:o}){na({policyActions:e,action:ZO})&&!i&&(t.push({type:ZO,method:zW,payload:{drawId:r,structureId:n,drawPosition:a},willDisableLinks:s}),o||t.push({type:m0,method:GSe,payload:{drawId:r,structureId:n,drawPosition:a},willDisableLinks:s}),na({policyActions:e,action:"BYE"})&&!o&&t.push({type:"BYE",method:zW,payload:{drawId:r,structureId:n,drawPosition:a,replaceWithBye:!0},willDisableLinks:s}))}function uTe({validActions:t,policyActions:e,activePositionsCheck:i,activePositionOverrides:r,activeDrawPositions:n,drawDefinition:a,structureId:s,drawPosition:o,structure:l,isByePosition:u,participantId:c,participant:d,drawId:p}){let f=l.stage===We||l.stage===Fe&&l.stageSequence===1;if(!u&&i({activePositionOverrides:r,activeDrawPositions:n,action:tb})&&na({policyActions:e,action:tb})&&SP({drawDefinition:a,structureId:s,drawPosition:o})&&f){let{seedAssignments:h}=ms({returnAllProxies:!0,drawDefinition:a,structure:l}),{seedNumber:m,seedValue:g}=h?.find(I=>I.participantId===c)??{};t.push({type:tb,method:JSe,participant:d,seedNumber:m,payload:{drawId:p,structureId:s,participantId:c,seedValue:g}})}if(!u&&i({activePositionOverrides:r,activeDrawPositions:n,action:wD})&&na({policyActions:e,action:wD})&&SP({drawDefinition:a,structureId:s,drawPosition:o})&&f){let{seedAssignments:h}=ms({returnAllProxies:!0,drawDefinition:a,structure:l}),{seedNumber:m}=h?.find(g=>g.participantId===c)??{};t.push({method:KSe,type:wD,participant:d,seedNumber:m,payload:{participantId:c,structureId:s,drawId:p}})}}function cTe({validActions:t,policyActions:e,isByePosition:i,participantId:r,participant:n,drawId:a}){if(!i&&r){if(na({policyActions:e,action:II})){let s={type:II,method:l9,participant:n,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:a}};t.push(s)}if(na({policyActions:e,action:TP})){let s={type:TP,method:YSe,participant:n,payload:{participantId:r,otherName:void 0}};t.push(s)}}}function dTe({validActions:t,policyActions:e,getValidSwapAction:i,possiblyDisablingAction:r,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:s,positionAssignments:o,returnParticipants:l,byeDrawPositions:u,drawDefinition:c,isByePosition:d,drawPosition:p,structureId:f,structure:h,drawId:m}){if(na({policyActions:e,action:hC})){let{validSwapAction:g}=i({possiblyDisablingAction:r,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:s,positionAssignments:o,returnParticipants:l,byeDrawPositions:u,drawDefinition:c,isByePosition:d,drawPosition:p,structureId:f,structure:h,drawId:m});g&&t.push(g)}}function pTe({validActions:t,policyActions:e,getValidAlternatesAction:i,possiblyDisablingAction:r,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f,event:h,disablePlacementActions:m}){if(na({policyActions:e,action:h0})&&!m){let{validAlternatesAction:g}=i({possiblyDisablingAction:r,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,validActions:t,structureId:d,structure:p,drawId:f,event:h});g&&t.push(g)}}function fTe({validActions:t,policyActions:e,getValidLuckyLosersAction:i,sourceStructuresComplete:r,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:s,activeDrawPositions:o,positionAssignments:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f,disablePlacementActions:h,isActiveDrawPosition:m}){if(na({policyActions:e,action:g0})&&!h&&!m&&l){let{validLuckyLosersAction:g}=i({sourceStructuresComplete:r,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:s,activeDrawPositions:o,positionAssignments:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f});g&&t.push(g)}}function hTe({validActions:t,policyActions:e,getValidModifyAssignedPairAction:i,participant:r,tournamentParticipants:n,returnParticipants:a,drawPosition:s,drawId:o,event:l}){if(r?.participantType===ht&&na({policyActions:e,action:f0})){let{validModifyAssignedPairAction:u}=i({tournamentParticipants:n,returnParticipants:a,drawPosition:s,participant:r,drawId:o,event:l});u&&t.push(u)}}function k0(t){return mTe(t)}function mTe(t){let e=Ge(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:s,drawPosition:o,event:l}=t,u=t.tournamentParticipants??(a&&Pi({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],c=et({structureId:t.structureId,drawDefinition:s});if(c.error)return c;let d=c.containingStructure||c.structure;if(!d)return{error:vi};let p=d.structureId;if(c=yv({drawDefinition:s,structureId:p}),o===void 0&&!c.isAdHoc)return{error:av};if(c.isAdHoc)return SC(t);if(c.error)return c;let{drawPositionInitialRounds:f,inactiveDrawPositions:h,activeDrawPositions:m,byeDrawPositions:g}=c,I=Rt({tournamentRecord:a,drawDefinition:s,structure:d,event:l}).appliedPolicies??{};Object.assign(I,i??{});let{actionsPolicy:v,enabledStructures:w,actionsDisabled:y}=j9({actionType:SD,appliedPolicies:I,drawDefinition:s,structure:d}),b=v?.activePositionOverrides||[],{sourceStructureIds:S}=Wb({finishingPosition:kp,targetRoundNumber:1,linkType:pu,drawDefinition:s,structureId:p})||{},U;S?.length&&(U=S.every(Y=>yu({structureId:Y,drawDefinition:s})));let T=S.length,D=S.length&&!U,{policyActions:P}=G9({enabledStructures:w,drawDefinition:s,structure:d}),E=![We,Fe].includes(d.stage)||d.stageSequence!==1,{drawId:R}=s,C=[],{assignedPositions:M,positionAssignments:N}=cr({structure:d}),A=M?.find(Y=>Y.drawPosition===o),O=!!A;if(!N?.map(Y=>Y.drawPosition)?.includes(o))return{error:lm};let{stage:k,stageSequence:F}=d,x=[k];k===en&&x.push(Fe),k===Fe&&x.push(en);let L=ym({entryStatuses:hf,provisionalPositioning:n,drawDefinition:s,stageSequence:F,structureId:p,stages:x}),$=If({drawDefinition:s,stages:x}).assignedParticipantIds??[],V=aTe(L,$),_=g.includes(o),B=m.includes(o);if(y)return{info:"Actions Disabled for structure",isActiveDrawPosition:B,isDrawPosition:!0,hasPositionAssigned:O,validActions:[],isByePosition:_};sTe({validActions:C,policyActions:P,isActiveDrawPosition:B,positionAssignments:N,disablePlacementActions:D,positionAssignment:A,isByePosition:_,getValidAssignmentActions:tTe,positionSourceStructureIds:S,unassignedParticipantIds:V,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,event:l}),oTe({validActions:C,policyActions:P,isActiveDrawPosition:B,getValidQualifiersAction:rTe,drawPositionInitialRounds:f,tournamentParticipants:u,positionAssignments:N,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,drawId:R});let{participantId:G}=A||{},j=G&&u.find(Y=>Y.participantId===G);return A&&(lTe({validActions:C,policyActions:P,isActiveDrawPosition:B,drawId:R,structureId:p,drawPosition:o,possiblyDisablingAction:E,isByePosition:_}),uTe({validActions:C,policyActions:P,activePositionsCheck:zUe,activePositionOverrides:b,activeDrawPositions:m,drawDefinition:s,structureId:p,drawPosition:o,structure:d,isByePosition:_,participantId:G,participant:j,drawId:R}),cTe({validActions:C,policyActions:P,isByePosition:_,participantId:G,participant:j,drawId:R}),dTe({validActions:C,policyActions:P,getValidSwapAction:nTe,possiblyDisablingAction:E,tournamentParticipants:u,inactiveDrawPositions:h,activeDrawPositions:m,positionAssignments:N,returnParticipants:r,byeDrawPositions:g,drawDefinition:s,isByePosition:_,drawPosition:o,structureId:p,structure:d,drawId:R})),pTe({validActions:C,policyActions:P,getValidAlternatesAction:JUe,possiblyDisablingAction:E,tournamentParticipants:u,positionAssignments:N,activeDrawPositions:m,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:R,event:l,disablePlacementActions:D}),fTe({validActions:C,policyActions:P,getValidLuckyLosersAction:eTe,sourceStructuresComplete:U,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,activeDrawPositions:m,positionAssignments:N,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:R,disablePlacementActions:D,isActiveDrawPosition:B}),hTe({validActions:C,policyActions:P,getValidModifyAssignedPairAction:HUe,participant:j,tournamentParticipants:u,returnParticipants:r,drawPosition:o,drawId:R,event:l}),{isActiveDrawPosition:B,isDrawPosition:!0,hasPositionAssigned:O,isByePosition:_,validActions:C,...H}}function HS({policyDefinitions:t,appliedPolicies:e,drawType:i}){let r=t?.[cP]?.drawTypeCoercion,n=e?.[cP]?.drawTypeCoercion;return(typeof r=="boolean"?r:void 0)??(i&&r?.[i])??(typeof n=="boolean"?n:void 0)??(i&&n?.[i])??!0}var O0=({drawDefinition:t})=>{let e=Ge({drawDefinition:t},[{[mn]:!0}]);if(e.error)return e;let i=t.structures?.find(n=>n.stage===Fe&&n.stageSequence===1);if(!i)return z({result:{error:f1}});let{qualifierPositions:r}=cr({structure:i});return Re(0,r.length).sort(()=>Math.random()-.5)};function x0({structureId:t,drawDefinition:e}){if(!e)return{error:_e};if(!ni(t))return{error:ie};let i=Iv({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!Fi([Ap,Os,MR,Np],r).length;return{...H,valid:n}}function Q9({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:ie};let i=nv(t);return i?{drawSize:i}:z({result:{error:ie},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function WS(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:s,event:o}=t||{},l="getSeedsCount",u=t?.participantsCount??t?.participantCount;if(!i){let h=jc({tournamentRecord:a,drawDefinition:s,event:o});if(h.error)return z({result:h,stack:l});i=h.policyDefinitions}let c=ut(u);if(u&&!c)return z({result:{error:ie},context:{participantsCount:u},stack:l});if(n&&!c)return z({result:{error:z4},stack:l});if(Number.isNaN(Number(r)))if(u)({drawSize:r}=Q9({participantsCount:u}));else return z({result:{error:Ww},stack:l});let d=n&&u||r;if(d&&d>r)return{error:y1};let p=i?.[yo];if(!p)return{error:N4};let f=p.seedsCountThresholds;return f?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:f.filter(h=>e?h.drawSize<=r:r===h.drawSize).reduce((h,m)=>u&&u>=m.minimumParticipantCount?m.seedsCount:h,0)}):{error:f4}}function UC({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:s,event:o}){if((!s||!n)&&i&&({participants:s,participantMap:n}=Pi({tournamentRecord:i})),!s)return{error:Yw};if(!Array.isArray(s))return{error:ie};if(!o)return{error:ui};let l=e?.[Cr]??r?.[Cr]??Sv[Cr],u=(a??l?.participants?.enforceGender)!==!1,{eventType:c,gender:d}=o,p=c===mc,f=c===Da&&_t||p&&ht||vt,h=Object.assign({},...(t??o.entries??[]).map(I=>({[I.participantId]:I.entryStatus}))),m=Object.keys(h),g=s.filter(I=>m.includes(I.participantId)).filter(I=>{let v=gTe({participant:I,participantType:f,eventType:c,entryStatusMap:h}),w=ITe({genderEnforced:u,participantMap:n,eventGender:d,participant:I,isDoubles:p,mismatch:v});return v||!w});if(g.length){let I=g.map(v=>v.participantId);return{error:S4,invalidParticipantIds:I}}return{...H,valid:!0}}function gTe({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[mc,Da].includes(i)&&t.participantType===vt&&(mp(n)||n===Sc);return t.participantType!==e&&!a}function ITe(t){let{participant:e,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:s}=t,o=!n&&a&&ot(e?.individualParticipantIds?.map(d=>i?.[d]?.participant?.person?.sex).filter(Boolean)??[])||[],l=!r||!o?.length||cu(r)||cl(r)&&ln(o[0])===ln(r)||$a(r)&&(o.length===1&&e.individualParticipantIds?.length===1||o.length===2),u=e?.person?.sex,c=!e?.person||!r||$a(r)||cu(r)||cl(r)&&ln(u)===ln(r);return!s||l&&c}function Z9({hasExistingDrawDefinition:t,qualifyingProfiles:e,appliedPolicies:i,qualifyingOnly:r,tieFormat:n,idPrefix:a,isMock:s,uuids:o}){let l="generateQualifyingSTructures",u=[],c=[],d=[],p=(v,w)=>v.stageSequence-w.stageSequence,f=(v,w)=>v.roundTarget-w.roundTarget,h=0,m=0,g,I=1;for(let v of e.sort(f)){let w=v.structureProfiles||[];I=v.roundTarget||I;let y=1,b=0,S,U,T;for(let D of(w||[]).sort(p)){let P=a1(D.drawSize||D.participantsCount),{qualifyingRoundNumber:E,structureOptions:R,matchUpFormat:C,structureName:M,structureId:N,drawType:A}=D,O=D.matchUpType,k=D.qualifyingPositions||vTe({drawSize:P,qualifyingRoundNumber:E}),F,x,L;if(!ut(P))return z({result:{error:Ww},stack:l});let $=e.length>1?`${I}-`:"",V=w.length>1||$?y:"",_=M||($||V?`${Jr(We)} ${$}${V}`:Jr(We));if(A===Zs){let{structures:B,groupCount:G,maxRoundNumber:j}=NS({structureName:D.structureName||_,structureId:N||o?.pop(),hasExistingDrawDefinition:t,stage:We,structureOptions:R,appliedPolicies:i,qualifyingOnly:r,stageSequence:y,matchUpType:O,roundTarget:I,tieFormat:n,drawSize:P,idPrefix:a,isMock:s,uuids:o});b=G,F=j,x=B[0],g=[1]}else({drawSize:P,matchUps:L,roundLimit:F}=gl({qualifyingRoundNumber:E,qualifyingPositions:k,matchUpType:O,drawSize:P,idPrefix:a,isMock:s,uuids:o})),x=ls({structureName:D.structureName||_,structureId:N||o?.pop(),qualifyingRoundNumber:F,hasExistingDrawDefinition:t,stage:We,qualifyingOnly:r,matchUpFormat:C,stageSequence:y,matchUpType:O,roundLimit:F,tieFormat:n,matchUps:L}),I&&gt({extension:{name:Al,value:I},element:x}),b=L?.filter(B=>B.roundNumber===F)?.length||0;if(y>1){let{link:B}=xS({sourceStructureId:U,sourceRoundNumber:S,targetStructureId:x.structureId,finishingPositions:T===pu?[1]:void 0,linkType:T});d.push(B),h+=(P||0)-b}else h+=P||0;T=A===Zs?pu:fu,U=x.structureId,S=F,n&&(L=kt({structure:x})?.matchUps||[],L?.forEach(B=>{let{tieMatchUps:G}=Mm({tieFormat:n,matchUp:B,isMock:s});Object.assign(B,{tieMatchUps:G,matchUpType:O})})),c.push(x),y+=1}m+=b,u.push({qualifiersCount:b,finalQualifyingRoundNumber:S,finalQualifyingStructureId:U,finishingPositions:g,roundTarget:I,linkType:T}),I+=1}return{qualifiersCount:m,qualifyingDrawPositionsCount:h,qualifyingDetails:u,structures:c,...H,links:d}}function vTe({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function eX(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=Ye(t.drawSize),n=e&&t.drawType!==ca&&(typeof e=="boolean"||e<=2)&&r===2&&il||t.drawType||il,a=O5.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=il;else if(r<4&&i)return{...z({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:lR},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function yTe(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:Jr(Fe),...t,stage:Fe},{structures:a,groupCount:s}=NS(n);if(s<1)return{error:cK};let o=i?.playoffGroups||[{finishingPositions:[1],structureName:Jr(Ai)}],[l]=a,{structures:u,links:c}=y9({sourceStructureId:l.structureId,requireSequential:r,drawDefinition:e,playoffGroups:o,groupCount:s,...t});return u&&a.push(...u),{...H,structures:a,links:c}}function bTe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),n=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),s=r.map((u,c)=>{let d=r.indexOf(u)%2?Os:Ap,p=1+c;return{linkType:hu,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),o={linkType:fu,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Os,roundNumber:n,structureId:t.structureId}},l=[{linkType:fu,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Os,roundNumber:1,structureId:i.structureId}},{linkType:hu,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Os,roundNumber:1,structureId:i.structureId}}];return[...s,o,...l]}function wTe({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let s=[],{matchUps:o}=Td({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=hd({structureName:t||Jr(Fe),structureId:a?.pop(),stageSequence:1,stage:Fe,matchUpType:e,matchUps:o});s.push(l);let u=r/2,{matchUps:c}=Td({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=hd({structureName:Jr(k5),matchUps:c,structureId:a?.pop(),stage:en,stageSequence:2,matchUpType:e});s.push(d);let{matchUps:p}=gl({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),f=hd({structureName:Jr(A5),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:Ai,matchUpType:e});s.push(f);let h=bTe({mainStructure:l,consolationStructure:d,deciderStructure:f});return{structures:s,links:h,...H}}function STe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:s,isMock:o,uuids:l}=t;if(!ut(s)||s<2)return{matchUps:[],roundsCount:0};if(Mo(s))return gl(t);let u=UTe(s),c=u.shift(),d=Re(1,(c?.participantsCount||0)+1).map(g=>({drawPosition:g})),p=[],f=1;({matchUps:p}=DP({roundNumber:f,matchUpType:n,idPrefix:a,matchUps:p,isMock:o,nodes:d,uuids:l})),f++;let h=t.roundLimit||e;for(let g of u){let I=g.participantsCount/2,v=Re(1,I+1);r&&I===r&&(h=f-1);let w=v.map(y=>{let b=I0({roundPosition:y,roundNumber:f,idPrefix:a,uuids:l});return{roundPosition:y,roundNumber:f,matchUpId:b}});p.push(...w),f++}let m=f-1;return p=DS({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:h,matchUps:p}),h&&(p=p.filter(g=>g.roundNumber<=h)),{matchUps:p,roundsCount:m,roundLimit:h}}function UTe(t){let e=Ye(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),s=a===1,o=!!(!s&&a%2);i=!s&&o?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:o})}return n}function tX(t){let{playoffAttributes:e,stageSequence:i=1,stage:r=Fe,tieFormat:n,matchUpType:a,drawSize:s,uuids:o}=t,l=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,u=t.structureId||l()||o?.pop(),c=t.appliedPolicies??Rt(t),d=t.policyDefinitions?.[dI]||c?.[dI];t.skipRounds=t.skipRounds||s<=4&&(d?.feedFromMainFinal?0:1)||0;let p=t.structureName??e?.["0"]?.name??Jr(Fe),f=()=>{let{matchUps:h}=gl(t);return{structures:[ls({stageSequence:i,structureName:p,matchUpType:a,structureId:u,tieFormat:n,matchUps:h,stage:r})],links:[],...H}};return{generators:{[ca]:()=>({structures:[ls({finishingPosition:kp,stageSequence:i,structureName:p,matchUps:[],matchUpType:a,structureId:u,stage:r})],links:[],...H}),[uf]:()=>{let{matchUps:h}=STe(t);return{structures:[ls({stageSequence:i,structureName:p,matchUpType:a,structureId:u,matchUps:h,stage:r})],links:[],...H}},[il]:()=>f(),[AR]:()=>f(),[tS]:()=>wTe(t),[oI]:()=>Yg({...t,childStage:Ai,roundOffsetLimit:3,playoffAttributes:e??q1}),[lI]:()=>Yg({...t,childStage:Ai,roundOffsetLimit:2,playoffAttributes:e??Y1}),[nS]:()=>Yg({...t,childStage:Ai}),[dv]:()=>{let{matchUps:h}=Td({drawSize:s,uuids:o,matchUpType:a});return{structures:[ls({stageSequence:i,structureName:p,matchUpType:a,structureId:u,stage:Fe,tieFormat:n,matchUps:h})],links:[],...H}},[iS]:()=>g9(t),[uI]:()=>Hf({...t,feedRounds:1,fmlc:!0}),[N5]:()=>Hf({...t,feedRounds:1}),[H1]:()=>Hf({...t,feedsFromFinal:1}),[W1]:()=>Hf({...t,feedsFromFinal:2}),[z1]:()=>Hf({...t,feedsFromFinal:3}),[rS]:()=>Hf(t),[NR]:()=>v9(t),[Zs]:()=>NS(t),[mu]:()=>yTe(t)}}}function F0(t){let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:r,qualifyingOnly:n,staggeredEntry:a,drawDefinition:s,tieFormat:o,isMock:l,uuids:u}=t||{},c=Ye(t.drawSize),d=t.drawTypeCoercion??HS({appliedPolicies:r,drawType:t.drawType}),p="generateDrawStructuresAndLinks",f=eX({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:d,drawSize:c});if(f.error)return f;let h=f.drawType,m=[],g=[],I=t?.matchUpType??zt,v=s?.structures?.filter(({stage:V})=>V===We);v&&m.push(...v);let w=v?.map(({structureId:V})=>V),y=s?.structures?.find(({stage:V,stageSequence:_})=>V===Fe&&_===1),b=s?.links?.filter(V=>V.target.structureId===y?.structureId&&w?.includes(V.source.structureId)),S=(V,_)=>{if(V.linkType===pu&&_?.structures){let B=V.source.finishingPositions||[];return _.structures.length*B.length}else if(V.linkType===fu&&_?.matchUps?.length){let B=V.source.roundNumber;return _.matchUps.filter(({roundNumber:G})=>G===B).length}},U=v?.map(V=>{let _=b?.find(K=>K.target.structureId===V.structureId),B=Kt({structure:V})?.positionAssignments?.length??0;if(!_)return B;let G=_?.source.structureId,j=s.structures?.find(K=>K.structureId===G),Y=S(_,j)||0;return B-Y}).filter(Boolean).reduce((V,_)=>V+_,0),T=b?.map(V=>{let _=V.source.structureId,B=v?.find(G=>G.structureId===_);return S(V,B)}).filter(Boolean).reduce((V,_)=>V+_,0),D=!!(y&&!y?.matchUps?.length);if(v?.length&&!D)return{error:AO};let P=!v?.length&&t.qualifyingProfiles,E=P?.length&&Z9({idPrefix:t.idPrefix,qualifyingProfiles:P,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,isMock:l,uuids:u});if(E?.error)return E;let{qualifyingDrawPositionsCount:R,qualifyingDetails:C,qualifiersCount:M}=E||{qualifyingDrawPositionsCount:U,qualifiersCount:T};R&&(E?.structures&&m.push(...E.structures),E?.links&&g.push(...E.links)),Object.assign(t,Ve({drawSize:c,matchUpType:I,tieFormat:o}));let N=h!==ca&&h!==AR&&(!c||c<2||!a&&![dv,uf].includes(h)&&([mu,Zs].includes(h)&&c<3||![Zs,mu].includes(h)&&!Mo(c)));if(N&&!R)return z({context:{drawSize:c,invalidDrawSize:N},result:{error:lR},stack:p});let{generators:A,error:O}=tX(t);if(O)return{error:O};let k=A[h];if(!k)return{error:u1};let F=k?.();if(F.error)return F;let{structures:x,links:L}=F;if(x?.length){let V=x.find(({stage:_,stageSequence:B})=>_===Fe&&B===1);if(y&&V){if(D){let _=V.structureId;if(V.structureId=y.structureId,L?.length)for(let B of L)B.source.structureId===_&&(B.source.structureId=y.structureId),B.target.structureId===_&&(B.target.structureId=y.structureId)}else if(!i)return{error:AO}}m.push(...x)}m.sort(vm),L?.length&&g.push(...L);let $=F.structures.find(({stage:V,stageSequence:_})=>V===Fe&&_===1);for(let V of C||[]){let{finalQualifyingRoundNumber:_,finalQualifyingStructureId:B,roundTarget:G,finishingPositions:j,linkType:Y}=V,K=$&&xS({targetStructureId:$.structureId,sourceStructureId:B,sourceRoundNumber:_,finishingPositions:j,targetEntryRound:G,linkType:Y})?.link;if(K?.error)return K;K&&g.push(K)}return b&&g.push(...b),{...H,qualifyingResult:{qualifyingDrawPositionsCount:R,qualifiersCount:M},structures:m,links:g}}function L0(t){let{modifyOriginal:e=!0,stageSequence:i=1,isMock:r}=t||{},n="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return z({result:{error:_e},stack:n});let a=e?t.drawDefinition:Oe(t.drawDefinition,!1,!0),{tieFormat:s,matchUpType:o}=t;if(s){let w=Hn({tieFormat:s});if(w.error)return w}s=Wr(s??yn({drawDefinition:a})?.tieFormat),o=o??(a.matchUpType||zt),t.tieFormat=s,t.matchUpType=o;let l=wP({drawDefinition:a,stage:Fe});t.drawSize=t.drawSize??l,!l&&t.drawSize&&UP({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:Fe});let u=Or({drawDefinition:a}).drawMatchUps.map(vr),c=F0(t);if(c.error)return z({result:c,stack:n});let{structures:d,links:p,qualifyingResult:f}=c;a.structures=d,a.links=p;let h=Math.max(t.qualifiersCount??0,f?.qualifiersCount||0);if(f?.qualifyingDrawPositionsCount&&!wP({stage:We,drawDefinition:a})){let w=UP({drawSize:f.qualifyingDrawPositionsCount,stage:We,drawDefinition:a});if(w.error)return w}if(h){let w=n9({qualifiersCount:h,drawDefinition:a,stage:Fe});if(w.error)return w}let m=t.drawSize??l;Object.assign(t,Ve({drawSize:m,matchUpType:o,tieFormat:s}));let{matchUps:g,matchUpsMap:I}=rr({drawDefinition:a});s&&g?.forEach(w=>{if(!u.includes(w.matchUpId)){let{tieMatchUps:y}=Mm({tieFormat:s,matchUp:w,isMock:r});Object.assign(w,{tieMatchUps:y,matchUpType:o})}});let{inContextDrawMatchUps:v}=Lp({drawDefinition:a,matchUpsMap:I});return ii({tournamentId:t.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:v,drawDefinition:a,matchUpsMap:I,...H,structures:d,matchUps:g,links:p}}function Pv(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,s;if(!rX({scaleItem:n}))return{error:kh};if(r&&Array.isArray(i.participants)&&(s=i.participants.find(o=>o.participantId===r),s)){if(s.participantType===jn&&n?.eventType!==Da)return{error:kh};let o=nX({removePriorValues:e,participant:s,scaleItem:n});if(o.error)return o;a=!o.valueChanged;let{topics:l}=bs();l.includes(tn)&&nt({topic:tn,payload:{tournamentId:i.tournamentId,participants:[s]}})}return a&&{...H,info:R1,existingValue:n?.scaleValue}||s&&{...H,newValue:n?.scaleValue}||{error:ji}}function iX(t){let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=t;if(!r)return{error:ge};if(!r.participants)return{error:Yw};let s=0,o={},l=[];for(let d of e){let p=d?.participantId;if(Array.isArray(d?.scaleItems))for(let f of d.scaleItems)if(rX({scaleItem:f}))Array.isArray(o[p])||(o[p]=[]),o[p].push(f);else return{error:kh}}for(let d of r.participants){let{participantId:p}=d||{};if(Array.isArray(o[p]))for(let f of o[p]){if(d.participantType===jn&&f?.eventType!==Da)return z({context:{participantId:p,scaleItem:f,participantType:d.participantType},info:"Invalid participantType for eventType",result:{error:kh}});nX({participant:d,scaleItem:f,removePriorValues:i}),l.push(d),s++}}let u=s?void 0:uv,{topics:c}=bs();if(c.includes(tn)&&s&&nt({topic:tn,payload:{tournamentId:r.tournamentId,participants:l}}),a){let{eventId:d,drawId:p,...f}=a,h=f.scaleAttributes?.scaleType&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let m={itemType:fL,itemValue:f};if(h&&(m.itemSubTypes=h),p||d){let{drawDefinition:g,event:I}=zn({tournamentRecord:r,eventId:d,drawId:p});p&&p0({drawDefinition:g,timeItem:m}),d&&Nm({event:I,timeItem:m})}else BS({tournamentRecord:r,timeItem:m})}}return n&&c.includes(sc)&&nt({topic:sc,payload:n}),Ve({...H,modificationsApplied:s,info:u})}function rX({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e?.includes(r)).length===i.length}function nX({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:dm};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(u=>r.includes(u)&&i[u]).length!==n.length)return{error:kh};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:s}=Zl({scaleAttributes:i,participant:e}),o=u=>[void 0,null,""].includes(u),l=!(o(s?.scaleValue)&&o(i.scaleValue))&&JSON.stringify(s?.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[vd,u,c,d].join("."),f=Ve({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(f.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(h=>h.itemType!==p)),e.timeItems.push(f)}return{...H,valueChanged:l,newValue:i.scaleValue}}function _0(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=Ge(t,[{[mr]:!0},{modifiedScaleValues:!0,[Xn]:Qn}]);if(n.error)return n;for(let a in i){let s=Pv({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(s.error)return s}return{...H}}var TTe=(t=0)=>250/Math.pow(t+5,.4),DTe=()=>1;function PTe(t=3,e=2){let i=t/e;return Number.isNaN(i)?Pg.kDefault():i}var Pg={nSpread:400,diffThreshold:.125,kCalc:TTe,kMultiplier:PTe,kDefault:DTe};function aX(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=Pr,winnerCountables:n=1,loserCountables:a=0,ratingType:s="ELO",maxCountables:o,countables:l}=t||{},u=r?.[s];if(!u)return{error:Xe};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,f=d?c.slice().reverse():c,h=(A,O)=>Number.parseFloat(O)>=Math.min(...A)&&Number.parseFloat(O)<=Math.max(...A);(!h(c,e)||!h(c,i))&&(h(c,e)||(e=u.defaultInitialization),h(c,i)||(i=u.defaultInitialization));let m=Ag({targetRange:Pr.ELO.range,sourceRange:f,value:d?c[0]-e:e}),g=Ag({targetRange:Pr.ELO.range,sourceRange:f,value:d?c[0]-i:i}),I=(A,O)=>1/(1+Math.pow(10,(O-A)/Pg.nSpread)),v=I(m,g),w=I(g,m),y=Pg.kCalc(n),b=Pg.kCalc(a),S=Pg.kMultiplier(o,l),U=m+S*y*(1-v),T=g+S*b*(0-w),D=Ag({sourceRange:Pr.ELO.range,value:U,targetRange:f}),P=Ag({sourceRange:Pr.ELO.range,value:T,targetRange:f}),E=d?c[0]-D:D,R=Number.parseFloat(E.toFixed(p)),C=d?c[0]-P:P,M=Number.parseFloat(C.toFixed(p)),N=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(D>P&&N>Pg.diffThreshold||R<0||M<0)&&(R=e,M=i),{newWinnerRating:R,newLoserRating:M}}var ETe=t=>t?.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0])||[0,0];function sX(t){let e=Ge(t,[{[mr]:!0},{matchUpIds:!0,[Xn]:sn,[$s]:um},{ratingType:!1,[qr]:v=>Pr[v]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a="ELO",refreshDynamic:s,considerGames:o,drawDefinition:l,matchUpIds:u,asDynamic:c}=t,d=Pr[a],{accessor:p}=d,f={},h=(t.matchUps||s&&Nn({drawDefinition:l,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:Ji}}).matchUps||wr({matchUpFilters:{matchUpIds:u,matchUpStatuses:Ji},tournamentRecord:n,inContext:!0}).matchUps)??[],m=`${a}.${rL}`,g=c?m:a;h.sort(Tm);for(let v of h){let{endDate:w,matchUpFormat:y,score:b,sides:S,winningSide:U}=v,T=v.matchUpType,D={eventType:T,scaleName:a,scaleType:fd},P={scaleName:m,eventType:T,scaleType:fd},E=Object.assign({},...(S??[]).map(x=>{let{sideNumber:L,participant:$}=x;return L&&{[L]:[$?.participantId,...$?.individualParticipantIds??[]].filter(Boolean).flat()}})),R=Object.assign({},...Object.values(E).flat().map(x=>{let L=f[x],$=!s||L?Bh({scaleAttributes:P,tournamentRecord:n,participantId:x}).scaleItem:void 0,V=Bh({tournamentRecord:n,scaleAttributes:D,participantId:x}).scaleItem,_=p?{[p]:void 0}:void 0;return x&&{[x]:$??V??{scaleName:g,eventType:T,scaleDate:w,scaleType:fd,scaleValue:_}}})),C=y?Ki(y):{},M=C?.bestOf||1,N=C?.setsTo||1,A=o?M&N:M,O=b?.sets&&ETe(b.sets)||U===1&&[1,0]||[0,1],k=U?E[U]:[],F=U?E[3-U]:[];for(let x of k){let L=R[x]?.scaleValue,$=typeof L=="object"?L[p]:L;for(let V of F){let _=R[V]?.scaleValue,B=typeof _=="object"?_[p]:_,G=U?O[U]:[0,0],j=U?O[3-U]:[0,0],{newWinnerRating:Y,newLoserRating:K}=aX({winnerCountables:G,loserCountables:j,maxCountables:A,winnerRating:$,loserRating:B,ratingType:a}),X=p?{...L,[p]:Y}:Y,Z=p?{..._,[p]:K}:K;R[x].scaleValue=X,R[V].scaleValue=Z,R[x].scaleName=g,R[V].scaleName=g}}Object.assign(f,R),i&&_0({tournamentRecord:n,modifiedScaleValues:f,removePriorValues:r})}let I=h.map(({matchUpId:v})=>v);return{...H,modifiedScaleValues:f,outputScaleName:g,processedMatchUpIds:I}}function TC(t){let{matchUpIds:e=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:s}=t;if(typeof i!="object")return{error:_e};let{participantIdPairings:o,matchUpsCount:l}=t,u=bC(t);if(u.error)return z({result:u});let{lastRoundNumber:c,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=u;if(!l)n?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return z({result:{error:ie,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(o&&!Array.isArray(o)||l&&!ut(l)||e&&!Array.isArray(e)||!o&&!l)return{error:ie,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:ie,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(c||0))return{error:ie,info:"roundNumber error"};let f=r??(n&&(c??0)+1||c||1);o=o??Re(0,l).map(()=>({participantIds:[void 0,void 0]}));let h=g=>{if(!t.idPrefix)return;let I=i.drawId,v=t.idPrefix??"ah";return`${I}-${v}-${f}-${g}`},m=o?.map((g,I)=>{let v=g?.participantIds??[void 0,void 0];v.push(void 0,void 0);let w=v.slice(0,2).map((b,S)=>Ve({sideNumber:S+1,participantId:b})),y=e[I]??h(I)??Pt();return{roundNumber:f,matchUpStatus:Li,matchUpId:y,sides:w}});if(m?.length){let g=yn({drawDefinition:i,event:s})?.tieFormat;g&&m.forEach(I=>{let{tieMatchUps:v}=Mm({tieFormat:g,matchUp:I,isMock:a});Object.assign(I,{tieMatchUps:v,matchUpType:ei})})}return{roundNumber:f,matchUpsCount:m?.length??0,matchUps:m,...H}}function RTe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(v=>({[v.pairing]:v.value}))),s=Object.keys(i),o=[],l=JW({actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),u=[ok(l)];o.push(l);let c=l.value,d=l,p=1,f=0,h=s.length,m;do h-=1,m=s.length*i[s[0]].length;while(m>t&&h>5);let g=[];s.forEach(v=>{i[v].slice(0,h).forEach(w=>{f+=1;let y=fh(v,w.opponent);if(!g.includes(y)){let b=JW({stipulated:[[v,w.opponent]],actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!u.includes(ok(b))){u.push(ok(b)),o.push(b);let{maxDelta:S,value:U}=b;S<d.maxDelta&&(d=b),(U<c||U===c&&Math.round(Math.random()))&&(c=U),g.push(y),p+=1}}}),o=o.filter(w=>Math.abs(w.value-c)<5)}),o.sort((v,w)=>v.maxDiff-w.maxDiff);let I=ba(o);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:f,candidate:I}}function ok(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function JW({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let s=e.flat(),o=[],l=0;e.filter(Boolean).forEach(d=>{let[p,f]=d,h=fh(p,f),m=i[h];o.push({participantIds:d,value:m}),l+=i[h]}),br(t,a).flatMap(d=>Rn(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((f,h)=>s.includes(h)||f,!1)){s.push(...p);let f=d.value;l+=f,o.push({participantIds:p,value:f})}}),o.sort((d,p)=>d.value-p.value);let u=o.reduce((d,p)=>{let[f,h]=p.participantIds,m=fh(f,h),g=r[m];return Math.max(g,d)},0),c=o.reduce((d,p)=>{let[f,h]=p.participantIds,m=fh(f,h),g=n[m];return Math.max(g,d)},0);return{value:l,participantIdPairings:o,maxDelta:u,maxDiff:c}}function fh(t,e){return[t,e].sort(oC).join("|")}function oX({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let s=fh(a,n);i.includes(s)||i.push(s)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function CTe({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(bt);if(r.length===2){let[n,a]=r,s=fh(n,a);e.includes(s)||e.push(s)}}return{encounters:e}}function MTe({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(s=>r(n,s));i[n]=a.sort((s,o)=>s.value-o.value)}function r(n,a){let s=fh(n,a);return{opponent:a,value:e[s]}}return{pairingValues:i}}var NTe=0;function ATe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){let a=Pr[r]?.defaultInitialization??NTe;return n.split("|").map(s=>{if(i===ps){let o=t?.find(l=>l.participantId===s)?.individualParticipantIds;return o?o?.map(l=>e[l]||a):a*2}else return e[s]||a})}function kTe(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:s,deltaObjects:o,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;n.forEach(w=>{let y=ATe({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:w}),b=typeof d=="number"&&d||.5,S=d&&(Math.round(Math.random())?b:b*-1)||0,U=Math.abs(y[0]-y[1])+S,T=Math.abs(y[0]-y[1]);o[w]=T,l[w]||(l[w]=0),l[w]+=U?Math.pow(U,2):0});let p=n.map(w=>({pairing:w,value:l[w]})).sort((w,y)=>w.value-y.value),{pairingValues:f}=MTe({possiblePairings:r,valueObjects:l}),{candidate:h,candidatesCount:m,deltaCandidate:g,iterations:I}=RTe({valueSortedPairings:p,maxIterations:a,pairingValues:f,deltaObjects:o,valueObjects:l}),{participantIdPairings:v}=s?g:h;return{participantIdPairings:v,candidatesCount:m,deltaCandidate:g,iterations:I,candidate:h}}var OTe=100,xTe=100,FTe=4e3;function $0(t){let{encounterValue:e=OTe,sameTeamValue:i=xTe,maxIterations:r=FTe,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:s,iterationMatchUps:o,tournamentRecord:l,dynamicRatings:u,refreshDynamic:c,participantIds:d,drawDefinition:p,roundNumber:f,structureId:h,matchUpIds:m,eventType:g,scaleName:I,idPrefix:v,isMock:w,salted:y,event:b}=t;if(!p)return{error:_e};if(!t.structure&&!h)return{error:vi};let S=t.structure||et({drawDefinition:p,structureId:h}).structure;if(!St(S))return{error:sf};if(!d?.length)return{error:Bd};let U=[...o??[],...S?.matchUps??[]],{encounters:T}=CTe({matchUps:U}),D=l?.participants??[],P={};if(u){let G=ot(S?.matchUps?S.matchUps.map(({roundNumber:Y})=>Y):[]),j=Math.max(...G,0);if(j){let Y=S?.matchUps?.filter(({roundNumber:X})=>X===j).map(({matchUpId:X})=>X),K=sX({ratingType:I??b?.category?.ratingType,updateParticipantRatings:n,tournamentRecord:l,asDynamic:!0,refreshDynamic:c,drawDefinition:p,matchUpIds:Y});if(K.error)return K;K.modifiedScaleValues&&(P=K.modifiedScaleValues)}}let{valueObjects:E}=LTe({tournamentParticipants:D,encounterValue:e,sameTeamValue:i,encounters:T}),{uniquePairings:R,possiblePairings:C,deltaObjects:M}=oX({participantIds:d}),N=Object.values(P).length?P:t.adHocRatings,A={tournamentParticipants:D,possiblePairings:C,uniquePairings:R,maxIterations:r,adHocRatings:N,deltaObjects:M,valueObjects:E,eventType:g,scaleName:I,salted:y},{candidatesCount:O,participantIdPairings:k,deltaCandidate:F,iterations:x,candidate:L}=kTe(A);if(!O)return{error:IR};let $,V;if(a){let G=TC({structureId:S?.structureId,ignoreLastRoundNumber:s,participantIdPairings:k,newRound:!0,drawDefinition:p,roundNumber:f,matchUpIds:m,idPrefix:v,isMock:w,event:b});if(G.error)return G;$=G.roundNumber,V=G.matchUps}let{maxDelta:_,maxDiff:B}=L;return{roundNumber:$,participantIdPairings:k,modifiedScaleValues:P,candidatesCount:O,deltaCandidate:F,...H,iterations:x,matchUps:V,maxDelta:_,maxDiff:B}}function LTe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let s of t)n[s]||(n[s]=0),n[s]+=i;let a=e?.filter(({participantType:s})=>s===_t);if(a)for(let s of a){let o=s.individualParticipantIds??[],{uniquePairings:l}=oX({participantIds:o});for(let u of l)n[u]||(n[u]=0),n[u]+=r}return{valueObjects:n}}function lX(t){let{drawType:e=il,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:s,placeByes:o,isMock:l,event:u}=t,c=t?.drawDefinition;if(!c)return{error:_e};let d=Rr,p=ym({stageSequence:1,drawDefinition:c,stage:d}),f=[Zs,tS,mu].includes(e)?p.length:nv(p.length);if(!a&&e===dv&&p.length<2||e===Zs&&p.length<3)return{error:lR};let{tieFormat:h,matchUpType:m}=t;if(h){let E=Hn({tieFormat:h});if(E.error)return E}h=Wr(h??yn({drawDefinition:c})?.tieFormat),m=m??c.matchUpType;let{structures:g}=to({stageSequence:1,drawDefinition:c,stage:d});if(g.length>1)return{error:T4};if(g?.[0]?.matchUps?.length)return{error:N1};let I=g?.[0]?.structureId;Object.assign(t,Ve({structureName:t.structureName??Jr(Rr),structureId:I,matchUpType:m,tieFormat:h,drawSize:f,stage:d}));let v=tX(t);if(v.error)return v;let w=v.generators[e];if(!w)return{error:u1};let y=w?.();if(y.error)return y;let{structures:b,links:S}=y,U=b.flatMap(E=>kt({structure:E}).matchUps);h&&U.forEach(E=>{let{tieMatchUps:R}=Mm({matchUp:E,tieFormat:h,isMock:l});Object.assign(E,{tieMatchUps:R,matchUpType:m})}),(!r||!i)&&(c=Oe(c,!1,!0)),c.links??=[],S.length&&c.links.push(...S);let T=new Set(b.map(({structureId:E})=>E));c.structures??=[];let D=new Set(c.structures.map(({structureId:E})=>E));c.structures=c.structures.map(E=>T.has(E.structureId)?b.find(({structureId:R})=>R===E.structureId):E);let P=b.filter(({structureId:E})=>!D.has(E));return P.length&&c.structures.push(...P),s&&OS({seedingProfile:t.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:c,structureId:I,placeByes:o,drawSize:f,event:u}),i&&ii({drawDefinition:c}),{links:S,structures:b,...H}}var B0={};pt(B0,{ScoringEngine:()=>mX,addPoint:()=>Sp,analyzeScore:()=>a_,analyzeSequence:()=>KX,analyzeSet:()=>qb,calculateMatchStatistics:()=>J0,calculatePointsTo:()=>PC,checkScoreHasValue:()=>dr,checkSetIsComplete:()=>MC,createMatchUp:()=>ud,deduceMatchUpFormat:()=>FC,enrichPointHistory:()=>fX,exportMatchUpJSON:()=>iEe,generate:()=>uX,generateScoreString:()=>eu,generateTieMatchUpScore:()=>_S,getEpisodes:()=>X0,getQuickStats:()=>hX,getScore:()=>Dd,getScoreboard:()=>q0,getSetComplement:()=>o_,getSetScoreString:()=>$Pe,getTiebreakComplement:()=>xC,getWinner:()=>Y0,groupByMatch:()=>ZX,helpers:()=>IX,inferServeSide:()=>j0,isComplete:()=>K0,isValidMatchUpFormat:()=>Ga,keyValueScore:()=>_X,mcpValidator:()=>tEe,mutate:()=>gX,parseCSV:()=>QX,parseMCPPoint:()=>JX,parseMatchUpFormat:()=>Ki,parseScoreString:()=>zS,pbpValidator:()=>VPe,pointParser:()=>XX,query:()=>GX,resolvePointValue:()=>G0,reverseScore:()=>cX,shotParser:()=>dx,shotSplitter:()=>YX,stringifyMatchUpFormat:()=>DR,tidyScore:()=>jX,toStatObjects:()=>Q0,validateMCPMatch:()=>eJ,validateMatchUp:()=>WX,validateMatchUpScore:()=>HX,validateScore:()=>s_,validateSet:()=>BPe,validateSetScore:()=>n_,validateTieFormat:()=>Hn});var uX={};pt(uX,{ScoringEngine:()=>mX,generateScoreString:()=>eu,generateTieMatchUpScore:()=>_S,reverseScore:()=>cX});function eu(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:r,reversed:n=!1,matchUpStatus:a,matchUpFormat:s,autoComplete:o,winningSide:l,sets:u}=t;if(!u)return{error:Xe,info:"missing sets"};let c=s&&Ki(s),{bestOf:d,finalSetFormat:p,setFormat:f}=c??{},h=n||!(!e||!l||l===1),m=r?_Te({matchUpStatus:a}):"",g=u?.sort($Te).map(I).filter(Boolean).join(" ")||"";if(!m)return g;if(l===2)return`${m} ${g}`;return`${g} ${m}`;function I(v){let w=d&&v.setNumber===d&&p?p:f,y=V=>Mi(V?.side1Score)||Mi(V?.side2Score),b=(V=>Mi(V?.side1TiebreakScore)||Mi(V?.side2TiebreakScore))(v),S=w?.tiebreakSet||!y(v)&&b,{side1Score:U,side2Score:T,side1TiebreakScore:D,side2TiebreakScore:P}=v,E=D||(Mi(D)||b&&o?0:""),R=P||(Mi(P)||b&&o?0:"");if(S){let V=y(v)&&!b,_=V?U:E,B=V?T:R;return`[${(h?[B,_]:[_,B]).join("-")}]`}let C=b?Math.min(E,R):"",M=C===E?1:2,N=Mi(C)?`(${C})`:"",A=U||(Mi(U)||o?0:""),O=T||(Mi(T)||o?0:""),k=V=>!i&&M===V?N:"",F=`${A}${k(1)}`,x=`${O}${k(2)}`,L=i&&b?`(${C})`:"",$=h?`${[x,F].join("-")}${L}`:`${[F,x].join("-")}${L}`;return["-"," "].includes($)&&($=""),$}}function _Te({matchUpStatus:t}){let e={[jr]:"RET",[mi]:"WO",[Wi]:"DF/DF",[Si]:"WO/WO",[Hd]:"SUS",[fs]:"ABN",[Zt]:"DEF",[mv]:"DR"};return t&&e[t]||""}function $Te(t,e){return t.setNumber-e.setNumber}function cX(t){if(!t?.score)return{error:Xe};let{sets:e}=t.score,i=e.map(s=>{let{side1TiebreakScore:o,side2TiebreakScore:l,winningSide:u,side1Score:c,side2Score:d,setNumber:p}=s;return Ve({winningSide:u?3-u:void 0,side1TiebreakScore:l,side2TiebreakScore:o,side1Score:d,side2Score:c,setNumber:p})}),r=t?.setTBlast,n=eu({setTBlast:r,sets:i}),a=eu({sets:i,reversed:!0,setTBlast:r});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:a},...H}}function ud(t){let{matchUpId:e=Pt(),matchUpFormat:i,participants:r=[],isDoubles:n=!1,matchUpType:a}=t,s=a||(n?"DOUBLES":"SINGLES"),o=r.map((l,u)=>({sideNumber:u+1,participantId:l.participantId,participant:l}));return o.length===0&&o.push({sideNumber:1},{sideNumber:2}),{matchUpId:e,matchUpFormat:i,matchUpStatus:"TO_BE_PLAYED",matchUpType:s,sides:o,score:{sets:[]},createdAt:new Date().toISOString()}}function V0(t){return t?!!t.aggregate:!1}function DC(t,e){let i=t.bestOf||t.exactly||3,r=Math.ceil(i/2);if(e[0]===r-1&&e[1]===r-1&&t.finalSetFormat){let a=t.finalSetFormat;return a.tiebreakSet?"matchTiebreak":a.timed?"timed":"standard"}let n=t.setFormat;return n?n.tiebreakSet?"tiebreakOnly":n.timed?"timed":"standard":"standard"}function PC(t,e,i,r,n){if(i==="timed"||!r)return;let a=BTe(t),s=VTe(t),o=e.exactly||e.bestOf||3,l=Math.ceil(o/2),{side1Points:u,side2Points:c}=jTe(a),d=GTe(u,c,r,i,e,a),p=WTe(a,r,i),f=zTe(d,p,r,i),h=qTe(f,s,l,e),m=KTe(d,n);return{pointsToGame:d,pointsToSet:f,pointsToMatch:h,gamesToSet:p,isBreakpoint:m}}function BTe(t){let e=t.score.sets;if(e.length===0)return;let i=e.at(-1);return i?.winningSide===void 0?i:void 0}function VTe(t){let e=[0,0];return t.score.sets.forEach(i=>{i.winningSide===1&&e[0]++,i.winningSide===2&&e[1]++}),e}function jTe(t){if(!t)return{side1Points:0,side2Points:0};let e=t.side1GameScores||[],i=t.side2GameScores||[];if(e.length===0&&i.length===0)return{side1Points:0,side2Points:0};let r=Math.max(e.length,i.length)-1;return{side1Points:e[r]??0,side2Points:i[r]??0}}function GTe(t,e,i,r,n,a){if(r==="tiebreakOnly"){let s=i.tiebreakSet?.tiebreakTo||11,o=i.tiebreakSet?.NoAD||!1;return lk(t,e,s,o)}if(r==="matchTiebreak"){let s=n.finalSetFormat?.tiebreakSet?.tiebreakTo||10,o=n.finalSetFormat?.tiebreakSet?.NoAD||!1;return lk(t,e,s,o)}if(a){let s=a.side1Score||0,o=a.side2Score||0,l=i.setTo||6,u=(typeof i.tiebreakAt=="number"?i.tiebreakAt:void 0)??l;if(!i.noTiebreak&&s===u&&o===u){let c=i.tiebreakFormat?.tiebreakTo||7,d=i.tiebreakFormat?.NoAD||!1;return lk(t,e,c,d)}}if(n.gameFormat?.type==="CONSECUTIVE"){let s=n.gameFormat.count||3;return[s,s]}return HTe(t,e,i)}function HTe(t,e,i){let r=i.gameFormat?.NoAD||i.NoAD||!1,n=4;return[QW(t,e,n,r),QW(e,t,n,r)]}function QW(t,e,i,r){if(t>=i-1&&e>=i-1){if(r)return t>e?0:t===e?1:2;let n=t-e;return n>=2?0:n===1?1:2}return t>=i?0:i-t}function lk(t,e,i,r){return[ZW(t,e,i,r),ZW(e,t,i,r)]}function ZW(t,e,i,r){if(t>=i&&(t-e>=2||r&&t>e))return 0;if(t>=i-1&&e>=i-1){if(r)return t>e?0:t===e?1:2;let n=t-e;return n>=2?0:n===1?1:2}return t>=i?0:i-t}function WTe(t,e,i){if(i==="tiebreakOnly"||i==="matchTiebreak")return!t||t.winningSide!==void 0?[1,1]:[1,1];let r=t?.side1Score||0,n=t?.side2Score||0,a=e.setTo||6,s=(typeof e.tiebreakAt=="number"?e.tiebreakAt:void 0)??a,o=e.noTiebreak||!1,l=e.winBy||2;return[ez(r,n,a,s,o,l),ez(n,r,a,s,o,l)]}function ez(t,e,i,r,n,a){if(!n&&t===r&&e===r)return 1;if(t>=i){let o=t-e;return o>=a?0:a-o}let s=i-t;if(e>=i-1&&t>=i-1){if(!n)return Math.max(1,i-t);let o=t-e;return o>=a?0:a-o}return s}function zTe(t,e,i,r){if(r==="tiebreakOnly"||r==="matchTiebreak")return[...t];let n=4;return[tz(t[0],e[0],n),tz(t[1],e[1],n)]}function tz(t,e,i){if(e<=0)return 0;let r=Math.max(0,e-1);return t+r*i}function qTe(t,e,i,r){let n=r.setFormat,a=YTe(n,r);return[iz(t[0],e[0],i,a),iz(t[1],e[1],i,a)]}function YTe(t,e){if(!t)return 24;if(t.tiebreakSet)return t.tiebreakSet.tiebreakTo||11;if(t.timed)return 0;let i=t.setTo||6,r=e.gameFormat?.type==="CONSECUTIVE"?e.gameFormat?.count||3:4;return i*r}function iz(t,e,i,r){if(e>=i)return 0;let n=Math.max(0,i-e-1);return t+n*r}function KTe(t,e){if(e===void 0)return!1;let i=1-e;return t[i]===1}function j0(t,e,i){if(i==="timed")return;let r=XTe(t);return V0(e)?JTe(t,r):i==="tiebreakOnly"||i==="matchTiebreak"?QTe(r):ZTe(t,e,r)}function XTe(t){let e=t.score.sets;if(e.length===0)return;let i=e[e.length-1];return i.winningSide===void 0?i:void 0}function JTe(t,e){let i=0;for(let r of t.score.sets)r.winningSide!==void 0&&(r.side1TiebreakScore!==void 0?i+=(r.side1TiebreakScore??0)+(r.side2TiebreakScore??0):i+=(r.side1Score??0)+(r.side2Score??0));if(e&&e.winningSide===void 0){let r=e.side1GameScores||[],n=e.side2GameScores||[];if(r.length>0||n.length>0){let a=Math.max(r.length,n.length)-1;i+=(r[a]??0)+(n[a]??0)}else i+=(e.side1Score??0)+(e.side2Score??0)}return i%2===0?"deuce":"ad"}function QTe(t){if(!t)return"deuce";let e=t.side1GameScores||[],i=t.side2GameScores||[];return e.length===0&&i.length===0||((e[0]??0)+(i[0]??0))%2===0?"deuce":"ad"}function ZTe(t,e,i){if(!i)return"deuce";let r=i.side1GameScores||[],n=i.side2GameScores||[];if(r.length===0&&n.length===0)return"deuce";let a=Math.max(r.length,n.length)-1;return((r[a]??0)+(n[a]??0))%2===0?"deuce":"ad"}function G0(t,e){if(!e.length)return 1;for(let{condition:i,value:r}of e)if(i.results&&t.result&&i.results.includes(t.result)||i.strokes&&t.stroke&&i.strokes.includes(t.stroke))return r;return 1}function Sp(t,e,i){if(!St(e))return t;let r=e.winner,n=e.server,{timestamp:a}=e;if(r===void 0&&e.winningSide!==void 0&&(r=e.winningSide-1),n===void 0&&e.serverSideNumber!==void 0&&(n=e.serverSideNumber-1),r==null)return t;let s=t;s.history??={points:[]};let o=Ki(t.matchUpFormat);if(!o)throw new Error(`Invalid matchUpFormat: ${t.matchUpFormat}`);let l=o.exactly||o.bestOf||3,u=Math.ceil(l/2),c=s.history.points.length+1,d=s.history.points.length,p=[0,0];s.score.sets.forEach(U=>{U.winningSide===1&&p[0]++,U.winningSide===2&&p[1]++});let f=DC(o,p),h=p[0]===u-1&&p[1]===u-1,m=h&&o.finalSetFormat?o.finalSetFormat:o.setFormat,g=m?.tiebreakSet?.modifier==="RALLY"||m?.modifier==="RALLY";n===void 0&&!g&&(n=z0(s,o,f));let I=e.code;!I&&r!==void 0&&n!==void 0&&(I=r===n?"S":"R");let v={...e,pointNumber:c,winner:r,winningSide:r+1,server:n,serverSideNumber:n!==void 0?n+1:void 0,serverParticipantId:e.serverParticipantId,timestamp:a||new Date().toISOString()};I&&(v.code=I),v.index=d;let w=PC(s,o,f,m,n);w&&(v.pointsToGame=w.pointsToGame,v.pointsToSet=w.pointsToSet,v.pointsToMatch=w.pointsToMatch,v.gamesToSet=w.gamesToSet,v.isBreakpoint=w.isBreakpoint);let y=j0(s,o,f);y!==void 0&&(v.serveSide=y);let b=i?.pointMultipliers||[],S=e.scoreValue??G0(v,b);switch(S!==1&&(v.scoreValue=S),s.history.points.push(v),s.matchUpStatus==="TO_BE_PLAYED"&&(s.matchUpStatus="IN_PROGRESS"),f){case"tiebreakOnly":tDe(s,v,r,o,m,p,u,S);break;case"matchTiebreak":iDe(s,v,r,o,p,u,S);break;case"timed":rDe(s,v,r,m,S);break;default:eDe(s,v,r,o,m,p,u,h);break}return s}function eDe(t,e,i,r,n,a,s,o){let l=EC(t,!1,!1),u=t.score.sets.indexOf(l),c=l.side1Score||0,d=l.side2Score||0,p=l.side1GameScores||[],f=l.side2GameScores||[];p.length===0&&f.length===0&&(p.push(0),f.push(0));let h=Math.max(p.length,f.length)-1,m=h>=0?p[h]??0:0,g=h>=0?f[h]??0:0,I=Math.max(p.length,f.length)-1,v=c+d-I;e.set=u,e.game=v+h,e.number=m+g;let w=n.setTo||6,y=(typeof n.tiebreakAt=="number"?n.tiebreakAt:void 0)??w,b=o&&r.finalSetFormat?.noTiebreak;i===0?(m++,p[p.length-1]=m):(g++,f[f.length-1]=g),l.side1GameScores=p,l.side2GameScores=f;let S=r.gameFormat?.type==="CONSECUTIVE",U=r.gameFormat?.count||3;if(S){let E=l.currentStreak;E&&E.side===i?l.currentStreak={side:i,count:E.count+1}:l.currentStreak={side:i,count:1}}let T=!b&&c===y&&d===y,D;S&&!T?D=l.currentStreak.count>=U?l.currentStreak.side:void 0:D=nDe(m,g,n,T);let P=D===void 0?dX(m,g,T,S&&!T):"0-0";if(e.score=P,D!==void 0){S&&(l.currentStreak=void 0),D===0?l.side1Score=c+1:l.side2Score=d+1,T&&(l.side1TiebreakScore=m,l.side2TiebreakScore=g);let E=aDe(l.side1Score||0,l.side2Score||0,n,o,r.finalSetFormat);typeof E=="number"?(l.winningSide=E+1,H0(t,r,s)):(l.side1GameScores.push(0),l.side2GameScores.push(0))}}function tDe(t,e,i,r,n,a,s,o=1){let l=EC(t,!0,!1),u=t.score.sets.indexOf(l),c=n.tiebreakSet.tiebreakTo||11,d=n.tiebreakSet.NoAD||!1,p=l.side1GameScores||[],f=l.side2GameScores||[];p.length===0&&f.length===0&&(p.push(0),f.push(0),l.side1GameScores=p,l.side2GameScores=f);let h=p[0]||0,m=f[0]||0;e.set=u,e.game=0,e.number=h+m,i===0?(h+=o,p[0]=h):(m+=o,f[0]=m),l.side1GameScores=p,l.side2GameScores=f;let g=W0(h,m,c,d);e.score=g===void 0?`${h}-${m}`:"0-0",g!==void 0&&(l.winningSide=g+1,l.side1TiebreakScore=h,l.side2TiebreakScore=m,l.side1Score=g===0?1:0,l.side2Score=g===0?0:1,H0(t,r,s))}function iDe(t,e,i,r,n,a,s=1){let o=r.finalSetFormat?.tiebreakSet?.tiebreakTo||10,l=r.finalSetFormat?.tiebreakSet?.NoAD||!1,u=EC(t,!1,!1),c=t.score.sets.indexOf(u),d=u.side1GameScores||[],p=u.side2GameScores||[];d.length===0&&p.length===0&&(d.push(0),p.push(0),u.side1GameScores=d,u.side2GameScores=p);let f=d[0]||0,h=p[0]||0;e.set=c,e.game=0,e.number=f+h,i===0?(f+=s,d[0]=f):(h+=s,p[0]=h),u.side1GameScores=d,u.side2GameScores=p;let m=W0(f,h,o,l);e.score=m===void 0?`${f}-${h}`:"0-0",m!==void 0&&(u.side1TiebreakScore=f,u.side2TiebreakScore=h,u.side1Score=m===0?1:0,u.side2Score=m===0?0:1,u.winningSide=m+1,H0(t,r,a))}function rDe(t,e,i,r,n=1){let a=EC(t,!1,!0),s=t.score.sets.indexOf(a);e.set=s,e.game=0,e.number=(a.side1Score||0)+(a.side2Score||0),i===0?a.side1Score=(a.side1Score||0)+n:a.side2Score=(a.side2Score||0)+n;let o=a.side1Score||0,l=a.side2Score||0;e.score=`${o}-${l}`}function EC(t,e,i){let r=t.score.sets.length-1;if(r>=0&&t.score.sets[r].winningSide===void 0)return t.score.sets[r];let n={setNumber:t.score.sets.length+1,side1Score:0,side2Score:0,side1GameScores:[],side2GameScores:[]};return e&&(n.isTiebreakOnly=!0),i&&(n.isTimed=!0),t.score.sets.push(n),n}function H0(t,e,i){let r=[0,0];t.score.sets.forEach(o=>{o.winningSide===1&&r[0]++,o.winningSide===2&&r[1]++});let n=V0(e),a=e.exactly;if(n){let o=a||e.bestOf||3;if(t.score.sets.filter(u=>u.winningSide!==void 0).length<o)return;let l=t.score.sets.reduce((u,c)=>(c.side1TiebreakScore!==void 0&&c.side2TiebreakScore!==void 0?(u[0]+=c.side1TiebreakScore,u[1]+=c.side2TiebreakScore):(u[0]+=c.side1Score??0,u[1]+=c.side2Score??0),u),[0,0]);l[0]!==l[1]&&(t.matchUpStatus="COMPLETED",t.winningSide=l[0]>l[1]?1:2,t.endTime=new Date().toISOString());return}if(!(r[0]>=i||r[1]>=i)||a&&t.score.sets.filter(o=>o.winningSide!==void 0).length<a)return;let s=r[0]>=i?0:1;t.matchUpStatus="COMPLETED",t.winningSide=s+1,t.endTime=new Date().toISOString()}function W0(t,e,i,r=!1){let n=Math.abs(t-e),a=r?1:2;if((t>=i||e>=i)&&n>=a)return t>e?0:1}function nDe(t,e,i,r){let n=i.gameFormat?.NoAD||i.NoAD||!1;if(r){let o=i.tiebreakFormat?.tiebreakTo||7,l=i.tiebreakFormat?.NoAD||!1;return W0(t,e,o,l)}let a=4,s=Math.abs(t-e);if(n)return t>=a||e>=a?t>e?0:1:void 0;if((t>=a||e>=a)&&s>=2)return t>e?0:1}function aDe(t,e,i,r,n){let a=i.setTo||6,s=(typeof i.tiebreakAt=="number"?i.tiebreakAt:void 0)??a,o=r&&n?.noTiebreak;if(a===1)return t>=1||e>=1?t>e?0:1:void 0;let l=(r&&n?n:i).winBy||2;if(!o&&(t===s+1||e===s+1)||(t>=a||e>=a)&&Math.abs(t-e)>=l)return t>e?0:1}function z0(t,e,i){let r=sDe(t,e,i);return t.history?.points?.[0]?.server===1?1-r:r}function sDe(t,e,i){let r=t.score.sets.length-1,n=r>=0?t.score.sets[r]:void 0;if(i==="tiebreakOnly"||i==="matchTiebreak"){let u=n?.side1GameScores||[],c=n?.side2GameScores||[],d=(u[0]||0)+(c[0]||0),p=0;for(let m=0;m<t.score.sets.length-1;m++){let g=t.score.sets[m];p+=(g.side1Score||0)+(g.side2Score||0)}let f=p%2,h=Math.floor(d/2)%2;return(f+h)%2}if(i==="timed")return((n?.side1Score||0)+(n?.side2Score||0))%2;let a=n?.side1Score||0,s=n?.side2Score||0,o=e.setFormat?.setTo||6,l=(typeof e.setFormat?.tiebreakAt=="number"?e.setFormat.tiebreakAt:void 0)??o;if(!e.finalSetFormat?.noTiebreak&&a===l&&s===l){let u=n?.side1GameScores||[],c=n?.side2GameScores||[],d=(u.at(-1)||0)+(c.at(-1)||0),p=(a+s)%2,f=Math.floor(d/2)%2;return(p+f)%2}return(a+s)%2}function dX(t,e,i,r){if(i||r)return`${t}-${e}`;let n=["0","15","30","40"];if(t<4&&e<4)return`${n[t]}-${n[e]}`;if(t>=3&&e>=3&&t===e)return"40-40";if(t>=3&&e>=3){let a=t-e;if(a===1)return"A-40";if(a===-1)return"40-A";if(a>=2)return"G-40";if(a<=-2)return"40-G"}return t>=3?`40-${e<4?n[e]:"40"}`:e>=3?`${t<4?n[t]:"40"}-40`:`${t<4?n[t]:"0"}-${e<4?n[e]:"0"}`}function Dd(t,e){let i=t.score.sets,r=uDe(t,e?.useBracketNotation),n=i.length>0?i.at(-1):null,a=n&&n.winningSide===void 0?[n.side1Score||0,n.side2Score||0]:[0,0],s=[0,0];if(n?.side1GameScores&&n.side2GameScores){let u=Math.max(n.side1GameScores.length,n.side2GameScores.length)-1;u>=0&&(s=[n.side1GameScores[u]||0,n.side2GameScores[u]||0])}let o=oDe(t,s),l=lDe(t);return{sets:i,scoreString:r,games:a,points:s,pointDisplay:o,situation:l}}function oDe(t,e){if(t.matchUpStatus==="COMPLETED"||t.matchUpStatus==="TO_BE_PLAYED")return;let i=Ki(t.matchUpFormat);if(!i)return;let r=t.score.sets.at(-1);if(!r||r.winningSide!==void 0)return;let n=[0,0];t.score.sets.forEach(c=>{c.winningSide===1&&n[0]++,c.winningSide===2&&n[1]++});let a=DC(i,n),s=a==="tiebreakOnly"||a==="matchTiebreak",o=i.gameFormat?.type==="CONSECUTIVE",l=s;if(!l&&a==="standard"){let c=i.exactly||i.bestOf||3,d=Math.ceil(c/2),p=n[0]===d-1&&n[1]===d-1,f=p&&i.finalSetFormat?i.finalSetFormat:i.setFormat;if(f){let h=r.side1Score||0,m=r.side2Score||0,g=f.setTo||6,I=(typeof f.tiebreakAt=="number"?f.tiebreakAt:void 0)??g,v=f.noTiebreak||!1,w=p&&i.finalSetFormat?.noTiebreak;l=!v&&!w&&h===I&&m===I}}let u=dX(e[0],e[1],l,o&&!l).split("-");return u.length===2?[u[0],u[1]]:[String(e[0]),String(e[1])]}function lDe(t){if(t.matchUpStatus==="COMPLETED"||t.matchUpStatus==="TO_BE_PLAYED")return;let e=Ki(t.matchUpFormat);if(!e)return;let i=e.exactly||e.bestOf||3,r=Math.ceil(i/2),n=[0,0];t.score.sets.forEach(y=>{y.winningSide===1&&n[0]++,y.winningSide===2&&n[1]++});let a=DC(e,n),s=n[0]===r-1&&n[1]===r-1,o=s&&e.finalSetFormat?e.finalSetFormat:e.setFormat,l=o?.tiebreakSet?.modifier==="RALLY"||o?.modifier==="RALLY",u;l||(u=z0(t,e,a));let c=PC(t,e,a,o,u);if(!c)return{isBreakPoint:!1,isGamePoint:!1,isSetPoint:!1,isMatchPoint:!1,isGoldenPoint:!1,isTiebreak:!1,server:u};let{pointsToGame:d,pointsToSet:p,pointsToMatch:f,isBreakpoint:h}=c,m=a==="tiebreakOnly"||a==="matchTiebreak";if(!m&&a==="standard"&&o){let y=t.score.sets.at(-1);if(y){let b=y.side1Score||0,S=y.side2Score||0,U=o.setTo||6,T=(typeof o.tiebreakAt=="number"?o.tiebreakAt:void 0)??U,D=o.noTiebreak||!1,P=s&&e.finalSetFormat?.noTiebreak;m=!D&&!P&&b===T&&S===T}}let g=!!(o?.NoAD||o?.gameFormat?.NoAD||m&&(o?.tiebreakFormat?.NoAD||o?.tiebreakSet?.NoAD||e.finalSetFormat?.tiebreakSet?.NoAD))&&d[0]===1&&d[1]===1,I=u===void 0?!1:d[u]===1,v=Math.min(p[0],p[1])===1,w=Math.min(f[0],f[1])===1;return{isBreakPoint:h,isGamePoint:I,isSetPoint:v,isMatchPoint:w,isGoldenPoint:g,isTiebreak:m,server:u}}function uDe(t,e=!1){let i=t.score.sets;return i.length===0?"0-0":i.map(r=>{let n=r.side1Score||0,a=r.side2Score||0;if(r.side1TiebreakScore!==void 0||r.side2TiebreakScore!==void 0){let s=r.side1TiebreakScore||0,o=r.side2TiebreakScore||0;return e&&(n===0&&a===1||n===1&&a===0)?`[${s}-${o}]`:n>a?`${n}-${a}(${o})`:`${n}(${s})-${a}`}return`${n}-${a}`}).join(", ")}function q0(t,e){let i=t.score.sets;if(i.length===0)return"0-0";let r=e?.perspective,n=i.map(s=>{let o=s.side1Score||0,l=s.side2Score||0;if(r===1&&([o,l]=[l,o]),s.side1TiebreakScore!==void 0||s.side2TiebreakScore!==void 0){let u=s.side1TiebreakScore||0,c=s.side2TiebreakScore||0;return r===1&&([u,c]=[c,u]),o>l?`${o}-${l}(${c})`:`${o}(${u})-${l}`}return`${o}-${l}`}),a=i.at(-1);if(t.matchUpStatus==="IN_PROGRESS"&&a&&!a.winningSide){let s=a.side1GameScores||[],o=s.length-1;if(o>=0&&s.length>0){let l=s[o]||0,u=(a.side2GameScores||[])[o]||0;if(l===0&&u===0)return n.join(", ");r===1&&([l,u]=[u,l]);let c=a.side1Score||0,d=a.side2Score||0,p=t.matchUpFormat?Ki(t.matchUpFormat):void 0,f=p?.setFormat?.setTo||6,h=(typeof p?.setFormat?.tiebreakAt=="number"?p.setFormat.tiebreakAt:void 0)??f,m=c===h&&d===h,g=p?.gameFormat?.type==="CONSECUTIVE",I=n.at(-1),v=`${n.slice(0,-1).join(", ")}${n.length>1?", ":""}${I}`;if(m||g)return`${v} (${l}-${u})`;{let w=cDe(l,u);return`${v} (${w})`}}}return n.join(", ")}function cDe(t,e){let i=["0","15","30","40"];if(t<=3&&e<=3)return`${i[t]}-${i[e]}`;if(t>=3&&e>=3){let r=t-e;return r===0?"40-40":r===1?"A-40":r===-1?"40-A":r>=2?"G-40":"40-G"}return t>=3?"G-40":e>=3?"40-G":`${i[t]}-${i[e]}`}function Y0(t){if(t.matchUpStatus==="COMPLETED")return t.winningSide}function K0(t){return t.matchUpStatus==="COMPLETED"}function X0(t){if(!t)return[];let e=t.history?.points;if(!e||e.length===0)return[];let i=[];for(let r=0;r<e.length;r++){let n=e[r],a=r<e.length-1?e[r+1]:void 0,s=n.set??0,o=n.game??0,l=n.number??0,u=a?a.set??0:void 0,c=a?a.game??0:void 0,d=r===e.length-1,p=d?t.matchUpStatus==="COMPLETED"||u===void 0&&c===void 0:u!==s||c!==o,f=d?t.matchUpStatus==="COMPLETED"||!1:a!==void 0&&u!==s,h;p&&(h=n.winner);let m;if(f){let b=t.score.sets[s];b?.winningSide!==void 0&&(m=b.winningSide-1)}let g={};n.pointsToGame&&(g.pointsToGame=n.pointsToGame),n.pointsToSet&&(g.pointsToSet=n.pointsToSet),n.pointsToMatch&&(g.pointsToMatch=n.pointsToMatch),n.gamesToSet&&(g.gamesToSet=n.gamesToSet),n.isBreakpoint!==void 0&&(g.isBreakpoint=n.isBreakpoint);let I=a?.server??n.server??0,v=t.score.sets[s],w=!!(v?.isTiebreakOnly||o>0&&v&&v.side1Score!==void 0&&v.side2Score!==void 0&&!v.isTiebreakOnly),y={action:"addPoint",point:{index:r,number:l,winner:n.winner,server:n.server,score:n.score,result:n.result},game:{index:o,isTiebreak:w,complete:p,winner:h},set:{index:s,complete:f,winner:m},needed:g,nextService:I,result:n.result,complete:d&&t.matchUpStatus==="COMPLETED"};i.push(y)}return i}var dDe={A:"Ace",D:"Double Fault",S:"Serve Winner",R:"Return Winner",W:"Winner",E:"Unforced Error",F:"Forced Error"},pDe=new Set(["A","S"]),fDe=new Set(["D","R","E","F"]);function hDe(t,e){let i={...t};return i.server=e.server,i.index=e.index,i.set=e.set,i.game=e.game,i.code&&!i.winner&&(i.winner=mDe(i.code,e.server)),i.code&&!i.result&&(i.result=dDe[i.code]),i.first_serve?i.serve=2:i.serve||(i.serve=1),i}function mDe(t,e){return pDe.has(t)?e:fDe.has(t)?1-e:e}function gDe(t){let e=[],i=[],r=t.result?.toLowerCase()||"";return r.includes("ace")&&e.push("aces"),(r.includes("winner")||r.includes("ace"))&&e.push("winners"),r.includes("double fault")&&i.push("doubleFaults"),r.includes("unforced error")&&i.push("unforcedErrors"),r.includes("forced error")&&i.push("forcedErrors"),t.winner===t.server?(e.push("servesWon"),t.serve===1?e.push("serves1stWon"):t.serve===2&&e.push("serves2ndWon")):(e.push("returns"),t.serve===1?e.push("received1stWon"):t.serve===2&&e.push("received2ndWon")),e.push("pointsWon"),{winner:e,loser:i}}function pX(t,e){let i={players:{},teams:{}};for(let a=0;a<2;a++)i.players[a]={},i.teams[a]={};let r=t;e?.setFilter!==void 0&&(r=t.filter(a=>a.set===e.setFilter));let n;return r.forEach((a,s)=>{if(a.winner===void 0){console.warn("Point missing winner:",a);return}let{winner:o,loser:l}=gDe(a),u=a.winner,c=1-u;if(o.forEach(d=>{i.teams[u][d]||(i.teams[u][d]=[]),i.teams[u][d].push(a),i.players[u][d]||(i.players[u][d]=[]),i.players[u][d].push(a)}),l.forEach(d=>{i.teams[c][d]||(i.teams[c][d]=[]),i.teams[c][d].push(a),i.players[c][d]||(i.players[c][d]=[]),i.players[c][d].push(a)}),a.server!==void 0){let d=a.server;i.teams[d].pointsServed||(i.teams[d].pointsServed=[]),i.teams[d].pointsServed.push(a),a.serve===1?(i.teams[d].serves1stIn||(i.teams[d].serves1stIn=[]),i.teams[d].serves1stIn.push(a)):a.serve===2&&(i.teams[d].serves2ndIn||(i.teams[d].serves2ndIn=[]),i.teams[d].serves2ndIn.push(a))}if(a.hand){let d=a.hand;i.teams[u][d]||(i.teams[u][d]=[]),i.teams[u][d].push({point:a,index:s})}if(IDe(a,n)&&n?.winner!==void 0){let d=n.winner;i.teams[d].gamesWon||(i.teams[d].gamesWon=[]),i.teams[d].gamesWon.push(n),i.players[d].gamesWon||(i.players[d].gamesWon=[]),i.players[d].gamesWon.push(n)}if(a.breakpoint){let d=a.server;i.teams[d].breakpointsFaced||(i.teams[d].breakpointsFaced=[]),i.teams[d].breakpointsFaced.push(a),u===d&&(i.teams[d].breakpointsSaved||(i.teams[d].breakpointsSaved=[]),i.teams[d].breakpointsSaved.push(a))}n=a}),i}function IDe(t,e){return e&&t.game!==void 0&&e.game!==void 0?t.game!==e.game:!1}function vDe(t){let e={totalPoints:0,byTeam:[0,0],byCategory:{}};for(let r=0;r<2;r++)if(t.teams[r].pointsWon){let n=t.teams[r].pointsWon.length;e.byTeam[r]=n,e.totalPoints+=n}let i=new Set;for(let r=0;r<2;r++)Object.keys(t.teams[r]).forEach(n=>i.add(n));return i.forEach(r=>{e.byCategory[r]=0;for(let n=0;n<2;n++)t.teams[n][r]&&(e.byCategory[r]+=t.teams[n][r].length)}),e}function yDe(t){if(!t?.teams)return[];let e=[];return Object.values({Aces:{category:"Aces",numerators:["aces"],calc:"number"},"Double Faults":{category:"Double Faults",numerators:["doubleFaults"],calc:"number"},Winners:{category:"Winners",numerators:["winners"],calc:"number"},"Unforced Errors":{category:"Unforced Errors",numerators:["unforcedErrors"],calc:"number"},"Forced Errors":{category:"Forced Errors",numerators:["forcedErrors"],calc:"number"},"Total Points Won":{category:"Total Points Won",numerators:["pointsWon"],calc:"number"},"Max Pts/Row":{category:"Max Pts/Row",numerators:["pointsWon"],calc:"maxConsecutive",attribute:"index"},"Max Games/Row":{category:"Max Games/Row",numerators:["gamesWon"],calc:"maxConsecutive",attribute:"game"},"First Serve %":{category:"First Serve %",numerators:["serves1stIn"],denominators:["pointsServed"],calc:"percentage"},"Points Won 1st":{category:"Points Won 1st",numerators:["serves1stWon"],denominators:["serves1stIn"],calc:"percentage"},"Points Won 2nd":{category:"Points Won 2nd",numerators:["serves2ndWon"],denominators:["serves2ndIn"],calc:"percentage"},"Points Won Receiving":{category:"Points Won Receiving",numerators:["received1stWon","received2ndWon"],denominators:["-pointsServed"],calc:"percentage"},"Breakpoints Saved":{category:"Breakpoints Saved",numerators:["breakpointsSaved"],denominators:["breakpointsFaced"],calc:"percentage"},"Breakpoints Converted":{category:"Breakpoints Converted",numerators:["-breakpointsSaved"],denominators:["-breakpointsFaced"],calc:"difference"},"Games Won":{category:"Games Won",numerators:["gamesWon"],calc:"number"},"Service Points Won":{category:"Service Points Won",numerators:["servesWon"],denominators:["pointsServed"],calc:"percentage"},"Aggressive Margin":{category:"Aggressive Margin",numerators:["*doubleFaults","*unforcedErrors"],denominators:["*aces","*winners","-*forcedErrors"],calc:"aggressiveMargin"}}).forEach(i=>{let r=[rz(i,t.teams,0),rz(i,t.teams,1)];(r[0].value!==0||r[1].value!==0)&&e.push({category:i.category,teams:r})}),e}function rz(t,e,i){switch(t.calc){case"number":return bDe(t,e,i);case"percentage":return wDe(t,e,i);case"maxConsecutive":return SDe(t,e,i);case"difference":return UDe(t,e,i);case"aggressiveMargin":return TDe(t,e,i)}}function bDe(t,e,i){let r=jh(t.numerators,e,i);return{value:r,display:String(r),numerators:t.numerators}}function wDe(t,e,i){let r=jh(t.numerators,e,i),n=jh(t.denominators||[],e,i);if(!n)return{value:0,display:"0",numerators:t.numerators};let a=Math.round(r/n*100);return{value:a,display:`${a}% (${r}/${n})`,numerators:t.numerators}}function SDe(t,e,i){let r=t.numerators[0],n=t.attribute||"index";if(!e[i][r])return{value:0,display:"0"};let a=e[i][r],s=0,o=a.length?1:0,l;return a.forEach(u=>{let c=u[n];l!==void 0&&c===l+1?o++:(o>s&&(s=o),o=1),l=c}),o>s&&(s=o),{value:s,display:String(s)}}function UDe(t,e,i){let r=jh(t.numerators,e,i),n=jh(t.denominators||[],e,i);if(!n)return{value:0,display:"0",numerators:t.numerators};let a=Math.abs(n-r),s=Math.round(a/n*100);return{value:s,display:`${s}% (${a}/${n})`,numerators:t.numerators}}function TDe(t,e,i){let r=jh(t.denominators||[],e,i),n=jh(t.numerators,e,i),a=r-n;return{value:a,display:String(a)}}function jh(t,e,i){return t?t.reduce((r,n)=>{let a=n.startsWith("-");n.includes("*");let s=n.replace("-","").replace("*",""),o=a?1-i:i,l=e[o]?.[s];return l?r+l.length:r},0):0}function J0(t,e,i){let r=pX(e||[],i),n=yDe(r),a=vDe(r);return{counters:r,calculated:n,summary:a}}function fX(t){if(!t)return[];let e=[],i=0,r=0,n=0;return t.forEach((a,s)=>{let o=hDe(a,{server:i,index:s,set:r,game:n});e.push(o)}),e}function hX(t,e){let i=pX(t||[],e);return{aces:[i.teams[0].aces?.length||0,i.teams[1].aces?.length||0],doubleFaults:[i.teams[0].doubleFaults?.length||0,i.teams[1].doubleFaults?.length||0],winners:[i.teams[0].winners?.length||0,i.teams[1].winners?.length||0],unforcedErrors:[i.teams[0].unforcedErrors?.length||0,i.teams[1].unforcedErrors?.length||0],totalPoints:[i.teams[0].pointsWon?.length||0,i.teams[1].pointsWon?.length||0]}}function jt(t,e,i){return t.teams[e]?.[i]?.length??0}function Rs(t,e){return!e||!t?0:Number.parseFloat((t/e*100).toFixed(2))}function $T(t,e,i){return t.find(r=>r.category===e)?.teams[i]?.value??0}function Q0(t){if(!t?.counters?.teams)return[];let{counters:e,calculated:i}=t,r=[];r.push({name:"Aces",numerator:[jt(e,0,"aces"),jt(e,1,"aces")],default:"numerator"},{name:"Double Faults",numerator:[jt(e,0,"doubleFaults"),jt(e,1,"doubleFaults")],default:"numerator"});let n=[jt(e,0,"serves1stWon"),jt(e,1,"serves1stWon")],a=[jt(e,0,"servesWon"),jt(e,1,"servesWon")];if(n[0]+n[1]>0&&(a[0]!==n[0]||a[1]!==n[1])){let y=[jt(e,0,"pointsServed"),jt(e,1,"pointsServed")],b=[jt(e,0,"serves1stIn"),jt(e,1,"serves1stIn")],S=[jt(e,0,"serves2ndWon"),jt(e,1,"serves2ndWon")],U=[jt(e,0,"serves2ndIn"),jt(e,1,"serves2ndIn")];r.push({name:"1st Serve In",numerator:b,denominator:y,pct:[Rs(b[0],y[0]),Rs(b[1],y[1])]},{name:"1st Serve Points Won",numerator:n,denominator:b,pct:[Rs(n[0],b[0]),Rs(n[1],b[1])]},{name:"2nd Serve Points Won",numerator:S,denominator:U,pct:[Rs(S[0],U[0]),Rs(S[1],U[1])]})}r.push({name:"Total Points Won",numerator:[jt(e,0,"pointsWon"),jt(e,1,"pointsWon")],default:"numerator"});let s=jt(e,0,"received1stWon")+jt(e,0,"received2ndWon"),o=jt(e,1,"received1stWon")+jt(e,1,"received2ndWon"),l=jt(e,1,"pointsServed"),u=jt(e,0,"pointsServed");r.push({name:"Receiving Points Won",numerator:[s,o],denominator:[l,u],pct:[Rs(s,l),Rs(o,u)]});let c=jt(e,1,"breakpointsFaced")-jt(e,1,"breakpointsSaved"),d=jt(e,0,"breakpointsFaced")-jt(e,0,"breakpointsSaved"),p=jt(e,1,"breakpointsFaced"),f=jt(e,0,"breakpointsFaced");r.push({name:"Break Points Won",numerator:[c,d],denominator:[p,f],pct:[Rs(c,p),Rs(d,f)]});let h=jt(e,0,"breakpointsSaved"),m=jt(e,1,"breakpointsSaved"),g=jt(e,0,"breakpointsFaced"),I=jt(e,1,"breakpointsFaced");r.push({name:"Break Points Saved",numerator:[h,m],denominator:[g,I],pct:[Rs(h,g),Rs(m,I)]},{name:"Winners",numerator:[jt(e,0,"winners"),jt(e,1,"winners")],default:"numerator"},{name:"Unforced Errors",numerator:[jt(e,0,"unforcedErrors"),jt(e,1,"unforcedErrors")],default:"numerator"},{name:"Forced Errors",numerator:[jt(e,0,"forcedErrors"),jt(e,1,"forcedErrors")],default:"numerator"});let v=a,w=[jt(e,0,"pointsServed"),jt(e,1,"pointsServed")];return r.push({name:"Service Points Won",numerator:v,denominator:w,pct:[Rs(v[0],w[0]),Rs(v[1],w[1])]},{name:"Games Won",numerator:[jt(e,0,"gamesWon"),jt(e,1,"gamesWon")]},{name:"Most Consecutive Points Won",numerator:[$T(i,"Max Pts/Row",0),$T(i,"Max Pts/Row",1)]},{name:"Most Consecutive Games Won",numerator:[$T(i,"Max Games/Row",0),$T(i,"Max Games/Row",1)]}),r}var mX=class{constructor(e={}){this.redoStack=[],this.pointMultipliers=[],e.competitionFormat?(this.competitionFormat=e.competitionFormat,this.matchUpFormat=e.matchUpFormat||e.competitionFormat.matchUpFormat||"SET3-S:6/TB7",this.pointMultipliers=e.pointMultipliers||e.competitionFormat.pointMultipliers||[]):(this.matchUpFormat=e.matchUpFormat||"SET3-S:6/TB7",this.pointMultipliers=e.pointMultipliers||[]),this.matchUpId=e.matchUpId,this.isDoubles=e.isDoubles||!1,this.eventHandlers=e.eventHandlers,this.state=ud({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles}),this.cacheFormatStructure()}setState(e){this.state=e,this.matchUpFormat=e.matchUpFormat,this.matchUpId=e.matchUpId,this.isDoubles=e.matchUpType==="DOUBLES",this.redoStack=[],this.initialScore=void 0,this.cacheFormatStructure()}getState(){return this.state}addPoint(e){let i=this.state.history?.points.length||0,r=this.state.score.sets.reduce((o,l)=>o+(l.side1Score||0)+(l.side2Score||0),0),n=this.state.score.sets.filter(o=>o.winningSide!==void 0).length,a=this.state.matchUpStatus==="COMPLETED",s=this.hasLineUp()?this.getActivePlayers():void 0;if(this.state=Sp(this.state,e,{pointMultipliers:this.pointMultipliers}),s){let o=this.state.history.points[this.state.history.points.length-1];this.isDoubles?o.activePlayers=[s.side1,s.side2]:o.activePlayers=[s.side1[0]||"",s.side2[0]||""]}if(e.penaltyType){let o=this.state.history.points[this.state.history.points.length-1];o.penaltyType=e.penaltyType}if(this.ensureHistory(),this.state.history.entries.push({type:"point",data:{winner:e.winner,winningSide:e.winningSide,server:e.server,serverSideNumber:e.serverSideNumber,serverParticipantId:e.serverParticipantId,timestamp:e.timestamp,rallyLength:e.rallyLength,result:e.result,penaltyType:e.penaltyType},timestamp:e.timestamp||new Date().toISOString(),pointIndex:i}),this.redoStack=[],this.eventHandlers){let o=this.buildEventContext();if(this.eventHandlers.onPoint?.(o),this.state.score.sets.reduce((l,u)=>l+(u.side1Score||0)+(u.side2Score||0),0)>r&&this.eventHandlers.onGameComplete?.({...o,gameWinner:e.winner}),this.state.score.sets.filter(l=>l.winningSide!==void 0).length>n){let l=this.state.score.sets.findLast(u=>u.winningSide!==void 0)?.winningSide===1?0:1;this.eventHandlers.onSetComplete?.({...o,setWinner:l})}if(!a&&this.state.matchUpStatus==="COMPLETED"){let l=this.state.winningSide===1?0:1;this.eventHandlers.onMatchComplete?.({...o,matchWinner:l})}}}addSet(e){this.applyAddSet(e),this.ensureHistory();let i=this.state.score.sets.at(-1)?.winningSide;this.state.history.entries.push({type:"set",data:{...e,winningSide:i},timestamp:e.timestamp||new Date().toISOString()}),this.redoStack=[]}addGame(e){this.applyAddGame(e),this.ensureHistory(),this.state.history.entries.push({type:"game",data:e,timestamp:e.timestamp||new Date().toISOString()}),this.redoStack=[]}endSegment(e){this.applyEndSegment(e),this.ensureHistory();let i=(e?.setNumber??this.state.score.sets.length)-1;this.state.history.entries.push({type:"endSegment",data:{setNumber:i+1,...e},timestamp:e?.timestamp||new Date().toISOString()})}setInitialScore(e){this.initialScore=e,this.redoStack=[],this.applyInitialScore(this.state,e),this.ensureHistory(),this.state.history.entries.push({type:"setInitialScore",data:e,timestamp:new Date().toISOString()}),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS")}undo(e=1){let i=this.state.history?.entries;if(i&&i.length>0){let a=Math.min(e,i.length);for(let s=0;s<a;s++){let o=i.pop();this.redoStack.push(o),o.type==="point"&&this.state.history.points.pop()}return this.rebuildFromEntries(),this.eventHandlers?.onUndo?.(this.buildEventContext()),!0}let r=this.state.history?.points||[];if(r.length===0)return!1;let n=Math.min(e,r.length);for(let a=0;a<n;a++){let s=r.pop();this.redoStack.push({type:"point",data:{winner:s.winner,server:s.server,timestamp:s.timestamp,rallyLength:s.rallyLength},timestamp:s.timestamp||""})}return this.rebuildState(),this.eventHandlers?.onUndo?.(this.buildEventContext()),!0}redo(e=1){if(this.redoStack.length===0)return!1;let i=Math.min(e,this.redoStack.length);for(let r=0;r<i;r++){let n=this.redoStack.pop();this.ensureHistory(),this.state.history.entries.push(n),n.type}return this.rebuildFromEntries(),this.eventHandlers?.onRedo?.(this.buildEventContext()),!0}canUndo(){let e=this.state.history?.entries;return e&&e.length>0?!0:(this.state.history?.points.length||0)>0}canRedo(){return this.redoStack.length>0}getUndoDepth(){let e=this.state.history?.entries;return e&&e.length>0?e.length:this.state.history?.points.length||0}getRedoDepth(){return this.redoStack.length}getScore(){return Dd(this.state)}getScoreboard(e){return q0(this.state,e)}getWinner(){return Y0(this.state)}isComplete(){return K0(this.state)}getPointCount(){return this.state.history?.points.length||0}getFormat(){return this.state.matchUpFormat}getStatistics(e){let i=this.state.history?.points||[];return J0(this.state,i,e)}getStatObjects(e){return Q0(this.getStatistics(e))}getNextServer(){if(this.competitionFormat?.serverRule==="WINNER_SERVES"){let r=this.state.history?.points.at(-1);return r?r.winner:0}if(!this.cachedFormatStructure)return 0;let e=[0,0];this.state.score.sets.forEach(r=>{r.winningSide===1&&e[0]++,r.winningSide===2&&e[1]++});let i=DC(this.cachedFormatStructure,e);return z0(this.state,this.cachedFormatStructure,i)}getEpisodes(){return X0(this.state)}isNoAd(){return!!(this.cachedFormatStructure?.setFormat?.NoAD||this.cachedFormatStructure?.setFormat?.gameFormat?.NoAD)}getSetsToWin(){if(!this.cachedFormatStructure)return 2;let e=this.cachedFormatStructure.exactly||this.cachedFormatStructure.bestOf||3;return Math.ceil(e/2)}getTiebreakAt(){let e=this.cachedFormatStructure?.setFormat;if(!e||e.tiebreakSet||e.timed||e.noTiebreak)return null;let i=e.setTo||6;return(typeof e.tiebreakAt=="number"?e.tiebreakAt:void 0)??i}hasFinalSetTiebreak(){let e=this.cachedFormatStructure?.finalSetFormat;return e?e.tiebreakSet?!0:e.noTiebreak?!1:!!(e.tiebreakFormat||e.tiebreakAt!==void 0):this.getTiebreakAt()!==null}getFormatStructure(){return this.cachedFormatStructure}getInputMode(){let e=this.state.history?.entries||[];if(e.length===0)return(this.state.history?.points.length||0)>0?"points":"none";let i=new Set(e.filter(r=>r.type!=="setInitialScore"&&r.type!=="endSegment").map(r=>r.type));if(i.size===0)return"none";if(i.size===1){let r=i.values().next().value;if(r==="point")return"points";if(r==="game")return"games";if(r==="set")return"sets"}return"mixed"}setLineUp(e,i){let r=this.state.sides.find(n=>n.sideNumber===e);r&&(r.lineUp=i),this.initialLineUps??={},this.initialLineUps[e]=i.map(n=>({...n}))}substitute(e){let i=this.state.sides.find(a=>a.sideNumber===e.sideNumber);if(!i?.lineUp)return;let r=i.lineUp.findIndex(a=>a.participantId===e.outParticipantId);if(r===-1)return;this.ensureHistory(),this.state.history.substitutions??=[];let n={sideNumber:e.sideNumber,outParticipantId:e.outParticipantId,inParticipantId:e.inParticipantId,beforePointIndex:this.state.history.points.length,timestamp:e.timestamp};this.state.history.substitutions.push(n),i.lineUp[r]={...i.lineUp[r],participantId:e.inParticipantId},this.state.history.entries.push({type:"substitution",data:n,timestamp:e.timestamp||new Date().toISOString()}),this.redoStack=[]}getActivePlayers(){let e=this.state.sides.find(r=>r.sideNumber===1),i=this.state.sides.find(r=>r.sideNumber===2);return{side1:e?.lineUp?.map(r=>r.participantId)||[],side2:i?.lineUp?.map(r=>r.participantId)||[]}}hasLineUp(){return this.state.sides.some(e=>e.lineUp&&e.lineUp.length>0)}setPointMultipliers(e){this.pointMultipliers=e}getPointMultipliers(){return this.pointMultipliers}getSupplementaryState(){return{redoStack:[...this.redoStack],initialLineUps:this.initialLineUps?Object.fromEntries(Object.entries(this.initialLineUps).map(([e,i])=>[e,i.map(r=>({...r}))])):void 0}}loadSupplementaryState(e){e.redoStack&&(this.redoStack=[...e.redoStack]),e.initialLineUps&&(this.initialLineUps=Object.fromEntries(Object.entries(e.initialLineUps).map(([i,r])=>[i,r.map(n=>({...n}))])))}getPenaltyProfile(){return this.competitionFormat?.penaltyProfile}getPointProfile(){return this.competitionFormat?.pointProfile}getTimerProfile(){return this.competitionFormat?.timerProfile}getTimeoutRules(){return this.competitionFormat?.timeoutRules}getSubstitutionRules(){return this.competitionFormat?.substitutionRules}getPlayerRules(){return this.competitionFormat?.playerRules}setEventHandlers(e){this.eventHandlers=e}getEventHandlers(){return this.eventHandlers}decoratePoint(e,i){let r=this.state.history?.points[e];r&&Object.assign(r,i)}markHardBoundary(e){let i=this.state.score.sets[e.setIndex];i&&(i.hardBoundaries??=[],i.hardBoundaries.includes(e.gameIndex)||(i.hardBoundaries.push(e.gameIndex),i.hardBoundaries.sort((r,n)=>r-n)))}editPoint(e,i,r){let n=this.state.history?.points;if(!n||e<0||e>=n.length)return;let a=r?.recalculate!==!1,s=n[e];if(i.winner!==void 0&&(s.winner=i.winner),i.server!==void 0&&(s.server=i.server),i.timestamp!==void 0&&(s.timestamp=i.timestamp),i.rallyLength!==void 0&&(s.rallyLength=i.rallyLength),i.wrongSide!==void 0&&(s.wrongSide=i.wrongSide),i.wrongServer!==void 0&&(s.wrongServer=i.wrongServer),i.penaltyPoint!==void 0&&(s.penaltyPoint=i.penaltyPoint),!a)return;let o=this.state.history?.entries;if(o){let l=o.find(u=>u.type==="point"&&u.pointIndex===e);l&&(i.winner!==void 0&&(l.data.winner=i.winner),i.server!==void 0&&(l.data.server=i.server))}o&&o.length>0?this.rebuildFromEntries():this.rebuildState(),this.redoStack=[]}reset(){this.state=ud({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles}),this.redoStack=[],this.initialScore=void 0,this.initialLineUps=void 0,this.eventHandlers?.onReset?.(this.buildEventContext())}ensureHistory(){this.state.history??={points:[]},this.state.history.entries??=[]}buildEventContext(){return{state:this.state,score:Dd(this.state)}}cacheFormatStructure(){this.cachedFormatStructure=Ki(this.matchUpFormat)}getInitialLineUps(){return this.initialLineUps}applyAddSet(e){let{side1Score:i,side2Score:r,side1TiebreakScore:n,side2TiebreakScore:a}=e,s=e.winningSide;s===void 0&&(i>r?s=1:r>i&&(s=2));let o={setNumber:this.state.score.sets.length+1,side1Score:i,side2Score:r,winningSide:s};n!==void 0&&(o.side1TiebreakScore=n),a!==void 0&&(o.side2TiebreakScore=a),this.state.score.sets.push(o),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS"),s!==void 0&&this.checkMatchCompletion()}applyAddGame(e){let{winner:i,tiebreakScore:r}=e,n=this.state.score.sets.length>0?this.state.score.sets.at(-1):void 0;(!n||n.winningSide!==void 0)&&(n={setNumber:this.state.score.sets.length+1,side1Score:0,side2Score:0},this.state.score.sets.push(n)),i===0?n.side1Score=(n.side1Score||0)+1:n.side2Score=(n.side2Score||0)+1,r&&(n.side1TiebreakScore=r[0],n.side2TiebreakScore=r[1]),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS"),this.checkSetCompletion(n),n.winningSide!==void 0&&this.checkMatchCompletion()}applySubstitution(e){let i=this.state.sides.find(n=>n.sideNumber===e.sideNumber);if(!i?.lineUp)return;let r=i.lineUp.findIndex(n=>n.participantId===e.outParticipantId);r!==-1&&(i.lineUp[r]={...i.lineUp[r],participantId:e.inParticipantId},this.state.history??={points:[]},this.state.history.substitutions??=[],this.state.history.substitutions.push(e))}applyEndSegment(e){let i=(e?.setNumber??this.state.score.sets.length)-1,r=this.state.score.sets[i];if(!r||r.winningSide!==void 0)return;let n=r.side1Score||0,a=r.side2Score||0;n>a?r.winningSide=1:a>n&&(r.winningSide=2),this.checkMatchCompletion()}checkSetCompletion(e){let i=Ki(this.state.matchUpFormat);if(!i)return;let r=i.exactly||i.bestOf||3,n=Math.ceil(r/2),a=[0,0];this.state.score.sets.forEach(u=>{u.winningSide===1&&a[0]++,u.winningSide===2&&a[1]++});let s=a[0]===n-1&&a[1]===n-1&&i.finalSetFormat?i.finalSetFormat:i.setFormat;if(!s)return;let o=e.side1Score||0,l=e.side2Score||0;if(s.tiebreakSet){let u=s.tiebreakSet.tiebreakTo||11,c=s.tiebreakSet.NoAD?1:2;(o>=u||l>=u)&&Math.abs(o-l)>=c&&(e.winningSide=o>l?1:2)}else if(!s.timed){let u=s.setTo||6,c=(typeof s.tiebreakAt=="number"?s.tiebreakAt:void 0)??u,d=s.noTiebreak||!1,p=s.winBy||2;(!d&&e.side1TiebreakScore!==void 0&&(o===c+1||l===c+1)||(o>=u||l>=u)&&Math.abs(o-l)>=p)&&(e.winningSide=o>l?1:2)}}checkMatchCompletion(){let e=Ki(this.state.matchUpFormat);if(!e)return;let i=e.exactly||e.bestOf||3,r=Math.ceil(i/2),n=V0(e),a=e.exactly;if(n){let s=a||i;if(this.state.score.sets.filter(o=>o.winningSide!==void 0).length>=s){let o=this.state.score.sets.reduce((l,u)=>(u.side1TiebreakScore===void 0?(l[0]+=u.side1Score??0,l[1]+=u.side2Score??0):(l[0]+=u.side1TiebreakScore,l[1]+=u.side2TiebreakScore??0),l),[0,0]);o[0]!==o[1]&&(this.state.matchUpStatus="COMPLETED",this.state.winningSide=o[0]>o[1]?1:2,this.state.endTime=new Date().toISOString())}}else{let s=[0,0];if(this.state.score.sets.forEach(o=>{o.winningSide===1&&s[0]++,o.winningSide===2&&s[1]++}),(s[0]>=r||s[1]>=r)&&(!a||this.state.score.sets.filter(o=>o.winningSide!==void 0).length>=a)){let o=s[0]>=r?0:1;this.state.matchUpStatus="COMPLETED",this.state.winningSide=o+1,this.state.endTime=new Date().toISOString()}}}rebuildFromEntries(){let e=this.state.history?.entries||[],i=this.getInitialLineUps(),r=ud({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles});if(i)for(let n of r.sides)i[n.sideNumber]&&(n.lineUp=i[n.sideNumber].map(a=>({...a})));this.initialScore&&(this.applyInitialScore(r,this.initialScore),r.matchUpStatus==="TO_BE_PLAYED"&&(r.matchUpStatus="IN_PROGRESS")),r.history={points:[],entries:[...e]},this.state=r;for(let n of e)switch(n.type){case"point":this.state=Sp(this.state,n.data,{pointMultipliers:this.pointMultipliers}),this.state.history.entries=r.history.entries;break;case"set":this.applyAddSet(n.data);break;case"game":this.applyAddGame(n.data);break;case"endSegment":this.applyEndSegment(n.data);break;case"substitution":this.applySubstitution(n.data);break}}rebuildState(){let e=this.state.history?.points||[],i=ud({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles});this.initialScore&&(this.applyInitialScore(i,this.initialScore),i.matchUpStatus==="TO_BE_PLAYED"&&(i.matchUpStatus="IN_PROGRESS"));for(let r of e)i=Sp(i,{winner:r.winner,server:r.server,timestamp:r.timestamp,rallyLength:r.rallyLength,result:r.result},{pointMultipliers:this.pointMultipliers});this.state=i}applyInitialScore(e,i){e.score.sets=[];for(let r=0;r<i.sets.length;r++){let n=i.sets[r],a={setNumber:r+1,side1Score:n.side1Score,side2Score:n.side2Score};n.side1TiebreakScore!==void 0&&(a.side1TiebreakScore=n.side1TiebreakScore),n.side2TiebreakScore!==void 0&&(a.side2TiebreakScore=n.side2TiebreakScore),n.winningSide!==void 0?a.winningSide=n.winningSide:n.side1Score>n.side2Score?a.winningSide=1:n.side2Score>n.side1Score&&(a.winningSide=2),e.score.sets.push(a)}if(i.currentSetScore){let r={setNumber:e.score.sets.length+1,side1Score:i.currentSetScore.side1Score,side2Score:i.currentSetScore.side2Score,side1GameScores:[],side2GameScores:[]};i.currentGameScore?(r.side1GameScores=[i.currentGameScore.side1Points],r.side2GameScores=[i.currentGameScore.side2Points]):(r.side1GameScores=[0],r.side2GameScores=[0]),e.score.sets.push(r)}}},gX={};pt(gX,{addPoint:()=>Sp,calculatePointsTo:()=>PC,createMatchUp:()=>ud,inferServeSide:()=>j0,resolvePointValue:()=>G0});var IX={};pt(IX,{keyValueScore:()=>_X,parseMatchUpFormat:()=>Ki,stringifyMatchUpFormat:()=>DR,tidyScore:()=>jX});var DDe="COMPLETED",PDe="WO/WO",vX=["RET","DEF","WO",PDe,"ABN","SUS","INT"],ox="DEFAULTED",yX="WALKOVER",bX="ABANDONED",wX="SUSPENDED",SX="RETIRED",UX="INTERRUPTED",EDe=[SX,ox,yX],RDe="Enter Score",Gh="()",Vp="[]",Z0=["up","left","shift+tab"],e_=["enter","down","tab","right"],PP="backspace",TX="r",DX="s",PX="a",EX="d",RX="w",CX="i",RC=[TX,EX,RX,PX,DX,CX],CC="space",uk=["[","("],EP=[...Z0,...e_,CC,"]"],MX="-",CDe="/",hh=MX,tu=MX,NX=[CDe],MDe=0,NDe=["=","+","num_1","num_2","shift+=","shift+-"],t_=["0","1","2","3","4","5","6","7","8","9"].concat(RC),AX=t_.map(t=>`shift+${t}`),kX=[hh,PP].concat(EP,NX),OX=[t_,AX,kX].join(","),ADe=[OX,Z0,e_,NDe].join(","),kDe={OUTCOMEKEYS:RC,SIDE1KEYS:t_,SIDE2KEYS:AX,MODIFIERS:kX,PROMPT:RDe,MOVEUP:Z0,MOVEDOWN:e_,HOTKEYS:ADe};function hg({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=xX({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==" "?" ":"";return t+r+i}else return i+" "+t}function xX({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of vX){let r=t?.indexOf(i);r===0?t=t.slice(i.length+1).trim()+" ":r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t?.trim()||(t=""),{scoreString:t,removed:e}}function lx({analysis:t,scoreString:e,sets:i,lowSide:r}){let n,a;if(!e)return{scoreString:e,sets:i};let{scoreString:s,removed:o}=xX({scoreString:e});if(e=s,o)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},u=Object.values(l).filter(m=>m!==void 0).length;l.setNumber&&u===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:c}=t.setFormat,{tiebreakTo:d,NoAD:p}=c||{},{isTiebreakEntry:f}=Kg({brackets:Vp,scoreString:e}),h=xDe(e);if(h>=0){n=e.slice(0,h);let{isTiebreakEntry:m}=Kg({brackets:Gh,scoreString:n}),{lastOpenBracketIndex:g,isTiebreakEntry:I}=Kg({brackets:Vp,scoreString:n}),v=n&&n[n.length-1].trim(),w=n&&!isNaN(v),y=t.isIncompleteSetScore;if(f&&I){let b=n.slice(g+1).split(tu),S=b?.length>0&&b[0]!==void 0&&!isNaN(parseInt(b[0]))&&parseInt(b[0])||void 0,U=b?.length>1&&b[1]!==void 0&&parseInt(b[1])||void 0,T=[S,U];if(U){let D=r===1?1:0;T[D]=(T?.[1-D]||0)+(p?1:2),(T[D]||0)<d&&(T[D]=d),n=e.slice(0,g+1),n+=T.join(tu)}else S!==void 0?(n=e.slice(0,g+1),n+=S):(n=e.slice(0,g),y=!0);l.side1TiebreakScore=T[0]||0,l.side2TiebreakScore=T[1]||0}if(n.length||(n=void 0),y){let b=l.side1Score?.toString();if(b){let S=b?.slice(0,b.length-1);l.side1Score=!isNaN(S)&&parseInt(S)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:i?.slice(0,i.length-1)||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]}else if(w){let b=l.side2Score?.toString(),S=l.side1Score?.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let U=b?.slice(0,b.length-1);l.side2Score=!isNaN(U)&&parseInt(U)||void 0}else{let U=S?.slice(0,S.length-1);l.side1Score=!isNaN(U)&&parseInt(U)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else m?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(f&&!I?a=i?.slice(0,i.length-1)||[]:(a=i,a[i.length-1]=l),f||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:e,sets:i}}function Kg({brackets:t=Gh,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...tl(i,n)),s=Math.max(...tl(r,n));return{isTiebreakEntry:a>s,lastOpenBracketIndex:a}}function ODe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=Vp.split(""),a=t.split(""),s=Math.max(...tl(r,a)),o=Math.max(...tl(n,a)),l=Math.max(...tl(tu,a));return i&&s>o&&l>s}function xDe(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function FX(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function nz({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){let n=Ki(t),{bestOf:a}=n,s=Math.ceil(a/2),o=r?.reduce((l,u)=>{let{winningSide:c}=u;return c&&l[c-1]++,l},[0,0])?.indexOf(s)+1||void 0;return EDe.includes(e)&&i&&(o=i),{matchUpWinningSide:o}}function MC({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:s}){if(!s)return{error:Xe,info:"missing set"};e=e||i&&Ki(i);let o=n&&e.finalSetFormat||e?.setFormat||{},{side1Score:l,side2Score:u}=s,{setTo:c,tiebreakAt:d}=o,p=l||u,f=NC({set:s}),h=Math.abs(l-u),m=l>=c||u>=c,g=r||l>=c&&u>=c||d&&d<c&&(l===d||u===d),I=t||g&&(f===1&&s.side1TiebreakScore>s.side2TiebreakScore||f===2&&s.side2TiebreakScore>s.side1TiebreakScore),v=!g&&o.NoAD||g||r&&o.tiebreakFormat?.NoAD?1:2,w=h>=v;return!!((a&&p||m&&(w||g)||r)&&(!g||I))}function NC({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function i_({analysis:t,set:e}){let i=NC({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return MC({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function FDe({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!i?.length)return{sets:[]};let a=i[i.length-1];r=Ye(r);let{validSide2Score:s,requiresTiebreak:o}=LDe({analysis:t,set:a,value:r});if(s){n=!0,e=(e||"")+r,a.side2Score=r;let l=i_({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,o){let u=Gh.split("")[0];e+=u}else t.isDecidingSet||(e+=" ")}return{sets:i,scoreString:e,updated:n}}function LDe({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:s}=r,{side1Score:o}=e,l,u;return n&&n<a?o===n?l=i<=a:l=i<=n:o===a?s?l=i<a:l=i<=a+1:o===a-1?s?l=i<=a:l=i<=a+1:o===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?u=o===a&&i===n||o===n&&i===a:u=o>=a&&i>=a&&o!==i),{validSide2Score:l,requiresTiebreak:u}}function LX({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let s;return e===TX?r?(s=!0,r=hg({scoreString:r,lowSide:t,outcome:"RET"}),n=t===2?1:2,a=SX):(s=!0,r=hg({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=ox):e===EX?(s=!0,r=hg({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=ox):e===RX?(s=!0,i=[],r="WO",n=t===2?1:2,a=yX):e===DX&&r?(s=!0,r=hg({scoreString:r,lowSide:t,outcome:"SUS"}),a=wX,n=void 0):e===PX?(s=!0,r=hg({scoreString:r,lowSide:t,outcome:"ABN"}),a=bX,n=void 0):e===CX&&r&&(s=!0,r=hg({scoreString:r,lowSide:t,outcome:"INT"}),a=UX,n=void 0),{updated:s,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function _De(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:s,lowSide:o,value:l}=t,u,c;!e?.length&&l!==PP&&(e=[{setNumber:1}]);let d=e.length-1;if(RC.includes(l)){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p;f&&!h?i="missing side2Score":s.finalSetIsComplete||n?i="final set is already complete":s.isIncompleteSetScore?i="incomplete set scoreString":s.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:u}=LX({lowSide:o,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===PP){if({scoreString:r,sets:e,outcomeRemoved:c}=lx({analysis:s,scoreString:r,sets:e}),r?.trim()===""&&(r=r.trim()),r||(e=[]),c){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p;if(f&&h){let m=f>h&&1||h>f&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,u=!0}else if(s.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===CC){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p,m=f>h&&1||h>f&&2||void 0;m&&!n&&!s.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),r+=" ",u=!0)}else if(l===hh&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&s.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let f=Ye((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=Ye(f),p=e[d].side1Score.toString(),u=!0}else{let f=Ye((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=Ye(f),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let f=(e.slice(0,d)||[]).filter(h=>h).map(h=>{let{side1Score:m,side2Score:g}=h;return[m,g].join("-")}).join(" ");f?r=f+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:u}}function $De({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){let s,o,{tiebreakSet:{tiebreakTo:l,NoAD:u}}=t.setFormat,[c]=Vp.split("");if(t.isMatchTiebreakEntry||(r+=c),n[t.setNumber-1]){let{lastOpenBracketIndex:d}=Kg({brackets:Vp,scoreString:r}),p=(r.slice((d??0)+1)+(e?"":a)).split(tu);if((p[i-1]?.length||0)>=2)o="tiebreak digit limit";else if(e){i===1&&(p[0]=(p[0]||"")+a),i===2&&(p[1]=(p[1]||"")+a);let f=[p[0]||0,p[1]||0].map(g=>Ye(g)),h=i===1?1:0;f[h]=f[1-h]+(u?1:2),f[h]<l&&(f[h]=l);let m=n[n.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],r=r.slice(0,(d??0)+1),r+=f.join(tu),s=!0}else{let f=[p[0]||0,p[1]||0].map(m=>Ye(m)),h=n[n.length-1];h.side1TiebreakScore=f[0],h.side2TiebreakScore=f[1],r+=a,s=!0}}else{let d=FX({lowValue:Ye(a||0),tiebreakTo:l,NoAD:u}),p=[Ye(a),d];i===2&&p.reverse();let f={side1TiebreakScore:p[0],side2TiebreakScore:p[1],setNumber:n?.length+1||1};n.push(f),r+=p.join(tu),s=!0}return{info:o,scoreString:r,sets:n,updated:s}}function BDe({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:s}=t?.setFormat||{},o=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(s&&r===n||r>n)return{scoreString:i};let l=h(),u=[r,l];e===2&&u.reverse();let c=Gh.split("")[0],d=u.join(hh)+(o?c:" ");i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},f=i_({analysis:t,set:p});return p.winningSide=f||void 0,{scoreString:i,set:p};function h(){return o?r+1:r+1===n?r+(s?1:2):n}}function VDe({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){let a=(n?.filter(F=>F?.winningSide)?.length||0)+(i?0:1),s=Ki(t),o=a===s?.bestOf,l=o&&s?.finalSetFormat||s?.setFormat||{},u=l?.timed,c=o&&n[s?.bestOf-1],d=c?.winningSide,{isTiebreakEntry:p}=Kg({brackets:Gh,scoreString:e}),{isTiebreakEntry:f}=Kg({brackets:Vp,scoreString:e}),h=p||f,m=!!l.tiebreakSet,g=e?.[e.length-1]?.trim(),I=e&&!isNaN(g),v=!h&&g===hh,w=p&&uk.includes(g),y=f&&uk.includes(g),b=f&&g===tu,S=e?.split(""),[U]=Vp.split(""),T=S&&Math.max(...tl(U,S)),D=S&&Math.max(...tl(tu,S)),P=S&&D>T,E=n[n.length-1]?.winningSide,R=n?.length&&!E,C=vX.find(F=>e?.indexOf(F)>=0),M=!isNaN(r),N=r===CC,A=EP.includes(r),O=e?.split("").find(F=>uk.includes(F)),k=A&&f&&!y&&(b||!ODe({scoreString:e}));return{isTiebreakSetValue:m&&M,matchUpScoringFormat:s,setNumber:a,setFormat:l,matchTiebreakHasJoiner:P,isGameScoreEntry:R,isSpace:N,isCloser:A,isTiebreakCloser:A&&O&&h&&I,isDecidingSet:o,isTiebreakSet:m,isTimedSet:u,isNumericEnding:I,isNumericValue:M,hasOpener:O,hasOutcome:C,finalSet:c,finalSetIsComplete:d,lastSetIsComplete:E,isInvalidSetTiebreakValue:N&&h&&w,isInvalidMatchTiebreakValue:k,isTiebreakEntry:h,isSetTiebreakEntry:p,isMatchTiebreakEntry:f,isIncompleteSetScore:v,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:y,isPartialMatchTiebreakValue:b}}function _X(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:s}=t,{matchUpFormat:o,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!OX.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:f}=nz({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});a=f;let h=VDe({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:o});if(NX.includes(i)&&(i=hh),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&p&&Ye(i)===0&&(h.isTiebreakCloser=!0),EP.includes(i)&&h.hasOpener&&(i=""),EP.includes(i)&&(i=CC),h.lastSetIsComplete){let m=r?.length&&r[r.length-1];r&&m!==" "&&(r+=" ")}if(h.isTimedSet)({info:d,sets:n,scoreString:r,updated:c,matchUpStatus:s,winningSide:a}=_De({analysis:h,lowSide:e,scoreString:r,sets:n,matchUpStatus:s,winningSide:a,value:i}));else if(RC.includes(i))h.finalSetIsComplete||a?d="final set is already complete":!h.isTiebreakEntry&&!h.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:s,winningSide:a,updated:c}=LX({lowSide:e,sets:n,scoreString:r,matchUpStatus:s,winningSide:a,value:i}):h.isTiebreakEntry||h.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===PP)c=!0,{scoreString:r,sets:n}=lx({analysis:h,scoreString:r,sets:n,lowSide:e}),r||(n=[]),s=void 0,a=void 0;else if(h.hasOutcome)d="has outcome";else if(i===hh&&!h.isMatchTiebreakEntry)(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(c=!0,{scoreString:r,sets:n}=lx({analysis:h,scoreString:r,sets:n,lowSide:e}),s=void 0);else if(i===tu&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?d="existing joiner":h.isNumericEnding&&(c=!0,r+=tu);else if([hh,tu].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:n,scoreString:r,updated:c}=FDe({analysis:h,scoreString:r,sets:n,value:i}));else if(h.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(h.isTiebreakCloser){let m=h.isSetTiebreakEntry?Gh:Vp,g=m.split("").reverse()[0],I=m.split("")[0],v=n[n.length-1],{tiebreakFormat:w}=h.setFormat,{tiebreakTo:y,NoAD:b}=w||{},S=NC({set:v});if(!h.isTiebreakSet){let T=Number.parseInt(r.split(I).reverse()[0]),D=FX({lowValue:T,tiebreakTo:y,NoAD:b});S===1?(v.side1TiebreakScore=D,v.side2TiebreakScore=T):(v.side1TiebreakScore=T,v.side2TiebreakScore=D)}r=(r||"")+g,h.isDecidingSet||(r+=" ");let U=i_({analysis:h,set:v});v.winningSide=U||void 0,c=!0}else if(h.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:c}=$De({analysis:h,auto:u,lowSide:e,scoreString:r,sets:n,value:i}));else if(h.isSetTiebreakEntry){let[m]=Gh.split(""),g=Math.max(...tl(m,r.split(""))),I=r.slice(g+1),v=I&&Ye(I)===MDe,w=Ye(I?I+i:i),{tiebreakFormat:y}=h.setFormat,{tiebreakTo:b,NoAD:S}=y||{};!v&&I.length<2?S&&w>b-1?d="invalid low value for NoAD tiebreak":(c=!0,r=(r||"")+i):d=v?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)d=`invalid key: ${i}`;else if(h.isGameScoreEntry)d="game scoreString entry";else if(h.lastSetIsComplete||!n.length){c=!0;let{scoreString:m,set:g}=BDe({analysis:h,lowSide:e,scoreString:r,value:Ye(i)});g&&(g.setNumber=n?.length+1||1),n=n?.concat(g).filter(Boolean)||[g],r=m||void 0}else console.log("error: unknown outcome")}if(c){n=n?.filter(Boolean);let{matchUpWinningSide:m}=nz({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});return a=m,m&&(!s||[Li,hs].includes(s))?(s=DDe,n=n.filter(g=>{let{side1Score:I,side2Score:v,side1TiebreakScore:w,side2TiebreakScore:y}=g;return I||v||w||y})):r&&!a&&![wX,bX,UX].includes(s)&&(s=void 0),{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}return{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}var AC="\\d+-\\d+",zb="\\d+-\\d+\\(\\d+\\)",r_="\\[\\d+-\\d+\\]",jDe="\\d+-\\d+\\(\\d+-\\d+\\)",GDe=new RegExp(`(${AC}),`,"g"),HDe=new RegExp(`(${zb}),`,"g"),WDe=[AC,zb,r_,jDe],zDe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],qDe=zDe.map(t=>{let e=t.split("").map(i=>WDe[i]).join(" ");return new RegExp(`^${e}$`)});function az(t){return!t||qDe.some(e=>e.test(t))}function YDe(t){let e="[];()",i=["[","("],r=Object.assign({},...e.split("").map(s=>({[s]:0}))),n="",a=t.split("").map(s=>{let o=e.includes(s)&&s,l=i.includes(o);if(l&&o)return r[o]+=1,n=o,s;if(!l&&o&&n&&o!==n){r[n]-=1;let u="[];".includes(n)&&"[];"||"()".includes(n)&&"()"||"",c=u.split("").find(d=>d!==n);if(u.includes(o))r[n]||(n="");else return r[o]||(n=""),c}return s}).join("");return t!==a?a:t}function UD(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function KDe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function yI(t){let e=(i=>i?.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function RP(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function sz(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function XDe(t){return t.startsWith("(")&&t.endsWith(")")}function JDe({score:t,applied:e}){t=YDe(t);let i=/\)(\d+)/g;if(i.test(t))for(let S of t.match(i)){let U=S.replace(")",") ");t=t.replace(S,U)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let S of a||[]){let[U]=S.match(n).slice(1),T=U.replace(/ /g,"");t=t.replace(S,`(${T})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){let S=t.match(s);S.length&&S.forEach(U=>{let T=U.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(U,T)})}if(s=/\(\((\d)\)\)/g,s.test(t)){let S=t.match(s);S.length&&S.forEach(U=>{let T=U.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(U,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);t=t.replace(o,"-"),["- "," -"].forEach(S=>{let U=new RegExp(`(\\d+)${S}(\\d+)`,"g"),T=t.match(U);T&&T.forEach(D=>t=t.replace(D,D.split(S).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(S=>{let[U]=S.match(/\((\d+), \)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&U==="6"&&(t=t.replace(S,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(S=>{let[U]=S.match(/\((\d+)\/\)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&U==="6"?t=t.replace(S,"(6-0)"):t=t.replace(S,`(${U})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(S=>{let[U]=S.match(/(\d\/\d)\/,/).slice(1);t=t.replace(S,`${U},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(S=>{let[U]=S.match(/\(\/(\d+)\)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&parseInt(U)<6?t=t.replace(S,`(6-${U})`):t=t.replace(S,`(${U})`)});let p,f,h,m,g,I=()=>{g=Ta(t.split("")),f=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],h=g["["]===g["]"]+1,m=f&&!h};I();let v=/(\d+-\d+\(\d+)0,/;if(v.test(t)){let[S]=t.match(v).slice(1);t=t.replace(v,S+")")}if(g["("]===g[")"]&&g["("]>1){let S=t.split(")(").join(") (").split(" ");S.every(XDe)?t=S.map(U=>{let T=U.slice(1,U.length-1);return T.length>2?T:U}).join(" "):t=S.join(" ")}I();let w=/[A-Za-z]+/.test(t),y=/\d+/.test(t);if(!w&&!y)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(S=>g[S])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(S=>g[S]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",I()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",I()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let S=[],U=0;for(let T of t.split("").reverse())T===")"&&(U?S.push("("):U+=1),T==="("&&(U-=1),S.push(T);S.reverse(),t=S.join("")}I()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),I()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",I()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",I()),m){let S="",U=0;for(let T of t.split(""))T==="("&&(U?S+=")":U+=1),T===")"&&(U-=1),S+=T;t=S}I(),h&&!f&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),I()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),I(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),I());let b=S=>{let U=S.indexOf("("),T=S.indexOf(")");return U>=0&&T>=0&&U<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let S=t.slice(1,t.length-1);b(S)&&(t=S,I())}return{score:t,applied:e}}function kC(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=tl("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,s)=>s%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function QDe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[GDe,HDe].forEach(i=>{let r=t.match(i);r?.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(kC).join(" "),{score:t,applied:e}}function ZDe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p?.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let f=/^-(\d+)$/;if(f.test(p)){let[h]=p.match(f).slice(1);if(h.length===2)return h.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(UD),a=0,s="";for(let p of n){let f=tl(p,r).find(I=>!a||I>a),h=r.slice(a,f-1),m=r[f-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let I=g.split(""),v=Math.abs(I.reduce((w,y)=>+w-+y));if(v===1){let w=[h.join(" "),[m,p].join("")].join(" ");s+=w,a=f+1}else if(v===0){let w=Math.max(...I);if([4,5,6,7,8,9].includes(w)){let y=[6,4].includes(w)?w+1:w-1,b=[w,y].sort().reverse().join("-"),S=[h.join(" "),[b,p].join("")].join(" ");s+=S,a=f+1}}}}if(n.length&&s.length){let p=r.slice(a).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((f,h)=>+f-+h,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let o=r.map(p=>KDe(p)&&"bracket"||yI(p)&&"set");if(o.includes("set")&&o.includes("bracket")){let p,f="";return r.forEach((h,m)=>{o[m]==="bracket"&&p==="set"?(h=i(h),f+=h):f+=` ${h}`,p=o[m]}),{score:f.trim()}}r=t.split(" ");let l,u=r.map(p=>{let f=new RegExp(/^(\d+)-(\d+)$/);if(f.test(p)){let[h,m]=p.match(f).slice(1),g=Math.abs([h,m].reduce((v,w)=>+v-+w,0)),I=Math.max(h,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&I>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=tl("tiebreak",u);if(c.length){let p="";r.forEach((f,h)=>{c.includes(h)?p+=`(${f}) `:c.includes(h+1)?p+=`${f}`:p+=`${f} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,f,h]=t.match(d).slice(1),m=Math.max(f,h)>=10;!yI(p)&&m&&(t=t.replace(d,`${p} [${f}-${h}]`))}return u=[],t=t.split(" ").map(p=>{let f=/^\((.*)\)$/,h=f.test(p),m=new RegExp(r_).test(p)&&"super"||new RegExp(zb).test(p)&&"tiebreak"||new RegExp(AC).test(p)&&"standard"||"unknown";return u.push(m),m==="standard"&&h?p.match(f)[1]:p}).join(" "),{score:t}}function ePe({score:t,applied:e}){for(let T of[".",","," ","/"]){let D=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(D.test(t)){let P=t.match(D).slice(1).map(R=>parseInt(R)),E=Math.abs(P[0]-P[1]);E<=10&&E>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,D,P,E,R,C]=t.match(i).slice(1);t=t.replace(i,`${T}${D}-${P} ${E}-${R}${C}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let s=kC(t);s!==t&&(t=s,e.push("deDashMash"));let o=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(o.test(t)){let[T,D,P]=t.match(o).slice(1),[E,R]=D.split("");t=`${T}-${E} ${R}-${P}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[T,D]=t.match(u).slice(1),P=T.trim(),E=D.trim();if(l.test(P)&&l.test(E)){let R=P.match(l).slice(1,3).join("-"),C=E.match(l).slice(1,3).join("-");t=`${R} ${C}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[T,D]=t.match(c).slice(1),P=T.trim(),E=D.trim();if(l.test(P)&&l.test(E)){let R=P.match(l).slice(1,3).join("-"),C=E.match(l).slice(1,3).join("-");t=`${R} ${C}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("singleSetCommaSeparationPattern")}let p=0,f=/(\d+)-(\d{2})-(\d+)/;for(;f.test(t)&&p<3;){let[T,D,P]=t.match(f).slice(1),E=D.split(""),R=`${T}-${E[0]} ${E[1]}-${P}`;t=t.replace(f,R),e.push("noSetSeparationPattern"),p+=1}let h=/(^|\s)7-6\s(\d+)\s/g,m=t.match(h);if(m?.length){let T=/(^|\s)7-6\s(\d+)\s/;m.forEach(D=>{let P=D.match(T).slice(2)[0];t=t.replace(D,`7-6(${P}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g?.forEach(T=>{let D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g?.forEach(T=>{let D=" "+T.slice(1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern2")});let I=/^\d, *\d\/\d, *\d/;if(I.test(t)){let T=t.match(I)[0],D=T.split("/").map(P=>`(${P})`).join(" ")+" ";t=t.replace(T,D),e.push("slashCommaSetPattern")}let v=/\(6-\)/g;v.test(t)&&(t=t.replace(v,"(6-0)"),e.push("missingZeroPattern2"));let w=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(w.test(t)){let T=t.match(w),D=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),P=t;T.forEach(E=>{let[R,C]=E.match(D).slice(1),M=`${R}-${C}`;P=P.replace(E,M)}),t=P,e.push("slashSetPattern")}let y=/(.*)\s(1\d)\s(\d+)$/;if(y.test(t)){let[T,D,P]=t.match(y).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${D}${P}`,e.push("spaceSeparatedSuperPattern"))}let b=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(b)||[]){let[D,P,E,R]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[C,M]=P.split("-").map(N=>parseInt(N));Math.abs(C-M)===1&&(t=t.replace(T,`${D}${P}(${E})${R}`),e.push("spaceSeparatedSetPattern"))}let S=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(S)||[]){let D=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[P,E,R]=T.match(D).slice(1),[C,M]=P.split("-").map(N=>parseInt(N));Math.abs(C-M)===1&&(t=t.replace(T,`${P}(${E})${R}`),e.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let T of t.match(U)||[]){let D=/(^|\s)(\d \d)\(/,[P,E]=T.match(D).slice(1);t=t.replace(T,`${P}${E.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function tPe({score:t,matchUpStatus:e}){let i=t?.split(" ");t=i.map(o=>{if(o.endsWith("]")){let l=o.split("[");if(yI(l[0]))return l[0]+`(${l[1].slice(0,-1)})`}return o}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let o of t.match(r)){let l=o.replace(" ","-").match(/\((.*)\)/)?.[1];if(Mi(l)&&l?.[0]>2){if([2,4].includes(l.length))l=l.split("").join("-");else if(l.length===3){let u=l.indexOf("1");l=RP(l.split(""),u)}}t=t.replace(o,`(${l})`)}i=t?.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((o,l)=>{let u=[void 0,"","COMPLETED"].includes(e)||l!==a;if(n.test(o)&&u){let[c,d,p]=Array.from(o.match(n)).slice(1),f=Math.min(d,p);return`${c}(${f})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l,u]=Array.from(o.match(n)).slice(1),c=l.split("");return`${c[0]}-${c[1]}(${u})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(o=>{if(n.test(o)){let[l,u]=Array.from(o.match(n)).slice(1);return yI(l)?`${l}(${u})`:l}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l]=o.match(n).slice(1);return`[${l<9?10:Number.parseInt(l)+2}-${l}]`}return o}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let o=t.match(s)[1];t=t.replace(s,`(${o}) `)}return{score:t}}function iPe({score:t,attributes:e,identifier:i}){if(typeof t!="string")return{score:t,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=t.match(r);for(let c of n||[]){let d=c.match(/^\((.*)\)$/)?.slice(1)?.[0],p=t.split(c)[0].split(")").reverse()[0].replace(/\D/g,"");if(d?.length===2&&p?.length>=2){let m=p.slice(p.length-2).split("").map(g=>parseInt(g));if(Math.abs(m[0]-m[1])===1)continue}let f=sz(d),h=kC(f);t=t.replace(c,`(${h})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);t.match(a)?.forEach(c=>{let d=sz(c.match(/^\[(.*)\]$/)[1]);t=t.replace(c,`(${d}) `).trim()});let s=[")","]"],o=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&s.some(c=>t.endsWith(c))&&o.some(c=>t.includes(c))){let c="",d=t.split(/[)\]]/).filter(Boolean).map(g=>(g.startsWith(",")&&(g=g.slice(1)),g.trim())),p=d.every(g=>g.includes(",")||UD(g)),f=d.every(g=>g.includes("/")||UD(g)),h=d.every(g=>g.includes("-")||UD(g)),m=p&&","||h&&"-"||f&&"/";if(m){let g;d.forEach(I=>{if(I.startsWith("("))if(g==="set"&&(c+=" "),I.includes(m))c+=I.slice(1).split(m).map(v=>v.trim()).join("-"),g="set";else{let v=I.slice(1);c+=`(${v}) `,g="tiebreak"}else if(I.startsWith("[")){let v=I.slice(1).split(m).map(y=>parseInt(y.trim())),w=Math.min(...v);g==="set"?c+=`(${w}) `:c+=`[${v.join("-")}] `,g="tiebreak"}}),t=c.trim()}}let l=Ta(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&yI(t)&&Mi(e?.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let u=/\(\)/g;return u.test(t)&&(t=t.replace(u,"").trim()),{score:t}}function $X({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let o=`${r[0]}-${r[1]}`;return r[2]&&(o+=` (${r[2]})`),n(),r.push(r),o};n();let s=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let o=e.shift(),l=Mi(o)&&parseInt(o),u=r[0]!==void 0&&r[1]!==void 0;if(Mi(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,s())){i.push(a()),r=[void 0,void 0];continue}if(u&&e.length===1&&Mi(e[0])){let c=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=c,i.push(a()),r=[void 0,void 0]}u&&s()}}return{sets:i}}function ux(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=RP(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=RP(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function BX(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e?.toString().split(""),a=n?.every(o=>Mi(o)),s=o=>Math.abs(o[0]-o[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let o=a?n.map(u=>parseInt(u)):e.split("").map(u=>parseInt(u)),{sets:l}=$X({score:e});if(o.length,e.length===3&&s(o.slice(0,2))===1){let[u,c,d]=o;e=`${u}-${c}(${d})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&o[0]===1){let[u,c,d]=o;e=`[${u}${c}-${d}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&s(o.slice(0,2))===1&&"987654".split("").includes(o[0].toString())){let[u,c,d,p]=o,f=Math.min(d,p);e=`${u}-${c}(${f})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&o[0]===1&&o[2]===1){let[u,c,d,p]=o;e=`[${u}${c}-${d}${p}]`,i.push("bigSuper")}else if(e.length===4){let[u,c,d,p]=o;e=`${u}${c} ${d}${p}`,i.push("split4")}else if(e.length===5&&s(o.slice(0,2))===1){let[u,c,d,p,f]=o;e=`${u}-${c}(${d}) ${p}-${f}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&s(o.slice(3))===1){let[u,c,d,p,f]=o;e=`${u}-${c} ${d}-${p}(${f})`,i.push("numericTiebreakPattern5")}else if(o.length===7)if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&o[4]===1){let[u,c,d,p,f,h,m]=o;e=`${u}-${c} ${d}-${p} [${f}${h}-${m}]`,i.push("numericTiebreakPattern6")}else if(s(o.slice(0,2))===1&&s(o.slice(3,5))>1&&s(o.slice(5,7))>1){let[u,c,d,p,f,h,m]=o;e=`${u}-${c}(${d}) ${p}-${f} ${h}-${m}`,i.push("numericTiebreakPattern7")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))===1&&s(o.slice(5,7))>1){let[u,c,d,p,f,h,m]=o;e=`${u}-${c} ${d}-${p}(${f}) ${h}-${m}`,i.push("numericTiebreakPattern8")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&s(o.slice(4,6))===1){let[u,c,d,p,f,h,m]=o;e=`${u}-${c} ${d}-${p} ${f}-${h}(${m})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let u=ux(e);u&&e!==u&&i.push("parsedSuperPattern"),e=u??e}else{let u=br(e.split(""),2).map(I=>I.join("")),c=u.map(I=>{let[v,w]=I.split("").map(S=>parseInt(S)),y=Math.abs(v-w),b=v>w?1:2;return y>1&&b||b*-1}),d=c.reduce((I,v)=>I>0&&v>0,1),p=Ta(c),f=c.map(I=>Math.abs(I)),h=Ta(f),m=c[0]<0,g=!m&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[u.slice(0,2).join(" "),u.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(d)e=u.join(" "),i.push("chunkSplit");else if(o.length===6){if(p[1]===2||p[2]===2)if(!Object.values(h).includes(3))e=u.join(" "),i.push("chunkSplit");else{let[I,v,w,y,b,S]=o,U=c.reduce((T,D,P)=>D<0?P:T,void 0);if(U===0){let T=Math.min(w,y);e=`${I}-${v}(${T}) ${b}-${S}`,i.push("chunkSplitTiebreak1")}else if(U===1){let T=Math.min(b,S);e=`${I}-${v} ${w}-${y}(${T})`,i.push("chunkSplitTiebreak2")}else e=`${I}-${v} ${w}-${y}`,i.push("chunkSplitTrimExtraneous")}}else if(o.length===8){let[I,v,w,y,b,S,U,T]=o;m||g?o[5]===1&&(m?e=`${I}-${v}(${w}) ${y}-${b} [${S}${U}-${T}]`:e=`${I}-${v} ${w}-${y}(${b}) [${S}${U}-${T}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:r}}function VX(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let u=l.match(n).slice(1).map(d=>Number.parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],o=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:s,setWinners:i,totalSets:o,winningSide:a}}function rPe({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),s=a.length;t=a.map((c,d)=>{if(new RegExp(zb).test(c)){let f=c.slice(3),h=c.slice(0,3),m=h.split("-");if(!yI(h)&&!e){let g=Math.max(...m),I=h.indexOf(g),v=[g,g-1];return I&&v.reverse(),v.join("-")+f}}else if(c.length===2&&Mi(c))return c.split("").join("-");c=kC(c);let p=new RegExp(`^${r_}$`).test(c)&&"super"||new RegExp(`^${zb}$`).test(c)&&"tiebreak"||new RegExp(`^${AC}$`).test(c)&&"standard"||"unknown";if(r.push(p),s>1&&p==="standard"&&d<2){let[f,h]=c.split("-"),m=Math.abs(parseInt(f)-parseInt(h)),g=Math.max(f,h),I=Math.min(f,h),v=[parseInt(f),parseInt(h)].indexOf(I);if(g>9&&m>2){let w=g.toString().split(""),y=w.find(b=>parseInt(b)>I||d&&parseInt(b)<=n)??w[0];y&&(c=v?[y,I].join("-"):[I,y].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[f,h]=c.split("-");if(!Math.abs(parseInt(f)-parseInt(h))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:o,setWinners:l,totalSets:u}=VX(t);if(u===1&&i?.removed==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...o)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...o)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function nPe({score:t}){let{setsTied:e,winningSide:i}=VX(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let o=t.match(r).slice(1)[0],l=o<=8?10:o+2;t=t.replace(r,` [${l}-${o}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let s=a.split("(").join("").split(")").join("").split("-");if(!s.every(o=>Mi(o)))return{score:t};if(s[0]==="76"){let o=s[1].length===2?Math.min(...s[1].split("").map(l=>parseInt(l))):s[1];t=[...n.slice(0,n.length-1),`7-6(${o})`].join(" ")}else{s=s.map(u=>parseInt(u));let o=Math.max(...s),l=Math.abs(s[0]-s[1]);if(o>=10){if(l>2&&s.every(u=>+u>=10)){let u=s.map(c=>c===o?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(s=u)}t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" ")}else n.length===3&&o>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function aPe({score:t}){return t=t?.toString().toLowerCase()||"",{score:t}}function sPe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function oPe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=RP(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=BX({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function lPe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&ux(t)?{score:ux(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function uPe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t?.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function cPe({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let n=e?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function dPe({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(def|defaulted)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleDefaulted"),{score:s.trim(),matchUpStatus:"defaulted",applied:i}}let n=e?.matchUpStatuses?.defaulted,a=["dft",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleDefaulted"),{matchUpStatus:"defaulted",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function pPe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function fPe({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function hPe({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function mPe({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function gPe({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[s,o]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${s}-${o}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Mi(i))&&e.length===4&&(t=e)}return{score:t}}function IPe({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var vPe={handleTiebreakSlashSeparation:mPe,handleSetSlashSeparation:fPe,punctuationAdjustments:JDe,handleGameSeparation:hPe,joinFloatingTiebreak:ZDe,handleBracketSpacing:QDe,handleSpaceSeparator:gPe,separateScoreBlocks:oPe,matchKnownPatterns:ePe,removeDanglingBits:pPe,removeErroneous:lPe,handleDefaulted:dPe,handleWalkover:uPe,properTiebreak:tPe,handleNumeric:BX,handleRetired:cPe,containedSets:iPe,sensibleSets:rPe,stringScore:aPe,superSquare:nPe,setBuilder:$X,excisions:IPe,replaceOh:sPe},ck={},yPe=["handleNumeric","handleWalkover","handleRetired","handleDefaulted","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],bPe=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function jX(t){if(!t.score)return{error:ie};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:s,profile:o}=t,l=[],u,c=[],d,p,f=e,h=g=>{g.forEach(I=>{p=vPe[I]({profile:o,identifier:r,matchUpStatus:u,attributes:d,applied:c,score:f});let v=p.score!==f;v&&l.push({method:I,score:p.score}),a&&(s||v||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},I),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),f=p.score})};h(yPe);let m=az(f);return m||(f=e.toString().replaceAll(/\D/g,""),d?.removed&&(d.removed=void 0),h(bPe),m=az(f),m||(f="")),c.forEach(g=>{ck[g]||(ck[g]=0),ck[g]+=1}),{matchUpStatus:u?.toUpperCase(),modifications:l,attributes:d,isValid:m,score:f}}var GX={};pt(GX,{analyzeScore:()=>a_,analyzeSet:()=>qb,calculateMatchStatistics:()=>J0,checkScoreHasValue:()=>dr,checkSetIsComplete:()=>MC,deduceMatchUpFormat:()=>FC,enrichPointHistory:()=>fX,getEpisodes:()=>X0,getQuickStats:()=>hX,getScore:()=>Dd,getScoreboard:()=>q0,getSetComplement:()=>o_,getTiebreakComplement:()=>xC,getWinner:()=>Y0,isComplete:()=>K0,isValidMatchUpFormat:()=>Ga,parseScoreString:()=>zS,toStatObjects:()=>Q0,validateMatchUpScore:()=>HX,validateScore:()=>s_,validateSetScore:()=>n_,validateTieFormat:()=>Hn});function wPe(t,e,i,r,n,a=!1){return n?{isValid:!0}:t===0&&e===0?{isValid:!1,error:"Tiebreak-only set requires both scores"}:t<r?{isValid:!1,error:`Tiebreak-only set winner must reach at least ${r}, got ${t}`}:i<(a?1:2)?{isValid:!1,error:a?`Tiebreak-only set (NoAD) must be won by at least 1 point, got ${t}-${e}`:`Tiebreak-only set must be won by at least 2 points, got ${t}-${e}`}:a?{isValid:!0}:t===r&&e>r-2?{isValid:!1,error:`Tiebreak-only set at ${r}-${e} requires playing past ${r}`}:t>r&&i!==2?{isValid:!1,error:`Tiebreak-only set past ${r} must be won by exactly 2 points, got ${t}-${e}`}:{isValid:!0}}function SPe(t,e,i,r){let n=r===i?i+1:i,a=r;return t!==n?{isValid:!1,error:`Tiebreak set winner must have ${n} games, got ${t}`}:e!==a?{isValid:!1,error:`Tiebreak set loser must have ${a} games, got ${e}`}:{isValid:!0}}function UPe(t,e,i){let r=Math.max(t||0,e||0),n=Math.min(t||0,e||0),a=r-n,s=i.tiebreakTo||7;return r<s?{isValid:!1,error:`Tiebreak winner must reach ${s} points, got ${r}`}:a<2?{isValid:!1,error:`Tiebreak must be won by 2 points, got ${r}-${n}`}:n>=s-1&&a>2?{isValid:!1,error:`Tiebreak score ${r}-${n} is invalid`}:{isValid:!0}}function TPe(t,e,i,r){return r?t===i+1&&e<i-1?{isValid:!1,error:`With tiebreak format, if side 1 has ${i+1} games, side 2 must be at least ${i-1}, got ${e}`}:e===i+1&&t<i-1?{isValid:!1,error:`With tiebreak format, if side 2 has ${i+1} games, side 1 must be at least ${i-1}, got ${t}`}:{isValid:!0}:{isValid:!0}}function DPe(t,e,i,r,n){if(t<r)return{isValid:!1,error:`Set winner must reach ${r} games, got ${t}`};let a=n&&t===r&&e===n&&i===1;if(i<2&&!a)return{isValid:!1,error:`Set must be won by at least 2 games, got ${t}-${e}`};if(n){if(e>=n&&!a)return{isValid:!1,error:`When tied at ${n}-${n}, must play tiebreak. Use format like ${n+1}-${n}(5)`};let s=n===r?r+1:r;if(t>s)return{isValid:!1,error:`With tiebreak format, set score cannot exceed ${s}-${n}. Got ${t}-${e}`}}else if(t>r+10)return{isValid:!1,error:`Set score ${t}-${e} exceeds reasonable limits`};return{isValid:!0}}function PPe(t,e,i){let r=t.side1TiebreakScore,n=t.side2TiebreakScore,a=e&&i?r:t.side1Score||t.side1||0,s=e&&i?n:t.side2Score||t.side2||0;return{side1Score:a,side2Score:s,side1TiebreakScore:r,side2TiebreakScore:n}}function EPe(t,e,i,r,n,a,s){if(i&&r){let o=SPe(t,e,i,r);if(!o.isValid)return o}return(n!==void 0||a!==void 0)&&s?UPe(n,a,s):{isValid:!0}}function RPe(t,e,i){return i&&(t>i+10||e>i+10)?{isValid:!1,error:`Set score ${t}-${e} exceeds expected range for ${i}-game sets`}:{isValid:!0}}function CPe(t,e,i){let{side1:r,side2:n,winner:a,loser:s,diff:o}=t,{setTo:l,tiebreakAt:u}=e;if(l&&u){let c=TPe(r,n,l,u);if(!c.isValid)return c}return i?RPe(a,s,l):l?DPe(a,s,o,l,u):{isValid:!0}}function n_(t,e,i,r){if(!e)return{isValid:!0};let n=Ki(e);if(!n)return{isValid:!0};let a=i&&n.finalSetFormat?n.finalSetFormat:n.setFormat;if(!a)return{isValid:!0};if(a.timed){if(!r){let S=t.side1Score??0,U=t.side2Score??0;if(S===0&&U===0)return{isValid:!1,error:"Timed set requires at least one side to have scored"};if(a.based==="P"&&S===U&&S>0&&a.tiebreakFormat&&!(t.side1TiebreakScore!==void 0||t.side2TiebreakScore!==void 0))return{isValid:!1,error:"Tied timed set requires tiebreak"}}return{isValid:!0}}let{setTo:s,tiebreakAt:o,tiebreakFormat:l,tiebreakSet:u}=a,c=u?.tiebreakTo,d=!!c&&!s,p=t.side1TiebreakScore!==void 0&&t.side2TiebreakScore!==void 0,{side1Score:f,side2Score:h,side1TiebreakScore:m,side2TiebreakScore:g}=PPe(t,d,p),I=Math.max(f,h),v=Math.min(f,h),w=I-v;if(d){let S=t.NoAD??a.tiebreakSet?.NoAD??!1;return wPe(I,v,w,c,r??!1,S)}let y=m!==void 0||g!==void 0,b=s&&I===s+1&&v===s;return y||b?EPe(I,v,s,o,m,g,l):CPe({side1:f,side2:h,winner:I,loser:v,diff:w},{setTo:s,tiebreakAt:o},r)}function HX(t,e,i){if(!t||t.length===0)return{isValid:!0};let r=e?.match(/SET(\d+)/)?.[1],n=r?Number.parseInt(r):3,a=[jr,mi,Zt].includes(i||"");for(let s=0;s<t.length;s++){let o=t[s],l=s+1===n,u=o.winningSide!==void 0,c=n_(o,e,l,a||i===void 0&&!u);if(!c.isValid)return{isValid:!1,error:`Set ${s+1}: ${c.error}`}}return{isValid:!0}}function OC(t){return!!t?.aggregate}function MPe(t,e,i,r,n,a){let{tiebreakTo:s,NoAD:o}=t||{},l=Math.max(e??0,i??0);return!(o&&l>s||l<s&&r&&(n&&!a||!n))}function NPe(t,e,i,r,n,a){let s=e+1===r,{side1Score:o,side2Score:l,side1TiebreakScore:u,side2TiebreakScore:c,winningSide:d}=t,p=Math.max(o??0,l??0),f=u??c,{finalSetFormat:h,setFormat:m}=i,g=s&&h||m;return f&&!MPe(g?.tiebreakFormat,u,c,d,n,a)?!1:g.setTo?!(!g.noTiebreak&&p>g.setTo+1):!0}function APe(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i[0]+=r.side1Score??0,i[1]+=r.side2Score??0),i),[0,0]);return e[0]>e[1]?1:e[1]>e[0]?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function kPe(t,e,i,r,n){return(!n||t===e)&&i===1&&r.indexOf(t)+1||void 0}function a_({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){let a=n?.sets??[],s=(a?.filter(T=>T?.winningSide)||[]).reduce((T,D)=>{let{winningSide:P}=D;if(!P)return T;let E=P-1;return T[E]++,T},[0,0]),o=r?r-1:void 0,l=o!==void 0&&[0,1].includes(o)?1-o:void 0,u=o!==void 0&&s[o],c=l!==void 0&&s[l],d=e?Ki(e):void 0,p=Math.max(...s),f=Ta(s)[p],h=d?.setFormat?.timed||d?.finalSetFormat?.timed,m=d?.bestOf||d?.exactly,g=m&&Math.ceil(m/2)||1,I=i??t,v=!!(I&&[Zt,jr,mi].includes(I)),w=!d||!a.length||a.every((T,D)=>NPe(T,D,d,m??0,D===a.length-1,v)),y=d?.exactly,b=!y||!I||I!==Oi||v||a.length>=y,S=OC(d),U=S&&a.length>0?APe(a):kPe(p,g,f,s,e);return{valid:!!(w&&b&&(r&&S&&r===U||r&&!S&&u>c&&r===U||r&&v||!r&&!U&&(![Oi,Zt,jr,mi].includes(I)||h&&I===Oi)))}}function s_({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:ie};let{sets:a,scoreStringSide1:s,scoreStringSide2:o}=n,l="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:ie,info:l};if(o!==void 0&&typeof o!="string")return{error:ie,info:l};if(a!==void 0&&!Array.isArray(a))return{error:ie,info:_p("sets")};if(a?.length){let u=a.map(d=>d?.setNumber).filter(Boolean);if(u.length!==ot(u).length)return{error:ie,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:f,side1TiebreakScore:h,side2TiebreakScore:m,side1PointScore:g,side2PointScore:I,winningSide:v,setNumber:w}=d;if(![[p,f],[h,m],[g,I]].filter(y=>y.some(b=>![void 0,null].includes(b))).every(y=>y.every(b=>ut(b))))return{error:ie,info:"non-numeric values"};if(![w,v].filter(y=>![void 0,null].includes(y)).every(y=>ut(y)))return{error:ie,info:"non-numeric values"};if(v&&![1,2].includes(v))return{error:ie,info:"winningSide must be 1 or 2"}}let{valid:c}=a_({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!c)return{error:_4,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var o_=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let s=Ye(i);s?.toString().length>2&&(s=Number.parseInt(s.toString().slice(0,2))),n&&n<r&&s>n&&(s=n);let o;return a&&!n?s>r?o=r:o=s<r?r:r-1:o=s+1<r&&r||n&&n<r&&s===n&&r||!n&&s+2||r+1,[e?s:o,e?o:s]},xC=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?Number.parseInt(i):i;a?.toString().length>2&&(a=Number.parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let s=OPe({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:s,e?s:a]};function OPe(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function cx(t,e){return t>e&&1||t<e&&2||void 0}function xPe(t,e){return e?{side1Score:t[0],side2Score:t[1],winningSide:cx(t[0],t[1])}:{side1TiebreakScore:t[0],side2TiebreakScore:t[1],winningSide:cx(t[0],t[1])}}function zS({tiebreakTo:t=7,scoreString:e="",matchUpFormat:i}){let r,n=3;if(i)try{r=Ki(i);let c=/SET(\d+)/.exec(i)?.[1];n=c?Number.parseInt(c):3}catch{}return e?.split(" ").filter(Boolean).map((c,d)=>u({set:c,setNumber:d+1}));function a(c,d){if(!r||!d)return!1;let p=c===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;if(!p)return!1;let f=p.tiebreakSet?.tiebreakTo,h=p.setTo;return!!f&&!h}function s(c){if(!r)return t;let d=c===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;return d?.tiebreakSet?.tiebreakTo??d?.tiebreakFormat?.tiebreakTo??t}function o(c,d,p){let f=c[1],h=s(p),m=xC({lowValue:f,isSide1:d===2,tiebreakTo:h});return Array.isArray(m)?[m[0],m[1]]:[void 0,void 0]}function l(c,d,p,f){let h=(d&&c.replace(d[0],"")||p&&c.replace(p[0],"")||c).split("-").map(y=>Number.parseInt(y)),m=h[0],g=h[1],I=cx(m,g),v,w;if(d&&([v,w]=o(d,I,f)),p){let y=p[1].split("-").map(b=>Number.parseInt(b));v=y[0],w=y[1]}return{side1Score:m,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:w,winningSide:I}}function u({set:c,setNumber:d}){let p=/\(([^)]+)\)/,f=/\[([^\]]+)\]/,h=p.exec(c),m=f.exec(c),g=c?.startsWith("[")&&m,I=a(d,!!g),v=s(d),w=I&&v===1,y;if(g){let b=m[1].split("-").map(S=>Number.parseInt(S));y=xPe(b,I)}else y=l(c,h,m,d);return{side1Score:y.side1Score,side2Score:y.side2Score,side1TiebreakScore:y.side1TiebreakScore,side2TiebreakScore:y.side2TiebreakScore,winningSide:y.winningSide,setNumber:d,...w&&{NoAD:!0},...I&&{tiebreakSet:!0}}}}function FPe({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=NC({set:n});return MC({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function qb(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:cR};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},s=n||a,o=!!(r&&s&&r===s),l=o&&i?.finalSetFormat||i?.setFormat,u=!!l?.tiebreakSet,c=!!l?.timed,d=!u&&!c,p=!!(r&&s&&r<=s),f=[e?.side1Score,e?.side2Score],h=[e?.side1PointScore,e?.side2PointScore],m=[e?.side1TiebreakScore,e?.side2TiebreakScore],g=f.filter(k=>k!==void 0).length,I=h.filter(k=>k!==void 0).length,v=m.filter(k=>k!==void 0).length,w=f?.filter(k=>!isNaN(k)).length,y=m?.filter(k=>!isNaN(k)).length,{tiebreakAt:b}=l||{},S=b&&f.filter(k=>k>=b).length===2,U=S&&(f[0]>f[1]&&1||f[1]>f[0]&&2||void 0),T=!!(y&&!w),D=!!e?.winningSide,{error:P,result:E}=LPe({sideTiebreakScores:m,sideGameScores:f,setFormat:l,setObject:e}),{error:R,result:C}=_Pe({sideTiebreakScores:m,setObject:e,setFormat:l}),M=d&&!T&&E||u&&T&&C||c,N=p&&!(u&&!T)&&!(d&&T)&&(!D||M),A=FPe({isTimedSet:c,matchUpScoringFormat:i,isDecidingSet:o,isTiebreakSet:T,setObject:e}),O={expectTiebreakSet:u,expectTimedSet:c,hasTiebreakCondition:S,isCompletedSet:D,isDecidingSet:o,isTiebreakSet:T,isValidSet:N,isValidSetNumber:p,isValidSetOutcome:M,leadingSide:U,setFormat:l,sideGameScores:f,sideGameScoresCount:g,sidePointScores:h,sidePointScoresCount:I,sideTiebreakScores:m,sideTiebreakScoresCount:v,winningSide:A};return e?.winningSide!==void 0&&(T?(O.isValidTiebreakSetOutcome=C,C||(O.tiebreakSetError=R)):(O.isValidStandardSetOutcome=E,E||(O.standardSetError=P))),O}function LPe({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:cR};let n=!!e?.tiebreakSet,a=!!e?.timed;if(!e||n||a)return{result:!1,error:ie};if(i?.filter(U=>!isNaN(U)).length!==2)return{result:!1,error:RO};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,NoAD:u}=e||{};if(!(s&&i?.find(U=>U>=s)))return{result:!1,error:RO};let c=[1,2].includes(t?.winningSide);if(!t||!c)return{result:!1,error:pR};let d=t?.winningSide-1,p=1-d,f=i[d],h=i[p],m=f-h;if(!(f>h))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=o&&l,I=r?.filter(U=>!isNaN(U)).length===2,v=r?.[d],w=r?.[p],y=o&&i.filter(U=>U>=o).length===2;if(g){let{NoAD:U,tiebreakTo:T}=l;if(y){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!I)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&r?.find(C=>C>=T)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let D=o<s?s:s+1;if(f>D)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!v||!w||v<w)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let P=U?1:2,E=v-w,R=w>=T-1;if(E&&R&&E<P)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(f>s&&!y)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let b=u?1:2,S=h>=s-1;return m&&S&&!y&&m<b?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>b&&f>s?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function _Pe({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:cR};let r=!!e?.tiebreakSet,n=!!e?.timed;if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t?.winningSide);if(!t||!a)return{result:!1,error:pR};let{tiebreakSet:s}=e||{},{NoAD:o,tiebreakTo:l}=s||{};if(i?.filter(g=>!isNaN(g)).length!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!i?.find(g=>g>=l))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=t?.winningSide-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let f=o?1:2,h=d-p,m=p>=l-1;return h&&m&&h<f?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var dk="SET3-S:6/TB7";function FC(t){let e=t.split(/[\s,]+/).filter(o=>o.length>0);if(e.length===0)return dk;let i;e.length===1?i=1:e.length===2?i=3:i=5;for(let o of e){let l=o.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(u=>Number.parseInt(u,10))||[];if(l.length===2){let u=Math.max(...l),c=Math.min(...l),d=u-c;if(u===10||u>10&&d<=2)return`SET${i}-S:TB10`}}let r=null;for(let o of e)if(/\(/.test(o)){r=o;break}let n;if(r){let o=r.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(c=>parseInt(c,10))||[];if(o.length===0)return dk;let l=Math.max(...o),u=Math.min(...o);l===u+1?n=u:n=l-1}else{let o=[];for(let u of e){let c=u.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(d=>parseInt(d,10))||[];c.length>0&&o.push(Math.max(...c))}if(o.length===0)return dk;let l=Math.max(...o);l>=6?n=6:n=l}let a=!1;if(e.length>=3){let o=e.at(-1).replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(l=>Number.parseInt(l,10))||[];if(o.length===2){let l=Math.max(...o),u=Math.min(...o);l>n+1&&l-u===2&&(a=!0)}}let s;return n===6?s=`SET${i}-S:6/TB7`:n===4?s=`SET${i}-S:4/TB7`:s=`SET${i}-S:${n}/TB7`,a&&(s+=`-F:${n}`),s}function WX(t){let{matchUp:e,expectedScore:i}=t;if(!e)return{isValid:!1,errors:["No matchUp provided"],warnings:[],actual:{sets:[],scoreString:""},expected:{sets:i?.sets,scoreString:i?.scoreString},pointsProcessed:0,pointsRejected:0};let r=[],n=[],a=ud({matchUpFormat:e?.matchUpFormat,matchUpId:e?.matchUpId,participants:e?.sides?.map(c=>c.participant).filter(c=>c!==void 0)}),s=e?.history?.points||[];s.length===0&&n.push("No points found to validate");let o=0,l=0;for(let c of s)try{a=Sp(a,{winner:c.winner,server:c.server}),o++}catch(d){l++;let p=d instanceof Error?d.message:String(d);r.push(`Point ${c.pointNumber||o+1}: ${p}`)}let u=Dd(a);return i&&(i.sets&&(u.sets.length!==i.sets.length&&r.push(`Set count mismatch: expected ${i.sets.length}, got ${u.sets.length}`),i.sets.forEach((c,d)=>{let p=u.sets[d];if(!p){r.push(`Missing set ${d+1}`);return}c.side1Score!==void 0&&p.side1Score!==c.side1Score&&r.push(`Set ${d+1} side1Score: expected ${c.side1Score}, got ${p.side1Score}`),c.side2Score!==void 0&&p.side2Score!==c.side2Score&&r.push(`Set ${d+1} side2Score: expected ${c.side2Score}, got ${p.side2Score}`),c.side1TiebreakScore!==void 0&&p.side1TiebreakScore!==c.side1TiebreakScore&&r.push(`Set ${d+1} side1TiebreakScore: expected ${c.side1TiebreakScore}, got ${p.side1TiebreakScore}`),c.side2TiebreakScore!==void 0&&p.side2TiebreakScore!==c.side2TiebreakScore&&r.push(`Set ${d+1} side2TiebreakScore: expected ${c.side2TiebreakScore}, got ${p.side2TiebreakScore}`)})),i.scoreString&&u.scoreString!==i.scoreString&&r.push(`Score string mismatch: expected "${i.scoreString}", got "${u.scoreString}"`)),{isValid:r.length===0,errors:r,warnings:n,actual:{sets:u.sets,scoreString:u.scoreString},expected:{sets:i?.sets,scoreString:i?.scoreString},pointsProcessed:o,pointsRejected:l}}function $Pe(t){let e=t?.side1Score||0,i=t?.side2Score||0;if(t?.side1TiebreakScore!==void 0||t?.side2TiebreakScore!==void 0){let r=t?.side1TiebreakScore||0,n=t?.side2TiebreakScore||0;return e>i?`${e}-${i}(${n})`:`${e}(${r})-${i}`}return`${e}-${i}`}function BPe(t){let{points:e,matchUpFormat:i,expectedGames:r,expectedTiebreak:n}=t,a={matchUpId:"validation",matchUpFormat:i,matchUpStatus:"TO_BE_PLAYED",matchUpType:"SINGLES",sides:[{sideNumber:1},{sideNumber:2}],score:{sets:[]},history:{points:e?.map((s,o)=>({...s,pointNumber:o+1,timestamp:"",winner:s.winner,server:s.server}))}};return WX({matchUp:a,expectedScore:{sets:[{side1Score:r?.[0],side2Score:r?.[1],side1TiebreakScore:n?.[0],side2TiebreakScore:n?.[1]}]}})}function VPe(t){let{points:e,expectedScore:i,matchUpFormat:r,allowExtraPoints:n=!1,debug:a=!1}=t,s=[],o=[],l=[],u,c=!1;r?u=r:i?(u=FC(i),c=!0,a&&console.log(`Deduced format: ${u} from score: ${i}`)):(u="SET3-S:6/TB7",c=!0,o.push("No format provided, using default SET3-S:6/TB7"));let d=ud({matchUpFormat:u}),p=e?.split("").map(v=>{let w=Number.parseInt(v,10);return Number.isNaN(w)||w!==0&&w!==1?null:w}).filter(v=>v!==null);if(p?.length===0)return s.push("No valid points found in point string"),{valid:!1,errors:s,warnings:o,pointsProcessed:0,pointsRejected:[],actualScore:"0-0",matchUpFormat:u,formatDeduced:c,sets:[]};let f=0;for(let v=0;v<p?.length;v++){let w=p[v];if(d.matchUpStatus==="COMPLETED"&&!n){l.push(w),a&&console.log(`Point ${v+1}: Rejected (match complete)`);continue}try{if(d=Sp(d,{winner:w}),f++,a){let y=Dd(d);console.log(`Point ${v+1}: ${w} â†’ ${y.scoreString}`)}}catch(y){l.push(w);let b=y instanceof Error?y.message:String(y);s.push(`Point ${v+1}: ${b}`),a&&console.log(`Point ${v+1}: Error - ${b}`)}}let h=Dd(d),m=h.scoreString,g=h.sets.map(v=>{let w=[v.side1Score||0,v.side2Score||0],y=v.side1TiebreakScore===void 0?void 0:[v.side1TiebreakScore,v.side2TiebreakScore||0],b=`${w[0]}-${w[1]}`;return y&&(b=w[0]>w[1]?`${w[0]}-${w[1]}(${y[1]})`:`${w[0]}(${y[0]})-${w[1]}`),{games:w,tiebreak:y,scoreString:b}}),I=!0;if(i){let v=oz(i),w=oz(m);v!==w&&(I=!1,s.push(`Score mismatch: expected "${i}", got "${m}"`))}return l.length>0&&o.push(`${l.length} excess points after match complete`),s.length>0&&(I=!1),{valid:I,errors:s,warnings:o,pointsProcessed:f,pointsRejected:l,expectedScore:i,actualScore:m,matchUpFormat:u,formatDeduced:c,sets:g}}function oz(t){return t.replace(/\s+/g,"").replace(/,/g,", ").toLowerCase()}var jPe={4:"Wide",5:"Body",6:"T"},zX={f:"Forehand",r:"Forehand Slice",v:"Forehand Volley",o:"Overhead Smash",u:"Forehand Drop Shot",l:"Forehand Lob",h:"Forehand Half-volley",j:"Forehand Drive Volley"},qX={b:"Backhand",s:"Backhand Slice",z:"Backhand Volley",p:"Backhand Overhead Smash",y:"Backhand Drop Shot",m:"Backhand Lob",i:"Backhand Half-volley",k:"Backhand Drive Volley"},GPe={t:"Trick Shot",q:"Unknown Shot"},HPe={...zX,...qX,...GPe},WPe={7:"shallow",8:"deep",9:"very deep"},zPe={1:1,2:2,3:3},qPe={"+":"approach","-":"net","=":"baseline"},Wf={n:"Net",w:"Out Wide",d:"Out Long",x:"Out Wide and Long",g:"Foot Fault",e:"Unknown","!":"Shank"};function YPe(t,e){return t.PtWinner===t.Svr?e:1-e}function YX(t){let e=[],i="",r="fbrsvzouymlhijkpqt";for(let n=0;n<t.length;n++){let a=t[n];a&&(r.includes(a)||"456".includes(a)?(i&&e.push(i),i=a):i+=a)}return i&&e.push(i),e}function KPe(t){if(t.includes("*"))return"*";if(t.includes("#"))return"#";if(t.includes("@"))return"@"}function jl(t){if(t){for(let e of Object.keys(Wf))if(t.includes(e))return e}}function XPe(t){let e=[];for(let i of t){if(!i)continue;let r=i[0];if(r&&/[456]/.test(r))e.push(i);else break}return e}function KX(t){if(!ni(t))return{serves:[],rally:[]};let e,i,r,n=t.split("c").length-1;t=t.split("c").join("");let a=YX(t),s=a;for(let c=a.length-1;c>=0;c--){let d=a[c];if(d&&(i=KPe(d),i)){s=a.slice(0,c+1),r=a.slice(c+1),e=d;break}}let o=XPe(s),l=o.length?s.slice(o.length):s;if(!i&&!o.length&&l.length===1){let c=l[0];c&&["S","P","Q","R"].includes(c)&&(e=c,l.length=0)}let u={serves:o,rally:l};return n&&(u.lets=n),i&&(u.terminator=i),e&&(u.result=e),r?.length,u}function XX(t){let e=t.join("|"),i=dx(t[0],1);if(i.winner==="S"||!t[1])return i.serve=1,i.code=e,i;let r=dx(t[1],2);return r.serve=2,r.first_serve={serves:i.serves},i.lets&&(r.first_serve.lets=i.lets),i.error&&(r.first_serve.error=i.error),i.parse_notes&&(r.first_serve.parse_notes=i.parse_notes),r.code=e,r}function dx(t,e){let i=KX(t);if(["Q","S"].includes(i.result||""))return i.winner="S",i;if(["P","R"].includes(i.result||"")||!i.terminator&&!jl(i.serves[0])&&i.serves.length>2)return i.winner="R",i;let r=(i.serves.length+i.rally.length)%2===0?"R":"S",n;if(i.rally.length>0?n=i.rally[i.rally.length-1]:i.serves.length>0&&(n=i.serves[i.serves.length-1]),!n)return{...i,winner:void 0};if(!i.rally.length){if(i.terminator==="*")i.result="Ace",i.winner="S";else if(i.terminator==="#")i.result="Serve Winner",i.winner="S";else{let a=jl(i.serves[0]);a?(i.error=Wf[a],e===2&&(i.result="Double Fault",i.winner="R")):(i.parse_notes="treated as a fault",e===2&&(i.result="Double Fault",i.winner="R"))}return i}if(i.rally.length===1&&n.includes("#")){i.result="Serve Winner",i.winner="S";let a=jl(n);return a&&(i.error=Wf[a]),i}return n.includes("#")?(i.result="Forced Error",i.error=Wf[jl(n)],i.winner=r==="R"?"S":"R"):n.includes("*")?(i.result="Winner",i.winner=r):n.includes("@")?(i.result="Unforced Error",i.error=Wf[jl(n)],i.winner=r==="R"?"S":"R"):jl(i.serves[0])?i.rally.length===1&&jl(n)&&(i.error=Wf[jl(n)],i.winner=r==="R"?"S":"R"):i.serves.length&&i.rally.length?(i.parse_notes="no terminator: receiver wins point",i.result="Unknown",i.winner="R"):i.rally.length===1&&jl(n)&&(i.error=Wf[jl(n)],i.winner=r==="R"?"S":"R"),i}function px(t){if(t)for(let e of t){let i=HPe[e];if(i)return i}}function JPe(t){if(t)for(let e of t){let i=jPe[e];if(i)return i}}function QPe(t,e,i){let r=[],n=1,a=i;if(t.length>0&&!jl(t[t.length-1])){let s=t[t.length-1],o=px(s)||"Forehand";r.push({shotNumber:n++,player:a,stroke:o,code:s}),a=1-a}for(let s of e){let o=px(s);if(!o)continue;let l={shotNumber:n++,player:a,stroke:o,code:s};for(let u of s){let c=zPe[u];c!==void 0&&(l.direction=c)}for(let u of s){let c=WPe[u];c&&(l.depth=c)}for(let u of s){let c=qPe[u];c&&(l.position=c)}r.push(l),a=1-a}return r}function JX(t,e){let i=YPe(t,e),r=t["1st"]||"",n=t["2nd"]||"";if(!r&&!n)return{winner:i,server:e,result:"Unknown"};let a=XX([r,n]),s={winner:i,server:e};a.result&&(s.result=a.result),a.serve&&(s.serve=a.serve);let o=a.serve===1?r:n,l=JPe(o);l&&(s.serveLocation=l);let u=a.rally[a.rally.length-1];if(u){let d=px(u);d&&(s.stroke=d,Object.values(zX).includes(d)?s.hand="Forehand":Object.values(qX).includes(d)&&(s.hand="Backhand"))}let c=QPe(a.serves,a.rally,e);return c.length>0&&(s.rally=c,s.rallyLength=c.length),a.code&&(s.code=a.code),s}function QX(t){if(!t||!ni(t))return[];let e=t.trim().split(`
`);if(e.length<2)return[];let i=e[0]?.split(",")||[],r=[];for(let n=1;n<e.length;n++){let a=e[n];if(!a)continue;let s=a.split(","),o={};for(let l=0;l<i.length;l++){let u=i[l];u&&(o[u]=s[l]||"")}r.push(o)}return r}function ZX(t){if(!Array.isArray(t))return[];let e=new Map;for(let i of t){let r=i.match_id;e.has(r)||e.set(r,[]),e.get(r).push(i)}return Array.from(e.entries()).map(([i,r])=>({match_id:i,points:r}))}function ZPe(t){let e=t?.split("-")||[];if(e.length<6)return{player1:"Player 1",player2:"Player 2"};let i=e[0],r=e[2]?.replace(/_/g," "),n=e[4]?.replace(/_/g," ")||"Player 1",a=e[5]?.replace(/_/g," ")||"Player 2";return{player1:n,player2:a,date:i,tournament:r}}function eEe(t){if(!t||t.length===0)return;let e=t.at(-1);if(!e)return;let i=e.Set1,r=e.Set2,n=e.Set3,a=e.Set4,s=e.Set5,o=[];return i&&o.push(`${i}-${r}`),n&&o.push(`${n}-${r||"0"}`),a&&o.push(`${a}-${r||"0"}`),s&&o.push(`${s}-${r||"0"}`),o.length>0?o.join(", "):void 0}function eJ(t,e={}){let{matchUpFormat:i,validateScore:r=!0,debug:n=!1}=e,a=[],s=[],o=ZPe(t.match_id),l=eEe(t.points),u,c=!1;i?u=i:l?(u=FC(l),c=!0,n&&console.log(`Deduced format: ${u} from score: ${l}`)):(u="SET3-S:6/TB7",c=!0,s.push("No format provided, using default SET3-S:6/TB7")),n&&(console.log(`Validating match: ${o.player1} vs ${o.player2}`),console.log(`Format: ${u}`),console.log(`Total points: ${t.points.length}`),l&&console.log(`Expected score: ${l}`));let d=ud({matchUpFormat:u,matchUpId:t.match_id});d.sides[0]&&(d.sides[0].participant={participantId:"player1",participantName:o.player1,participantType:"INDIVIDUAL",participantRole:"COMPETITOR"}),d.sides[1]&&(d.sides[1].participant={participantId:"player2",participantName:o.player2,participantType:"INDIVIDUAL",participantRole:"COMPETITOR"});let p=0,f=0,h=0,m=0,g=0,I,v=0;for(let S=0;S<t.points?.length;S++){let U=t.points[S];if(U){I=U.Svr==="1"?0:1;try{let T=JX(U,I),D={winner:T.winner,server:T.server};if(d=Sp(d,D),d.history?.points&&d.history.points.length>0){let P=d.history.points[d.history.points.length-1];P&&(T.result&&(P.result=T.result),T.stroke&&(P.stroke=T.stroke),T.hand&&(P.hand=T.hand),T.serve&&(P.serve=T.serve),T.serveLocation&&(P.serveLocation=T.serveLocation),T.rally&&(P.rally=T.rally),T.rallyLength&&(P.rallyLength=T.rallyLength),T.code&&(P.code=T.code))}if(v++,T.result==="Ace"&&p++,T.result==="Double Fault"&&f++,T.result==="Winner"&&h++,T.result==="Unforced Error"&&m++,T.result==="Forced Error"&&g++,n&&(S<5||S===t.points.length-1)){let P=Dd(d);console.log(`Point ${S+1}: ${T.result||"Rally"} â†’ ${P.scoreString}`)}}catch(T){let D=T instanceof Error?T.message:String(T);a.push(`Point ${S+1}: ${D}`),n&&console.error(`Point ${S+1} failed:`,D)}}}let w=Dd(d).scoreString,y=d.matchUpStatus==="COMPLETED";y||s.push(`Match not complete. Final score: ${w}`);let b;if(r&&l){let S=lz(l),U=lz(w);b=S===U,b||a.push(`Score mismatch: expected "${l}", got "${w}"`),n&&(console.log(`Expected: ${l} â†’ ${S}`),console.log(`Actual: ${w} â†’ ${U}`),console.log(`Score matches: ${b}`))}return n&&(console.log(`Final score: ${w}`),console.log(`Match complete: ${y}`),console.log(`Stats: ${p} aces, ${f} DFs, ${h} winners, ${m} UEs, ${g} FEs`)),{valid:a.length===0,errors:a,warnings:s,matchUp:d,pointsProcessed:v,expectedScore:l,actualScore:w,scoreMatches:b,formatDeduced:c,aces:p,doubleFaults:f,winners:h,unforcedErrors:m,forcedErrors:g}}function lz(t){return t.replace(/\s+/g,"").replace(/,/g,", ").toLowerCase()}function tEe(t){let{csvData:e,matchId:i,matchUpFormat:r,debug:n=!1}=t,a=[],s=[],o=[],l;try{l=QX(e)}catch(I){let v=I instanceof Error?I.message:String(I);return a.push(`Failed to parse CSV: ${v}`),{valid:!1,errors:a,warnings:s,matchesProcessed:0,pointsProcessed:0,matchUps:[],totalAces:0,totalDoubleFaults:0,totalWinners:0,totalUnforcedErrors:0,totalForcedErrors:0}}let u=ZX(l);n&&console.log(`Parsed ${l.length} points from ${u.length} matches`);let c=i?u.filter(I=>I.match_id===i):u;if(c.length===0)return a.push(i?`Match ID not found: ${i}`:"No matches found in CSV data"),{valid:!1,errors:a,warnings:s,matchesProcessed:0,pointsProcessed:0,matchUps:[],totalAces:0,totalDoubleFaults:0,totalWinners:0,totalUnforcedErrors:0,totalForcedErrors:0};let d=0,p=0,f=0,h=0,m=0,g=0;for(let I of c){let v=eJ(I,{matchUpFormat:r,debug:n});v.valid||a.push(...v.errors),s.push(...v.warnings),o.push(v.matchUp),d+=v.pointsProcessed,p+=v.aces,f+=v.doubleFaults,h+=v.winners,m+=v.unforcedErrors,g+=v.forcedErrors}return{valid:a.length===0,errors:a,warnings:s,matchesProcessed:c.length,pointsProcessed:d,matchUps:o,totalAces:p,totalDoubleFaults:f,totalWinners:h,totalUnforcedErrors:m,totalForcedErrors:g}}function iEe(t){return JSON.stringify(t,null,2)}function rEe(t){let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:s,isMock:o,event:l}=t,{tieFormat:u,matchUpFormat:c}=t;if(a===sr&&s===sr){let d=e?.structures?.find(({stage:p})=>p===Fe)?.tieFormat;u=u||d||n&&l?.tieFormat?.tieFormatName===n&&l.tieFormat||n&&hc({namedFormat:n,hydrateCollections:i,isMock:o,event:l})||l?.tieFormat||hc({event:l,isMock:o,hydrateCollections:i}),c=void 0}else c||(u=void 0,l?.matchUpFormat||(c=ac));if(u){let d=Hn({gender:l?.gender,enforceGender:r,tieFormat:u});if(d.error)return d}return{tieFormat:u,matchUpFormat:c}}function nEe(t){let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,qualifyingOnly:n,drawEntries:a,structureId:s,tieFormat:o,idPrefix:l,isMock:u,event:c}=t,d=t.qualifyingProfiles,p=d?.length?Z9({hasExistingDrawDefinition:!0,uuids:t.uuids,qualifyingProfiles:d,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,idPrefix:l,isMock:u}):void 0;if(p?.error)return p;e.structures=e.structures?.filter(({structureId:b})=>b!==i),e.links=e.links?.filter(({source:b})=>b.structureId!==i);let{qualifiersCount:f,qualifyingDrawPositionsCount:h,qualifyingDetails:m}=p??{};h&&(p?.structures&&e.structures?.push(...p.structures),p?.links&&e.links?.push(...p.links));let g=e.structures?.find(({stage:b,stageSequence:S})=>b===Fe&&S===1),{qualifiersCount:I}=wv({stageSequence:1,drawDefinition:e,structureId:s,stage:Fe}),v=Math.max(f??0,I??0),w=n9({qualifiersCount:v,drawDefinition:e,stage:Fe});if(w.error||(w=UP({drawSize:h,stage:We,drawDefinition:e}),w.error))return w;aEe({drawDefinition:e,drawEntries:a,event:c});let y=sEe({mainStructure:g,qualifyingDetails:m,drawDefinition:e});return y.error?y:{drawDefinition:e,structureId:s}}function aEe({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===We)){let n={...r,entryStage:r.entryStage??Fe,drawDefinition:t,event:i};qL(n)}}function sEe({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){for(let r of e||[]){let{finalQualifyingRoundNumber:n,finalQualifyingStructureId:a,roundTarget:s,finishingPositions:o,linkType:l}=r,u=t&&xS({targetStructureId:t.structureId,sourceStructureId:a,sourceRoundNumber:n,finishingPositions:o,targetEntryRound:s,linkType:l})?.link;if(u?.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function tJ(t){let{participantIds:e}=t,i=t.drawDefinition?.entries?.filter(r=>{let n=r.entryStatus;return!t.restrictEntryStatus||co.includes(n)}).map(bt)??[];if(e){let r=e.filter(n=>!i?.includes(n));if(r?.length)return z({result:{error:No},info:{invalidParticipantIds:r}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:ie,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:ie,info:"roundsCount must be less than 32"}:{participantIds:e}}function l_(t){let e=[],{roundsCount:i=1,drawDefinition:r,matchUpsCount:n,structureId:a,idPrefix:s,isMock:o,event:l}=t,u,c=tJ(t);if(c.error)return c;for(let d of Re(1,i+1)){let p=TC({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:r,matchUpsCount:n,structureId:a,roundNumber:u,idPrefix:s,isMock:o,event:l});if(p.error)return z({result:p,info:{iteration:d}});p.matchUps?.length&&e.push(...p.matchUps),u=(p?.roundNumber??1)+1}return{matchUps:e}}function oEe(t){let{tournamentRecord:e,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=t,s=t.scaleAccessor??Pr[r]?.accessor,o=e.participants??[];for(let l of i??[]){let u=o?.find(d=>d.participantId===l),c=uz({scaleName:`${r}.${rL}`,participant:u,eventType:n});!c&&r&&(c=uz({scaleAccessor:s,participant:u,scaleName:r,eventType:n})),c&&!a[l]&&(a[l]=c)}return a}function uz({scaleType:t=fd,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){let a=(i&&Zl({scaleAttributes:{eventType:n??Oh,scaleType:t,scaleName:r},participant:i}))?.scaleItem?.scaleValue;return e&&St(a)?a[e]:a}function u_(t){let e=uEe(t);if(e?.error)return e;let i=tJ(t);if(i.error)return i;let r=lEe(t);if(r.error)return r;let n=oEe(t),a=t.tournamentRecord?.isMock??t.isMock,s=t.eventType??t.event?.eventType,o=[],l=[],u;for(let c of Re(1,(t.roundsCount??1)+1)){let d=$0({...t,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:o,adHocRatings:n,roundNumber:u,eventType:s,isMock:a});if(d.error)return d;let{matchUps:p,...f}=d;f.modifiedScaleValues&&(n=f.modifiedScaleValues),l.push({...f,iteration:c,matchUpsCount:p?.length}),u=(f?.roundNumber??1)+1,p?.length&&o.push(...p)}return{...H,matchUps:o,roundResults:l}}function lEe(t){if(t.structureId)return t.structureId;let e=t.drawDefinition,i=e?.structures?.filter(n=>n.stageSequence===1)?.reduce((n,a)=>{let s=a.stage&&xh[a.stage];return Wn({structure:a})&&s>(xh[n?.stage]||1)?a:n},void 0),r=e?.structures?.find(n=>n.structureId===i?.structureId);return r?Wn({structure:r})?{structure:r}:{error:uh}:{error:vi}}function uEe(t){return t.roundsCount&&typeof t.roundsCount!="number"?{error:ie,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==ca?{error:uh}:!Array.isArray(t.drawDefinition?.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:ie,info:"Missing Entries"}:{error:void 0}}function cEe(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:s}=t,o=s?.entries?.filter(({entryStage:c,entryStatus:d})=>(!c||c===Fe)&&d&&co.includes(d)),l=o?.map(bt),u=o?Math.floor(o.length/2):0;if(t.automated)return dEe({...t,participantIds:l});{let c=l_({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:u,idPrefix:n,isMock:a,event:s});if(c.error)return c;c.matchUps?.length&&yC({matchUps:c.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:r,event:s})}return{...H}}function dEe(t){let{restrictEntryStatus:e,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:s}=t.drawMatic??{},o=u_({...t,eventType:t.drawMatic?.eventType??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:s??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:r,matchUpIds:n});return o.error?o:(o?.matchUps?.length&&yC({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:o.matchUps,event:t.event,structureId:r}),{...H})}function pEe({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,seedsCount:u}){r=r??n;let c=et({drawDefinition:s,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:vi};let{positionAssignments:p}=cr({structure:d}),f=p?.length||0;if(u>f)return{error:p4};let h=d.structures?.length,m=ut(o?.groupSeedingThreshold)&&o?.groupSeedingThreshold,g=i0({roundRobinGroupsCount:h,drawSize:f})?.seedGroups,{seedsCount:I}=WS({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:f});return I&&a?.[yo]&&u>I&&e&&(u=I),d.seedLimit=u,d.seedAssignments=Re(1,u+1).map(v=>{let w=g?.find(S=>S.includes(v)),y=w&&Math.min(...w),b=m&&v>=m?y:v;return{participantId:void 0,seedNumber:v,seedValue:b}}),ii({drawDefinition:s,structureIds:[l]}),{...H,seedLimit:u}}function km({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:s,stage:o}){if(!e)return{error:ge};a=a??s?.entries??[];let l=a.filter(f=>(!o||!f.entryStage||f.entryStage===o)&&(!n||!f.entryStageSequence||f.entryStageSequence===n)&&co.includes(f.entryStatus)),u={...i};return{scaledEntries:l.map(f=>{let{participantId:h}=f,{scaleItem:m}=Bh({tournamentRecord:e,scaleAttributes:i,participantId:h});return{...f,...m}}).filter(f=>{let h=f.scaleValue;return!r&&(Number.isNaN(h)||!Number.parseFloat(h))?!1:h}).sort(r||(t||u?.ascending===!1?d:c))};function c(f,h){return p(f)-p(h)}function d(f,h){return p(h)-p(f)}function p(f){return Number.parseFloat(f.scaleValue||(t?-1:1e5))}}function iJ(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=to({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r?.find(({structureId:f})=>!n.includes(f));if(!a)return z({result:{error:vi},stack:e});let s=a?.structureId,{seedsCount:o,stageEntries:l,seedLimit:u}=bEe({...t,structureId:s});(t.seededParticipants||t.event||t.seedingScaleName)&&mEe({...t,seedsCount:o,structure:a,structureId:s});let c=t.automated!==!1&&t.drawType!==ca&&!(t.qualifyingOnly&&t.stage!==We),d=(r?.length||0)>1,p=c?hEe({...t,multipleStructures:d,seedLimit:u,structureId:s}):{};return p?.error?z({result:p,stack:e}):{...p,stageEntries:l,structureId:s,seedsCount:o}}function fEe({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{let a=it({name:Al,element:n})?.extension?.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!a||a===r)&&hf.includes(n.entryStatus)})}function hEe(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=OS({...t,seedsOnly:e});if(i.error)return i;let r=i?.positionAssignments,n=i?.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function mEe(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(bt);e?gEe({...t,enteredParticipantIds:a}):(n||i)&&IEe({...t,enteredParticipantIds:a})}function gEe(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,structure:u,event:c}=t,d=u?Rm({provisionalPositioning:e,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structure:u}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,f)=>p.seedNumber<f.seedNumber?-1:p.seedNumber<f.seedNumber?1:0).forEach(p=>{let{participantId:f,seedNumber:h,seedValue:m}=p;Uv({provisionalPositioning:e,tournamentRecord:n,drawDefinition:s,seedingProfile:o,participantId:f,seedBlockInfo:d,structureId:l,seedNumber:h,seedValue:m,event:c})})}function IEe(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:s,drawDefinition:o,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:f}=d?.category||{};d?.eventType;let h=vEe({...t})||l&&yEe({...t}),m=h?.length??0;m<e&&(e=m),h?.filter(({participantId:g})=>r.includes(g)).slice(0,a||e).forEach((g,I)=>{let v=I+1,{participantId:w,scaleValue:y}=g,b=n?.[v]||y||v;Uv({provisionalPositioning:i,tournamentRecord:s,drawDefinition:o,seedingProfile:u,participantId:w,structureId:c,seedNumber:v,seedValue:b,event:d})})}function vEe(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:s}=t,{categoryName:o,ageCategoryCode:l}=s?.category||{},u=s?.eventType,c={scaleName:i||o||l||s.eventId,scaleType:Jl,eventType:u};return km({scaleAttributes:c,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function yEe(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:s,ageCategoryCode:o}=r?.category||{},l=r?.eventType;return km({scaleAttributes:{scaleName:s||o,scaleType:Iu,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function bEe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=fEe(t);e>i.length&&(e=i.length);let{seedLimit:r}=pEe({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function wEe(t){let e=L0({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:s,seedingProfile:o,participants:l,drawEntries:u,placeByes:c,drawSize:d,drawType:p,entries:f}=t,h=[],m=[],g=SEe({ignoreStageSpace:n,drawDefinition:i,drawEntries:u,drawType:p,entries:f});if(g.error)return g;let I=p===uf?0:Ye(t.seedsCount??0),v=iJ({...t,qualifyingOnly:!d||s,appliedPolicies:a,drawDefinition:i,seedingProfile:o,participants:l,stage:Fe,seedsCount:I,placeByes:c,drawSize:d,entries:f});if(v.error&&!v.conflicts)return v;v.positioningReport?.length&&h.push({[Fe]:v.positioningReport});let w=v.structureId;return v.conflicts&&(m=v.conflicts),p===ca&&t.roundsCount&&cEe({...t,drawDefinition:i,structureId:w}),{drawDefinition:i,positioningReports:h,conflicts:m,structureId:w}}function SEe(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let s of a){if(r&&s.entryStage&&s.entryStage!==Fe)continue;let o={...s,ignoreStageSpace:e??n===ca,entryStage:s.entryStage??Fe,event:t.event,drawDefinition:i,drawType:n},l=qL(o);if(r&&l.error)return l}return{error:void 0}}var UEe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),TEe=UEe;function DEe(t){let{drawId:e=Pt(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=TEe();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function c_(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:s,event:o}=t,l=Ge(t,[{[mn]:!0,[J1]:!0}]);if(l.error)return l;if(!Ga({matchUpFormat:n}))return{error:zw};let u="setMatchUpFormat";if(s){let c=pi({drawDefinition:r,matchUpId:s,event:o});if(c.error)return c;let d=c.matchUp;if(d?.matchUpType===sr)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:la};d&&(d.matchUpFormat=n,Tt({tournamentId:i?.tournamentId,eventId:o?.eventId,context:u,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if(o?.eventType===sr)return{error:uu};for(let c of e){let d=et({drawDefinition:r,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if(o?.eventType===sr)return{error:uu};let c=et({drawDefinition:r,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),ii({drawDefinition:r,structureIds:e}),{...H}}function PEe({tieFormat:t}){let e=Hn({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Pt());return{tieFormat:t}}function EEe({existingQualifyingStructures:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUpType:n,tieFormat:a,event:s}){if((r||a)&&!(r&&s?.matchUpFormat===r||s?.tieFormat&&a&&JSON.stringify(s.tieFormat)===JSON.stringify(a))){if(a){let o=PEe({tieFormat:a});if(o.error)return o;let l=t?.every(u=>u.tieFormat);(!t?.length||l)&&(i.tieFormat=o.tieFormat??a)}else if(r){let o=c_({tournamentRecord:e,drawDefinition:i,matchUpFormat:r,event:s});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(i.matchUpType=n)}return{error:void 0}}var rJ={};pt(rJ,{attachPolicies:()=>$p,findPolicy:()=>pf,getAppliedPolicies:()=>Rt,getPolicyDefinitions:()=>jc,mutate:()=>nJ,query:()=>sJ,removePolicy:()=>aJ});var nJ={};pt(nJ,{attachPolicies:()=>$p,removePolicy:()=>aJ});function aJ(t){let e=Ge(t,[{[Kve]:!0,_anyOf:{[dn]:!1,[mr]:!1,[mn]:!1,[$c]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return cz(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ge};for(let a of n){let s=t.tournamentRecords[a],o=cz(t,s);if(o.error)return o;i=!0}}else return{error:ge};return i?{...H}:{error:qw}}function cz(t,e){let i=Rt(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?gt({element:e,extension:{name:Bb,value:i}}):Mn({element:e,name:Bb}),{...H}):{error:qw}}var sJ={};pt(sJ,{findPolicy:()=>pf,getAppliedPolicies:()=>Rt,getPolicyDefinitions:()=>jc});var REe={[yo]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[mu]:{positioning:Np},[Zs]:{positioning:Np}},positioning:M5},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},fx=REe;function CEe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return z({info:"policyDefinitions must be an object",result:{error:ie},stack:r});let n={[uP]:t?.[uP]};return e?MEe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&$p({drawDefinition:i,policyDefinitions:n}),!t?.[yo]&&!e?.[yo]&&($p({policyDefinitions:fx,drawDefinition:i}),t&&Object.assign(t,fx)),{error:void 0}}function MEe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e?.[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&($p({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function NEe(t){let{tournamentRecord:e,policyDefinitions:i,appliedPolicies:r,matchUpFormat:n,matchUpType:a,tieFormat:s,drawType:o,stack:l,event:u}=t,c=t.drawId?u?.drawDefinitions?.find(I=>I.drawId===t.drawId):void 0,d=c?.structures?.find(I=>I.stage===Fe&&I.stageSequence===1)?.structureId,p=c?c.structures?.filter(I=>I.stage===We):[],f=p?.length===1&&!p[0].matchUps?.length&&p[0].structureId;c&&o!==c.drawType&&(c.drawType=o);let h=c??DEe({processCodes:t.processCodes,drawId:t.drawId,drawType:o}),m=EEe({existingQualifyingStructures:p,tournamentRecord:e,drawDefinition:h,matchUpFormat:n,matchUpType:a,tieFormat:s,event:u});if(m.error)return z({result:m,stack:l});let g=CEe({appliedPolicies:r,policyDefinitions:i,drawDefinition:h,stack:l});return g.error?g:{drawDefinition:h,structureId:d,existingDrawDefinition:c,existingQualifyingPlaceholderStructureId:f}}function AEe(t){let e="generateOrGetExisting",i=[],r=[],n=NEe(t);if(n.error)return z({result:n,stack:e});let a=n.existingDrawDefinition,s,o,l=t.drawEntries??t.eventEntries??[],u=n.existingQualifyingPlaceholderStructureId&&nEe({...t,...n})||wEe({...t,...n,entries:l});return u.error?z({result:u,stack:e}):(u.positioningReports?.length&&i.push(...u.positioningReports??[]),u.conflicts?.length&&r.push(...u.conflicts??[]),s=u.drawDefinition,o=u.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:s,structureId:o,conflicts:r,entries:l})}function kEe(t){let{qualifyingPlaceholder:e,existingDrawDefinition:i,positioningReports:r,qualifyingProfiles:n,appliedPolicies:a,qualifyingOnly:s,drawDefinition:o,seedingProfile:l,participants:u,structureId:c,tieFormat:d,entries:p,stack:f}=t,h=e&&!n?.length&&!i,m=[];if(n){let g=(y,b)=>y.stageSequence-b.stageSequence,I=(y,b)=>y.roundTarget-b.roundTarget,v=[],w=1;n.sort(I);for(let y of n){if(!Array.isArray(y.structureProfiles))return z({info:_p("structureProfiles"),result:{error:Xe},stack:f});w=y.roundTarget||w;let b=y.structureProfiles?.sort(g)||[],S=1;for(let U of b){let{qualifyingRoundNumber:T,qualifyingPositions:D,seededParticipants:P,seedingScaleName:E,seedsCount:R=0,seedByRanking:C,placeByes:M,drawSize:N}=U,A=iJ({...t,seedingProfile:U.seedingProfile??l,stageSequence:S,qualifyingRoundNumber:T,preparedStructureIds:v,qualifyingPositions:D,seededParticipants:P,stage:We,seedingScaleName:E,appliedPolicies:a,drawDefinition:o,qualifyingOnly:s,seedByRanking:C,participants:u,roundTarget:w,seedsCount:R,placeByes:M,drawSize:N,entries:p});if(A.error)return A;A.structureId&&v.push(A.structureId),S+=1,A.conflicts?.length&&m.push(...A.conflicts),A.positioningReport?.length&&r.push({[We]:A.positioningReport})}w+=1}}else if(c&&h){let g=ls({structureName:Jr(We),stage:We,qualifyingOnly:s,tieFormat:d}),{link:I}=xS({sourceStructureId:g.structureId,targetStructureId:c,sourceRoundNumber:0,linkType:pu});o.structures||(o.structures=[]),o.structures.push(g),o.links||(o.links=[]),o.links.push(I)}return{qualifyingConflicts:m,error:void 0}}var oJ={};pt(oJ,{addGoesTo:()=>Lp,allCompetitionMatchUps:()=>Oo,allDrawMatchUps:()=>Nn,allEventMatchUps:()=>Lu,allPlayoffPositionsFilled:()=>u0,allTournamentMatchUps:()=>wr,analyzeDraws:()=>VS,analyzeMatchUp:()=>Kb,analyzeTournament:()=>w_,bulkUpdatePublishedEventIds:()=>P_,calculateWinCriteria:()=>Om,categoryCanContain:()=>Zw,checkMatchUpIsComplete:()=>bp,checkValidEntries:()=>UC,cleanExpiredMutationLocks:()=>I_,compareTieFormats:()=>Tc,competitionScheduleMatchUps:()=>XS,courtGridRows:()=>WC,credits:()=>OEe,drawMatchUps:()=>B_,eventMatchUps:()=>YC,filterMatchUps:()=>Qu,filterParticipants:()=>CS,findDrawDefinition:()=>N0,findExtension:()=>it,findVenue:()=>po,getAggregateTeamResults:()=>b_,getAllDrawMatchUps:()=>rr,getAllEventData:()=>E_,getAllStructureMatchUps:()=>kt,getAllowedDrawTypes:()=>LC,getAllowedMatchUpFormats:()=>g_,getAppliedPolicies:()=>Rt,getAssignedParticipantIds:()=>If,getAvailableMatchUpsCount:()=>bC,getAvailablePlayoffProfiles:()=>LS,getCategoryAgeDetails:()=>Mp,getCheckedInParticipantIds:()=>Um,getCompetitionDateRange:()=>$C,getCompetitionMatchUps:()=>Yb,getCompetitionParticipants:()=>d_,getCompetitionPenalties:()=>v_,getCompetitionVenues:()=>jS,getCourtInfo:()=>iC,getCourts:()=>V_,getDrawData:()=>wC,getDrawDefinitionTimeItem:()=>EL,getDrawParticipantRepresentativeIds:()=>C0,getDrawStructures:()=>to,getDrawTypeCoercion:()=>HS,getEligibleVoluntaryConsolationParticipants:()=>R0,getEntriesAndSeedsCount:()=>zC,getEvent:()=>H_,getEventData:()=>GS,getEventMatchUpFormatTiming:()=>N_,getEventProperties:()=>j_,getEventPublishStatus:()=>Oa,getEventStructures:()=>dC,getEventTimeItem:()=>fS,getEvents:()=>G_,getFlightProfile:()=>Bi,getHomeParticipantId:()=>x_,getLinkedTournamentIds:()=>uS,getMatchUpCompetitiveProfile:()=>SS,getMatchUpContextIds:()=>F_,getMatchUpDailyLimits:()=>XC,getMatchUpDailyLimitsUpdate:()=>A_,getMatchUpDependencies:()=>fo,getMatchUpFormat:()=>L_,getMatchUpFormatTiming:()=>US,getMatchUpFormatTimingUpdate:()=>M_,getMatchUpScheduleDetails:()=>rC,getMatchUpType:()=>nC,getMatchUpsMap:()=>Or,getMatchUpsStats:()=>__,getMatchUpsToSchedule:()=>VC,getMaxEntryPosition:()=>C_,getModifiedMatchUpFormatTiming:()=>qC,getMutationLocks:()=>T_,getPairedParticipant:()=>io,getParticipantEventDetails:()=>p_,getParticipantIdFinishingPositions:()=>M0,getParticipantMembership:()=>f_,getParticipantResults:()=>RS,getParticipantScaleItem:()=>Bh,getParticipantSchedules:()=>h_,getParticipantSignInStatus:()=>m_,getParticipantTimeItem:()=>RL,getParticipants:()=>Pi,getPersonRequests:()=>vf,getPolicyDefinitions:()=>jc,getPositionAssignments:()=>vI,getPositionsPlayedOff:()=>Dv,getPredictiveAccuracy:()=>O_,getProfileRounds:()=>HC,getPublishState:()=>Pm,getRandomQualifierList:()=>O0,getRoundMatchUps:()=>wn,getRounds:()=>$_,getScaleValues:()=>fv,getScaledEntries:()=>km,getScheduledRoundsDetails:()=>qS,getSchedulingProfile:()=>Wc,getSchedulingProfileIssues:()=>R_,getSeedingThresholds:()=>r0,getSeedsCount:()=>WS,getStructureSeedAssignments:()=>ms,getTeamLineUp:()=>Fp,getTieFormat:()=>BC,getTimeItem:()=>Ss,getTournamentIds:()=>oS,getTournamentInfo:()=>Am,getTournamentPenalties:()=>_C,getTournamentPersons:()=>y_,getTournamentPoints:()=>Ev,getTournamentPublishStatus:()=>bv,getTournamentStructures:()=>l0,getTournamentTimeItem:()=>XR,getValidGroupSizes:()=>AS,getVenueData:()=>mI,getVenuesAndCourts:()=>_u,isAdHoc:()=>Wn,isCompletedStructure:()=>yu,isValidForQualifying:()=>x0,isValidMatchUpFormat:()=>Ga,matchUpActions:()=>SC,participantScaleItem:()=>Zl,participantScheduledMatchUps:()=>k_,positionActions:()=>k0,publicFindCourt:()=>$L,publicFindVenue:()=>_L,tallyParticipantResults:()=>Dm,tieFormatGenderValidityCheck:()=>TR,tournamentMatchUps:()=>KC,validMatchUp:()=>JR,validMatchUps:()=>Ja,validateCollectionDefinition:()=>eS,validateLineUp:()=>cC});function OEe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Miro, Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var lJ={};pt(lJ,{filterParticipants:()=>CS,getCompetitionParticipants:()=>d_,getPairedParticipant:()=>io,getParticipantEventDetails:()=>p_,getParticipantMembership:()=>f_,getParticipantScaleItem:()=>Bh,getParticipantSchedules:()=>h_,getParticipantSignInStatus:()=>m_,getParticipantTimeItem:()=>RL,getParticipants:()=>Pi,getScaleValues:()=>fv,participantScaleItem:()=>Zl,validateLineUp:()=>cC});function d_(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Ri};let i=[],r={},n={},a={},s=[],o={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:f,matchUps:h,derivedEventInfo:m,derivedDrawInfo:g}=Pi({...t,tournamentRecord:u});Object.assign(o,d),Object.assign(r,p),Object.assign(n,m),Object.assign(a,g),i.push(...f??[]),s.push(...h??[]),c?.forEach(I=>{l.includes(I)||l.push(I)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:o,participants:i,...H,matchUps:s}}function p_({tournamentRecord:t,participantId:e}){if(!t)return{error:ge};if(!e)return{error:ur};let i=[e].concat((t.participants??[]).filter(r=>r?.participantType&&[_t,ht].includes(r.participantType)&&r.individualParticipantIds?.includes(e)).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=(r?.entries??[]).map(a=>a.participantId);return Ln(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function f_({tournamentRecord:t,participantId:e}){if(!t)return{error:ge};if(!e)return{error:ur};let{participants:i}=Pi({participantFilters:{participantTypes:[_t,ht,Xa]},tournamentRecord:t});return(i??[]).filter(r=>r.individualParticipantIds?.includes(e)).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function h_({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:ge};if(typeof t!="object")return{error:_c,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=wr({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),s=fo({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],o={};for(let l of a){let{sides:u}=l,c,d=u?.map(f=>{if(f.participant)return[f.participant].concat(...f.participant.individualParticipants||[]);s[l.matchUpId]&&!c&&(c=(s[l.matchUpId]||[]).map(h=>n[h]).filter(({winningSide:h,bye:m})=>!h&&!m))}).filter(Boolean).flat()??[];for(let f of d){let{participantId:h}=f;o[h]||(o[h]={potentialMatchUps:[],participant:f,matchUps:[]}),o[h].matchUps.push(l)}let p=c?.map(({sides:f})=>f).flat().map(({participant:f})=>f&&[f].concat(...f.individualParticipants||[])).filter(Boolean).flat()||[];for(let f of p){let{participantId:h}=f;o[h]||(o[h]={potentialMatchUps:[],participant:f,matchUps:[]}),o[h].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(o).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...H}}function m_({tournamentRecord:t,participantId:e}){if(!t)return{error:ge};if(!e)return{error:ur};let{participant:i}=Wd({tournamentRecord:t,participantId:e});if(!i)return{error:ji};let{timeItem:r}=Ss({itemType:pS,element:i});return r&&r.itemValue===Vb&&Vb}var uJ={};pt(uJ,{analyzeDraws:()=>VS,analyzeTournament:()=>w_,cleanExpiredMutationLocks:()=>I_,getAggregateTeamResults:()=>b_,getAllowedDrawTypes:()=>LC,getAllowedMatchUpFormats:()=>g_,getAppliedPolicies:()=>Rt,getCompetitionDateRange:()=>$C,getCompetitionPenalties:()=>v_,getMutationLocks:()=>T_,getPolicyDefinitions:()=>jc,getTournamentInfo:()=>Am,getTournamentPenalties:()=>_C,getTournamentPersons:()=>y_,getTournamentPoints:()=>Ev,getTournamentStructures:()=>l0,getTournamentTimeItem:()=>XR});function g_({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:ge};let{appliedPolicies:r}=Rt({tournamentRecord:t});return(r?.[ko]?.matchUpFormats||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function LC({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:ge};let{appliedPolicies:r}=Rt({tournamentRecord:t});return(r?.[cP]?.allowedDrawTypes||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function I_(t){let{tournamentRecord:e}=t;if(!e)return{error:ge};let i=new Date().toISOString(),r=0,n=o=>{let{extension:l}=it({element:o,name:Pn});if(!l?.value?.locks?.length)return;let u=l.value,c=u.locks.length;u.locks=u.locks.filter(p=>p.expiresAt===null||p.expiresAt>i);let d=c-u.locks.length;d>0&&(r+=d,gt({element:o,extension:{name:Pn,value:u},creationTime:!1}))};n(e);let a=e.events??[];for(let o of a){n(o);let l=o.drawDefinitions??[];for(let u of l)n(u)}let s=e.venues??[];for(let o of s)n(o);return{...H,removedCount:r}}function _C({tournamentRecord:t}){if(!t)return{error:ge};let e=(t?.participants??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:s}=a||{};i[s]?i[s].participants.push(n):i[s]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function v_({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ri};let e=[];for(let i of Object.values(t)){let{penalties:r}=_C({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function $C({tournamentRecords:t}){if(!St(t))return{error:Ri};let e=Object.keys(t??{}).reduce((n,a)=>{let s=t[a],{tournamentInfo:{startDate:o,endDate:l}}=Am({tournamentRecord:s}),u=o&&Qe(o),c=u&&new Date(u);(!n.startDate||c&&c<n.startDate)&&(n.startDate=c);let d=l&&Qe(l),p=d&&new Date(d);return(!n.endDate||p&&p>n.endDate)&&(n.endDate=p),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&Qe(e.startDate.toISOString()),r=e.endDate&&Qe(e.endDate.toISOString());return!i||!r?{error:O4}:{startDate:i,endDate:r}}function y_({tournamentRecord:t,participantFilters:e}){if(!t)return{error:ge};let i=t.participants||[];e&&(i=CS({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:s}=a.person;r[s]?r[s].participantIds.push(a.participantId):r[s]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function b_(t){let e=Ge(t,[{[mr]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},r={},n=d=>{let p=d?.individualParticipants?.map(f=>f.teams?.length===1&&f.teams[0]);return d?.teams?.length===1&&d?.teams?.[0]||p?.[0].participantId===p?.[1].participantId&&p?.[0]},{matchUps:a,participants:s}=Pi({participantFilters:{participantTypes:[vt]},withRankingProfile:!0,withStatistics:!0,...t});for(let d of s??[]){if(d.participantType===jn)continue;d.draws?.[0]?.drawId==="draw-0-3"&&console.log(d.participantType,d.draws[0].finishingPositionRange);let p=n(d);if(p)for(let f of d?.draws??[]){let h=f?.finishingPositionRange?.join("-");if(h&&i?.[h]){let m=p?.participantId,g=f?.drawId,I=`${m}|${g}|${h}`;r[I]=i[h]}}}let o=d=>({teamName:d,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(d,p,f)=>{d[p]===void 0&&(d[p]=0),d[p]+=f},u={},c={};for(let d of a??[]){let{sides:p,matchUpFormat:f}=d,h=f&&Ki(f);if(p?.length===2&&h.setFormat?.timed&&(!h.finalSetFormat||h.finalSetFormat?.timed))for(let m of p){let g=n(m.participant),I=g?.participantId,v=m.participant?.participantId,w=g?.participantName,y=m.sideNumber,b=m.participant?.individualParticipantIds||v&&[v]||[];if(b.forEach(S=>{S&&!u[S]&&(u[S]=o(w))}),I&&y){c[I]||(c[I]=o(w));let S=[...b.map(T=>u[T]),c[I]];d.winningSide&&(y===d.winningSide?S.forEach(T=>l(T,"win",1)):S.forEach(T=>l(T,"loss",1)));let U=d.score?.sets||[];for(let T of U){let D=T?.[`side${3-y}Score`]||0,P=T?.[`side${y}Score`]||0,E=P-D;S.forEach(R=>l(R,"pointsPlayed",P+D)),S.forEach(R=>l(R,"points",P)),S.forEach(R=>l(R,"diff",E))}}}}for(let d of Object.keys(r)){let[p]=d.split("|");c[p]&&(c[p].bonus+=r[d],c[p].pointsPct=parseFloat((c[p].points/c[p].pointsPlayed).toFixed(2)),c[p].standingPoints=c[p].win+c[p].bonus)}for(let d of Object.keys(u))u[d].pointsPct=parseFloat((u[d].points/u[d].pointsPlayed).toFixed(2));return{...H,individualResults:u,teamResults:c}}function xEe(t){let e=t.participants?.filter(({participantType:a})=>a===_t)?.length===2,i=t.events?.length===1&&t.events[0],r=i?.drawDefinitions?.length===1&&i.drawDefinitions[0],n=(r?.structures?.length===1&&r.structures[0])?.positionAssignments?.length===2;return!!(i.tieFormat&&e&&n)}function w_({tournamentRecord:t}){if(!t)return{error:ge};let{drawsAnalysis:e}=VS({tournamentRecord:t}),i={isDual:xEe(t),drawsAnalysis:e},r=Pi({tournamentRecord:t});return r.missingParticipantIds?.length&&(i.missingParticipantIds=r.missingParticipantIds),{...H,analysis:i}}function Og(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function S_({qualityWinProfiles:t,wonMatchUpIds:e,mappedMatchUps:i,participantSideMap:r,tournamentParticipants:n,tournamentStartDate:a,level:s}){let o=0,l=[],u={};for(let c of n)u[c.participantId]=c;for(let c of t){let{rankingScaleName:d,rankingSnapshot:p="latestAvailable",includeWalkovers:f=!1,rankingRanges:h=[],maxBonusPerTournament:m,unrankedOpponentBehavior:g="noBonus"}=c,I=0;for(let v of e){let w=i[v];if(!w)continue;let{matchUpStatus:y,sides:b=[],winningSide:S}=w;if(!f&&(y===mi||y===Zt))continue;let U=r[v];if(!U||S!==U)continue;let T=b.find(R=>R.sideNumber!==U)?.participantId;if(!T)continue;let D=u[T];if(!D)continue;let P=FEe({participant:D,rankingScaleName:d,rankingSnapshot:p,tournamentStartDate:a});if(!P){if(g==="noBonus")continue;continue}let E=h.find(R=>P>=R.rankRange[0]&&P<=R.rankRange[1]);if(E){let R;if(typeof E.value=="number")R=E.value;else if(typeof E.value=="object"){let C=Og(s,E.value.level??E.value);typeof C=="number"&&(R=C)}R&&(I+=R,l.push({opponentParticipantId:T,opponentRank:P,points:R,matchUpId:v}))}}m!==void 0&&I>m&&(I=m),o+=I}return{qualityWinPoints:o,qualityWins:l}}function FEe({participant:t,rankingScaleName:e,rankingSnapshot:i,tournamentStartDate:r}){let n=(t.timeItems||[]).filter(o=>{if(!o?.itemType)return!1;let l=o.itemType.split(".");return l[0]===vd&&l[1]===Iu&&l[3]===e});if(!n.length)return;let a=n;if(i==="tournamentStart"&&r){let o=new Date(r).getTime();a=n.filter(l=>(l.itemDate?new Date(l.itemDate).getTime():0)<=o)}if(!a.length)return;a.sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0));let s=a[a.length-1]?.itemValue;return typeof s=="number"?s:void 0}var LEe="RANKING_POINTS",_Ee="QUALITY_WIN",$Ee="fullToEach",cJ="splitEven",BEe="teamOnly",dJ=["ageCategoryCodes","genders","categoryNames","categoryTypes","ratingTypes","ballTypes","wheelchairClasses","subTypes"],pJ=["eventTypes","drawTypes","drawSizes","maxDrawSize","stages","stageSequences","levels","maxLevel","flights","maxFlightNumber","participationOrder","dateRanges"],VEe={RANKING_POINTS:LEe,QUALITY_WIN:_Ee,FULL_TO_EACH:$Ee,SPLIT_EVEN:cJ,TEAM_ONLY:BEe,CATEGORY_SCOPE_FIELDS:dJ,PROFILE_SCOPE_FIELDS:pJ};function U_(t){let{participation:e={},awardProfiles:i,wheelchairClass:r,startDate:n,eventType:a,drawSize:s,drawType:o,category:l,endDate:u,gender:c,level:d}=t,{participationOrder:p,flightNumber:f,rankingStage:h}=e,m=b=>!n&&!u||!b.dateRanges?!0:b.dateRanges.some(S=>{let U=!n||!S.startDate||new Date(n)>new Date(S.startDate),T=!u||!S.endDate||new Date(u)<=new Date(S.endDate);return U&&T}),g=b=>{if(!b)return!0;let S=l||{};return!(b.ageCategoryCodes?.length&&!b.ageCategoryCodes.includes(S.ageCategoryCode)||b.genders?.length&&!b.genders.includes(c)||b.categoryNames?.length&&!b.categoryNames.includes(S.categoryName)||b.categoryTypes?.length&&!b.categoryTypes.includes(S.type)||b.ratingTypes?.length&&!b.ratingTypes.includes(S.ratingType)||b.ballTypes?.length&&!b.ballTypes.includes(S.ballType)||b.wheelchairClasses?.length&&!b.wheelchairClasses.includes(r)||b.subTypes?.length&&!b.subTypes.includes(S.subType))},I=b=>m(b)&&(!b.maxFlightNumber||f<=b.maxFlightNumber)&&(!b.drawTypes?.length||b.drawTypes?.includes(o))&&(!b.drawSizes?.length||b.drawSizes.includes(s))&&(!b.stages?.length||b.stages.includes(h))&&(!b.levels?.length||b.levels.includes(d))&&(!b.maxDrawSize||s<=b.maxDrawSize)&&(!b.drawSize||b.drawSize===s)&&(!b.maxLevel||d<=b.maxLevel)&&(!f||!b.flights?.flightNumbers?.length||b.flights.flightNumbers.includes(f))&&(!b.participationOrder||b.participationOrder===p)&&g(b.category)&&(!b.eventTypes?.length||b.eventTypes?.includes(a)),v=i.filter(I);if(v.length===0)return{awardProfile:void 0};if(v.length===1)return{awardProfile:v[0]};let w=v.filter(b=>b.priority!==void 0);if(w.length){let b=Math.max(...w.map(S=>S.priority));return{awardProfile:w.find(S=>S.priority===b)}}let y=v.map((b,S)=>({profile:b,score:jEe(b),index:S}));return y.sort((b,S)=>S.score-b.score||b.index-S.index),{awardProfile:y[0].profile}}function jEe(t){let e=0;for(let i of pJ){let r=t[i];if(r!=null){if(Array.isArray(r)&&r.length===0)continue;e+=1}}if(t.category)for(let i of dJ){let r=t.category[i];Array.isArray(r)&&r.length>0&&(e+=1)}return e}function CP({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){let s=(h,m)=>{if(h){if(Array.isArray(m)){let g=m.find(I=>I.flight===h||I.f===h);return g.value||g.v}if(typeof m=="object"){let g=m.flights||m.f;if(Array.isArray(g))return g[h-1]}}},o=(h,m)=>{let g=h?.value||h?.v||(ut(h)?h:0),I=Og(a,h?.level);return{value:s(m,I)||ut(I)&&I||g}},l=0,u,c,d,p,f=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let h=i.find(I=>I.drawSize===r||I.drawSizes?.includes(r)),m=i.find(I=>I.drawSize&&I.threshold&&r>I.drawSize),g=i.find(I=>!I.drawSize&&!I.drawSizes?.length);f!==void 0&&(h=h?.[f],m=m?.[f],g=g?.[f]),c=o(h,e).value,d=o(m,e).value,p=o(g,e).value,l=c||d||p,u=c&&h.requireWin||d&&m.requireWin||g?.requireWin}else if(typeof i=="object"){let h=i?.drawSizes?.[r],m=i;f!==void 0&&(h=h?.[f],m=m?.[f]),c=o(h,e).value,p=o(m,e).value,l=c||p,u=c?h.requireWin:m?.requireWin}else ut(i)&&f===void 0&&(l=i);return e&&n?.pct?.[e]&&(l=Math.round(l*n.pct[e])),{awardPoints:l,requireWin:u}}function Ev({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){if(!i)return{error:ge};let n=ua(),{policyDefinitions:a}=jc({policyTypes:[hD],tournamentRecord:i}),s=e?.[hD]??a?.[hD];if(!s)return{error:uR};let o=s.awardProfiles,l=s.requireWinFirstRound,u=s.requireWinForPoints,c=s.doublesAttribution,d=s.qualityWinProfiles,{participants:p,derivedEventInfo:f,derivedDrawInfo:h,mappedMatchUps:m}=Pi({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),g=p?.filter(S=>S.draws?.length),I={},v={};for(let S of i.participants||[])S.person?.personId&&(I[S.participantId]=S.person.personId),S.individualParticipantIds?.length&&(v[S.participantId]=S.individualParticipantIds);let w={},y={},b={};for(let S of g??[]){let{participantType:U,participantId:T,person:D,draws:P}=S;for(let E of P){let{drawId:R,structureParticipation:C,eventId:M}=E,N=f[M],A=h[R],O=A?.drawType,{category:k,eventType:F,gender:x,wheelchairClass:L}=N||{},$=E.startDate||N.startDate||i.startDate,V=E.endDate||N.endDate||i.endDate;if(F===Da&&U!==jn)continue;let _;if(o){let B=u,G=0,j=0,Y=0,K=0,X,Z,Q=0,ae,te,ne;for(let le of C){let{finishingPositionRange:de,participationOrder:pe,participantWon:ve,flightNumber:Me,rankingStage:Ee,winCount:Be}=le;if(G+=Be||0,Array.isArray(de)&&de.length){let ce=Math.min(...de);(te===void 0||ce<te)&&(te=ce)}let fe=A?.drawSize,{awardProfile:Te}=U_({wheelchairClass:L,awardProfiles:o,participation:le,eventType:F,startDate:$,category:k,drawSize:fe,drawType:O,endDate:V,gender:x,level:r});if(Te){if(!fe)continue;if(Te.profileName&&(Z=Te.profileName),ne||(ne=Te),ae===void 0&&Te.maxCountableMatches!==void 0){let ee=Te.maxCountableMatches;if(typeof ee=="number")ae=ee;else if(typeof ee=="object"){let Se=Og(r,ee.level??ee);typeof Se=="number"&&(ae=Se)}}let ce=Array.isArray(de)&&Math.max(...de),be=ot(de||[]).join("-"),we=ce&&Ee!==We&&de?.includes(fe);Te.requireWinForPoints!==void 0&&(B=Te.requireWinForPoints),Te.requireWinFirstRound!==void 0&&(l=Te.requireWinFirstRound);let{finishingPositionPoints:Ae={},finishingPositionRanges:ye,finishingRound:Ne,pointsPerWin:he,flights:De}=Te,Le=Array.isArray(Te.perWinPoints)?Te.perWinPoints?.find(ee=>ee.participationOrders?.includes(pe)):Te.perWinPoints,J=Ae.participationOrders,se=0,oe;if((!J||J.includes(pe))&&ye&&ce){let ee=ye[ce];ee&&({awardPoints:se,requireWin:oe}=CP({flightNumber:Me,valueObj:ee,drawSize:fe,flights:De,level:r}))}if(!se&&Ne&&pe===1&&ce){let ee=Ne[ce];ee&&({awardPoints:se,requireWin:oe}=CP({participantWon:ve,flightNumber:Me,valueObj:ee,drawSize:fe,flights:De,level:r}))}we&&l!==void 0&&(B=l),oe!==void 0&&(B=oe),se>j&&(!B||Be)&&(j=se,X=ce,ne=Te);let ue=ae!==void 0?Math.min(Be||0,Math.max(0,ae-Q)):Be;if(!se&&he&&ue&&(Y+=ue*he,Q+=ue,X=be),!se&&Be&&Le){let ee=Og(r,Le?.level);typeof ee=="number"?(Y+=(ue||0)*ee,Q+=ue||0):!ee&&Le.value&&(Y+=(ue||0)*Le.value,Q+=ue||0)}}if(U===jn&&Te){let ce=Array.isArray(Te.perWinPoints)?Te.perWinPoints?.find(we=>we.participationOrders?.includes(pe)):Te.perWinPoints,be=ce&&Og(r,ce.level);if(be){let we=(S.matchUps||[]).filter(({structureId:Ae})=>Ae===le.structureId);for(let{matchUpId:Ae}of we){let ye=m[Ae],Ne=ye?.sides?.find(he=>he.participantId===T)?.sideNumber;if(!(!Ne||ye.winningSide!==Ne))for(let he of ye.tieMatchUps||[]){if(!he.winningSide)continue;let{collectionPosition:De}=he,Le;if(typeof be=="object"&&be.line){if(be.limit&&De>be.limit)continue;Le=be.line[De-1]}else typeof be=="number"&&(Le=be);if(Le)for(let J of he.sides||[]){if(J.sideNumber!==he.winningSide)continue;let se=J.participantId;if(!se)continue;let oe=v[se]||[se];for(let ue of oe){let ee=I[ue];ee&&(w[ee]||(w[ee]=[]),w[ee].push({linePoints:Le,collectionPosition:De,eventType:F,drawId:R}))}}}}}}}if(ne?.bonusPoints&&te!==void 0){for(let le of ne.bonusPoints)if(le.finishingPositions?.includes(te)){let de=le.value;if(typeof de=="number")K=de;else if(typeof de=="object"){let pe=Og(r,de.level??de);typeof pe=="number"&&(K=pe)}break}}if(_=j+Y+K,Y||j||K){let le={winCount:G,positionPoints:j,rangeAccessor:X,perWinPoints:Y,bonusPoints:K,eventType:F,drawId:R,points:_,category:k,drawType:O,startDate:$,endDate:V,level:r};n&&Z&&(le.profileName=Z);let de=D?.personId;if(de)w[de]||(w[de]=[]),w[de].push(le);else if(U===ht){if(b[T]||(b[T]=[]),b[T].push(le),c){let pe=c===cJ?.5:1,ve=v[T]||[];for(let Me of ve){let Ee=I[Me];if(!Ee)continue;let Be={...le,points:Math.round(le.points*pe),positionPoints:Math.round(le.positionPoints*pe),perWinPoints:Math.round(le.perWinPoints*pe),bonusPoints:Math.round(le.bonusPoints*pe),doublesParticipantId:T};w[Ee]||(w[Ee]=[]),w[Ee].push(Be)}}}else U===jn&&(y[T]||(y[T]=[]),y[T].push(le))}if(d?.length&&S.matchUps){let le=Object.values(S.matchUps).filter(de=>de.drawId===R&&de.participantWon);if(le.length){let de=le.map(Ee=>Ee.matchUpId),pe={};for(let Ee of le)pe[Ee.matchUpId]=Ee.sideNumber;let{qualityWinPoints:ve,qualityWins:Me}=S_({qualityWinProfiles:d,wonMatchUpIds:de,mappedMatchUps:m,participantSideMap:pe,tournamentParticipants:i.participants||[],tournamentStartDate:i.startDate,level:r});if(ve>0){let Ee=D?.personId;Ee&&(w[Ee]||(w[Ee]=[]),w[Ee].push({qualityWinPoints:ve,qualityWins:Me,eventType:F,drawId:R}))}}}}}}return{participantsWithOutcomes:g,personPoints:w,pairPoints:b,teamPoints:y,...H}}function T_(t){let{tournamentRecord:e,scope:i}=t;if(!e)return{error:ge};let r=new Date().toISOString(),n=[],a=(l,u)=>{let{extension:c}=it({element:l,name:Pn}),d=c?.value??{locks:[]};for(let p of d.locks)p.expiresAt!==null&&p.expiresAt<=r||i&&p.scope!==i||n.push({...p,...u})};a(e);let s=e.events??[];for(let l of s){a(l,{eventId:l.eventId});let u=l.drawDefinitions??[];for(let c of u)a(c,{eventId:l.eventId,drawId:c.drawId})}let o=e.venues??[];for(let l of o)a(l,{venueId:l.venueId});return{...H,mutationLocks:n}}var fJ={};pt(fJ,{compareTieFormats:()=>Tc,getTieFormat:()=>BC,tieFormatGenderValidityCheck:()=>TR,validateCollectionDefinition:()=>eS});function MP(t){if(!t)return{};let e=[],i=t.tieFormatName,r=t.collectionDefinitions?.map(n=>{let{matchUpType:a,matchUpFormat:s,matchUpCount:o,category:l,gender:u}=n;e.includes(s)||e.push(s);let c=l?.ageCategoryCode;return[o,a===Rp?"D":"S",c,s,u].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:r}}function Tc({considerations:t={},descendant:e,ancestor:i}){let r={},n={},{matchUpFormats:a,tieFormatDesc:s}=MP(e),{matchUpFormats:o,tieFormatDesc:l}=MP(i),u=ot((a??[]).filter(b=>!(o??[]).includes(b)).concat((o??[]).filter(b=>!(a??[]).includes(b)))),c=!!(t?.collectionName&&e.collectionDefinitions.map(({collectionName:b})=>b).join("|")!==i.collectionDefinitions.map(({collectionName:b})=>b).join("|")),d=!!(t?.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:b})=>b).join("|")!==i.collectionDefinitions.map(({collectionOrder:b})=>b).join("|")),p=Object.assign({},...(e?.collectionDefinitions||[]).map(b=>({[b.collectionId]:b}))),f=Object.assign({},...(i?.collectionDefinitions||[]).map(b=>({[b.collectionId]:b})));r.collectionIds=SW(Object.keys(p),Object.keys(f)),n.collectionIds=SW(Object.keys(f),Object.keys(p)),r.collectionsValue=dz(p),n.collectionsValue=dz(f),r.groupsCount=i?.collectionGroups?.length??(0-(e?.collectionGroups?.length??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let h=r.collectionsValue.totalValue-n.collectionsValue.totalValue,m=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,I=n.collectionsValue.assignmentValues.some((b,S)=>{let U=r.collectionsValue.assignmentValues[S];return!U||b.valueKey!==U.valueKey||b.value!==U.value?!0:Array.isArray(b.value)?b.value.every((T,D)=>U.value[D]===T):!1}),v=c||d||l!==s||g||I||h!==0,w=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],y=w.length&&w;return{matchUpFormatDifferences:u,matchUpCountDifference:m,descendantDifferences:r,ancestorDifferences:n,orderDifference:d,valueDifference:h,nameDifference:c,descendantDesc:s,ancestorDesc:l,...H,different:v,invalid:y}}function dz(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(oC).reduce((n,a)=>{let s=t[a],{collectionValueProfiles:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=s,f={collectionValueProfiles:o,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},h=Object.keys(f).filter(g=>![void 0,null].includes(f[g])&&(!Array.isArray(f[g])||f[g].length>0));h.length!==1&&e.push({collectionId:a});let m=h[0];if(m){let g=m==="collectionValueProfiles"?Object.values(o):f[m];i.push({valueKey:m,value:g})}return r+=u,o?.length?n+o.reduce((g,I)=>g+I.value,0):u?ut(c)?n+c*u:ut(d)?n+d*u:ut(p)?n+p*u:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function D_(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=hJ(t);return{matchUp:Oe(e,!0,!0),error:i}}function hJ({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,matchUpId:o,inContext:l,eventId:u,drawId:c,event:d}){if(!i)return{error:ge};if(typeof o!="string")return{error:Tn};if(!a||!d){let h=(wr({tournamentRecord:i,nextMatchUps:s}).matchUps??[]).find(m=>m.matchUpId===o);if(!h)return{error:cn};({eventId:u,drawId:c}=h),{event:d,drawDefinition:a}=zn({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:ja};n&&!r&&(r=Gc({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:d?.surfaceCategory??i.surfaceCategory,indoorOutDoor:d?.indoorOutdoor??i.indoorOutdoor,endDate:d?.endDate??i.endDate,tournamentId:i.tournamentId,eventId:u??d?.eventId,drawId:c},{participants:f=[]}=df({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(s){let h=(Nn({context:l?p:void 0,participants:f,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,inContext:l,event:d}).matchUps??[]).find(g=>g.matchUpId===o);if(!h)return{error:cn};let m=a?.structures?.find(g=>g.structureId===h.structureId);return{drawDefinition:a,structure:m,matchUp:h}}else{let{matchUp:h,structure:m}=pi({context:l?p:void 0,tournamentParticipants:f,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:o,inContext:l,event:d});return{matchUp:h,structure:m,drawDefinition:a}}}function BC({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:s,event:o}){if(!t)return{error:ge};if(!s&&!o&&!i&&!r)return z({result:{error:Xe},stack:"getTieFormat"});a&&!o&&(o=t.events?.find(f=>f.eventId===a));let l=D_({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:s,event:o});if(r&&l?.error)return l;if(!e&&l?.drawDefinition&&(e=l?.drawDefinition),n=n??l?.structure,!n&&i&&!r){if(!e)return{error:Vo};let f=et({drawDefinition:e,structureId:i});if(f.error)return f;n=f.structure}let u=(n?.tieFormat||n?.tieFormatId)&&yn({structure:n,drawDefinition:e,event:o})?.tieFormat,c=(e?.tieFormat||e?.tieFormatId)&&yn({drawDefinition:e,event:o})?.tieFormat,d=yn({event:o})?.tieFormat,p=yn({matchUp:l?.matchUp,drawDefinition:e,structure:n,event:o})?.tieFormat;return{...H,matchUp:l?.matchUp,structureDefaultTieFormat:Wr(u),eventDefaultTieFormat:Wr(d),drawDefaultTieFormat:Wr(c),tieFormat:Wr(p),structure:n}}var mJ={};pt(mJ,{bulkUpdatePublishedEventIds:()=>P_,getAllEventData:()=>E_,getCourtInfo:()=>iC,getDrawData:()=>wC,getEventData:()=>GS,getEventPublishStatus:()=>Oa,getPublishState:()=>Pm,getTournamentPublishStatus:()=>bv,getVenueData:()=>mI});function P_({tournamentRecord:t,outcomes:e}){if(!t)return{error:ge};if(!e?.length)return{error:Xe,info:"Missing outcomes"};let i=e.reduce((n,a)=>{let{drawId:s,eventId:o}=a;return o&&s&&(n[o]?n[o].includes(s)||n[o].push(s):n[o]=[s]),n},{}),r=Object.keys(i);return{publishedEventIds:(t.events?.filter(n=>r.includes(n.eventId))).filter(n=>{let a=Oa({event:n}),{drawDetails:s,drawIds:o}=a??{},{eventId:l}=n;return i[l].filter(u=>{let c=s?Object.keys(a.drawDetails).filter(d=>sC({drawId:d,drawDetails:s})):[];return o?.includes(u)||c.includes(u)}).length}).map(n=>n.eventId),eventIdPublishedDrawIdsMap:i}}function E_({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:ge};let i=t.events||[],r=t?.participants||[],{tournamentInfo:n}=Am({tournamentRecord:t}),{venues:a}=_u({tournamentRecord:t}),s=i.map(o=>{let{eventId:l}=o,u=L9({event:o}).eventInfo,c=hS({tournamentRecord:t,event:o}).scheduleTiming,d=(o.drawDefinitions||[]).map(f=>{let{drawId:h,drawName:m,matchUpFormat:g,updatedAt:I}=f,v={drawId:h,drawName:m,matchUpFormat:g,updatedAt:I},{abandonedMatchUps:w,completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S}=vv({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:f,event:o});return{drawInfo:v,matchUps:{abandonedMatchUps:w,completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S}}}),p=Oa({event:o});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:s}}}var gJ={};pt(gJ,{courtGridRows:()=>WC,findVenue:()=>po,getMatchUpsToSchedule:()=>VC,getPersonRequests:()=>vf,getProfileRounds:()=>HC,getScheduledRoundsDetails:()=>qS,getSchedulingProfile:()=>Wc,getSchedulingProfileIssues:()=>R_,publicFindCourt:()=>$L});function bI({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){let{individualParticipantIds:n}=YR(r);i=i??r.schedule?.timeAfterRecovery;let a=u=>{t[u]||(t[u]=[]),t[u]=ot(t[u].concat(...n))},s=u=>{i&&(!e[u]||i>e[u])&&(e[u]=i)},o=r.winnerTo?.matchUpId||r.winnerMatchUpId;o&&(i&&s(o),a(o));let l=r.loserTo?.matchUpId||r.loserMatchUpId;l&&(i&&s(l),a(l)),r.sidesTo?.length&&r.sidesTo.forEach(({matchUpId:u})=>{u&&(i&&s(u),a(u))})}function VC(t){let e=Ge(t,[{[eL]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,orderedMatchUpIds:o,clearDate:l,matchUps:u}=t,c=s?Object.keys(s):[],d=(o??[]).map(f=>u.find(h=>h.matchUpId===f)).filter(Boolean).filter(f=>{let h=!l&&(r.includes(f.matchUpId)||c.includes(f.matchUpId)),m=["BYE",Zt,Oi,fs,jr,mi,Si,Wi].includes(f?.matchUpStatus);return n||!h&&!f.winningSide&&!m}),p=i&&a?d.reduce((f,h)=>{let{drawId:m,tournamentId:g}=h;return f.matchUpMap[g]||(f.matchUpMap[g]={}),f.matchUpMap[g][m]?f.matchUpMap[g][m].push(h):f.matchUpMap[g][m]=[h],bI({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:h}),f},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function jC({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:s,eventType:o,eventId:l}){if(!Ga({matchUpFormat:r}))return{error:zw};let u=Object.keys(i).filter(d=>!s||d===s),c;return u.forEach(d=>{if(c)return;let p=i[d],f=l?zn({tournamentRecord:p,eventId:l})?.event:void 0;return c=US({tournamentRecord:p,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:f}),c?.averageMinutes||c?.recoveryMinutes}),{recoveryMinutes:c?.recoveryMinutes||t,averageMinutes:c?.averageMinutes||e,typeChangeRecoveryMinutes:c?.typeChangeRecoveryMinutes||c?.recoveryMinutes||t}}function qS(t){let e=Ge(t,[{[iL]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[Xn]:sn}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:Ri};let a={},s=[],o=t.rounds.toSorted((h,m)=>(h.sortOrder??0)-(m.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(h=>gv({tournamentRecord:h}).containedStructures)),u=t.matchUps??Oo({nextMatchUps:!0,tournamentRecords:n}).matchUps,c=0,d={},p={},f={};return{scheduledRoundsDetails:o.flatMap(h=>{let m=h.periodLength||r,g=[];l?.[h.structureId]?g.push(...l[h.structureId]):g.push(h.structureId);let I=u?Qu({tournamentIds:[h.tournamentId],roundNumbers:[h.roundNumber],matchUpIds:h.matchUpIds,eventIds:[h.eventId],drawIds:[h.drawId],processContext:!0,structureIds:g,matchUps:u}).sort(Tm):[],{segmentNumber:v,segmentsCount:w}=h.roundSegment||{};if(ut(v)&&Mo(I?.length)&&Mo(w)&&v>0&&v<=w&&w<I?.length&&!h.matchUpIds?.length){let U=I.length/w,T=U*(v-1);I=I.slice(T,T+U)}let y=n[h.tournamentId],b=zn({drawId:h.drawId,tournamentRecord:y}).event,S=[];for(let U of I){let T=U.matchUpFormat;T&&(a[T]||(a[T]=[],a[T].push(U)),S.push(T))}for(let U of S){let{eventType:T,category:D}=b??{},{categoryName:P,ageCategoryCode:E}=D??{},{typeChangeRecoveryMinutes:R,recoveryMinutes:C,averageMinutes:M,error:N}=jC({categoryName:P??E,categoryType:D?.categoryType,tournamentId:h.tournamentId,eventId:h.eventId,tournamentRecords:n,matchUpFormat:U,eventType:T});if(N)return{error:N,round:h};let A=I.filter(k=>(i||!Ji.includes(k.matchUpStatus))&&k.matchUpStatus!=="BYE").map(vr);A.forEach(k=>{f[k]={typeChangeRecoveryMinutes:R,recoveryMinutes:C,averageMinutes:M},d[k]=C,p[k]=M}),s.push(...A),c=Math.max(M||0,c);let O=`${M}|${m}`;return{roundPeriodLength:m,recoveryMinutes:C,averageMinutes:M,matchUpIds:A,hash:O}}}),greatestAverageMinutes:c,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:s,minutesMap:f,...H}}function IJ({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t?.map(o=>{let l=Qe(o?.scheduleDate);if(!l){n.push(`Invalid date: ${o?.scheduledDate}`);return}let u=(o?.venues||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!e?.includes(p)){n.push(`Missing venueId: ${p}`);return}let f=d.filter(h=>{let m=i.includes(h.eventId)&&r.includes(h.drawId);return m||n.push(`Invalid eventId: ${h.eventId} or drawId: ${h.drawId}`),m});if(f.length)return{venueId:p,rounds:f}}).filter(Boolean);return u.length&&l&&{...o,venues:u}}).filter(Boolean),s=n.length;return{updatedSchedulingProfile:a,modifications:s,issues:n}}function GC({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:ie};let{venueIds:i,tournamentsMap:r}=HEe({tournamentRecords:t}),n,a,s=e.every(o=>{let{scheduleDate:l,venues:u}=o;return Cn(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(f=>{if(!f)return a="empty round",!1;let{roundSegment:h,tournamentId:m,structureId:g,roundNumber:I,eventId:v,drawId:w}=f,y=r?.[m]?.[v]?.[w]?.[g]?.includes(I);y||(a="Invalid rounds");let{segmentNumber:b,segmentsCount:S}=h||{},U=!h||ut(b)&&Mo(S)&&b<=S;return U||(a="Invalid segment"),y&&U}):(n=lf,!1):(a="rounds should be an array",!1)}):!1});return!s&&!n&&(n=ie),{valid:!!s,error:n,info:a}}function GEe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],s=[],o=[],l=(e?.venues||[]).map(({venueId:c,courts:d})=>(!r||d?.length)&&c),u=e?.tournamentId;if(u){n.push(u),i[u]={};let c=e?.events||[];for(let d of c){let p=d.eventId;s.push(p),i[u][p]={};let f=h=>parseInt(h);for(let h of d.drawDefinitions||[]){let m=h.drawId;o.push(m),i[u][p][m]={};let{structures:g}=to({drawDefinition:h});for(let I of g||[]){let v=I.structureId,{matchUps:w}=kt({structure:I}),{roundMatchUps:y}=wn({matchUps:w}),b=y&&Object.keys(y).map(f);if(i[u][p][m][v]=b,a.push(v),I.structures?.length)for(let S of I.structures)a.push(S.structureId),i[u][p][m][S.structureId]=b}}}}return{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:s,drawIds:o}}function HEe(t){let e=t?.tournamentRecords&&Object.values(t?.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:s,tournamentIds:o}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:f,eventIds:h,drawIds:m}=GEe({tournamentRecord:u});return f.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...h),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:o,structureIds:s,venueIds:r,eventIds:n,drawIds:a}}function Wc({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ri};let{extension:i}=it({element:e,name:_h,tournamentRecords:t,discover:!0}),r=i?.value||[];if(r.length){let{venueIds:n}=jS({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:s}=U0({tournamentRecords:t}),{updatedSchedulingProfile:o,modifications:l,issues:u}=IJ({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:s});if(l){r=o;let c=Rv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return c.error?c:{schedulingProfile:r,modifications:l,issues:u}}}return{schedulingProfile:r,modifications:0}}function Rv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=GC({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?gt({tournamentRecords:t,discover:!0,extension:{name:_h,value:i}}):Mn({element:e,name:_h,tournamentRecords:t,discover:!0})}function YS(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=Wc({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:r}=jS({tournamentRecords:i}),{eventIds:n,drawIds:a}=U0({tournamentRecords:i}),{updatedSchedulingProfile:s,modifications:o,issues:l}=IJ({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return o?{...Rv({schedulingProfile:s,tournamentRecords:i}),modifications:o,issues:l}:{...H,modifications:o,issues:l}}function R_(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:jw};if(!Array.isArray(e))return{error:ie};if(!e.every(Cn))return{error:qi};let n=[],a=0,s={},{schedulingProfile:o}=Wc({tournamentRecords:i});if(!o)return{issues:n,...H};let{matchUps:l}=Oo({nextMatchUps:!0,tournamentRecords:i});for(let c of o){let{scheduleDate:d,venues:p=[]}=c;if(!e?.length||e.includes(d)){for(let f of p||[])if(f){let{rounds:h}=f,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:I}=qS({tournamentRecords:i,periodLength:r,matchUps:l,rounds:h}),{matchUpDependencies:v}=fo({tournamentRecords:i,matchUps:l}),w=y=>{let b;return I?.find((S,U)=>{let T=S.matchUpIds.includes(y);return T&&(b=U),T}),b};if(g?.forEach((y,b)=>{let S=g.slice(b+1),U=Fi(S,v?.[y]?.matchUpIds||[]);U.length&&m.push({matchUpId:y,shouldBeAfter:U})}),m.length){a+=m.length;let y=m.map(({matchUpId:b,shouldBeAfter:S})=>{let U=w(b),T=ot(S.map(w));return s[d]||(s[d]={}),s[d][U]||(s[d][U]=[]),T.forEach(D=>{s[d][U].includes(D)||s[d][U].push(D)}),{matchUpId:b,matchUpRoundIndex:U,earlierRoundIndices:T,shouldBeAfter:S}});n.push(...y)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...n.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:f}=c;return{[d]:{earlierRoundIndices:f,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:s,...H}}function vf(t){let{tournamentRecords:e,requestType:i}=t,r=Ge(t,[{[dn]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:s}=it({element:a,name:hv}),o=s?.value||[];for(let l of o){let{personId:u,requests:c}=l||{};n[u]||(n[u]=[]);for(let d of c)i&&d.requestType!==i||n[u].push(d)}}return{personRequests:n,...H}}function hx(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:s,eventId:o,drawId:l}=t,u=r?e:s,c=[n,o,l,u,a].join("|");return Ve({structureId:u,roundSegment:i,tournamentId:n,roundNumber:a,eventId:o,drawId:l,id:c})}function pz({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:s,categoryType:o}=n||{},{categoryName:l,ageCategoryCode:u}=s||{},c=Ta(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let f=c[p],h=jC({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:o,eventType:a});if(h.error)return h;let m=h.averageMinutes*f;isNaN(d)||(d+=m)}),{roundMinutes:d}}function WEe(t){return(t||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((a,s)=>a+s,0),n=(i.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:n}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function fz(t){let e=t.length,i=t.filter(({sides:u})=>u?.some(({bye:c})=>c)).length||0,r=t.filter(({winningSide:u,matchUpStatus:c})=>u||Ji.includes(c)).length||0,n=t.filter(({schedule:u,matchUpStatus:c})=>u?.scheduledDate&&u?.scheduledTime&&c!=="BYE").length||0,a=e-i,s=a===r,o=a-n,l=a-n;return{unscheduledCount:o,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:s,byeCount:i}}function HC({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:jw};t={[i.tournamentId]:i}}if(e){let a=GC({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=Wc({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:Vr};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:s})=>a.map(({rounds:o})=>o.map(l=>{let u=hx(l);return u.roundSegment?.segmentsCount&&(n[u.id]=u.roundSegment.segmentsCount),Ve({id:r?u.id:void 0,scheduleDate:s,...u})}))).flat(1/0),segmentedRounds:n}}function Pd({court:t,date:e}){let i=e&&t.dateAvailability?.find(n=>du(n.date,e)),r=t.dateAvailability?.find(n=>!n.date);return i||r}function zEe({court:t,date:e}){let i=Pd({court:t,date:e}),r=new Map,n=[];return(i?.bookings||[]).forEach(a=>{if(typeof a.courtOrder=="number"){let s=a.rowCount||1;for(let o=0;o<s;o++)r.set(a.courtOrder+o,a)}else n.push(a)}),{gridBookings:r,timeBookings:n}}function WC({courtPrefix:t="C|",minRowsCount:e,courtsData:i,scheduledDate:r}){if(!Array.isArray(i))return{error:ie};let n=i?.reduce((o,l)=>{let u=l.matchUps||[],c=Math.max(0,...u.map(d=>d.schedule.courtOrder||0));return Math.max(c,o)},1),a=Math.max(e||0,n),s=Re(0,a).map(o=>({matchUps:Re(0,i.length).map(l=>{let u=i[l],{courtId:c,venueId:d}=u;if(r){let{gridBookings:p}=zEe({court:u,date:r});if(p.has(o+1)){let f=p.get(o+1);return{schedule:{courtOrder:o+1,venueId:d,courtId:c},isBlocked:!0,booking:f}}}return{schedule:{courtOrder:o+1,venueId:d,courtId:c}}})}));return i.forEach((o,l)=>{for(let u of o.matchUps){let c=u.schedule?.courtOrder;c&&(s[c-1].matchUps[l]=u)}}),{courtPrefix:t,rows:s.map((o,l)=>Object.assign({rowId:`rowId-${l+1}`},...o.matchUps.map((u,c)=>({[`${t}${c}`]:u}))))}}var vJ={};pt(vJ,{getEntriesAndSeedsCount:()=>zC,getMaxEntryPosition:()=>C_});function zC({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:ui};let{entries:s,stageEntries:o}=R8({drawDefinition:e,drawId:r,stage:a,event:n}),l=o.length,{drawSize:u}=Q9({participantsCount:l}),c=WS({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return z({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:s,seedsCount:d,stageEntries:o}}function C_(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>Ye(n||0)),0)}var yJ={};pt(yJ,{allCompetitionMatchUps:()=>Oo,allDrawMatchUps:()=>Nn,allEventMatchUps:()=>Lu,allTournamentMatchUps:()=>wr,analyzeMatchUp:()=>Kb,calculateWinCriteria:()=>Om,checkMatchUpIsComplete:()=>bp,competitionScheduleMatchUps:()=>XS,drawMatchUps:()=>B_,eventMatchUps:()=>YC,filterMatchUps:()=>Qu,getAllDrawMatchUps:()=>rr,getAllStructureMatchUps:()=>kt,getCheckedInParticipantIds:()=>Um,getCompetitionMatchUps:()=>Yb,getEventMatchUpFormatTiming:()=>N_,getHomeParticipantId:()=>x_,getMatchUpCompetitiveProfile:()=>SS,getMatchUpContextIds:()=>F_,getMatchUpDailyLimits:()=>XC,getMatchUpDailyLimitsUpdate:()=>A_,getMatchUpDependencies:()=>fo,getMatchUpFormat:()=>L_,getMatchUpFormatTiming:()=>US,getMatchUpFormatTimingUpdate:()=>M_,getMatchUpScheduleDetails:()=>rC,getMatchUpType:()=>nC,getMatchUpsStats:()=>__,getModifiedMatchUpFormatTiming:()=>qC,getParticipantResults:()=>RS,getPredictiveAccuracy:()=>O_,getRoundMatchUps:()=>wn,getRounds:()=>$_,isValidMatchUpFormat:()=>Ga,matchUpActions:()=>SC,participantScheduledMatchUps:()=>k_,tallyParticipantResults:()=>Dm,tournamentMatchUps:()=>KC,validMatchUp:()=>JR,validMatchUps:()=>Ja});function bJ({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ri};let i=[],r;for(let n of Object.values(t)){let{extension:a}=it({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let s=n.events??[];for(let o of s){let{eventId:l}=o,{extension:u}=it({name:e,element:o});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function M_({tournamentRecords:t}){return bJ({extensionName:vc,tournamentRecords:t})}var pk="ADULT",fk="JUNIOR",BT="WHEELCHAIR",qEe={[jd]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Bt]:30,default:60}}]},defaultDailyLimits:{[zt]:2,[Bt]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[ac],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[BT],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[pk,BT],minutes:{default:60,[Bt]:30}},{categoryTypes:[fk],minutes:{default:60,[Bt]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[pk,BT],minutes:{default:30}},{categoryTypes:[fk],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[pk,fk],minutes:{default:30}},{categoryTypes:[BT],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},YEe=qEe;function N_({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:ui};let n,a;if(e?.length){let d=[];n=e.map(p=>{let f=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(f?.matchUpFormat)&&Ga({matchUpFormat:f?.matchUpFormat}))return d.push(f.matchUpFormat),f}).filter(Boolean)}else{let{policy:d}=pf({policyType:ko,tournamentRecord:t,event:r});if(d?.matchUpFormats)n=d?.matchUpFormats;else{let{extension:p}=it({name:vc,element:r}),f,h;p?.value?{matchUpAverageTimes:f,matchUpRecoveryTimes:h}=p.value:{matchUpAverageTimes:f,matchUpRecoveryTimes:h}=YEe[jd],n=ot([...(f||[]).map(m=>m.matchUpFormatCodes),...(h||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:s,eventId:o,category:l}=r,u=l?.categoryName??l?.ageCategoryCode??o;if(!o)return{error:ui};let c=n.map(({matchUpFormat:d,description:p})=>{let f=US({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:s,event:r});return{matchUpFormat:d,description:p,...f}});return Ve({eventMatchUpFormatTiming:c,info:a})}function qC(t){let e=Ge(t,[{[mr]:!0},{[qr]:m=>Ga({matchUpFormat:m}),[Ha]:zw,[J1]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=it({name:vc,element:n}),s=a?.value,{extension:o}=it({element:i,name:vc}),l=o?.value,u=s?.matchUpAverageTimes&&Zy({...s,matchUpFormat:r}),c=l?.matchUpAverageTimes&&Zy({...l,matchUpFormat:r}),d=[u,c].find(m=>m),p=s?.matchUpRecoveryTimes&&eb({...s,matchUpFormat:r}),f=l?.matchUpRecoveryTimes&&eb({...l,matchUpFormat:r}),h=[p,f].find(m=>m);return{matchUpFormat:r,recoveryTimes:h,averageTimes:d}}function A_({tournamentRecords:t}){return bJ({extensionName:lS,tournamentRecords:t})}var KS=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function k_({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!Ja(e))return{error:Ou};if(!Array.isArray(t))return{error:ie};let i=e.filter(Boolean).filter(({schedule:r})=>KS({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,s=Qe(a?.scheduledDate),o=di(a?.scheduledTime);return s&&o&&(r[s]?r[s].push(n):r[s]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>GK(di(n.schedule?.scheduledTime),di(a.schedule?.scheduledTime)))}),{...H,scheduledMatchUps:i}}function KEe({tournamentRecords:t}){let e={},i=[];for(let r of Object.values(t))for(let n of r.events??[]){let a=Oa({event:n}),s=a?.drawDetails;St(s)?(Object.assign(e,s),i.push(...Object.keys(s).filter(o=>sC({drawId:o,drawDetails:s})))):a?.drawIds?.length&&i.push(...a.drawIds)}return{drawIds:i,detailsMap:e}}function NP({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:o,drawId:l,structureId:u,roundNumber:c})=>`${o}|${l}|${u}${c}`;t?.length&&t.flatMap(({venues:o})=>o.map(({rounds:l})=>l)).forEach(o=>{o.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let f=r({eventId:l,drawId:u,structureId:c,roundNumber:d});i[f]=p})});let n=[],a={noScheduledDate:[]};for(let o of e){let l=o.schedule||{},u=l.scheduledDate&&Qe(l.scheduledDate)||l.scheduledTime&&Qe(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(o)}let s=Object.keys(a).sort((o,l)=>o.localeCompare(l));for(let o of s){let l=a[o],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},f=p.scheduledTime&&di(p.scheduledTime)||"noScheduledTime";u[f]||(u[f]=[]),u[f].push(d)}for(let d of Object.keys(u)){let p=u[d].sort((f,h)=>(f.roundNumber||0)-(h.roundNumber||0));u[d]=p}let c=Object.keys(u).sort((d,p)=>d.localeCompare(p));for(let d of c){let p=u[d];p.sort((f,h)=>{let m=i[r(f)]||0,g=i[r(h)]||0;return m-g}),n.push(...p)}}return n}function YC(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:h,nextMatchUps:m,tournamentId:g,inContext:I,context:v,event:w}=t;if(!w)return{error:ui};let{eventId:y,eventName:b,endDate:S,eventType:U,category:T,gender:D}=w??{},P={...v,...Ve({surfaceCategory:w.surfaceCategory??c?.surfaceCategory,indoorOutDoor:w.indoorOutdoor??c?.indoorOutdoor,tournamentId:g??c?.tournamentId,endDate:S??c?.endDate,eventName:b,eventType:U,category:T,eventId:y,gender:D})},E;!e&&c&&({participants:e,participantMap:r,groupInfo:E}=df({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:h,inContext:I})),h&&!i&&(i=Gc({policyDefinitions:l,tournamentRecord:c,contextProfile:h,event:w}));let R=Oa({event:w});return{...(w.drawDefinitions??[]).reduce((C,M)=>{let N=vv({hydrateParticipants:t.hydrateParticipants,context:P,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:f,participantMap:r,publishStatus:R,contextProfile:h,drawDefinition:M,nextMatchUps:m,inContext:I,event:w});return Object.keys(N)?.forEach(A=>{Array.isArray(N[A])&&(C[A]||(C[A]=[]),C[A]=C[A].concat(N[A]))}),C},{}),...H,groupInfo:E}}function KC(t){if(!t?.tournamentRecord)return{error:ge};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,inContext:o=!0,usePublishState:l,contextFilters:u,matchUpFilters:c,contextProfile:d,nextMatchUps:p,context:f}=t,h=t.tournamentId??s.tournamentId,m=s?.events??[],{participants:g,participantMap:I,groupInfo:v}=df({participantsProfile:r,tournamentRecord:s,contextProfile:d,inContext:o});d&&!e&&(e=Gc({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));let{appliedPolicies:w}=Rt({tournamentRecord:s}),y=u?.eventIds??[];return{...m.filter(b=>!y.includes(b.eventId)).map(b=>{let S={eventDrawsCount:Bi({event:b}).flightProfile?.flights?.length||b.drawDefinitions?.length||0,...f};return YC({hydrateParticipants:t.hydrateParticipants,context:S,tournamentAppliedPolicies:w,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,contextFilters:u,contextProfile:d,contextContent:e,matchUpFilters:c,participantMap:I,participants:g,tournamentId:h,nextMatchUps:p,inContext:o,event:b})}).reduce((b,S)=>((S&&Object.keys(S).filter(U=>!["success","matchUpsMap"].includes(U)))?.forEach(U=>{Array.isArray(S[U])&&(b[U]||(b[U]=[]),b[U]=b[U].concat(S[U]),b.matchUpsCount!==void 0?b.matchUpsCount+=S[U].length:b.matchUpsCount=S[U].length)}),b),{matchUpsCount:0}),groupInfo:v,participants:g}}function Yb({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,useParticipantMap:n,policyDefinitions:a,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c}){if(typeof r!="object"||!Object.keys(r).length)return{error:Ri};let d=Object.keys(r).map(h=>{let m=r[h];return KC({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:a,tournamentRecord:m,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c})}),p={},f={};return{...d.reduce((h,m)=>(Object.keys(m).forEach(g=>{if(g==="groupInfo")Object.assign(f,m[g]);else if(g==="participants")for(let I of m[g]??[])p[I.participantId]=I;else Array.isArray(m[g])&&(h[g]||(h[g]=[]),h[g]=h[g].concat(m[g]))}),h),{}),groupInfo:f,mappedParticipants:p}}function XS(t){if(typeof t?.tournamentRecords!="object"||!Object.keys(t?.tournamentRecords).length)return{error:Ri};let{courts:e,venues:i}=_u(t),r=Wc(t).schedulingProfile,{sortDateMatchUps:n=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:s,activeTournamentId:o,tournamentRecords:l,withCourtGridRows:u,minCourtGridRows:c,usePublishState:d,status:p=Qa,sortCourtsData:f}=t,h=o??pm()??Object.keys(l)[0],m=d?bv({tournamentRecord:l[h],status:p}):void 0,g=s?Yb({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Oi]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!qo(m?.orderOfPlay))return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let I,v;d&&({drawIds:I,detailsMap:v}=KEe({tournamentRecords:l})),I?.length&&(t.contextFilters??={},t.contextFilters.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(N=>I.includes(N)):t.contextFilters.drawIds=I);let w=m?.orderOfPlay;w?.eventIds?.length&&(t.matchUpFilters??={},t.matchUpFilters?.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(N=>w.eventIds.includes(N)):t.matchUpFilters.eventIds=w.eventIds),w?.scheduledDates?.length&&(t.matchUpFilters??={},t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(N=>w.scheduledDates.includes(N)):t.matchUpFilters.scheduledDates=w.scheduledDates),s&&(t.matchUpFilters??={},t.matchUpFilters?.excludeMatchUpStatuses?.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Oi)||t.matchUpFilters.excludeMatchUpStatuses.push(Oi):t.matchUpFilters.excludeMatchUpStatuses=[Oi]);let{completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S,abandonedMatchUps:U,groupInfo:T,mappedParticipants:D}=Yb({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),P=[...b??[],...S??[]];v&&(!I?.length||Object.keys(v).length)&&(P=P.filter(N=>{let{drawId:A,structureId:O,stage:k}=N;if(!qo(v?.[A]?.publishingDetail))return!1;let F=Object.keys(v[A].stageDetails??{});if(F.length){let L=F.filter(V=>!qo(v[A].stageDetails[V])),$=F.filter(V=>qo(v[A].stageDetails[V]));return L.length&&L.includes(k)?!1:$.length&&$.includes(k)?!0:L.length&&!L.includes(k)&&!$.length}let x=Object.keys(v[A].structureDetails??{});if(x.length){let L=x.filter(V=>!qo(v[A].structureDetails[V])),$=x.filter(V=>qo(v[A].structureDetails[V]));return L.length&&L.includes(O)?!1:$.length&&$.includes(O)?!0:L.length&&!L.includes(O)&&!$.length}return!0})),v&&d&&(P=P.filter(N=>{let{drawId:A,structureId:O,roundNumber:k}=N;if(!ut(k))return!0;let F=v[A]?.structureDetails?.[O];if(!F)return!0;let{scheduledRounds:x,roundLimit:L}=F;if(ut(L)&&k>L)return!1;if(x){let $=x[k];return $?qo($):!1}return!0}));let E=n?NP({matchUps:P,schedulingProfile:r}):P,R=e?.map(N=>{let A=M(N);return{surfaceCategory:N?.surfaceCategory??"",matchUps:A,...N}}),C={completedMatchUps:s?g:y,mappedParticipants:t.hydrateParticipants?void 0:D,dateMatchUps:E,courtsData:R,groupInfo:T,venues:i};if(u){let N=t.matchUpFilters?.scheduledDate,{rows:A,courtPrefix:O}=WC({minRowsCount:Math.max(c||0,E.length||0),scheduledDate:N,courtsData:R});C.courtPrefix=O,C.rows=A}return{...C,...H};function M({courtId:N}){let A=(a?E.concat(y??[],U??[]):E).filter(O=>O.schedule?.courtId===N||O.schedule?.allocatedCourts?.map(({courtId:k})=>k).includes(N));return f?NP({matchUps:A,schedulingProfile:r}):A}}function XC({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ri};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:s}=XEe({tournamentRecord:a});r=s}),{matchUpDailyLimits:r}}function XEe(t){let e=Ge(t,[{[mr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:r}=pf({policyType:jd,tournamentRecord:i}),{extension:n}=it({element:i,name:lS}),a=n?.value?.dailyLimits,s=r?.defaultDailyLimits;return{matchUpDailyLimits:a||s}}function O_(t){let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:s,zoneDoubling:o,matchUpType:l,scaleName:u,eventId:c,zonePct:d,drawId:p,event:f}=t;if(!r&&!e)return{error:ge};if(l&&![zt,Bt].includes(l))return{error:ie,info:{matchUpType:l}};if(e&&!Ja(e))return{error:ie,context:{matchUps:e}};let h=Pr[u],m=h?.ascending??t.ascending??!1,g=h?.accessor??t.valueAccessor,I=Array.isArray(h?.range)?Math.abs(h.range[0]-h.range[1]):0,v=ut(d)&&I?(d??0/100)*I:t.zoneMargin??I,w={withScaleValues:!0,withCompetitiveness:!0},y={matchUpTypes:l?[l]:[zt,Bt]},b=r?.participants;e?.[0]?.hasContext?p?e=e.filter(M=>M.drawId===p):c&&(e=e.filter(M=>M.eventId===c)):e??=p&&!n&&[]||!p&&c&&!f&&[]||p&&Nn({inContext:!0,drawDefinition:n,contextFilters:y,contextProfile:w,participants:b})?.matchUps||!p&&c&&Lu({inContext:!0,contextFilters:y,contextProfile:w,participants:b,event:f})?.matchUps||wr({tournamentRecord:r,contextFilters:y,contextProfile:w})?.matchUps||[],l&&(e=e.filter(M=>M.matchUpType===l));let S=e.filter(({winningSide:M,score:N,sides:A,matchUpStatus:O})=>![jr,Zt,mi,mv,fs].includes(O??"")&&dr({score:N})&&A?.length===2&&M),U=QEe({matchUps:S,excludeMargin:a,exclusionRule:s,valueAccessor:g,ascending:m,scaleName:u}),T=!o||Ti(zt)(l)?v:(v||0)*2,D=v?S.map(({competitiveProfile:M,matchUpType:N,score:A,sides:O})=>{let k=wJ({singlesForDoubles:i,valueAccessor:g,matchUpType:N,scaleName:u,sides:O}),F=Math.abs(k[0].value-k[1].value);return{competitiveness:M?.competitiveness,valuesGap:F,score:A}}).filter(({valuesGap:M})=>M<=T):[],P=JEe({zoneData:D}),E=P&&Object.values(P).flat().length,R=E&&Object.assign({},...Object.keys(P).map(M=>({[M]:Math.round(1e4*P[M].length/E)/100}))),C=S.length-(D?.length||0);return{...H,relevantMatchUps:S,zoneDistribution:R,zoneData:D,accuracy:U,nonZone:C}}function JEe({zoneData:t}){let e={[CL]:[],[jb]:[],[Gb]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function wJ({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let s=e?.range.sort(),o=l=>{let u=l?.[e?.valueAccessor];return{exclude:e&&u>=s[0]&&u<=s[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l?.individualParticipants;if(c?.length){let d=[],p=0;for(let f of c){let{scaleValue:h,value:m}=hz({singlesForDoubles:t,valueAccessor:i,participant:f,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:I}=o(h);g&&u.push(I),d.push(h),m&&!Number.isNaN(Number(p))?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=hz({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:f,exclusionValue:h}=o(d);return f&&u.push(h),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function hz({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){let a=t?zt:i,s=r?.rankings?.[a]?.find(u=>u.scaleName===n),o=(r?.ratings?.[a]?.find(u=>u.scaleName===n)||s)?.scaleValue,l=e?o?.[e]:o;return{scaleValue:o,value:l}}function QEe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let s={affirmative:[],negative:[],excluded:[]};for(let u of a)ZEe({matchUp:u,accuracy:s,excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n});let o=s.affirmative.length+s.negative.length,l=o&&s.affirmative.length/o*100;return s.percent=l?Math.round(100*l)/100:0,s}function ZEe({matchUp:t,accuracy:e,excludeMargin:i,exclusionRule:r,valueAccessor:n,ascending:a,scaleName:s}){let{matchUpType:o,sides:l,score:u,winningSide:c}=t;if(!c)return;if(r&&(!r.valueAccessor||!r.range)){e.error={info:"exclusionRule requires valueAccessor and range",error:Xe};return}let d=c-1,p=wJ({exclusionRule:r,valueAccessor:n,matchUpType:o,scaleName:s,sides:l});if(eRe({exclusionRule:r,sideValues:p,accuracy:e,score:u,winningSide:c}))return;if(tRe(p)){e.excluded.push({scoreString:u?.scoreStringSide1,missingValues:!0,winningSide:c,sideValues:p});return}let f=p[d].value-p[1-d].value;if(iRe({excludeMargin:i,valuesGap:f})){e.excluded.push({scoreString:u?.scoreStringSide1,excludeMargin:i,winningSide:c,excludeGap:!0,sideValues:p,valuesGap:f});return}let h=a?f:f*-1,m=c===1?u?.scoreStringSide1:u?.scoreStringSide2;h>0?e.affirmative.push({winningScoreString:m,winningSide:c,sideValues:p,valuesGap:f,score:u}):e.negative.push({winningScoreString:m,winningSide:c,sideValues:p,valuesGap:f,score:u})}function eRe({exclusionRule:t,sideValues:e,accuracy:i,score:r,winningSide:n}){if(t){let a=e.flatMap(({exclusionValues:s})=>s);if(a.length)return i.excluded.push({scoreString:r?.scoreStringSide1,exclusionValues:a,winningSide:n,sideValues:e}),!0}return!1}function tRe(t){return t.filter(e=>![void 0,"",null].includes(e.value)).length<2}function iRe({excludeMargin:t,valuesGap:e}){let i=Number.parseFloat(t||0);return i&&Math.abs(e)<i}function Om({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=w9({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:s,collectionGroupNumber:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,f=o&&r.includes(o);if(ut(p||d))n=!0;else{if(f)continue;if(typeof l=="number"&&ut(l))i+=l;else if(Array.isArray(s)&&s?.length)for(let h of s)i+=h.matchUpValue;else typeof c=="number"&&ut(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...H}:{valueGoal:Math.floor(i/2)+1,...H}}function x_(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=Ge(t,[{[xu]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:s}=mf({timeItems:r?.timeItems||[],itemType:OL});return!i||s&&e&&new Date(s).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function F_({matchUps:t,matchUpId:e}){if(!Ja(t))return{error:ie};let i=t.find(o=>o.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:s}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:s}}function Cv(t,e){if(!St(t))return{error:ie};if(!Array.isArray(e))return{error:ie};let i={};for(let{param:r,error:n,attr:a}of e){let s=rRe({params:t,param:r,attr:a,error:n});if(s?.error)return s;i[r]=s}return i}function rRe({params:t,param:e,attr:i,error:r}){if(e===LR&&St(t.drawDefinition)&&ni(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===xu){let n=hJ({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:Vr,info:{param:e}}}function L_(t){let{structureId:e,matchUpId:i,event:r}=t,n=t.drawDefinition,a=Ge(t,[{[mr]:!0},{[iL]:{[OR]:!1,[Nl]:!1,[V5]:!1,[$c]:!1}}]);if(a[$s])return a;let s=Cv(t,[{[pv]:xu,[$s]:Xe}])?.matchUp;if(i&&s?.error)return s;!n&&s?.drawDefinition&&(n=s?.drawDefinition);let o=s?.structure;if(!o&&e&&!i){if(!n)return{error:Vo};let p=et({drawDefinition:n,structureId:e});if(p.error)return p;o=p.structure}let l=o?.matchUpFormat,u=n?.matchUpFormat,c=r?.matchUpFormat,d=s?.matchUp?.matchUpFormat||l||u||c;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:c,drawDefaultMatchUpFormat:u,matchUpFormat:d}}function __({profileBands:t,tournamentRecord:e,matchUps:i}){if(!Ja(i))return{error:Ou};let r=!t&&pf({policyType:Ju,tournamentRecord:e}).policy,n=t||r?.profileBands||ML[Ju].profileBands,a=i.filter(({winningSide:p})=>p),s=a.map(N7),o=(p,f)=>{let h=M7(f,n);return p[h]+=1,p},l=A7(s).reduce((p,f)=>o(p,f),{[CL]:0,[jb]:0,[Gb]:0,[U7]:0}),u=Object.keys(l).reduce((p,f)=>(l[f]||0)+p,0),c=Object.keys(l).map(p=>{let f=Number.parseFloat((l[p]/u).toFixed(4));return{[p]:f*100}}),d=a.filter(({matchUpStatus:p})=>p===NW).length;return c.push({[NW]:Number.parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...H}}var{stageOrder:mz}=Wve;function nRe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(mz[t?.stage]||0)-(mz[e?.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function $_({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:s,withSplitRounds:o,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:ie,inContextMatchUps:r};if(s&&!n){if(typeof s!="object")return{error:jw};n={[s.tournamentId]:s}}let f=typeof n!="object"||!Object.keys(n).length;if((d||u||!r||!a&&(t||i||a||o))&&f)return{error:Ri};let h=Object.assign({},...Object.values(n??{}).map(({venues:S=[],tournamentId:U})=>({[U]:S?.map(({venueId:T})=>T)}))),m=Object.values(n??{}).map(({events:S=[],tournamentId:U,startDate:T,endDate:D})=>S.map(P=>({...P,validVenueIds:h[U],startDate:P.startDate??T,endDate:P.endDate??D}))).flat(),{segmentedRounds:g,profileRounds:I}=n&&(t||i||a||o)&&HC({tournamentRecords:n,schedulingProfile:a})||{},v=t&&Object.assign({},...I.map(S=>({[S.id]:S}))),w=r||n&&Oo({tournamentRecords:n,matchUpFilters:l})?.matchUps||[],y=[],b=w&&Object.values(w.reduce((S,U)=>{let T=hx(U).id,D=g?.[T],P=[...S[T]?.matchUps??[],U],{containerStructureId:E,stageSequence:R,structureName:C,tournamentId:M,isRoundRobin:N,matchUpType:A,roundNumber:O,roundOffset:k,structureId:F,eventName:x,roundName:L,drawName:$,eventId:V,drawId:_}=U,B=N?E:F;return{...S,[T]:{id:c?T:void 0,structureId:B,stageSequence:R,segmentsCount:D,structureName:C,tournamentId:M,matchUpType:A,roundNumber:O,roundOffset:k,eventName:x,roundName:L,drawName:$,matchUps:P,eventId:V,drawId:_}}},{})).map(S=>{let{minFinishingSum:U,winnerFinishingPositionRange:T}=WEe(S.matchUps),D=S.segmentsCount;if(D){let O=S.matchUps.length/D;return br(S.matchUps.sort((k,F)=>k.roundPosition-F.roundPosition),O).map((k,F)=>{let{unscheduledCount:x,incompleteCount:L,matchUpsCount:$,isScheduled:V,isComplete:_,byeCount:B}=fz(k),G=pz({matchUps:S.matchUps,tournamentRecords:n,events:m,round:S});return Ve({...S,...p,roundSegment:{segmentsCount:D,segmentNumber:F+1},winnerFinishingPositionRange:T,unscheduledCount:x,incompleteCount:L,minFinishingSum:U,matchUpsCount:$,isScheduled:V,roundTiming:G,isComplete:_,byeCount:B,matchUps:k})})}let{unscheduledCount:P,incompleteCount:E,matchUpsCount:R,isScheduled:C,isComplete:M,byeCount:N}=fz(S.matchUps),A=pz({matchUps:S.matchUps,tournamentRecords:n,events:m,round:S});return Ve({...S,...p,winnerFinishingPositionRange:T,unscheduledCount:P,incompleteCount:E,minFinishingSum:U,matchUpsCount:R,isScheduled:C,roundTiming:A,isComplete:M,byeCount:N})}).flat().filter(S=>{if(t){let F=Qe(t),x=c?S.id:hx(S).id;if(F&&v[x]&&Qe(v[x].scheduleDate)===F)return!1}let{isComplete:U,isScheduled:T}=S,D=!i||!U,P=!e||!T,E=d||u?m?.find(({eventId:F})=>F===S.eventId):void 0,R=E?.startDate??s?.startDate,C=E?.endDate??s?.endDate,M=!u||!R||new Date(u)>=new Date(R),N=!u||!C||new Date(u)<=new Date(C),A=M&&N,O=!d||E?.validVenueIds.includes(d),k=D&&P&&O&&A;return k||y.push(S),k}).sort(nRe)||[];return{...H,rounds:b,excludedRounds:y}}function Kb(t){let{matchUp:e,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=t||{},{matchUpFormat:s}=t||{};if(!e)return{error:oa};s=s||e?.matchUpFormat;let o=Ki(s),l=!!e?.winningSide,u=e.score?.sets,c=u?.length,d=r&&r-1,p=!!u?.find((B,G)=>B.setNumber===r&&G===d),f=u?.filter(B=>B?.winningSide)||[],h=f?.length||0,m=r&&u?.slice(r)||[],g=!!(c&&r&&m?.reduce((B,G)=>(!G||!G.side1Score&&!G.side2Score&&!G.side1TiebreakScore&&!G.side2TiebreakScore&&!G.side1PointScore&&!G.side2PointScore)&&B,!0)),I=r<=c&&u.find(B=>B.setNumber===r),v=I&&qb({setObject:I,matchUpScoringFormat:o}),{isCompletedSet:w,sideGameScores:y,sideTiebreakScores:b}=v||{},S=!!(I&&!w&&g||r&&r===c+1&&!l),U=[1,2].includes(i),T=U?i-1:0,D=I&&U&&(!n&&!a&&y[T]!==void 0&&y[T]||n&&b[T]!==void 0&&b[T]),P=!!D,E=f?.map(B=>qb({setObject:B,matchUpScoringFormat:o}).isValidSetOutcome).reduce((B,G)=>B&&G,!0),R=f.reduce((B,G)=>{let{winningSide:j}=G,Y=j-1;return B[Y]++,B},[0,0]),C=e?.winningSide,M=C&&C-1,N=1-M,A=R[M],O=R[N],k=Math.max(...R),F=Ta(R)[k],{bestOf:x,exactly:L}=o??{},$=Math.ceil((x||L||1)/2),V=k===$&&F===1&&R.indexOf(k)+1||void 0,_=A>O&&C===V;return{completedSetsHaveValidOutcomes:E,validMatchUpWinningSide:_,calculatedWinningSide:V,matchUpScoringFormat:o,validMatchUpOutcome:V&&E&&_,isLastSetWithValues:g,completedSetsCount:h,isCompletedMatchUp:l,isValidSideNumber:U,hasExistingValue:P,existingValue:D,isExistingSet:p,isActiveSet:S,...v}}function B_({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:f,contextProfile:h,drawDefinition:m,nextMatchUps:g,tournamentId:I,inContext:v,context:w,event:y}){let{eventId:b,eventName:S,endDate:U,eventType:T,category:D,gender:P}=y??{},E={...w,...Ve({surfaceCategory:y?.surfaceCategory??o?.surfaceCategory,indoorOutDoor:y?.indoorOutdoor??o?.indoorOutdoor,endDate:U??y?.endDate??o?.endDate,tournamentId:I??o?.tournamentId,eventName:S,eventType:T,category:D,eventId:b,gender:P})},R;return!t?.length&&o&&({participants:t,participantMap:p,groupInfo:R}=df({participantsProfile:r,useParticipantMap:s,tournamentRecord:o,contextProfile:h,inContext:v})),y&&h&&!c&&(c=Gc({policyDefinitions:a,tournamentRecord:o,contextProfile:h,drawDefinition:m,event:y})),{...vv({context:E,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:f,contextProfile:h,drawDefinition:m,nextMatchUps:g,inContext:v,event:y}),groupInfo:R}}var SJ={};pt(SJ,{getCompetitionVenues:()=>jS,getCourts:()=>V_,getVenuesAndCourts:()=>_u,publicFindVenue:()=>_L});function V_({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=Oe(r.courts||[]);return a.forEach(s=>Object.assign(s,{venueId:n})),a}).flat()}:{error:ge}}var UJ={};pt(UJ,{categoryCanContain:()=>Zw,getCategoryAgeDetails:()=>Mp,getEvent:()=>H_,getEventProperties:()=>j_,getEventStructures:()=>dC,getEventTimeItem:()=>fS,getEvents:()=>G_,getFlightProfile:()=>Bi,getScaledEntries:()=>km});function j_({tournamentRecord:t,event:e}){if(!t)return{error:ge};if(!e)return{error:ui};let i=e.entries||[],r=t.participants||[],n=e.category?.categoryName||e.category?.ageCategoryCode,{eventType:a}=e,s=new Set(i.map(d=>d.participantId)),o=r.filter(d=>s.has(d.participantId)),l,u,c;return{entryScaleAttributes:o.map(d=>{let{participantId:p,participantName:f,name:h}=d,m={scaleType:FL,eventType:a,scaleName:n},g=Zl({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;m={scaleType:V7,eventType:a,scaleName:n};let I=Zl({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;m={scaleType:B7,eventType:a,scaleName:n};let v=Zl({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;return l=!!(l||g),u=!!(u||I),c=!!(c||v),{participantId:p,participantName:f||h,seed:g,ranking:I,rating:v}}),hasSeededParticipants:l,hasRankedParticipants:u,hasRatedParticipants:c}}function G_({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:s}){if(!t)return{error:ge};let{tournamentId:o}=t,l=(t.events??[]).filter(({eventId:c})=>!n||Array.isArray(n)&&n.includes(c)).map(c=>{let d=c.drawDefinitions?.map(fI);if(a?.length&&!Fi(a,d).length)return;let p=Oe(c);return r&&Object.assign(p,{tournamentId:o}),s&&Object.assign(p,s),p}).filter(Boolean),u={};if(e){let c=Pi({withScaleValues:!0,tournamentRecord:t}).participantMap,d=p=>p.reduce((f,h)=>f+Number.parseFloat(h),0);for(let p of l){let f=i??p.eventType,h=p.eventId;u[h]||(u[h]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let m=(p.entries??[]).filter(({entryStatus:S})=>co.includes(S)).map(bt),g=S=>{if(S?.ratings?.[f])for(let U of S?.ratings?.[f]??[]){let T=U.scaleName;u[h].ratings[T]||(u[h].ratings[T]=[]);let D=Pr[T]?.accessor;if(D){let P=Number.parseFloat(U.scaleValue?.[D]);P&&u[h].ratings[T].push(P)}}if(S?.rankings?.[f])for(let U of S?.rankings?.[f]??[]){let T=U.scaleName;u[h].ranking[T]||(u[h].ranking[T]=[]),U.scaleValue&&u[h].ranking[T].push(U.scaleValue)}};for(let S of m){let U=c?.[S]?.participant;if(U?.participantType===vt)g(U);else for(let T of U?.individualParticipantIds??[]){let D=c?.[T]?.participant;g(D)}}let I=u[h].ratings;for(let S of Object.keys(I)){let U=I[S];if(!U.length)continue;let T=wW(U)?.toFixed(2);u[h].ratingsStats[S]={avg:Number.parseFloat((d(U)/U.length).toFixed(2)),median:T?Number.parseFloat(T):void 0,max:Math.max(...U),min:Math.min(...U)}}let v=(S,U)=>{let T=D=>{if(u[h].draws?.[S]&&D?.ratings?.[f])for(let P of D?.ratings?.[f]??[]){let E=P.scaleName;u[h].draws[S]?.ratings[E]||(u[h].draws[S].ratings[E]=[]);let R=Pr[E]?.accessor;if(R){let C=Number.parseFloat(P.scaleValue?.[R]);C&&u[h].draws[S].ratings[E].push(C)}}if(u[h].draws?.[S]&&D?.rankings?.[f])for(let P of D?.rankings?.[f]??[]){let E=P.scaleName;u[h].draws[S]?.ranking[E]||(u[h].draws[S].ranking[E]=[]);let R=P.scaleValue;R&&u[h].draws[S].ranking[E].push(R)}};for(let D of U.filter(Boolean)){let P=c?.[D]?.participant;if(P?.participantType===vt)T(P);else for(let E of P?.individualParticipantIds??[]){let R=c?.[E]?.participant;T(R)}}},w=[],y=S=>a?.length&&a.includes(S)||w.includes(S);for(let S of p.drawDefinitions??[]){let U=S.drawId;if(y(U))continue;let T=If({drawDefinition:S}).assignedParticipantIds??[];u[h].draws[U]||(u[h].draws[U]={ratingsStats:{},ratings:{},ranking:{}}),w.push(U),v(U,T)}let b=Bi({event:p}).flightProfile;for(let S of b?.flights??[]){let U=S.drawId;if(y(U))continue;let T=S.drawEntries.map(bt);v(U,T)}for(let S of w){let U=u[h].draws[S].ratings;for(let T of Object.keys(U)){let D=U[T];if(!D.length)continue;let P=wW(D)?.toFixed(2);u[h].draws[S].ratingsStats[T]={avg:Number.parseFloat((d(D)/D.length).toFixed(2)),median:P?Number.parseFloat(P):void 0,max:Math.max(...D),min:Math.min(...D)}}}}}return Ve({eventScaleValues:u,events:l,...H})}function H_({tournamentRecord:t,drawDefinition:e,context:i,event:r}){if(!t)return{error:ge};if(!r)return{error:ui};let n=Oe(r);i&&Object.assign(n,i);let a=e&&n.drawDefinitions?.find(({drawId:s})=>e.drawId===s);return Ve({drawDefinition:a,event:n})}function aRe(t){let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=lRe(t),n=uRe({...t,policyDefinitions:r,appliedPolicies:i}),a=oRe(t),s=cRe({...t,consideredEntries:a,appliedPolicies:i});if(s?.error)return z({result:s,stack:e});let o=dRe({...t,consideredEntries:a}),l=sRe({...t,appliedPolicies:i,policyDefinitions:r,drawSize:o});if(l.error)return z({result:l,stack:e});let u=l.drawType;if(isNaN(o)&&u!==ca)return z({result:{error:Ww},stack:e});let c=r?.[yo]??i?.[yo],d=t.seedingProfile??c?.seedingProfile?.drawTypes?.[u??""]??c?.seedingProfile;t.seedingProfile&&(r[yo]||(r[yo]={...fx[yo]}),r[yo].seedingProfile=d);let p=pRe({...t,drawType:u});return p?.error?z({result:p,stack:e}):{drawSize:o,drawType:u,enforceGender:n,seedingProfile:d,appliedPolicies:i,policyDefinitions:r}}function sRe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??HS({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),s=eX({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return s.error?s:{drawType:s.drawType}}function TJ(t){return t?.filter(e=>e.entryStatus&&[...co,bS].includes(e.entryStatus))}function oRe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||TJ(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Fe)}function lRe(t){let{tournamentRecord:e,event:i}=t,r={...t?.appliedPolicies,...Rt({tournamentRecord:e,event:i}).appliedPolicies??{}},n=Oe(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function uRe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){return t??e?.[Cr]?.participants?.enforceGender??i?.[Cr]?.participants?.enforceGender}function cRe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:s,event:o}=t;return o&&s&&UC({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:s,event:o})}function dRe(t){return!t.drawSize&&t.consideredEntries.length&&![ca,tS,dv,Zs,mu].includes(t.drawType??"")&&nv(t.consideredEntries.length)||t.drawSize&&Ye(t.drawSize)||!1}function pRe(t){let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:r,drawType:n}=t,a=!r&&e&&LC({tournamentRecord:e,categoryType:i?.category?.categoryType,categoryName:i?.category?.categoryName});return a?.length&&!a.includes(n)?{error:c1}:{...H}}function DJ(t){let{drawDefinition:e,appliedPolicies:i}=t,r=i?.[gc],n=Or({drawDefinition:e});return e.structures?.forEach(a=>{let s=Sd({structureId:a.structureId,matchUpsMap:n}),o=C7({roundNamingPolicy:r,drawDefinition:e,structure:a,matchUps:s}),{roundNamingProfile:l,roundProfile:u}=o;(a.structures||[a]).forEach(c=>{(c.matchUps??[]).forEach(d=>{let p=d?.roundNumber?.toString();if(p){let f=l?.[p]?.roundName,h=l?.[p]?.abbreviatedRoundName,m=u?.[p]?.feedRound;Object.assign(d,{abbreviatedRoundName:h,feedRound:m,roundName:f})}})})}),{drawDefinition:e}}function JS(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:s}=Pi({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),o=TJ(r?.entries)??[],l=aRe({...t,participantMap:s,participants:a,eventEntries:o});if(l.error)return z({result:l,stack:n});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:f,seedingProfile:h}=l,m=r?.eventType,g=t.matchUpType??m,I=rEe({...t,enforceGender:f,eventType:m,matchUpType:g});if(I.error)return z({result:I,stack:n});let{matchUpFormat:v,tieFormat:w}=I;if(t.drawId&&typeof t.drawId!="string")return z({result:{error:ie},stack:n});let y=AEe({...t,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:v,seedingProfile:h,participants:a,eventEntries:o,matchUpType:g,tieFormat:w,drawSize:d,drawType:p,event:r});if(y.error)return z({result:y,stack:n});let{existingDrawDefinition:b,positioningReports:S,drawDefinition:U,structureId:T,conflicts:D,entries:P}=y;if(!U)return z({result:{error:ie},stack:n});let E=kEe({...t,existingDrawDefinition:b,positioningReports:S,appliedPolicies:u,drawDefinition:U,seedingProfile:h,participants:a,structureId:T,entries:P,params:t,stack:n});if(E.error)return E;let{qualifyingConflicts:R}=E;return U.drawName=t.drawName??(p&&Jr(p)),d&&typeof e=="object"&&d>=4&&ZL({...e,drawDefinition:U,matchUpType:g}),t.hydrateRoundNames&&u?.[gc]&&DJ({drawDefinition:U,appliedPolicies:u}),{existingDrawDefinition:!!b,qualifyingConflicts:R,positioningReports:S,drawDefinition:U,structureId:T,...H,conflicts:D}}function fRe({matchUps:t,matchUpType:e}){if(!t)return{error:Ou};let i=[],r=[],n=0;e&&(t=t.filter(T=>T.matchUpType===e));let a=ot(t.map(({matchUpType:T})=>T));if(a.length>1)if(lh(a,ei))t=t.filter(Ti(ei));else if(lh(a,zt))t=t.filter(Ti(zt));else if(lh(a,Bt))t=t.filter(Ti(Bt));else return{};if(!Ja(t)||!t.length)return{};let s=(T,D)=>Ye(T)-Ye(D),o=ot(t.flatMap(T=>T.drawPositions).filter(Boolean)).sort(s),l=Re(1,Math.max(...o)+1).filter(T=>!o.includes(T)).sort(s),{roundMatchUps:u}=wn({matchUps:t}),c=u?.[1],d=u?.[2]??[],p=c?.[0],f=p?.drawId,h=p?.structureId,m=u?Object.keys(u).map(T=>Ye(T)):[],g=Math.max(...m),I=u?.[g]?.length??0,v=Math.ceil(Math.log(I)/Math.log(2)),w=Re(1,v+1).map(T=>{let D=Math.pow(2,T-1),P=g+v-T+1;return Re(1,D+1).map(E=>({drawId:f,structureId:h,matchUpId:Pt(),drawPositions:[],sides:[],roundNumber:P,roundPosition:E,finishingRound:T}))});v&&(t=t.concat(...w.flat()));let y=c?.map(T=>T.drawPositions)?.flat(1/0),b=d.map(T=>T.drawPositions).flat(1/0).filter(T=>!y?.includes(T)).sort(s),S=d.filter(T=>T.drawPositions?.find(D=>b.includes(D))).map(T=>{let D=T.drawPositions?.find(R=>b.includes(R)),P=D&&T.drawPositions?.indexOf(D),E=P!==void 0&&T.sides?.[P];return D&&{[D]:E}});if(l?.length&&b?.length===l?.length){let T=b.map((R,C)=>[R,l[C]].sort(s)),D=Object.assign({},...S),P=Oe(c?.[0].finishingRound,!1,!0),E=Oe(c?.[0].finishingPositionRange,!1,!0);r=T.map((R,C)=>{let M=Math.max(...R||[])/2,N=R?.map(A=>D[A]||{bye:!0,drawPosition:A});return{finishingPositionRange:E,sideNumber:C+1,matchUpStatus:"BYE",matchUpId:Pt(),finishingRound:P,roundNumber:1,drawPositions:R,roundPosition:M,structureId:h,drawId:f,sides:N}}),t=t.concat(...r)}let U=g+v;return Re(1,U+1).forEach(T=>{let D=[],P=gz({matchUps:t,roundNumber:T}),E=gz({matchUps:t,roundNumber:T-1}),R=new Set(E.map(hRe).filter(Boolean)),C=P?.length===i?.length,M=P?.length===i?.length/2;T===1&&P.forEach(N=>{let A=N.drawPositions||[],{matchUpId:O,structureId:k}=N,F=[{...N.sides[0],drawPosition:A[0],matchUpId:O,structureId:k},{...N.sides[1],drawPosition:A[1],matchUpId:O,structureId:k}],x={...N,children:F};D.push(x)}),C?(n++,P.forEach((N,A)=>{let O=N.drawPositions||[],{matchUpId:k,structureId:F}=N,x=O.filter(Boolean).reduce((V,_)=>y?.includes(_)?V:_,void 0),L=[{...N.sides.filter(Boolean).reduce((V,_)=>_.participantId&&!R.has(_.participantId)?_:V,void 0),drawPosition:x,feedRoundNumber:n,sides:N.sides,matchUpId:k,structureId:F},i[A]],$={...N,children:L};D.push($)})):M&&P.forEach((N,A)=>{let O=[i[A*2],i[A*2+1]],k={...N,children:O};D.push(k)}),i=D}),{hierarchy:i[0],missingMatchUps:r,maxRound:g,finalRound:U,matchUps:t}}function gz({matchUps:t,roundNumber:e}){return t.filter(i=>i.roundNumber===e).sort((i,r)=>i.roundPosition-r.roundPosition)}function hRe(t){if(t.matchUpStatus==="BYE")return t.sides.reduce((e,i)=>i.participantId||e,void 0);if(t.winningSide)return t.sides.reduce((e,i)=>i.sideNumber===t.winningSide?i.participantId:e,void 0)}function PJ({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Xe,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:o},l)=>({[o]:l+1})));n=n||t.scaleName;let s=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:o})=>({scaleItems:[{scaleValue:a[o],eventType:t.eventType,scaleType:Jl,scaleName:n,scaleDate:s}],participantId:o}))}}function mRe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:s,event:o,stage:l,sortDescending:u,scaleSortMethod:c}){let d=zC({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:s,event:o,stage:l});if(d.error)return d;let{entries:p,seedsCount:f,stageEntries:h}=d;if(!h||!f)return{error:ie};let m=km({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=PJ({scaleAttributes:r,scaledEntries:m,stageEntries:h,seedsCount:f,scaleName:n});return{scaleItemsWithParticipantIds:g}}var EJ={};pt(EJ,{addDrawEntries:()=>YL,addEventEntries:()=>rl,addEventEntryPairs:()=>AJ,destroyPairEntries:()=>M8,destroyPairEntry:()=>QL,getEntriesAndSeedsCount:()=>zC,getMaxEntryPosition:()=>C_,modifyEntriesStatus:()=>bP,modifyEventEntries:()=>kJ,mutate:()=>RJ,promoteAlternate:()=>MJ,promoteAlternates:()=>z_,query:()=>vJ,removeDrawEntries:()=>NJ,removeEventEntries:()=>MS,setEntryPosition:()=>W_,setEntryPositions:()=>CJ});var RJ={};pt(RJ,{addDrawEntries:()=>YL,addEventEntries:()=>rl,addEventEntryPairs:()=>AJ,destroyPairEntries:()=>M8,destroyPairEntry:()=>QL,modifyEntriesStatus:()=>bP,modifyEventEntries:()=>kJ,promoteAlternate:()=>MJ,promoteAlternates:()=>z_,removeDrawEntries:()=>NJ,removeEventEntries:()=>MS,setEntryPosition:()=>W_,setEntryPositions:()=>CJ});function W_({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let s="setEntryPositions";if(!t)return{error:ge};if(!i)return z({result:{error:ur},stack:s});if(r!==void 0&&!Number.isSafeInteger(r))return{error:ie,entryPosition:r};(a?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),(e?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let o=l=>{l.entries.forEach(u=>{u.entryPosition===r&&u.participantId!==i&&(u.entryPosition+=.1)})};return n||(a?.entries&&(o(a),a.entries=Do({entries:a.entries})),e?.entries&&(o(e),e.entries=Do({entries:e.entries}))),{...H}}function CJ({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:ge};if(!Array.isArray(e))return{error:ie};for(let n of e){let{participantId:a,entryPosition:s}=n,o=W_({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:s,event:r});if(o.error)return o}return r?.entries&&(r.entries=Do({entries:r.entries})),i?.entries&&(i.entries=Do({entries:i.entries})),{...H}}function MJ(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:ie,participantId:e}:z_({...t,participantIds:[e].filter(Boolean)})}function z_({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Fe,eventId:a,event:s}){if(!t)return{error:ge};if(!Array.isArray(i))return{error:ie,participantIds:i};if(!s)return{error:ui};let o="promoteAlternates";if(s){let l=Iz({element:s,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=Iz({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?z({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...H},stack:o}):l}return{...H}}function Iz({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===Bs),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),s=n.reduce((d,p)=>{let{entryPosition:f}=p;return isNaN(f)&&d||(!d||f<d.entryPosition)&&p||d},void 0),o=a.length?a:[s].filter(Boolean);if(!o?.length)return{error:K4};let l=o.filter(({entryStatus:d})=>d!==Bs);if(l.length)return{error:CO,invalidEntryStatus:l};let u=o.filter(({entryStage:d})=>d&&d!==r);if(u.length)return{error:RIe,invalidStage:u};let c=e&&o.filter(d=>d.stageSequence!==e);if(c?.length)return{error:CIe,invalidStageSequence:c};for(let d of o){d.entryStatus=da;let p=d?.entryPosition;isNaN(p)||i.entries.forEach(h=>{h.entryStatus===Bs&&h.entryPosition>p&&(h.entryPosition=h.entryPosition-1)});let f=Math.max(...i.entries.filter(h=>h.entryStatus===da&&!isNaN(h.entryPosition)).map(({entryPosition:h})=>Ye(h||0)),0);d.entryPosition=f||0}return{...H}}function NJ({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){if(!a)return{error:ui};if(!r)return{error:Vo};if(!e?.length)return{error:Bd};let s=If({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(Ln(s,e))return{error:lv};let o=c=>{let d=c.participantId;return!e.includes(d)},{flightProfile:l}=Bi({event:a}),u=l?.flights?.find(c=>c.drawId===r);return u?.drawEntries&&(u.drawEntries=u.drawEntries.filter(o),t&&(u.drawEntries=Do({entries:u.drawEntries}))),i?.entries&&(i.entries=i.entries.filter(o),t&&(i.entries=Do({entries:i.entries}))),{...H}}function Il(t){let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:s}=t,o=t.tournamentId?t.tournamentRecords?.[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&t.tournamentRecords?.[t.activeTournamentId]);if(!o)return{error:ge};if(!s)return z({result:{error:dm},stack:e});s.participantId||(s.participantId=Pt()),o.participants||(o.participants=[]);let{participantId:l,individualParticipantIds:u}=s;if(o.participants.reduce((m,g)=>g.participantId===l||m,!1))return{error:H4};let{participantType:c,participantRole:d}=s;if(!c||!Object.keys(Jy).includes(c))return{error:Ao,participantType:c};if(!d)return{error:j4};let p=o.participants||[],f=p.filter(m=>m.participantType===vt).map(m=>m.participantId);if(c!==vt&&s.person)return{error:ie,person:s.person};if(u&&!Array.isArray(u))return{error:ie,individualParticipantIds:u};if(c===ht){if(s.person)return{error:ie,person:s.person};if(s.individualParticipantIds){if(s.individualParticipantIds.length!==2&&!a)return z({info:"PAIR must be 2 individualParticipantIds",result:{error:Sa},stack:e});{let I=p.filter(v=>v.participantType===vt).map(v=>v.participantId);if(!Array.isArray(s.individualParticipantIds))return z({result:{error:Sa},stack:e});if(!s.individualParticipantIds.reduce((v,w)=>I.includes(w)&&v,!0))return z({result:{error:Sa},stack:e})}}else return z({result:{error:Bd},stack:e});let m=p.filter(I=>I.participantType===ht).map(I=>({individualParticipantIds:I.individualParticipantIds,participant:I})),g=s.participantType===ht&&m.find(I=>Fi(I.individualParticipantIds,s.individualParticipantIds).length===2);if(g&&!i)return{...H,existingParticipant:!0,participant:r&&Oe(g.participant)};if(!s.participantName){let I=p.filter(w=>s.individualParticipantIds?.includes(w.participantId)),v=I.map(w=>w.person?.standardFamilyName).filter(Boolean).join("/");I.length===1&&(v+="/Unknown"),s.participantName=v}}else if(c===vt){if(!s.person?.standardFamilyName||!s.person?.standardGivenName)return{error:Y4};if(!s.participantName){let m=`${s.person.standardFamilyName.toUpperCase()}, ${s.person.standardGivenName}`;s.participantName=m}}else if(c&&[_t,Xa].includes(c)){if(u||(s.individualParticipantIds=[]),s.individualParticipantIds?.length)for(let m of s.individualParticipantIds){if(typeof m!="string")return z({result:{participantId:m,error:ie},stack:e});if(!f.includes(m))return z({result:{participantId:m,error:ji},stack:e})}}else return{error:Ao};o.participants.push(s),n||nt({payload:{tournamentId:o.tournamentId,participants:[s]},topic:bd});let h={participant:r&&Oe(s),...H};return Ve(h)}function ro({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:ge};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=Pt())});let a=r.filter(d=>!n.includes(d.participantId)),s=r.filter(d=>n.includes(d.participantId)),o=a.filter(d=>d.participantType===vt),l=a.filter(d=>d.participantType!==vt),u=o.concat(...l),c=[];if(u.length){for(let p of u){let f=Il({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(f.error)return f;f.success&&!f.existingParticipant&&c.push(f.participant)}c.length&&nt({topic:bd,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&Oe(c),addedCount:c.length,...H};return s.length&&Object.assign(d,{notAdded:s,info:mR}),Ve(d)}else return{info:"No new participants to add",addedCount:0,...H}}function AJ(t){let e=Ge(t,[{[mr]:!0,[$c]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=Bs,participantIdPairs:n=[],entryStage:a=Fe,tournamentRecord:s,drawDefinition:o,event:l,uuids:u}=t;if(l.eventType!==Bt)return{error:uu};let c=[],d=new Map;for(let y of s.participants??[]){let{participantType:b,participantId:S,person:U,individualParticipantIds:T}=y;b===vt&&U?.sex?d.set(S,U.sex):b===ht&&T&&c.push(T)}let p=n.filter(y=>{if(y.length!==2)return!0;if(!l.gender||cu(l.gender))return!1;if(!d.has(y[0])||!d.has(y[1]))return!0;let b=y.map(U=>d.get(U)),S=eh(l.gender)&&(!eh(b[0])||!eh(b[1]))||fp(l.gender)&&(!fp(b[0])||!fp(b[1]));return $a(l.gender)&&(b.sort(oC),(!fp(b[0])||!eh(b[1]))&&(S=!0)),S});if(p.length)return{error:Sa,invalidParticipantIdPairs:p};let f=n.map(y=>({participantId:u?.pop()??Pt(),participantRole:Xr,individualParticipantIds:y,participantType:ht})),h=i?f:f.filter(y=>!c.find(b=>Fi(b,y.individualParticipantIds).length===2)),m,g=[];if(h){let y=ro({allowDuplicateParticipantIdPairs:i,participants:h,returnParticipants:!0,tournamentRecord:s});if(y.error)return y;g=y.participants||[],m=y.info}let I=n.map(y=>{let b=g.find(U=>Fi(U.individualParticipantIds,y).length===2);if(b)return b;let{participant:S}=io({tournamentRecord:s,participantIds:y});return S}).map(y=>y.participantId),v=rl({participantIds:I,tournamentRecord:s,drawDefinition:o,entryStatus:r,entryStage:a,event:l});h.length&&nt({payload:{participants:h},topic:bd});let w=h.map(bt);return{...v,info:m,newParticipantIds:w}}function kJ({entryStatus:t=da,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Fe,tournamentRecord:n,event:a}){if(!n)return{error:ge};if(!a)return{error:ui};let s=n.participants??[],o=s.filter(m=>m.participantType===vt).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!o.includes(m));if(l.length)return{error:Sa,invalidParticipantIds:l};let u=i.filter(m=>m.length!==2);if(u.length)return{error:Sa,invalidParticipantIdPairs:u};let c=s.filter(m=>m.participantType===ht).map(m=>m.individualParticipantIds),d=i.filter(m=>!c.find(g=>Fi(g,m).length===2)).map(m=>({participantType:ht,participantRole:Xr,individualParticipantIds:m})),p=ro({participants:d,tournamentRecord:n});if(p.error)return p;let f=i.map(m=>{let{participant:g}=io({tournamentRecord:n,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:r})),h=e.map(m=>({entryStatus:Us,participantId:m,entryStage:r}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===r),a.entries=a.entries.concat(...f,...h),{...H}}var OJ={};pt(OJ,{addDrawDefinition:()=>QS,addEvent:()=>Mv,addFlight:()=>eM,assignSeedPositions:()=>zJ,attachFlightProfile:()=>Z_,categoryCanContain:()=>Zw,deleteDrawDefinitions:()=>JC,deleteEvents:()=>YJ,deleteFlightAndFlightDraw:()=>HJ,deleteFlightProfileAndFlightDraws:()=>$J,generate:()=>xJ,generateEventsFromTieFormat:()=>FJ,getCategoryAgeDetails:()=>Mp,getEvent:()=>H_,getEventProperties:()=>j_,getEventStructures:()=>dC,getEventTimeItem:()=>fS,getEvents:()=>G_,getFlightProfile:()=>Bi,getScaledEntries:()=>km,modifyEvent:()=>KJ,modifyEventMatchUpFormatTiming:()=>BJ,modifyPairAssignment:()=>WJ,mutate:()=>LJ,query:()=>UJ,refreshEventDrawOrder:()=>Q_,removeEventMatchUpFormatTiming:()=>QC,removeScaleValues:()=>e$,removeSeeding:()=>qJ,setEventDates:()=>X_,setEventDisplay:()=>ZC,setEventEndDate:()=>K_,setEventStartDate:()=>Y_,updateDrawIdsOrder:()=>J_,validateCategory:()=>Ob});var xJ={};pt(xJ,{generateEventsFromTieFormat:()=>FJ});function gRe({tournamentId:t,event:e}){return e?(nt({payload:{tournamentId:t,event:e},key:e.eventId,topic:l7}),{...H}):{error:ui}}var IRe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},vRe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},yRe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},bRe={COLLEGE_D3:IRe,COLLEGE_DEFAULT:vRe,COLLEGE_JUCO:yRe,DOMINANT_DUO:i5,DOMINANT_DUO_MIXED:QK,LAVER_CUP:o5,TEAM_DOUBLES_3_AGGREGATION:qK,TIME_TENNIS_DUAL:ZK,TIME_TENNIS_PRO_CIRCUIT:JK,USTA_BREWER_CUP:e5,USTA_OZAKI_CUP:t5,USTA_COLLEGE:r5,USTA_GOLD_TEAM_CHALLENGE:zK,USTA_INTERSECTIONAL:XK,USTA_LEVEL_1:n5,USTA_SECTION_BATTLE:KK,USTA_SOUTHERN_LEVEL_5:YK,USTA_TOC:l5,USTA_WTT_ITT:a5,USTA_ZONAL:s5};function Mv({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){if(!e)return{error:ge};if(e.events||(e.events=[]),!r)return{error:ui};let{startDate:n,endDate:a}=e;if(!i&&(r.entries?.length||r.drawDefinitions?.length)){let o=Ve({drawDefinitions:!!r.drawDefinitions?.length,entries:!!r.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:ie,context:o}}let s={eventType:Oh,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===Da){if(r.tieFormat){let o=Hn({tieFormat:r.tieFormat});if(o.error)return o}else if(r.tieFormatName){if(!bRe[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:ie};let o=hc({isMock:e?.isMock,namedFormat:r.tieFormatName,event:r});s.tieFormat=o}}if(s.eventId||(s.eventId=Pt()),e.events.reduce((o,l)=>o||l.eventId===s.eventId,void 0))return{error:b4};{let o=s;if(e.events.push(o),!t){let{topics:l}=bs();if(l.includes(WR)){let d=Lu({event:r}).matchUps??[];wd({tournamentId:e?.tournamentId,eventId:r.eventId,matchUps:d})}let{drawDefinitions:u,...c}=r;for(let d of u||[])cS({drawDefinition:d});gRe({tournamentId:e?.tournamentId,event:c})}return{...H,event:s}}}function FJ(t){let e=Ge(t,[{[cI]:{[xR]:!0,[x5]:!0}},{[mr]:!0}]);if(e.error)return e;let i=t.tieFormat||hc({namedFormat:t.tieFormatName}),r=t.uuids||[WK(i.collectionDefinitions.length)],n={[Zi]:[],[Lr]:[]};if(t.addEntriesFromTeams){let s=t.tournamentRecord.participants?.filter(o=>o.participantType===jn)?.flatMap(o=>o.individualParticipantIds??[]);for(let o of t.tournamentRecord.participants??[])if(s?.includes(o.participantId)){let l=o.person?.sex;if(l&&cl(l)){let u=ln(l);u&&n[u].push(o.participantId)}}}let a=[];for(let s of i.collectionDefinitions??[]){let o=r?.pop()?.toString()||Pt(),l=s.matchUpType,u=s.gender,c={matchUpFormat:s.matchUpFormat,eventName:s.collectionName,category:s.category,gender:u,eventType:l,eventId:o};if(t.addEntriesFromTeams){let d=l===mc?Us:t.entryStatus||da,p=$a(u)?[...n[Zi],...n[Lr]]:n[ln(u)||Xu]??[];if(p.length){let f=rl({participantIds:p,entryStatus:d,event:c});if(f.error)return f}}if(a.push(c),t.addEvents!==!1){let d=Mv({internalUse:!0,tournamentRecord:t.tournamentRecord,event:c});if(d.error)return d}}return{...H,events:a}}var LJ={};pt(LJ,{addDrawDefinition:()=>QS,addEvent:()=>Mv,addFlight:()=>eM,assignSeedPositions:()=>zJ,attachFlightProfile:()=>Z_,deleteDrawDefinitions:()=>JC,deleteEvents:()=>YJ,deleteFlightAndFlightDraw:()=>HJ,deleteFlightProfileAndFlightDraws:()=>$J,modifyEvent:()=>KJ,modifyEventMatchUpFormatTiming:()=>BJ,modifyPairAssignment:()=>WJ,refreshEventDrawOrder:()=>Q_,removeEventMatchUpFormatTiming:()=>QC,removeScaleValues:()=>e$,removeSeeding:()=>qJ,setEventDates:()=>X_,setEventDisplay:()=>ZC,setEventEndDate:()=>K_,setEventStartDate:()=>Y_,updateDrawIdsOrder:()=>J_,validateCategory:()=>Ob});function Nv({removePriorValues:t=!0,status:e=Qa,statusObject:i,event:r}){if(!St(i))return{error:ie};let n=Oa({event:r,status:e}),a=`${zd}.${qd}`,s={itemValue:{[e]:{...n,...i}},itemType:a};return Nm({timeItem:s,removePriorValues:t,event:r})}function Av(t){let e=Ge(t,[{[mr]:!0,[$c]:!0},{eventDataParams:!1,[Xn]:Qn}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=Qa,event:s,drawIdsToRemove:o,drawIdsToAdd:l}=t,{appliedPolicies:u}=Rt({tournamentRecord:n,event:s}),c={...u,...t.policyDefinitions},d=s?.drawDefinitions?.map(({drawId:b})=>b)??[],p=t.drawDetails?Object.keys(t.drawDetails):[],f=p.length?[]:t.drawIds,h=(l??[]).concat(...o??[],...f??[],...p),m=h.filter(b=>!d.includes(b));if(m.length)return z({result:{error:ja},context:{invalidDrawIds:m}});if(t.drawDetails)for(let b of Object.keys(t.drawDetails)){let S=t.drawDetails[b];if(S.publishingDetail?.embargo&&!ld(S.publishingDetail.embargo))return{error:Ng};if(S.stageDetails){for(let U of Object.keys(S.stageDetails))if(S.stageDetails[U].embargo&&!ld(S.stageDetails[U].embargo))return{error:Ng}}if(S.structureDetails)for(let U of Object.keys(S.structureDetails)){let T=S.structureDetails[U];if(T.embargo&&!ld(T.embargo))return{error:Ng};if(T.scheduledRounds){for(let D of Object.keys(T.scheduledRounds))if(T.scheduledRounds[D].embargo&&!ld(T.scheduledRounds[D].embargo))return{error:Ng}}}}let g=Oa({event:s,status:a}),I=Object.keys(g?.drawDetails||{}).filter(b=>d.includes(b)).reduce((b,S)=>(b[S]=g.drawDetails[S],b),{});for(let b of d)if((!h.length||h.includes(b))&&(o?.includes(b)||f?.length&&!f.includes(b)?I[b]={...I[b],publishingDetail:{published:!1}}:(l?.includes(b)||f?.includes(b)||!f?.length)&&(I[b]={...I[b],publishingDetail:{published:!0}})),t.drawDetails?.[b]){let S=t.drawDetails[b],U=S.structureDetails??I[b].structureDetails,T=S.stageDetails??I[b].stageDetails??{},{structureIdsToRemove:D=[],structureIdsToAdd:P=[],publishingDetail:E={},stagesToRemove:R=[],stagesToAdd:C=[]}=S;if((P||C)&&(E.published=!0),I[b]={publishingDetail:E,structureDetails:U,stageDetails:T},P.length||D.length){let N=(s?.drawDefinitions?.find(O=>O.drawId===b)?.structures??[]).map(({structureId:O})=>O),A=(P??[]).concat(D??[]).filter(O=>!N.includes(O));if(A.length)return z({result:{error:vi},context:{invalidStructureIds:A}});U=U??{};for(let O of N)D.includes(O)?U[O]={published:!1}:U[O]={published:!0};I[b].structureDetails=U}let M=(s?.drawDefinitions?.find(N=>N.drawId===b)?.structures??[]).map(({stage:N})=>N);if(C.length){for(let N of C)T[N]={published:!0};for(let N of M)T[N]||(T[N]={published:!1})}if(C.length||R.length){for(let N of R)T[N]={published:!1};for(let N of M)T[N]||(T[N]={published:!0})}(C.length||R.length)&&(I[b].stageDetails=T)}Nv({statusObject:{drawDetails:I},removePriorValues:r,status:a,event:s});let{topics:v}=bs(),w=v.includes(jO),y=w||t.returnEventData?GS({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:c,event:s})?.eventData:void 0;return w&&nt({payload:{eventData:y,tournamentId:n.tournamentId},topic:jO}),{...H,eventData:y}}var _J="deleteDrawDefinitions",mx="autoSchedulingAudit",TD="deleteEvents",wRe={AUTO_SCHEDULING_AUDIT:mx,DELETE_EVENTS:TD,DELETE_DRAW_DEFINITIONS:_J};function JC(t){if(!t.tournamentRecord)return{error:ge};let e="deleteDrawDefinitions",i=t.drawIds??[],r=t.event,{autoPublish:n=!0,tournamentRecord:a,auditData:s,eventId:o,force:l}=t,{appliedPolicies:u}=Rt({tournamentRecord:a,event:r}),c={...u,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!r){let T=zn({tournamentRecord:a,eventId:o,drawId:d});if(T.error)return T;r=T.event}let p=[],f=[],h=[];if(!r?.drawDefinitions)return z({info:"event has no drawDefinition",result:{...H},stack:e});let m=r.drawDefinitions.map(({drawId:T})=>T);if(i.length||(i=m),i=i.filter(T=>m.includes(T)),!i.length)return z({info:"nothing to do; no matching drawIds in event.",result:{...H},stack:e});let g=Oe(Bi({event:r}).flightProfile,!1,!0),I=({participantId:T,drawPosition:D,qualifier:P,bye:E})=>({bye:E,qualifier:P,drawPosition:D,participantId:T}),v=l??u?.[ko]?.allowDeletionWithScoresPresent?.drawDefinitions,w=Oa({event:r})??{},y=w.drawIds??(w.drawDetails&&Object.keys(w.drawDetails))??[],b,S=[],U=r.drawDefinitions.filter(T=>{if(i.includes(T.drawId)){let D=Nn({event:r,drawDefinition:T})?.matchUps??[];if(D.some(({score:F})=>dr({score:F}))&&!v)return S.push(T.drawId),!0;let{drawId:P,drawType:E,drawName:R}=T,C=g?.flights?.find(F=>F.drawId===T.drawId);C&&(C.drawEntries=C.drawEntries?.filter(F=>co.includes(F.entryStatus))),y.includes(P)&&(y=y.filter(F=>F!==P),b=!0);let M=to({stageSequence:1,drawDefinition:T,stage:Fe})?.structures?.[0],N=(M?vI({structureId:M.structureId,tournamentRecord:a,drawDefinition:T}):void 0)?.positionAssignments?.map(I),A=to({stage:We,drawDefinition:T})?.structures,O=A?.length?A.map(F=>{let x=F.stageSequence;return{positionAssignments:vI({structureId:F.structureId,tournamentRecord:a,drawDefinition:T})?.positionAssignments.map(I),stageSequence:x}}):void 0,k={action:_J,payload:{drawDefinitions:[T],eventId:o??r?.eventId,auditData:s}};h.push(k),p.push(Ve({tournamentId:a.tournamentId,eventId:o??r?.eventId,qualifyingPositionAssignments:O,positionAssignments:N,auditData:s,drawType:E,drawName:R,drawId:P})),D?.forEach(({matchUpId:F})=>f.push(F))}return!i.includes(T.drawId)});if(S.length&&!l)return z({context:{drawIdsWithScoresPresent:S},result:{error:Kw},stack:e});if(r.drawDefinitions=U,g&&Gd({event:r,extension:{name:eo,value:g}}),YS({tournamentRecord:a}),b){let T={};for(let P of y)T[P]=w.drawDetails?.[P]??{published:!0};let D=Nv({statusObject:{drawDetails:T},event:r});if(D.error)return{error:D.error}}if(h.length)if(Jw(sc)){let T=a.tournamentId;nt({topic:sc,payload:{tournamentId:T,detail:h}});let D=(Ss({element:r,itemType:yp})?.timeItem?.itemValue||0)+1;kl({element:r,timeItem:{itemType:yp,itemValue:D},removePriorValues:!0})}else SRe({appliedPolicies:u,event:r,deletedDrawsDetail:p,auditData:s});if(f.length&&Fu({tournamentId:a?.tournamentId,matchUpIds:f}),i.forEach(T=>Eye({drawId:T})),n&&b){let T=Av({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:c,tournamentRecord:a,event:r});if(T.error)return{...H,info:T.error}}return{...H}}function SRe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){if(t?.audit?.[yp]===!1)return;let{extension:n}=it({name:yp,element:e}),a={...r,deletedDrawsDetail:i},s={value:Array.isArray(n?.value)?n?.value.concat(a):[a],name:yp};gt({element:e,extension:s})}function $J({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){if(!e)return{error:ge};if(!r)return{error:ui};let{flightProfile:a}=Bi({event:r});if(a){let s=a.flights?.map(({drawId:l})=>l).filter(Boolean),o=JC({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return o.error?o:VR({event:r,name:eo})}return{...H}}function q_(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,s=t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(s).length)return{error:Ri};let o=Object.keys(s).filter(u=>!n||n===u);if(n&&!o.includes(n))return{error:ie};let l;for(let u of o){let c=s[u],{event:d}=zn({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=URe({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...H}:{error:ds}}function URe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:ge};if(r&&!Array.isArray(r))return{error:ie};if(e&&!Array.isArray(e))return{error:ie};let a=vc;if(n){let{extension:s}=it({element:n,name:a}),o=s?.value||{},l=vz({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});gt({element:n,extension:{name:a,value:l}})}else{let{extension:s}=it({element:t,name:a}),o=s?.value||{},l=vz({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});gt({extension:{name:a,value:l},element:t})}return{...H}}function vz(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let s=n?.length&&i.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(u=>u!==r)}:l).filter(({matchUpFormatCodes:l})=>l?.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let o=a?.length&&e.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(u=>u!==r)}:l).filter(({matchUpFormatCodes:l,averageTimes:u})=>l?.length||u).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:s?.length&&s||i,matchUpRecoveryTimes:o?.length&&o||e}}function BJ(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:s,event:o}=t;if(!e)return{error:ge};if(!Ga({matchUpFormat:n}))return{error:ie};if(!o)return{error:ui};let{averageTimes:l=[],recoveryTimes:u=[]}=qC({tournamentRecord:e,matchUpFormat:n,event:o}),c=o.category,d=c?.categoryName||c?.ageCategoryCode||o?.eventId,p={categoryNames:[d],minutes:{}},f={categoryNames:[d],minutes:{}},h=w=>{if(w.categoryTypes?.includes(a)&&console.log("encountered:",{categoryType:a}),!(w.categoryNames?.includes(d)&&(w.categoryNames=w.categoryNames.filter(y=>y!==d),p={minutes:w.minutes,categoryNames:[d]},!w.categoryNames.length)))return w},m=r&&!isNaN(Ye(r)),g=i&&!isNaN(Ye(i)),I=l.map(h).filter(w=>w?.categoryNames?.length),v=u.map(h).filter(w=>w?.categoryNames?.length);return m&&(Object.assign(p.minutes,{[o?.eventType||zt]:r}),I.push(p)),g&&(Object.assign(f.minutes,{[o?.eventType||zt]:i}),v.push(f)),!m&&!g?{error:ie}:q_({averageTimes:m&&I,recoveryTimes:g&&v,tournamentRecord:e,matchUpFormat:n,eventId:s})}function QC(t){if(t.event)return yz({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=Ge(t,[{[dn]:!0,[B5]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=zn({tournamentRecord:n,eventId:r});if(a)return yz({event:a})}}return{error:ds}}function yz({event:t}){return VR({event:t,name:vc})}var VJ={MON:"MON",TUE:"TUE",WED:"WED",THU:"THU",FRI:"FRI",SAT:"SAT",SUN:"SUN"};function jJ(t){return!Array.isArray(t)||ot(t).length!==t.length?!1:t.every(e=>Object.keys(VJ).includes(e))}function Y_({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:ge};if(!e)return{error:ui};if(!dl.test(i))return{error:qi};let r=GJ(t),n="setEventStartDate";if(r.error)return z({result:r,stack:n});let{tournamentStartDate:a,tournamentEndDate:s}=r,o=new Date(Qe(i)).getTime();if(!a||!s||o<a||o>s)return z({result:{error:qi},stack:n,info:"startDate must be within tournament start and end dates"});let l=e.endDate&&new Date(Qe(e.endDate)).getTime();return l&&o>l&&(e.endDate=i),e.startDate=i,{...H}}function K_(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:ge};if(!i)return{error:ui};if(!dl.test(r))return{error:qi};let n=GJ(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:s}=n,o=new Date(Qe(r)).getTime();if(!a||!s||o<a||o>s)return{error:qi};let l=i.startDate&&new Date(Qe(i.startDate)).getTime();return l&&o<l&&(i.startDate=r),i.endDate=r,{...H}}function X_(t){let e="setEventDates",i=Ge(t,[{tournamentRecord:!0,event:!0},{[qr]:u=>dl.test(u),[Ha]:qi,startDate:!1,endDate:!1},{[qr]:u=>u.filter(Boolean).every(c=>dl.test(c)),[Ha]:qi,activeDates:!1},{[qr]:jJ,weekdays:!1}]);if(i.error)return i;let{tournamentRecord:r,weekdays:n,event:a,startDate:s,endDate:o}=t,l=t.activeDates?.filter(Boolean);if(s&&o){let u=new Date(Qe(s)).getTime(),c=new Date(Qe(o)).getTime();if(u>c)return z({result:{error:ie},stack:e,info:"startDate cannot be after endDate"})}if(l){let u=s||r.startDate,c=o||r.endDate,d=!u||l.every(f=>new Date(f)>=new Date(u)),p=!c||l.every(f=>new Date(f)<=new Date(c));if(!d||!p)return z({result:{error:qi},stack:e})}if(s){let u=Y_({tournamentRecord:r,event:a,startDate:s});if(u.error)return z({result:u,stack:e})}if(o){let u=K_({tournamentRecord:r,event:a,endDate:o});if(u.error)return z({result:u,stack:e})}return l&&(a.activeDates=l),n&&(a.weekdays=n),{...H}}function GJ(t){let{startDate:e,endDate:i}=t;return!dl.test(e)||!dl.test(i)?z({result:{error:L4},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Qe(e)).getTime(),tournamentEndDate:new Date(Qe(i)).getTime()}}function J_({event:t,orderedDrawIdsMap:e}){if(typeof t!="object")return{error:ui};if(!e)return{error:Xe,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:ie,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(n=>!Number.isNaN(Number(n))))return{error:ie,info:"drawOrder must be numeric"};if(ot(i).length!==i.length)return{info:"drawOrder values must be unique",error:ie};if(t.drawDefinitions?.length){let n=(t.drawDefinitions||[]).map(({drawId:s})=>s),a=Object.keys(e);if(a?.length&&Fi(n,a).length!==n.length)return{error:ie,info:"Missing drawIds"};t.drawDefinitions.forEach(s=>{s.drawOrder=e[s.drawId]})}let{flightProfile:r}=Bi({event:t});return r?.flights?.forEach(n=>{n.flightNumber=e[n.drawId]}),{...H}}function Q_({tournamentRecord:t,event:e}){if(!t)return{error:ge};if(!e)return{error:ui};let{flightProfile:i}=Bi({event:e}),r=i?.flights?.sort((s,o)=>s.flightNumber-o.flightNumber).map(s=>s.drawId).filter(Boolean),n=e.drawDefinitions?.sort((s,o)=>s.drawOrder-o.drawOrder).map(s=>s.drawId).filter(Boolean).filter(s=>!r?.includes(s)),a=Object.assign({},...[...r||[],...n||[]].map((s,o)=>({[s]:o+1})));return a?J_({event:e,orderedDrawIdsMap:a}):{...H}}function HJ({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){if(!e)return{error:ge};if(!r)return{error:Vo};if(!n)return{error:ui};let{flightProfile:s}=Bi({event:n});if(s&&s.flights?.find(o=>o.drawId===r)){let o=s.flights.filter(u=>u.drawId!==r),l={name:eo,value:{...s,flights:o}};Gd({event:n,extension:l})}if(n.drawDefinitions?.find(o=>o.drawId===r)){let o=JC({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(o.error)return o}return Q_({tournamentRecord:e,event:n})}function WJ(t){let e=Ge(t,[{[$c]:!0,[mr]:!0,[tL]:!1},{replacementIndividualParticipantId:!0,[qr]:g=>ni(g),existingIndividualParticipantId:!0,[$s]:ur,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:r,tournamentRecord:n,drawDefinition:a,participantId:s,event:o,uuids:l}=t;if(e.error)return e;if(o?.eventType!==ps)return{error:uu};if(!(o?.entries?.filter(({entryStatus:g})=>[Us,ff].includes(g)).map(({participantId:g})=>g)||[]).includes(i))return{error:No};let u=(n.participants||[]).find(g=>g.participantId===s);if(u?.participantType!==ht)return{error:Cp,participant:u};let c=u.individualParticipantIds,d=[i,...c.filter(g=>g!==r)],{participant:p}=io({participantIds:d,tournamentRecord:n}),f;if(p)f=p.participantId;else{let g={participantId:l?.pop(),participantRole:Xr,individualParticipantIds:d,participantType:ht},I=Il({participant:g,returnParticipant:!0,tournamentRecord:n});if(I.error)return I;f=I.participant.participantId}let{flightProfile:h}=Bi({event:o});if(a){let g=h?.flights?.find(({drawId:I})=>I===a.drawId);g&&(g.drawEntries=g.drawEntries.map(I=>I.participantId===s?{...I,participantId:f}:I)),a.entries=a.entries.map(I=>I.participantId===s?{...I,participantId:f}:I);for(let I of a.structures||[])if(I.structures){I.positionAssignments=void 0;for(let v of I.structures)v.positionAssignments=v.positionAssignments.map(w=>w.participantId===s?{...w,participantId:f}:w)}else I.positionAssignments&&(I.positionAssignments=I.positionAssignments.map(v=>v.participantId===s?{...v,participantId:f}:v))}o.entries=o.entries.map(g=>g.participantId===s&&{...g,participantId:f}||g.participantId===i&&{...g,participantId:r}||g);let m=n.events.some(({entries:g,eventId:I,drawDefinitions:v})=>o.eventId===I?v.some(({drawId:w,entries:y})=>w===a?.drawId?!1:y?.find(b=>b.participantId===s)):g?.find(w=>w.participantId===s));if(!m){let g=Em({addIndividualParticipantsToEvents:!1,participantIds:[s],tournamentRecord:n});if(g.error)return g}return{...H,participantOtherEntries:m,newPairParticipantId:f}}function QS(t){let{flight:e,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:s,tournamentRecord:o,drawDefinition:l,event:u}=t;if(!l)return{error:_e};if(!u)return{error:ui};u.drawDefinitions||(u.drawDefinitions=[]);let{drawId:c,drawName:d,entries:p}=l,{entries:f}=u,h=0;if(n!==void 0&&n!==u.drawDefinitions.length)return{error:ie,info:"drawDefintions count mismatch"};let{flightProfile:m}=Bi({event:u}),g=e&&m?.flights?.find(R=>R.flightNumber===e.flightNumber),I=m?.links?.find(R=>R?.target?.drawId===c)?.source?.drawId;if(I&&!u.drawDefinitions.find(R=>R.drawId===I))return z({result:{error:_e},info:{sourceDrawId:I}});if(g&&g.drawId!==l.drawId)return z({result:{error:uh},info:{relevantFlight:g}});let v=p?.every(({participantId:R,entryStatus:C})=>{let M=g?.drawEntries.find(N=>N.participantId===R);return!C||M?.entryStatus===C}),w=!s||f&&p?.every(({participantId:R,entryStatus:C,entryStage:M})=>f.find(N=>N.participantId===R&&(!N.entryStage||N.entryStage===M))?.entryStatus===C);if(g&&!v)return z({result:{error:uh},context:{drawEntriesPresentInFlight:v,matchingEventEntries:w,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&p?.filter(Boolean).forEach(R=>{if(R?.entryStatus&&co.includes(R?.entryStatus)){let C=f?.filter(Boolean).find(M=>M.participantId===R.participantId);C&&R.entryStatus&&C?.entryStatus!==R.entryStatus&&(C.entryStatus=R.entryStatus,h+=1)}}),f&&!w)return z({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:w,eventEntries:f},error:uh}});let y=m?.flights?.map(({flightNumber:R})=>!isNaN(R)&&Ye(R))?.filter(Boolean)||[],b=u.drawDefinitions.map(({drawOrder:R})=>R&&Ye(R))?.filter(Boolean)||[],S=Math.max(0,...b,...y)+1,U=m?.flights?.find(R=>R.drawId===c),T;if(U){U.drawName=l.drawName,T={name:eo,value:{...m,flights:m.flights}};let R=U.flightNumber;R&&!b.includes(R)?S=R:U.flightNumber=S}else{let R=m?.flights||[];R.push({manuallyAdded:!0,flightNumber:S,drawEntries:p,drawName:d,drawId:c}),T={name:eo,value:{...m||{},flights:R}}}Gd({event:u,extension:T}),Object.assign(l,{drawOrder:S});let D=u.drawDefinitions.find(R=>R.drawId===c),P=o?.tournamentId,E=u.eventId;if(D){if(!a)return{error:c4};let R=Nn({drawDefinition:D})?.matchUps?.map(vr)??[],C=Nn({drawDefinition:l})?.matchUps;if(!i){R?.length&&Fu({matchUpIds:R,action:"modifyDrawDefinition",tournamentId:P,eventId:E}),C?.length&&wd({matchUps:C,tournamentId:P,eventId:E}),u.drawDefinitions=u.drawDefinitions.map(N=>N.drawId===c?l:N);let M=l.structures?.map(({structureId:N})=>N);ii({drawDefinition:l,tournamentId:P,structureIds:M,eventId:E})}}else if(u.drawDefinitions.push(l),!i){let{matchUps:R}=Nn({drawDefinition:l,event:u});R&&wd({tournamentId:o?.tournamentId,matchUps:R}),cS({drawDefinition:l,tournamentId:P,eventId:E})}return{...H,modifiedEventEntryStatusCount:h}}function zJ(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,assignments:o,drawId:l,event:u}=t,c=0;if(!o?.length)return{error:h1};if(!r)return{error:ge};if(!l)return{error:Vo};let d=ms({provisionalPositioning:e,drawDefinition:n,structureId:s});if(d.error)return d;let{seedAssignments:p,seedLimit:f}=d,h=Object.assign({},...(p??[]).filter(I=>I.seedNumber).map(I=>({[I.seedNumber]:I})));o.forEach(I=>{let{seedNumber:v}=I;f&&v<=f&&(!i||h[v])&&(h[v]=I)});let m=Object.values(h),g=m.map(I=>I?.participantId).filter(Boolean);if(g.length!==Q6(g).length)return{error:d4};for(let I of m){let v=Uv({...I,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,event:u});if(v?.error)return v;v?.success&&c++}return c?{...H,modifications:c}:{error:uv}}function Z_({deleteExisting:t,event:e,flightProfile:i}){let r="attachFlightProfile";if(!i)return z({result:{error:Xe},stack:r});if(!e)return z({result:{error:ui},stack:r});let{flightProfile:n}=Bi({event:e});return n&&!t?z({result:{error:M1},stack:r}):e.drawDefinitions?.length?z({result:{error:a4},stack:r}):(Gd({event:e,extension:{name:eo,value:i}}),{flightProfile:Oe(i,!1,!0),...H})}function TRe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){if(!t)return{error:ge};if(!i)return{error:Bd};if(!e)return{error:Xe,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=e,s=[$7,r,n,a].join(".");return t.participants?.forEach(o=>{i.includes(o.participantId)&&o.timeItems&&(o.timeItems=o.timeItems.filter(l=>l&&l?.itemType!==s))}),{...H}}function e$({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:s}){if(!a)return{error:ui};if(r&&!Array.isArray(r))return z({result:{error:ie},info:_p("entryStatus"),stack:"removeScaleValues"});let o=a.entries;if(n){let{flightProfile:u}=Bi({event:a}),c=u?.flights?.find(d=>d.drawId===n);c?o=c.drawEntries:o=i?.entries}let l=(o||[]).filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!r||r.includes(u.entryStatus))).map(bt);return TRe({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function ZC({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=Qa,event:n}){if(!e)return z({result:{error:ge}});if(!n)return z({result:{error:ui}});if(!St(i))return z({result:{error:Xe}});if(St(i.draws))for(let s of Object.keys(i.draws)){let o=i.draws[s].scheduleDetails??[];if(o.length){let l=[];for(let u of o){let c=l.find(d=>eIe(d.attributes,u.attributes));c?.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[s].scheduleDetails=l}}let a=Nv({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...H}}function qJ({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:s}){if(!t)return{error:ge};if(!a)return{error:ui};r=r||a.category?.categoryName||a.category?.ageCategoryCode;let o={eventType:a.eventType,scaleType:Jl,scaleName:r};return e$({tournamentRecord:t,scaleAttributes:o,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:s})}function YJ(t){let e=Ge(t,[{[mr]:!0},{eventIds:!0,[Xn]:sn}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],s=[],o=[],l=[];if(r.events=(r.events||[]).filter(u=>{if(n.includes(u.eventId)){let p={action:TD,payload:{events:[u]}};a.push(p),s.push({tournamentId:r.tournamentId,eventName:u.eventName,eventType:u.eventType,category:u.category,eventId:u.eventId,gender:u.gender})}let c=u.eventType===ps?(u.entries||[]).map(({entryStatus:p,participantId:f})=>p!==Us&&f).filter(Boolean):[],d=n.includes(u.eventId);return d?l.push(...c):o.push(...c),!d}),i){let u=l.filter(c=>!o.includes(c));r.participants=r.participants.filter(({participantId:c})=>!u.includes(c))}if(YS({tournamentRecord:r}),a.length)if(Jw(sc)){let u=r.tournamentId;nt({topic:sc,payload:{type:TD,tournamentId:u,detail:a}})}else BS({tournamentRecord:r,timeItem:{itemValue:s,itemType:TD}});return{...H}}function KJ(t){let e=Ge(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:Qn}]);if(e.error)return e;let{eventUpdates:i,event:r}=t,n="modifyEvent",a=CRe(t),s=MRe({enteredParticipants:a}),{enteredParticipantGenders:o,enteredParticipantTypes:l}=s,u=Bi({event:r})?.flightProfile?.flights,c=!r.drawDefinitions?.length&&!u?.length,d=NRe({noFlightsNoDraws:c,enteredParticipantGenders:o,eventUpdates:i,stack:n});if(d.error)return d;let p=ARe({enteredParticipantTypes:l,eventUpdates:i,stack:n});if(p.error)return p;let f=DRe({...t,...s,enteredParticipants:a,stack:n});if(f.error)return f;let h=RRe({...t,stack:n});return h.error?h:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{...H})}function DRe(t){let e=t.eventUpdates?.category;if(!e)return{...H};let i=Ob({category:e});if(i.error)return i;if(t.event.eventType===sr){let r=PRe(t);if(r.error)return r}if(t.enteredParticipants?.length){let r=ERe(t,e);if(r.error)return r}return{...H}}function PRe(t){let e=t.event?.drawDefinitions?.map(n=>zo(n))??[],i=zo(t.event),r=(Lu(t)?.matchUps??[]).map(n=>zo(n))??[];return[i,...e,...r].filter(Boolean).every(n=>n.collectionDefinitions.every(a=>!a.category||Zw({category:t.eventUpdates.category,childCategory:a.category})))?{...H}:z({result:{error:Rb},stack:t.stack})}function ERe(t,e){let i=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,r=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,n=t.enteredParticipants.flatMap(o=>o.participantType===vt?[o]:o.individualParticpants??[]),a=Mp({category:e,consideredDate:i}),s=Mp({category:e,consideredDate:r});if(a?.ageMinDate||a?.ageMaxDate||s?.ageMinDate||s?.ageMaxDate)for(let o of n){let l=o.person?.birthDate;if(!l)return z({result:{error:k4},stack:t.stack});let u=new Date(l).getTime(),c=bz(u,a,t.stack);if(c)return c;let d=bz(u,s,t.stack);if(d)return d}return{...H}}function bz(t,e,i){if(!e)return null;if(e.ageMinDate||e.ageMaxDate){let r=new Date(e.ageMinDate).getTime(),n=new Date(e.ageMaxDate).getTime();if(t<r||t>n)return z({result:{error:B4},stack:i})}return null}function RRe(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=X_({startDate:i.startDate||r.startDate||e.startDate,endDate:i.endDate||r.endDate||e.endDate,tournamentRecord:e,event:r});if(a.error)return z({result:a,stack:n})}return{...H}}function CRe(t){let{tournamentRecord:e,event:i}=t,r=i?.entries?.filter(({entryStatus:n})=>{let a=n;return[...co,Bs].includes(a)}).map(({participantId:n})=>n)??[];return r?Pi({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function MRe({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{let s=a.person?.sex?[a.person.sex]:a.individualParticpants?.map(o=>o.person?.sex)||[];return e.push(...s),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=ot(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function NRe({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||cu(i.gender)||e.length===1&&e[0]===i.gender||t&&$a(i.gender);return i.gender&&!n?z({context:{gender:i.gender,validGender:n},result:{error:Yy},stack:r}):{...H}}function ARe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(sr)&&[sr]||t.includes(vt)&&[pl]||t.includes(ht)&&[ps]||[ps,pl,sr]).includes(e.eventType??"");return e.eventType&&!r?z({context:{participantType:e.eventType,validEventType:r},result:{error:uu},stack:i}):{...H}}function eM({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){let s="addFlight";if(!n)return z({result:{error:ui},stack:s});if(!i)return z({result:{error:Xe},stack:s});if(e?.length){let f=(n.entries??[]).map(bt),h=e.map(bt);if(Fi(h,f).length!==h.length)return z({result:{error:ie},stack:s})}let o=Bi({event:n})?.flightProfile,l=o?.flights?.map(({flightNumber:f})=>!isNaN(f)&&Ye(f))?.filter(Boolean)||[],u=Math.max(0,...l)+1,c={drawId:r||Pt(),flightNumber:u,drawEntries:e,drawName:i};if(a&&(c.stage=a),t&&(c.qualifyingPositions=t),(o?.flights||[]).find(({drawId:f})=>f===c.drawId))return z({result:{error:hK},stack:s});let d=(o?.flights||[]).concat(c),p={name:eo,value:{...o||{},flights:d}};return Gd({event:n,extension:p})}var XJ={};pt(XJ,{drawMatic:()=>u_,garman:()=>iQ,generateAdHocMatchUps:()=>TC,generateAdHocRounds:()=>l_,generateAndPopulatePlayoffStructures:()=>T0,generateCourts:()=>t$,generateDrawDefinition:()=>JS,generateDrawMaticRound:()=>$0,generateDrawStructuresAndLinks:()=>F0,generateDrawTypeAndModifyDrawDefinition:()=>L0,generateFlightProfile:()=>xRe,generateLineUps:()=>tQ,generateQualifyingStructure:()=>v0,generateSeedingScaleItems:()=>PJ,generateStatCrew:()=>FRe,generateVoluntaryConsolation:()=>lX,roundRobinGroups:()=>jwe});var kRe="splitLevelBased",JJ="splitWaterfall",QJ="splitShuttle",ORe={SPLIT_LEVEL_BASED:kRe,SPLIT_WATERFALL:JJ,SPLIT_SHUTTLE:QJ};function xRe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:s,sortDescending:o,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:f}=t;if(!p)return{error:ui};let h=p.entries??[],{flightProfile:m}=Bi({event:p});if(m&&i&&!s)return{error:M1};let g=t.scaledEntries??km({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:o,event:p,stage:f}).scaledEntries,I=new Set(g.map(bt)),v=Rn(h.filter(({participantId:P})=>!I.has(P)).filter(P=>(!f||!P.entryStage||P.entryStage===f)&&(!P.entryStatus||hf.includes(P.entryStatus)))),w=g.concat(...v),y=w.length,b=Math.ceil(y/u),S=br(w,b);c===JJ?S=UO(w,u):c===QJ&&(S=UO(w,u,!0));function U(P){return(P||[]).map(({participantId:E,scaleValue:R})=>{let C=h.find(M=>M.participantId===E);return C?.scaleValue&&R&&(C.scaleValue=R),C}).sort((E,R)=>E.scaleValue-R.scaleValue).map((E,R)=>(E.scaleValue&&(E.seedNumber=R+1),E))}let T=Re(0,u).map(P=>{let E=P+1;return{flightNumber:E,drawId:d?.pop()??Pt(),drawEntries:U(S[P]),drawName:l?.length&&l[P]||`${e} ${E}`}}),D={scaleAttributes:n,splitMethod:c,flights:T};if(i){let P=Z_({flightProfile:D,deleteExisting:s,event:p});return{splitEntries:ua()&&S||void 0,...P}}else return{flightProfile:D,...H}}function ZJ({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(s=>typeof s=="object"&&Object.keys(s).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return eQ({tagName:e,attributes:n,childArrays:i,childObjects:r})}function eQ(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,s=f=>{let h=Object.keys(f)[0],m=f[h];return{key:h,value:m}},o=r?.map(({key:f,value:h})=>eQ({tagName:f,childObjects:h.map(s)})).join(`\r
`),l=n?.map(({key:f,value:h})=>ZJ({tagName:f,json:h??[]})).join(`\r
`),u=i?.map(({key:f,value:h})=>`${f}="${h}"`).join(" "),c=u?` ${u}`:"";if(e==="childArray")return l;let d=l?.length?`${a}${l}${a}`:"",p=o?.length?`${a}${o}${a}`:"";return`<${e}${c}>${d}${p}</${e}>`}function FRe(t){let e=Ge(t,[{[mr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:r,tournamentId:n,tournamentName:a}=i,{participantMap:s,matchUps:o,mappedMatchUps:l}=Pi({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),u=i.participants.filter(w=>w.participantType===_t),c=o?.filter(w=>w.matchUpType===_t)??[],d=c?.reduce((w,y)=>{let b=y?.tieMatchUps??[];return b&&[...w,...b]},[])??[],p=o?.filter(w=>w.matchUpType===zt)??[],f=o?.filter(w=>w.matchUpType===Bt)??[],h=d.length===p.length+f.length,m=c.length===1&&h,g={mappedMatchUps:l,participantMap:s,tournamentName:a,tournamentId:n,tournament:h?"N":"Y",startDate:r},I=[],v=[];if(m){let w=c[0],{json:y,xml:b}=wz({teamParticipants:u,teamMatchUp:w,...g,doubles:f,singles:p});v.push(y),I.push(b)}else for(let w of c){let y=w?.sides?.map(({participant:T})=>T?.participantId).filter(Boolean);if(y?.length!==2)continue;let b=y.map(T=>T&&s?.[T]?.participant),{xml:S,json:U}=wz({doubles:w.tieMatchUps?.filter(T=>T.matchUpType===Bt),singles:w.tieMatchUps?.filter(T=>T.matchUpType===zt),teamParticipants:b,teamMatchUp:w,...g});v.push(U),I.push(S)}return{json:v,xml:I,...H}}function wz({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:s,startDate:o,doubles:l,singles:u}){let c=t?.find(y=>y.participantRoleResponsibilities?.includes("Home")),d=t?.filter(y=>y.participantId!==c?.participantId),p=_s(o,"/","MDY"),f=c?.participantName||d?.[1]?.participantName,h=c?.participantId||d?.[1]?.participantId,m=d?.[0]?.participantName,g=d?.[0]?.participantId,I={},v=t.map(y=>({team:{...$Re({teamParticipant:y,teamMatchUp:a,uniValues:I,participantMap:i,mappedMatchUps:e,homeid:h})}})),w=Ve({venue:{tournamentname:s?r:void 0,neutralgame:c?"N":"Y",gameid:n,officials:{},tournament:s,rules:{},homename:f,visname:m,homeid:h,visid:g,date:p},childArray:v,singles_matches:u?.map(y=>Sz({matchUp:y,homeid:h,uniValues:I})),doubles_matches:l?.map(y=>Sz({matchUp:y,homeid:h,uniValues:I}))});return{json:w,xml:ZJ({json:w,tagName:"tngame"})}}function LRe({homeid:t,uniValues:e,participant:i}){if(!i)return{};let r=i.individualParticipants?.length===2,n=r?ot(i.individualParticipants?.map(m=>m.teams?.[0]?.participantId)):[],a=r?ot(i.individualParticipants?.map(m=>m.teams?.[0]?.teamId)):[],s=!r&&i.teams?.[0]?.participantId||n?.length===1&&n[0]||void 0,o=!r&&i.teams?.[0]?.teamId||a?.length===1&&a[0]||s,l=r?void 0:i.participantName,u=i.individualParticipants?.[0]?.participantName,c=i.individualParticipants?.[1]?.participantName,d=t&&(s===t?"H":"V")||"",p=r?void 0:e[s][i.participantId],f=e[s][i.individualParticipants?.[0]?.participantId],h=e[s][i.individualParticipants?.[1]?.participantId];return Ve({vh:d,uni:p,uni_1:f,uni_2:h,team:o,name:l,name_1:u,name_2:c})}function _Re({sets:t,sideNumber:e}){return Object.assign({},...t?.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o}=i,l=`set_${r}`,u=`tie_${r}`,c=e===1?n:a,d=e===1?s:o;return{[l]:c,[u]:d}})??[])}function $Re({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){let{participantId:s,participantName:o}=t,l=n&&(s===n?"H":"V")||"",u=i?.[s]?.matchUps,c=u&&Object.keys(u),d=e?.sides?.find(({participant:y})=>y.participantId===s)?.sideNumber,p=e?.score?.sets?.[0]?.[`side${d}Score`]??0;a[s]={};let f={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},h=[],m=[],g=0;for(let y of c??[]){let b=r?.[y],S=b.sides.find(({participant:T})=>T.participantId===s)?.sideNumber,U=b.score?.sets?.[0]?.[`side${S}Score`]??0;g+=U;for(let T of b.tieMatchUps??[]){let{matchUpType:D,winningSide:P}=T,E=P&&(P===S?"w":"l")||"";E&&(f[D][E]+=1);let R=E==="w"?"1":"0",C=E==="l"?"1":"0";if(D===zt){let M=m.length+1;m.push({singles_pair:{pair:M,won:R,lost:C,tied:"0"}})}else if(D===Bt){let M=h.length+1;h.push({doubles_pair:{pair:M,won:R,lost:C,tied:"0"}})}}}let I=[{singles:{childArray:m,won:f.SINGLES.w,lost:f.SINGLES.l}},{doubles:{childArray:h,won:f.DOUBLES.w,lost:f.DOUBLES.l}}],v=[],w=1;for(let y of t.individualParticipantIds){let b=i?.[y];if(b){let{participant:S,counters:U}=b,T={won:U?.DOUBLES?.wins||0,lost:U?.DOUBLES?.losses||0},D={won:U?.SINGLES?.wins||0,lost:U?.SINGLES?.losses||0},{participantName:P,participantId:E}=S;a[s][E]=w,v.push({player:{name:P,uni:w,singles:D,doubles:T}})}w+=1}return{vh:l,id:s,name:o,score:p||g,totals:I,childArray:v}}function Sz({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:s}=t??{},o=s?.map(l=>{let{sideNumber:u,participant:c}=l,d=_Re({sets:t.score?.sets,sideNumber:u});return{[a===zt?"singles_score":"doubles_score"]:{...LRe({homeid:e,uniValues:i,participant:c}),...d}}});return{[a===zt?"singles_match":"doubles_match"]:{match:r,order:n,childArray:o}}}var BRe="DESC",gx="DESC",VRe={ASC:"ASC",ASCENDING:"ASC",DESC:BRe,DESCENDING:gx};function tQ(t){let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:s,attach:o,event:l}=t;if(l?.eventType!==Da)return{error:uu};if(!r)return{error:ge};if(!e&&!n)return{error:ja};if(e=e??yn({drawDefinition:n,event:l})?.tieFormat,Hn({tieFormat:e}).error)return{error:Kl};if(typeof a!="object"&&!i)return{error:ie,context:{scaleAccessor:a}};let u={},c=(n?.entries??l?.entries??[]).filter(E=>E?.entryStatus===da).map(bt),{participants:d=[]}=Pi({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=d.filter(({participantId:E})=>c.includes(E)),f=E=>E===Iu?"rankings":"ratings",h=l?.category?.categoryName??l?.category?.ageCategoryCode,{scaleName:m=h,scaleType:g=Iu,sortOrder:I,accessor:v}=a||{},w=f(g),y=(E,R)=>{let C=E[w]?.[R];if(!C&&i&&(C=E[w]?.[oh]),Array.isArray(C)){let M=C.find(N=>N.scaleName===m)?.scaleValue;if(Mi(M))return M;if(v&&typeof M=="object")return M[v]}return 0},b=(E,R,C)=>{let M=I===gx?R:E,N=I===gx?E:R;return y(M,C)-y(N,C)},S=(E,R)=>b(E,R,oh),U=(E,R)=>b(E,R,Rp),T=[],D=e?.collectionDefinitions??[];for(let E of p){let R=E.individualParticipants?.sort(S)??[],C=s?R:E.individualParticipants?.sort(U)??[],M={};for(let A of D){let O=[],{collectionId:k,matchUpCount:F,matchUpType:x,gender:L}=A,$=Ti(oh)(x);Re(0,F).forEach(V=>{let _=$?R:C??[],B=V+1,G=[];Re(0,$?1:2).forEach(j=>{let Y=_?.find(K=>{let X=ln(L),Z=X&&(cl(L)&&X||$a(L)&&[Zi,Lr][j]);return(!Z||Z===K.person?.sex)&&!O.includes(K.participantId)})?.participantId;Y&&(G.push(Y),O.push(Y),M[Y]||(M[Y]=[]),M[Y].push({collectionPosition:B,collectionId:k}))}),$||T.push(G)})}let N=Object.keys(M).map(A=>({collectionAssignments:M[A],participantId:A}));u[E.participantId]=N}let P=[];for(let E of T){let{participant:R}=io({tournamentParticipants:d,participantIds:E});if(!R){let C={individualParticipantIds:E,participantRole:Xr,participantType:ht};P.push(C)}}if(o){for(;P.length;)Il({participant:P.pop(),tournamentRecord:r});gt({element:n,extension:{name:Ic,value:u}})}return{...H,lineUps:u,participantsToAdd:P}}function t$(t){if(!t)return{error:Xe};let e=Ge(t,[{dates:!1,[qr]:s=>Array.isArray(s)&&s.every(Cn)},{uuids:!1,[qr]:s=>Array.isArray(s)&&s.every(ni)},{startTime:!1,endTime:!1,[qr]:$1},{idPrefix:!1,namePrefix:!1,[qr]:ni},{count:!0,[qr]:Mi}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&aI(i,r)||[],a=Re(1,t.count+1).map(s=>Ve({courtId:t.uuids?.pop()??(t.idPrefix&&`${t.idPrefix}-${s}`)??Pt(),courtName:t.courtNames?.pop()??(t.namePrefix&&`${t.namePrefix} ${s}`),dateAvailability:n.map(o=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:o}))}));return{...H,courts:a}}var iQ={};pt(iQ,{default:()=>HRe,garman:()=>aQ});function kv(t){let e=Ge(t,[{courtDate:!0,_ofType:Qn}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=tr(r.startTime);(r.bookings||[]).filter(o=>!o.bookingType||!i.includes(o.bookingType)).sort((o,l)=>(nP(o.startTime)||"").localeCompare(nP(l.startTime)||"")).forEach(o=>{let l={startTime:di(a.toISOString()),endTime:o.startTime};tr(o.startTime)>a&&n.push(l),tr(o.endTime)>a&&(a=tr(o.endTime))});let s={startTime:di(a.toISOString()),endTime:r.endTime};return tr(r.endTime)>a&&n.push(s),{timeSlots:n}}function jRe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=s=>{let{timeSlots:o}=kv({includeBookingTypes:e,courtDate:s});return!!o?.filter(a)?.length};function a(s){let o=tr(s.startTime),l=tr(s.endTime);return o>i||l<r?!1:Qw(i,l)>=t}return{enoughTime:n}}function rQ(t){let e=Ge(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:sn}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,s=t.courts,o=tr(n),l=V1(o,i),{enoughTime:u}=jRe({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:o,periodEndTime:l});return{availableToScheduleCount:(s?.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=Pd({date:a,court:c});return!!(d&&u(d))})||[]).length,...H}}function tM(t){let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(a)||!a.length)return{error:ie,courts:a};if(!Array.isArray(s))return{error:tP};if(!Cn(n))return{error:qi};i&&(Array.isArray(i)?i.includes(n)&&(s=[]):s=[]);let{courtBookings:o,unassignedBookings:l}=s.reduce((p,f)=>{let{courtId:h}=f;return h?p.courtBookings[h]?p.courtBookings[h].push(f):p.courtBookings[h]=[f]:p.unassignedBookings.push(f),p},{courtBookings:{},unassignedBookings:[]}),u=a.map((p,f)=>{let{courtId:h,courtName:m}=p,g=o[h]||[],I=Pd({date:n,court:p})||{},{bookings:v=[],startTime:w,endTime:y,date:b}=I,S=[e[f]&&{startTime:w,endTime:e[f]},...Oe(v,!1,!0),...g].filter(Boolean);return{courtId:h,courtName:m,dateAvailability:{bookings:S,startTime:w,endTime:y,date:b}}});l.sort((p,f)=>Mt(p.startTime)-Mt(f.startTime));let c=()=>u.flatMap(p=>{let f=p.dateAvailability,{timeSlots:h=[]}=kv({courtDate:f});return{courtName:p.courtName,courtId:p.courtId,timeSlots:h}}),d=[];for(let p of l){let{startTime:f,endTime:h,averageMinutes:m,recoveryMinutes:g,matchUpId:I}=p,v=Mt(f),w=Mt(h),y=c().reduce((b,{courtId:S,courtName:U,timeSlots:T})=>{let D;return T.find(({startTime:P,endTime:E})=>{D=Mt(P)-v;let R=v>=Mt(P);return w<=Mt(E)&&b.startDifference!==0&&((D===0||D+r>=0)&&(b.startDifference===void 0||D<b.startDifference)||R)})?{courtName:U,courtId:S,startDifference:D}:b},{});if(y.courtId){let b={averageMinutes:m,recoveryMinutes:g,matchUpId:I,startTime:f,endTime:h};d.push(b),u.find(({courtId:S})=>S===y.courtId)?.dateAvailability.bookings.push(b)}else console.log({unassignedBooking:p})}return{virtualCourts:u.map(({courtId:p,courtName:f,dateAvailability:h})=>({dateAvailability:[h],courtName:f,courtId:p})),assignedBookings:d}}function iM({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function nQ(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return Re(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function wI({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,s)=>{let o=Pd({date:t,court:s}),l=n&&(o?.[n]||s[n]);return l&&(!a||e&&Mt(l)<Mt(a)||i&&Mt(l)>Mt(a))?l:a},void 0)}function GRe({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||wI({courts:r,scheduleDate:n,startTime:!0}),i=i||wI({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let s=tr(e),o=tr(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let u=Pd({court:l,date:n}),{timeSlots:c}=kv({courtDate:u});c?.forEach(d=>{let p=tr(d.startTime),f=tr(d.endTime);if(p>o||p<s||f<s)return!1;if(Qw(p,f)>=t){let h=di(p.toISOString());h&&(!a||h<a)&&(a=h)}})}}return{firstTimeSlotStartTime:a}}function i$(t){let e=Ge(t,[{courts:!0,_ofType:sn}]);if(e.error)return e;let{date:i=_1(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:s}=t,{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||iM({averageMatchUpMinutes:u}),i=Qe(i),r=di(r),n=di(n);let f=0,h=0,m=0,g=0,I=0;!s&&d&&(s=nQ({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:v}=tM({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:s}),{firstTimeSlotStartTime:w}=GRe({averageMinutes:u,courts:v,startTime:r,endTime:n,date:i});o&&w&&(r=w??r);let y=Mt(r),b=Mt(n)-y,S=Math.floor(b/a),U=Re(0,S+1).map(T=>{let D=y+T*a,P=Tve(D),E=rQ({courts:v??[],averageMatchUpMinutes:u,periodStart:P,date:i});if(E.error)return{error:E.error};let{availableToScheduleCount:R=0}=E,C=R>h?R-h:0;I+=T?R:0;let M=T?I/T:R,N=a*M/u,A=T?N*(T-1)+M:M,O=R?h&&A-f||C:0;f=A,h=R,m+=O;let k=Ye(m)-g;return g+=k,{periodStart:P,add:k,availableToScheduleCount:R,newCourts:C,totalMatchUps:g}});return{scheduleTimes:U.reduce((T,D)=>{let P=Re(0,D.add).map(()=>({scheduleTime:D.periodStart}));return T.concat(...P)},[]).flat(),timingProfile:U,totalMatchUps:g}}var aQ={getCourtsAvailableAtPeriodStart:rQ,generateTimeSlots:kv,getScheduleTimes:i$,courtGenerator:nQ},HRe=aQ,sQ={};pt(sQ,{isAggregateFormat:()=>OC,isValid:()=>Ga,isValidMatchUpFormat:()=>Ga,parse:()=>Ki,stringify:()=>DR});var oQ={};pt(oQ,{allCompetitionMatchUps:()=>Oo,allDrawMatchUps:()=>Nn,allEventMatchUps:()=>Lu,allTournamentMatchUps:()=>wr,analyzeMatchUp:()=>Kb,applyLineUps:()=>MQ,assignMatchUpSideParticipant:()=>uQ,assignTieMatchUpParticipantId:()=>AP,bulkMatchUpStatusUpdate:()=>PQ,calculateWinCriteria:()=>Om,checkInParticipant:()=>n$,checkMatchUpIsComplete:()=>bp,checkOutParticipant:()=>r$,competitionScheduleMatchUps:()=>XS,disableTieAutoCalc:()=>UQ,drawMatchUps:()=>B_,enableTieAutoCalc:()=>bQ,eventMatchUps:()=>YC,filterMatchUps:()=>Qu,findMatchUp:()=>D_,getAllDrawMatchUps:()=>rr,getAllStructureMatchUps:()=>kt,getCheckedInParticipantIds:()=>Um,getCompetitionMatchUps:()=>Yb,getEventMatchUpFormatTiming:()=>N_,getHomeParticipantId:()=>x_,getMatchUpCompetitiveProfile:()=>SS,getMatchUpContextIds:()=>F_,getMatchUpDailyLimits:()=>XC,getMatchUpDailyLimitsUpdate:()=>A_,getMatchUpDependencies:()=>fo,getMatchUpFormat:()=>L_,getMatchUpFormatTiming:()=>US,getMatchUpFormatTimingUpdate:()=>M_,getMatchUpScheduleDetails:()=>rC,getMatchUpType:()=>nC,getMatchUpsStats:()=>__,getModifiedMatchUpFormatTiming:()=>qC,getParticipantResults:()=>RS,getPredictiveAccuracy:()=>O_,getRoundMatchUps:()=>wn,getRounds:()=>$_,isValidMatchUpFormat:()=>Ga,matchUpActions:()=>SC,mutate:()=>lQ,participantScheduledMatchUps:()=>k_,query:()=>yJ,removeDelegatedOutcome:()=>wQ,removeMatchUpSideParticipant:()=>o$,removeTieMatchUpParticipantId:()=>dQ,replaceTieMatchUpParticipantId:()=>s$,resetAdHocMatchUps:()=>RQ,resetMatchUpLineUps:()=>h$,resetScorecard:()=>g$,resetTieFormat:()=>m$,setDelegatedOutcome:()=>EQ,setMatchUpFormat:()=>TQ,setMatchUpState:()=>yf,setMatchUpStatus:()=>ZS,setOrderOfFinish:()=>CQ,substituteParticipant:()=>SQ,tallyParticipantResults:()=>Dm,toggleParticipantCheckInState:()=>rM,tournamentMatchUps:()=>KC,updateTieMatchUpScore:()=>Hc,validMatchUp:()=>JR,validMatchUps:()=>Ja});var lQ={};pt(lQ,{applyLineUps:()=>MQ,assignMatchUpSideParticipant:()=>uQ,assignTieMatchUpParticipantId:()=>AP,bulkMatchUpStatusUpdate:()=>PQ,checkInParticipant:()=>n$,checkOutParticipant:()=>r$,disableTieAutoCalc:()=>UQ,enableTieAutoCalc:()=>bQ,findMatchUp:()=>D_,removeDelegatedOutcome:()=>wQ,removeMatchUpSideParticipant:()=>o$,removeTieMatchUpParticipantId:()=>dQ,replaceTieMatchUpParticipantId:()=>s$,resetAdHocMatchUps:()=>RQ,resetMatchUpLineUps:()=>h$,resetScorecard:()=>g$,resetTieFormat:()=>m$,setDelegatedOutcome:()=>EQ,setMatchUpFormat:()=>TQ,setMatchUpState:()=>yf,setMatchUpStatus:()=>ZS,setOrderOfFinish:()=>CQ,substituteParticipant:()=>SQ,toggleParticipantCheckInState:()=>rM,updateTieMatchUpScore:()=>Hc});function uQ({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){if(i&&typeof i!="string")return{error:No};if(!e)return{error:_e};if(!n)return{error:Tn};let s=r===void 0;if(s&&(r=1),![1,2].includes(r))return z({result:{error:ie,context:{sideNumber:r}}});let{matchUp:o,structure:l}=pi({drawDefinition:e,matchUpId:n,event:a});if(!o)return{error:cn};if(!(!l?.structures&&!(e.drawType&&e.drawType!==ca)&&!l?.matchUps?.find(({roundPosition:u})=>!!u)))return{error:c1};if(!i&&(o?.score?.scoreStringSide1||Ji.includes(o?.matchUpstatus)||o?.matchUpStatus&&[Si,Wi].includes(o.matchUpStatus)))return{error:fR,info:"matchUp has completed status or score"};if(o){if(o.sides=[1,2].map(u=>{let c=o.sides?.find(d=>d.sideNumber===u)??{sideNumber:u};return r===u?{...c,participantId:i}:c}),s)for(let u of o.sides)u.sideNumber&&(u.sideNumber=3-u.sideNumber);Tt({tournamentId:t?.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:o})}return{...H,sidesSwapped:s}}function Ea({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s,event:o}){let{matchUp:l}=pi({drawDefinition:r,event:o,matchUpId:a});if(!l)return{error:cn};let u=kl({removePriorValues:t,element:l,duplicateValues:i,timeItem:s});return n||Tt({tournamentId:e?.tournamentId,eventId:o?.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),u}function r$(t){let e=[{[mr]:!0},{[mn]:!0},{[gu]:!0},{[Nl]:!0}],i=Ge(t,e);if(i.error)return i;let r=Cv(t,[{[pv]:xu,attr:{[FR]:!0}}]);if(r.error)return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=r?.matchUp?.matchUp,{matchUpStatus:u,score:c}=l??{};if(u&&dL.includes(u)||u&&Ji.includes(u)||dr({score:c}))return{error:h4};let d=Um({matchUp:l});if(d?.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:f}=d??{};if(!f?.includes(s))return{error:No};if(!p?.includes(s))return{error:q4};let h=k7({matchUp:l});if(h?.error)return h;let{sideParticipantIds:m,nestedIndividualParticipantIds:g}=h??{},I=m?.indexOf(s);return I!==void 0&&[0,1].includes(I)&&(g?.[I]??[]).forEach(v=>{Ea({drawDefinition:a,matchUpId:o,timeItem:{itemType:gP,itemValue:v}})}),Ea({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:gP}}),{...H,checkedOut:!0}}function n$(t){let e=[{[mr]:!0},{[mn]:!0},{[gu]:!0},{[Nl]:!0}],i=Ge(t,e);if(i[$s])return i;let r=Cv(t,[{[pv]:xu,attr:{[FR]:!0}}]);if(r[$s])return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=Um({matchUp:r?.matchUp?.matchUp});if(l?.error)return l;let{checkedInParticipantIds:u,allRelevantParticipantIds:c}=l??{};if(!c?.includes(s))return{[$s]:No};let d={...H,checkedIn:!0};return u?.includes(s)||Ea({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:mP}}),d}function rM(t){let e=Ge(t,[{[gu]:!0,[mn]:!0,[Nl]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,r=t.tournamentRecord??(i&&t.tournamentRecords?.[i]);if(!r)return{error:ge};let n=Cv(t,[{[pv]:xu,attr:{[FR]:!0},[$s]:cn}]).matchUp?.matchUp;if(!n)return{error:cn};let{checkedInParticipantIds:a=[]}=Um({matchUp:n}),{participantId:s,matchUpId:o,drawDefinition:l}=t;return s&&a.includes(s)?r$({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n}):n$({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n})}function a$({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){if(!t)return{error:ge};if(!e)return{error:Vo};if(!r)return{error:ds};let n=Or({drawDefinition:e}),{matchUp:a}=pi({matchUpId:i,drawDefinition:e,matchUpsMap:n});if(!a)return{error:cn};let{matchUp:s,structure:o}=pi({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:n,event:r});if(!s)return{error:cn};let{collectionPosition:l,drawPositions:u,collectionId:c,matchUpTieId:d,matchUpType:p}=s;if(p&&!lh([zt,Bt],p))return{error:la};let{positionAssignments:f}=Kt({structure:o}),h=f?.filter(S=>u?.includes(S.drawPosition)),{matchUp:m}=pi({matchUpId:d,drawDefinition:e,matchUpsMap:n}),g=m?.sides?.map(bt)??[],I=h?.map(bt)??[],v=[...g,...I],{participants:w}=Pi({tournamentRecord:t,participantFilters:{participantTypes:[_t],participantIds:v}}),{matchUp:y}=pi({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:n}),b=yn({matchUp:m,drawDefinition:e,structure:o,event:r})?.tieFormat;return{inContextDualMatchUp:y,inContextTieMatchUp:s,relevantAssignments:h,collectionPosition:l,teamParticipants:w,collectionId:c,matchUpType:p,dualMatchUp:m,tieMatchUp:a,tieFormat:b,structure:o,...H}}function s$(t){let e=a$(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:s,substitution:o,event:l}=t;if(!r||!a)return z({result:{error:ur},stack:i});if(r===a)return{...H};let{inContextDualMatchUp:u,inContextTieMatchUp:c,collectionPosition:d,collectionId:p,dualMatchUp:f,tieMatchUp:h,tieFormat:m}=e,g=c?.matchUpType,I=c?.sides?.find(k=>k.participant?.participantId===r||k.participant?.individualParticipantIds?.includes(r));if(!I)return{error:ji};let v=Pi({tournamentRecord:n,participantFilters:{participantIds:[r,a]}})?.participants??[];if(v.length!==2)return z({result:{error:ur},stack:i});if(v[0].participantType!==v[1].participantType)return z({result:{error:Ao},stack:i});let{appliedPolicies:w}=Rt({tournamentRecord:n,drawDefinition:s,event:l}),y=t.policyDefinitions?.[Cr]??w?.[Cr]??Sv[Cr],b=v.find(({participantId:k})=>k===a);if((t.enforceGender??y?.participants?.enforceGender)!==!1&&cl(c?.gender)&&ln(c?.gender)!==ln(b?.person?.sex))return{error:Cp,info:"Gender mismatch"};let S=y?.processCodes?.substitution;$S({tournamentId:n.tournamentId,eventId:l.eventId,inContextDualMatchUp:u,drawDefinition:s,dualMatchUp:f});let U=f?.sides?.find(({sideNumber:k})=>k===I.sideNumber);if(!U)return z({result:{sideNumber:I.sideNumber,existingParticipantId:r,error:Vr},stack:i});if(c?.sides?.flatMap(k=>k.participant?.individualParticipantIds||k.participant?.participantId||[])?.includes(a))return z({result:{error:mR},stack:i});let T=u?.sides?.find(({sideNumber:k})=>k===I.sideNumber)?.participantId,D=U.lineUp,P=D?.find(({participantId:k})=>a===k),E=D?.reduce((k,F)=>F.substitutionOrder>k?F.substitutionOrder:k,0),R=D?.map(k=>{let F=Oe(k,!1,!0);if(![r,a].includes(F.participantId))return F;if(!o&&[r,a].includes(F.participantId)&&(F.collectionAssignments=F.collectionAssignments?.filter(x=>!(x.collectionPosition===d&&x.collectionId===p))),o&&r===F.participantId&&(F.collectionAssignments=F.collectionAssignments.map(x=>x.collectionPosition===d&&x.collectionId===p&&x.substitutionOrder===void 0?{...x,substitutionOrder:E}:x)),F.participantId===a){F.collectionAssignments||(F.collectionAssignments=[]);let x={collectionId:p,collectionPosition:d};o&&(x.previousParticipantId=r,x.substitutionOrder=(E??0)+1),F.collectionAssignments.push(x)}return F})??[];if(!P){let k={collectionId:p,collectionPosition:d};o&&(k.substitutionOrder=(E??0)+1,k.previousParticipantId=r);let F={collectionAssignments:[k],participantId:a};R.push(F)}let C=g===Bt,{assignedParticipantIds:M}=yP({lineUp:D,collectionPosition:d,collectionId:p}),{assignedParticipantIds:N}=yP({lineUp:R,collectionPosition:d,collectionId:p});if(U.lineUp=R,T&&m){let k=Cm({participantId:T,lineUp:R,drawDefinition:s,tieFormat:m});if(k.error)return z({result:k,stack:i})}else console.log("team participantId not found");let A,O;if(C){let{tournamentRecord:k}=t,F=io({participantIds:N,tournamentRecord:k});if(!F.participant){let L=Il({returnParticipant:!0,pairOverride:!0,tournamentRecord:k,participant:{participantRole:Xr,individualParticipantIds:N,participantType:ht}});if(L.error)return z({result:L,stack:i});A=L.participant?.participantId}F=io({participantIds:M,tournamentRecord:k});let x=F.participant?.participantId;x&&Em({participantIds:[x],tournamentRecord:k}).success&&(O=x)}if(o||I.substitutions?.length===1){if(o)S&&h&&(h.processCodes=ot([...h?.processCodes??[],...S]));else for(let k of S||[]){let F=h?.processCodes?.lastIndexOf(k);F!==void 0&&h?.processCodes?.splice(F,1)}h&&Tt({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:s})}return f&&Tt({tournamentId:n?.tournamentId,matchUp:f,context:i,drawDefinition:s}),{...H,modifiedLineUp:R,participantRemoved:O,participantAdded:A}}function cQ({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){if(!a||!t||!Array.isArray(n))return{modifiedLineUp:i?.lineUp||[],error:ie};let s=i?.lineUp||Fp({participantId:e,drawDefinition:r})?.lineUp,o=[],l=[];return{modifiedLineUp:s?.map(u=>{if(!n.includes(u.participantId))return u;let c=u.collectionAssignments?.filter(d=>{let p=d.collectionId===a&&d.collectionPosition===t;return p&&(d.previousParticipantId&&o.push(d.previousParticipantId),l.push({participantId:u.participantId,...d})),!p});return{participantId:u.participantId,collectionAssignments:c}}).filter(Boolean)||[],assignmentsRemoved:l,previousParticipantIds:o}}function WRe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r=(i.events||[]).filter(a=>a?.eventType===sr&&a?.entries?.some(s=>s.participantId===e)),n=a=>!t.includes(a.participantId);for(let a of r){a.entries=(a.entries||[]).filter(n);let{flightProfile:s}=Bi({event:a});s?.flights?.forEach(o=>{o.drawEntries=(o.drawEntries||[]).filter(n)}),a?.drawDefinitions?.forEach(o=>{o.entries=(o.entries||[]).filter(n)})}return{...H}}function nM({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return z({result:{error:ge},stack:n});if(!e||!t)return z({result:{error:Xe},stack:n});let a=r.participants??[],s=a.find(d=>d.participantId===e);if(!s)return z({result:{error:ji},stack:n});if(s?.participantType&&![_t,Xa].includes(s.participantType))return z({context:{participantType:s.participantType},result:{error:Ao},stack:n});let o=t.filter(d=>a.find(p=>p.participantId===d)?.participantType!==vt);if(o.length)return z({result:{error:Sa,invalidParticipantIds:o},stack:n});s.individualParticipantIds||(s.individualParticipantIds=[]);let l=s.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&lC({individualParticipantIds:u,tournamentRecord:r}),s.individualParticipantIds=s.individualParticipantIds.concat(...u));let{topics:c}=bs();if(c.includes(tn)){let d=a.find(({participantId:p})=>p===e);nt({topic:tn,payload:{participants:[d]}})}return WRe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:Oe(s,!1,!0),added:u.length,...H}}function aM(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:s}=t;if(!n)return{error:ge};if(!s)return{error:dm};if(!s.participantId)return Il({tournamentRecord:n,participant:s});let{participant:o}=Wd({participantId:s.participantId,tournamentRecord:n});if(!o)return Il({tournamentRecord:n,participant:s});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:f,onlineResources:h,contacts:m,person:g}=s;if(f&&o.participantType!==f)return{error:$4};let I={};if(m&&(I.contacts=m),h&&(I.onlineResources=h),c&&ni(c)&&(I.participantOtherName=c),d&&ni(d)&&(I.participantName=d),Array.isArray(u)){let{participants:v}=Pi({participantFilters:{participantTypes:[vt]},tournamentRecord:n}),w=v?.map(bt);if(w){let y=u.filter(b=>ni(b)&&w.includes(b));([Xa,ei].includes(f||o.participantType)||f===ht&&(y.length===2||a))&&(I.individualParticipantIds=y),o.participantType===Jy.PAIR&&e&&(I.participantName=zRe({individualParticipants:v,newValues:I}))}}return Object.keys(XL).includes(p)&&(I.participantRole=p),Object.keys(Jy).includes(f)&&(I.participantType=f),Array.isArray(l)&&(I.participantRoleResponsibilties=l),o.participantType===Jy.INDIVIDUAL&&g&&qRe({updateParticipantName:e,existingParticipant:o,newValues:I,person:g}),Object.assign(o,Ve(I)),i&&nM({individualParticipantIds:[o.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),nt({topic:tn,payload:{tournamentId:n.tournamentId,participants:[o]}}),{participant:Oe(o),...H}}function zRe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n?.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function qRe({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:s,nationalityCode:o,personId:l,birthdate:u,tennisId:c,sex:d}=r;d&&Object.keys(UR).includes(d)&&(n.sex=d);let p;if(ni(l)&&(n.personId=l),o&&ni(o)&&(YRe(o)||o==="")&&(n.nationalityCode=o),a&&typeof ni(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),s&&typeof ni(s)&&s.length>1&&(n.standardGivenName=s,p=!0),p&&t){let f=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=f}u&&Cn(u)&&(n.birthdate=u),c&&ni(c)&&(n.tennisId=c),Object.assign(e.person,n)}function YRe(t){return ch.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function AP(t){let e=a$(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",r=t.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:s,event:o}=t;if(!s)return z({result:{error:ur},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return z({result:{error:A4},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:u,relevantAssignments:c,collectionPosition:d,teamParticipants:p,collectionId:f,matchUpType:h,dualMatchUp:m,tieFormat:g}=e;if(u?.sides?.flatMap(x=>x.participant?.individualParticipantIds||x.participant?.participantId||[])?.includes(s))return z({result:{...H},stack:i});r=r??(t.sideNumber?l?.sides?.find(x=>x.sideNumber===t.sideNumber)?.participantId:void 0);let I=Pi({participantFilters:{participantIds:[s]},tournamentRecord:n})?.participants?.[0];if(!I)return z({result:{error:ji},stack:i});let{appliedPolicies:v}=Rt({tournamentRecord:n,drawDefinition:a,event:o}),w=t.policyDefinitions?.[Cr]??v?.[Cr]??Sv[Cr];if((t.enforceGender??w?.participants?.enforceGender)!==!1&&cl(u?.gender)&&ln(u?.gender)!==ln(I.person?.sex))return{error:Cp,info:"Gender mismatch"};let{individualParticipantIds:y,participantType:b}=I;if(Ti(zt)(h)&&b!==vt)return{error:Ao};let S=b===vt?[s]:y,U=r&&p?.find(({participantId:x})=>x===r)||p?.find(({individualParticipantIds:x})=>Ln(S,x));if(!U)return{error:E1};if(r||(r=U.participantId),!r)return{error:ji};let T=c?.find(x=>x.participantId===U?.participantId)?.drawPosition,D=m?.sides?.find(x=>x.participantId===r)?.sideNumber,P=u?.sides?.find(x=>T&&x.drawPosition===T)?.sideNumber,E=D??P??t.sideNumber;if(!g)return{error:ov};if(!g.collectionDefinitions?.find(x=>x.collectionId===f))return{error:C4};$S({tournamentId:n.tournamentId,eventId:o.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:m});let R=m?.sides?.find(x=>x.sideNumber===E),C=u?.sides?.find(x=>x.sideNumber===E),M=(R?.lineUp??Fp({participantId:r,drawDefinition:a})?.lineUp)?.filter(x=>x.collectionAssignments?.find(L=>L.collectionPosition===d&&L.collectionId===f&&!L.previousParticipantId))?.map(x=>x?.participantId),N=M?.length>1&&M||(b===ht?I.individualParticipantIds:[s]),A=cQ({collectionPosition:d,teamParticipantId:r,dualMatchUpSide:R,drawDefinition:a,participantIds:N,collectionId:f});if(A.error)return z({result:A,stack:i});let{modifiedLineUp:O}=A,k;if(h===Bt){if(b!==ht){let x=hk({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:g});if(x?.error)return z({result:x,stack:i});if(x=F({side:C}),x.error)return x;k=x.deletedParticipantId,R&&(R.lineUp=O),m&&Tt({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:a})}else if(b===ht)for(let x of N)hk({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:x,collectionId:f,tieFormat:g})}else{let x=hk({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:g});if(x?.error)return x}if(R&&(R.lineUp=O),m&&Tt({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:a}),k){let{error:x}=Em({participantIds:[k],tournamentRecord:n});x&&console.log("cleanup")}return{...H,modifiedLineUp:O};function F({side:x}){let L;if(x.participant){let $=x.participant.individualParticipantIds||[];if($.filter(Boolean).length===1){let{participant:V}=io({participantIds:$,tournamentRecord:n});$.push(s);let{participant:_}=io({participantIds:$,tournamentRecord:n});if(!_&&V){V.individualParticipantIds=$;let B=aM({pairOverride:!0,tournamentRecord:n,participant:V});if(B.error)return B}else L=V?.participantId}}else{let $=Il({participant:{individualParticipantIds:[s],participantRole:Xr,participantType:ht},pairOverride:!0,tournamentRecord:n});if($.error)return $}return{...H,deletedParticipantId:L}}}function hk({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:s}){let o=Fp({participantId:e,drawDefinition:i})?.lineUp,l=(r||o)?.find(c=>c?.participantId===n),u={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(u);else{let c={collectionAssignments:[u],participantId:n};r.push(c)}return Cm({participantId:e,lineUp:r,drawDefinition:i,tieFormat:s})}function dQ(t){let{tournamentRecord:e,drawDefinition:i,participantId:r,event:n}=t,a="removeTieMatchUpParticiapantId";if(!r)return z({result:{error:ur},stack:a});let s=a$(t);if(s.error)return s;let{appliedPolicies:o}=Rt({tournamentRecord:e,drawDefinition:i,event:n}),l=(t.policyDefinitions?.[Cr]??o?.[Cr]??Sv[Cr])?.processCodes?.substitution,{inContextDualMatchUp:u,inContextTieMatchUp:c,relevantAssignments:d,collectionPosition:p,teamParticipants:f,collectionId:h,matchUpType:m,dualMatchUp:g,tieMatchUp:I,tieFormat:v}=s;if(!g)return z({result:{error:oa},stack:a});let w=c?.sides?.find(E=>E.participant?.participantId===r||E.participant?.individualParticipantIds?.includes(r));if(!w)return z({result:{error:ji},stack:a});let y=t.policyDefinitions?.[ko]??o?.[ko];if(!w.substitutions?.length&&(dr({score:c?.score})||c?.winningSide)&&y?.requireParticipantsForScoring!==!1)return z({result:{error:mK},stack:a});let b=u?.sides?.find(({sideNumber:E})=>E===w.sideNumber)?.participantId;if(!b)return z({result:{error:ji},stack:a});let S=Pi({participantFilters:{participantIds:[r]},tournamentRecord:e})?.participants?.[0];if(!S)return z({result:{error:ji},stack:a});if(m===zt&&S.participantType===ht)return z({result:{error:Cp},stack:a});let U=S.participantType===vt?[r]:S.individualParticipantIds;$S({tournamentId:e.tournamentId,eventId:n.eventId,inContextDualMatchUp:u,drawDefinition:i,dualMatchUp:g});let T=g.sides?.find(({sideNumber:E})=>E===w.sideNumber);if(!T&&(g.sides?.filter(({lineUp:E})=>!E).length||0)<2){let E=f?.map(({participantId:R})=>({drawPosition:d?.find(C=>C.participantId===R)?.drawPosition,teamParticipantId:R}));T=g.sides?.find(R=>E?.find(({drawPosition:C})=>C===R.drawPosition)?.teamParticipantId===b)}if(!T)return z({result:{error:ji,context:{participantId:r}}});let{modifiedLineUp:D,previousParticipantIds:P}=cQ({collectionPosition:p,teamParticipantId:b,dualMatchUpSide:T,participantIds:U,drawDefinition:i,collectionId:h});if(T.lineUp=D,b&&v&&Cm({participantId:b,lineUp:D,drawDefinition:i,tieFormat:v}),m===Bt&&S.participantType===vt){let E=c?.sides?.find(M=>M.sideNumber===T?.sideNumber),{participantId:R}=E??{},C=R&&Pi({participantFilters:{participantIds:[R]},tournamentRecord:e,withDraws:!0})?.participants?.[0];if(C){let M=C?.individualParticipantIds?.filter(N=>N!==r)??[];if(P&&M.push(...P),M.length>2)return z({result:{error:Sa},stack:a});if(C.draws?.length){if(M.length===1){let{participant:N}=io({participantIds:M,tournamentRecord:e});if(!N){let A=Il({participant:{participantRole:Xr,individualParticipantIds:M,participantType:ht},pairOverride:!0,tournamentRecord:e});if(A.error)return z({result:A,stack:a})}}}else if(M.length){C.individualParticipantIds=M;let N=aM({participant:C,pairOverride:!0,tournamentRecord:e});if(N.error)return z({result:N,stack:a})}else{let N=Em({participantIds:[R],tournamentRecord:e});N.error&&console.log("cleanup",{result:N})}}else return z({result:{error:ji},stack:a})}if(w.substitutions?.length===1&&!c?.sides?.find(E=>E.sideNumber!==w.sideNumber)?.substitutions?.length&&I?.processCodes?.length){for(let E of l||[]){let R=I.processCodes.lastIndexOf(E);I.processCodes.splice(R,1)}Tt({tournamentId:e?.tournamentId,matchUp:I,context:a,drawDefinition:i})}return Tt({tournamentId:e?.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...H,modifiedLineUp:D}}function o$(t){let e=Ge(t,[{[mr]:!0,[mn]:!0,[Nl]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=t;if(r&&![1,2].includes(r))return{error:ie,sideNumber:r};let{matchUp:s,structure:o}=pi({drawDefinition:i,matchUpId:n,event:a});return s?Wn({structure:o})?(s.sides?.forEach(l=>{(!r||l.sideNumber===r)&&delete l.participantId}),Tt({tournamentId:t.tournamentRecord?.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:s}),{...H}):{error:c1}:{error:cn}}function KRe({matchUpStatuses:t=["BYE",mi,Zt],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){let n=e?.reduce((c,d)=>!c||d.roundNumber>c.roundNumber?d:c,void 0),a=n?.drawPositions?.find(c=>c!==i),s=r.filter(c=>c?.drawPositions?.includes(a)).map(c=>c.matchUpStatus),o=r.filter(c=>c?.drawPositions?.includes(i)).map(c=>c.matchUpStatus),l=Ln(s||[],t),u=Ln(o||[],t);return{sourceMatchUp:n,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:s,loserHadMatchUpStatus:u,loserMatchUpStatuses:o}}function XRe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:s,dualMatchUp:o,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=et({drawDefinition:a,structureId:s});if(d?.structureType===hn)return{...H};u=u??Or({drawDefinition:a});let p=(u?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:f}=$h({drawPosition:i,matchUps:p}),h=p?.filter(g=>g.roundNumber>=l&&g.roundNumber!==f&&g.drawPositions?.includes(i)),{positionAssignments:m}=Kt({drawDefinition:a,structureId:s});for(let g of h??[])JRe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:o,matchUpsMap:u,matchUp:g,event:c});return{...H}}function JRe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:o,matchUpsMap:l,matchUp:u,event:c}){let d="removeSubsequentDrawPosition";if(o){let f=t.find(({matchUpId:m})=>u.matchUpId===m).sides?.find(m=>m.drawPosition===r)?.sideNumber,h=u.sides?.find(m=>m.sideNumber===f);h&&delete h.lineUp}u.drawPositions=(u.drawPositions||[]).map(f=>f===r?void 0:f).filter(Boolean);let p=e.filter(({drawPosition:f})=>u.drawPositions?.includes(f)).filter(f=>f.bye).length;return u.matchUpStatus=p&&"BYE"||$r(u.matchUpStatus)&&u.matchUpStatus||Li,$r(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&L8({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),Tt({tournamentId:n?.tournamentId,eventId:c?.eventId,context:`${d}-${r}`,drawDefinition:s,matchUp:u}),{...H}}function Ov(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:s,dualMatchUp:o,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,f=Wn({structure:c}),{drawPositions:h,winningSide:m}=l.matchUp||{};if(!f&&!h)return{error:Gw};let{targetLinks:{loserTargetLink:g,winnerTargetLink:I,byeTargetLink:v},targetMatchUps:{loserMatchUp:w,winnerMatchUp:y,byeMatchUp:b}}=l,S=Po({...t,matchUpStatus:a||Li,removeWinningSide:!0});if(S.error)return S;let U;if(p){let{matchUpTieId:O,matchUpsMap:k}=t;if(U=Hc({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:k,event:d}),!e&&!U.removeWinningSide)return{...H}}if(f)return{...H};let{matchUps:T}=kt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:s,structure:c}),{positionAssignments:D}=cr({structure:c}),P=m-1,E=1-P,R=h[P],C=h[E],{winnerParticipantId:M,loserParticipantId:N}=D?.reduce((O,k)=>(k.drawPosition===C&&(O.loserParticipantId=k.participantId),k.drawPosition===R&&(O.winnerParticipantId=k.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},A=T.filter(O=>O.drawPositions?.includes(C));if(y&&pQ({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:M,tournamentRecord:r,winnerTargetLink:I,drawDefinition:n,winnerMatchUp:y,dualMatchUp:o,matchUpsMap:s}),w){let{winnerHadMatchUpStatus:O}=KRe({drawPositionMatchUps:A,loserDrawPosition:C,sourceMatchUps:T}),k=g.linkCondition===fl;if(O&&k){let x=Math.min(...w.drawPositions);Ix({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:x,matchUpsMap:s,event:d})}let F=QRe({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:N,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:w,dualMatchUp:o,matchUpsMap:s,event:d});if(F.error)return F}if(b){let O=Math.min(...b.drawPositions);Ix({targetLink:v,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:s,event:d})}return{...H,...U&&{tieMatchUpResult:U}}}function pQ({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:o,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){let{structureId:p,roundNumber:f}=l,h="removeDirectedWinner";if(a){let m=a.target.structureId,{structure:g}=et({drawDefinition:o,structureId:m});if(!g)return{error:vi};let{positionAssignments:I}=cr({structure:g});g.seedAssignments=(g.seedAssignments??[]).filter(U=>U.participantId!==r);let v=I?.find(U=>U.participantId===r)?.drawPosition,{matchUps:w}=kt({drawDefinition:o,structure:g,event:d}),y=w.map(U=>U.drawPositions).flat(1/0).filter(Boolean),b=Ta(y);if((v?b[v]:void 0)===1)I?.forEach(U=>{U.participantId===r&&delete U.participantId});else{let U=w.filter(({drawPositions:T})=>T.includes(v));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:U,winnerTargetLink:a})}let S=u?.drawMatchUps?.find(({matchUpId:U})=>U===l.matchUpId);S&&Tt({tournamentId:n?.tournamentId,eventId:d?.eventId,matchUp:S,context:h,drawDefinition:o})}return f&&XRe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:s,drawDefinition:o,dualMatchUp:c,matchUpsMap:u,roundNumber:f,structureId:p}),{...H}}function QRe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,dualMatchUp:l,event:u}){let c="removeDirectedLoser",d=r.target.structureId,{structure:p}=et({drawDefinition:a,structureId:d});if(!p)return{error:vi};let{positionAssignments:f}=cr({structure:p}),h=f?.find(m=>m.participantId===e)?.drawPosition;if(f?.forEach(m=>{m.participantId===e&&delete m.participantId}),n&&t){let m=o?.drawMatchUps?.find(({matchUpId:g})=>g===s.matchUpId);m.matchUpStatusCodes=t===Si?["WO","WO"]:[]}if(p.seedAssignments=(p.seedAssignments??[]).filter(m=>m.participantId!==e),l){let m=s?.sides.reduce((v,w,y)=>w.drawPosition===h?y:v,void 0),g=o?.drawMatchUps?.find(({matchUpId:v})=>v===s.matchUpId),I=g?.sides?.[m];I&&(delete I.lineUp,Tt({tournamentId:i?.tournamentId,eventId:u?.eventId,matchUp:g,context:c,drawDefinition:a}))}return{...H}}function Ix({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:s}){let o=a.target.structureId,l="removeDirectedBye";Ht({color:"brightyellow",method:l,drawPosition:r});let u=ES({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:o,event:s});return z({result:u,stack:l})}function ZRe(t){let{matchUpFormat:e,score:i}=t,r=i?.sets?.length,n=e&&Ki(e),{setFormat:a,finalSetFormat:s,bestOf:o}=n??{};return(o&&r===o&&s||a)?.timed||!1}function eCe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){let n="attemptToSetMatchUpStatusBYE";if(r?.winningSide)return z({result:{error:sv},context:{matchUpStatus:"BYE"},stack:n});let{positionAssignments:a}=cr({structure:i}),s=a?.filter(o=>o.bye).map(o=>o.drawPosition);return r.drawPositions?.some(o=>s?.includes(o))?(r.matchUpStatus="BYE",r.matchUpStatusCodes=[],Tt({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:r}),{...H}):z({result:{error:P4},info:"matchUp does not include BYE",stack:n})}function ib(t){let{tournamentRecord:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:s,event:o}=t,l="doubleExitAdvancement";if(s.structureType===hn)return z({result:{...H},stack:l});let{matchUp:u,targetMatchUps:c,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:f,loserTargetDrawPosition:h}=c,m=$r(p?.matchUpStatus)&&!p.sides?.map(I=>I.participantId??I.participant).filter(Boolean).length,g=p?.matchUpStatus===Si;if(Ht({method:l,newline:!0,color:"brightyellow",keyColors:{sourceMatchUpId:"brightcyan",loserMatchUpId:"brightmagenta",winnerMatchUpId:"brightgreen"},sourceMatchUpId:u?.matchUpId,sourceStatus:t.matchUpStatus,sourceDP:JSON.stringify(u?.drawPositions),loserMatchUpId:p?.matchUpId,loserStatus:p?.matchUpStatus,loserDP:JSON.stringify(p?.drawPositions),loserTargetDP:h,loserIsEmptyExit:m,loserIsDoubleExit:g,loserSides:JSON.stringify(p?.sides?.map(I=>({sn:I.sideNumber,pid:I.participantId?.slice(0,8),fed:I.participantFed}))),winnerMatchUpId:f?.matchUpId,winnerStatus:f?.matchUpStatus,winnerDP:JSON.stringify(f?.drawPositions)}),p&&p.matchUpStatus!=="BYE"){let{loserTargetLink:I}=d,v=i?.progression?.doubleExitPropagateBye,w=p.feedRound&&p.sides?.[0]?.participantFed;if(v||w){Ht({method:l,color:"cyan",decision:"advanceByeToLoserMatchUp",propagateBye:v,targetFedIn:!!w});let y=fQ({loserTargetDrawPosition:h,tournamentRecord:e,loserTargetLink:I,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:o});if(y.error)return z({result:y,stack:l})}else if(m){let y=t.matchUpStatus===Wi?Wi:Si,b=t.matchUpStatus===Wi?Zt:mi,S=n.drawMatchUps.find(U=>U.matchUpId===p.matchUpId);if(Ht({method:l,color:"brightred",decision:"EMPTY_EXIT_converting_to_DOUBLE_EXIT",loserMatchUpId:p.matchUpId,currentStatus:p.matchUpStatus,newStatus:y}),S){let U=[{matchUpStatus:b,previousMatchUpStatus:y,sideNumber:1},{matchUpStatus:b,previousMatchUpStatus:t.matchUpStatus,sideNumber:2}].map(D=>Ve(D)),T=Po({...t,matchUp:S,matchUpId:p.matchUpId,matchUpStatus:y,matchUpStatusCodes:U,winningSide:void 0,removeScore:!0});if(T.error)return z({result:T,stack:l})}}else if(g)Ht({method:l,color:"brightyellow",decision:"SKIP_loserMatchUp_already_doubleExit",loserMatchUpId:p.matchUpId});else{let{feedRound:y,drawPositions:b,matchUpId:S}=p,U=y?2:2-b.indexOf(h);Ht({method:l,color:"cyan",decision:"conditionallyAdvanceLoser",feedRound:y,walkoverWinningSide:U,loserMatchUpId:S});let T=Uz({...t,targetMatchUp:p,walkoverWinningSide:U,tournamentRecord:e,sourceMatchUp:u,matchUpId:S});if(T.error)return z({result:T,stack:l})}}if(f){Ht({method:l,color:"cyan",decision:"conditionallyAdvanceWinner",winnerMatchUpId:f.matchUpId});let I=Uz({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:e,sourceMatchUp:u});if(I.error)return z({result:I,stack:l})}return z({result:{...H},stack:l})}function Uz(t){let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s}=t,o=r.structures.find(({structureId:_})=>_===a.structureId),l=t.matchUpStatus===Wi?Wi:Si,u=t.matchUpStatus===Wi?Zt:mi,c="conditionallyAdvanceDrawPosition",d=s.drawMatchUps.find(_=>_.matchUpId===a.matchUpId);if(!d)return{error:oa};let p=n?.drawPositions||[],f=d.drawPositions?.filter(Boolean),h=n?.structureId===a.structureId;if(Ht({method:c,newline:!0,color:"magenta",keyColors:{targetMatchUpId:"brightcyan",sourceMatchUpId:"brightyellow"},targetMatchUpId:a.matchUpId,targetStructureId:a.structureId?.slice(0,8),targetRound:[a.roundNumber,a.roundPosition],targetDP:JSON.stringify(d.drawPositions),targetStatus:d.matchUpStatus,targetFeedRound:a.feedRound,sourceMatchUpId:n?.matchUpId,sourceStructureId:n?.structureId?.slice(0,8),sourceRound:n?[n.roundNumber,n.roundPosition]:void 0,sourceDP:JSON.stringify(p),sameStructure:h,paramMatchUpStatus:t.matchUpStatus,EXIT:u,DOUBLE_EXIT:l}),h&&Ln(p,f)&&(f=f.filter(_=>!p.includes(_))),h&&f.length>1)return z({result:{error:iI},stack:c});let{pairedPreviousMatchUpIsDoubleExit:m,pairedPreviousMatchUp:g}=x8({...t,structure:o});Ht({method:c,color:"magenta",keyColors:{pairedMatchUpId:"brightcyan"},pairedMatchUpId:g?.matchUpId,pairedRound:g?[g.roundNumber,g.roundPosition]:void 0,pairedStatus:g?.matchUpStatus,pairedStructureId:g?.structureId?.slice(0,8),pairedIsDoubleExit:m});let I=_n({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:v,targetLinks:w}=I,{loserTargetDrawPosition:y,winnerMatchUp:b,loserMatchUp:S}=v;if(S){let{loserTargetLink:_}=w,B=fQ({loserTargetDrawPosition:y,loserMatchUp:S,tournamentRecord:i,loserTargetLink:_,drawDefinition:r,matchUpsMap:s});if(B.error)return z({result:B,stack:c})}let U=d.drawPositions?.filter(Boolean)||[],T=U.length===1,D=t.walkoverWinningSide||T&&yD({drawPosition:U[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,P=$r(d.matchUpStatus)&&!U.length,E=P?l:u;Ht({method:c,color:"brightyellow",keyColors:{matchUpStatus:"brightgreen",existingExit:"brightred"},existingExit:P,matchUpStatus:E,targetCurrentStatus:d.matchUpStatus,targetDP:JSON.stringify(U),hasDrawPosition:T,walkoverWinningSide:D});let R=e.find(_=>_.matchUpId===g.matchUpId),C=[],M;n&&(n?.structureId===R?.structureId?n.roundPosition<g?.roundPosition?M=1:M=2:a.feedRound?n.structureId===a.structureId?M=2:M=1:D&&(M=3-D),Ht({method:c,color:"cyan",keyColors:{sourceSideNumber:"brightgreen"},sourceSideNumber:M,sourceStructureId:n.structureId?.slice(0,8),pairedStructureId:R?.structureId?.slice(0,8),targetStructureId:a.structureId?.slice(0,8),sameStructureAsPaired:n?.structureId===R?.structureId,targetFeedRound:a.feedRound,sourceRP:n.roundPosition,pairedRP:g?.roundPosition}));let N=t.matchUpStatus,A=g?.matchUpStatus;M===1?C=[{matchUpStatus:VT(N),previousMatchUpStatus:N,sideNumber:1},{matchUpStatus:VT(A),previousMatchUpStatus:A,sideNumber:2}]:M===2&&(C=[{matchUpStatus:VT(A),previousMatchUpStatus:A,sideNumber:1},{matchUpStatus:VT(N),previousMatchUpStatus:N,sideNumber:2}]),C.length&&(C=C.map(_=>Ve(_))),Ht({method:c,color:"brightgreen",keyColors:{matchUpStatus:"brightcyan",winningSide:"brightyellow"},action:"modifyMatchUpScore",targetMatchUpId:d.matchUpId,matchUpStatus:E,winningSide:D,matchUpStatusCodes:JSON.stringify(C),sourceStatus:N,pairedStatus:A});let O=Po({...t,winningSide:D,matchUp:d,matchUpStatusCodes:C,matchUpStatus:E});if(O.error)return z({result:O,stack:c});if(P)return Ht({method:c,color:"brightred",decision:"EXISTING_EXIT_triggers_recursive_doubleExitAdvancement",targetMatchUpId:d.matchUpId,matchUpStatus:E}),ib({...t,matchUpStatus:E,targetData:I});if(!b)return z({result:{...H},stack:c});let k=f.length===2?f[D-1]:f[0],{positionAssignments:F}=Kt({structure:o}),x=F?.find(_=>_.drawPosition===k),L=s.drawMatchUps.find(_=>_.matchUpId===b.matchUpId),$=L?.drawPositions?.filter(Boolean),V=$.length===1;if(k){if(x?.bye){let _=_n({matchUpId:L.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(V){let B=$.filter(Boolean)[0],G=yD({drawPosition:B,matchUpId:L.matchUpId,inContextDrawMatchUps:e}),j=Po({appliedPolicies:t.appliedPolicies,matchUpId:L.matchUpId,matchUp:L,matchUpStatus:u,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,winningSide:G});return j.error?z({result:j,stack:c}):GL({drawPositionToAdvance:B,matchUpId:L.matchUpId,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}else if($r(b.matchUpStatus)){let B=ib({...t,matchUpId:L.matchUpId,matchUpStatus:E,targetData:_});if(B.error)return z({result:B,stack:c})}return z({result:{...H},stack:c})}return ph({matchUpId:b.matchUpId,drawPosition:k,inContextDrawMatchUps:e,drawDefinition:r})}else if(m){if(!L)return{error:oa};if(V){let G=$[0],j=yD({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:G});console.log("existing drawPosition is winningSide",{walkoverWinningSide:j})}let _=$r(L.matchUpStatus)?u:l,B=Po({matchUpId:L.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:L,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,matchUpStatus:_});if(B.error)return z({result:B,stack:c});if(_===l){let G=ib({...t,matchUpId:a.matchUpId,matchUpStatus:_,targetData:I});if(G.error)return G}}return z({result:{...H},stack:c})}function fQ(t){let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:s,loserMatchUp:o}=t,l=r?.target?.structureId,{structure:u}=et({drawDefinition:n,structureId:l});return u?Za({drawPosition:e,tournamentRecord:i,drawDefinition:n,structureId:l,matchUpsMap:a,loserMatchUp:o,event:s}):{error:sf}}function VT(t){return t===Si?mi:t===Wi?Zt:t}function tCe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,s=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),o="attemptToSetMatchUpStatus",l=r==="BYE",u=a.winningSide,c=[Si,Wi].includes(r),d=PS({matchUpStatus:r}),p=qO({matchUpStatus:r}),f=!d&&!p,h=t.matchUpTieId||u&&d&&!c,m=u&&c;Ht({method:o,newline:!0,color:"brightyellow",keyColors:{matchUpStatus:"brightcyan",matchUpId:"brightmagenta"},matchUpId:a.matchUpId,matchUpStatus:r,existingStatus:a.matchUpStatus,existingWinningSide:u,isDoubleExit:c,isBYE:l,directing:d,nonDirecting:p,unrecognized:f,onlyModifyScore:h,changeCompletedToDoubleExit:m,propagateExitStatus:t.propagateExitStatus,teamRoundRobinContext:s});let g=()=>Po({...t,removeScore:[Bc,mi].includes(r),matchUpStatus:r||Li}),I=f&&"unrecognized"||h&&"onlyModifyScore"||m&&"changeCompletedToDoubleExit"||u&&"existingWinningSide_removeDirected"||p&&"nonDirecting_clearScore"||l&&"isBYE"||!d&&"notDirecting_error"||c&&"isDoubleExit_modifyAndAdvance"||s&&"teamRoundRobinContext"||t.propagateExitStatus&&"propagateExitStatus"||"fallthrough_error";return Ht({method:o,color:"brightgreen",keyColors:{route:"brightcyan"},route:I,matchUpId:a.matchUpId}),f&&{error:EO}||h&&DD(t)||m&&iCe(t)||u&&Ov(t)||p&&g()||l&&eCe({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:EO}||c&&rCe(t)||s&&DD(t)||t.propagateExitStatus&&DD(t)||z({result:{error:sv,info:"matchUpStatus: "+r},stack:o})}function iCe(t){let e=Ov(t);return e.error?e:ib(t)}function rCe(t){let e=DD({...t,removeScore:!0});return e.error?e:ib(t)}function DD(t){let e="scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide){let n=Ov(t);if(n.error)return z({result:n,stack:e})}let i=!!t.matchUp.collectionId,r=Po({...t});if(i){let{matchUpTieId:n,drawDefinition:a,matchUpsMap:s}=t,o=Hc({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,event:t.event,drawDefinition:a,matchUpsMap:s});if(o.error)return z({result:o,stack:e});Object.assign(r,{tieMatchUpResult:o})}return z({result:r,stack:e})}function nCe({drawDefinition:t,structure:e,matchUp:i}){let{drawPositions:r}=i,{positionAssignments:n}=Kt({drawDefinition:t,structure:e}),a=n?.filter(({drawPosition:l})=>r?.includes(l))?.map(l=>{let{extension:u}=it({element:l,name:yc});return u?.value?.groupOrder}),{containerStructures:s}=gv({drawDefinition:t}),o=s[e.structureId];return{structureIds:Iv({drawDefinition:t,structureId:o})?.links?.source?.filter(l=>Ln(a,l.source?.finishingPositions||[])).map(l=>l.source.structureId)}}function hQ({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===kp&&yu({drawDefinition:t,structure:e})){let{structureIds:n}=nCe({drawDefinition:t,structure:e,matchUp:i});n?.length&&r.push(...n)}return{connectedStructureIds:r}}function aCe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===ks){let o=r.sides.find(({sideNumber:u})=>u!==a).participantId,l=i.find(u=>u.structureId===s.target.structureId&&u.roundNumber===s.target.roundNumber&&u.sides.some(({participantId:c})=>c===o));if(l?.matchUpStatus===Li){let u=_n({matchUpId:l.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Bp({inContextDrawMatchUps:i,drawDefinition:n,targetData:u})){let{structure:c}=et({structureId:l.structureId,drawDefinition:n}),d=Kt({structure:c}).positionAssignments;for(let p of d||[])if(p.participantId===o){let f=r.sides.find(({sideNumber:h})=>h===a).participantId;if(p.participantId=f,c?.positionAssignments)c.positionAssignments=d;else if(c?.structures){let h=Object.assign({},...(d||[]).map(m=>({[m.drawPosition]:m.participantId})));for(let m of c.structures)m.positionAssignments?.forEach(g=>g.participantId=h[g.drawPosition])}bc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:c}),e=!0}}}}return{...H,qualifierReplaced:e}}function sCe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===ks){let o=r.sides.find(({sideNumber:c})=>c===a)?.participantId,l=i.filter(c=>c.structureId===s.target.structureId&&c.roundNumber===s.target.roundNumber&&c.sides.some(({participantId:d,qualifier:p})=>p&&!d)),u=Ia(l);if(u?.matchUpStatus===Li){let c=_n({matchUpId:u.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Bp({inContextDrawMatchUps:i,drawDefinition:n,targetData:c})){let d=u.sides.find(h=>h.qualifier&&!h.participantId)?.drawPosition,{structure:p}=et({structureId:u.structureId,drawDefinition:n});if(!p)return{error:vi};let f=Kt({structure:p}).positionAssignments;for(let h of f||[])if(h.drawPosition===d&&!h.participantId){if(h.participantId=o,p.positionAssignments)p.positionAssignments=f;else if(p.structures){let m=Object.assign({},...(f||[]).map(g=>({[g.drawPosition]:g.participantId})));for(let g of p.structures)g.positionAssignments?.forEach(I=>I.participantId=m[I.drawPosition])}bc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:p}),e=!0}}}}return{...H,qualifierPlaced:e}}function oCe(t){let e="attemptToSetWinningSide",i,r={},{appliedPolicies:n,disableAutoCalc:a,drawDefinition:s,dualMatchUp:o,winningSide:l,structure:u,matchUp:c}=t;if(o?._disableAutoCalc&&a!==!1)return S0(t);if(c.winningSide&&c.winningSide!==l){let{connectedStructureIds:h}=hQ({drawDefinition:s,structure:u,matchUp:c});h.length&&(console.log({connectedStructureIds:h}),i=!0);let m=Ov(t);if(m.error)return m}let d=U9(t);if(d.context?.progressExitStatus&&Object.assign(r,d.context),d.error)return z({result:d,stack:e});let p,f;return t.qualifierChanging&&n?.[$b]?.autoReplaceQualifiers&&(p=aCe(t).qualifierReplaced),t.qualifierAdvancing&&n?.[$b]?.autoPlaceQualifiers&&(f=sCe(t).qualifierPlaced),z({result:Ve({...H,...d,connectedStructures:i,qualifierReplaced:p,qualifierPlaced:f,context:r}),stack:e})}var PD={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function mQ(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:s}=t,{matchUpId:o}=s,{iteration:l=0}=t;l+=1;let u="removeDoubleExit";Ht({color:"brightyellow",method:u,matchUpId:o,iteration:l,keyColors:PD});let{targetMatchUps:{loserMatchUp:c,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:f}}=a;if(d&&d.matchUpStatus!=="BYE"){let{stage:g,roundNumber:I,roundPosition:v,structureName:w}=d;Ht({winner:"winner",roundPosition:v,structureName:w,roundNumber:I,keyColors:PD,stage:g}),Tz({...t,targetMatchUp:d,sourceMatchUp:s,iteration:l})}let h=c?.matchUpStatus==="BYE"&&(c?.feedRound||c?.roundNumber===1),m=a?.targetLinks?.loserTargetLink?.linkCondition===fl;if(h&&m){let g=e.filter(({roundNumber:w,structureId:y})=>y===s.structureId&&w===1),I=g.map(({roundPosition:w})=>w),v=br(I.sort(),2).find(w=>w.includes(s.roundPosition));if((g.filter(({roundPosition:w})=>v.includes(w))?.map(({matchUpStatus:w})=>w)).every(w=>[Wi,Si].includes(w)))return z({result:{...H},stack:u})}if(c&&(c.matchUpStatus!=="BYE"||h)){let g=e.find(({matchUpId:U})=>U===c.matchUpId),{structure:I}=et({drawDefinition:r,structureId:g.structureId}),{stage:v,roundNumber:w,roundPosition:y,feedRound:b,structureName:S}=c;if(Ht({loser:"loser",roundPosition:y,structureName:S,roundNumber:w,keyColors:PD,feedRound:b,stage:v}),i?.progression?.doubleExitPropagateBye||h)Ix({drawPosition:p,targetLink:f,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:n});else{let U=Tz({...t,targetMatchUp:c,structure:I,iteration:l});if(U.error)return z({result:U,stack:u})}}return z({result:{...H},stack:u})}function Tz(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s,structure:o,iteration:l}=t,u="conditionallyRemoveDrawPosition";Ht({method:u,structureName:o?.structureName,iteration:l});let c=_n({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:d}}=c,p=s?.drawMatchUps.find(w=>w.matchUpId===a.matchUpId),f,h,m;if(a.feedRound)m=d?.drawPositions?.filter(Boolean)?.find(w=>a.drawPositions.includes(w));else if(n==null)m=Fi(a?.drawPositions||[],d?.drawPositions||[])?.[0];else{h=F8({structureId:o.structureId,matchUp:n,matchUpsMap:s})?.pairedPreviousMatchUp,f=[Si,Wi].includes(h?.matchUpStatus);let w=h?.drawPositions?.filter(Boolean)||[];if([...Ji,"BYE"].includes(h?.matchUpStatus)||h?.winningSide){let y=n.drawPositions||[],b=a.drawPositions?.filter(Boolean);Ln(y,b)&&(b=b?.filter(S=>!y.includes(S))),m=y.concat(w).find(S=>b?.includes(S))}}if(d&&m){let{stage:w,roundNumber:y,roundPosition:b,structureName:S}=d;Ht({method:"removeDirectedWinner",drawPositionToRemove:m,color:"brightgreen",roundPosition:b,structureName:S,roundNumber:y,keyColors:PD,stage:w}),pQ({winningDrawPosition:m,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}let g=mQ({targetData:c,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:s,structure:o,iteration:l});if(g.error)return z({result:g,stack:u});let I=lCe({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),v=!f;return g=Po({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],matchUpStatus:I,removeScore:v,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),g.error?z({result:g,stack:u}):{...H}}function lCe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus==="BYE"?"BYE":t?[Wi,Zt].includes(e?.matchUpStatus)?Zt:mi:Li}function uCe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=t,a=t.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===ks){let s=r.sides?.find(({sideNumber:l})=>l===r.winningSide)?.participantId,o=i.find(l=>l.structureId===a.target.structureId&&l.roundNumber===a.target.roundNumber&&l.sides?.some(({participantId:u})=>u===s));if(o&&o.matchUpStatus===Li){let l=_n({matchUpId:o.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Bp({inContextDrawMatchUps:i,drawDefinition:n,targetData:l})){let{structure:u}=et({structureId:o.structureId,drawDefinition:n}),c=Kt({structure:u}).positionAssignments;for(let d of c||[])if(d.participantId===s){if(d.participantId=void 0,u?.positionAssignments)u.positionAssignments=c;else if(u?.structures){let p=Object.assign({},...(c||[]).map(f=>({[f.drawPosition]:f.participantId})));for(let f of u?.structures||[])f.positionAssignments?.forEach(h=>h.participantId=p[h.drawPosition])}bc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:u}),e=!0}}}}return{qualifierRemoved:e}}function cCe(t){let{matchUp:e,matchUpStatus:i,score:r,winningSide:n}=t,a="noDownStreamDependencies";if([Si,Wi].includes(e?.matchUpStatus)&&![Si,Wi].includes(i)){let g=mQ(t);if(g.error)return z({result:g,stack:a})}let s=i===Si,o=dr({score:r})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!n),l=t?.inContextMatchUp?.collectionId&&ZRe(t.inContextMatchUp),u=t.removeScore||!l&&![hs,fs].includes(i||hs),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!n&&!dr({score:r}),d=g=>{let I,{structure:v,drawDefinition:w,dualMatchUp:y,disableAutoCalc:b}=t;if(y?._disableAutoCalc&&b!==!1)return S0({...t,removeWinningSide:c});let{connectedStructureIds:S}=hQ({drawDefinition:w,structure:v,matchUp:e});S.length&&(console.log({connectedStructureIds:S}),I=!0),Object.assign(t,{removeScore:g});let U=Ov(t);if(U.error)return U;if(t.removingQualifier&&t.appliedPolicies?.[$b]?.autoRemoveQualifiers){let T=uCe(t);return{...H,connectedStructures:I,...T}}return{...H,connectedStructures:I}};if(c&&n&&t.isCollectionMatchUp)return Dz(t);let p=[Bc,fs].includes(i)&&t.dualWinningSideChange,f=i&&i!==Li,h=t.propagateExitStatus&&$r(i),m=(n||p||h)&&oCe(t)||o&&d(u)||f&&tCe(t)||c&&d(u)||e&&Dz({...t,removeScore:!0})||{...H};return z({result:m,stack:a})}function Dz(t){let e="ndd:scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let r=Ov(t);if(r.error)return r}let i=Po({...t});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:n,event:a,matchUpsMap:s}=t,{removeWinningSide:o}=Hc({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:n,matchUpsMap:s,event:a});o&&console.log("REMOVE WINNING SIDE")}return z({result:i,stack:e})}function l$(t){let e=Ge(t,[{[mr]:!0,[mn]:!0,[Nl]:!0},{homeParticipantId:!0,[$s]:ur}]);if(e.error)return e;let i=Cv(t,[{[pv]:xu,attr:{[FR]:!0}}]);if(i.error)return i;let r=i?.matchUp?.matchUp?.sides?.map(c=>c?.participantId);if(t.homeParticipantId&&!r?.includes(t.homeParticipantId))return{error:No};let{disableNotice:n,homeParticipantId:a,removePriorValues:s,tournamentRecord:o,drawDefinition:l,matchUpId:u}=t;return Ea({duplicateValues:!1,removePriorValues:s,tournamentRecord:o,drawDefinition:l,disableNotice:n,matchUpId:u,timeItem:{itemType:OL,itemValue:a}})}function gQ({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=mf({timeItems:i?.timeItems||[],itemType:ZR});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function Xd(t){let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,scheduledTime:o,matchUpId:l}=t;if(!l)return z({result:{error:Tn},stack:e});if(!cv(o))return z({result:{error:Ms},stack:e});if(!i){let f=pi({drawDefinition:a,matchUpId:l});if(f.error)return z({result:f,stack:e});i=f.matchUp}let u=Qe(o),c=gf({matchUp:i}).scheduledDate,d=u&&!c;if((gQ({matchUp:i}).timeModifiers||[])?.length){let f=IQ({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(f?.error)return z({result:f,stack:e})}let p=mm(o,!0,d);return Ea({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,matchUpId:l,timeItem:{itemType:Sm,itemValue:p}})}function IQ({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:s}){let o="addMatchUpTimeModifiers";if(!a)return z({result:{error:Tn},stack:o});if(n!==void 0&&!Array.isArray(n))return z({info:_p("timeModifiers"),result:{error:ie},stack:o});if(!s){let d=pi({drawDefinition:i,matchUpId:a});if(d.error)return z({result:d,stack:o});s=d.matchUp}let l=gQ({matchUp:s}).timeModifiers||[],u=n.filter(d=>!l.includes(d));if(n.length&&!u.length)return{...H};if(u.some(d=>HO.includes(d))){l=l.filter(p=>!HO.includes(p));let d=Xd({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return z({result:d,stack:o})}let c=n?.length?[...u,...l]:void 0;return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:ZR,itemValue:c}})}function sM({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:Tn};let s=t&&dl.test(t);if(t&&!s)return{error:qi};let o={itemValue:Qe(t),itemType:wm};return Ea({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o})}function oM({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtIds:o}){if(!i&&!e)return{error:ge};if(!s)return{error:Tn};let l=pi({drawDefinition:r,matchUpId:s});if(l.error)return l;if(l?.matchUp?.matchUpType!==Va)return{error:la};if(!(o===void 0||Array.isArray(o)&&o.length&&o.every(c=>typeof c=="string")))return{error:ie,context:{courtIds:o}};let u;if(o){let c=e||i&&{[i.tournamentId]:i},d=_u({tournamentRecords:c});if(d.error)return d;let p=d.courts?.filter(f=>o.includes(f.courtId));if(p?.length!==o.length)return{error:ie,context:{courtIds:o}};u=p?.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:vu,itemDate:a,itemValue:u}})}function xv({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:s}){if(!i)return{error:ge};if(!a)return{error:Tn};if(s){let o=po({tournamentRecords:e,tournamentRecord:i,venueId:s});if(o.error)return o}return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:bm,itemValue:s}})}function xm({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtId:o}){if(!i&&!e)return{error:ge};if(!s)return{error:Tn};if(o){let l=Yd({tournamentRecords:e,tournamentRecord:i,courtId:o});if(l.error)return l;let u=l.venue?.venueId;xv({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,venueId:u})}return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:Ud,itemDate:a,itemValue:o}})}function Qo(t,e){let i=jK.test(t)?t:di(t),r=Qe(t)||Qe(e)||_s(new Date);return new Date(`${r}T${i}`).getTime()}function lM(t){let e="addMatchUpScheduleItems",i=Ge(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[Xn]:Qn}],e);if(i.error)return i;let{matchUpDependencies:r,inContextMatchUps:n}=t,{proConflictDetection:a=!1,errorOnAnachronism:s=!1,checkChronology:o=!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,disableNotice:p,drawMatchUps:f,matchUpId:h,schedule:m,event:g}=t,I,v;if(f)I=f.find(A=>A.matchUpId===h);else{let A=pi({drawDefinition:d,event:g,matchUpId:h});if(A.error)return A;I=A.matchUp}let{endTime:w,courtId:y,courtIds:b,courtOrder:S,resumeTime:U,homeParticipantId:T,scheduledDate:D,scheduledTime:P,startTime:E,stopTime:R,timeModifiers:C,venueId:M}=m;o&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=fo({drawDefinition:d}));let N=r?.[h]?.matchUpIds;if(m.scheduledDate&&o&&N){let A=n?.filter(O=>(O.schedule?.scheduledDate||Qe(O.schedule?.scheduledTime))&&N.includes(O.matchUpId)).map(({schedule:O})=>{let k=iP(O);return new Date(k??"").getTime()});if(A?.length){let O=iP(m),k=new Date(O??"").getTime();if(Math.max(...A)>=k){if(s)return z({result:{error:TO},stack:e});v=TO}}}if(D!==void 0){let A=sM({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledDate:D,matchUpId:h});if(A?.error)return z({result:A,stack:e,context:{scheduledDate:D}})}if(P!==void 0){let A=Xd({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledTime:P,matchUpId:h,matchUp:I});if(A?.error)return z({result:A,stack:e,context:{scheduledTime:P}})}if(E!==void 0){let A=c$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,startTime:E,event:g});if(A?.error)return z({result:A,stack:e,context:{startTime:E}})}if(R!==void 0){let A=p$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,stopTime:R,event:g});if(A?.error)return z({result:A,stack:e,context:{stopTime:R}})}if(U!==void 0){let A=f$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,resumeTime:U,matchUpId:h,event:g});if(A?.error)return z({result:A,stack:e,context:{resumeTime:U}})}if(w!==void 0){let A=d$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,endTime:w,event:g});if(A?.error)return z({result:A,stack:e,context:{endTime:w}})}if(b!==void 0){let A=oM({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,courtIds:b});if(A?.error)return z({result:A,stack:e,context:{courtIds:b}})}if(a&&y!==void 0&&D!==void 0&&S!==void 0&&ut(S)){let A=Ye(S),O=(wr({tournamentRecord:c})?.matchUps??[]).find(k=>{if(k.matchUpId===h)return!1;let F=k.schedule?.courtOrder?Ye(k.schedule.courtOrder):void 0;return k.schedule?.courtId===y&&F===A&&k.schedule?.scheduledDate===D});if(O)return z({result:{error:o4,info:`Court slot already occupied by matchUp ${O.matchUpId}`},stack:e,context:{courtId:y,courtOrder:S,scheduledDate:D}})}if(y!==void 0&&D!==void 0){let A=xm({courtDayDate:D,disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:h,courtId:y});if(A?.error)return z({result:A,stack:e,context:{courtId:y}})}if(M!==void 0){let A=xv({disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:h,venueId:M});if(A?.error)return z({result:A,stack:e,context:{venueId:M}})}if(S!==void 0&&ut(S)){let A=u$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,courtOrder:S,matchUpId:h});if(A?.error)return z({result:A,stack:e,context:{courtOrder:S}})}if(C!==void 0){let A=IQ({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,timeModifiers:C,matchUpId:h,matchUp:I});if(A?.error)return z({result:A,stack:e,context:{timeModifiers:C}})}return ni(T)&&l$({disableNotice:!0,homeParticipantId:T,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h}),p||Tt({tournamentId:c?.tournamentId,eventId:g?.eventId,context:e,drawDefinition:d,matchUp:I}),v?{...H,warnings:[v]}:{...H}}function u$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:Tn};if(n&&!ut(n))return{error:ie,info:"courtOrder must be numeric"};let s=n&&Ye(n);return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:QR,itemValue:s}})}function vQ({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:s}){if(!s)return{error:Tn};if(!n)return{error:ur};if(e){let l=Pi({tournamentRecord:e,participantFilters:{participantTypes:[vt],participantRoles:[KL]}}).participants??[];if(!yd({tournamentParticipants:l,participantId:n}))return{error:ji}}let o={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(o.itemSubTypes=[a]),Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:s,timeItem:o})}function c$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:s}){if(!n)return{error:Tn};if(!cv(a))return{error:Ms};let{matchUp:o}=pi({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=gf({matchUp:o}),u=(o?.timeItems??[]).filter(c=>[oc,Ql,Uc].includes(c?.itemType)).map(c=>Qo(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||Qo(a,l)<u){o?.timeItems&&(o.timeItems=o.timeItems.filter(d=>d.itemType!==wo));let c=mm(a,!0,!0);return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:wo,itemValue:c}})}else return{error:aK}}function d$({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:s,event:o}){if(!a)return{error:Tn};if(!cv(s))return{error:Ms};let{matchUp:l}=pi({drawDefinition:r,event:o,matchUpId:a}),{scheduledDate:u}=gf({matchUp:l}),c=(l?.timeItems??[]).filter(d=>[wo,Ql,oc].includes(d?.itemType)).map(d=>Qo(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||Qo(s,u)>c){l?.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Uc));let d=mm(s,!0,!0);return Ea({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Uc,itemValue:d}})}else return{error:rK}}function p$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:s}){if(!n)return{error:Tn};if(!cv(a))return{error:Ms};let{matchUp:o}=pi({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=gf({matchUp:o}),u=o?.timeItems??[];if(u.reduce((h,m)=>m.itemType===Uc||h,void 0))return{error:U1};let c=u.filter(h=>[wo,Ql,oc].includes(h?.itemType)).sort((h,m)=>Qo(h.itemValue,l)-Qo(m.itemValue,l)),d=c.at(-1),p=d?.itemType===oc,f=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Qo(h.itemValue,l)).reduce((h,m)=>!h||m>h?m:h,void 0);if(Qo(a,l)>f){if(o?.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let h={itemValue:mm(a,!0,!0),itemType:oc};return Ea({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:h})}else return{error:nK}}function f$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:s}){if(!a)return{error:Tn};if(!cv(n))return{error:Ms};let{matchUp:o}=pi({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:l}=gf({matchUp:o}),u=o?.timeItems??[];if(u.reduce((h,m)=>m.itemType===Uc||h,void 0))return{error:U1};let c=u.filter(h=>[wo,Ql,oc].includes(h?.itemType)).sort((h,m)=>Qo(h.itemValue,l)-Qo(m.itemValue,l)),d=c.at(-1),p=d?.itemType===Ql,f=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Qo(h.itemValue,l)).reduce((h,m)=>!h||m>h?m:h,void 0);if(Qo(n,l)>f){if(o?.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let h={itemValue:mm(n,!0,!0),itemType:Ql};return Ea({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:h})}else return{error:MIe}}function dCe(t){let{targetData:e,matchUpsMap:i}=t,{targetMatchUps:{loserMatchUp:r}}=e,n=$r(r?.matchUpStatus),a=!!i?.drawMatchUps.find(s=>s.loserMatchUpId===r?.matchUpId&&$r(s.matchUpStatus));return a&&r?.matchUpStatus===Si||a&&n}function pCe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:s,matchUp:o,event:l,score:u}){let c=Oe(n,void 0,!0);for(let p of c?.tieMatchUps||[])p.matchUpId===o.matchUpId&&(p.winningSide=r,p.score=u,!dr({score:u})&&!e?Object.assign(p,{...gC}):e&&(p.matchUpStatus=e));a=a??yn({matchUp:o,structure:s,drawDefinition:t,event:l})?.tieFormat;let{winningSide:d}=_S({matchUp:c,drawDefinition:t,matchUpsMap:i,structure:s,tieFormat:a,event:l});return{projectedWinningSide:d}}function fCe(t){let{tournamentRecord:e,inContextMatchUp:i,structure:r,drawDefinition:n}=t,a=i.roundNumber,s=i.sides.find(b=>b.sideNumber===i.winningSide),o=i.sides.find(b=>b.sideNumber!==i.winningSide),{drawPosition:l,participantId:u}=s,{drawPosition:c,participantId:d}=o,p="swapWinnerLoser",{matchUps:f}=kt(t),h=f.filter(({drawPositions:b,roundNumber:S})=>b?.includes(l)&&S>a);ua({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:h}),h.forEach(b=>{b.drawPositions=b.drawPositions?.map(S=>S===l?c:S)||[],Tt({tournamentId:e?.tournamentId,eventId:t.event?.eventId,context:p,drawDefinition:n,matchUp:b})});let{stage:m,stageSequence:g}=r,I=n.structures.filter(({stage:b,stageSequence:S})=>b===m&&S>g).map(({structureId:b})=>b),{targetLinks:{loserTargetLink:v,winnerTargetLink:w}}=t.targetData,y=[v?.target.structureId,w?.target?.structureId].filter(Boolean);return n.structures.filter(({stage:b,structureId:S})=>b!==m&&y.includes(S)).forEach(({stage:b,stageSequence:S,structureId:U})=>{I.includes(U)||I.push(U),n.structures.filter(({stage:T,stageSequence:D})=>T===b&&D>S).forEach(({structureId:T})=>{I.includes(T)||I.push(T)})}),n.structures.filter(({structureId:b})=>I.includes(b)).forEach(b=>{let{positionAssignments:S}=Kt({structure:b}),U=S?.find(({participantId:D})=>D===u),T=S?.find(({participantId:D})=>D===d);U&&(U.participantId=d),T&&(T.participantId=u)}),Po({...t})}function yf(t){let e="setMatchUpStatus";t.matchUpStatus&&[mi,Si].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,propagateExitStatus:n,tournamentRecords:a,tournamentRecord:s,disableAutoCalc:o,enableAutoCalc:l,drawDefinition:u,matchUpStatus:c,winningSide:d,matchUpId:p,event:f,score:h}=t;if(!u)return{error:_e};if(c&&[Bc,hs,fs,Li].includes(c)&&d)return{error:ie,winningSide:d,matchUpStatus:c};if(![void 0,...i7].includes(c))return z({result:{error:sv},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let m=Or({drawDefinition:u}),{matchUps:g}=rr({nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:m,event:f}),I=m.drawMatchUps.find(V=>V.matchUpId===p),v=g?.find(V=>V.matchUpId===p);if(!I||!g)return{error:cn};if((I.winningSide||d)&&c==="BYE")return{context:"Cannot have Bye with winningSide",error:pD,matchUpStatus:c};let w=v?.structureId,{structure:y}=et({drawDefinition:u,structureId:w}),b=Ti(ei)(I.matchUpType),S=v?.drawPositions?.filter(Boolean),U=v?.matchUpTieId,T=_n({matchUpId:U||p,inContextDrawMatchUps:g,drawDefinition:u});Object.assign(t,{inContextDrawMatchUps:g,inContextMatchUp:v,matchUpTieId:U,matchUpsMap:m,targetData:T,structure:y,matchUp:I});let D=c===Li&&h?.scoreStringSide1===""&&h?.scoreStringSide2===""&&!d;if(dCe(t)&&D)return{error:vIe};let P=Bp(t),E;if(b){if(o)gt({extension:{name:Lh,value:!0},element:I});else if(l){let V=I.winningSide,{winningSide:_,scoreStringSide1:B,scoreStringSide2:G,set:j}=_S({drawDefinition:u,matchUpsMap:m,structure:y,matchUp:I,event:f}),Y={scoreStringSide1:B,scoreStringSide2:G,sets:j?[j]:[]};if(E=_!==V,P&&E)return z({stack:"winningSideWithDownstreamDependencies",result:{error:hR},context:{winningSide:d,matchUp:I}});Mn({name:Lh,element:I}),Object.assign(t,{winningSide:_,dualWinningSideChange:E,projectedWinningSide:_,score:Y})}$S({tournamentId:s?.tournamentId,inContextDualMatchUp:v,eventId:f?.eventId,dualMatchUp:I,drawDefinition:u})}if(b&&c&&[Im].includes(c))return{info:"Not supported for matchUpType: TEAM",error:ie};if(h&&!b&&!r){let V=I.matchUpFormat??y?.matchUpFormat??u?.matchUpFormat??f?.matchUpFormat,_=s_({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:V,matchUpStatus:c,winningSide:d,score:h});if(_.error)return _}let R=Rt({policyTypes:[$b,ko],tournamentRecord:s,drawDefinition:u,event:f})?.appliedPolicies??{};St(t.policyDefinitions)&&Object.assign(R,t.policyDefinitions);let C=mCe({assignedDrawPositions:S,propagateExitStatus:n,inContextMatchUp:v,appliedPolicies:R,drawDefinition:u,matchUpStatus:c,structure:y,matchUp:I});if(C?.error)return C;let M=v?.stage===We&&v.finishingRound===1,N=M&&d,A=M&&I.winningSide&&!d&&(!t.matchUpStatus||t.matchUpStatus&&qO({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!dr({outcome:t.outcome})),O=N&&d!==I.winningSide&&I.winningSide;if(Object.assign(t,{qualifierAdvancing:N,qualifierChanging:O,removingQualifier:A,appliedPolicies:R}),U){let{matchUp:V}=pi({matchUpId:U,inContext:!0,drawDefinition:u,matchUpsMap:m,event:f});if(V){let _=yn({matchUp:V,drawDefinition:u,structure:y,event:f})?.tieFormat,{projectedWinningSide:B}=pCe({drawDefinition:u,matchUpStatus:c,dualMatchUp:V,matchUpsMap:m,winningSide:d,tieFormat:_,structure:y,matchUp:I,event:f,score:h}),G=V.winningSide;E=B!==G;let j=V._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:E,projectedWinningSide:B,autoCalcDisabled:j,matchUpTieId:U,dualMatchUp:V,tieFormat:_})}}let k=PS({matchUpStatus:c});if(!U){if(P&&!d&&(c&&qO({matchUpStatus:c})||c&&[Si,Wi].includes(c)))return{error:pD,activeDownstream:P,winningSide:d};if(d&&d===I.winningSide&&c&&!k)return{context:"winningSide must include directing matchUpStatus",error:pD,directingMatchUpStatus:k,matchUpStatus:c}}let{schedule:F}=t;if(F){let V=lM({disableNotice:!0,tournamentRecords:a,tournamentRecord:s,drawDefinition:u,matchUpId:p,schedule:F});if(V.error)return V}let x=!b&&!E&&d&&I.winningSide&&I.winningSide!==d;if(i&&x&&I.roundPosition)return fCe(t);let L=d&&!U||t.projectedWinningSide;Ht({activeDownstream:P,matchUpWinner:L,method:e,winningSide:d});let $=!P&&cCe(t)||L&&hCe(t)||(k||t.autoCalcDisabled)&&yQ(t)||{error:fK};return z({result:$,stack:e})}function hCe(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?yQ(t):z({stack:"winningSideWithDownstreamDependencies",result:{error:hR},context:{winningSide:i,matchUp:e}})}function yQ(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!dr({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&Li||t.winningSide&&Oi||hs:t.matchUpStatus||Oi,s=t.removeScore||[Bc,mi].includes(a)&&![hs,fs].includes(a),o=Po({...t,matchUpStatus:a,removeWinningSide:n,removeScore:s});if(o.error)return o;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=Hc({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:r});if(d.error)return d;Object.assign(o,{tieMatchUpResult:d})}return o}function mCe({assignedDrawPositions:t,propagateExitStatus:e,inContextMatchUp:i,appliedPolicies:r,drawDefinition:n,matchUpStatus:a,structure:s,matchUp:o}){if(r?.[ko]?.requireParticipantsForScoring===!1)return{...H};let l=i?.sides?.map(d=>d.participantId).filter(Boolean).length,u=o?.sides?[]:Kt({structureId:s?.structureId,drawDefinition:n}).positionAssignments,c=l&&l===2||o.collectionId&&Wn({structure:s})&&l&&l>=1||t?.length===2&&u?.filter(d=>t.includes(d.drawPosition)).every(d=>d.participantId);return a&&[mi,Zt,Si].includes(a)&&l===1&&e?{...H}:a&&t7.includes(a)&&!c?z({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:a,requiredParticipants:c},result:{error:sv}}):{...H}}function bQ({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:_e};let{matchUp:n}=pi({drawDefinition:e,matchUpId:i,event:r});return n?.matchUpType!==Va?{error:la}:yf({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function wQ({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:_e};if(!i)return{error:Tn};let{matchUp:r}=pi({drawDefinition:t,event:e,matchUpId:i});return r?Mn({name:jR,element:r}):{error:cn}}function gCe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:s}){let o="substituteParticipant";if(!r)return{error:_e};if(!a)return{error:Tn};if(!e||!t)return z({result:{error:ur},stack:o});let{matchUp:l}=pi({drawDefinition:r,matchUpId:a,event:s});if(!l)return{error:cn};if(!l.collectionId)return z({result:{error:la},stack:o});let u=Or({drawDefinition:r}),{matchUps:c}=rr({tournamentParticipants:i?.participants,inContext:!0,drawDefinition:r,matchUpsMap:u}),d=c?.find(f=>f.matchUpId===a),p=c?.find(f=>f.matchUpId===d?.matchUpTieId)?.sides?.find(f=>f.participant.individualParticipants.some(({participantId:h})=>h===e));return!p||n&&p.sideNumber!==n?{error:No}:p.participant?.individualParticipants?.map(bt).filter(f=>f!==e)?.includes(t)?s$({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:s}):z({result:{error:No},stack:o})}function SQ(t){return gCe(t)}function UQ({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:_e};let{matchUp:r}=pi({drawDefinition:t,matchUpId:e,event:i});return gt({extension:{name:Lh,value:!0},element:r})}function TQ(t){let e="setMatchUpFormat",i=Ge(t,[{tournamentRecord:!0},{[qr]:b=>Ga({matchUpFormat:b}),[Ha]:zw,matchUpFormat:!0}]);if(i.error)return z({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:s,matchUpFormat:o,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:f,event:h,force:m}=t;if(a&&!Array.isArray(a))return z({result:{error:ie,scheduledDates:a},stack:e});if(u&&!lh([pl,ps],u))return z({result:{error:uu},stack:e});let g=0,I=t.structureIds||l&&[l].filter(Boolean)||[],v=t.eventIds||d&&[d].filter(Boolean)||[],w=t.drawIds||f&&[f].filter(Boolean)||[];if((l||I?.length)&&!n)return z({result:{error:_e},stack:e});if(f&&c&&n){let b=c_({tournamentRecord:r,drawDefinition:n,matchUpFormat:o,structureIds:I,structureId:l,matchUpId:c});if(b.error)return b;g+=1}let y=b=>{let S=[];for(let U of b.structures||[]){if(Array.isArray(p)&&!p.includes(U.stage)||Array.isArray(s)&&!s.includes(U.stageSequence)||I?.length&&!I.includes(U.structureId))continue;I?.length&&U.matchUpFormat!==o&&(U.matchUpFormat=o,S.push(U.structureId),g+=1);let T=((m||a)&&kt({matchUpFilters:{matchUpStatuses:[Li]},structure:U}).matchUps)??[],D=(a&&kt({matchUpFilters:{matchUpStatuses:[Li]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:U}).matchUps)??[];if(T?.length){let P=D?D.map(vr):T.map(vr);for(let E of T)P.includes(E.matchUpId)&&(E.matchUpFormat=a?.length?o:void 0,Tt({tournamentId:r?.tournamentId,eventId:h?.eventId,context:e,drawDefinition:b,matchUp:E}))}}return!S.length&&b.matchUpFormat!==o&&(b.matchUpFormat=o,g+=1),S};for(let b of r?.events||[])if(!(v?.length&&!v.includes(b.eventId)||u&&u!==b.eventType||u===sr))if(Array.isArray(s)||Array.isArray(p)||I?.length||w?.length)for(let S of b.drawDefinitions||[]){if(Array.isArray(w)&&!w.includes(S.drawId))continue;let U=y(S);ii({structureIds:U,drawDefinition:S})}else b.matchUpFormat!==o&&(b.matchUpFormat=o,g+=1);return g?{...H,modificationsCount:g}:{...H,info:uv}}function h$({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){if(!i)return{error:_e};let a=pi({drawDefinition:i,matchUpId:r})?.matchUp;if(!a?.tieMatchUps)return{error:la};let s=pi({inContext:!0,drawDefinition:i,matchUpId:r,event:n})?.matchUp,o=0;return(a?.sides||[]).forEach(l=>{l.lineUp&&delete l.lineUp}),(s?.sides||[]).forEach(l=>{if(o+=1,t===!1){let u=s?.tieFormat,c=l.participantId;u&&c&&Cm({drawDefinition:i,participantId:c,lineUp:[],tieFormat:u})}Tt({tournamentId:e?.tournamentId,context:"resetMatchUpLineUps",eventId:n?.eventId,drawDefinition:i,matchUp:a})}),{...H,modificationsCount:o}}function DQ(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n,setTBlast:a}=t;if(!n)return{sets:[]};let s=n.sets||[],o=eu({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),l=eu({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),u=eu({matchUpFormat:e,matchUpStatus:i,winningSide:r,setTBlast:a,sets:s}),c=o===u?l:o;return r&&(o=r===1?u:c,l=r===2?u:c),{score:{sets:s,scoreStringSide1:o,scoreStringSide2:l}}}function ICe({sourceMatchUpStatusCodes:t,propagateExitStatus:e,sourceMatchUpStatus:i,loserParticipantId:r,tournamentRecord:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,event:l}){let u="progressExitStatus";Ht({method:u,newline:!0,color:"magenta",keyColors:{loserMatchUpId:"brightcyan",sourceMatchUpStatus:"brightyellow"},loserMatchUpId:s?.matchUpId,loserMatchUpStatus:s?.matchUpStatus,sourceMatchUpStatus:i,sourceMatchUpStatusCodes:JSON.stringify(t),loserParticipantId:r?.slice(0,8),propagateExitStatus:e});let c=$r(i)&&i!==jr&&i||mi,d=rr({inContext:!0,drawDefinition:a,matchUpsMap:o})?.matchUps,p=c,f=d?.find(h=>h.matchUpId===s?.matchUpId);if(Ht({method:u,color:"magenta",carryOverMatchUpStatus:c,updatedLoserMatchUpId:f?.matchUpId,updatedLoserStatus:f?.matchUpStatus,updatedLoserSides:JSON.stringify(f?.sides?.map(h=>({sn:h.sideNumber,pid:h.participantId?.slice(0,8),bye:h.bye}))),updatedLoserDP:JSON.stringify(f?.drawPositions),existingStatusCodes:JSON.stringify(f?.matchUpStatusCodes)}),f?.matchUpId&&p){let h,m=f.matchUpStatusCodes?.map(v=>typeof v=="string"?v:"WO")??[],g=f.sides?.find(v=>v.participantId===r);if(g?.sideNumber){let v=f?.sides?.reduce((w,y)=>y?.participantId?w+1:w,0);if(Ht({method:u,color:"brightyellow",keyColors:{decision:"brightgreen"},loserSideNumber:g.sideNumber,participantsCount:v,statusCodesLength:m.length,existingStatusCodes:JSON.stringify(m),loserMatchUpIsExit:$r(s.matchUpStatus),loserMatchUpOriginalStatus:s.matchUpStatus}),v===1&&m.length===0)h=g.sideNumber===1?2:1,m[0]=t[0],Ht({method:u,color:"brightgreen",decision:"SINGLE_PARTICIPANT_no_existing_codes",winningSide:h,statusCodes:JSON.stringify(m)});else if(!$r(s.matchUpStatus))h=g.sideNumber===1?2:1,m[0]=t[0],Ht({method:u,color:"brightgreen",decision:"TWO_PARTICIPANTS_not_exit",winningSide:h,statusCodes:JSON.stringify(m)});else{let w=m[0];m[g.sideNumber-1]=t[0];let y=g.sideNumber===1?2:1;m[y-1]=w,p=Si,h=void 0,Ht({method:u,color:"brightred",decision:"BOTH_EXITS_converting_to_DOUBLE_WALKOVER",loserMatchUpStatus:p,winningSide:h,statusCodes:JSON.stringify(m)})}}else Ht({method:u,color:"brightyellow",decision:"NO_LOSER_PARTICIPANT_SIDE_FOUND",loserParticipantId:r?.slice(0,8),availableSides:JSON.stringify(f.sides?.map(v=>({sn:v.sideNumber,pid:v.participantId?.slice(0,8)})))});Ht({method:u,color:"brightmagenta",keyColors:{finalStatus:"brightgreen",finalWinningSide:"brightyellow"},action:"calling_setMatchUpState",loserMatchUpId:s.matchUpId,finalStatus:p,finalWinningSide:h,finalStatusCodes:JSON.stringify(m)});let I=yf({matchUpStatus:p,matchUpId:s.matchUpId,matchUpStatusCodes:m,allowChangePropagation:!0,propagateExitStatus:e,tournamentRecord:n,drawDefinition:a,winningSide:h,event:l});return z({result:I,stack:u,context:{progressExitStatus:!0}})}return z({result:{error:oa},stack:u})}function ZS(t){let e=Ge(t,[{[Nl]:!0,[mn]:!0}]);if(e.error)return e;let i="setMatchUpStatus",r=ws(t);if(!t.drawDefinition){let b=t.tournamentRecord??(t.tournamentId&&r[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=b);let S=zn({eventId:t.eventId,drawId:t.drawId,tournamentRecord:b});if(S.error)return S;S.drawDefinition&&(t.drawDefinition=S.drawDefinition),t.event=S.event}let{disableScoreValidation:n,propagateExitStatus:a,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpId:d,schedule:p,event:f,notes:h}=t,m=t.matchUpFormat||t.outcome?.matchUpFormat,{policy:g}=pf({policyType:ko,tournamentRecord:o,event:f}),I=t.allowChangePropagation!==void 0&&t.allowChangePropagation||g?.allowChangePropagation!==void 0&&g.allowChangePropagation||void 0,{outcome:v,setTBlast:w}=t;if(v?.winningSide&&![1,2].includes(v.winningSide))return{error:pR};if(m){let b=c_({tournamentRecord:o,drawDefinition:c,matchUpFormat:m,matchUpId:d,event:f});if(b.error)return b}if(v?.score?.sets&&!v.score.scoreStringSide1){let{score:b}=DQ({...v,setTBlast:w});v.score=b,v.score.sets=v.score.sets.filter(S=>S.side1Score||S.side2Score||S.side1TiebreakScore||S.side2TiebreakScore)}let y=yf({matchUpStatusCodes:v?.matchUpStatusCodes,matchUpStatus:v?.matchUpStatus,winningSide:v?.winningSide,allowChangePropagation:I,disableScoreValidation:n,score:v?.score,propagateExitStatus:a,tournamentRecords:r,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpFormat:m,matchUpId:d,schedule:p,event:f,notes:h});if(y.context?.progressExitStatus){let b=!0,S=0;for(;b&&S<10;){b=!1,S+=1;let U=ICe({sourceMatchUpStatusCodes:y.context.sourceMatchUpStatusCodes,sourceMatchUpStatus:y.context.sourceMatchUpStatus,loserParticipantId:y.context.loserParticipantId,propagateExitStatus:t.propagateExitStatus,tournamentRecord:t.tournamentRecord,loserMatchUp:y.context.loserMatchUp,matchUpsMap:y.context.matchUpsMap,drawDefinition:t.drawDefinition,event:t.event});U.context?.loserMatchUp&&(Object.assign(y.context,U.context),b=!0)}}return z({result:y,stack:i})}function PQ(t){if(!t?.outcomes)return{error:Xe};if(!Array.isArray(t.outcomes))return{error:Xe,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:ge};let s=i.filter(o=>o.tournamentId===n);if(s.length){let o=vCe({outcomes:s,tournamentRecord:a});if(o.error)return o}}return{...H}}function vCe(t){let{tournamentRecords:e,tournamentRecord:i,outcomes:r,policyDefinitions:n}=t,a={};r.forEach(s=>{let{eventId:o}=s;a[o]||(a[o]=[]),a[o].push(s)});for(let s of Object.keys(a)){let{event:o}=zn({tournamentRecord:i,eventId:s});for(let l of a[s]){let{drawId:u}=l,c=o?.drawDefinitions?.find(d=>d.drawId===u);if(c&&u){let{matchUpFormat:d,matchUpId:p}=l,f=ZS({schedule:l?.schedule,tournamentRecords:e,policyDefinitions:n,tournamentRecord:i,drawDefinition:c,matchUpFormat:d,matchUpId:p,outcome:l,drawId:u,event:o});if(f.error)return f}}}return{...H}}function yCe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){if(!r&&!t)return{error:_e};if(!i)return{error:Xe,info:"missing outcome"};if(!r&&!e)return{error:oa};if(!r){let n=pi({drawDefinition:t,matchUpId:e});if(n.error)return n;r=n.matchUp}return typeof i!="object"||!i.score?.scoreStringSide1||!i.score?.scoreStringSide2?{error:ie}:gt({element:r,extension:{name:jR,value:i}})}function EQ(t){return yCe(t)}function m$(t){let e="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=t,a=Ge(t,[{[mr]:!0,[Nl]:!0}],e);if(a.error)return a;let s=Cv(t,[{[pv]:xu}]);if(s[$s])return s;let o=t.tournamentRecord?.tournamentId,{matchUp:l,structure:u}=s?.matchUp??{};if(!l?.tieMatchUps)return z({result:{error:la},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...H};let c=yn({structure:u,drawDefinition:i,event:r})?.tieFormat;if(!c)return z({result:{error:Vr},info:"No inherited tieFormat",stack:e});let d=[],p=[],f=[],h=[];for(let m of c.collectionDefinitions){let{matchUpCount:g,collectionId:I}=m;p.push(I);let v=(l.tieMatchUps||[]).filter(w=>w.collectionId===I);if(v.length>g)v.sort((w,y)=>(w.matchUpStatus===Li?1:0)-(y.matchUpStatus===Li?1:0)),f.push(...v.slice(0,g)),d.push(...v.slice(3).map(vr));else if(f.push(...v),v.length<g){let w=g-v.length,y=FS({collectionDefinition:m,matchUpsLimit:w,matchUp:l,uuids:n});h.push(...y)}}for(let m of l?.tieMatchUps||[])m.collectionId&&!p.includes(m.collectionId)&&d.push(m.matchUpId);return h.length&&(f.push(...h),wd({eventId:r?.eventId,matchUps:h,drawDefinition:i,tournamentId:o})),d.length&&Fu({matchUpIds:d,eventId:r?.eventId,drawDefinition:i,tournamentId:o}),l&&(l.tieMatchUps=f,l.tieFormatId=void 0,l.tieFormat=void 0,Tt({structureId:u?.structureId,eventId:r?.eventId,context:e,drawDefinition:i,tournamentId:o,matchUp:l})),{...H,newMatchUps:h,deletedMatchUpIds:d}}function g$(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}=t,a="resetScorecard";if(!i)return z({result:{error:_e},stack:a});if(!r)return z({result:{error:Tn},stack:a});if(!ni(r))return z({result:{error:ie,matchUpId:r},stack:a});let s=Or({drawDefinition:i}),{matchUps:o}=rr({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:s}),l=s.drawMatchUps.find(m=>m.matchUpId===r),u=o?.find(m=>m.matchUpId===r);if(!l||!o)return{error:cn};if(l.matchUpType!==Da)return{error:la};let c=_n({inContextDrawMatchUps:o,drawDefinition:i,matchUpId:r}),d=u?.structureId,{structure:p}=et({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:o,inContextMatchUp:u,matchUpsMap:s,targetData:c,structure:p,matchUp:l}),Bp(t))return{error:hR};if(l.tieMatchUps?.length)for(let m of l.tieMatchUps){let g=yf({matchUpId:m.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:n});if(g.error)return z({result:g,stack:a})}let f=Rt({tournamentRecord:e,drawDefinition:i,event:n})?.appliedPolicies,h=Hc({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:f,drawDefinition:i,matchUpsMap:s,matchUpId:r});if(h.error)return z({result:h,stack:a});if(t.tiebreakReset&&!h.tieFormatRemoved){let m=yn({drawDefinition:i,structure:p,event:n})?.tieFormat;if(l.tieFormat&&m){let{matchUpCountDifference:g,descendantDifferences:I,ancestorDifferences:v,valueDifference:w}=Tc({descendant:l.tieFormat,ancestor:m});if(I.collectionIds.length===1&&!v.collectionIds.length&&!v.groupsCount&&g===1&&w===1){let y=m$({tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n});if(y.error)return y}}}return{...H}}function RQ(t){let e=Ge(t,[{[mn]:!0,[$c]:!0},{[cI]:{[aS]:!1,roundNumbers:!1},[j5]:"At least one must be provided",[Xn]:sn}]);if(e.error)return e;let i=M9(t);if(i.error)return i;let{matchUpIds:r}=i,n=Ti(Da)(t.event.eventType),{tournamentRecord:a,drawDefinition:s,event:o}=t;for(let l of r){if(n){let c=g$({tiebreakReset:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(c.error||t.removeAssignments&&h$({inheritance:!1,drawDefinition:s,matchUpId:l}).error)return c}let u=yf({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(u.error)return u;if(t.removeAssignments){let c=o$({...t,matchUpId:l});if(c.error)return c}}return{...H}}function bCe({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){if(!e)return{error:_e};let r="setOrderOfFinish";if(!Array.isArray(i))return z({info:_p("finishingOrder"),result:{error:ie},stack:r});let{completedMatchUps:n,matchUpsMap:a}=vv({inContext:!0,drawDefinition:e}),s=n?.map(vr)??[],o=i.map(vr),{matchUpTypes:l,roundNumbers:u,structureIds:c,matchUpTieIds:d}=(n??[]).filter(({matchUpId:v})=>o.includes(v)).reduce((v,w)=>{let{matchUpTieId:y,matchUpType:b,roundNumber:S,structureId:U}=w;return v.matchUpTypes.includes(b)||v.matchUpTypes.push(b),v.roundNumbers.includes(S)||v.roundNumbers.push(S),v.structureIds.includes(U)||v.structureIds.push(U),v.matchUpTieIds.includes(y)||v.matchUpTieIds.push(y),v},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||u.length>1||c.length>1)return z({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:ie},stack:r});let p,f,h={},m=[],g=[];if(!i.every(({orderOfFinish:v,matchUpId:w})=>(m.push(w),v&&g.push(v),h[w]=v,p=s.includes(w),f=v===void 0||ut(v)&&Math.floor(v)>0,p&&f)))return z({result:{error:p?ie:sv},info:!p&&"matchUps must be completed"||!f&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let I=n?.filter(v=>v.structureId===c[0]&&v.roundNumber===u[0]&&v.matchUpType===l[0]&&v.matchUpTieId===d[0]&&!m.includes(v.matchUpId));for(let v of I??[]){let{orderOfFinish:w}=v||{};if(w){if(!ut(w))return z({context:{orderOfFinish:w,matchUp:v},result:{error:ie},stack:r});g.push(w)}}if(Q6(g).length!==g.length||Math.max(...g)>g.length)return z({info:"Values not unique or greater than expected number of values",result:{error:ie},stack:r});if(c.length){let v=aC({matchUpFilters:{matchUpIds:o},structureId:c[0],drawDefinition:e,matchUpsMap:a});if(v.error)return z({result:v,stack:r});v.completedMatchUps?.forEach(w=>{w.orderOfFinish=h[w.matchUpId],Tt({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:w})})}return{...H}}function CQ(t){return bCe(t)}function MQ(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=t,s="applyLineUps",o=Ge(t,[{[mr]:!0,[mn]:!0,[Nl]:!0},{lineUps:!0,[Xn]:sn}],s);if(o.error)return o;let l=e.participants||[],u=pi({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:r});if(u.error)return u;if(!u.matchUp)return{error:cn};let{matchUp:c,structure:d}=u,{drawPositions:p,matchUpType:f}=c;if(f!==ei)return{error:la};if(!p?.length)return{error:Gw};let h=yn({matchUp:c,drawDefinition:i,structure:d,event:a})?.tieFormat,m={};for(let I of n){if(!Array.isArray(I))return{error:ie,lineUp:I};let v={},w=[];for(let T of I){if(typeof T!="object")return{error:ie,lineUpAssignment:T};let{participantId:D,collectionAssignments:P=[]}=T;if(!Array.isArray(P))return{error:ie,collectionAssignments:P};let E=l.find(C=>C.participantId===D);if(!E)return{error:ji};if(E.participantType!==vt)return{error:Ao};let R=c.sides?.find(C=>C.participant?.individualParticipantIds?.includes(D))?.sideNumber;R&&w.push(R);for(let C of P){if(typeof C!="object")return{error:ie,collectionAssignment:C};let{collectionId:M,collectionPosition:N}=C,A=h?.collectionDefinitions?.find(F=>F.collectionId===M);if(!A)return{error:ie,collectionId:M};let O=`${M}-${N}`;v[O]||(v[O]=[]);let k=v[O].length;if(Ti(zt)(A.matchUpType)&&k||A.matchUpType===Bt&&k>1)return{info:"Excessive collectionPosition assignments",error:ie};v[O].push(D)}}let y=Object.values(v);for(let T of y)if(T.length===2){let{participant:D}=io({tournamentParticipants:l,participantIds:T});if(!D){let P=Il({participant:{participantType:ht,participantRole:Xr,individualParticipantIds:T},pairOverride:!0,tournamentRecord:e});if(P.error)return P}}let b=Ta(w),S=(b[1]||0)>(b[2]||0)&&1||(b[2]||0)>(b[1]||0)&&2||void 0,U=Object.keys(m).map(T=>parseInt(T));S&&!U.includes(S)&&(m[S]=I)}if(!Object.keys(m).length)return{error:R1};if(u=pi({drawDefinition:i,matchUpId:r}),u.error)return u;if(!u.matchUp)return{error:cn};let{matchUp:g}=u;g.sides??=[];for(let I of[1,2]){let v=g.sides.find(y=>y.sideNumber===I),w=m[I];if(w)v?v.lineUp=w:g.sides.push({lineUp:w,sideNumber:I});else continue}return Tt({tournamentId:e?.tournamentId,context:s,drawDefinition:i,matchUp:g}),{...H}}var I$={};pt(I$,{anonymizeTournamentRecord:()=>QQ,generate:()=>NQ,generateEventWithDraw:()=>hM,generateOutcome:()=>D$,generateOutcomeFromScoreString:()=>v$,generateParticipants:()=>Fv,generateTournamentRecord:()=>XQ,modifyTournamentRecord:()=>eZ,mutate:()=>JQ});var NQ={};pt(NQ,{generateEventWithDraw:()=>hM,generateOutcome:()=>D$,generateOutcomeFromScoreString:()=>v$,generateParticipants:()=>Fv,generateTournamentRecord:()=>XQ});function wCe(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i.side1+=r.side1Score??0,i.side2+=r.side2Score??0),i),{side1:0,side2:0});return e.side1>e.side2?1:e.side2>e.side1?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function SCe(t){let e={side1:0,side2:0};if(t.forEach(i=>{i.winningSide===1?e.side1++:i.winningSide===2&&e.side2++}),e.side1>e.side2)return 1;if(e.side2>e.side1)return 2}function UCe(t,e,i){if(t||!e||!i)return t;let r=Ki(e);return OC(r)?wCe(i):SCe(i)}function TCe(t,e,i){let r=zS({scoreString:t,matchUpFormat:e});return{sets:r,scoreStringSide1:eu({sets:r,matchUpFormat:e,setTBlast:i}),scoreStringSide2:eu({sets:r,reversed:!0,matchUpFormat:e,setTBlast:i})}}function DCe(t,e,i,r){let n=eu({sets:t,matchUpFormat:i,setTBlast:r}),a=eu({sets:t,reversed:!0,matchUpFormat:i,setTBlast:r});if(typeof n!="string")return n;if(typeof a!="string")return a;let s=e===2?a:n,o=e===2?n:a;return{sets:zS({scoreString:s,matchUpFormat:i}),scoreStringSide1:s,scoreStringSide2:o}}function v$(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n,setTBlast:a,preserveSideOrder:s=!1}=t;if(!n)return{outcome:{...gC,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:ie,winningSide:r};let o=n&&zS({scoreString:n,matchUpFormat:e}),l=n?.trim().startsWith("["),u=UCe(r,e,o),c=Ki(e),d=s||l||OC(c)?TCe(n,e,a):DCe(o,u,e,a);return Ve({outcome:{matchUpStatus:i,winningSide:u,score:d}})}function y$({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){let n=(e?.[r.matchUpId]?.matchUpIds||[]).filter(a=>i.includes(a)).filter(a=>!t[a]);return{dependenciesScheduled:!n?.length,remainingDependencies:n}}function eU({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function PCe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function Xb({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:s=0,scheduleTime:o,matchUp:l}){let u=di(l?.schedule?.endTime),c=u?ra(u,Ye(s)):ra(o,Ye(r)+Ye(s)),d=i&&(u?ra(di(u),i):ra(o,Ye(r)+Ye(i))),p=a?.[l.matchUpId]?.participantIds||[],f=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(h=>{eU({individualParticipantProfiles:e,participantId:h});let m=e[h].priorMatchUpType!==l.matchUpType&&d||c;f.includes(h)?PCe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:m,participantId:h,scheduleTime:o}):(e[h].timeAfterRecovery=m,e[h].bookings.push({scheduleTime:o,timeAfterRecovery:m}))}),bI({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:c,matchUp:l})}function AQ({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){let a,s=n.minutesMap?.[r]?.recoveryMinutes,o=(n.minutesMap?.[r]?.averageMinutes||0)+(s||0),l=ra(i,o),u=e?.[r]?.dependentMatchUpIds||[];if(u.length){let c=u.reduce((d,p)=>{let f=t[p];if(!f)return d;let h={scheduleTime:f,matchUpId:p};return f&&!d.matchUpId||Mt(f)<Mt(d.scheduleTime)?h:d},{});c.scheduleTime&&Mt(l)>Mt(c.scheduleTime)&&(a=c)}return{scheduledDependent:a}}function ECe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>i===Bt&&(r?.participant?.individualParticipants||[])||r?.participant&&[r.participant]||[]).flat()}var tU="DO_NOT_SCHEDULE",RCe={DO_NOT_SCHEDULE:tU};function b$({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:s}){let o=ECe(s).map(({person:f})=>f?.personId);if(i){let f=(s?.potentialParticipants||[]).flat().map(({person:h})=>h?.personId);o.push(...f)}let l=o.map(f=>r[f]?.map(h=>({...h,personId:f}))).filter(Boolean).flat().filter(f=>f.requestType===tU&&du(a,f.date)),u=[],c=s?.matchUpId,d=tr(di(n),Qe(a)),p=di(V1(d,t).toISOString());for(let f of l){let{requestId:h,startTime:m,endTime:g}=f;(n>m&&n<g||p&&p>m&&p<g)&&(u.push({matchUpId:c,request:f,scheduleTime:n}),e[h]?(e[h].scheduleTimes.includes(n)||e[h].scheduleTimes.push(n),e[h].matchUpIds.includes(c)||e[h].matchUpIds.push(c)):e[h]={request:f,scheduleTimes:[n],matchUpIds:[c]})}return{conflicts:u}}function vx({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=YR(i),s=(t[i.matchUpId]||[]).filter(o=>!Ln(o,a)).flat();[...a,...s].forEach(o=>{if(eU({individualParticipantProfiles:e,participantId:o}),!e[o].potentialCounted[i.drawId]){let l=e[o].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[Vs]?l[Vs]+=r:r>0&&(l[Vs]=r),s.includes(o)&&(e[o].potentialCounted[i.drawId]=!0)}})}function CCe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,matchUpDependencies:o,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){let p=[];i||(n=d?.filter(m=>{let g=m.schedule||{},I=m.matchUpStatus==="BYE";return I&&p.push({tournamentId:m.tournamentId,matchUpId:m.matchUpId}),!I&&KS({schedule:g})&&(!u||m.schedule.scheduledDate===u)}),i=n.map(vr));let f=Array.isArray(l)?l.includes(u):l,h=f?[]:d.filter(({matchUpId:m})=>i.includes(m));for(let m of h){vx({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:m});let g=m.schedule?.scheduledTime;if(g){s[m.matchUpId]=g;let I=c?.[m.matchUpId]?.recoveryMinutes;Xb({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:o,averageMatchUpMinutes:r,recoveryMinutes:I,scheduleTime:g,matchUp:m})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:f}}function uM({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:s,matchUps:o}){if(typeof r!="object")return{error:Ri};if(!Ja(o)&&!Array.isArray(i))return{error:Ou};a=a??iM({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).flatMap(d=>(d.events??[]).map(p=>{let{scheduleTiming:f}=hS({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:f}}}))),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i??=o?.filter(d=>{let p=d.schedule;return KS({schedule:p})&&(!s||d.schedule.scheduledDate===s)});let c=i?.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!=="BYE");return{bookings:c?.map(({eventId:d,schedule:p,matchUpFormat:f})=>{let{event:h,scheduleTiming:m}=l[d],g=h?.eventType,I={...m,defaultTiming:u,matchUpFormat:f},{averageMinutes:v,recoveryMinutes:w}=eC({timingDetails:I,eventType:g}),{courtId:y,venueId:b}=p,S=di(p.scheduledTime),U=ra(S,v);return{recoveryMinutes:w,averageMinutes:v,periodLength:a,startTime:S,courtId:y,endTime:U,venueId:b}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function MCe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:s,periodLength:o,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(s&&!a&&(a={[s.tournamentId]:s}),typeof a!="object"||!Object.keys(a).length)return{error:Ri};o=o??iM({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:f,venues:h}=_u({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=f?.filter(b=>!c||c.includes(b.venueId))??[];u=u??wI({courts:m,scheduleDate:l,startTime:!0}),p=p??wI({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:I}=uM({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:o,venueIds:c,matchUps:d}),v={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:o,startTime:u,bookings:g,endTime:p,courts:m},{scheduleTimes:w}=i$(v),y=c?.length===1&&c[0]||h?.length===1&&h[0].venueId||void 0;return{dateScheduledMatchUpIds:I?.map(Pa("matchUpId")),dateScheduledMatchUps:I,scheduleTimes:w,venueId:y}}function NCe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,s,o,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(n=n.concat(u.matchUpIds)),u.hash,o=e,s=u.recoveryMinutes,a=u.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:s,averageMinutes:o}),{groupedRounds:r}}function kQ({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:f,venues:h}){let m={},g=[],I=[],v=[];for(let w of h){let{rounds:y=[],venueId:b}=w,{scheduledRoundsDetails:S,greatestAverageMinutes:U,orderedMatchUpIds:T,minutesMap:D}=qS({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:u,matchUps:p,rounds:y});v.push(...T??[]);let{groupedRounds:P}=NCe({scheduledRoundsDetails:S,greatestAverageMinutes:U,garmanSinglePass:!0}),E,R=[];d&&({scheduleTimes:R,dateScheduledMatchUpIds:E}=MCe({averageMatchUpMinutes:P[0]?.averageMinutes,scheduleDate:Qe(c),venueIds:[w.venueId],clearScheduleDates:o,tournamentRecords:l,periodLength:u,matchUps:p}));let C=CCe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:E,greatestAverageMinutes:U,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,scheduleDate:c,minutesMap:D,matchUps:p});({dateScheduledMatchUpIds:E}=C);let M=C,{byeScheduledMatchUpDetails:N,clearDate:A}=C;N?.length&&I.push(...N);let{matchUpsToSchedule:O,matchUpMap:k}=VC({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:E,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:T,clearDate:A,matchUps:p}),F=f.filter(x=>x.venueId===b);m[b]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:U,scheduledRoundsDetails:S,dateScheduledMatchUps:M,matchUpsToSchedule:O,scheduleTimes:R,groupedRounds:P,venueCourts:F,minutesMap:D,matchUpMap:k},o||g.push(...E)}return{allDateScheduledByeMatchUpDetails:I,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:m,allDateMatchUpIds:v}}function ACe(t,e){let i=Mt(t.scheduleTime),r=Mt(t.timeAfterRecovery),n=Mt(e.scheduleTime),a=Mt(e.timeAfterRecovery),s=i===n||r===a,o=i>n&&i<a,l=n>i&&n<r,u=r>n&&r<a,c=a>i&&a<r;return Ve({hasOverlap:s||o||u||l||c,startAisContained:o,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function w$({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){let s=(i?.[n.matchUpId]?.participantIds||[]).flat(),o=a?.minutesMap?.[n.matchUpId]?.averageMinutes||0,l=a?.minutesMap?.[n.matchUpId]?.recoveryMinutes||0,u=s.every(p=>{eU({individualParticipantProfiles:t,participantId:p});let f=t[p];if(!f.timeAfterRecovery)return!0;let h=di(n?.schedule?.endTime),m=h?ra(h,Ye(l)):ra(r,Ye(o)+Ye(l));return![...Object.keys(f.potentialBookings).filter(g=>g!==n.drawId).map(g=>f.potentialBookings[g]).flat(),...f.bookings].find(g=>ACe({scheduleTime:r,timeAfterRecovery:m},g).hasOverlap)}),c=e[n.matchUpId],d=(c?Qw(tr(c),tr(r),!1):0)>=0;return{enoughTime:u&&d}}function OQ({autoSchedulingAudit:t,tournamentRecords:e}){nt({topic:sc,payload:t});let i=s=>s?Object.values(s).reduce((o,l)=>o+l.length||0,0):0,r=(t?.schedulingProfile||[]).reduce((s,o)=>s+o.venues.reduce((l,u)=>l+u.rounds.length,0),0),n={scheduledDatesCount:t.scheduledDates?.length,noTimeMatchUpIdsCount:i(t?.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t?.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t?.overLimitMatchUpIds),requestConflictsCount:i(t?.requestConflicts),profileRoundsCount:r},a={itemType:mx,itemValue:n};for(let s of Object.values(e)){let o=s.tournamentId;Jw(sc)?nt({payload:{type:mx,tournamentId:o,detail:n},topic:sc}):BS({tournamentRecord:s,timeItem:a})}}function S$({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=YR(r),{matchUpId:a,matchUpType:s}=r,o=(r.roundPosition&&t[a]||[]).flat(),l=ot(n.concat(...o));return l.forEach(u=>{eU({individualParticipantProfiles:e,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=e[u];if(c)return[s,Vs].find(d=>{let p=c.counters?.[d]||0,f=i[d]||0;return p&&f&&p>=f})}),relevantParticipantIds:l}}function Jb({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:s,tournamentRecord:o,matchUpDetails:l,matchUpIds:u,schedule:c}){if(!o)return{error:ge};if(!l&&(!u||!Array.isArray(u)))return{error:um};if(!l&&(!c||typeof c!="object"))return{error:oK};let d,p=[],f=0;if(r&&!n){let g=fo({tournamentRecords:s,tournamentRecord:o});n=g.matchUpDependencies,d=g.matchUps}d||(d=wr({tournamentRecord:o})?.matchUps??[]);let h=d.reduce((g,I)=>{let{matchUpId:v,drawId:w,matchUpStatus:y}=I;return(e||y!=="BYE")&&(t||!Ji.includes(y))&&(g[w]?g[w].push(v):g[w]=[v]),g},{}),m=l?.map(g=>g.matchUpId);for(let g of Object.keys(h)){let{drawDefinition:I}=Kd({tournamentRecord:o,drawId:g});if(!I)continue;let v=h[g].filter(y=>u?.includes(y)??m?.includes(y)),w=Nn({inContext:!1,drawDefinition:I}).matchUps;for(let y of v){let b=l?.find(U=>U.matchUpId===y)?.schedule||c,S=lM({schedule:b,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:s,tournamentRecord:o,checkChronology:r,drawDefinition:I,drawMatchUps:w,matchUpId:y});if(S?.warnings?.length&&p.push(...S.warnings),S?.success&&(f+=1),S.error)return S}}return p.length?{...H,scheduled:f,warnings:p}:{...H,scheduled:f}}function iU(t){let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:s,checkChronology:o,matchUpDetails:l,schedule:u}=t;if(t.matchUpIds&&!n)return Jb(t);let c=Ge(t,[{[dn]:!0},{[cI]:{matchUpContextIds:!1,matchUpDetails:!1},[Ha]:ie,[Xn]:sn}]);if(c.error)return c;if((!l||n)&&!u)return{error:Xe,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:f}=fo({tournamentRecords:s});for(let h of Object.values(s)){let{tournamentId:m}=h,g=n?.filter(v=>v.tournamentId===m).map(vr),I=l?.filter(v=>v?.tournamentId===m);if(g?.length||I?.length){let v=Jb({matchUpDetails:I,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:h,checkChronology:o,matchUpIds:g,schedule:u});if(v.warnings?.length&&d.push(...v.warnings),v.scheduled&&(p+=v.scheduled),v.error)return v}}return d.length?{...H,scheduled:p,warnings:d}:{...H,scheduled:p}}function kCe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:f,courts:h,dryRun:m}){let g={},I={},v={},w={},y={},b={},S={},U={},T={},D={};for(let R of n){let C=Qe(R?.scheduleDate),M=R?.venues||[],N={},A={},O=(G,j)=>{G.forEach(Y=>{let K=A[Y].counters;K[j]?K[j]+=1:K[j]=1,K[Vs]?K[Vs]+=1:K[Vs]=1})};v[C]={},w[C]={},g[C]={},I[C]={},S[C]=[],U[C]=[],T[C]=[],D[C]=[];let k={};f.forEach(G=>{G.schedule?.scheduledDate&&du(C,Qe(G.schedule.scheduledDate))&&bI({matchUpPotentialParticipantIds:N,matchUpNotBeforeTimes:k,matchUp:G})});let{allDateScheduledByeMatchUpDetails:F,venueScheduledRoundDetails:x,allDateMatchUpIds:L}=kQ({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:k,matchUpScheduleTimes:b,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:C,matchUps:f,courts:h,venues:M}),$=10,V=0,_,B=10;for(;!_;){for(let{venueId:G}of M){let j=0,Y=x[G];for(;Y.courtsCount&&Y.scheduleTimes?.length&&Y.matchUpsToSchedule?.length&&j<=Y.courtsCount;){let{scheduleTime:K,attempts:X=0}=Y.scheduleTimes.shift(),Z=Y.matchUpsToSchedule.find(Q=>{let{matchUpId:ae,matchUpType:te}=Q,{participantIdsAtLimit:ne,relevantParticipantIds:le}=S$({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,matchUpDailyLimits:o,matchUp:Q});if(ne.length)return U[C].includes(ae)||U[C].push(ae),!1;let{scheduledDependent:de}=AQ({matchUpScheduleTimes:b,matchUpDependencies:s,scheduleTime:K,matchUpId:ae,details:Y});if(de)return!1;let{dependenciesScheduled:pe,remainingDependencies:ve}=y$({matchUpScheduleTimes:b,matchUpDependencies:s,allDateMatchUpIds:L,matchUp:Q});if(!pe)return w[C][ae]||(w[C][ae]=[]),w[C][ae].push({scheduleTime:K,remainingDependencies:ve}),!1;let{enoughTime:Me}=w$({individualParticipantProfiles:A,matchUpNotBeforeTimes:k,matchUpDependencies:s,scheduleTime:K,details:Y,matchUp:Q});if(!Me)return v[C][ae]||(v[C][ae]=[]),v[C][ae].push({scheduleTime:K}),!1;let Ee=Y.greatestAverageMinutes,{conflicts:Be}=b$({potentials:e,averageMatchUpMinutes:Ee,requestConflicts:D,personRequests:d,scheduleTime:K,scheduleDate:C,matchUp:Q});if(Be?.length)return y[C]||(y[C]=[]),y[C].push(...Be),!1;O(le,te);let fe=Y.minutesMap?.[ae]?.recoveryMinutes;return Xb({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,matchUpNotBeforeTimes:k,averageMatchUpMinutes:Ee,matchUpDependencies:s,recoveryMinutes:fe,scheduleTime:K,matchUp:Q}),b[ae]=K,!0});Y.matchUpsToSchedule=Y.matchUpsToSchedule.filter(({matchUpId:Q})=>Q!==Z?.matchUpId),Z?j+=1:(I[C][G]||(I[C][G]=[]),I[C][G].push({scheduleTime:K,attempts:X+1}))}Y.matchUpsToSchedule?.length&&(I[C][G]=I[C][G]?.filter(K=>{let X=K.attempts<$;return X&&Y.scheduleTimes.push(K),!X})),(!Y.scheduleTimes?.length||!Y.matchUpsToSchedule?.length)&&(Y.complete=!0)}V+=1,_=M.every(({venueId:G})=>x[G].complete)||V===B}for(let{venueId:G}of M){let j=x[G].matchUpMap;Object.keys(j).forEach(Y=>{let K=u[Y];K&&Object.keys(j[Y]).forEach(X=>{let{drawDefinition:Z}=Kd({tournamentRecord:K,drawId:X});Z&&j[Y][X].forEach(({matchUpId:Q})=>{let ae=b[Q];if(ae){let te=ae.split(":").map(os).join(":"),ne=`${Qe(C)}T${te}`;m?S[C].push(Q):(Xd({drawDefinition:Z,scheduledTime:ne,matchUpId:Q}).success&&S[C].push(Q),G&&xv({tournamentRecord:K,drawDefinition:Z,matchUpId:Q,venueId:G}))}})})}),T[C]=x[G].matchUpsToSchedule.map(vr),g[C][G]=x[G].scheduleTimes.sort((Y,K)=>Mt(Y.scheduleTime)-Mt(K.scheduleTime))}!m&&F?.length&&iU({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let G of R.venues)for(let j of G.rounds){let Y=(j.matchUps?.map(({matchUpId:X})=>X)||[]).filter(X=>S[C].includes(X));j.canScheduledMatchUpIds=Y;let K=Math.round(Y.length/j.matchUpsCount*1e4)/100;(K===1/0||isNaN(K))&&(K=0),j.possibleToSchedulePct=K,j.matchUpsCount===Y.length&&(j.possibleToSchedule=!0)}}let P=n.map(({scheduleDate:R})=>R),E={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:S,schedulingProfile:c,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:P};return OQ({tournamentRecords:u,autoSchedulingAudit:E}),{...H,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:I,recoveryTimeDeferredMatchUpIds:v,dependencyDeferredMatchUpIds:w,matchUpScheduleTimes:b,overLimitMatchUpIds:U,scheduledMatchUpIds:S,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:P}}function Pz({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Xe,stack:"getEarliestCourtTime"};let a=wI({scheduleDate:n,courts:[r],startTime:!0}),s=wI({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||s;let o=Pd({court:r,date:n}),{timeSlots:l}=kv({courtDate:o}),u=tr(e),c=tr(i);return{earliestCourtTime:l?.reduce((d,p)=>{let f=tr(p.startTime),h=tr(p.endTime);if(f>c||h<u)return d;let m=u>f?u:f;if(Qw(m,h)>=t){let g=di(m.toISOString());g&&(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:s}}function OCe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:f=[],courts:h,dryRun:m}){let g={},I={},v={},w={},y={},b={},S={},U={},T={};for(let E of n??[]){let R=Qe(E?.scheduleDate),C=E?.venues||[],M={},N={},A=(Z,Q)=>{Z.forEach(ae=>{let te=N[ae].counters;te[Q]?te[Q]+=1:te[Q]=1,te[Vs]?te[Vs]+=1:te[Vs]=1})};g[R]={},I[R]={},b[R]=[],S[R]=[],U[R]=[],T[R]=[];let O={};f?.forEach(Z=>{Z.schedule?.scheduledDate&&du(R,Qe(Z.schedule.scheduledDate))&&bI({matchUpPotentialParticipantIds:M,matchUpNotBeforeTimes:O,matchUp:Z})});let{allDateScheduledByeMatchUpDetails:k,allDateScheduledMatchUpIds:F,venueScheduledRoundDetails:x,allDateMatchUpIds:L}=kQ({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:O,matchUpScheduleTimes:y,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:R,matchUps:f,courts:h,venues:C}),$=f?.filter(({matchUpId:Z})=>F.includes(Z)),{bookings:V}=uM({dateScheduledMatchUps:$,tournamentRecords:u,scheduleDate:R,periodLength:c}),{virtualCourts:_}=tM({scheduleDate:R,periodLength:c,bookings:V,courts:h}),B=_?.reduce((Z,Q)=>{let{earliestCourtTime:ae,courtEndTime:te}=Pz({date:R,averageMinutes:0,court:Q});return(!Z.startTime||tr(ae)<tr(Z.startTime))&&(Z.startTime=ae),(!Z.endTime||tr(te)>tr(Z.endTime))&&(Z.endTime=te),Z},{}),G=B.startTime,j=({courtId:Z,booking:Q})=>_?.find(ae=>ae.courtId===Z)?.dateAvailability[0].bookings.push(Q),Y=10,K=0,X;for(;!X;){for(let{venueId:Z}of C){let Q=x[Z],ae=Q.matchUpsToSchedule.length,te=[],ne=[],le,de=0;for(;!le;){for(let pe of Q.matchUpsToSchedule){if(ne.length===Q.courtsCount||te.length===Q.courtsCount){le=!0;break}let{matchUpId:ve,matchUpType:Me}=pe,{participantIdsAtLimit:Ee,relevantParticipantIds:Be}=S$({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpDailyLimits:o,matchUp:pe});if(Ee.length){S[R].includes(ve)||S[R].push(ve);continue}let{dependenciesScheduled:fe,remainingDependencies:Te}=y$({matchUpScheduleTimes:y,matchUpDependencies:s,allDateMatchUpIds:L,matchUp:pe});if(!fe){I[R][ve]||(I[R][ve]=[]),I[R][ve].push({remainingDependencies:Te});continue}let ce=[],be=_?.reduce((we,Ae)=>{if(ne.includes(Ae.courtId))return we;let{earliestCourtTime:ye}=Pz({averageMinutes:Q.greatestAverageMinutes,startTime:G,date:R,court:Ae});if(we.scheduleTime&&Mt(ye)>=Mt(we.scheduleTime))return we;let{scheduledDependent:Ne}=AQ({matchUpScheduleTimes:y,matchUpDependencies:s,scheduleTime:ye,matchUpId:ve,details:Q});if(Ne)return we;let{enoughTime:he}=w$({individualParticipantProfiles:N,matchUpNotBeforeTimes:O,matchUpDependencies:s,scheduleTime:ye,details:Q,matchUp:pe});if(!he)return g[R][ve]||(g[R][ve]=[]),g[R][ve].includes(ye)||g[R][ve].push(ye),we;let De=Q.minutesMap?.[ve]?.averageMinutes||Q.greatestAverageMinutes,{conflicts:Le}=b$({potentials:e,averageMatchUpMinutes:De,requestConflicts:T,personRequests:p,scheduleTime:ye,scheduleDate:R,matchUp:pe});if(Le?.length)return ce.push(...Le),!1;A(Be,Me);let J=Q.minutesMap?.[ve]?.recoveryMinutes;return Xb({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpNotBeforeTimes:O,averageMatchUpMinutes:De,matchUpDependencies:s,recoveryMinutes:J,scheduleTime:ye,matchUp:pe}),(!we.scheduleTime||Mt(ye)<Mt(we.scheduleTime))&&(we.averageMatchUpMinutes=De,we.recoveryMinutes=J,we.scheduleTime=ye,we.courtName=Ae.courtName,we.courtId=Ae.courtId),we},{});if(be.scheduleTime){let{averageMatchUpMinutes:we,recoveryMinutes:Ae,scheduleTime:ye,courtId:Ne}=be;y[ve]=ye,w[ve]=Ne,te.push(ve),ne.push(Ne);let he=ye,De=ra(he,we);j({courtId:Ne,booking:{averageMatchUpMinutes:we,recoveryMinutes:Ae,periodLength:c,matchUpId:ve,startTime:he,courtId:Ne,endTime:De,venueId:Z}}),Q.matchUpsToSchedule=Q.matchUpsToSchedule.filter(Le=>Le.matchUpId!==ve)}else ce?.length&&(v[R]||(v[R]=[]),v[R].push(...ce))}(ne.length===Q.courtsCount||te.length===Q.courtsCount||!Q.matchUpsToSchedule.length)&&(le=!0),Q.matchUpsToSchedule.length&&te<Q.courtsCount&&(tr(G)<tr(B.endTime)?G=ra(G,c):(le=!0,Q.complete=!0)),de+=1,!le&&de>=ae&&(le=!0)}Q.matchUpsToSchedule?.length||(Q.complete=!0)}K+=1,X=C.every(({venueId:Z})=>x[Z].complete)||K===Y}for(let{venueId:Z}of C){let Q=x[Z].matchUpMap;Object.keys(Q).forEach(ae=>{let te=u[ae];te&&Object.keys(Q[ae]).forEach(ne=>{let{drawDefinition:le}=Kd({tournamentRecord:te,drawId:ne});le&&Q[ae][ne].forEach(({matchUpId:de})=>{let pe=y[de],ve=w[de];if(pe){let Me=pe.split(":").map(os).join(":"),Ee=`${Qe(R)}T${Me}`;m||(Xd({drawDefinition:le,scheduledTime:Ee,matchUpId:de}),xm({courtDayDate:R,tournamentRecords:u,tournamentRecord:te,drawDefinition:le,matchUpId:de,courtId:ve})),b[R].push(de)}})})}),U[R]=x[Z].matchUpsToSchedule.map(vr)}!m&&k?.length&&iU({matchUpDetails:k,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let Z of E.venues)for(let Q of Z.rounds){let ae=(Q.matchUps??[]).map(({matchUpId:ne})=>ne)?.filter(ne=>b[R].includes(ne));Q.canScheduledMatchUpIds=ae;let te=Math.round((ae?.length||0)/Q.matchUpsCount*1e4)/100;(te===1/0||isNaN(te))&&(te=void 0),Q.possibleToSchedulePct=te,Q.matchUpsCount===ae?.length&&(Q.possibleToSchedule=!0)}}let D=(n??[]).map(({scheduleDate:E})=>E),P={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:b,schedulingProfile:d,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:D};return OQ({tournamentRecords:u,autoSchedulingAudit:P}),{...H,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:y,overLimitMatchUpIds:S,scheduledMatchUpIds:b,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:D}}function cM(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=Ji,scheduledDates:r,venueIds:n}=t,a=ws(t),s=St(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!s?.length)return{error:Ri};let o=0;for(let l of s){let u=a[l],c=xCe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:r,venueIds:n});if(c.error)return c;o+=c.clearedScheduleCount??0}return{...H,clearedScheduleCount:o}}function xCe({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=Ji,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:ge};if(!Array.isArray(e)||!Array.isArray(n))return{error:ie};n.length&&t.push("venueId");let a=wr({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],s={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&KS({schedule:c,scheduleAttributes:t})&&(!n?.length||n.includes(c.venueId))&&(s[d]||(s[d]=[]),s[d].push(p))});let o=i.tournamentId,l=0;for(let u in s){let{event:c,drawDefinition:d}=zn({tournamentRecord:i,drawId:u}),p=Nn({drawDefinition:d,matchUpFilters:{matchUpIds:s[u]}}).matchUps??[];for(let f of p){let h=!1;f.timeItems=(f.timeItems??[]).filter(m=>{let g=m?.itemType&&![vu,Ud,bm,QR,wm,Sm].includes(m?.itemType);return g||(h=!0),g}),h&&(Tt({context:"clear schedules",eventId:c?.eventId,drawDefinition:d,tournamentId:o,matchUp:f}),l+=1)}}return{...H,clearedScheduleCount:l}}function dM(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:s,useGarman:o,dryRun:l,pro:u}=t,c=Ge(t,[{[dn]:!0},{[qr]:D=>!D||Array.isArray(D)&&D.every(Cn),[F5]:!1,[Xn]:sn}]);if(c.error)return c;let d=Wc({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...H};let{modifications:p,issues:f=[],schedulingProfile:h=[]}=d,m=Object.assign({},...Object.values(a).map(D=>gv({tournamentRecord:D}).containedStructures)),g=new Set(n.map(D=>{if(Cn(D))return Qe(D)}).filter(Boolean)),I=h.map(D=>D.scheduleDate).map(D=>Cn(D)&&Qe(D)).filter(D=>D&&(!n.length||g.has(D)));if(!I.length)return{error:x4};if(r&&!l){let D=Array.isArray(r)?r:[];cM({tournamentRecords:a,scheduledDates:D})}let v=_u({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:w}=Oo({matchUpFilters:{matchUpTypes:[zt,Bt]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:y}=fo({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:w}),{matchUpDailyLimits:b}=XC({tournamentRecords:a}),{personRequests:S}=vf({requestType:tU,tournamentRecords:a}),U=h.filter(D=>{let P=Qe(D?.scheduleDate);return I.includes(P)}).sort((D,P)=>new Date(D.scheduleDate).getTime()-new Date(P.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:f,dateSchedulingProfiles:U,containedStructureIds:m,matchUpDependencies:y,matchUpDailyLimits:b,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:h,personRequests:S,periodLength:s,matchUps:w,dryRun:l,courts:v};return u?OCe(T):kCe(T)}function pM(t){if(!t||typeof t!="string")return!1;try{return Intl.DateTimeFormat(void 0,{timeZone:t}),!0}catch{return!1}}function yx(t,e){let i=e??new Date,r=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).formatToParts(i).find(l=>l.type==="timeZoneName")?.value??"";if(r==="GMT")return 0;let n=r.match(/GMT([+-])(\d{2}):(\d{2})/);if(!n)return 0;let a=n[1]==="+"?1:-1,s=Number.parseInt(n[2],10),o=Number.parseInt(n[3],10);return a*(s*60+o)}function xQ(t,e,i){if(!pM(i))return{error:dR};let[r,n]=e.split(":").map(Number),[a,s,o]=t.split("-").map(Number),l=new Date(Date.UTC(a,s-1,o,r,n,0,0)),u=yx(i,l),c=l.getTime()-u*60*1e3,d=new Date(c),p=yx(i,d);if(p!==u){let f=l.getTime()-p*60*1e3;return new Date(f).toISOString()}return d.toISOString()}function FCe(t,e){if(!pM(e))return{error:dR};let i=new Date(t),r=new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(i),n=o=>r.find(l=>l.type===o)?.value??"",a=`${n("year")}-${n("month")}-${n("day")}`,s=`${n("hour")==="24"?"00":n("hour")}:${n("minute")}`;return{date:a,time:s}}function LCe(t,e,i){let r=xQ(t,e,i);return typeof r!="string"||ld(r)?r:{error:dR}}var _Ce={isValidIANATimeZone:pM,getTimeZoneOffsetMinutes:yx,wallClockToUTC:xQ,utcToWallClock:FCe,toEmbargoUTC:LCe};function fM(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};if(n.tournamentId||(n.tournamentId=Pt()),n.startDate&&!Xl(n.startDate)&&!Ky.test(n.startDate))return{error:qi};if(n.endDate&&!Xl(n.endDate)&&!Ky.test(n.endDate))return{error:qi};if(n.activeDates){let a=n.activeDates.filter(Boolean);if(!a.every(s=>Xl(s)||Ky.test(s)))return{error:qi};if(a.length){let s=[...a].sort();n.startDate||(n.startDate=s[0]),n.endDate||(n.endDate=s[s.length-1]);let o=a.every(u=>new Date(u)>=new Date(n.startDate)),l=a.every(u=>new Date(u)<=new Date(n.endDate));if(!o||!l)return{error:qi}}n.activeDates=a}return n.localTimeZone&&!pM(n.localTimeZone)?{error:dR}:(n.extensions&&(n.extensions=n.extensions.filter(hl)),{...n})}function U$({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:s}){if(!i)return{error:ge};let o={},l=(i.participants??[]).filter(({participantType:h,participantRole:m})=>h===vt&&m===Xr),u=0;for(let h of l){let m=a&&wp({element:h,accessor:a})?.value||r&&h.person?.[r]||e&&h[e];if(m){if(!Object.keys(o).includes(m)){o[m]={participantName:n?.[u]??m,participantId:s?.pop()??Pt(),individualParticipantIds:[],participantRole:Xr,participantType:_t};let g={value:r??e,name:$O};gt({element:o[m],extension:g}),u+=1}o[m].individualParticipantIds.push(h.participantId)}}let c=Object.keys(o),d=(i.participants??[]).map(h=>{if(h.participantType!==_t||h.participantRole!==Xr)return;let{extension:m}=it({name:$O,element:h}),g=m?.value;if(c.includes(g))return h.participantId}).filter(Boolean),p=0,f=[];return Object.keys(o).forEach(h=>{let m=o[h],{participantId:g}=m;d.includes(g)||(i.participants||(i.participants=[]),t&&i.participants.push(m),f.push(m),p++)}),t&&p?(nt({payload:{tournamentId:i.tournamentId,participants:f},topic:bd}),{...H,participantsAdded:p}):f.length?{...H,newParticipants:f}:{error:PIe}}var $Ce=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],BCe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function FQ({count:t=1,participantsCount:e=32}={}){let i=Rn(BCe),r=i.slice(0,t);return{cities:Re(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Ia(r))}}function LQ({count:t=1,participantsCount:e=32}={}){let i=Rn($Ce),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:Re(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Ia(r))}}function _Q({count:t=1,participantsCount:e=32}={}){let i=Re(0,t).map(()=>Re(0,5).map(()=>ea(0,9)).join(""));return{postalCodes:Re(0,e).map(r=>r<t?i[r]:Ia(i))}}function kP({idPrefix:t,participantType:e,index:i,uuids:r}){let n=ni(e)?e[0]:"X";return t?`${t}-${n}-${i}`:r?.pop()||Pt()}function $Q(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r?.[a],state:i?.[a],city:e?.[a],countryCode:n}}var VCe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood","Zecic"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Miro","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function mk(t){let{count:e=100,sex:i}=t||{};if(!e||i&&!cl(i))return{personData:[],error:ie};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:s}=VCe,o=ch.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(r/n.length),u=Math.ceil(r/a.length),c=Math.ceil(r/s.length),d=Re(0,l).flatMap(()=>{let m=Oe(n,!1,!0);return Re(0,n.length).map(()=>ba(m))}),p=Re(0,u).flatMap(()=>{let m=Oe(a,!1,!0);return Re(0,a.length).map(()=>ba(m))}),f=Re(0,c).flatMap(()=>{let m=Oe(s,!1,!0);return Re(0,s.length).map(()=>ba(m))}),h={};for(let m=0;m<r;m++){let g=d.pop(),I=i||Ia([Zi,Lr]),v=I===Zi?f.pop():p.pop(),w=Ia(o);h[`${v}${g}`]={nationalityCode:w,sex:I,firstName:v,lastName:g}}return{personData:Object.values(h).slice(0,e)}}function BQ(t){let e=t?.count||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:s,category:o,sex:l}=t||{};if(Number.isNaN(Number(e)))return{error:ie};let u=a?.[Zi]||eh(l)&&e||0,c=a?.[Lr]||fp(l)&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&mk({count:u,sex:Zi}).personData||[],f=c&&mk({count:c,sex:Lr}).personData||[],h=[...p,...f,...d&&mk({count:d}).personData||[]],m=h.filter(T=>!l||u&&c||T.sex===l),g=[];if(Array.isArray(s)){let T=s.filter(D=>typeof D.firstName!="string"||typeof D.lastName!="string"||D.sex&&![Zi,Lr].includes(D.sex)||D.nationalityCode&&(typeof D.nationalityCode!="string"||D.nationalityCode.length>3||!ch.some(({iso:P,ioc:E})=>[P,E].includes(D.nationalityCode)))?!1:(D.nationalityCode&&g.push(D.nationalityCode),!0));if(T.length)m=T;else return{error:ie}}let I=s?m:Rn(m);if(I.length<e){let{maleFirstNames:T,maleLastNames:D,femaleFirstNames:P,femaleLastNames:E,nationalityCodes:R}=h.reduce((C,M)=>{let{firstName:N,lastName:A,nationalityCode:O}=M;return M.sex===Zi?(C.maleFirstNames.includes(N)||C.maleFirstNames.push(N),C.maleLastNames.includes(A)||C.maleLastNames.push(A)):(C.femaleFirstNames.includes(N)||C.femaleFirstNames.push(N),C.femaleLastNames.includes(A)||C.femaleLastNames.push(A)),C.nationalityCodes.includes(O)||C.nationalityCodes.push(O),C},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Re(0,e-I.length).forEach(()=>{let C=l||Ia([Zi,Lr]),M=Ia(R),N=Ia(C===Zi?T:P),A=Ia(C===Zi?D:E),O={firstName:N,lastName:A,sex:C,nationalityCode:M};I.push(O)})}let{ageMinDate:v,ageMaxDate:w}=Mp({consideredDate:r,category:o}),y=Ye(v?.slice(0,4)||0)||Ye(w?.slice(0,4)||0)-3,b=Ye(w?.slice(0,4)||0)||Ye(v?.slice(0,4)||0)+3,S=(v||w)&&[y,b],U=I.slice(0,e).map((T,D)=>{let[P,E]=S||[],R=S&&ba(Re(P,E)),C=ba(Re(0,365)),M=R&&Cve(R,C);return Object.assign(Ve({extensions:i||[{name:"regionCode",value:D+1}],birthDate:M,isMock:n}),T)});return{persons:U.length&&U||I[0],nationalityCodes:g}}var jCe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function OP({nameRoot:t="TEAM",count:e=1}={}){let i=Rn(jCe).slice(0,e);return i.length<e&&Re(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function Fv(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=Pr,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:s,categories:o,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:f,teamSize:h=8,personIds:m,idPrefix:g,uuids:I,personExtensions:v,addressProps:w,gendersCount:y,matchUpType:b,personData:S,sex:U,inContext:T,withISO2:D,withIOC:P,scaleAllParticipants:E}=t,R=f===ht||b===Rp,C=f===_t||b===_t;i&&(!Array.isArray(i)||!i.every(fe=>Mi(fe))||i.length!==2)&&(i=void 0),e=E?p:e;let M=1e3,N=e&&e>M?e:M;i=i||[1,N],i[1]+=1;let A=p*(R&&2||C&&(h??8)||1),O=BQ({count:A,personExtensions:v,consideredDate:s,gendersCount:y,personData:S,category:l,sex:U});if(O.error)return O;let{nationalityCodes:k,persons:F}=O,x={},L={},$={},V={},_=fe=>{Object.assign(x,fe.doublesRankings),Object.assign(L,fe.singlesRankings),Object.assign(V,fe.doublesRatings),Object.assign($,fe.singlesRatings)};if(St(l)){let fe=Ez({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:l});_(fe)}Array.isArray(o)&&o.forEach(fe=>{let Te=Ez({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:fe});_(Te)});let B=ch.filter(fe=>c==="IOC"&&fe.ioc||fe.iso);function G(fe){let Te=Math.ceil(A/fe);return n&&Te>n?Math.ceil(A/n):fe}let{postalCodesProfile:j,postalCodesCount:Y,statesProfile:K,citiesProfile:X,citiesCount:Z,statesCount:Q}=w||{},ae=fe=>Object.keys(fe).flatMap(Te=>Re(0,K[Te]).map(()=>Te)),te=X&&ae(X)||w?.cities||FQ({count:Z||A,participantsCount:A}).cities,ne=K&&ae(K)||w?.states||LQ({count:Q||A,participantsCount:A}).states,le=j&&ae(j)||w?.postalCodes||_Q({count:Y||A,participantsCount:A}).postalCodes,de={cities:te,states:ne,postalCodes:le},pe=G(u),ve=pe?Rn(B).slice(0,u):d&&B.filter(fe=>d.includes(fe.iso))||B,Me=Rn(Re(0,Math.ceil(A/(pe||1))).map(()=>ve).flat(1/0)),Ee=OP({count:p}).names;return{participants:Re(0,p).flatMap(fe=>{let Te=R&&2||C&&(h??8)||1,ce=Re(0,Te).map(Ne=>{let he=fe*Te+Ne;return Be(he)}),be=ce.map(Ne=>Ne.participantId),we=ce.map(Ne=>Ne.person.standardFamilyName).join("/"),Ae=R?ht:_t,ye={participantId:kP({participantType:Ae,index:fe,idPrefix:g,uuids:I}),participantName:R?we:Ee[fe],participantRole:Xr,individualParticipantIds:be,participantType:Ae};return T&&(ye.individualParticipants=ce),R||C?[ye,...ce]:ce}),...H};function Be(fe){let Te=F[fe],{nationalityCode:ce,participantExtensions:be,participantTimeItems:we,extensions:Ae,firstName:ye,birthDate:Ne,lastName:he,personId:De,sex:Le}=Te||{},J=ye||"GivenName",se=he||"FamilyName",oe=`${J} ${se}`,ue=Me[fe],ee=k?.length&&ce||ue&&(c==="IOC"?ue.ioc||ue.iso:ue.iso||ue.ioc)||ce;Me?.length&&!ee&&!ce&&console.log("%c Invalid Nationality Code",{participantIndex:fe,country:ue});let Se=$Q({...de,participantIndex:fe,nationalityCode:ee}),Pe=Ve({participantId:kP({participantType:vt,index:fe,idPrefix:g,uuids:I}),extensions:be,timeItems:we,participantRole:Xr,participantType:vt,participantName:oe,person:{personId:De||m?.length&&m[fe]||Pt(),birthDate:Cn(Ne)?Ne:void 0,addresses:[Se],standardFamilyName:se,standardGivenName:J,nationalityCode:ee,extensions:Ae,sex:Le}});if(P&&ee){let Ue=ch.find(({iso:dt})=>dt===ee);Ue?.ioc&&(Pe.person.iocNationalityCode=Ue.ioc),Ue?.label&&(Pe.person.countryName=Ue.label)}if(D&&ee){let Ue=ch.find(({iso:dt})=>dt===ee);Ue?.iso2&&(Pe.person.iso2NationalityCode=Ue.iso2),Ue?.label&&(Pe.person.countryName=Ue.label)}let st=Ue=>{let dt=Ue.categoryName||Ue.ratingType||Ue.ageCategoryCode,bi=L[dt]?.[fe],qe=x[dt]?.[fe];jT({scaleValue:bi,eventType:Oh,scaleType:Iu,participant:Pe,category:Ue}),jT({scaleValue:qe,eventType:mc,scaleType:Iu,participant:Pe,category:Ue});let wi=$[dt]?.[fe],li=V[dt]?.[fe];jT({scaleValue:wi,eventType:Oh,scaleType:fd,participant:Pe,category:Ue}),jT({scaleValue:li,eventType:mc,scaleType:fd,participant:Pe,category:Ue})};return Array.isArray(o)?o.forEach(Ue=>st(Ue)):l&&st(l),Pe}}function jT({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,s=[vd,r,i,a].join("."),o={itemValue:t,itemType:s};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function Ez(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,s=e.rankingRange||t.rankingRange||[1,1e3],o={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:f}=e,h=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!f){let[m,g]=s||[];if(l[h]=Rn(Re(m,g)).slice(0,i||ea(20,30)),[ht,_t].includes(n)){let[I,v]=s||[];o[h]=Rn(Re(I,v)).slice(0,i||ea(20,30))}}if(f&&r[f]){let{ratingMax:m,ratingMin:g,ratingAttributes:I}=e,v={...r[f],...I||{}},{attributes:w={},decimalsCount:y,accessors:b,range:S,step:U}=v,T=C=>{let M={},N=Object.keys(C||{});for(let A of N){let O=C[A];if(typeof O=="object"&&O.generator){let{range:k}=O,[F,x]=k.slice().sort();M[A]=ea(F,x)}else M[A]=O}return M},D=S[0]>S[1]?2:.7,[P,E]=S.slice().sort(),R=Re(0,2e3).map(()=>X6(P,E,D,U,y)).filter(C=>(!m||C<=m)&&(!g||C>=g)).slice(0,i||ea(20,30)).map(C=>b?Object.assign({},...b.map(M=>({[M]:C})),T(w)):C);u[h]=[...a,...R],[ht,_t].includes(n)&&(c[h]=[...a,...R])}return{singlesRankings:l,doublesRankings:o,singlesRatings:u,doublesRatings:c}}function T$(t){let{alternatesCount:e=0,tieFormatName:i,drawSize:r}=t,n=0,a=0,s=0,o=0,l={},u={[Zi]:0,[Lr]:0,[hm]:0,[Xu]:0,ANY:0};(St(t.tieFormat)?t.tieFormat:hc({namedFormat:i}))?.collectionDefinitions?.filter(Boolean).forEach(f=>{let{category:h,collectionId:m,matchUpType:g,matchUpCount:I,gender:v}=f;if(cl(v)){let w=ln(v),y=I*(g===Bt?2:1);w&&u[w]<y&&(u[w]=y)}else $a(v)&&(u[Zi]<I&&(u[Zi]=I),u[Lr]<I&&(u[Lr]=I));if(h){let w=JSON.stringify(h);l[w]=h}if(m||(f.collectionId=Pt()),Ti(Bt)(g)){let w=I;o+=I,n=Math.max(n,w)}if(Ti(zt)(g)){let w=I;s+=I,a=Math.max(a,w)}});let c=Object.keys(l).length?Math.max(s,o*2):Math.max(a,n*2),d=n*(r+e),p=a*(r+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:c,genders:u}}function GCe({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=vt}=t||{},a=r||0,s={[Lr]:0,[hm]:0,[Xu]:0,[Zi]:0,ANY:0},o=0,l=0,u=0,c=0,d=0,p=({alternatesCount:h=0,uniqueParticipants:m,tieFormatName:g,drawSize:I=0,eventType:v,tieFormat:w,category:y,gender:b,stage:S})=>{let U=v===ps,T=v===sr,D=!!(m||S===We||y||b);if(T){c=Math.max(c,I+h),w=typeof w=="object"?w:hc({namedFormat:g});let{teamSize:P,maxDoublesDraw:E,maxSinglesDraw:R,genders:C}=T$({alternatesCount:h,tieFormatName:g,tieFormat:w,drawSize:I});u=Math.max(u,P),l=Math.max(l,R),D||(o=Math.max(o,E)),Object.keys(C).forEach(M=>s[M]+=C[M])}else if(U)if(D){let P=(I+h)*2;d+=P,b&&(s[b]+=P)}else I+h&&I+h>o&&(o=I+h);else if(D){let P=I+h;b&&(s[b]+=P),d+=P}else I&&I>l&&(l=I+h)};if(e?.forEach(h=>{let{tieFormatName:m,tieFormat:g,drawProfiles:I,eventType:v,category:w,gender:y}=h;if(I)for(let b of I){let{tieFormatName:S,tieFormat:U}=b;p({...b,tieFormatName:S||m,tieFormat:U||g,eventType:v,category:w,gender:y})}}),Array.isArray(i))for(let h of i)p(h);let f=Math.max(c*u,o*2,l);return o&&(n=ht),(r||a)<f&&(r=f),r&&o&&[ht,sr].includes(n)&&(l&&Math.floor(l/2)>o?r=Math.floor(l/2):(!l||o*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!e?.length&&!i?.length?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:c,largestTeamSize:u,participantType:n,gendersCount:s}}function VQ({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if(t?.participantsCount===0)return{addedCount:0,...H};let{participantsCount:s,participantType:o,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=GCe({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t?.teamKey,p=Fv({consideredDate:n,...t,participantsCount:s,participantType:o,gendersCount:c,uuids:a}).participants,f=0,h=ro({tournamentRecord:e,participants:p});if(h.error)return h;if(f+=h.addedCount,d){let v=U$({tournamentRecord:e,...d});if(v.error)return v}let m=p.filter(({participantType:v})=>v===vt).map(bt),g=t?.idPrefix?`${_t}-${t.idPrefix}`:void 0,I=Re(0,l).map(v=>{let w=m.slice(v*u,(v+1)*u),y=kP({index:v,participantType:o,idPrefix:g,uuids:a});return{participantName:`Team ${v+1}`,participantRole:Xr,individualParticipantIds:w,participantType:_t,participantId:y}});return h=ro({participants:I,tournamentRecord:e}),h.error?h:(f+=h.addedCount,{addedCount:f,...H})}function jQ({drawProfiles:t,category:e,gender:i}){let r={},n=t?.reduce((s,o)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=Fe,drawSize:p=0}=o||{};Object.keys(s).includes(d)||(s[d]=0);let f=(u||p)-l;return c||i||e||d===We?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=f):s[d]=Math.max(s[d],f),s},{}),a=Object.keys(r);return a.forEach(s=>n[s]+=r[s]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function GQ({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Fe]||0,a=e[We]||0;return{stageParticipants:{QUALIFYING:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(0,a),MAIN:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(a,a+n)}}}var HCe={[mi]:2,[Si]:1,[Wi]:1,[jr]:1,[Zt]:4};function D$(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=HCe,matchUpFormat:n=ac,pointsPerMinute:a=2.5,sideWeight:s=4}=t;if(!Ga({matchUpFormat:n}))return{error:E4};if(typeof r!="object")return{error:ie};if(e>100&&(e=100),Number.isNaN(Number(e))||Number.isNaN(Number(a))||Number.isNaN(Number(s)))return{error:ie};let o=Object.keys(r).filter(D=>Object.keys(s7).includes(D)&&D!==Oi);if(Object.keys(o).reduce((D,P)=>D+r[P],0)>100)return{error:ie,matchUpStatusProfile:r};let l=o.reduce((D,P)=>(D.pointer=D.pointer+r[P],D.valueMap.push([D.pointer,P]),D),{pointer:0,valueMap:[]}),u=ea(1,100),c=(l.valueMap.find(D=>u<=D[0])??[100,Oi])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if($r(c)){i=i||ea(1,2);let D={score:d,matchUpStatus:c,winningSide:i};if(!(c===Zt&&ea(1,100)>100-e))return{outcome:D}}else if([Si,Wi].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=Ki(n),{bestOf:f=1,exactly:h,setFormat:m,finalSetFormat:g}=p??{},I=[],v=ea(0,1),w=i?[i-1]:[...Re(0,s).map(()=>v),1-v],y=[jr,Zt,hs,Hd].includes(c)&&(ba(Re(1,h||f))||1),b,S=Re(1,(h??f)+1);for(let D of S){let P=D===(h??f),{set:E,incomplete:R,winningSideNumber:C}=WCe({setFormat:P&&g||m,incomplete:y===D,pointsPerMinute:a,matchUpStatus:c,weightedRange:w,setNumber:D});if(I.push(E),R){b=C;break}if(Kb({matchUp:{score:{sets:I},matchUpFormat:n}}).calculatedWinningSide&&!p?.aggregate)break}let U;if(b)U=i||b;else if(p?.aggregate&&I.length>0){let D=I.reduce((R,C)=>R+(C.side1Score??0),0),P=I.reduce((R,C)=>R+(C.side2Score??0),0),E=ea(0,I.length-1);if(i){if(i===1&&D<=P||i===2&&P<=D){let R=Math.abs(D-P)+ea(1,3);i===1?I[E].side1Score+=R:I[E].side2Score+=R}U=i}else if(D===P){let R=ea(1,2);R===1?I[E].side1Score+=1:I[E].side2Score+=1,U=R}else U=D>P?1:2}else U=Kb({matchUp:{score:{sets:I},matchUpFormat:n,winningSide:i}}).calculatedWinningSide;let{score:T}=DQ({winningSide:U,score:{sets:I},matchUpStatus:c});return{outcome:{winningSide:U,matchUpStatus:c,score:T}}}function WCe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let s={setNumber:a},{setTo:o,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=n,f=ea(0,t.length-1),h=t[f],m;if(d){let g=p*e,I=Math.round(g*.2),v=g+ba([1,-1])*I,w=nIe(v,2),y=[w,v-w];h&&y.reverse(),m=t[f]+1;let b=y[0]>y[1]&&1||y[1]>y[0]&&2||0;if(r){let[T,D]=y;return Object.assign(s,{side1Score:T,side2Score:D}),Ji.includes(i)?{set:s,incomplete:r,winningSideNumber:m}:{set:s,incomplete:r}}b||(y[ea(0,1)]+=1),b=y[0]>y[1]?1:2,b!==m&&y.reverse();let[S,U]=y;return Object.assign(s,{side1Score:S,side2Score:U,winningSide:m}),{set:s}}else{if(r)return s.side1Score=ea(0,u),s.side2Score=ea(0,u),Ji.includes(i)&&(m=t[f]+1),{set:s,incomplete:r,winningSideNumber:m};{let g=Re(1,o+1).flatMap(U=>Re(0,o+2-U).map(()=>U)),I=g[ea(0,g.length-1)],v=o&&o_({isSide1:!0,tiebreakAt:u,lowValue:I,setTo:o}),w=!v,y=t.length===1&&t[f]+1;if(!w){y?(v[0]>v[1]?1:2)!==y&&v.reverse():h&&v.reverse();let[U,T]=v;Object.assign(s,{side1Score:U,side2Score:T})}let b=qb({matchUpScoringFormat:{setFormat:n},setObject:s}),S;if(b.hasTiebreakCondition||w){let{NoAD:U,tiebreakTo:T}=l||c||{},D=Re(1,T+1).flatMap(R=>Re(0,T+2-R).map(()=>R)),P=D[ea(0,D.length-1)],E=xC({isSide1:!0,tiebreakNoAd:U,tiebreakTo:T,lowValue:P});if(E)if(w){let R=E[0]>E[1]?1:2;y?R!==y&&E.reverse():h&&E.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=E,S=E[0]>E[1]&&1||E[1]>E[0]&&2||void 0}else b.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=E:[s.side2TiebreakScore,s.side1TiebreakScore]=E}s.winningSide=b.winningSide||b.leadingSide||y||S}}return{set:s}}function zCe({firstRoundDualMatchUps:t,event:e,tournamentRecord:i,drawDefinition:r}){let n=e?.category?.ageCategoryCode||e?.category?.categoryName;if(n){let d=tQ({singlesOnly:!0,tournamentRecord:i,drawDefinition:r,scaleAccessor:{scaleName:n,sortOrder:"ASC",scaleType:Iu},event:e});if(d.error)return d;let{lineUps:p,participantsToAdd:f}=d;ro({tournamentRecord:i,participants:f}),gt({element:r,extension:{name:Ic,value:p}});return}let a=t[0]?.structureId,{positionAssignments:s}=Kt({drawDefinition:r,structureId:a});if(!s?.length)return;let{participants:o}=Pi({participantFilters:{participantTypes:[ei]},tournamentRecord:i});function l(d){return o?.find(p=>{let{participantId:f}=p;return s.find(h=>h.participantId===f)?.drawPosition===d})}function u(d,p,f){d.sides.forEach(h=>{let{drawPosition:m}=h,g=l(m);if(g){let I=g.individualParticipantIds?.[p];I&&AP({teamParticipantId:g.participantId,participantId:I,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e});return}})}function c(d,p,f){d.sides.forEach(h=>{let{drawPosition:m}=h,g=l(m);g&&g.individualParticipantIds?.slice(p*2,p*2+2)?.forEach(I=>{AP({teamParticipantId:g.participantId,participantId:I,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e})})})}t.forEach(d=>{let p=d.tieMatchUps.filter(Ti(zt)),f=d.tieMatchUps.filter(Ti(Bt));p.forEach((h,m)=>{let g=h.matchUpId;u(h,m,g)}),f.forEach((h,m)=>{let g=h.matchUpId;c(h,m,g)})})}function qCe({structure:t,matchUpsMap:e,drawDefinition:i,tournamentRecord:r,event:n,matchUpStatusProfile:a,matchUpFormat:s,matchUpStatus:o,scoreString:l,randomWinningSide:u,completionGoal:c,completedCount:d}){let p=kt({contextFilters:{matchUpTypes:[Bt,zt]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}).matchUps.filter(({winningSide:f})=>!f).sort(Tm).map(vr);for(let f of p){if(!Number.isNaN(Number(c))&&d.value>=c)break;let{matchUps:h}=kt({matchUpFilters:{matchUpTypes:[Bt,zt]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}),m=h.find(I=>I.matchUpId===f),g=[Si,Wi].includes(m.matchUpStatus);if(m?.readyToScore&&!g){let I=YCe({matchUpStatusProfile:a,tournamentRecord:r,drawDefinition:i,targetMatchUp:m,matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:!u&&1,event:n});if(I?.error)return I;d.value+=1}}}function xP(t){let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:s,event:o}=t;if(!s)return{error:_e};let l=t.matchUpFormat||s.matchUpFormat||o?.matchUpFormat,u=s.structures.slice().sort(vm),c={value:0},{matchUps:d,matchUpsMap:p}=rr({matchUpFilters:{matchUpTypes:[ei],roundNumbers:[1]},contextFilters:{stages:[Fe,We]},inContext:!0,drawDefinition:s});if(d?.length){let I=zCe({firstRoundDualMatchUps:d,event:o,tournamentRecord:n,drawDefinition:s});if(I?.error)return I}let f=typeof i=="string"&&i,h=f&&Oi,m=u.length===2&&u[0].finishingPosition===kp&&Fi(u.map(({stage:I})=>I),[Fe,Ai]).length===2,g=u.map(({structureId:I})=>I);for(let I of g){if(c.value>=a)break;let v=s.structures.find(y=>y.structureId===I),w=qCe({structure:v,matchUpsMap:p,drawDefinition:s,tournamentRecord:n,event:o,matchUpStatusProfile:e,matchUpFormat:l,matchUpStatus:h,scoreString:f,randomWinningSide:r,completionGoal:a,completedCount:c});if(w?.error)return w;m&&v.finishingPosition===kp&&t.completeRoundRobinPlayoffs&&Tv({structureId:v.structureId,applyPositioning:!0,drawDefinition:s})}return{...H,completedCount:c.value}}function HQ(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:s,matchUpFormat:o,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus==="BYE")return;let{matchUpId:d}=a||{},{outcome:p}=v$({matchUpFormat:o,matchUpStatus:s,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),ZS({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function YCe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:s,targetMatchUp:o,scoreString:l,winningSide:u,event:c}=t;if(l||a)return HQ(t);let{matchUpId:d}=o||{},{outcome:p}=D$({matchUpStatusProfile:e,matchUpFormat:s,winningSide:u});return ZS({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function WQ({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:s}){let o=Bi({event:s}).flightProfile,{eventName:l,eventType:u,category:c}=s,{startDate:d}=r,p=[],f=c?.categoryName||c?.ageCategoryCode||c?.ratingType,h=s.drawDefinitions?.map(({drawId:m})=>m);if(Array.isArray(o?.flights))for(let[m,g]of o.flights.entries()){let{drawId:I,stage:v,drawName:w,drawEntries:y}=g;p.push(g.drawId);let b=n[m],{seedsCount:S,generate:U=!0}=b||{};if(U){let T=y.filter(Pa(gu)).map(Pa(gu)),D=f||l;if(r&&S&&S<=T.length&&Re(1,S+1).forEach((M,N)=>{let A={scaleValue:M,scaleName:D,scaleType:Jl,eventType:u,scaleDate:d},O=T[N];Pv({tournamentRecord:r,participantId:O,scaleItem:A})}),h?.includes(I))break;let P=JS({...b,matchUpType:u,seedingScaleName:D,tournamentRecord:r,drawEntries:y,drawName:w,drawId:I,isMock:a,event:s,stage:v});if(P.error)return{error:P.error,drawIds:[]};let{drawDefinition:E}=P;if(!E)return{error:ja};let R=n[m]?.drawExtensions;if(Array.isArray(R)&&R.filter(hl).forEach(M=>gt({element:E,extension:M})),P=QS({suppressNotifications:!0,tournamentRecord:r,drawDefinition:E,event:s}),P.error)return{error:P.error,drawIds:[]};if(b?.withPlayoffs){let M=E.structures?.[0].structureId,N=vC({idPrefix:b.idPrefix,...b.withPlayoffs,tournamentRecord:r,drawDefinition:E,structureId:M,isMock:a,event:s});if(N?.error)return N}let C=b?.completionGoal;if(b?.automated!==!1&&(e||C)){let M=b?.matchUpFormat,N=xP({completeAllMatchUps:!C&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:C,drawDefinition:E,matchUpFormat:M,event:s});if(N.error)return{error:N.error,drawIds:[]};let A=N.completedCount;if(b?.drawType===mu){let O=E.structures?.find(x=>x.stage===Fe);if(!O)return{error:vi};let k=Tv({structureId:O.structureId,tournamentRecord:r,drawDefinition:E});if(k.error)return{error:k.error,drawIds:[]};let F=C?C-(A??0):void 0;if(k=xP({completeAllMatchUps:!C&&e,completionGoal:C?F:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:E,matchUpFormat:M,event:s}),k.error)return{error:k.error,drawIds:[]}}}}}return{...H,drawIds:p}}function zQ(t){let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:s,event:o,uuids:l}=t,{category:u,gender:c,eventType:d}=o,p=Ti(pl)(d)&&vt||Ti(ps)(d)&&ht||d,f=i[Fe]||0,h=i[We]||0,m=a.drawProfiles?.length?f+h:a.participantsProfile?.participantsCount??0,g=cl(c)?c:void 0,I=e?.idPrefix?`E-${s}-${e?.idPrefix}`:void 0,{participants:v}=Fv({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n?.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:m,ratingsParameters:r,category:u,idPrefix:I,sex:g}),w=ro({tournamentRecord:n,participants:v});if(w.error)return w;let y=v?.filter(({participantType:S})=>S===p),b=v?.map(bt);return{uniqueDrawParticipants:y,uniqueParticipantIds:b}}function KCe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=il,qualifyingPositions:s=0,stage:o=Fe,drawSize:l=0,drawName:u,drawId:c}=r,d=l-s,p=i.slice(0,d).map(bt);if(p.length){let m=rl({participantIds:p,autoEntryPositions:t,entryStage:o,tournamentRecord:e,event:n});if(m.error)return m}let f=p.map(m=>({entryStatus:da,entryStage:o,participantId:m})),h=eM({drawName:u||a,qualifyingPositions:s,drawEntries:f,drawId:c,event:n,stage:o});return h.error?h:{...H}}function qQ({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:s,event:o}){let l=0;for(let u of n){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=Fe,drawSize:f=0}=u,h=f-c,m=d||s||a||p===We,g=m?t.slice(l,l+h):i[p||Fe]||[];m&&(l+=h);let I=KCe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:u,event:o});if(I.error)return I}return{...H}}function YQ(t){let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,publish:p,isMock:f,uuids:h}=t,m=c.gender,g=c.eventName,{eventType:I=pl,policyDefinitions:v,drawProfiles:w=[],eventExtensions:y,surfaceCategory:b,tieFormatName:S,processCodes:U,discipline:T,eventLevel:D,timeItems:P,ballType:E,category:R}=c,C=c.eventId||Pt(),M=c.tieFormat||(I===sr?hc({namedFormat:S,event:{eventId:C,category:R,gender:m},hydrateCollections:s,isMock:f}):void 0),N=u.participants;for(let K of w)!m&&K.gender&&(m=K?.gender);let{stageParticipantsCount:A,uniqueParticipantsCount:O,uniqueParticipantStages:k}=jQ({drawProfiles:w,category:R,gender:m}),F=Ti(pl)(I)&&vt||Ti(ps)(I)&&ht||I,{uniqueDrawParticipants:x=[],uniqueParticipantIds:L=[]}=k?zQ({event:{eventType:I,category:R,gender:m},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,uuids:h}):{},{eventAttributes:$}=c;typeof $!="object"&&($={});let V=R?.categoryName||R?.ageCategoryCode||R?.ratingType;g=g||V||"Generated Event";let _={...$,surfaceCategory:b,processCodes:U,discipline:T,eventLevel:D,eventName:g,eventType:I,tieFormat:M,ballType:E,category:R,eventId:C,gender:m};if(y?.length&&Array.isArray(y)){let K=y.filter(hl);K?.length&&Object.assign(_,{extensions:K})}if(Array.isArray(P)&&P.forEach(K=>Nm({event:j,timeItem:K})),typeof v=="object")for(let K of Object.keys(v))$p({policyDefinitions:{[K]:v[K]},event:_});_.category&&(_.category.categoryName=V);let B,G=Mv({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:_});if(G.error)return G;let j=G?.event,{stageParticipants:Y}=GQ({allUniqueParticipantIds:e,stageParticipantsCount:A,eventParticipantType:F,targetParticipants:N});if(w?.length){let K=qQ({uniqueDrawParticipants:x,autoEntryPositions:a,stageParticipants:Y,tournamentRecord:u,drawProfiles:w,category:R,gender:m,event:j});if(K.error)return K;let X=WQ({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:o,tournamentRecord:u,drawProfiles:w,isMock:f,event:j});if(X.error)return X;B=X.drawIds}else if(c?.participantsProfile?.participantsCount){let K=x.map(bt);if(K.length){let X=rl({participantIds:K,autoEntryPositions:a,tournamentRecord:u,entryStage:Fe,event:j});if(X.error)return X}}return p&&Av({tournamentRecord:u,event:j}),{drawIds:B,eventId:C,uniqueParticipantIds:L}}function P$({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!Cn(e))return{error:qi};let n="addSchedulingProfileRound",{extension:a}=it({name:_h,tournamentRecords:t,discover:!0}),s=a?.value||[],o=s.find(p=>du(e,p.scheduleDate));if(!o){let{startDate:p,endDate:f}=$C({tournamentRecords:t}),h=new Date(e);if(p&&h<new Date(p)||f&&h>new Date(f))return{error:qi};o={scheduleDate:e,venues:[]},s.push(o)}let l=o.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},o.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(f=>!u.includes(f)).sort().map(f=>St(p[f])?c(p[f]):p[f]).flat().join("|");if(l.rounds.find(p=>c(p)===c(r)))return z({result:{error:v4},stack:n});l.rounds.push(r);let d=Rv({tournamentRecords:t,schedulingProfile:s});return d.error?d:{...H}}function XCe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:ie};let i=gv({tournamentRecord:e}).containedStructures,r=wr({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let s of t){let{scheduleDate:o,venues:l=[]}=s;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:f,winnerFinishingPositionRange:h,roundSegment:m}=p,g=r.filter(I=>{let v=h?.indexOf("-")>0&&h.split("-").map(y=>+y),w=I.finishingPositionRange?.winner;return I.drawId===f&&(!p.roundNumber||I.roundNumber===p.roundNumber)&&(!w||!v||Fi(w,v).length===2||ot(w).length===ot(v).length&&Fi(w,v).length===ot(w).length)})[0];if(g){let{eventId:I,roundNumber:v,drawName:w,structureName:y,roundName:b}=g,S=g.structureId;v&&!h&&(S=Object.keys(i).find(D=>i[D].includes(S))??S);let U={tournamentId:n,structureId:S,roundNumber:v,roundSegment:m,eventId:I,drawId:f},T=P$({tournamentRecords:{[n]:e},round:U,scheduleDate:o,venueId:d});if(T.error)return T;a.push({structureName:y,roundName:b,drawName:w,...U})}}}}return{scheduledRounds:a}}function hM(t){let e=Ge(t,[{drawProfile:!0,_ofType:Qn}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:s,hydrateCollections:o,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,isMock:d=!0,drawProfile:p,startDate:f,drawIndex:h,uuids:m}=t,g=Oe(p,!1,!0),{excessParticipantAlternates:I=!0,matchUpFormat:v=ac,drawType:w=il,tournamentAlternates:y=0,alternatesCount:b=0,qualifyingPositions:S,qualifyingProfiles:U,generate:T=!0,eventExtensions:D,drawExtensions:P,completionGoal:E,tieFormatName:R,buildTeams:C,seedsCount:M,timeItems:N,drawName:A,category:O,idPrefix:k,publish:F,gender:x,stage:L}=g,$=g.drawSize||(g.ignoreDefaults?void 0:32),V=g.eventId||Pt(),_=p.eventType||p.matchUpType||pl,B=_===ps?ht:vt,G=St(p.tieFormat)&&p.tieFormat||_===_t&&hc({event:{eventId:V,category:O,gender:x},namedFormat:R,hydrateCollections:o,isMock:d})||void 0,j=O?.categoryName||O?.ageCategoryCode||O?.ratingType,Y=p.eventName||j||`Generated ${_}`,K=c?.participants||[],X=(U?.flatMap(ce=>ce.structureProfiles||[]).reduce((ce,be)=>{let we=!be.participantsCount||be.participantsCount>be.drawSize?be.drawSize:be.participantsCount||0;return ce+we},0)||0)*(B===ht?2:1),Z=(!p.participantsCount||p.participantsCount>$?$:p.participantsCount)||0,Q={eventName:Y,eventType:_,tieFormat:G,category:O,eventId:V,gender:x};Array.isArray(N)&&N.forEach(ce=>Nm({event:Q,timeItem:ce}));let{eventAttributes:ae}=p;if(typeof ae!="object"&&(ae={}),Object.assign(Q,ae),D?.length&&Array.isArray(D)){let ce=D.filter(hl);ce?.length&&Object.assign(Q,{extensions:ce})}let te=[];if(r?.participantsCount===0||p.uniqueParticipants||X||!c||x||O){let ce=(Z||0)+b+X,be=ce,we={[Zi]:0,[Lr]:0},Ae,ye;if(_===_t){({teamSize:Ae,genders:ye}=T$({alternatesCount:b,tieFormatName:R,tieFormat:G,drawSize:$}));let De=g.teamGenders;if(De){for(let J of Object.keys(De))ye[J]!==void 0&&De[J]>ye[J]&&(ye[J]=De[J]);let Le=(ye[Zi]||0)+(ye[Lr]||0);Le>Ae&&(Ae=Le)}Object.keys(ye).forEach(Le=>{let J=ln(Le);J&&cl(Le)&&ye[J]&&(we[J]=$*ye[J])}),be=Ae*(($||0)+X)}let Ne=r?.idPrefix?`D-${h}-${r?.idPrefix}`:void 0,he=Fv({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:be,consideredDate:c?.startDate,sex:x||r?.sex,rankingRange:p.rankingRange,uuids:p.uuids||m,ratingsParameters:u,participantType:B,gendersCount:we,idPrefix:Ne,category:O}).participants;if(Q.category&&(Q.category.categoryName=j),c){let De=ro({participants:he,tournamentRecord:c});if(De.error)return De}if(he.forEach(({participantId:De})=>te.push(De)),K=he,_===_t){let De=ye[Zi]?he.filter(({participantType:Ue,person:dt})=>Ue===vt&&dt?.sex===Zi).map(bt):[],Le=ye[Lr]?he.filter(({participantType:Ue,person:dt})=>Ue===vt&&fp(dt?.sex)).map(bt):[],J=he.filter(({participantType:Ue})=>Ue===vt).map(bt).filter(Ue=>!De.includes(Ue)&&!Le.includes(Ue)),se=[...g.teamNames??[],...OP({count:ce}).names],oe=Ae-(ye[Zi]+ye[Lr]),ue=0,ee=0,Se=0,Pe=Re(0,ce).map(Ue=>{let dt=Le.slice(ue,ue+ye[Lr]),bi=De.slice(ee,ee+ye[Zi]),qe=J.slice(Se,Se+oe);ue+=ye[Lr],ee+=ye[Zi],Se+=oe;let wi=C!==!1?[...dt,...bi,...qe]:[];return{participantName:se[Ue]||`Team ${Ue+1}`,participantOtherName:`TM${Ue+1}`,participantRole:Xr,individualParticipantIds:wi,participantType:_t,participantId:Pt()}}),st=ro({participants:Pe,tournamentRecord:c});if(!st.success)return st;K=Pe}}let ne=ce=>{let{participantType:be}=ce;return Ti(pl)(_)&&be===vt||Ti(ps)(_)&&be===ht?!0:_===_t&&be===_t},le=ce=>!p.gender||ce.person?.sex===p.gender?!0:ce.individualParticipantIds?.some(be=>{let we=K.find(Ae=>Ae.participantId===be);return we&&le(we)}),de=K.filter(ne).filter(le).filter(({participantId:ce})=>!i.includes(ce)),pe=de.slice(0,Z).map(ce=>ce.participantId);if(d&&pe?.length){let ce=rl({autoEntryPositions:s,entryStage:L,tournamentRecord:c,participantIds:pe,event:Q});if(ce.error)return ce}let ve=X?de.slice(Z,Z+X).map(ce=>ce.participantId):0;if(d&&ve?.length){let ce=0,be=1,we=(ye,Ne)=>ye.stageSequence-Ne.stageSequence,Ae=(ye,Ne)=>ye.roundTarget-Ne.roundTarget;for(let ye of U.sort(Ae)){be=ye.roundTarget||be;let Ne=1,he;for(let De of ye.structureProfiles.sort(we)){let Le=(De.drawSize||a1(De.participantsCount))-(he||0),J=ve.slice(ce,ce+Le),se=rl({entryStage:We,entryStageSequence:Ne,autoEntryPositions:s,tournamentRecord:c,participantIds:J,roundTarget:be,event:Q});if(se.error)return se;he=De.qualifyingPositions,ce+=Le,Ne+=1}be+=1}}let Me=I&&c?.participants?.filter(({participantId:ce})=>!pe.includes(ce)).filter(ne).filter(le).slice(0,b||$-Z||y).map(ce=>ce.participantId);if(d&&Me?.length){let ce=rl({participantIds:Me,autoEntryPositions:!1,entryStatus:Bs,tournamentRecord:c,event:Q});if(ce.error)return ce.error}let Ee=j||Y;c&&M&&M<=pe.length&&Re(1,M+1).forEach((ce,be)=>{let we={scaleName:Ee,scaleDate:f,scaleType:FL,scaleValue:ce,eventType:_},Ae=pe[be];Pv({tournamentRecord:c,participantId:Ae,scaleItem:we})});let Be=JS({...Oe(p,!1,!0),tournamentRecord:c,seedingScaleName:Ee,matchUpFormat:v,eventId:V,isMock:d,event:Q});if(Be.error)return Be;if(!Be.drawDefinition)return{error:ja};let{drawDefinition:fe}=Be,Te=fe.drawId;if(Array.isArray(P)&&P.filter(hl).forEach(ce=>gt({element:fe,extension:ce})),T){if(QS({drawDefinition:fe,event:Q,suppressNotifications:!0}),p.withPlayoffs){let be=fe.structures?.[0].structureId,we=vC({...p.withPlayoffs,tournamentRecord:c,drawDefinition:fe,structureId:be,idPrefix:k,isMock:d,event:Q});if(we?.error)return we}let ce=p.automated===!1;if(d&&!ce){let be=we=>{let Ae=xP({completeAllMatchUps:we.completeAllMatchUps,completionGoal:we.completionGoal,matchUpStatusProfile:n,randomWinningSide:l,tournamentRecord:c,drawDefinition:fe,matchUpFormat:v,event:Q});if(Ae.error)return Ae;let ye=Ae.completedCount;if(w===mu){let Ne=fe.structures?.find(Le=>Le.stage===Fe);if(!Ne)return{error:vi};Tv({structureId:Ne.structureId,tournamentRecord:c,drawDefinition:fe});let he=E?E-(ye??0):void 0,De=xP({completionGoal:E?he:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawDefinition:fe,matchUpFormat:v,event:Q});if(De.error)return De}};if(E&&be({completionGoal:E}),p.outcomes){let{matchUps:we}=Nn({inContext:!0,drawDefinition:fe,event:Q});for(let Ae of p.outcomes){let{matchUpStatus:ye=Oi,matchUpStatusCodes:Ne,stageSequence:he=1,matchUpIndex:De=0,structureOrder:Le,matchUpFormat:J,drawPositions:se,roundPosition:oe,stage:ue=Fe,roundNumber:ee,winningSide:Se,scoreString:Pe}=Ae,st=we?.reduce((qe,wi)=>{let{structureId:li,matchUpId:an}=wi;return qe[li]?qe[li].push(an):qe[li]=[an],qe},{})??[],Ue=Object.assign({},...Object.keys(st).map((qe,wi)=>({[qe]:wi+1}))),dt=we?.filter(qe=>(!ue||qe.stage===ue)&&(!he||qe.stageSequence===he)&&(!ee||qe.roundNumber===ee)&&(!oe||qe.roundPosition===oe)&&(!Le||Ue[qe.structureId]===Le)&&(!se||Fi(se,qe.drawPositions).length===2))?.[De],bi=HQ({matchUpStatusCodes:Ne,tournamentRecord:c,drawDefinition:fe,targetMatchUp:dt,matchUpFormat:J,matchUpStatus:ye,scoreString:Pe,winningSide:Se});if(bi?.error)return bi}}a&&be({completeAllMatchUps:a})}F&&Av({tournamentRecord:c,event:Q})}else{let ce=eM({drawEntries:fe.entries,drawName:A||w,qualifyingPositions:S,drawId:Te,event:Q,stage:L});if(ce.error)return ce}return{...H,event:Ve(Q),uniqueParticipantIds:te,targetParticipants:K,drawDefinition:fe,eventId:V,drawId:Te}}var KQ=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,indoorOutdoor:void 0,floodlit:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),JCe=KQ;function mM({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=po({tournamentRecord:t,venueId:i});if(!a)return{error:lf};a.courts||(a.courts=[]);let s={...KQ(),venueId:i,courtId:r};if(s.courtId||(s.courtId=Pt()),a.courts.some(o=>o.courtId===s.courtId))return{error:eK};{let o=(n?.dateAvailability||[]).map(c=>({...c,date:Qe(c.date),startTime:di(c.startTime),endTime:di(c.endTime),bookings:c.bookings?.map(({startTime:d,endTime:p,bookingType:f})=>({startTime:di(d),endTime:di(p),bookingType:f}))})),l=Object.keys(s);for(let c of l)if(n?.[c])if(c==="dateAvailability"){let d=tC({dateAvailability:o});if(!d.valid&&d.error)return d;s.dateAvailability=o}else s[c]=n[c];let u=s;return a.courts.push(u),e||nt({payload:{venue:a,tournamentId:t.tournamentId},topic:Vc,key:a.venueId}),{...H,court:Oe(s),venueId:i}}}function E$(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:Vd};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let s of Object.values(r)){let{venue:o}=po({tournamentRecord:s,venueId:i});if(o){let l=QCe({...t,tournamentRecord:s});for(let u of l?.courts??[])n.push(u?.courtId);if(l.error)return l;a=!0}}return a?{...H,courtIds:n}:{error:lf}}function QCe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:s,startTime:o,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:Vd};let f=po({tournamentRecord:r,venueId:d});if(f.error)return f;let{venue:h}=f;if(!Mi(s)||!n)return{error:Z4};s=s??n.length;let m=Re(0,s).map(g=>{let I=a?.[g],v=I?p.map(w=>({date:_s(w),startTime:o,endTime:u,...I})):e;return I&&o&&u&&v.push({startTime:o,endTime:u}),{courtName:n[g]||i&&h?.venueAbbreviation&&`${h?.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:v}}).map((g,I)=>{let v=l?.pop()||c&&`${c}-${I+1}`;return mM({disableNotice:!0,tournamentRecord:r,courtId:v,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==s?z({info:"not all courts could be generated",result:{error:ie}}):(h&&nt({payload:{venue:h,tournamentId:r.tournamentId},topic:Vc,key:h.venueId}),{...H,courts:Oe(m)})}function R$({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,s=[];for(let[o,l]of i.entries()){let{venueAbbreviation:u,venueId:c=r?.pop()??Pt(),dateAvailability:d,venueDateAvailability:p,defaultStartTime:f,defaultEndTime:h,startTime:m="07:00",endTime:g="19:00",courtTimings:I,courtsCount:v,courtNames:w,venueName:y,idPrefix:b,courtIds:S}=l,U={venueName:y||`Venue ${o+1}`,venueAbbreviation:u,venueId:c};f&&(U.defaultStartTime=f),h&&(U.defaultEndTime=h),l.isPrimary&&(U.isPrimary=!0),p&&(U.dateAvailability=p);let T=TS({tournamentRecord:t,venue:U});if(T.error){if(e)continue;return T}s.push(c);let D=aI(n,a),P=!Array.isArray(d)&&[{startTime:m,endTime:g}].concat(D.map(E=>({date:_s(E),startTime:m,endTime:g})));if(v||w){let E=E$({dateAvailability:d||P,tournamentRecord:t,courtTimings:I,courtsCount:v,courtNames:w,startTime:m,idPrefix:b,courtIds:S,endTime:g,venueId:c,dates:D});if(E.error)return E}}return s}function ZCe(t){let{tournamentRecord:e,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:s,uuids:o}=t,l=0;for(let c of i){let d=[],{tieFormatName:p=lP,teamProfiles:f=[],teamsCount:h=0,category:m,idPrefix:g,gender:I}=c,v=c.leagueName??c.eventName??`League ${l+1}`,w=c.leagueId??c.eventId??o?.pop()??Pt();r.push(w);let y=St(c.tieFormat)&&c.tieFormat||hc({event:{eventId:w,category:m,gender:I},namedFormat:p,isMock:t.isMock})||void 0;if(!y)return{error:ov};let b=Math.max(h,f.length),S=Re(0,b),{genders:U,teamSize:T}=T$({tieFormat:y,drawSize:b}),D={[Lr]:0,[hm]:0,[Xu]:0,[Zi]:0,ANY:0};Object.keys(U).forEach(E=>D[E]+=U[E]);for(let E of S){let R=f?.[E]?.teamName??`Team ${E+1}`,C=f?.[E]?.teamId||o?.pop()||Pt(),M=c.startDate??t.startDate,N=Fv({...c?.participantsProfile,participantsCount:T,consideredDate:M,gendersCount:D,category:m,uuids:o}).participants,A=N.map($=>$.participantId),O=_t,k=C??kP({participantType:O,idPrefix:g,index:E,uuids:o});d.push({participantId:k,entryStatus:da,entryStage:Fe});let F=f?.[E]?.venueIds??[],x={participantId:k,participantRole:Xr,participantName:R,individualParticipantIds:A,participantType:O,homeVenueIds:F};F.forEach($=>!n.includes($)&&n.push($)),s.push(...A,k);let L=ro({participants:[x,...N],tournamentRecord:e});if(L.error)return L}let P={eventName:v,entries:d,eventType:_t,tieFormat:y,category:m,eventId:w,gender:I};if(e.events||(e.events=[]),e.events.push(P),d.length){let E=(Mi(c.roundsCount)&&c.roundsCount)??c.roundsCount===Gve?(b-1)*2:b-1,R=JS({automated:c.automated,tournamentRecord:e,drawType:ca,roundsCount:E,drawSize:b,event:P});if(R.error)return R;let{drawDefinition:C}=R;if(C){let M=C?.drawId;QS({drawDefinition:C,event:P,suppressNotifications:!0}),a.push(M)}}l++}let u=n.map(c=>({venueId:c}));R$({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:u,uuids:o})}var eMe=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function XQ(t){let{startDate:e,endDate:i}=t??{},{tournamentName:r=ba(eMe),ratingsParameters:n=Pr,tournamentExtensions:a,policyDefinitions:s,schedulingProfile:o,venueProfiles:l,uuids:u}=t??{},c=t?.isMock===!1?void 0:!0;if(e&&!Cn(e)||i&&!Cn(i))return{error:qi};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:ie};if(!e){let v=new Date;e=_s(i??v),i=_s(v.setDate(v.getDate()+7))}if(!i){let v=new Date(e);i=_s(v.setDate(v.getDate()+7))}let d=fM({...t.tournamentAttributes??{},tournamentName:r,startDate:e,endDate:i,isMock:c}),p=l?.length?R$({tournamentRecord:d,venueProfiles:l,uuids:u}):[];if(a?.length&&Array.isArray(a)){let v=a.filter(w=>hl({extension:w}));v?.length&&Object.assign(d,{extensions:v,isMock:c})}if(typeof s=="object")for(let v of Object.keys(s))$p({policyDefinitions:{[v]:s[v]},tournamentRecord:d});if(!t?.leagueProfiles?.length||t.eventProfiles?.length||t.drawProfiles?.length||t.participantsProfile){let v=VQ({tournamentRecord:d,...t});if(!v.success)return v}let f=[],h=[],m=[];if(t.leagueProfiles){let v=ZCe({allUniqueParticipantIds:f,tournamentRecord:d,...t,eventIds:h,venueIds:p,drawIds:m});if(v?.error)return v}if(t.drawProfiles){let v=tMe({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:m});if(v?.error)return v}if(t.eventProfiles){let v=iMe({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:m});if(v?.error)return v}let{scheduledRounds:g=void 0,schedulerResult:I={}}=o?rMe({...t,tournamentRecord:d}):{};return O1(),Ve({...H,tournamentRecord:d,scheduledRounds:g,schedulerResult:I,eventIds:h,venueIds:p,drawIds:m})}function tMe(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,s=0;for(let o of i){let l=hM({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:o,drawIndex:s,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(o?.addEvent!==!1){if(l=Mv({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),n.push(c)}p?.length&&r.push(...p),s+=1}}function iMe(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let s of e){let o=YQ({...t,eventIndex:a,eventProfile:s});if(o.error)return o;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=o;u&&n.push(...u),r.push(l),c?.length&&i.push(...c),a+=1}}function rMe(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,s=XCe({schedulingProfile:e,tournamentRecord:i});if(s.error)return s;let o=s.scheduledRounds;if(r){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:dM({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:n}),scheduledRounds:o}}return{scheduledRounds:o}}var JQ={};pt(JQ,{anonymizeTournamentRecord:()=>QQ,modifyTournamentRecord:()=>eZ});function QQ({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){if(!i)return{error:ge};let s=Array.isArray(t)?MW.concat(...t):MW,o=k=>Array.isArray(t)?k?.extensions?.filter(F=>s.includes(F.name)):k?.extensions,l={};i.extensions=o(i);let u=a||Pt();l[i.tournamentId]=u,i.tournamentId=u,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${_s(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let k of i.participants||[]){k.extensions=o(k),k.onlineResources=[];let F=Pt();l[k.participantId]=F,k.participantId=F}for(let k of i.participants||[])Array.isArray(k.individualParticipantIds)&&(k.individualParticipantIds=k.individualParticipantIds.map(F=>l[F]));let c=0;for(let k of i.venues||[]){k.venueAbbreviation=`V${c}`,k.extensions=o(k),k.venueName=`Venue #${c}`,k.onlineResources=[],k.addresses=[];let F=Pt();l[k.venueId]=F,k.isMock=!0,c+=1;let x=0;for(let L of k.courts||[])L.courtName=`V${c}C${x}`,L.extensions=o(L),L.onlineResources=[],L.isMock=!0,x+=1}let d=1;for(let k of i.events||[]){k.extensions=o(k),k.onlineResources=[],k.isMock=!0;let F=Pt();l[k.eventId]=F,k.eventId=F;let x=k.category?.categoryName||k.category?.ageCategoryCode||k.category?.ratingType||k.gender;if(k.eventName=`Event ${d} ${x}`,Array.isArray(k.entries))for(let $ of k.entries)$.participantId=l[$.participantId];for(let $ of k.drawDefinitions||[]){$.extensions=o($);let V=Pt();if(l[$.drawId]=V,$.drawId=V,$.isMock=!0,Array.isArray($.entries))for(let B of $.entries)B.participantId=l[B.participantId];let _=B=>{B.extensions=o(B);let G=Pt();l[B.structureId]=G,B.structureId=G;for(let j of B.positionAssignments||[])j.participantId&&(j.participantId=l[j.participantId]);for(let j of B.seedAssignments||[])j.participantId&&(j.participantId=l[j.participantId]);for(let j of B.matchUps||[]){j.isMock=!0;for(let Y of j.sides||[])Y.lineUp&&(Y.lineUp=Y.lineUp.map(({participantId:K,collectionAssignments:X})=>({participantId:l[K],collectionAssignments:X})))}};for(let B of $.structures||[])if(_(B),Array.isArray(B.structures))for(let G of B.structures)_(G);for(let B of $.links||[])B.source.structureId=l[B.source.structureId],B.target.structureId=l[B.target.structureId]}let{extension:L}=it({name:eo,element:k});Array.isArray(L?.value?.flights)&&L?.value.flights?.forEach($=>{if($.drawId=l[$.drawId],Array.isArray($.drawEntries))for(let V of $.drawEntries)V.participantId=l[V.participantId]}),d+=1}let p=i.startDate||_s(new Date),f=(i.participants||[]).filter(({participantType:k})=>k===vt),h=f.reduce((k,F)=>{let x=F.person?.sex,L=ln(x);return L&&cl(x)?k[L]+=1:k[Xu]+=1,k},{[Zi]:0,[Lr]:0,[Xu]:0}),m=Object.assign({},...Object.keys(h).map(k=>({[k]:BQ({category:{ageCategoryCode:"O18"},count:h[k],personExtensions:[],consideredDate:p,sex:k})?.persons||[]}))),g={[Zi]:0,[Lr]:0,[Xu]:0},I=f.length,v=f.reduce((k,F)=>{let x=F.person?.addresses?.[0]||{},{city:L,state:$,postalCode:V}=x;return k.cities.includes(L)||k.cities.push(L),k.states.includes($)||k.states.push($),k.postalCodes.includes(V)||k.postalCodes.push(V),k},{cities:[],postalCodes:[],states:[]}),w=v.postalCodes.length,y=v.cities.length,b=v.states.length,{cities:S}=FQ({count:y||I,participantsCount:I}),{states:U}=LQ({count:b||I,participantsCount:I}),{postalCodes:T}=_Q({count:w||I,participantsCount:I}),D={cities:S,states:U,postalCodes:T};f.forEach((k,F)=>{let x=k?.person,L=x?.sex||Xu,$=Qe(x?.birthDate)?.split("-")[0],V=g[L],_=m[L][V];if(g[L]+=1,$){let[,B,G]=_?.birthDate?.split("-")||[],j=[$,B,G].join("-");_.birthDate=j}if(x?.addresses){let B=$Q({...D,participantIndex:F,nationalityCode:_.nationalityCode});_.addresses=[B]}_.personId=n?.[F]||Pt(),e?(_.standardFamilyName=_.lastName,_.standardGivenName=_.firstName,k.participantName=`${_.standardGivenName} ${_.standardFamilyName}`):(_.standardFamilyName=x?.standardFamilyName,_.standardGivenName=x?.standardGivenName),delete _.firstName,delete _.lastName,_.extensions=o(x),k.person=_,l[x?.personId]=_.personId}),(i.participants||[]).filter(({participantType:k})=>k===ht).forEach(k=>{let{individualParticipantIds:F}=k;k.participantName=nMe({individualParticipantIds:F,individualParticipants:f})});let P=(i.participants||[]).filter(({participantType:k})=>k===_t),E=P.length,R=OP({count:E}).names;P.forEach((k,F)=>{k.participantName=R[F]});let C=(i.participants||[]).filter(({participantType:k})=>k===Xa),M=C.length,N=OP({count:M,nameRoot:"Group"}).names;C.forEach((k,F)=>{k.participantName=N[F]});let{extension:A}=it({element:i,name:_h});Array.isArray(A?.value)&&A?.value.forEach(k=>{k.tournamentId=l[k.tournamentId],k.structureId=l[k.structureId],k.eventId=l[k.eventId],k.drawId=l[k.drawId]});let{extension:O}=it({element:i,name:hv});return Array.isArray(O?.value)&&O?.value.forEach(k=>{k.personId=l[k.personId]}),{...H}}function nMe({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r?.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function aMe({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n}){let{gender:a,category:s,eventType:o}=t,{drawProfiles:l,publish:u}=e,c=Ti(pl)(o)&&vt||Ti(ps)(o)&&ht||o;if(l){let{stageParticipantsCount:d,uniqueParticipantsCount:p,uniqueParticipantStages:f}=jQ({drawProfiles:l,category:s,gender:a}),{uniqueDrawParticipants:h=[],uniqueParticipantIds:m=[]}=f?zQ({event:{eventType:o,category:s,gender:a},uniqueParticipantsCount:p,participantsProfile:e.participantsProfile,ratingsParameters:e.ratingsParameters,tournamentRecord:i,eventProfile:e,uuids:e.uuids}):{};r.push(...m);let{stageParticipants:g}=GQ({targetParticipants:i.participants||[],allUniqueParticipantIds:r,stageParticipantsCount:d,eventParticipantType:c}),I=qQ({uniqueDrawParticipants:h,autoEntryPositions:e.autoEntryPositions,stageParticipants:g,tournamentRecord:i,drawProfiles:l,category:s,gender:a,event:t});if(I.error||(I=WQ({matchUpStatusProfile:e.matchUpStatusProfile,completeAllMatchUps:e.completeAllMatchUps,randomWinningSide:e.randomWinningSide,tournamentRecord:i,drawProfiles:l,isMock:e.isMock,event:t}),I.error))return I;n.push(...I.drawIds)}return u&&Av({tournamentRecord:i,event:t}),H}function ZQ(t,e){return t?.find((i,r)=>e.eventIndex!==void 0&&r===e.eventIndex||e.eventName&&i.eventName===e.eventName||e.eventId&&i.eventId===e.eventId)}function sMe({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n,params:a}){return aMe({event:t,eventProfile:{...e,...a},tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n})}function oMe({eventProfile:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s}){let o=YQ({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,randomWinningSide:a.randomWinningSide,ratingsParameters:t.ratingsParameters,tournamentRecord:e,eventProfile:t,eventIndex:s,uuids:a.uuids});if(o.error)return o;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=o;return u&&n.push(...u),r.push(l),c?.length&&i.push(...c),{eventIndexIncrement:1}}function lMe({eventProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=e.events?.length||0;for(let o of t){let l=ZQ(e.events,o);if(l){let u=sMe({event:l,eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,drawIds:n,params:a});if(u?.error)return u}else{let u=oMe({eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s});if(u?.error)return u;s+=u?.eventIndexIncrement||1}}return H}function uMe({drawProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=(e.events||[]).flatMap(o=>o.drawDefinitions?.map(()=>1)||[]).reduce((o,l)=>o+l,0);for(let o of t){let l=hM({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,hydrateCollections:a.hydrateCollections,randomWinningSide:a.randomWinningSide,ratingsParameters:a.ratingsParameters,tournamentRecord:e,drawProfile:o,drawIndex:s,uuids:a.uuids});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(l=Mv({tournamentRecord:e,event:d,internalUse:!0}),l.error)return l;u&&n.push(u),r.push(c),p?.length&&i.push(...p),s+=1}return H}function cMe({schedulingProfile:t,autoSchedule:e,periodLength:i,tournamentRecord:r}){let n=[],a={};if(t?.length){let s={[r.tournamentId]:r},o=Rv({tournamentRecords:s,schedulingProfile:t});if(o.error)return o;if(e){let{tournamentId:l}=r,u={[l]:r};a=dM({tournamentRecords:u,periodLength:i})}}return{scheduledRounds:n,schedulerResult:a}}function eZ(t){let{participantsProfile:e={},schedulingProfile:i,tournamentRecord:r,autoSchedule:n,eventProfiles:a,periodLength:s,venueProfiles:o,drawProfiles:l,uuids:u}=t;if(!r)return{error:ge};let c=[],d=[],p=[];a?.forEach(w=>{let y=ZQ(r.events,w);y?.gender&&(w.gender=y.gender)});let f=r.participants?.length||void 0;f&&e?.idPrefix&&(e.idPrefix=`${e.idPrefix}-${f}`);let h=VQ({startDate:r.startDate,participantsProfile:e,tournamentRecord:r,eventProfiles:a,drawProfiles:l,uuids:u});if(!h.success)return h;if(a){let w=lMe({eventProfiles:a,tournamentRecord:r,allUniqueParticipantIds:c,eventIds:d,drawIds:p,params:t});if(w.error)return w}if(l){let w=uMe({drawProfiles:l,tournamentRecord:r,allUniqueParticipantIds:c,eventIds:d,drawIds:p,params:t});if(w.error)return w}let m=o?.length?R$({tournamentRecord:r,venueProfiles:o}):[],g=cMe({tournamentRecord:r,schedulingProfile:i,autoSchedule:n,periodLength:s});if(g.error)return g;let{scheduledRounds:I,schedulerResult:v}=g;return{totalParticipantsCount:r.participants.length,scheduledRounds:I,schedulerResult:v,...H,eventIds:d,venueIds:m,drawIds:p}}var tZ={};pt(tZ,{addDynamicRatings:()=>_0,addIndividualParticipantIds:()=>nM,addParticipant:()=>Il,addParticipants:()=>ro,addPenalty:()=>SZ,addPersonRequests:()=>oZ,addPersons:()=>UZ,createGroupParticipant:()=>fZ,createTeamsFromParticipantAttributes:()=>U$,deleteParticipants:()=>Em,filterParticipants:()=>CS,findParticipant:()=>pZ,getCompetitionParticipants:()=>d_,getPairedParticipant:()=>io,getParticipantEventDetails:()=>p_,getParticipantMembership:()=>f_,getParticipantScaleItem:()=>Bh,getParticipantSchedules:()=>h_,getParticipantSignInStatus:()=>m_,getParticipantTimeItem:()=>RL,getParticipants:()=>Pi,getScaleValues:()=>fv,mergeParticipants:()=>wZ,modifyIndividualParticipantIds:()=>lZ,modifyParticipant:()=>aM,modifyParticipantName:()=>hZ,modifyParticipantOtherName:()=>cZ,modifyParticipantsSignInStatus:()=>uZ,modifyPenalty:()=>yZ,modifyPersonRequests:()=>aZ,mutate:()=>iZ,participantScaleItem:()=>Zl,query:()=>lJ,regenerateParticipantNames:()=>dZ,removeIndividualParticipantIds:()=>JL,removeParticipantIdsFromAllTeams:()=>lC,removePenalty:()=>IZ,removePersonRequests:()=>sZ,removeRatings:()=>gZ,scaledTeamAssignment:()=>mZ,setParticipantScaleItem:()=>Pv,setParticipantScaleItems:()=>iX,validateLineUp:()=>cC});var iZ={};pt(iZ,{addDynamicRatings:()=>_0,addIndividualParticipantIds:()=>nM,addParticipant:()=>Il,addParticipants:()=>ro,addPenalty:()=>SZ,addPersonRequests:()=>oZ,addPersons:()=>UZ,createGroupParticipant:()=>fZ,createTeamsFromParticipantAttributes:()=>U$,deleteParticipants:()=>Em,findParticipant:()=>pZ,mergeParticipants:()=>wZ,modifyIndividualParticipantIds:()=>lZ,modifyParticipant:()=>aM,modifyParticipantName:()=>hZ,modifyParticipantOtherName:()=>cZ,modifyParticipantsSignInStatus:()=>uZ,modifyPenalty:()=>yZ,modifyPersonRequests:()=>aZ,regenerateParticipantNames:()=>dZ,removeIndividualParticipantIds:()=>JL,removeParticipantIdsFromAllTeams:()=>lC,removePenalty:()=>IZ,removePersonRequests:()=>sZ,removeRatings:()=>gZ,scaledTeamAssignment:()=>mZ,setParticipantScaleItem:()=>Pv,setParticipantScaleItems:()=>iX});function rZ(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function nZ({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:s,endTime:o}=n;return n.requestType===tU&&(a=Qe(a),s=di(s),o=di(o),a&&s&&o)?{date:a,startTime:s,endTime:o,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=rZ(),t[e].push(n);return{mergeCount:r.length}}function C$(t){let{tournamentRecords:e,personRequests:i}=t,r=Ge(t,[{[dn]:!0}]);if(r.error)return r;if(!i)return{...H};let n=Object.values(e);for(let a of n){let s=a.participants??[],o=[];for(let l of Object.keys(i))if(yd({tournamentParticipants:s,personId:l})){let u=i[l];u.length&&o.push({personId:l,requests:u})}Object.keys(o).length&&gt({element:a,extension:{value:o,name:hv}})}return{...H}}function aZ(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=Ge(t,[{[dn]:!0},{requests:!0,[Xn]:sn,[Ha]:ie}]);if(n.error)return n;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:s}=vf({tournamentRecords:e}),o=u=>{s&&(s[u]=s[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(r&&s?.[r])o(r);else if(s)for(let u of Object.keys(s))o(u);let l=i.filter(u=>!u.requestId);return l.length&&nZ({personRequests:s,personId:r,requests:l}),C$({tournamentRecords:e,personRequests:s})}function sZ(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,s=Ge(t,[{[dn]:!0}]);if(s.error)return s;let{personRequests:o}=vf({tournamentRecords:e}),l=c=>{o&&(o[c]=o[c].filter(d=>(!i||d.requestType!==i)&&(!r||d.requestId!==r)&&(!a||d.date!==a)),o?.[c]?.length||delete o[c])},u=!i&&!r&&!n&&!a;if(!u){if(n&&o?.[n])l(n);else if(o)for(let c of Object.keys(o))l(c)}return u||!o||!Object.keys(o).length?Mn({name:hv,tournamentRecords:e,discover:!0}):C$({tournamentRecords:e,personRequests:o})}function oZ(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=Ge(t,[{[dn]:!0,[Xve]:!0},{requests:!0,[Xn]:sn,[Ha]:ie}]);if(n.error)return n;let{personRequests:a}=vf({tournamentRecords:e}),{mergeCount:s}=nZ({personRequests:a,personId:i,requests:r});return s&&a?C$({tournamentRecords:e,personRequests:a}):{error:ie}}function lZ({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return z({result:{error:ge},stack:r});if(!e||!t)return z({result:{error:Xe},stack:r});let n=i.participants||[],a=n.find(f=>f.participantId===e);if(!a)return z({result:{error:ji},stack:r});if(![_t,Xa].includes(a.participantType))return z({result:{error:Ao},context:{participantType:a.participantType},stack:r});let s=t.filter(f=>n.find(h=>h.participantId===f)?.participantType!==vt);if(s.length)return z({result:{error:Sa,invalidParticipantIds:s},stack:r});let o=a.individualParticipantIds||[],l=t.filter(f=>!o.includes(f)),u=o.filter(f=>!t.includes(f)),c=nM({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return z({result:c,stack:r});let d=JL({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return z({result:d,stack:r});let{topics:p}=bs();if(p.includes(tn)){let f=n.find(({participantId:h})=>h===e);nt({topic:tn,payload:{tournamentId:i.tournamentId,participants:[f]}})}return{...c,...d}}function uZ({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:ge};if(!Array.isArray(e))return{error:Xe};if(![Vb,v7].includes(i))return{error:ie,signInState:i};let r=t.participants||[];if(!r.length)return{error:Yw};let n=r.map(bt),a=e.filter(u=>!n.includes(u));if(a.length)return{error:ie,context:{invalidParticipantIds:a}};let s=[],o=new Date().toISOString();for(let u of r){let{participantId:c}=u;if(e.includes(c)){let d=D0({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:pS,itemValue:i,createdAt:o}});if(d.error)return d;s.push(u)}}let{topics:l}=bs();return s.length&&l.includes(tn)&&nt({topic:tn,payload:{tournamentId:t.tournamentId,participants:s}}),{...H}}function cZ({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:ge};if(!e)return{error:ur};let{participant:r}=Wd({tournamentRecord:t,participantId:e});if(!r)return{error:ji};r.participantOtherName=i;let{topics:n}=bs();return n.includes(tn)&&nt({topic:tn,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...H}}function Rz({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),r=m=>/^[a-z]*$/.test(i(m)),n=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),s=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),o=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,u=m=>m.toLowerCase().indexOf("f")<0,c=m=>m.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=KO(e?.standardGivenName??""),f=KO(e?.standardFamilyName??"");if(!t)return`${p}${d}${f}`;l(t)&&!o(t)&&!s(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),f=f.toLowerCase()):n(t)?(p=p.toUpperCase(),f=f.toUpperCase()):a(t)&&(f=f.toUpperCase());let h=`${p}${d}${f}`;return u(t)?h=f:s(t)&&(o(t)?h=`${f},${d}${p}`:h=`${f}${d}${p}`),h}function dMe({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,s=r&&i[r];if(r!==jn&&s){let{personFormat:o,doublesJoiner:l}=s;r===vt&&(e.participantName=Rz({person:a,personFormat:o})),r===ht&&(e.participantName=n?.map(u=>{let c=t[u]?.person;return Rz({person:c,personFormat:o})}).filter(Boolean).join(l??"/"))}}function dZ({tournamentRecord:t,formats:e}){if(!t)return{error:ge};if(!St(e))return{error:Xe};let i=t.participants??[],r=Y6(i,"participantId");for(let n of i)dMe({participant:n,participantMap:r,formats:e});return{...H}}function pZ(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,s=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Xe,stack:"publicFindParticipant"};let o,l;for(let u of Object.values(s)){l=u.tournamentId;let c=u.participants||[];if(o=yd({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),o)break}return{participant:o,tournamentId:l,...H}}function fZ({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=D8,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:ge};if(!a)return{error:Xe,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:ie};let s=(Pi({participantFilters:{participantTypes:[vt]},tournamentRecord:r}).participants??[]).map(c=>c.participantId);for(let c of t)if(!s.includes(c))return{error:Ao,participantId:c};let o=Ve({participantId:n||Pt(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:Xa,participantRole:i}),l=Il({participant:o,tournamentRecord:r});if(l.error)return l;let{topics:u}=bs();return u.includes(bd)&&nt({topic:bd,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...H,participant:Oe(o)}}function hZ({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:ge};if(!i)return{error:ur};if(!e)return{error:Xe,info:"Missing participantName"};let{participant:r}=Wd({tournamentRecord:t,participantId:i});if(!r)return{error:ji};r.participantName=e;let{topics:n}=bs();return n.includes(tn)&&nt({topic:tn,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...H}}function mZ({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:s,scaleAttributes:o,teamNameBase:l,teamsCount:u,eventId:c,event:d}){if(!s)return{error:ge};if(!Array.isArray(a)&&!ut(u)&&!c||!ut(r)||n&&!Array.isArray(n)||o&&(typeof o!="object"||!Object.keys(o).length))return{error:ie};if(!o&&!n.length||!n&&!(e&&o))return{error:Xe,info:"Missing scaling details"};if(c&&!a){if(d?.eventType!==Da)return{error:uu};a=d?.entries?.filter(({entryStatus:I})=>I===da).map(bt)}if(!a?.length&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Xe};let p=e??n.map(({participantId:I})=>I);i&&(a?.reverse(),r+=1),r>(a?.length||0)-1&&(r=0);let f=a?.slice(r).concat(...a.slice(0,r))??[],h=[];for(let I of s.participants??[]){let{participantId:v,participantType:w}=I;if(f.includes(v)){if(w!==jn)return{error:Ao,participant:I};h.push(I)}}if(u&&h.length<u){let I=u-(h?.length||0),v=l??"Team",w=Re(0,I).map(U=>({participantName:`${v} ${U+1}`,participantType:jn,participantRole:Xr})),{participants:y=[]}=ro({participants:w,returnParticipants:!0,tournamentRecord:s}),b=y.map(bt),S=s.participants?.filter(({participantId:U})=>b.includes(U))??[];h.push(...S)}if(!h.length)return{error:E1};if(t)for(let I of h)I.individualParticipantIds=[];else{let I=h.map(v=>v).flat();e?.length?p=p.filter(v=>!I.includes(v)):n=n?.filter(({participantId:v})=>!I.includes(v))}if(!e?.length&&!n?.length)return{error:IR,info:"Nothing to be done"};if(!n.length){for(let I of s.participants??[]){let{participantId:v,participantType:w}=I;if(!p.includes(v))continue;if(w!==vt)return{error:Ao,participant:I};let y=Zl({scaleAttributes:o,participant:I})?.scaleItem,b=o?.accessor?y?.scaleValue?.[o?.accessor]:y?.scaleValue,S={participantId:v,scaleValue:b};n.push(S)}if(!n.length)return{error:ji}}n.sort((I,v)=>o?.sortOrder?(v?.scaleValue||0)-(I?.scaleValue||0):(I?.scaleValue||1/0)-(v?.scaleValue||1/0));for(let I of n)if(!I.participantId)return{error:ie,scaledParticipant:I};let m=0;for(;m<n.length;){for(let I of h){if(m+1>n.length)break;let v=n[m];I.individualParticipantIds.push(v.participantId),m++}h.reverse()}let g=h.map(bt);for(let I of s.events??[]){if(I.eventType!==Da)continue;let v=(I.entries??[]).filter(w=>g.includes(w.participantId));for(let w of v){let y=w.participantId,b=h.find(U=>U.participantId===y)?.individualParticipantIds;I.entries=(I.entries??[]).filter(U=>!b.includes(U.participantId)),(I.drawDefinitions??[]).forEach(U=>{U.entries=(U.entries??[]).filter(T=>!b.includes(T.participantId))});let{flightProfile:S}=Bi({event:I});(S?.flights||[]).forEach(U=>{U.drawEntries=(U.drawEntries||[]).filter(T=>!b.includes(T.participantId))})}}return{...H,scaledParticipants:n}}function gZ(t){let e=Ge(t,[{[mr]:!0,[Z1]:!0},{ratingType:!1,[qr]:s=>Pr[s]}]);if(e.error)return e;let i=`${t.ratingType}.${rL}`,r=t.asDynamic?i:t.ratingType,n=[vd,fd,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let s of a)s.timeItems&&(s.timeItems=s.timeItems.filter(o=>o.itemType!==n));return{...H}}function IZ(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Ri};for(let i of Object.values(e)){let r=pMe({...t,tournamentRecord:i});if(r.error&&r.error!==rI)return r}return{...H}}function pMe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:ge};if(!e)return{error:S1};let i=t?.participants??[],r=[],n=!1,a;return i.forEach(s=>{let o=!1;s.penalties=(s.penalties??[]).filter(l=>(l.penaltyId===e&&(o=!0,n||(a=l,n=!0)),o&&r.push(s),l.penaltyId!==e))}),a&&nt({topic:tn,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...H,penalty:a}:{error:rI}}var fMe=({penaltyId:t=Pt()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),vZ=fMe;function yZ(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Ri};for(let i of Object.values(e)){let r=hMe({...t,tournamentRecord:i});if(r.error&&r.error!==rI||r.success)return r}return{error:rI}}function hMe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:ge};if(!e)return{error:ie,modifications:e};if(!i)return{error:S1};let r=t?.participants??[],n=Object.keys(vZ()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:vR};let s,o=[];return r.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),s||(s=c)),c)),u&&o.push(l)}),s&&nt({topic:tn,payload:{tournamentId:t.tournamentId,participants:o}}),s?{...H,penalty:s}:{error:rI}}function bZ(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:ot(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=ot(t[n].map(s=>JSON.stringify(s)).concat(e[n].map(s=>JSON.stringify(s)))).map(s=>JSON.parse(s));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=bZ(t[n],e[n],i):r[n]=e[n];return r},{})}function wZ({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:ge};e.participants||(e.participants=[]);let r=t.filter(Pa(gu)).map(u=>({[u.participantId]:u})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(u=>{if(n[u.participantId]){let c=bZ(u,n[u.participantId],i);return a.push(c),c}return u});let s=e.participants.map(Pa(gu))||[],o=t.filter(({participantId:u})=>!s.includes(u)),{topics:l}=bs();return o.length&&(e.participants=e.participants.concat(...o),l.includes(bd)&&nt({topic:bd,payload:{participants:o}})),a.length&&l.includes(tn)&&nt({topic:tn,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:o.length,...H}}function SZ(t){let{tournamentRecord:e,participantIds:i}=t,r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n;for(let a of Object.values(r)){let s=(Pi({tournamentRecord:a}).participants??[])?.map(bt).filter(o=>i.includes(o));s.length&&(n=mMe({...t,penaltyId:t.penaltyId??n,tournamentRecord:a,participantIds:s}).penaltyId)}return n?{...H,penaltyId:n}:{error:ji}}function mMe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:s,matchUpId:o,issuedAt:l,notes:u}){if(!e)return{error:ge};if(!i)return{error:ur};if(!n)return{error:Q4};let c=(e?.participants??[]).filter(f=>i.includes(f.participantId));if(!c.length)return{error:ji};let d=new Date().toISOString(),p=Object.assign(vZ({penaltyId:s}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:o,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(f=>gt({element:p,extension:f})),c.forEach(f=>{f.penalties??=[],f.penalties.push(p)}),nt({topic:tn,payload:{tournamentId:e.tournamentId,participants:c}}),{...H,penaltyId:p.penaltyId}}function UZ({participantRole:t=Xr,tournamentRecord:e,persons:i}){if(!e)return{error:ge};if(!Array.isArray(i))return{error:ie};if(!Object.keys(XL).includes(t))return{error:V4};let r=new Set((e.participants||[]).map(({person:h})=>h?.personId).filter(Boolean)),n=[],a=i.filter(h=>h&&(!h.personId||!r.has(h.personId))).map(h=>(h.personId||(h.personId=Pt()),n.push(h.personId),h)),s=(h,m)=>Object.assign({},...Object.keys(h).filter(g=>!m.includes(g)).map(g=>({[g]:h[g]}))),o=a.map(h=>Ve({extensions:h.participantExtensions,timeItems:h.participantTimeItems,participantType:vt,participantRole:t,person:s(h,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,u,c=ro({participants:o,tournamentRecord:e});if(c.error)return c;u=c.addedCount||0;let d=[],p=Pi({participantFilters:{participantTypes:[vt]},tournamentRecord:e})?.participants??[];if(t===Xr&&i.filter(({pairedPersons:h})=>h).forEach(({personId:h,pairedPersons:m})=>{Array.isArray(m)&&m.forEach(g=>{let I=[h,g.personId].map(v=>yd({tournamentParticipants:p,personId:v})).filter(Boolean);if(I.length===2){let v=I.map(bt);d.push(Ve({extensions:g.participantExtensions,timeItems:g.timeItems,participantRole:Xr,individualParticipantIds:v,participantType:ht}))}})}),d.length){if(c=ro({participants:d,tournamentRecord:e}),c.error)return c;l=c.addedCount||0}let f=u+l;return{...H,addedCount:f,newPersonIds:n}}var TZ={};pt(TZ,{bulkUpdatePublishedEventIds:()=>P_,getAllEventData:()=>E_,getCourtInfo:()=>iC,getDrawData:()=>wC,getEventData:()=>GS,getEventPublishStatus:()=>Oa,getPublishState:()=>Pm,getTournamentPublishStatus:()=>bv,getVenueData:()=>mI,mutate:()=>DZ,publishEvent:()=>Av,publishEventSeeding:()=>PZ,publishOrderOfPlay:()=>NZ,publishParticipants:()=>MZ,query:()=>mJ,setEventDisplay:()=>ZC,unPublishEvent:()=>AZ,unPublishEventSeeding:()=>EZ,unPublishOrderOfPlay:()=>CZ,unPublishParticipants:()=>RZ});var DZ={};pt(DZ,{publishEvent:()=>Av,publishEventSeeding:()=>PZ,publishOrderOfPlay:()=>NZ,publishParticipants:()=>MZ,setEventDisplay:()=>ZC,unPublishEvent:()=>AZ,unPublishEventSeeding:()=>EZ,unPublishOrderOfPlay:()=>CZ,unPublishParticipants:()=>RZ});function PZ({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=Qa,drawIds:a=[],event:s}){if(!r)return{error:ge};if(!s)return{error:ui};let o=Oa({event:s,status:n}),l=(o?.seeding?.seedingScaleNames||i)&&{...o?.seeding?.seedingScaleNames,...i},u=(o?.seeding?.stageSeedingScaleNames||e)&&{...o?.seeding?.stageSeedingScaleNames,...e},c=Ve({stageSeedingScaleNames:u,seedingScaleNames:l,published:!0,drawIds:a});return Nv({statusObject:{seeding:c},removePriorValues:t,status:n,event:s}),nt({topic:p7,payload:{tournamentId:r.tournamentId,eventId:s.eventId,drawIds:a}}),{...H}}function EZ({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=Qa,drawIds:n,stages:a,event:s}){if(!i)return{error:ge};if(!s)return{error:ui};let o=Oa({event:s});if(o){let l=o.seeding;if(Array.isArray(a)&&l.stageSeedingScaleNames)for(let u of a)l.stageSeedingScaleNames[u]&&delete l.stageSeedingScaleNames[u];Array.isArray(e)&&l?.seedingScaleNames&&(l.seedingScaleNames=l.seedingScaleNames.filter(u=>!e.includes(u))),Array.isArray(n)&&l?.drawIds&&(l.drawIds=l.drawIds.filter(u=>!n.includes(u))),(!Object.values(l.stageSeedingScaleNames??{}).length&&!l.seedingScaleNames?.length&&!l.drawIds?.length||!a&&!e&&!n?.length)&&(delete l.stageSeedingScaleNames,delete l.seedingScaleNames,delete l.drawIds,l.published=!1),Nv({statusObject:{seeding:l},removePriorValues:t,status:r,event:s})}return nt({topic:TL,payload:{tournamentId:i.tournamentId,eventId:s.eventId}}),{...H}}function M$({tournamentRecord:t}){if(!Jw(hP))return;let e=bv({tournamentRecord:t});if(!(e?.orderOfPlay?.published||e?.participants?.published)){for(let i of t.events??[]){let r=Oa({event:i})?.drawDetails??{};for(let n of i.drawDefinitions?.map(fI)??[])if(sC({drawDetails:r,drawId:n,ignoreEmbargo:!0}))return}nt({topic:hP,payload:{tournamentId:t.tournamentId}})}}function RZ(t){let e=ws(t);if(!Object.keys(e).length)return{error:Ri};for(let i of Object.values(e)){let r=gMe({tournamentRecord:i,...t});if(r.error)return r}return{...H}}function gMe({removePriorValues:t=!0,tournamentRecord:e,status:i=Qa}){if(!e)return{error:ge};let r=`${zd}.${qd}`,{timeItem:n}=Ss({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].participants,kl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),nt({payload:{tournamentId:e.tournamentId},topic:m7}),M$({tournamentRecord:e}),{...H}}function CZ(t){let e=ws(t);if(!Object.keys(e).length)return{error:Ri};for(let i of Object.values(e)){let r=IMe({tournamentRecord:i,...t});if(r.error)return r}return{...H}}function IMe({removePriorValues:t=!0,tournamentRecord:e,status:i=Qa}){if(!e)return{error:ge};let r=`${zd}.${qd}`,{timeItem:n}=Ss({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,kl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),nt({topic:DL,payload:{tournamentId:e.tournamentId}}),M$({tournamentRecord:e}),{...H}}function MZ(t){let e=ws(t);if(!Object.keys(e).length)return{error:Ri};for(let i of Object.values(e)){let r=vMe({tournamentRecord:i,...t});if(r.error)return r}return{...H}}function vMe({removePriorValues:t,tournamentRecord:e,status:i=Qa,embargo:r,columns:n,language:a}){if(!e)return{error:ge};let s=`${zd}.${qd}`,{timeItem:o}=Ss({element:e,itemType:s}),l=o?.itemValue||{[i]:{}},u={published:!0};return r&&!ld(r)?{error:Ng}:(r&&(u.embargo=r),n&&(u.columns=n),l[i].participants=u,a&&(l[i].language=a),kl({timeItem:{itemValue:l,itemType:s},element:e,removePriorValues:t}),nt({payload:{tournamentId:e.tournamentId},topic:h7}),{...H})}function NZ(t){let e=ws(t);if(!Object.keys(e).length)return{error:Ri};for(let i of Object.values(e)){let r=yMe({tournamentRecord:i,...t});if(r.error)return r}return{...H}}function yMe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=Qa,eventIds:n=[],embargo:a,language:s}){if(!i)return{error:ge};let o=`${zd}.${qd}`,{timeItem:l}=Ss({element:i,itemType:o}),u=l?.itemValue||{[r]:{}},c={published:!0,scheduledDates:t,eventIds:n};return a&&!ld(a)?{error:Ng}:(a&&(c.embargo=a),u[r].orderOfPlay=c,s&&(u[r].language=s),kl({timeItem:{itemValue:u,itemType:o},element:i,removePriorValues:e}),nt({topic:f7,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...H})}function AZ({removePriorValues:t=!0,tournamentRecord:e,status:i=Qa,event:r}){if(!e)return{error:ge};if(!r)return{error:ui};let n=`${zd}.${qd}`,{timeItem:a}=fS({itemType:n,event:r}),s=a?.itemValue||{[i]:{}};return delete s[i].structureIds,delete s[i].drawDetails,delete s[i].drawIds,Nm({event:r,timeItem:{itemValue:s,itemType:n},removePriorValues:t}),Nv({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),nt({topic:UL,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),M$({tournamentRecord:e}),{eventId:r.eventId,...H}}var N$={};pt(N$,{applyTournamentRankingPoints:()=>LZ,generateRankingList:()=>OZ,getAwardPoints:()=>CP,getAwardProfile:()=>U_,getParticipantPoints:()=>xZ,getQualityWinPoints:()=>S_,getTournamentPoints:()=>Ev,mutate:()=>FZ,query:()=>kZ});var kZ={};pt(kZ,{generateRankingList:()=>OZ,getAwardPoints:()=>CP,getAwardProfile:()=>U_,getParticipantPoints:()=>xZ,getQualityWinPoints:()=>S_,getTournamentPoints:()=>Ev});function FP({awards:t,pointComponents:e,bestOfCount:i,maxResultsPerLevel:r,mandatoryRules:n}){let a=t.map(d=>{let p=0;for(let f of e)p+=typeof d[f]=="number"?d[f]:0;return{award:d,value:p}});a.sort((d,p)=>p.value-d.value);let s=a,o=[];if(r){let d={};s=[];for(let p of a){let f=p.award.level;f===void 0||!r[f]?s.push(p):(d[f]=(d[f]||0)+1,d[f]<=r[f]?s.push(p):o.push(p))}}if(n?.length)return bMe(s,o,i,n);let l=i>0?s.slice(0,i):s,u=[...i>0?s.slice(i):[],...o],c=l.reduce((d,p)=>d+p.value,0);return{counting:l,dropped:u,bucketTotal:c}}function bMe(t,e,i,r){let n=new Set;for(let p of r){let f=new Set(p.levels),h=[];for(let g=0;g<t.length;g++){let I=t[g].award.level;I!==void 0&&f.has(I)&&h.push(g)}let m=p.bestOfCount?h.slice(0,p.bestOfCount):h;for(let g of m)n.add(g)}let a=[],s=[];for(let p=0;p<t.length;p++)n.has(p)?a.push(t[p]):s.push(t[p]);let o,l;if(i>0){let p=Math.max(0,i-a.length);o=s.slice(0,p),l=s.slice(p)}else o=s,l=[];let u=[...a,...o],c=[...l,...e],d=u.reduce((p,f)=>p+f.value,0);return{counting:u,dropped:c,bucketTotal:d}}function OZ({pointAwards:t,aggregationRules:e={},categoryFilter:i,asOfDate:r}){let{rollingPeriodDays:n,countingBuckets:a,tiebreakCriteria:s=[],minCountableResults:o=0,maxResultsPerLevel:l,bestOfCount:u}=e,c=t;if(i&&(c=c.filter(h=>{if(i.ageCategoryCodes?.length){let m=h.category?.ageCategoryCode;if(!m||!i.ageCategoryCodes.includes(m))return!1}if(i.genders?.length){let m=h.category?.gender||h.gender;if(!m||!i.genders.includes(m))return!1}return!(i.eventTypes?.length&&(!h.eventType||!i.eventTypes.includes(h.eventType)))})),n&&r){let h=new Date(r);h.setDate(h.getDate()-n);let m=h.getTime();c=c.filter(g=>g.endDate?new Date(g.endDate).getTime()>=m:!0)}let d={};for(let h of c){let m=h.personId;m&&(d[m]||(d[m]=[]),d[m].push(h))}let p=[];for(let[h,m]of Object.entries(d)){let g=0,I=[],v=[],w;if(a?.length){w=[];for(let S of a){let{bucketName:U,eventTypes:T,pointComponents:D,bestOfCount:P,maxResultsPerLevel:E,mandatoryRules:R}=S,C=m;T?.length&&(C=C.filter(O=>O.eventType&&T.includes(O.eventType)));let{counting:M,dropped:N,bucketTotal:A}=FP({awards:C,pointComponents:D,bestOfCount:P,maxResultsPerLevel:E,mandatoryRules:R});g+=A,I.push(...M.map(O=>O.award)),v.push(...N.map(O=>O.award)),w.push({bucketName:U,countingResults:M.map(O=>O.award),droppedResults:N.map(O=>O.award),bucketTotal:A})}}else{let{counting:S,dropped:U,bucketTotal:T}=FP({awards:m,pointComponents:["points","qualityWinPoints"],bestOfCount:u||0,maxResultsPerLevel:l});g=T,I=S.map(D=>D.award),v=U.map(D=>D.award)}let y=I.length>=o,b={personId:h,totalPoints:g,rank:0,meetsMinimum:y,countingResults:I,droppedResults:v};w&&(b.bucketBreakdown=w),p.push(b)}p.sort((h,m)=>m.totalPoints-h.totalPoints),s.length&&p.sort((h,m)=>{if(h.totalPoints!==m.totalPoints)return m.totalPoints-h.totalPoints;for(let g of s){let I=Cz(g,h,m);if(I!==0)return I}return 0});let f=1;for(let h=0;h<p.length;h++)h>0&&p[h].totalPoints===p[h-1].totalPoints?s.length>0&&s.some(m=>Cz(m,p[h-1],p[h])!==0)?p[h].rank=f:p[h].rank=p[h-1].rank:p[h].rank=f,f=h+2;return p}function Cz(t,e,i){switch(t){case"highestSingleResult":{let r=Math.max(0,...e.countingResults.map(n=>n.points||0));return Math.max(0,...i.countingResults.map(n=>n.points||0))-r}case"mostCountingResults":return i.countingResults.length-e.countingResults.length;case"mostWins":{let r=e.countingResults.reduce((n,a)=>n+(a.winCount||0),0);return i.countingResults.reduce((n,a)=>n+(a.winCount||0),0)-r}default:return 0}}function xZ({pointAwards:t,personId:e,aggregationRules:i={}}){let{countingBuckets:r,maxResultsPerLevel:n,bestOfCount:a}=i,s=t.filter(c=>c.personId===e);if(r?.length){let c=[],d=0;for(let p of r){let{bucketName:f,eventTypes:h,pointComponents:m,bestOfCount:g,maxResultsPerLevel:I,mandatoryRules:v}=p,w=s;h?.length&&(w=w.filter(U=>U.eventType&&h.includes(U.eventType)));let{counting:y,dropped:b,bucketTotal:S}=FP({awards:w,pointComponents:m,bestOfCount:g,maxResultsPerLevel:I,mandatoryRules:v});d+=S,c.push({bucketName:f,countingResults:y.map(U=>U.award),droppedResults:b.map(U=>U.award),bucketTotal:S})}return{buckets:c,totalPoints:d}}let{counting:o,dropped:l,bucketTotal:u}=FP({awards:s,pointComponents:["points","qualityWinPoints"],bestOfCount:a||0,maxResultsPerLevel:n});return{buckets:[{bucketName:"All",countingResults:o.map(c=>c.award),droppedResults:l.map(c=>c.award),bucketTotal:u}],totalPoints:u}}var FZ={};pt(FZ,{applyTournamentRankingPoints:()=>LZ});function LZ({tournamentRecord:t,policyDefinitions:e,participantFilters:i,scaleName:r="RANKING_POINTS",level:n,removePriorValues:a}){if(!t)return{error:ge};let s=Ev({tournamentRecord:t,policyDefinitions:e,participantFilters:i,level:n});if(s.error)return s;let{personPoints:o,pairPoints:l,teamPoints:u}=s,c={};for(let f of t.participants||[])f.person?.personId&&(c[f.person.personId]=f.participantId);let d=t.endDate,p=0;for(let[f,h]of Object.entries(o)){let m=c[f];if(!m)continue;let g={};for(let I of h){let v=I.eventType||"SINGLES";g[v]||(g[v]=[]),g[v].push(I)}for(let[I,v]of Object.entries(g)){let w=v.reduce((b,S)=>b+(S.points||0)+(S.qualityWinPoints||0)+(S.linePoints||0),0),y=Pv({tournamentRecord:t,participantId:m,scaleItem:{scaleType:Iu,scaleName:r,eventType:I,scaleDate:d,scaleValue:{points:w,awards:v}},removePriorValues:a});if(y.error)return y;p++}}return{...H,personPoints:o,pairPoints:l,teamPoints:u,modificationsApplied:p}}var _Z={};pt(_Z,{getEntryStatusReports:()=>SMe,getParticipantStats:()=>wMe,getStructureReports:()=>TMe,getVenuesReport:()=>MMe});function wMe({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:s,matchUps:o}){if(!n)return{error:ge};if(o&&!Array.isArray(o))return{error:la};if(o=o??wr({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!o?.length)return{error:Ou};let l=[];e&&l.push(e),r&&l.push(r);let u=l.length?{participantIds:l}:{participantTypes:[jn]},c=Pi({participantFilters:u,tournamentRecord:n}).participants??[];if(!c.every(({participantType:U})=>U===jn))return{error:Sa};l.length||l.push(...c.map(bt));let d=new Map,p=new Map,f=new Map,h=new Map,m=(U,T="")=>p.get(U)||p.set(U,{participantName:T,participantId:U,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(U);for(let U of c){let{participantId:T,individualParticipantIds:D}=U;h.set(T,D??[]),m(T,U.participantName)}if(r&&!h.get(r))return z({result:{error:ji},context:{teamParticipantId:r}});if(e&&!h.get(e))return z({result:{error:ji},context:{opponentParticipantId:e}});let g=[],I=U=>{let T=[[],[]];for(let P of U){let E=P.participant;if(E?.participantName){d.set(E.participantId,{participantName:E.participantName,ratings:E.ratings});let R=p.get(E.participantId);R&&(R.participantName=E.participantName)}}let D=({side:P,individualParticipantIds:E})=>P.participantId&&(!E?.length||E.includes(P.participantId))&&[P.participantId]||P.participant?.individualParticipantIds?.length&&(!E?.length||Fi(E,P.participant?.individualParticipantIds).length===P.participant?.individualParticipantIds?.length)&&P.participant.individualParticipantIds;if(h.size){let P=(E,R)=>{for(let C of U){if(!C.participant)continue;let M=D({individualParticipantIds:R,side:C});if(M?.length){let N=C.sideNumber;if(!N)continue;let A=[E];i&&A.push(...M),T[N-1]=A;let O=p.get(E);for(let k of M.filter(Boolean))O&&!O.competitorIds.includes(k)&&O.competitorIds.push(k)}}};if(r)(!e||U.every(E=>E.participant&&(D({individualParticipantIds:h.get(r),side:E})||D({individualParticipantIds:h.get(e),side:E}))))&&P(r,h.get(r));else for(let[E,R]of h)P(E,R)}else if(i)for(let P of U){if(!P.participant)continue;let E=D({individualParticipantIds:[],side:P}),R=P.sideNumber;R&&(T[R-1]=E)}return T};for(let U of o){if(!St(U))return{error:la};let{matchUpStatus:T,matchUpFormat:D,matchUpType:P,winningSide:E,score:R,sides:C}=U;if(!C||!R||P===Va||T==="BYE")continue;let M=I(C);if(!M.filter(Boolean).length)continue;let N=t&&E&&SS({matchUp:U})?.competitiveness;g.push(U);let A=HL({matchUpStatus:T,matchUpFormat:D,tallyPolicy:s,winningSide:E,score:R}),O=d8({matchUpStatus:T,matchUpFormat:D,tallyPolicy:s,winningSide:E,score:R}),{pointsTally:k,tiebreaksTally:F}=p8({matchUpFormat:D,score:R});M.forEach((x,L)=>{for(let $ of x){let V=d.get($)?.participantName,_=m($,V);if(_){let B=(X,Z)=>Z.forEach((Q,ae)=>_[X][ae]+=Q),G=L?[...F].reverse():F,j=L?[...k].reverse():k,Y=L?[...O].reverse():O,K=L?[...A].reverse():A;if(B("tiebreaks",G),B("points",j),B("games",Y),B("sets",K),E){let X=E-1===L?0:1;_.matchUps[X]+=1}if(N){let X=N.toLowerCase();_.competitiveness[X]||(_.competitiveness[X]=[0,0]),_.competitiveness[X][L]+=1}if(T){let X=T.toLowerCase();_.matchUpStatuses[X]||(_.matchUpStatuses[X]=0),_.matchUpStatuses[X]+=1}}}})}let v=["tiebreaks","matchUps","points","games","sets"],w=["competitive","routine","decisive"],y=new Map,b=(U,T)=>(U??0)+(T??0);for(let[U,T]of p.entries()){for(let D of v){let P=T[D].reduce(b);if(P){let E=T[D][0]/P,R=`${D}Ratio`,C=parseFloat(E.toFixed(2));T[R]=C,f.set(U,!0),y.has(R)||y.set(R,[]),y.get(R)?.push(C)}}for(let D of w){let P=T.competitiveness?.[D]?.reduce(b);if(P){let E=T.competitiveness[D][0]/P,R=`${D}Ratio`,C=parseFloat(E.toFixed(2));T[R]=C}}}if(!r){let U=(T,D)=>D-T;for(let T of p.values())for(let D of v){let P=`${D}Ratio`;if(typeof T[P]=="number"){let E=y.get(P)?.sort(U).indexOf(T[P]);if(typeof E=="number"&&E>=0){let R=`${D}Rank`;T[R]=E+1}}}}let S={relevantMatchUps:g,...H};return r?(S.teamStats=p.get(r),e&&(S.opponentStats=p.get(e))):S.participatingTeamsCount=f.size,S.allParticipantStats=[...p.values()],S}function LP({participant:t,eventType:e}){let i=t?.person?.personId,r=t?.person?.personOtherIds?.[0],n=t?.person?.tennisId,a=t?.ratings?.[e]?.find(({scaleName:u})=>u==="WTN"),s=a?.scaleValue,{wtnRating:o,confidence:l}=s||{};return{timeStamp:a?.scaleDate,personOtherId:r,confidence:l,wtnRating:o,personId:i,tennisId:n}}function SMe({tournamentRecord:t}){if(!t)return{error:ge};let e=t.tournamentId,{participantMap:i}=Pi({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(wr({matchUpFilters:{matchUpTypes:[oh,Rp]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:f,matchUpType:h})=>f?.flatMap(m=>h===Rp?m?.participant?.individualParticipantIds:m?.participant?.participantId||m.participantId).filter(Boolean)).filter(Boolean),n=[],a={},s={},o={},l=0,u=({id:f,entry:h,eventId:m,eventType:g})=>{let{qualifyingSeeding:I,mainSeeding:v,entryStatus:w,entryStage:y,drawId:b}=h;a[f]||(a[f]=[]);let{participant:S,events:U}=i?.[f]??{},T=LP({participant:S,eventType:g}),D=U?.[m]?.ranking;w===m0&&n.push(f),a[f].push({participantType:S?.participantType,participantId:f,tournamentId:e,eventType:g,eventId:m,drawId:b,entryStatus:w,entryStage:y,...T,ranking:D,mainSeeding:v,qualifyingSeeding:I})};for(let f of t.events??[]){let h={},m=U=>{h[U]||(h[U]={count:0}),h[U].count+=1},{drawDefinitions:g=[],eventType:I,eventId:v}=f,w=g.flatMap(U=>{let{drawId:T,entries:D}=U;l+=1;let P=({stage:M,stageSequence:N})=>M===Fe&&N===1||M===We,E=(U.structures??[]).filter(P).flatMap(({positionAssignments:M})=>M).filter(Boolean).map(({participantId:M})=>M),R=({participantId:M})=>E.includes(M),C=M=>{let{participantId:N,entryStatus:A,entryStage:O}=M;m(A);let k=i?.[N]?.draws?.[T]?.seedAssignments?.[Fe];return{qualifyingSeeding:i?.[N]?.draws?.[T]?.seedAssignments?.[We],participantId:N,mainSeeding:k,entryStatus:A,entryStage:O,drawId:T}};return D?.filter(R).map(C)}),y=U=>{let T=U.participantId,D=i?.[T].participant.individualParticipantIds?.filter(P=>r.includes(P));return T&&{[T]:{individualParticipantIds:D}}};I===mc?(()=>{let U=Object.assign({},...w.map(y).filter(Boolean)),T=D=>{U[D.participantId].individualParticipantIds.forEach(P=>{u({id:P,eventType:I,eventId:v,entry:D})})};w.forEach(T)})():w.forEach(U=>{u({id:U?.participantId,eventType:I,eventId:v,entry:U})});let b=Object.values(h).reduce((U,T)=>U+T.count,0);Object.keys(h).forEach(U=>{h[U].pct=h[U].count/b*100}),o[v]={tournamentId:e,eventId:v,entries:w,entryStatuses:h};let S=Object.assign({},...co.flatMap(U=>[{[U+"_count"]:h[U]?.count},{[U+"_pct"]:h[U]?.pct}]));s[v]={tournamentId:e,eventId:v,...S}}let c=Object.values(i??{}).filter(({participant:{participantType:f,participantRole:h}})=>f===vt&&h===Xr),d=c.filter(({participant:f})=>!r.includes(f.participantId)).map(({participant:f})=>f.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(o).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(s).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(o).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function UMe({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=h=>{let m=h?.matchUpFormat;m&&(n[m]||(n[m]=0),n[m]+=1)},s=e.filter(h=>i?h.eventId===i:h.drawId===r).reduce((h,m)=>(a(m),(m.sides??[]).flatMap(g=>(g?.participant?.individualParticipants||[g?.participant]).filter(Boolean)).forEach(g=>h[g.participantId]=g),h),{}),o=Object.values(s),l=o.map(h=>LP({participant:h,eventType:t})).filter(({wtnRating:h})=>h),u=(o.length-l.length)/o.length*100,c=l.reduce((h,m)=>{let{wtnRating:g,confidence:I}=m;return h.totalWTN+=g,h.totalConfidence+=I,h},{totalWTN:0,totalConfidence:0}),d=l?.length?c.totalWTN/l.length:0,p=l?.length?c.totalConfidence/l.length:0,f=Object.values(n).reduce((h,m)=>h+(m||0),0);return{matchUpFormatCounts:n,matchUpsCount:f,avgConfidence:p,pctNoRating:u,avgWTN:d}}function TMe(t){let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:r,firstStageSequenceOnly:n=!0}=t;if(!e)return{error:tI};let a=[],s={},o={},l=[],u=g=>I=>I.structureId===g,c=Object.assign({},...(i??[]).map(({name:g,label:I,accessor:v})=>{let w=it({element:e,name:g})?.extension?.value,y=v?wp({element:w,accessor:v})?.value:w;return{[I??g]:y}})),d=e?.tournamentId,p=wr({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],f=g=>Ss({itemType:fL,itemSubTypes:[Jl],element:{timeItems:g}})?.timeItem?.itemValue?.scaleBasis,h=({positionManipulations:g})=>{g?.forEach(I=>{let{structureId:v,name:w}=I,y=I.drawPositions??[I.drawPosition];s[v]??=[],s[v].push(`${w}: ${y.join("/")}`)})},m=e?.events?.flatMap(({timeItems:g,drawDefinitions:I=[],extensions:v,eventType:w,eventName:y,eventId:b,category:S})=>{let U=v?.find(N=>N.name===eo)?.value?.flights?.map(N=>({[N.drawId]:N.flightNumber})),T=U&&Object.assign({},...U),D=v?.find(N=>N.name===yp),P=g?.find(N=>N.itemType===yp),E=D?.value?.length??P?.itemValue??0,R=Object.values(T??{}),C=T&&Math.min(...R),M=f(g);return o[b]={seedingBasis:M?JSON.stringify(M):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:E,tournamentId:d,eventId:b},I.filter(N=>!r||!U||T[N.drawId]===C).flatMap(N=>{let{matchUpFormat:A,tieFormat:O,timeItems:k,extensions:F,structures:x,drawName:L,drawType:$,drawId:V}=N,{matchUpFormatCounts:_,matchUpsCount:B,avgConfidence:G,pctNoRating:j,avgWTN:Y}=UMe({eventType:w,matchUps:p,drawId:V}),K=f(k)??M,X=DMe({extensions:F}),Z=X?.length??0;return h({positionManipulations:X}),o[b].totalPositionManipulations+=Z,o[b].generatedDrawsCount+=1,Z>o[b].maxPositionManipulations&&(o[b].maxPositionManipulations=Z),x?.filter(Q=>(Q.stageSequence===1||!n)&&[We,Fe,en,Ai].includes(Q.stage)).map(Q=>{let ae=[Fe,Ai].includes(Q.stage)?PMe(p,Q.structureId):void 0;Q.stage===Fe&&a.push({eventName:y,drawName:L,structureId:Q.structureId});let te=EMe(ae)?.participant,ne=RMe(te),le=CMe(te),de=LP({participant:le?.[0]??te,eventType:w}),{personId:pe,personOtherId:ve,tennisId:Me,confidence:Ee,wtnRating:Be}=de||{},fe=LP({participant:le?.[1],eventType:w}),{personId:Te,personOtherId:ce,tennisId:be,confidence:we,wtnRating:Ae}=fe||{},{ageCategoryCode:ye,categoryName:Ne,subType:he}=S??{},De=Q.matchUpFormat??A,Le=(_[De]??0)/B*100,{tieFormatName:J,tieFormatDesc:se}=MP(O),{tieFormatName:oe,tieFormatDesc:ue}=MP(Q.tieFormat),ee=se===ue,Se=!ee&&oe,Pe=Q.tieFormat&&!ee&&ue,st=X?.filter(u(Q.structureId))?.length??0;return{...c,tournamentId:d,eventId:b,structureId:Q.structureId,drawId:V,eventType:w,category:he,categoryName:Ne,ageCategoryCode:ye,flightNumber:T?.[V],drawType:$,stage:Q.stage,seedingBasis:K?JSON.stringify(K):void 0,winningPersonId:pe,winningPersonOtherId:ve,winningPersonTennisId:Me,winningPersonWTNrating:Be,winningPersonWTNconfidence:Ee,winningPerson2Id:Te,winningPerson2OtherId:ce,winningPerson2TennisId:be,winningPerson2WTNrating:Ae,winningPerson2WTNconfidence:we,winningTeamId:ne,positionManipulations:st,pctNoRating:j,matchUpFormat:De,pctInitialMatchUpFormat:Le,matchUpsCount:B,drawTieFormatName:J,drawTieFormatDesc:se,tieFormatName:Se,tieFormatDesc:Pe,avgConfidence:G,avgWTN:Y}})})});return a.forEach(({eventName:g,drawName:I,structureId:v})=>{s[v]?.length&&l.push({eventName:g,drawName:I,actions:s[v]})}),{eventStructureReports:Object.values(o),structureReports:m,flightReports:l}}function DMe({extensions:t}){return t?.find(({name:e})=>e===qg)?.value?.slice(1)}function PMe(t,e){return t.find(i=>i.structureId===e&&i.finishingRound===1&&i.winningSide)}function EMe(t){if(t?.sides)return t.sides.find(e=>e.sideNumber===t.winningSide)}function RMe(t){return t?.participantType===jn?t.participantId:void 0}function CMe(t){return t?.participantType===ht?t.individualParticipants??[]:[]}function MMe({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){if(!Array.isArray(n))return{error:ie,dates:n};if(!Array.isArray(r))return{error:ie,venueIds:r};if(!(e&&Object.keys(e).filter(c=>!i||c===i)||[]).length)return{error:Ri};if(!n.every(Cn))return{error:qi};let a=_u({tournamentRecords:e,ignoreDisabled:t,dates:n});if(a.error)return a;let s=a?.venues?.filter(({venueId:c})=>!r?.length||r.includes(c)),o=a.courts?.reduce((c,d)=>(d.dateAvailability?.forEach(p=>{let f=p.date;c.includes(f)||c.push(f)}),c),[]).filter(c=>!n.length||n.includes(c)),l={venueIds:s?.map(({venueId:c})=>c)},{matchUps:u}=Oo({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:s?.map(c=>NMe(o,c,u))}}function NMe(t,e,i){let{venueId:r,courts:n,venueName:a}=e,s={};return t.forEach(o=>{let l=0,u=0,c=0;for(let f of n){let h=f.dateAvailability.find(g=>g.date===o),m=(h&&kv({courtDate:h}).timeSlots)?.reduce((g,I)=>{let{startTime:v,endTime:w}=I,y=Mt(w)-Mt(v);return g+y},0);m&&(c+=1),l+=m}let d=i.filter(({schedule:f})=>f.venueId===r&&du(o,f.scheduledDate));d.forEach(({schedule:f})=>{let h=di(f.scheduledTime),m=ra(h,f.averageMinutes),g=Mt(m)-Mt(h);u+=g});let p=l?(u/l*100).toFixed(2):"100";s[o]={scheduledMatchUpsCount:d.length,availableCourts:c,availableMinutes:l,scheduledMinutes:u,percentUtilization:p}}),{venueId:r,venueName:a,venueReport:s}}var A$={};pt(A$,{addCourtGridBooking:()=>XZ,addMatchUpCourtOrder:()=>u$,addMatchUpEndTime:()=>d$,addMatchUpOfficial:()=>vQ,addMatchUpResumeTime:()=>f$,addMatchUpScheduleItems:()=>lM,addMatchUpScheduledDate:()=>sM,addMatchUpScheduledTime:()=>Xd,addMatchUpStartTime:()=>c$,addMatchUpStopTime:()=>p$,addSchedulingProfileRound:()=>P$,allocateTeamMatchUpCourts:()=>oM,assignMatchUpCourt:()=>xm,assignMatchUpVenue:()=>xv,bulkRescheduleMatchUps:()=>zZ,bulkScheduleMatchUps:()=>iU,bulkScheduleTournamentMatchUps:()=>Jb,bulkUpdateCourtAssignments:()=>jZ,calculateScheduleTimes:()=>k$,clearMatchUpSchedule:()=>YZ,clearScheduledMatchUps:()=>cM,courtGridRows:()=>WC,findMatchUpFormatTiming:()=>jC,findVenue:()=>po,generateBookings:()=>uM,generateVirtualCourts:()=>tM,getMatchUpsToSchedule:()=>VC,getPersonRequests:()=>vf,getProfileRounds:()=>HC,getScheduledRoundsDetails:()=>qS,getSchedulingProfile:()=>Wc,getSchedulingProfileIssues:()=>R_,matchUpScheduleChange:()=>qZ,modifyMatchUpFormatTiming:()=>q_,mutate:()=>$Z,proAutoSchedule:()=>VZ,proConflicts:()=>HZ,publicFindCourt:()=>$L,query:()=>gJ,removeCourtGridBooking:()=>JZ,removeEventMatchUpFormatTiming:()=>QC,removeMatchUpCourtAssignment:()=>BZ,reorderUpcomingMatchUps:()=>WZ,scheduleMatchUps:()=>GZ,scheduleProfileRounds:()=>dM,setMatchUpDailyLimits:()=>KZ,setMatchUpHomeParticipantId:()=>l$,setSchedulingProfile:()=>Rv,toggleParticipantCheckInState:()=>rM,validateSchedulingProfile:()=>GC});var $Z={};pt($Z,{addCourtGridBooking:()=>XZ,addMatchUpCourtOrder:()=>u$,addMatchUpEndTime:()=>d$,addMatchUpOfficial:()=>vQ,addMatchUpResumeTime:()=>f$,addMatchUpScheduleItems:()=>lM,addMatchUpScheduledDate:()=>sM,addMatchUpScheduledTime:()=>Xd,addMatchUpStartTime:()=>c$,addMatchUpStopTime:()=>p$,addSchedulingProfileRound:()=>P$,allocateTeamMatchUpCourts:()=>oM,assignMatchUpCourt:()=>xm,assignMatchUpVenue:()=>xv,bulkRescheduleMatchUps:()=>zZ,bulkScheduleMatchUps:()=>iU,bulkScheduleTournamentMatchUps:()=>Jb,bulkUpdateCourtAssignments:()=>jZ,calculateScheduleTimes:()=>k$,clearMatchUpSchedule:()=>YZ,clearScheduledMatchUps:()=>cM,findMatchUpFormatTiming:()=>jC,generateBookings:()=>uM,generateVirtualCourts:()=>tM,matchUpScheduleChange:()=>qZ,modifyMatchUpFormatTiming:()=>q_,proAutoSchedule:()=>VZ,proConflicts:()=>HZ,removeCourtGridBooking:()=>JZ,removeEventMatchUpFormatTiming:()=>QC,removeMatchUpCourtAssignment:()=>BZ,reorderUpcomingMatchUps:()=>WZ,scheduleMatchUps:()=>GZ,scheduleProfileRounds:()=>dM,setMatchUpDailyLimits:()=>KZ,setMatchUpHomeParticipantId:()=>l$,setSchedulingProfile:()=>Rv,toggleParticipantCheckInState:()=>rM,validateSchedulingProfile:()=>GC});function k$({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:s,scheduleDate:o,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:Ri};s=s??iM({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=_u({dates:[o],ignoreDisabled:!0,tournamentRecords:a}),f=d?.filter(P=>!u||u.includes(P.venueId));l||(l=f?.reduce((P,E)=>{let R=E.dateAvailability?.find(C=>!C.date||du(o,C.date))?.startTime??E.startTime;return R&&(!P||Mt(R)<Mt(P))?R:P},void 0)),c||(c=f?.reduce((P,E)=>{let R=E.dateAvailability?.find(C=>!C.date||du(o,C.date))?.endTime??E.endTime;return R&&(!P||Mt(R)>Mt(P))?R:P},void 0));let h=Object.values(a),m=Object.assign({},...h.map(P=>(P.events??[]).map(E=>{let{scheduleTiming:R}=hS({tournamentRecord:P,event:E});return{[E.eventId]:{event:E,scheduleTiming:R}}})).flat()),g=XS({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:o,venueIds:u}}),I=g?.dateMatchUps??[],v=g?.completedMatchUps??[],w=[];w.push(...I),w.push(...v);let y={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},b=w?.map(({eventId:P,schedule:E,matchUpFormat:R})=>{let{event:C,scheduleTiming:M}=m[P],N=C?.eventType,A={...M,defaultTiming:y,matchUpFormat:R},{averageMinutes:O,recoveryMinutes:k}=eC({eventType:N,timingDetails:A}),{courtId:F,venueId:x}=E,L=di(E.scheduledTime),$=ra(L,O);return{recoveryMinutes:k,averageMinutes:O,periodLength:s,startTime:L,endTime:$,courtId:F,venueId:x}}),S={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:o,clearScheduleDates:n,periodLength:s,startTime:l,endTime:c,bookings:b,courts:f},{scheduleTimes:U}=i$(S),T=u?.length===1&&u[0]||p?.length===1&&p[0].venueId||void 0,D=w.map(vr);return{venueId:T,scheduleTimes:U,dateScheduledMatchUpIds:D}}function BZ(t){let e=Ge(t,[{[dn]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:s,courtId:o,drawId:l}=t,u=r[n];if(!u)return{error:ge};let{drawDefinition:c,event:d}=Kd({tournamentRecord:u,drawId:l});if(!c)return{error:_e};let p=pi({drawDefinition:c,event:d,matchUpId:s});if(p.error)return p;if(p?.matchUp?.matchUpType===Va){let{itemValue:f}=mf({timeItems:p.matchUp.timeItems??[],itemType:vu}),h=o&&f.filter(m=>m.courtId!==o);return Ea({duplicateValues:!1,removePriorValues:i,tournamentRecord:u,drawDefinition:c,matchUpId:s,timeItem:{itemType:vu,itemValue:h}})}else return xm({tournamentRecord:u,drawDefinition:c,courtDayDate:a,courtId:"",matchUpId:s})}function VZ({scheduleCompletedMatchUps:t,minCourtGridRows:e=10,tournamentRecords:i,scheduledDate:r,matchUps:n}){if(!Ja(n))return{error:ie};if(n.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:gR};let a=XS({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:e,tournamentRecords:i,matchUpFilters:{localPerspective:!0,scheduledDate:r}});if(a.error)return a;let{rows:s}=a,o=[],l=h=>[(h.sides||[]).map(m=>[m.participantId,m.participant?.individualParticipantIds]),(h.potentialParticipants||[]).flat().map(m=>[m.participantId,m.individualParticipantIds])].flat(1/0).filter(Boolean),u=s?.reduce((h,m)=>{let g=[],I=[];Object.values(m).forEach(w=>{if(St(w)&&(w.matchUpId&&(g.push(w.matchUpId),o.push(w)),w.sides)){let y=l(w);I.push(...y)}});let v=Object.values(m).filter(w=>St(w)&&!w.matchUpId&&!w.isBlocked);return h.concat({matchUpIds:g,availableCourts:v,rowId:m.rowId,participantIds:I})},[]);n.filter(({matchUpStatus:h})=>h&&h!=="BYE"&&(t||!Ji.includes(h))).sort(Tm);let c=fo({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:i}).matchUpDependencies,d=[],p=[];for(;n.length&&u.length;){let h=u.shift(),m=[];for(;n.length&&h.availableCourts.length;){let g=n.concat(m).map(D=>D.matchUpId),I=n.shift(),v=I?.matchUpId,w=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),y=v&&g.some(D=>c[v].matchUpIds.includes(D)),b=v&&p.some(D=>c[v].dependentMatchUpIds.includes(D)),S=h.matchUpIds.some(D=>w.includes(D)),U=l(I),T=h.participantIds.some(D=>U.includes(D));if(I&&!S&&!y&&!T&&!b){let D=h.availableCourts.shift();Object.assign(I.schedule,D.schedule),Object.assign(D,I),d.push(I),h.participantIds.push(...U),h.matchUpIds.push(v)}else I&&m.push(I)}n.push(...m),p.push(...h.matchUpIds)}let f=d.map(({matchUpId:h,tournamentId:m,schedule:g,drawId:I})=>({tournamentId:m,matchUpId:h,drawId:I,schedule:{...g,scheduledDate:r}}));return a=iU({tournamentRecords:i,matchUpDetails:f}),{...a,scheduled:d,notScheduled:n}}function jZ(t){let{courtDayDate:e}=t,i=Ge(t,[{courtAssignments:!0,[Xn]:sn,[Ha]:Xe},{[dn]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,s)=>{let{tournamentId:o}=s;return a[o]||(a[o]=[]),a[o].push(s),a},{}),n;return Object.keys(r).every(a=>{let s=t[dn][a];if(!s)return n={error:ge},!1;let o=r[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(o).every(l=>{let{drawDefinition:u}=zn({tournamentRecord:s,drawId:l});return u?(o[l].every(c=>{let{matchUpId:d,courtId:p}=c,f=xm({tournamentRecord:s,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(f.success)return f?.success;n={error:uK}}),!0):(n={error:_e},!1)})}),n||H}function GZ(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:o={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:f=30,scheduleDate:h,matchUpIds:m,venueIds:g,startTime:I,endTime:v,dryRun:w}=t,y=Ge(t,[{[dn]:!0,[aS]:!0},{[qr]:Cn,[Ha]:qi,[qve]:!0},{[qr]:B=>!B||!isNaN(B),[Jve]:!1,[Ha]:ie,[Qve]:!1,[Zve]:!1}]);if(y.error)return y;let b=t.competitionMatchUps??Oo({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],S=t.matchUpDependencies??fo({includeParticipantDependencies:!0,matchUps:b,tournamentRecords:e}).matchUpDependencies;b.forEach(B=>{B.schedule?.scheduledDate&&du(h,Qe(B.schedule.scheduledDate))&&bI({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:B})});let U=m.map(B=>b.find(G=>G.matchUpId===B)).filter(Boolean),{venueId:T,scheduleTimes:D,dateScheduledMatchUpIds:P}=k$({tournamentRecords:e,remainingScheduleTimes:d,startTime:di(I),endTime:di(v),scheduleDate:Qe(h),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:f,venueIds:g}),E={},R=[],C={},M={},N={};b.filter(({matchUpId:B})=>P?.includes(B)).forEach(B=>{vx({matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUp:B,value:1});let G=B.schedule?.scheduledTime;if(G){C[B.matchUpId]=G;let j=a?.[B.matchUpId];Xb({recoveryMinutes:j||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:S,scheduleTime:G,matchUp:B})}});let A=U.filter(B=>{let G=P?.includes(B.matchUpId),j=["BYE",Zt,Oi,fs,jr,mi].includes(B?.matchUpStatus);return!G&&!B.winningSide&&!j}),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:F}=A.reduce((B,G)=>{let{drawId:j,tournamentId:Y,matchUpType:K}=G,{participantIdsAtLimit:X,relevantParticipantIds:Z}=S$({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,matchUpDailyLimits:u,matchUp:G});return X?.length?(B.overLimitMatchUpIds.push(G.matchUpId),B.participantIdsAtLimit.push(...X),B):(Z.forEach(Q=>{eU({individualParticipantProfiles:o,participantId:Q});let ae=o[Q].counters;ae[K]?ae[K]+=1:ae[K]=1,ae[Vs]?ae[Vs]+=1:ae[Vs]=1}),B.matchUpMap[Y]||(B.matchUpMap[Y]={}),B.matchUpMap[Y][j]?B.matchUpMap[Y][j].push(G):B.matchUpMap[Y][j]=[G],bI({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:G}),B)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});A=A.filter(({matchUpId:B})=>!k.includes(B));let x=0,L=D?.length??0,{personRequests:$}=vf({tournamentRecords:e,requestType:tU});for(;D?.length&&A.length&&x<=L;){x++;let{scheduleTime:B}=D.shift(),G=A.find(j=>{let{matchUpId:Y}=j,{dependenciesScheduled:K,remainingDependencies:X}=y$({matchUpScheduleTimes:C,matchUpDependencies:S,allDateMatchUpIds:i,matchUp:j});if(!K)return N[Y]||(N[Y]=[]),N[Y].push({scheduleTime:B,remainingDependencies:X}),!1;let{enoughTime:Z}=w$({individualParticipantProfiles:o,matchUpNotBeforeTimes:l,matchUpDependencies:S,scheduleTime:B,matchUp:j});if(!Z)return M[Y]||(M[Y]=[]),M[Y].push({scheduleTime:B}),!1;let{conflicts:Q}=b$({potentials:c,averageMatchUpMinutes:r,requestConflicts:E,personRequests:$,scheduleTime:B,scheduleDate:h,matchUp:j});if(Q?.length)return!1;let ae=a?.[j.matchUpId];return Xb({recoveryMinutes:ae||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:S,scheduleTime:B,matchUp:j}),C[j.matchUpId]=B,!0});A=A.filter(({matchUpId:j})=>j!==G?.matchUpId),G||R.push(B)}A.forEach(B=>{vx({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,value:-1,matchUp:B})});let V=[];Object.keys(O).forEach(B=>{let G=e[B];G&&Object.keys(O[B]).forEach(j=>{let{drawDefinition:Y}=Kd({tournamentRecord:G,drawId:j});Y&&O[B][j].forEach(({matchUpId:K})=>{let X=C[K];if(X){let Z=X.split(":").map(os).join(":"),Q=`${Qe(h)}T${Z}`;w?V.push(K):(Xd({drawDefinition:Y,matchUpId:K,scheduledTime:Q}).success&&V.push(K),T&&xv({tournamentRecords:e,tournamentRecord:G,drawDefinition:Y,matchUpId:K,venueId:T}))}})})});let _=uL(A);return{...H,requestConflicts:Object.values(E),remainingScheduleTimes:D?.map(({scheduleTime:B})=>B),individualParticipantProfiles:o,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:R,overLimitMatchUpIds:k,scheduledMatchUpIds:V,noTimeMatchUpIds:_,recoveryTimeDeferred:M,dependencyDeferred:N}}function HZ({useDeepDependencies:t=!1,tournamentRecords:e,matchUps:i}){if(!Ja(i))return{error:Ou};if(i.some(({matchUpId:b,hasContext:S})=>b&&!S))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:gR};let r=Math.max(...i.map(({schedule:b})=>b?.courtOrder||1).map(b=>Ye(b))),n=Re(1,r+1).map(b=>i.filter(S=>Ye(S.schedule?.courtOrder)===b)),a={},s={},o={};n.flat().filter(Boolean).sort(Tm).forEach(({schedule:b})=>delete b[vD]);let l=ot(i.map(({drawId:b})=>b)),u=fo({includeParticipantDependencies:!0,tournamentRecords:e,drawIds:l}),c=u.matchUpDependencies,d=t?u.positionDependencies??{}:{},p=n.map((b,S)=>b.reduce((U,T)=>{if(!T.matchUpId)return U;let{matchUpId:D,winnerMatchUpId:P,loserMatchUpId:E,schedule:R,sides:C,potentialParticipants:M}=T,N=R?.courtId;a[D]=S,s[N]=[],U.matchUpIds.push(D),o[D]=T;let A=c[D].matchUpIds;A.length&&U.sourceMatchUpIds.push(...A);let O=C?.flatMap(F=>[F.participant?.individualParticipantIds,F.participantId]).flat().filter(Boolean)??[],k=M?.flat().flatMap(({individualParticipantIds:F,participantId:x})=>[F,x]).flat().filter(Boolean)||[];return U.participantIds.push(...k,...O),P&&U.targetMatchUpIds.push(P),E&&U.targetMatchUpIds.push(E),U},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),f=(b,S)=>c[b].sources.reduce((U,T,D)=>T.includes(S)&&D+1||U,0),h=p.map(()=>[]),m=(b,S,U)=>{U[b]||(U[b]={}),U[b][Vl]||(U[b][Vl]=S.filter(T=>T!==b))},g=(b,S,U)=>{S.participantIds.filter(T=>b.participantIds.includes(T)).forEach(T=>{let D=S.matchUpIds.concat(b.matchUpIds).filter(P=>c[P].participantIds.includes(T));D.forEach(P=>{m(P,D,U)})})},I=(b,S,U)=>{U[b]||(U[b]={}),U[b][Bl]||(U[b][Bl]=S.filter(T=>T!==b))},v=b=>{let S={},U=Ta(b.participantIds),T=new Set(Object.keys(U).filter(P=>U[P]>1)),D=b.matchUpIds.filter(P=>c[P].participantIds.some(E=>T.has(E)));return D.forEach(P=>{I(P,D,S)}),S},w=b=>{let S={},U={};return b.forEach(T=>{let{matchUpId:D,schedule:P}=T;if(!D||!P?.courtId||!P?.scheduledDate)return;let E=`${P.courtId}|${P.scheduledDate}`;U[E]||(U[E]=[]),U[E].push(D)}),Object.values(U).forEach(T=>{T.length>1&&T.forEach(D=>{S[D]=T.filter(P=>P!==D)})}),S},y=(b,S,U,T)=>{if(!o[b].schedule[vD]){o[b].schedule[vD]=S,o[b].schedule[q7]=T,h[a[b]].push({matchUpId:b,issueType:U,issueIds:T,issue:S});let D=o[b].schedule.courtId;s[D]||(s[D]=[]),s[D].push({matchUpId:b,issue:S,issueType:U,issueIds:T})}};if(p.forEach((b,S)=>{let U=S?p[S-1]:void 0,T=p.slice(S+1),D=v(b),P=w(n[S].filter(E=>b.matchUpIds.includes(E.matchUpId)));U&&g(U,b,D),b.matchUpIds.forEach(E=>{let R=c[E].matchUpIds;for(let M of T){let N=M.matchUpIds.filter(A=>R.includes(A));N?.length&&(N.forEach(A=>y(A,Oy,as,[E])),y(E,Oy,as,N))}if(P[E]&&y(E,Bl,W7,P[E]),D[E]?.[Bl]&&y(E,Bl,WO,D[E][Bl]),b.sourceMatchUpIds.includes(E)){let M=b.matchUpIds.filter(N=>c[N].matchUpIds.includes(E));y(E,Bl,as,M),b.matchUpIds.filter(N=>c[N].matchUpIds.includes(E)).forEach(N=>y(N,Bl,as,[E]))}let C=U?.matchUpIds?.filter(M=>f(E,M)>1);if(C?.length&&(y(E,xy,as,C),C.forEach(M=>y(M,xy,as,[E]))),D[E]?.[Vl]&&y(E,Vl,WO,D[E][Vl]),U?.targetMatchUpIds?.includes(E)){let M=o[E].schedule.courtId,N=R.filter(A=>U.matchUpIds.includes(A));N.some(A=>o[A].schedule.courtId===M)||(N.forEach(A=>y(A,Vl,as,[E])),y(E,Vl,as,N))}})}),t){let b=new Set(Object.keys(a)),S={};for(let D of b)S[D]=new Set(c[D]?.dependentMatchUpIds??[]);let U=0;for(let D of b){let P=c[D]?.sources?.length??0;P>U&&(U=P)}let T=D=>{let P=new Set(D.participantIds),E={};for(let R of D.matchUpIds){let C=c[R]?.participantIds??[];for(let M of C)P.has(M)||(E[M]||(E[M]=new Set),E[M].add(R))}return E};if(p.forEach((D,P)=>{let E=T(D);for(let[,R]of Object.entries(E))if(R.size>1){let C=[...R];for(let M of C)y(M,Vl,zO,C.filter(N=>N!==M))}if(P>0){let R=p[P-1],C=T(R);for(let[M,N]of Object.entries(E))if(C[M]){let A=[...new Set([...N,...C[M]])];for(let O of A)y(O,Vl,zO,A.filter(k=>k!==O))}}}),p.forEach((D,P)=>{for(let E of D.matchUpIds)for(let R=2;R<=Math.min(P,U);R++){let C=p[P-R];for(let M of C.matchUpIds){let N=f(E,M);N>0&&R<N&&(y(E,xy,as,[M]),y(M,xy,as,[E]))}}}),p.forEach((D,P)=>{for(let E of D.matchUpIds){let R=S[E];if(!R?.size)continue;for(let M=0;M<P;M++){let N=p[M].matchUpIds.filter(A=>R.has(A));if(N.length){for(let A of N)y(A,Oy,as,[E]);y(E,Oy,as,N)}}let C=D.matchUpIds.filter(M=>M!==E&&R.has(M));if(C.length){for(let M of C)y(M,Bl,as,[E]);y(E,Bl,as,C)}}}),Object.keys(d).length){let D=new Set(Object.values(d).flat());p.forEach(P=>{for(let E of P.matchUpIds){let R=(c[E]?.matchUpIds??[]).filter(C=>D.has(C)).filter(C=>!b.has(C));R.length&&y(E,Vl,z7,R)}})}}return{courtIssues:s,rowIssues:h}}function WZ(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return z({result:{error:Ri},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return z({result:{error:Xe},stack:e});let a=r?.length;if(!a)return{...H};let s=0;return r.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,f=u+(n?-1:1);f<0&&(f=a-1),f===a&&(f=0);let h=r[f].schedule.scheduledTime,m=o({tournamentId:c,scheduledTime:h,matchUpId:p,drawId:d});if(m.success)s++;else return m}),s===a?H:z({result:{error:lK},stack:e});function o({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:f}=Kd({tournamentRecord:p,drawId:d});return f?Xd({drawDefinition:f,scheduledTime:u,matchUpId:c}):{error:ja}}}function zZ(t){let{scheduleChange:e,matchUpIds:i,dryRun:r}=t;if(!i||!Array.isArray(i))return{error:um};if(typeof e!="object")return{error:ie};let n=ws(t),a=[],s=[];for(let l of Object.values(n)){let u=AMe({tournamentRecord:l,scheduleChange:e,matchUpIds:i,dryRun:r});if(u.error)return u;Array.isArray(u.notRescheduled)&&s.push(...u.notRescheduled);let c=uL(u.notRescheduled),d=[];u.rescheduled?.forEach(p=>{let{matchUpId:f}=p;c.includes(f)&&d.push(f),a.push(p)}),d.length&&(s=u?.notRescheduled?.filter(({matchUpId:p})=>!d.includes(p))||[])}let o=!!(a.length&&!s.length);return{...H,rescheduled:a,notRescheduled:s,allRescheduled:o}}function AMe({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){if(!t)return{error:ge};if(!i||!Array.isArray(i))return{error:um};if(typeof e!="object")return{error:ie};let n=[],a=[],{minutesChange:s,daysChange:o}=e;if(!s&&!o)return{...H};if(s&&isNaN(s))return{error:ie};if(o&&isNaN(o))return{error:ie};let{matchUps:l}=wr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:y})=>!Ji.includes(y),c=l?.filter(y=>KS({schedule:y.schedule})).filter(y=>u({matchUpStatus:y.matchUpStatus}));if(!c?.length)return{...H};let{tournamentInfo:d}=Am({tournamentRecord:t}),{startDate:p,endDate:f}=d,h=c?.reduce((y,b)=>{let{matchUpId:S,drawId:U}=b;return y[U]?y[U].push(S):y[U]=[S],y},{}),m=1440;for(let y of Object.keys(h)){let b=Kd({tournamentRecord:t,drawId:y});if(b.error)return b;let S=b.drawDefinition,U=h[y].filter(T=>i.includes(T));for(let T of U)if(T&&S){let D=c.find(N=>N.matchUpId===T)?.schedule,{scheduledTime:P,scheduledDate:E}=D,R,C,M;if(!R&&o&&E){let N=Qe(E);M=ky(N,o),R=new Date(M)<new Date(p)||new Date(M)>new Date(f)}if(s&&P){let N=Qe(P),A=Mt(di(P))+s;if(R=A<0||A>m,!R){let O=ra(P,s),k=N&&M||E===N&&N;C=k?`${k}T${O}`:O}}if(R)a.push(T);else{if(!r){if(C){let N=Xd({scheduledTime:C,drawDefinition:S,matchUpId:T});if(N.error)return N}if(M){let N=sM({scheduledDate:M,drawDefinition:S,matchUpId:T});if(N.error)return N}}(C||M)&&n.push(T)}}}let g=wr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],I=g.filter(({matchUpId:y})=>n.includes(y)),v=g.filter(({matchUpId:y})=>a.includes(y)),w=I.length&&!v.length;return{...H,rescheduled:I,notRescheduled:v,allRescheduled:w}}function qZ(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Ri};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:s,courtDayDate:o}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=r||{},{drawId:d,matchUpId:p,tournamentId:f}=n||{};if(!u&&!p)return z({result:{error:Xe},stack:e});let{matchUps:h}=Oo({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=h?.find(({matchUpId:y})=>y===u),g=h?.find(({matchUpId:y})=>y===p),I=0;if(s&&u&&!p){let y=v({tournamentId:c,matchUpId:u,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y?.success&&I++,y.error)return z({result:y,stack:e})}else if(a&&s&&u&&p){let y=v({tournamentId:c,matchUpId:u,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y.success&&I++,y.error)return z({result:y,stack:e,info:"source"});let b=v({tournamentId:f,sourceCourtId:s,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:o});if(b.success&&I++,b.error)return z({result:b,stack:e,info:"target"})}else return{error:Xe};return I?H:z({result:{error:uv},stack:e});function v(y){let{tournamentRecords:b,tournamentId:S,matchUp:U,drawId:T}=y,D=b[S],{drawDefinition:P}=Kd({tournamentRecord:D,drawId:T});return U.matchUpType===ei?w({...y,tournamentRecord:D,drawDefinition:P}):xm({...y,tournamentRecord:D,drawDefinition:P})}function w({removePriorValues:y,tournamentRecords:b,tournamentRecord:S,drawDefinition:U,sourceCourtId:T,courtDayDate:D,matchUpId:P,matchUp:E,courtId:R}){let C=[R].concat(E.schedule.allocatedCourts.map(({courtId:M})=>M).filter(M=>M!==T));return oM({removePriorValues:y,tournamentRecords:b,tournamentRecord:S,drawDefinition:U,courtDayDate:D,matchUpId:P,courtIds:C})}}function YZ({scheduleAttributes:t=[vu,Ud,bm,wm,Sm,wo,Uc,Ql,oc],tournamentRecord:e,drawDefinition:i,matchUpId:r}){let n="clearMatchUpSchedule",a=i?Nn({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps?.[0]:wr({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps?.[0];if(!a)return{error:cn};let s=(a.timeItems??[]).filter(o=>o?.itemType&&!t.includes(o?.itemType));return a.timeItems=s,Tt({tournamentId:e.tournamentId,context:n,drawDefinition:i,matchUp:a}),{...H}}function KZ(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:Ri};if(typeof r!="object")return{error:_c};let a=Object.keys(n).filter(s=>!i||i===s);if(i&&!a.includes(i))return{error:ie};for(let s of a){let o=n[s],l=gt({extension:{name:lS,value:{dailyLimits:r}},element:o});if(l.error)return l}return{...H}}function XZ(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,bookingType:n,courtOrder:a,rowCount:s=1,courtId:o,notes:l}=t;if(!e)return z({result:{error:ie},info:"tournamentRecord is required"});if(!o)return{error:fc};if(!r)return z({result:{error:ie},info:"scheduledDate is required"});if(!n)return z({result:{error:ie},info:"bookingType is required"});if(a==null)return z({result:{error:ie},info:"courtOrder is required"});if(!Number.isInteger(a)||a<1)return z({result:{error:ie},info:"courtOrder must be a positive integer"});if(!Number.isInteger(s)||s<1)return z({result:{error:ie},info:"rowCount must be a positive integer"});let{court:u,venue:c}=Yd({tournamentRecord:e,courtId:o});if(!u)return{error:fc};if(!Pd({court:u,date:r})){u.dateAvailability||(u.dateAvailability=[]);let f={date:r,bookings:[]};u.dateAvailability.push(f)}let d=Pd({court:u,date:r});if(d.bookings){for(let f of d.bookings)if(typeof f.courtOrder=="number"){let h=f.courtOrder,m=h+(f.rowCount||1)-1,g=a,I=a+s-1;if(g<=m&&I>=h)return z({result:{error:tK},info:`Booking conflicts with existing booking at rows ${h}-${m}`})}}let p={courtOrder:a,rowCount:s,bookingType:n,notes:l,createdAt:new Date().toISOString()};return d.bookings||(d.bookings=[]),d.bookings.push(p),!i&&c&&nt({payload:{venue:c,tournamentId:e.tournamentId},topic:Vc,key:c.venueId}),{...H,booking:p}}function JZ(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,courtOrder:n,courtId:a}=t;if(!e)return z({result:{error:ie},info:"tournamentRecord is required"});if(!a)return{error:fc};if(!r)return z({result:{error:ie},info:"scheduledDate is required"});if(n==null)return z({result:{error:ie},info:"courtOrder is required"});let{court:s,venue:o}=Yd({tournamentRecord:e,courtId:a});if(!s)return{error:fc};let l=Pd({court:s,date:r});if(!l?.bookings)return z({result:{error:NO},info:"No bookings found for this date"});let u=l.bookings.findIndex(d=>d.courtOrder===n);if(u===-1)return z({result:{error:NO},info:`No booking found at row ${n}`});let c=l.bookings.splice(u,1)[0];return!i&&o&&nt({payload:{venue:o,tournamentId:e.tournamentId},topic:Vc,key:o.venueId}),{...H,booking:c}}var QZ={};pt(QZ,{addCollectionDefinition:()=>F$,addCollectionGroup:()=>nee,aggregateTieFormats:()=>see,compareTieFormats:()=>Tc,getTieFormat:()=>BC,modifyCollectionDefinition:()=>O$,modifyTieFormat:()=>aee,mutate:()=>ZZ,orderCollectionDefinitions:()=>iee,query:()=>fJ,removeCollectionDefinition:()=>x$,removeCollectionGroup:()=>tee,tieFormatGenderValidityCheck:()=>TR,validateCollectionDefinition:()=>eS});var ZZ={};pt(ZZ,{addCollectionDefinition:()=>F$,addCollectionGroup:()=>nee,aggregateTieFormats:()=>see,modifyCollectionDefinition:()=>O$,modifyTieFormat:()=>aee,orderCollectionDefinitions:()=>iee,removeCollectionDefinition:()=>x$,removeCollectionGroup:()=>tee});function jp({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:s}){let o="getTieFormat",l;if(e=r?.structureId??e,i=n?.matchUpId??i,(i||e)&&!t)return{error:_e};if(a&&s)l=zo(s);else if(i){if(t&&(!n||!r)){let u=pi({drawDefinition:t,matchUpId:i});if(u.error)return u;if(u.matchUp?.matchUpType!==Va)return z({result:{error:la},stack:o});r||(r=u.structure),n||(n=u.matchUp)}l=Qy({item:n,drawDefinition:t,structure:r,event:s})||Qy({item:r,drawDefinition:t,structure:r,event:s})||zo(t)||zo(s)}else if(t&&e){if(!r){let u=et({drawDefinition:t,structureId:e});if(u.error)return u;r=u?.structure}l=Qy({item:r,drawDefinition:t,structure:r,event:s})||zo(t)||zo(s)}else l=zo(t)||zo(s);return l?{...H,structure:r,tieFormat:l,matchUp:n}:z({result:{error:ov},stack:o})}function _P({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![Ji].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==uo&&!dr(t))}function gk({from:t,to:e}){let i=Object.keys(t),r=Fi(i,Object.keys(e)).length===i.length,n=i.filter(s=>t[s]!==e[s]).map(s=>({countChange:e[s]-t[s],collectionId:s})),a=i.every(s=>t[s]===e[s]);return{equivalent:r&&a,matchUpsCountChanges:n}}function kMe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:s,event:o,uuids:l}){let u="updateTieFormat",c=e?.tournamentId,d=0,p=0,f=0,h=0,m=n?.collectionDefinitions.reduce((S,U)=>(S[U.collectionId]=(S[U.collectionId]||0)+U.matchUpCount,S),{}),g=({tieFormat:S})=>{let U=S?.collectionDefinitions.reduce((T,D)=>(T[D.collectionId]=(T[D.collectionId]||0)+D.matchUpCount,T),{});return gk({from:U,to:m}).equivalent},I=jp({drawDefinition:i})?.tieFormat,v=jp({event:o})?.tieFormat;if(o&&a){for(let S of o.drawDefinitions??[])w({drawDefinition:S});o.tieFormat=Wr(n),h+=1}else if(s){if(!s.tieMatchUps)return z({result:{error:la},stack:u});let S=Ta(s.tieMatchUps?.map(({collectionId:E})=>E)),U=gk({to:m,from:S}),{changes:T,changesArePossible:D,cannotChangeReaon:P}=Mz({matchUp:s,check:U});if(U.equivalent)if(_P({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=Wr(n),h+=1;else return z({result:{error:v1},info:"matchUp is IN_PROGRESS or COMPLETE",stack:u});else if(D)b({tieFormat:n,matchUp:s,changes:T,uuids:l});else return z({context:{collectionMap:m,matchUpMap:S},result:{error:Kl},info:P||"specified changes not possible",stack:u});p+=1,Tt({eventId:o?.eventId,context:u,drawDefinition:i,tournamentId:c,matchUp:s})}else if(r){let S=y({inheritedTieFormat:I??v,structure:r})?.modifiedMatchUpsCount;S&&(p+=S,d+=1,h+=1);let U=!r.tieFormat||Tc({ancestor:r.tieFormat,descendant:n}).different;U&&(r.tieFormat=Wr(n),d+=1,h+=1),(S||U)&&i&&ii({structureIds:[r.structureId],eventId:o?.eventId,drawDefinition:i})}else if(i)w({drawDefinition:i}),i.tieFormat=Wr(n),h+=1;else return{error:_e};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:f,modifiedCount:h,...H,tieFormat:n};function w({drawDefinition:S}){let U=S.structures||[],T=[];for(let D of U){if(D.tieFormat)continue;let P=y({inheritedTieFormat:v,structure:D})?.modifiedMatchUpsCount;if(P){d+=1,p+=P;let E=D.structureId;T.push(E)}}return ii({structureIds:T,eventId:o?.eventId,drawDefinition:S}),T.length}function y({inheritedTieFormat:S,structure:U}){let T=0,D=kt({matchUpFilters:{matchUpTypes:[ei]},structure:U})?.matchUps||[];for(let P of D){let E=_P({matchUp:P,updateInProgressMatchUps:t}),R=!1,C=Ta(P.tieMatchUps?.map(({collectionId:N})=>N)),M=gk({from:C,to:m});if(M.equivalent)P.tieFormat&&g(P)&&E&&(P.tieFormat=Wr(n),R=!0);else{let{changes:N,changesArePossible:A}=Mz({matchUp:P,check:M});if(A&&!P.tieFormat)b({changes:N,matchUp:P,tieFormat:n,uuids:l});else if(S)(!P.tieFormat||Tc({ancestor:S,descendant:P.tieFormat}).different)&&(P.tieFormat=S,R=!0);else return z({result:{error:ov},stack:u})}R&&(T+=1,Tt({tournamentId:e?.tournamentId,drawDefinition:i,context:u,eventId:a,matchUp:P}))}return{modifiedMatchUpsCount:T}}function b({uuids:S,matchUp:U,tieFormat:T,changes:D}){U.tieFormat=Wr(T);let P=[],E=[];return D.forEach(R=>{if(R.countChange>0){let C=Math.max(0,...U.tieMatchUps.filter(A=>A.collectionId===R.collectionId).map(Pa("collectionPosition"))),M=T.collectionDefinitions.find(A=>A.collectionId===R.collectionId),N=FS({matchUpsLimit:R.countChange,collectionPositionOffset:C,collectionDefinition:M,matchUp:U,uuids:S});E.push(...Oe(N,!1,!0)),f+=E.length,U.tieMatchUps.push(...N)}else{let C=R.toBePlayedTieMatchUpIds.slice(0,Math.abs(R.countChange));console.log("remove",C.length),P.push(...C),U.tieMatchUps=U.tieMatchUps.filter(({matchUpId:M})=>!C.includes(M))}}),E.length&&wd({matchUps:E,drawDefinition:i,tournamentId:c,eventId:a}),P.length&&Fu({matchUpIds:P,action:"updateTieFormat",drawDefinition:i,tournamentId:c,eventId:a}),{matchUpIdsRemoved:P,matchUpsAdded:E}}}function Mz({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let s=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===Li).map(Pa("matchUpId")),o=s.length+a>=0||a>0;return!o&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:s,collectionId:n,countChange:a}),o}),changes:r,cannotChangeReaon:i}}function gM({appliedPolicies:t,drawDefinition:e,auditData:i}){if(!t?.audit?.[Xy])return;let{extension:r}=it({name:Xy,element:e}),n={value:Array.isArray(r?.value)?r?.value.concat(i):[i],name:Xy};gt({element:e,extension:n})}function O$({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:s,matchUpCount:o,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:f,gender:h,event:m,collectionValueProfiles:g,collectionValue:I,matchUpValue:v,scoreValue:w,setValue:y}){let b="modifyCollectionDefinition";if(s&&!Ga({matchUpFormat:s}))return z({result:{error:ie},context:{matchUpFormat:s},stack:b});if(r&&typeof r!="string")return z({result:{error:ie},context:{collectionName:r},stack:b});if(h&&!Object.values(UR).includes(h))return z({result:{error:ie},context:{gender:h},stack:b});if(p&&typeof p!="object")return z({result:{error:ie},context:{category:p},stack:b});let S={collectionValueProfiles:g,collectionValue:I,matchUpValue:v,scoreValue:w,setValue:y};if(!Object.values(S).filter(Boolean).length&&!i&&!r&&!s&&!o&&!u)return z({result:{error:Xe},stack:b});if(Object.values(S).filter(Boolean).length>1)return z({info:"Only one value assignment allowed per collectionDefinition",result:{error:ie},stack:b});let U=jp({drawDefinition:a,structureId:c,matchUpId:d,eventId:f,event:m});if(U.error)return z({result:U,stack:b});let{matchUp:T,structure:D,tieFormat:P}=U,E=Wr(P),R=P?.collectionDefinitions.find(V=>V.collectionId===l),C=E?.collectionDefinitions.find(V=>V.collectionId===l);if(!R)return z({info:"source collectionDefinition",result:{error:Vr},context:{collectionId:l},stack:b});let M=I??v??w??y;if(g?.length){let V=r4({matchUpCount:o??R?.matchUpCount??0,collectionValueProfiles:g});if(V.errors)return z({result:{error:ie},info:V.errors,stack:b})}else if(M&&!ut(M))return z({result:{error:ie},info:"value is not an integer",context:{value:M},stack:b});let N=(V,_)=>Fi(Object.keys(V),Object.keys(_)).length===Object.keys(V).length&&Fi(Object.values(V),Object.values(_)).length===Object.values(V).length,A=g&&(!R.collectionValueProfiles||!N(R.collectionValueProfiles,g)),O=ut(I)&&R.collectionValue!==I||ut(v)&&R.matchUpValue!==v||ut(w)&&R.scoreValue!==w||ut(y)&&R.setValue!==y||A,k=[];if(O&&(C.collectionValueProfiles=void 0,C.collectionValue=void 0,C.matchUpValue=void 0,C.scoreValue=void 0,C.setValue=void 0,Object.assign(C,S),k.push({collectionId:l,...Ve(S)})),(ut(w)||ut(y))&&C.collectionGroupNumber){let V=C.collectionGroupNumber;E.collectionDefinitions=E.collectionDefinitions.map(_=>{let{collectionGroupNumber:B,...G}=_;return B===V?G:_}),E.collectionGroups=E.collectionGroups.filter(({groupNumber:_})=>_!==V),k.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:F,valueGoal:x}=Om(E),L=Ve({aggregateValue:F,valueGoal:x});if((L.aggregateValue!==P?.winCriteria.aggregateValue||L.valueGoal!==P?.winCriteria.valueGoal)&&(E.winCriteria=L,k.push({collectionId:l,winCriteria:L})),ut(i)&&R.collectionOrder!==i&&(C.collectionOrder=i,k.push({collectionId:l,collectionOrder:i})),r&&R.collectionName!==r&&(C.collectionName=r,k.push({collectionId:l,collectionName:r})),s&&R.matchUpFormat!==s&&(C.matchUpFormat=s,k.push({collectionId:l,matchUpFormat:s})),ut(o)&&R.matchUpCount!==o&&(C.matchUpCount=o,k.push({collectionId:l,matchUpCount:o})),u&&R.matchUpType!==u)return z({result:{error:C1},context:{matchUpType:u},stack:b});p&&R.category!==p&&(C.category=p,k.push({collectionId:l,category:p})),h&&R.gender!==h&&(C.gender=h,k.push({collectionId:l,gender:h}));let $=Ve(E);if(U=Hn({tieFormat:$}),U.error)return z({result:U,stack:b});if(!k.length)return z({result:{...H,modifications:k}});if(P?.tieFormatName!==n?($.tieFormatName=n,k.push({tieFormatName:n})):k.length&&(delete $.tieFormatName,k.push("tieFormatName removed: modifications without new tieFormatName")),U=kMe({tieFormat:$,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:D,eventId:f,matchUp:T,event:m}),!U.error){let{appliedPolicies:V}=Rt({tournamentRecord:e}),_=Ve({collectionDefinition:C,drawId:a?.drawId,action:b,structureId:c,matchUpId:d,eventId:f});gM({appliedPolicies:V,drawDefinition:a,auditData:_})}return z({result:{...U,modifications:k},stack:b})}function OMe({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){let s=[];return n&&a?s=[a]:i&&r?s=kt({matchUpFilters:{matchUpTypes:[ei]},structure:r})?.matchUps??[]:e&&(s=Nn({matchUpFilters:{matchUpTypes:[ei]},drawDefinition:e})?.matchUps??[]),{targetMatchUps:s.filter(o=>!o.winningSide&&o.matchUpStatus!==Oi&&(t||o.matchUpStatus!==uo&&!dr(o)))}}function xMe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let s of r){let o=!!s.tieFormat;o&&(s.tieFormat=Wr(n));let l;if(t){let u=Rt({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=Hc({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}o&&!l&&Tt({tournamentId:e?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:s,drawDefinition:i})}return{...H}}function eee({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:s,structure:o,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:f,valueGoal:h}=Om(l);l.winCriteria=Ve({aggregateValue:f,valueGoal:h}),(e&&e!==h||f&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:m}=OMe({updateInProgressMatchUps:t,drawDefinition:a,structureId:s,structure:o,matchUpId:u,matchUp:c});xMe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let g=Ve(l),I=Hn({tieFormat:g});if(I.error)return I;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(o)o.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:_e};return ii({drawDefinition:a,eventId:p?.eventId}),{...H}}function tee({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:s,matchUp:o,eventId:l,event:u}){if(!e)return{error:Xe};if(isNaN(e))return{error:ie};let c="removeCollectionGroup",d=o?void 0:jp({drawDefinition:r,structureId:a,matchUpId:s,eventId:l,event:u});if(d?.error)return z({result:d,stack:c});let p=d?.structure;o=o??d?.matchUp;let f=d?.tieFormat,h=f?.winCriteria.valueGoal,m=f?.winCriteria.aggregateValue,g=Wr(f);if(d=Hn({tieFormat:g}),d.error)return z({result:d,stack:c});let I=[];if(g.collectionDefinitions=g.collectionDefinitions.map(v=>{let{collectionGroupNumber:w,...y}=v;return w!==e?v:(I.push(v.collectionId),y)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:v})=>v!==e),d=eee({updateInProgressMatchUps:t,originalValueGoal:h,wasAggregateValue:m,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:s,matchUp:o,eventId:l,event:u}),!d.error){let{appliedPolicies:v}=Rt({tournamentRecord:i}),w=Ve({drawId:r?.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:s,eventId:l});gM({appliedPolicies:v,drawDefinition:r,auditData:w})}return z({result:{...d,modifiedCollectionIds:I},stack:c})}function SI({tieFormat:t,orderMap:e}){let i=Wr(t);return i.collectionDefinitions?.forEach(r=>{let n=e[r.collectionId];n&&(r.collectionOrder=n)}),i.collectionDefinitions?.sort((r,n)=>eI(r.collectionOrder)-eI(n.collectionOrder)),i}function iee({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:s,event:o}){if(typeof n!="object"||!Object.values(n).every(c=>ut(c)))return z({result:{error:ie},context:{orderMap:n}});let l=i?et({drawDefinition:e,structureId:i}):void 0;if(l?.error)return l;let u=l?.structure;if(a&&o?.tieFormat)Nz({tournamentRecord:t,event:o,orderMap:n});else if(r){let c=e&&pi({drawDefinition:e,matchUpId:r});if(c?.error)return c;if(s=c.matchUp,!s)return{error:oa};let d=BC({tournamentRecord:t,matchUpId:r,structure:u,drawDefinition:e,event:o})?.tieFormat;s.tieFormat=SI({tieFormat:d,orderMap:n}),Tt({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:e,matchUp:s})}else if(i)if(u?.tieFormat)u.tieFormat=SI({tieFormat:u.tieFormat,orderMap:n}),ree({eventId:o?.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:n}),ii({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)bx({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else if(o?.tieFormat)Nz({structureIds:[i],tournamentRecord:t,orderMap:n,event:o});else return{error:Vr};else if(e?.tieFormat)bx({tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else return{error:Vr};return{...H}}function Nz({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=SI({tieFormat:r.tieFormat,orderMap:i});e?.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])bx({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function bx({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??n?.tieFormat,s=SI({tieFormat:a,orderMap:r});i?.length||(e.tieFormat=s);let o=[];for(let l of e.structures??[])i?.length&&!i.includes(l.structureId)||((l.tieFormat||i?.includes(l.structureId))&&(l.tieFormat=SI({tieFormat:l.tieFormat??e.tieFormat??n?.tieFormat,orderMap:r})),ree({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),o.push(l.structureId));ii({drawDefinition:e,structureIds:o})}function ree({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){let a=kt({matchUpFilters:{matchUpTypes:[ei]},structure:i})?.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=SI({tieFormat:s.tieFormat,orderMap:r}),Tt({tournamentId:t?.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function x$({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:s,matchUpId:o,eventId:l,matchUp:u,event:c}){let d="removeCollectionDefinition",p=u?void 0:jp({drawDefinition:r,structureId:s,matchUpId:o,eventId:l,event:c});if(p?.error)return z({result:p,stack:d});let f=p?.structure;u=u??p?.matchUp;let h=p?.tieFormat,m=Wr(h);if(p=Hn({tieFormat:m}),p.error)return z({result:p,stack:d});let g=m?.collectionDefinitions?.find(E=>E.collectionId===a);if(!g)return z({result:{error:Vr,collectionId:a}});m.collectionDefinitions=m.collectionDefinitions.filter(E=>E.collectionId!==a),g.collectionGroupNumber&&(m.collectionDefinitions=m.collectionDefinitions.map(E=>{let{collectionGroupNumber:R,...C}=E;return C}),m.collectionGroups=m.collectionGroups.filter(({groupNumber:E})=>E!==g.collectionGroupNumber));let{aggregateValue:I,valueGoal:v}=Om(m);m.winCriteria=Ve({aggregateValue:I,valueGoal:v});let w=h?.winCriteria.valueGoal,y=h?.winCriteria.aggregateValue;(w&&w!==v||I&&!y)&&(n?m.tieFormatName=n:delete m.tieFormatName);let b=[];o&&u?b=[u]:s&&f?b=kt({matchUpFilters:{matchUpTypes:[ei]},structure:f})?.matchUps??[]:r?b=Nn({matchUpFilters:{matchUpTypes:[ei]},drawDefinition:r})?.matchUps??[]:c&&(b=Lu({matchUpFilters:{matchUpTypes:[ei]}})?.matchUps??[]);let S=(b||[]).filter(E=>{let R=E.tieMatchUps?.filter(M=>M.collectionId===a)?.some(dr),C=e&&E.tieFormat?Tc({descendant:E.tieFormat,ancestor:m})?.different:!1;return t&&!R||!E.winningSide&&E.matchUpStatus!==Oi&&(t||E.matchUpStatus!==uo&&!dr(E)&&!C)});if(!S.length)return{error:uv};let{appliedPolicies:U}=Rt({tournamentRecord:i});if(o&&u&&t){let E=u.tieMatchUps?.filter(R=>R.collectionId===a);for(let R of E??[]){let C=yf({matchUpId:R.matchUpId,tieMatchUpId:u?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(C.error||(C=pi({drawDefinition:r,matchUpId:o}),C.error))return C;u=C?.matchUp}}let T=[];for(let E of S){for(let R of E?.sides??[])R.lineUp=(R.lineUp??[]).map(C=>({participantId:C.participantId,collectionAssignments:(C?.collectionAssignments??[]).filter(M=>M.collectionId!==a)}));if(E.tieMatchUps=(E.tieMatchUps??[]).filter(R=>{let C=R.collectionId===a;return C&&T.push(R.matchUpId),!C}),E.tieFormat&&(E.tieFormat=Wr(m)),t){let R=Hc({matchUpId:E.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(R.error)return R}Tt({tournamentId:i?.tournamentId,eventId:c?.eventId,drawDefinition:r,context:d,matchUp:E})}T.length&&Fu({tournamentId:i?.tournamentId,matchUpIds:T,eventId:c?.eventId,drawDefinition:r});let D=Ve(m);if(p=Hn({tieFormat:D}),p.error)return z({result:p,stack:d});if(l&&c)c.tieFormat=D;else if(o&&u)u.tieFormat=D;else if(f)f.tieFormat=D;else if(r)r.tieFormat=D;else if(!u||!r)return{error:_e};ii({drawDefinition:r,eventId:c?.eventId});let P=Ve({drawId:r?.drawId,action:d,collectionId:a,structureId:s,matchUpId:o,eventId:l});return gM({appliedPolicies:U,drawDefinition:r,auditData:P}),{tieFormat:D,deletedMatchUpIds:T,targetMatchUps:S,...H}}function nee({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:s,matchUpId:o,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(n))return z({result:{error:Xe},stack:d});let p=l?void 0:jp({drawDefinition:r,structureId:s,matchUpId:o,eventId:u,event:c});if(p?.error)return z({result:p,stack:d});let f=p?.structure;l=l||p?.matchUp;let h=p?.tieFormat,m=h?.winCriteria.valueGoal,g=Wr(h);if(p=Hn({tieFormat:g}),p.error)return z({result:p,stack:d});for(let v of g.collectionDefinitions){let{collectionId:w,collectionGroupNumber:y}=v;if(y&&n.includes(w))return z({info:"collectionIds cannot be part of other collectionGroups",result:{error:ie},stack:d})}let I=(g.collectionGroups||[]).reduce((v,w)=>w.groupNumber>v?w.groupNumber:v,0)+1;return i.groupNumber=I,g.collectionDefinitions=g.collectionDefinitions.map(v=>n.includes(v.collectionId)?{...v,collectionGroupNumber:I}:v),g.collectionGroups=[...g.collecitonGroups||[],i],eee({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:s,structure:f,tieFormat:g,matchUpId:o,matchUp:l,eventId:u,event:c})}function F$({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:s,drawDefinition:o,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:f,uuids:h,event:m}){let g="addCollectionDefinition",I=Rt({tournamentRecord:r,drawDefinition:o,event:m}).appliedPolicies??{},v=n?.[Cr]??I?.[Cr];a=a??v?.participants?.enforceCategory;let w=(u??v?.participants?.enforceGender)!==!1,y=!!((i??m?.category)&&a!==!1),b=!!((s??m?.gender)&&w),S=eS({referenceCategory:i??m?.category,collectionDefinition:e,referenceGender:s,checkCategory:y,checkGender:b,event:m});if(S.error)return z({result:S,stack:g});let U=p?.tieFormat?void 0:jp({drawDefinition:o,structureId:c,matchUpId:d,eventId:f,event:m});if(U?.error)return z({result:{error:U.error},stack:g});let T=U?.structure;p=p??U?.matchUp;let D=p?.tieFormat??U?.tieFormat,P=Wr(D);if(U=Hn({tieFormat:P}),U?.error)return z({result:{error:U.error},stack:g});if(!e.collectionId)e.collectionId=Pt();else if(P.collectionDefinitions.map(({collectionId:x})=>x).includes(e.collectionId))return z({context:{collectionId:e.collectionId},result:{error:pK}});P.collectionDefinitions.push(e),P.collectionDefinitions.sort((x,L)=>(x.collectionOrder||0)-(L.collectionOrder||0)).forEach((x,L)=>x.collectionOrder=L+1);let{aggregateValue:E,valueGoal:R}=Om(P);P.winCriteria=Ve({aggregateValue:E,valueGoal:R});let C=D?.winCriteria.valueGoal,M=D?.winCriteria.aggregateValue;(C&&C!==R||E&&!M)&&(l?P.tieFormatName=l:delete P.tieFormatName);let N=[],A=[],O=[],k=Ve(P);if(U=Hn({tieFormat:k}),U?.error)return z({result:{error:U.error},stack:g});if(f&&m){m.tieFormat=k;for(let x of m.drawDefinitions??[])if(!x.tieFormat)for(let L of x.structures??[]){if(L.tieFormat)continue;let $=Ik({updateInProgressMatchUps:t,collectionDefinition:e,structure:L,uuids:h});A.push(...$.newMatchUps),O.push(...$.targetMatchUps),N.push(L.structureId)}GT({modifiedMatchUps:O,eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(c&&T){T.tieFormat=k;let x=Ik({updateInProgressMatchUps:t,collectionDefinition:e,structure:T,uuids:h});A.push(...x.newMatchUps),O=x.targetMatchUps,GT({modifiedMatchUps:O,eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(d&&p){if(!_P({matchUp:p,updateInProgressMatchUps:t}))return z({result:{error:v1},stack:g});p.tieFormat=k;let x=FS({collectionDefinition:e,matchUp:p,uuids:h});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...x),A.push(...x),GT({modifiedMatchUps:[p],eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(o){o.tieFormat=k;for(let x of o.structures??[]){let L=Ik({updateInProgressMatchUps:t,collectionDefinition:e,structure:x,uuids:h});N.push(x.structureId),A.push(...L.newMatchUps),O.push(...L.targetMatchUps)}GT({modifiedMatchUps:O,eventId:m?.eventId,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else return{error:_e};let F=Ve({drawId:o?.drawId,collectionDefinition:e,action:g,structureId:c,matchUpId:d,eventId:f});return gM({appliedPolicies:I,drawDefinition:o,auditData:F}),{tieFormat:k,targetMatchUps:O,addedMatchUps:A,...H}}function Ik({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){let n=[],a=(kt({matchUpFilters:{matchUpTypes:[ei]},structure:i})?.matchUps).filter(s=>_P({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let o=FS({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...o),n.push(...o)}return{newMatchUps:n,targetMatchUps:a}}function GT({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:s}){wd({tournamentId:e?.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i?.forEach(o=>{Tt({tournamentId:e?.tournamentId,drawDefinition:r,context:s,matchUp:o,eventId:a})}),ii({structureIds:t,drawDefinition:r,eventId:a})}function aee({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!Hn({tieFormat:i}).valid)return z({result:{error:Kl},info:"falied validation",stack:d});let p=jp({drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(p.error)return z({result:p,stack:d});let{matchUp:f,tieFormat:h}=p,m=Wr(h),g=Tc({descendant:i,ancestor:m,considerations:n});if(g.invalid)return z({context:{invalid:g.invalid},result:{error:Kl},stack:d});if(!g?.different)return z({result:{...H},info:"Nothing to do",stack:d});let I=m.collectionDefinitions.map(({collectionId:D})=>D),v=i.collectionDefinitions.map(({collectionId:D})=>D),w=I.filter(D=>!v.includes(D)),y=i.collectionDefinitions.filter(({collectionId:D})=>!I.includes(D)),b=y.map(Pa("collectionId")),S=[],U,T=i.tieFormatName;for(let D of i.collectionDefinitions){if(b.includes(D.collectionId))continue;let P=O$({updateInProgressMatchUps:t,...D,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(P.modifications&&S.push(...P.modifications),P.error)return z({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of y){let P=F$({updateInProgressMatchUps:t,collectionDefinition:D,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:s,matchUpId:o,matchUp:f,eventId:l,uuids:u,event:c});if(P.error)return z({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of w){let P=x$({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:D,structureId:s,matchUpId:o,eventId:l,matchUp:f,event:c});if(P.error)return z({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}return h?.tieFormatName!==T?(U.tieFormatName=T,S.push({tieFormatName:T})):(S.length||b.length||w.length)&&(delete U.tieFormatName,S.push("tieFormatName removed: modifications without new tieFormatName")),U.collectionDefinitions=U.collectionDefinitions.sort((D,P)=>eI(D.collectionOrder)-eI(P.collectionOrder)).map((D,P)=>({...D,collectionOrder:P+1})),{processedTieFormat:Wr(U),modifications:S,...H}}function see({tournamentRecord:t}){if(!t)return{error:ge};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=u=>{if(!u.tieFormat)return;let c;for(let d of r)Tc({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);if(c)u.tieFormatId=c,delete u.tieFormat;else{let d=Oe(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Pt()),u.tieFormatId=d.tieFormatId,delete u.tieFormat,r.push(d),e+=1}};i.eventType,n({tieFormat:i.tieFormat});for(let u of i.drawDefinitions??[]){n({tieFormat:u.tieFormat});for(let c of u.structures??[])n({tieFormat:c.tieFormat})}let a=(u,c)=>{let d=o.matchUps?.find(p=>p.matchUpId===u);d&&(d.tieFormatId=c,delete d.tieFormat,Tt({tournamentId:t?.tournamentId,eventId:i.eventId,matchUp:d}))},s=u=>{let c=Oe(u.tieFormat,void 0,!0);c.tieFormatId||(c.tieFormatId=Pt()),r.push(c),e+=1,a(u.matchUpId,c.tieFormatId)},o=Lu({matchUpFilters:{matchUpTypes:[Va]},event:i}),l=o.matchUps??[];for(let u of l){let c;for(let d of r)u.tieFormat&&Tc({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);c?a(u.matchUpId,c):s(u)}r.length&&(i.tieFormats=r)}return{...H,addedCount:e}}var oee={};pt(oee,{addDrawDefinitionExtension:()=>BR,addEventExtension:()=>Gd,addEventTimeItem:()=>Nm,addExtension:()=>gt,addMutationLock:()=>pee,addNotes:()=>mC,addOnlineResource:()=>gee,addParticipantExtension:()=>H5,addParticipantTimeItem:()=>D0,addTimeItem:()=>kl,addTournamentExtension:()=>aL,addTournamentTimeItem:()=>BS,analyzeDraws:()=>VS,analyzeTournament:()=>w_,cleanExpiredMutationLocks:()=>I_,copyTournamentRecord:()=>uee,createTournamentRecord:()=>fM,generate:()=>lee,getAggregateTeamResults:()=>b_,getAllowedDrawTypes:()=>LC,getAllowedMatchUpFormats:()=>g_,getAppliedPolicies:()=>Rt,getCompetitionDateRange:()=>$C,getCompetitionPenalties:()=>v_,getMutationLocks:()=>T_,getPolicyDefinitions:()=>jc,getTournamentInfo:()=>Am,getTournamentPenalties:()=>_C,getTournamentPersons:()=>y_,getTournamentPoints:()=>Ev,getTournamentStructures:()=>l0,getTournamentTimeItem:()=>XR,hydrateTournamentRecord:()=>fee,mutate:()=>cee,query:()=>uJ,removeDrawDefinitionExtension:()=>W5,removeEventExtension:()=>VR,removeExtension:()=>Mn,removeMutationLock:()=>dee,removeNotes:()=>w0,removeOnlineResource:()=>mee,removeParticipantExtension:()=>z5,removeTournamentExtension:()=>sL,setTournamentCategories:()=>yee,setTournamentDates:()=>IM,setTournamentEndDate:()=>wee,setTournamentName:()=>Iee,setTournamentNotes:()=>vee,setTournamentStartDate:()=>bee,setTournamentStatus:()=>hee});var lee={};pt(lee,{copyTournamentRecord:()=>uee,createTournamentRecord:()=>fM});function uee(t){let e=Ge(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord,n=1440*60*1e3,a=(i&&r?new Date(Qe(r)).getTime()-new Date(Qe(i)).getTime():0)/n,s=t.endDate||B1(t.startDate,a),o=p=>p?.filter(({itemType:f})=>t.itemTypeList?.includes(f)),l=p=>p?.filter(({name:f})=>t.extensionList?.includes(f)),u=p=>{let{timeItems:f,extensions:h,...m}=p;return Oe({...m,timeItems:o(f),extensions:l(h)},!1,!0)},c=p=>{let{drawDefinitions:f,timeItems:h,extensions:m,startDate:g,endDate:I,...v}=p;return Oe({extensions:l(m),timeItems:o(h),startDate:t.startDate,endDate:s,...v},!1,!0)},d={participants:t.copyParticipants?t.tournamentRecord.participants?.map(u)??[]:[],parentOrganisation:Oe({...t.tournamentRecord.parentOrganisation},!1,!0),venues:Oe(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:o(t.tournamentRecord.timeItems),events:t.tournamentRecord.events?.map(c)??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:Pt(),endDate:s};return{...H,tournamentRecord:d}}var cee={};pt(cee,{addDrawDefinitionExtension:()=>BR,addEventExtension:()=>Gd,addEventTimeItem:()=>Nm,addExtension:()=>gt,addMutationLock:()=>pee,addNotes:()=>mC,addOnlineResource:()=>gee,addParticipantExtension:()=>H5,addParticipantTimeItem:()=>D0,addTimeItem:()=>kl,addTournamentExtension:()=>aL,addTournamentTimeItem:()=>BS,hydrateTournamentRecord:()=>fee,removeDrawDefinitionExtension:()=>W5,removeEventExtension:()=>VR,removeExtension:()=>Mn,removeMutationLock:()=>dee,removeNotes:()=>w0,removeOnlineResource:()=>mee,removeParticipantExtension:()=>z5,removeTournamentExtension:()=>sL,setTournamentCategories:()=>yee,setTournamentDates:()=>IM,setTournamentEndDate:()=>wee,setTournamentName:()=>Iee,setTournamentNotes:()=>vee,setTournamentStartDate:()=>bee,setTournamentStatus:()=>hee});function dee(t){let{tournamentRecord:e,drawDefinition:i,event:r,venueId:n,lockId:a,scope:s,lockToken:o,forceRelease:l}=t;if(!e)return{error:ge};if(!a&&!s)return{error:Xe,info:"Provide lockId or scope to identify the lock"};let u;if(i)u=i;else if(r)u=r;else if(n){let h=po({tournamentRecord:e,venueId:n});if(h.error)return{error:h.error};u=h.venue}else u=e;let{extension:c}=it({element:u,name:Pn}),d=c?.value??{locks:[]},p=d.locks.findIndex(h=>a?h.lockId===a:h.scope===s);if(p===-1)return{error:yK};let f=d.locks[p];return!l&&f.lockToken!==o?{error:bK}:(d.locks.splice(p,1),gt({element:u,extension:{name:Pn,value:d},creationTime:!1}),{...H})}function pee(t){let{tournamentRecord:e,drawDefinition:i,event:r,venueId:n,scope:a,lockToken:s,methods:o}=t,l=t.expiresAt??null;if(!e)return{error:ge};if(!a||!s)return{error:Xe,info:a?"Missing lockToken":"Missing scope"};if(l!==null&&isNaN(Date.parse(l)))return{error:ie,info:"Invalid expiresAt; must be ISO 8601 or null"};let u;if(i)u=i;else if(r)u=r;else if(n){let g=po({tournamentRecord:e,venueId:n});if(g.error)return{error:g.error};u=g.venue}else u=e;let{extension:c}=it({element:u,name:Pn}),d=c?.value??{locks:[]},p=new Date().toISOString();d.locks=d.locks.filter(g=>g.expiresAt===null||g.expiresAt>p);let f=d.locks.find(g=>g.scope!==a?!1:!g.methods||!o?!0:g.methods.some(I=>o.includes(I)));if(f)return f.lockToken===s?(f.expiresAt=l,o?f.methods=o:delete f.methods,gt({element:u,extension:{name:Pn,value:d},creationTime:!1}),{...H,lockId:f.lockId}):{error:vK};let h=Pt(),m={lockId:h,lockToken:s,scope:a,expiresAt:l,createdAt:p,...o&&{methods:o}};return d.locks.push(m),gt({element:u,extension:{name:Pn,value:d},creationTime:!1}),FMe(e,u),{...H,lockId:h}}function FMe(t,e){if(e===t){let{extension:r}=it({element:t,name:Pn});r?.value&&!r.value.enabled&&(r.value.enabled=!0,gt({element:t,extension:{name:Pn,value:r.value},creationTime:!1}));return}let{extension:i}=it({element:t,name:Pn});i?.value?i.value.enabled||(i.value.enabled=!0,gt({element:t,extension:{name:Pn,value:i.value},creationTime:!1})):gt({element:t,extension:{name:Pn,value:{enabled:!0,locks:[]}},creationTime:!1})}function fee(t){let{tournamentRecord:e,eventProfiles:i=[],directives:r,policyDefinitions:n}=t;return e?((e.events||[]).forEach(a=>{let s=i.find(o=>o.eventId&&o.eventId===a.eventId);(s?.directives?.hydrateRoundNames||r?.hydrateRoundNames)&&a.drawDefinitions?.forEach(o=>{(s?.policyDefinitions?.[gc]||n?.[gc])&&DJ({drawDefinition:o,appliedPolicies:n})})}),{tournamentRecord:e}):{error:ge}}function hee({tournamentRecord:t,status:e}){return t?e&&!Object.keys($9).includes(e)?{error:ie,info:"Unknown status"}:(t.tournamentStatus=e,{...H}):{error:ge}}function mee(t){let e=Ge(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return z({result:{error:Vr}});mg({element:i.parentOrganisation,onlineResource:r})}else if(a||s){let u=(i.participants??[]).find(c=>s&&c.person?.personId===s||c.participantId===a);if(!u)return z(s?{result:{error:Vr}}:{result:{error:ji}});if(s){if(u.person?.personId!==s)return z({result:{error:Cp}});mg({element:u.person,onlineResource:r})}else mg({element:u,onlineResource:r})}else if(o){let u=(i.venues??[]).filter(c=>!l||c.venueId===l).flatMap(c=>(c.courts??[]).filter(d=>d.courtId===o))?.[0];if(!u)return z({result:{error:fc}});mg({element:u,onlineResource:r})}else if(l){let u=(i.venues??[]).find(c=>c.venueId===l);if(!u)return z({result:{error:lf}});mg({element:u,onlineResource:r})}else mg({element:i,onlineResource:r}),nt({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:cf});return{...H}}function mg({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!(r?.[sP]===e[sP]&&r?.[oP]===e[oP]&&r?.[sI]===e[sI]));t.onlineResources=i}function gee(t){let e=Ge(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return z({result:{error:Vr}});gg({element:i.parentOrganisation,onlineResource:r})}else{if(a&&s&&a!==s)return z({result:{error:Cp}});if(a||s){let u=(i.participants??[]).find(c=>s&&c.person?.personId===s||c.participantId===a);if(!u)return z(s?{result:{error:Vr}}:{result:{error:ji}});if(s){if(u.person?.personId!==s)return z({result:{error:Cp}});gg({element:u.person,onlineResource:r})}else gg({element:u,onlineResource:r})}else if(o){let u=(i.venues??[]).filter(c=>!l||c.venueId===l).flatMap(c=>(c.courts??[]).filter(d=>d.courtId===o))?.[0];if(!u)return z({result:{error:fc}});gg({element:u,onlineResource:r})}else if(l){let u=(i.venues??[]).find(c=>c.venueId===l);if(!u)return z({result:{error:lf}});gg({element:u,onlineResource:r})}else gg({element:i,onlineResource:r}),nt({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:cf})}return{...H}}function gg({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>r?.[xO]!==e[xO]&&r?.[sI]!==e[sI]);return i.push(e),t.onlineResources=i,{...H}}function Iee({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:ge};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&nt({topic:cf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...H}}function vee({tournamentRecord:t,notes:e}){if(!t)return{error:ge};let i=e?mC({element:t,notes:e}):w0({element:t});return i.error?i:(nt({topic:cf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...H})}function yee({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,nt({topic:cf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...H}):{error:ge}}function LMe({tournamentRecord:t}){if(!t)return{error:ge};let{startDate:e,endDate:i}=t,r=aI(e,i),n=[];for(let a of t.venues||[])a?.courts?.length&&n.push(...a.courts);for(let a of n){let{startTime:s,endTime:o}=(a.dateAvailability??[]).reduce((c,d)=>{let p=Mt(c.startTime),f=Mt(c.endTime);return d.startTime&&Mt(d.startTime)<p&&(c.startTime=d.startTime),d.endTime&&Mt(d.endTime)>f&&(c.endTime=d.endTime),c},{startTime:"08:00",endTime:"18:00"}),l=r.map(c=>a.dateAvailability?.find(d=>d.date===c)??{date:c,startTime:s,endTime:o}),u=a.dateAvailability?.find(c=>!c.date);u&&l.unshift(u),a.dateAvailability=l}return{...H}}function IM(t){let{tournamentRecord:e,startDate:i,endDate:r,weekdays:n}=t,a=t.activeDates?.filter(Boolean),s=Ge(t,[{tournamentRecord:!0},{[qr]:f=>dl.test(f),[Ha]:qi,startDate:!1,endDate:!1},{[qr]:f=>f.filter(Boolean).every(h=>dl.test(h)),[Ha]:qi,activeDates:!1},{[qr]:jJ,weekdays:!1}]);if(s.error)return s;if(r&&i&&new Date(r)<new Date(i))return{error:ie};if(r&&i&&new Date(i)>new Date(r))return{error:ie};if(a?.length){let f=i||e.startDate,h=r||e.endDate,m=!f||a.every(I=>new Date(I)>=new Date(f)),g=!h||a.every(I=>new Date(I)<=new Date(h));if(!m||!g)return{error:qi}}let o;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||r&&e.endDate&&new Date(r)<new Date(e.endDate))&&(o=!0);let l=aI(e.startDate,e.endDate);i&&(e.startDate=i),r&&(e.endDate=r);let u=aI(e.startDate,e.endDate),c=l.filter(f=>!u.includes(f)),d=u.filter(f=>!l.includes(f));for(let f of e.events??[])i&&f.startDate&&new Date(f.startDate)<new Date(i)&&(f.startDate=i),r&&f.startDate&&new Date(f.startDate)>new Date(r)&&(f.startDate=i??r),r&&f.endDate&&new Date(f.endDate)>new Date(r)&&(f.endDate=r),i&&f.endDate&&new Date(f.endDate)<new Date(i)&&(f.endDate=r??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),r&&e.startDate&&new Date(r)<new Date(e.startDate)&&(e.startDate=r),a&&(e.activeDates=a),n&&(e.weekdays=n);let p=o&&_Me({tournamentRecord:e})?.unscheduledMatchUpIds;return LMe({tournamentRecord:e}),nt({payload:Ve({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:n,endDate:r}),topic:cf}),{...H,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:c}}function bee({tournamentRecord:t,startDate:e}){return e?IM({tournamentRecord:t,startDate:e}):{error:qi}}function wee({tournamentRecord:t,endDate:e}){return e?IM({tournamentRecord:t,endDate:e}):{error:qi}}function _Me({tournamentRecord:t}){let e=wr({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let s of e){let{schedule:o,matchUpId:l}=s;if(o&&o.scheduledDate){let u=new Date(o.scheduledDate);(i&&u<i||r&&u>r)&&(a.push(l),n.includes(o.scheduledDate)||n.push(o.scheduledDate))}}return n.length&&!cM({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:s4}:{unscheduledMatchUpIds:a}}var See={};pt(See,{BLOCK_TYPES:()=>xt,EvaluatorRegistry:()=>Fee,adjacentBlockEvaluator:()=>q$,applyTemporalAvailabilityToTournamentRecord:()=>Hee,blockDurationEvaluator:()=>K$,buildDayRange:()=>Dee,buildEdges:()=>$$,buildSchedulingProfileFromUISelections:()=>Wee,calculateCapacityStats:()=>Eee,calculateCourtHours:()=>Xee,clampDragToCollisions:()=>kee,clampToDayRange:()=>L$,compareCapacityCurves:()=>Mee,computePlanItemId:()=>BP,courtDayKey:()=>rb,courtKey:()=>xg,courtOverlapEvaluator:()=>W$,createFollowByEvaluator:()=>Lee,dayBoundaryEvaluator:()=>X$,defaultEvaluators:()=>xee,deriveRailSegments:()=>V$,diffMinutes:()=>rU,extractDay:()=>lp,filterCapacityCurve:()=>Ree,findBlocksContainingTime:()=>Aee,formatConflicts:()=>Bee,generateCapacityCurve:()=>G$,getHighestSeverity:()=>$ee,groupConflictsBySeverity:()=>_ee,hhmmToMinutes:()=>Qb,intervalsOverlap:()=>Nee,iterateDayTicks:()=>jee,lightingEvaluator:()=>Y$,maintenanceWindowEvaluator:()=>J$,matchWindowEvaluator:()=>z$,mergeAdjacentSegments:()=>j$,mergeOverlappingAvailability:()=>Kee,minutesToHhmm:()=>vM,overlappingRange:()=>Tee,railsToDateAvailability:()=>Z$,rangesOverlap:()=>_$,resolveCourtId:()=>th,resolveStatus:()=>$P,resolveVenueId:()=>mh,runValidationPipeline:()=>Gee,sampleCapacityCurve:()=>Cee,snapIsoToGranularity:()=>Vee,snapToGranularity:()=>Q$,sortBlocksByStart:()=>Oee,sortEdges:()=>B$,timeInsideBlock:()=>H$,todsAvailabilityToBlocks:()=>zee,validateDateAvailability:()=>Yee,validateSchedulingProfileFormat:()=>qee,validateSegments:()=>Pee,venueDayKey:()=>Uee,venueKey:()=>Jf});var xt={MAINTENANCE:"MAINTENANCE",PRACTICE:"PRACTICE",RESERVED:"RESERVED",BLOCKED:"BLOCKED",CLOSED:"CLOSED",SCHEDULED:"SCHEDULED",SOFT_BLOCK:"SOFT_BLOCK",HARD_BLOCK:"HARD_BLOCK",LOCKED:"LOCKED",AVAILABLE:"AVAILABLE",UNSPECIFIED:"UNSPECIFIED"};function rb(t,e){return`${t.tournamentId}|${t.venueId}|${t.courtId}|${e}`}function xg(t){return`${t.tournamentId}|${t.venueId}|${t.courtId}`}function Jf(t,e){return`${t}|${e}`}function Uee(t,e,i){return`${t}|${e}|${i}`}function mh(t){return t.venueId||t.venueName||"unknown-venue"}function th(t){return t.courtId||t.courtName||"unknown-court"}function L$(t,e){let i=t.start,r=t.end,n=e?.start,a=e?.end;if(r<=n||i>=a)return null;let s=i<n?n:i,o=r>a?a:r;return{...t,start:s,end:o}}function _$(t,e){return t?.start<e?.end&&e?.start<t?.end}function Tee(t,e){let i=t?.start>e?.start?t?.start:e?.start,r=t?.end<e?.end?t?.end:e?.end;return{start:i,end:r}}function rU(t,e){let i=new Date(t),r=(new Date(e).getTime()-i.getTime())/(1e3*60);return Number.isNaN(r)?0:r}function $P(t,e,i){if(t.length===0||!i||i.length===0)return xt.AVAILABLE;let r=new Map(i.map((s,o)=>[s,o])),n=xt.AVAILABLE,a=1/0;for(let s of t){let o=e.get(s);if(!o)continue;let l=r.get(o.type);l!==void 0&&l<a&&(a=l,n=o.type)}return n}function $$(t){let e=[];if(!Array.isArray(t))return e;for(let i of t)e.push({time:i.start,type:"START",blockId:i.id}),e.push({time:i.end,type:"END",blockId:i.id});return e}function B$(t){return Array.isArray(t)?t.slice().sort((e,i)=>{let r=e.time.localeCompare(i.time);return r!==0?r:e.type==="END"&&i.type==="START"?-1:e.type==="START"&&i.type==="END"?1:0}):[]}function V$(t,e,i){if(!Array.isArray(t)||!e||!i)return[];let r=t.map(u=>L$(u,e)).filter(u=>u!==null);if(r.length===0)return[{start:e.start,end:e.end,status:xt.AVAILABLE,contributingBlocks:[]}];let n=new Map(r.map(u=>[u.id,u])),a=B$($$(r)),s=new Set,o=[],l=e.start;for(let u of a){let c=u.time;if(c>l){let d=Array.from(s),p=$P(d,n,i.typePrecedence);o.push({start:l,end:c,status:p,contributingBlocks:d})}u.type==="START"?s.add(u.blockId):s.delete(u.blockId),l=c}if(l<e.end){let u=Array.from(s),c=$P(u,n,i.typePrecedence);o.push({start:l,end:e.end,status:c,contributingBlocks:u})}return j$(o)}function j$(t){if(t.length===0)return t;let e=[],i={...t[0]};for(let r=1;r<t.length;r++){let n=t[r],a=i.status===n.status,s=i.contributingBlocks.length===n.contributingBlocks.length&&i.contributingBlocks.every(l=>n.contributingBlocks.includes(l)),o=i.end===n.start;a&&s&&o?i.end=n.end:(e.push(i),i={...n})}return e.push(i),e}function lp(t){return Qe(t)}function Dee(t,e){return{start:`${t}T${e?.dayStartTime}:00`,end:`${t}T${e?.dayEndTime}:00`}}function Pee(t){for(let e=0;e<t.length;e++){let i=t[e];if(i.start>=i.end)return!1;if(e<t.length-1){let r=t[e+1];if(i.end>r.start||i.end!==r.start)return!1}}return!0}function G$(t,e){let i=new Set;if(!Array.isArray(e))return{day:t,points:[]};for(let a of e)for(let s of a.rails)for(let o of s.segments)i.add(o.start),i.add(o.end);let r=Array.from(i).sort(),n=r.map(a=>({time:a,courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0}));for(let a of e)for(let s of a.rails)for(let o=0;o<r.length;o++){let l=r[o],u=$Me(s.segments,l);if(u){let c=n[o];BMe(u,c)}}return{day:t,points:n}}function $Me(t,e){for(let i of t)if(e>=i.start&&e<i.end)return i;return null}function BMe(t,e){switch(t.status){case xt.AVAILABLE:e.courtsAvailable++;break;case xt.RESERVED:case xt.SOFT_BLOCK:e.courtsSoftBlocked++;break;case xt.BLOCKED:case xt.PRACTICE:case xt.MAINTENANCE:case xt.CLOSED:e.courtsSoftBlocked++;break;case xt.SCHEDULED:case xt.HARD_BLOCK:case xt.LOCKED:e.courtsHardBlocked++;break}}function Eee(t){if(!t.points||t.points.length===0)return{peakAvailable:0,peakTime:"",minAvailable:0,minTime:"",avgAvailable:0,totalCourtHours:0,utilizationPercent:0,peakUnavailable:0,peakUnavailableTime:"",totalCourts:0,totalAvailableHours:0,totalUnavailableHours:0,availablePercent:0,avgBlockedHoursPerCourt:0};let e=0,i=t.points[0].time,r=1/0,n=t.points[0].time,a=0,s=t.points[0].time,o=0,l=0,u=0;for(let g=0;g<t.points.length-1;g++){let I=t.points[g],v=t.points[g+1],w=(new Date(v.time).getTime()-new Date(I.time).getTime())/(1e3*60*60),y=I.courtsAvailable+I.courtsSoftBlocked+I.courtsHardBlocked;u=Math.max(u,y);let b=I.courtsSoftBlocked+I.courtsHardBlocked;I.courtsAvailable>e&&(e=I.courtsAvailable,i=I.time),I.courtsAvailable<r&&(r=I.courtsAvailable,n=I.time),b>a&&(a=b,s=I.time),o+=I.courtsAvailable*w,l+=b*w}let c=(new Date(t.points.at(-1).time).getTime()-new Date(t.points[0].time).getTime())/(1e3*60*60),d=u*c,p=d>0?o/d*100:0,f=d>0?l/d*100:0,h=u>0?l/u:0,m=t.points.length>1?t.points.slice(0,-1).reduce((g,I)=>g+I.courtsAvailable,0)/(t.points.length-1):0;return{peakAvailable:e,peakTime:i,minAvailable:r===1/0?0:r,minTime:n,avgAvailable:m,totalCourtHours:d,utilizationPercent:f,peakUnavailable:a,peakUnavailableTime:s,totalCourts:u,totalAvailableHours:o,totalUnavailableHours:l,availablePercent:p,avgBlockedHoursPerCourt:h}}function Ree(t,e){let i=t.points?.filter(r=>r.time>=e.start&&r.time<=e.end);return{...t,points:i}}function Cee(t,e){if(!t.points||t.points.length===0)return t;let i=[],r=new Date(t.points[0].time),n=new Date(t.points.at(-1).time),a=new Date(r);for(;a<=n;){let s=a.toISOString(),o=VMe(t.points,s);o&&i.push(o),a=new Date(a.getTime()+e*60*1e3)}return{...t,points:i}}function VMe(t,e){for(let i=t.length-1;i>=0;i--)if(t[i].time<=e)return{time:e,courtsAvailable:t[i].courtsAvailable,courtsSoftBlocked:t[i].courtsSoftBlocked,courtsHardBlocked:t[i].courtsHardBlocked};return null}function Mee(t,e){let i=[],r=new Set;t.points?.forEach(a=>r.add(a.time)),e?.points?.forEach(a=>r.add(a.time));let n=Array.from(r).sort();for(let a of n){let s=t.points?.find(l=>l.time===a)||{courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0},o=e.points?.find(l=>l.time===a)||{courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0};i.push({time:a,availableDelta:o.courtsAvailable-s.courtsAvailable,softBlockedDelta:o.courtsSoftBlocked-s.courtsSoftBlocked,hardBlockedDelta:o.courtsHardBlocked-s.courtsHardBlocked})}return i}function Nee(t,e){let i=new Date(t.start?.endsWith("Z")?t.start:t.start+"Z").getTime(),r=new Date(t.end?.endsWith("Z")?t.end:t.end+"Z").getTime(),n=new Date(e?.start?.endsWith("Z")?e?.start:e?.start+"Z").getTime(),a=new Date(e?.end?.endsWith("Z")?e?.end:e?.end+"Z").getTime();return i<a&&r>n}function H$(t,e){let i=new Date(e?.start?.endsWith("Z")?e?.start:e?.start+"Z").getTime(),r=new Date(e?.end?.endsWith("Z")?e?.end:e?.end+"Z").getTime();return i<=t&&t<r}function Aee(t,e){return Array.isArray(e)?e.filter(i=>H$(t,i)):[]}function kee(t,e,i){let r=e>=t?"forward":"backward",n=Math.min(t,e),a=Math.max(t,e),s,o,l=!1,u;if(r==="forward"){let c=a;for(let d of i){let p=new Date(d.start.endsWith("Z")?d.start:d.start+"Z").getTime(),f=new Date(d.end.endsWith("Z")?d.end:d.end+"Z").getTime();p>t&&p<a&&p<c&&(c=p,l=!0,u=d),p<a&&f>t&&p<c&&p>t&&(c=p,l=!0,u=d)}s=t,o=c}else{let c=n;if(Array.isArray(i))for(let d of i){let p=new Date(d.start.endsWith("Z")?d.start:d.start+"Z").getTime(),f=new Date(d.end.endsWith("Z")?d.end:d.end+"Z").getTime();f<t&&f>n&&f>c&&(c=f,l=!0,u=d),p<t&&f>n&&f>c&&f<t&&(c=f,l=!0,u=d)}s=c,o=t}return{start:s,end:o,clamped:l,clampedBy:u,direction:r}}function Oee(t){Array.isArray(t)&&t.sort((e,i)=>{let r=new Date(e.start.endsWith("Z")?e.start:e.start+"Z").getTime(),n=new Date(i.start.endsWith("Z")?i.start:i.start+"Z").getTime();return r-n})}var W$={id:"COURT_OVERLAP",description:"Prevent double-booking courts or overriding hard blocks",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Qe(n.start),s=`${n.court.tournamentId}|${n.court.venueId}|${n.court.courtId}|${a}`,o=t.blocksByCourtDay.get(s)||[];for(let l of o){if(l===n.id)continue;let u=t.blocksById.get(l);if(u&&_$(n,u)){let c=u.type===xt.HARD_BLOCK||u.type===xt.LOCKED||n.type===xt.HARD_BLOCK||n.type===xt.LOCKED?"ERROR":"WARN",d=n.start>u.start?n.start:u.start,p=n.end<u.end?n.end:u.end;i.push({code:"COURT_OVERLAP",message:`Block overlaps existing ${u.type.toLowerCase()} (${u.reason||"no reason"}) on court ${n.court.courtId}`,severity:c,timeRange:{start:d,end:p},courts:[n.court]})}}}return i}},z$={id:"MATCH_WINDOW",description:"Ensure availability windows are large enough for typical matches",evaluate:(t,e)=>{let i=[],r=new Set;for(let n of e){let a=n.block,s=Qe(a.start),o=`${a.court.tournamentId}|${a.court.venueId}|${a.court.courtId}|${s}`;r.add(o)}for(let n of r){let a=(t.blocksByCourtDay.get(n)||[]).map(o=>t.blocksById.get(o)).filter(Boolean).slice().sort((o,l)=>o.start.localeCompare(l.start)),s=null;for(let o of a)if(o.type!==xt.AVAILABLE&&o.type!==xt.SOFT_BLOCK&&o.type!==xt.RESERVED){if(s){let l=rU(s,o.start);l>0&&l<60&&i.push({code:"MATCH_WINDOW_TOO_SMALL",message:`Availability window (${l} minutes) is smaller than typical match duration (60 minutes)`,severity:"WARN",timeRange:{start:s,end:o.start},courts:[o.court]})}s=o.end}}return i}},q$={id:"ADJACENT_BLOCK",description:"Warn about blocks with no transition time",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Qe(n.start),s=`${n.court.tournamentId}|${n.court.venueId}|${n.court.courtId}|${a}`,o=t.blocksByCourtDay.get(s)||[];for(let l of o){if(l===n.id)continue;let u=t.blocksById.get(l);u&&(u.end===n.start||n.end===u.start)&&u.type!==n.type&&i.push({code:"NO_TRANSITION_TIME",message:`${n.type} immediately follows ${u.type} with no transition time (recommended: 15 minutes)`,severity:"INFO",timeRange:{start:u.end,end:n.start},courts:[n.court]})}}return i}},Y$={id:"LIGHTING",description:"Prevent scheduling on unlit courts after sunset",evaluate:(t,e)=>{let i=[],r="19:00";for(let n of e){if(n.kind==="REMOVE_BLOCK")continue;let a=n.block;a.end.slice(11,16)>r&&(a.type===xt.AVAILABLE||a.type===xt.RESERVED)&&i.push({code:"AFTER_SUNSET",message:`Court scheduled after sunset (${r}). Verify court has adequate lighting.`,severity:"WARN",timeRange:{start:`${a.start.slice(0,11)}${r}:00`,end:a.end},courts:[a.court]})}return i}},K$={id:"BLOCK_DURATION",description:"Validate block durations are reasonable",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=rU(n.start,n.end);a<15?i.push({code:"BLOCK_TOO_SHORT",message:`Block duration (${a} minutes) is unusually short. Minimum recommended: 15 minutes.`,severity:"WARN",timeRange:n,courts:[n.court]}):a>720&&i.push({code:"BLOCK_TOO_LONG",message:`Block duration (${a/60} hours) is unusually long. Maximum recommended: ${720/60} hours.`,severity:"WARN",timeRange:n,courts:[n.court]})}return i}},X$={id:"DAY_BOUNDARY",description:"Ensure blocks do not span multiple days",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Qe(n.start),s=Qe(n.end);a!==s&&i.push({code:"SPANS_MULTIPLE_DAYS",message:`Block spans from ${a} to ${s}. Blocks should be contained within a single day.`,severity:"ERROR",timeRange:n,courts:[n.court]})}return i}},J$={id:"MAINTENANCE_WINDOW",description:"Validate maintenance scheduling practices",evaluate:(t,e)=>{let i=[],r="09:00",n="17:00";for(let a of e){if(a.kind==="REMOVE_BLOCK")continue;let s=a.block;if(s.type===xt.MAINTENANCE){let o=s.start.slice(11,16),l=s.end.slice(11,16),u=rU(s.start,s.end);(o>=r&&o<n||l>r&&l<=n)&&i.push({code:"MAINTENANCE_DURING_PEAK",message:`Maintenance scheduled during peak hours (${r}-${n}). Consider scheduling during off-peak times.`,severity:"INFO",timeRange:s,courts:[s.court]}),u<30&&i.push({code:"MAINTENANCE_TOO_SHORT",message:`Maintenance duration (${u} minutes) may be insufficient. Recommended minimum: 30 minutes.`,severity:"INFO",timeRange:s,courts:[s.court]})}}return i}},xee=[W$,X$,K$,z$,q$,Y$,J$],Fee=class{constructor(){this.evaluators=new Map}register(e){this.evaluators.set(e.id,e)}unregister(e){this.evaluators.delete(e)}get(e){return this.evaluators.get(e)}getAll(){return Array.from(this.evaluators.values())}clear(){this.evaluators.clear()}},Lee=t=>({id:"FOLLOW_BY",description:"Player rest and follow-by conflicts using Competition Factory",evaluate:(e,i)=>[]});function _ee(t){return Array.isArray(t)?{errors:t?.filter(e=>e.severity==="ERROR"),warnings:t.filter(e=>e.severity==="WARN"),info:t.filter(e=>e.severity==="INFO")}:{errors:[],warnings:[],info:[]}}function $ee(t){return Array.isArray(t)?t.some(e=>e.severity==="ERROR")?"ERROR":t.some(e=>e.severity==="WARN")?"WARN":t.some(e=>e.severity==="INFO")?"INFO":null:null}function Bee(t){return Array.isArray(t)?t.map(e=>{let i=e.courts.map(n=>n.courtId).join(", "),r=`${e.timeRange.start.slice(11,16)}-${e.timeRange.end.slice(11,16)}`;return`[${e.severity}] ${e.code}: ${e.message} (${i} @ ${r})`}):[]}function Qb(t){if(typeof t!="string")return 0;let[e,i]=t.split(":").map(Number);return e*60+i}function vM(t){let e=Math.max(0,Math.min(1439,Math.round(t))),i=Math.floor(e/60),r=e%60;return`${String(i).padStart(2,"0")}:${String(r).padStart(2,"0")}`}function Q$(t,e,i="round"){if(e<=0)return t;switch(i){case"floor":return Math.floor(t/e)*e;case"ceil":return Math.ceil(t/e)*e;case"round":return Math.round(t/e)*e}}function Vee(t,e,i="round"){if(!t||typeof t!="string")return t;let r=t.slice(0,10),n=t.slice(11,16),a=Qb(n),s=Q$(a,e,i),o=vM(s);return`${r}T${o}:00`}function*jee(t,e,i){if(i<=0)return;let r=Qb(t),n=Qb(e);for(let a=r;a<n;a+=i)yield vM(a)}function BP(t){let e=[t.day,t.venueId,t.eventId];return t.drawId&&e.push(t.drawId),e.push(`R${t.roundNumber}`),e.join("|")}function jMe(t,e){let i=[],r=new Set(t.getTournamentDays()),n=t.listCourtMeta(),a=new Set(n.map(s=>s.ref.venueId));for(let s of e){r.has(s.day)||i.push({ruleId:"PRECHECK_INVALID_DAY",phase:"PRECHECK",severity:"ERROR",message:`Day '${s.day}' is not within the tournament date range`,context:{day:s.day}});for(let o of s.items)a.has(o.venueId)||i.push({ruleId:"PRECHECK_INVALID_VENUE",phase:"PRECHECK",severity:"ERROR",message:`Venue '${o.venueId}' does not exist in the tournament record`,context:{day:s.day,venueId:o.venueId,planItemId:o.planItemId}}),o.notBeforeTime&&!/^\d{2}:\d{2}$/.test(o.notBeforeTime)&&i.push({ruleId:"PRECHECK_INVALID_TIME_FORMAT",phase:"PRECHECK",severity:"ERROR",message:`notBeforeTime '${o.notBeforeTime}' is not valid HH:MM format`,context:{day:s.day,planItemId:o.planItemId}}),o.roundNumber<1&&i.push({ruleId:"PRECHECK_INVALID_ROUND",phase:"PRECHECK",severity:"ERROR",message:`roundNumber must be >= 1, got ${o.roundNumber}`,context:{day:s.day,planItemId:o.planItemId}})}return i}function GMe(t,e){let i=[],r=new Set;for(let n of e)for(let a of n.items)r.has(a.planItemId)&&i.push({ruleId:"INTEGRITY_DUPLICATE_PLAN_ITEM",phase:"INTEGRITY",severity:"ERROR",message:`Duplicate plan item '${a.planItemId}'`,context:{day:n.day,planItemId:a.planItemId}}),r.add(a.planItemId);return i}function HMe(t,e){let i=[],r=new Map;for(let n of e)for(let a of n.items){let s=`${a.eventId}|${a.drawId||""}`,o=r.get(s)||[];o.push({day:n.day,roundNumber:a.roundNumber,planItemId:a.planItemId}),r.set(s,o)}for(let[n,a]of r.entries()){if(a.length<2)continue;let s=[...a].sort((o,l)=>o.roundNumber-l.roundNumber);for(let o=1;o<s.length;o++){let l=s[o-1],u=s[o];u.day<l.day&&i.push({ruleId:"ORDERING_ROUND_DAY_SEQUENCE",phase:"ORDERING",severity:"WARN",message:`Round ${u.roundNumber} is scheduled on ${u.day} which is before round ${l.roundNumber} on ${l.day} (event: ${n.split("|")[0]})`,context:{day:u.day,planItemId:u.planItemId},fixAction:{type:"MOVE_PLAN_ITEM",description:`Move round ${u.roundNumber} to ${l.day} or later`,payload:{planItemId:u.planItemId,suggestedDay:l.day}}})}}return i}function WMe(t,e){let i=[];for(let r of e){let n=0,a=r.items.filter(p=>p.estimatedDurationMinutes);for(let p of a)n+=p.estimatedDurationMinutes;if(n===0)continue;let s=t.getVisibleTimeRange(r.day),o=Az(s.startTime),l=Az(s.endTime)-o,u=t.listCourtMeta(),c=new Set(r.items.map(p=>p.venueId)),d=(c.size===1?u.filter(p=>p.ref.venueId===[...c][0]):u).length*l;n>d?i.push({ruleId:"CAPACITY_DEMAND_EXCEEDS_SUPPLY",phase:"CAPACITY",severity:"WARN",message:`Estimated demand (${Math.round(n/60)}h) exceeds available court-hours (${Math.round(d/60)}h) on ${r.day}`,context:{day:r.day}}):n>d*.9&&i.push({ruleId:"CAPACITY_NEAR_LIMIT",phase:"CAPACITY",severity:"INFO",message:`Demand is at ${Math.round(n/d*100)}% of capacity on ${r.day}`,context:{day:r.day}})}return i}function Az(t){let[e,i]=t.split(":").map(Number);return e*60+i}var kz=["PRECHECK","INTEGRITY","ORDERING","CAPACITY"],zMe={PRECHECK:jMe,INTEGRITY:GMe,ORDERING:HMe,CAPACITY:WMe};function Gee(t){let{engine:e,day:i,phases:r}=t,n;if(i){let l=e.getDayPlan(i);n=l?[l]:[]}else n=e?.getAllPlans();let a=r?kz.filter(l=>r.includes(l)):kz,s=[];for(let l of a){let u=zMe[l],c=u(e,n);if(s.push(...c),l==="PRECHECK"&&c.some(d=>d.severity==="ERROR"))break}let o=new Map;for(let l of s){let u=l.context?.planItemId||"__global__",c=o.get(u)||[];c.push(l),o.set(u,c)}return{results:s,issueIndex:o}}var qMe={courtToCourtId:t=>t.courtId,isSchedulableStatus:t=>t===xt.AVAILABLE||t===xt.SOFT_BLOCK||t===xt.RESERVED,aggregateByVenue:!1};function Z$(t,e={}){let i={...qMe,...e},r=[];for(let n of t){let{day:a,venueId:s,rails:o}=n;for(let l of o){let{court:u,segments:c}=l,d=i.courtToCourtId(u),p=YMe(c,i);for(let f of p)r.push({date:a,startTime:Oz(f.start),endTime:Oz(f.end),venueId:s,courtIds:[d]})}}return i.aggregateByVenue?KMe(r):r}function YMe(t,e){let i=[],r=null,n=null;for(let a of t)e.isSchedulableStatus(a.status)?(r||(r=a.start),n=a.end):(r&&n&&i.push({start:r,end:n}),r=null,n=null);return r&&n&&i.push({start:r,end:n}),i}function Oz(t){return t.slice(11,16)}function KMe(t){let e=new Map;for(let i of t){let r=`${i.venueId}|${i.date}|${i.startTime}|${i.endTime}`;if(e.has(r)){let n=e.get(r);i.courtIds&&(n.courtIds=[...n.courtIds||[],...i.courtIds])}else e.set(r,{...i})}return Array.from(e.values())}function Hee(t){let{tournamentRecord:e,timelines:i,config:r={},engine:n}=t,a=Z$(i,r),s=structuredClone(e),o=new Map;for(let l of a){let u=o.get(l.venueId)||[];u.push(l),o.set(l.venueId,u)}if(s.venues&&Array.isArray(s.venues)){let l=n?.getConfig()?.tournamentId;for(let u of s.venues){let c=mh(u),d=o.get(c);if(d&&(u.dateAvailability=d),n&&l){let p=n.getVenueAvailability(l,c);p&&(u.defaultStartTime=p.startTime,u.defaultEndTime=p.endTime)}}}return s}function Wee(t){let e=[];for(let i of t)!i.scheduleDate||!i.venueIds.length||e.push({scheduleDate:i.scheduleDate,venueIds:i.venueIds,rounds:i.rounds||[]});return e}function zee(t){let{venue:e,tournamentId:i,blockType:r=xt.AVAILABLE}=t,n=[];if(!e.dateAvailability)return n;let a=mh(e);for(let s of e.dateAvailability){let{date:o,startTime:l,endTime:u,courtIds:c}=s;if(c&&c.length>0)for(let d of c)n.push({court:{tournamentId:i,venueId:a,courtId:d},start:`${o}T${l}:00`,end:`${o}T${u}:00`,type:r});else if(e.courts&&e.courts.length>0)for(let d of e.courts){let p=th(d);n.push({court:{tournamentId:i,venueId:a,courtId:p},start:`${o}T${l}:00`,end:`${o}T${u}:00`,type:r})}}return n}function qee(t){let e=[];if(!Array.isArray(t))return e.push("Profile must be an array"),{valid:!1,errors:e};for(let i=0;i<t.length;i++){let r=t[i];if(r.scheduleDate?/^\d{4}-\d{2}-\d{2}$/.test(r.scheduleDate)||e.push(`Item ${i}: invalid scheduleDate format (expected YYYY-MM-DD)`):e.push(`Item ${i}: missing scheduleDate`),(!r.venueIds||!Array.isArray(r.venueIds)||r.venueIds.length===0)&&e.push(`Item ${i}: missing or empty venueIds array`),r.rounds)if(!Array.isArray(r.rounds))e.push(`Item ${i}: rounds must be an array`);else for(let n=0;n<r.rounds.length;n++)r.rounds[n].eventId||e.push(`Item ${i}, round ${n}: missing eventId`)}return{valid:e.length===0,errors:e}}function Yee(t){let e=[];if(!Array.isArray(t))return e.push("Entries must be an array"),{valid:!1,errors:e};for(let i=0;i<t.length;i++){let r=t[i];(!r.date||!/^\d{4}-\d{2}-\d{2}$/.test(r.date))&&e.push(`Entry ${i}: invalid or missing date`),(!r.startTime||!/^\d{2}:\d{2}$/.test(r.startTime))&&e.push(`Entry ${i}: invalid or missing startTime (expected HH:MM)`),(!r.endTime||!/^\d{2}:\d{2}$/.test(r.endTime))&&e.push(`Entry ${i}: invalid or missing endTime (expected HH:MM)`),r.startTime&&r.endTime&&r.startTime>=r.endTime&&e.push(`Entry ${i}: startTime must be before endTime`),r.venueId||e.push(`Entry ${i}: missing venueId`)}return{valid:e.length===0,errors:e}}function Kee(t){if(t.length===0)return t;let e=new Map;for(let r of t){let n=`${r.venueId}|${r.date}`,a=e.get(n)||[];a.push(r),e.set(n,a)}let i=[];for(let r of e.values()){r.sort((a,s)=>a.startTime.localeCompare(s.startTime));let n={...r[0]};for(let a=1;a<r.length;a++){let s=r[a];s.startTime<=n.endTime?(n.endTime=s.endTime>n.endTime?s.endTime:n.endTime,n.courtIds&&s.courtIds&&(n.courtIds=[...new Set([...n.courtIds,...s.courtIds])])):(i.push(n),n={...s})}i.push(n)}return i}function Xee(t){let e=0;for(let i of t){let r=xz(i.startTime),n=(xz(i.endTime)-r)/60,a=i.courtIds?.length||1;e+=n*a}return e}function xz(t){let[e,i]=t.split(":").map(Number);return e*60+i}var Jee={};pt(Jee,{addCourt:()=>mM,addCourts:()=>E$,addVenue:()=>TS,deleteCourt:()=>ste,deleteVenue:()=>rB,deleteVenues:()=>tte,disableCourts:()=>ite,disableVenues:()=>rte,enableCourts:()=>nte,enableVenues:()=>ate,generate:()=>Qee,generateCourts:()=>t$,getCompetitionVenues:()=>jS,getCourts:()=>V_,getVenuesAndCourts:()=>_u,modifyCourt:()=>nB,modifyCourtAvailability:()=>tB,modifyVenue:()=>ote,mutate:()=>Zee,publicFindVenue:()=>_L,query:()=>SJ});var Qee={};pt(Qee,{generateCourts:()=>t$});var Zee={};pt(Zee,{addCourt:()=>mM,addCourts:()=>E$,addVenue:()=>TS,deleteCourt:()=>ste,deleteVenue:()=>rB,deleteVenues:()=>tte,disableCourts:()=>ite,disableVenues:()=>rte,enableCourts:()=>nte,enableVenues:()=>ate,modifyCourt:()=>nB,modifyCourtAvailability:()=>tB,modifyVenue:()=>ote});function eB(t){if(!t?.tournamentRecord&&!Array.isArray(t?.venueMatchUps))return{error:ge};if(!t?.courtId)return{error:cm};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:s}=Wc({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:o}=wr({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:o,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{let f=p.schedule?.allocatedCourts?.map(({courtId:h})=>h);return p.schedule?.courtId===c||f?.includes(c)});return NP({matchUps:d,schedulingProfile:s})}}function XMe({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:ge};if(!r)return{error:Vd};let{schedulingProfile:n}=Wc({tournamentRecord:e}),{matchUps:a}=wr({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:s({matchUps:a,venueId:r})};function s({matchUps:o,venueId:l}){let u=o.filter(c=>{let d=c.schedule?.allocatedCourts?.map(({venueId:p})=>p);return c.schedule?.venueId===l||d?.includes(l)});return NP({matchUps:u,schedulingProfile:n})}}function tB({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){if(!t)return{error:ge};if(!n)return{error:cm};let s=tC({dateAvailability:e});if(s.error)return s;let{updatedDateAvailability:o,totalMergeCount:l}=JMe(e);e=o;let u=Yd({tournamentRecord:t,courtId:n});if(u.error)return u;let{court:c,venue:d}=u,{matchUps:p}=eB({tournamentRecord:t,venueMatchUps:r,courtId:n});if(p?.length){let f=Rt({tournamentRecord:t})?.appliedPolicies,h=a??f?.[jd]?.allowDeletionWithScoresPresent?.courts,m=[];m.length&&(h||console.log("throw error: scheduled court matchUps",m.length))}return c&&(c.dateAvailability=e,!i&&d&&nt({payload:{venue:d,tournamentId:t.tournamentId},topic:Vc,key:d.venueId})),{...H,totalMergeCount:l}}function JMe(t){let e=0,i=t.reduce((n,a)=>{let{date:s,startTime:o,endTime:l,bookings:u}=a;return n[s]||(n[s]=[]),n[s].push({startTime:o,endTime:l,bookings:u}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(mbe);let{mergedAvailability:a,mergeCount:s}=QMe(i[n]);r.push(...a.map(o=>({date:n,...o}))),e+=s}),{updatedDateAvailability:r,totalMergeCount:e}}function QMe(t){let e,i,r,n=t.length,a=0,s=[];for(;t.length&&n;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(n-=1,!e)e=u,r=d,i=c;else if(Qw(tr(i),tr(u),!1)>0){let p={startTime:e,endTime:i};r?.length&&(p.bookings=r),s.push(p),e=u,r=d,i=c}else d&&(r?r.push(d):r=d),i=c,a+=1}let o={startTime:e,endTime:i};return r?.length&&(o.bookings=r),s.push(o),{mergedAvailability:s,mergeCount:a}}function iB({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:wK,info:e}}function ete({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:Tn};if(!e&&!r)return{error:Vo};let a;if(!e){if(!t)return{error:ge};({drawDefinition:e}=zn({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=pi({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:ge};let s=wr({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=b9({matchUps:s,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(s=>[Ud,vu].includes(s.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:s})=>![Ud,vu].includes(s)),Tt({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...H}):{error:cn}}function rB(t){if(typeof t?.venueId!="string")return{error:Vd};let{tournamentRecord:e,venueId:i,force:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(n).length)return{error:ge};let a=Oo({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],s=Rt({tournamentRecord:e})?.appliedPolicies,o=r??s?.[jd]?.allowDeletionWithScoresPresent?.venues;if(!a.length||o)for(let l of Object.values(n)){for(let c of a){let d=ete({matchUpId:c.matchUpId,drawId:c.drawId,tournamentRecord:l});if(d.error)return d}let u;l.venues=(l.venues??[]).filter(c=>c?.venueId!==i?!0:(u=!0,!1)),u&&nt({payload:{venueId:i,tournamentId:l.tournamentId},topic:gL,key:i})}else return iB({matchUpsCount:a.length});return YS({tournamentRecords:n}),{...H}}function tte({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:ge};if(!Array.isArray(e))return{error:ie};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,s=rB({tournamentRecord:t,venueId:a,force:i});if(s.error)return s}}return{...H}}function ite(t){let{courtIds:e,dates:i}=t,r=ws(t),n=[{[dn]:!0,[_R]:!0}],a=Ge(t,n);if(a.error)return a;for(let s of Object.values(r))ZMe({tournamentRecord:s,courtIds:e,dates:i});return{...H}}function ZMe({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>gt({extension:{value:r,name:To},creationTime:!1,element:a});for(let a of t.venues||[])for(let s of a.courts||[])if(e?.includes(s.courtId)){let o=n(s);if(o.error)return o}return{...H}}function rte(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[dn]:!0,[$R]:!0}],a=Ge(t,n);if(a.error)return a;let s=Object.keys(e).filter(o=>!i||o===i);for(let o of s){let l=e[o];eNe({tournamentRecord:l,venueIds:r})}return{...H}}function eNe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e?.includes(i.venueId)){let r=gt({creationTime:!1,element:i,extension:{name:To,value:!0}});if(r.error)return r}return{...H}}function nte(t){let e=ws(t),i=[{[dn]:!0}];!t.enableAll&&i.push({[_R]:!0});let r=Ge(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:s}=t;for(let o of Object.values(e))tNe({tournamentRecord:o,courtIds:a,enableAll:n,dates:s});return{...H}}function tNe({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e?.includes(a.courtId))if(Array.isArray(r)){let{extension:s}=it({element:a,name:To});if(s){let o=s.value;Array.isArray(o.dates)&&(o.dates=o.dates.filter(l=>!r.includes(l))),gt({extension:{name:To,value:o},creationTime:!1,element:a})}}else Mn({element:a,name:To});return{...H}}function ate(t){let e=ws(t),i=[{[dn]:!0}];!t.enableAll&&i.push({[$R]:!0});let r=Ge(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let s of Object.values(e))for(let o of s.venues||[])(a||n?.includes(o.venueId))&&Mn({element:o,name:To});return{...H}}function ste(t){let{courtId:e,disableNotice:i,force:r}=t,n=ws(t),a=Ge(t,[{[dn]:!0,[$5]:!0}]);if(a.error)return a;let s,o;for(let l of Object.values(n)){if(o=iNe({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),o.error&&o.error!==fc)return o;o.success&&(s=!0)}return s?{...H}:o}function iNe({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){let n=Yd({tournamentRecord:t,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:s}=eB({tournamentRecord:t,courtId:i}),o=Rt({tournamentRecord:t})?.appliedPolicies,l=r??o?.[jd]?.allowDeletionWithScoresPresent?.courts;if(!s?.length||l){for(let u of s??[]){let c=ete({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:t});if(c.error)return c}a&&(a.courts=(a.courts??[]).filter(u=>u.courtId!==i),e||nt({payload:{venue:a,tournamentId:t.tournamentId},topic:Vc,key:a.venueId}))}else return iB({matchUpsCount:s.length});return{...H}}function nB(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,s=ws(t);if(!Object.keys(s).length)return{error:Ri};let o;for(let l of Object.values(s)){let u=rNe({tournamentRecord:l,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(u?.error)return u;o=!0}return o?{...H}:void 0}function rNe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:ge};if(!n)return{error:cm};if(!r||typeof r!="object")return{error:_c};let s=Yd({tournamentRecord:t,courtId:n});if(s.error)return s;let{venue:o,court:l}=s,u=Object.keys(JCe()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>u.includes(p)).length)return{error:vR};let c=new Set(u.filter(p=>!["dateAvailability"].includes(p))),d=Object.keys(r).filter(p=>c.has(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=tB({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||nt({payload:{venue:o,tournamentId:t.tournamentId},topic:Vc,key:o?.venueId}),{...H,court:Oe(l)}}var nNe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,defaultStartTime:void 0,defaultEndTime:void 0,isPrimary:void 0,dateAvailability:[],addresses:[],contacts:[],courts:[],roles:[]}),aNe=nNe;function ote(t){let{modifications:e,venueId:i,force:r}=t,n=ws(t);if(!Object.keys(n).length)return{error:Ri};if(typeof i!="string")return{error:Vd};let a,s;for(let o of Object.values(n)){let l=lNe({tournamentRecord:o,modifications:e,venueId:i,force:r});if(l.success&&(s=!0),l.error&&(a=l.error),l.error&&l.error!==lf)return l}return YS({tournamentRecords:n}),s?{...H}:{error:a}}function sNe({venue:t,modifications:e,tournamentRecord:i,venueMatchUps:r,allowModificationWhenMatchUpsScheduled:n}){let a=t?.courts?.map(u=>u.courtId)??[],s=e.courts?.map(u=>u.courtId)||[],o=s.length?a.filter(u=>!s.includes(u)):e?.courts&&a,l=[];if(o?.length){let u=t?.courts?.filter(c=>o.includes(c.courtId))?.map(c=>{let d=eB({courtId:c.courtId,tournamentRecord:i,venueMatchUps:r});for(let p of d.matchUps??[])l.push({matchUpId:p.matchUpId,drawId:p.drawId});return d.matchUps?.length??0}).reduce((c,d)=>c+d);return t&&(!u||n)?(t.courts=t.courts?.filter(c=>s.includes(c.courtId)),Jb({schedule:{courtId:"",scheduledDate:""},matchUpDetails:l,removePriorValues:!0,tournamentRecord:i}),{success:!0}):iB({matchUpsCount:u})}return{success:!0}}function oNe({modifications:t,tournamentRecord:e,venueMatchUps:i,venueId:r,force:n}){if(t.courts)for(let a of t.courts){let{courtId:s}=a||{},o=nB({modifications:a,disableNotice:!0,tournamentRecord:e,venueMatchUps:i,courtId:s,force:n});if(o?.error===fc&&(o=mM({disableNotice:!0,tournamentRecord:e,venueId:r,court:a})),o?.error)return o}return{success:!0}}function lNe({tournamentRecord:t,modifications:e,venueId:i,force:r}){if(!t)return{error:ge};if(!e||typeof e!="object")return{error:_c};if(!i)return{error:Vd};let n=Rt({tournamentRecord:t})?.appliedPolicies,a=r??n?.[jd]?.allowDeletionWithScoresPresent?.venues,{matchUps:s}=XMe({tournamentRecord:t,venueId:i}),o=po({tournamentRecord:t,venueId:i});if(o.error)return o;let l=o.venue,u=Object.keys(aNe()).filter(g=>g!=="venueId");if(!Object.keys(e).filter(g=>u.includes(g)).length)return{error:vR};let c=new Set(u.filter(g=>!["courts","onlineResources","dateAvailability","isPrimary"].includes(g))),d=Object.keys(e).filter(g=>c.has(g));if(!l)return{error:lf};let p=e.defaultStartTime??l.defaultStartTime,f=e.defaultEndTime??l.defaultEndTime;if(p||f){if(!p||!f)return{error:ie,info:"both defaultStartTime and defaultEndTime are required"};if(!vP({startTime:p,endTime:f}))return{error:ie,info:"defaultEndTime must be after defaultStartTime"}}if(d.forEach(g=>Object.assign(l,{[g]:e[g]})),"isPrimary"in e&&(e.isPrimary?(Y7({tournamentRecord:t}),l.isPrimary=!0):delete l.isPrimary),e.dateAvailability!==void 0){if(Array.isArray(e.dateAvailability)&&e.dateAvailability.length){let g=tC({dateAvailability:e.dateAvailability});if(g.error)return g}l.dateAvailability=e.dateAvailability}let h=sNe({venue:l,modifications:e,tournamentRecord:t,venueMatchUps:s,allowModificationWhenMatchUpsScheduled:a});if("error"in h&&h.error)return h;let m=oNe({modifications:e,tournamentRecord:t,venueMatchUps:s,venueId:i,force:r});return m?.error?m:(YS({tournamentRecord:t}),l&&nt({payload:{venue:l,tournamentId:t.tournamentId},topic:Vc,key:l?.venueId}),{...H,venue:Oe(l)})}var yM={};pt(yM,{JSON2CSV:()=>mNe,UUID:()=>Pt,UUIDS:()=>WK,allNumeric:()=>e4,attributeFilter:()=>Fh,chunkArray:()=>br,chunkByNth:()=>UO,chunkSizeProfile:()=>Z6,constantToString:()=>Jr,countValues:()=>oIe,createMap:()=>Y6,dateTime:()=>HK,definedAttributes:()=>Ve,dehydrateMatchUps:()=>dNe,extractAttributes:()=>J7,flattenJSON:()=>aB,generateDateRange:()=>aI,generateHashCode:()=>iIe,generateRange:()=>Re,generateTimeCode:()=>rZ,groupValues:()=>J6,hasAttributeValues:()=>tIe,instanceCount:()=>Ta,intersection:()=>Fi,isConvertableInteger:()=>ut,isNumeric:()=>Mi,isOdd:()=>K6,isPowerOf2:()=>Mo,isValidEmbargoDate:()=>ld,makeDeepCopy:()=>Oe,matchUpScheduleSort:()=>cNe,matchUpSort:()=>Tm,nearestPowerOf2:()=>s1,nextPowerOf2:()=>nv,noNulls:()=>sIe,noNumeric:()=>t4,numericSort:()=>ar,occurrences:()=>uIe,overlap:()=>Ln,randomMember:()=>Ia,randomPop:()=>ba,shuffleArray:()=>Rn,structureSort:()=>vm,subSort:()=>cIe,timeZone:()=>_Ce,undefinedToNull:()=>wO,unique:()=>ot,visualizeScheduledMatchUps:()=>uNe});function uNe({scheduledMatchUps:t,showGlobalLog:e}){Fbe();let i=t?.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:s}=t.find(o=>o.structureId===n);return{[n]:`${a} ${s}`}})};i?.forEach(n=>{Ht({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let a=t.filter(o=>o.structureId===n),s=wn({matchUps:a})?.roundMatchUps||[];Object.keys(s).forEach(o=>{Ht({roundNumber:o,keyColors:{roundNumber:"brightcyan"}},!0),s[o].forEach(({matchUpId:l,schedule:u})=>{let c=di(u.scheduledTime);Ht({matchUpId:l,time:c,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&xbe()}var{extractTime:Fz,timeStringMinutes:Lz}=HK;function cNe(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=Lz(Fz(i.scheduledTime)),a=Lz(Fz(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function dNe({tournamentRecord:t}){if(!t)return{error:ge};if(typeof t!="object"||!t.tournamentId)return{error:ie};let{matchUps:e}=wr({tournamentRecord:t,inContext:!1});if(e?.length){let i=pNe({tournamentRecord:t});hNe(e,i)}return{...H}}function pNe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var fNe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function hNe(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,s=e[r]||e[n]||e[a],o=i.matchUpFormat===s?void 0:i.matchUpFormat;for(let l of Object.keys(i))fNe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}function mNe(t,e){if(e&&typeof e!="object")return{error:ie};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:s,onlyHeaderRow:o,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:f='"',columnJoiner:h=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof h!="string"||typeof m!="string"||typeof g!="string"||typeof f!="string")return{error:ie};i=Object.assign({},...Object.keys(i).reverse().map(M=>({[M]:Array.isArray(i[M])?i[M]:[typeof i[M]=="string"&&i[M]].filter(Boolean)})));let I=t.filter(Boolean).map(M=>aB(M,g)),v=Object.values(i).flat();r&&l.push(...v);let w=I.reduce((M,N)=>Object.keys(N).every(A=>!M.includes(A)&&M.push(A)||!0)&&M,[]).filter(M=>!l?.length||l.includes(M)),y=Object.assign({},...Object.keys(i).reverse().map(M=>i[M].map(N=>({[N]:M})).flat()).flat()),b=(M,N)=>e?.sortOrder?e.sortOrder.includes(M)&&e.sortOrder.includes(N)&&e.sortOrder.indexOf(M)-e.sortOrder.indexOf(N)||!e.sortOrder.includes(N)&&-1:0,S=w.reduce((M,N)=>{let A=y[N];return A?M.includes(A)||M.push(A):M.push(N),M},[]).sort(b);Object.keys(c).forEach(M=>!S.includes(M)&&S.unshift(M)),Object.keys(i).forEach(M=>!S.includes(M)&&S.unshift(M)),typeof p=="object"&&Object.keys(p).forEach(M=>!S.includes(M)&&S.unshift(M));let U=S.map(M=>c[M]||M);if(o)return[U];let T=M=>`${f}${M}${f}`,D=[],P=M=>Object.values(S.reduce((N,A,O)=>{let k=i[A],F=(k?.length?M[k.find($=>M[$])]:M[A])||p?.[A]||"",x=d[A]?.[F]||F,L=va(u[A])?u[A](x):x;return N[A]=T(L),L&&(D[O]=(D[O]||0)+1),N},{})),E=I.map(P),R=s&&[...D].map((M,N)=>!M&&N).filter(Mi).reverse();if(R){let M=N=>N.filter((A,O)=>!R.includes(O));E=E.map(M),U=M(U)}let C=E.map(M=>M.join(h));return a?C.map(M=>{let N=M.split(h);return Object.assign({},...N.map((A,O)=>({[U[O]]:A})))}):n?[U.map(T).join(h),...C].join(m):C.join(m)}function aB(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,aB(t[n],e,i.concat(n))),{})}var{FACTORY:_z}=Y5;function gNe({tournamentRecord:t,value:e}){let{extension:i}=it({element:t,name:_z}),r={name:_z,value:{...i?.value,...e}};gt({element:t,extension:r})}function lte({timeStamp:t}){let e=fm(),i=O1();return i&&Object.values(e).forEach(r=>{gNe({tournamentRecord:r,value:{version:oR(),timeStamp:t}})}),i}function ute({engineType:t,methodName:e,elapsed:i,params:r,result:n}){let a=ua();if(typeof a!="object")return;let s={method:e},o=n?.error&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&a.params?.includes(e),u=a.params&&!Array.isArray(a.params)||l,c=Array.isArray(a.exclude)&&a.exclude.includes(e);!c&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(s.elapsed=i),!c&&(o||u)&&(s.params=r),!c&&(o||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&a.result?.includes(e))&&(s.result=n),Object.keys(s).length>1&&AK(s,t)}function sB({methodName:t,params:e,start:i}){let r={error:yR,methodName:t},n=i?Date.now()-i:0;return ute({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}var INe={setMatchUpHomeParticipantId:"SCHEDULING",calculateScheduleTimes:"SCHEDULING",addMatchUpScheduledDate:"SCHEDULING",bulkScheduleTournamentMatchUps:"SCHEDULING",toggleParticipantCheckInState:"SCHEDULING",removeMatchUpCourtAssignment:"SCHEDULING",proAutoSchedule:"SCHEDULING",bulkUpdateCourtAssignments:"SCHEDULING",allocateTeamMatchUpCourts:"SCHEDULING",scheduleMatchUps:"SCHEDULING",addSchedulingProfileRound:"SCHEDULING",proConflicts:"SCHEDULING",reorderUpcomingMatchUps:"SCHEDULING",generateVirtualCourts:"SCHEDULING",bulkRescheduleMatchUps:"SCHEDULING",clearScheduledMatchUps:"SCHEDULING",matchUpScheduleChange:"SCHEDULING",bulkScheduleMatchUps:"SCHEDULING",scheduleProfileRounds:"SCHEDULING",clearMatchUpSchedule:"SCHEDULING",addMatchUpScheduledTime:"SCHEDULING",setMatchUpDailyLimits:"SCHEDULING",assignMatchUpCourt:"SCHEDULING",assignMatchUpVenue:"SCHEDULING",generateBookings:"SCHEDULING",validateSchedulingProfile:"SCHEDULING",setSchedulingProfile:"SCHEDULING",addCourtGridBooking:"SCHEDULING",removeCourtGridBooking:"SCHEDULING",addMatchUpCourtOrder:"SCHEDULING",addMatchUpStartTime:"SCHEDULING",addMatchUpEndTime:"SCHEDULING",addMatchUpStopTime:"SCHEDULING",addMatchUpResumeTime:"SCHEDULING",addMatchUpOfficial:"SCHEDULING",addMatchUpScheduleItems:"SCHEDULING",setDrawParticipantRepresentativeIds:"DRAWS",resetVoluntaryConsolationStructure:"DRAWS",withdrawParticipantAtDrawPosition:"DRAWS",addVoluntaryConsolationStructure:"DRAWS",luckyLoserDrawPositionAssignment:"DRAWS",shiftAdHocRounds:"DRAWS",setPositionAssignments:"DRAWS",swapAdHocRounds:"DRAWS",alternateDrawPositionAssignment:"DRAWS",removeDrawPositionAssignment:"DRAWS",automatedPlayoffPositioning:"DRAWS",modifySeedAssignment:"DRAWS",qualifierDrawPositionAssignment:"DRAWS",qualifierProgression:"DRAWS",setStructureOrder:"DRAWS",attachQualifyingStructure:"DRAWS",renameStructures:"DRAWS",assignDrawPositionBye:"DRAWS",addDrawDefinitionTimeItem:"DRAWS",removeStructure:"DRAWS",addVoluntaryConsolationStage:"DRAWS",resetQualifyingStructure:"DRAWS",swapDrawPositionAssignments:"DRAWS",removeSeededParticipant:"DRAWS",addQualifyingStructure:"DRAWS",adHocPositionSwap:"DRAWS",addPlayoffStructures:"DRAWS",automatedPositioning:"DRAWS",modifyDrawDefinition:"DRAWS",resetDrawDefinition:"DRAWS",pruneDrawDefinition:"DRAWS",assignDrawPosition:"DRAWS",deleteAdHocMatchUps:"DRAWS",removeRoundMatchUps:"DRAWS",updateTeamLineUp:"DRAWS",addAdHocMatchUps:"DRAWS",modifyDrawName:"DRAWS",setSubOrder:"DRAWS",attachConsolationStructures:"DRAWS",attachPlayoffStructures:"DRAWS",attachStructures:"DRAWS",generateDrawTypeAndModifyDrawDefinition:"DRAWS",generateAndPopulatePlayoffStructures:"DRAWS",generateDrawMaticRound:"DRAWS",generateVoluntaryConsolation:"DRAWS",generateDrawDefinition:"DRAWS",generateQualifyingStructure:"DRAWS",generateDrawStructuresAndLinks:"DRAWS",generateAdHocMatchUps:"DRAWS",generateAdHocRounds:"DRAWS",drawMatic:"DRAWS",addFinishingRounds:"DRAWS",buildDrawHierarchy:"DRAWS",autoSeeding:"DRAWS",setMatchUpStatus:"SCORING",setMatchUpState:"SCORING",bulkMatchUpStatusUpdate:"SCORING",setDelegatedOutcome:"SCORING",removeDelegatedOutcome:"SCORING",updateTieMatchUpScore:"SCORING",resetScorecard:"SCORING",setOrderOfFinish:"SCORING",resetAdHocMatchUps:"SCORING",applyLineUps:"SCORING",resetTieFormat:"SCORING",enableTieAutoCalc:"SCORING",disableTieAutoCalc:"SCORING",resetMatchUpLineUps:"SCORING",assignMatchUpSideParticipant:"MATCHUPS",replaceTieMatchUpParticipantId:"MATCHUPS",assignTieMatchUpParticipantId:"MATCHUPS",removeTieMatchUpParticipantId:"MATCHUPS",removeMatchUpSideParticipant:"MATCHUPS",substituteParticipant:"MATCHUPS",checkOutParticipant:"MATCHUPS",checkInParticipant:"MATCHUPS",setMatchUpFormat:"MATCHUPS",createMatchUp:"SCORING",addPoint:"SCORING",resolvePointValue:"SCORING",calculatePointsTo:"SCORING",inferServeSide:"SCORING",modifyPersonRequests:"PARTICIPANTS",removePersonRequests:"PARTICIPANTS",addPersonRequests:"PARTICIPANTS",setParticipantScaleItems:"PARTICIPANTS",setParticipantScaleItem:"PARTICIPANTS",modifyIndividualParticipantIds:"PARTICIPANTS",createTeamsFromParticipantAttributes:"PARTICIPANTS",modifyParticipantsSignInStatus:"PARTICIPANTS",addIndividualParticipantIds:"PARTICIPANTS",modifyParticipantOtherName:"PARTICIPANTS",regenerateParticipantNames:"PARTICIPANTS",addDynamicRatings:"PARTICIPANTS",createGroupParticipant:"PARTICIPANTS",modifyParticipantName:"PARTICIPANTS",scaledTeamAssignment:"PARTICIPANTS",removeRatings:"PARTICIPANTS",removePenalty:"PARTICIPANTS",modifyPenalty:"PARTICIPANTS",deleteParticipants:"PARTICIPANTS",mergeParticipants:"PARTICIPANTS",modifyParticipant:"PARTICIPANTS",addParticipants:"PARTICIPANTS",addPenalty:"PARTICIPANTS",addParticipant:"PARTICIPANTS",addPersons:"PARTICIPANTS",removeIndividualParticipantIds:"PARTICIPANTS",removeParticipantIdsFromAllTeams:"PARTICIPANTS",destroyPairEntries:"ENTRIES",destroyPairEntry:"ENTRIES",setEntryPosition:"ENTRIES",setEntryPositions:"ENTRIES",promoteAlternate:"ENTRIES",promoteAlternates:"ENTRIES",removeDrawEntries:"ENTRIES",modifyEntriesStatus:"ENTRIES",addEventEntryPairs:"ENTRIES",removeEventEntries:"ENTRIES",modifyEventEntries:"ENTRIES",addDrawEntries:"ENTRIES",addEventEntries:"ENTRIES",deleteFlightProfileAndFlightDraws:"EVENTS",modifyEventMatchUpFormatTiming:"EVENTS",removeEventMatchUpFormatTiming:"EVENTS",setEventDates:"EVENTS",setEventEndDate:"EVENTS",setEventStartDate:"EVENTS",deleteFlightAndFlightDraw:"EVENTS",refreshEventDrawOrder:"EVENTS",modifyPairAssignment:"EVENTS",updateDrawIdsOrder:"EVENTS",addDrawDefinition:"EVENTS",deleteDrawDefinitions:"EVENTS",assignSeedPositions:"EVENTS",attachFlightProfile:"EVENTS",removeScaleValues:"EVENTS",setEventDisplay:"EVENTS",validateCategory:"EVENTS",removeSeeding:"EVENTS",deleteEvents:"EVENTS",modifyEvent:"EVENTS",addFlight:"EVENTS",addEvent:"EVENTS",generateEventsFromTieFormat:"EVENTS",modifyCourtAvailability:"VENUES",deleteVenue:"VENUES",deleteVenues:"VENUES",addCourt:"VENUES",addCourts:"VENUES",disableCourts:"VENUES",disableVenues:"VENUES",enableCourts:"VENUES",enableVenues:"VENUES",deleteCourt:"VENUES",modifyCourt:"VENUES",modifyVenue:"VENUES",addVenue:"VENUES",publishEventSeeding:"PUBLISHING",unPublishEventSeeding:"PUBLISHING",unPublishParticipants:"PUBLISHING",unPublishOrderOfPlay:"PUBLISHING",publishParticipants:"PUBLISHING",publishOrderOfPlay:"PUBLISHING",unPublishEvent:"PUBLISHING",publishEvent:"PUBLISHING",setTournamentStatus:"TOURNAMENT",setTournamentName:"TOURNAMENT",setTournamentNotes:"TOURNAMENT",setTournamentCategories:"TOURNAMENT",setTournamentDates:"TOURNAMENT",setTournamentEndDate:"TOURNAMENT",setTournamentStartDate:"TOURNAMENT",addTournamentExtension:"TOURNAMENT",removeTournamentExtension:"TOURNAMENT",modifyCollectionDefinition:"TIE_FORMAT",removeCollectionGroup:"TIE_FORMAT",orderCollectionDefinitions:"TIE_FORMAT",removeCollectionDefinition:"TIE_FORMAT",addCollectionGroup:"TIE_FORMAT",addCollectionDefinition:"TIE_FORMAT",modifyTieFormat:"TIE_FORMAT",aggregateTieFormats:"TIE_FORMAT",attachPolicies:"POLICY",removePolicy:"POLICY",linkTournaments:"COMPETITION",unlinkTournament:"COMPETITION",unlinkTournaments:"COMPETITION",applyTournamentRankingPoints:"RANKING"};function vNe(t,e,i){if(!e||!i||!i.extensions?.find(o=>o?.name===Pn)?.value?.enabled)return;let r=INe[t];if(!r)return;let n=e.lockToken,a=new Date().toISOString(),s=[];if(e.drawDefinition&&s.push({element:e.drawDefinition,label:`draw:${e.drawDefinition.drawId}`}),e.event&&s.push({element:e.event,label:`event:${e.event.eventId}`}),e.venueId){let o=po({tournamentRecord:i,venueId:e.venueId});o.venue&&s.push({element:o.venue,label:`venue:${e.venueId}`})}s.push({element:i,label:"tournament"});for(let{element:o,label:l}of s){let u=yNe({element:o,scope:r,methodName:t,lockToken:n,now:a,label:l});if(u)return u}}function yNe({element:t,scope:e,methodName:i,lockToken:r,now:n,label:a}){let{extension:s}=it({element:t,name:Pn});if(!s?.value?.locks?.length)return;let o=s.value,l=!1;for(let u=o.locks.length-1;u>=0;u--){let c=o.locks[u];if(c.scope===e&&!(c.methods&&!c.methods.includes(i))){if(c.expiresAt!==null&&c.expiresAt<=n){o.locks.splice(u,1),l=!0;continue}if(r&&r===c.lockToken){l&&gt({element:t,extension:{name:Pn,value:o},creationTime:!1});return}return l&&gt({element:t,extension:{name:Pn,value:o},creationTime:!1}),{error:IK,info:`Locked by ${a} (scope: ${c.scope}, lockId: ${c.lockId})`}}}l&&gt({element:t,extension:{name:Pn,value:o},creationTime:!1})}function bNe(t,e){if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:ge};let i=e.drawId||e.matchUp?.drawId;if(i){let{event:a,drawDefinition:s,tournamentId:o}=zn({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),o&&(e.tournamentId=o),a&&(e.event=a)}if(e.eventId&&!e.event){let{event:a,tournamentId:s}=zn({eventId:e.eventId,tournamentRecords:t});if(!a)return{error:ds};e.tournamentId=s,e.event=a}let r=e.tournamentId??pm();if(!r&&e)return e;let n=t[r];return r&&!n?{error:ge}:(n&&(e.tournamentRecord=n),e)}function oB(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),s=pm();i&&(i.activeTournamentId=s);let o=i?.tournamentRecord||F1(s),l=typeof i?.tournamentRecord=="object"&&{[i?.tournamentRecord.tournamentId]:i.tournamentRecord}||fm(),u=i?Oe(i,void 0,!0):void 0,c=i?bNe(l,i):void 0;if(c?.error)return c;let d=vNe(r,c,o);if(d)return d;let p=wNe({params:c,tournamentRecords:l,tournamentRecord:o,methodName:r,method:e}),f=Date.now()-a;return ute({result:p,methodName:r,elapsed:f,params:u,engineType:n}),p}function wNe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(ua())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return SR({engineName:"engine",methodName:r,params:i,err:a})}}function bM(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=bs();for(let s of[...a].sort(SNe)){let o=CK({topic:s});o?.length&&kO({topic:s,notices:o})}e&&n&&a.includes(VO)&&kO({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:VO})}var $z={[TL]:5,[UL]:5,[DL]:5,[SL]:5,[wL]:5,[yL]:5,[c7]:5,[d7]:5,[hP]:1,[bL]:1,[zR]:1,[tn]:5,[Vc]:5,[vL]:4,[mL]:4,[gL]:4,[IL]:4,[WR]:3,[pL]:2};function SNe(t,e){return($z[e]||0)-($z[t]||0)}function UNe({convertExtensions:t,removeExtensions:e}){let i=fm();return{tournamentId:pm(),tournamentRecords:Oe(i,t,!1,e)}}function TNe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=t?.tournamentId??pm();if(typeof r!="string")return{};let n=F1(r);return{tournamentRecord:Oe(n,e,!1,i)}}function DNe(){let t=fm(),{extension:e}=it({name:xp,tournamentRecords:t,discover:!0}),i=e?.value?.tournamentIds||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),wR(t)}function Bz(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:_c}:t?.tournamentId?MK(e?Oe(t):t):{error:ie}}function Zb(t,e=!0){if(typeof t!="object")return{error:_c};if(Nb(),Array.isArray(t)){if(t.filter(i=>i?.tournamentId).length!==t.length)return{error:DO};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t?.tournamentId)t={[t.tournamentId]:t},Nb(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:DO};return wR(e?Oe(t):t)}function PNe(t,e,i,r,n,a){let s=kK(i,r,n,a);if(s.error)return s;let o=s.methods??[];return Object.keys(o).filter(l=>va(o[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:o[l],...u});if(ua())return c();try{return c()}catch(d){SR({engineName:"engine",methodName:l,params:u,err:d})}}}),{...H,...t}}function Ig(t,e){return e?.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function cte(t,e){t.importMethods=(i,r,n,a)=>PNe(t,e,i,r,n,a),t.getTournament=i=>TNe(i),t.getState=i=>UNe({convertExtensions:i?.convertExtensions,removeExtensions:i?.removeExtensions}),t.version=()=>oR(),t.reset=()=>(wR({}),Ig(t)),t.devContext=i=>(Cb(i),Ig(t)),t.getDevContext=i=>ua(i),t.newTournamentRecord=(i={})=>{let r=fM(i),n=r.tournamentId;return r.error?r:(Bz(r),Nb(n),{...H,tournamentId:n})},t.setState=(i,r,n)=>{Mb(r,n);let a=Zb(i,r);return Ig(t,a)},t.setTournamentId=i=>Nb(i),t.getTournamentId=()=>pm(),t.setTournamentRecord=(i,r,n)=>{Mb(r,n);let a=Bz(i,r);return Ig(t,a)},t.removeTournamentRecord=i=>{let r=NK(i);return Ig(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=DNe();return Ig(t,i)}}function ENe(t,e,i){if(!Array.isArray(e))return{error:ie,message:"directives must be an array"};let r=RK(),n=Date.now(),a=i&&Oe(fm(),!1,!0),s=[];for(let u of e){if(typeof u!="object")return{error:ie,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:ie,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!r[c])return sB({methodName:c,start:n,params:p});if(d){let h=s.at(-1),m=Object.keys(d);for(let g of m)h[g]&&(p[g]=h[g])}let f=oB(t,r[c],p,c,"sync");if(f?.error)return a&&Zb(a),{...f,rolledBack:!!a};s.push({...f,methodName:c})}let o=Date.now(),l=lte({timeStamp:o});return bM({directives:e,mutationStatus:l,timeStamp:o}),Xw(),{success:s.every(u=>u.success),results:s}}function Vz(t,e){if(!St(e))return{error:ie,message:"args must be an object"};let i=Object.values(e).filter(va).length;if(i>1)return{message:"there must be only one arg with typeof function",error:ie};let r=i?Object.keys(e).find(f=>va(e[f])):ni(e.method)&&e.method;if(!r)return{error:yR};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=s.rollbackOnError&&Oe(fm(),!1,!0),l=n||t[r]||A1()[r];if(!l)return sB({methodName:r,params:s});let u=oB(t,l,s,r,"sync")??{};u?.error&&o&&Zb(o);let c=Date.now(),d=lte({timeStamp:c}),p=u?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&bM({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:c}),(p||!u?.success||s?.doNotNotify)&&Xw(),u}var RNe=(()=>{let t={executionQueue:(e,i)=>ENe(t,e,i),execute:e=>Vz(t,e)};return cte(t,Vz),t})(),lB=RNe;function jz(t,e){if(!St(e))return{error:ie,message:"args must be an object"};let i=Object.values(e).filter(va).length;if(i>1)return{message:"there must be only one arg with typeof function",error:ie};let r=i?Object.keys(e).find(l=>va(e[l])):ni(e.method)&&e.method;if(!r)return{error:yR};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=n||t[r]||A1()[r];return o?oB(t,o,s,r,"ask"):sB({methodName:r,params:s})}(()=>{let t={execute:e=>jz(t,e)};return cte(t,jz),t})();var gh={},sd;function dte(t,e=!0){if(!t)return{error:Xe};if(typeof t!="object")return{error:_c};if(t.matchUpId)sd=t.matchUpId,gh[sd]=e?Oe(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(gh[i.matchUpId]=e?Oe(i):i,sd||(sd=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(gh[i.matchUpId]=e?Oe(i):i,sd||(sd=i.matchUpId));return e?Oe(t):t}function CNe(){return gh[sd]}function MNe(){return Object.values(gh)}function NNe(){sd=void 0,gh={}}function ANe(t){return Oe(gh[sd],t?.convertExtensions,!1,t?.removeExtensions)}(()=>{let t={getState:i=>ANe(i),version:()=>oR(),reset:()=>(NNe(),{...H}),drawId:void 0,error:void 0,success:!1,devContext:i=>(Cb(i),t),setState:(i,r,n)=>{Mb(r,n);let a=dte(i);return e(a)}};function e(i){return i?.error?(t.error=i.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=i.drawId),t}return kNe(t,[B0]),t})();function kNe(t,e){e.forEach(i=>{Object.keys(i).forEach(r=>{t[r]=n=>{if(ua())return Gz(t,{params:n,governor:i,methodName:r});try{return Gz(t,{params:n,governor:i,methodName:r})}catch(a){SR({engineName:"matchUpEngine",methodName:r,params:n,err:a})}}})})}function Gz(t,{params:e,governor:i,methodName:r}){t.error=void 0,t.success=!1;let n=e?.matchUp||CNe(),a=e?.matchUps||MNe(),s=e?.rollbackOnError&&Oe(n,!1,!0);e={...e,matchUpId:n?.matchUpId,matchUps:a,matchUp:n};let o=i[r](e);if(o?.error)return s&&dte(s),{...o,rolledBack:!!s};let l=o?.success&&e?.delayNotify!==!0&&e?.doNotNotify!==!0;return l&&bM(),(l||!o?.success||e?.doNotNotify)&&Xw(),o}var vk=!1;(()=>{let t={version:()=>oR(),setDeepCopy:(n,a)=>(Mb(n,a),t),devContext:n=>(Cb(n),vk=!0,t)};return i([I$]),t;function e(n,a){let s=n({...a});return s?.error||bM(),Xw(),vk&&(Cb(!1),vk=!1),s}function i(n){n.forEach(a=>{Object.keys(a).forEach(s=>{t[s]=r(a,s)})})}function r(n,a){return s=>{if(ua()){let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&Zb(o.tournamentRecord),o}else try{let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&Zb(o.tournamentRecord),o}catch(o){let l;typeof o=="string"?l=o.toUpperCase():o instanceof Error&&(l=o.message),console.log("ERROR",{params:JSON.stringify(s),method:a,error:l})}}}})();var ONe={};pt(ONe,{BLOCK_TYPES:()=>xt,EvaluatorRegistry:()=>Fee,TemporalEngine:()=>xNe,adjacentBlockEvaluator:()=>q$,applyTemporalAvailabilityToTournamentRecord:()=>Hee,blockDurationEvaluator:()=>K$,buildDayRange:()=>Dee,buildEdges:()=>$$,buildSchedulingProfileFromUISelections:()=>Wee,calculateCapacityStats:()=>Eee,calculateCourtHours:()=>Xee,clampDragToCollisions:()=>kee,clampToDayRange:()=>L$,compareCapacityCurves:()=>Mee,computePlanItemId:()=>BP,courtDayKey:()=>rb,courtKey:()=>xg,courtOverlapEvaluator:()=>W$,createFollowByEvaluator:()=>Lee,dayBoundaryEvaluator:()=>X$,defaultEvaluators:()=>xee,deriveRailSegments:()=>V$,diffMinutes:()=>rU,extractDay:()=>lp,filterCapacityCurve:()=>Ree,findBlocksContainingTime:()=>Aee,formatConflicts:()=>Bee,generateCapacityCurve:()=>G$,getHighestSeverity:()=>$ee,groupConflictsBySeverity:()=>_ee,hhmmToMinutes:()=>Qb,intervalsOverlap:()=>Nee,iterateDayTicks:()=>jee,lightingEvaluator:()=>Y$,maintenanceWindowEvaluator:()=>J$,matchWindowEvaluator:()=>z$,mergeAdjacentSegments:()=>j$,mergeOverlappingAvailability:()=>Kee,minutesToHhmm:()=>vM,overlappingRange:()=>Tee,railsToDateAvailability:()=>Z$,rangesOverlap:()=>_$,resolveCourtId:()=>th,resolveStatus:()=>$P,resolveVenueId:()=>mh,runValidationPipeline:()=>Gee,sampleCapacityCurve:()=>Cee,snapIsoToGranularity:()=>Vee,snapToGranularity:()=>Q$,sortBlocksByStart:()=>Oee,sortEdges:()=>B$,timeInsideBlock:()=>H$,todsAvailabilityToBlocks:()=>zee,validateDateAvailability:()=>Yee,validateSchedulingProfileFormat:()=>qee,validateSegments:()=>Pee,venueDayKey:()=>Uee,venueKey:()=>Jf});var pd,xNe=(pd=class{constructor(){this.tournamentRecord=null,this.blocksById=new Map,this.blocksByCourtDay=new Map,this.courtDayAvailability=new Map,this.venueDayAvailability=new Map,this.templates=new Map,this.rules=new Map,this.plans=new Map,this.subscribers=[],this.resolvedGranularity=15,this.nextBlockId=1}init(e,i){this.tournamentRecord=e,this.config={tournamentId:i?.tournamentId||e?.tournamentId||"tournament-1",dayStartTime:i?.dayStartTime||"06:00",dayEndTime:i?.dayEndTime||"23:00",slotMinutes:i?.slotMinutes||15,granularityMinutes:i?.granularityMinutes,typePrecedence:i?.typePrecedence||[xt.HARD_BLOCK,xt.LOCKED,xt.MAINTENANCE,xt.BLOCKED,xt.PRACTICE,xt.RESERVED,xt.SOFT_BLOCK,xt.AVAILABLE,xt.UNSPECIFIED],conflictEvaluators:i?.conflictEvaluators||[]},this.resolvedGranularity=this.config.granularityMinutes??this.config.slotMinutes??15,this.plans.clear(),this.loadBlocksFromTournamentRecord(),this.emit({type:"STATE_CHANGED",payload:{reason:"INIT"}})}updateTournamentRecord(e){this.tournamentRecord=e,this.loadBlocksFromTournamentRecord(),this.emit({type:"STATE_CHANGED",payload:{reason:"TOURNAMENT_RECORD_UPDATED"}})}getConfig(){return{...this.config}}getResolvedGranularityMinutes(){return this.resolvedGranularity}getCourtAvailability(e,i){let r=xg(e),n=this.courtDayAvailability.get(`${r}|${i}`)??this.courtDayAvailability.get(`${r}|DEFAULT`)??null,a=Jf(e.tournamentId,e.venueId),s=this.venueDayAvailability.get(`${a}|${i}`)??this.venueDayAvailability.get(`${a}|DEFAULT`)??null;if(n&&s){let l=n.startTime>s.startTime?n.startTime:s.startTime,u=n.endTime<s.endTime?n.endTime:s.endTime;return l>=u?s:{startTime:l,endTime:u}}return n||s||this.courtDayAvailability.get("GLOBAL|DEFAULT")||{startTime:this.config.dayStartTime,endTime:this.config.dayEndTime}}setCourtAvailability(e,i,r){let n=xg(e);this.courtDayAvailability.set(`${n}|${i}`,r),this.emit({type:"AVAILABILITY_CHANGED",payload:{court:e,day:i,avail:r}})}setCourtAvailabilityAllDays(e,i){let r=xg(e);this.courtDayAvailability.set(`${r}|DEFAULT`,i),this.emit({type:"AVAILABILITY_CHANGED",payload:{court:e,scope:"all-days",avail:i}})}setAllCourtsDefaultAvailability(e){this.courtDayAvailability.set("GLOBAL|DEFAULT",e),this.emit({type:"AVAILABILITY_CHANGED",payload:{scope:"global",avail:e}})}getVenueAvailability(e,i,r){let n=Jf(e,i);if(r){let a=this.venueDayAvailability.get(`${n}|${r}`);if(a)return a}return this.venueDayAvailability.get(`${n}|DEFAULT`)??null}setVenueDefaultAvailability(e,i,r){let n=Jf(e,i);this.venueDayAvailability.set(`${n}|DEFAULT`,r),this.emit({type:"AVAILABILITY_CHANGED",payload:{tournamentId:e,venueId:i,scope:"venue",avail:r}})}setVenueDayAvailability(e,i,r,n){let a=Jf(e,i);this.venueDayAvailability.set(`${a}|${r}`,n),this.emit({type:"AVAILABILITY_CHANGED",payload:{tournamentId:e,venueId:i,day:r,scope:"venue-day",avail:n}})}getVisibleTimeRange(e,i){let r=i&&i.length>0?i:this.getAllCourtsFromTournamentRecord(),n="23:59",a="00:00";for(let s of r){let o=this.getCourtAvailability(s,e);o.startTime<n&&(n=o.startTime),o.endTime>a&&(a=o.endTime)}return r.length===0?{startTime:this.config.dayStartTime,endTime:this.config.dayEndTime}:{startTime:n,endTime:a}}getTournamentDays(){if(!this.tournamentRecord?.startDate)return[];let e=this.tournamentRecord.startDate,i=this.tournamentRecord.endDate||e,r=[],n=new Date(e),a=new Date(i);for(;n<=a;)r.push(n.toISOString().slice(0,10)),n.setDate(n.getDate()+1);return r}getDayTimeline(e){let i=this.getAllCourtsFromTournamentRecord(),r=new Map;for(let a of i){let s=r.get(a.venueId)||[];s.push(a),r.set(a.venueId,s)}let n=[];for(let[a,s]of r.entries()){let o=[];for(let l of s){let u=this.getCourtRail(e,l);u&&o.push(u)}n.push({day:e,venueId:a,rails:o})}return n}getVenueTimeline(e,i){return this.getDayTimeline(e).find(r=>r.venueId===i)||null}getCourtRail(e,i){let r=this.getCourtAvailability(i,e),n={start:`${e}T${r.startTime}:00`,end:`${e}T${r.endTime}:00`},a=rb(i,e),s=(this.blocksByCourtDay.get(a)||[]).map(l=>this.blocksById.get(l)).filter(l=>!!l),o=V$(s,n,this.config);return{court:i,segments:o}}getCapacityCurve(e){let i=this.getDayTimeline(e);return G$(e,i)}getDayBlocks(e){let i=[];for(let r of this.blocksById.values())lp(r.start)===e&&i.push(r);return i}getAllBlocks(){return Array.from(this.blocksById.values())}getTemplates(){return Array.from(this.templates.values())}getTemplate(e){return this.templates.get(e)||null}getRules(){return Array.from(this.rules.values())}getRule(e){return this.rules.get(e)||null}addPlanItem(e){let i=BP(e),r={...e,planItemId:i},n=this.plans.get(e.day)||{day:e.day,items:[]};return n.items=n.items.filter(a=>a.planItemId!==i),n.items.push(r),this.plans.set(e.day,n),this.emit({type:"PLAN_CHANGED",payload:{action:"ADD",planItem:r}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),r}removePlanItem(e){for(let[i,r]of this.plans.entries()){let n=r.items.findIndex(a=>a.planItemId===e);if(n!==-1){let a=r.items.splice(n,1)[0];return r.items.length===0&&this.plans.delete(i),this.emit({type:"PLAN_CHANGED",payload:{action:"REMOVE",planItem:a}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),!0}}return!1}updatePlanItem(e,i){for(let r of this.plans.values()){let n=r.items.find(a=>a.planItemId===e);if(n)return Object.assign(n,i),this.emit({type:"PLAN_CHANGED",payload:{action:"UPDATE",planItem:n}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),n}return null}movePlanItem(e,i){let r=null;for(let[s,o]of this.plans.entries()){let l=o.items.findIndex(u=>u.planItemId===e);if(l!==-1){r=o.items.splice(l,1)[0],o.items.length===0&&this.plans.delete(s);break}}if(!r)return null;let n={...r,day:i};n.planItemId=BP(n);let a=this.plans.get(i)||{day:i,items:[]};return a.items=a.items.filter(s=>s.planItemId!==n.planItemId),a.items.push(n),this.plans.set(i,a),this.emit({type:"PLAN_CHANGED",payload:{action:"MOVE",planItem:n,fromDay:r.day}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),n}getDayPlan(e){return this.plans.get(e)||null}getAllPlans(){return Array.from(this.plans.values())}applyBlock(e){let i=[];for(let r of e.courts){let n=lp(e.timeRange.start),a=this.clampToAvailability(r,n,e.timeRange.start,e.timeRange.end);if(!a)continue;let s={id:this.generateBlockId(),court:r,start:a.start,end:a.end,type:e.type,reason:e.reason,hardSoft:e.hardSoft,source:e.source||"USER"};i.push({kind:"ADD_BLOCK",block:s})}return this.applyMutations(i)}moveBlock(e){let i=this.blocksById.get(e.blockId);if(!i)return{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${e.blockId} not found`}],conflicts:[]};let r=e.newCourt||i.court,n=lp(e.newTimeRange.start),a=this.clampToAvailability(r,n,e.newTimeRange.start,e.newTimeRange.end);if(!a)return{applied:[],rejected:[],warnings:[{code:"OUTSIDE_AVAILABILITY",message:"Block falls outside court availability"}],conflicts:[]};let s={...i,start:a.start,end:a.end,court:r};return this.applyMutations([{kind:"UPDATE_BLOCK",block:s,previousBlock:i}])}resizeBlock(e){let i=this.blocksById.get(e.blockId);if(!i)return{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${e.blockId} not found`}],conflicts:[]};let r=lp(e.newTimeRange.start),n=this.clampToAvailability(i.court,r,e.newTimeRange.start,e.newTimeRange.end);if(!n)return{applied:[],rejected:[],warnings:[{code:"OUTSIDE_AVAILABILITY",message:"Block falls outside court availability"}],conflicts:[]};let a={...i,start:n.start,end:n.end};return this.applyMutations([{kind:"UPDATE_BLOCK",block:a,previousBlock:i}])}removeBlock(e){let i=this.blocksById.get(e);return i?this.applyMutations([{kind:"REMOVE_BLOCK",block:i}]):{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${e} not found`}],conflicts:[]}}applyTemplate(e){return this.templates.get(e.templateId)?{applied:[],rejected:[],warnings:[],conflicts:[]}:{applied:[],rejected:[],warnings:[{code:"TEMPLATE_NOT_FOUND",message:`Template ${e.templateId} not found`}],conflicts:[]}}importScheduledMatchUps(e){let i=[];for(let a of this.blocksById.values())a.type===xt.SCHEDULED&&a.source==="SYSTEM"&&i.push({kind:"REMOVE_BLOCK",block:a});for(let a of i)this.applyMutation(a);let r=[];for(let a of e){let s=a.startTime.length===5?`${a.startTime}:00`:a.startTime,o=this.timeToMinutes(s)+a.durationMinutes,l=Math.floor(o/60),u=o%60,c=`${String(l).padStart(2,"0")}:${String(u).padStart(2,"0")}:00`,d={id:this.generateBlockId(),court:{tournamentId:this.config.tournamentId,venueId:a.venueId,courtId:a.courtId},start:`${a.date}T${s}`,end:`${a.date}T${c}`,type:xt.SCHEDULED,source:"SYSTEM",matchUpId:a.matchUpId,reason:"Scheduled Match"};r.push({kind:"ADD_BLOCK",block:d})}let n=this.applyMutations(r);return{...n,applied:[...i,...n.applied]}}timeToMinutes(e){let i=e.split(":").map(Number);return i[0]*60+i[1]}simulateBlocks(e,i){let r=this.createSnapshot(),n=r.applyMutations(e),a=i||this.getFirstAvailableDay(),s=a?r.getDayTimeline(a):[],o=a?r.getCapacityCurve(a):void 0;return{previewRails:s,capacityImpact:o,conflicts:n.conflicts}}subscribe(e){return this.subscribers.push(e),()=>{let i=this.subscribers.indexOf(e);i>-1&&this.subscribers.splice(i,1)}}emit(e){for(let i of this.subscribers)try{i(e)}catch(r){console.error("Error in event listener:",r)}}applyMutations(e){let i=this.evaluateConflicts(e);if(i.filter(n=>n.severity==="ERROR").length>0)return{applied:[],rejected:e,warnings:[],conflicts:i};let r=[];for(let n of e)this.applyMutation(n),r.push(n);return this.emit({type:"BLOCKS_CHANGED",payload:{mutations:r}}),this.emit({type:"STATE_CHANGED",payload:{reason:"BLOCKS_MUTATED"}}),i.length>0&&this.emit({type:"CONFLICTS_CHANGED",payload:{conflicts:i}}),{applied:r,rejected:[],warnings:i.filter(n=>n.severity==="WARN").map(n=>({code:n.code,message:n.message})),conflicts:i}}applyMutation(e){let{kind:i,block:r,previousBlock:n}=e;switch(i){case"ADD_BLOCK":this.blocksById.set(r.id,r),this.indexBlock(r);break;case"UPDATE_BLOCK":n&&this.unindexBlock(n),this.blocksById.set(r.id,r),this.indexBlock(r);break;case"REMOVE_BLOCK":this.unindexBlock(r),this.blocksById.delete(r.id);break}}indexBlock(e){let i=lp(e.start),r=rb(e.court,i),n=this.blocksByCourtDay.get(r)||[];n.includes(e.id)||(n.push(e.id),this.blocksByCourtDay.set(r,n))}unindexBlock(e){let i=lp(e.start),r=rb(e.court,i),n=(this.blocksByCourtDay.get(r)||[]).filter(a=>a!==e.id);n.length>0?this.blocksByCourtDay.set(r,n):this.blocksByCourtDay.delete(r)}evaluateConflicts(e){let i=this.createContext(),r=[];for(let n of this.config.conflictEvaluators||[])try{let a=n.evaluate(i,e);r.push(...a)}catch(a){console.error(`Error in evaluator ${n.id}:`,a)}return r}createContext(){return{config:this.config,tournamentRecord:this.tournamentRecord,blocksById:new Map(this.blocksById),blocksByCourtDay:new Map(this.blocksByCourtDay),templates:new Map(this.templates),rules:new Map(this.rules)}}createSnapshot(){let e=new pd;return e.config={...this.config},e.tournamentRecord=this.tournamentRecord,e.blocksById=new Map(this.blocksById),e.blocksByCourtDay=new Map(this.blocksByCourtDay),e.courtDayAvailability=new Map(this.courtDayAvailability),e.venueDayAvailability=new Map(this.venueDayAvailability),e.templates=new Map(this.templates),e.rules=new Map(this.rules),e.plans=new Map([...this.plans.entries()].map(([i,r])=>[i,{...r,items:[...r.items]}])),e.nextBlockId=this.nextBlockId,e.resolvedGranularity=this.resolvedGranularity,e}loadBlocksFromTournamentRecord(){if(this.blocksById.clear(),this.blocksByCourtDay.clear(),this.courtDayAvailability.clear(),this.venueDayAvailability.clear(),!!this.tournamentRecord?.venues)for(let e of this.tournamentRecord.venues){let i=mh(e),r=Jf(this.config.tournamentId,i);if(e.defaultStartTime&&e.defaultEndTime&&this.venueDayAvailability.set(`${r}|DEFAULT`,{startTime:e.defaultStartTime,endTime:e.defaultEndTime}),e.dateAvailability?.length){for(let n of e.dateAvailability)if(n.date?n.startTime&&n.endTime&&this.venueDayAvailability.set(`${r}|${n.date}`,{startTime:n.startTime,endTime:n.endTime}):n.startTime&&n.endTime&&this.venueDayAvailability.set(`${r}|DEFAULT`,{startTime:n.startTime,endTime:n.endTime}),n.bookings?.length&&e.courts?.length){let a=n.date||this.tournamentRecord.startDate;for(let s of n.bookings){if(!s.startTime||!s.endTime)continue;let o=s.startTime.length===5?`${s.startTime}:00`:s.startTime,l=s.endTime.length===5?`${s.endTime}:00`:s.endTime,u=pd.BOOKING_TYPE_MAP[(s.bookingType||"").toUpperCase()]||xt.RESERVED;for(let c of e.courts){let d={tournamentId:this.config.tournamentId,venueId:i,courtId:th(c)},p=this.generateBlockId(),f={id:p,court:d,start:`${a}T${o}`,end:`${a}T${l}`,type:u,reason:s.bookingType||"Booking",source:"SYSTEM"};this.blocksById.set(p,f),this.indexBlock(f)}}}}for(let n of e.courts||[]){if(!n.dateAvailability?.length)continue;let a={tournamentId:this.config.tournamentId,venueId:i,courtId:th(n)};for(let s of n.dateAvailability){let o=s.date||this.tournamentRecord.startDate;if(s.startTime&&s.endTime){let l=xg(a);this.courtDayAvailability.set(`${l}|${o}`,{startTime:s.startTime,endTime:s.endTime})}if(s.bookings?.length)for(let l of s.bookings){if(!l.startTime||!l.endTime)continue;let u=l.startTime.length===5?`${l.startTime}:00`:l.startTime,c=l.endTime.length===5?`${l.endTime}:00`:l.endTime,d=pd.BOOKING_TYPE_MAP[(l.bookingType||"").toUpperCase()]||xt.RESERVED,p=this.generateBlockId(),f={id:p,court:a,start:`${o}T${u}`,end:`${o}T${c}`,type:d,reason:l.bookingType||"Booking",source:"SYSTEM"};this.blocksById.set(p,f),this.indexBlock(f)}}}}}getAllCourtsFromTournamentRecord(){if(!this.tournamentRecord?.venues)return[];let e=[];for(let i of this.tournamentRecord.venues){let r=mh(i);if(i.courts)for(let n of i.courts)e.push({tournamentId:this.config.tournamentId,venueId:r,courtId:th(n)})}return e}getFirstAvailableDay(){return this.tournamentRecord?.startDate?Qe(this.tournamentRecord.startDate):null}generateBlockId(){return`block-${this.nextBlockId++}`}clampToAvailability(e,i,r,n){let a=this.getCourtAvailability(e,i),s=`${i}T${a.startTime}:00`,o=`${i}T${a.endTime}:00`,l=r<s?s:r,u=n>o?o:n;return l>=u?null:{start:l,end:u}}listCourtMeta(){return this.getAllCourtsFromTournamentRecord().map(e=>this.getCourtMeta(e))}getCourtMeta(e){if(this.tournamentRecord?.venues){for(let i of this.tournamentRecord.venues)if(mh(i)===e.venueId)for(let r of i.courts||[]){if(th(r)!==e.courtId)continue;let n=this.getFirstAvailableDay(),a=n?this.getCourtAvailability(e,n):void 0;return{ref:e,name:r.courtName||r.courtId,surface:r.surfaceCategory||r.surfaceType||"hard",indoor:r.indoorOutdoor==="INDOOR"||r.indoor||!1,hasLights:r.hasLights||!1,tags:[],openTime:a?.startTime,closeTime:a?.endTime}}}return{ref:e,name:e.courtId,surface:"hard",indoor:!1,hasLights:!1,tags:[]}}},pd.BOOKING_TYPE_MAP={MAINTENANCE:xt.MAINTENANCE,PRACTICE:xt.PRACTICE,RESERVED:xt.RESERVED,MATCH:xt.SCHEDULED,SCHEDULED:xt.SCHEDULED},pd),FNe={calculateNewRatings:aX,generateDynamicRatings:sX};lB.importMethods({...N$,...FNe});lB.importMethods(H6,!0,1);var LNe=lB,_Ne={ratingsParameters:Pr},pte={};pt(pte,{activeMatchUpStatuses:()=>dL,auditConstants:()=>wRe,competitionFormatConstants:()=>zNe,completedMatchUpStatuses:()=>Ji,directingMatchUpStatuses:()=>r7,displayConstants:()=>jUe,drawDefinitionConstants:()=>kR,entryStatusConstants:()=>Fye,errorConditionConstants:()=>NIe,eventConstants:()=>G1,extensionConstants:()=>Y5,flightConstants:()=>ORe,genderConstants:()=>UR,keyValueConstants:()=>kDe,matchUpActionConstants:()=>KUe,matchUpStatusConstants:()=>s7,matchUpTypes:()=>Zge,nonDirectingMatchUpStatuses:()=>n7,particicipantsRequiredMatchUpStatuses:()=>t7,participantConstants:()=>y7,participantRoles:()=>XL,participantTypes:()=>Jy,penaltyConstants:()=>cAe,policyConstants:()=>pye,positionActionConstants:()=>QSe,rankingConstants:()=>VEe,ratingConstants:()=>Vbe,recoveryTimeRequiredMatchUpStatuses:()=>Tye,requestConstants:()=>RCe,resourceContants:()=>kve,resultConstants:()=>fIe,scaleConstants:()=>lye,scheduleConstants:()=>dbe,sortingConstants:()=>VRe,surfaceConstants:()=>gAe,tieFormatConstants:()=>xve,timeItemConstants:()=>abe,topicConstants:()=>Dye,tournamentConstants:()=>$9,upcomingMatchUpStatuses:()=>a7,validMatchUpStatuses:()=>i7,venueConstants:()=>yAe,weekdayConstants:()=>VJ});var $Ne="INTENNSE_STANDARD",BNe="TENNIS_STANDARD",VNe="MATCHUP",jNe="HALF",GNe="SEGMENT",HNe="BETWEEN_GAMES",WNe="BETWEEN_POINTS",zNe={INTENNSE_STANDARD:$Ne,TENNIS_STANDARD:BNe,MATCHUP:VNe,SET:"SET",HALF:jNe,SEGMENT:GNe,BETWEEN_GAMES:HNe,BETWEEN_POINTS:WNe,ANY:"ANY"},qNe="Coaching",YNe="Ball Abuse",KNe="Racket Abuse",XNe="Verbal Abuse",JNe="INELIGIBILITY",QNe="Physical Abuse",ZNe="Unsportmanlike Conduct",eAe="Dress Code Violation",tAe="Equipment Violation",iAe="Leaving the court",rAe="Failure to complete",nAe="No Show",aAe="Other",sAe="REFUSAL_TO_PLAY",oAe="PROHIBITED_SUBSTANCE",lAe="Puncuality",uAe="Failure to sign in",cAe={COACHING:qNe,BALL_ABUSE:YNe,RACKET_ABUSE:KNe,VERBAL_ABUSE:XNe,PHYSICAL_ABUSE:QNe,INELIGIBILITY:JNe,UNSPORTSMANLIKE_CONDUCT:ZNe,PROHIBITED_SUBSTANCE:oAe,DRESS_CODE_VIOLATION:eAe,EQUIMENT_VIOLATION:tAe,LEAVING_THE_COURT:iAe,REFUSAL_TO_PLAY:sAe,FAILURE_TO_COMPLETE:rAe,NO_SHOW:nAe,OTHER:aAe,PUNCTUALITY:lAe,FAILUIRE_TO_SIGN_IN:uAe},dAe="CLAY",pAe="HARD",fAe="GRASS",hAe="CARPET",mAe="ARTIFICIAL",gAe={CLAY:dAe,HARD:pAe,GRASS:fAe,CARPET:hAe,ARTIFICIAL:mAe},IAe="INDOOR",vAe="OUTDOOR",yAe={INDOOR:IAe,OUTDOOR:vAe};const{AFTER_REST:bAe,FOLLOWED_BY:wAe,NEXT_AVAILABLE:SAe,NOT_BEFORE:UAe,TO_BE_ANNOUNCED:TAe}=pte.timeItemConstants,wx="overlay",Hi="center",Hz="header",Hh="right",Gp="left",Wz="top",Sx="",HT="flex",Xo="none",DAe="buttonBar",zz="roundsColumns",PAe=8,qz="roundsStats",Yz="roundsTable",EAe={[bAe]:"After rest",[wAe]:"Followed by",[TAe]:"TBA",[SAe]:"Next available",[UAe]:"NB"};function Zu(t){return typeof t=="function"}function Ux(t){return typeof t=="object"&&!Array.isArray(t)}const yk="font-medium";function Ih(t){const{target:e,button:i,stateChange:r}=t;let n=0;const a=()=>(n+=1,`Item${n}`),s=document.createElement("div");i.class&&s.classList.add(i.class),s.classList.add("dropdown"),i.id&&(s.id=i.id),i.align===Hh?(s.classList.add("is-right"),s.style.marginLeft="1em"):s.style.marginRight="1em";const o=v=>v.classList.contains("is-active"),l=()=>{o(s)&&s.classList.remove("is-active")},u=v=>{o(v)?v.classList.remove("is-active"):v.classList.add("is-active")};s.onmouseleave=l,s.onclick=()=>u(s);const c=document.createElement("div");c.classList.add("dropdown-trigger");const d=document.createElement("button");d.className="button font-medium",i.intent&&d.classList.add(i.intent),d.setAttribute("aria-haspopup","true");const p=document.createElement("span");Zu(i.onClick)&&(p.onclick=i.onClick),p.style.marginRight="1em",p.innerHTML=i.label,d.appendChild(p);const f=document.createElement("span");Zu(i.onClick)&&(f.onclick=i.onClick),f.innerHTML=`
      <span class="icon is-small font-medium">
        âŒ„
      </span>
  `,f.style.height="2em",d.appendChild(f),c.appendChild(d),s.appendChild(c);const h=document.createElement("div");h.classList.add("dropdown-menu"),h.style.zIndex="99998";const m=document.createElement("div");m.classList.add("dropdown-content");const g=()=>{const v=h.querySelectorAll(".dropdown-item");for(const w of Array.from(v))w.classList.remove("is-active")},I=v=>{const w=document.createElement("a");w.className=yk;const y=v.disabled?"0.4":"1";return w.style.textDecoration="none",w.style.opacity=y,v.color&&(w.style.color=v.color),w.classList.add("dropdown-item"),v.isActive&&w.classList.add("is-active"),v.value&&w.setAttribute("value",v.value),v.class&&w.classList.add(v.class),w.onclick=b=>{if(v.disabled)return;v.value&&(d.value=v.value,s.setAttribute("value",v.value)),b.stopPropagation(),Zu(v.onClick)&&(Zu(r)&&r(),v.onClick(b)),v.close&&l();const S=o(w);g(),S?p.innerHTML=i.label:(i.selection&&u(w),i.modifyLabel&&v.modifyLabel!==!1&&(p.innerHTML=`${i.append?i.label+": ":""}${v?.label||a()}`))},w.innerHTML=v?.label||a(),w};for(const v of i.options||[])if(v.heading){const w=document.createElement("div");w.style.fontWeight="bold",w.classList.add("dropdown-item"),w.classList.add(yk),w.innerHTML=v.heading,m.appendChild(w)}else if(v.divider){const w=document.createElement("hr");w.classList.add("dropdown-divider"),w.classList.add(yk),m.appendChild(w)}else v.hide||m.appendChild(I(v));return i.options?.length&&(i.options[0].value&&s.setAttribute("value",i.options[0].value),h.appendChild(m)),s.appendChild(h),e&&e.appendChild(s),s}function RAe(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}class xa{constructor(e){this.table=e}reloadData(e,i,r){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,r)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,r){return this.table.deprecationAdvisor.check(e,i,r)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class Ir{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,r){var n=e?i.split(e):[i],a=n.length,s;for(let o=0;o<a&&(r=r[n[o]],s=r,!!r);o++);return s}static deepClone(e,i,r=[]){var n={}.__proto__,a=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var s in e){let o=e[s],l,u;o!=null&&typeof o=="object"&&(o.__proto__===n||o.__proto__===a)&&(l=r.findIndex(c=>c.subject===o),l>-1?i[s]=r[l].copy:(u=Object.assign(Array.isArray(o)?[]:{},o),r.unshift({subject:o,copy:u}),i[s]=this.deepClone(o,u,r)))}return i}}let CAe=class fte extends xa{constructor(e,i,r){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=r,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),r=i?e.touches[0].pageX:e.pageX,n=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let a=Ir.elOffset(this.container);r-=a.left,n-=a.top}return{x:r,y:n}}elementPositionCoords(e,i="right"){var r=Ir.elOffset(e),n,a,s;switch(this.container!==document.body&&(n=Ir.elOffset(this.container),r.left-=n.left,r.top-=n.top),i){case"right":a=r.left+e.offsetWidth,s=r.top-1;break;case"bottom":a=r.left,s=r.top+e.offsetHeight;break;case"left":a=r.left,s=r.top-1;break;case"top":a=r.left,s=r.top;break;case"center":a=r.left+e.offsetWidth/2,s=r.top+e.offsetHeight/2;break}return{x:a,y:s,offset:r}}show(e,i){var r,n,a,s,o;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(a=e,o=this.elementPositionCoords(e,i),s=o.offset,r=o.x,n=o.y):typeof e=="number"?(s={top:0,left:0},r=e,n=i):(o=this.containerEventCoords(e),r=o.x,n=o.y,this.reversedX=!1),this.element.style.top=n+"px",this.element.style.left=r+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(r,n,a,s,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,r,n,a){var s=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;(e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",r?this.element.style.right=this.container.offsetWidth-n.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0);let o=Math.max(this.container.offsetHeight,s?this.container.scrollHeight:0);i+this.element.offsetHeight>o&&(r?a==="bottom"?this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-r.offsetHeight-1+"px":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+r.offsetHeight+1+"px":this.element.style.height=o+"px")}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new fte(this.table,e,this),this.childPopup}};class oi extends xa{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...r)=>(this.table.initGuard(e),i(...r)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,r){return this.table.componentFunctionBinder.bind(e,i,r)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,r;if(this._handler&&(r=this.table.rowManager.displayPipeline.findIndex(n=>n.handler===this._handler),r>-1&&(i=r)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new CAe(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}}var MAe={rownum:function(t,e,i,r,n,a){return a.getPosition()}};class VP extends oi{static moduleName="accessor";static accessors=MAe;constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="accessor"+(n.charAt(0).toUpperCase()+n.slice(1)),s;e.definition[a]&&(s=this.lookupAccessor(e.definition[a]),s&&(i=!0,r[a]={accessor:s,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.accessor=r)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":VP.accessors[e]?i=VP.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var r="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),n=e.getComponent(),a=Ir.deepClone(e.data||{});return this.table.columnManager.traverse(function(s){var o,l,u,c;s.modules.accessor&&(l=s.modules.accessor[r]||s.modules.accessor.accessor||!1,l&&(o=s.getFieldValue(a),o!="undefined"&&(c=s.getComponent(),u=typeof l.params=="function"?l.params(o,a,i,c,n):l.params,s.setFieldValue(a,l.accessor(o,a,i,u,c,n)))))}),a}}var NAe={method:"GET"};function Tx(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(Tx(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(Tx(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}function AAe(t){var e=Tx(t),i=[];return e.forEach(function(r){i.push(encodeURIComponent(r.key)+"="+encodeURIComponent(r.value))}),i.join("&")}function hte(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+AAe(i)),t}function kAe(t,e,i){var r;return new Promise((n,a)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(r=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],r){for(var s in r.headers)e.headers||(e.headers={}),typeof e.headers[s]>"u"&&(e.headers[s]=r.headers[s]);e.body=r.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(o=>{o.ok?o.json().then(l=>{n(l)}).catch(l=>{a(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+o.status,o.statusText),a(o))}).catch(o=>{console.error("Ajax Load Error - Connection Error: ",o),a(o)})):(console.warn("Ajax Load Error - No URL Set"),n([]))})}function Dx(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(Dx(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(Dx(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}var OAe={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var r=Dx(i),n=new FormData;return r.forEach(function(a){n.append(a.key,a.value)}),n}}};class Fg extends oi{static moduleName="ajax";static defaultConfig=NAe;static defaultURLGenerator=hte;static defaultLoaderPromise=kAe;static contentTypeFormatters=OAe;constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=Fg.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||Fg.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||Fg.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,r,n){var a=this.table.options.ajaxParams;return a&&(typeof a=="function"&&(a=a.call(this.table)),n=Object.assign(Object.assign({},a),n)),n}requestDataCheck(e,i,r,n){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,r,n,a){var s;return!a&&this.requestDataCheck(e)?(e&&this.setUrl(e),s=this.generateConfig(r),this.sendRequest(this.url,i,s)):a}setDefaultConfig(e={}){this.config=Object.assign({},Fg.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,r){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,r,i).then(n=>(this.table.options.ajaxResponse&&(n=this.table.options.ajaxResponse.call(this.table,e,i,n)),n)):Promise.reject()}}var xAe={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)}},FAe={table:function(t){var e=[],i=!0,r=this.table.columnManager.columns,n=[],a=[];return t=t.split(`
`),t.forEach(function(s){e.push(s.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(s){var o=r.find(function(l){return s&&l.definition.title&&s.trim()&&l.definition.title.trim()===s.trim()});o?n.push(o):i=!1}),i||(i=!0,n=[],e[0].forEach(function(s){var o=r.find(function(l){return s&&l.field&&s.trim()&&l.field.trim()===s.trim()});o?n.push(o):i=!1}),i||(n=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(s){var o={};s.forEach(function(l,u){n[u]&&(o[n[u].field]=l)}),a.push(o)}),a):!1}},LAe={copyToClipboard:["ctrl + 67","meta + 67"]},_Ae={copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}},$Ae={keybindings:{bindings:LAe,actions:_Ae}};class jP extends oi{static moduleName="clipboard";static moduleExtensions=$Ae;static pasteActions=xAe;static pasteParsers=FAe;constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,r,n;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(n=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),r=this.table.modules.export.generateHTMLTable(n),i=r?this.generatePlainContent(n):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),r=this.table.options.clipboardCopyFormatter("html",r))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),r&&e.clipboardData.setData("text/html",r)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),r&&e.originalEvent.clipboardData.setData("text/html",r)),this.dispatchExternal("clipboardCopied",i,r),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(r=>{var n=[];r.columns.forEach(a=>{var s="";if(a)if(r.type==="group"&&(a.value=a.component.getKey()),a.value===null)s="";else switch(typeof a.value){case"object":s=JSON.stringify(a.value);break;case"undefined":s="";break;default:s=a.value}n.push(s)}),i.push(n.join("	"))}),i.join(`
`)}copy(e,i){var r,n;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),r=window.getSelection(),r.toString()&&i&&(this.customSelection=r.toString()),r.removeAllRanges(),r.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(n=document.body.createTextRange(),n.moveToElementText(this.table.element),n.select()),document.execCommand("copy"),r&&r.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=jP.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=jP.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,r,n;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),r=this.pasteParser.call(this,i),r?(e.preventDefault(),this.table.modExists("mutator")&&(r=this.mutateData(r)),n=this.pasteAction.call(this,r),this.dispatchExternal("clipboardPasted",i,r,n)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(r=>{i.push(this.table.modules.mutator.transformRow(r,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,r=this.confirm("clipboard-paste",[e]);return(r||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}}class BAe{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class mte{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,r)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class nU extends xa{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var e=this.element,i=this.column.getField(),r={top:"flex-start",bottom:"flex-end",middle:"center"},n={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=r[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=n[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var a=this.column.definition.cssClass.split(" ");a.forEach(s=>{e.classList.add(s)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,r){var n=this.setValueProcessData(e,i,r);n&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,r){var n=!1;return(this.value!==e||r)&&(n=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),n&&this.dispatch("cell-value-changed",this),n}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new mte(this)),this.component}}class gte{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._column.table.componentFunctionBinder.handle("column",i._column,r)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var r=this._column.table.columnManager.findColumn(e);r?this._column.table.columnManager.moveColumn(this._column,r,i):console.warn("Move Error - No matching column found:",r)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var Ite={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};class ec extends xa{static defaultOptionList=Ite;constructor(e,i,r){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=r,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((n,a)=>{var s=new ec(n,this);this.attachColumn(s)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.isRowHeader&&e.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(ec.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{ec.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(r=>{this.element.classList.add(r)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var r=document.createElement("input");r.classList.add("tabulator-title-editor"),r.addEventListener("click",n=>{n.stopPropagation(),r.focus()}),r.addEventListener("mousedown",n=>{n.stopPropagation()}),r.addEventListener("change",()=>{e.title=r.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(r),e.field?this.langBind("columns|"+e.field,n=>{r.value=n||e.title||"&nbsp;"}):r.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,n=>{this._formatColumnHeaderTitle(i,n||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var r=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof r){case"object":r instanceof Node?e.appendChild(r):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",r));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=r}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,r=this.fieldStructure,n=r.length,a;for(let s=0;s<n&&(i=i[r[s]],a=i,!!i);s++);return a}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var r=e,n=this.fieldStructure,a=n.length;for(let s=0;s<a;s++)if(s==a-1)r[n[s]]=i;else{if(!r[n[s]])if(typeof i<"u")r[n[s]]={};else break;r=r[n[s]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var r=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=r+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=r-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(n){n.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(r){i.push(r.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.table.initialized&&(this.element.style.width=e+"px"),this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(n){n.delete()}),this.dispatch("column-delete",this);var r=this.cells.length;for(let n=0;n<r;n++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new nU(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(n=>{n.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(n=>{var a=n.getWidth();a>i&&(i=a)}),i)){var r=i+1;e?this.setWidth(r):(this.maxInitialWidth&&!e&&(r=Math.min(r,this.maxInitialWidth)),this.setWidthActual(r))}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(r=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>r.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new gte(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof ec?this.parent.getComponent():!1}}class wM{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class La extends xa{constructor(e,i,r="row"){super(i.table),this.parent=i,this.data={},this.type=r,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,r=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(r=this.calcMinHeight(),i=this.calcMaxHeight(),e?this.height=Math.max(i,r):this.height=this.manualHeight?this.height:Math.max(i,r)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var e=0;return this.cells.forEach(function(i){var r=i.getHeight();r>e&&(e=r)}),e}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&Ir.elVisible(this.element),r={},n;return new Promise((a,s)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(r=Object.assign(r,this.data),r=Object.assign(r,e)),n=this.chain("row-data-changing",[this,r,e],null,e);for(let o in n)this.data[o]=n[o];this.dispatch("row-data-save-after",this);for(let o in e)this.table.columnManager.getColumnsByFieldRoot(o).forEach(u=>{let c=this.getCell(u.getField());if(c){let d=u.getFieldValue(n);c.getValue()!==d&&(c.setValueProcessData(d),i&&c.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),a()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(r){return r.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var r=this.table.rowManager.findRow(e);r?(this.table.rowManager.moveRowActual(this,r,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new wM(this)),this.component}}var VAe={avg:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:2;return t.length&&(r=t.reduce(function(a,s){return Number(a)+Number(s)}),r=r/t.length,r=n!==!1?r.toFixed(n):r),parseFloat(r).toString()},max:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a>r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},min:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a<r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},sum:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(a){a=Number(a),r+=isNaN(a)?0:Number(a)}),n!==!1?r.toFixed(n):r},concat:function(t,e,i){var r=0;return t.length&&(r=t.reduce(function(n,a){return String(n)+String(a)})),r},count:function(t,e,i){var r=0;return t.length&&t.forEach(function(n){n&&r++}),r},unique:function(t,e,i){var r=t.filter((n,a)=>(t||n===0)&&t.indexOf(n)===a);return r.length}};class Lg extends oi{static moduleName="columnCalcs";static calculations=VAe;constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new ec({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,r={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":Lg.calculations[i.topCalc]?r.topCalc=Lg.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":r.topCalc=i.topCalc;break}r.topCalc&&(e.modules.columnCalcs=r,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":Lg.calculations[i.bottomCalc]?r.botCalc=Lg.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":r.botCalc=i.bottomCalc;break}r.botCalc&&(e.modules.columnCalcs=r,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,r;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),r=this.generateRow("top",i),this.topRow=r;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(r.getElement()),r.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),r=this.generateRow("bottom",i),this.botRow=r;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(r.getElement()),r.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,r;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),r=this.generateRowData("bottom",i),e.calcs.bottom.updateData(r),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),r=this.generateRowData("top",i),e.calcs.top.updateData(r),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[],r=this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs,n=this.table.modules.dataTree;return e.forEach(a=>{i.push(a.getData()),r&&a.modules.dataTree?.open&&this.rowsToData(n.getFilteredTreeChildren(a)).forEach(s=>{i.push(a)})}),i}generateRow(e,i){var r=this.generateRowData(e,i),n;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),n=new La(r,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),n.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),n.component=!1,n.getComponent=()=>(n.component||(n.component=new BAe(n)),n.component),n.generateCells=()=>{var a=[];this.table.columnManager.columnsByIndex.forEach(s=>{this.genColumn.setField(s.getField()),this.genColumn.hozAlign=s.hozAlign,s.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.lookupFormatter(s.definition[e+"CalcFormatter"]),params:s.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.lookupFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=s.definition.cssClass;var o=new nU(this.genColumn,n);o.getElement(),o.column=s,o.setWidth(),s.cells.push(o),a.push(o),s.visible||o.hide()}),n.cells=a},n}generateRowData(e,i){var r={},n=e=="top"?this.topCalcs:this.botCalcs,a=e=="top"?"topCalc":"botCalc",s,o;return n.forEach(function(l){var u=[];l.modules.columnCalcs&&l.modules.columnCalcs[a]&&(i.forEach(function(c){u.push(l.getFieldValue(c))}),o=a+"Params",s=typeof l.modules.columnCalcs[o]=="function"?l.modules.columnCalcs[o](u,i):l.modules.columnCalcs[o],l.setFieldValue(r,l.modules.columnCalcs[a](u,i,s)))}),r}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(r=>{e[r.getKey()]=this.getGroupResults(r)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),r=e.getSubGroups(),n={},a={};return r.forEach(s=>{n[s.getKey()]=this.getGroupResults(s)}),a={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:n},a}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}}class jAe extends oi{static moduleName="dataTree";constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(r,n){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(r,n){return i.dataTreeStartExpanded[n]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(r=>{this.reinitializeRowChildren(r)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,r){this.redrawNeeded(r)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],r=Array.isArray(i),n=r||!r&&typeof i=="object"&&i!==null;!n&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!n&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:n?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&n?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&n?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:n}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(r){r.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],r=i.getElement(),n=e.modules.dataTree;n.branchEl&&(n.branchEl.parentNode&&n.branchEl.parentNode.removeChild(n.branchEl),n.branchEl=!1),n.controlEl&&(n.controlEl.parentNode&&n.controlEl.parentNode.removeChild(n.controlEl),n.controlEl=!1),this.generateControlElement(e,r),e.getElement().classList.add("tabulator-tree-level-"+n.index),n.index&&(this.branchEl?(n.branchEl=this.branchEl.cloneNode(!0),r.insertBefore(n.branchEl,r.firstChild),this.table.rtl?n.branchEl.style.marginRight=(n.branchEl.offsetWidth+n.branchEl.style.marginLeft)*(n.index-1)+n.index*this.indent+"px":n.branchEl.style.marginLeft=(n.branchEl.offsetWidth+n.branchEl.style.marginRight)*(n.index-1)+n.index*this.indent+"px"):this.table.rtl?r.style.paddingRight=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-right"))+n.index*this.indent+"px":r.style.paddingLeft=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-left"))+n.index*this.indent+"px")}generateControlElement(e,i){var r=e.modules.dataTree,n=r.controlEl;i=i||e.getCells()[0].getElement(),r.children!==!1&&(r.open?(r.controlEl=this.collapseEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.collapseRow(e)})):(r.controlEl=this.expandEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.expandRow(e)})),r.controlEl.addEventListener("mousedown",a=>{a.stopPropagation()}),n&&n.parentNode===i?n.parentNode.replaceChild(r.controlEl,n):i.insertBefore(r.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((r,n)=>{var a,s;i.push(r),r instanceof La&&(r.create(),a=r.modules.dataTree,!a.index&&a.children!==!1&&(s=this.getChildren(r,!1,!0),s.forEach(o=>{o.create(),i.push(o)})))}),i}getChildren(e,i,r){var n=e.modules.dataTree,a=[],s=[];return n.children!==!1&&(n.open||i)&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?a=this.table.modules.filter.filter(n.children):a=n.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(a,r),a.forEach(o=>{s.push(o);var l=this.getChildren(o,!1,!0);l.forEach(u=>{s.push(u)})})),s}generateChildren(e){var i=[],r=e.getData()[this.field];return Array.isArray(r)||(r=[r]),r.forEach(n=>{var a=new La(n||{},this.table.rowManager);a.create(),a.modules.dataTree.index=e.modules.dataTree.index+1,a.modules.dataTree.parent=e,a.modules.dataTree.children&&(a.modules.dataTree.open=this.startOpen(a.getComponent(),a.modules.dataTree.index)),i.push(a)}),i}expandRow(e,i){var r=e.modules.dataTree;r.children!==!1&&(r.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,r=[],n;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?n=this.table.modules.filter.filter(i.children):n=i.children,n.forEach(a=>{a instanceof La&&r.push(a)})),r}rowDeleting(e){var i=e.modules.dataTree;i&&i.children&&Array.isArray(i.children)&&i.children.forEach(r=>{r instanceof La&&r.wipe()})}rowDelete(e){var i=e.modules.dataTree.parent,r;i&&(r=this.findChildIndex(e,i),r!==!1&&i.data[this.field].splice(r,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,r,n){var a=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof n<"u"&&(a=this.findChildIndex(n,e),a!==!1&&e.data[this.field].splice(r?a:a+1,0,i)),a===!1&&(r?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var r=!1;return typeof e=="object"?e instanceof La?r=e.data:e instanceof wM?r=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(r=i.modules.dataTree.children.find(n=>n instanceof La?n.element===e:!1),r&&(r=r.data)):e===null&&(r=!1):typeof e>"u"?r=!1:r=i.data[this.field].find(n=>n.data[this.table.options.index]==e),r&&(Array.isArray(i.data[this.field])&&(r=i.data[this.field].indexOf(r)),r==-1&&(r=!1)),r}getTreeChildren(e,i,r){var n=e.modules.dataTree,a=[];return n&&n.children&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),n.children.forEach(s=>{s instanceof La&&(a.push(i?s.getComponent():s),r&&this.getTreeChildren(s,i,r).forEach(o=>{a.push(o)}))})),a}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}function GAe(t,e={},i){var r=e.delimiter?e.delimiter:",",n=[],a=[];t.forEach(s=>{var o=[];switch(s.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":s.columns.forEach((l,u)=>{l&&l.depth===1&&(a[u]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":s.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}o.push('"'+String(l.value).split('"').join('""')+'"')}}),n.push(o.join(r));break}}),a.length&&n.unshift(a.join(r)),n=n.join(`
`),e.bom&&(n="\uFEFF"+n),i(n,"text/csv")}function HAe(t,e,i){var r=[];t.forEach(n=>{var a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(s=>{s&&(a[s.component.getTitleDownload()||s.component.getField()]=s.value)}),r.push(a);break}}),r=JSON.stringify(r,null,"	"),i(r,"application/json")}function WAe(t,e={},i){var r=[],n=[],a={},s=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},o=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},u=e.title?e.title:"",c,d;l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(f=>{switch(f.type){case"header":r.push(p(f));break;case"group":n.push(p(f,s));break;case"calc":n.push(p(f,o));break;case"row":n.push(p(f));break}});function p(f,h){var m=[];return f.columns.forEach(g=>{var I;if(g){switch(typeof g.value){case"object":g.value=g.value!==null?JSON.stringify(g.value):"";break;case"undefined":g.value="";break}I={content:g.value,colSpan:g.width,rowSpan:g.height},h&&(I.styles=h),m.push(I)}}),m}c=this.dependencyRegistry.lookup("jspdf","jsPDF"),d=new c(l),e.autoTable&&(typeof e.autoTable=="function"?a=e.autoTable(d)||{}:a=e.autoTable),u&&(a.didDrawPage=function(f){d.text(u,40,30)}),a.head=r,a.body=n,d.autoTable(a),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function zAe(t,e,i){var r=this,n=e.sheetName||"Sheet1",a=this.dependencyRegistry.lookup("XLSX"),s=a.utils.book_new(),o=new xa(this),l="compress"in e?e.compress:!0,u=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:l},c;u.type="binary",s.SheetNames=[],s.Sheets={};function d(){var h=[],m=[],g={},I={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((v,w)=>v+(w&&w.width?w.width:1),0):0,r:t.length}};return t.forEach((v,w)=>{var y=[];v.columns.forEach(function(b,S){b?(y.push(!(b.value instanceof Date)&&typeof b.value=="object"?JSON.stringify(b.value):b.value),(b.width>1||b.height>-1)&&(b.height>1||b.width>1)&&m.push({s:{r:w,c:S},e:{r:w+b.height-1,c:S+b.width-1}})):y.push("")}),h.push(y)}),a.utils.sheet_add_aoa(g,h),g["!ref"]=a.utils.encode_range(I),m.length&&(g["!merges"]=m),g}if(e.sheetOnly){i(d());return}if(e.sheets)for(var p in e.sheets)e.sheets[p]===!0?(s.SheetNames.push(p),s.Sheets[p]=d()):(s.SheetNames.push(p),o.commsSend(e.sheets[p],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:r.active,intercept:function(h){s.Sheets[p]=h}}));else s.SheetNames.push(n),s.Sheets[n]=d();e.documentProcessing&&(s=e.documentProcessing(s));function f(h){for(var m=new ArrayBuffer(h.length),g=new Uint8Array(m),I=0;I!=h.length;++I)g[I]=h.charCodeAt(I)&255;return m}c=a.write(s,u),i(f(c),"application/octet-stream")}function qAe(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function YAe(t,e,i){const r=[];t.forEach(n=>{const a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(s=>{s&&(a[s.component.getTitleDownload()||s.component.getField()]=s.value)}),r.push(JSON.stringify(a));break}}),i(r.join(`
`),"application/x-ndjson")}var KAe={csv:GAe,json:HAe,jsonLines:YAe,pdf:WAe,xlsx:zAe,html:qAe};class GP extends oi{static moduleName="download";static downloaders=KAe;constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,r){return new Blob([i],{type:r})}),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){}downloadToTab(e,i,r,n){this.download(e,i,r,n,!0)}download(e,i,r,n,a){var s=!1;function o(u,c){a?a===!0?this.triggerDownload(u,c,e,i,!0):a(u):this.triggerDownload(u,c,e,i)}if(typeof e=="function"?s=e:GP.downloaders[e]?s=GP.downloaders[e]:console.warn("Download Error - No such download type found: ",e),s){var l=this.generateExportList(n);s.call(this.table,l,r||{},o.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),r=this.table.options.groupHeaderDownload;return r&&!Array.isArray(r)&&(r=[r]),i.forEach(n=>{var a;n.type==="group"&&(a=n.columns[0],r&&r[n.indent]&&(a.value=r[n.indent](a.value,n.component._group.getRowCount(),n.component._group.getData(),n.component)))}),i}triggerDownload(e,i,r,n,a){var s=document.createElement("a"),o=this.table.options.downloadEncoder(e,i);o&&(a?window.open(window.URL.createObjectURL(o)):(n=n||"Tabulator."+(typeof r=="function"?"txt":r),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(o,n):(s.setAttribute("href",window.URL.createObjectURL(o)),s.setAttribute("download",n),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,r){i==="intercept"&&this.download(r.type,"",r.options,r.active,r.intercept)}}function SM(t,e){var i=e.mask,r=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",n=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",a=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function s(o){var l=i[o];typeof l<"u"&&l!==a&&l!==r&&l!==n&&(t.value=t.value+""+l,s(o+1))}t.addEventListener("keydown",o=>{var l=t.value.length,u=o.key;if(o.keyCode>46&&!o.ctrlKey&&!o.metaKey){if(l>=i.length)return o.preventDefault(),o.stopPropagation(),!1;switch(i[l]){case r:if(u.toUpperCase()==u.toLowerCase())return o.preventDefault(),o.stopPropagation(),!1;break;case n:if(isNaN(u))return o.preventDefault(),o.stopPropagation(),!1;break;case a:break;default:if(u!==i[l])return o.preventDefault(),o.stopPropagation(),!1}}}),t.addEventListener("keyup",o=>{o.keyCode>46&&e.maskAutoFill&&s(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&s(t.value.length)}function XAe(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input");if(s.setAttribute("type",n.search?"search":"text"),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),s.setAttribute(l,s.getAttribute(l)+n.elementAttributes["+"+l])):s.setAttribute(l,n.elementAttributes[l]);s.value=typeof a<"u"?a:"",e(function(){t.getType()==="cell"&&(s.focus({preventScroll:!0}),s.style.height="100%",n.selectContents&&s.select())});function o(l){(a===null||typeof a>"u")&&s.value!==""||s.value!==a?i(s.value)&&(a=s.value):r()}return s.addEventListener("change",o),s.addEventListener("blur",o),s.addEventListener("keydown",function(l){switch(l.keyCode){case 13:o();break;case 27:r();break;case 35:case 36:l.stopPropagation();break}}),n.mask&&SM(s,n),s}function JAe(t,e,i,r,n){var a=t.getValue(),s=n.verticalNavigation||"hybrid",o=String(a!==null&&typeof a<"u"?a:""),l=document.createElement("textarea"),u=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+n.elementAttributes["+"+d])):l.setAttribute(d,n.elementAttributes[d]);l.value=o,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),n.selectContents&&l.select())});function c(d){(a===null||typeof a>"u")&&l.value!==""||l.value!==a?(i(l.value)&&(a=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):r()}return l.addEventListener("change",c),l.addEventListener("blur",c),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=u&&(u=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&n.shiftEnterSubmit&&c();break;case 27:r();break;case 38:(s=="editor"||s=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(s=="editor"||s=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),n.mask&&SM(l,n),l}function QAe(t,e,i,r,n){var a=t.getValue(),s=n.verticalNavigation||"editor",o=document.createElement("input");if(o.setAttribute("type","number"),typeof n.max<"u"&&o.setAttribute("max",n.max),typeof n.min<"u"&&o.setAttribute("min",n.min),typeof n.step<"u"&&o.setAttribute("step",n.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let c in n.elementAttributes)c.charAt(0)=="+"?(c=c.slice(1),o.setAttribute(c,o.getAttribute(c)+n.elementAttributes["+"+c])):o.setAttribute(c,n.elementAttributes[c]);o.value=a;var l=function(c){u()};e(function(){t.getType()==="cell"&&(o.removeEventListener("blur",l),o.focus({preventScroll:!0}),o.style.height="100%",o.addEventListener("blur",l),n.selectContents&&o.select())});function u(){var c=o.value;!isNaN(c)&&c!==""&&(c=Number(c)),c!==a?i(c)&&(a=c):r()}return o.addEventListener("keydown",function(c){switch(c.keyCode){case 13:u();break;case 27:r();break;case 38:case 40:s=="editor"&&(c.stopImmediatePropagation(),c.stopPropagation());break;case 35:case 36:c.stopPropagation();break}}),n.mask&&SM(o,n),o}function ZAe(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input");if(s.setAttribute("type","range"),typeof n.max<"u"&&s.setAttribute("max",n.max),typeof n.min<"u"&&s.setAttribute("min",n.min),typeof n.step<"u"&&s.setAttribute("step",n.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),s.setAttribute(l,s.getAttribute(l)+n.elementAttributes["+"+l])):s.setAttribute(l,n.elementAttributes[l]);s.value=a,e(function(){t.getType()==="cell"&&(s.focus({preventScroll:!0}),s.style.height="100%")});function o(){var l=s.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=a?i(l)&&(a=l):r()}return s.addEventListener("blur",function(l){o()}),s.addEventListener("keydown",function(l){switch(l.keyCode){case 13:o();break;case 27:r();break}}),s}function eke(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l=t.getValue(),u=document.createElement("input");function c(p){var f;return o.isDateTime(p)?f=p:a==="iso"?f=o.fromISO(String(p)):f=o.fromFormat(String(p),a),f.toFormat("yyyy-MM-dd")}if(u.type="date",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.max&&u.setAttribute("max",a?c(n.max):n.max),n.min&&u.setAttribute("min",a?c(n.min):n.min),n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+n.elementAttributes["+"+p])):u.setAttribute(p,n.elementAttributes[p]);l=typeof l<"u"?l:"",a&&(o?l=c(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=l,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select())});function d(){var p=u.value,f;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&a)switch(f=o.fromFormat(String(p),"yyyy-MM-dd"),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(l=u.value)}else r()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function tke(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l,u=t.getValue(),c=document.createElement("input");if(c.type="time",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(o?(o.isDateTime(u)?l=u:a==="iso"?l=o.fromISO(String(u)):l=o.fromFormat(String(u),a),u=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()=="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,f;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(f=o.fromFormat(String(p),"hh:mm"),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(u=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function ike(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"):null,l,u=t.getValue(),c=document.createElement("input");if(c.type="datetime-local",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(o?(o.isDateTime(u)?l=u:a==="iso"?l=o.fromISO(String(u)):l=o.fromFormat(String(u),a),u=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,f;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(f=o.fromISO(String(p)),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(u=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}let rke=class{constructor(e,i,r,n,a,s){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(s),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:n,cancel:a},this._deprecatedOptionsCheck(),this._initializeValue(),r(this._onRendered.bind(this))}_deprecatedOptionsCheck(){}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(r){r.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let r in e)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,i.getAttribute(r)+e["+"+r])):i.setAttribute(r,e[r]);return this.params.mask&&SM(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],r;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",r=Object.keys(e).filter(n=>i.includes(n)).length,r?r>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var r=this.displayItems.find(n=>typeof n.label<"u"&&n.label.toLowerCase().startsWith(this.filterTerm));r&&this._focusItem(r),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],r=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(n=>this.listIteration===r?this._parseList(n):Promise.reject(r))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var r=this.params.filterRemote?{term:i}:{};return e=hte(e,{},r),fetch(e).then(n=>n.ok?n.json().catch(a=>(console.warn("List Ajax Load Error - Invalid JSON returned",a),Promise.reject(a))):(console.error("List Ajax Load Error - Connection Error: "+n.status,n.statusText),Promise.reject(n))).catch(n=>(console.error("List Ajax Load Error - Connection Error: ",n),Promise.reject(n)))}_uniqueColumnValues(e){var i={},r=this.table.getData(this.params.valuesLookup),n;return e?n=this.table.columnManager.getColumnByField(e):n=this.cell.getColumn()._getSelf(),n?r.forEach(a=>{var s=n.getFieldValue(a);this._emptyValueCheck(s)||(this.params.multiselect&&Array.isArray(s)?s.forEach(o=>{this._emptyValueCheck(o)||(i[o]=!0)}):i[s]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_emptyValueCheck(e){return e===null||typeof e>"u"||e===""}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([r,n])=>({label:n,value:r}))),e.forEach(r=>{typeof r!="object"&&(r={label:r,value:r}),this._parseListItem(r,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,r){var n={};e.options?n=this._parseListGroup(e,r+1):(n={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:r,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(n,!0)),i.push(n)}_parseListGroup(e,i){var r={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(n=>{this._parseListItem(n,r.options,i)}),r}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((r,n)=>e(r.label,n.label,r.value,n.value,r.original,n.original)),i.forEach(r=>{r.group&&this._sortGroup(e,r.options)})}_defaultSortFunction(e,i){var r,n,a,s,o=0,l,u=/(\d+)|(\D+)/g,c=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(r=String(e).toLowerCase(),n=String(i).toLowerCase(),r===n)return 0;if(!(c.test(r)&&c.test(n)))return r>n?1:-1;for(r=r.match(u),n=n.match(u),l=r.length>n.length?n.length:r.length;o<l;)if(a=r[o],s=n[o++],a!==s)return isFinite(a)&&isFinite(s)?(a.charAt(0)==="0"&&(a="."+a),s.charAt(0)==="0"&&(s="."+s),a-s):a>s?1:-1;return r.length>n.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(r=>{this._filterItem(e,i,r)})):this.filtered=!1,this.data}_filterItem(e,i,r){var n=!1;return r.group?(r.options.forEach(a=>{this._filterItem(e,i,a)&&(n=!0)}),r.visible=n):r.visible=e(i,r.label,r.value,r.original),r.visible}_defaultFilterFunc(e,i,r,n){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(r).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,r;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,r=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,r instanceof HTMLElement?i.appendChild(r):i.innerHTML=r,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let n in e.elementAttributes)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,this.input.getAttribute(n)+e.elementAttributes["+"+n])):i.setAttribute(n,e.elementAttributes[n]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(n=>{this._buildItem(n)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var r;this.typing=!1,this.params.multiselect?(r=this.currentItems.indexOf(e),r>-1?(this.currentItems.splice(r,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(n=>n.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,r;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(n=>n.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(r=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,r===null||typeof r>"u"||r===""?i=r:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}};function nke(t,e,i,r,n){var a=new rke(this,t,e,i,r,n);return a.input}function ake(t,e,i,r,n){var a=this,s=t.getElement(),o=t.getValue(),l=s.getElementsByTagName("svg").length||5,u=s.getElementsByTagName("svg")[0]?s.getElementsByTagName("svg")[0].getAttribute("width"):14,c=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function f(I){c.forEach(function(v,w){w<I?(a.table.browser=="ie"?v.setAttribute("class","tabulator-star-active"):v.classList.replace("tabulator-star-inactive","tabulator-star-active"),v.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(a.table.browser=="ie"?v.setAttribute("class","tabulator-star-inactive"):v.classList.replace("tabulator-star-active","tabulator-star-inactive"),v.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function h(I){var v=document.createElement("span"),w=p.cloneNode(!0);c.push(w),v.addEventListener("mouseenter",function(y){y.stopPropagation(),y.stopImmediatePropagation(),f(I)}),v.addEventListener("mousemove",function(y){y.stopPropagation(),y.stopImmediatePropagation()}),v.addEventListener("click",function(y){y.stopPropagation(),y.stopImmediatePropagation(),i(I),s.blur()}),v.appendChild(w),d.appendChild(v)}function m(I){o=I,f(I)}if(s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",u),p.setAttribute("height",u),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",n.elementAttributes&&typeof n.elementAttributes=="object")for(let I in n.elementAttributes)I.charAt(0)=="+"?(I=I.slice(1),d.setAttribute(I,d.getAttribute(I)+n.elementAttributes["+"+I])):d.setAttribute(I,n.elementAttributes[I]);for(var g=1;g<=l;g++)h(g);return o=Math.min(parseInt(o),l),f(o),d.addEventListener("mousemove",function(I){f(0)}),d.addEventListener("click",function(I){i(0)}),s.addEventListener("blur",function(I){r()}),s.addEventListener("keydown",function(I){switch(I.keyCode){case 39:m(o+1);break;case 37:m(o-1);break;case 13:i(o);break;case 27:r();break}}),d}function ske(t,e,i,r,n){var a=t.getElement(),s=typeof n.max>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("max")||100:n.max,o=typeof n.min>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("min")||0:n.min,l=(s-o)/100,u=t.getValue()||0,c=document.createElement("div"),d=document.createElement("div"),p,f;function h(){var m=window.getComputedStyle(a,null),g=l*Math.round(d.offsetWidth/((a.clientWidth-parseInt(m.getPropertyValue("padding-left"))-parseInt(m.getPropertyValue("padding-right")))/100))+o;i(g),a.setAttribute("aria-valuenow",g),a.setAttribute("aria-label",u)}if(c.style.position="absolute",c.style.right="0",c.style.top="0",c.style.bottom="0",c.style.width="5px",c.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",n.elementAttributes&&typeof n.elementAttributes=="object")for(let m in n.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),d.setAttribute(m,d.getAttribute(m)+n.elementAttributes["+"+m])):d.setAttribute(m,n.elementAttributes[m]);return a.style.padding="4px 4px",u=Math.min(parseFloat(u),s),u=Math.max(parseFloat(u),o),u=Math.round((u-o)/l),d.style.width=u+"%",a.setAttribute("aria-valuemin",o),a.setAttribute("aria-valuemax",s),d.appendChild(c),c.addEventListener("mousedown",function(m){p=m.screenX,f=d.offsetWidth}),c.addEventListener("mouseover",function(){c.style.cursor="ew-resize"}),a.addEventListener("mousemove",function(m){p&&(d.style.width=f+m.screenX-p+"px")}),a.addEventListener("mouseup",function(m){p&&(m.stopPropagation(),m.stopImmediatePropagation(),p=!1,f=!1,h())}),a.addEventListener("keydown",function(m){switch(m.keyCode){case 39:m.preventDefault(),d.style.width=d.clientWidth+a.clientWidth/100+"px";break;case 37:m.preventDefault(),d.style.width=d.clientWidth-a.clientWidth/100+"px";break;case 9:case 13:h();break;case 27:r();break}}),a.addEventListener("blur",function(){r()}),d}function oke(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input"),o=n.tristate,l=typeof n.indeterminateValue>"u"?null:n.indeterminateValue,u=!1,c=Object.keys(n).includes("trueValue"),d=Object.keys(n).includes("falseValue");if(s.setAttribute("type","checkbox"),s.style.marginTop="5px",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let f in n.elementAttributes)f.charAt(0)=="+"?(f=f.slice(1),s.setAttribute(f,s.getAttribute(f)+n.elementAttributes["+"+f])):s.setAttribute(f,n.elementAttributes[f]);s.value=a,o&&(typeof a>"u"||a===l||a==="")&&(u=!0,s.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&s.focus({preventScroll:!0})}),s.checked=c?a===n.trueValue:a===!0||a==="true"||a==="True"||a===1;function p(f){var h=s.checked;return c&&h?h=n.trueValue:d&&!h&&(h=n.falseValue),o?f?u?l:h:s.checked&&!u?(s.checked=!1,s.indeterminate=!0,u=!0,l):(u=!1,h):h}return s.addEventListener("change",function(f){i(p())}),s.addEventListener("blur",function(f){i(p(!0))}),s.addEventListener("keydown",function(f){f.keyCode==13&&i(p()),f.keyCode==27&&r()}),s}function lke(t,e,i,r,n){var a=t._getSelf().column,s,o,l;function u(c){var d=c.getValue(),p="input";switch(typeof d){case"number":p="number";break;case"boolean":p="tickCross";break;case"string":d.includes(`
`)&&(p="textarea");break}return p}return s=n.editorLookup?n.editorLookup(t):u(t),n.paramsLookup&&(l=typeof n.paramsLookup=="function"?n.paramsLookup(s,t):n.paramsLookup[s]),o=this.table.modules.edit.lookupEditor(s,a),o.call(this,t,e,i,r,l||{})}var uke={input:XAe,textarea:JAe,number:QAe,range:ZAe,date:eke,time:tke,datetime:ike,list:nke,star:ake,progress:ske,tickCross:oke,adaptable:lke};class uB extends oi{static moduleName="edit";static editors=uke;constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.convertEmptyValues=!1,this.editors=uB.editors,this.registerTableOption("editTriggerEvent","focus"),this.registerTableOption("editorEmptyValue"),this.registerTableOption("editorEmptyValueFunc",this.emptyValueCheck.bind(this)),this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("editorEmptyValue"),this.registerColumnOption("editorEmptyValueFunc"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0)),Object.keys(this.table.options).includes("editorEmptyValue")&&(this.convertEmptyValues=!0)}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,r=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||r&&(i.getElement().firstChild.blur(),this.invalidEdit||(r===!0?r=this.table.addRow({}):typeof r=="function"?r=this.table.addRow(r(i.row.getComponent())):r=this.table.addRow(Object.assign({},r)),r.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateLeft(),r)return!0;if(n=this.table.rowManager.prevDisplayRow(e.row,!0),n&&(r=this.findPrevEditableCell(n,n.cells.length),r))return r.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateRight(),r)return!0;if(n=this.table.rowManager.nextDisplayRow(e.row,!0),n&&(r=this.findNextEditableCell(n,-1),r))return r.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findPrevEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findNextEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.prevDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.nextDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var r=!1;if(i<e.cells.length-1)for(var n=i+1;n<e.cells.length;n++){let a=e.cells[n];if(a.column.modules.edit&&Ir.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}findPrevEditableCell(e,i){var r=!1;if(i>0)for(var n=i-1;n>=0;n--){let a=e.cells[n];if(a.column.modules.edit&&Ir.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i=Object.keys(e.definition).includes("editorEmptyValue"),r={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{},convertEmptyValues:i,editorEmptyValue:e.definition.editorEmptyValue,editorEmptyValueFunc:e.definition.editorEmptyValueFunc};r.editor=this.lookupEditor(e.definition.editor,e),r.editor&&(e.modules.edit=r)}lookupEditor(e,i){var r;switch(typeof e){case"string":this.editors[e]?r=this.editors[e]:console.warn("Editor Error - No such editor found: ",e);break;case"function":r=e;break;case"boolean":e===!0&&(typeof i.definition.formatter!="function"?this.editors[i.definition.formatter]?r=this.editors[i.definition.formatter]:r=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",i.definition.formatter));break}return r}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,r;if(this.invalidEdit=!1,i){for(this.currentCell=!1,r=i.getElement(),this.dispatch("edit-editor-clear",i,e),r.classList.remove("tabulator-editing");r.firstChild;)r.removeChild(r.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,r=e.getElement(!0);this.updateCellClass(e),r.setAttribute("tabindex",0),r.addEventListener("mousedown",function(n){n.button===2?n.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&r.addEventListener("dblclick",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&r.addEventListener("click",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),this.options("editTriggerEvent")==="focus"&&r.addEventListener("focus",function(n){i.recursionBlock||i.edit(e,n,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,r=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,n=e.row.getElement();n.offsetTop<i?this.table.rowManager.element.scrollTop-=i-n.offsetTop:n.offsetTop+n.offsetHeight>r&&(this.table.rowManager.element.scrollTop+=n.offsetTop+n.offsetHeight-r);var a=this.table.rowManager.element.scrollLeft,s=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,o=e.getElement();this.table.modExists("frozenColumns")&&(a+=parseInt(this.table.modules.frozenColumns.leftMargin||0),s-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(a-=parseInt(this.table.columnManager.renderer.vDomPadLeft),s-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),o.offsetLeft<a?this.table.rowManager.element.scrollLeft-=a-o.offsetLeft:o.offsetLeft+o.offsetWidth>s&&(this.table.rowManager.element.scrollLeft+=o.offsetLeft+o.offsetWidth-s)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,r){var n=this,a=!0,s=function(){},o=e.getElement(),l=!1,u,c,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(I){if(n.currentCell===e&&!l){var v=n.chain("edit-success",[e,I],!0,!0);return v===!0||n.table.options.validationMode==="highlight"?(l=!0,n.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,n.editedCells.indexOf(e)==-1&&n.editedCells.push(e),I=n.transformEmptyValues(I,e),e.setValue(I,!0),v===!0):(l=!0,n.invalidEdit=!0,n.focusCellNoEvent(e,!0),s(),setTimeout(()=>{l=!1},10),!1)}}function f(){n.currentCell===e&&!l&&n.cancelEdit()}function h(I){s=I}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(o),!1;if(i&&i.stopPropagation(),a=this.allowEdit(e),a||r){if(n.cancelEdit(),n.currentCell=e,this.focusScrollAdjust(e),c=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,c)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,c),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",c),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(c):e.column.modules.edit.params,u=e.column.modules.edit.editor.call(n,c,h,p,f,d),this.currentCell&&u!==!1)if(u instanceof Node){for(o.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");o.firstChild;)o.removeChild(o.firstChild);o.appendChild(u),s();for(var m=o.children,g=0;g<m.length;g++)m[g].addEventListener("click",function(I){I.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",u),this.blur(o),!1;else return this.blur(o),!1;return!0}else return this.mouseClick=!1,this.blur(o),!1}emptyValueCheck(e){return e===""||e===null||typeof e>"u"}transformEmptyValues(e,i){var r=i.column.modules.edit,n=r.convertEmptyValues||this.convertEmptyValues,a;return n&&(a=r.editorEmptyValueFunc||this.options("editorEmptyValueFunc"),a&&a(e)&&(e=r.convertEmptyValues?r.editorEmptyValue:this.options("editorEmptyValue"))),e}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}}class Kz{constructor(e,i,r,n){this.type=e,this.columns=i,this.component=r||!1,this.indent=n||0}}class bk{constructor(e,i,r,n,a){this.value=e,this.component=i||!1,this.width=r,this.height=n,this.depth=a}}var cke={},dke={visible:function(){return this.rowManager.getVisibleRows(!1,!0)},all:function(){return this.rowManager.rows},selected:function(){return this.modules.selectRow.selectedRows},active:function(){return this.options.pagination?this.rowManager.getDisplayRows(this.rowManager.displayRows.length-2):this.rowManager.getDisplayRows()}};class nb extends oi{static moduleName="export";static columnLookups=cke;static rowLookups=dke;constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.colVisPropAttach="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,r,n){var a,s,o,l;return this.cloneTableStyle=i,this.config=e||{},this.colVisProp=n,this.colVisPropAttach=this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1),l=nb.columnLookups[r],l&&(o=l.call(this.table),o=o.filter(u=>this.columnVisCheck(u))),a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(o)):[],o&&(o=o.map(u=>u.getComponent())),s=this.bodyToExportRows(this.rowLookup(r),o),a.concat(s)}generateTable(e,i,r,n){var a=this.generateExportList(e,i,r,n);return this.generateTableElement(a)}rowLookup(e){var i=[],r;return typeof e=="function"?e.call(this.table).forEach(n=>{n=this.table.rowManager.findRow(n),n&&i.push(n)}):(r=nb.rowLookups[e]||nb.rowLookups.active,i=r.call(this.table)),Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(r=>{var n=this.processColumnGroup(r);n&&i.push(n)}),i}processColumnGroup(e){var i=e.columns,r=0,n=e.definition["title"+this.colVisPropAttach]||e.definition.title,a={title:n,column:e,depth:1};if(i.length){if(a.subGroups=[],a.width=0,i.forEach(s=>{var o=this.processColumnGroup(s);o&&(a.width+=o.width,a.subGroups.push(o),o.depth>r&&(r=o.depth))}),a.depth+=r,!a.width)return!1}else if(this.columnVisCheck(e))a.width=1;else return!1;return a}columnVisCheck(e){var i=e.definition[this.colVisProp];return this.config.rowHeaders===!1&&e.isRowHeader?!1:(typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i===!1||i===!0?i:e.visible&&e.field)}headersToExportRows(e){var i=[],r=0,n=[];function a(s,o){var l=r-o;if(typeof i[o]>"u"&&(i[o]=[]),s.height=s.subGroups?1:l-s.depth+1,i[o].push(s),s.height>1)for(let u=1;u<s.height;u++)typeof i[o+u]>"u"&&(i[o+u]=[]),i[o+u].push(!1);if(s.width>1)for(let u=1;u<s.width;u++)i[o].push(!1);s.subGroups&&s.subGroups.forEach(function(u){a(u,o+1)})}return e.forEach(function(s){s.depth>r&&(r=s.depth)}),e.forEach(function(s){a(s,0)}),i.forEach(s=>{var o=[];s.forEach(l=>{if(l){let u=typeof l.title>"u"?"":l.title;o.push(new bk(u,l.column.getComponent(),l.width,l.height,l.depth))}else o.push(null)}),n.push(new Kz("header",o))}),n}bodyToExportRows(e,i=[]){var r=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(n=>{this.columnVisCheck(n)&&i.push(n.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(n=>{switch(n.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&n.modules.dataTree.parent)}return!0}),e.forEach((n,a)=>{var s=n.getData(this.colVisProp),o=[],l=0;switch(n.type){case"group":l=n.level,o.push(new bk(n.key,n.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(u=>{o.push(new bk(u._column.getFieldValue(s),u,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=n.modules.dataTree.index);break}r.push(new Kz(n.type,o,n.getComponent(),l))}),r}generateTableElement(e){var i=document.createElement("table"),r=document.createElement("thead"),n=document.createElement("tbody"),a=this.lookupTableStyles(),s=this.table.options["rowFormatter"+this.colVisPropAttach],o={};return o.rowFormatter=s!==null?s:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(o.treeElementField=this.table.modules.dataTree.elementField),o.groupHeader=this.table.options["groupHeader"+this.colVisPropAttach],o.groupHeader&&!Array.isArray(o.groupHeader)&&(o.groupHeader=[o.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),r,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,u)=>{let c;switch(l.type){case"header":r.appendChild(this.generateHeaderElement(l,o,a));break;case"group":n.appendChild(this.generateGroupElement(l,o,a));break;case"calc":n.appendChild(this.generateCalcElement(l,o,a));break;case"row":c=this.generateRowElement(l,o,a),this.mapElementStyles(u%2&&a.evenRow?a.evenRow:a.oddRow,c,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n.appendChild(c);break}}),r.innerHTML&&i.appendChild(r),i.appendChild(n),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.styleRowHeader=e.firstRow.getElementsByClassName("tabulator-row-header")[0],e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,r){var n=document.createElement("tr");return e.columns.forEach(a=>{if(a){var s=document.createElement("th"),o=a.component._column.definition.cssClass?a.component._column.definition.cssClass.split(" "):[];s.colSpan=a.width,s.rowSpan=a.height,s.innerHTML=a.value,this.cloneTableStyle&&(s.style.boxSizing="border-box"),o.forEach(function(l){s.classList.add(l)}),this.mapElementStyles(a.component.getElement(),s,["text-align","border-left","border-right","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(a.component._column.contentElement,s,["padding-top","padding-left","padding-right","padding-bottom"]),a.component._column.visible?this.mapElementStyles(a.component.getElement(),s,["width"]):a.component._column.definition.width&&(s.style.width=a.component._column.definition.width+"px"),a.component._column.parent&&a.component._column.parent.isGroup?this.mapElementStyles(a.component._column.parent.groupElement,s,["border-top"]):this.mapElementStyles(a.component.getElement(),s,["border-top"]),a.component._column.isGroup?this.mapElementStyles(a.component.getElement(),s,["border-bottom"]):this.mapElementStyles(this.table.columnManager.getElement(),s,["border-bottom"]),n.appendChild(s)}}),n}generateGroupElement(e,i,r){var n=document.createElement("tr"),a=document.createElement("td"),s=e.columns[0];return n.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?s.value=i.groupHeader[e.indent](s.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(s.value=e.component._group.generator(s.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),a.colSpan=s.width,a.innerHTML=s.value,n.classList.add("tabulator-print-table-group"),n.classList.add("tabulator-group-level-"+e.indent),s.component.isVisible()&&n.classList.add("tabulator-group-visible"),this.mapElementStyles(r.firstGroup,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(r.firstGroup,a,["padding-top","padding-left","padding-right","padding-bottom"]),n.appendChild(a),n}generateCalcElement(e,i,r){var n=this.generateRowElement(e,i,r);return n.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(r.calcRow,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n}generateRowElement(e,i,r){var n=document.createElement("tr");if(n.classList.add("tabulator-print-table-row"),e.columns.forEach((a,s)=>{if(a){var o=document.createElement("td"),l=a.component._column,u=this.table,c=u.columnManager.findColumnIndex(l),d=a.value,p,f,h={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return o},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return u},getComponent:function(){return h},column:l},m=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(m.forEach(function(g){o.classList.add(g)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(h,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?o.appendChild(d):o.innerHTML=d,f=["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"],l.isRowHeader?(p=r.styleRowHeader,f.push("background-color")):p=r.styleCells&&r.styleCells[c]?r.styleCells[c]:r.firstCell,p&&(this.mapElementStyles(p,o,f),l.definition.align&&(o.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&s==0)&&(e.component._row.modules.dataTree.controlEl&&o.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),o.firstChild),e.component._row.modules.dataTree.branchEl&&o.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),o.firstChild)),n.appendChild(o),h.modules.format&&h.modules.format.renderedCallback&&h.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let a=Object.assign(e.component);a.getElement=function(){return n},i.rowFormatter(e.component)}return n}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,r,n){var a=this.generateExportList(r||this.table.options.htmlOutputConfig,i,e,n||"htmlOutput");return this.generateHTMLTable(a)}mapElementStyles(e,i,r){if(this.cloneTableStyle&&e&&i){var n={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var a=window.getComputedStyle(e);r.forEach(function(s){i.style[n[s]]||(i.style[n[s]]=a.getPropertyValue(s))})}}}}var pke={"=":function(t,e,i,r){return e==t},"<":function(t,e,i,r){return e<t},"<=":function(t,e,i,r){return e<=t},">":function(t,e,i,r){return e>t},">=":function(t,e,i,r){return e>=t},"!=":function(t,e,i,r){return e!=t},regex:function(t,e,i,r){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,r){var n=t.toLowerCase().split(typeof r.separator>"u"?" ":r.separator),a=String(e===null||typeof e>"u"?"":e).toLowerCase(),s=[];return n.forEach(o=>{a.includes(o)&&s.push(!0)}),r.matchAll?s.length===n.length:!!s.length},starts:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,r){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};class Qf extends oi{static moduleName="filter";static filters=pke;constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,r,n){return n.filter=this.getFilters(!0,!0),n}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,r,n){this.setFilter(e,i,r,n),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,r,n){this.addFilter(e,i,r,n),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var r=this.table.columnManager.findColumn(e);if(r)this.setHeaderFilterValue(r,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,r){this.removeFilter(e,i,r),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,r){return this.search("rows",e,i,r)}searchData(e,i,r){return this.search("data",e,i,r)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var r=this,n=e.getField();function a(s){var o=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",u="",c;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==s){if(e.modules.filter.prevSuccess=s,e.modules.filter.emptyFunc(s))delete r.headerFilters[n];else{switch(e.modules.filter.value=s,typeof e.definition.headerFilterFunc){case"string":Qf.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,c=function(d){var p=e.definition.headerFilterFuncParams||{},f=e.getFieldValue(d);return p=typeof p=="function"?p(s,f,d):p,Qf.filters[e.definition.headerFilterFunc](s,f,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":c=function(d){var p=e.definition.headerFilterFuncParams||{},f=e.getFieldValue(d);return p=typeof p=="function"?p(s,f,d):p,e.definition.headerFilterFunc(s,f,d,p)},l=c;break}c||(o==="partial"?(c=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(s).toLowerCase())>-1:!1},l="like"):(c=function(d){return e.getFieldValue(d)==s},l="=")),r.headerFilters[n]={value:s,func:c,type:l}}e.modules.filter.value=s,u=JSON.stringify(r.headerFilters),r.prevHeaderFilterChangeCheck!==u&&(r.prevHeaderFilterChangeCheck=u,r.trackChanges(),r.refreshFilter())}return!0}e.modules.filter={success:a,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,r){var n=this,a=e.modules.filter.success,s=e.getField(),o,l,u,c,d,p,f,h;e.modules.filter.value=i;function m(){}function g(I){h=I}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),s){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(I){return!I&&I!==0},o=document.createElement("div"),o.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":n.table.modules.edit.editors[e.definition.headerFilter]?(l=n.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(I){return I!==!0&&I!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&n.table.modules.edit.editors[e.definition.formatter]?(l=n.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(I){return I!==!0&&I!==!1})):l=n.table.modules.edit.editors.input;break}if(l){if(c={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return o},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},f=e.definition.headerFilterParams||{},f=typeof f=="function"?f.call(n.table,c):f,u=l.call(this.table.modules.edit,c,g,a,m,f),!u){console.warn("Filter Error - Cannot add filter to "+s+" column, editor returned a value of false");return}if(!(u instanceof Node)){console.warn("Filter Error - Cannot add filter to "+s+" column, editor should return an instance of Node, the editor returned:",u);return}n.langBind("headerFilters|columns|"+e.definition.field,function(I){u.setAttribute("placeholder",typeof I<"u"&&I?I:e.definition.headerFilterPlaceholder||n.langText("headerFilters|default"))}),u.addEventListener("click",function(I){I.stopPropagation(),u.focus()}),u.addEventListener("focus",I=>{var v=this.table.columnManager.contentsElement.scrollLeft,w=this.table.rowManager.element.scrollLeft;v!==w&&(this.table.rowManager.scrollHorizontal(v),this.table.columnManager.scrollHorizontal(v))}),d=!1,p=function(I){d&&clearTimeout(d),d=setTimeout(function(){a(u.value)},n.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=u,e.modules.filter.attrType=u.hasAttribute("type")?u.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=u.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(u.addEventListener("keyup",p),u.addEventListener("search",p),e.modules.filter.attrType=="number"&&u.addEventListener("change",function(I){a(u.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&u.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&u.addEventListener("mousedown",function(I){I.stopPropagation()})),o.appendChild(u),e.contentElement.appendChild(o),r||n.headerFilterColumns.push(e),h&&h()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,r,n){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),this.addFilter(e)}addFilter(e,i,r,n){var a=!1;Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),e.forEach(s=>{s=this.findFilter(s),s&&(this.filterList.push(s),a=!0)}),a&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var r=!1;return typeof e.field=="function"?r=function(n){return e.field(n,e.type||{})}:Qf.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?r=function(n){return Qf.filters[e.type](e.value,i.getFieldValue(n),n,e.params||{})}:r=function(n){return Qf.filters[e.type](e.value,n[e.field],n,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=r,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(r=>{r=this.findFilter(r),r&&i.push(r)}),i.length?i:!1}getFilters(e,i){var r=[];return e&&(r=this.getHeaderFilters()),i&&r.forEach(function(n){typeof n.type=="function"&&(n.type="function")}),r=r.concat(this.filtersToArray(this.filterList,i)),r}filtersToArray(e,i){var r=[];return e.forEach(n=>{var a;Array.isArray(n)?r.push(this.filtersToArray(n,i)):(a={field:n.field,type:n.type,value:n.value},i&&typeof a.type=="function"&&(a.type="function"),r.push(a))}),r}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,r){Array.isArray(e)||(e=[{field:e,type:i,value:r}]),e.forEach(n=>{var a=-1;typeof n.field=="object"?a=this.filterList.findIndex(s=>n===s):a=this.filterList.findIndex(s=>n.field===s.field&&n.type===s.type&&n.value===s.value),a>-1?this.filterList.splice(a,1):console.warn("Filter Error - No matching filter type found, ignoring: ",n.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,r,n){var a=[],s=[];return Array.isArray(i)||(i=[{field:i,type:r,value:n}]),i.forEach(o=>{o=this.findFilter(o),o&&s.push(o)}),this.table.rowManager.rows.forEach(o=>{var l=!0;s.forEach(u=>{this.filterRecurse(u,o.getData())||(l=!1)}),l&&a.push(e==="data"?o.getData("data"):o.getComponent())}),a}filter(e,i){var r=[],n=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(a=>{this.filterRow(a)&&r.push(a)}):r=e.slice(0),this.subscribedExternal("dataFiltered")&&(r.forEach(a=>{n.push(a.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),n)),r}filterRow(e,i){var r=!0,n=e.getData();this.filterList.forEach(s=>{this.filterRecurse(s,n)||(r=!1)});for(var a in this.headerFilters)this.headerFilters[a].func(n)||(r=!1);return r}filterRecurse(e,i){var r=!1;return Array.isArray(e)?e.forEach(n=>{this.filterRecurse(n,i)&&(r=!0)}):r=e.func(i),r}}function fke(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function hke(t,e,i){return t.getValue()}function mke(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function gke(t,e,i){var r=parseFloat(t.getValue()),n="",a,s,o,l,u,c=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",f=e.symbol||"",h=!!e.symbolAfter,m=typeof e.precision<"u"?e.precision:2;if(isNaN(r))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(r<0&&(r=Math.abs(r),n=p),a=m!==!1?r.toFixed(m):r,a=String(a).split("."),s=a[0],o=a.length>1?c+a[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(s);)s=s.replace(l,"$1"+d+"$2");return u=s+o,n===!0?(u="("+u+")",h?u+f:f+u):h?n+u+f:n+f+u}function Ike(t,e,i){var r=t.getValue(),n=e.urlPrefix||"",a=e.download,s=r,o=document.createElement("a"),l;function u(c,d){var p=c.shift(),f=d[p];return c.length&&typeof f=="object"?u(c,f):f}if(e.labelField&&(l=t.getData(),s=u(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":s=e.label;break;case"function":s=e.label(t);break}if(s){if(e.urlField&&(l=t.getData(),r=Ir.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":r=e.url;break;case"function":r=e.url(t);break}return o.setAttribute("href",n+r),e.target&&o.setAttribute("target",e.target),e.download&&(typeof a=="function"?a=a(t):a=a===!0?"":a,o.setAttribute("download",a)),o.innerHTML=this.emptyToSpace(this.sanitizeHTML(s)),o}else return"&nbsp;"}function vke(t,e,i){var r=document.createElement("img"),n=t.getValue();switch(e.urlPrefix&&(n=e.urlPrefix+t.getValue()),e.urlSuffix&&(n=n+e.urlSuffix),r.setAttribute("src",n),typeof e.height){case"number":r.style.height=e.height+"px";break;case"string":r.style.height=e.height;break}switch(typeof e.width){case"number":r.style.width=e.width+"px";break;case"string":r.style.width=e.width;break}return r.addEventListener("load",function(){t.getRow().normalizeHeight()}),r}function yke(t,e,i){var r=t.getValue(),n=t.getElement(),a=e.allowEmpty,s=e.allowTruthy,o=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',u=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return o&&r===e.trueValue||!o&&(s&&r||r===!0||r==="true"||r==="True"||r===1||r==="1")?(n.setAttribute("aria-checked",!0),l||""):a&&(r==="null"||r===""||r===null||typeof r>"u")?(n.setAttribute("aria-checked","mixed"),""):(n.setAttribute("aria-checked",!1),u||"")}function bke(t,e,i){var r=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=e.outputFormat||"dd/MM/yyyy HH:mm:ss",s=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=t.getValue();if(typeof r<"u"){var l;return r.isDateTime(o)?l=o:n==="iso"?l=r.fromISO(String(o)):l=r.fromFormat(String(o),n),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(a)):s===!0||!o?o:typeof s=="function"?s(o):s}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function wke(t,e,i){var r=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=typeof e.suffix<"u"?e.suffix:!1,o=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,u=typeof e.date<"u"?e.date:r.now(),c=t.getValue();if(typeof r<"u"){var d;return r.isDateTime(c)?d=c:n==="iso"?d=r.fromISO(String(c)):d=r.fromFormat(String(c),n),d.isValid?l?d.diff(u,o).toHuman()+(s?" "+s:""):parseInt(d.diff(u,o)[o])+(s?" "+s:""):a===!0?c:typeof a=="function"?a(c):a}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function Ske(t,e,i){var r=t.getValue();return typeof e[r]>"u"?(console.warn("Missing display value for "+r),r):e[r]}function Uke(t,e,i){var r=t.getValue(),n=t.getElement(),a=e&&e.stars?e.stars:5,s=document.createElement("span"),o=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',u='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';s.style.verticalAlign="middle",o.setAttribute("width","14"),o.setAttribute("height","14"),o.setAttribute("viewBox","0 0 512 512"),o.setAttribute("xml:space","preserve"),o.style.padding="0 1px",r=r&&!isNaN(r)?parseInt(r):0,r=Math.max(0,Math.min(r,a));for(var c=1;c<=a;c++){var d=o.cloneNode(!0);d.innerHTML=c<=r?l:u,s.appendChild(d)}return n.style.whiteSpace="nowrap",n.style.overflow="hidden",n.style.textOverflow="ellipsis",n.setAttribute("aria-label",r),s}function Tke(t,e,i){var r=this.sanitizeHTML(t.getValue())||0,n=document.createElement("span"),a=e&&e.max?e.max:100,s=e&&e.min?e.min:0,o=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",u,c;if(!(isNaN(r)||typeof t.getValue()>"u")){switch(n.classList.add("tabulator-traffic-light"),c=parseFloat(r)<=a?parseFloat(r):a,c=parseFloat(c)>=s?parseFloat(c):s,u=(a-s)/100,c=Math.round((c-s)/u),typeof o){case"string":l=o;break;case"function":l=o(r);break;case"object":if(Array.isArray(o)){var d=100/o.length,p=Math.floor(c/d);p=Math.min(p,o.length-1),p=Math.max(p,0),l=o[p];break}}return n.style.backgroundColor=l,n}}function Dke(t,e={},i){var r=this.sanitizeHTML(t.getValue())||0,n=t.getElement(),a=e.max?e.max:100,s=e.min?e.min:0,o=e.legendAlign?e.legendAlign:"center",l,u,c,d,p;switch(u=parseFloat(r)<=a?parseFloat(r):a,u=parseFloat(u)>=s?parseFloat(u):s,l=(a-s)/100,u=Math.round((u-s)/l),typeof e.color){case"string":c=e.color;break;case"function":c=e.color(r);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,I=Math.floor(u/g);I=Math.min(I,e.color.length-1),I=Math.max(I,0),c=e.color[I];break}default:c="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(r);break;case"boolean":d=r;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(r);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,I=Math.floor(u/g);I=Math.min(I,e.legendColor.length-1),I=Math.max(I,0),p=e.legendColor[I]}break;default:p="#000"}n.style.minWidth="30px",n.style.position="relative",n.setAttribute("aria-label",u);var f=document.createElement("div");f.style.display="inline-block",f.style.width=u+"%",f.style.backgroundColor=c,f.style.height="100%",f.setAttribute("data-max",a),f.setAttribute("data-min",s);var h=document.createElement("div");if(h.style.position="relative",h.style.width="100%",h.style.height="100%",d){var m=document.createElement("div");m.style.position="absolute",m.style.top=0,m.style.left=0,m.style.textAlign=o,m.style.width="100%",m.style.color=p,m.innerHTML=d}return i(function(){if(!(t instanceof mte)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",n.appendChild(g),n=g}n.appendChild(h),h.appendChild(f),d&&h.appendChild(m)}),""}function Pke(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function Eke(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function Rke(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function Cke(t,e,i){var r=t.getValue(),n=e.size||15,a=n+"px",s,o,l=e.hasOwnProperty("onValue")?e.onValue:!0,u=e.hasOwnProperty("offValue")?e.offValue:!1,c=e.onTruthy?r:r===l;return s=document.createElement("div"),s.classList.add("tabulator-toggle"),c?(s.classList.add("tabulator-toggle-on"),s.style.flexDirection="row-reverse",e.onColor&&(s.style.background=e.onColor)):e.offColor&&(s.style.background=e.offColor),s.style.width=2.5*n+"px",s.style.borderRadius=a,e.clickable&&s.addEventListener("click",d=>{t.setValue(c?u:l)}),o=document.createElement("div"),o.classList.add("tabulator-toggle-switch"),o.style.height=a,o.style.width=a,o.style.borderRadius=a,s.appendChild(o),s}function Mke(t,e,i){var r=document.createElement("span"),n=t.getRow(),a=t.getTable();return n.watchPosition(s=>{e.relativeToPage&&(s+=a.modules.page.getPageSize()*(a.modules.page.getPage()-1)),r.innerText=s}),r}function Nke(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}function Ake(t,e,i){var r,n,a;function s(o){var l=o.getValue(),u="plaintext";switch(typeof l){case"boolean":u="tickCross";break;case"string":l.includes(`
`)&&(u="textarea");break}return u}return r=e.formatterLookup?e.formatterLookup(t):s(t),e.paramsLookup&&(a=typeof e.paramsLookup=="function"?e.paramsLookup(r,t):e.paramsLookup[r]),n=this.table.modules.format.lookupFormatter(r),n.call(this,t,a||{},i)}function kke(t,e,i){var r=e.delimiter||",",n=t.getValue(),a=this.table,s;return e.valueMap&&(typeof e.valueMap=="string"?s=function(o){return o.map(l=>Ir.retrieveNestedData(a.options.nestedFieldSeparator,e.valueMap,l))}:s=e.valueMap),Array.isArray(n)?(s&&(n=s(n)),n.join(r)):n}function Oke(t,e,i){var r=e.indent||"	",n=typeof e.multiline>"u"?!0:e.multiline,a=e.replacer||null,s=t.getValue();return n&&(t.getElement().style.whiteSpace="pre-wrap"),JSON.stringify(s,a,r)}var xke={plaintext:fke,html:hke,textarea:mke,money:gke,link:Ike,image:vke,tickCross:yke,datetime:bke,datetimediff:wke,lookup:Ske,star:Uke,traffic:Tke,progress:Dke,color:Pke,buttonTick:Eke,buttonCross:Rke,toggle:Cke,rownum:Mke,handle:Nke,adaptable:Ake,array:kke,json:Oke};class _g extends oi{static moduleName="format";static formatters=xke;constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupTypeFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupTypeFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupTypeFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupTypeFormatter(e,"HtmlOutput"))}lookupTypeFormatter(e,i){var r={params:e.definition["formatter"+i+"Params"]||{}},n=e.definition["formatter"+i];return r.formatter=this.lookupFormatter(n),r}lookupFormatter(e){var i;switch(typeof e){case"string":_g.formatters[e]?i=_g.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),i=_g.formatters.plaintext);break;case"function":i=e;break;default:i=_g.formatters.plaintext;break}return i}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,r){var n,a,s,o;return e.definition.titleFormatter?(n=this.lookupFormatter(e.definition.titleFormatter),s=l=>{e.titleFormatterRendered=l},o={getValue:function(){return i},getElement:function(){return r},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},a=e.definition.titleFormatterParams||{},a=typeof a=="function"?a():a,n.call(this,o,a,s)):i}formatValue(e){var i=e.getComponent(),r=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function n(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,r,n)}formatExportValue(e,i){var r=e.column.modules.format[i],n;if(r){let s=function(o){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=o,e.modules.format.rendered=!1};var a=s;return n=typeof r.params=="function"?r.params(e.getComponent()):r.params,r.formatter.call(this,e.getComponent(),n,s)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(r){return i[r]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}}class Fke extends oi{static moduleName="frozenColumns";constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],r=0,n=0;this.leftColumns.forEach((a,s)=>{if(a.modules.frozen.marginValue=r,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(r+=a.getWidth()),s==this.leftColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup){var o=this.getColGroupParentElement(a);i.includes(o)||(this.layoutElement(o,a),i.push(o)),o.classList.toggle("tabulator-frozen-left",a.modules.frozen.edge&&a.modules.frozen.position==="left"),o.classList.toggle("tabulator-frozen-right",a.modules.frozen.edge&&a.modules.frozen.position==="right")}else this.layoutElement(a.getElement(),a);e&&a.cells.forEach(l=>{this.layoutElement(l.getElement(!0),a)})}),this.rightColumns.forEach((a,s)=>{a.modules.frozen.marginValue=n,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(n+=a.getWidth()),s==this.rightColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup?this.layoutElement(this.getColGroupParentElement(a),a):this.layoutElement(a.getElement(),a),e&&a.cells.forEach(o=>{this.layoutElement(o.getElement(!0),a)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));i.forEach(r=>{r.deinitialize()}),e.forEach(r=>{r.type==="row"&&this.layoutRow(r)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)}),this.rightColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)})}layoutElement(e,i){var r;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?r=i.modules.frozen.position==="left"?"right":"left":r=i.modules.frozen.position,e.style[r]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}getFrozenColumns(){return this.leftColumns.concat(this.rightColumns)}_calcSpace(e,i){var r=0;for(let n=0;n<i;n++)e[n].visible&&(r+=e[n].getWidth());return r}}class Lke extends oi{static moduleName="frozenRows";constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,r=typeof i;r==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):r==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(r=>{i.push(r)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(r){var n=i.indexOf(r);n>-1&&i.splice(n,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var r=e.getElement();r.parentNode&&r.parentNode.removeChild(r),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,r)=>{this.table.rowManager.styleRow(i,r)})}}class _ke{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,r)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class $g{constructor(e,i,r,n,a,s,o){this.groupManager=e,this.parent=i,this.key=n,this.level=r,this.field=a,this.hasSubGroups=r<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=o,this.rows=[],this.groups=[],this.groupList=[],this.generator=s,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=o?o.visible:typeof e.startOpen[r]<"u"?e.startOpen[r]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var r=i+"_"+e,n=new $g(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[r]:!1);this.groups[r]=n,this.groupList.push(n)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var r=this.groupManager.groupIDLookups[i].func(e.getData()),n=i+"_"+r;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[n]&&this.groups[n].addRow(e):(this.groups[n]||this._createGroup(r,i),this.groups[n].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,r){var n=this.conformRowData({});e.updateData(n);var a=this.rows.indexOf(i);a>-1?r?this.rows.splice(a+1,0,e):this.rows.splice(a,0,e):r?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),r=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(r.parentNode&&r.parentNode.removeChild(r),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var r=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(n=>{r.push(n.getData(i||"data"))}),r}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(r=>{r.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var r=i.getHeadersAndRows();r.forEach(n=>{var a=n.getElement();e.parentNode.insertBefore(a,e.nextSibling),n.initialize(),e=a})}):this.rows.forEach(i=>{var r=i.getElement();e.parentNode.insertBefore(r,e.nextSibling),i.initialize(),e=r}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(r){var n=r.getRowGroup(e);n&&(i=n)}):this.rows.find(function(r){return r===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getRows(e,i){var r=[];return i&&this.groupList.length?this.groupList.forEach(n=>{r=r.concat(n.getRows(e,i))}):this.rows.forEach(function(n){r.push(e?n.getComponent():n)}),r}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(r){e.push(r.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,Ir.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new _ke(this)),this.component}}class $ke extends oi{static moduleName="groupRows";constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,r=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(r)&&e.length>r.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(a,s)=>{this.headerGenerator[0]=(o,l,u)=>(typeof o>"u"?"":o)+"<span>("+l+" "+(l===1?a:s.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var n=this.table.columnManager.getRealColumns();n.forEach(a=>{a.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),a.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((a,s)=>{var o,l;typeof a=="function"?o=a:(l=this.table.columnManager.getColumnByField(a),l?o=function(u){return l.getFieldValue(u)}:o=function(u){return u[a]}),this.groupIDLookups.push({field:typeof a=="function"?!1:a,func:o,values:this.allowedValues?this.allowedValues[s]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(a=>{}),this.startOpen=i),r&&(this.headerGenerator=Array.isArray(r)?r:[r])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var r=this.getGroups(!1)[0];i.push(r.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(r=>r.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,r){if(this.table.options.groupBy){this.assignRowToGroup(e);var n=e.modules.group.rows;return n.length>1&&(!i||i&&n.indexOf(i)==-1?r?n[0]!==e&&(i=n[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):n[n.length-1]!==e&&(i=n[n.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,r){if(this.table.options.groupBy){!r&&i instanceof $g&&(i=this.table.rowManager.prevDisplayRow(e)||i);var n=i instanceof $g?i:i.modules.group,a=e instanceof $g?e:e.modules.group;n===a?this.table.rowManager.moveRowInArray(n.rows,e,i,r):(a&&a.removeRow(e),n.insertRow(e,i,r))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(r=>{r.groupList.length?i=i.concat(this.getChildGroups(r)):i.push(r)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(r=>{var n={};n.level=0,n.rowCount=0,n.headerContent="";var a=[];r.hasSubGroups?(a=this.pullGroupListData(r.groupList),n.level=r.level,n.rowCount=a.length-r.groupList.length,n.headerContent=r.generator(r.key,n.rowCount,r.rows,r),i.push(n),i=i.concat(a)):(n.level=r.level,n.headerContent=r.generator(r.key,r.rows.length,r.rows,r),n.rowCount=r.getRows().length,i.push(n),r.getRows().forEach(s=>{i.push(s.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(r=>{var n=r.getRowGroup(e);n&&(i=n)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(r=>{this.createGroup(r,0,i)}),e.forEach(r=>{this.assignRowToExistingGroup(r,i)})):e.forEach(r=>{this.assignRowToGroup(r,i)}),Object.values(i).forEach(r=>{r.wipe(!0)})}createGroup(e,i,r){var n=i+"_"+e,a;r=r||[],a=new $g(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],r[n]),this.groups[n]=a,this.groupList.push(a)}assignRowToExistingGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n="0_"+r;this.groups[n]&&this.groups[n].addRow(e)}assignRowToGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n=!this.groups["0_"+r];return n&&this.createGroup(r,0,i),this.groups["0_"+r].addRow(e),!n}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,r=i.getPath(),n=this.getExpectedPath(e),a;a=r.length==n.length&&r.every((s,o)=>s===n[o]),a||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],r=e.getData();return this.groupIDLookups.forEach(n=>{i.push(n.func(r))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(r=>{i=i.concat(r.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((r,n)=>{this.table.rowManager.styleRow(r,n),e.appendChild(r.getElement()),r.initialize(!0),r.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}var Bke={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},Vke={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},jke={undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"]},Gke={undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))}},Hke={keybindings:{bindings:jke,actions:Gke}};class HP extends oi{static moduleName="history";static moduleExtensions=Hke;static undoers=Bke;static redoers=Vke;constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,r){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:r})}rowAdded(e,i,r,n){this.action("rowAdd",e,{data:i,pos:r,index:n})}rowDeleted(e){var i,r;this.table.options.groupBy?(r=e.getComponent().getGroup()._getSelf().rows,i=r.indexOf(e),i&&(i=r[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,r){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:r}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(r){return r.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return HP.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return HP.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(r){if(r.component instanceof La)r.component===e&&(r.component=i);else if(r.component instanceof nU&&r.component.row===e){var n=r.component.column.getField();n&&(r.component=i.getCell(n))}})}}class Wke extends oi{static moduleName="htmlTableImport";constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,r=e.getElementsByTagName("th"),n=e.getElementsByTagName("tbody")[0],a=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),n=n?n.getElementsByTagName("tr"):[],this._extractOptions(e,i),r.length?this._extractHeaders(r,n):this._generateBlankHeaders(r,n);for(var s=0;s<n.length;s++){var o=n[s],l=o.getElementsByTagName("td"),u={};this.hasIndex||(u[i.index]=s);for(var c=0;c<l.length;c++){var d=l[c];typeof this.fieldIndex[c]<"u"&&(u[this.fieldIndex[c]]=d.innerHTML)}a.push(u)}i.data=a,this.dispatchExternal("htmlImported")}_extractOptions(e,i,r){var n=e.attributes,a=Object.keys(r||i),s={};a.forEach(c=>{s[c.toLowerCase()]=c});for(var o in n){var l=n[o],u;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(u=l.name.replace("tabulator-",""),typeof s[u]<"u"&&(i[s[u]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(r=>r.title===e);return i||!1}_extractHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a=!1,s=this._findCol(n.textContent),o;s?a=!0:s={title:n.textContent.trim()},s.field||(s.field=n.textContent.trim().toLowerCase().replaceAll(" ","_")),o=n.getAttribute("width"),o&&!s.width&&(s.width=o),this._extractOptions(n,s,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[r]=s.field,s.field==this.table.options.index&&(this.hasIndex=!0),a||this.table.options.columns.push(s)}}_generateBlankHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a={title:"",field:"col"+r};this.fieldIndex[r]=a.field;var s=n.getAttribute("width");s&&(a.width=s),this.table.options.columns.push(a)}}}function zke(t){var e=[],i=0,r=0,n=!1;for(let a=0;a<t.length;a++){let s=t[a],o=t[a+1];if(e[i]||(e[i]=[]),e[i][r]||(e[i][r]=""),s=='"'&&n&&o=='"'){e[i][r]+=s,a++;continue}if(s=='"'){n=!n;continue}if(s==","&&!n){r++;continue}if(s=="\r"&&o==`
`&&!n){r=0,i++,a++;continue}if((s=="\r"||s==`
`)&&!n){r=0,i++;continue}e[i][r]+=s}return e}function qke(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function Yke(t){return t}function Kke(t){var e=this.dependencyRegistry.lookup("XLSX"),i=e.read(t),r=i.Sheets[i.SheetNames[0]];return e.utils.sheet_to_json(r,{header:1})}var Xke={csv:zke,json:qke,array:Yke,xlsx:Kke};class cB extends oi{static moduleName="import";static importers=Xke;constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text"),this.registerTableOption("importHeaderTransform"),this.registerTableOption("importValueTransform"),this.registerTableOption("importDataValidator"),this.registerTableOption("importFileValidator")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,r,n,a){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(s=>(console.error("Import Error:",s||"Unable to import data"),Promise.reject(s)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=cB.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i,r){var n=this.lookupImporter(e);if(n)return this.pickFile(i,r).then(this.importData.bind(this,n)).then(this.structureData.bind(this)).then(this.mutateData.bind(this)).then(this.validateData.bind(this)).then(this.setData.bind(this)).catch(a=>(this.dispatch("import-error",a),this.dispatchExternal("importError",a),console.error("Import Error:",a||"Unable to import file"),this.table.dataLoader.alertError(),setTimeout(()=>{this.table.dataLoader.clearAlert()},3e3),Promise.reject(a)))}pickFile(e,i){return new Promise((r,n)=>{var a=document.createElement("input");a.type="file",a.accept=e,a.addEventListener("change",s=>{var o=a.files[0],l=new FileReader,u=this.validateFile(o);if(u===!0){switch(this.dispatch("import-importing",a.files),this.dispatchExternal("importImporting",a.files),i||this.table.options.importReader){case"buffer":l.readAsArrayBuffer(o);break;case"binary":l.readAsBinaryString(o);break;case"url":l.readAsDataURL(o);break;default:l.readAsText(o)}l.onload=c=>{r(l.result)},l.onerror=c=>{console.warn("File Load Error - Unable to read file"),n(c)}}else n(u)}),this.dispatch("import-choose"),this.dispatchExternal("importChoose"),a.click()})}importData(e,i){var r;return this.table.dataLoader.alertLoader(),new Promise((n,a)=>{setTimeout(()=>{r=e.call(this.table,i),r instanceof Promise||r?n(r):a()},10)})}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(r=>{i.push(this.table.modules.mutator.transformRow(r,"import"))}):i=e,i}transformHeader(e){var i=[];if(this.table.options.importHeaderTransform)e.forEach(r=>{i.push(this.table.options.importHeaderTransform.call(this.table,r,e))});else return e;return i}transformData(e){var i=[];if(this.table.options.importValueTransform)e.forEach(r=>{i.push(this.table.options.importValueTransform.call(this.table,r,e))});else return e;return i}structureArrayToObject(e){var i=this.transformHeader(e.shift()),r=e.map(n=>{var a={};return n=this.transformData(n),i.forEach((s,o)=>{a[s]=n[o]}),a});return r}structureArrayToColumns(e){var i=[],r=this.transformHeader(e[0]),n=this.table.getColumns();return n[0]&&r[0]&&n[0].getDefinition().title===r[0]&&e.shift(),e.forEach(a=>{var s={};a=this.transformData(a),a.forEach((o,l)=>{var u=n[l];u&&(s[u.getField()]=o)}),i.push(s)}),i}validateFile(e){return this.table.options.importFileValidator?this.table.options.importFileValidator.call(this.table,e):!0}validateData(e){var i;return this.table.options.importDataValidator?(i=this.table.options.importDataValidator.call(this.table,e),i===!0?e:Promise.reject(i)):e}setData(e){return this.dispatch("import-imported",e),this.dispatchExternal("importImported",e),this.table.dataLoader.clearAlert(),this.table.setData(e)}}class Jke extends oi{static moduleName="interaction";constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let r in i)i[r]=null})}cellContentsSelectionFixer(e,i){var r;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(r=document.body.createTextRange(),r.moveToElementText(i.getElement()),r.select()):window.getSelection&&(r=document.createRange(),r.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(r))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,r=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let n in this.eventMap)this.eventMap[n]===r&&this.subscribers[n]&&(i=!1);i&&(this.unsubscribe(r+"-touchstart",this.touchSubscribers[r+"-touchstart"]),this.unsubscribe(r+"-touchend",this.touchSubscribers[r+"-touchend"]),delete this.touchSubscribers[r+"-touchstart"],delete this.touchSubscribers[r+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let r in this.eventMap)i[r]&&(this.subscriptionChanged(r,!0),this.columnSubscribers[r]||(this.columnSubscribers[r]=[]),this.columnSubscribers[r].push(e))}handle(e,i,r){this.dispatchEvent(e,i,r)}handleTouch(e,i,r,n){var a=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":a.tap=!0,clearTimeout(a.tapHold),a.tapHold=setTimeout(()=>{clearTimeout(a.tapHold),a.tapHold=null,a.tap=null,clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"TapHold",r,n)},1e3);break;case"end":a.tap&&(a.tap=null,this.dispatchEvent(e+"Tap",r,n)),a.tapDbl?(clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"DblTap",r,n)):a.tapDbl=setTimeout(()=>{clearTimeout(a.tapDbl),a.tapDbl=null},300),clearTimeout(a.tapHold),a.tapHold=null;break}}dispatchEvent(e,i,r){var n=r.getComponent(),a;this.columnSubscribers[e]&&(r instanceof nU?a=r.column.definition[e]:r instanceof ec&&(a=r.definition[e]),a&&a(i,n)),this.dispatchExternal(e,i,n)}}var Qke={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35},Zke={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,r=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=r?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)}};class ab extends oi{static moduleName="keybindings";static bindings=Qke;static actions=Zke;constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,ab.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)ab.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(r=>{var n=Array.isArray(r)?r:[r];n.forEach(a=>{this.mapBinding(i,a)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var r={action:ab.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},n=i.toString().toLowerCase().split(" ").join("").split("+");n.forEach(a=>{switch(a){case"ctrl":r.ctrl=!0;break;case"shift":r.shift=!0;break;case"meta":r.meta=!0;break;default:a=isNaN(a)?a.toUpperCase().charCodeAt(0):parseInt(a),r.keys.push(a),this.watchKeys[a]||(this.watchKeys[a]=[]),this.watchKeys[a].push(r)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];n&&(e.pressedKeys.push(r),n.forEach(function(a){e.checkBinding(i,a)}))},this.keydownBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];if(n){var a=e.pressedKeys.indexOf(r);a>-1&&e.pressedKeys.splice(a,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var r=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(n=>{var a=this.pressedKeys.indexOf(n);a==-1&&(r=!1)}),r&&i.action.call(this,e),!0):!1}}class eOe extends oi{static moduleName="menu";constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadMenuEvent(r.column.definition[e],i,r)}loadMenuTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadMenuEvent(r.definition[e],i,r)}loadMenuEvent(e,i,r){r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent()):e,this.loadMenu(i,r,e)}loadMenu(e,i,r,n,a){var s=!(e instanceof MouseEvent),o=document.createElement("div"),l;if(o.classList.add("tabulator-menu"),s||e.preventDefault(),!(!r||!r.length)){if(n)l=a.child(o);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(o)}r.forEach(u=>{var c=document.createElement("div"),d=u.label,p=u.disabled;u.separator?c.classList.add("tabulator-menu-separator"):(c.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?c.appendChild(d):c.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(c.classList.add("tabulator-menu-item-disabled"),c.addEventListener("click",f=>{f.stopPropagation()})):u.menu&&u.menu.length?c.addEventListener("click",f=>{f.stopPropagation(),this.loadMenu(f,i,u.menu,c,l)}):u.action&&c.addEventListener("click",f=>{u.action(f,i.getComponent())}),u.menu&&u.menu.length&&c.classList.add("tabulator-menu-item-submenu")),o.appendChild(c)}),o.addEventListener("click",u=>{this.rootPopup&&this.rootPopup.hide()}),l.show(n||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",r,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",r,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}class tOe extends oi{static moduleName="moveColumn";constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,r={},n;!e.modules.frozen&&!e.isGroup&&!e.isRowHeader&&(n=e.getElement(),r.mousemove=(function(a){e.parent===i.moving.parent&&((i.touchMove?a.touches[0].pageX:a.pageX)-Ir.elOffset(n).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n),i.moveColumn(e,!1)))}).bind(i),n.addEventListener("mousedown",function(a){i.touchMove=!1,a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=r}bindTouchEvents(e){var i=e.getElement(),r=!1,n,a,s,o,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextColumn(),s=n?n.getWidth()/2:0,a=e.prevColumn(),o=a?a.getWidth()/2:0,l=0,u=0,r=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",c=>{var d,p;this.moving&&(this.moveHover(c),r||(r=c.touches[0].pageX),d=c.touches[0].pageX-r,d>0?n&&d-l>s&&(p=n,p!==e&&(r=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):a&&-d-u>o&&(p=a,p!==e&&(r=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(n=p.nextColumn(),l=s,s=n?n.getWidth()/2:0,a=p.prevColumn(),u=o,o=a?a.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(c)})}startMove(e,i){var r=i.getElement(),n=this.table.columnManager.getContentsElement(),a=this.table.columnManager.getHeadersElement();this.table.modules.selectRange&&this.table.modules.selectRange.columnSelection&&this.table.modules.selectRange.mousedown&&this.table.modules.selectRange.selecting==="column"||(this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-Ir.elOffset(r).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),n.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=n.clientHeight-a.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e),this.dispatch("column-moving",e,this.moving))}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var r=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(n,a){var s=n.getElement(!0);s.parentNode&&r[a]&&s.parentNode.insertBefore(r[a].getElement(),s.nextSibling)}):e.getCells().forEach(function(n,a){var s=n.getElement(!0);s.parentNode&&r[a]&&s.parentNode.insertBefore(r[a].getElement(),s)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),r=i.scrollLeft,n=(this.touchMove?e.touches[0].pageX:e.pageX)-Ir.elOffset(i).left+r,a;this.hoverElement.style.left=n-this.startX+"px",n-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.max(0,r-5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1))),r+i.clientWidth-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.min(i.clientWidth,r+5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1)))}}var iOe={delete:function(t,e,i){t.delete()}},rOe={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};class WP extends oi{static moduleName="moveRow";static senders=iOe;static receivers=rOe;constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,r={};r.mouseup=(function(n){i.tableRowDrop(n,e)}).bind(i),r.mousemove=(function(n){var a;n.pageY-Ir.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a=e.getElement(),a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a=e.getElement(),a.previousSibling&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=r}initializeRow(e){var i=this,r={},n;r.mouseup=(function(a){i.tableRowDrop(a,e)}).bind(i),r.mousemove=(function(a){var s=e.getElement();a.pageY-Ir.elOffset(s).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(s.parentNode.insertBefore(i.placeholderElement,s.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(s.parentNode.insertBefore(i.placeholderElement,s),i.moveRow(e,!1))}).bind(i),this.hasHandle||(n=e.getElement(),n.addEventListener("mousedown",function(a){a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=r}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,r=e.getElement(!0);r.addEventListener("mousedown",function(n){n.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(n,e.row)},i.checkPeriod))}),r.addEventListener("mouseup",function(n){n.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,r)}}bindTouchEvents(e,i){var r=!1,n,a,s,o,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextRow(),s=n?n.getHeight()/2:0,a=e.prevRow(),o=a?a.getHeight()/2:0,l=0,u=0,r=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",c=>{var d,p;this.moving&&(c.preventDefault(),this.moveHover(c),r||(r=c.touches[0].pageY),d=c.touches[0].pageY-r,d>0?n&&d-l>s&&(p=n,p!==e&&(r=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):a&&-d-u>o&&(p=a,p!==e&&(r=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(n=p.nextRow(),l=s,s=n?n.getHeight()/2:0,a=p.prevRow(),u=o,o=a?a.getHeight()/2:0))}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(c),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var r=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r)),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var r=this.touchMove?e.touches[0].pageX:e.pageX,n=this.touchMove?e.touches[0].pageY:e.pageY,a,s;a=i.getElement(),this.connection?(s=a.getBoundingClientRect(),this.startX=s.left-r+window.pageXOffset,this.startY=s.top-n+window.pageYOffset):this.startY=n-a.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),r=i.scrollTop,n=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+r;this.hoverElement.style.top=Math.min(n-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,r){this.dispatchExternal("movableRowsElementDrop",e,i,r?r.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(r=>{typeof r=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(r))):this.connectionElements.push(r)}),this.connectionElements.forEach(r=>{var n=a=>{this.elementRowDrop(a,r,this.moving)};r.addEventListener("mouseup",n),r.tabulatorElementDropEvent=n,r.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(r=>{r.type==="row"&&r.modules.moveRow&&r.modules.moveRow.mouseup&&r.getElement().addEventListener("mouseup",r.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,r){var n=!1;if(r){switch(typeof this.table.options.movableRowsSender){case"string":n=WP.senders[this.table.options.movableRowsSender];break;case"function":n=this.table.options.movableRowsSender;break}n?n.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var r=!1,n=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":r=WP.receivers[this.table.options.movableRowsReceiver];break;case"function":r=this.table.options.movableRowsReceiver;break}r?n=r.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),n?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:n})}commsReceived(e,i,r){switch(i){case"connect":return this.connect(e,r.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,r.row,r.success)}}}var nOe={};class zP extends oi{static moduleName="mutator";static mutators=nOe;constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard","import"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutatorImport"),this.registerColumnOption("mutatorImportParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,r){return this.transformRow(i,"data",r)}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="mutator"+(n.charAt(0).toUpperCase()+n.slice(1)),s;e.definition[a]&&(s=this.lookupMutator(e.definition[a]),s&&(i=!0,r[a]={mutator:s,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.mutate=r)}lookupMutator(e){var i=!1;switch(typeof e){case"string":zP.mutators[e]?i=zP.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,r){var n="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),a;return this.enabled&&this.table.columnManager.traverse(s=>{var o,l,u;s.modules.mutate&&(o=s.modules.mutate[n]||s.modules.mutate.mutator||!1,o&&(a=s.getFieldValue(typeof r<"u"?r:e),(i=="data"&&!r||typeof a<"u")&&(u=s.getComponent(),l=typeof o.params=="function"?o.params(a,e,i,u):o.params,s.setFieldValue(e,o.mutator(a,e,i,l,u)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var r=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,n={};if(r)return n=Object.assign(n,e.row.getData()),e.column.setFieldValue(n,i),r.mutator(i,n,"edit",r.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(r=>{var n=e.row.getCell(r);n&&n.setValue(n.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}}function aOe(t,e,i,r,n){var a=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{s.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{c.innerHTML=d}),r?(o.innerHTML=" "+e+"-"+Math.min(e+t-1,r)+" ",u.innerHTML=" "+r+" ",a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(u),a.appendChild(c)):(o.innerHTML=" 0 ",a.appendChild(s),a.appendChild(o),a.appendChild(c)),a}function sOe(t,e,i,r,n){var a=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{s.innerHTML=d}),o.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),u.innerHTML=" "+n+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{c.innerHTML=d}),a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(u),a.appendChild(c),a}var oOe={rows:aOe,pages:sOe};class dB extends oi{static moduleName="page";static pageCounters=oOe;constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("paginationOutOfRange",!1),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var r=this.table.rowManager,n=r.getDisplayRows(),a;return i?n.length?a=n[0]:r.activeRows.length&&(a=r.activeRows[r.activeRows.length-1],i=!1):n.length&&(a=n[n.length-1],i=!(n.length<this.size)),{index:a,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,r,n){return this.initialLoad||(this.progressiveLoad&&!r||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),n.page=this.page,this.size&&(n.size=this.size),n}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var r,n,a;!i&&!this.table.dataLoader.loading&&(r=this.table.rowManager.getElement(),n=r.scrollHeight-r.clientHeight-e,a=this.table.options.progressiveLoadScrollMargin||r.clientHeight*2,n<a&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var r=document.createElement("option");r.value=i,i===!0?this.langBind("pagination|all",function(n){r.innerHTML=n}):r.innerHTML=i,this.pageSizeSelect.appendChild(r)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=dB.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,r;e||(this.langBind("pagination|first",n=>{this.firstBut.innerHTML=n}),this.langBind("pagination|first_title",n=>{this.firstBut.setAttribute("aria-label",n),this.firstBut.setAttribute("title",n)}),this.langBind("pagination|prev",n=>{this.prevBut.innerHTML=n}),this.langBind("pagination|prev_title",n=>{this.prevBut.setAttribute("aria-label",n),this.prevBut.setAttribute("title",n)}),this.langBind("pagination|next",n=>{this.nextBut.innerHTML=n}),this.langBind("pagination|next_title",n=>{this.nextBut.setAttribute("aria-label",n),this.nextBut.setAttribute("title",n)}),this.langBind("pagination|last",n=>{this.lastBut.innerHTML=n}),this.langBind("pagination|last_title",n=>{this.lastBut.setAttribute("aria-label",n),this.lastBut.setAttribute("title",n)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",n=>{this.pageSizeSelect.setAttribute("aria-label",n),this.pageSizeSelect.setAttribute("title",n),i.innerHTML=n}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",n=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(r=document.querySelector(this.table.options.paginationCounterElement),r?r.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),r=i.indexOf(e);if(r>-1){var n=this.size===!0?1:Math.ceil((r+1)/this.size);return this.setPage(n)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,r){var n;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,r=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),n=this.pageCounter.call(this,i,r,this.page,e,this.max),typeof n){case"object":if(n instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(n)}else this.pageCounterElement.innerHTML="",n!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",n);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=n}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),r=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),n=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let a=r;a<=n;a++)a>0&&a<=this.max&&this.pagesElement.appendChild(this._generatePageButton(a));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",r=>{i.setAttribute("aria-label",r+" "+e),i.setAttribute("title",r+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",r=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,r,n,a,s,o=e.filter(l=>l.type==="row");if(this.mode=="local"){r=[],this.setMaxRows(e.length),this.size===!0?(n=0,a=e.length):(n=this.size*(this.page-1),a=n+parseInt(this.size)),this._setPageButtons();for(let l=n;l<a;l++){let u=e[l];u&&(r.push(u),u.type==="row"&&(s||(s=u),i++))}return this._setPageCounter(o.length,i,s?o.indexOf(s)+1:0),r}else return this._setPageButtons(),this._setPageCounter(o.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i,r;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else{if(this.page>this.max&&(console.warn("Remote Pagination Error - Server returned last page value lower than the current page"),r=this.options("paginationOutOfRange"),r))return this.setPage(typeof r=="function"?r.call(this,this.page,this.max):r);this.dispatchExternal("pageLoaded",this.getPage())}else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}}var lOe={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,r=t+"-"+e,n=i.indexOf(r+"="),a,s;return n>-1&&(i=i.slice(n),a=i.indexOf(";"),a>-1&&(i=i.slice(0,a)),s=i.replace(r+"=","")),s?JSON.parse(s):!1}},uOe={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var r=new Date;r.setDate(r.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+r.toUTCString()}};class zu extends oi{static moduleName="persistence";static moduleInitOrder=-10;static readers=lOe;static writers=uOe;constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,r;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:zu.readers[this.table.options.persistenceReaderFunc]?this.readFunc=zu.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):zu.readers[this.mode]?this.readFunc=zu.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:zu.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=zu.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):zu.writers[this.mode]?this.writeFunc=zu.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(r=this.retrieveData("page"),r&&(typeof r.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=r.paginationSize),typeof r.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=r.paginationInitialPage))),this.config.group&&(r=this.retrieveData("group"),r&&(typeof r.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=r.groupBy),typeof r.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=r.groupStartOpen),typeof r.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=r.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,r;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(r=this.load("headerFilter"),r&&(this.table.options.initialHeaderFilter=r))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,r;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),r=this.config.columns===!0?Object.keys(i):this.config.columns,r.forEach(n=>{var a=Object.getOwnPropertyDescriptor(i,n),s=i[n];a&&Object.defineProperty(i,n,{set:o=>{s=o,this.defWatcherBlock||this.save("columns"),a.set&&a.set(o)},get:()=>(a.get&&a.get(),s)})}),this.defWatcherBlock=!1)}load(e,i){var r=this.retrieveData(e);return i&&(r=r?this.mergeDefinition(i,r):i),r}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,r){var n=[];return i=i||[],i.forEach((a,s)=>{var o=this._findColumn(e,a),l;o&&(r?l=Object.keys(a):this.config.columns===!0||this.config.columns==null?(l=Object.keys(o),l.push("width")):l=this.config.columns,l.forEach(u=>{u!=="columns"&&typeof a[u]<"u"&&(o[u]=a[u])}),o.columns&&(o.columns=this.mergeDefinition(o.columns,a.columns)),n.push(o))}),e.forEach((a,s)=>{var o=this._findColumn(i,a);o||(n.length>s?n.splice(s,0,a):n.push(a))}),n}_findColumn(e,i){var r=i.columns?"group":i.field?"field":"object";return e.find(function(n){switch(r){case"group":return n.title===i.title&&n.columns.length===i.columns.length;case"field":return n.field===i.field;case"object":return n===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],r=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(n=>{var a={},s=n.getDefinition(),o;n.isGroup?(a.title=s.title,a.columns=this.parseColumns(n.getColumns())):(a.field=n.getField(),this.config.columns===!0||this.config.columns==null?(o=Object.keys(s),o.push("width"),o.push("visible")):o=this.config.columns,o.forEach(l=>{switch(l){case"width":a.width=n.getWidth();break;case"visible":a.visible=n.visible;break;default:typeof s[l]!="function"&&r.indexOf(l)===-1&&(a[l]=s[l])}})),i.push(a)}),i}}class cOe extends oi{static moduleName="popup";constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,r){this.loadPopupEvent(i,null,e,r)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadPopupEvent(r.column.definition[e],i,r)}loadPopupTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadPopupEvent(r.definition[e],i,r)}loadPopupEvent(e,i,r,n){var a;function s(o){a=o}r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent(),s):e,this.loadPopup(i,r,e,a,n)}loadPopup(e,i,r,n,a){var s=!(e instanceof MouseEvent),o,l;r instanceof HTMLElement?o=r:(o=document.createElement("div"),o.innerHTML=r),o.classList.add("tabulator-popup"),o.addEventListener("click",u=>{u.stopPropagation()}),s||e.preventDefault(),l=this.popup(o),typeof n=="function"&&l.renderCallback(n),e?l.show(e):l.show(i.getElement(),a||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}}class dOe extends oi{static moduleName="print";constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,r){var n=window.scrollX,a=window.scrollY,s=document.createElement("div"),o=document.createElement("div"),l=this.table.modules.export.generateTable(typeof r<"u"?r:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),u,c;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(s.classList.add("tabulator-print-header"),u=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof u=="string"?s.innerHTML=u:s.appendChild(u),this.element.appendChild(s)),this.element.appendChild(l),this.table.options.printFooter&&(o.classList.add("tabulator-print-footer"),c=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof c=="string"?o.innerHTML=c:o.appendChild(c),this.element.appendChild(o)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(n,a),this.manualBlock=!1}}class pOe extends oi{static moduleName="reactiveData";constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,r;this.currentVersion++,r=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-push"),n.forEach(s=>{i.table.rowManager.addRowActual(s,!1)}),a=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),a}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-unshift"),n.forEach(s=>{i.table.rowManager.addRowActual(s,!0)}),a=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),a}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-shift"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[0]),n&&n.deleteActual()),a=i.origFuncs.shift.call(e),i.unblock("data-shift")),a}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-pop"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),n&&n.deleteActual()),a=i.origFuncs.pop.call(e),i.unblock("data-pop")),a}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a=n[0]<0?e.length+n[0]:n[0],s=n[1],o=n[2]?n.slice(2):!1,l,u;if(!i.blocked&&r===i.currentVersion){if(i.block("data-splice"),o&&(l=e[a]?i.table.rowManager.getRowFromDataObject(e[a]):!1,l?o.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(o=o.slice().reverse(),o.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),s!==0){var c=e.slice(a,typeof n[1]>"u"?n[1]:a+s);c.forEach((d,p)=>{var f=i.table.rowManager.getRowFromDataObject(d);f&&f.deleteActual(p!==c.length-1)})}(o||s!==0)&&i.table.rowManager.reRenderInPosition(),u=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return u}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var r in i)this.watchKey(e,i,r);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,r=e.getData()[this.table.options.dataTreeChildField],n={};r&&(n.push=r.push,Object.defineProperty(r,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var a=n.push.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-push")}return a}}),n.unshift=r.unshift,Object.defineProperty(r,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var a=n.unshift.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return a}}),n.shift=r.shift,Object.defineProperty(r,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var a=n.shift.call(r);this.rebuildTree(e),i.unblock("tree-shift")}return a}}),n.pop=r.pop,Object.defineProperty(r,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var a=n.pop.call(r);this.rebuildTree(e),i.unblock("tree-pop")}return a}}),n.splice=r.splice,Object.defineProperty(r,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var a=n.splice.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return a}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,r){var n=this,a=Object.getOwnPropertyDescriptor(i,r),s=i[r],o=this.currentVersion;Object.defineProperty(i,r,{set:l=>{if(s=l,!n.blocked&&o===n.currentVersion){n.block("key");var u={};u[r]=l,e.updateData(u),n.unblock("key")}a.set&&a.set(l)},get:()=>(a.get&&a.get(),s)})}unwatchRow(e){var i=e.getData();for(var r in i)Object.defineProperty(i,r,{value:i[r]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}class fOe extends oi{static moduleName="resizeColumns";constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1),this.registerTableOption("resizableColumnGuide",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(r=>{r.modules.resize&&r.modules.resize.handleEl&&(i&&(r.modules.resize.handleEl.style[e.modules.frozen.position]=i,r.modules.resize.handleEl.style["z-index"]=11),r.element.after(r.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,r,n){var a=this,s=!1,o=r.definition.resizable,l={},u=r.getLastColumn();if(e==="header"&&(s=r.definition.formatter=="textarea"||r.definition.variableHeight,l={variableHeight:s}),(o===!0||o==e)&&this._checkResizability(u)){var c=document.createElement("span");c.className="tabulator-col-resize-handle",c.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){a.startColumn=r,a.initialNextColumn=a.nextColumn=u.nextColumn(),a._mouseDown(p,u,c)};c.addEventListener("mousedown",d),c.addEventListener("touchstart",d,{passive:!0}),c.addEventListener("dblclick",p=>{var f=u.getWidth();p.stopPropagation(),u.reinitializeWidth(!0),f!==u.getWidth()&&(a.dispatch("column-resized",u),a.dispatchExternal("columnResized",u.getComponent()))}),r.modules.frozen&&(c.style.position="sticky",c.style[r.modules.frozen.position]=this.frozenColumnOffset(r)),l.handleEl=c,n.parentNode&&r.visible&&n.after(c)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}resize(e,i){var r=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n=r-this.startX,a=r-this.latestX,s,o;if(this.latestX=r,this.table.rtl&&(n=-n,a=-a),s=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(this.startWidth+n),o=i.width==i.minWidth||i.width==i.maxWidth,a<0&&(this.nextColumn=this.initialNextColumn),this.table.options.resizableColumnFit&&this.nextColumn&&!(s&&o)){let l=this.nextColumn.getWidth();a>0&&l<=this.nextColumn.minWidth&&(this.nextColumn=this.nextColumn.nextColumn()),this.nextColumn&&this.nextColumn.setWidth(this.nextColumn.getWidth()-a)}this.table.columnManager.rerenderColumns(!0),!this.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}calcGuidePosition(e,i,r){var n=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,a=r.getBoundingClientRect().x-this.table.element.getBoundingClientRect().x,s=this.table.element.getBoundingClientRect().x,o=i.element.getBoundingClientRect().left-s,l=n-this.startX,u=Math.max(a+l,o+i.minWidth);return i.maxWidth&&(u=Math.min(u,o+i.maxWidth)),u}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,r){var n=this,a;this.dispatchExternal("columnResizing",i.getComponent()),n.table.options.resizableColumnGuide&&(a=document.createElement("span"),a.classList.add("tabulator-col-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.left=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function s(l){n.table.options.resizableColumnGuide?a.style.left=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function o(l){n.table.options.resizableColumnGuide&&(n.resize(l,i),a.remove()),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!1),n.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",s),r.removeEventListener("touchmove",s),r.removeEventListener("touchend",o),n.table.element.classList.remove("tabulator-block-select"),n.startWidth!==i.getWidth()&&(n.table.columnManager.verticalAlignHeaders(),n.dispatch("column-resized",i),n.dispatchExternal("columnResized",i.getComponent()))}e.stopPropagation(),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!0),n.startX=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n.latestX=n.startX,n.startWidth=i.getWidth(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),r.addEventListener("touchmove",s,{passive:!0}),r.addEventListener("touchend",o)}}class hOe extends oi{static moduleName="resizeRows";constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1),this.registerTableOption("resizableRowGuide",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,r=e.getElement(),n=document.createElement("div");n.className="tabulator-row-resize-handle";var a=document.createElement("div");a.className="tabulator-row-resize-handle prev",n.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){i.startRow=e,i._mouseDown(l,e,n)};n.addEventListener("mousedown",s),n.addEventListener("touchstart",s,{passive:!0}),a.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){var u=i.table.rowManager.prevDisplayRow(e);u&&(i.startRow=u,i._mouseDown(l,u,a))};a.addEventListener("mousedown",o),a.addEventListener("touchstart",o,{passive:!0}),r.appendChild(n),r.appendChild(a)}resize(e,i){i.setHeight(this.startHeight+((typeof e.screenY>"u"?e.touches[0].screenY:e.screenY)-this.startY))}calcGuidePosition(e,i,r){var n=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,a=r.getBoundingClientRect().y-this.table.element.getBoundingClientRect().y,s=this.table.element.getBoundingClientRect().y,o=i.element.getBoundingClientRect().top-s,l=n-this.startY;return Math.max(a+l,o)}_mouseDown(e,i,r){var n=this,a;n.dispatchExternal("rowResizing",i.getComponent()),n.table.options.resizableRowGuide&&(a=document.createElement("span"),a.classList.add("tabulator-row-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.top=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function s(l){n.table.options.resizableRowGuide?a.style.top=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function o(l){n.table.options.resizableRowGuide&&(n.resize(l,i),a.remove()),document.body.removeEventListener("mouseup",s),document.body.removeEventListener("mousemove",s),r.removeEventListener("touchmove",s),r.removeEventListener("touchend",o),n.table.element.classList.remove("tabulator-block-select"),n.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),n.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,n.startHeight=i.getHeight(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),r.addEventListener("touchmove",s,{passive:!0}),r.addEventListener("touchend",o)}}class mOe extends oi{static moduleName="resizeTable";constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.tableHeight!=n||this.tableWidth!=a)&&(this.tableHeight=n,this.tableWidth=a,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.containerHeight!=n||this.containerWidth!=a)&&(this.containerHeight=n,this.containerWidth=a,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}function gOe(t,e,i){var r=document.createElement("div"),n=t.getRow()._row.modules.responsiveLayout;r.classList.add("tabulator-responsive-collapse-toggle"),r.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function a(s){var o=n.element;n.open=s,o&&(n.open?(r.classList.add("open"),o.style.display=""):(r.classList.remove("open"),o.style.display="none"))}return r.addEventListener("click",function(s){s.stopImmediatePropagation(),a(!n.open),t.getTable().rowManager.adjustTableSize()}),a(n.open),r}var IOe={format:{formatters:{responsiveCollapse:gOe}}};class vOe extends oi{static moduleName="responsiveLayout";static moduleExtensions=IOe;constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.collapseFormatter&&(this.collapseFormatter=this.collapseFormatter.bind(this.table)),this.table.columnManager.columnsByIndex.forEach((i,r)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=r,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,r)=>{var n=r.modules.responsive.order-i.modules.responsive.order;return n||r.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),r=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(r<0){let n=this.columns[this.index];n?(this.hideColumn(n),this.index++):e=!1}else{let n=this.columns[this.index-1];n&&r>0&&r>=n.getWidth()?(this.showColumn(n),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,r;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);r=this.collapseFormatter(this.generateCollapsedRowData(e)),r&&i.appendChild(r),e.calcHeight(!0)}}generateCollapsedRowData(e){var i=e.getData(),r=[],n;return this.hiddenColumns.forEach(a=>{var s=a.getFieldValue(i);if(a.definition.title&&a.field)if(a.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let l=function(u){u()};var o=l;n={value:!1,data:{},getValue:function(){return s},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return a.getComponent()},getTable:()=>this.table},r.push({field:a.field,title:a.definition.title,value:a.modules.format.formatter.call(this.table.modules.format,n,a.modules.format.params,l)})}else r.push({field:a.field,title:a.definition.title,value:s})}),r}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(r=>{var n=document.createElement("tr"),a=document.createElement("td"),s=document.createElement("td"),o,l=document.createElement("strong");a.appendChild(l),this.modules.localize.bind("columns|"+r.field,function(u){l.innerHTML=u||r.title}),r.value instanceof Node?(o=document.createElement("div"),o.appendChild(r.value),s.appendChild(o)):s.innerHTML=r.value,n.appendChild(a),n.appendChild(s),i.appendChild(n)}),Object.keys(e).length?i:""}}function yOe(t,e,i){var r=document.createElement("input"),n=!1;if(r.type="checkbox",r.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(r.addEventListener("click",s=>{s.stopPropagation()}),typeof t.getRow=="function"){var a=t.getRow();a instanceof wM?(r.addEventListener("change",s=>{this.table.options.selectableRowsRangeMode==="click"&&n?n=!1:a.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&r.addEventListener("click",s=>{n=!0,this.table.modules.selectRow.handleComplexRowClick(a._row,s)}),r.checked=a.isSelected&&a.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(a,r)):r=""}else r.addEventListener("change",s=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(r);return r}var bOe={format:{formatters:{rowSelection:yOe}}};class wOe extends oi{static moduleName="selectRow";static moduleExtensions=bOe;constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,r){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,r=i.checkRowSelectability(e),n=e.getElement(),a=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",a)};e.modules.select={selected:!1},n.classList.toggle("tabulator-selectable",r),n.classList.toggle("tabulator-unselectable",!r),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?n.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(n.addEventListener("click",function(s){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),n.addEventListener("mousedown",function(s){if(s.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",a),document.body.addEventListener("keyup",a),i.toggleRow(e),!1}),n.addEventListener("mouseenter",function(s){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),n.addEventListener("mouseout",function(s){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var r=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),n=this.table.rowManager.getDisplayRowIndex(e),a=r<=n?r:n,s=r>=n?r:n,o=this.table.rowManager.getDisplayRows().slice(0),l=o.splice(a,s-a+1);i.ctrlKey||i.metaKey?(l.forEach(u=>{u!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(u):this.toggleRow(u))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],r,n;switch(typeof e){case"undefined":r=this.table.rowManager.rows;break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(a=>{n=this._selectRow(a,!0,!0),n&&i.push(n)}),this._rowSelectionChanged(!1,i)):r&&this._selectRow(r,!1,!0)}_selectRow(e,i,r){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!r&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var n=this.table.rowManager.findRow(e);if(n){if(this.selectedRows.indexOf(n)==-1)return n.getElement().classList.add("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!0,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!0),this.selectedRows.push(n),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!0),this.dispatchExternal("rowSelected",n.getComponent()),this._rowSelectionChanged(i,n),n}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var r=[],n,a;switch(typeof e){case"undefined":n=Object.assign([],this.selectedRows);break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(s=>{a=this._deselectRow(s,!0,!0),a&&r.push(a)}),this._rowSelectionChanged(i,[],r)):n&&this._deselectRow(n,i,!0)}_deselectRow(e,i){var r=this,n=r.table.rowManager.findRow(e),a,s;if(n){if(a=r.selectedRows.findIndex(function(o){return o==n}),a>-1)return s=n.getElement(),s&&s.classList.remove("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!1,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!1),r.selectedRows.splice(a,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!1),this.dispatchExternal("rowDeselected",n.getComponent()),r._rowSelectionChanged(i,void 0,n),n}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],r=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(n=>n.getComponent()),Array.isArray(r)||(r=[r]),r=r.map(n=>n.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,r))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var r=this.table.modules.dataTree.getChildren(e,!0,!0);if(i)for(let n of r)this._selectRow(n,!0);else for(let n of r)this._deselectRow(n,!0)}}class SOe{constructor(e){return this._range=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._range.table.componentFunctionBinder.handle("range",i._range,r)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0,!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}class UOe extends xa{constructor(e,i,r,n){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(r,n)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,r){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(r)}setStartBound(e){var i,r;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,r=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,r))}setEndBound(e){var i=this._getTableRows().length,r,n,a;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(r=e.row.position-1,n=e.column.getPosition()-1,a=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(r,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&a?this.setEnd(r,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,n):this.setEnd(r,n))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,r=this.table.columnManager.renderer.leftCol,n=this.table.columnManager.renderer.rightCol,a,s,o,l,u,c,d,p,f,h;this.table.options.renderHorizontal==="virtual"&&this.rangeManager.rowHeader&&(n+=1),e==null&&(e=0),i==null&&(i=1/0),r==null&&(r=0),n==null&&(n=1/0),this.overlaps(r,e,n,i)&&(a=Math.max(this.top,e),s=Math.min(this.bottom,i),o=Math.max(this.left,r),l=Math.min(this.right,n),u=this.rangeManager.getCell(a,o),c=this.rangeManager.getCell(s,l),d=u.getElement(),p=c.getElement(),f=u.row.getElement(),h=c.row.getElement(),this.element.classList.add("tabulator-range-active"),this.table.rtl?(this.element.style.right=f.offsetWidth-d.offsetLeft-d.offsetWidth+"px",this.element.style.width=d.offsetLeft+d.offsetWidth-p.offsetLeft+"px"):(this.element.style.left=f.offsetLeft+d.offsetLeft+"px",this.element.style.width=p.offsetLeft+p.offsetWidth-d.offsetLeft+"px"),this.element.style.top=f.offsetTop+"px",this.element.style.height=h.offsetTop+h.offsetHeight-f.offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,r,n){return!(this.left>r||e>this.right||this.top>n||i>this.bottom)}getData(){var e=[],i=this.getRows(),r=this.getColumns();return i.forEach(n=>{var a=n.getData(),s={};r.forEach(o=>{s[o.field]=a[o.field]}),e.push(s)}),e}getCells(e,i){var r=[],n=this.getRows(),a=this.getColumns();return e?r=n.map(s=>{var o=[];return s.getCells().forEach(l=>{a.includes(l.column)&&o.push(i?l.getComponent():l)}),o}):n.forEach(s=>{s.getCells().forEach(o=>{a.includes(o.column)&&r.push(i?o.getComponent():o)})}),r}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(r=>{r.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),r={start:null,end:null};return i.length?(r.start=i[0],r.end=i[i.length-1]):console.warn("No bounds defined on range"),r}getComponent(){return this.component||(this.component=new SOe(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}}var TOe={rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},DOe={rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)}},POe={range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,r=!1,n,a,s,o,l;return l=t.length,i&&(n=i.getBounds(),a=n.start,n.start===n.end&&(r=!0),a&&(e=this.table.rowManager.activeRows.slice(),s=e.indexOf(a.row),r?o=t.length:o=e.indexOf(n.end.row)-s+1,s>-1&&(this.table.blockRedraw(),e=e.slice(s,s+o),e.forEach((u,c)=>{u.updateData(t[c%l])}),this.table.restoreRedraw()))),e}},EOe={range:function(t){var e=[],i=[],r=this.table.modules.selectRange.activeRange,n=!1,a,s,o,l,u;return r&&(a=r.getBounds(),s=a.start,a.start===a.end&&(n=!0),s&&(t=t.split(`
`),t.forEach(function(c){e.push(c.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),u=l.indexOf(s.column),u>-1)))?(n?o=e[0].length:o=l.indexOf(a.end.column)-u+1,l=l.slice(u,u+o),e.forEach(c=>{var d={},p=c.length;l.forEach(function(f,h){d[f.field]=c[h%p]}),i.push(d)}),i):!1}},ROe={range:function(){var t=this.modules.selectRange.selectedColumns();return this.columnManager.rowHeader&&t.unshift(this.columnManager.rowHeader),t}},COe={range:function(){return this.modules.selectRange.selectedRows()}},MOe={keybindings:{bindings:TOe,actions:DOe},clipboard:{pasteActions:POe,pasteParsers:EOe},export:{columnLookups:ROe,rowLookups:COe}};class NOe extends oi{static moduleName="selectRange";static moduleInitOrder=1;static moduleExtensions=MOe;constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableOption("selectableRangeAutoFocus",!0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()),this.options("columns").findIndex(e=>e.frozen)>0&&console.warn("Having frozen column in arbitrary position with selectRange option may result in unpredictable behavior."),this.options("columns").filter(e=>e.frozen)>1&&console.warn("Having multiple frozen columns with selectRange option may result in unpredictable behavior."))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-moving",this.handleColumnMoving.bind(this)),this.subscribe("column-moved",this.handleColumnMoved.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){var e;this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior"))),this.table.modules.frozenColumns&&this.table.modules.frozenColumns.active&&(e=this.table.modules.frozenColumns.getFrozenColumns(),(e.length>1||e.length===1&&e[0]!==this.rowHeader)&&console.warn("Using frozen columns that are not the range header in combination with the selectRange option may result in unpredictable behavior"))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(r=>r.occupiesRow(e.row)):i=this.ranges.filter(r=>r.occupies(e)),i.map(r=>r.getComponent())}rowGetRanges(e){var i=this.ranges.filter(r=>r.occupiesRow(e));return i.map(r=>r.getComponent())}colGetRanges(e){var i=this.ranges.filter(r=>r.occupiesColumn(e));return i.map(r=>r.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;this.restoreFocus();try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(r=>r.occupiesColumn(e)),i&&this.ranges.forEach(r=>{var n=r.getColumns(!0);n.forEach(a=>{a!==e&&a.setWidth(e.width)})}))}handleColumnMoving(e,i){this.resetRanges().setBounds(i),this.overlay.style.visibility="hidden"}handleColumnMoved(e,i,r){this.activeRange.setBounds(e),this.layoutElement()}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||this.table.options.movableColumns&&this.selecting==="column"&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),r=this.ranges.findIndex(n=>n.occupies(e));i.classList.toggle("tabulator-range-selected",r!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=r}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e),i.preventDefault()}keyNavigateRange(e,i,r,n){this.navigate(r,n,i),e.preventDefault()}navigate(e,i,r){var n=!1,a,s,o,l,u,c,d,p,f,h,m;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(g=>g===this.activeRange?(g.setEnd(g.start.row,g.start.col),!0):(g.destroy(),!1))),a=this.activeRange,o={top:a.top,bottom:a.bottom,left:a.left,right:a.right},s=i?a.end:a.start,l=s.row,u=s.col,e)switch(r){case"left":u=this.findJumpCellLeft(a.start.row,s.col);break;case"right":u=this.findJumpCellRight(a.start.row,s.col);break;case"up":l=this.findJumpCellUp(s.row,a.start.col);break;case"down":l=this.findJumpCellDown(s.row,a.start.col);break}else{if(i&&(this.selecting==="row"&&(r==="left"||r==="right")||this.selecting==="column"&&(r==="up"||r==="down")))return;switch(r){case"left":u=Math.max(u-1,0);break;case"right":u=Math.min(u+1,this.getTableColumns().length-1);break;case"up":l=Math.max(l-1,0);break;case"down":l=Math.min(l+1,this.getTableRows().length-1);break}}if(this.rowHeader&&u===0&&(u=1),i||a.setStart(l,u),a.setEnd(l,u),i||(this.selecting="cell"),n=o.top!==a.top||o.bottom!==a.bottom||o.left!==a.left||o.right!==a.right,n)return c=this.getRowByRangePos(a.end.row),d=this.getColumnByRangePos(a.end.col),p=c.getElement().getBoundingClientRect(),h=d.getElement().getBoundingClientRect(),f=this.table.rowManager.getElement().getBoundingClientRect(),m=this.table.columnManager.getElement().getBoundingClientRect(),p.top>=f.top&&p.bottom<=f.bottom||(c.getElement().parentNode&&d.getElement().parentNode?this.autoScroll(a,c.getElement(),d.getElement()):c.getComponent().scrollTo(void 0,!1)),h.left>=m.left+this.getRowHeaderWidth()&&h.right<=m.right||(c.getElement().parentNode&&d.getElement().parentNode?this.autoScroll(a,c.getElement(),d.getElement()):d.getComponent().scrollTo(void 0,!1)),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpRow(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(s){return s.getData()[e.getField()]})}findJumpCol(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(s){return e.getData()[s.getField()]})}findJumpItem(e,i,r,n){var a;for(let s of r){let o=n(s);if(e){if(a=s,o)break}else if(i){if(a=s,o)break}else if(o)a=s;else break}return a}findJumpCellLeft(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),s=n[i-1]?this.isEmpty(r.getData()[n[i-1].getField()]):!1,o=this.rowHeader?n.slice(1,i):n.slice(0,i),l=this.findJumpCol(r,o,!0,a,s);return l?l.getPosition()-1:i}findJumpCellRight(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),s=n[i+1]?this.isEmpty(r.getData()[n[i+1].getField()]):!1,o=this.findJumpCol(r,n.slice(i+1,n.length),!1,a,s);return o?o.getPosition()-1:i}findJumpCellUp(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),s=n[e-1]?this.isEmpty(n[e-1].getData()[r.getField()]):!1,o=this.findJumpRow(r,n.slice(0,e),!0,a,s);return o?o.position-1:e}findJumpCellDown(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),s=n[e+1]?this.isEmpty(n[e+1].getData()[r.getField()]):!1,o=this.findJumpRow(r,n.slice(e+1,n.length),!1,a,s);return o?o.position-1:e}newSelection(e,i){var r;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){r=this.resetRanges(),this.selecting="all";var n,a=this.getCell(-1,-1);this.rowHeader?n=this.getCell(0,1):n=this.getCell(0,0),r.setBounds(n,a);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,r){var n=this.table.rowManager.element,a,s,o,l;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof r>"u"&&(r=this.getColumnByRangePos(e.end.col).getElement()),a={left:r.offsetLeft,right:r.offsetLeft+r.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},s={left:n.scrollLeft+this.getRowHeaderWidth(),right:Math.ceil(n.scrollLeft+n.clientWidth),top:n.scrollTop,bottom:n.scrollTop+n.offsetHeight-this.table.rowManager.scrollbarWidth},o=s.left<a.left&&a.left<s.right&&s.left<a.right&&a.right<s.right,l=s.top<a.top&&a.top<s.bottom&&s.top<a.bottom&&a.bottom<s.bottom,o||(a.left<s.left?n.scrollLeft=a.left-this.getRowHeaderWidth():a.right>s.right&&(n.scrollLeft=Math.min(a.right-n.clientWidth,a.left-this.getRowHeaderWidth()))),l||(a.top<s.top?n.scrollTop=a.top:a.bottom>s.bottom&&(n.scrollTop=a.bottom-n.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(r=>{r.type==="row"&&(this.layoutRow(r),r.cells.forEach(n=>this.renderCell(n)))}),this.getTableColumns().forEach(r=>{this.layoutColumn(r)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesRow(e));this.selecting==="row"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutColumn(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesColumn(e));this.selecting==="column"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutRanges(){var e,i,r;this.table.initialized&&(e=this.getActiveCell(),e&&(i=e.getElement(),r=e.row.getElement(),this.table.rtl?this.activeRangeCellElement.style.right=r.offsetWidth-i.offsetLeft-i.offsetWidth+"px":this.activeRangeCellElement.style.left=r.offsetLeft+i.offsetLeft+"px",this.activeRangeCellElement.style.top=r.offsetTop+"px",this.activeRangeCellElement.style.width=i.offsetWidth+"px",this.activeRangeCellElement.style.height=r.offsetHeight+"px",this.ranges.forEach(n=>n.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var r;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),r=this.table.rowManager.getRowFromPosition(e+1),r?r.getCells(!1,!0).filter(n=>n.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var r;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),r=new UOe(this.table,this,e,i),this.activeRange=r,this.ranges.push(r),this.rangeContainer.appendChild(r.element),r}resetRanges(){var e,i,r;return this.ranges.forEach(n=>n.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(r=this.table.rowManager.activeRows[0].cells.filter(n=>n.column.visible),i=r[this.rowHeader?1:0],i&&(e.setBounds(i),this.options("selectableRangeAutoFocus")&&this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}getRowHeaderWidth(){return this.rowHeader?this.rowHeader.getElement().offsetWidth:0}isEmpty(e){return e==null||e===""}}function AOe(t,e,i,r,n,a,s){var o=s.alignEmptyValues,l=s.decimalSeparator,u=s.thousandSeparator,c=0;if(t=String(t),e=String(e),u&&(t=t.split(u).join(""),e=e.split(u).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))c=isNaN(e)?0:-1;else if(isNaN(e))c=1;else return t-e;return(o==="top"&&a==="desc"||o==="bottom"&&a==="asc")&&(c*=-1),c}function kOe(t,e,i,r,n,a,s){var o=s.alignEmptyValues,l=0,u;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof s.locale){case"boolean":s.locale&&(u=this.langLocale());break;case"string":u=s.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),u)}return(o==="top"&&a==="desc"||o==="bottom"&&a==="asc")&&(l*=-1),l}function pB(t,e,i,r,n,a,s){var o=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),l=s.format||"dd/MM/yyyy HH:mm:ss",u=s.alignEmptyValues,c=0;if(typeof o<"u"){if(o.isDateTime(t)||(l==="iso"?t=o.fromISO(String(t)):t=o.fromFormat(String(t),l)),o.isDateTime(e)||(l==="iso"?e=o.fromISO(String(e)):e=o.fromFormat(String(e),l)),!t.isValid)c=e.isValid?-1:0;else if(!e.isValid)c=1;else return t-e;return(u==="top"&&a==="desc"||u==="bottom"&&a==="asc")&&(c*=-1),c}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function OOe(t,e,i,r,n,a,s){return s.format||(s.format="dd/MM/yyyy"),pB.call(this,t,e,i,r,n,a,s)}function xOe(t,e,i,r,n,a,s){return s.format||(s.format="HH:mm"),pB.call(this,t,e,i,r,n,a,s)}function FOe(t,e,i,r,n,a,s){var o=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return o-l}function LOe(t,e,i,r,n,a,s){var o=s.type||"length",l=s.alignEmptyValues,u=0,c=this.table,d;s.valueMap&&(typeof s.valueMap=="string"?d=function(f){return f.map(h=>Ir.retrieveNestedData(c.options.nestedFieldSeparator,s.valueMap,h))}:d=s.valueMap);function p(f){var h;switch(d&&(f=d(f)),o){case"length":h=f.length;break;case"sum":h=f.reduce(function(m,g){return m+g});break;case"max":h=Math.max.apply(null,f);break;case"min":h=Math.min.apply(null,f);break;case"avg":h=f.reduce(function(m,g){return m+g})/f.length;break;case"string":h=f.join("");break}return h}if(!Array.isArray(t))u=Array.isArray(e)?-1:0;else if(!Array.isArray(e))u=1;else return o==="string"?String(p(t)).toLowerCase().localeCompare(String(p(e)).toLowerCase()):p(e)-p(t);return(l==="top"&&a==="desc"||l==="bottom"&&a==="asc")&&(u*=-1),u}function _Oe(t,e,i,r,n,a,s){var o=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return o-l}function $Oe(t,e,i,r,n,a,s){var o,l,u,c,d=0,p,f=/(\d+)|(\D+)/g,h=/\d/,m=s.alignEmptyValues,g=0;if(!t&&t!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(o=String(t).toLowerCase(),l=String(e).toLowerCase(),o===l)return 0;if(!(h.test(o)&&h.test(l)))return o>l?1:-1;for(o=o.match(f),l=l.match(f),p=o.length>l.length?l.length:o.length;d<p;)if(u=o[d],c=l[d++],u!==c)return isFinite(u)&&isFinite(c)?(u.charAt(0)==="0"&&(u="."+u),c.charAt(0)==="0"&&(c="."+c),u-c):u>c?1:-1;return o.length>l.length}return(m==="top"&&a==="desc"||m==="bottom"&&a==="asc")&&(g*=-1),g}var BOe={number:AOe,string:kOe,date:OOe,time:xOe,datetime:pB,boolean:FOe,array:LOe,exists:_Oe,alphanum:$Oe};class sb extends oi{static moduleName="sort";static sorters=BOe;constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,r,n){var a=this.getSort();return a.forEach(s=>{delete s.column}),n.sort=a,n}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,r,n;switch(typeof e.definition.sorter){case"string":sb.sorters[e.definition.sorter]?i=sb.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(r=e.getElement(),r.classList.add("tabulator-sortable"),n=document.createElement("div"),n.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":n.classList.add("tabulator-col-sorter-element");break;case"header":r.classList.add("tabulator-col-sorter-element");break;default:r.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":n.appendChild(this.table.options.headerSortElement);break;default:n.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(n),e.modules.sort.element=n,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&n.addEventListener("mousedown",a=>{a.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?n:r).addEventListener("click",a=>{var s="",o=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?s=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?s=e.modules.sort.dir=="asc"?"desc":"asc":s="none";else switch(e.modules.sort.dir){case"asc":s="desc";break;case"desc":s="asc";break;default:s=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(a.shiftKey||a.ctrlKey)?(o=this.getSort(),l=o.findIndex(u=>u.field===e.getField()),l>-1?(o[l].dir=s,l=o.splice(l,1)[0],s!="none"&&o.push(l)):s!="none"&&o.push({column:e,dir:s}),this.setSort(o)):s=="none"?this.clear():this.setSort(e,s),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(r){r.column&&i.push({column:r.column.getComponent(),field:r.column.getField(),dir:r.dir})}),i}setSort(e,i){var r=this,n=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(a){var s;s=r.table.columnManager.findColumn(a.column),s?(a.column=s,n.push(a),r.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",a.column)}),r.sortList=n,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],r="string",n,a;if(i&&(i=i.getData(),n=e.getField(),n))switch(a=e.getFieldValue(i),typeof a){case"undefined":r="string";break;case"boolean":r="boolean";break;default:!isNaN(a)&&a!==""?r="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(r="alphanum");break}return sb.sorters[r]}sort(e,i){var r=this,n=this.table.options.sortOrderReverse?r.sortList.slice().reverse():r.sortList,a=[],s=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",r.getSort()),i||r.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(n.forEach(function(o,l){var u;o.column&&(u=o.column.modules.sort,u&&(u.sorter||(u.sorter=r.findSorter(o.column)),o.params=typeof u.params=="function"?u.params(o.column.getComponent(),o.dir):u.params,a.push(o)),i||r.setColumnHeader(o.column,o.dir))}),a.length&&r._sortItems(e,a)):i||n.forEach(function(o,l){r.setColumnHeader(o.column,o.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(o=>{s.push(o.getComponent())}),this.dispatchExternal("dataSorted",r.getSort(),s)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var r=e.modules.sort.element,n;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;r.firstChild;)r.removeChild(r.firstChild);n=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof n=="object"?r.appendChild(n):r.innerHTML=n}}_sortItems(e,i){var r=i.length-1;e.sort((n,a)=>{for(var s,o=r;o>=0;o--){let l=i[o];if(s=this._sortRow(n,a,l.column,l.dir,l.params),s!==0)break}return s})}_sortRow(e,i,r,n,a){var s,o,l=n=="asc"?e:i,u=n=="asc"?i:e;return e=r.getFieldValue(l.getData()),i=r.getFieldValue(u.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",s=l.getComponent(),o=u.getComponent(),r.modules.sort.sorter.call(this,e,i,s,o,r.getComponent(),n,a)}}class VOe{constructor(e,i){this.columnCount=e,this.rowCount=i,this.columnString=[],this.columns=[],this.rows=[]}genColumns(e){var i=Math.max(this.columnCount,Math.max(...e.map(r=>r.length)));this.columnString=[],this.columns=[];for(let r=1;r<=i;r++)this.incrementChar(this.columnString.length-1),this.columns.push(this.columnString.join(""));return this.columns}genRows(e){var i=Math.max(this.rowCount,e.length);this.rows=[];for(let r=1;r<=i;r++)this.rows.push(r);return this.rows}incrementChar(e){let i=this.columnString[e];i?i!=="Z"?this.columnString[e]=String.fromCharCode(this.columnString[e].charCodeAt(0)+1):(this.columnString[e]="A",e?this.incrementChar(e-1):this.columnString.push("A")):this.columnString.push("A")}setRowCount(e){this.rowCount=e}setColumnCount(e){this.columnCount=e}}class vte{constructor(e){return this._sheet=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._sheet.table.componentFunctionBinder.handle("sheet",i._sheet,r)}})}getTitle(){return this._sheet.title}getKey(){return this._sheet.key}getDefinition(){return this._sheet.getDefinition()}getData(){return this._sheet.getData()}setData(e){return this._sheet.setData(e)}clear(){return this._sheet.clear()}remove(){return this._sheet.remove()}active(){return this._sheet.active()}setTitle(e){return this._sheet.setTitle(e)}setRows(e){return this._sheet.setRows(e)}setColumns(e){return this._sheet.setColumns(e)}}class Xz extends xa{constructor(e,i){super(e.table),this.spreadsheetManager=e,this.definition=i,this.title=this.definition.title||"",this.key=this.definition.key||this.definition.title,this.rowCount=this.definition.rows,this.columnCount=this.definition.columns,this.data=this.definition.data||[],this.element=null,this.isActive=!1,this.grid=new VOe(this.columnCount,this.rowCount),this.defaultColumnDefinition={width:100,headerHozAlign:"center",headerSort:!1},this.columnDefinition=Object.assign(this.defaultColumnDefinition,this.options("spreadsheetColumnDefinition")),this.columnDefs=[],this.rowDefs=[],this.columnFields=[],this.columns=[],this.rows=[],this.scrollTop=null,this.scrollLeft=null,this.initialize(),this.dispatchExternal("sheetAdded",this.getComponent())}initialize(){this.initializeElement(),this.initializeColumns(),this.initializeRows()}reinitialize(){this.initializeColumns(),this.initializeRows()}initializeElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tab"),this.element.innerText=this.title,this.element.addEventListener("click",()=>{this.spreadsheetManager.loadSheet(this)})}initializeColumns(){this.grid.setColumnCount(this.columnCount),this.columnFields=this.grid.genColumns(this.data),this.columnDefs=[],this.columnFields.forEach(e=>{var i=Object.assign({},this.columnDefinition);i.field=e,i.title=e,this.columnDefs.push(i)})}initializeRows(){var e;this.grid.setRowCount(this.rowCount),e=this.grid.genRows(this.data),this.rowDefs=[],e.forEach((i,r)=>{var n={_id:i},a=this.data[r];a&&a.forEach((s,o)=>{var l=this.columnFields[o];l&&(n[l]=s)}),this.rowDefs.push(n)})}unload(){this.isActive=!1,this.scrollTop=this.table.rowManager.scrollTop,this.scrollLeft=this.table.rowManager.scrollLeft,this.data=this.getData(!0),this.element.classList.remove("tabulator-spreadsheet-tab-active")}load(){var e=!this.isActive;this.isActive=!0,this.table.blockRedraw(),this.table.setData([]),this.table.setColumns(this.columnDefs),this.table.setData(this.rowDefs),this.table.restoreRedraw(),e&&this.scrollTop!==null&&(this.table.rowManager.element.scrollLeft=this.scrollLeft,this.table.rowManager.element.scrollTop=this.scrollTop),this.element.classList.add("tabulator-spreadsheet-tab-active"),this.dispatchExternal("sheetLoaded",this.getComponent())}getComponent(){return new vte(this)}getDefinition(){return{title:this.title,key:this.key,rows:this.rowCount,columns:this.columnCount,data:this.getData()}}getData(e){var i=[],r,n,a;return this.rowDefs.forEach(s=>{var o=[];this.columnFields.forEach(l=>{o.push(s[l])}),i.push(o)}),!e&&!this.options("spreadsheetOutputFull")&&(r=i.map(s=>s.findLastIndex(o=>typeof o<"u")+1),n=Math.max(...r),a=r.findLastIndex(s=>s>0)+1,i=i.slice(0,a),i=i.map(s=>s.slice(0,n))),i}setData(e){this.data=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}clear(){this.setData([])}setTitle(e){this.title=e,this.element.innerText=e,this.dispatchExternal("sheetUpdated",this.getComponent())}setRows(e){this.rowCount=e,this.initializeRows(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}setColumns(e){this.columnCount=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}remove(){this.spreadsheetManager.removeSheet(this)}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchExternal("sheetRemoved",this.getComponent())}active(){this.spreadsheetManager.loadSheet(this)}}class jOe extends oi{static moduleName="spreadsheet";constructor(e){super(e),this.sheets=[],this.element=null,this.registerTableOption("spreadsheet",!1),this.registerTableOption("spreadsheetRows",50),this.registerTableOption("spreadsheetColumns",50),this.registerTableOption("spreadsheetColumnDefinition",{}),this.registerTableOption("spreadsheetOutputFull",!1),this.registerTableOption("spreadsheetData",!1),this.registerTableOption("spreadsheetSheets",!1),this.registerTableOption("spreadsheetSheetTabs",!1),this.registerTableOption("spreadsheetSheetTabsElement",!1),this.registerTableFunction("setSheets",this.setSheets.bind(this)),this.registerTableFunction("addSheet",this.addSheet.bind(this)),this.registerTableFunction("getSheets",this.getSheets.bind(this)),this.registerTableFunction("getSheetDefinitions",this.getSheetDefinitions.bind(this)),this.registerTableFunction("setSheetData",this.setSheetData.bind(this)),this.registerTableFunction("getSheet",this.getSheet.bind(this)),this.registerTableFunction("getSheetData",this.getSheetData.bind(this)),this.registerTableFunction("clearSheet",this.clearSheet.bind(this)),this.registerTableFunction("removeSheet",this.removeSheetFunc.bind(this)),this.registerTableFunction("activeSheet",this.activeSheetFunc.bind(this))}initialize(){this.options("spreadsheet")&&(this.subscribe("table-initialized",this.tableInitialized.bind(this)),this.subscribe("data-loaded",this.loadRemoteData.bind(this)),this.table.options.index="_id",this.options("spreadsheetData")&&this.options("spreadsheetSheets")&&(console.warn("You cannot use spreadsheetData and spreadsheetSheets at the same time, ignoring spreadsheetData"),this.table.options.spreadsheetData=!1),this.compatibilityCheck(),this.options("spreadsheetSheetTabs")&&this.initializeTabset())}compatibilityCheck(){this.options("data")&&console.warn("Do not use the data option when working with spreadsheets, use either spreadsheetData or spreadsheetSheets to pass data into the table"),this.options("pagination")&&console.warn("The spreadsheet module is not compatible with the pagination module"),this.options("groupBy")&&console.warn("The spreadsheet module is not compatible with the row grouping module"),this.options("responsiveCollapse")&&console.warn("The spreadsheet module is not compatible with the responsive collapse module")}initializeTabset(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tabs");var e=this.options("spreadsheetSheetTabsElement");e&&!(e instanceof HTMLElement)&&(e=document.querySelector(e),e||console.warn("Unable to find element matching spreadsheetSheetTabsElement selector:",this.options("spreadsheetSheetTabsElement"))),e?e.appendChild(this.element):this.footerAppend(this.element)}tableInitialized(){this.sheets.length?this.loadSheet(this.sheets[0]):this.options("spreadsheetSheets")?this.loadSheets(this.options("spreadsheetSheets")):this.options("spreadsheetData")&&this.loadData(this.options("spreadsheetData"))}loadRemoteData(e,i,r){return console.log("data",e,i,r),Array.isArray(e)?(this.table.dataLoader.clearAlert(),this.dispatchExternal("dataLoaded",e),!e.length||Array.isArray(e[0])?this.loadData(e):this.loadSheets(e)):console.error(`Spreadsheet Loading Error - Unable to process remote data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e),!1}loadData(e){var i={data:e};this.loadSheet(this.newSheet(i))}destroySheets(){this.sheets.forEach(e=>{e.destroy()}),this.sheets=[],this.activeSheet=null}loadSheets(e){Array.isArray(e)||(e=[]),this.destroySheets(),e.forEach(i=>{this.newSheet(i)}),this.loadSheet(this.sheets[0])}loadSheet(e){this.activeSheet!==e&&(this.activeSheet&&this.activeSheet.unload(),this.activeSheet=e,e.load())}newSheet(e={}){var i;return e.rows||(e.rows=this.options("spreadsheetRows")),e.columns||(e.columns=this.options("spreadsheetColumns")),i=new Xz(this,e),this.sheets.push(i),this.element&&this.element.appendChild(i.element),i}removeSheet(e){var i=this.sheets.indexOf(e),r;this.sheets.length>1?i>-1&&(this.sheets.splice(i,1),e.destroy(),this.activeSheet===e&&(r=this.sheets[i-1]||this.sheets[0],r?this.loadSheet(r):this.activeSheet=null)):console.warn("Unable to remove sheet, at least one sheet must be active")}lookupSheet(e){return e?e instanceof Xz?e:e instanceof vte?e._sheet:this.sheets.find(i=>i.key===e)||!1:this.activeSheet}setSheets(e){return this.loadSheets(e),this.getSheets()}addSheet(e){return this.newSheet(e).getComponent()}getSheetDefinitions(){return this.sheets.map(e=>e.getDefinition())}getSheets(){return this.sheets.map(e=>e.getComponent())}getSheet(e){var i=this.lookupSheet(e);return i?i.getComponent():!1}setSheetData(e,i){e&&!i&&(i=e,e=!1);var r=this.lookupSheet(e);return r?r.setData(i):!1}getSheetData(e){var i=this.lookupSheet(e);return i?i.getData():!1}clearSheet(e){var i=this.lookupSheet(e);return i?i.clear():!1}removeSheetFunc(e){var i=this.lookupSheet(e);i&&this.removeSheet(i)}activeSheetFunc(e){var i=this.lookupSheet(e);return i?this.loadSheet(i):!1}}class GOe extends oi{static moduleName="tooltip";constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,r){var n=e==="tooltip"?r.column.definition.tooltip:r.definition.headerTooltip;n&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,r,n),this.table.options.tooltipDelay))}mouseoutCheck(e,i,r){this.popupInstance||this.clearPopup()}clearPopup(e,i,r){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,r){var n,a,s;function o(l){a=l}typeof r=="function"&&(r=r(e,i.getComponent(),o)),r instanceof HTMLElement?n=r:(n=document.createElement("div"),r===!0&&(i instanceof nU?r=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{n.innerHTML=r=l||i.definition.title}):r=i.definition.title),n.innerHTML=r),(r||r===0||r===!1)&&(n.classList.add("tabulator-tooltip"),n.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(n),typeof a=="function"&&this.popupInstance.renderCallback(a),s=this.popupInstance.containerEventCoords(e),this.popupInstance.show(s.x+15,s.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}}var HOe={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(/^[a-z0-9]+$/i);return r.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(i);return r.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=!0,n=t.getData(),a=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(s){var o=s.getData();o!==n&&e==a.getFieldValue(o)&&(r=!1)}),r},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};class fB extends oi{static moduleName="validate";static validators=HOe;constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,r){var n=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return n!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,n)}),n}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(r=>{r=r.getComponent();var n=r.validate();n!==!0&&(i=i.concat(n))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,r=[],n;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(a=>{n=i._extractValidator(a),n&&r.push(n)}):(n=this._extractValidator(e.definition.validator),n&&r.push(n)),e.modules.validate=r.length?r:!1)}_extractValidator(e){var i,r,n;switch(typeof e){case"string":return n=e.indexOf(":"),n>-1?(i=e.substring(0,n),r=e.substring(n+1)):i=e,this._buildValidator(i,r);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var r=typeof e=="function"?e:fB.validators[e];return r?{type:typeof e=="function"?"function":e,func:r,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,r){var n=this,a=[],s=this.invalidCells.indexOf(i);return e&&e.forEach(o=>{o.func.call(n,i.getComponent(),r,o.params)||a.push({type:o.type,parameters:o.params})}),i.modules.validate||(i.modules.validate={}),a.length?(i.modules.validate.invalid=a,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),s==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),s>-1&&this.invalidCells.splice(s,1)),a.length?a:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}}var wk=Object.freeze({__proto__:null,AccessorModule:VP,AjaxModule:Fg,ClipboardModule:jP,ColumnCalcsModule:Lg,DataTreeModule:jAe,DownloadModule:GP,EditModule:uB,ExportModule:nb,FilterModule:Qf,FormatModule:_g,FrozenColumnsModule:Fke,FrozenRowsModule:Lke,GroupRowsModule:$ke,HistoryModule:HP,HtmlTableImportModule:Wke,ImportModule:cB,InteractionModule:Jke,KeybindingsModule:ab,MenuModule:eOe,MoveColumnsModule:tOe,MoveRowsModule:WP,MutatorModule:zP,PageModule:dB,PersistenceModule:zu,PopupModule:cOe,PrintModule:dOe,ReactiveDataModule:pOe,ResizeColumnsModule:fOe,ResizeRowsModule:hOe,ResizeTableModule:mOe,ResponsiveLayoutModule:vOe,SelectRangeModule:NOe,SelectRowModule:wOe,SortModule:sb,SpreadsheetModule:jOe,TooltipModule:GOe,ValidateModule:fB}),WOe={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{},dependencies:{}};class yte{constructor(e,i,r={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},r)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var r=Object.assign({},this.registeredDefaults),n=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(r,e);for(let a in i)r.hasOwnProperty(a)||(n&&console.warn("Invalid "+this.msgType+" option:",a),r[a]=i.key);for(let a in r)a in i?r[a]=i[a]:Array.isArray(r[a])?r[a]=Object.assign([],r[a]):typeof r[a]=="object"&&r[a]!==null?r[a]=Object.assign({},r[a]):typeof r[a]>"u"&&delete r[a];return r}}class UM extends xa{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,r){var n=this.rows().indexOf(e),a=e.getElement(),s=0;return new Promise((o,l)=>{if(n>-1){if(typeof r>"u"&&(r=this.table.options.scrollToRowIfVisible),!r&&Ir.elVisible(a)&&(s=Ir.elOffset(a).top-Ir.elOffset(this.elementVertical).top,s>0&&s<this.elementVertical.clientHeight-a.offsetHeight))return o(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(a.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-a.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-a.offsetTop)+a.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+a.offsetHeight;break;case"top":this.elementVertical.scrollTop=a.offsetTop;break}o()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class zOe extends UM{constructor(e){super(e)}renderRowCells(e,i){const r=document.createDocumentFragment();e.cells.forEach(n=>{r.appendChild(n.getElement())}),e.element.appendChild(r),i||e.cells.forEach(n=>{n.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class qOe extends UM{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var r=i.getWidth();r>e&&(e=r)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var r={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},n=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(a=>{var s={},o;a.visible&&(a.modules.frozen||(o=a.getWidth(),s.leftPos=n,s.rightPos=n+o,s.width=o,this.isFitData&&(s.fitDataCheck=a.modules.vdomHoz?a.modules.vdomHoz.fitDataCheck:!0),n+o>this.vDomScrollPosLeft&&n<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=n),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=o),this.columns.push(a),a.modules.vdomHoz=s,n+=o))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(r))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(r=>{i.appendChild(r.getElement())}),e.element.appendChild(i),e.cells.forEach(r=>{r.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++){let r=this.columns[i];r&&r.reinitializeWidth()}}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,r;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(n=>{!n.definition.width&&n.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){r=i.getElement(),i.generateCells(),this.tableElement.appendChild(r);for(let n=0;n<i.cells.length;n++){let a=i.cells[n];r.appendChild(a.getElement()),a.column.reinitializeWidth()}r.parentNode.removeChild(r),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((r,n)=>{r!==this.columns[n]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));e.forEach(r=>{this.reinitializeRow(r,!0)}),i.forEach(r=>{r.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,r){for(let n=e;n<i;n++){let a=this.columns[n];a.modules.vdomHoz.leftPos+=r,a.modules.vdomHoz.rightPos+=r}}addColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol+1];r&&r.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);n.getElement().insertBefore(a.getElement(),n.getCell(this.columns[this.rightCol]).getElement().nextSibling),a.cellRendered()}}),this.fitDataColActualWidthCheck(r),this.rightCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=r.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol-1];if(r)if(r.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(a=>{if(a.type!=="group"){var s=a.getCell(r);a.getElement().insertBefore(s.getElement(),a.getCell(this.columns[this.leftCol]).getElement()),s.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(a=>{a.type!=="group"&&(a.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=r.getWidth();let n=this.fitDataColActualWidthCheck(r);n&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+n,this.vDomPadRight-=n)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol];r&&r.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(s){console.warn("Could not removeColRight",s.message)}}}),this.vDomPadRight+=r.getWidth(),this.rightCol--,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol];r&&r.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(s){console.warn("Could not removeColLeft",s.message)}}}),this.vDomPadLeft+=r.getWidth(),this.leftCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,r;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),r=i-e.modules.vdomHoz.width,r&&(e.modules.vdomHoz.rightPos+=r,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,r)),e.modules.vdomHoz.fitDataCheck=!1),r}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let r=e.getCell(i);e.getElement().appendChild(r.getElement()),r.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var r=e.getElement();r.firstChild;)r.removeChild(r.firstChild);this.initializeRow(e)}}}class YOe extends xa{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new yte(this.table,"column definition",Ite),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:qOe,basic:zOe};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],r={},n=this.table.options.autoColumns==="full"?e:[e[0]],a=this.table.options.autoColumnsDefinitions;if(e&&e.length){if(n.forEach(s=>{Object.keys(s).forEach((o,l)=>{let u=s[o],c;r[o]?r[o]!==!0&&typeof u<"u"&&(r[o].sorter=this.calculateSorterFromValue(u),r[o]=!0):(c={field:o,title:o,sorter:this.calculateSorterFromValue(u)},i.splice(l,0,c),r[o]=typeof u>"u"?c:!0)})}),a)switch(typeof a){case"function":this.table.options.columns=a.call(this.table,i);break;case"object":Array.isArray(a)?i.forEach(s=>{var o=a.find(l=>l.field===s.field);o&&Object.assign(s,o)}):i.forEach(s=>{a[s.field]&&Object.assign(s,a[s.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}calculateSorterFromValue(e){var i;switch(typeof e){case"undefined":i="string";break;case"boolean":i="boolean";break;case"number":i="number";break;case"object":Array.isArray(e)?i="array":i="string";break;default:!isNaN(e)&&e!==""?i="number":e.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?i="alphanum":i="string";break}return i}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.dispatchExternal("columnsLoading"),this.table.options.rowHeader&&(this.rowHeader=new ec(this.table.options.rowHeader===!0?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),e.forEach((r,n)=>{this._addColumn(r)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.subscribedExternal("columnsLoaded")&&this.dispatchExternal("columnsLoaded",this.getComponents()),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,r){var n=new ec(e,this),a=n.getElement(),s=r&&this.findColumnIndex(r);if(i&&this.rowHeader&&(!r||r===this.rowHeader)&&(i=!1,r=this.rowHeader,s=0),r&&s>-1){var o=r.getTopColumn(),l=this.columns.indexOf(o),u=o.getElement();i?(this.columns.splice(l,0,n),u.parentNode.insertBefore(a,u)):(this.columns.splice(l+1,0,n),u.parentNode.insertBefore(a,u.nextSibling))}else i?(this.columns.unshift(n),this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)):(this.columns.push(n),this.headersElement.appendChild(n.getElement()));return n.columnRendered(),n}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var r=i.getHeight();r>e&&(e=r)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof ec)return e;if(e instanceof gte)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}),i.find(n=>n.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(r=>{var n=this.table.options.nestedFieldSeparator?r.split(this.table.options.nestedFieldSeparator)[0]:r;n===e&&i.push(this.columnsByField[r])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,r)=>{e(i,r)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(r=>{(!e||e&&r.visible)&&i.push(r.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],r=e?this.columns:this.columnsByIndex;return r.forEach(n=>{i.push(n.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,r){i.element.parentNode.insertBefore(e.element,i.element),r&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,r),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,r){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,r):this._moveColumnInArray(this.columns,e,i,r),this._moveColumnInArray(this.columnsByIndex,e,i,r,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,r),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,r,n,a){var s=e.indexOf(i),o,l=[];s>-1&&(e.splice(s,1),o=e.indexOf(r),o>-1?n&&(o=o+1):o=s,e.splice(o,0,i),a&&(l=this.chain("column-moving-rows",[i,r,n],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(u){if(u.cells.length){var c=u.cells.splice(s,1)[0];u.cells.splice(o,0,c)}})))}scrollToColumn(e,i,r){var n=0,a=e.getLeftOffset(),s=0,o=e.getElement();return new Promise((l,u)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof r>"u"&&(r=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":s=-this.element.clientWidth/2;break;case"right":s=o.clientWidth-this.headersElement.clientWidth;break}if(!r&&a>0&&a+o.offsetWidth<this.element.clientWidth)return!1;n=a+s,n=Math.max(Math.min(n,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(n),this.scrollHorizontal(n),l()}else console.warn("Scroll Error - Column not visible"),u("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(r=>{i.push(r.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(r){var n,a,s;r.visible&&(n=r.definition.width||0,a=parseInt(r.minWidth),typeof n=="string"?n.indexOf("%")>-1?s=e/100*parseInt(n):s=parseInt(n):s=n,i+=s>a?s:a)}),i}addColumn(e,i,r){return new Promise((n,a)=>{var s=this._addColumn(e,i,r);this._reIndexColumns(),this.dispatch("column-add",e,i,r),this.layoutMode()!="fitColumns"&&s.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),n(s)})}deregisterColumn(e){var i=e.getField(),r;i&&delete this.columnsByField[i],r=this.columnsByIndex.indexOf(e),r>-1&&this.columnsByIndex.splice(r,1),r=this.columns.indexOf(e),r>-1&&this.columns.splice(r,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){Ir.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class KOe extends UM{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,r=document.createDocumentFragment(),n=this.rows();n.forEach((a,s)=>{this.styleRow(a,s),a.initialize(!1,!0),a.type!=="group"&&(i=!1),r.appendChild(a.getElement())}),e.appendChild(r),n.forEach(a=>{a.rendered(),a.heightInitialized||a.calcHeight(!0)}),n.forEach(a=>{a.heightInitialized||a.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=Ir.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=Ir.elOffset(i).top-Ir.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class XOe extends UM{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,r=!1,n=!1,a=this.table.rowManager.scrollLeft,s=this.rows(),o=this.vDomTop;o<=this.vDomBottom;o++)if(s[o]){var l=i-s[o].getElement().offsetTop;if(n===!1||Math.abs(l)<n)n=l,r=o;else break}s.forEach(u=>{u.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(r===!1?this.rows.length-1:r,!0,n||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(a)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var r=e-this.vDomScrollPosTop,n=e-this.vDomScrollPosBottom,a=this.vDomWindowBuffer*2,s=this.rows();if(this.scrollTop=e,-r>a||n>a){var o=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*s.length)),this.scrollColumns(o)}else i?(r<0&&this._addTopRow(s,-r),n<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(s,-n):this.vDomScrollPosBottom=this.scrollTop)):(n>=0&&this._addBottomRow(s,n),r>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(s,r):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,r=this.elementVertical.clientHeight+i,n=!1,a=0,s=0,o=this.rows();if(e)a=this.vDomTop,s=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(o[l])if(n)if(r-o[l].getElement().offsetTop>=0)s=l;else break;else if(i-o[l].getElement().offsetTop>=0)a=l;else if(n=!0,r-o[l].getElement().offsetTop>=0)s=l;else break;return o.slice(a,s+1)}_virtualRenderFill(e,i,r){var n=this.tableElement,a=this.elementVertical,s=0,o=0,l=0,u=0,c=0,d=0,p=this.rows(),f=p.length,h=0,m,g,I=[],v=0,w=0,y=this.table.rowManager.fixedHeight,b=this.elementVertical.clientHeight,S=this.table.options.rowHeight,U=!0;if(e=e||0,r=r||0,!e)this.clear();else{for(;n.firstChild;)n.removeChild(n.firstChild);u=(f-e+1)*this.vDomRowHeight,u<b&&(e-=Math.ceil((b-u)/this.vDomRowHeight),e<0&&(e=0)),s=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=s}if(f&&Ir.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,y||this.table.options.maxHeight?(S&&(w=b/S+this.vDomWindowBuffer/S),w=Math.max(this.vDomWindowMinTotalRows,Math.ceil(w))):w=f;(w==f||o<=b+this.vDomWindowBuffer||v<this.vDomWindowMinTotalRows)&&this.vDomBottom<f-1;){for(I=[],g=document.createDocumentFragment(),d=0;d<w&&this.vDomBottom<f-1;)h=this.vDomBottom+1,m=p[h],this.styleRow(m,h),m.initialize(!1,!0),!m.heightInitialized&&!this.table.options.rowHeight&&m.clearCellHeight(),g.appendChild(m.getElement()),I.push(m),this.vDomBottom++,d++;if(!I.length)break;n.appendChild(g),I.forEach(T=>{T.rendered(),T.heightInitialized||T.calcHeight(!0)}),I.forEach(T=>{T.heightInitialized||T.setCellHeight()}),I.forEach(T=>{l=T.getHeight(),v<s?c+=l:o+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),v++}),U=this.table.rowManager.adjustTableSize(),b=this.elementVertical.clientHeight,U&&(y||this.table.options.maxHeight)&&(S=o/v,w=Math.max(this.vDomWindowMinTotalRows,Math.ceil(b/S+this.vDomWindowBuffer/S)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+r:this.scrollTop-c,this.vDomBottomPad=this.vDomBottom==f-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-o-c,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((o+c)/v),this.vDomBottomPad=this.vDomRowHeight*(f-this.vDomBottom-1),this.vDomScrollHeight=c+o+this.vDomBottomPad-b),n.style.paddingTop=this.vDomTopPad+"px",n.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+c+r-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-b:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-b),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-b),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,a.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var r=this.tableElement,n=[],a=0,s=this.vDomTop-1,o=0,l=!0;l;)if(this.vDomTop){let u=e[s],c,d;u&&o<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,s),r.insertBefore(u.getElement(),r.firstChild),(!u.initialized||!u.heightInitialized)&&n.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomTop--,s--,o++):l=!1):l=!1}else l=!1;for(let u of n)u.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomTopPad-=a,this.vDomTopPad<0&&(this.vDomTopPad=s*this.vDomRowHeight),s<1&&(this.vDomTopPad=0),r.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=a)}_removeTopRow(e,i){for(var r=[],n=0,a=0,s=!0;s;){let o=e[this.vDomTop],l;o&&a<this.vDomMaxRenderChain?(l=o.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,n+=l,r.push(o),a++):s=!1):s=!1}for(let o of r){let l=o.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomTopPad+=n,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?n:n+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var r=this.tableElement,n=[],a=0,s=this.vDomBottom+1,o=0,l=!0;l;){let u=e[s],c,d;u&&o<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,s),r.appendChild(u.getElement()),(!u.initialized||!u.heightInitialized)&&n.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomBottom++,s++,o++):l=!1):l=!1}for(let u of n)u.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomBottomPad-=a,(this.vDomBottomPad<0||s==e.length-1)&&(this.vDomBottomPad=0),r.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=a)}_removeBottomRow(e,i){for(var r=[],n=0,a=0,s=!0;s;){let o=e[this.vDomBottom],l;o&&a<this.vDomMaxRenderChain?(l=o.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,n+=l,r.push(o),a++):s=!1):s=!1}for(let o of r){let l=o.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomBottomPad+=n,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=n)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class JOe extends xa{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let r=document.createElement("div");r.classList.add("tabulator-placeholder-contents"),r.innerHTML=e,i.appendChild(r),this.placeholderContents=r}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,r=this.element.scrollTop,n=this.scrollTop>r;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=r&&(this.scrollTop=r,this.renderer.scrollRows(r,n),this.dispatch("scroll-vertical",r,n),this.dispatchExternal("scrollVertical",r,n))})}findRow(e){if(typeof e=="object"){if(e instanceof La)return e;if(e instanceof wM)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(r=>r.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(r=>r.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(r=>r.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.type==="row"&&i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,r){return this.renderer.scrollToRowPosition(e,i,r)}setData(e,i,r){return new Promise((n,a)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&r&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),n()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((r,n)=>{if(r&&typeof r=="object"){var a=new La(r,this);this.rows.push(a)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",r)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var r=this.rows.indexOf(e),n=this.activeRows.indexOf(e);n>-1&&this.activeRows.splice(n,1),r>-1&&this.rows.splice(r,1),this.setActiveRows(this.activeRows),this.displayRowIterator(a=>{var s=a.indexOf(e);s>-1&&a.splice(s,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,r,n){var a=this.addRowActual(e,i,r,n);return a}addRows(e,i,r,n){var a=[];return new Promise((s,o)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof r>"u"&&i||typeof r<"u"&&!i)&&e.reverse(),e.forEach((l,u)=>{var c=this.addRow(l,i,r,!0);a.push(c),this.dispatch("row-added",c,l,i,r)}),this.refreshActiveData(n?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),s(a)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,r,n){var a=e instanceof La?e:new La(e||{},this),s=this.findAddRowPos(i),o=-1,l,u;return r||(u=this.chain("row-adding-position",[a,s],null,{index:r,top:s}),r=u.index,s=u.top),typeof r<"u"&&(r=this.findRow(r)),r=this.chain("row-adding-index",[a,r,s],null,r),r&&(o=this.rows.indexOf(r)),r&&o>-1?(l=this.activeRows.indexOf(r),this.displayRowIterator(function(c){var d=c.indexOf(r);d>-1&&c.splice(s?d:d+1,0,a)}),l>-1&&this.activeRows.splice(s?l:l+1,0,a),this.rows.splice(s?o:o+1,0,a)):s?(this.displayRowIterator(function(c){c.unshift(a)}),this.activeRows.unshift(a),this.rows.unshift(a)):(this.displayRowIterator(function(c){c.push(a)}),this.activeRows.push(a),this.rows.push(a)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",a.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),n||this.reRenderInPosition(),a}moveRow(e,i,r){this.dispatch("row-move",e,i,r),this.moveRowActual(e,i,r),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,r),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,r){this.moveRowInArray(this.rows,e,i,r),this.moveRowInArray(this.activeRows,e,i,r),this.displayRowIterator(n=>{this.moveRowInArray(n,e,i,r)}),this.dispatch("row-moving",e,i,r)}moveRowInArray(e,i,r,n){var a,s,o,l;if(i!==r&&(a=e.indexOf(i),a>-1&&(e.splice(a,1),s=e.indexOf(r),s>-1?n?e.splice(s+1,0,i):e.splice(s,0,i):e.splice(a,0,i)),e===this.getDisplayRows())){o=a<s?a:s,l=s>a?s:a+1;for(let u=o;u<=l;u++)e[u]&&this.styleRow(e[u],u)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r!==!1&&r<this.displayRowsCount-1&&(n=this.getDisplayRows()[r+1]),n&&(!(n instanceof La)||n.type!="row")?this.nextDisplayRow(n,i):n}prevDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r&&(n=this.getDisplayRows()[r-1]),i&&n&&(!(n instanceof La)||n.type!="row")?this.prevDisplayRow(n,i):n}findRowIndex(e,i){var r;return e=this.findRow(e),e&&(r=i.indexOf(e),r>-1)?r:!1}getData(e,i){var r=[],n=this.getRows(e);return n.forEach(function(a){a.type=="row"&&r.push(a.getData(i||"data"))}),r}getComponents(e){var i=[],r=this.getRows(e);return r.forEach(function(n){i.push(n.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,r){var n=this.table,a="",s=0,o=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(s=this.dataPipeline.findIndex(l=>l.handler===e),s>-1)a="dataPipeline",i&&(s==this.dataPipeline.length-1?a="display":s++);else if(s=this.displayPipeline.findIndex(l=>l.handler===e),s>-1)a="displayPipeline",i&&(s==this.displayPipeline.length-1?a="end":s++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else a=e||"all",s=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===a&&s<this.redrawBlockRestoreConfig.index||o.indexOf(a)<o.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:r,stage:a,index:s});return}else Ir.elVisible(this.element)?r?this.reRenderInPosition(this.refreshPipelines.bind(this,e,a,s,r)):(this.refreshPipelines(e,a,s,r),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),n.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,a,s,r),this.dispatch("data-refreshed")}}refreshPipelines(e,i,r,n){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let a=r;a<this.dataPipeline.length;a++){let s=this.dataPipeline[a].handler(this.activeRowsPipeline[a].slice(0));this.activeRowsPipeline[a+1]=s||this.activeRowsPipeline[a].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":r=0,this.resetDisplayRows();case"displayPipeline":for(let a=r;a<this.displayPipeline.length;a++){let s=this.displayPipeline[a].handler((a?this.getDisplayRows(a-1):this.activeRows).slice(0),n);this.setDisplayRows(s||this.getDisplayRows(a-1).slice(0),a)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(r=>{r.type==="row"&&(r.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var r=Object.assign([],this.renderer.visibleRows(!i));return e&&(r=this.chain("rows-visible",[i],r,r)),r}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:XOe,basic:KOe};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}normalizeHeight(e){this.activeRows.forEach(function(i){i.normalizeHeight(e)})}adjustTableSize(){let e=this.element.clientHeight,i,r=!1;if(this.renderer.verticalFillMode==="fill"){let n=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const a="calc(100% - "+n+"px)";this.element.style.minHeight=i||"calc(100% - "+n+"px)",this.element.style.height=a,this.element.style.maxHeight=a}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-n+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(r=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),r}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class QOe extends xa{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){this.table.options.footerElement&&(typeof this.table.options.footerElement==="string"?this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement)):this.element=this.table.options.footerElement)}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class ZOe extends xa{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,r){this.pseudoTrackers[e].target!==r&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=r,this.dispatch(e+"-mouseenter",i,r))}pseudoMouseLeave(e,i){var r=Object.keys(this.pseudoTrackers),n={row:["cell"],cell:["row"]};r=r.filter(a=>{var s=n[e];return a!==e&&(!s||s&&!s.includes(a))}),r.forEach(a=>{var s=this.pseudoTrackers[a].target;this.pseudoTrackers[a].target&&(this.dispatch(a+"-mouseleave",i,s),this.pseudoTrackers[a].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let r of i)for(let n of e){let a=r+"-"+n;this.subscriptionChange(a,this.subscriptionChanged.bind(this,r,n))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,r){var n=this.listeners[i].components,a=n.indexOf(e),s=!1;r?a===-1&&(n.push(e),s=!0):this.subscribed(e+"-"+i)||a>-1&&(n.splice(a,1),s=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),s&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var r=i.composedPath&&i.composedPath()||i.path,n=this.findTargets(r);n=this.bindComponents(e,n),this.triggerEvents(e,i,n),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(n).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let r=Object.keys(this.componentMap);for(let n of e){let a=n.classList?[...n.classList]:[];if(a.filter(l=>this.abortClasses.includes(l)).length)break;let o=a.filter(l=>r.includes(l));for(let l of o)i[this.componentMap[l]]||(i[this.componentMap[l]]=n)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var r=Object.keys(i).reverse(),n=this.listeners[e],a={},s={},o={};for(let l of r){let u,c=i[l],d=this.previousTargets[l];if(d&&d.target===c)u=d.component;else switch(l){case"row":case"group":(n.components.includes("row")||n.components.includes("cell")||n.components.includes("group"))&&(u=this.table.rowManager.getVisibleRows(!0).find(f=>f.getElement()===c),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[l]=!1));break;case"column":n.components.includes("column")&&(u=this.table.columnManager.findColumn(c));break;case"cell":n.components.includes("cell")&&(a.row instanceof La?u=a.row.findCell(c):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}u&&(a[l]=u,o[l]={target:c,component:u})}return this.previousTargets=o,Object.keys(i).forEach(l=>{let u=a[l];s[l]=u}),s}triggerEvents(e,i,r){var n=this.listeners[e];for(let a in r)r[a]&&n.components.includes(a)&&this.dispatch(a+"-"+e,i,r[a])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class exe{constructor(e){this.table=e,this.bindings={}}bind(e,i,r){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,r):this.bindings[e][i]=r}handle(e,i,r){if(this.bindings[e]&&this.bindings[e][r]&&typeof this.bindings[e][r].bind=="function")return this.bindings[e][r].bind(null,i);r!=="then"&&typeof r=="string"&&!r.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+r+" function, have you checked that you have the correct Tabulator module installed?")}}class txe extends xa{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,r,n,a,s){var o=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,r,a])){this.loading=!0,a||this.alertLoader(),i=this.chain("data-params",[e,r,a],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,r,a],!1,Promise.resolve([]));return l.then(u=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(u)&&typeof u=="object"&&(u=this.mapParams(u,this.objectInvert(this.table.options.dataReceiveParams)));var c=this.chain("data-loaded",[u],null,u);o==this.requestOrder?(this.clearAlert(),c!==!1&&(this.dispatchExternal("dataLoaded",c),this.table.rowManager.setData(c,n,typeof s>"u"?!n:s))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(u=>{console.error("Data Load Error: ",u),this.dispatchExternal("dataLoadError",u),a||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,n,typeof s>"u"?!n:s),Promise.resolve()}mapParams(e,i){var r={};for(let n in e)r[i.hasOwnProperty(n)?i[n]:n]=e[n];return r}objectInvert(e){var i={};for(let r in e)i[e[r]]=r;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class ixe{constructor(e,i,r){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=r?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=r}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e])if(i)if(r=this.events[e].findIndex(n=>n===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),r;return this.events[i]&&this.events[i].forEach((n,a)=>{let s=n.apply(this.table,e);a||(r=s)}),r}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class rxe{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,r=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:r}),this.events[e].sort((n,a)=>n.priority-a.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e]){if(i)if(r=this.events[e].findIndex(n=>n.callback===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,r,n){var a=r;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((s,o)=>{a=s.callback.apply(this,i.concat([a]))}),a):typeof n=="function"?n():n}_confirm(e,i){var r=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((n,a)=>{n.callback.apply(this,i)&&(r=!0)}),r}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(r=>{r.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class nxe extends xa{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,r){var n="";return typeof this.options(e)<"u"?(n="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(n=n+", Please use the %c"+i+"%c option instead",this._warnUser(n,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),r&&(this.table.options[i]=this.table.options[e])):this._warnUser(n,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}class axe extends xa{constructor(e){super(e),this.deps={},this.props={}}initialize(){this.deps=Object.assign({},this.options("dependencies"))}lookup(e,i,r){if(Array.isArray(e)){for(const a of e){var n=this.lookup(a,i,!0);if(n)break}if(n)return n;this.error(e)}else return i?this.lookupProp(e,i,r):this.lookupKey(e,r)}lookupProp(e,i,r){var n;if(this.props[e]&&this.props[e][i])return this.props[e][i];if(n=this.lookupKey(e,r),n)return this.props[e]||(this.props[e]={}),this.props[e][i]=n[i]||n,this.props[e][i]}lookupKey(e,i){var r;return this.deps[e]?r=this.deps[e]:window[e]?(this.deps[e]=window[e],r=this.deps[e]):i||this.error(e),r}error(e){console.error("Unable to find dependency",e,"Please check documentation and ensure you have imported the required library into your project")}}function sxe(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function Jz(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function oxe(t,e){var i=0,r=this.table.rowManager.element.clientWidth,n=0,a=!1;t.forEach((s,o)=>{s.widthFixed||s.reinitializeWidth(),(this.table.options.responsiveLayout?s.modules.responsive.visible:s.visible)&&(a=s),s.visible&&(i+=s.getWidth())}),a?(n=r-i+a.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(a.setWidth(0),this.table.modules.responsiveLayout.update()),n>0?a.setWidth(n):a.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function lxe(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,r=0,n=0,a=0,s=0,o=[],l=[],u=0,c=0,d=0;function p(h){var m;return typeof h=="string"?h.indexOf("%")>-1?m=i/100*parseInt(h):m=parseInt(h):m=h,m}function f(h,m,g,I){var v=[],w=0,y=0,b=0,S=a,U=0,T=0,D=[];function P(R){return g*(R.column.definition.widthGrow||1)}function E(R){return p(R.width)-g*(R.column.definition.widthShrink||0)}return h.forEach(function(R,C){var M=I?E(R):P(R);R.column.minWidth>=M?v.push(R):R.column.maxWidth&&R.column.maxWidth<M?(R.width=R.column.maxWidth,m-=R.column.maxWidth,S-=I?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1,S&&(g=Math.floor(m/S))):(D.push(R),T+=I?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1)}),v.length?(v.forEach(function(R){w+=I?R.width-R.column.minWidth:R.column.minWidth,R.width=R.column.minWidth}),y=m-w,b=T?Math.floor(y/T):y,U=f(D,y,b,I)):(U=T?m-Math.floor(m/T)*T:m,D.forEach(function(R){R.width=I?E(R):P(R)})),U}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(h){var m,g,I;h.visible&&(m=h.definition.width,g=parseInt(h.minWidth),m?(I=p(m),r+=I>g?I:g,h.definition.widthShrink&&(l.push({column:h,width:I>g?I:g}),u+=h.definition.widthShrink)):(o.push({column:h,width:0}),a+=h.definition.widthGrow||1))}),n=i-r,s=Math.floor(n/a),d=f(o,n,s,!1),o.length&&d>0&&(o[o.length-1].width+=d),o.forEach(function(h){n-=h.width}),c=Math.abs(d)+n,c>0&&u&&(d=f(l,c,Math.floor(c/u),!0)),d&&l.length&&(l[l.length-1].width-=d),o.forEach(function(h){h.column.setWidth(h.width)}),l.forEach(function(h){h.column.setWidth(h.width)})}var uxe={fitData:sxe,fitDataFill:Jz,fitDataTable:Jz,fitDataStretch:oxe,fitColumns:lxe};class qP extends oi{static moduleName="layout";static modes=uxe;constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;qP.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){var i=this.table.columnManager.columnsByIndex.find(r=>r.definition.variableHeight||r.definition.formatter==="textarea");this.dispatch("layout-refreshing"),qP.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),i&&this.table.rowManager.normalizeHeight(!0),this.dispatch("layout-refreshed")}}var cxe={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};class hB extends oi{static moduleName="localize";static langs=cxe;constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=Ir.deepClone(hB.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let r in i)e[r]&&typeof e[r]=="object"?this._setLangProp(e[r],i[r]):e[r]=i[r]}setLocale(e){e=e||"default";function i(r,n){for(var a in r)typeof r[a]=="object"?(n[a]||(n[a]={}),i(r[a],n[a])):n[a]=r[a]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let r=e.split("-")[0];this.langList[r]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,r),e=r):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=Ir.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var r=i?e+"|"+i:e,n=r.split("|"),a=this._getLangElement(n,this.locale);return a||""}_getLangElement(e,i){var r=this.lang;return e.forEach(function(n){var a;r&&(a=r[n],typeof a<"u"?r=a:r=!1)}),r}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}}class dxe extends oi{static moduleName="comms";constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],r;return r=this.table.constructor.registry.lookupTable(e),r.forEach(n=>{this.table!==n&&i.push(n)}),i}send(e,i,r,n){var a=this.getConnections(e);a.forEach(s=>{s.tableComms(this.table.element,i,r,n)}),!a.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,r,n){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,r,n);console.warn("Inter-table Comms Error - no such module:",i)}}var pxe=Object.freeze({__proto__:null,CommsModule:dxe,LayoutModule:qP,LocalizeModule:hB});class Wo{static registry={tables:[],register(e){Wo.registry.tables.push(e)},deregister(e){var i=Wo.registry.tables.indexOf(e);i>-1&&Wo.registry.tables.splice(i,1)},lookupTable(e,i){var r=[],n,a;if(typeof e=="string"){if(n=document.querySelectorAll(e),n.length)for(var s=0;s<n.length;s++)a=Wo.registry.matchElement(n[s]),a&&r.push(a)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof Wo?(a=Wo.registry.matchElement(e),a&&r.push(a)):Array.isArray(e)?e.forEach(function(o){r=r.concat(Wo.registry.lookupTable(o))}):i||console.warn("Table Connection Error - Invalid Selector",e);return r},matchElement(e){return Wo.registry.tables.find(function(i){return e instanceof Wo?i===e:i.element===e})}};static findTable(e){var i=Wo.registry.lookupTable(e,!0);return Array.isArray(i)&&!i.length?!1:i}}class Fr extends Wo{static moduleBindings={};static moduleExtensions={};static modulesRegistered=!1;static defaultModules=!1;constructor(){super()}static initializeModuleBinder(e){Fr.modulesRegistered||(Fr.modulesRegistered=!0,Fr._registerModules(pxe,!0),e&&Fr._registerModules(e))}static _extendModule(e,i,r){if(Fr.moduleBindings[e]){var n=Fr.moduleBindings[e][i];if(n)if(typeof r=="object")for(let a in r)n[a]=r[a];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",i)}else console.warn("Module Error - module does not exist:",e)}static _registerModules(e,i){var r=Object.values(e);i&&r.forEach(n=>{n.prototype.moduleCore=!0}),Fr._registerModule(r)}static _registerModule(e){Array.isArray(e)||(e=[e]),e.forEach(i=>{Fr._registerModuleBinding(i),Fr._registerModuleExtensions(i)})}static _registerModuleBinding(e){e.moduleName?Fr.moduleBindings[e.moduleName]=e:console.error("Unable to bind module, no moduleName defined",e.moduleName)}static _registerModuleExtensions(e){var i=e.moduleExtensions;if(e.moduleExtensions)for(let r in i){let n=i[r];if(Fr.moduleBindings[r])for(let a in n)Fr._extendModule(r,a,n[a]);else{Fr.moduleExtensions[r]||(Fr.moduleExtensions[r]={});for(let a in n)Fr.moduleExtensions[r][a]||(Fr.moduleExtensions[r][a]={}),Object.assign(Fr.moduleExtensions[r][a],n[a])}}Fr._extendModuleFromQueue(e)}static _extendModuleFromQueue(e){var i=Fr.moduleExtensions[e.moduleName];if(i)for(let r in i)Fr._extendModule(e.moduleName,r,i[r])}_bindModules(){var e=[],i=[],r=[];this.modules={};for(var n in Fr.moduleBindings){let a=Fr.moduleBindings[n],s=new a(this);this.modules[n]=s,a.prototype.moduleCore?this.modulesCore.push(s):a.moduleInitOrder?a.moduleInitOrder<0?e.push(s):i.push(s):r.push(s)}e.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),i.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),this.modulesRegular=e.concat(r.concat(i))}}class fxe extends xa{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}class up extends Fr{static defaultOptions=WOe;static extendModule(){up.initializeModuleBinder(),up._extendModule(...arguments)}static registerModule(){up.initializeModuleBinder(),up._registerModule(...arguments)}constructor(e,i,r){super(),up.initializeModuleBinder(r),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new exe(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new nxe(this),this.optionsList=new yte(this,"table constructor"),this.dependencyRegistry=new axe(this),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new YOe(this),this.rowManager=new JOe(this),this.footerManager=new QOe(this),this.dataLoader=new txe(this),this.alertManager=new fxe(this),this._bindModules(),this.options=this.optionsList.generate(up.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new ixe(this,this.options,this.options.debugEventsExternal),this.eventBus=new rxe(this.options.debugEventsInternal),this.interactionMonitor=new ZOe(this),this.dataLoader.initialize(),this.footerManager.initialize(),this.dependencyRegistry.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,r;if(e.tagName==="TABLE"){this.originalElement=this.element,r=document.createElement("div");var n=e.attributes;for(var a in n)typeof n[a]=="object"&&r.setAttribute(n[a].name,n[a].value);e.parentNode.replaceChild(r,e),this.element=e=r}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(r=>{r.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(r=>{r.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var e=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var r,n;return this.options.debugInitialization&&!this.initialized&&(e||(r=new Error().stack.split(`
`),n=r[0]=="Error"?r[2]:r[1],n[0]==" "?e=n.trim().split(" ")[1].split(".")[1]:e=n.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,r){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,r,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,r){return this.initGuard(),this.dataLoader.load(e,i,r,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((r,n)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var s=this.rowManager.findRow(a[this.options.index]);s?(i++,s.updateData(a).then(()=>{i--,i||r()}).catch(o=>{n("Update Error - Unable to update row",a,o)})):n("Update Error - Unable to find row",a)}):(console.warn("Update Error - No data provided"),n("Update Error - No data provided"))})}addData(e,i,r){return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,r).then(s=>{var o=[];s.forEach(function(l){o.push(l.getComponent())}),n(o)}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}updateOrAddData(e){var i=[],r=0;return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(s=>{var o=this.rowManager.findRow(s[this.options.index]);r++,o?o.updateData(s).then(()=>{r--,i.push(o.getComponent()),r||n(i)}):this.rowManager.addRows(s).then(l=>{r--,i.push(l[0].getComponent()),r||n(i)})}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let r of e){let n=this.rowManager.findRow(r,!0);if(n)i.push(n);else return console.error("Delete Error - No matching row found:",r),Promise.reject("Delete Error - No matching row found")}return i.sort((r,n)=>this.rowManager.rows.indexOf(r)>this.rowManager.rows.indexOf(n)?1:-1),i.forEach(r=>{r.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,r){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,r,!0).then(n=>n[0].getComponent())}updateOrAddRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>r.getComponent()):this.rowManager.addRows(i).then(n=>n[0].getComponent())}updateRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>Promise.resolve(r.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,r){var n=this.rowManager.findRow(e);return n?this.rowManager.scrollToRow(n,i,r):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,r){var n=this.rowManager.findRow(e);this.initGuard(),n?n.moveToRow(i,r):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,r){var n=this.columnManager.findColumn(r);return this.initGuard(),this.columnManager.addColumn(e,i,n).then(a=>a.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var r=this.columnManager.findColumn(e);return this.initGuard(),r?r.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,r){var n=this.columnManager.findColumn(e),a=this.columnManager.findColumn(i);this.initGuard(),n?a?this.columnManager.moveColumn(n,a,r):console.warn("Move Error - No matching column found:",a):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,r){return new Promise((n,a)=>{var s=this.columnManager.findColumn(e);return s?this.columnManager.scrollToColumn(s,i,r):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}}var Dy=up;class hxe extends Dy{static extendModule(){Dy.initializeModuleBinder(wk),Dy._extendModule(...arguments)}static registerModule(){Dy.initializeModuleBinder(wk),Dy._registerModule(...arguments)}constructor(e,i,r){super(e,i,wk)}}var Lv=hxe;function aU({anchorId:t}){const e=Lv.findTable(`#${t}`)[0];e&&e.destroy()}function mxe(t,e){return t?yM.dateTime.convertTime(t,e):""}function bte(t){const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const r=t.getValue(),{potentialParticipants:n,eventName:a="",roundName:s="",schedule:o={},winningSide:l,matchUpId:u,sides:c}=r||{},{courtOrder:d="",scheduledTime:p="",courtId:f="",timeModifiers:h,venueId:m=""}=o;if(e.setAttribute("courtOrder",d),e.setAttribute("courtId",f),e.setAttribute("venueId",m),e.className="schedule-cell dragdrop",e.ondragover=R=>R.preventDefault(),u&&(e.draggable=!0,e.id=u,l&&e.classList.add("matchup-complete")),!u)return e;const g=`${a} ${s}`,I=R=>R.person?.standardFamilyName?.toUpperCase()||R.participantName,v=n?.map(R=>R?.map(C=>`<span class='potential nowrap'>${I(C)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),w=R=>{const C=c?.find(M=>R===M.sideNumber)?.participant?.participantName;if(C)return l===R?`<span style='font-weight: bold'>${C}</span>`:C},y=w(1)||v?.shift()||"Unkown",b=w(2)||v?.shift()||"Unknown";e.id=u;const S=document.createElement("div");S.className="header flexrow",S.innerHTML=(h?.[0]&&EAe[h[0]]+"&nbsp;"||"")+mxe(p,!1),e.appendChild(S);const U=document.createElement("div");U.className="catround",U.innerHTML=g,e.appendChild(U);const T=document.createElement("div");T.className="scheduled_teams";const D=document.createElement("div");D.className="scheduled_team",D.style.fontSize="1em",D.innerHTML=y,T.appendChild(D);const P=document.createElement("div");P.className="divider",P.innerHTML="vs.",T.appendChild(P);const E=document.createElement("div");if(E.className="scheduled_team",E.style.fontSize="1em",E.innerHTML=b,T.appendChild(E),l){const R=document.createElement("div");R.innerHTML=r.score?.scoreStringSide1||"",T.appendChild(R)}return e.appendChild(T),e}function gxe({count:t}){return t>0?yM.generateRange(0,t).map(()=>({headerHozAlign:Hi,formatter:bte,headerSort:!1,resizable:!1,minWidth:150})):[]}function Ixe(t){t.getElement().style.backgroundColor="var(--chc-bg-primary)";const e=document.createElement("span"),i=t.getRow().getData();return e.innerHTML=i.rowNumber,e}function vxe(){return{formatter:Ixe,headerSort:!1,resizable:!1,hozAlign:Hi,frozen:!0,width:55}}function yxe({courtsData:t,courtPrefix:e}){const i=PAe-t?.length||0,r=i<=0?1:i,n=gxe({count:r}),a=vxe(),s=(o,l)=>({field:`${e}${l}`,title:o.courtName,headerHozAlign:Hi,formatter:bte,headerSort:!1,resizable:!1,hozAlign:Hi,minWidth:150});return[].concat([a],t?.map(s),n)}function bxe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ED={exports:{}},wxe=ED.exports,Qz;function Sxe(){return Qz||(Qz=1,(function(t,e){(function(i,r){t.exports=r()})(wxe,(function(){var i=1e3,r=6e4,n=36e5,a="millisecond",s="second",o="minute",l="hour",u="day",c="week",d="month",p="quarter",f="year",h="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,I=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var N=["th","st","nd","rd"],A=M%100;return"["+M+(N[(A-20)%10]||N[A]||N[0])+"]"}},w=function(M,N,A){var O=String(M);return!O||O.length>=N?M:""+Array(N+1-O.length).join(A)+M},y={s:w,z:function(M){var N=-M.utcOffset(),A=Math.abs(N),O=Math.floor(A/60),k=A%60;return(N<=0?"+":"-")+w(O,2,"0")+":"+w(k,2,"0")},m:function M(N,A){if(N.date()<A.date())return-M(A,N);var O=12*(A.year()-N.year())+(A.month()-N.month()),k=N.clone().add(O,d),F=A-k<0,x=N.clone().add(O+(F?-1:1),d);return+(-(O+(A-k)/(F?k-x:x-k))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:d,y:f,w:c,d:u,D:h,h:l,m:o,s,ms:a,Q:p}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},b="en",S={};S[b]=v;var U="$isDayjsObject",T=function(M){return M instanceof R||!(!M||!M[U])},D=function M(N,A,O){var k;if(!N)return b;if(typeof N=="string"){var F=N.toLowerCase();S[F]&&(k=F),A&&(S[F]=A,k=F);var x=N.split("-");if(!k&&x.length>1)return M(x[0])}else{var L=N.name;S[L]=N,k=L}return!O&&k&&(b=k),k||!O&&b},P=function(M,N){if(T(M))return M.clone();var A=typeof N=="object"?N:{};return A.date=M,A.args=arguments,new R(A)},E=y;E.l=D,E.i=T,E.w=function(M,N){return P(M,{locale:N.$L,utc:N.$u,x:N.$x,$offset:N.$offset})};var R=(function(){function M(A){this.$L=D(A.locale,null,!0),this.parse(A),this.$x=this.$x||A.x||{},this[U]=!0}var N=M.prototype;return N.parse=function(A){this.$d=(function(O){var k=O.date,F=O.utc;if(k===null)return new Date(NaN);if(E.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var x=k.match(g);if(x){var L=x[2]-1||0,$=(x[7]||"0").substring(0,3);return F?new Date(Date.UTC(x[1],L,x[3]||1,x[4]||0,x[5]||0,x[6]||0,$)):new Date(x[1],L,x[3]||1,x[4]||0,x[5]||0,x[6]||0,$)}}return new Date(k)})(A),this.init()},N.init=function(){var A=this.$d;this.$y=A.getFullYear(),this.$M=A.getMonth(),this.$D=A.getDate(),this.$W=A.getDay(),this.$H=A.getHours(),this.$m=A.getMinutes(),this.$s=A.getSeconds(),this.$ms=A.getMilliseconds()},N.$utils=function(){return E},N.isValid=function(){return this.$d.toString()!==m},N.isSame=function(A,O){var k=P(A);return this.startOf(O)<=k&&k<=this.endOf(O)},N.isAfter=function(A,O){return P(A)<this.startOf(O)},N.isBefore=function(A,O){return this.endOf(O)<P(A)},N.$g=function(A,O,k){return E.u(A)?this[O]:this.set(k,A)},N.unix=function(){return Math.floor(this.valueOf()/1e3)},N.valueOf=function(){return this.$d.getTime()},N.startOf=function(A,O){var k=this,F=!!E.u(O)||O,x=E.p(A),L=function(K,X){var Z=E.w(k.$u?Date.UTC(k.$y,X,K):new Date(k.$y,X,K),k);return F?Z:Z.endOf(u)},$=function(K,X){return E.w(k.toDate()[K].apply(k.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(X)),k)},V=this.$W,_=this.$M,B=this.$D,G="set"+(this.$u?"UTC":"");switch(x){case f:return F?L(1,0):L(31,11);case d:return F?L(1,_):L(0,_+1);case c:var j=this.$locale().weekStart||0,Y=(V<j?V+7:V)-j;return L(F?B-Y:B+(6-Y),_);case u:case h:return $(G+"Hours",0);case l:return $(G+"Minutes",1);case o:return $(G+"Seconds",2);case s:return $(G+"Milliseconds",3);default:return this.clone()}},N.endOf=function(A){return this.startOf(A,!1)},N.$set=function(A,O){var k,F=E.p(A),x="set"+(this.$u?"UTC":""),L=(k={},k[u]=x+"Date",k[h]=x+"Date",k[d]=x+"Month",k[f]=x+"FullYear",k[l]=x+"Hours",k[o]=x+"Minutes",k[s]=x+"Seconds",k[a]=x+"Milliseconds",k)[F],$=F===u?this.$D+(O-this.$W):O;if(F===d||F===f){var V=this.clone().set(h,1);V.$d[L]($),V.init(),this.$d=V.set(h,Math.min(this.$D,V.daysInMonth())).$d}else L&&this.$d[L]($);return this.init(),this},N.set=function(A,O){return this.clone().$set(A,O)},N.get=function(A){return this[E.p(A)]()},N.add=function(A,O){var k,F=this;A=Number(A);var x=E.p(O),L=function(_){var B=P(F);return E.w(B.date(B.date()+Math.round(_*A)),F)};if(x===d)return this.set(d,this.$M+A);if(x===f)return this.set(f,this.$y+A);if(x===u)return L(1);if(x===c)return L(7);var $=(k={},k[o]=r,k[l]=n,k[s]=i,k)[x]||1,V=this.$d.getTime()+A*$;return E.w(V,this)},N.subtract=function(A,O){return this.add(-1*A,O)},N.format=function(A){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||m;var F=A||"YYYY-MM-DDTHH:mm:ssZ",x=E.z(this),L=this.$H,$=this.$m,V=this.$M,_=k.weekdays,B=k.months,G=k.meridiem,j=function(X,Z,Q,ae){return X&&(X[Z]||X(O,F))||Q[Z].slice(0,ae)},Y=function(X){return E.s(L%12||12,X,"0")},K=G||function(X,Z,Q){var ae=X<12?"AM":"PM";return Q?ae.toLowerCase():ae};return F.replace(I,(function(X,Z){return Z||(function(Q){switch(Q){case"YY":return String(O.$y).slice(-2);case"YYYY":return E.s(O.$y,4,"0");case"M":return V+1;case"MM":return E.s(V+1,2,"0");case"MMM":return j(k.monthsShort,V,B,3);case"MMMM":return j(B,V);case"D":return O.$D;case"DD":return E.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return j(k.weekdaysMin,O.$W,_,2);case"ddd":return j(k.weekdaysShort,O.$W,_,3);case"dddd":return _[O.$W];case"H":return String(L);case"HH":return E.s(L,2,"0");case"h":return Y(1);case"hh":return Y(2);case"a":return K(L,$,!0);case"A":return K(L,$,!1);case"m":return String($);case"mm":return E.s($,2,"0");case"s":return String(O.$s);case"ss":return E.s(O.$s,2,"0");case"SSS":return E.s(O.$ms,3,"0");case"Z":return x}return null})(X)||x.replace(":","")}))},N.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},N.diff=function(A,O,k){var F,x=this,L=E.p(O),$=P(A),V=($.utcOffset()-this.utcOffset())*r,_=this-$,B=function(){return E.m(x,$)};switch(L){case f:F=B()/12;break;case d:F=B();break;case p:F=B()/3;break;case c:F=(_-V)/6048e5;break;case u:F=(_-V)/864e5;break;case l:F=_/n;break;case o:F=_/r;break;case s:F=_/i;break;default:F=_}return k?F:E.a(F)},N.daysInMonth=function(){return this.endOf(d).$D},N.$locale=function(){return S[this.$L]},N.locale=function(A,O){if(!A)return this.$L;var k=this.clone(),F=D(A,O,!0);return F&&(k.$L=F),k},N.clone=function(){return E.w(this.$d,this)},N.toDate=function(){return new Date(this.valueOf())},N.toJSON=function(){return this.isValid()?this.toISOString():null},N.toISOString=function(){return this.$d.toISOString()},N.toString=function(){return this.$d.toUTCString()},M})(),C=R.prototype;return P.prototype=C,[["$ms",a],["$s",s],["$m",o],["$H",l],["$W",u],["$M",d],["$y",f],["$D",h]].forEach((function(M){C[M[1]]=function(N){return this.$g(N,M[0],M[1])}})),P.extend=function(M,N){return M.$i||(M(N,R,P),M.$i=!0),P},P.locale=D,P.isDayjs=T,P.unix=function(M){return P(1e3*M)},P.en=S[b],P.Ls=S,P.p={},P}))})(ED)),ED.exports}var Uxe=Sxe();const Txe=bxe(Uxe);function Dxe(t){const{dateMatchUps:e=[],completedMatchUps:i=[],groupInfo:r,mappedParticipants:n}=t?.data??{},a=e.concat(...i),s=a.reduce((b,S)=>{const U=S?.schedule?.scheduledDate;return U&&!b.includes(U)&&b.push(U),b},[]),o=s[0];let l;const u=b=>{for(const S of b.sides||[])S.participantId&&(S.participant=n[S.participantId],S.participant?.individualParticipantIds&&(S.participant.individualParticipants=S.participant.individualParticipantIds.map(U=>n[U])))},c=({scheduledDate:b})=>{const S=t?.data?.courtsData.map(P=>{const{matchUps:E,...R}=P;return E.forEach(u),{...R,matchUps:E.filter(C=>C.schedule?.scheduledDate===b)}}),U="C|",T=A$.courtGridRows({courtsData:S,courtPrefix:U,minRowsCount:10,scheduledDate:b}).rows,D=yxe({courtsData:S,courtPrefix:U});return T?.forEach((P,E)=>{P.rowId=`rowId-${E+1}`,P.rowNumber=E+1}),{rows:T,columns:D,courtsCount:S?.length??0,courtsData:S,groupInfo:r}},d=({scheduledDate:b})=>{const{rows:S}=c({scheduledDate:b});l?.replaceData(S),l.matchUps=a},p=b=>Txe(b).format("dddd MMM D"),f=s.map(b=>({onClick:()=>d({scheduledDate:b}),label:p(b),value:b,close:!0})),h={label:p(o),options:f,id:"dateSelector",modifyLabel:!0,selection:!0},m=document.getElementById("scheduleHeader");RAe(m);const g=Ih({button:h});m.appendChild(g),aU({anchorId:"tournamentSchedule"});const I=document.getElementById("tournamentSchedule"),{rows:v=[],columns:w=[],courtsCount:y}=c({scheduledDate:o});return l=new Lv(I,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:v,columns:w}),{table:l,courtsCount:y}}function YP(t,e){const i=t?.person||t?.participant?.person,r=e?.person||e?.participant?.person;return i||r?i?.standardFamilyName&&!r?.standardFamilyName||r?.standardFamilyName&&!i?.standardFamilyName||!i?.standardFamilyName&&!r?.standardFamilyName?1:i.standardFamilyName?.localeCompare(r?.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!t?.participantName&&!e?.participantName?1:t?.participantName?.localeCompare(e?.participantName)}const{ratingsParameters:Zz}=_Ne,{SINGLES:eq}=G1,tq="playersTable";function Pxe({participants:t=[],columnConfig:e}){aU({anchorId:tq});const i=document.getElementById(tq);if(!i)return;const r=t.filter(d=>d.participantType==="INDIVIDUAL");r.sort(YP);const n=r.map(d=>{const f=(d.person||{}).nationalityCode||"",h=(d.events||[]).map(v=>v.eventName).join(", "),m={};for(const v of d.ratings?.[eq]||[]){const w=v.scaleName.toLowerCase(),b=Zz[v.scaleName.toUpperCase()]?.accessor||`${w}Rating`;m[w]=typeof v.scaleValue=="object"&&v.scaleValue!==null?v.scaleValue:{[b]:v.scaleValue}}const I=d.rankings?.[eq]?.[0]?.scaleValue??void 0;return{name:d.participantName||"",country:f,ratings:m,ranking:I,events:h}}),a=new Set;let s=!1;for(const d of n){for(const p of Object.keys(d.ratings||{}))a.add(p);d.ranking!==null&&d.ranking!==void 0&&(s=!0)}let o=[];for(const d of a){const p=d.toUpperCase(),f=Zz[p];if(!f||e&&Array.isArray(e.ratings)&&!new Set(e.ratings.map(g=>g.toUpperCase())).has(p))continue;const h=f.accessor||`${d}Rating`;o.push({title:p,field:`ratings.${d}.${h}`,sorter:"number",sorterParams:{alignEmptyValues:"bottom"},headerSort:!0,width:80})}o.sort((d,p)=>d.title.localeCompare(p.title)),e&&Array.isArray(e.rankings)&&e.rankings.length===0&&(s=!1);const l=[{title:bo("players.name"),field:"name",sorter:"string",headerSort:!0}];(!e||e.country!==!1)&&l.push({title:bo("players.country"),field:"country",sorter:"string",headerSort:!0,width:100}),s&&l.push({title:bo("players.rank"),field:"ranking",sorter:"number",sorterParams:{alignEmptyValues:"bottom"},headerSort:!0,width:80}),l.push(...o),(!e||e.events!==!1)&&l.push({title:bo("players.events"),field:"events",sorter:"string",headerSort:!0}),new Lv(i,{height:window.innerHeight*.84,placeholder:bo("players.noParticipants"),data:n,columns:l})}function Exe(){return"tmxToken"}function wte(t,e){return function(){return t.apply(e,arguments)}}const{toString:Rxe}=Object.prototype,{getPrototypeOf:mB}=Object,{iterator:TM,toStringTag:Ste}=Symbol,DM=(t=>e=>{const i=Rxe.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),$u=t=>(t=t.toLowerCase(),e=>DM(e)===t),PM=t=>e=>typeof e===t,{isArray:_v}=Array,UI=PM("undefined");function sU(t){return t!==null&&!UI(t)&&t.constructor!==null&&!UI(t.constructor)&&js(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Ute=$u("ArrayBuffer");function Cxe(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Ute(t.buffer),e}const Mxe=PM("string"),js=PM("function"),Tte=PM("number"),oU=t=>t!==null&&typeof t=="object",Nxe=t=>t===!0||t===!1,RD=t=>{if(DM(t)!=="object")return!1;const e=mB(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Ste in t)&&!(TM in t)},Axe=t=>{if(!oU(t)||sU(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},kxe=$u("Date"),Oxe=$u("File"),xxe=t=>!!(t&&typeof t.uri<"u"),Fxe=t=>t&&typeof t.getParts<"u",Lxe=$u("Blob"),_xe=$u("FileList"),$xe=t=>oU(t)&&js(t.pipe);function Bxe(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}}const iq=Bxe(),rq=typeof iq.FormData<"u"?iq.FormData:void 0,Vxe=t=>{let e;return t&&(rq&&t instanceof rq||js(t.append)&&((e=DM(t))==="formdata"||e==="object"&&js(t.toString)&&t.toString()==="[object FormData]"))},jxe=$u("URLSearchParams"),[Gxe,Hxe,Wxe,zxe]=["ReadableStream","Request","Response","Headers"].map($u),qxe=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function lU(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let r,n;if(typeof t!="object"&&(t=[t]),_v(t))for(r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else{if(sU(t))return;const a=i?Object.getOwnPropertyNames(t):Object.keys(t),s=a.length;let o;for(r=0;r<s;r++)o=a[r],e.call(null,t[o],o,t)}}function Dte(t,e){if(sU(t))return null;e=e.toLowerCase();const i=Object.keys(t);let r=i.length,n;for(;r-- >0;)if(n=i[r],e===n.toLowerCase())return n;return null}const ih=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Pte=t=>!UI(t)&&t!==ih;function Px(){const{caseless:t,skipUndefined:e}=Pte(this)&&this||{},i={},r=(n,a)=>{if(a==="__proto__"||a==="constructor"||a==="prototype")return;const s=t&&Dte(i,a)||a;RD(i[s])&&RD(n)?i[s]=Px(i[s],n):RD(n)?i[s]=Px({},n):_v(n)?i[s]=n.slice():(!e||!UI(n))&&(i[s]=n)};for(let n=0,a=arguments.length;n<a;n++)arguments[n]&&lU(arguments[n],r);return i}const Yxe=(t,e,i,{allOwnKeys:r}={})=>(lU(e,(n,a)=>{i&&js(n)?Object.defineProperty(t,a,{value:wte(n,i),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(t,a,{value:n,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:r}),t),Kxe=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Xxe=(t,e,i,r)=>{t.prototype=Object.create(e.prototype,r),Object.defineProperty(t.prototype,"constructor",{value:t,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},Jxe=(t,e,i,r)=>{let n,a,s;const o={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),a=n.length;a-- >0;)s=n[a],(!r||r(s,t,e))&&!o[s]&&(e[s]=t[s],o[s]=!0);t=i!==!1&&mB(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},Qxe=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const r=t.indexOf(e,i);return r!==-1&&r===i},Zxe=t=>{if(!t)return null;if(_v(t))return t;let e=t.length;if(!Tte(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},eFe=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&mB(Uint8Array)),tFe=(t,e)=>{const r=(t&&t[TM]).call(t);let n;for(;(n=r.next())&&!n.done;){const a=n.value;e.call(t,a[0],a[1])}},iFe=(t,e)=>{let i;const r=[];for(;(i=t.exec(e))!==null;)r.push(i);return r},rFe=$u("HTMLFormElement"),nFe=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,r,n){return r.toUpperCase()+n}),nq=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),aFe=$u("RegExp"),Ete=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),r={};lU(i,(n,a)=>{let s;(s=e(n,a,t))!==!1&&(r[a]=s||n)}),Object.defineProperties(t,r)},sFe=t=>{Ete(t,(e,i)=>{if(js(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const r=t[i];if(js(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},oFe=(t,e)=>{const i={},r=n=>{n.forEach(a=>{i[a]=!0})};return _v(t)?r(t):r(String(t).split(e)),i},lFe=()=>{},uFe=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function cFe(t){return!!(t&&js(t.append)&&t[Ste]==="FormData"&&t[TM])}const dFe=t=>{const e=new Array(10),i=(r,n)=>{if(oU(r)){if(e.indexOf(r)>=0)return;if(sU(r))return r;if(!("toJSON"in r)){e[n]=r;const a=_v(r)?[]:{};return lU(r,(s,o)=>{const l=i(s,n+1);!UI(l)&&(a[o]=l)}),e[n]=void 0,a}}return r};return i(t,0)},pFe=$u("AsyncFunction"),fFe=t=>t&&(oU(t)||js(t))&&js(t.then)&&js(t.catch),Rte=((t,e)=>t?setImmediate:e?((i,r)=>(ih.addEventListener("message",({source:n,data:a})=>{n===ih&&a===i&&r.length&&r.shift()()},!1),n=>{r.push(n),ih.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",js(ih.postMessage)),hFe=typeof queueMicrotask<"u"?queueMicrotask.bind(ih):typeof process<"u"&&process.nextTick||Rte,mFe=t=>t!=null&&js(t[TM]),me={isArray:_v,isArrayBuffer:Ute,isBuffer:sU,isFormData:Vxe,isArrayBufferView:Cxe,isString:Mxe,isNumber:Tte,isBoolean:Nxe,isObject:oU,isPlainObject:RD,isEmptyObject:Axe,isReadableStream:Gxe,isRequest:Hxe,isResponse:Wxe,isHeaders:zxe,isUndefined:UI,isDate:kxe,isFile:Oxe,isReactNativeBlob:xxe,isReactNative:Fxe,isBlob:Lxe,isRegExp:aFe,isFunction:js,isStream:$xe,isURLSearchParams:jxe,isTypedArray:eFe,isFileList:_xe,forEach:lU,merge:Px,extend:Yxe,trim:qxe,stripBOM:Kxe,inherits:Xxe,toFlatObject:Jxe,kindOf:DM,kindOfTest:$u,endsWith:Qxe,toArray:Zxe,forEachEntry:tFe,matchAll:iFe,isHTMLForm:rFe,hasOwnProperty:nq,hasOwnProp:nq,reduceDescriptors:Ete,freezeMethods:sFe,toObjectSet:oFe,toCamelCase:nFe,noop:lFe,toFiniteNumber:uFe,findKey:Dte,global:ih,isContextDefined:Pte,isSpecCompliantForm:cFe,toJSONObject:dFe,isAsyncFn:pFe,isThenable:fFe,setImmediate:Rte,asap:hFe,isIterable:mFe};let At=class Cte extends Error{static from(e,i,r,n,a,s){const o=new Cte(e.message,i||e.code,r,n,a);return o.cause=e,o.name=e.name,e.status!=null&&o.status==null&&(o.status=e.status),s&&Object.assign(o,s),o}constructor(e,i,r,n,a){super(e),Object.defineProperty(this,"message",{value:e,enumerable:!0,writable:!0,configurable:!0}),this.name="AxiosError",this.isAxiosError=!0,i&&(this.code=i),r&&(this.config=r),n&&(this.request=n),a&&(this.response=a,this.status=a.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:me.toJSONObject(this.config),code:this.code,status:this.status}}};At.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";At.ERR_BAD_OPTION="ERR_BAD_OPTION";At.ECONNABORTED="ECONNABORTED";At.ETIMEDOUT="ETIMEDOUT";At.ERR_NETWORK="ERR_NETWORK";At.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";At.ERR_DEPRECATED="ERR_DEPRECATED";At.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";At.ERR_BAD_REQUEST="ERR_BAD_REQUEST";At.ERR_CANCELED="ERR_CANCELED";At.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";At.ERR_INVALID_URL="ERR_INVALID_URL";const gFe=null;function Ex(t){return me.isPlainObject(t)||me.isArray(t)}function Mte(t){return me.endsWith(t,"[]")?t.slice(0,-2):t}function Sk(t,e,i){return t?t.concat(e).map(function(n,a){return n=Mte(n),!i&&a?"["+n+"]":n}).join(i?".":""):e}function IFe(t){return me.isArray(t)&&!t.some(Ex)}const vFe=me.toFlatObject(me,{},null,function(e){return/^is[A-Z]/.test(e)});function EM(t,e,i){if(!me.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=me.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!me.isUndefined(g[m])});const r=i.metaTokens,n=i.visitor||c,a=i.dots,s=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&me.isSpecCompliantForm(e);if(!me.isFunction(n))throw new TypeError("visitor must be a function");function u(h){if(h===null)return"";if(me.isDate(h))return h.toISOString();if(me.isBoolean(h))return h.toString();if(!l&&me.isBlob(h))throw new At("Blob is not supported. Use a Buffer instead.");return me.isArrayBuffer(h)||me.isTypedArray(h)?l&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function c(h,m,g){let I=h;if(me.isReactNative(e)&&me.isReactNativeBlob(h))return e.append(Sk(g,m,a),u(h)),!1;if(h&&!g&&typeof h=="object"){if(me.endsWith(m,"{}"))m=r?m:m.slice(0,-2),h=JSON.stringify(h);else if(me.isArray(h)&&IFe(h)||(me.isFileList(h)||me.endsWith(m,"[]"))&&(I=me.toArray(h)))return m=Mte(m),I.forEach(function(w,y){!(me.isUndefined(w)||w===null)&&e.append(s===!0?Sk([m],y,a):s===null?m:m+"[]",u(w))}),!1}return Ex(h)?!0:(e.append(Sk(g,m,a),u(h)),!1)}const d=[],p=Object.assign(vFe,{defaultVisitor:c,convertValue:u,isVisitable:Ex});function f(h,m){if(!me.isUndefined(h)){if(d.indexOf(h)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(h),me.forEach(h,function(I,v){(!(me.isUndefined(I)||I===null)&&n.call(e,I,me.isString(v)?v.trim():v,m,p))===!0&&f(I,m?m.concat(v):[v])}),d.pop()}}if(!me.isObject(t))throw new TypeError("data must be an object");return f(t),e}function aq(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function gB(t,e){this._pairs=[],t&&EM(t,this,e)}const Nte=gB.prototype;Nte.append=function(e,i){this._pairs.push([e,i])};Nte.toString=function(e){const i=e?function(r){return e.call(this,r,aq)}:aq;return this._pairs.map(function(n){return i(n[0])+"="+i(n[1])},"").join("&")};function yFe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Ate(t,e,i){if(!e)return t;const r=i&&i.encode||yFe,n=me.isFunction(i)?{serialize:i}:i,a=n&&n.serialize;let s;if(a?s=a(e,n):s=me.isURLSearchParams(e)?e.toString():new gB(e,n).toString(r),s){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}class sq{constructor(){this.handlers=[]}use(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){me.forEach(this.handlers,function(r){r!==null&&e(r)})}}const IB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1,legacyInterceptorReqResOrdering:!0},bFe=typeof URLSearchParams<"u"?URLSearchParams:gB,wFe=typeof FormData<"u"?FormData:null,SFe=typeof Blob<"u"?Blob:null,UFe={isBrowser:!0,classes:{URLSearchParams:bFe,FormData:wFe,Blob:SFe},protocols:["http","https","file","blob","url","data"]},vB=typeof window<"u"&&typeof document<"u",Rx=typeof navigator=="object"&&navigator||void 0,TFe=vB&&(!Rx||["ReactNative","NativeScript","NS"].indexOf(Rx.product)<0),DFe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",PFe=vB&&window.location.href||"http://localhost",EFe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:vB,hasStandardBrowserEnv:TFe,hasStandardBrowserWebWorkerEnv:DFe,navigator:Rx,origin:PFe},Symbol.toStringTag,{value:"Module"})),_a={...EFe,...UFe};function RFe(t,e){return EM(t,new _a.classes.URLSearchParams,{visitor:function(i,r,n,a){return _a.isNode&&me.isBuffer(i)?(this.append(r,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)},...e})}function CFe(t){return me.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function MFe(t){const e={},i=Object.keys(t);let r;const n=i.length;let a;for(r=0;r<n;r++)a=i[r],e[a]=t[a];return e}function kte(t){function e(i,r,n,a){let s=i[a++];if(s==="__proto__")return!0;const o=Number.isFinite(+s),l=a>=i.length;return s=!s&&me.isArray(n)?n.length:s,l?(me.hasOwnProp(n,s)?n[s]=[n[s],r]:n[s]=r,!o):((!n[s]||!me.isObject(n[s]))&&(n[s]=[]),e(i,r,n[s],a)&&me.isArray(n[s])&&(n[s]=MFe(n[s])),!o)}if(me.isFormData(t)&&me.isFunction(t.entries)){const i={};return me.forEachEntry(t,(r,n)=>{e(CFe(r),n,i,0)}),i}return null}function NFe(t,e,i){if(me.isString(t))try{return(e||JSON.parse)(t),me.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(t)}const uU={transitional:IB,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const r=i.getContentType()||"",n=r.indexOf("application/json")>-1,a=me.isObject(e);if(a&&me.isHTMLForm(e)&&(e=new FormData(e)),me.isFormData(e))return n?JSON.stringify(kte(e)):e;if(me.isArrayBuffer(e)||me.isBuffer(e)||me.isStream(e)||me.isFile(e)||me.isBlob(e)||me.isReadableStream(e))return e;if(me.isArrayBufferView(e))return e.buffer;if(me.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return RFe(e,this.formSerializer).toString();if((o=me.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return EM(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||n?(i.setContentType("application/json",!1),NFe(e)):e}],transformResponse:[function(e){const i=this.transitional||uU.transitional,r=i&&i.forcedJSONParsing,n=this.responseType==="json";if(me.isResponse(e)||me.isReadableStream(e))return e;if(e&&me.isString(e)&&(r&&!this.responseType||n)){const s=!(i&&i.silentJSONParsing)&&n;try{return JSON.parse(e,this.parseReviver)}catch(o){if(s)throw o.name==="SyntaxError"?At.from(o,At.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:_a.classes.FormData,Blob:_a.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};me.forEach(["delete","get","head","post","put","patch"],t=>{uU.headers[t]={}});const AFe=me.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),kFe=t=>{const e={};let i,r,n;return t&&t.split(`
`).forEach(function(s){n=s.indexOf(":"),i=s.substring(0,n).trim().toLowerCase(),r=s.substring(n+1).trim(),!(!i||e[i]&&AFe[i])&&(i==="set-cookie"?e[i]?e[i].push(r):e[i]=[r]:e[i]=e[i]?e[i]+", "+r:r)}),e},oq=Symbol("internals");function Py(t){return t&&String(t).trim().toLowerCase()}function CD(t){return t===!1||t==null?t:me.isArray(t)?t.map(CD):String(t)}function OFe(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=i.exec(t);)e[r[1]]=r[2];return e}const xFe=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Uk(t,e,i,r,n){if(me.isFunction(r))return r.call(this,e,i);if(n&&(e=i),!!me.isString(e)){if(me.isString(r))return e.indexOf(r)!==-1;if(me.isRegExp(r))return r.test(e)}}function FFe(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,r)=>i.toUpperCase()+r)}function LFe(t,e){const i=me.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+i,{value:function(n,a,s){return this[r].call(this,e,n,a,s)},configurable:!0})})}let Gs=class{constructor(e){e&&this.set(e)}set(e,i,r){const n=this;function a(o,l,u){const c=Py(l);if(!c)throw new Error("header name must be a non-empty string");const d=me.findKey(n,c);(!d||n[d]===void 0||u===!0||u===void 0&&n[d]!==!1)&&(n[d||l]=CD(o))}const s=(o,l)=>me.forEach(o,(u,c)=>a(u,c,l));if(me.isPlainObject(e)||e instanceof this.constructor)s(e,i);else if(me.isString(e)&&(e=e.trim())&&!xFe(e))s(kFe(e),i);else if(me.isObject(e)&&me.isIterable(e)){let o={},l,u;for(const c of e){if(!me.isArray(c))throw TypeError("Object iterator must return a key-value pair");o[u=c[0]]=(l=o[u])?me.isArray(l)?[...l,c[1]]:[l,c[1]]:c[1]}s(o,i)}else e!=null&&a(i,e,r);return this}get(e,i){if(e=Py(e),e){const r=me.findKey(this,e);if(r){const n=this[r];if(!i)return n;if(i===!0)return OFe(n);if(me.isFunction(i))return i.call(this,n,r);if(me.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=Py(e),e){const r=me.findKey(this,e);return!!(r&&this[r]!==void 0&&(!i||Uk(this,this[r],r,i)))}return!1}delete(e,i){const r=this;let n=!1;function a(s){if(s=Py(s),s){const o=me.findKey(r,s);o&&(!i||Uk(r,r[o],o,i))&&(delete r[o],n=!0)}}return me.isArray(e)?e.forEach(a):a(e),n}clear(e){const i=Object.keys(this);let r=i.length,n=!1;for(;r--;){const a=i[r];(!e||Uk(this,this[a],a,e,!0))&&(delete this[a],n=!0)}return n}normalize(e){const i=this,r={};return me.forEach(this,(n,a)=>{const s=me.findKey(r,a);if(s){i[s]=CD(n),delete i[a];return}const o=e?FFe(a):String(a).trim();o!==a&&delete i[a],i[o]=CD(n),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return me.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=e&&me.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const r=new this(e);return i.forEach(n=>r.set(n)),r}static accessor(e){const r=(this[oq]=this[oq]={accessors:{}}).accessors,n=this.prototype;function a(s){const o=Py(s);r[o]||(LFe(n,s),r[o]=!0)}return me.isArray(e)?e.forEach(a):a(e),this}};Gs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);me.reduceDescriptors(Gs.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[i]=r}}});me.freezeMethods(Gs);function Tk(t,e){const i=this||uU,r=e||i,n=Gs.from(r.headers);let a=r.data;return me.forEach(t,function(o){a=o.call(i,a,n.normalize(),e?e.status:void 0)}),n.normalize(),a}function Ote(t){return!!(t&&t.__CANCEL__)}let cU=class extends At{constructor(e,i,r){super(e??"canceled",At.ERR_CANCELED,i,r),this.name="CanceledError",this.__CANCEL__=!0}};function xte(t,e,i){const r=i.config.validateStatus;!i.status||!r||r(i.status)?t(i):e(new At("Request failed with status code "+i.status,[At.ERR_BAD_REQUEST,At.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function _Fe(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function $Fe(t,e){t=t||10;const i=new Array(t),r=new Array(t);let n=0,a=0,s;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=r[a];s||(s=u),i[n]=l,r[n]=u;let d=a,p=0;for(;d!==n;)p+=i[d++],d=d%t;if(n=(n+1)%t,n===a&&(a=(a+1)%t),u-s<e)return;const f=c&&u-c;return f?Math.round(p*1e3/f):void 0}}function BFe(t,e){let i=0,r=1e3/e,n,a;const s=(u,c=Date.now())=>{i=c,n=null,a&&(clearTimeout(a),a=null),t(...u)};return[(...u)=>{const c=Date.now(),d=c-i;d>=r?s(u,c):(n=u,a||(a=setTimeout(()=>{a=null,s(n)},r-d)))},()=>n&&s(n)]}const KP=(t,e,i=3)=>{let r=0;const n=$Fe(50,250);return BFe(a=>{const s=a.loaded,o=a.lengthComputable?a.total:void 0,l=s-r,u=n(l),c=s<=o;r=s;const d={loaded:s,total:o,progress:o?s/o:void 0,bytes:l,rate:u||void 0,estimated:u&&o&&c?(o-s)/u:void 0,event:a,lengthComputable:o!=null,[e?"download":"upload"]:!0};t(d)},i)},lq=(t,e)=>{const i=t!=null;return[r=>e[0]({lengthComputable:i,total:t,loaded:r}),e[1]]},uq=t=>(...e)=>me.asap(()=>t(...e)),VFe=_a.hasStandardBrowserEnv?((t,e)=>i=>(i=new URL(i,_a.origin),t.protocol===i.protocol&&t.host===i.host&&(e||t.port===i.port)))(new URL(_a.origin),_a.navigator&&/(msie|trident)/i.test(_a.navigator.userAgent)):()=>!0,jFe=_a.hasStandardBrowserEnv?{write(t,e,i,r,n,a,s){if(typeof document>"u")return;const o=[`${t}=${encodeURIComponent(e)}`];me.isNumber(i)&&o.push(`expires=${new Date(i).toUTCString()}`),me.isString(r)&&o.push(`path=${r}`),me.isString(n)&&o.push(`domain=${n}`),a===!0&&o.push("secure"),me.isString(s)&&o.push(`SameSite=${s}`),document.cookie=o.join("; ")},read(t){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function GFe(t){return typeof t!="string"?!1:/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function HFe(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Fte(t,e,i){let r=!GFe(e);return t&&(r||i==!1)?HFe(t,e):e}const cq=t=>t instanceof Gs?{...t}:t;function Wh(t,e){e=e||{};const i={};function r(u,c,d,p){return me.isPlainObject(u)&&me.isPlainObject(c)?me.merge.call({caseless:p},u,c):me.isPlainObject(c)?me.merge({},c):me.isArray(c)?c.slice():c}function n(u,c,d,p){if(me.isUndefined(c)){if(!me.isUndefined(u))return r(void 0,u,d,p)}else return r(u,c,d,p)}function a(u,c){if(!me.isUndefined(c))return r(void 0,c)}function s(u,c){if(me.isUndefined(c)){if(!me.isUndefined(u))return r(void 0,u)}else return r(void 0,c)}function o(u,c,d){if(d in e)return r(u,c);if(d in t)return r(void 0,u)}const l={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:o,headers:(u,c,d)=>n(cq(u),cq(c),d,!0)};return me.forEach(Object.keys({...t,...e}),function(c){if(c==="__proto__"||c==="constructor"||c==="prototype")return;const d=me.hasOwnProp(l,c)?l[c]:n,p=d(t[c],e[c],c);me.isUndefined(p)&&d!==o||(i[c]=p)}),i}const Lte=t=>{const e=Wh({},t);let{data:i,withXSRFToken:r,xsrfHeaderName:n,xsrfCookieName:a,headers:s,auth:o}=e;if(e.headers=s=Gs.from(s),e.url=Ate(Fte(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),o&&s.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),me.isFormData(i)){if(_a.hasStandardBrowserEnv||_a.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(me.isFunction(i.getHeaders)){const l=i.getHeaders(),u=["content-type","content-length"];Object.entries(l).forEach(([c,d])=>{u.includes(c.toLowerCase())&&s.set(c,d)})}}if(_a.hasStandardBrowserEnv&&(r&&me.isFunction(r)&&(r=r(e)),r||r!==!1&&VFe(e.url))){const l=n&&a&&jFe.read(a);l&&s.set(n,l)}return e},WFe=typeof XMLHttpRequest<"u",zFe=WFe&&function(t){return new Promise(function(i,r){const n=Lte(t);let a=n.data;const s=Gs.from(n.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:u}=n,c,d,p,f,h;function m(){f&&f(),h&&h(),n.cancelToken&&n.cancelToken.unsubscribe(c),n.signal&&n.signal.removeEventListener("abort",c)}let g=new XMLHttpRequest;g.open(n.method.toUpperCase(),n.url,!0),g.timeout=n.timeout;function I(){if(!g)return;const w=Gs.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),b={data:!o||o==="text"||o==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:w,config:t,request:g};xte(function(U){i(U),m()},function(U){r(U),m()},b),g=null}"onloadend"in g?g.onloadend=I:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(I)},g.onabort=function(){g&&(r(new At("Request aborted",At.ECONNABORTED,t,g)),g=null)},g.onerror=function(y){const b=y&&y.message?y.message:"Network Error",S=new At(b,At.ERR_NETWORK,t,g);S.event=y||null,r(S),g=null},g.ontimeout=function(){let y=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const b=n.transitional||IB;n.timeoutErrorMessage&&(y=n.timeoutErrorMessage),r(new At(y,b.clarifyTimeoutError?At.ETIMEDOUT:At.ECONNABORTED,t,g)),g=null},a===void 0&&s.setContentType(null),"setRequestHeader"in g&&me.forEach(s.toJSON(),function(y,b){g.setRequestHeader(b,y)}),me.isUndefined(n.withCredentials)||(g.withCredentials=!!n.withCredentials),o&&o!=="json"&&(g.responseType=n.responseType),u&&([p,h]=KP(u,!0),g.addEventListener("progress",p)),l&&g.upload&&([d,f]=KP(l),g.upload.addEventListener("progress",d),g.upload.addEventListener("loadend",f)),(n.cancelToken||n.signal)&&(c=w=>{g&&(r(!w||w.type?new cU(null,t,g):w),g.abort(),g=null)},n.cancelToken&&n.cancelToken.subscribe(c),n.signal&&(n.signal.aborted?c():n.signal.addEventListener("abort",c)));const v=_Fe(n.url);if(v&&_a.protocols.indexOf(v)===-1){r(new At("Unsupported protocol "+v+":",At.ERR_BAD_REQUEST,t));return}g.send(a||null)})},qFe=(t,e)=>{const{length:i}=t=t?t.filter(Boolean):[];if(e||i){let r=new AbortController,n;const a=function(u){if(!n){n=!0,o();const c=u instanceof Error?u:this.reason;r.abort(c instanceof At?c:new cU(c instanceof Error?c.message:c))}};let s=e&&setTimeout(()=>{s=null,a(new At(`timeout of ${e}ms exceeded`,At.ETIMEDOUT))},e);const o=()=>{t&&(s&&clearTimeout(s),s=null,t.forEach(u=>{u.unsubscribe?u.unsubscribe(a):u.removeEventListener("abort",a)}),t=null)};t.forEach(u=>u.addEventListener("abort",a));const{signal:l}=r;return l.unsubscribe=()=>me.asap(o),l}},YFe=function*(t,e){let i=t.byteLength;if(i<e){yield t;return}let r=0,n;for(;r<i;)n=r+e,yield t.slice(r,n),r=n},KFe=async function*(t,e){for await(const i of XFe(t))yield*YFe(i,e)},XFe=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:i,value:r}=await e.read();if(i)break;yield r}}finally{await e.cancel()}},dq=(t,e,i,r)=>{const n=KFe(t,e);let a=0,s,o=l=>{s||(s=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:u,value:c}=await n.next();if(u){o(),l.close();return}let d=c.byteLength;if(i){let p=a+=d;i(p)}l.enqueue(new Uint8Array(c))}catch(u){throw o(u),u}},cancel(l){return o(l),n.return()}},{highWaterMark:2})},pq=64*1024,{isFunction:WT}=me,JFe=(({Request:t,Response:e})=>({Request:t,Response:e}))(me.global),{ReadableStream:fq,TextEncoder:hq}=me.global,mq=(t,...e)=>{try{return!!t(...e)}catch{return!1}},QFe=t=>{t=me.merge.call({skipUndefined:!0},JFe,t);const{fetch:e,Request:i,Response:r}=t,n=e?WT(e):typeof fetch=="function",a=WT(i),s=WT(r);if(!n)return!1;const o=n&&WT(fq),l=n&&(typeof hq=="function"?(h=>m=>h.encode(m))(new hq):async h=>new Uint8Array(await new i(h).arrayBuffer())),u=a&&o&&mq(()=>{let h=!1;const m=new i(_a.origin,{body:new fq,method:"POST",get duplex(){return h=!0,"half"}}).headers.has("Content-Type");return h&&!m}),c=s&&o&&mq(()=>me.isReadableStream(new r("").body)),d={stream:c&&(h=>h.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(h=>{!d[h]&&(d[h]=(m,g)=>{let I=m&&m[h];if(I)return I.call(m);throw new At(`Response type '${h}' is not supported`,At.ERR_NOT_SUPPORT,g)})});const p=async h=>{if(h==null)return 0;if(me.isBlob(h))return h.size;if(me.isSpecCompliantForm(h))return(await new i(_a.origin,{method:"POST",body:h}).arrayBuffer()).byteLength;if(me.isArrayBufferView(h)||me.isArrayBuffer(h))return h.byteLength;if(me.isURLSearchParams(h)&&(h=h+""),me.isString(h))return(await l(h)).byteLength},f=async(h,m)=>{const g=me.toFiniteNumber(h.getContentLength());return g??p(m)};return async h=>{let{url:m,method:g,data:I,signal:v,cancelToken:w,timeout:y,onDownloadProgress:b,onUploadProgress:S,responseType:U,headers:T,withCredentials:D="same-origin",fetchOptions:P}=Lte(h),E=e||fetch;U=U?(U+"").toLowerCase():"text";let R=qFe([v,w&&w.toAbortSignal()],y),C=null;const M=R&&R.unsubscribe&&(()=>{R.unsubscribe()});let N;try{if(S&&u&&g!=="get"&&g!=="head"&&(N=await f(T,I))!==0){let L=new i(m,{method:"POST",body:I,duplex:"half"}),$;if(me.isFormData(I)&&($=L.headers.get("content-type"))&&T.setContentType($),L.body){const[V,_]=lq(N,KP(uq(S)));I=dq(L.body,pq,V,_)}}me.isString(D)||(D=D?"include":"omit");const A=a&&"credentials"in i.prototype,O={...P,signal:R,method:g.toUpperCase(),headers:T.normalize().toJSON(),body:I,duplex:"half",credentials:A?D:void 0};C=a&&new i(m,O);let k=await(a?E(C,P):E(m,O));const F=c&&(U==="stream"||U==="response");if(c&&(b||F&&M)){const L={};["status","statusText","headers"].forEach(B=>{L[B]=k[B]});const $=me.toFiniteNumber(k.headers.get("content-length")),[V,_]=b&&lq($,KP(uq(b),!0))||[];k=new r(dq(k.body,pq,V,()=>{_&&_(),M&&M()}),L)}U=U||"text";let x=await d[me.findKey(d,U)||"text"](k,h);return!F&&M&&M(),await new Promise((L,$)=>{xte(L,$,{data:x,headers:Gs.from(k.headers),status:k.status,statusText:k.statusText,config:h,request:C})})}catch(A){throw M&&M(),A&&A.name==="TypeError"&&/Load failed|fetch/i.test(A.message)?Object.assign(new At("Network Error",At.ERR_NETWORK,h,C,A&&A.response),{cause:A.cause||A}):At.from(A,A&&A.code,h,C,A&&A.response)}}},ZFe=new Map,_te=t=>{let e=t&&t.env||{};const{fetch:i,Request:r,Response:n}=e,a=[r,n,i];let s=a.length,o=s,l,u,c=ZFe;for(;o--;)l=a[o],u=c.get(l),u===void 0&&c.set(l,u=o?new Map:QFe(e)),c=u;return u};_te();const yB={http:gFe,xhr:zFe,fetch:{get:_te}};me.forEach(yB,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const gq=t=>`- ${t}`,e1e=t=>me.isFunction(t)||t===null||t===!1;function t1e(t,e){t=me.isArray(t)?t:[t];const{length:i}=t;let r,n;const a={};for(let s=0;s<i;s++){r=t[s];let o;if(n=r,!e1e(r)&&(n=yB[(o=String(r)).toLowerCase()],n===void 0))throw new At(`Unknown adapter '${o}'`);if(n&&(me.isFunction(n)||(n=n.get(e))))break;a[o||"#"+s]=n}if(!n){const s=Object.entries(a).map(([l,u])=>`adapter ${l} `+(u===!1?"is not supported by the environment":"is not available in the build"));let o=i?s.length>1?`since :
`+s.map(gq).join(`
`):" "+gq(s[0]):"as no adapter specified";throw new At("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n}const $te={getAdapter:t1e,adapters:yB};function Dk(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new cU(null,t)}function Iq(t){return Dk(t),t.headers=Gs.from(t.headers),t.data=Tk.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),$te.getAdapter(t.adapter||uU.adapter,t)(t).then(function(r){return Dk(t),r.data=Tk.call(t,t.transformResponse,r),r.headers=Gs.from(r.headers),r},function(r){return Ote(r)||(Dk(t),r&&r.response&&(r.response.data=Tk.call(t,t.transformResponse,r.response),r.response.headers=Gs.from(r.response.headers))),Promise.reject(r)})}const Bte="1.13.6",RM={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{RM[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const vq={};RM.transitional=function(e,i,r){function n(a,s){return"[Axios v"+Bte+"] Transitional option '"+a+"'"+s+(r?". "+r:"")}return(a,s,o)=>{if(e===!1)throw new At(n(s," has been removed"+(i?" in "+i:"")),At.ERR_DEPRECATED);return i&&!vq[s]&&(vq[s]=!0,console.warn(n(s," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(a,s,o):!0}};RM.spelling=function(e){return(i,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function i1e(t,e,i){if(typeof t!="object")throw new At("options must be an object",At.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let n=r.length;for(;n-- >0;){const a=r[n],s=e[a];if(s){const o=t[a],l=o===void 0||s(o,a,t);if(l!==!0)throw new At("option "+a+" must be "+l,At.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new At("Unknown option "+a,At.ERR_BAD_OPTION)}}const MD={assertOptions:i1e,validators:RM},Ho=MD.validators;let vh=class{constructor(e){this.defaults=e||{},this.interceptors={request:new sq,response:new sq}}async request(e,i){try{return await this._request(e,i)}catch(r){if(r instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const a=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=Wh(this.defaults,i);const{transitional:r,paramsSerializer:n,headers:a}=i;r!==void 0&&MD.assertOptions(r,{silentJSONParsing:Ho.transitional(Ho.boolean),forcedJSONParsing:Ho.transitional(Ho.boolean),clarifyTimeoutError:Ho.transitional(Ho.boolean),legacyInterceptorReqResOrdering:Ho.transitional(Ho.boolean)},!1),n!=null&&(me.isFunction(n)?i.paramsSerializer={serialize:n}:MD.assertOptions(n,{encode:Ho.function,serialize:Ho.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),MD.assertOptions(i,{baseUrl:Ho.spelling("baseURL"),withXsrfToken:Ho.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let s=a&&me.merge(a.common,a[i.method]);a&&me.forEach(["delete","get","head","post","put","patch","common"],h=>{delete a[h]}),i.headers=Gs.concat(s,a);const o=[];let l=!0;this.interceptors.request.forEach(function(m){if(typeof m.runWhen=="function"&&m.runWhen(i)===!1)return;l=l&&m.synchronous;const g=i.transitional||IB;g&&g.legacyInterceptorReqResOrdering?o.unshift(m.fulfilled,m.rejected):o.push(m.fulfilled,m.rejected)});const u=[];this.interceptors.response.forEach(function(m){u.push(m.fulfilled,m.rejected)});let c,d=0,p;if(!l){const h=[Iq.bind(this),void 0];for(h.unshift(...o),h.push(...u),p=h.length,c=Promise.resolve(i);d<p;)c=c.then(h[d++],h[d++]);return c}p=o.length;let f=i;for(;d<p;){const h=o[d++],m=o[d++];try{f=h(f)}catch(g){m.call(this,g);break}}try{c=Iq.call(this,f)}catch(h){return Promise.reject(h)}for(d=0,p=u.length;d<p;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=Wh(this.defaults,e);const i=Fte(e.baseURL,e.url,e.allowAbsoluteUrls);return Ate(i,e.params,e.paramsSerializer)}};me.forEach(["delete","get","head","options"],function(e){vh.prototype[e]=function(i,r){return this.request(Wh(r||{},{method:e,url:i,data:(r||{}).data}))}});me.forEach(["post","put","patch"],function(e){function i(r){return function(a,s,o){return this.request(Wh(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:s}))}}vh.prototype[e]=i(),vh.prototype[e+"Form"]=i(!0)});let r1e=class Vte{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const r=this;this.promise.then(n=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](n);r._listeners=null}),this.promise.then=n=>{let a;const s=new Promise(o=>{r.subscribe(o),a=o}).then(n);return s.cancel=function(){r.unsubscribe(a)},s},e(function(a,s,o){r.reason||(r.reason=new cU(a,s,o),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=r=>{e.abort(r)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new Vte(function(n){e=n}),cancel:e}}};function n1e(t){return function(i){return t.apply(null,i)}}function a1e(t){return me.isObject(t)&&t.isAxiosError===!0}const Cx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Cx).forEach(([t,e])=>{Cx[e]=t});function jte(t){const e=new vh(t),i=wte(vh.prototype.request,e);return me.extend(i,vh.prototype,e,{allOwnKeys:!0}),me.extend(i,e,null,{allOwnKeys:!0}),i.create=function(n){return jte(Wh(t,n))},i}const Sn=jte(uU);Sn.Axios=vh;Sn.CanceledError=cU;Sn.CancelToken=r1e;Sn.isCancel=Ote;Sn.VERSION=Bte;Sn.toFormData=EM;Sn.AxiosError=At;Sn.Cancel=Sn.CanceledError;Sn.all=function(e){return Promise.all(e)};Sn.spread=n1e;Sn.isAxiosError=a1e;Sn.mergeConfig=Wh;Sn.AxiosHeaders=Gs;Sn.formToJSON=t=>kte(me.isHTMLForm(t)?new FormData(t):t);Sn.getAdapter=$te.getAdapter;Sn.HttpStatusCode=Cx;Sn.default=Sn;const{Axios:Mtt,AxiosError:Ntt,CanceledError:Att,isCancel:ktt,CancelToken:Ott,VERSION:xtt,all:Ftt,Cancel:Ltt,isAxiosError:_tt,spread:$tt,toFormData:Btt,AxiosHeaders:Vtt,HttpStatusCode:jtt,formToJSON:Gtt,getAdapter:Htt,mergeConfig:Wtt}=Sn,Gte=Exe(),s1e=globalThis.location.host.includes("localhost")||globalThis.location.hostname==="127.0.0.1",o1e=window.dev?.baseURL||(s1e?"http://localhost:8383":"https://courthive.net"),dU=Sn.create({baseURL:o1e});dU.interceptors.request.use(t=>{const e=localStorage.getItem(Gte);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));dU.interceptors.response.use(t=>t,t=>{if(t.message==="Network Error"&&console.log("network error"),t.response){t.response?.status===401&&Hte();const e=t.response.data.message||t.response.data.error||t.response.data;console.log({message:e})}});const l1e=()=>{const t=localStorage.getItem(Gte);dU.defaults.headers.common.Authorization=`Bearer ${t}`},Hte=()=>{dU.defaults.headers.common.Authorization=void 0},Fm={...dU,addAuthorization:l1e,removeAuthorization:Hte},CM="Missing tournamentId";async function Wte(t){if(!t?.tournamentId)throw new Error(CM);return await Fm.post("/factory/tournamentinfo",t)}async function Mx({providerAbbr:t}){if(!t)throw new Error("missing provicerAbbr");return await Fm.post("/provider/calendar",{providerAbbr:t})}async function zte(t){if(!t?.tournamentId)throw new Error(CM);if(!t?.eventId)throw new Error("missing eventId");return await Fm.post("/factory/eventdata",t)}async function u1e(t){if(!t?.tournamentId)throw new Error(CM);return Object.assign(t,{courtCompletedMatchUps:!0,withCourtGridRows:!0,usePublishState:!0,minCourtGridRows:10,nextMatchUps:!0}),await Fm.post("/factory/scheduledmatchUps",{params:t})}async function c1e(t){if(!t?.tournamentId)throw new Error(CM);return await Fm.post("/factory/participants",{params:t})}async function d1e(){return await Fm.get("/factory/version")}const p1e=t=>{let e;const i=Array.isArray(t)?t:[t];return r=>{if(e&&i.forEach(n=>n.removeFilter(e)),r){const n=r?.toLowerCase();e=a=>a.searchText?.includes(n),i.forEach(a=>a.addFilter(e))}else e=void 0}},qte=t=>(e,i)=>{const r=e.getDefinition();return t.includes(r.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"};function f1e(t,e,i,r){const n=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${n})</span>`}function h1e(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}function bB(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var yq={exports:{}},bq;function m1e(){return bq||(bq=1,(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var a="",s=0;s<arguments.length;s++){var o=arguments[s];o&&(a=n(a,r(o)))}return a}function r(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return i.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var s="";for(var o in a)e.call(a,o)&&a[o]&&(s=n(s,o));return s}function n(a,s){return s?a?a+" "+s:a+s:a}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(yq)),yq.exports}var g1e=m1e();const gn=bB(g1e);function I1e({variant:t}){return gn("chc-placeholder",t==="showAddress"&&"chc-placeholder--show-address")}const v1e=t=>"chc-participant",y1e=t=>gn("chc-participant-name",t?.variant&&`chc-participant-name--${t.variant}`),b1e=t=>gn("chc-participant-type",t?.variant&&`chc-participant-type--${t.variant}`);function w1e({drawPosition:t,sideNumber:e}){const i=gn("chc-participant-container",e===1&&"chc-participant-container--side1");return t?`${i} chc-has-draw-position`:i}function S1e({winnerChevron:t,isDoubles:e}){return t?e?"chc-chevron-doubles--winner":"chc-chevron--winner":""}const wB=()=>"chc-participant-detail";function U1e({individualParticipant:t,className:e}){const{city:i,state:r,countryCode:n}=t?.person?.addresses?.[0]||{},a=[i,r,n].filter(Boolean).join(", ")||" ",s=document.createElement("div");return s.className=gn(wB(),e),s.innerHTML=a,s}function ia(t){return typeof t=="function"}function T1e(t){return typeof t=="string"}function D1e({element:t,attr:e}){if(!T1e(e))return;const i=e.split(".");for(const r of i)if(t=t?.[r],!t)return;return t}function P1e({individualParticipant:t,attribute:e,className:i}){const r=t?.person,n=D1e({element:r,attr:e});if(!n)return"";const a=document.createElement("div");return a.className=gn(wB(),i),a.innerHTML=n,a}function E1e({individualParticipant:t,className:e}){const i=t?.teams?.[0],r=i?.participantName||" ",n=document.createElement("div");return n.className=gn(wB(),e),n.classList.add("tmx-tm"),n.setAttribute("id",i?.participantId||""),n.innerHTML=r,n}function R1e(t){const e=t?.composition?.configuration?.participantDetail;if(e==="TEAM")return E1e(t);if(t?.composition?.configuration?.showAddress??e==="ADDRESS")return U1e(t);if(e){const i=P1e({...t,attribute:e});if(i&&typeof i!="string")return i}return document.createElement("div")}function vo(t){return typeof t=="function"}var wq={exports:{}},Sq;function C1e(){return Sq||(Sq=1,(function(t){(function(){var e=function(l,u){var c=this;e.count=(e.count||0)+1,this.count=e.count,this.isOpened=!1,this.input=a(l),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-controls","awesomplete_list_"+this.count),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=u=u||{},r(this,{minChars:2,maxItems:10,autoFirst:!1,data:e.DATA,filter:e.FILTER_CONTAINS,sort:u.sort===!1?!1:e.SORT_BYLENGTH,container:e.CONTAINER,item:e.ITEM,replace:e.REPLACE,tabSelect:!1,listLabel:"Results List",statusNoResults:"No results found",statusXResults:"{0} results found",statusTypeXChar:"Type {0} or more characters for results"},u),this.index=-1,this.container=this.container(l),this.ul=a.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container,"aria-label":this.listLabel}),this.status=a.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:""}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(d){var p=d.keyCode;c.opened&&(p===13&&c.selected||p===9&&c.selected&&c.tabSelect?(d.preventDefault(),c.select(void 0,void 0,d)):p===27?c.close({reason:"esc"}):(p===38||p===40)&&(d.preventDefault(),c[p===38?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(d){d.preventDefault()},click:function(d){var p=d.target;if(p!==this){for(;p&&!/li/i.test(p.nodeName);)p=p.parentNode;p&&d.button===0&&(d.preventDefault(),c.select(p,d.target,d))}}}},a.bind(this.input,this._events.input),a.bind(this.input.form,this._events.form),a.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||u.list||[],e.all.push(this)};e.prototype={set list(l){if(Array.isArray(l))this._list=l;else if(typeof l=="string"&&l.indexOf(",")>-1)this._list=l.split(/\s*,\s*/);else if(l=a(l),l&&l.children){var u=[];n.apply(l.children).forEach(function(c){if(!c.disabled){var d=c.textContent.trim(),p=c.value||d,f=c.label||d;p!==""&&u.push({label:f,value:p})}}),this._list=u}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(l){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),this.input.setAttribute("aria-activedescendant",""),a.fire(this.input,"awesomplete-close",l||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&this.index===-1&&this.goto(0),a.fire(this.input,"awesomplete-open")},destroy:function(){if(a.unbind(this.input,this._events.input),a.unbind(this.input.form,this._events.form),!this.options.container){var l=this.container.parentNode;l.insertBefore(this.input,this.container),l.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete"),this.input.removeAttribute("aria-expanded"),this.input.removeAttribute("aria-controls"),this.input.removeAttribute("aria-owns"),this.input.removeAttribute("role");var u=e.all.indexOf(this);u!==-1&&e.all.splice(u,1)},next:function(){var l=this.ul.children.length;this.goto(this.index<l-1?this.index+1:l?0:-1)},previous:function(){var l=this.ul.children.length,u=this.index-1;this.goto(this.selected&&u!==-1?u:l-1)},goto:function(l){var u=this.ul.children;this.selected&&u[this.index].setAttribute("aria-selected","false"),this.index=l,l>-1&&u.length>0&&(u[l].setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=u[l].offsetTop-this.ul.clientHeight+u[l].clientHeight,a.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(l,u,c){if(l?this.index=a.siblingIndex(l):l=this.ul.children[this.index],l){var d=this.suggestions[this.index],p=a.fire(this.input,"awesomplete-select",{text:d,origin:u||l,originalEvent:c});p&&(this.replace(d),this.close({reason:"select"}),a.fire(this.input,"awesomplete-selectcomplete",{text:d,originalEvent:c}))}},evaluate:function(){var l=this,u=this.input.value;u.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(c){return new i(l.data(c,u))}).filter(function(c){return l.filter(c,u)}),this.sort!==!1&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach(function(c,d){l.ul.appendChild(l.item(c,u,d))}),this.ul.children.length===0?(this.status.textContent=this.statusNoResults,this.close({reason:"nomatches"})):(this.input.setAttribute("aria-activedescendant",""),this.open(),this.status.textContent=this.statusXResults.replaceAll("{0}",this.ul.children.length))):(this.close({reason:"nomatches"}),this.minChar<=1||u.length>=this.minChars?this.status.textContent=this.statusNoResults:this.status.textContent=this.statusTypeXChar.replaceAll("{0}",this.minChars))}},e.all=[],e.FILTER_CONTAINS=function(l,u){return RegExp(a.regExpEscape(u.trim()),"i").test(l)},e.FILTER_STARTSWITH=function(l,u){return RegExp("^"+a.regExpEscape(u.trim()),"i").test(l)},e.SORT_BYLENGTH=function(l,u){return l.length!==u.length?l.length-u.length:l<u?-1:1},e.CONTAINER=function(l){return a.create("div",{className:"awesomplete",around:l})},e.ITEM=function(l,u,c){var d=u.trim()===""?l:l.replace(RegExp(a.regExpEscape(u.trim()),"gi"),"<mark>$&</mark>");return a.create("li",{innerHTML:d,role:"option","aria-selected":"false",tabindex:"-1",id:"awesomplete_list_"+this.count+"_item_"+c})},e.REPLACE=function(l){this.input.value=l.value},e.DATA=function(l){return l};function i(l){var u=Array.isArray(l)?{label:l[0],value:l[1]}:typeof l=="object"&&"label"in l&&"value"in l?l:{label:l,value:l};this.label=u.label||u.value,this.value=u.value}Object.defineProperty(i.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),i.prototype.toString=i.prototype.valueOf=function(){return""+this.label};function r(l,u,c){for(var d in u){var p=u[d],f=l.input.getAttribute("data-"+d.toLowerCase());typeof p=="number"?l[d]=parseInt(f):p===!1?l[d]=f!==null:p instanceof Function?l[d]=null:l[d]=f,!l[d]&&l[d]!==0&&(l[d]=d in c?c[d]:p)}}var n=Array.prototype.slice;function a(l,u){return typeof l=="string"?(u||document).querySelector(l):l||null}function s(l,u){return n.call((u||document).querySelectorAll(l))}a.create=function(l,u){var c=document.createElement(l);for(var d in u){var p=u[d];if(d==="inside")a(p).appendChild(c);else if(d==="around"){var f=a(p);f.parentNode.insertBefore(c,f),c.appendChild(f),f.getAttribute("autofocus")!=null&&f.focus()}else d in c?c[d]=p:c.setAttribute(d,p)}return c},a.bind=function(l,u){if(l)for(var c in u){var d=u[c];c.split(/\s+/).forEach(function(p){l.addEventListener(p,d)})}},a.unbind=function(l,u){if(l)for(var c in u){var d=u[c];c.split(/\s+/).forEach(function(p){l.removeEventListener(p,d)})}},a.fire=function(l,u,c){var d=document.createEvent("HTMLEvents");d.initEvent(u,!0,!0);for(var p in c)d[p]=c[p];return l.dispatchEvent(d)},a.regExpEscape=function(l){return l.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},a.siblingIndex=function(l){for(var u=0;l=l.previousElementSibling;u++);return u};function o(){s("input.awesomplete").forEach(function(l){new e(l)})}return typeof self<"u"&&(self.Awesomplete=e),typeof Document<"u"&&(document.readyState!=="loading"?o():document.addEventListener("DOMContentLoaded",o)),e.$=a,e.$$=s,t.exports&&(t.exports=e),e})()})(wq)),wq.exports}var M1e=C1e();const N1e=bB(M1e);function A1e({list:t,element:e,callback:i,currentValue:r,withCatchTab:n,onChange:a,onSelectComplete:s,listProvider:o}){const l=new N1e(e,{list:t});e.parentElement&&(e.parentElement.style.width="100%"),vo(o)&&e.addEventListener("focus",()=>{const d=o();l.list=d});let u=!1;const c=d=>{u=!0,vo(i)&&i(d.text.value),e.value=d.text.label,l.suggestions=[],vo(s)&&setTimeout(()=>s(),0)};if(n){const d=p=>p.key==="Tab"&&p.preventDefault();e.addEventListener("keydown",d,!1),e.addEventListener("keyup",d,!1)}if(typeof a=="function"&&e.addEventListener("change",a),e.setAttribute("autocomplete","off"),e.addEventListener("awesomplete-selectcomplete",d=>c(d),!1),e.addEventListener("keyup",function(d){const p=d.key==="Tab"&&d.shiftKey;if((d.key==="Enter"||d.key==="Tab"&&!p)&&!u){const f=e.value.trim()==="";if(d.key==="Enter"&&f){vo(i)&&i(""),e.value="",l.suggestions=[],vo(s)&&setTimeout(()=>s(),0);return}l.suggestions?.length&&!f&&(l.next(),l.select(0))}u=!1}),r){const d=t.find(p=>p.value===r)?.label;d&&(e.value=d)}return{typeAhead:l}}function SB(t){return t[t.length-1]}function pU(t,...e){return e.forEach(i=>{t.includes(i)||t.push(i)}),t}function Uq(t,e){return t?t.split(e):[]}function UB(t,e,i){const r=e===void 0||t>=e,n=i===void 0||t<=i;return r&&n}function Yte(t,e,i){return t<e?e:t>i?i:t}function TI(t,e,i={},r=0,n=""){const a=Object.keys(i).reduce((o,l)=>{let u=i[l];return typeof u=="function"&&(u=u(r)),`${o} ${l}="${u}"`},t);n+=`<${a}></${t}>`;const s=r+1;return s<e?TI(t,e,i,s,n):n}function TB(t){return t.replace(/>\s+/g,">").replace(/\s+</,"<")}function Nx(t){return new Date(t).setHours(0,0,0,0)}function Lm(){return new Date().setHours(0,0,0,0)}function DI(...t){switch(t.length){case 0:return Lm();case 1:return Nx(t[0])}const e=new Date(0);return e.setFullYear(...t),e.setHours(0,0,0,0)}function ew(t,e){const i=new Date(t);return i.setDate(i.getDate()+e)}function k1e(t,e){return ew(t,e*7)}function XP(t,e){const i=new Date(t),r=i.getMonth()+e;let n=r%12;n<0&&(n+=12);const a=i.setMonth(r);return i.getMonth()!==n?i.setDate(0):a}function tw(t,e){const i=new Date(t),r=i.getMonth(),n=i.setFullYear(i.getFullYear()+e);return r===1&&i.getMonth()===2?i.setDate(0):n}function Tq(t,e){return(t-e+7)%7}function yh(t,e,i=0){const r=new Date(t).getDay();return ew(t,Tq(e,i)-Tq(r,i))}function Kte(t,e){return Math.round((t-e)/6048e5)+1}function O1e(t){const e=yh(t,4,1),i=yh(new Date(e).setMonth(0,4),4,1);return Kte(e,i)}function Xte(t,e){const i=yh(new Date(t).setMonth(0,1),e,e),r=yh(t,e,e),n=Kte(r,i);if(n<53)return n;const a=yh(new Date(t).setDate(32),e,e);return r===a?1:n}function x1e(t){return Xte(t,0)}function F1e(t){return Xte(t,6)}function vg(t,e){const i=new Date(t).getFullYear();return Math.floor(i/e)*e}function Up(t,e,i){if(e!==1&&e!==2)return t;const r=new Date(t);return e===1?i?r.setMonth(r.getMonth()+1,0):r.setDate(1):i?r.setFullYear(r.getFullYear()+1,0,0):r.setMonth(0,1),r.setHours(0,0,0,0)}const Ax=/dd?|DD?|mm?|MM?|yy?(?:yy)?/,L1e=/[\s!-/:-@[-`{-~å¹´æœˆæ—¥]+/;let Pk={};const Dq={y(t,e){return new Date(t).setFullYear(parseInt(e,10))},m(t,e,i){const r=new Date(t);let n=parseInt(e,10)-1;if(isNaN(n)){if(!e)return NaN;const a=e.toLowerCase(),s=o=>o.toLowerCase().startsWith(a);if(n=i.monthsShort.findIndex(s),n<0&&(n=i.months.findIndex(s)),n<0)return NaN}return r.setMonth(n),r.getMonth()!==Jte(n)?r.setDate(0):r.getTime()},d(t,e){return new Date(t).setDate(parseInt(e,10))}},_1e={d(t){return t.getDate()},dd(t){return zT(t.getDate(),2)},D(t,e){return e.daysShort[t.getDay()]},DD(t,e){return e.days[t.getDay()]},m(t){return t.getMonth()+1},mm(t){return zT(t.getMonth()+1,2)},M(t,e){return e.monthsShort[t.getMonth()]},MM(t,e){return e.months[t.getMonth()]},y(t){return t.getFullYear()},yy(t){return zT(t.getFullYear(),2).slice(-2)},yyyy(t){return zT(t.getFullYear(),4)}};function Jte(t){return t>-1?t%12:Jte(t+12)}function zT(t,e){return t.toString().padStart(e,"0")}function Qte(t){if(typeof t!="string")throw new Error("Invalid date format.");if(t in Pk)return Pk[t];const e=t.split(Ax),i=t.match(new RegExp(Ax,"g"));if(e.length===0||!i)throw new Error("Invalid date format.");const r=i.map(a=>_1e[a]),n=Object.keys(Dq).reduce((a,s)=>(i.find(o=>o[0]!=="D"&&o[0].toLowerCase()===s)&&a.push(s),a),[]);return Pk[t]={parser(a,s){const o=a.split(L1e).reduce((l,u,c)=>{if(u.length>0&&i[c]){const d=i[c][0];d==="M"?l.m=u:d!=="D"&&(l[d]=u)}return l},{});return n.reduce((l,u)=>{const c=Dq[u](l,o[u],s);return isNaN(c)?l:c},Lm())},formatter(a,s){let o=r.reduce((l,u,c)=>l+=`${e[c]}${u(a,s)}`,"");return o+=SB(e)}}}function zh(t,e,i){if(t instanceof Date||typeof t=="number"){const r=Nx(t);return isNaN(r)?void 0:r}if(t){if(t==="today")return Lm();if(e&&e.toValue){const r=e.toValue(t,e,i);return isNaN(r)?void 0:Nx(r)}return Qte(e).parser(t,i)}}function MM(t,e,i){if(isNaN(t)||!t&&t!==0)return"";const r=typeof t=="number"?new Date(t):t;return e.toDisplay?e.toDisplay(r,e,i):Qte(e).formatter(r,i)}const $1e=document.createRange();function Ed(t){return $1e.createContextualFragment(t)}function Zte(t){return t.parentElement||(t.parentNode instanceof ShadowRoot?t.parentNode.host:void 0)}function NM(t){return t.getRootNode().activeElement===t}function ob(t){t.style.display!=="none"&&(t.style.display&&(t.dataset.styleDisplay=t.style.display),t.style.display="none")}function lb(t){t.style.display==="none"&&(t.dataset.styleDisplay?(t.style.display=t.dataset.styleDisplay,delete t.dataset.styleDisplay):t.style.display="")}function JP(t){t.firstChild&&(t.removeChild(t.firstChild),JP(t))}function B1e(t,e){JP(t),e instanceof DocumentFragment?t.appendChild(e):typeof e=="string"?t.appendChild(Ed(e)):typeof e.forEach=="function"&&e.forEach(i=>{t.appendChild(i)})}const QP=new WeakMap,{addEventListener:V1e,removeEventListener:j1e}=EventTarget.prototype;function kx(t,e){let i=QP.get(t);i||(i=[],QP.set(t,i)),e.forEach(r=>{V1e.call(...r),i.push(r)})}function G1e(t){let e=QP.get(t);e&&(e.forEach(i=>{j1e.call(...i)}),QP.delete(t))}if(!Event.prototype.composedPath){const t=(e,i=[])=>{i.push(e);let r;return e.parentNode?r=e.parentNode:e.host?r=e.host:e.defaultView&&(r=e.defaultView),r?t(r,i):i};Event.prototype.composedPath=function(){return t(this.target)}}function eie(t,e,i){const[r,...n]=t;if(e(r))return r;if(!(r===i||r.tagName==="HTML"||n.length===0))return eie(n,e,i)}function tie(t,e){const i=typeof e=="function"?e:r=>r instanceof Element&&r.matches(e);return eie(t.composedPath(),i,t.currentTarget)}const Ey={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM y"}},DB={autohide:!1,beforeShowDay:null,beforeShowDecade:null,beforeShowMonth:null,beforeShowYear:null,clearButton:!1,dateDelimiter:",",datesDisabled:[],daysOfWeekDisabled:[],daysOfWeekHighlighted:[],defaultViewDate:void 0,disableTouchKeyboard:!1,enableOnReadonly:!0,format:"mm/dd/yyyy",language:"en",maxDate:null,maxNumberOfDates:1,maxView:3,minDate:null,nextArrow:"Â»",orientation:"auto",pickLevel:0,prevArrow:"Â«",showDaysOfWeek:!0,showOnClick:!0,showOnFocus:!0,startView:0,title:"",todayButton:!1,todayButtonMode:0,todayHighlight:!1,updateOnBlur:!0,weekNumbers:0,weekStart:0},{language:Ek,format:H1e,weekStart:W1e}=DB;function Pq(t,e){return t.length<6&&e>=0&&e<7?pU(t,e):t}function iie(t,e){switch(t===4?e===6?3:!e+1:t){case 1:return O1e;case 2:return x1e;case 3:return F1e}}function Eq(t,e,i){return e.weekStart=t,e.weekEnd=(t+6)%7,i===4&&(e.getWeekNumber=iie(4,t)),t}function Rq(t,e,i,r){const n=zh(t,e,i);return n!==void 0?n:r}function Rk(t,e,i=3){const r=parseInt(t,10);return r>=0&&r<=i?r:e}function qT(t,e,i,r=void 0){e in t&&(i in t||(t[i]=r?r(t[e]):t[e]),delete t[e])}function Ck(t,e){const i=Object.assign({},t),r={},n=e.constructor.locales,a=!!e.rangeSideIndex;let{datesDisabled:s,format:o,language:l,locale:u,maxDate:c,maxView:d,minDate:p,pickLevel:f,startView:h,weekNumbers:m,weekStart:g}=e.config||{};if(qT(i,"calendarWeeks","weekNumbers",S=>S?1:0),qT(i,"clearBtn","clearButton"),qT(i,"todayBtn","todayButton"),qT(i,"todayBtnMode","todayButtonMode"),i.language){let S;if(i.language!==l&&(n[i.language]?S=i.language:(S=i.language.split("-")[0],n[S]||(S=!1))),delete i.language,S){l=r.language=S;const U=u||n[Ek];u=Object.assign({format:H1e,weekStart:W1e},n[Ek]),l!==Ek&&Object.assign(u,n[l]),r.locale=u,o===U.format&&(o=r.format=u.format),g===U.weekStart&&(g=Eq(u.weekStart,r,m))}}if(i.format){const S=typeof i.format.toDisplay=="function",U=typeof i.format.toValue=="function",T=Ax.test(i.format);(S&&U||T)&&(o=r.format=i.format),delete i.format}let I=f;"pickLevel"in i&&(I=Rk(i.pickLevel,f,2),delete i.pickLevel),I!==f&&(I>f&&("minDate"in i||(i.minDate=p),"maxDate"in i||(i.maxDate=c)),s&&!i.datesDisabled&&(i.datesDisabled=[]),f=r.pickLevel=I);let v=p,w=c;if("minDate"in i){const S=DI(0,0,1);v=i.minDate===null?S:Rq(i.minDate,o,u,v),v!==S&&(v=Up(v,f,!1)),delete i.minDate}if("maxDate"in i&&(w=i.maxDate===null?void 0:Rq(i.maxDate,o,u,w),w!==void 0&&(w=Up(w,f,!0)),delete i.maxDate),w<v?(p=r.minDate=w,c=r.maxDate=v):(p!==v&&(p=r.minDate=v),c!==w&&(c=r.maxDate=w)),i.datesDisabled){const S=i.datesDisabled;if(typeof S=="function")r.datesDisabled=null,r.checkDisabled=(U,T)=>S(new Date(U),T,a);else{const U=r.datesDisabled=S.reduce((T,D)=>{const P=zh(D,o,u);return P!==void 0?pU(T,Up(P,f,a)):T},[]);r.checkDisabled=T=>U.includes(T)}delete i.datesDisabled}if("defaultViewDate"in i){const S=zh(i.defaultViewDate,o,u);S!==void 0&&(r.defaultViewDate=S),delete i.defaultViewDate}if("weekStart"in i){const S=Number(i.weekStart)%7;isNaN(S)||(g=Eq(S,r,m)),delete i.weekStart}if(i.daysOfWeekDisabled&&(r.daysOfWeekDisabled=i.daysOfWeekDisabled.reduce(Pq,[]),delete i.daysOfWeekDisabled),i.daysOfWeekHighlighted&&(r.daysOfWeekHighlighted=i.daysOfWeekHighlighted.reduce(Pq,[]),delete i.daysOfWeekHighlighted),"weekNumbers"in i){let S=i.weekNumbers;if(S){const U=typeof S=="function"?(T,D)=>S(new Date(T),D):iie(S=parseInt(S,10),g);U&&(m=r.weekNumbers=S,r.getWeekNumber=U)}else m=r.weekNumbers=0,r.getWeekNumber=null;delete i.weekNumbers}if("maxNumberOfDates"in i){const S=parseInt(i.maxNumberOfDates,10);S>=0&&(r.maxNumberOfDates=S,r.multidate=S!==1),delete i.maxNumberOfDates}i.dateDelimiter&&(r.dateDelimiter=String(i.dateDelimiter),delete i.dateDelimiter);let y=d;"maxView"in i&&(y=Rk(i.maxView,d),delete i.maxView),y=f>y?f:y,y!==d&&(d=r.maxView=y);let b=h;if("startView"in i&&(b=Rk(i.startView,b),delete i.startView),b<f?b=f:b>d&&(b=d),b!==h&&(r.startView=b),i.prevArrow){const S=Ed(i.prevArrow);S.childNodes.length>0&&(r.prevArrow=S.childNodes),delete i.prevArrow}if(i.nextArrow){const S=Ed(i.nextArrow);S.childNodes.length>0&&(r.nextArrow=S.childNodes),delete i.nextArrow}if("disableTouchKeyboard"in i&&(r.disableTouchKeyboard="ontouchstart"in document&&!!i.disableTouchKeyboard,delete i.disableTouchKeyboard),i.orientation){const S=i.orientation.toLowerCase().split(/\s+/g);r.orientation={x:S.find(U=>U==="left"||U==="right")||"auto",y:S.find(U=>U==="top"||U==="bottom")||"auto"},delete i.orientation}if("todayButtonMode"in i){switch(i.todayButtonMode){case 0:case 1:r.todayButtonMode=i.todayButtonMode}delete i.todayButtonMode}return Object.entries(i).forEach(([S,U])=>{U!==void 0&&S in DB&&(r[S]=U)}),r}const Cq={show:{key:"ArrowDown"},hide:null,toggle:{key:"Escape"},prevButton:{key:"ArrowLeft",ctrlOrMetaKey:!0},nextButton:{key:"ArrowRight",ctrlOrMetaKey:!0},viewSwitch:{key:"ArrowUp",ctrlOrMetaKey:!0},clearButton:{key:"Backspace",ctrlOrMetaKey:!0},todayButton:{key:".",ctrlOrMetaKey:!0},exitEditMode:{key:"ArrowDown",ctrlOrMetaKey:!0}};function z1e(t){return Object.keys(Cq).reduce((e,i)=>{const r=t[i]===void 0?Cq[i]:t[i],n=r&&r.key;if(!n||typeof n!="string")return e;const a={key:n,ctrlOrMetaKey:!!(r.ctrlOrMetaKey||r.ctrlKey||r.metaKey)};return n.length>1&&(a.altKey=!!r.altKey,a.shiftKey=!!r.shiftKey),e[i]=a,e},{})}const Mq=t=>t.map(e=>`<button type="button" class="%buttonClass% ${e}" tabindex="-1"></button>`).join(""),q1e=TB(`<div class="datepicker">
  <div class="datepicker-picker">
    <div class="datepicker-header">
      <div class="datepicker-title"></div>
      <div class="datepicker-controls">
        ${Mq(["prev-button prev-btn","view-switch","next-button next-btn"])}
      </div>
    </div>
    <div class="datepicker-main"></div>
    <div class="datepicker-footer">
      <div class="datepicker-controls">
        ${Mq(["today-button today-btn","clear-button clear-btn"])}
      </div>
    </div>
  </div>
</div>`),Y1e=TB(`<div class="days">
  <div class="days-of-week">${TI("span",7,{class:"dow"})}</div>
  <div class="datepicker-grid">${TI("span",42)}</div>
</div>`),K1e=TB(`<div class="week-numbers calendar-weeks">
  <div class="days-of-week"><span class="dow"></span></div>
  <div class="weeks">${TI("span",6,{class:"week"})}</div>
</div>`);class PB{constructor(e,i){Object.assign(this,i,{picker:e,element:Ed('<div class="datepicker-view"></div>').firstChild,selected:[],isRangeEnd:!!e.datepicker.rangeSideIndex}),this.init(this.picker.datepicker.config)}init(e){"pickLevel"in e&&(this.isMinView=this.id===e.pickLevel),this.setOptions(e),this.updateFocus(),this.updateSelection()}prepareForRender(e,i,r){this.disabled=[];const n=this.picker;n.setViewSwitchLabel(e),n.setPrevButtonDisabled(i),n.setNextButtonDisabled(r)}setDisabled(e,i){i.add("disabled"),pU(this.disabled,e)}performBeforeHook(e,i){let r=this.beforeShow(new Date(i));switch(typeof r){case"boolean":r={enabled:r};break;case"string":r={classes:r}}if(r){const n=e.classList;if(r.enabled===!1&&this.setDisabled(i,n),r.classes){const a=r.classes.split(/\s+/);n.add(...a),a.includes("disabled")&&this.setDisabled(i,n)}r.content&&B1e(e,r.content)}}renderCell(e,i,r,n,{selected:a,range:s},o,l=[]){e.textContent=i,this.isMinView&&(e.dataset.date=n);const u=e.classList;if(e.className=`datepicker-cell ${this.cellClass}`,r<this.first?u.add("prev"):r>this.last&&u.add("next"),u.add(...l),(o||this.checkDisabled(n,this.id))&&this.setDisabled(n,u),s){const[c,d]=s;r>c&&r<d&&u.add("range"),r===c&&u.add("range-start"),r===d&&u.add("range-end")}a.includes(r)&&u.add("selected"),r===this.focused&&u.add("focused"),this.beforeShow&&this.performBeforeHook(e,n)}refreshCell(e,i,r,[n,a]){const s=e.classList;s.remove("range","range-start","range-end","selected","focused"),i>n&&i<a&&s.add("range"),i===n&&s.add("range-start"),i===a&&s.add("range-end"),r.includes(i)&&s.add("selected"),i===this.focused&&s.add("focused")}changeFocusedCell(e){this.grid.querySelectorAll(".focused").forEach(i=>{i.classList.remove("focused")}),this.grid.children[e].classList.add("focused")}}class X1e extends PB{constructor(e){super(e,{id:0,name:"days",cellClass:"day"})}init(e,i=!0){if(i){const r=Ed(Y1e).firstChild;this.dow=r.firstChild,this.grid=r.lastChild,this.element.appendChild(r)}super.init(e)}setOptions(e){let i;if("minDate"in e&&(this.minDate=e.minDate),"maxDate"in e&&(this.maxDate=e.maxDate),e.checkDisabled&&(this.checkDisabled=e.checkDisabled),e.daysOfWeekDisabled&&(this.daysOfWeekDisabled=e.daysOfWeekDisabled,i=!0),e.daysOfWeekHighlighted&&(this.daysOfWeekHighlighted=e.daysOfWeekHighlighted),"todayHighlight"in e&&(this.todayHighlight=e.todayHighlight),"weekStart"in e&&(this.weekStart=e.weekStart,this.weekEnd=e.weekEnd,i=!0),e.locale){const r=this.locale=e.locale;this.dayNames=r.daysMin,this.switchLabelFormat=r.titleFormat,i=!0}if("beforeShowDay"in e&&(this.beforeShow=typeof e.beforeShowDay=="function"?e.beforeShowDay:void 0),"weekNumbers"in e)if(e.weekNumbers&&!this.weekNumbers){const r=Ed(K1e).firstChild;this.weekNumbers={element:r,dow:r.firstChild,weeks:r.lastChild},this.element.insertBefore(r,this.element.firstChild)}else this.weekNumbers&&!e.weekNumbers&&(this.element.removeChild(this.weekNumbers.element),this.weekNumbers=null);"getWeekNumber"in e&&(this.getWeekNumber=e.getWeekNumber),"showDaysOfWeek"in e&&(e.showDaysOfWeek?(lb(this.dow),this.weekNumbers&&lb(this.weekNumbers.dow)):(ob(this.dow),this.weekNumbers&&ob(this.weekNumbers.dow))),i&&Array.from(this.dow.children).forEach((r,n)=>{const a=(this.weekStart+n)%7;r.textContent=this.dayNames[a],r.className=this.daysOfWeekDisabled.includes(a)?"dow disabled":"dow"})}updateFocus(){const e=new Date(this.picker.viewDate),i=e.getFullYear(),r=e.getMonth(),n=DI(i,r,1),a=yh(n,this.weekStart,this.weekStart);this.first=n,this.last=DI(i,r+1,0),this.start=a,this.focused=this.picker.viewDate}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e,i&&(this.range=i.dates)}render(){if(this.today=this.todayHighlight?Lm():void 0,this.prepareForRender(MM(this.focused,this.switchLabelFormat,this.locale),this.first<=this.minDate,this.last>=this.maxDate),this.weekNumbers){const e=this.weekStart,i=yh(this.first,e,e);Array.from(this.weekNumbers.weeks.children).forEach((r,n)=>{const a=k1e(i,n);r.textContent=this.getWeekNumber(a,e),n>3&&r.classList[a>this.last?"add":"remove"]("next")})}Array.from(this.grid.children).forEach((e,i)=>{const r=ew(this.start,i),n=new Date(r),a=n.getDay(),s=[];this.today===r&&s.push("today"),this.daysOfWeekHighlighted.includes(a)&&s.push("highlighted"),this.renderCell(e,n.getDate(),r,r,this,r<this.minDate||r>this.maxDate||this.daysOfWeekDisabled.includes(a),s)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.dataset.date),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/864e5))}}function Nq(t,e){if(!t||!t[0]||!t[1])return;const[[i,r],[n,a]]=t;if(!(i>e||n<e))return[i===e?r:-1,n===e?a:12]}class J1e extends PB{constructor(e){super(e,{id:1,name:"months",cellClass:"month"})}init(e,i=!0){i&&(this.grid=this.element,this.element.classList.add("months","datepicker-grid"),this.grid.appendChild(Ed(TI("span",12,{"data-month":r=>r}))),this.first=0,this.last=11),super.init(e)}setOptions(e){if(e.locale&&(this.monthNames=e.locale.monthsShort),"minDate"in e)if(e.minDate===void 0)this.minYear=this.minMonth=this.minDate=void 0;else{const i=new Date(e.minDate);this.minYear=i.getFullYear(),this.minMonth=i.getMonth(),this.minDate=i.setDate(1)}if("maxDate"in e)if(e.maxDate===void 0)this.maxYear=this.maxMonth=this.maxDate=void 0;else{const i=new Date(e.maxDate);this.maxYear=i.getFullYear(),this.maxMonth=i.getMonth(),this.maxDate=DI(this.maxYear,this.maxMonth+1,0)}e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),"beforeShowMonth"in e&&(this.beforeShow=typeof e.beforeShowMonth=="function"?e.beforeShowMonth:void 0)}updateFocus(){const e=new Date(this.picker.viewDate);this.year=e.getFullYear(),this.focused=e.getMonth()}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((r,n)=>{const a=new Date(n),s=a.getFullYear(),o=a.getMonth();return r[s]===void 0?r[s]=[o]:pU(r[s],o),r},{}),i&&i.dates&&(this.range=i.dates.map(r=>{const n=new Date(r);return isNaN(n)?void 0:[n.getFullYear(),n.getMonth()]}))}render(){this.prepareForRender(this.year,this.year<=this.minYear,this.year>=this.maxYear);const e=this.selected[this.year]||[],i=this.year<this.minYear||this.year>this.maxYear,r=this.year===this.minYear,n=this.year===this.maxYear,a=Nq(this.range,this.year);Array.from(this.grid.children).forEach((s,o)=>{const l=Up(new Date(this.year,o,1),1,this.isRangeEnd);this.renderCell(s,this.monthNames[o],o,l,{selected:e,range:a},i||r&&o<this.minMonth||n&&o>this.maxMonth)})}refresh(){const e=this.selected[this.year]||[],i=Nq(this.range,this.year)||[];Array.from(this.grid.children).forEach((r,n)=>{this.refreshCell(r,n,e,i)})}refreshFocus(){this.changeFocusedCell(this.focused)}}function Q1e(t){return[...t].reduce((e,i,r)=>e+=r?i:i.toUpperCase(),"")}class Aq extends PB{constructor(e,i){super(e,i)}init(e,i=!0){i&&(this.navStep=this.step*10,this.beforeShowOption=`beforeShow${Q1e(this.cellClass)}`,this.grid=this.element,this.element.classList.add(this.name,"datepicker-grid"),this.grid.appendChild(Ed(TI("span",12)))),super.init(e)}setOptions(e){if("minDate"in e&&(e.minDate===void 0?this.minYear=this.minDate=void 0:(this.minYear=vg(e.minDate,this.step),this.minDate=DI(this.minYear,0,1))),"maxDate"in e&&(e.maxDate===void 0?this.maxYear=this.maxDate=void 0:(this.maxYear=vg(e.maxDate,this.step),this.maxDate=DI(this.maxYear,11,31))),e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),this.beforeShowOption in e){const i=e[this.beforeShowOption];this.beforeShow=typeof i=="function"?i:void 0}}updateFocus(){const e=new Date(this.picker.viewDate),i=vg(e,this.navStep),r=i+9*this.step;this.first=i,this.last=r,this.start=i-this.step,this.focused=vg(e,this.step)}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((r,n)=>pU(r,vg(n,this.step)),[]),i&&i.dates&&(this.range=i.dates.map(r=>{if(r!==void 0)return vg(r,this.step)}))}render(){this.prepareForRender(`${this.first}-${this.last}`,this.first<=this.minYear,this.last>=this.maxYear),Array.from(this.grid.children).forEach((e,i)=>{const r=this.start+i*this.step,n=Up(new Date(r,0,1),2,this.isRangeEnd);e.dataset.year=r,this.renderCell(e,r,r,n,this,r<this.minYear||r>this.maxYear)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.textContent),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/this.step))}}function Eg(t,e){const i={bubbles:!0,cancelable:!0,detail:{date:t.getDate(),viewDate:new Date(t.picker.viewDate),viewId:t.picker.currentView.id,datepicker:t}};t.element.dispatchEvent(new CustomEvent(e,i))}function ZP(t,e){const{config:i,picker:r}=t,{currentView:n,viewDate:a}=r;let s;switch(n.id){case 0:s=XP(a,e);break;case 1:s=tw(a,e);break;default:s=tw(a,e*n.navStep)}s=Yte(s,i.minDate,i.maxDate),r.changeFocus(s).render()}function rie(t){const e=t.picker.currentView.id;e!==t.config.maxView&&t.picker.changeView(e+1).render()}function nie(t){t.setDate({clear:!0})}function aie(t){const e=Lm();t.config.todayButtonMode===1?t.setDate(e,{forceRefresh:!0,viewDate:e}):t.setFocusedDate(e,!0)}function sie(t){const e=()=>{t.config.updateOnBlur?t.update({revert:!0}):t.refresh("input"),t.hide()},i=t.element;NM(i)?i.addEventListener("blur",e,{once:!0}):e()}function kq(t,e){const i=t.picker,r=new Date(i.viewDate),n=i.currentView.id,a=n===1?XP(r,e-r.getMonth()):tw(r,e-r.getFullYear());i.changeFocus(a).changeView(n-1).render()}function Z1e(t){rie(t)}function eLe(t){ZP(t,-1)}function tLe(t){ZP(t,1)}function iLe(t,e){const i=tie(e,".datepicker-cell");if(!i||i.classList.contains("disabled"))return;const{id:r,isMinView:n}=t.picker.currentView,a=i.dataset;n?t.setDate(Number(a.date)):r===1?kq(t,Number(a.month)):kq(t,Number(a.year))}function rLe(t){t.preventDefault()}const Mk=["left","top","right","bottom"].reduce((t,e)=>(t[e]=`datepicker-orient-${e}`,t),{}),Oq=t=>t&&`${t}px`;function xq(t,e){if("title"in e&&(e.title?(t.controls.title.textContent=e.title,lb(t.controls.title)):(t.controls.title.textContent="",ob(t.controls.title))),e.prevArrow){const i=t.controls.prevButton;JP(i),e.prevArrow.forEach(r=>{i.appendChild(r.cloneNode(!0))})}if(e.nextArrow){const i=t.controls.nextButton;JP(i),e.nextArrow.forEach(r=>{i.appendChild(r.cloneNode(!0))})}if(e.locale&&(t.controls.todayButton.textContent=e.locale.today,t.controls.clearButton.textContent=e.locale.clear),"todayButton"in e&&(e.todayButton?lb(t.controls.todayButton):ob(t.controls.todayButton)),"minDate"in e||"maxDate"in e){const{minDate:i,maxDate:r}=t.datepicker.config;t.controls.todayButton.disabled=!UB(Lm(),i,r)}"clearButton"in e&&(e.clearButton?lb(t.controls.clearButton):ob(t.controls.clearButton))}function Fq(t){const{dates:e,config:i,rangeSideIndex:r}=t,n=e.length>0?SB(e):Up(i.defaultViewDate,i.pickLevel,r);return Yte(n,i.minDate,i.maxDate)}function Lq(t,e){!("_oldViewDate"in t)&&e!==t.viewDate&&(t._oldViewDate=t.viewDate),t.viewDate=e;const{id:i,year:r,first:n,last:a}=t.currentView,s=new Date(e).getFullYear();switch(i){case 0:return e<n||e>a;case 1:return s!==r;default:return s<n||s>a}}function Nk(t){return window.getComputedStyle(t).direction}function oie(t){const e=Zte(t);if(!(e===document.body||!e))return window.getComputedStyle(e).overflow!=="visible"?e:oie(e)}class nLe{constructor(e){const{config:i,inputField:r}=this.datepicker=e,n=q1e.replace(/%buttonClass%/g,i.buttonClass),a=this.element=Ed(n).firstChild,[s,o,l]=a.firstChild.children,u=s.firstElementChild,[c,d,p]=s.lastElementChild.children,[f,h]=l.firstChild.children,m={title:u,prevButton:c,viewSwitch:d,nextButton:p,todayButton:f,clearButton:h};this.main=o,this.controls=m;const g=r?"dropdown":"inline";a.classList.add(`datepicker-${g}`),xq(this,i),this.viewDate=Fq(e),kx(e,[[a,"mousedown",rLe],[o,"click",iLe.bind(null,e)],[m.viewSwitch,"click",Z1e.bind(null,e)],[m.prevButton,"click",eLe.bind(null,e)],[m.nextButton,"click",tLe.bind(null,e)],[m.todayButton,"click",aie.bind(null,e)],[m.clearButton,"click",nie.bind(null,e)]]),this.views=[new X1e(this),new J1e(this),new Aq(this,{id:2,name:"years",cellClass:"year",step:1}),new Aq(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[i.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),i.container?i.container.appendChild(this.element):r.after(this.element)}setOptions(e){xq(this,e),this.views.forEach(i=>{i.init(e,!1)}),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:i}=this,r=e.inputField;if(r){const n=Nk(r);n!==Nk(Zte(i))?i.dir=n:i.dir&&i.removeAttribute("dir"),this.place(),i.classList.add("active"),e.config.disableTouchKeyboard&&r.blur()}else i.classList.add("active");this.active=!0,Eg(e,"show")}hide(){this.active&&(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,Eg(this.datepicker,"hide"))}place(){const{classList:e,style:i}=this.element;i.display="block";const{width:r,height:n}=this.element.getBoundingClientRect(),a=this.element.offsetParent;i.display="";const{config:s,inputField:o}=this.datepicker,{left:l,top:u,right:c,bottom:d,width:p,height:f}=o.getBoundingClientRect();let{x:h,y:m}=s.orientation,g=l,I=u;if(a===document.body||!a)g+=window.scrollX,I+=window.scrollY;else{const T=a.getBoundingClientRect();g-=T.left-a.scrollLeft,I-=T.top-a.scrollTop}const v=oie(o);let w=0,y=0,{clientWidth:b,clientHeight:S}=document.documentElement;if(v){const T=v.getBoundingClientRect();T.top>0&&(y=T.top),T.left>0&&(w=T.left),T.right<b&&(b=T.right),T.bottom<S&&(S=T.bottom)}let U=0;h==="auto"&&(l<w?(h="left",U=w-l):l+r>b?(h="right",b<c&&(U=b-c)):Nk(o)==="rtl"?h=c-r<w?"left":"right":h="left"),h==="right"&&(g+=p-r),g+=U,m==="auto"&&(u-n>y?m=d+n>S?"top":"bottom":m="bottom"),m==="top"?I-=n:I+=f,e.remove(...Object.values(Mk)),e.add(Mk[h],Mk[m]),i.left=Oq(g),i.top=Oq(I)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevButtonDisabled(e){this.controls.prevButton.disabled=e}setNextButtonDisabled(e){this.controls.nextButton.disabled=e}changeView(e){const i=this.currentView;return e!==i.id&&(this._oldView||(this._oldView=i),this.currentView=this.views[e],this._renderMethod="render"),this}changeFocus(e){return this._renderMethod=Lq(this,e)?"render":"refreshFocus",this.views.forEach(i=>{i.updateFocus()}),this}update(e=void 0){const i=e===void 0?Fq(this.datepicker):e;return this._renderMethod=Lq(this,i)?"render":"refresh",this.views.forEach(r=>{r.updateFocus(),r.updateSelection()}),this}render(e=!0){const{currentView:i,datepicker:r,_oldView:n}=this,a=new Date(this._oldViewDate),s=e&&this._renderMethod||"render";if(delete this._oldView,delete this._oldViewDate,delete this._renderMethod,i[s](),n&&(this.main.replaceChild(i.element,n.element),Eg(r,"changeView")),!isNaN(a)){const o=new Date(this.viewDate);o.getFullYear()!==a.getFullYear()&&Eg(r,"changeYear"),o.getMonth()!==a.getMonth()&&Eg(r,"changeMonth")}}}function lie(t,e,i,r,n,a){if(UB(t,n,a)){if(r(t)){const s=e(t,i);return lie(s,e,i,r,n,a)}return t}}function aLe(t,e,i){const r=t.picker,n=r.currentView,a=n.step||1;let s=r.viewDate,o;switch(n.id){case 0:s=ew(s,i?e*7:e),o=ew;break;case 1:s=XP(s,i?e*4:e),o=XP;break;default:s=tw(s,e*(i?4:1)*a),o=tw}s=lie(s,o,e<0?-a:a,l=>n.disabled.includes(l),n.minDate,n.maxDate),s!==void 0&&r.changeFocus(s).render()}function sLe(t,e){const{config:i,picker:r,editMode:n}=t,a=r.active,{key:s,altKey:o,shiftKey:l}=e,u=e.ctrlKey||e.metaKey,c=()=>{e.preventDefault(),e.stopPropagation()};if(s==="Tab"){sie(t);return}if(s==="Enter"){if(!a)t.update();else if(n)t.exitEditMode({update:!0,autohide:i.autohide});else{const m=r.currentView;m.isMinView?t.setDate(r.viewDate):(r.changeView(m.id-1).render(),c())}return}const d=i.shortcutKeys,p={key:s,ctrlOrMetaKey:u,altKey:o,shiftKey:l},f=Object.keys(d).find(m=>{const g=d[m];return!Object.keys(g).find(I=>g[I]!==p[I])});if(f){let m;if(f==="toggle"?m=f:n?f==="exitEditMode"&&(m=f):a?f==="hide"?m=f:f==="prevButton"?m=[ZP,[t,-1]]:f==="nextButton"?m=[ZP,[t,1]]:f==="viewSwitch"?m=[rie,[t]]:i.clearButton&&f==="clearButton"?m=[nie,[t]]:i.todayButton&&f==="todayButton"&&(m=[aie,[t]]):f==="show"&&(m=f),m){Array.isArray(m)?m[0].apply(null,m[1]):t[m](),c();return}}if(!a||n)return;const h=(m,g)=>{l||u||o?t.enterEditMode():(aLe(t,m,g),e.preventDefault())};s==="ArrowLeft"?h(-1,!1):s==="ArrowRight"?h(1,!1):s==="ArrowUp"?h(-1,!0):s==="ArrowDown"?h(1,!0):(s==="Backspace"||s==="Delete"||s&&s.length===1&&!u)&&t.enterEditMode()}function oLe(t){t.config.showOnFocus&&!t._showing&&t.show()}function lLe(t,e){const i=e.target;(t.picker.active||t.config.showOnClick)&&(i._active=NM(i),i._clicking=setTimeout(()=>{delete i._active,delete i._clicking},2e3))}function uLe(t,e){const i=e.target;i._clicking&&(clearTimeout(i._clicking),delete i._clicking,i._active&&t.enterEditMode(),delete i._active,t.config.showOnClick&&t.show())}function cLe(t,e){e.clipboardData.types.includes("text/plain")&&t.enterEditMode()}function dLe(t,e){const{element:i,picker:r}=t;if(!r.active&&!NM(i))return;const n=r.element;tie(e,a=>a===i||a===n)||sie(t)}function uie(t,e){return t.map(i=>MM(i,e.format,e.locale)).join(e.dateDelimiter)}function cie(t,e,i=!1){if(e.length===0)return i?[]:void 0;const{config:r,dates:n,rangeSideIndex:a}=t,{pickLevel:s,maxNumberOfDates:o}=r;let l=e.reduce((u,c)=>{let d=zh(c,r.format,r.locale);return d===void 0||(d=Up(d,s,a),UB(d,r.minDate,r.maxDate)&&!u.includes(d)&&!r.checkDisabled(d,s)&&(s>0||!r.daysOfWeekDisabled.includes(new Date(d).getDay()))&&u.push(d)),u},[]);if(l.length!==0)return r.multidate&&!i&&(l=l.reduce((u,c)=>(n.includes(c)||u.push(c),u),n.filter(u=>!l.includes(u)))),o&&l.length>o?l.slice(o*-1):l}function eE(t,e=3,i=!0,r=void 0){const{config:n,picker:a,inputField:s}=t;if(e&2){const o=a.active?n.pickLevel:n.startView;a.update(r).changeView(o).render(i)}e&1&&s&&(s.value=uie(t.dates,n))}function _q(t,e,i){const r=t.config;let{clear:n,render:a,autohide:s,revert:o,forceRefresh:l,viewDate:u}=i;a===void 0&&(a=!0),a?s===void 0&&(s=r.autohide):s=l=!1,u=zh(u,r.format,r.locale);const c=cie(t,e,n);!c&&!o||(c&&c.toString()!==t.dates.toString()?(t.dates=c,eE(t,a?3:1,!0,u),Eg(t,"changeDate")):eE(t,l?3:1,!0,u),s&&t.hide())}function $q(t,e){return e?i=>MM(i,e,t.config.locale):i=>new Date(i)}class pLe{constructor(e,i={},r=void 0){e.datepicker=this,this.element=e,this.dates=[];const n=this.config=Object.assign({buttonClass:i.buttonClass&&String(i.buttonClass)||"button",container:null,defaultViewDate:Lm(),maxDate:void 0,minDate:void 0},Ck(DB,this));let a;if(e.tagName==="INPUT"?(a=this.inputField=e,a.classList.add("datepicker-input"),i.container&&(n.container=i.container instanceof HTMLElement?i.container:document.querySelector(i.container))):n.container=e,r){const c=r.inputs.indexOf(a),d=r.datepickers;if(c<0||c>1||!Array.isArray(d))throw Error("Invalid rangepicker object.");d[c]=this,this.rangepicker=r,this.rangeSideIndex=c}this._options=i,Object.assign(n,Ck(i,this)),n.shortcutKeys=z1e(i.shortcutKeys||{});const s=Uq(e.value||e.dataset.date,n.dateDelimiter);delete e.dataset.date;const o=cie(this,s);o&&o.length>0&&(this.dates=o),a&&(a.value=uie(this.dates,n));const l=this.picker=new nLe(this),u=[e,"keydown",sLe.bind(null,this)];a?kx(this,[u,[a,"focus",oLe.bind(null,this)],[a,"mousedown",lLe.bind(null,this)],[a,"click",uLe.bind(null,this)],[a,"paste",cLe.bind(null,this)],[document,"mousedown",dLe.bind(null,this)],[window,"resize",l.place.bind(l)]]):(kx(this,[u]),this.show())}static formatDate(e,i,r){return MM(e,i,r&&Ey[r]||Ey.en)}static parseDate(e,i,r){return zh(e,i,r&&Ey[r]||Ey.en)}static get locales(){return Ey}get active(){return!!(this.picker&&this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(e){const i=Ck(e,this);Object.assign(this._options,e),Object.assign(this.config,i),this.picker.setOptions(i),eE(this,3)}show(){if(this.inputField){const{config:e,inputField:i}=this;if(i.disabled||i.readOnly&&!e.enableOnReadonly)return;!NM(i)&&!e.disableTouchKeyboard&&(this._showing=!0,i.focus(),delete this._showing)}this.picker.show()}hide(){this.inputField&&(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}toggle(){this.picker.active?this.inputField&&this.picker.hide():this.show()}destroy(){this.hide(),G1e(this),this.picker.detach();const e=this.element;return e.classList.remove("datepicker-input"),delete e.datepicker,this}getDate(e=void 0){const i=$q(this,e);if(this.config.multidate)return this.dates.map(i);if(this.dates.length>0)return i(this.dates[0])}setDate(...e){const i=[...e],r={},n=SB(e);n&&typeof n=="object"&&!Array.isArray(n)&&!(n instanceof Date)&&Object.assign(r,i.pop());const a=Array.isArray(i[0])?i[0]:i;_q(this,a,r)}update(e=void 0){if(!this.inputField)return;const i=Object.assign(e||{},{clear:!0,render:!0,viewDate:void 0}),r=Uq(this.inputField.value,this.config.dateDelimiter);_q(this,r,i)}getFocusedDate(e=void 0){return $q(this,e)(this.picker.viewDate)}setFocusedDate(e,i=!1){const{config:r,picker:n,active:a,rangeSideIndex:s}=this,o=r.pickLevel,l=zh(e,r.format,r.locale);l!==void 0&&(n.changeFocus(Up(l,o,s)),a&&i&&n.changeView(o),n.render())}refresh(e=void 0,i=!1){e&&typeof e!="string"&&(i=e,e=void 0);let r;e==="picker"?r=2:e==="input"?r=1:r=3,eE(this,r,!i)}enterEditMode(){const e=this.inputField;!e||e.readOnly||!this.picker.active||this.editMode||(this.editMode=!0,e.classList.add("in-edit"))}exitEditMode(e=void 0){if(!this.inputField||!this.editMode)return;const i=Object.assign({update:!1},e);delete this.editMode,this.inputField.classList.remove("in-edit"),i.update&&this.update(i)}}function fLe(t,e,i,r,n){if(n){const a=e.target.value;n(a)?(r.innerHTML="",r.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(r.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),r.classList.add("is-danger"))}}function hLe(t){const e=new Set(t.options.filter(h=>h.selected).map(h=>h.value)),i=document.createElement("div");i.style.cssText="position: relative; width: 100%;";const r=document.createElement("div");r.style.cssText="display: flex; align-items: center; flex-wrap: wrap; gap: 4px; min-height: 2.5em; padding: 4px 8px; border: 1px solid var(--chc-input-border, #7a7a7a); border-radius: 4px; background: var(--chc-input-bg, #fff); cursor: pointer; box-sizing: border-box";const n=document.createElement("div");n.style.cssText="display: flex; flex-wrap: wrap; gap: 4px; flex: 1; min-width: 0;";const a=document.createElement("span");a.textContent="â–¾",a.style.cssText="margin-left: auto; padding-left: 8px; user-select: none; color: var(--chc-text-secondary, #666);",r.appendChild(n),r.appendChild(a);const s=document.createElement("div");s.style.cssText=["display: none","position: absolute","top: 100%","left: 0","right: 0","z-index: 50","max-height: 220px","overflow-y: auto","border: 1px solid var(--chc-border-primary, #dbdbdb)","border-top: none","border-radius: 0 0 4px 4px","background: var(--chc-dropdown-bg, #fff)","box-shadow: 0 4px 8px rgba(0,0,0,0.1)"].join("; ");const o=new Map;for(const h of t.options){const m=document.createElement("label");m.style.cssText=["display: flex","align-items: center","gap: 8px","padding: 6px 10px","cursor: pointer","color: var(--chc-text-primary, #363636)"].join("; "),m.addEventListener("mouseenter",()=>{m.style.background="var(--chc-hover-bg, #f5f5f5)"}),m.addEventListener("mouseleave",()=>{m.style.background=""});const g=document.createElement("input");g.type="checkbox",g.value=h.value,g.checked=!!h.selected,h.disabled&&(g.disabled=!0),g.style.cssText="margin: 0; cursor: pointer;";const I=document.createElement("span");I.textContent=h.label,m.appendChild(g),m.appendChild(I),s.appendChild(m),o.set(h.value,g)}i.appendChild(r),i.appendChild(s);let l=!1;function u(){l=!l,s.style.display=l?"block":"none"}function c(){l=!1,s.style.display="none"}function d(){if(n.innerHTML="",e.size===0){const h=document.createElement("span");h.textContent="Selectâ€¦",h.style.cssText="color: var(--chc-text-muted, #999); user-select: none;",n.appendChild(h);return}for(const h of e){const m=t.options.find(v=>v.value===h);if(!m)continue;const g=document.createElement("span");g.style.cssText=["display: inline-flex","align-items: center","gap: 4px","padding: 2px 6px","border-radius: 3px","background: var(--chc-status-info, blue)","color: var(--chc-text-inverse, #fff)","font-size: 0.85em","white-space: nowrap"].join("; "),g.textContent=m.label;const I=document.createElement("span");I.textContent="Ã—",I.style.cssText="cursor: pointer; margin-left: 2px; font-weight: bold;",I.addEventListener("click",v=>{v.stopPropagation(),e.delete(h);const w=o.get(h);w&&(w.checked=!1),d(),p()}),g.appendChild(I),n.appendChild(g)}}function p(){if(vo(t.onChange)){const h=new Event("change",{bubbles:!0});f.dispatchEvent(h),t.onChange(h,t)}}r.addEventListener("click",()=>u()),document.addEventListener("click",h=>{l&&!i.contains(h.target)&&c()});for(const[h,m]of o)m.addEventListener("change",()=>{m.checked?e.add(h):e.delete(h),d(),p()});d();const f=i;return Object.defineProperty(f,"selectedValues",{get:()=>[...e],enumerable:!0}),Object.defineProperty(f,"value",{get:()=>[...e].join(","),enumerable:!0}),{container:i,element:f}}const Ak="none";function mLe(t,e){for(const i of e.options){if(i.hide)continue;const r=document.createElement("option");r.className="font-medium",i.value&&r.setAttribute("value",i.value),(i.selected||e.value===i.value)&&r.setAttribute("selected","true"),i.disabled&&r.setAttribute("disabled","true"),r.innerHTML=i.label,t.appendChild(r)}}function gLe(t){const e=document.createElement("div");if(e.className="field font-medium",t.class&&e.classList.add(t.class),t.width?e.style.cssText=`width: ${t.width}`:e.style.cssText="flex-grow: 1",t.label&&!t.checkbox){const s=document.createElement("label");s.style.cssText=t.labelStyle||"font-weight: bold; font-size: larger;",s.innerHTML=t.label,e.appendChild(s)}let i,r,n=[];const a=document.createElement("div");if(a.className="control font-medium",t.controlVisible===!1&&(a.style.display=Ak),t.controlId&&(a.id=t.controlId),t.text){const s=document.createElement("div");t.id&&(s.id=t.id),s.className="content",s.innerHTML=t.text,a.appendChild(s)}else if(t.radio){const s=document.createElement("div");s.id=t.id,s.className="control";for(const o of t.options??[]){const l=document.createElement("label");l.className="radio";const u=document.createElement("input");o.field&&n.push({input:u,field:o.field}),o.id&&(u.id=o.id),u.name=t.id,u.type="radio",u.value=o.text,o.checked&&(u.checked=!0),vo(t.onChange)&&u.addEventListener("change",d=>t.onChange(d,t)),l.appendChild(u),s.appendChild(l);const c=document.createElement("span");c.style.marginLeft=".25em",c.style.marginRight="1em",c.style.color="var(--chc-text-primary)",c.innerHTML=o.text,s.appendChild(c)}a.appendChild(s),i=s}else if(t.options&&t.multiple){const{container:s,element:o}=hLe(t);t.id&&(s.id=t.id),a.appendChild(s),i=o}else if(t.options){const s=document.createElement("div");s.className="select font-medium",s.style.cssText="width: 100%",t.zIndex&&(s.style.zIndex=t.zIndex);const o=document.createElement("select");if(t.dataPlaceholder&&o.setAttribute("data-placeholder",t.dataPlaceholder),t.dataType&&o.setAttribute("data-type",t.dataType),t.disabled&&(o.disabled=!0),t.id&&(s.id=t.id),o.style.cssText="width: 100%",mLe(o,t),s.appendChild(o),a.appendChild(s),t.help){const l=document.createElement("p");l.className="help font-medium is-info",l.innerHTML=t.help?.text,l.style.display=t.help?.visible?"":Ak,a.appendChild(l)}i=o,vo(t.onChange)&&o.addEventListener("change",l=>t.onChange(l,t))}else if(t.checkbox){const s=document.createElement("div");s.className="flexrow nowrap",s.style.display="inline-block";const o=document.createElement("input");vo(t.onChange)&&o.addEventListener("change",c=>t.onChange(c,t)),i=o;const l=t.intent??"is-success";o.className=`is-checkradio ${l}`,o.type="checkbox",o.id=t.id,t.checked&&(o.checked=!0),s.appendChild(o);const u=document.createElement("label");u.setAttribute("for",t.id),t.color&&(u.style.color=t.color),u.innerHTML=t.label,s.appendChild(u),a.appendChild(s)}else{const s=document.createElement("input");if(s.className="input font-medium",t.class&&s.classList.add(t.class),s.setAttribute("type",t.type||"text"),s.setAttribute("autocomplete",t.autocomplete||"off"),s.setAttribute("placeholder",t.placeholder||""),t.disabled&&s.setAttribute("disabled","true"),t.id&&s.setAttribute("id",t.id),a.appendChild(s),t.iconLeft){a.classList.add("has-icons-left");const l=document.createElement("span");l.className="icon is-small is-left font-medium";const u=document.createElement("i");u.className=t.iconLeft,l.appendChild(u),a.appendChild(l)}if(t.type==="password"){a.classList.add("has-icons-right");const l=document.createElement("span");l.className="icon is-small is-right font-medium";const u=document.createElement("i");u.className=t.iconRight,l.appendChild(u),a.appendChild(l)}i=s;const o=document.createElement("p");if(o.className="help font-medium",a.appendChild(o),t.validator&&s.addEventListener("input",l=>fLe(t,l,s,o,t.validator)),t.date){const l=t.maxNumberOfDates||1,u=!t.maxNumberOfDates||l===1;r=new pLe(s,{maxDate:t.maxDate,minDate:t.minDate,format:"yyyy-mm-dd",maxNumberOfDates:l,autohide:u})}else t.typeAhead&&A1e({...t.typeAhead,element:s});vo(t.onKeyDown)&&s.addEventListener("keydown",l=>t.onKeyDown(l,t)),vo(t.onChange)&&s.addEventListener("change",l=>t.onChange(l,t)),vo(t.onInput)&&s.addEventListener("input",l=>t.onInput(l,t)),vo(t.onKeyUp)&&s.addEventListener("keyup",l=>t.onKeyUp(l,t)),t.value!==void 0&&(s.value=t.value),t.selectOnFocus&&s.addEventListener("focus",()=>s.select())}return e.appendChild(a),t.visible===!1&&(e.style.display=Ak),{field:e,inputElement:i,datepicker:r,subFields:n}}const kk="__BYE__",Ok="__QUALIFIER__";function ILe({matchUp:t,side:e,sideNumber:i,eventHandlers:r,composition:n,position:a,currentParticipant:s}){const o=n?.configuration,l=e?.drawPosition,u=()=>{const y=ia(o?.participantProvider)?o.participantProvider():[],b=o?.persistInputFields;let S=y;b&&s&&(y.some(E=>E.participantId===s.participantId)||(S=[s,...y]));const U=S.map(E=>({label:E.participantName||E.participantId,value:E.participantId})),T=s?.participantId===kk,D=s?.participantId===Ok,P=[];return T||P.push({label:"â€” BYE â€”",value:kk}),o?.hasQualifying&&!D&&P.push({label:"â€” QUALIFIER â€”",value:Ok}),[...P,...U]},c=u(),d=y=>{if(!e)return;if(!y||y.trim()===""){ia(r?.removeAssignment)&&r.removeAssignment({matchUp:t,side:e,sideNumber:i||1});return}if(y===kk){ia(r?.assignBye)&&r.assignBye({matchUp:t,side:e,sideNumber:i||1});return}if(y===Ok){ia(r?.assignQualifier)&&r.assignQualifier({matchUp:t,side:e,sideNumber:i||1});return}const b=(ia(o?.participantProvider)?o.participantProvider():[]).find(S=>S.participantId===y);b&&ia(r?.assignParticipant)&&r.assignParticipant({matchUp:t,side:e,sideNumber:i||1,participant:b})};let p=!1;const f=()=>{if(p){p=!1;return}const y=Array.from(document.querySelectorAll(".participant-assignment-input input")),b=y.findIndex(S=>S.id===m);if(b!==-1&&b<y.length-1){const S=y[b+1];setTimeout(()=>{S.focus()},100)}},h=a?`-p${a}`:"",m=`assign-${t.matchUpId}-side${i}${h}`,g=s?.participantId,{field:I}=gLe({typeAhead:{list:c,callback:d,onSelectComplete:f,listProvider:u,currentValue:g},placeholder:a?`Partner ${a}`:"Type participant name...",field:m,id:m,class:"participant-assignment-input"});l&&(I.dataset.drawPosition=l.toString());const v=I.querySelector("input");v&&v.addEventListener("keydown",y=>{y.key==="Tab"&&(p=!0,setTimeout(()=>{p=!1},500))}),I.style.width="100%",I.style.margin="0";const w=o?.assignmentInputFontSize;return w&&(I.style.fontSize=w),setTimeout(()=>{const y=I.querySelector("input");if(y){let b=y.parentElement,S=0;for(;b&&S<15;){const U=window.getComputedStyle(b);(U.overflow!=="visible"||U.overflowX!=="visible"||U.overflowY!=="visible")&&(b.style.setProperty("overflow","visible","important"),b.style.setProperty("overflow-x","visible","important"),b.style.setProperty("overflow-y","visible","important")),b=b.parentElement,S++}}},100),I}const vLe=()=>"chc-seed";function yLe({className:t,composition:e,side:i}){const r=i?.seedValue==="~"?"":i?.seedValue!==void 0&&i.seedValue||i?.seedNumber;if(!r)return"";const n=e?.configuration||{},{bracketedSeeds:a}=n,s=typeof a=="boolean"&&["(",")"]||a==="square"&&["[","]"]||["",""],o=`${s[0]}${r}${s[1]}`,l=n.seedingElement==="sup"?"sup":"span",u=document.createElement(l);return u.className=t||"",u.innerHTML=o,u}const bLe=t=>gn("chc-scale",t?.color&&`chc-scale--${t.color}`);function wLe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n}){const a=e?.configuration,s=a?.scaleAttributes?.eventType||r?.matchUpType||"SINGLES",o=t?.rankings,l=t?.ratings,u=a?.scaleAttributes,c=u?.scaleType,d=u?.scaleName,p=u?.accessor,f=c==="RATING"?l:o,h=f?.SINGLES?.find(T=>T?.scaleName===d)?.scaleValue,m=f?.DOUBLES?.find(T=>T?.scaleName===d)?.scaleValue,g=h&&p?h[p]:h||"",I=m&&p?m[p]:m||"",v=s==="SINGLES"?g:I,w=a?.scaleAttributes?.fallback,y=!n&&(v||w&&(g||I)),b=document.createElement("span"),S=a?.scaleAttributes?.scaleColor,U=S==="green"||S==="red"?S:void 0;return y&&(b.className=gn(i,bLe(U?{color:U}:{}))),b.innerHTML=y||"",b}var SLe=Object.defineProperty,ft=(t,e)=>{for(var i in e)SLe(t,i,{get:e[i],enumerable:!0})};function AM(){return"2.4.6-beta.11"}var EB={};ft(EB,{competitionGovernor:()=>die,drawsGovernor:()=>wae,entriesGovernor:()=>Jue,eventGovernor:()=>nce,generationGovernor:()=>wce,matchUpFormatGovernor:()=>Nce,matchUpGovernor:()=>Ace,mocksGovernor:()=>VG,participantGovernor:()=>Pde,policyGovernor:()=>Due,publishingGovernor:()=>Kde,queryGovernor:()=>Mue,rankingGovernor:()=>tH,reportGovernor:()=>upe,scheduleGovernor:()=>cpe,scoreGovernor:()=>cj,temporalGovernor:()=>Ype,tieFormatGovernor:()=>Tpe,tournamentGovernor:()=>kpe,venueGovernor:()=>Ufe});var die={};ft(die,{getLinkedTournamentIds:()=>OU,getTournamentIds:()=>AU,linkTournaments:()=>Iae,mutate:()=>pie,query:()=>bae,unlinkTournament:()=>yae,unlinkTournaments:()=>vae});var pie={};ft(pie,{linkTournaments:()=>Iae,unlinkTournament:()=>yae,unlinkTournaments:()=>vae});var bh="SINGLES",qt="SINGLES",Hp="DOUBLES",Vt="DOUBLES",Wa="TEAM",ti="TEAM",ULe={SINGLES_MATCHUP:bh,SINGLES:qt,DOUBLES_MATCHUP:Hp,DOUBLES:Vt,TEAM_MATCHUP:Wa,TEAM:ti},fie={[qt]:[qt,"S"],[Vt]:[Vt,"D"],[ti]:[ti,"T"],S:[qt,"S"],D:[Vt,"D"],T:[ti,"T"]};function or(t,e){return(t??0)-(e??0)}function Ke(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function ya(t){return typeof t=="function"}function ai(t){return typeof t=="string"}function Ut(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function TLe(t,e){if(!Ut(t)||!Ut(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function hie(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(Ut).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var DLe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function Ox(t,e){if(t===void 0)return null;if(!Ut(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>Ox(a))}:{[n]:e?r(t[n]):Ox(t[n])}))}function xx(t){return Array.isArray(t)?t.length+t.map(xx).reduce((e,i)=>e+i,0):Ut(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>xx(t[e])).reduce((e,i)=>e+i,0):0}function PLe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=xx(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function xo(t){return Number.isNaN(Number(t))?!1:t>0&&(t&t-1)===0}function Bq(t){if(!t.length)return;let e=[...t].sort(or),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function ELe(t){if(t===1||Number.isNaN(Number(t))||!xo(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function RB(t){return Number.isNaN(Number(t))?0:t%2&&t+1||t}function CB(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Ni(t){return!Number.isNaN(Number.parseFloat(t))}function mie(t){let e=Ke(t);if(!Number.isNaN(e))return e===0?!1:(e&-e)===1}function $v(t){if(Number.isNaN(Number(t)))return!1;for(;!xo(t);)t++;return t}function ta(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function ct(t){return ai(t)&&!t.trim().length?!1:Number.isSafeInteger(typeof t=="string"?+t:t)}function RLe(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function CLe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function gie(t,e,i,r,n=2){let a=1-Math.random(),s=1-Math.random(),o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=gie(t,e,i):(o=Math.pow(o,i),o*=e-t,o+=t),r&&(o=CLe(o,r)),Number.parseFloat(o.toFixed(n))}function tE(t,e=2){return Number.parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function lt(t){return Array.isArray(t)?t?.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function MLe(t){return Array.isArray(t)?t?.map(e=>e===null?void 0:e):t}function An(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function PI(t){return ct(t)?t:1/0}function Ra(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function NLe(t){return Iie(Ra(t))}function Iie(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function ALe(t,e,i){return i.indexOf(t)===e}function vie(t){return t.filter(ALe)}function wa(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function xs(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Ce(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function nl(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function _i(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function Vq(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function $n(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function kLe(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function OLe(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function Sr(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function yie(t,[e,...i]){return t.length?[t.slice(0,e),...yie(t.slice(e),[...i,e])]:[]}function xLe(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function bie(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function wie(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function Fx(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let s=i?!!(Math.floor(a/e)%2):!1,o=a%e,l=s?e-1-o:o;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function FLe(t,e=1){if(!Array.isArray(t)||!t.every(ct))return[];let i=Math.min(...t,e),r=Math.max(...t);return Ce(i,r+1).filter(n=>!t.includes(n))}function wh(t,e){return!Array.isArray(t)||!ai(e)?!1:_i(t,fie[e]).length}var W={success:!0},Sie="error",LLe={SUCCESS:W,ERROR:Sie};function Uie({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:s}=n;if(typeof a!="number"||typeof s!="number"||s>e||s<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==lt(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...W}}var _Le={};ft(_Le,{addNotice:()=>at,callListener:()=>zx,createInstanceState:()=>w0e,cycleMutationStatus:()=>r2,deepCopyEnabled:()=>i2,deleteNotice:()=>n2,deleteNotices:()=>wU,disableNotifications:()=>Wre,enableNotifications:()=>WM,getDevContext:()=>ha,getMethods:()=>Yre,getNotices:()=>Kre,getProvider:()=>qx,getTopics:()=>Ts,getTournamentId:()=>jm,getTournamentRecord:()=>a2,getTournamentRecords:()=>Gm,globalLog:()=>Qre,handleCaughtError:()=>qM,hasTopic:()=>SU,removeTournamentRecord:()=>Jre,setDeepCopy:()=>aw,setDevContext:()=>nw,setGlobalLog:()=>Hre,setGlobalMethods:()=>zre,setGlobalSubscriptions:()=>U0e,setMethods:()=>qre,setStateMethods:()=>Zre,setStateProvider:()=>b0e,setSubscriptions:()=>T0e,setTournamentId:()=>sw,setTournamentRecord:()=>Xre,setTournamentRecords:()=>zM,timeKeeper:()=>S0e});var Lx={message:"Chronological error; time violation.",code:"ANACHRONISM"},iw={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},Tie={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},_x={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Ci={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},Ie={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},fU={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},EI={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Sh={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},$e={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},Die={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},za={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},bf={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},MB={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},NB={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},RI={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},Pie={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},Eie={message:"Schedule conflict: court slot already occupied",code:"ERR_SCHEDULE_CONFLICT_DOUBLE_BOOKING"},Rie={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},$Le={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},AB={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},hU={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},mU={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},BLe={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},_m={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},Bv={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},kB={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},kM={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},Cie={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},gU={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},jo={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},Mie={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},Nie={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},Aie={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},kie={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},Oie={message:"Invalid action",code:"ERR_INVALID_ACTION"},$x={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},xie={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},Fie={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},Lie={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},OB={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},_ie={message:"Existing round",code:"ERR_EXISTING_ROUND"},VLe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},es={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},yi={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},xB={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},wf={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},FB={message:"Missing MAIN structure",code:"ERR_MISSING_MAIN_STRUCTURE"},$ie={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},bu={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},ci={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},gs={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},Bie={message:"Event exists",code:"ERR_EXISTING_EVENT"},Vie={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},jie={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},LB={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},Gie={message:"Missing stage",code:"ERR_MISSING_STAGE"},Sf={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Hie={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},Wie={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},zie={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},Bx={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},IU={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},ND={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},jLe={message:"Propagated exits downstream",code:"ERR_PROPAGATED_EXITS_DOWNSTREAM"},Vv={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},iu={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},qie={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},Yie={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},Kie={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},jv={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Dn={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},$m={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},pn={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Bu={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},pa={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},fa={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},_B={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},OM={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},GLe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},Xie={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},$B={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},Jie={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},BB={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},HLe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},vU={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},WLe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},Qie={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},zLe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},xM={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},qLe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},YLe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},Bm={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Je={message:"Missing value",code:"ERR_MISSING_VALUE"},Zie={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},ere={message:"Missing date",code:"ERR_MISSING_DATE"},tre={message:"No valid dates",code:"ERR_NO_VALID_DATES"},iE={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},AD={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},ire={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Yi={message:"Invalid Date",code:"ERR_INVALID_DATE"},Ns={message:"Invalid time",code:"ERR_INVALID_TIME"},rre={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},KLe={message:"Missing date range",info:"Event or tournament must have start and end dates",code:"ERR_MISSING_DATE_RANGE"},FM={message:"Invalid Time Zone",code:"ERR_INVALID_TIME_ZONE"},Bg={message:"Invalid embargo: must be an ISO 8601 datetime with timezone (Z or Â±HH:MM offset)",code:"ERR_INVALID_EMBARGO"},Vx={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},nre={message:"Invalid score",code:"ERR_INVALID_SCORE"},LM={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},XLe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},VB={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},are={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},_M={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},sre={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},$M={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Wp={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Fo={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Ua={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},ore={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Lo={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},lre={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},Vm={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},yU={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},pr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},ure={message:"Missing qualified participants",code:"ERR_MISSING_QUALIFIED_PARTICIPANTS"},Gi={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},cre={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},JLe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},dre={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Jd={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},pre={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},fre={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},hre={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},Gv={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},BM={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},jB={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},jx={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},mre={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},QLe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},ZLe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},gre={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},Ire={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},Gx={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},GB={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},HB={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},vre={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},WB={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},CI={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},yre={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},Dc={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},bre={message:"Court exists",code:"ERR_EXISTING_COURT"},Hx={message:"Booking not found",code:"ERR_NOT_FOUND_BOOKING"},wre={message:"Existing matchUps conflict with booking",code:"ERR_EXISTING_MATCHUPS"},Sre={message:"Venue exists",code:"ERR_EXISTING_VENUE"},Uf={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Qd={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},Ure={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},zB={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},Tre={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},Dre={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},e0e={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},qB={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},Pre={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},YB={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},KB={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},VM={message:"Missing context",code:"ERR_MISSING_CONTEXT"},Ere={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},qh={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},Rre={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},Hv={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},Cre={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},jM={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},Mre={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},Nre={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},zc={message:"Invalid object",code:"ERR_INVALID_OBJECT"},ub={message:"Invalid gender",code:"ERR_INVALID_GENDER"},rw={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},re={message:"Invalid values",code:"ERR_INVALID_VALUES"},Are={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},XB={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},kre={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},GM={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},JB={message:"Value unchanged",code:"ABORT_UNCHANGED"},Gr={message:"Not found",code:"ERR_NOT_FOUND"},QB={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},Ore={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},ZB={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},xre={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},Fre={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},Wx={message:"Existing stage",code:"ERR_EXISTING_STAGE"},e2={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},HM={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Lre={message:"Mutation blocked by active lock",code:"ERR_MUTATION_LOCKED"},_re={message:"Active mutation lock already exists for scope",code:"ERR_EXISTING_MUTATION_LOCK"},$re={message:"Mutation lock not found",code:"ERR_NOT_FOUND_MUTATION_LOCK"},Bre={message:"Lock token does not match",code:"ERR_UNAUTHORIZED_LOCK_OPERATION"},Vre={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},bU={message:"Scores present",code:"ERR_SCORES_PRESENT"},t0e={ANACHRONISM:Lx,BOOKING_NOT_FOUND:Hx,CANNOT_CHANGE_WINNING_SIDE:$M,CANNOT_MODIFY_TIEFORMAT:VB,CANNOT_MODIFY_PARTICIPANT_TYPE:are,CANNOT_REMOVE_MAIN_STRUCTURE:Tie,CANNOT_REMOVE_PARTICIPANTS:_M,CATEGORY_MISMATCH:sre,COURT_EXISTS:bre,COURT_NOT_FOUND:Dc,EXISTING_MATCHUPS:wre,DRAW_DEFINITION_NOT_FOUND:za,DRAW_ID_EXISTS:Mie,DRAW_POSITION_ACTIVE:mU,DRAW_POSITION_ASSIGNED:RI,DRAW_POSITION_NOT_CLEARED:Rie,DRAW_POSITION_NOT_FOUND:$Le,DRAW_SIZE_MISMATCH:Cie,DUPLICATE_ENTRY:iw,DUPLICATE_VALUE:Are,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:Ire,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:gre,EVENT_EXISTS:Bie,EVENT_NOT_FOUND:gs,EXISTING_DRAW_DEFINITIONS:Die,EXISTING_END_TIME:zB,EXISTING_FLIGHT:Ore,EXISTING_MATCHUP_ID:Fre,EXISTING_OUTCOME:xre,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:Gv,EXISTING_PARTICIPANT:BM,EXISTING_POLICY_TYPE:BB,EXISTING_PROFILE:ZB,EXISTING_ROUND:_ie,EXISTING_STAGE:Wx,EXISTING_STRUCTURE:e2,INCOMPATIBLE_MATCHUP_STATUS:ND,INCOMPLETE_SOURCE_STRUCTURE:MB,INSUFFICIENT_DRAW_POSITIONS:HB,INVALID_ACTION:Oie,INVALID_ASSIGNMENT:$x,INVALID_BOOKINGS:iE,INVALID_CATEGORY:rw,INVALID_COLLECTION_DEFINITION:Nre,INVALID_CONFIGURATION:Mre,INVALID_DATE_AVAILABILITY:AD,INVALID_DATE:Yi,INVALID_DRAW_DEFINITION:Sh,INVALID_DRAW_POSITION_FOR_SEEDING:NB,INVALID_DRAW_POSITION:_m,INVALID_DRAW_SIZE:kM,INVALID_END_TIME:Ure,INVALID_ENTRIES:jie,INVALID_EVENT_TYPE:bu,INVALID_GAME_SCORES:Vx,INVALID_GENDER:ub,INVALID_MATCHUP_FORMAT:qie,INVALID_MATCHUP_STATUS:Vv,INVALID_MATCHUP_STATUS_BYE:zie,INVALID_MATCHUP:fa,INVALID_OBJECT:zc,INVALID_PARTICIPANT_ID:Fo,INVALID_PARTICIPANT_IDS:Ua,INVALID_PARTICIPANT_ROLE:ore,INVALID_PARTICIPANT_SEEDING:Nie,INVALID_PARTICIPANT_TYPE:Lo,INVALID_PARTICIPANT:Wp,INVALID_POLICY_DEFINITION:Jie,INVALID_RECORDS:_x,INVALID_SCALE_ITEM:qh,INVALID_SEED_NUMBER:Fie,INVALID_SEED_POSITION:Lie,INVALID_SET_NUMBER:zLe,INVALID_SIDE_NUMBER:Qie,INVALID_SCORE:nre,INVALID_STAGE:Sf,INVALID_START_TIME:Dre,INVALID_STRUCTURE:bf,INVALID_STOP_TIME:Tre,INVALID_TIE_FORMAT:iu,INVALID_TIME:Ns,INVALID_TIME_ITEM:qB,INVALID_TOURNAMENT_DATES:rre,INVALID_TOURNAMENT_RECORD:fU,INVALID_VALUES:re,INVALID_WINNING_SIDE:LM,MATCHUP_NOT_FOUND:pn,METHOD_NOT_FOUND:HM,MUTATION_LOCKED:Lre,MUTATION_LOCK_EXISTS:_re,MUTATION_LOCK_NOT_FOUND:$re,MISSING_ASSIGNMENTS:LB,MISSING_ASYNC_STATE_PROVIDER:Pre,MISSING_AVOIDANCE_POLICY:Xie,MISSING_BIRTH_DATE:Zie,MISSING_COLLECTION_DEFINITION:Kie,MISSING_COURT_ID:Bm,MISSING_COURTS_INFO:yre,MISSING_DATE_AVAILABILITY:ire,MISSING_DATE:ere,MISSING_DRAW_DEFINITION:$e,MISSING_DRAW_ID:jo,MISSING_DRAW_POSITION:Bv,MISSING_DRAW_POSITIONS:hU,MISSING_DRAW_SIZE:gU,MISSING_ENTRIES:Vie,MISSING_EVENT:ci,MISSING_QUALIFIED_PARTICIPANTS:ure,MISSING_MATCHUP_FORMAT:Yie,MISSING_MATCHUP_ID:Dn,MISSING_MATCHUP_IDS:$m,MISSING_MATCHUP:pa,MISSING_MATCHUPS:Bu,MISSING_PARTICIPANT_COUNT:pre,MISSING_PARTICIPANT_ID:pr,MISSING_PARTICIPANT_IDS:Jd,MISSING_PARTICIPANT_ROLE:lre,MISSING_PARTICIPANT:Vm,MISSING_PARTICIPANTS:yU,MISSING_PENALTY_ID:WB,MISSING_PENALTY_TYPE:vre,MISSING_PERSON_DETAILS:hre,MISSING_POLICY_ATTRIBUTES:$B,MISSING_POLICY_DEFINITION:OM,MISSING_POLICY_TYPE:_B,MISSING_POSITION_ASSIGNMENTS:Wie,MISSING_ROUND_NUMBER:VLe,MISSING_SCHEDULE:Ere,MISSING_SCORING_POLICY:WLe,MISSING_SEED_ASSIGNMENTS:xie,MISSING_SEEDCOUNT_THRESHOLDS:kie,MISSING_SEEDING_POLICY:GLe,MISSING_SET_NUMBER:qLe,MISSING_SET_OBJECT:xM,MISSING_SIDE_NUMBER:YLe,MISSING_STAGE:Gie,MISSING_STRUCTURE_ID:es,MISSING_STRUCTURE:wf,MISSING_MAIN_STRUCTURE:FB,MISSING_STRUCTURES:xB,MISSING_TARGET_LINK:OB,MISSING_TIE_FORMAT:jv,MISSING_TIME_ITEM:YB,MISSING_TIME_ITEMS:KB,MISSING_TOURNAMENT_ID:EI,MISSING_TOURNAMENT_RECORD:Ie,MISSING_TOURNAMENT_RECORDS:Ci,MISSING_VALUE:Je,MISSING_VENUE_ID:Qd,MODIFICATIONS_FAILED:Rre,NO_CANDIDATES:jM,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:GB,NO_MODIFICATIONS_APPLIED:Hv,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:Gx,NO_PARTICIPANT_REMOVED:dre,NO_VALID_ACTIONS:kre,NO_VALID_ATTRIBUTES:GM,NO_VALID_DATES:tre,NOT_FOUND:Gr,NOT_IMPLEMENTED:QB,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:jB,PARTICIPANT_ID_EXISTS:cre,PARTICIPANT_NOT_CHECKED_IN:fre,PARTICIPANT_NOT_FOUND:Gi,PARTICIPANT_PAIR_EXISTS:JLe,PENALTY_NOT_FOUND:CI,POLICY_NOT_ATTACHED:HLe,POLICY_NOT_FOUND:vU,SCHEDULE_NOT_CLEARED:Pie,SCHEDULE_CONFLICT_DOUBLE_BOOKING:Eie,SCHEDULED_MATCHUPS:Vre,SCORES_PRESENT:bU,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:Aie,STAGE_SEQUENCE_LIMIT:Hie,STRUCTURE_NOT_FOUND:yi,TEAM_NOT_FOUND:XB,UNABLE_TO_ASSIGN_COURT:Cre,UNAUTHORIZED_LOCK_OPERATION:Bre,UNLINKED_STRUCTURES:$ie,UNRECOGNIZED_DRAW_TYPE:AB,UNRECOGNIZED_MATCHUP_FORMAT:IU,UNRECOGNIZED_MATCHUP_STATUS:Bx,VALUE_UNCHANGED:JB,VENUE_EXISTS:Sre},Ii={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},jre={addNotice:f0e,callListener:v0e,cycleMutationStatus:p0e,deleteNotice:g0e,deleteNotices:m0e,disableNotifications:i0e,enableNotifications:r0e,getMethods:t2,getNotices:h0e,getTopics:I0e,getTournamentId:Gre,getTournamentRecord:n0e,getTournamentRecords:a0e,removeTournamentRecord:u0e,setMethods:d0e,setSubscriptions:c0e,setTournamentId:o0e,setTournamentRecord:s0e,setTournamentRecords:l0e,handleCaughtError:y0e};function i0e(){Ii.disableNotifications=!0}function r0e(){Ii.disableNotifications=!1}function Gre(){return Ii.tournamentId}function n0e(t){return Ii.tournamentRecords[t]}function a0e(){return Ii.tournamentRecords}function s0e(t){let e=t?.tournamentId;return e?(Ii.tournamentRecords[e]=t,{success:!0}):{error:fU}}function o0e(t){return t?Ii.tournamentRecords[t]?(Ii.tournamentId=t,{success:!0}):{error:Ie}:(Ii.tournamentId=void 0,{success:!0})}function l0e(t){Ii.tournamentRecords=t;let e=Object.keys(t);e.length===1?Ii.tournamentId=e[0]:e.length||(Ii.tournamentId=void 0)}function u0e(t){if(typeof t!="string")return{error:re};if(!Ii.tournamentRecords[t])return{error:Gr};delete Ii.tournamentRecords[t];let e=Object.keys(Ii.tournamentRecords);return e.length===1?Ii.tournamentId=e[0]:e.length||(Ii.tournamentId=void 0),{success:!0}}function c0e(t){return t.subscriptions===null||Object.keys(t.subscriptions).length===0?(Ii.subscriptions={},{...W}):typeof t.subscriptions!="object"?{error:re}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?Ii.subscriptions[e]=t.subscriptions[e]:delete Ii.subscriptions[e]}),{...W})}function d0e(t){return typeof t!="object"?{error:re}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(Ii.methods[e]=t[e])}),{...W})}function p0e(){let t=Ii.modified;return Ii.modified=!1,t}function f0e({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(Ii.disableNotifications||(Ii.modified=!0),!(Ii.disableNotifications||!Ii.subscriptions[t]&&!r)))return i&&(Ii.notices=Ii.notices.filter(n=>!(n.topic===t&&n.key===i))),Ii.notices.push({topic:t,payload:e,key:i}),{...W}}function t2(){return Ii.methods??{}}function h0e({topic:t}){return Ii.notices.filter(e=>e.topic===t).map(e=>e.payload)}function m0e(){Ii.notices=[]}function g0e({topic:t,key:e}){Ii.notices=Ii.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function I0e(){return{topics:Object.keys(Ii.subscriptions)}}function v0e({topic:t,notices:e},i){let r=Ii.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i?.[t];n&&typeof n=="function"&&n(e)}function y0e({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:Gre(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var Qt={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},kr=jre,jq=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function b0e(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(_i(Object.keys(t),jq).length!==jq.length)throw new Error("Global state provider is missing required methods");return kr=t,{success:!0}}function w0e(){if(kr.createInstanceState){try{kr.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:Pre}}function ha(t){return!t||typeof t!="object"?Qt.devContext??!1:typeof Qt.devContext!="object"?!1:Object.keys(t).every(e=>Qt.devContext?.[e]===t[e])&&Qt.devContext}function S0e(t="reset",e="default"){let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Qt.timers).filter(r=>r!=="default"||Qt.timers[r].startTime).map(r=>{let n=Qt.timers[r],a=n.state==="stopped"?0:(i-(n?.startTime??0))/1e3,s=n.elapsedTime+a;return{state:Qt.timers[r].state,elapsedTime:s.toFixed(2),timer:r}});{let r=Qt.timers[e].state==="stopped"?0:(i-(Qt.timers[e]?.startTime??0))/1e3,n=Qt.timers[e].elapsedTime+r;return{state:Qt.timers[e].state,elapsedTime:n.toFixed(2),timer:e}}}if(!Qt.timers[e]||t==="reset"){if(e==="allTimers")return Qt.timers={default:{elapsedTime:0}},!0;Qt.timers[e]={startTime:i,state:"active",elapsedTime:0}}return Qt.timers[e].elapsedTime||(Qt.timers[e].elapsedTime=0),t==="stop"&&Qt.timers[e].state!=="stopped"&&(Qt.timers[e].state="stopped")&&(Qt.timers[e].elapsedTime+=(i-(Qt.timers[e]?.startTime??0))/1e3),t==="start"&&(Qt.timers[e].startTime=i)&&(Qt.timers[e].state="active"),Qt.timers[e]}function Hre(t){ya(t)?Qt.globalLog=t:delete Qt.globalLog}function nw(t){Qt.devContext=t}function Wre(){kr.disableNotifications()}function WM(){kr.enableNotifications()}function aw(t,e){typeof t=="boolean"&&(Qt.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Qt.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Qt.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Qt.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Qt.deepCopyAttributes.threshold=e.threshold))}function i2(){return{enabled:Qt.deepCopy,...Qt.deepCopyAttributes}}function U0e(t){return t?.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Qt.globalSubscriptions[e]=t.subscriptions[e]}),{...W}):{error:Je,info:"missing subscriptions"}}function T0e(t){return t?.subscriptions?kr.setSubscriptions({subscriptions:t.subscriptions}):{error:Je,info:"missing subscriptions"}}function zre(t){return t?typeof t!="object"?{error:re}:(Object.keys(t).forEach(e=>{ya(t[e])&&(Qt.globalMethods[e]=t[e])}),{...W}):{error:Je,info:"missing method declarations"}}function qre(t){return t?typeof t!="object"?{error:re}:kr.setMethods(t):{error:Je,info:"missing method declarations"}}function r2(){return kr.cycleMutationStatus()}function at(t){if(typeof t?.topic!="string")return;let e=Qt.globalSubscriptions[t.topic];return kr.addNotice(t,e)}function Yre(){return{...Qt.globalMethods,...kr.getMethods()}}function Kre(t){return kr.getNotices(t)}function n2({key:t,topic:e}){return kr.deleteNotice({key:t,topic:e})}function wU(){return kr.deleteNotices()}function Ts(){return kr.getTopics()}function SU(t){return Ts()?.topics?.includes(t)}async function zx(t){return kr.callListener(t,Qt.globalSubscriptions)}function jm(){return kr.getTournamentId()}function a2(t){return kr.getTournamentRecord(t)}function Gm(){return kr.getTournamentRecords()}function Xre(t){return kr.setTournamentRecord(t)}function zM(t){return kr.setTournamentRecords(t)}function sw(t){return kr.setTournamentId(t)}function Jre(t){return kr.removeTournamentRecord(t)}function qx(){return kr}function qM({engineName:t,methodName:e,params:i,err:r}){let n=ya(kr.handleCaughtError)&&kr.handleCaughtError||jre.handleCaughtError,{tournamentRecord:a,...s}=i;return n({params:s,engineName:t,methodName:e,err:r})}function Qre(t,e){if(Qt.globalLog)try{Qt.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),Hre()}else console.log(e,t)}function Zre(t,e,i,r){if(!Ut(t))return{error:re};Ni||(i=1);let n=Array.isArray(e)?e:[],a={},s=(o,l=0)=>{Object.keys(o).forEach(u=>{ya(o[u])?a[u]=o[u]:Ut(o[u])&&(e===!0||n?.includes(u))&&(i===void 0||l<i)&&s(o[u],l+1)})};return s(t),r?zre(a):qre(a),{methods:a}}function D0e(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function je(t,e,i,r){if(typeof t!="object"||t===null)return t;i2()?.enabled||(r=!0);let n=["",void 0,null];e&&n.push(!1);let a=D0e(t,n,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(o=>je(o))}:{[s]:r?t[s]:je(t[s])}))}function q({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e?.stack)&&(e.stack=[]),e&&Array.isArray(e?.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&(e.context||(e.context={}),Object.assign(e.context,je(t))),e&&!e?.error&&!e?.success&&Object.assign(e,{...W}),e??{success:!0}}var _r="FEMALE",tc="OTHER",Hm="MIXED",er="MALE",s2={FEMALE_ABBR:"F",OTHER_ABBR:"O",MIXED_ABBR:"X",MALE_ABBR:"M",ANY_ABBR:"A",FEMALE:_r,MIXED:Hm,OTHER:tc,MALE:er,ANY:"ANY"};function gp(t){return[_r,"F"].includes(t)}function rh(t){return[er,"M"].includes(t)}function Ba(t){return[Hm,"X"].includes(t)}function wu(t){return["ANY","A"].includes(t)}function un(t){if(t){if(gp(t))return _r;if(Ba(t))return Hm;if(rh(t))return er;if(wu(t))return"ANY"}return tc}function vl(t){return gp(t)||rh(t)}var P0e="MIXED events can not contain mixed singles or { gender: ANY } collections",E0e="events with { gender: ANY } can not contain MIXED singles collections";function YM(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&vl(i)&&un(i)!==un(n)?q({result:{valid:!1,error:ub},context:{gender:n},stack:e}):Ba(i)&&(wu(n)||Ba(n)&&r!==Vt)?q({result:{error:ub,valid:!1},info:P0e,stack:e}):wu(i)&&Ba(n)&&r!==Vt?q({result:{error:ub,valid:!1},info:E0e,stack:e}):{valid:!0}}var R0e="normal",Gq="timed",C0e="final",o2="NOAD",ene=["SET","HAL","QTR","PER","INN","RND","FRM","MAP","MAT"],tne="CONSECUTIVE",ine="TRADITIONAL",M0e={S:R0e,F:C0e,G:"game"};function KM(t,e){if(Ut(t)&&(t?.bestOf||t?.exactly)&&t?.setFormat)return A0e(t,e)}function ow(t){return!Number.isNaN(Number(t))&&Number(t)}function rne(t){let e=`T${t.minutes}`;return t.based==="P"&&(e+="P"),t.tiebreakFormat?.tiebreakTo&&(e+=`/TB${t.tiebreakFormat.tiebreakTo}`),t.modifier&&(e+=`@${t.modifier}`),e}function N0e(t){let e=t?.deuceAfter?`${t.deuceAfter}D`:"";if(t?.type===ine)return`TN${e}`;if(t?.type===tne&&Number.isInteger(t.count))return`${t.count}C${e}`}function A0e(t,e){let i=ow(t.bestOf)||void 0,r=ow(t.exactly)||void 0,n=i||r;if(t.setFormat?.timed&&t.simplified&&n===1)return rne(t.setFormat);let a=t.matchRoot||"SET",s=r&&r!==1?"X":"",o=t.aggregate?"A":"",l=n&&`${a}${n}${s}${o}`||"",u=Hq(t.setFormat,e),c=u&&`S:${u}`||"",d=Hq(t.finalSetFormat,e),p=n&&n>1&&d&&u!==d&&`F:${d}`||"",f=t.gameFormat?`G:${N0e(t.gameFormat)}`:"";if(l&&u)return[l,c,f,p].filter(Boolean).join("-")}function Hq(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return rne(t);if(t.tiebreakSet)return Wq(t.tiebreakSet);let i=ow(t.setTo);if(i){let r=t.NoAD&&o2||"",n=Wq(t.tiebreakFormat),a=n&&`/${n}`||"",s=ow(t.tiebreakAt),o=s&&(s!==i||e)&&`@${s}`||"";if(n!==!1)return`${i}${r}${a}${o}`}}}function Wq(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&ow(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?o2:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Xi(t){if(ai(t)){let e=t.startsWith("T")&&Gq||ene.some(i=>t.startsWith(i))&&"SET"||"";if(e===Gq){let i=sne(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e==="SET")return x0e(t)}}function k0e(t){let e=ene.find(u=>t.startsWith(u));if(!e)return;let i=t.slice(e.length),r=/^(\d+)([A-Z]*)$/.exec(i);if(!r)return;let n=MI(r[1]);if(!n)return;let a=r[2],s=!1,o=!1,l=[];for(let u of a)u==="X"?s=!0:u==="A"?o=!0:l.push(u);return{matchRoot:e,count:n,exactly:s,aggregate:o,matchMods:l}}function O0e(t){let e=/^(.+?)(\d+D)$/.exec(t),i=e?e[1]:t,r=e?Number(e[2].slice(0,-1)):void 0;if(r!==void 0&&(r<1||!Number.isInteger(r)))return;if(i==="TN"){let a={type:ine};return r&&(a.deuceAfter=r),a}let n=/^([1-9]\d*)C$/.exec(i);if(n){let a={type:tne,count:Number(n[1])};return r&&(a.deuceAfter=r),a}}function x0e(t){let e=t.split("-"),i=k0e(e[0]);if(!i)return;let{matchRoot:r,count:n,exactly:a,aggregate:s,matchMods:o}=i,l=a&&n!==1?void 0:n,u=a&&n!==1?n:void 0,c,d,p,f=0,h=0,m=0;for(let v=1;v<e.length;v++){let w=e[v].indexOf(":");if(w<0)return;let y=e[v].slice(0,w),b=e[v].slice(w+1);if(!(y in M0e))return;if(y==="S"){if(f++,f>1)return;c=zq(e[v],b)}else if(y==="F"){if(h++,h>1)return;d=zq(e[v],b)}else if(y==="G"&&(m++,m>1||(p=O0e(b),!p)))return}let g=c&&c.timed||d&&d.timed;if(r==="SET"&&!(l&&l<6||g&&u)||!c||!(!d||d))return;let I=je({setFormat:c,exactly:u,bestOf:l});return r!=="SET"&&(I.matchRoot=r),s&&(I.aggregate=!0),o.length>0&&(I.matchMods=o),d&&(I.finalSetFormat=d),p&&(I.gameFormat=p),I}function zq(t,e){return e.startsWith("TB")?F0e(e):e.startsWith("T")?sne(e):L0e(t,e)}function F0e(t){let e=ane(t);return e===!1?!1:typeof e=="object"?{tiebreakSet:e}:void 0}function L0e(t,e){let i=/^[FS]:(\d+)([A-Za-z]*)/.exec(t),r=i&&one(i[2])||!1,n=!i?.[2]||r,a=i?MI(i[1]):void 0,s=nne(e),o=s!==!1,l=o&&s||a,u=ane(e.split("/")[1]);return!a||!n||u===!1||!o?!1:_0e(a,r,u,l)}function _0e(t,e,i,r){let n={setTo:t};return e&&(n.NoAD=!0),i?(n.tiebreakFormat=i,n.tiebreakAt=r):n.noTiebreak=!0,n}function nne(t,e=!0){let i=t?.indexOf("@")>0&&t.split("@");if(i)return(e?MI(i[1]):i[1])||!1}function ane(t){if(t)return t.startsWith("TB")?$0e(t):!1}function $0e(t){let e=nne(t,!1),i=/^TB(\d+)([A-Za-z]*)/.exec(t),r=i?.[1],n=i&&one(i[2]),a=!i?.[2]||n,s=MI(r);if(!s||!a)return!1;let o={tiebreakTo:s};return e&&typeof e=="string"&&!ct(e)&&(o.modifier=e),n&&(o.NoAD=!0),o}function sne(t){let e=t.slice(1),i=/^(\d+)([PG])?(?:\/TB(\d+))?(@[A-Za-z]+)?$/.exec(e),r=MI(i?.[1]);if(!r)return;let n={timed:!0,minutes:r},a=i?.[2];a==="P"?n.based="P":a==="G"&&(n.based="G");let s=i?.[3];if(s){let u=MI(s);u&&(n.tiebreakFormat={tiebreakTo:u})}let o=i?.[4],l=[void 0,"P","G",""].includes(o);if(o&&!l){let u=/^(\d+)([PGA])?(?:\/TB\d+)?(@)([A-Za-z]+)$/.exec(e)?.[4];return u?(n.modifier=u,n):void 0}return o&&(n.based=o),n}function one(t){return t?.includes(o2)}function MI(t){let e=Number(t);return Number.isNaN(e)?0:e}function B0e(t){return t.replaceAll(/T(\d+)G(?=\/TB|@|-|$)/g,"T$1")}function qa({matchUpFormat:t}){if(!ai(t)||t==="")return!1;let e=Xi(t),i=/-S:(\d+)\/TB(\d{1,2})@?(\d?)/.exec(t),r=i?.[1],n=i?.[2],a=i?.[3],s=/-F:(\d+)\/TB(\d{1,2})@?(\d?)/.exec(t),o=s?.[1],l=s?.[2],u=s?.[3];return KM(e,!!(i&&n&&r===a||s&&l&&o===u))===B0e(t)}var cb=/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1])$/,lne=/^((0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)([.,]\d{3})?$/,yl=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))([ T](0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/,Ip=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))?([ T]?(0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/;function rE(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Ze(t.scheduledTime)),!e)return;let i=fi(t.scheduledTime),r=Ze(e);return r&&i&&(r+=`T${i}`),r}function V0e(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function Wv(t){let e=typeof t=="string"?t?.split(" "):[];if(t&&e?.length>1&&!["AM","PM"].includes(e[1].toUpperCase()))return!1;let i=Wm(t,!0,!0);return!!(!t||i&&Ip.test(i))}function kn(t){return ru(t)||cb.test(t)}function j0e(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+3600*e.getHours();return G0e(i,{displaySeconds:!1})}function G0e(t,e){let i=Number.parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e?.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(us).join(":")}var l2=t=>{let e=lw(t)||ru(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${us(r)}-${us(e.getUTCDate())}`};function H0e(t){let e=lw(t)||ru(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Hs(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&!t.includes("T")&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),s=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,s].join(e):i==="MDY"?[n,a,s].join(e):i==="YDM"?[s,a,n].join(e):i==="DYM"?[a,s,n].join(e):i==="MYD"?[n,s,a].join(e):[s,n,a].join(e)}function nE(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function W0e(t){return nE(t).getTime()}function lw(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!Number.isNaN(Number(t))&&new Date(t)||!1;return e&&!Number.isNaN(Number(e.valueOf()))}function z0e(t,e){return t<=e}function NI(t,e){if(!kn(t)||!kn(e))return[];let i=Ze(t)+"T00:00",r=Ze(e)+"T00:00",n=new Date(i),a=new Date(r),s=lw(a)&&lw(n)&&z0e(n,a),o=[],l=0;if(s){let u=n,c=u.getTime();for(;c<=a.getTime()&&l<300;)l+=1,o.push(new Date(u)),c=u.setDate(u.getDate()+1)}return o.map(u=>Hs(u))}var q0e=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function ru(t){return typeof t!="string"?!1:q0e.test(t)}function cd(t){return typeof t!="string"||!ru(t)?!1:/([zZ]|[+-]\d{2}:?\d{2})$/.test(t)}function u2(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!Number.isNaN(Number.parseInt(r)));return!(e.length<2||!i||Number.parseInt(e[0])>23||Number.parseInt(e[1])>60)}function Nt(t){let e=fi(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>Number.parseInt(n));return i*60+r}function Y0e(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[us(e),us(i)].join(":")}function aE(t){return u2(t)?t.split(":").slice(0,2).map(us).join(":"):void 0}function fi(t){return ru(t)&&t.indexOf("T")>0?aE(t.split("T").reverse()[0]):aE(t)}function Ze(t){return ru(t)||yl.test(t)?t.split("T")[0]:""}function Fy(t,e){let i=new Date(t);return i.setUTCDate(i.getUTCDate()+e),Ze(i.toISOString())}function sE(t){t=typeof t=="string"?t:"00:00";let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,Number.isNaN(Number.parseInt(i.hours))||Number.isNaN(Number.parseInt(i.minutes))||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function K0e(t){let e=sE(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&Number.parseInt(e.hours)<12&&(e.hours=(e.hours&&Number.parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(us).join(":")}function X0e(t){let e=sE(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),e.hours?.[0]==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function Wm(t,e,i){let r=Ze(t),n=fi(t),a=r?n:t;return t?e&&(r&&i&&t||K0e(a))||X0e(a):void 0}function une(t,e){let i=sE(t),r=sE(e);if(Number.parseInt(i.hours)<Number.parseInt(r.hours))return-1;if(Number.parseInt(i.hours)>Number.parseInt(r.hours))return 1;if(i.hours===r.hours){if(Number.parseInt(i.minutes)<Number.parseInt(r.minutes))return-1;if(Number.parseInt(i.minutes)>Number.parseInt(r.minutes))return 1}return 0}function c2(t,e=7){let i=Ze(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return Hs(n)}function J0e(t){return c2(t)}function Q0e(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),Hs(n,i)}function Z0e(t,e,i){let r=new Date(t,0);return Hs(new Date(r.setDate(e)),i)}function ir(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(us),n=nE(e).setHours(i,r,0,0);return nE(n)}function UU(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function aa(t,e){let i=fi(t);if(!i)return"00:00";let r=Number.isNaN(e)?0:e;return fi(d2(ir(i),r).toISOString())||"00:00"}function d2(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function us(t){return t.toString()[1]?t:"0"+t}function Su(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var cne={addDays:c2,addWeek:J0e,addMinutesToTimeString:aa,convertTime:Wm,getIsoDateString:rE,getUTCdateString:l2,DateHHMM:j0e,extractDate:Ze,extractTime:fi,formatDate:Hs,getDateByWeek:Q0e,isISODateString:ru,isValidEmbargoDate:cd,isDate:lw,isTimeString:u2,offsetDate:nE,offsetTime:W0e,sameDay:Su,timeStringMinutes:Nt,timeToDate:ir,timeUTC:H0e,validTimeValue:Wv,validDateString:cb,timeValidation:Ip,dateValidation:yl},e_e=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),t_e=t=>t.filter(Boolean).every(Ni);function yg(t,e){return`${t}-${e}`}function zp(t){let e=t.category;if(typeof e!="object"||!e)return{error:rw};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s}=e,o=e.categoryName,l;if(!(e_e([i,r,n,o],"string")&&t_e([a,s])&&[r,n].filter(Boolean).every(kn)))return{error:rw};let u=t.consideredDate??Ze(new Date().toLocaleDateString("sv"));if(!u||!kn(u))return{error:Yi};let[c]=u.split("-").slice(0,3).map(L=>Number.parseInt(L)),d=Fy(u,-1);if(!d)return{error:Yi};let[p,f]=d.split("-").slice(1,3).map(L=>Number.parseInt(L)),h=`${us(p)}-${us(f)}`,m=Fy(u,1);if(!m)return{error:Yi};let[g,I]=m.split("-").slice(1,3).map(L=>Number.parseInt(L)),v=`${us(g)}-${us(I)}`,w=s&&Fy(u,-1*365*s),y=a&&Fy(u,-1*365*a),b=[],S=L=>!b.includes(L)&&b.push(L);i=i??o;let U=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,D=i?.includes("-"),P=D&&i?.match(T),E=i?.match(U);function R(L){let $=c-L,V=yg($,v);e.ageMinDate&&e.ageMinDate!==V&&S(`Invalid submitted ageMinDate: ${n}`),n=V,i&&(e.ageMax&&e.ageMax!==L-1&&(S(`Invalid submitted ageMax: ${a}`),y=void 0),a=L-1)}function C(L){let $=c-L-1,V=yg($,v);e.ageMin&&e.ageMin>L&&S(`Invalid submitted ageMin: ${s}`),e.ageMax&&e.ageMax>L&&S(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==V&&S(`Invalid submitted ageMinDate: ${n}`),n=V,i&&(e.ageMax&&e.ageMax!==L&&(S(`Invalid submitted ageMax: ${a}`),w=void 0),a=L)}function M(L){let $=c-L,V=yg($,h);e.ageMaxDate&&e.ageMaxDate!==V&&S(`Invalid submitted ageMaxDate: ${r}`),r=V,i&&(e.ageMin&&e.ageMin!==L+1&&(S(`Invalid submitted ageMin: ${s}`),w=void 0),s=L+1)}function N(L){let $=c-L-1,V=yg($,h);e.ageMaxDate&&e.ageMaxDate!==V&&S(`Invalid submitted ageMaxDate: ${r}`),r=V,i&&(e.ageMin&&e.ageMin!==L&&(S(`Invalid submitted ageMin: ${s}`),w=void 0),s=L)}function A(L){let $=U.exec(L)||[],[V,_,B]=$.slice(1),G=Number.parseInt(_);V==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),R(G)):V==="O"&&M(G),B==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),C(G)):B==="O"&&N(G),r=(r??w)||void 0,n=(n??y)||void 0}function O(){if(r=void 0,n=void 0,a=void 0,s=void 0,e.ageMin){let V=c-e.ageMin;r=yg(V,h)}if(e.ageMax){let V=c-e.ageMax-1;n=yg(V,v)}let[L,$]=(i?.match(T)??[]).slice(1).map(V=>Number.parseInt(V));L<=$?(s=L,a=$,l=!0):S(`Invalid combined age range ${i}`)}function k(){s&&M(s),a&&C(a)}function F(){P?O():D?i?.split("-").forEach(A):E&&i?A(i):k()}F(),a&&e?.ageMin&&e?.ageMin>a&&(S(`Invalid submitted ageMin: ${e?.ageMin}`),s=void 0);let x=je({consideredDate:u,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s});return b.length&&(x.errors=b),x}function uw({category:t}){if(!Ut(t))return{error:re};let e=zp({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!Ni(i)?q({result:{error:re},context:{ratingMax:i}}):r&&!Ni(r)?q({result:{error:re},context:{ratingMin:r}}):{...e}}function TU({childCategory:t,withDetails:e,category:i}){let r=uw({category:i}),n=uw({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),s=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),o=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),u=i?.ratingType&&t?.ratingType&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=i?.ballType&&t?.ballType&&i.ballType!==t.ballType,d=je({invalidRatingRange:u,invalidAgeMinDate:o,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:s,invalidAgeMin:a,valid:!u&&!o&&!l&&!c&&!s&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function DU({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:s}){a=a??s?.gender;let o="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),q({result:{errors:l,error:zc},stack:o});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:f,matchUpFormat:h,matchUpValue:m,matchUpType:g,scoreValue:I,setValue:v,category:w,gender:y}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof f!="number"&&l.push(`matchUpCount is not type number: ${f}`),g&&!wh([qt,Vt],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!u?.length].concat([m,d,I,v].map(ct)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&f){let b=Uie({collectionValueProfiles:u,matchUpCount:f});b.errors&&l.push(...b.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),h&&!qa({matchUpFormat:h})&&l.push(`Invalid matchUpFormat: ${h}`),r){let b=YM({referenceGender:a,matchUpType:g,gender:y});if(b.error)return q({context:{referenceGender:a,gender:y},result:b,stack:o})}if(t&&n&&w){let b=TU({category:n,childCategory:w});if(!b.valid)return q({result:{error:rw},context:b,stack:o})}return l.length?q({result:{errors:l,error:Nre},stack:o}):{valid:!0}}function qn(t){let e=!!(t?.enforceCategory!==!1&&t?.category),i=!!(t?.enforceGender!==!1&&t?.gender),r=t?.checkCollectionIds,n=t?.tieFormat,a=t?.event,s="validateTieFormat",o=[],l=i_e({...t,stack:s});if(l?.error)return l;let u,c=n.collectionDefinitions.every(m=>{let{setValue:g,scoreValue:I,collectionValue:v}=m;(g||I)&&!v&&(u=!0);let{valid:w,errors:y}=DU({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:m,checkCollectionIds:r,checkCategory:e,checkGender:i,event:a});return w?!0:(Array.isArray(y)&&o.push(...y),!1)}),d=typeof n.winCriteria?.valueGoal=="number"&&n.winCriteria?.valueGoal>0&&!u||n.winCriteria?.aggregateValue;if(!(d||n.winCriteria?.aggregateValue))return u?o.push("aggregateValue is required"):o.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),q({context:{tieFormat:n,errors:o,aggregateValueImperative:u},result:{error:iu},stack:s});let p=n.collectionDefinitions.map(({collectionId:m})=>m),f=!r||p.length===lt(p).length,h=c&&d&&f;return h?{valid:h,errors:o}:q({result:{error:iu},context:{tieFormat:n,errors:o},stack:s})}function i_e(t){let{tieFormat:e,stack:i}=t;return!t||!e||!Ut(e)?q({result:{error:iu},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):Ut(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...W}:q({result:{error:iu},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):q({result:{error:iu},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var oE="resourceSubType",lE="resourceType",AI="identifier",Yx="name",r_e={RESOURCE_SUB_TYPE:oE,RESOURCE_TYPE:lE,IDENTIFIER:AI,NAME:Yx};function xe(t,e,i,r,n=0){if(qx().makeDeepCopy)return qx().makeDeepCopy(t,e,i,r);let a=i2(),{stringify:s,toJSON:o,ignore:l,modulate:u}=a||{};if(!a?.enabled&&!i||typeof t!="object"||ya(t)||t===null||typeof a?.threshold=="number"&&n>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(f=>!i||!l||Array.isArray(l)&&!l.includes(f)||ya(l)&&!l(f)),p=(f,h)=>{c[f]=ya(h?.toString)?h.toString():JSON.stringify(h)};for(let f of d){let h=t[f],m=ya(u)?u(h):void 0;if(m!==void 0)c[f]=m;else if(e&&f==="extensions"&&Array.isArray(h)){let g=p2(h);Object.assign(c,...g)}else r&&f==="extensions"?c[f]=[]:Array.isArray(s)&&s.includes(f)?p(f,h):Array.isArray(o)&&o.includes(f)&&ya(h?.toJSON)?c[f]=h.toJSON():h===null?c[f]=void 0:V0e(h)?c[f]=new Date(h).toISOString():c[f]=xe(h,e,i,r,n+1)}return c}function p2(t){return t?.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function dne(t=1,e){return Ce(0,t).map(()=>Et(e))}function Et(t){let e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);let i=Math.trunc(Math.random()*4294967295),r=Math.trunc(Math.random()*4294967295),n=Math.trunc(Math.random()*4294967295),a=Math.trunc(Math.random()*4294967295),s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${s.replaceAll("-","")}`:s}var pne={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},fne={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},hne={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},mne={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},gne={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},Ine={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},vne={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},yne={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},bne={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},wne={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Ws="SET3-S:6/TB7",n_e="SET3-S:6NOAD",Sne="SET3-S:6/TB7-F:TB10",a_e="SET3-S:4/TB7",s_e="SET3-S:4/TB5@3",o_e="SET1-S:T20",l_e="SET1-S:8/TB7",u_e="SET1-S:8/TB7@7",c_e={FORMAT_STANDARD:Ws,FORMAT_STANDARD_NOAD:n_e,FORMAT_ATP_DOUBLES:Sne,FORMAT_SHORT_SETS:a_e,FORMAT_FAST4:s_e,FORMAT_PRO_SET:l_e,FORMAT_COLLEGE_PRO_SET:u_e,TIMED20:o_e},Une={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},Tne={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},Dne={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},Pne={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},Ene={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},Rne={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},Cne={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},uE="COLLEGE_DEFAULT",Kx="COLLEGE_JUCO",Xx="COLLEGE_D3",Mne="DOMINANT_DUO",Nne="DOMINANT_DUO_MIXED",Ane="LAVER_CUP",kne="TEAM_DOUBLES_3_AGGREGATION",One="TIME_TENNIS_DUAL",xne="TIME_TENNIS_PRO_CIRCUIT",Fne="USTA_BREWER_CUP",Lne="USTA_OZAKI_CUP",_ne="USTA_COLLEGE",$ne="USTA_GOLD_TEAM_CHALLENGE",Bne="USTA_LEVEL_1",Vne="USTA_INTERSECTIONAL",jne="USTA_SECTION_BATTLE",Gne="USTA_SOUTHERN_LEVEL_5",Hne="USTA_TOC",Wne="USTA_WTT_ITT",zne="USTA_ZONAL",d_e={COLLEGE_D3:Xx,COLLEGE_DEFAULT:uE,COLLEGE_JUCO:Kx,DOMINANT_DUO:Mne,DOMINANT_DUO_MIXED:Nne,LAVER_CUP:Ane,TEAM_DOUBLES_3_AGGREGATION:kne,TIME_TENNIS_DUAL:One,TIME_TENNIS_PRO_CIRCUIT:xne,USTA_BREWER_CUP:Fne,USTA_OZAKI_CUP:Lne,USTA_COLLEGE:_ne,USTA_GOLD_TEAM_CHALLENGE:$ne,USTA_INTERSECTIONAL:Vne,USTA_LEVEL_1:Bne,USTA_SECTION_BATTLE:jne,USTA_SOUTHERN_LEVEL_5:Gne,USTA_TOC:Hne,USTA_WTT_ITT:Wne,USTA_ZONAL:zne},qne="STANDARD",qq={[qne]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[Xx]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Ws,matchUpCount:6,matchUpValue:1},tieFormatName:Xx,valueGoal:5},[uE]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:Ws,matchUpCount:6,matchUpValue:1},tieFormatName:uE,valueGoal:4},[Kx]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Ws,matchUpCount:6,matchUpValue:1},tieFormatName:Kx,valueGoal:5},[Ane]:Rne,[Mne]:Une,[Nne]:vne,[kne]:fne,[One]:yne,[xne]:Ine,[Fne]:bne,[Lne]:wne,[_ne]:Tne,[$ne]:pne,[Vne]:gne,[Bne]:Dne,[jne]:mne,[Gne]:hne,[Wne]:Pne,[Hne]:Cne,[zne]:Ene},p_e=t=>{let e=t?.namedFormat&&Object.keys(qq).includes(t.namedFormat)?t.namedFormat:qne,i=Array.isArray(t?.uuids)?t?.uuids:[],r,{category:n,gender:a}=t?.event??{},s=xe(qq[e],!1,!0),o=l=>{if(!t?.isMock&&!t?.event?.isMock||!t.event)return i?.pop()??Et();let u=t?.event?.eventId;return i.pop()??`${u}-COL-${l+1}`};return s.hydrate?(r={winCriteria:{valueGoal:s.valueGoal},collectionDefinitions:[{collectionId:o(0),matchUpFormat:Sne,collectionName:"Doubles",matchUpType:Vt,...s.doubles},{collectionId:o(1),matchUpFormat:Ws,collectionName:"Singles",matchUpType:qt,...s.singles}]},s.tieFormatName&&(r.tieFormatName=s.tieFormatName)):(s.collectionDefinitions.forEach((l,u)=>l.collectionId=o(u)),r=s),t?.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},Pc=p_e,bl="SINGLES",Yh="SINGLES",Is="DOUBLES",Ec="DOUBLES",lr="TEAM",Ca="TEAM",f_e="RATING",h_e="BOTH",m_e={AGE:"AGE",BOTH:h_e,DOUBLES:Is,DOUBLES_EVENT:Ec,RATING:f_e,SINGLES:bl,SINGLES_EVENT:Yh,TEAM_EVENT:Ca,TEAM:lr},ke="MAIN",ze="QUALIFYING",rn="CONSOLATION",Mr="VOLUNTARY_CONSOLATION",ki="PLAY_OFF",XM=[ke,ze,rn,ki,Mr],Kh={[ze]:1,[ke]:2,[ki]:3,[rn]:3,[Mr]:4},Yne="finishingPositions",Kne="aggregateEventStructures",Xne={[ke]:1,[ki]:2,[rn]:3,[ze]:4,[Mr]:5},g_e={[ki]:1,[ke]:2,[rn]:3,[ze]:4,[Mr]:5},PU="CLUSTER",JM="ADJACENT",Jne="SEPARATE",qp="WATERFALL",QM="ITEM",In="CONTAINER",So="DRAW",ZM="RANDOM",Fs="TOP_DOWN",Yp="BOTTOM_UP",Uu="POSITION",Tu="WINNER",Du="LOSER",wl="FIRST_MATCHUP",ma="AD_HOC",I_e="AD_HOC",zv="FEED_IN",kI="COMPASS",OI="OLYMPIC",v_e="SINGLE_ELIMINATION",al="SINGLE_ELIMINATION",EU="DOUBLE_ELIMINATION",xI="FIRST_MATCH_LOSER_CONSOLATION",RU="FIRST_ROUND_LOSER_CONSOLATION",Tf="LUCKY_DRAW",eN="CURTIS_CONSOLATION",y_e="CURTIS_CONSOLATION",f2="FEED_IN_CHAMPIONSHIP_TO_SF",cw="FEED_IN_CHAMPIONSHIP_TO_SF",h2="FEED_IN_CHAMPIONSHIP_TO_QF",dw="FEED_IN_CHAMPIONSHIP_TO_QF",m2="FEED_IN_CHAMPIONSHIP_TO_R16",pw="FEED_IN_CHAMPIONSHIP_TO_R16",Qne="MODIFIED_FEED_IN_CHAMPIONSHIP",fw="MODIFIED_FEED_IN_CHAMPIONSHIP",CU="FEED_IN_CHAMPIONSHIP",MU="PLAYOFF",tN="CUSTOM",b_e="DOUBLE_ROUND_ROBIN",no="ROUND_ROBIN",Pu="ROUND_ROBIN_WITH_PLAYOFF",Zne="DECIDER",eae="BACKDRAW",g2={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},I2={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Kp="WIN_RATIO",zm="ROUND_OUTCOME",tae=[kI,eN,dw,pw,cw,CU,h2,m2,f2,xI,RU,Tf,fw,OI,MU,Pu],w_e=[ma,kI,eN,EU,dw,pw,cw,CU,zv,xI,RU,Tf,fw,OI,MU,no,Pu,al,tN],iae={MAIN:ke,QUALIFYING:ze,CONSOLATION:rn,ITEM:QM,CONTAINER:In,FIRST_MATCHUP:wl,WINNER:Tu,LOSER:Du,AD_HOC:ma,FEED_IN:zv,FLEX_ROUNDS:I_e,COMPASS:kI,PLAY_OFF:ki,PLAYOFF:MU,OLYMPIC:OI,KNOCKOUT:v_e,SINGLE_ELIMINATION:al,DOUBLE_ELIMINATION:EU,CURTIS:eN,FICSF:f2,FICQF:h2,FICR16:m2,MFIC:Qne,VOLUNTARY_CONSOLATION:Mr,FIRST_MATCH_LOSER_CONSOLATION:xI,FIRST_ROUND_LOSER_CONSOLATION:RU,MODIFIED_FEED_IN_CHAMPIONSHIP:fw,FEED_IN_CHAMPIONSHIP_TO_R16:pw,FEED_IN_CHAMPIONSHIP_TO_QF:dw,FEED_IN_CHAMPIONSHIP_TO_SF:cw,FEED_IN_CHAMPIONSHIP:CU,LUCKY_DRAW:Tf,CUSTOM:tN,ROUND_ROBIN_WITH_PLAYOFF:Pu,ROUND_ROBIN:no,DECIDER:Zne,BACKDRAW:eae,COMPASS_ATTRIBUTES:g2,OLYMPIC_ATTRIBUTES:I2,DRAW:So,RANDOM:ZM,TOP_DOWN:Fs,BOTTOM_UP:Yp,CLUSTER:PU,ADJACENT:JM,SEPARATE:Jne,WATERFALL:qp,WIN_RATIO:Kp,ROUND_OUTCOME:zm,MULTI_STRUCTURE_DRAWS:tae,generatedDrawTypes:w_e,stageOrder:Kh,finishOrder:Xne,AGGREGATE_EVENT_STRUCTURES:Kne,FINISHING_POSITIONS:Yne},S_e=iae,fn="tournamentRecords",v2="policyDefinitions",gr="tournamentRecord",y2="onlineResource",vn="drawDefinition",rae="tieFormatName",b2="matchUpFormat",Eu="participantId",nae="scheduleDates",U_e="tournamentId",T_e="scheduleDate",D_e="roundNumber",iN="structureId",w2="participant",NU="matchUpIds",aae="entryStage",P_e="policyType",sae="structures",S2="eventType",Ol="matchUpId",rN="tieFormat",nN="inContext",aN="structure",sN="courtIds",E_e="personId",oN="venueIds",U2="matchUps",oae="courtId",lae="eventId",Vu="matchUp",uae="drawId",zs="error",qc="event",qv="param",T2="uuids",R_e="averageMatchUpMinutes",C_e="recoveryMinutes",M_e="periodLength",N_e="number",Zn="object",on="array",Yr="_validate",cae="_message",Ya="_invalid",Jn="_ofType",D2="_anyOf",FI="_oneOf",Yq={[y2]:t=>_i(Object.keys(t),[oE,lE,AI]).length===3,[rae]:t=>t&&Pc({namedFormat:t}),[T2]:t=>!t||Array.isArray(t)&&t.every(ai),[rN]:t=>!qn({tieFormat:t}).error,[S2]:t=>[bl,Is,lr].includes(t),[aae]:t=>XM.includes(t)},A_e={[fn]:Ci,[gr]:Ie,[v2]:OM,[vn]:$e,[Eu]:pr,[b2]:Yie,[U_e]:EI,[iN]:es,[NU]:$m,[w2]:Vm,[y2]:zc,[S2]:bu,[sae]:xB,[Ol]:Dn,[rN]:iu,[aN]:wf,[oae]:Bm,[U2]:Bu,[lae]:gs,[Vu]:pa,[sN]:Je,[oN]:Je,[uae]:jo,[qc]:ci},k_e={[fn]:Zn,[v2]:Zn,[gr]:Zn,[vn]:Zn,[y2]:Zn,[nae]:on,[w2]:Zn,[NU]:on,[sae]:on,[rN]:Zn,[aN]:Zn,[sN]:on,[oN]:on,[U2]:on,[Vu]:Zn,[qc]:Zn,[T2]:on};function He(t,e,i){if(!t&&!Ut(t))return{error:re};if(!e?.length||t?._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:re};let{paramError:r,errorParam:n}=F_e(t,e);if(!r)return{valid:!0};let a=r[Yr]&&(r[zs]||r[Ya])||t?.[n]===void 0&&(r[zs]||r[Ya]||A_e[n]||re)||re,s=n??(r[FI]&&Object.keys(r[FI]).join(", "));return q({info:{param:s,message:r[cae]},result:{error:a},stack:i})}function dae(t,e){let i=Object.keys(t),r=Object.keys(e);return _i(i,r)}function O_e(t,e){if(!e)return;let i=dae(t,e);return i.length!==1?{error:re}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function x_e(t,e){if(!e)return;let i=dae(t,e).filter(r=>t[r]);return i.length<1?{error:re}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function F_e(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:s,_validate:o,_info:l,...u})=>{let c=a&&O_e(t,a);if(c?.error)return c.error;c&&Object.assign(u,c);let d=s&&x_e(t,s);if(d?.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(h=>typeof u[h]=="boolean"),f=p.find(h=>{let m=o&&!ya(o),g=t[h]!==void 0&&!o&&L_e(t,h,n),I=u[h]&&[void 0,null].includes(t[h]),v=m||g||I||o&&t[h]!==void 0&&!__e(t[h],o)||Yq[h]&&!Yq[h](t[h]);return v&&(i=h,r=l),v});return!p.length||f}),errorParam:i,paramInfo:r}}function L_e(t,e,i){return i=i||k_e[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function __e(t,e){return ya(e)?e(t):!0}var P2="DYNAMIC",Ru="RANKING",md="RATING",Rd="SCALE",nu="SEEDING",$_e={RANKING:Ru,RATING:md,SCALE:Rd,SEEDING:nu};function Yv(t){let e=He(t,[{[w2]:!0}]);if(e.error)return e;let i=t.participant.timeItems?.filter(({itemType:n})=>n?.startsWith(Rd)&&[Ru,md,nu].includes(n.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(i?.length){let n=s=>i.filter(o=>o?.itemType===s).sort((o,l)=>new Date(o.createdAt||void 0).getTime()-new Date(l.createdAt||void 0).getTime()).pop(),a=lt(i.map(({itemType:s})=>s));for(let s of a){let o=n(s);if(o){let[,l,u,c,d]=o.itemType.split("."),p=d?`${c}.${d}`:c,f=l===nu&&"seedings"||l===Ru&&"rankings"||"ratings";r[f][u]||(r[f][u]=[]),r[f][u].push({scaleValue:o.itemValue,scaleDate:o.itemDate,scaleName:p})}}}return{...W,...r}}function Xh(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,s,o){if(!a||!s)return;let l=Object.keys(a),u=Object.keys(s),c=Object.assign({},...u.filter(f=>f.indexOf("||")).map(f=>f.split("||").map(h=>({[h]:f}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let f of l)if(d.indexOf(f)>=0||p){let h=c[f]||f,m=s[h]||p,g=a[f];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let I=g.map(v=>{let w={};return n(v,m,w)!==!1?w:void 0}).filter(Boolean);o[f]=I}else g&&(o[f]={},n(g,m,o[f]));else{let I=a[f];if(Array.isArray(m)&&!m.includes(I))return!1;(s[f]||p&&s[f]!==!1)&&(o[f]=I)}}}}var Jx="voluntaryConsolation",ic="competitiveBands",E2="roundRobinTally",Cu="positionActions",Nr="matchUpActions",kD="rankingPoints",Rc="roundNaming",Kv="participant",hw="progression",Zd="scheduling",mw="avoidance",B_e="participant",V_e="display",vs="scoring",As="seeding",LI="feedIn",j_e="audit",cE="draws",G_e={POLICY_TYPE_VOLUNTARY_CONSOLATION:Jx,POLICY_TYPE_COMPETITIVE_BANDS:ic,POLICY_TYPE_ROUND_ROBIN_TALLY:E2,POLICY_TYPE_POSITION_ACTIONS:Cu,POLICY_TYPE_MATCHUP_ACTIONS:Nr,POLICY_TYPE_RANKING_POINTS:kD,POLICY_TYPE_ROUND_NAMING:Rc,POLICY_TYPE_PARTICIPANT:Kv,POLICY_TYPE_PROGRESSION:hw,POLICY_TYPE_SCHEDULING:Zd,POLICY_TYPE_AVOIDANCE:mw,POLICY_TYPE_DISPLAY:V_e,POLICY_TYPE_PRIVACY:B_e,POLICY_TYPE_FEED_IN:LI,POLICY_TYPE_SCORING:vs,POLICY_TYPE_SEEDING:As,POLICY_TYPE_AUDIT:j_e,POLICY_TYPE_DRAWS:cE};function Cd({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let s=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),o=xe(s,!1,n);if(o){let l=e?.[Kv];if(i?.withScaleValues){let{ratings:u,rankings:c}=Yv({participant:o});o.rankings=c,o.ratings=u}if(l?.participant)return Xh({template:l.participant,source:o})}return o}var H_e="element required",W_e="missing name";function On(t){if(!t||typeof t!="object")return{error:Je};if(t.element&&typeof t?.element!="object")return{error:re};if(!t?.name)return{error:Je,info:W_e};if(!t?.element){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=On({element:i,name:t.name});if(r.error)return q({result:r,stack:"removeExtension"})}return{...W}}return{error:Je,info:H_e}}return t?.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>e?.name!==t.name),{...W}):{...W,info:Gr}}function Sl({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function It(t){if(typeof t!="object")return{error:Je};let e="addExtension";if(t?.element&&typeof t.element!="object")return q({result:{error:re},stack:e});if(!Sl({extension:t.extension}))return q({result:{error:re,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=It({extension:t.extension,element:r});if(n.error)return q({result:n,stack:e})}return{...W}}else return q({result:{error:Je},stack:e});if(t.element.extensions||(t.element.extensions=[]),t?.creationTime??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...W}}function R2(t){return!t||typeof t!="object"?{error:Je}:t.tournamentRecord?It({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:Ie}}function lN(t){return!t||typeof t!="object"?{error:Je}:t.drawDefinition?It({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:za}}function ep(t){return!t||typeof t!="object"?{error:Je}:t.event?It({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:gs}}function pae(t){if(!t||typeof t!="object")return{error:Je};if(!t.participantId)return{error:pr};let e=t.tournamentRecord?.participants||[],i=Cd({participantId:t.participantId,tournamentParticipants:e});return i?It({creationTime:t.creationTime,extension:t.extension,element:i}):{error:Gi}}function C2(t){return!t||typeof t!="object"?{error:Je}:t.tournamentRecord?On({element:t.tournamentRecord,name:t.name}):{error:Ie}}function fae(t){return!t||typeof t!="object"?{error:Je}:t.drawDefinition?On({element:t.drawDefinition,name:t.name}):{error:za}}function uN(t){return!t||typeof t!="object"?{error:Je}:t?.event?On({element:t.event,name:t.name}):{error:gs}}function hae(t){if(!t||typeof t!="object")return{error:Je};if(!t.participantId)return{error:pr};let e=t.tournamentRecord?.participants||[],i=Cd({participantId:t.participantId,tournamentParticipants:e});return i?On({element:i,name:t.name}):{error:Gi}}function AU({tournamentRecords:t}){return{tournamentIds:Ut(t)?Object.keys(t):[],...W}}var z_e="extensionQueries";function rt({discover:t,element:e,name:i,...r}){if(!e||!i){if(t&&r){let a=Object.keys(r).filter(l=>typeof t=="boolean"||Array.isArray(t)&&t.includes(l)).find(l=>Array.isArray(r[l]?.extensions)?r[l].extensions.find(u=>u?.name===i):!1),s=a&&r[a];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(l=>l.extensions?.length));let o=s?.extensions?.find(l=>l?.name===i);return{extension:o,info:o?void 0:Gr}}return q({result:{error:Je},stack:z_e})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let n=e.extensions.find(a=>a?.name===i);return{extension:n,info:n?void 0:Gr}}var q_e="activeSuspension",gw="appliedPolicies",mae="context",cN="delegatedOutcome",Eo="disabled",Jh="disableAutoCalc",dN="disableLinks",dE="display",Tp="drawDeletions",Y_e="drawProfile",pE="entryProfile",K_e="eventProfile",X_e="eventWithdrawalRequests",J_e="factory",ao="flightProfile",Qx="groupingAttribute",Cc="lineUps",Xp="linkedTournamentsIds",En="mutationLocks",M2="participantRepresentatives",Xv="personRequests",Xg="positionActions",Q_e="rankingPoints",Z_e="registration",xl="roundTarget",kU="scheduleLimits",Mc="scheduleTiming",Qh="schedulingProfile",e$e="statusDetail",_I="subOrder",Nc="tally",db="tieFormatModification",gae={ACTIVE_SUSPENSION:q_e,APPLIED_POLICIES:gw,CONTEXT:mae,DELEGATED_OUTCOME:cN,DISABLED:Eo,DISABLE_LINKS:dN,DISABLE_AUTO_CALC:Jh,DISPLAY:dE,DRAW_DELETIONS:Tp,DRAW_PROFILE:Y_e,ENTRY_PROFILE:pE,EVENT_PROFILE:K_e,EVENT_WITHDRAWAL_REQUESTS:X_e,FLIGHT_PROFILE:ao,GROUPING_ATTRIBUTE:Qx,LINEUPS:Cc,LINKED_TOURNAMENTS:Xp,MUTATION_LOCKS:En,PARTICIPANT_REPRESENTATIVES:M2,PERSON_REQUESTS:Xv,POSITION_ACTIONS:Xg,RANKING_POINTS:Q_e,REGISTRATION:Z_e,ROUND_TARGET:xl,SCHEDULE_LIMITS:kU,SCHEDULE_TIMING:Mc,SCHEDULING_PROFILE:Qh,STATUS_DETAIL:e$e,SUB_ORDER:_I,TALLY:Nc,TIE_FORMAT_MODIFICATIONS:db,FACTORY:J_e},Kq=[cN,Eo,Jh,dN,ao,Cc,Xp,En,M2,Xv,xl,kU,Mc,Qh,_I,Nc,db];function Iae({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let e=AU({tournamentRecords:t}),{tournamentIds:i}=e;return i?.length>1?It({tournamentRecords:t,discover:!0,extension:{name:Xp,value:{tournamentIds:i}}}):{...W}}function vae({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let e=On({name:Xp,tournamentRecords:t,discover:!0});return q({result:e,stack:"unlinkTournaments"})}function yae({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:re};if(!e)return{error:EI};let i=AU({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:EI};let n;return r.every(a=>{let s=t[a],{extension:o}=rt({element:s,name:Xp});if(!o)return!0;let l=o?.value?.tournamentIds||[];if(!l?.length||l.length===1&&l.includes(e)||a===e){let d=C2({name:Xp,tournamentRecord:s});return d.error&&(n=d.error),d.success}let u=l.filter(d=>d!==e);o.value={tournamentIds:u};let c=R2({tournamentRecord:s,extension:o});return c.error&&(n=c.error),c.success}),n?{error:n}:{...W}}var bae={};ft(bae,{getLinkedTournamentIds:()=>OU,getTournamentIds:()=>AU});function OU({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Ci}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{let i=t[e],r=i?.tournamentId,{extension:n}=rt({element:i,name:Xp}),a=(n?.value?.tournamentIds||[]).filter(s=>s!==r);return{[e]:a}}))}}var wae={};ft(wae,{adHocPositionSwap:()=>Ooe,addAdHocMatchUps:()=>VN,addDrawDefinitionTimeItem:()=>FV,addFinishingRounds:()=>XU,addGoesTo:()=>Qp,addPlayoffStructures:()=>BN,addQualifyingStructure:()=>koe,addVoluntaryConsolationStage:()=>Poe,addVoluntaryConsolationStructure:()=>UV,allPlayoffPositionsFilled:()=>kV,alternateDrawPositionAssignment:()=>poe,assignDrawPosition:()=>Xoe,assignDrawPositionBye:()=>ns,attachConsolationStructures:()=>zoe,attachPlayoffStructures:()=>XV,attachQualifyingStructure:()=>xV,attachStructures:()=>$N,autoSeeding:()=>Wze,automatedPlayoffPositioning:()=>sy,automatedPositioning:()=>aT,buildDrawHierarchy:()=>Gze,checkValidEntries:()=>WN,deleteAdHocMatchUps:()=>Qoe,drawMatic:()=>kj,findDrawDefinition:()=>tj,generateAdHocMatchUps:()=>zN,generateAdHocRounds:()=>Aj,generateAndPopulatePlayoffStructures:()=>YV,generateDrawDefinition:()=>ST,generateDrawMaticRound:()=>uj,generateDrawStructuresAndLinks:()=>sj,generateDrawTypeAndModifyDrawDefinition:()=>oj,generateQualifyingStructure:()=>jV,generateVoluntaryConsolation:()=>Mle,getAssignedParticipantIds:()=>Af,getAvailableMatchUpsCount:()=>jN,getAvailablePlayoffProfiles:()=>lT,getDrawDefinitionTimeItem:()=>X2,getDrawParticipantRepresentativeIds:()=>ZV,getDrawStructures:()=>so,getDrawTypeCoercion:()=>mT,getEligibleVoluntaryConsolationParticipants:()=>QV,getMatchUpsMap:()=>xr,getParticipantIdFinishingPositions:()=>ej,getPositionAssignments:()=>GI,getPositionsPlayedOff:()=>oy,getRandomQualifierList:()=>nj,getSeedingThresholds:()=>EV,getSeedsCount:()=>gT,getStructureSeedAssignments:()=>ys,getTeamLineUp:()=>Jp,getValidGroupSizes:()=>rT,isAdHoc:()=>Yn,isCompletedStructure:()=>Au,isValidForQualifying:()=>aj,luckyLoserDrawPositionAssignment:()=>soe,modifyDrawDefinition:()=>qoe,modifyDrawName:()=>JV,modifySeedAssignment:()=>yoe,mutate:()=>Sae,positionActions:()=>rj,pruneDrawDefinition:()=>Koe,qualifierDrawPositionAssignment:()=>OV,qualifierProgression:()=>boe,query:()=>tle,removeDrawPositionAssignment:()=>bw,removeRoundMatchUps:()=>Zoe,removeSeededParticipant:()=>Aoe,removeStructure:()=>Toe,renameStructures:()=>Uoe,resetDrawDefinition:()=>Yoe,resetQualifyingStructure:()=>Eoe,resetVoluntaryConsolationStructure:()=>$ae,setDrawParticipantRepresentativeIds:()=>Uae,setPositionAssignments:()=>coe,setStructureOrder:()=>woe,setSubOrder:()=>ele,shiftAdHocRounds:()=>uoe,swapAdHocRounds:()=>doe,swapDrawPositionAssignments:()=>Moe,updateTeamLineUp:()=>ag,withdrawParticipantAtDrawPosition:()=>Qse});var Sae={};ft(Sae,{adHocPositionSwap:()=>Ooe,addAdHocMatchUps:()=>VN,addDrawDefinitionTimeItem:()=>FV,addPlayoffStructures:()=>BN,addQualifyingStructure:()=>koe,addVoluntaryConsolationStage:()=>Poe,addVoluntaryConsolationStructure:()=>UV,alternateDrawPositionAssignment:()=>poe,assignDrawPosition:()=>Xoe,assignDrawPositionBye:()=>ns,attachConsolationStructures:()=>zoe,attachPlayoffStructures:()=>XV,attachQualifyingStructure:()=>xV,attachStructures:()=>$N,automatedPlayoffPositioning:()=>sy,automatedPositioning:()=>aT,deleteAdHocMatchUps:()=>Qoe,luckyLoserDrawPositionAssignment:()=>soe,modifyDrawDefinition:()=>qoe,modifyDrawName:()=>JV,modifySeedAssignment:()=>yoe,pruneDrawDefinition:()=>Koe,qualifierDrawPositionAssignment:()=>OV,qualifierProgression:()=>boe,removeDrawPositionAssignment:()=>bw,removeRoundMatchUps:()=>Zoe,removeSeededParticipant:()=>Aoe,removeStructure:()=>Toe,renameStructures:()=>Uoe,resetDrawDefinition:()=>Yoe,resetQualifyingStructure:()=>Eoe,resetVoluntaryConsolationStructure:()=>$ae,setDrawParticipantRepresentativeIds:()=>Uae,setPositionAssignments:()=>coe,setStructureOrder:()=>woe,setSubOrder:()=>ele,shiftAdHocRounds:()=>uoe,swapAdHocRounds:()=>doe,swapDrawPositionAssignments:()=>Moe,updateTeamLineUp:()=>ag,withdrawParticipantAtDrawPosition:()=>Qse});var N2=t=>e=>t[e],A2=(t=[])=>t.map(yr).filter(Boolean),Zx=(t=[])=>t.map(wt).filter(Boolean),wt=(t={})=>N2(t)("participantId"),yr=(t={})=>N2(t)("matchUpId"),$I=(t={})=>N2(t)("drawId");function Uae({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:za};if(!Array.isArray(t))return{error:re};let i=Zx(e?.entries||[]);return t.length&&_i(t,i).length<t.length?{error:re}:lN({drawDefinition:e,extension:{name:M2,value:t}})}var Ma="ABANDONED",qm="AWAITING_RESULT",Fl="CANCELLED",xi="COMPLETED",Jv="DEAD_RUBBER",Yt="DEFAULTED",zi="DOUBLE_DEFAULT",Ui="DOUBLE_WALKOVER",ho="IN_PROGRESS",Na="INCOMPLETE",k2="NOT_PLAYED",Ur="RETIRED",tp="SUSPENDED",$i="TO_BE_PLAYED",si="WALKOVER",t$e=[qm,xi,Yt,ho,Na,Ur,tp],Tae=[qm,xi,Yt,Ui,zi,ho,Na,Ur,tp,si],Dae=[Ma,qm,"BYE",Fl,xi,Jv,Yt,Ui,zi,ho,Na,k2,Ur,tp,$i,si],Pae=["BYE",Ui,zi,xi,Yt,Ur,si],Eae=[Ma,qm,Fl,Jv,ho,Na,k2,tp,$i,void 0],Qi=[Fl,Ma,xi,Jv,Yt,Ui,zi,Ur,si],O2=[Ma,xi,Yt,Ui,zi,ho,Ur,si],Rae=[ho,Na,tp,$i],pN={ABANDONED:Ma,AWAITING_RESULT:qm,BYE:"BYE",CANCELLED:Fl,COMPLETED:xi,DEAD_RUBBER:Jv,DEFAULTED:Yt,DOUBLE_WALKOVER:Ui,DOUBLE_DEFAULT:zi,IN_PROGRESS:ho,INCOMPLETE:Na,NOT_PLAYED:k2,RETIRED:Ur,SUSPENDED:tp,TO_BE_PLAYED:$i,WALKOVER:si};function Ym(t,e,i){let r=d=>rt({element:d,name:xl})?.extension?.value,n=i?.deprioritizeCompleted,a=i?.mode===Kne&&g_e,s=i?.mode===Yne&&Xne,o=s||a||Kh,l=d=>d?.stage===ke&&d?.stageSequence===1,u=d=>l(d)?-1:o[d?.stage],c=d=>d?.matchUps.every(({matchUpStatus:p})=>Qi.includes(p)?1:-1);return n&&c(t)-c(e)||a&&u(t)-u(e)||(t?.stage&&o[t.stage]||0)-(e?.stage&&o[e.stage]||0)||(r(t)||0)-(r(e)||0)||!s&&!a&&(e?.positionAssignments?.length??1/0)-(t?.positionAssignments?.length??1/0)||(t?.stageSequence??0)-(e?.stageSequence??0)||(fE(t)||0)-(fE(e)||0)}function fE(t){return(t?.matchUps||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((n,a)=>n+a,0);return!e||r<e?r:e},void 0)}function tt(t){let e=He(t,[{[vn]:!0,[iN]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=so({drawDefinition:i}),a=n?.flatMap(l=>l.structures?[...l.structures].concat(l):l),s=a?.find(l=>l.structureId===r);if(!s)return{error:yi};let o=s.structureType===QM?a?.find(l=>l.structures?.some(u=>u.structureId===r)):void 0;return{structure:s,containingStructure:o}}function so({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:s,stage:o}){let l=!e&&$e||!e?.structures&&xB||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let u=h=>{let m=rt({element:h,name:xl})?.extension?.value;return!n||n===m},c=e?.structures?.filter(p).filter(f).filter(u).sort((h,m)=>Ym(h,m,a))??[],d=t?Object.assign({},...XM.map(h=>{let m=c?.filter(g=>g.stage===h);return m?.length&&{[h]:m}}).filter(Boolean)):{};return{structures:c,stageStructures:d};function p(h){return!o&&!Array.isArray(s)||o&&h.stage===o||Array.isArray(s)&&s.includes(h.stage)}function f(h){return!r&&!Array.isArray(i)||r&&h.stageSequence===r||Array.isArray(i)&&i.includes(h.stageSequence)}}function Cae({drawDefinition:t}){if(!t)return{error:$e};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=Xt({structure:i}),a=n?.map(wt).filter(Boolean)??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Xt({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:$e};if({structure:i,error:r}=tt({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>Xt({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=Wie,{positionAssignments:n,error:r}}function fr({drawDefinition:t,structureId:e,structure:i}){let r=Xt({drawDefinition:t,structureId:e,structure:i})?.positionAssignments||[],n=r?.filter(u=>u.participantId??u.bye??u.qualifier),a=r&&r?.length===n?.length,s=r?.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),o=r?.filter(u=>!u.participantId&&u.bye),l=r?.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:s,assignedPositions:n,qualifierPositions:l,byePositions:o}}var x2="addDrawDefinition",fN="addMatchUps",Md="addParticipants",F2="addScaleItems",Mae="addEvent",Nae="addVenue",lc="audit",L2="dataIssue",_2="deleteParticipants",$2="deleteVenue",B2="deletedDrawIds",V2="deletedMatchUpIds",j2="modifyDrawDefinition",Aae="modifyDrawEntries",kae="modifyEventEntries",G2="modifyMatchUp",nn="modifyParticipants",H2="modifyPositionAssignments",W2="modifySeedAssignments",Df="modifyTournamentDetail",Yc="modifyVenue",eF="mutations",tF="publishEvent",Oae="publishEventSeeding",xae="publishOrderOfPlay",Fae="publishParticipants",z2="unPublishEvent",q2="unPublishEventSeeding",Y2="unPublishOrderOfPlay",Lae="unPublishParticipants",hE="unPublishTournament",hN="updateInContextMatchUp",i$e={ADD_DRAW_DEFINITION:x2,ADD_MATCHUPS:fN,ADD_PARTICIPANTS:Md,ADD_SCALE_ITEMS:F2,ADD_EVENT:Mae,ADD_VENUE:Nae,AUDIT:lc,DATA_ISSUE:L2,DELETE_PARTICIPANTS:_2,DELETE_VENUE:$2,DELETED_DRAW_IDS:B2,DELETED_MATCHUP_IDS:V2,MODIFY_DRAW_DEFINITION:j2,MODIFY_DRAW_ENTRIES:Aae,MODIFY_EVENT_ENTRIES:kae,MODIFY_MATCHUP:G2,MODIFY_PARTICIPANTS:nn,MODIFY_POSITION_ASSIGNMENTS:H2,MODIFY_SEED_ASSIGNMENTS:W2,MODIFY_TOURNAMENT_DETAIL:Df,MODIFY_VENUE:Yc,MUTATIONS:eF,PUBLISH_EVENT_SEEDING:Oae,PUBLISH_EVENT:tF,PUBLISH_ORDER_OF_PLAY:xae,PUBLISH_PARTICIPANTS:Fae,UNPUBLISH_EVENT_SEEDING:q2,UNPUBLISH_EVENT:z2,UNPUBLISH_ORDER_OF_PLAY:Y2,UNPUBLISH_PARTICIPANTS:Lae,UNPUBLISH_TOURNAMENT:hE,UPDATE_INCONTEXT_MATCHUP:hN};function mN(t,e){if(!t)return{error:$e};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=e?.filter(Boolean);return t.updatedAt=r,t.structures?.filter(Boolean).forEach(a=>{(!n?.length||n?.includes(a.structureId))&&(a.updatedAt=r)}),{...W}}function Nd({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&mN(t),at({payload:{matchUps:i,tournamentId:e,eventId:r},topic:fN}),{...W}}function ju({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&mN(t),at({topic:V2,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)n2({key:a});return{...W}}function Dt({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&ri({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),at({topic:G2,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...W}):(console.log(pa),{error:pa})}function r$e({tournamentId:t,inContextMatchUp:e}){return e?(at({payload:{inContextMatchUp:e,tournamentId:t},topic:hN,key:e.matchUpId}),{...W}):{error:pa}}function xU({tournamentId:t,eventId:e,drawDefinition:i}){return i?(mN(i),at({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:x2,key:i.drawId}),{...W}):(console.log($e),{error:$e})}function n$e({tournamentId:t,eventId:e,drawId:i}){return at({payload:{drawId:i,tournamentId:t,eventId:e},topic:B2,key:i}),n2({key:i}),{...W}}function ri({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(mN(t,i),at({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:j2,key:t.drawId}),{...W}):{error:$e}}function _ae({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:$e};if(!i)return{error:wf};let n=i.seedAssignments,a=i.structureId,s=t.drawId;return at({payload:{tournamentId:e,eventId:r,drawId:s,structureId:a,seedAssignments:n},topic:W2,key:t.drawId}),ri({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...W}}function Ac({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:$e};if(!i)return{error:wf};let n=Xt({structure:i}),a=i.structureId,s=t.drawId,o=r?.eventId;return at({topic:H2,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:o,drawId:s},key:a}),ri({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:o}),{...W}}function $ae({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){if(!e)return{error:$e};let n=e.structures?.find(s=>s.stage===Mr);if(!n)return{error:yi};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],ju({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(s=>s.entryStage!==Mr)),ri({tournamentId:t?.tournamentId,eventId:r?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...W}}function K2({drawPositions:t,structure:e}){if([ze,ke].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Xt({structure:e});i?.filter(({drawPosition:r})=>t?.includes(r))?.forEach(r=>{It({element:r,extension:{name:dN,value:!0}})})}function FU(t){let{appliedPolicies:e,positionAction:i,drawDefinition:r}=t;if(e?.audit?.[Xg]===!1)return;let{extension:n}=rt({name:Xg,element:r}),a=Array.isArray(n?.value)?n?.value??[]:[];if(!a?.length){let o=r.structures.find(l=>l.stage===ke);if(o){let l=Xt({structure:o}).positionAssignments?.map(({drawPosition:u,participantId:c,bye:d,qualifier:p})=>({drawPosition:u,participantId:c,qualifier:p,bye:d}));a.push({name:"initialMainAssignments",initialAssignments:l})}}let s={value:a.concat(i),name:Xg};It({element:r,extension:s})}function Qv({tournamentRecord:t,drawDefinition:e,event:i}){let r=(t?.events||i&&[i])?.map(o=>o?.drawDefinitions).flat().filter(Boolean)||e&&[e]||[],n={},a={},s=r.map(o=>o?.structures?.filter(l=>l?.structures)).flat().filter(Boolean);for(let o of s){let{structures:l,structureId:u}=o??{};l&&u&&(n[u]=l?.map(c=>c.structureId))&&l.forEach(c=>a[c.structureId]=o?.structureId)}return{containedStructures:n,containerStructures:a}}function gN(t){let{sides:e,matchUpType:i}=t||{},r=t.potentialParticipants?.length?t.potentialParticipants.flat().map(a=>i===Vt?a?.individualParticipantIds||[]:a.participantId).flat():[],n=(e||[]).map(a=>i===Vt&&(a?.participant?.individualParticipantIds||[])||a?.participantId&&[a.participantId]||[]).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function Ds(t){return t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var LU="SIGN_IN_STATUS",Bae="SIGNED_OUT",Iw="SIGNED_IN",Gn="TEAM",yt="INDIVIDUAL",ts="GROUP",mt="PAIR",$t="TEAM",pb={TEAM_PARTICIPANT:Gn,INDIVIDUAL:yt,GROUP:ts,TEAM:$t,PAIR:mt},a$e={INDIVIDUAL:yt,GROUP:ts,PAIR:mt,TEAM:$t,SIGN_IN_STATUS:LU,SIGNED_OUT:Bae,SIGNED_IN:Iw};function IN({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?xe(e,t?.convertExtensions,!0):e,a=n.filter(l=>l.participantType===$t),s=n.filter(l=>l.participantType===ts),o=n.filter(l=>l.participantType===mt);return n.forEach(l=>{if(l.participantType===yt){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.teamParticipantIds?.includes(c.participantId)&&(l.teamParticipantIds.push(c.participantId),r.get(c.participantId)||r.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),o.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),s.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}function Vae(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function s$e(t){let e=Object.assign({},...gd.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return Vae(e[t])}var gd=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function jae({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n?.map(({person:o})=>o)].flat().filter(Boolean);function s(o){let{nationalityCode:l}=o||{};if(l){let u=gd.find(({iso:c})=>c===l);i&&u?.ioc&&!o.iocNationalityCode&&(o.iocNationalityCode=u.ioc),e&&u?.iso2&&!o.iso2NationalityCode&&(o.iso2NationalityCode=u.iso2),u?.label&&!o.countryName&&(o.countryName=u.label)}}a.forEach(s)}function o$e({participantMap:t,template:e}){let i=Object.values(t);for(let r of i){let n=r.participant;if(n.individualParticipantIds?.length){n.individualParticipants=[];for(let a of n.individualParticipantIds){let s=t[a].participant;n.individualParticipants.push(e?Xh({template:e,source:s}):s)}}}}function ip(t){let{tournamentRecord:e,participantId:i}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let n of Object.values(r)){let a=n.participants?.find(s=>s.participantId===i);if(a)return{participant:a,tournamentId:n.tournamentId}}return{error:Gi}}function Gae(t){let{tournamentRecord:e,participantId:i}=t;if(i){let r=ip({tournamentRecord:e,participantId:i});return r.participant??r}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Je}}function Ps(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=Gae(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:re,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:KB};let a=n.timeItems.filter(o=>o?.itemType===r).filter(o=>!i?.length||i.some(l=>o?.itemSubTypes?.includes(l))).sort((o,l)=>{let u=new Date(o.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),s=xe(a.pop(),!1,!0);if(s){let o={timeItem:s,...W};return e&&Object.assign(o,{previousItems:a}),o}else return{info:Gr}}function X2({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:jo};if(!e.timeItems)return{info:Gr};let{timeItem:n,previousItems:a,info:s}=Ps({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function _U({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:ci};if(!r.timeItems)return{info:Gr};let{timeItem:n,previousItems:a,info:s}=Ps({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:s}}function vN({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:Ie};if(!e.timeItems)return{info:Gr};let{timeItem:n,previousItems:a,info:s}=Ps({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function J2({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:Ie};if(!i)return{error:pr};let a=ip({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:s}=a;if(!s?.timeItems)return{info:Gr};let{timeItem:o,previousItems:l,info:u}=Ps({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return o&&{timeItem:o,previousItems:l}||{info:u}}var l$e={[ts]:"groupParticipantIds",[mt]:"pairParticipantIds",[$t]:"teamParticipantIds"},u$e={[ts]:"groups",[$t]:"teams"};function Hae({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,withGroupings:a,internalUse:s,withISO2:o,withIOC:l}){let u=[],c={};for(let p of i.participants??[]){let f=p?.participantId;f&&p$e({participantMap:c,participantId:f})}for(let p of i.participants??[]){let f=xe(p,e,s),{participantId:h,individualParticipantIds:m,participantType:g}=f;if(!c[h]){u.push(h);continue}if(Object.assign(c[h].participant,f),m){let I=d$e({individualParticipantIds:m,participantCopy:f,participantMap:c,participantType:g,participantId:h});I.missingParticipantIds.length&&u.push(...I.missingParticipantIds)}if(r&&(c[h].participant.signedIn=c$e(f)),n){let{ratings:I,rankings:v,seedings:w}=Yv({participant:f});c[h].participant.seedings=w,c[h].participant.rankings=v,c[h].participant.ratings=I}(l||o)&&jae({participant:c[h].participant,withISO2:o,withIOC:l})}if(t){let p=Ut(t)?t:void 0;o$e({participantMap:c,template:p})}let d;return a&&(d=IN({participants:Object.values(c).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:u,participantMap:c,groupInfo:d}}function c$e(t){let{timeItem:e}=Ps({itemType:LU,element:t});return e?.itemValue===Iw}function d$e({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){let a=[];for(let s of t){let o=i[s]?.participant;if(!o){a.push(s);continue}if(o[l$e[r]].push(n),[$t,ts].includes(r)){let{participantRoleResponsibilities:l,participantOtherName:u,participantName:c,participantId:d,teamId:p}=e,f=u$e[r];o[f].push({participantRoleResponsibilities:l,participantOtherName:u,participantName:c,participantId:d,teamId:p})}if(r===mt){let l=t.find(u=>u!==s);i[s].pairIdMap[n]=l,i[s].pairIdMap[l]=n}}return{missingParticipantIds:a}}function p$e({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[qt]:{...i},[Vt]:{...i},[$t]:{...i},...i}}}function Pf({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){if(e)return Hae({...t,...r,tournamentRecord:i});let a=xe(i.participants,!1,!0)||[];(t?.withIOC||t?.withISO2)&&a.forEach(o=>jae({participant:o,...t}));let s;if((n||t?.withGroupings)&&a?.length&&({participantsWithGroupings:a,groupInfo:s}=IN({participantsProfile:t,deepCopy:!1,participants:a})),t?.withScaleValues&&a?.length)for(let o of a){let{ratings:l,rankings:u}=Yv({participant:o});o.rankings=u,o.ratings=l}return{participants:a,groupInfo:s}}function Ct({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:_B};let s={};return i&&o(i),a&&o(a),r&&o(r),n&&o(n),{appliedPolicies:s,...W};function o(l){let u=l?.extensions?.find(c=>c.name===gw)?.value;if(u)for(let c of Object.keys(u))(t?e.includes(c):!e.length||e.includes(c))&&(s[c]=xe(u[c],!1,!0))}}function Kc({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:_B};let{appliedPolicies:a}=Ct({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),s={};for(let o of t){let l=a?.[o];l&&(s[o]=l)}return Object.keys(s).length?{policyDefinitions:s}:{info:vU.message}}var Wae="WALKOVER",Xq="RETIRED",Q2="COMPETITIVE",vw="ROUTINE",yw="DECISIVE",OD="winRatio",f$e={[ic]:{policyName:"Competitive Bands Default",profileBands:{[yw]:20,[vw]:50}}},Z2=f$e;function Xc({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let s=Kc({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let o=t?.[ic]??s?.[ic]??Z2[ic];a.policies[ic]=o}return a}function Ef({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:Ie};let{appliedPolicies:a}=Ct({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a?.[i]?{policy:a[i]}:{info:vU?.message}}function $U({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){e=e??r?.category?.categoryName??r?.category?.ageCategoryCode,i=i??r?.category?.categoryType??r?.category?.subType;let{policy:n}=Ef({policyType:Zd,tournamentRecord:t,event:r}),a=(t?rt({element:t,name:Mc}).extension:void 0)?.value,s=(r&&rt({name:Mc,element:r}).extension)?.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:s,categoryName:e,categoryType:i,policy:n}}}function eV({drawDefinition:t,attributes:e}){let{extension:i}=rt({element:t,name:pE}),r=i?.value||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:pE,value:r},lN({drawDefinition:t,extension:i}),{entryProfile:r}}function BU({drawDefinition:t}){let{extension:e}=rt({element:t,name:pE});return{entryProfile:e?.value||{}}}var qs="ALTERNATE",VU="CONFIRMED",ga="DIRECT_ACCEPTANCE",jU="FEED_IN",GU="JUNIOR_EXEMPT",kc="LUCKY_LOSER",HU="ORGANISER_ACCEPTANCE",WU="QUALIFIER",h$e="REGISTERED",zU="SPECIAL_EXEMPT",Es="UNGROUPED",Rf="UNPAIRED",BI="WILDCARD",Mu="WITHDRAWN",xD=[VU,ga,GU,HU,zU],zae=[jU,kc,WU],Cf=[VU,ga,jU,GU,HU,zU,BI],mo=[VU,ga,GU,kc,WU,HU,zU,BI],qae=[qs,VU,ga,jU,GU,kc,HU,WU,h$e,zU,Es,Rf,BI,Mu],m$e={ALTERNATE:qs,CONFIRMED:VU,DIRECT_ACCEPTANCE:ga,DIRECT_ENTRY_STATUSES:Cf,DRAW_SPECIFIC_STATUSES:zae,EQUIVALENT_ACCEPTANCE_STATUSES:xD,FEED_IN:jU,JUNIOR_EXEMPT:GU,LUCKY_LOSER:kc,ORGANISER_ACCEPTANCE:HU,QUALIFIER:WU,SPECIAL_EXEMPT:zU,STRUCTURE_SELECTED_STATUSES:mo,UNGROUPED:Es,UNPAIRED:Rf,VALID_ENTRY_STATUSES:qae,WILDCARD:BI,WITHDRAWN:Mu};function tV({stage:t,drawDefinition:e}){let{entryProfile:i}=BU({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&XM.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return eV({drawDefinition:e,attributes:n}),!0}return r}function g$e({stage:t,drawDefinition:e}){let{entryProfile:i}=BU({drawDefinition:e});return i[t]?.alternates||0}function I$e({stage:t,drawDefinition:e}){let{entryProfile:i}=BU({drawDefinition:e});return i[t]?.wildcardsCount||0}function iF({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function Km({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:s,stages:o,stage:l}){let u=i.entries?.reduce((c,d)=>{let p=rt({name:xl,element:d})?.extension?.value,f=l&&d.entryStage===l||o?.length&&d.entryStage&&o.includes(d.entryStage),h=!n||d.entryStatus&&n.includes(d.entryStatus),m=d.entryStageSequence??1;return f&&(!r||m===r)&&h&&(!s||!p||s===p)?c.concat(d):c},[])??[];if(a&&l===ki){let{playoffEntries:c,error:d}=v$e({provisionalPositioning:t,drawDefinition:i,structureId:a});return d&&console.log("playoff entries error"),(c?.length?c:u).filter(p=>!e||p.placementGroup===e)}return u}function v$e({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===Uu&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:s}=n.source,{structure:o}=tt({drawDefinition:e,structureId:s});o?.structureType===In&&(o.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(m=>{let{participantId:g}=m,I=rt({element:m,name:Nc}).extension?.value;return I&&g?{[g]:I}:void 0}).filter(Boolean)),f=Object.keys(p).reduce((m,g)=>{let I=p[g],v=I.groupOrder||t&&I.provisionalOrder;return m.includes(v)||m.push(v),m},[]).length===Object.keys(p).length,h=Object.keys(p).filter(m=>{let g=p[m],I=g.groupOrder||t&&g.provisionalOrder;return a?.includes(I)});(!t||f)&&h.forEach(m=>{let g=p[m],{groupOrder:I,provisionalOrder:v,GEMscore:w}=g,y=I||t&&v,b=[...a??[]].sort(or).indexOf(y)+1;r.push({entryStage:ki,entryStatus:jU,placementGroup:b,groupingValue:d,participantId:m,GEMscore:w})})})}return{playoffEntries:r}}function y$e({stage:t,drawDefinition:e}){return Cf.reduce((i,r)=>(iF({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function ys({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){let a,s=[];n||({structure:n,error:a}=tt({drawDefinition:i,structureId:r}));let o=Xt({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:yi};r||(r=n.structureId);let{stage:l,stageSequence:u}=n,c=l===ki&&i&&Km({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:r,stage:l}),d=c?c.filter(h=>h.placementGroup===1).sort((h,m)=>h.GEMscore<m.GEMscore&&1||h.GEMscore>m.GEMscore&&-1||0).map((h,m)=>{let g=m+1;return{participantId:h.participantId,seedValue:g,seedProxy:!0,seedNumber:g}}):[],p=d?.slice(0,e?d.length:o.length/2);p.length?s=p:n.seedAssignments?s=n.seedAssignments:a=xie;let f=n.seedLimit??n?.positionAssignments?.length;return{seedAssignments:s,stageSequence:u,seedLimit:f,stage:l,error:a}}function Yo(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function fb({item:t,drawDefinition:e,structure:i,event:r}){if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:e.tieFormats?.find(n=>t.tieFormatId===n.tieFormatId)||(r.tieFormat?r.tieFormat:r.tieFormats?.find(n=>t.tieFormatId===n.tieFormatId));if(i?.tieFormat)return i.tieFormat;if(i?.tieFormatId){let n=e.tieFormats?.find(a=>i.tieFormatId===a.tieFormatId);if(n)return n}}}function bn({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:fb({item:i,drawDefinition:t,structure:e,event:r})||fb({item:e,drawDefinition:t,structure:e,event:r})||Yo(t)||Yo(r)}}function b$e({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function xr({drawDefinition:t,structure:e}){let i={},r=[];return(t?.structures??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:s,structures:o}=n,l=Array.isArray(o);if(l)l&&o.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=s;i[a]={matchUps:u,itemStructureIds:[]},u?.forEach(c=>{r.push(c),c.tieMatchUps&&r.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function Ad({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=e?.mappedMatchUps??t;let n=t[i],a=(n?.itemStructureIds||[]).map(s=>{let{matchUps:o,structureName:l}=t[s];return r?o.map(u=>Object.assign(xe(u,!0,!0),{containerStructureId:i,structureId:s,structureName:l})):o}).flat();return(n?.matchUps||[]).concat(...a)}function Yae({groupedOrder:t,roundPositionsCount:e}){if(!t||t?.length<=e)return t;let i=Sr(t,t.length/e).map(n=>n.reduce((a,s)=>a+s)),r=i.slice().sort(or);return i.map(n=>r.indexOf(n)+1)}function yN(t){if(!Ut(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>ct(a)||a===void 0||a===null);return r&&n}function is(t){return Array.isArray(t)?t.every(yN):!1}function w$e(t,e){return e?.find(i=>t.includes(i))}function Un({matchUps:t=[],interpolate:e}){if(!is(t))return{roundMatchUps:[],error:re};let i=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?Ke(p.roundNumber):p.roundNumber;return!p.roundNumber||d.includes(f)?d:d.concat(f)},[]).sort(or).map(d=>{let p=t.filter(m=>m.roundNumber===d),f=p.find(({matchUpType:m})=>m===ti)?p.filter(({matchUpType:m})=>m===ti):p,h=m=>m.sort((g,I)=>or(g.roundPosition,I.roundPosition));return{[d]:h(f)}}),r=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?Ke(p.roundNumber):p.roundNumber;return d[f]||(d[f]=je({abbreviatedRoundName:p.abbreviatedRoundName,finishingRound:p.finishingRound,roundName:p.roundName})),d},{}),n=Object.assign({},...i);if(e){let d=Math.max(...Object.keys(n).map(f=>Ke(f)).filter(f=>!Number.isNaN(f))),p=n[d]?.length;if(p>1&&xo(p)){let f=d+1,h=f+p/2;Ce(f,h).forEach((m,g)=>{n[m]=Ce(0,p/(2+g*2)).map(()=>({}))})}}let a=0,s=Object.assign({},...Object.keys(n).map(d=>{let p=n[d]?.length,f=n[d]?.filter(m=>!Qi.includes(m.matchUpStatus)&&!m.score?.scoreStringSide1)?.length,h=p&&p===f;return a=Math.max(a,p),{[d]:{matchUpsCount:p,inactiveCount:f,inactiveRound:h}}})),o=0,l=0,u=Object.keys(n).map(d=>Ke(d)).filter(d=>!Number.isNaN(d));u.forEach(d=>{let p=n[d].sort((h,m)=>h.roundPosition-m.roundPosition),f=p.flatMap(h=>h?.drawPositions||[]);if(s[d].roundNumber=d,s[d].roundFactor=s[d].matchUpsCount?a/s[d].matchUpsCount:1,s[d].finishingRound=r[d]?.finishingRound,s[d].roundName=r[d]?.roundName,s[d].abbreviatedRoundName=r[d]?.abbreviatedRoundName,s[d].finishingPositionRange=n[d]?.[0]?.finishingPositionRange,d===1||!s[d-1]){let h=f.sort(or),m=Sr(h,2);s[d].drawPositions=h,s[d].pairedDrawPositions=m}else{let h=s[d-1],m=h.drawPositions,g=h.matchUpsCount/s[d].matchUpsCount,I=Sr(m,g),v=p.map(w=>{let{roundPosition:y}=w,b=[...w.drawPositions||[],void 0,void 0].slice(0,2);if(!y)return b;let S=b?.filter(Boolean)||[];if(!S?.length)return[void 0,void 0];if(d<3&&S?.length===2)return b?.slice().sort(or);let U=_i(m,S).length!==S?.length;if(S?.length&&U)return S?.length===1?[S[0],void 0]:b?.slice().sort(or);let T=(y-1)*2;return I.slice(T,T+2).map(D=>w$e(D,S))});s[d].drawPositions=v?.flat(),s[d].pairedDrawPositions=v}s[d+1]?.matchUpsCount===s[d].matchUpsCount&&(s[d+1].feedRound=!0,s[d+1].feedRoundIndex=l,s[d].preFeedRound=!0,l+=1),s[d]&&!s[d].feedRound&&(s[d].roundIndex=o,o+=1)});let c=!!Object.values(s).some(({matchUpsCount:d})=>!xo(d));return{hasNoRoundPositions:t.some(d=>!d.roundPosition),roundsNotPowerOf2:c,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:u,roundProfile:s,...W}}function FD(t){if(!Array.isArray(t))return"";let e=t.filter(Ni);return e.length?lt([Math.min(...e),Math.max(...e)]).join("-"):""}function S$e({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:$e};if(!e)return{error:es};let{structure:r}=tt({drawDefinition:t,structureId:e});if(r?.stage!==rn)return{error:Sf,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=n?.filter(d=>d.target.structureId===e)||[],s=a?.reduce((d,p)=>{let{structureId:f}=p.source;return d.includes(f)?d:d.concat(f)},[])||[],o=Object.assign({},...s.map(d=>{let p=Ad({structureId:d,matchUpsMap:i}),f=Un({matchUps:p}).roundProfile;return{[d]:f}})),l=Ad({matchUpsMap:i,structureId:e}),{roundProfile:u}=Un({matchUps:l}),c={};return a?.forEach(d=>{let{structureId:p,roundNumber:f}=d.source,{feedProfile:h,groupedOrder:m,positionInterleave:g,roundNumber:I}=d.target,v=o[p],w=v[1]?.drawPositions,y=v[f]?.matchUpsCount;if(!y)return;let b=y?w.length/y:0,S=w.length/b,U=w.slice(),T=Yae({roundPositionsCount:S,groupedOrder:m}),D=T?.length||1;if(D<=S){let R=w.length/D,C=Sr(U,R);h===Yp&&C.forEach(M=>M.reverse()),U=T?.length&&T?.map(M=>C[M-1]).flat()||C.flat()}let P=Sr(U,b);if(g){let R=Ce(0,g.interleave).map(()=>{}),C=Ce(0,g.offset).map(()=>{});P=P.map(N=>[N,...R]),P.unshift(C),P=P.flat(1);let M=P.length-g.offset;P=P.slice(0,M)}c[I]||(c[I]={});let E=u?.[I]?.feedRound?2:1;P.forEach((R,C)=>{let M=1+C*E;c[I][M]||(c[I][M]=FD(R))})}),{sourceDrawPositionRanges:c}}function Kae({drawDefinition:t}){if(typeof t!="object")return{error:Sh};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((s,o)=>{let{stage:l}=o;return s[l]?s[l].push(o):s[l]=[o],s},{});for(let s of Object.keys(n)){let o=n[s].find(({stageSequence:u})=>u===1);if(!o)continue;let{structureId:l}=o;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:s})}return{exitProfiles:e};function a({exitProfiles:s,exitProfile:o,structureId:l,targetRound:u,aggregator:c,stage:d}){s[l]||(s[l]=[]),o==="0"&&[rn,ki].includes(d)||s[l].push(o);let p=r.filter(f=>f.source.structureId===l&&f.source.roundNumber>=u);for(let f of p){let h=f.source.roundNumber,m=f.target.roundNumber,g=f.target.structureId,I=i.find(w=>w.structureId===g).stage,v=[I,g,m,h].join("|");if(c[v])return;c[v]=!0,a({exitProfile:`${o}-${h}`,structureId:g,exitProfiles:s,targetRound:m,aggregator:c,stage:I})}}}function U$e({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){if(!t)return{error:$e};if(!i)return{error:es};if(!e){let s=Ad({matchUpsMap:r,structureId:i});if({roundProfile:e}=Un({matchUps:s}),!e)return{error:Je}}let n=(Math.min(...e?.[1]?.drawPositions??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{let o=e?.[s]?.matchUpsCount,l=e?.[1]?.drawPositions??[],u=Sr(l,l.length/o),c=u.map(FD),d=u.map(g=>g.map(I=>I-n)).map(FD),p=a.map(g=>{if(g>s)return;let I=e?.[g]?.drawPositions??[];return Sr(I,I.length/o)}).filter(Boolean),f=Ce(0,o).map(g=>p.map(I=>I[g]).flat().filter(Boolean).sort(or)).map(g=>lt(g)),h=f.map(g=>xLe(g).map(FD).join(", ")),m=Object.assign({},...Ce(0,o).map(g=>({[g+1]:{firstRoundDrawPositionsRange:c[g],firstRoundOffsetDrawPositionsRange:d[g],possibleDrawPositions:f[g],drawPositionsRange:h[g]}})));return{[s]:m}}))}}function iV({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){if(!i)return!1;r=r??i.matchUps??[],t=t??Un({matchUps:r}).roundsNotPowerOf2;let n=!!i.positionAssignments?.find(({drawPosition:a})=>a)||!!r?.find(({drawPositions:a})=>a?.length);return(!e?.drawType||e.drawType!==Tf)&&!i?.structures&&t&&n}function Yn({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!e?.find(n=>n?.roundPosition),r=!!e?.find(n=>n?.drawPositions?.length);return!t?.structures&&t?.stage!==Mr&&(!e.length||!i&&!r)}var rV={[Rc]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[ke]:"",[ki]:"P",[ze]:"Q",[rn]:"C"}}},T$e=rV;function Xae({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){let{roundProfile:n,roundMatchUps:a}=Un({matchUps:r}),{structureAbbreviation:s,stage:o}=i,l=Yn({structure:i}),u=iV({structure:i}),c=i.structures,d={},p=rV[Rc],f=i.stage===ze,h=f?Math.max(...(e?.structures??[]).filter(R=>R.stage===ze).map(({stageSequence:R})=>R??1),0):0,m=(i.stageSequence??1)<h?i.stageSequence??1:"",g=m&&(t?.affixes?.preQualifying||p.affixes.preQualifying)||"",I=t?.roundNamingMap||p.roundNamingMap||{},v=t?.abbreviatedRoundNamingMap||p.abbreviatedRoundNamingMap||{},w=t?.affixes?.preFeedRound||p.affixes.preFeedRound,y=t?.affixes?.roundNumber||p.affixes.roundNumber,b=(t?.namingConventions||p.namingConventions).round,S=o&&o!==ke?o[0]:"",U=t?.stageConstants||p.stageConstants,T=o&&U?.[o]||S,D=`${g}${T}${m}`,P=n?Object.keys(n):[],E=f&&U?.[ze]?`${U?.[ze]}-`:"";if(c||l||u)Object.assign(d,...P.map(R=>{let C=`${E}${b} ${R}`,M=`${y}${R}`;return{[R]:{roundName:C,abbreviatedRoundName:M}}}));else{let R=f&&(t?.qualifyingFinishMap||p?.qualifyingFinishMap||{});Object.assign(d,...P.map(C=>{if(!n?.[C])return;let{matchUpsCount:M,preFeedRound:N}=n[C],A=M*2,O=R?.[n?.[C].finishingRound]||R&&`${y}${A}`||I[M]||`${y}${A}`,k=N?`-${w}`:"",F=`${O}${k}`,x=[D,s,F].filter(Boolean).join("-"),L=`${v[M]||`${y}${A}`}${k}`,$=[D,s,L].filter(Boolean).join("-");return{[C]:{abbreviatedRoundName:$,roundName:x}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}var D$e=(t,e)=>(t||0)+(e||0);function Jae(t,e){let i=Array.isArray(t)?t[0]:t;return Number.isNaN(i)&&Wae||i<=e[yw]&&yw||i<=e[vw]&&vw||Q2}function Qae({score:t}){let e=t?.sets||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(D$e)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function P$e(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function Zae(t){return t.map(P$e).sort().map(e=>parseFloat(e.toFixed(2)))}function qU({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:pa};let{score:r,winningSide:n}=i;if(!n)return{error:re};let a=!e&&t&&Ef({policyType:ic,tournamentRecord:t}).policy,s=e||a?.profileBands||Z2[ic].profileBands,o=Qae({score:r}),l=Zae([o]),u=Jae(l,s),c=Array.isArray(l)?l[0]:l;return{...W,competitiveness:u,pctSpread:c}}function ese({matchUp:t}){if(!t)return{error:pa};if(t&&!t.sides)return{error:fa};if(t&&!t.hasContext)return{error:VM};let e=(t.sides??[])?.map(s=>s?.participantId).filter(Boolean),i=t.sides?.filter(s=>s.participant?.participantType===yt).map(s=>s.participantId).filter(Boolean)??[],r=((t.sides??[])?.map(s=>s.participant?.individualParticipants).filter(Boolean)??[]).map(s=>(s??[]).map(o=>o?.participantId).filter(Boolean)),n=[...i,...r.flat()].filter(Boolean)??[],a=lt(n.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:a,individualParticipantIds:n,sideParticipantIds:e,...W}}var mE="CHECK_IN",gE="CHECK_OUT",E$e="SCHEDULE",Xm="SCHEDULE.ASSIGNMENT.VENUE",Nu="SCHEDULE.ALLOCATION.COURTS",kd="SCHEDULE.ASSIGNMENT.COURT",bN="SCHEDULE.COURT.ORDER",Jm="SCHEDULE.DATE",R$e="COMPLETED.DATE",nV="HOME_PARTICIPANT_ID",aV="SCHEDULE.ASSIGN.OFFICIAL",Qm="SCHEDULE.TIME.SCHEDULED",Uo="SCHEDULE.TIME.START",uc="SCHEDULE.TIME.STOP",au="SCHEDULE.TIME.RESUME",Oc="SCHEDULE.TIME.END",wN="SCHEDULE.TIME.MODIFIERS",tse="TO_BE_ANNOUNCED",ise="NEXT_AVAILABLE",rse="FOLLOWED_BY",nse="AFTER_REST",ase="RAIN_DELAY",C$e="NOT_BEFORE",rF=[tse,ise,rse,nse,ase],M$e="ELIGIBILITY",N$e="REGISTRATION",A$e="SUSPENSION",k$e="MEDICAL",O$e="PENALTY",sse="SCALE",ose="RATING",lse="RANKING",sV="SEEDING",rp="PUBLISH",rs="PUBLIC",np="STATUS",x$e="MODIFICATION",F$e="RETRIEVAL",L$e="other",_$e={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:rF,AFTER_REST:nse,ALLOCATE_COURTS:Nu,ASSIGN_COURT:kd,ASSIGN_OFFICIAL:aV,ASSIGN_VENUE:Xm,CHECK_IN:mE,CHECK_OUT:gE,COMPLETED_DATE:R$e,COURT_ORDER:bN,ELIGIBILITY:M$e,END_TIME:Oc,FOLLOWED_BY:rse,MEDICAL:k$e,MODIFICATION:x$e,NEXT_AVAILABLE:ise,NOT_BEFORE:C$e,OTHER:L$e,PENALTY:O$e,PUBLIC:rs,PUBLISH:rp,RANKING:lse,RATING:ose,RAIN_DELAY:ase,REGISTRATION:N$e,RESUME_TIME:au,RETRIEVAL:F$e,SCALE:sse,SCHEDULE:E$e,SCHEDULED_DATE:Jm,SCHEDULED_TIME:Qm,SEEDING:sV,START_TIME:Uo,STATUS:np,STOP_TIME:uc,SUSPENSION:A$e,TIME_MODIFIERS:wN,TO_BE_ANNOUNCED:tse};function Zm({matchUp:t}){if(!t)return{error:pa};if(!t.hasContext)return{error:VM};if(!t.sides||t?.sides.filter(Boolean).length!==2)return{error:fa};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=ese({matchUp:t}),n=(t.timeItems??[]).filter(o=>o?.itemType&&[mE,gE].includes(o.itemType)).sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(o=>o.itemValue).filter(o=>n.filter(l=>l?.itemValue===o).reverse()[0].itemType===mE);e?.forEach((o,l)=>{let u=r?.[l],c=o?.length&&o.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),r?.forEach((o,l)=>{a.includes(o)&&(e?.[l]??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let s=r?.reduce((o,l)=>a.includes(l)&&o,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:s,checkedInParticipantIds:a,...W}}var Di=t=>e=>{let i=Ut(e)&&e?.matchUpType||ai(e)&&e;return i&&fie[t].includes(i)};function hb(t){let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},r=e?.map(({matchUpFormatCodes:a})=>a?.filter(s=>s===i)).flat().filter(Boolean).sort((a,s)=>(a?.length||0)-(s?.length||0))||[],n=r.includes(i)?i:r[0];return e?.find(({matchUpFormatCodes:a,averageTimes:s})=>a?.find(o=>n===o)&&s)?.averageTimes}function mb(t){let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:r}=t||{};return e?.find(({matchUpFormatCodes:n,averageTimes:a,recoveryTimes:s})=>{if(a&&i){let{greaterThan:o=0,lessThan:l=360}=a;if(i>o&&i<l)return!0}return n?.find(o=>o===r)&&s})?.recoveryTimes}function use({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>(a.categoryNames?.length||0)-(n.categoryNames?.length||0)).find(({categoryTypes:n,categoryNames:a})=>!a?.length&&!n?.length||a?.includes(e)||n?.includes(i))).find(Boolean)}function $$e({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:s,policy:o}){let l=e?.matchUpRecoveryTimes&&mb({...e,averageMinutes:i,matchUpFormat:n}),u=t?.matchUpRecoveryTimes&&mb({...t,averageMinutes:i,matchUpFormat:n}),c=o?.matchUpRecoveryTimes&&mb({...o,averageMinutes:i,matchUpFormat:n}),d=[l,u,c,o?.defaultTimes?.recoveryTimes,r?.recoveryTimes];return use({categoryName:a,categoryType:s,timesBlockArray:d})}function B$e({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:s}){let o=a?.matchUpAverageTimes&&hb({...a,matchUpFormat:t}),l=n?.matchUpAverageTimes&&hb({...n,matchUpFormat:t}),u=s?.matchUpAverageTimes&&hb({...s,matchUpFormat:t}),c=[o,l,u,s?.defaultTimes?.averageTimes,r?.averageTimes];return use({categoryName:e,categoryType:i,timesBlockArray:c})}var cse="DOUBLES_SINGLES",dse="SINGLES_DOUBLES",Ys="total",nF="participantConflict",aF="potentialParticipantConflict",ss="matchUpConflict",pse="courtDoubleBooking",fse="positionLinkConflict",hse="ISSUE_IDS",Gl="CONFLICT",Hl="WARNING",Ly="ERROR",_y="ISSUE",LD="STATE",V$e="BLOCKED",j$e="PRACTICE",G$e="MAINTENANCE",H$e={SINGLES_DOUBLES:dse,DOUBLES_SINGLES:cse,TOTAL:Ys,CONFLICT_MATCHUP_ORDER:ss,CONFLICT_PARTICIPANTS:nF,CONFLICT_POTENTIAL_PARTICIPANTS:aF,CONFLICT_COURT_DOUBLE_BOOKING:pse,CONFLICT_POSITION_LINK:fse,SCHEDULE_ISSUE_IDS:hse,SCHEDULE_CONFLICT:Gl,SCHEDULE_WARNING:Hl,SCHEDULE_ERROR:Ly,SCHEDULE_ISSUE:_y,SCHEDULE_STATE:LD,BLOCKED:V$e,PRACTICE:j$e,MAINTENANCE:G$e};function YU({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:o}){if(!i)return{error:Ie};s=s??o?.eventType??Yh;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=$U({tournamentRecord:i,categoryName:n,categoryType:a,event:o}),c={...u,matchUpFormat:r,categoryType:a,defaultTiming:l};return SN({eventType:s,timingDetails:c})}function SN({timingDetails:t,eventType:e}){let i=B$e(t),r=Object.keys(i?.minutes||{}),n=i?.minutes&&(r?.includes(e)&&i.minutes[e]||i.minutes.default),a=$$e({...t,averageMinutes:n}),s=Object.keys(a?.minutes||{}),o=a?.minutes&&(s?.includes(e)&&a.minutes[e]||a.minutes.default),l=Di(Yh)(e)?dse:cse,u=a?.minutes&&(s?.includes(l)&&a.minutes[l]||o);return{averageMinutes:n,recoveryMinutes:o,typeChangeRecoveryMinutes:u}}function xk(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Mf({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>xk(n)-xk(a)).pop(),r=i&&xk(i);return{itemValue:i?.itemValue,timeStamp:r}}function oV({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Mf({timeItems:i?.timeItems||[],itemType:Qm});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function Nf({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Mf({timeItems:i?.timeItems||[],itemType:Jm});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function Vf(t){if(lne.test(t)){let e=l2();return new Date(`${e}T${t}`)}else return new Date(t)}function W$e({matchUp:t}){if(!t)return{error:pa};if(!t.timeItems)return{error:KB};let e=t.timeItems.filter(r=>[Uo,uc,au,Oc].includes(r?.itemType)).sort((r,n)=>Vf(r.itemValue).getTime()-Vf(n.itemValue).getTime()),i=e.reduce((r,n)=>{let a,s=n?.itemType?.split("."),o=`SCHEDULE.TIME.${n?.itemType?.startsWith("SCHEDULE.TIME")&&s[2]}`;switch(o){case Uo:a=0;break;case Oc:if(r.lastValue&&[Uo,au].includes(r.lastType)){let l=Vf(n.itemValue).getTime()-Vf(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;case uc:if([Uo,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let l=Vf(n.itemValue).getTime()-Vf(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;default:a=r.milliseconds;break}return{milliseconds:a,lastType:o,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([Uo,au].includes(i.lastType)){let r=new Date().getTime()-Vf(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:z$e(i.milliseconds),relevantTimeItems:e}}function z$e(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function q$e({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:e.reduce((r,n)=>{let a=n.itemType===Uo&&n;return a&&(!r||i(a)<i(r))?a:r},void 0)?.itemValue}}function IE(t){return parseInt(t)}function vE({startTime:t="",endTime:e=""}={}){if(!t||!e||!Ip.test(t)||!Ip.test(e))return!1;let[i,r]=t.split(":").map(IE),[n,a]=e.split(":").map(IE);return n<i?!1:!(i===n&&a<r)}function Y$e(t,e){let[i,r]=t.startTime.split(":").map(IE),[n,a]=e.startTime.split(":").map(IE);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function UN({dateAvailability:t}){if(!t)return{error:ire};if(!Array.isArray(t))return{error:AD};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:AD};let{date:n,startTime:a,endTime:s,bookings:o=[]}=r;if(!a||!s)return{error:AD};if(n&&!yl.test(n))return{error:Yi,dateAvailability:{date:n},info:e};if(!Ip.test(a))return{error:Ns,dateAvailability:{startTime:a},info:i};if(!Ip.test(s))return{error:Ns,dateAvailability:{endTime:s},info:i};if(a===s)return{error:Ns,dateAvailability:{startTime:a,endTime:s},info:"startTime and endTime are equivalent"};if(!vE({startTime:a,endTime:s}))return{error:Ns,dateAvailability:{startTime:a,endTime:s},info:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:iE};for(let l of o){if(typeof l!="object")return{error:iE};let{startTime:u,endTime:c}=l;if(!Ip.test(u))return{error:Ns,booking:{startTime:u},info:i};if(!Ip.test(c))return{error:Ns,booking:{endTime:c},info:i};if(u===c)return{error:Ns,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!vE({startTime:u,endTime:c}))return{error:Ns,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function mse({tournamentRecord:t}){for(let e of t.venues??[])e.isPrimary&&delete e.isPrimary}function KU(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:re};let n=Ds(t);i.venueId||(i.venueId=Et());let a;for(let s of Object.values(n)){let o=K$e({disableNotice:!0,tournamentRecord:s,context:r,venue:i});if(o?.error)return o;a=o.venue}return e||at({topic:Nae,payload:{venue:i}}),je({...W,venue:a})}function K$e({tournamentRecord:t,disableNotice:e,context:i,venue:r}){if(!t)return{error:Ie};if(!r)return{error:Je,info:"missing venue"};if(t.venues||(t.venues=[]),r.venueId||(r.venueId=Et()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0))return{error:Sre};if(r.dateAvailability?.length){let n=UN({dateAvailability:r.dateAvailability});if(n.error)return n}if(r.defaultStartTime||r.defaultEndTime){if(!r.defaultStartTime||!r.defaultEndTime)return{error:re,info:"both defaultStartTime and defaultEndTime are required"};if(!vE({startTime:r.defaultStartTime,endTime:r.defaultEndTime}))return{error:re,info:"defaultEndTime must be after defaultStartTime"}}return i&&It({element:r,extension:{value:i,name:mae}}),r.isPrimary&&mse({tournamentRecord:t}),t.venues.push(r),{...W,venue:xe(r)}}function go({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:Ie};if(!i)return{error:Qd};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(OU({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let s=t[a],o=go({tournamentRecord:s,venueId:i});if(o.success&&o.venue)return KU({tournamentRecord:e,venue:o.venue}),{...W,venue:r}}}return r?{...W,venue:r}:{error:Uf}}function lV({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=go({tournamentRecords:i,tournamentRecord:r,venueId:n});return xe(a,t,!0)}function ap({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:Ie};if(!i)return{error:Bm};let r="findCourt",n,a;if((e.venues??[]).forEach(s=>{(s.courts??[]).forEach(o=>{o.courtId===i&&(n=o,a=s)})}),n)return{...W,court:n,venue:a};if(t){let s=(OU({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of s){let l=t[o],u=ap({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&KU({tournamentRecord:e,venue:u.venue}),{...W,court:n,venue:a}}}return q({result:{error:Dc},stack:r})}function uV(t){return xe(ap(t),!1,!0)}function TN({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:Ie};if(!i)return{error:Bm};let r=ap({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:h,notes:m})=>({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:h,notes:m}))(r.court);return{...W,courtInfo:xe(n,!1,e)}}function VI(t){let e=He(t,[{[gr]:!0},{venueId:!0,[zs]:Qd}]);if(e.error)return e;let{tournamentRecord:i,venueId:r}=t,n=go({tournamentRecord:i,venueId:r});if(n.error)return n;let a=(n.venue?.courts??[]).map(l=>(({courtInfo:u})=>({...u}))(TN({courtId:l.courtId,internalUse:!0,tournamentRecord:i}))),s=n.venue&&(({venueId:l,venueName:u,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:u,venueId:l}))(n.venue),o=s&&{...s,courtsInfo:a};return{...W,venueData:xe(o,!1,!0)}}function X$e({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:e.reduce((r,n)=>{let a=n.itemType===Oc&&n;return a&&(!r||i(a)>i(r))?a:r},void 0)?.itemValue}}function Vi({event:t,eventId:e}){if(!t)return{error:ci};let i=rt({name:ao,element:t})?.extension,r=e?xe(i?.value,!1,!0):i?.value;return e&&t.drawDefinitions?.forEach(n=>{r?.flights?.forEach(a=>{a.drawId===n.drawId&&Object.assign(a,{drawDefinition:n})})}),{flightProfile:r}}function Kn(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},s=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},o=Object.values(s).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(r){let u,c=o.find(d=>{let p=(d?.drawDefinitions??[]).find(f=>f.drawId===r);if(p)u=p,l=a[d.eventId].tournamentId;else{let f=(d&&Vi({event:d})?.flightProfile)?.flights?.find(h=>h.drawId===r);if(f)return l=a[d.eventId].tournamentId,{entries:f.drawEntries,drawName:f.drawName,tournamentId:l,drawId:r}}return p});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=o.find(c=>c?.eventId===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...q({result:{error:gs},stack:n})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...q({result:{error:za},context:{drawId:r,eventId:i},stack:n})}}function DN(t){let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:s,scheduleTiming:o,matchUpFormat:l,publishStatus:u,matchUp:c}=t;if(!c)return{error:pa};if(n&&!c.matchUpType&&!t.matchUpType&&(e||a)&&c.drawId){let b=t.drawDefinition||e?.drawDefinitions?.find(U=>U.drawId===c.drawId);!b&&a&&({drawDefinition:b,event:e}=Kn({drawId:c.drawId,tournamentRecord:a}));let S=c.structureId&&b?.structures?.find(({structureId:U})=>U===c.structureId);i=t.matchUpType||S?.matchUpType||b?.matchUpType||e?.eventType!==lr&&e?.eventType}let{milliseconds:d,time:p}=W$e({matchUp:c}),{startTime:f}=q$e({matchUp:c}),{endTime:h}=X$e({matchUp:c}),m,{eventIds:g,drawIds:I}=r??{};if((!g||g.includes(c.eventId))&&(!I||I.includes(c.drawId))){let b=X=>X.createdAt?new Date(X.createdAt).getTime():0,S=new Map,U=c.timeItems?.toSorted((X,Z)=>b(X)-b(Z))??[];for(let X of U)S.set(X.itemType,X.itemValue);let T=S.get(nV),D=S.get(Nu),P=S.get(Qm),E=S.get(wN),R=S.get(Jm),C=S.get(aV),M=S.get(bN),N=S.get(Xm),A=S.get(kd),O,k,F,x,L,$=c.matchUpType??i;if(o&&P&&n&&$){let X={matchUpFormat:c.matchUpFormat??l,...o};({averageMinutes:k=0,recoveryMinutes:F=0,typeChangeRecoveryMinutes:x=0}=SN({timingDetails:X,eventType:$})),(k||F)&&(O=h?aa(fi(h),F):aa(P,k+F)),x&&(L=h?aa(fi(h),x):aa(P,k+x))}!R&&P&&(R=Ze(P));let V=rE({scheduledDate:R,scheduledTime:P}),_={},B=(a&&N&&VI({tournamentRecord:a,venueId:N}))?.venueData||{};N&&(_[N]=B);let{venueName:G,venueAbbreviation:j,courtsInfo:Y}=B,K=(A&&Y?.find(X=>X.courtId===A))?.courtName;for(let X of D||[]){if(!a)break;X.venueId&&!_[X.venueid]&&(_[X.venueId]=VI({venueId:X.venueId,tournamentRecord:a})?.venueData);let Z=_[X.venueId];X.venueName=Z?.venueName;let Q=Z?.courtsInfo?.find(ae=>ae.courtId===X.courtId);X.courtName=Q?.courtName}m=je({typeChangeTimeAfterRecovery:L,timeAfterRecovery:O,scheduledDate:R,scheduledTime:P,isoDateString:V,homeParticipantId:T,venueAbbreviation:j,allocatedCourts:D,timeModifiers:E,venueName:G,venueId:N,courtOrder:M,courtName:K,courtId:A,official:C,typeChangeRecoveryMinutes:x,recoveryMinutes:F,averageMinutes:k,milliseconds:d,startTime:f,endTime:h,time:p})}else m=je({milliseconds:d,startTime:f,endTime:h,time:p});let{scheduledDate:v}=Nf({matchUp:c}),{scheduledTime:w}=oV({matchUp:c});if(s&&u?.displaySettings?.draws){let b=u.displaySettings.draws,S=(b?.[c.drawId]??b?.default)?.scheduleDetails;if(S){let U=(S.find(T=>v&&T.dates?.includes(v))??S.find(T=>!T.dates?.length))?.attributes;if(U){let T=Object.assign({},...Object.keys(m).map(D=>({[D]:!0})),U);m=Xh({source:m,template:T})}}}let y=c.matchUpStatus&&Qi.includes(c.matchUpStatus)&&(Ze(h)||Ze(v)||Ze(w))||void 0;return{schedule:m,endDate:y}}function J$e({drawPositions:t,roundProfile:e,roundNumber:i}){let r=[void 0,void 0];if(wie(t))return{orderedDrawPositions:r,displayOrder:r};let n=e?.[i],a=n?.pairedDrawPositions?.find(o=>$n(o||[],t.filter(Boolean)))??r,s=n?.feedRound;if(bie(t)){let o=[...t].sort(or);return{orderedDrawPositions:o.length===2?o:a,displayOrder:s?o:a}}if(s){let o=[t.find(l=>!isNaN(Ke(l))),void 0];return{orderedDrawPositions:o,displayOrder:o}}return{orderedDrawPositions:a,displayOrder:a}}function yE({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=o=>o===void 0?-1:o,s=i.map(o=>{let{collectionAssignments:l,participantId:u}=o,c=l?.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((o,l)=>a(o.substitutionOrder)-a(l.substitutionOrder));for(let o of s){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=o;r.includes(l)||(u&&n.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),r=r.filter(d=>d!==u),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function oo({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:Ie};if(!Array.isArray(i)||i.length>2)return{error:Ua};if(!i.length)return q({result:{error:Jd},stack:r});t=t??e?.participants??[];let n=t.filter(o=>o.participantType===mt&&_i(i,o.individualParticipantIds).length===i.length&&o.individualParticipantIds.length===i.length),a=n[0];if(!a)return q({result:{error:Gi},stack:r});let s=xe(n.slice(1),!1,!0);return{participant:xe(a),duplicatedPairParticipants:s,...W}}function Jp({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:$e};if(typeof e!="string")return{error:pr};let{extension:i}=rt({element:t,name:Cc});return{lineUp:(i?.value||{})[e]}}function Q$e({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:s,sideLineUps:o,matchUpType:l}){if(!s||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:f})=>{let{assignedParticipantIds:h,substitutions:m}=yE({collectionPosition:i,collectionId:s,lineUp:p});if(l===Vt){if(h?.length<=2){let g=n?.[h[0]]?.pairIdMap?.[h[1]],I=(g&&n[g]?.participant||oo({participantIds:h,tournamentParticipants:t}).participant)?.participantId;return{[d]:{participantId:I,teamParticipant:f,substitutions:m}}}else if(h?.length>2)return{[d]:{teamParticipant:f,substitutions:m}}}else{let g=h?.[0];return g&&{[d]:{participantId:g,teamParticipant:f,substitutions:m}}}};if(!r?.length){let d=o?.map(p=>{let{teamParticipant:f,sideNumber:h}=p,m=p.lineUp||Jp({participantId:f.teamParticipantId,drawDefinition:a})?.lineUp;return u({attribute:h,lineUp:m,teamParticipant:f})}).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=r?.map(d=>{let p=e.find(g=>g.drawPosition===d)?.participantId,f=o?.find(g=>g?.drawPosition===d),h=f?.teamParticipant||p&&n?.[p]?.participant||t?.find(({participantId:g})=>g===p),m=f?.lineUp||Jp({participantId:p,drawDefinition:a})?.lineUp;return u({attribute:d,lineUp:m,teamParticipant:h})}).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function PN(t){let e=He(t,[{[Vu]:!0}]);if(e.error)return e;let i=t?.matchUp,r=i?.matchUpType;if(!r&&i?.sides?.length){let n=i.sides.find(({participant:a})=>a)?.participant?.participantType;r=n===yt&&qt||n===mt&&Vt||n===$t&&$t||void 0}return{matchUpType:r}}function Z$e({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:s,sideNumber:o}){let l=i.find(f=>f.drawPosition&&f.drawPosition===a),u=a&&t,c=o&&e,d=u?u[a]?.participantId:l?.participantId,p=l?eBe({displaySideNumber:r,seedAssignments:n,participantId:d,assignment:l,sideNumber:o}):{...c?.[o]};if(s&&(o===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&u){let f=u[a]?.teamParticipant,h=u[a]?.participant,m=u[a]?.substitutions;h&&(p.participant=h),m&&(p.substitutions=m),f&&(p.teamParticipant=f)}return p}function eBe({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let s=tBe({seedAssignments:e,participantId:i});Object.assign(a,s,{participantId:i}),s?.seedNumber&&s?.seedValue===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function tBe({seedAssignments:t,participantId:e}){return t?.find(i=>!i.seedProxy&&i.participantId===e)}function gse({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:s,initialRoundOfPlay:o,additionalContext:l,roundNamingProfile:u,tournamentRecord:c,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:f,seedAssignments:h,usePublishState:m,participantMap:g,contextContent:I,scheduleTiming:v,contextProfile:w,drawDefinition:y,publishStatus:b,scoringActive:S,matchUpTieId:U,isRoundRobin:T,roundProfile:D,sideLineUps:P,structure:E,context:R,matchUp:C,event:M}){l=l??{};let N=bn({drawDefinition:y,structure:E,matchUp:C,event:M})?.tieFormat,{roundOffset:A,structureId:O,structureName:k,stage:F,stageSequence:x}=E,{drawId:L,drawName:$,drawType:V}=y??{},_=N?.collectionDefinitions,B=C.collectionId&&_?.find(J=>J.collectionId===C.collectionId),G=C.collectionId?B?.matchUpFormat:C.matchUpFormat??E?.matchUpFormat??y?.matchUpFormat??M?.matchUpFormat,j=C.matchUpType||B?.matchUpType||E?.matchUpType||y?.matchUpType||!Di(lr)(M?.eventType)&&M?.eventType,Y=f?"BYE":C.matchUpStatus,{schedule:K,endDate:X}=DN({scheduleVisibilityFilters:t,afterRecoveryTimes:s,tournamentRecord:c,usePublishState:m,scheduleTiming:v,drawDefinition:y,matchUpFormat:G,publishStatus:b,matchUpType:j,matchUp:C,event:M}),Z=d??C.drawPositions??[],{collectionPosition:Q,collectionId:ae,roundPosition:te}=C,ne=C.roundNumber??l.roundNumber,le=ae?Q$e({tournamentParticipants:i,positionAssignments:r,collectionPosition:Q,participantMap:g,drawDefinition:y,drawPositions:Z,collectionId:ae,sideLineUps:P,matchUpType:j}):void 0,de=u?.[ne]?.roundName||l.roundName,pe=u?.[ne]?.abbreviatedRoundName||l.abbreviatedRoundName,ve=D?.[ne]?.feedRound,Me=D?.[ne]?.preFeedRound,Ee=D?.[ne]?.roundFactor,Be=n?.[ne],fe=te?Be?.[te]:void 0,Te=e?.[ne],ce=B?.category?{...R?.category,...B.category}:R?.category??M?.category,be=C.processCodes?.length&&C.processCodes||B?.processCodes?.length&&B?.processCodes||E?.processCodes?.length&&E?.processCodes||y?.processCodes?.length&&y?.processCodes||M?.processCodes?.length&&M?.processCodes||c?.processCodes,we=w?.withCompetitiveness&&qU({...I,matchUp:C}),Ae=C.finishingPositionRange??l.finishingPositionRange,ye=F!==ze&&ct(o)&&o+(ne||0),Ne=J=>je(J,void 0,!0),he={...Ne(R),...Ne({matchUpFormat:j===lr?void 0:G,tieFormat:j===lr?N:void 0,gender:B?.gender??M?.gender,endDate:C.endDate??X,discipline:M?.discipline,category:ce,finishingPositionRange:Ae,abbreviatedRoundName:pe,drawPositionsRange:fe,competitiveProfile:we,structureName:k,stageSequence:x,drawPositions:Z,matchUpStatus:Y,processCodes:be,isRoundRobin:T,matchUpTieId:U,preFeedRound:Me,matchUpType:j,roundFactor:Ee,roundOffset:A,structureId:O,roundNumber:ne,roundOfPlay:ye,feedRound:ve,roundName:de,drawName:$,drawType:V,schedule:K,drawId:L,stage:F}),...xe(Ne(C),!0,!0)};if(G&&C.score?.scoreStringSide1){let J=Xi(G),{bestOf:se,finalSetFormat:oe,setFormat:ue}=J??{};(oe?.tiebreakSet||ue?.tiebreakSet||ue?.timed)&&(he.score.sets=he.score.sets.sort((ee,Se)=>ee.setNumber-Se.setNumber).map((ee,Se)=>{let Pe=Se+1===se&&oe?oe:ue,st=Pe?.tiebreakSet&&!Pe?.timed,Ue=Pe?.timed;return st?(ee.tiebreakSet=!0,[1,2].includes(ee.winningSide)&&(ee.side1Score=ee.winningSide===1?1:0,ee.side2Score=ee.winningSide===2?1:0)):Ue&&(ee.timed=!0),ee}))}if(Array.isArray(Z)){let{orderedDrawPositions:J,displayOrder:se}=J$e({drawPositions:Z,roundProfile:D,roundNumber:ne}),oe=D?.[ne]?.feedRound,ue=se[0]!==J[0],ee=J.concat(void 0,void 0).slice(0,2).map((Se,Pe)=>{let st=Pe+1,Ue=ue?3-st:st,dt=Z$e({...le,positionAssignments:r,displaySideNumber:Ue,seedAssignments:h,drawPosition:Se,isFeedRound:oe,sideNumber:st}),bi=C.sides?.find(li=>li.sideNumber===st),qe=te?(te-1)*2+Pe+1:void 0,wi=qe?Te?.[qe]:void 0;return Ne({sourceDrawPositionRange:wi,...bi,...dt})});Object.assign(he,xe({sides:ee},!0,!0))}if(i&&he.sides){let J=p?.[Kv],se=oe=>{let ue=g?.[oe]?.participant;return ue&&Xh({template:J?.participant,source:ue})};if(he.sides.filter(Boolean).forEach(oe=>{if(oe.participantId){let ue=xe(se(oe.participantId)||(i?Cd({policyDefinitions:p,participantId:oe.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:w}):void 0),void 0,!0);if(ue){let ee,Se;if(y?.entries){let Pe=y.entries.find(Ue=>Ue.participantId===oe.participantId),st=M?.entries?.find(Ue=>Ue.participantId===oe.participantId);ee=Pe?.entryStatus||st?.entryStatus,ue.entryStatus=ee,Pe?.entryStage&&(Se=Pe.entryStage,ue.entryStage=Se)}a===!1?Object.assign(oe,{participant:{entryStage:Se,entryStatus:ee}}):Object.assign(oe,{participant:ue})}}if(oe?.participant?.individualParticipantIds?.length&&!oe.participant.individualParticipants?.length){let ue=oe.participant.individualParticipantIds.map(ee=>se(ee)||(i?Cd({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:w,participantId:ee}):void 0));a!==!1&&Object.assign(oe.participant,{individualParticipants:ue})}}),!he.matchUpType){let{matchUpType:oe}=PN({matchUp:he});oe&&Object.assign(he,{matchUpType:oe})}if(w?.inferGender&&(!he.gender||he.gender===Hm)&&he.sides?.length===2&&he.matchUpType!==lr){let oe=he.sides.map(ue=>{if(Di(qt)(he.matchUpType))return ue.participant?.person?.sex;if(ue.participant?.individualParticipants?.length===2){let ee=lt(ue.participant.individualParticipants.map(Se=>Se.person?.sex)).filter(Boolean);if(ee.length===1)return ee[0]}});if(oe.filter(Boolean).length===2&&lt(oe).length===1){let ue=oe[0];he.inferredGender=ue}}}if(he.tieMatchUps){let J=he.matchUpStatus==="BYE",se=he.sides?.map(({participant:oe,drawPosition:ue,sideNumber:ee,lineUp:Se})=>{let Pe=oe?.participantType===lr&&oe;return{teamParticipant:Pe&&je({participantRoleResponsibilities:Pe.participantRoleResponsibilities,participantOtherName:Pe.participanOthertName,participantName:Pe.participantName,participantId:Pe.participantId,teamId:Pe.teamId}),drawPosition:ue,sideNumber:ee,lineUp:Se}});he.tieMatchUps=he.tieMatchUps.map(oe=>{let ue=he.matchUpId,ee={finishingPositionRange:he.finishingPositionRange,abbreviatedRoundName:pe,roundNumber:ne,roundName:de};return gse({tieDrawPositions:Z,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:se,drawPositionsRanges:n,initialRoundOfPlay:o,roundNamingProfile:u,additionalContext:ee,appliedPolicies:p,isCollectionBye:J,usePublishState:m,publishStatus:b,matchUpTieId:ue,isRoundRobin:T,roundProfile:D,matchUp:oe,event:M,tournamentParticipants:i,positionAssignments:r,tournamentRecord:c,seedAssignments:h,participantMap:g,contextContent:I,scheduleTiming:v,contextProfile:w,drawDefinition:y,scoringActive:S,structure:E,context:R})})}let De=he.sides?.filter(J=>J?.participantId).length===2,Le=!he.winningSide;if(Object.assign(he,{readyToScore:S&&De&&Le,hasContext:!0}),De){let{allParticipantsCheckedIn:J,checkedInParticipantIds:se}=Zm({matchUp:he});Object.assign(he,{allParticipantsCheckedIn:J,checkedInParticipantIds:se})}return Array.isArray(w?.exclude)&&w?.exclude.forEach(J=>delete he[J]),he}function iBe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Mf({timeItems:i?.timeItems||[],itemType:Nu});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:xe(r,!1,!0)}:e}function rBe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Mf({timeItems:i?.timeItems||[],itemType:kd});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function nBe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Mf({timeItems:i?.timeItems||[],itemType:Xm});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function rc(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:s,matchUpFormats:o,roundPositions:l,matchUpFormat:u,collectionIds:c,isMatchUpTie:d,roundNumbers:p,matchUpIds:f,roundNames:h,filterMatchUpTypes:m=!0,filterMatchUpIds:g=!0,stageSequences:I,scheduledDates:v,scheduledDate:w,participantIds:y,processContext:b,tournamentIds:S,matchUpTypes:U,structureIds:T,readyToScore:D,courtIds:P,eventIds:E,venueIds:R,drawIds:C,stages:M}=t,N=Array.isArray(y)?y.filter(Boolean):[],A=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],k=Array.isArray(M)?M.filter(Boolean):[],F=Array.isArray(I)?I.filter(Boolean):[],x=Array.isArray(c)?c.filter(Boolean):[],L=Array.isArray(h)?h.filter(Boolean):[],$=Array.isArray(p)?p.filter(Boolean):[],V=Array.isArray(l)?l.filter(Boolean):[],_=Array.isArray(f)&&g?f.filter(Boolean):[],B=Array.isArray(U)&&m?U.filter(Boolean):[],G=Array.isArray(P)?P.filter(Boolean):[],j=Array.isArray(R)?R.filter(Boolean):[],Y=Array.isArray(o)&&o.filter(Boolean)||typeof u=="string"&&[u]||[],K=Array.isArray(v)&&v.filter(Boolean)||typeof w=="string"&&w.length&&[w]||[],X=Array.isArray(S)?S.filter(Boolean):[],Z=Array.isArray(E)?E.filter(Boolean):[],Q=Array.isArray(C)?C.filter(Boolean):[],ae=Array.isArray(T)?T.filter(Boolean):[];return e.filter(te=>{if(D&&!Di(Wa)(te)&&!te.readyToScore||te.winningSide&&s&&![1,2].includes(te.winningSide)||d!==void 0&&(d&&!te.tieMatchUps||!d&&te.tieMatchUps)||n!==void 0&&(n&&!te.collectionId||!n&&te.collectionId)||k.length&&!k.includes(te.stage)||F.length&&!F.includes(te.stageSequence)||x.length&&(!te.collectionId||!x.includes(te.collectionId))||L.length&&(!te.roundName||!L.includes(te.roundName))||$.length&&(!te.roundNumber||!$.includes(te.roundNumber))||V.length&&(!te.roundPosition||!V.includes(te.roundPosition))||A.length&&(!te.matchUpStatus||!A.includes(te.matchUpStatus))||O.length&&te.matchUpStatus&&O.includes(te.matchUpStatus)||_.length&&!_.includes(te.matchUpId)||B.length&&(!te.matchUpType||!wh(B,te.matchUpType))||Y.length&&(!te.matchUpFormat||!Y.includes(te.matchUpFormat)))return!1;if(K?.length){let{scheduledTime:ne}=oV({matchUp:te}),{scheduledDate:le}=Nf({matchUp:te}),de=Ze(ne)||le;if(!K.some(pe=>Su(pe,de)))return!1}if(G.length){let{courtId:ne}=rBe({matchUp:te}),{allocatedCourts:le}=iBe({matchUp:te}),de=le?.map(({courtId:pe})=>pe);if(!G.filter(Boolean).includes(ne)||de?.includes(ne))return!1}if(j.length){let{venueId:ne}=nBe({matchUp:te});if(!j.filter(Boolean).includes(ne))return!1}if(b){if(X.length&&!X.includes(te.tournamentId)||Z.length&&!Z.includes(te.eventId)||Q.length&&!Q.includes(te.drawId)||ae.length&&!ae.includes(te.structureId))return!1;let ne=te.sides?.map(({participantId:le})=>le).filter(Boolean)??[];if(r&&ne.length<r||N.length&&!N.some(le=>ne.includes(le)))return!1}return!0})}function Ot(t){let{provisionalPositioning:e,tournamentRecord:i,contextFilters:r,matchUpFilters:n,contextProfile:a,drawDefinition:s,context:o={},structure:l,inContext:u,event:c}=t,{seedAssignments:d,contextContent:p,exitProfiles:f,matchUpsMap:h}=t,m={},g={};if(!l)return{collectionPositionMatchUps:m,error:wf,roundMatchUps:g,matchUps:[]};let I=Array.isArray(n?.eventIds)?n?.eventIds.filter(Boolean):[],v=Array.isArray(n?.structureIds)?n?.structureIds.filter(Boolean):[],w=Array.isArray(n?.drawIds)?n?.drawIds.filter(Boolean):[],y=!o?.eventId||!I?.length&&!r?.eventIds?.filter(Boolean).length||I?.includes(o.eventId)||r?.eventIds?.includes(o.eventId),b=!v?.length||v.includes(l.structureId),S=!s||!w?.length||w.includes(s.drawId);if(!y||!b||!S)return{collectionPositionMatchUps:m,roundMatchUps:g,matchUps:[]};a&&!p&&(p=Xc({tournamentRecord:i,contextProfile:a,drawDefinition:s}));let{appliedPolicies:U}=Ct({drawDefinition:s}),T={...t.tournamentAppliedPolicies,...U,...t.policyDefinitions},D=T?.scoring?.structures,P=l.stage&&D?.stage?.[l.stage],E=l.stageSequence&&P?.stageSequence?.[l.stageSequence],R=T?.scoring?.requireAllPositionsAssigned||P?.requireAllPositionsAssigned||E?.requireAllPositionsAssigned;h||(h=xr({drawDefinition:s,structure:l}));let{positionAssignments:C,allPositionsAssigned:M}=fr({structure:l}),N=!R||M,{seedAssignments:A}=ys({provisionalPositioning:e,drawDefinition:s,structure:l});d=d??A;let{structureId:O}=l;f=f||s&&Kae({drawDefinition:s}).exitProfiles;let k=f?.[O],F=k?.length&&(k[0].split("-").map(G=>parseInt(G)).reduce((G,j)=>G+j)||0),x=!!l.structures,L=Ad({matchUpsMap:h,structureId:O,inContext:u}),$=T?.[Rc],V=Xae({roundNamingPolicy:$,drawDefinition:s,structure:l,matchUps:L}),{roundNamingProfile:_,roundProfile:B}=V;if(g=V?.roundMatchUps??[],n&&(L=rc({matchUps:L,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),u){let{sourceDrawPositionRanges:G}=S$e({drawDefinition:s,matchUpsMap:h,structureId:O}),j=s?U$e({drawDefinition:s,roundProfile:B,matchUpsMap:h,structureId:O}).drawPositionsRanges:void 0,Y=t.tournamentParticipants,K=t.participantMap;!Y?.length&&!K&&i&&({participants:Y=[],participantMap:K}=Pf({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:u})),L=L.map(X=>gse({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:G,tournamentParticipants:Y,positionAssignments:C,drawPositionsRanges:j,initialRoundOfPlay:F,roundNamingProfile:_,tournamentRecord:i,appliedPolicies:T,seedAssignments:d,contextContent:p,participantMap:K,contextProfile:a,drawDefinition:s,scoringActive:N,isRoundRobin:x,roundProfile:B,structure:l,context:o,matchUp:X,event:c})),(L?.filter(X=>Array.isArray(X.tieMatchUps))).forEach(X=>{let Z=X.tieMatchUps;L=L.concat(...Z)}),r&&(L=rc({processContext:!0,...r,matchUps:L}))}else(L?.filter(G=>Array.isArray(G.tieMatchUps))).forEach(G=>{let j=G.tieMatchUps;L=L.concat(...j)});return n&&(L=rc({matchUps:L,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n?.matchUpTypes||n?.matchUpIds)&&(L=rc({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:L})),(n?.matchUpTypes||n?.matchUpIds||u)&&(g=Un({matchUps:L}).roundMatchUps??[]),bn({drawDefinition:s,structure:l,event:c})?.tieFormat&&({collectionPositionMatchUps:m}=b$e({matchUps:L})),{collectionPositionMatchUps:m,roundMatchUps:g,isRoundRobin:x,roundProfile:B,matchUpsMap:h,matchUps:L}}function Dp({matchUp:t}){return t?Qi.includes(t?.matchUpStatus)||t?.winningSide:!1}function EN({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:h,contextProfile:m,drawDefinition:g,exitProfiles:I,matchUpsMap:v,structureId:w,inContext:y,structure:b,context:S,event:U}){!b&&w&&({structure:b}=tt({drawDefinition:g,structureId:w}));let T=Ot({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:h,contextProfile:m,drawDefinition:g,exitProfiles:I,matchUpsMap:v,structure:b,inContext:y,context:S,event:U}),D=[],P=[],E=[],R=[],C=[];if(T.error)return T;let{matchUps:M}=T,{assignedPositions:N}=fr({structure:b}),A=N?.filter(k=>k.participantId).map(k=>k.drawPosition),O;return M.filter(k=>{let F=u?.matchUpTypes?.length===1&&u.matchUpTypes[0]===ti;return!(k.matchUpType!==ti&&F)}).forEach(k=>{if(k.matchUpStatus===Ma){D.push(k);return}k.matchUpType===ti&&(O=!0);let F=!!k.collectionId,x=F&&k.sides?.every(G=>G.participantId),L=!F&&k.drawPositions?.filter(Boolean).length===2,$=!F&&k.drawPositions?.every(G=>A?.includes(G)),V=N?.filter(G=>G.bye).map(G=>G.drawPosition),_=!F&&k.drawPositions?.find(G=>V?.includes(G)),B=Rae.includes(k.matchUpStatus)&&(x||L&&(!t||$));return _?C.push(k):Dp({matchUp:k})?P.push(k):B?E.push(k):R.push(k)}),{includesTeamMatchUps:O,abandonedMatchUps:D,completedMatchUps:P,upcomingMatchUps:E,pendingMatchUps:R,byeMatchUps:C,structure:b}}function aBe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:$e};if(!i)return{error:es};let{links:r}=Zv({drawDefinition:t,structureId:i}),n=r.source.reduce((s,o)=>!o.source.roundNumber||o.source.roundNumber===e?s.concat(o):s,[]),a=r.target.reduce((s,o)=>!o.target.roundNumber||o.target.roundNumber===e?s.concat(o):s,[]);return{links:{source:n,target:a}}}function Fk({finishingPositions:t,linkCondition:e,linkType:i,source:r}){let n=r.find(a=>{let s=!a.source?.finishingPositions||!t||$n(t,a.source?.finishingPositions);return e===a.linkCondition&&s&&a.linkType===i});return[Tu,Du].includes(n?.linkType)&&!n?.source?.roundNumber?q({result:{error:re},stack:"getTargetLink",context:n}):n}function Zv({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>(n.source?.structureId===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),n.target?.structureId===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r),{source:[],target:[]})}:{error:es}:{error:$e}}function sBe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(s=>s.roundNumber===i&&!s.matchUpTieId),a=t.filter(s=>s.roundNumber===i+1&&!s.matchUpTieId);if(a.length){let s;return a.length===n.length?s=a.find(o=>o.roundPosition===r):a.length===n.length/2&&(s=a.find(o=>o.roundPosition===Math.ceil(r/2))),{matchUp:s}}return{message:"no progression found"}}function Lk({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){if(!n)return{error:OB};let{target:{structureId:a,feedProfile:s,groupedOrder:o,roundNumber:l,positionInterleave:u}}=n,{structure:c}=tt({drawDefinition:r,structureId:a}),{positionAssignments:d}=Xt({structure:c}),p=(e?.filter(D=>D.structureId===c?.structureId)).filter(D=>D.roundNumber===l&&!D.matchUpTieId),f=p.length,h=Ce(1,f+1),m=f/t,g=Math.ceil(m*i),I=1-i%2;if(u?.interleave&&m!==.5){let D=u.offset+(i-1)*u.interleave,P=i+D;g=Math.ceil(P/2),I=1-P%2}let v=h,w=h[g-1],y=Yae({roundPositionsCount:h.length,groupedOrder:o}),b=y?.length||1;if(b<=h.length){let D=f/b,P=Sr(h,D);s===Yp&&P.forEach(E=>E.reverse()),v=y?.length&&y?.map(E=>P[E-1]).flat()||v}s===Fs?w=v[g-1]:s===Yp?((!y?.length||b>h.length)&&(g=p.length+1-g),w=v[g-1]):s===ZM&&ha()&&console.log(QB,{feedProfile:s});let S=w&&p.reduce((D,P)=>P.roundPosition===w?P:D,void 0),U;S?.feedRound?(I=0,U=Math.min(...(S.drawPositions||[]).filter(Boolean))):U=S?.drawPositions?.length===2&&S?.drawPositions[I];let T=d?.find(({drawPosition:D})=>D===U);if(T){let{extension:D}=rt({element:T,name:dN});if(D?.value)return{disabledDrawPosition:U}}return{matchUp:S,targetDrawPosition:U,matchUpDrawPositionIndex:I}}function Bn({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(o=>o.matchUpId===n));let{structure:s}=tt({structureId:a?.structureId,drawDefinition:r});return s?.finishingPosition===zm?oBe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:s,matchUp:a}):lBe({matchUp:a})}function oBe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){let{winnerMatchUpId:a,loserMatchUpId:s}=n,{links:o}=aBe({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),l=o?.source,u=Fk({source:l,linkType:Tu}),c=Fk({linkCondition:wl,linkType:Du,source:l}),d=Fk({source:l,linkType:Du}),p=c&&d;d||(d=c);let f=u?.target?.feedProfile,h=d?.target?.feedProfile,m=c?.target?.feedProfile,g,I,v,w,y,b,S,U,T,D;if(e&&(a||s)&&(S=a&&f!==So&&t.find(({matchUpId:R})=>R===a),w=s&&h!==So&&t.find(({matchUpId:R})=>R===s),S||w))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u},targetMatchUps:{loserMatchUp:w,winnerMatchUp:S}};let{roundPosition:P}=n;D=D||t.filter(R=>R.structureId===r.structureId);let E=D.reduce((R,C)=>C.roundNumber===n.roundNumber&&!C.matchUpTieId?R+1:R,0);return d&&!w&&h!==So&&({matchUpDrawPositionIndex:b,targetDrawPosition:y,matchUp:w}=Lk({targetLink:d,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),p&&m!==So&&({matchUpDrawPositionIndex:v,targetDrawPosition:I,matchUp:g}=Lk({targetLink:c,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),u&&!S&&f!==So&&({matchUpDrawPositionIndex:T,targetDrawPosition:U,matchUp:S}=Lk({targetLink:u,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),S||(D=D||t.filter(R=>R.structureId===r.structureId),{matchUp:S}=sBe({structureMatchUps:D,matchUp:n})),je({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u,byeTargetLink:c},targetMatchUps:{winnerMatchUpDrawPositionIndex:T,loserMatchUpDrawPositionIndex:b,byeMatchUpDrawPositionIndex:v,winnerTargetDrawPosition:U,loserTargetDrawPosition:y,byeTargetDrawPosition:I,winnerMatchUp:S,loserMatchUp:w,byeMatchUp:g},targetMatchUpIds:!!(a||s)})}function lBe({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function uBe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{let{matchUpId:n,structureId:a,drawPositions:s=[]}=r,{structure:o}=tt({drawDefinition:t,structureId:a});if(o?.finishingPosition===Kp){let{roundNumber:l}=r,u=l&&Ke(l)+1,c=o.matchUps??[],{roundMatchUps:d}=Un({matchUps:c});if(u&&d?.[u]){let p=[...s].sort(or).map((f,h)=>{let m=d[u].find(g=>g.drawPositions?.includes(f));return{matchUpId:m?.matchUpId,roundNumber:u,schedule:m?.schedule,sideNumber:h+1,structureName:o.structureName}});Object.assign(r,{sidesTo:p})}}else{let l=Bn({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:n}),{winnerMatchUp:u}=l.targetMatchUps,{loserMatchUp:c}=l.targetMatchUps;!r.winnerMatchUpId&&u&&(r.winnerMatchUpId=u.matchUpId),!r.loserMatchUpId&&c&&(r.loserMatchUpId=c.matchUpId);let d=_k({upcomingMatchUp:u}),p=_k({upcomingMatchUp:c});if(r.matchUpStatus!=="BYE"&&c?.matchUpStatus==="BYE"){let{matchUp:h}=Ise({matchUp:c,drawDefinition:t,inContextDrawMatchUps:e})||{};p=h&&_k({upcomingMatchUp:h})||p}let f=r.schedule?.timeAfterRecovery;if(f&&(d?.schedule?.scheduledTime&&Nt(d.schedule.scheduledTime)<Nt(f)&&(i[d.matchUpId]=r.matchUpId,d.schedule.scheduleConflict=r.matchUpId),p?.schedule?.scheduledTime&&Nt(p.schedule.scheduledTime)<Nt(f)&&(i[p.matchUpId]=r.matchUpId,p.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:d,loserTo:p}),r.drawPositions?.filter(Boolean).length){let h=l.targetLinks?.loserTargetLink?.linkCondition===wl,m=cBe(r);if(m.length){let g=Zx(u?.sides),I=Zx(c?.sides),v=m.find(({participantId:y})=>g.includes(y))?[]:m,w=m.find(({participantId:y})=>I.includes(y))?[]:m;c&&h&&w.length<2&&w.push({bye:!0,tbd:!0}),v?.length&&u&&(!l.targetMatchUpIds&&u&&(u=e.find(({matchUpId:y})=>y===u.matchUpId)),u.potentialParticipants||(u.potentialParticipants=[]),u.potentialParticipants.push(v)),w?.length&&c&&(l.targetMatchUpIds||(u=e.find(({matchUpId:y})=>y===c.matchUpId)),c.potentialParticipants||(c.potentialParticipants=[]),c.potentialParticipants.push(w))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function cBe(t){return t?.sides?.map(({participant:e,participantId:i,qualifier:r})=>e||i&&{participantId:i}||r&&{qualifier:r}).filter(Boolean)||[]}function Ise({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){let{matchUpId:r,matchUpStatus:n,structureId:a}=t||{};if(!t||!a||t?.matchUpStatus===$i)return{matchUp:t};if(n==="BYE"){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:o})=>o===t.winnerMatchUpId):{winnerMatchUp:s}=Bn({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r})?.targetMatchUps||{},Ise({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function _k(t){if(t?.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s}))(t.upcomingMatchUp)}function nr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=ey(t);if(i.error)return q({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:s,byeMatchUps:o,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...s??[],...o??[]),matchUpsMap:l}}function ey(t){if(!t?.drawDefinition)return{error:$e};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:s,participantsProfile:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,scheduleTiming:h,participantMap:m,publishStatus:g,contextProfile:I,drawDefinition:v,nextMatchUps:w,inContext:y,context:b,event:S}=t,U=[],T=[],D=[],P=[],E=[];I&&!i&&(i=Xc({policyDefinitions:u,tournamentRecord:c,contextProfile:I,event:S}));let R;!e?.length&&c&&(e=c?.participants,(y||o?.withGroupings)&&e?.length&&({participantsWithGroupings:e,groupInfo:R}=IN({participants:e,participantsProfile:o})));let{structures:C}=so({drawDefinition:v});if(!C)return{error:yi};r||(r=xr({drawDefinition:v}));let M=v&&Kae({drawDefinition:v}).exitProfiles;C.forEach(O=>{let{byeMatchUps:k=[],pendingMatchUps:F=[],upcomingMatchUps:x=[],completedMatchUps:L=[],abandonedMatchUps:$=[]}=EN({matchUpFilters:w?void 0:f,contextFilters:w?void 0:p,inContext:y||w||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:h,publishStatus:g,contextProfile:I,drawDefinition:v,exitProfiles:M,matchUpsMap:r,structure:O,context:b,event:S});U=U.concat(...$),T=T.concat(...L),D=D.concat(...x),P=P.concat(...F),E=E.concat(...k)});let N=O=>(!f&&!w&&!p||(f&&(O=rc({matchUps:O,...f})),p&&(O=rc({matchUps:O,...p,processContext:!0}))),O),A={abandonedMatchUps:N(U),completedMatchUps:N(T),upcomingMatchUps:N(D),pendingMatchUps:N(P),byeMatchUps:N(E),matchUpsMap:r,...W,groupInfo:R};if(w){let O=typeof w=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:k,completed:F,upcoming:x,pending:L,bye:$}=O,V=[].concat(...k&&U||[],...F&&T||[],...x&&D||[],...L&&P||[],...$&&E||[]);uBe({inContextDrawMatchUps:V,drawDefinition:v})}return A}function Gu(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:h,nextMatchUps:m,inContext:g,context:I,event:v}=t;if(!v)return{error:ci};let{eventId:w,eventName:y,endDate:b,eventType:S,category:U,gender:T,matchUpFormat:D}=v??{},P={...I,...je({indoorOutDoor:v.indoorOutdoor??c?.indoorOutdoor,surfaceCategory:v.surfaceCategory??c?.surfaceCategory,endDate:v.endDate??c?.endDate,tournamentId:c?.tournamentId,matchUpFormat:D,eventName:y,eventType:S,category:U,eventId:w,gender:T})};b&&(P.endDate=b),h&&!i&&(i=Xc({policyDefinitions:l,tournamentRecord:c,contextProfile:h,event:v}));let E;if(!e?.length&&!r&&c){let M=Pf({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:h,inContext:g});r=M.participantMap,e=M.participants??[],E=M.groupInfo}let R=v.drawDefinitions??[],C=$U({tournamentRecord:c,event:v}).scheduleTiming;return{matchUps:R.flatMap(M=>{let{matchUps:N}=nr({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:P,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextFilters:p,contextProfile:h,drawDefinition:M,contextContent:i,matchUpFilters:f,participantMap:r,scheduleTiming:C,nextMatchUps:m,inContext:g,event:v});return N??[]}),groupInfo:E}}function Tr(t){let e=He(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!t?.tournamentRecord)return{error:Ie};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:s,useParticipantMap:o,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,usePublishState:d,contextProfile:p,matchUpFilters:f,contextFilters:h,nextMatchUps:m,context:g}=t,I=t.tournamentId??u.tournamentId,v=u?.events??[];r||({participants:r,participantMap:i}=Pf({participantsProfile:a,useParticipantMap:o,tournamentRecord:u,contextProfile:p,inContext:c}));let{appliedPolicies:w}=Ct({tournamentRecord:u}),y={...g,tournamentId:I,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},b=Xc({policyDefinitions:l,tournamentRecord:u,contextProfile:p});return{matchUps:v.flatMap(S=>(y.eventDrawsCount=S.drawDefinitions?.length??0,Gu({context:y,scheduleVisibilityFilters:n,tournamentAppliedPolicies:w,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:b,contextFilters:h,contextProfile:p,matchUpFilters:f,participantMap:i,nextMatchUps:m,participants:r,inContext:c,event:S}).matchUps??[])).concat(...u.matchUps??[])}}function _o({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}){if(typeof r!="object"||!Object.keys(r).length)return{error:Ci};let c=Object.keys(r).map(d=>{let p=r[d];return Tr({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:p,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}).matchUps??[]}).flat();return{...W,matchUps:c}}function eg(t,e){return dBe(t,e)||(t?.stageSequence||0)-(e?.stageSequence||0)||t?.roundNumber&&e.roundNumber&&t?.roundNumber-e?.roundNumber||(t?.roundPosition??0)-(e?.roundPosition??0)}function dBe(t,e){return(Kh[t?.stage]||0)-(Kh[e?.stage]||0)}function xn(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:f,drawDefinition:h,nextMatchUps:m,inContext:g,context:I,event:v}=t,{eventId:w,eventName:y,endDate:b,eventType:S,category:U,gender:T,matchUpFormat:D}=v??{},P={...I,surfaceCategory:v?.surfaceCategory??c?.surfaceCategory,indoorOutDoor:v?.indoorOutdoor??c?.indoorOutdoor,matchUpFormat:D,eventType:S,eventName:y,category:U,eventId:w,endDate:b,gender:T},E;return!e?.length&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:E}=Pf({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:f,inContext:g})),f&&!r&&(r=Xc({policyDefinitions:l,tournamentRecord:c,contextProfile:f,drawDefinition:h,event:v})),{...nr({context:P,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,drawDefinition:h,contextContent:r,contextFilters:p,contextProfile:f,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:v}),groupInfo:E}}function Pp({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=xe(t),r=e.split("."),n=[],a;o({targetElement:i,attributes:r});let s={value:a};return n.length&&(s.values=n),s;function o({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,f]of u.entries())if(l?.[f]){let h=u.slice(p+1);h.length?Array.isArray(l[f])?l[f].forEach(m=>o({targetElement:m,attributes:h})):(l=l[f],d({targetElement:l,index:p})):(a||(a=l[f]),n.includes(l[f])||n.push(l[f]))}function d({targetElement:p,index:f}){if(p&&f===u.length-1&&["string","number"].includes(typeof p)){let h=c?p.slice(0,c):p;a?n.includes(h)||n.push(h):(a=h,n.push(h))}}}}var vse=t=>e=>!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(i=>({[i]:Pp({element:e,accessor:i})?.value}))||typeof t=="object"&&Object.keys(t).map(i=>({[i]:Pp({element:e,accessor:i})?.value}))||(typeof t=="string"&&Pp({element:e,accessor:t}))?.value,Aa=vse;function XU({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:s,fmlc:o}){if(!is(a))return[];let{roundProfile:l,roundNumbers:u=[]}=Un({interpolate:!0,matchUps:a});r=r??Math.max(...u,0);let c=n?r-n:0,d=c&&l?.[r-c]?.matchUpsCount,p=l&&Object.values(l).map(Aa("matchUpsCount")),f=(g,I)=>{let v=Math.min(...g);d&&I&&v===1&&(v=d);let w=Math.max(...g);return e&&w>e&&(w=e),[v,w]},h=l&&Object.assign({},...u.map(g=>{let I=(r??0)+1-g-c,v=l[g].matchUpsCount,w={finishingPositionRange:{},finishingRound:I},y=p?.slice(g-1).reduce((R,C)=>R+(C||0),0),b=o&&g!==1,S=1+t+(b?i??0:0),U=1,T=Ce(S,s?S+v*2:y+S+U),D=y+U-v,P=f(T.slice(D)),E=f(T.slice(0,D),!0);return w.finishingPositionRange={loser:P,winner:E},{[g]:w}})),m=ha({finishingRound:!0});return a.filter(Boolean).forEach(g=>{let I=g.roundNumber&&h[g.roundNumber];m&&!I&&console.log({roundFinishingData:h,matchUp:g}),g.finishingRound=I?.finishingRound,g.finishingPositionRange=I?.finishingPositionRange}),a}function Qp({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){if(!e)return{error:$e};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=nr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!i?.drawMatchUps.some(n=>n.finishingPositionRange)&&e?.structures?.length===1&&!e?.structures[0].structures){let n=i?.drawMatchUps??[];XU({matchUps:n})}return(t??[]).filter(({collectionId:n})=>!n).forEach(n=>{let{matchUpId:a,structureId:s}=n,o=Bn({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:a}),{winnerMatchUp:l,loserMatchUp:u}=o.targetMatchUps,c=l?.matchUpId,d=u?.matchUpId,p=Ad({matchUpsMap:i,structureId:s}).find(f=>f.matchUpId===a);if(p&&(c&&(r.winnerMatchUpIds[p.matchUpId]=c,Object.assign(p,{winnerMatchUpId:c}),Object.assign(n,{winnerMatchUpId:c})),d&&(r.loserMatchUpIds[p.matchUpId]=d,n.loserMatchUpId=d,p.loserMatchUpId=d,n.finishingPositionRange))){let f=u.finishingPositionRange&&[...n.finishingPositionRange.loser,...u.finishingPositionRange.loser],h=f&&[Math.min(...f),Math.max(...f)];n.finishingPositionRange.loser=h,p.finishingPositionRange.loser=h}}),{inContextDrawMatchUps:t,goesToMap:r}}function Io(t){let e=Ds(t),i=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:s}=t;if(!Array.isArray(i))return{error:Bu};if(!Array.isArray(r))return{error:jo};let o=t.matchUpIds?.length?t.matchUpIds:i.map(v=>v.matchUpId);if(!Array.isArray(o))return{error:$m};let l={},u={},c={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),f=p.reduce((v,w)=>v.concat(w.events??[]).map(y=>(y.drawDefinitions||[]).map(b=>b.links||[])).flat(1/0),[]).filter(({linkType:v})=>v===Uu),h=i;if(f.length){h=_o({nextMatchUps:!0,tournamentRecords:e}).matchUps;let v=f.reduce((w,y)=>{let b=y.source?.structureId,S=y.target?.structureId;return b&&S&&(c[S]=b),b&&!w.includes(b)&&w.push(b),w},[]);for(let w of v)l[w]=[];for(let w of h??[]){let y=w.containerStructureId||w.structureId;v.includes(y)&&l[y].push(w.matchUpId)}}let m=v=>{u[v]||(u[v]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[v]=[])},g=(v,w)=>{u[v].matchUpIds.forEach(y=>{u[w].matchUpIds.push(y)}),u[w].matchUpIds.push(v),u[v].dependentMatchUpIds.push(w),n&&u[v].participantIds.forEach(y=>u[w].participantIds.push(y))},I=v=>{let w=Object.keys(l).length;for(let y of v||[]){let{matchUpId:b,winnerMatchUpId:S,loserMatchUpId:U}=y;if(!o.length||o.includes(b)){if(m(b),n){let{individualParticipantIds:P}=gN(y);u[b].participantIds=P}S&&(m(S),g(b,S),d[S].push(b)),U&&(m(U),g(b,U),d[U].push(b)),u[b].sources.push(d[b]);let T=d[b].map(P=>u[P].sources[0]).flat(),D=d[b].map(P=>u[P].sources[1]).flat();if(u[b].sources.push(T,D),w){let P=y.containerStructureId||y.structureId,E=c[P];if(l[E])for(let R of l[E])m(R),g(R,b),d[R].push(b)}}}};if(s)Qp({drawDefinition:s}),h?.length||(h=xn({drawDefinition:s}).matchUps),I(h);else{if(h?.length||(h=_o({nextMatchUps:!0,tournamentRecords:e}).matchUps),!r.length){let v=p?.length?p.map(({events:w=[]})=>w.map(({drawDefinitions:y=[]})=>y.map(({drawId:b})=>b))).flat(1/0):[];v&&(r=v)}for(let v of r){let w=h?.filter(y=>y.drawId===v).sort(eg);if(!w?.find(({roundPosition:y})=>!y)){let y=w?.find(({tournamentId:S})=>S),{drawDefinition:b}=Kn({tournamentRecord:e[y?.tournamentId],drawId:v});b&&Qp({drawDefinition:b})}I(w)}}return{positionDependencies:l,matchUpDependencies:u,sourceMatchUpIds:d,matchUps:h,...W}}function hr(t){let e=t?.matchUp,i=t?.score||e?.score,r=i?.sets?.[0],{side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o,side1PointScore:l,side2PointScore:u}=r||{},c=n||a||s||o||l||u;return!!(i?.sets?.length>1||c)}function JU({matchUpStatus:t}){return Pae.includes(t)}function pBe({matchUpStatus:t}){return O2.includes(t)}function sF({matchUpStatus:t}){return Eae.includes(t)}function cV({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){let a=r?.find(({participantId:o})=>o),s=i?.filter(cV)?.length;return hr({score:n})||s||e&&a||t&&pBe({matchUpStatus:t})&&![Yt,si,ho].includes(t)}function ty(t){let{drawDefinition:e,findContainer:i,structureId:r,event:n}=t,a=t.structure,{containedStructures:s}=Qv({drawDefinition:e}),o=r?s[r]||[]:[],l={isCollectionMatchUp:!1};if(!a){let U=tt({drawDefinition:e,structureId:r});if(U.error)return U;a=i?U.containingStructure??U.structure:U.structure}if(Yn({structure:a}))return{structure:a,isAdHoc:!0,error:_m};let{matchUps:u}=nr({inContext:!0,matchUpFilters:l,drawDefinition:e,event:n}),c=u?.filter(U=>U.structureId===r||o.includes(U.structureId)),{matchUpDependencies:d}=Io({drawIds:[e.drawId],matchUps:u,drawDefinition:e}),p=[],f=[],h={},m=[];for(let U of u??[]){if(U.structureId===r||o.includes(U.structureId)){f.push(...U.drawPositions??[]);let T=U.roundNumber;for(let D of(U.drawPositions??[]).filter(Boolean))(!h[D]||T&&h[D]>T)&&(h[D]=T)}cV(U)&&(m.push(U),p.push(U.matchUpId,...d?.[U?.matchUpId]?.matchUpIds||[]))}let g=lt(f.filter(Boolean)).sort(or),I=lt(p),v=lt(c?.map(({matchUpId:U,drawPositions:T})=>I.includes(U)?T:[]).flat().filter(Boolean)).sort(or),{positionAssignments:w}=Xt({drawDefinition:e,structure:a}),y=w?.filter(U=>U.bye).map(U=>U.drawPosition),b=w?.filter(U=>U.qualifier).map(U=>U.drawPosition),S=g?.filter(U=>!v.includes(U))||[];return{allDrawPositions:g,inContextStructureMatchUps:c,drawPositionInitialRounds:h,activeDependentMatchUpIds:I,qualifyingDrawPositions:b,inactiveDrawPositions:S,positionAssignments:w,activeDrawPositions:v,byeDrawPositions:y,activeMatchUps:m,structure:a}}function Zh({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&i?.includes(t)).map(({roundNumber:i})=>i).sort(or)[0]}}var td={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},dV=[];function Wt(t,e){ai(t)&&(t={method:t}),(e||ha())&&dV.push(t)}function fBe(t){return dV.slice()}function hBe(t){let e=fBe().map(i=>{let{color:r,keyColors:n,method:a,newline:s}=i,o=Object.keys(td).includes(r)?td[r]:td.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=n&&Object.keys(n).includes(c)&&td[n[c]]?td[n[c]]:td.brightwhite;return`${td.white}${c}: ${d}${i[c]}`}).join(", "),u=a?.length<15?"		":"	";return[s?`
`:"",o,a,u,td.white,l,td.reset,`
`].join("")});e?.length&&console.log(...e)}function mBe(){dV.length=0}function pV(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,containsParticipant:r,filled:e||i||r}}function Br(t){return[Yt,si,Ur].includes(t)}function ns({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,loserMatchUp:a,matchUpsMap:s,structureId:o,structure:l,event:u}){if(!r)return{error:$e};if(l||({structure:l}=tt({drawDefinition:r,structureId:o})),!l)return{error:yi};o||({structureId:o}=l);let c="assignDrawPositionBye";Wt({method:c,color:"cyan",drawPosition:n}),s??=xr({drawDefinition:r});let{positionAssignments:d}=Xt({structure:l}),{activeDrawPositions:p}=ty({drawDefinition:r,structureId:o});if(d?.find(E=>E.drawPosition===n)?.bye)return{...W};let f=!!(a&&s.drawMatchUps.some(E=>E.loserMatchUpId===a?.matchUpId&&Br(E.matchUpStatus)));if(p?.includes(n)&&!f)return{error:mU};let h=d?.find(E=>E.drawPosition===n);if(!h)return{error:_m};let{filled:m,containsBye:g,containsParticipant:I}=pV(h);if(g)return{...W};if(m&&!g&&!f)return q({result:{error:RI},stack:c});let v=Ct({tournamentRecord:i,drawDefinition:r,event:u}).appliedPolicies??{},w=nr({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[],y={isCollectionMatchUp:!1},{matchUps:b}=Ot({provisionalPositioning:t,drawDefinition:r,matchUpFilters:y,matchUpsMap:s,structure:l});if(d?.forEach(E=>{E.drawPosition===n&&(E.bye=!0,f&&(E.participantId=void 0))}),l.structureType===In)return gBe({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:b}),Ac({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:u}),Jq({assignedParticipantId:I,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:c});let{roundProfile:S,roundMatchUps:U}=Un({matchUps:b}),T=(S&&Object.keys(S).map(E=>Number.parseInt(E)).reverse())?.find(E=>S?.[E].drawPositions?.includes(n)),D=T?U?.[T].find(({drawPositions:E})=>E?.includes(n)):void 0;D&&yse({tournamentRecord:i,drawDefinition:r,matchUp:D,event:u});let P=D?.drawPositions?.find(E=>E!==n);if(D&&P){let E=fV({sourceDrawPositions:D.drawPositions,matchUpId:D.matchUpId,inContextDrawMatchUps:w,drawPositionToAdvance:P,tournamentRecord:i,drawDefinition:r,matchUpsMap:s});if(E.error)return E}return Ac({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:u}),Jq({assignedParticipantId:I,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:c})}function Jq({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&FU({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),q({result:{...W},stack:s})}function yse({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:"BYE",score:void 0,winningSide:void 0}),Dt({tournamentId:t?.tournamentId,eventId:i??n?.eventId,context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function gBe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{a.drawPositions?.includes(i)&&yse({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function fV({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:s,event:o}){Wt({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(w=>w.matchUpId===s),u=e.find(w=>w.matchUpId===s)?.structureId,{structure:c}=tt({drawDefinition:n,structureId:u}),{positionAssignments:d}=Xt({structure:c}),p=d?.filter(w=>w.bye).map(w=>w.drawPosition),f=l?.drawPositions?.find(w=>w!==t),h=f&&p?.includes(f),{targetLinks:{loserTargetLink:m},targetMatchUps:{loserMatchUp:g,winnerMatchUp:I,loserTargetDrawPosition:v}}=Bn({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:s});if(I&&I.structureId===c?.structureId&&IBe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:I,matchUpsMap:a,event:o}),g&&h&&g.structureId!==c?.structureId){let{roundNumber:w}=g;if(w===1){let y=ns({structureId:m.target.structureId,drawPosition:v,tournamentRecord:r,drawDefinition:n,event:o});if(y.error)return y}else bse({loserTargetDrawPosition:v,tournamentRecord:r,loserTargetLink:m,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:o})}return{...W}}function IBe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:s,event:o}){let l="advanceWinner",u=s.drawMatchUps.find(M=>M.matchUpId===a.matchUpId),c=e.find(M=>M.matchUpId===a.matchUpId)?.structureId,{structure:d}=tt({drawDefinition:n,structureId:c}),{positionAssignments:p}=Xt({structure:d}),f=p?.find(({drawPosition:M})=>M===t)?.bye,h=u.drawPositions?.filter(Boolean),m=p?.filter(M=>h?.includes(M.drawPosition)),g=p?.find(({drawPosition:M})=>M===t),I=i?.find(M=>M!==t),v=(I&&m?.find(({drawPosition:M})=>M===I))?.bye,w=f&&v;if(w&&console.log({isByeAdvancedBye:w}),h?.length>1&&f&&!v)return q({result:{error:RI},stack:l});let y=h?.find(M=>M!==t),b=w,S=[...(u.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),U=S.map(M=>!M&&!b||M===t?(b=!0,t):M).sort(or);if(!b)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:m}),q({result:{error:RI},stack:l});let T=p?.find(({drawPosition:M})=>M===y)?.bye,D=p?.find(({drawPosition:M})=>M===t)?.bye;Object.assign(u,{matchUpStatus:D||T?"BYE":$i,score:void 0,winningSide:void 0,drawPositions:U});let P=u.drawPositions.find(M=>!S.includes(M));Wt({method:l,color:"brightyellow",changedDrawPosition:P,pairedDrawPositionIsBye:T,drawPositionIsBye:D}),Dt({tournamentId:r?.tournamentId,matchUp:u,eventId:o?.eventId,context:l,drawDefinition:n});let{targetLinks:{loserTargetLink:E},targetMatchUps:{loserMatchUp:R,loserTargetDrawPosition:C}}=Bn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(T||D){let M=T?t:y;if(M)fV({drawPositionToAdvance:M,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:s});else if(D&&E&&R)if(R.feedRound)bse({loserTargetDrawPosition:C,tournamentRecord:r,loserTargetLink:E,drawDefinition:n,loserMatchUp:R,matchUpsMap:s});else{let N=1-a.roundPosition%2,A=R.drawPositions[N],O=ns({structureId:E.target.structureId,drawPosition:A,tournamentRecord:r,drawDefinition:n,event:o});if(O.error)return O}}}function bse({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{roundNumber:o}=n;Wt({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=(a?.mappedMatchUps||{})[n.structureId].matchUps,{initialRoundNumber:u}=Zh({drawPosition:t,matchUps:l});if(u===o){let c=ns({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:s});if(c.error)return c}}function wse({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:s}=Ot({drawDefinition:i,matchUpsMap:r,structure:n,event:a});s.forEach(o=>{let l=t.filter(({drawPosition:u})=>o.drawPositions?.includes(u)).filter(u=>u.bye).length;o.winningSide||(Object.assign(o,{matchUpStatus:l?"BYE":$i}),Dt({tournamentId:e?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:i,matchUp:o}))})}function QU(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:s,matchUpsMap:o,event:l}=t,{structure:u}=tt({drawDefinition:a,structureId:s}),c=(fr({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(c&&i&&!r&&(r=c?.drawPosition),!r)return{error:Bv};i||(i=c?.participantId);let{activeDrawPositions:d}=ty({drawDefinition:a,structureId:s});return d.includes(r)?{error:mU}:(e||({matchUps:e}=nr({inContext:!0,drawDefinition:a,matchUpsMap:o})),oF({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:s,drawPosition:r,matchUpsMap:o,event:l}).drawPositionCleared?(Ac({tournamentId:n?.tournamentId,drawDefinition:a,structure:u,event:l}),{...W,participantId:i}):{error:Rie})}function oF({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:s}){let{structure:o}=tt({drawDefinition:i,structureId:a});if(!o)return{error:yi};let l=fr({drawDefinition:i,structure:o}).positionAssignments||[],u=l.some(I=>{if(I.drawPosition===r)return delete I.participantId,delete I.qualifier,delete I.bye,!0});if(o.structureType===In)return wse({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:o}),{drawPositionCleared:u,...W};let c={isCollectionMatchUp:!1},{matchUps:d}=Ot({drawDefinition:i,matchUpFilters:c,matchUpsMap:n,structure:o,event:s}),{roundProfile:p,roundMatchUps:f}=Un({matchUps:d}),h=(p&&Object.keys(p))?.map(I=>Ke(I)),m=r,g=h?.map(I=>{let v=p?.[I]?.pairedDrawPositions?.find(P=>P.includes(m)),w=v?.find(P=>P!==m),y=l.find(P=>P.drawPosition===w),b=p?.[I+1],S=y?.bye,U=b?.pairedDrawPositions?.find(P=>P.includes(w)),T=S&&U&&b&&b.drawPositions?.includes(w),D=v&&{pairedDrawPositionByeAdvancedPair:!T&&U,pairedDrawPosition:w,targetDrawPosition:m,relevantPair:v,roundNumber:I};return T&&(m=w),D}).filter(I=>I?.targetDrawPosition)?.reduce((I,v)=>{let{roundNumber:w,relevantPair:y,targetDrawPosition:b,pairedDrawPosition:S,pairedDrawPositionByeAdvancedPair:U}=v,T={roundNumber:w,targetDrawPosition:b,relevantPair:y},D=U&&{roundNumber:w+1,targetDrawPosition:S,relevantPair:U,subsequentRoundRemoval:!0},P=[T,D].filter(Boolean);return I.concat(...P)},[]);return g?.forEach(({roundNumber:I,targetDrawPosition:v,relevantPair:w})=>{let y=f?.[I].find(b=>$n(b.drawPositions?.filter(Boolean),w.filter(Boolean)));y&&(vBe({inContextDrawMatchUps:t,targetDrawPosition:v,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:I,matchUpsMap:n}),Sse({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:y,drawPosition:r,matchUpsMap:n,structure:o,event:s}))}),{tasks:g,drawPositionCleared:u,positionAssignments:l}}function vBe({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:s}){let{structure:o}=tt({drawDefinition:r,structureId:s});if(!o)return{error:yi};if(o.structureType===In)return;n=n||xr({drawDefinition:r});let l=(n?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:u}=Zh({drawPosition:e,matchUps:l}),c=l?.filter(p=>p.roundNumber>=a&&p.roundNumber!==u&&p.drawPositions?.includes(e)),d=Xt({drawDefinition:r,structureId:s}).positionAssignments??[];return c?.forEach(p=>Sse({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:o})),{...W}}function Sse({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u="removeDrawPosition",c=n.drawPositions?.slice(),d=n.matchUpStatus,p=n.winningSide;s=s??xr({drawDefinition:r});let f=s.mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:h}=Zh({drawPosition:a,matchUps:f});if(n.roundNumber&&h&&n.roundNumber>h){let U=(n.drawPositions??[]).map(T=>T===a?void 0:T);n.drawPositions=U}if(n.matchUpType===ti){let U=(t?.find(T=>T.matchUpId===n.matchUpId)?.sides??[]).reduce((T,D,P)=>D.drawPosition===a?P:T,void 0);U!==void 0&&n.sides?.[U]?.lineUp&&(delete n.sides?.[U].lineUp,Dt({tournamentId:i?.tournamentId,context:`${u}-TEAM`,eventId:l?.eventId,matchUp:n,drawDefinition:r}))}let m=Bn({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:I,winnerMatchUp:v,loserMatchUpDrawPositionIndex:w}}=m,y=e.filter(({drawPosition:U})=>n.drawPositions?.includes(U)).filter(U=>U.bye).length,b=y&&"BYE"||n.matchUpStatus&&Br(n.matchUpStatus)&&n.matcHUpStatus||$i;n.matchUpStatus=b,n.matchUpStatus&&Br(n.matchUpStatus)&&(n.winningSide=void 0);let S=c?.find(U=>!n.drawPositions?.includes(U));if(c?.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(S&&Wt({method:u,color:"brightyellow",removedDrawPosition:S}),Dt({tournamentId:i?.tournamentId,context:`${u}-${a}`,eventId:l?.eventId,matchUp:n,drawDefinition:r})),I&&I.structureId!==m.matchUp.structureId&&!y){let{drawPositions:U,roundNumber:T}=I;if(T===1){let D=U[w];oF({structureId:I.structureId,drawPosition:D,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s})}else{let D=Math.min(...U.filter(Boolean)),P=yBe({loserMatchUpDrawPosition:D,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:I,matchUpsMap:s,event:l});if(P.error)return q({result:P,stack:u});let E=(s?.mappedMatchUps||{})[I.structureId].matchUps,{initialRoundNumber:R}=Zh({drawPosition:D,matchUps:E});R===1&&(Wt({method:u,color:"brightyellow",loserMatchUpDrawPosition:D}),oF({structureId:I.structureId,drawPosition:D,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s}))}}return v&&v.structureId!==m.matchUp.structureId&&g.target.feedProfile,{...W}}function yBe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{structure:o}=tt({structureId:n.structureId,drawDefinition:r}),{positionAssignments:l}=Xt({structure:o});if(l?.find(u=>u.drawPosition===t)?.bye){let u=QU({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:s});if(u.error)return u}return{...W}}function Af({drawDefinition:t,stages:e}){if(!t)return{error:$e};let i=(t?.structures??[]).filter(n=>!e?.length||n.stage&&e.includes(n.stage)),r=lt(i.map(n=>{let{positionAssignments:a}=Xt({structure:n});return a?a.map(wt):[]}).flat().filter(Boolean));return{...W,assignedParticipantIds:r}}function Ro(t){let e=(t?.entries??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:s}=n,o=`_${a||ke}${s||""}`;return r[o]||(r[o]=[]),r[o].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let s=a+1;return{...n,entryPosition:s}})).flat()}function vp(t){return[Rf,Es].includes(t)}function bE({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:s,extension:o,eventSync:l,drawId:u,stage:c,event:d}){if(!n||!Array.isArray(n))return{error:Fo,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:ci};if(a&&!qae.includes(a))return{error:jx};if(s&&!XM.includes(s))return{error:Sf};let p="modifyEntriesStatus",f=[];if(!a&&!o)return q({result:{error:Je},info:"Missing entryStatus",stack:p});if(o&&!Sl({extension:o,requiredAttributes:["name"]}))return q({result:{error:re},info:"Invalid extension",context:{extension:o},stack:p});let h=[];d?.drawDefinitions?.forEach(D=>{let P=Af({stages:c&&[c],drawDefinition:D}).assignedParticipantIds??[];h.push(...P)});let m=i?.participants??[];if(!n.every(D=>{let P=Cd({tournamentParticipants:m,participantId:D})?.participantType;return!(P&&[mt,Gn].includes(P)&&vp(a))&&!(a&&d?.eventType&&P===yt&&[Is,Ca].includes(d.eventType)&&[qs,...xD].includes(a))}))return{error:jx};let g=d&&Vi({event:d}).flightProfile,I=g?.flights?.find(D=>D.drawId===u),v=D=>{let P=(D||[]).filter(R=>!c||!R.entryStage||c===R.entryStage).filter(({participantId:R})=>n.includes(R)),E=R=>a&&h.includes(R.participantId)&&!(xD.includes(R.entryStatus)&&xD.includes(a));return P.every(R=>E(R)&&!e?!1:(a&&(R.entryStatus=a,delete R.entryPosition),s&&(R.entryStage=s,delete R.entryPosition),o&&(o.value?It({element:R,extension:o}):On({element:R,name:o.name})),!0))?{...W}:{error:Gv}},w=({flight:D,drawDefinition:P})=>{d&&(d.entries=Ro({entries:d.entries??[]})),D&&(D.drawEntries=Ro({entries:D.drawEntries})),P&&(P.entries=Ro({entries:P.entries}))},y=D=>{let{flight:P,drawDefinition:E}=D,R="updateDrawEntries";if(P){let C=v(P.drawEntries);if(C.error)return q({result:C,stack:R})}if(E){let C=v(E.entries);if(C.error)return q({result:C,stack:R});f.includes(E.drawId)||f.push(E.drawId)}return{...W}},b=d?.entries?.find(({entryPosition:D})=>D)??(I?.drawEntries?.find(({entryPosition:D})=>D)||r?.entries?.find(({entryPosition:D})=>D));if(t&&!b&&w({flight:I,drawDefinition:r}),I||r){let D=y({flight:I,drawDefinition:r});if(D.error)return q({result:D,stack:p})}let S=d?.drawDefinitions?.map(({drawId:D})=>D)??[],U=g?.flights?.filter(D=>!S.includes(D.drawId))||[];for(let D of U){let P=D&&y({flight:D});if(P?.error)return q({result:P,stack:p})}let T=g?.flights?.length===1&&(d?.drawDefinitions?.length??0)<=g?.flights?.length;if(!I&&!r&&a&&zae.includes(a))return{error:Ire};if(!I&&!r||a===Mu||l&&T){let D=v(d?.entries);if(D?.error)return q({result:D,stack:p});let P;if(a===Mu&&(g?.flights?.every(E=>{let R=v(E.drawEntries);return R.error?(P=R.error,!1):(E.drawEntries=E.drawEntries.filter(({participantId:C})=>!n.includes(C)),!0)}),d?.drawDefinitions?.every(E=>{let R=v(E.entries);return R.error?(P=R.error,!1):(E.entries=E.entries?.filter(({participantId:C})=>!n.includes(C)),!0)})),P)return q({result:{error:P},stack:p})}t&&w({flight:I,drawDefinition:r});for(let D of d?.drawDefinitions??[])f.length&&!f.includes(D.drawId)||ri({tournamentId:i.tournamentId,eventId:d?.eventId,drawDefinition:D});return{...W}}function Vg({value:t,sourceRange:e,targetRange:i}){if(!Array.isArray(e)||e.length!==2)return 0;let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),s=Math.max(...i);return(t-r)*(s-a)/(n-r)+a}var Use="NTRP",Tse="DUPR",Dse="UTR_P",Pse="UTPR",Ese="SQUASH_LEVELS",Rse="US_SQUASH",Cse="USATT",Mse="ITTF",Nse="USAR",bBe={ELO:"ELO",NTRP:Use,TRN:"TRN",UTR:"UTR",WTN:"WTN",DUPR:Tse,UTR_P:Dse,UTPR:Pse,PSA:"PSA",SQUASH_LEVELS:Ese,US_SQUASH:Rse,USATT:Cse,ITTF:Mse,USAR:Nse,BWF:"BWF"},wBe={ELO:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!1},[Use]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!1,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!1,range:[1,16]},WTN:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!0,decimalsCount:2,range:[40,1]},[Tse]:{defaultInitialization:3.5,accessors:["duprRating","reliabilityScore"],accessor:"duprRating",attributes:{reliabilityScore:{generator:!0,range:[0,100]}},decimalsCount:3,ascending:!1,range:[2,8]},[Dse]:{defaultInitialization:5,accessors:["utrpRating","verified"],accessor:"utrpRating",attributes:{verified:{type:"boolean"},provisional:{type:"string"}},decimalsCount:1,ascending:!1,range:[1,10]},[Pse]:{defaultInitialization:3.5,accessor:"utprRating",decimalsCount:1,ascending:!1,range:[2,5],deprecated:!0},PSA:{defaultInitialization:500,accessor:"psaPoints",decimalsCount:0,ascending:!1,range:[0,3e3],attributes:{tournaments:{generator:!0,range:[1,20]},divisor:{generator:!0,range:[10,20]}}},[Ese]:{defaultInitialization:2e3,accessor:"squashLevel",decimalsCount:0,ascending:!1,range:[0,7e3]},[Rse]:{defaultInitialization:3.5,accessor:"usSquashRating",decimalsCount:1,ascending:!1,range:[2,6]},[Cse]:{defaultInitialization:1e3,accessor:"usattRating",decimalsCount:0,ascending:!1,range:[200,3e3]},[Mse]:{defaultInitialization:500,accessor:"ittfPoints",decimalsCount:0,ascending:!1,range:[0,2e4]},[Nse]:{defaultInitialization:1e4,accessor:"usarRanking",decimalsCount:0,ascending:!0,range:[1,25e3]},BWF:{defaultInitialization:5e3,accessor:"bwfPoints",decimalsCount:0,ascending:!0,range:[0,15e4],attributes:{tournaments:{generator:!0,range:[1,10]}}}},Er=wBe;function SBe({sourceRatingType:t,sourceRating:e}){let i=Er[t]?.range,r=i?.[0]>i?.[1],n=Er.ELO.range;return Vg({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function UBe({targetRatingType:t,sourceRating:e}){let i=Er[t]?.decimalsCount||0,r=Er[t]?.range,n=r?.[0]>r?.[1],a=Math.max(...r),s=Er.ELO?.range,o=Vg({targetRange:r,sourceRange:s,value:e}),l=Number.parseFloat(o?.toFixed(i))||0;return n?a-l:l}function Qq(t){let e=He(t,[{ratings:!0,[Jn]:Zn}]);if(e.error)return e;let i=t.matchUpType&&[qt,Vt].includes(t.matchUpType)?t.matchUpType:qt,r=Object.keys(Er),n=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:"ELO",a=t.ratings[i]?t.ratings[i].reduce((p,f)=>p.includes(f.scaleName)?p:p.concat(f.scaleName),[]):[];if(!a)return{error:Gr};let s=t.ratings[i]?.find(p=>p.scaleName===n)??t.ratings[i]?.[0];if(a[0]===n)return s;let o=s?.scaleName,l=Er[s?.scaleName]?.accessor,u=l&&s.scaleValue[l]||s?.scaleValue,c=SBe({sourceRatingType:o,sourceRating:u}),d=UBe({targetRatingType:n,sourceRating:c});return d?{convertedRating:d,sourceRating:u}:{error:re}}function TBe({participantResults:t,sides:e,score:i}){let r=e?.find(({sideNumber:o})=>o===1),n=e?.find(({sideNumber:o})=>o===2),a=r?.participant?.ratings,s=n?.participant?.ratings;if(a?.[qt]&&s?.[qt]){let o="ELO",{convertedRating:l}=Qq({ratings:a,targetRatingType:o}),{convertedRating:u}=Qq({ratings:s,targetRatingType:o}),{side1pressure:c,side2pressure:d}=DBe({side1ConvertedRating:l,side2ConvertedRating:u,score:i});c&&t[r?.participantId].pressureScores.push(c),d&&t[n?.participantId].pressureScores.push(d);let p=Math.max(...Er.ELO.range),f=tE((u-l)/p),h=tE((l-u)/p);t[r?.participantId].ratingVariation.push(f),t[n?.participantId].ratingVariation.push(h)}}function DBe({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){let r=Math.max(t,e),n=Math.min(t,e),a=Math.abs(t-e),s=Er.ELO.range,o=Math.max(...s),l=(o-r)*0,u=(r+l)/o*a,c=i?.sets?.reduce((v,w)=>v+(w?.side1Score??0),0),d=i?.sets?.reduce((v,w)=>v+(w.side2Score??0),0),p=t>e?2:1,f=(c||0)*(n+(p===1?u:0)),h=(d||0)*(n+(p===2?u:0)),m=f+h,g=m?tE(f/m):0,I=m?tE(h/m):0;return{side1pressure:g,side2pressure:I}}function hV({winningSide:t,matchUpFormat:e=Ws,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],s=n?.sets,o=typeof t=="number"&&t-1,l=Xi(e),u=mV(l?.bestOf??1);if(typeof o=="number"&&(i===Yt&&r?.setsCreditForDefaults||i===si&&r?.setsCreditForWalkovers))a[o]=u;else for(let c of s||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof o=="number"&&i===Ur&&(+a[1-o]===u&&(a[1-o]-=1),r?.setsCreditForRetirements&&(a[o]=u)),a}function Ase({matchUpFormat:t=Ws,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){let{sets:a}=n||{};if(!a)return[0,0];let s=typeof e=="number"&&e-1,o=Xi(t),l=o?.bestOf??1,u=mV(l),c=o?.setFormat?.tiebreakAt||0,d=[[],[]];if(typeof s=="number"&&(i===Yt&&r?.gamesCreditForDefaults||i===si&&r?.gamesCreditForWalkovers)){let p=o?.setFormat?.setTo||0,f=u*p;d[s].push(f)}else a.forEach((p,f)=>{let h=(p.setNumber||f+1)>u&&o?.finalSetFormat?"finalSetFormat":"setFormat",m=o?.[h]?.based,g=o?.[h].tiebreakSet,{side1Score:I,side2Score:v}=p;Zq(m)&&!g&&(d[0].push(Ke(I||0)),d[1].push(Ke(v||0))),g&&p.winningSide&&r?.gamesCreditForTiebreakSets!==!1&&d[p.winningSide-1].push(1)});if(i===Ur&&typeof s=="number"){let p=a.length>u&&o?.finalSetFormat?"finalSetFormat":"setFormat",f=o?.[p];if(Zq(f.based)){let h=f?.setTo||0,m=I=>{if(!(!o||I===""))return+I===c-1||+I===c?Ke(c||0)+1:+I<c?h:c},g=hV({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(d.map(I=>I[s]<=I[1-s]).reduce((I,v)=>I+(v?1:0),0)>g[1-s]){let I=d[s].length,v=m(d[1-s][I-1]);v&&(d[s][I-1]=v)}u>d[s].length&&r?.gamesCreditForRetirements&&d[s].push(h)}}return[d[0].reduce((p,f)=>p+f,0),d[1].reduce((p,f)=>p+f,0)]}function kse({matchUpFormat:t,score:e}){let i=t?Xi(t):void 0,r=i?.bestOf??1,n=mV(r),a=[0,0],s=[0,0];return e?.sets?.forEach((o,l)=>{let u=(o.setNumber||l+1)>n&&i?.finalSetFormat?"finalSetFormat":"setFormat",c=i?.[u]?.based;if(Ose(c)){let{side1Score:d,side2Score:p}=o;d&&(s[0]+=Ke(d||0)),p&&(s[1]+=Ke(p||0))}else o.side1TiebreakScore&&(s[0]+=Ke(o.side1TiebreakScore||0)),o.side2TiebreakScore&&(s[1]+=Ke(o.side2TiebreakScore||0)),(o.side1TiebreakScore||o.side2TiebreakScore)&&o.winningSide&&(a[o.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:a}}function mV(t){return t&&Math.ceil(t/2)||1}function Ose(t){return t==="P"}function Zq(t){return!Ose(t)}function PBe({participantResults:t,groupingTotal:e,matchUpFormat:i,tallyPolicy:r,totalGames:n,perPlayer:a,totalSets:s}){let o=i&&Xi(i)||{},l=o.bestOf,u=l&&Math.ceil(l/2)||1,c=o.setFormat?.setTo,d=Math.pow(10,r?.precision||3);Object.keys(t).forEach(p=>{let f=t[p].setsWon,h=t[p].setsLost,m=r?.groupTotalSetsPlayed||e==="setsPct"?s:a*u||f+h,g=Math.round(f/m*d)/d;(g===1/0||Number.isNaN(g))&&(g=m);let I=t[p].tieMatchUpsWon,v=t[p].tieMatchUpsLost,w=I+v,y=Math.round(I/w*d)/d;(y===1/0||Number.isNaN(y))&&(y=I);let b=t[p].matchUpsWon,S=t[p].matchUpsLost,U=b+S,T=Math.round(b/U*d)/d;(T===1/0||Number.isNaN(T))&&(T=b);let D=t[p].gamesWon||0,P=t[p].gamesLost||0,E=(a||0)*u*(c||0),R=r?.groupTotalGamesPlayed||e==="gamesPct"?n:Math.max(E,D+P),C=Math.round(D/R*d)/d;(C===1/0||Number.isNaN(C))&&(C=0);let M=t[p].pointsWon+t[p].pointsLost,N=Math.round(t[p].pointsWon/M*d)/d;(N===1/0||Number.isNaN(N))&&(N=0),t[p].setsWon=f,t[p].setsLost=h,t[p].setsPct=g,t[p].tieMatchUpsWon=I,t[p].tieMatchUpsPct=y,t[p].matchUpsPct=T,t[p].gamesWon=D,t[p].gamesLost=P,t[p].gamesPct=C,t[p].pointsPct=N,t[p].result=`${t[p].matchUpsWon}/${t[p].matchUpsLost}`})}function ZU({participantIds:t,pressureRating:e,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,perPlayer:a,matchUps:s}){let o={},l=n?.excludeMatchUpStatuses||[],u=s?.filter(f=>(f.tieMatchUps||!l.includes(f.matchUpStatus))&&(!t?.length||_i(t,[jg(f,0),jg(f,1)]).length===2)),c=u?.flatMap(({score:f,tieMatchUps:h})=>h?h.filter(({matchUpStatus:m})=>!l.includes(m)).flatMap(({score:m})=>m?.sets?.length??0):f?.sets?.length??0)?.reduce((f,h)=>f+h,0),d=f=>f?.sets?.reduce((h,m)=>h+(m?.side1Score??0)+(m?.side2Score??0),0)??0,p=u?.flatMap(({score:f,tieMatchUps:h})=>h?h.filter(({matchUpStatus:m})=>!l.includes(m)).flatMap(({score:m})=>d(m)):d(f))?.reduce((f,h)=>f+h,0);for(let f of u??[]){let{matchUpStatus:h,tieMatchUps:m,tieFormat:g,score:I,winningSide:v,sides:w}=f,y=g&&f._disableAutoCalc&&g.collectionDefinitions.every(({scoreValue:U})=>U),b=v&&EBe(f),S=v&&RBe(f);if(!b&&!S)if(h&&Qi.includes(h)){let U=jg(f,0),T=jg(f,1);U&&(nd(o,U),o[U].matchUpsCancelled+=1),T&&(nd(o,T),o[T].matchUpsCancelled+=1)}else if(m?.length){a=0;for(let U of m){if(U.winningSide){let T=w?.find(({sideNumber:P})=>P===U.winningSide)?.participantId,D=w?.find(({sideNumber:P})=>P===U.winningSide)?.participantId;T&&D&&(nd(o,T),nd(o,D),o[T].tieMatchUpsWon+=1,o[D].tieMatchUpsLost+=1,Di(qt)(U.matchUpType)?(o[T].tieSinglesWon+=1,o[D].tieSinglesLost+=1):Di(Vt)(U.matchUpType)&&(o[T].tieDoublesWon+=1,o[D].tieDoublesLost+=1))}e3({score:U.score,manualGamesOverride:y,participantResults:o,sides:w})}}else e3({manualGamesOverride:y,participantResults:o,score:I,sides:w});else if(nd(o,b),nd(o,S),m?.length){a=0;for(let U of m){let{matchUpType:T}=U,D=Di(Vt)(T),P=Di(qt)(T);U.winningSide&&(U.winningSide===v?(b&&(o[b].tieMatchUpsWon+=1,P&&(o[b].tieSinglesWon+=1),D&&(o[b].tieDoublesWon+=1)),S&&(o[S].tieMatchUpsLost+=1,P&&(o[S].tieSinglesLost+=1),D&&(o[S].tieDoublesLost+=1))):U.winningSide!==v&&(S&&(o[S].tieMatchUpsWon+=1,P&&(o[S].tieSinglesWon+=1),D&&(o[S].tieDoublesWon+=1)),b&&(o[b].tieMatchUpsLost+=1,P&&(o[b].tieSinglesLost+=1),D&&(o[b].tieDoublesLost+=1)))),t3({matchUpFormat:U.matchUpFormat,matchUpStatus:U.matchUpStatus,matchUpType:U.matchUpType,score:U.score,sides:U.sides,winningParticipantId:b,losingParticipantId:S,manualGamesOverride:y,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:v})}xse({winningParticipantId:b,losingParticipantId:S,participantResults:o,matchUpStatus:h})}else t3({matchUpFormat:f.matchUpFormat??r,matchUpType:f.matchUpType,isTieMatchUp:void 0,winningParticipantId:b,manualGamesOverride:y,losingParticipantId:S,participantResults:o,pressureRating:e,matchUpStatus:h,tallyPolicy:n,winningSide:v,score:I,sides:w});if(y){let U=I?.sets?.reduce((E,R)=>E+(R?.side1Score??0),0),T=I?.sets?.reduce((E,R)=>E+(R.side2Score??0),0),D=w?.find(({sideNumber:E})=>E===1)?.participantId,P=w?.find(({sideNumber:E})=>E===2)?.participantId;nd(o,D),nd(o,P),D&&(o[D].gamesWon+=U,o[D].gamesLost+=T),P&&(o[P].gamesWon+=T,o[P].gamesLost+=U)}}return PBe({participantResults:o,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,totalGames:p,perPlayer:a,totalSets:c}),{participantResults:o}}function EBe(t){let e=t.winningSide-1;return jg(t,e)}function RBe(t){let e=1-(t.winningSide-1);return jg(t,e)}function jg(t,e){if(!t?.sides)return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function nd(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function e3({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],s=[0,0];for(let l of n||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(s[u-1]+=1),a[0].push(Ke(c||0)),a[1].push(Ke(d||0))}let o=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];r.forEach((l,u)=>{let{participantId:c}=l;c&&(nd(e,c),e[c].setsWon+=s[u],e[c].setsLost+=s[1-u],t||(e[c].gamesWon+=o[u],e[c].gamesLost+=o[1-u]))})}function t3({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:s,isTieMatchUp:o,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let f=c&&c-1,h=1-f;n&&l===qt&&TBe({participantResults:r,sides:p,score:d}),o||xse({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:s});let m=hV({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=Ase({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:I}=kse({score:d,matchUpFormat:a});t&&(r[t].setsWon+=m[f],r[t].setsLost+=m[h],e||(r[t].gamesWon+=g[f],r[t].gamesLost+=g[h]),r[t].pointsWon+=I[f],r[t].pointsLost+=I[h]),i&&(r[i].setsWon+=m[h],r[i].setsLost+=m[f],e||(r[i].gamesWon+=g[h],r[i].gamesLost+=g[f]),r[i].pointsWon+=I[h],r[i].pointsLost+=I[f])}function xse({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===si&&(i[e].walkovers+=1),r===Yt&&(i[e].defaults+=1),r===Ur&&(i[e].retirements+=1),Br(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function CBe(t,e,i,r){t.groups&&Object.keys(t.groups).sort(r).forEach(n=>{let a=t.groups[n].map(o=>e[o]).join(", "),s=`${n} ${t.attribute}: ${a}`;i.push(s)})}function MBe(t,e,i,r){if(t.excludedDirectives?.length){let n=t.excludedDirectives.map(({attribute:o})=>o).join(", "),a=`${n.length} directives were excluded due to participants limit}`;r.push(a);let s=`Excluded: ${n}`;r.push(s)}else{let n=(u,c)=>Number.parseFloat(t.reversed?u:c)-Number.parseFloat(t.reversed?c:u),a=t.groups?Object.values(t.groups).flat(1/0).length:t.participantIds?.length??0,s=t.reversed?" in reverse order":"",o=t.groups?"grouped":"separated",l=`Step ${e+1}: ${a} particiants were ${o}${s} by ${t.attribute}`;if(r.push(l),t.idsFilter){let u=`${t.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(u)}CBe(t,i,r,n)}r.push("----------------------")}function NBe({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(s=>{s.participantId&&s.participant&&(r[s.participantId]=s.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,s)=>{MBe(a,s,r,n)}),n.push("Final Order:"),e.forEach(a=>{let{participantId:s,resolved:o}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[s]} => resolved: ${!!o}`)}),n.join(`\r
`)}function Fse({participantResults:t,participantIds:e,attribute:i}){return Lse({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:s}=n,o=s?.[i];return!isNaN(o)&&a&&(r[o]?r[o].push(a):r[o]=[a]),r},{})}function Lse(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var ABe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],$k={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function i3(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!kBe(t))return{};let s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n?.groupOrderKey)?n.groupOrderKey:"matchUpsWon",o=Fse({participantResults:i,attribute:s});a.push({attribute:s,groups:o});let l=Object.keys(o).map(g=>Number.parseFloat(g)).sort((g,I)=>I-g).map(g=>o[g]).map(g=>{let I=_se({participantIds:g,...t});return a.push(...I.report??[]),I.order}).flatMap((g,I)=>g.map(v=>v.resolved?v:{...v,subGroup:[I].concat(...v.subGroup??[])})),u,c=0,d=1,p;l.forEach((g,I)=>{I&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let v=Number.parseInt(g.subGroup?.join("")||0);g.resolved?(g.position=I+1,d=g.position):(u&&v>u&&(d+=c,c=0),g.position=d,c+=1),u=v});let f=l.map(({position:g})=>g),h=Ra(f);return l.forEach(g=>{let{participantId:I,position:v}=g||{},w=i[I];g.GEMscore=m(w);let y=h[v];g?.position!==void 0&&(y>1&&(g.ties=y,r&&(g.subOrder=r[I])),g.rankOrder=v,g.groupOrder=v+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function m(g){return(Array.isArray(n?.GEMscore)?Object.keys($k).filter(I=>n.GEMscore.includes(I)):Object.keys($k)).map(I=>(g[I]||0)*Math.pow(10,$k[I].toFixed(3))).reduce((I,v)=>I+v,0)}}function kBe({participantResults:t,participantsCount:e}){let i=Lse({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function OBe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,groupTotals:r,tallyPolicy:n,attribute:a,idsFilter:s,matchUps:o,reversed:l}){let{participantResults:u}=ZU({participantIds:s&&e,groupingTotal:r&&a,matchUpFormat:i,tallyPolicy:n,matchUps:o}),c=Fse({participantResults:u,participantIds:e,attribute:a}),d=[{attribute:a,reversed:l,groups:c,idsFilter:s,groupTotals:r}],p;return Object.keys(c).length>1&&e.length&&(p=Object.keys(c).map(f=>Number.parseFloat(f)).sort((f,h)=>l?f-h:h-f).map(f=>c[f]).map(f=>{let h=_se({participantResults:u,disableHeadToHead:t,participantIds:f,matchUpFormat:i,tallyPolicy:n,matchUps:o});return d.push(...h.report??[]),h.order}).flatMap((f,h)=>f.map(m=>m.resolved?m:{...m,subGroup:[h].concat(...m.subGroup??[])}))),{order:p,report:d}}function _se({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let s=[],o=[],l;if(i?.length===1)return{order:[{resolved:!0,participantId:i[0]}]};if(i?.length===2&&(!n?.headToHead||!n.headToHead.disabled&&!e)){let c=xBe({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return o.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:c,headToHeadWinner:d,report:o}}}let u=(n?.tallyDirectives||ABe).filter(c=>{let d=!(Ni(c.maxParticipants)&&i?.length>c.maxParticipants);return d||s.push(c),d});return s.length&&o.push({excludedDirectives:s,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,groupTotals:f,disableHeadToHead:h})=>(l=OBe({disableHeadToHead:h,participantIds:i,matchUpFormat:r,groupTotals:f,tallyPolicy:n,attribute:c,idsFilter:p,matchUps:a,reversed:d}),o.push(l.report),!l.order)),l.order?{order:l.order,report:o}:{order:i?.map(c=>({participantId:c})),report:o}}function xBe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function tg({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:s}){if(!n?.length||!is(n))return{error:Bu};let o=lt(n.map(({structureId:y})=>y));if(o.length!==1)return q({result:{error:re,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let l=n.filter(y=>y&&y.matchUpStatus!=="BYE"),u=l.length&&lt(l.flatMap(({drawPositions:y})=>y)).length,c=l.filter(y=>Dp({matchUp:y})).length===l.length;c||(s=0);let d=n.every(({matchUpType:y,tieMatchUps:b})=>y===ti&&b?.every(S=>Dp({matchUp:S}))),p=t?.[E2],f=n.filter(y=>Dp({matchUp:y})??y.matchUpType===ti),{participantResults:h}=ZU({matchUps:f,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:s}),m,g,{groupOrder:I,report:v}=i3({matchUps:f,participantResults:h,participantsCount:u,matchUpFormat:r,subOrderMap:a,tallyPolicy:p});if(i&&FBe({participantResults:h}),c&&I)m=v,g=I,I.forEach(y=>{let{participantId:b,groupOrder:S,rankOrder:U,subOrder:T,ties:D,GEMscore:P}=y,E=h[b];Object.assign(E,{groupOrder:S,rankOrder:U,GEMscore:P,subOrder:T,ties:D})});else{let{groupOrder:y,report:b}=i3({requireCompletion:!1,participantResults:h,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});m=b,g=y,y&&y.forEach(S=>{let{participantId:U,groupOrder:T,GEMscore:D}=S,P=h[U];Object.assign(P,{provisionalOrder:T,GEMscore:D})})}let w={completedTieMatchUps:d,readableReport:"",participantResults:h,bracketComplete:c,order:[],report:m};if((c||d)&&(w.order=g),e||ha({tally:!0})){let y=NBe({matchUps:n,report:m,order:g});ha({tally:!0})&&console.log(y),w.readableReport=y}return w}function FBe({participantResults:t}){let e=n=>n.reduce((a,s)=>a+parseFloat(s),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:s}=a,o=s?.length?i(s):0;return{participantId:n,averagePressure:o}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function su({requireTimeStamp:t,scaleAttributes:e,participant:i}){if(!i)return{error:Vm};if(!Ut(e))return{error:re};if(i.timeItems??=[],Array.isArray(i.timeItems)){let{accessor:r,scaleType:n,eventType:a,scaleName:s}=e,o=[Rd,n,a,s].join("."),l=i.timeItems.filter(u=>u?.itemType===o).filter(u=>!t||u?.itemDate).sort((u,c)=>(u.createdAt?new Date(u.createdAt).getTime():0)-(c.createdAt?new Date(c.createdAt).getTime():0)).pop();if(l){let[u,c,d,p]=l.itemType?.split(".")??[];if(u!==Rd)return{error:qh};let f=r&&Pp({element:l.itemValue,accessor:r}),h=f?.value||l.itemValue,m={rawValue:f&&l.itemValue,eventType:d,scaleDate:l.itemDate,scaleValue:h,scaleName:p,scaleType:c};return{...W,scaleItem:m}}}return{...W,scaleItem:void 0}}function LBe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){let a={},s=c=>[Rd,nu,n.eventType,c].join("."),o=Object.assign({},...(r.timeItems||[]).filter(({itemType:c})=>c.split(".")[1]===nu).map(({itemType:c,itemValue:d})=>({[c]:d}))),l=(t?.stageSeedingScaleNames&&Object.values(t?.stageSeedingScaleNames)||Array.isArray(t?.seedingScaleNames)&&t.seedingScaleNames||[]).map(s),u=_i(Object.keys(o),l);if((!e||!Object.keys(o).length&&!t?.drawIds?.length||u.length)&&u.length){if(t?.stageSeedingScaleNames){let c=Object.keys(t.stageSeedingScaleNames).map(p=>{let f=s(t.stageSeedingScaleNames[p]),h=o[f];return[p,h]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...c);a.seedAssignments=d}else if(u){let c=u.map(d=>o[d]);a.seedValue=c.pop()}}else if(!e&&typeof i=="object"){let c=Object.keys(i).map(p=>{let f=s(i[p]),h=o[f];return[p,h]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...c);a.seedAssignments=d}else{let{categoryName:c,ageCategoryCode:d}=n.category||{},p=[d,n.eventId,c].filter(Boolean),f;for(let h of p){let m={eventType:n.eventType,scaleType:nu,scaleName:h},g=su({scaleAttributes:m,participant:r});if(g.scaleItem){f=g.scaleItem;break}}if(f&&(!e||t?.published&&!t?.published?.drawIds?.length)){let h=f.scaleValue;a.seedValue=h}}return a}function gV({positionAssignments:t}){let e=(t||[]).filter(Aa(Eu)).map(n=>{let{extension:a}=rt({element:n,name:_I}),s=Ke(a?.value),o=!isNaN(s)&&s;return o&&{participantId:n.participantId,subOrder:o}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=Ra(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function _Be({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:s,entry:o}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=o,p=d?.length&&t?Object.assign({},...p2(d??[])):{},f=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:s,eventId:a});i.events[a]=je(f,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function iy(t){let e=He(t,[{[gr]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:r=rs}=t,n=`${rp}.${np}`;return xe(vN({tournamentRecord:i,itemType:n})?.timeItem?.itemValue?.[r],!1,!0)}function $Be(t){let{tournamentId:e}=t??{};return!!e}function Fa({event:t,status:e=rs}){let i=`${rp}.${np}`;return _U({itemType:i,event:t})?.timeItem?.itemValue?.[e]}function zf(t){let e=t?.embargo;return!e||!ru(e)?!1:new Date(e).getTime()>Date.now()}function Ko(t){return!!t?.published&&!zf(t)}function RN({drawDetails:t,drawId:e,ignoreEmbargo:i=!1}){let r=t?.[e]?.publishingDetail;return i?!!r?.published:Ko(r)}function ig(t){let{tournamentRecord:e,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:s,event:o}=t??{};if(e&&!$Be(e))return{error:re};if(n&&!o)return{error:gs};if(Array.isArray(r)&&r?.length){let p={};for(let f of r){if(!ai(f))return{error:re};let h=Kn({tournamentRecord:e,eventId:f})?.event;if(!h)return{error:gs};let m=Bk({event:h});p[f]=m}return{...W,publishState:p}}if(o){let p=Bk({event:o}),f={};if(s)return i?{publishState:{status:{published:!!p.status.publishedDrawIds?.includes(s),drawDetail:p.status.drawDetails?.[s]},...W}}:{error:za};if(Array.isArray(a)&&a?.length){let h=o.drawDefinitions?.map($I)??[];for(let m of a){if(!ai(m))return{error:re};if(!h.includes(m))return{error:za};f[m]={status:{published:!!p.status.publishedDrawIds.includes(m),drawDetail:p.status.drawDetails?.[m]}}}}else f=p;return{...W,publishState:f}}let l=[],u=!1,c={};for(let p of e?.events??[]){let f=Bk({event:p});c[p.eventId]=f,f.status.published&&(l.push(p.eventId),u=!0);for(let{drawId:h}of p.drawDefinitions??[]){let m=f.status?.publishedDrawIds?.includes(h);m&&(c[h]={status:{published:m}})}}let d=[];if(e){let p=iy({tournamentRecord:e});c.tournament=p??{},(p?.orderOfPlay?.published||p?.participants?.published)&&(u=!0),c.tournament.status={published:u,publishedEventIds:l},p?.orderOfPlay?.embargo&&d.push({type:"orderOfPlay",embargo:p.orderOfPlay.embargo,embargoActive:zf(p.orderOfPlay)}),p?.participants?.embargo&&d.push({type:"participants",embargo:p.participants.embargo,embargoActive:zf(p.participants)})}for(let p of e?.events??[]){let f=Fa({event:p})?.drawDetails??{};for(let[h,m]of Object.entries(f)){m?.publishingDetail?.embargo&&d.push({type:"draw",id:h,embargo:m.publishingDetail.embargo,embargoActive:zf(m.publishingDetail)});for(let[g,I]of Object.entries(m?.stageDetails??{}))I?.embargo&&d.push({type:"stage",id:`${h}:${g}`,embargo:I.embargo,embargoActive:zf(I)});for(let[g,I]of Object.entries(m?.structureDetails??{}))if(I?.embargo&&d.push({type:"structure",id:g,embargo:I.embargo,embargoActive:zf(I)}),I?.scheduledRounds)for(let[v,w]of Object.entries(I.scheduledRounds))w?.embargo&&d.push({type:"scheduledRound",id:`${g}:round${v}`,embargo:w.embargo,embargoActive:zf(w)})}}return d.length&&(c.embargoes=d),{...W,publishState:c}}function Bk({event:t}){let e=Fa({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let r=e.drawDetails??{};for(let o of t.drawDefinitions?.map($I)||[])r[o]||(r[o]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter(o=>RN({drawDetails:r,drawId:o,ignoreEmbargo:!0})),a=n?.length?n:e.drawIds??[];if(a?.length&&!n?.length)for(let o of a)r[o]={publishingDetail:{published:!0}};let s=a?.length>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:r,published:s}}}function $se(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||r==="BYE"||e[i].scheduleItems.push({...c,scheduledDate:Ze(c?.scheduledDate),scheduledTime:fi(c?.scheduledTime),checkScoreHasValue:hr({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,drawId:d})}function BBe({finishingPositionRange:t={winner:[],loser:[]},collectionPosition:e,participantMap:i,finishingRound:r,participantWon:n,collectionId:a,matchUpStatus:s,participantId:o,stageSequence:l,roundNumber:u,structureId:c,matchUpId:d,drawId:p,stage:f}){let h=i[o],m=y=>Math.abs(y[0]-y[1]);h.structureParticipation[c]||(h.structureParticipation[c]={rankingStage:f,walkoverWinCount:0,defaultWinCount:0,stageSequence:l,winCount:0,structureId:c,drawId:p});let g=h.structureParticipation[c],{winner:I,loser:v}=t,w=n?I:v;n&&(g.winCount+=1,s===si&&(g.walkoverWinCount+=1),s===Yt&&(g.defaultWinCount+=1)),w&&(!g.finishingPositionRange||m(w)<m(g.finishingPositionRange))&&(g.finishingPositionRange=w),r&&((!g.finishingRound||r<g.finishingRound)&&(g.finishingMatchUpId=d,g.finishingRound=r,g.roundNumber=u),r===1&&(g.participantWon=n)),e&&(g.lineParticipation||(g.lineParticipation=[]),g.lineParticipation.push({collectionPosition:e,collectionId:a,won:n}))}function r3(t){let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:s,withEvents:o,withDraws:l,finishingPositionRange:u,finishingRound:c,matchUpStatus:d,stageSequence:p,roundNumber:f,structureId:h,score:m,stage:g,withRankingProfile:I,collectionPosition:v,tieWinningSide:w,roundPosition:y,matchUpTieId:b,matchUpSides:S,collectionId:U,matchUpType:T,winningSide:D,matchUpId:P,schedule:E,eventId:R,drawId:C,sides:M}=t,N=a&&M?.length===2&&Object.assign({},...M.map(({sideNumber:A},O)=>{let k=M[1-O].participantId;return A&&{[A]:k}}).filter(Boolean));for(let A of M){let{participantId:O,sideNumber:k,bye:F}=A;if(F)continue;let x=D===k,L=_=>{let B=n[_]?.participant,G=B?.participantType,j=[{participantId:_,participantType:G}];if(G!==Gn)for(let Y of B?.individualParticipantIds||[]){let K=n[Y]?.participant;j.push({participantType:K?.participantType,participantId:Y})}return j},$=(_,B)=>{if(s){if(n[_].matchUps[P]={participantWon:x,matchUpType:T,structureId:h,sideNumber:k,matchUpId:P,eventId:R,drawId:C,stage:g},a){let G=L(B);n[_].matchUps[P].opponentParticipantInfo=G}U&&(n[_].matchUps[P].collectionId=U)}a&&B&&(n[_].opponents[B]={participantId:B,matchUpId:P,eventId:R,drawId:C}),I&&BBe({finishingPositionRange:u,collectionPosition:v,participantMap:n,participantWon:x,collectionId:U,finishingRound:c,matchUpStatus:d,participantId:_,stageSequence:p,roundNumber:f,structureId:h,matchUpId:P,drawId:C,stage:g}),(i||e)&&$se({participantMap:n,participantId:_,matchUpStatus:d,roundPosition:y,matchUpType:T,roundNumber:f,structureId:h,matchUpId:P,schedule:E,drawId:C,score:m})},V=({participant:_,partnerParticipantId:B})=>{let G=(j,Y)=>{j&&(j.partnerParticipantIds||(j.partnerParticipantIds=[]),j.partnerParticipantIds.includes(Y)||j.partnerParticipantIds.push(Y))};l&&G(_?.draws?.[C],B),o&&G(_?.events?.[R],B),s&&G(_?.matchUps?.[P],B)};if(O&&n[O]){let _=N?.[k];$(O,_);let B=n[O]?.participant.participantType===mt,G=n[O]?.participant.individualParticipantIds||[];if(b){if(r){let j=Y=>n[Y].matchUps[b]={participantWon:w===k,matchUpId:b,matchUpType:ti,sideNumber:k};j(O),G.forEach(j)}if(l&&!n[O].draws[C]){let j=S.find(X=>X.sideNumber===k)?.participant?.participantId,Y=n[j]?.draws?.[C]?.entryStatus,K=X=>n[X].draws[C]={entryStatus:Y,eventId:R,drawId:C};K(O),G.forEach(K)}}if(B&&(G.forEach(j=>n[j]&&$(j,_)),G.forEach((j,Y)=>{let K=G[1-Y],X=n[j];X&&V({participant:X,partnerParticipantId:K})}),o&&S)){let j=S.find(Y=>Y.sideNumber===k)?.participant?.participantId;if(j){let Y=n[j]?.events[R];Y?(n[O].events[R]={...Y},G.forEach(K=>n[K].events[R]={...Y})):console.log("Missing teamEntry",{eventId:R,teamParticipantId:j})}}if(D){let j=Y=>{x?(n[Y].counters[T].wins+=1,n[Y].counters.wins+=1,d===si&&(n[Y].counters[T].walkoverWins+=1,n[Y].counters.walkoverWins+=1),d===Yt&&(n[Y].counters[T].defaultWins+=1,n[Y].counters.defaultWins+=1)):(n[Y].counters[T].losses+=1,n[Y].counters.losses+=1,d===si&&(n[Y].counters[T].walkovers+=1,n[Y].counters.walkovers+=1),d===Yt&&(n[Y].counters[T].defaults+=1,n[Y].counters.defaults+=1))};j(O),G.forEach(j)}}}}function CN(t,e){return(t||"").localeCompare(e||"")}function VBe(t){let{participantFilters:e,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,contextFilters:s,matchUpFilters:o,participantMap:l,contextProfile:u,withPotentialMatchUps:c,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:h,withStatistics:m,withOpponents:g,withMatchUps:I,withSeeding:v,withEvents:w,withDraws:y}=t,b=e?.participantIds,S=k=>{let F=[k];return l[k]?.participant.individualParticipantIds?.forEach(x=>F.push(x)),F.some(x=>!b?.length||b.includes(x))?F:[]},U={withMatchUps:I||d,withEvents:w||d,withDraws:y||d,withPotentialMatchUps:c,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:h,withStatistics:m,participantMap:l,withOpponents:g,withSeeding:v},T=[],D={},P=[],E={},R={},C={},M={},N={},A=({eventType:k,scaleNames:F,participantId:x})=>l[x]?.participant?.rankings?.[k]?.find(L=>F.includes(L.scaleName))?.scaleValue;for(let k of n?.events||[]){if(e?.eventIds&&!e.eventIds.includes(k.eventId))continue;let{drawDefinitions:F=[],extensions:x=[],wheelchairClass:L,eventType:$,eventName:V,category:_,entries:B,eventId:G,gender:j}=k,{flightProfile:Y}=Vi({event:k}),K=Y?.flights??[],X=ig({event:k}).publishState;X&&(E[G]=X);let Z=X?.status?.publishedSeeding;if(w||v||d){let ae=i?Object.assign({},...p2(x??[])):{};R[G]={...ae,wheelchairClass:L,eventName:V,eventType:$,category:_,eventId:G,gender:j};let te=[_?.categoryName,_?.ageCategoryCode].filter(Boolean);for(let ne of B){let{participantId:le}=ne;if(!le||!l[le])continue;let de=A({eventType:$,scaleNames:te,participantId:le}),pe,ve;if(v){let Ee=l[le].participant;({seedAssignments:pe,seedValue:ve}=LBe({publishedSeeding:Z,usePublishState:a,withSeeding:v,participant:Ee,event:k}))}let Me=Ee=>{if(l[Ee]?.events?.[G])return;let Be=l[Ee];_Be({convertExtensions:i,seedAssignments:pe,participant:Be,withSeeding:v,seedValue:ve,eventId:G,ranking:de,entry:ne})};Me(le),(l[le].participant.individualParticipantIds||[]).forEach(Me)}}let Q=E?.[G]?.publishedSeeding;if(y||d||v){let ae=ne=>ne?Object.assign({},...ne.map(({participantId:le,seedValue:de,seedNumber:pe})=>({[le]:{seedValue:de,seedNumber:pe}}))):void 0,te=lt([...F.map($I),...K.map($I)]);for(let ne of te){let le=F.find(ee=>ee.drawId===ne),de=[_?.categoryName,_?.ageCategoryCode].filter(Boolean),{structures:pe=[],drawOrder:ve,drawName:Me,drawType:Ee}=le??{},Be=K?.find(ee=>ee.drawId===ne),fe=le?.entries||Be?.drawEntries,Te=Be?.flightNumber,ce=(le?.structures||[]).sort((ee,Se)=>Ym(ee,Se)).map(({structureId:ee,structures:Se})=>[ee,...(Se||[]).map(({structureId:Pe})=>Pe)]).flat(1/0),be,we,Ae,ye,Ne=0,he=new Set(pe.filter(({stage:ee,stageSequence:Se})=>ee===ke&&Se===1||ee===ze).flatMap(ee=>{let{positionAssignments:Se}=Xt({structure:ee}),{seedAssignments:Pe,stageSequence:st,stage:Ue}=ee;return Ue===ke?(Ne=Se?.length??0,Ae=Se,ye=Pe):st===1&&(be=Se,we=Pe),Se}).map(({participantId:ee})=>ee).filter(Boolean)),De=ae(ye),Le=ae(we),J=le?fe.filter(({participantId:ee})=>he.has(ee)):fe,se=!a||Q?.published&&(Q?.drawIds?.length===0||Q?.drawIds?.includes(ne));for(let ee of J){if(!l[ee.participantId])continue;let{entryStatus:Se,entryStage:Pe,entryPosition:st,participantId:Ue}=ee,dt=A({participantId:Ue,scaleNames:de,eventType:$}),bi=qe=>{if(!l[qe]||l[qe].draws?.[ne])return;let wi=v&&se,li=wi?{}:void 0,an=wi?De?.[Ue]?.seedValue||De?.[Ue]?.seedNumber:void 0,Go=an?De?.[Ue]:void 0,Lf=wi?Le?.[Ue]?.seedValue||Le?.[Ue]?.seedNumber:void 0,_f=Lf?Le?.[Ue]:void 0;li&&an&&(li[ke]=Go),li&&Lf&&(li[ze]=_f);let wy=an||Lf;wy&&(l[qe].participant.seedings[$]||(l[qe].participant.seedings[$]=[]),Go&&l[qe].participant.seedings[$].push({...Go,scaleName:ne}),_f&&l[qe].participant.seedings[$].push({..._f,scaleName:ne}),li&&(l[qe].events[G].seedAssignments||(l[qe].events[G].seedAssignments={}),Object.keys(li).forEach(Sy=>l[qe].events[G].seedAssignments[Sy]=li[Sy]))),(y||d)&&(l[qe].draws[ne]=je({seedAssignments:li,entryPosition:st,entryStatus:Se,entryStage:Pe,seedValue:wy,eventId:G,ranking:dt,drawId:ne},!1,!1,!0))};[Es,Rf].includes(Se)||(bi(Ue),(l[Ue].participant.individualParticipantIds||[])?.forEach(bi))}let oe=(le?.structures??[]).reduce((ee,Se)=>(ee.includes(Se.stage)||ee.push(Se.stage),ee),[]),ue=(le?.links??[]).length;C[ne]={qualifyingPositionAssignments:be,qualifyingSeedAssignments:we,mainPositionAssignments:Ae,qualifyingSeedingMap:Le,mainSeedAssignments:ye,orderedStructureIds:ce,mainSeedingMap:De,flightNumber:Te,linksCount:ue,drawOrder:ve,drawName:Me,drawType:Ee,drawSize:Ne,drawId:ne,stages:oe}}}if(d||f||h||m||g||I||y){let ae=!!f||c,te=Gu({afterRecoveryTimes:!!f,policyDefinitions:r,tournamentRecord:n,inContext:!0,participantMap:l,contextFilters:s,matchUpFilters:o,contextProfile:u,nextMatchUps:ae,event:k})?.matchUps??[];for(let ne of te){let{finishingPositionRange:le,potentialParticipants:de,tieMatchUps:pe=[],sides:ve=[],winningSide:Me,matchUpType:Ee,matchUpId:Be,eventId:fe,drawId:Te,collectionId:ce,containerStructureId:be,stageSequence:we,finishingRound:Ae,matchUpStatus:ye,roundPosition:Ne,roundNumber:he,structureId:De,schedule:Le,score:J,stage:se}=ne;if(D[Be]=ne,d&&be&&De&&Te&&(M[De]||(M[De]=[]),M[De].push(ne),!N[be])){let ue=F.find(ee=>ee.drawId===Te);ue&&(N[be]={drawDefinition:ue,drawId:Te})}let oe={finishingPositionRange:le,containerStructureId:be,finishingRound:Ae,stageSequence:we,roundPosition:Ne,collectionId:ce,roundNumber:he,structureId:De,schedule:Le,eventId:fe,drawId:Te,score:J,stage:se};r3({...oe,...U,matchUpStatus:ye,winningSide:Me,matchUpType:Ee,matchUpId:Be,sides:ve});for(let ue of pe){let{winningSide:ee,sides:Se=[],matchUpId:Pe,collectionPosition:st,collectionId:Ue,matchUpStatus:dt,matchUpType:bi}=ue;r3({...oe,...U,winningSide:ee,tieWinningSide:Me,matchUpTieId:Be,matchUpId:Pe,sides:Se,collectionId:Ue,collectionPosition:st,matchUpSides:ve,matchUpStatus:dt,matchUpType:bi})}Array.isArray(de)&&(ae||f||p)&&de.flat().map(wt).filter(Boolean)?.forEach(ue=>{S(ue)?.forEach(ee=>{l[ee]&&(l[ee].potentialMatchUps[Be]=je({tournamentId:n?.tournamentId,matchUpId:Be,eventId:fe,drawId:Te}))}),(f||p)&&$se({potential:!0,participantMap:l,participantId:ue,matchUpStatus:ye,roundPosition:Ne,structureId:De,matchUpType:Ee,roundNumber:he,matchUpId:Be,schedule:Le,drawId:Te,score:J})})}P.push(...te)}}let O={};if(d)for(let[k,F]of Object.entries(N)){let{drawDefinition:x,drawId:L}=F,$=x.structures?.find(j=>j.structureType===In&&j.stage===ke&&j.stageSequence===1);if(!$?.structures)continue;let V=$.structures,_=V.length,B=V.reduce((j,Y)=>j+(Y.positionAssignments?.length||0),0),G=x.structures?.find(j=>j.stage===ki);O[L]||(O[L]={});for(let j of V){let Y=j.structureId,K=M[Y];if(!K?.length)continue;let X=j.positionAssignments?.length,{subOrderMap:Z}=gV({positionAssignments:j.positionAssignments}),Q=tg({matchUps:K,subOrderMap:Z});if(Q?.participantResults)for(let[ae,te]of Object.entries(Q.participantResults)){let{groupOrder:ne,provisionalOrder:le}=te,de=ne||le;if(!de)continue;let pe;if(B===X&&de)pe=[de,de];else if(_>1&&de&&!G)pe=[1,_];else if(_>1&&de&&G){let ve=x.links?.find(Me=>Me.source.structureId===k)?.source?.finishingPositions;if(ve){let Me=ve.length*_;if(ve.includes(de))pe=[1,Me];else{let Ee=(X-de)*_;pe=[Me+1,B-Ee]}}}pe&&(O[L][ae]=pe)}}}if(m||d||f){let k=Object.values(l);for(let F of k){let{wins:x,losses:L,[qt]:{wins:$,losses:V},[Vt]:{wins:_,losses:B}}=F.counters,G=(j,Y,K)=>{let X=Y+K,Z=Y,Q=X&&Z/X;F.statistics[j]={denominator:X,numerator:Z,statValue:Q,statCode:j}};if(m&&(G(OD,x,L),G(`${OD}.${qt}`,$,V),G(`${OD}.${Vt}`,_,B)),d){let j=(Y=[])=>Math.abs(Y[0]-Y[1]);for(let Y of Object.keys(F.draws)){let{orderedStructureIds:K=[],flightNumber:X}=C[Y]||{};if(F.structureParticipation&&K.length){let Z,Q=0,ae=K.map(te=>{let ne=F.structureParticipation[te];if(!ne)return;Z||(Z=ne?.finishingPositionRange),j(Z)>j(ne?.finishingPositionRange)&&(Z=ne?.finishingPositionRange);let le=ne.stage!==ze;return le&&(Q+=1),je({...ne,participationOrder:le?Q:void 0,flightNumber:X})}).filter(Boolean);if(F.draws[Y]){let te=F.participant.participantId,ne=O[Y]?.[te];ne&&(Z=ne),F.draws[Y].finishingPositionRange=Z,F.draws[Y].structureParticipation=ae}}}}if(f){let j=Ut(f)?f.scheduledMinutesDifference:0,Y=F.scheduleItems||[],K=F.potentialMatchUps||{},X=Y.reduce((Q,ae)=>{let{scheduledDate:te,scheduledTime:ne}=ae;return Q[te]||(Q[te]=[]),ne&&Q[te].push(ae),Q},{});Object.values(X).forEach(Q=>Q.sort(une));for(let Q of Y){let{typeChangeTimeAfterRecovery:ae,timeAfterRecovery:te,scheduledDate:ne,scheduledTime:le}=Q,de=X[ne],pe=Nt(le);for(let ve of de){if(ve.matchUpId===Q.matchUpId||Br(ve.matchUpStatus)&&!ve.checkScoreHasValue)continue;let Me=Q.matchUpType!==ve.matchUpType&&ae||te,Ee=Q.drawId===ve.drawId,Be=K[Q.matchUpId]&&K[ve.matchUpId],fe=Nt(ve.scheduledTime),Te=Math.abs(fe-pe),ce=fe>=pe;if((j&&!Number.isNaN(j)?Te<=j:ce&&Nt(ve.scheduledTime)<Nt(Me))&&!(Be&&Ee)&&ce){let be=[Q.matchUpId,ve.matchUpId].sort(CN).join("|");F.scheduleConflicts[be]={priorScheduledMatchUpId:Q.matchUpId,matchUpIdWithConflict:ve.matchUpId}}}}let Z=F.participant.participantId;Object.keys(F.scheduleConflicts).length&&T.push(Z),l[Z].scheduleConflicts=F.scheduleConflicts}}}return{participantIdsWithConflicts:T,eventsPublishStatuses:E,derivedEventInfo:R,derivedDrawInfo:C,mappedMatchUps:D,participantMap:l,matchUps:P}}function eT({participantFilters:t={},tournamentRecord:e,participants:i=[]}){if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:s,participantRoles:o,participantRoleResponsibilities:l,participantTypes:u,participantIds:c,signInStatus:d,enableOrFiltering:p,eventIds:f,genders:h}=t,m=$l(f)&&e?.events?.filter(y=>f?.includes(y.eventId))||e?.events||[],g=n&&jBe({drawEntryStatuses:n,tournamentEvents:m}),I=s&&GBe({eventEntryStatuses:s,tournamentEvents:m}),v=a!==void 0&&[!0,!1].includes(a)&&m.reduce((y,b)=>y.concat(...(b.drawDefinitions||[]).map(S=>Cae({drawDefinition:S}).allPositionedParticipantIds).filter(Boolean)),[]),w=y=>r?.reduce((b,S)=>{let{accessor:U,value:T}=S,{values:D}=Pp({element:y,accessor:U});return b&&D?.includes(T)},!0);if(i=i?.filter(y=>{let b=Ps({element:y,itemType:LU})?.timeItem?.itemValue,{participantRoleResponsibilities:S,participantType:U,participantRole:T,participantId:D,person:P}=y,E=Array.isArray(h)&&h?.length&&P?.sex&&h.includes(P.sex);return p?h&&E||a&&v.includes(D)||a===!1&&!v.includes(D)||g?.includes(D)||I?.includes(D)||c?.includes(D)||d&&b===d||u&&U&&$l(u)&&u.includes(U)||o&&T&&$l(o)&&o.includes(T)||l&&$l(S)&&$l(l)&&l.find(R=>S?.includes(R))||r?.length&&$l(r)&&w(y):(!h||E)&&(a===void 0||a&&v.includes(D)||a===!1&&!v.includes(D))&&(!g||g.includes(D))&&(!I||I.includes(D))&&(!c||c.includes(D))&&(!d||b===d)&&(!u||U&&$l(u)&&u.includes(U))&&(!o||T&&$l(o)&&o.includes(T))&&(!l||$l(S)&&$l(l)&&l.find(R=>S?.includes(R)))&&(!r?.length||$l(r)&&w(y))}),m.length&&f){let y=new Set(m.filter(b=>f.includes(b.eventId)).flatMap(b=>{let S=(b.entries||[]).map(T=>T.participantId);if(Di(bl)(b.eventType))return S;let U=(e?.participants??[]).filter(T=>S.includes(T.participantId)).flatMap(T=>T.individualParticipantIds);return S.concat(...U)}));i=i?.filter(b=>y.has(b.participantId))}return i}function $l(t){return t&&Array.isArray(t)&&t.length}function jBe({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return lt(e.reduce((r,n)=>{let{flightProfile:a}=Vi({event:n}),s=a?.flights?.flatMap(({drawEntries:l})=>Array.isArray(l)?l.filter(i).map(wt):[])||[],o=n.drawDefinitions?.map(({entries:l})=>l?l.filter(i).map(wt):[])||[];return r.concat(...s,...o)},[]))}function GBe({eventEntryStatuses:t,tournamentEvents:e}){return lt(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(wt);return i.concat(...n)},[]))}function Ei(t){let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:s,withScheduleItems:o,tournamentRecord:l,scheduleAnalysis:u,withSignInStatus:c,withTeamMatchUps:d,withScaleValues:p,usePublishState:f,withStatistics:h,contextFilters:m,matchUpFilters:g,contextProfile:I,withOpponents:v,withMatchUps:w,internalUse:y,withSeeding:b,withEvents:S,withDraws:U,withISO2:T,withIOC:D}=t,P="getParticipants";if(!l)return q({stack:P,result:{error:Ie}});(w||n)&&Io({tournamentRecord:l});let E=Hae({convertExtensions:a,tournamentRecord:l,withSignInStatus:c,withScaleValues:p,internalUse:y,withISO2:T,withIOC:D}),{participantMap:R}=E,C=VBe({withMatchUps:w??n,withEvents:S??n,withDraws:U??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:o,policyDefinitions:s,tournamentRecord:l,scheduleAnalysis:u,withTeamMatchUps:d,usePublishState:f,withStatistics:h,contextFilters:m,matchUpFilters:g,participantMap:R,withOpponents:v,contextProfile:I,withSeeding:b}),{participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:O,mappedMatchUps:k}=C,F=C.matchUps;R=C.participantMap;let x=u??r,L=({potentialMatchUps:j,scheduleConflicts:Y,scheduleItems:K,participant:X,statistics:Z,opponents:Q,matchUps:ae,events:te,draws:ne})=>{let le=Object.values(ne),de=Object.values(Q);return v&&le?.forEach(pe=>{pe.opponents=de.filter(ve=>ve.drawId===pe.drawId)}),je({...X,scheduleConflicts:u?Object.values(Y):void 0,draws:U||n?le:void 0,events:S||n?Object.values(te):void 0,matchUps:w||n?Object.values(ae):void 0,opponents:v?de:void 0,potentialMatchUps:x?Object.values(j):void 0,statistics:h?Object.values(Z):void 0,scheduleItems:o?K:void 0},!1,!1,!0)},$=new Map;for(let j of Object.keys(R))$.set(j,L(R[j]));let V=[...$.values()],_=s?.[Kv]?.participant,B=eT({participants:V,participantFilters:i,tournamentRecord:l});if(e){let j=Ut(e)?e:void 0;for(let Y of B)for(let K of Y.individualParticipantIds??[]){Y.individualParticipants??=[];let X=$.get(K),Z=j?Xh({template:j,source:X}):X;Y.individualParticipants.push(Z)}}let G=_?B.map(j=>Xh({source:j,template:_})):B;return{participantMap:t.returnParticipantMap!==!1?R:void 0,mappedMatchUps:t.returnMatchUps!==!1?k:void 0,matchUps:t.returnMatchUps!==!1?F:void 0,missingParticipantIds:E.missingParticipantIds,participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:O,participants:G,...W}}function em(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:pr};let{participant:a,tournamentId:s}=ip({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...su({participant:a,scaleAttributes:i}),tournamentId:s}:{error:Gi}}function HBe(t,e){let i=t.startDate||e?.startDate,r=t.endDate||e?.endDate;return!i||!r?{error:KLe}:!kn(i)||!kn(r)?{error:Yi}:{startDate:i,endDate:r}}function n3(t,e){let i=new Date(Ze(t)),r=new Date(Ze(e)),n=r.getFullYear()-i.getFullYear(),a=r.getMonth()-i.getMonth();return(a<0||a===0&&r.getDate()<i.getDate())&&n--,n}function a3(t,e,i){return!(e!==void 0&&t<e||i!==void 0&&t>i)}function WBe(t){return/^C\d{1,2}-\d{1,2}$/.test(t.ageCategoryCode||"")}function zBe(t,e,i,r){if(WBe(e))return{valid:!0};let n=e.ageMin,a=e.ageMax;if(e.ageCategoryCode&&!n&&!a){let d=zp({consideredDate:i,category:e});d.error||(n=d.ageMin,a=d.ageMax)}if(!n&&!a)return{valid:!0};let s=t.person?.birthDate;if(!s)return{valid:!1,reason:"Missing birthDate",details:{requiredMin:n,requiredMax:a}};let o=n3(s,i),l=n3(s,r),u=a3(o,n,a),c=a3(l,n,a);if(!u){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${o} at event start (${i}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}if(!c){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${l} at event end (${r}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}return{valid:!0}}function qBe(t,e,i,r){if(!e.ratingMin&&!e.ratingMax)return{valid:!0};if(!e.ratingType)return{valid:!0};let n={scaleType:"RATING",scaleName:e.ratingType,eventType:i.eventType},{scaleItem:a}=em({tournamentRecord:r,participantId:t.participantId,scaleAttributes:n});if(!a?.scaleValue)return{valid:!1,reason:`Missing ${e.ratingType} rating`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};let s;if(typeof a.scaleValue=="object"){let o=Pp({element:a.scaleValue,accessor:a.scaleValue?.accessor});if(o===void 0)return{valid:!1,reason:`Cannot extract rating value from ${e.ratingType} scale item`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};s=o}else s=a.scaleValue;return e.ratingMin!==void 0&&s<e.ratingMin?{valid:!1,reason:`${e.ratingType} rating ${s} below minimum ${e.ratingMin}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:e.ratingMax!==void 0&&s>e.ratingMax?{valid:!1,reason:`${e.ratingType} rating ${s} above maximum ${e.ratingMax}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:{valid:!0}}function YBe(t){let e=t.person;if(!e)return"Unknown";let i=e.standardGivenName||e.passportGivenName,r=e.standardFamilyName||e.passportFamilyName;return[i,r].filter(Boolean).join(" ")||"Unknown"}function KBe(t,e,i,r,n,a){let s=zBe(t,e,r,n),o=qBe(t,e,i,a);if(!s.valid||!o.valid){let l={participantId:t.participantId,participantName:YBe(t),rejectionReasons:[]};return s.valid||l.rejectionReasons.push({type:"age",reason:s.reason,details:s.details||{}}),o.valid||l.rejectionReasons.push({type:"rating",reason:o.reason,details:o.details||{}}),l}return null}function Uh({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){if(!e)return{error:$e};let n=e.entries?.find(a=>a.participantId===t&&(!i||i===a.entryStatus)&&(!r||r===a.entryStage));return t&&n}function XBe({relevantLinks:t,drawDefinition:e,provisionalPositioning:i,roundQualifiersCounts:r}){let n=0;for(let a of t){let s=tt({structureId:a.source.structureId,drawDefinition:e})?.structure;if(s?.stage===ze){let o=a.source.roundNumber,l=a.target.roundNumber,u;if(s.structureType===In){let c=s.structures?.length??0,d=a.source.finishingPositions?.length??0;u=c*d}else u=Ot({matchUpFilters:{roundNumbers:[o]},structure:s,afterRecoveryTimes:!1,provisionalPositioning:i,inContext:!1}).matchUps?.length||0;r[l]||(r[l]=0),r[l]+=u,n+=u}}return n}function ry(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=t;if(!i)return{error:$e};let{entryProfile:s}=BU({drawDefinition:i}),o=a&&r&&s?.[a]?.stageSequence?.[r]?.qualifiersCount||a&&s?.[a]?.qualifiersCount||0,l={};if(!n)return{qualifiersCount:o,roundQualifiersCounts:l};let{structure:u}=tt({drawDefinition:i,structureId:n}),c=i.links?.filter(f=>f?.target?.structureId===u?.structureId),d=0;c?.length&&(d=XBe({relevantLinks:c,drawDefinition:i,provisionalPositioning:e,roundQualifiersCounts:l}));let p=Object.keys(l);if(p.length<=1){let f=p[0]||1;l[f]=Math.max(l[f]||0,o)}return d=Math.max(d,o),{qualifiersCount:d,roundQualifiersCounts:l}}function wE({stage:t,drawDefinition:e}){let{entryProfile:i}=BU({drawDefinition:e});return i?.[t]?.drawSize||0}function JBe(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=wE({stage:n,drawDefinition:i}),{qualifiersCount:s}=ry({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-s}function Bse({stage:t,drawDefinition:e}){return!!(t===Mr||tV({stage:t,drawDefinition:e})&&wE({stage:t,drawDefinition:e}))}function Vse({entryStatus:t=ga,drawDefinition:e,stageSequence:i,stage:r}){if(t===qs)return g$e({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...W}:{error:gre};let n=JBe({drawDefinition:e,stageSequence:i,stage:r}),a=I$e({drawDefinition:e,stage:r}),s=iF({entryStatus:BI,drawDefinition:e,stage:r}),o=iF({entryStatus:ga,drawDefinition:e,stage:r}),l=s+o,u=l>=n,c=n-l;return r!==Mr&&u?{error:Gx}:t===BI?s<a?{...W}:{error:Gx}:{positionsAvailable:c,...W}}function IV(t){let e=He(t,[{[vn]:!0,[aae]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=ga,entryStageSequence:n,entryStage:a=ke,ignoreStageSpace:s,drawDefinition:o,entryPosition:l,participant:u,roundTarget:c,extensions:d,extension:p,drawType:f,event:h}=t,m="addDrawEntry";if(f!==ma&&!Bse({stage:a,drawDefinition:o}))return q({result:{error:Sf},stack:m});let g=Vse({stageSequence:n,stage:a,drawDefinition:o,entryStatus:r});if(!s&&!g.success&&(!f||f!==ma))return{error:g.error};if(p&&!Sl({extension:p}))return q({result:{error:re},info:"Invalid extension",context:{extension:p},stack:m});let I=t.participantId||u?.participantId;if(!I)return q({result:{error:pr},stack:m});let v=r===kc&&Uh({participantId:I,drawDefinition:o,entryStatus:r}),w=a===Mr&&Uh({participantId:I,drawDefinition:o,entryStage:a}),y=Uh({participantId:I,drawDefinition:o}),b=r!==kc&&a!==Mr&&y;if(b)return i?(at({payload:{drawId:o.drawId,eventId:h?.eventId,error:iw,participantId:I},topic:L2}),{...W}):q({result:{error:iw},context:{participantId:I},stack:m});if(v||w)return q({context:{invalidEntry:b,invalidLuckyLoser:v,invalidVoluntaryConsolation:w},result:{error:BM},stack:m});let S=je({entryStageSequence:n,participantId:I,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&It({element:S,extension:p}),c&&It({extension:{name:"roundEntry",value:c},element:S}),o.entries??=[],o.entries.push(S),ri({drawDefinition:o}),{...W}}function QBe(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=ga,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:s,drawDefinition:o,stageSequence:l,stage:u=ke,roundTarget:c,extension:d,event:p}=t,f=o.drawType===ma;if(!u)return{error:Gie};if(!o)return{error:$e};if(!Array.isArray(s))return{error:Ua};if(!f&&!Bse({stage:u,drawDefinition:o}))return{error:Sf};if(d&&!Sl({extension:d}))return q({result:{error:re},info:"Invalid extension",context:{extension:d},stack:e});let h=Vse({drawDefinition:o,stageSequence:l,entryStatus:r,stage:u});if(!a&&!h.success&&!f)return{error:h.error};let m=h.positionsAvailable??0;if(!a&&!f&&u!==Mr&&m<s.length)return{error:jB};let g=[],I=o.drawId,v=p?.eventId,w=s.reduce((y,b)=>{let S=r===kc&&Uh({participantId:b,drawDefinition:o,entryStatus:r}),U=u===Mr&&Uh({entryStage:u,drawDefinition:o,participantId:b}),T=Uh({participantId:b,drawDefinition:o});return r!==kc&&u!==Mr&&T&&(g.push(b),i&&at({payload:{error:iw,participantId:b,eventId:v,drawId:I},topic:L2})),S||U?y.concat(b):y},[]);return g.length&&!i?q({context:{eventId:v,drawId:I,duplicateEntries:g},result:{error:iw},stack:e}):(s.filter(y=>y&&!w.includes(y)).forEach(y=>{let b={entryStageSequence:l,entryStage:u,participantId:y,entryStatus:r};d&&It({element:b,extension:d}),c&&It({extension:{name:xl,value:c},element:b}),o.entries??=[],o.entries.push(b)}),n&&(o.entries=Ro({entries:o.entries})),ri({drawDefinition:o}),w?.length||g?.length?{info:"some participantIds could not be added",participantIdsNotAdded:w,duplicateEntries:g,...W}:{...W})}function vV({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,entryStage:l,extension:u,drawId:c,event:d}){if(!n?.length)return{error:Jd};if(!d)return{error:gs};if(!c)return{error:jo};let p=(d.entries||[]).map(wt);if(n.filter(m=>!p.includes(m)).length)return{error:Vie};if(a){let m=QBe({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,extension:u});if(m.error)return m}let{flightProfile:f}=Vi({event:d}),h=f?.flights.find(m=>m.drawId===c);return h?.drawEntries&&(n.forEach(m=>{let g=s===kc&&Vk({participantId:m,entryStatus:s,flight:h}),I=l===Mr&&Vk({participantId:m,entryStage:l,flight:h});!(s!==kc&&l!==Mr&&Vk({flight:h,participantId:m}))&&!g&&!I&&h.drawEntries.push({participantId:m,entryStatus:s,entryStage:l})}),e&&(h.drawEntries=Ro({entries:h.drawEntries}))),{...W}}function Vk({participantId:t,entryStatus:e,entryStage:i,flight:r}){let n=r.drawEntries?.find(a=>a.participantId===t&&(!e||e===a.entryStatus)&&(!i||i===a.entryStage));return t&&n}function tT({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){let a="removeEventEntries";if(!n?.eventId)return{error:ci};if(!Array.isArray(e)||e.some(d=>!ai(d)))return q({result:{error:Fo},stack:a});let s=(n.drawDefinitions??[]).flatMap(d=>Af({drawDefinition:d}).assignedParticipantIds??[]),o=(i?.length&&n.entries?.filter(d=>d.entryStatus&&i.includes(d.entryStatus))||[]).map(wt).filter(d=>!s.includes(d)),l=(r&&n.entries?.filter(d=>d.entryStage&&d.entryStage===r)||[]).map(wt).filter(d=>!s.includes(d));if(e.length?e=e.filter(d=>(!i?.length||o.includes(d))&&(!r||l.includes(d))):o.length&&l.length?e=_i(o,l):o.length?e=o:l.length&&(e=l),e?.length&&s.some(d=>e.includes(d)))return q({result:{error:Gv},stack:a});if(!e?.length)return{...W,participantIdsRemoved:[]};let u=[];n.entries=(n.entries??[]).filter(d=>{let p=!e.includes(d?.participantId);return p||u.push(d.participantId),p}),t&&(n.entries=Ro({entries:n.entries}));let{flightProfile:c}=Vi({event:n});return c?.flights?.forEach(d=>{d.drawEntries=(d.drawEntries||[]).filter(p=>!e.includes(p.participantId))}),n.drawDefinitions?.forEach(d=>{d.entries=(d.entries??[]).filter(p=>!e.includes(p.participantId))}),{...W,participantIdsRemoved:u}}var jse={[Nr]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},ny=jse;function ZBe(t,e,i,r){return e.gender&&i&&!(Ba(e.gender)||wu(e.gender))&&un(e.gender)!==un(t.person?.sex)?(r.push({participantId:t.participantId,sex:t.person?.sex}),!1):!0}function e2e({participantIds:t,typedParticipantIds:e,checkTypedParticipants:i}){return t.filter(r=>!i||e.includes(r))}function t2e({tournamentRecord:t,participantIds:e,event:i,entryStatus:r,genderEnforced:n,mismatchedGender:a}){function s(c,d,p){return Di(qt)(d.eventType)&&c.participantType===yt&&!vp(p)}function o(c,d,p){return d.eventType===Vt&&c.participantType===mt&&!vp(p)}function l(c,d,p,f,h){return d.eventType===Vt&&c.participantType===yt&&vp(p)?d.gender&&f&&!(Ba(d.gender)||wu(d.gender))&&un(d.gender)!==un(c.person?.sex)?(h.push({participantId:c.participantId,sex:c.person?.sex}),!1):!0:!1}function u(c,d,p){return d.eventType===$t&&(c.participantType===$t||vp(p)&&c.participantType===yt)}return t?.participants?.filter(c=>e.includes(c.participantId)?s(c,i,r)&&(!i.gender||!n||Ba(i.gender)||wu(i.gender)||un(i.gender)===un(c.person?.sex))||o(c,i,r)||l(c,i,r,n,a)?!0:s(c,i,r)&&!ZBe(c,i,n,a)?!1:u(c,i,r):!1).map(c=>c.participantId)??[]}function i2e({typedParticipantIds:t,categoryRejections:e,tournamentRecord:i,startDate:r,endDate:n,event:a}){let s=[];for(let o of t){let l=i.participants?.find(u=>u.participantId===o);if(l)if(a.category){let u=KBe(l,a.category,a,r,n,i);u?e.push(u):s.push(o)}else s.push(o)}return s}function r2e({enforceCategory:t,event:e,tournamentRecord:i,typedParticipantIds:r,categoryRejections:n}){if(t&&e.category&&i){let a=HBe(e,i);if(!("error"in a)){let{startDate:s,endDate:o}=a;return i2e({typedParticipantIds:r,tournamentRecord:i,event:e,startDate:s,endDate:o,categoryRejections:n})}}return r}function n2e({validParticipantIds:t,existingIds:e,entryStatus:i,entryStage:r,extensions:n,extension:a,roundTarget:s,entryStageSequence:o,addedParticipantIdEntries:l,event:u}){t.forEach(c=>{if(!e.has(c)){let d=je({participantId:c,entryStatus:i,entryStage:r,extensions:n});a&&It({element:d,extension:a}),s&&It({extension:{name:xl,value:s},element:d}),o&&(d.entryStageSequence=o),l.push(d.participantId),u.entries?.push(d)}})}function a2e({tournamentRecord:t,removedEntries:e,event:i}){if(i.eventType&&[Ec,Ca].includes(i.eventType)){let r=new Set((i.entries||[]).map(l=>l.participantId)),n=(i.entries||[]).filter(l=>vp(l.entryStatus)).map(l=>l.participantId),a=t?.participants??[],s=new Set(a.filter(l=>r.has(l.participantId)&&l.participantType&&[mt,$t].includes(l.participantType)).map(l=>l.individualParticipantIds).flat(1/0)),o=n.filter(l=>s.has(l));o.length&&(e.push(...o),tT({participantIds:o,autoEntryPositions:!1,event:i}))}}function s2e(t,e){if(!Array.isArray(t.participantIds))return q({result:{error:Ua},stack:e});let i=lt(t.participantIds??[]);return t.event?i?.length?t.event?.eventId?{participantIds:i}:{error:gs}:q({result:{error:Jd},stack:e}):{error:ci}}function o2e({policyDefinitions:t,tournamentRecord:e,event:i,enforceGender:r}){let n=Ct({tournamentRecord:e,event:i}).appliedPolicies??{},a=t?.[Nr]??n?.[Nr]??ny[Nr],s=(r??a?.participants?.enforceGender)!==!1;return{matchUpActionsPolicy:a,genderEnforced:s}}function l2e(t,e,i){return t&&(!Array.isArray(t)||!t.every(r=>Sl({extension:r})))||e&&!Sl({extension:e})?q({context:je({extension:e,extensions:t}),result:{error:re},info:"Invalid extension(s)",stack:i}):null}function sl(t){let{suppressDuplicateEntries:e=!0,entryStatus:i=ga,autoEntryPositions:r=!0,enforceCategory:n=!1,enforceGender:a=!0,entryStageSequence:s,policyDefinitions:o,entryStage:l=ke,tournamentRecord:u,ignoreStageSpace:c,drawDefinition:d,roundTarget:p,extensions:f,extension:h,drawId:m,event:g}=t,I="addEventEntries",v=s2e(t,I);if("error"in v)return v;let w="participantIds"in v?v.participantIds:[],y=l2e(f,h,I);if(y)return y;let{genderEnforced:b}=o2e({policyDefinitions:o,tournamentRecord:u,event:g,enforceGender:a}),S=[],U=[],T=!!u,D=[],P,E=t2e({tournamentRecord:u,participantIds:w,event:g,entryStatus:i,genderEnforced:b,mismatchedGender:D}),R=[];E=r2e({enforceCategory:n,event:g,tournamentRecord:u,typedParticipantIds:E,categoryRejections:R});let C=e2e({participantIds:w,typedParticipantIds:E,checkTypedParticipants:T});g.entries??=[];let M=new Set(g.entries.map(O=>O.participantId||O.participant?.participantId));if(n2e({validParticipantIds:C,existingIds:M,entryStatus:i,entryStage:l,extensions:f,extension:h,roundTarget:p,entryStageSequence:s,addedParticipantIdEntries:S,event:g}),m&&!vp(l)){let O=vV({participantIds:C,suppressDuplicateEntries:e,autoEntryPositions:r,entryStageSequence:s,ignoreStageSpace:c,drawDefinition:d,entryStatus:i,roundTarget:p,entryStage:l,extension:h,drawId:m,event:g});O.error&&(P=O.error)}if(a2e({event:g,tournamentRecord:u,removedEntries:U}),C.length!==w.length)return q({context:je({categoryRejections:R.length?R:void 0,mismatchedGender:D.length?D:void 0,gender:g.gender}),result:{error:Ua},stack:I});r&&(g.entries=Ro({entries:g.entries||[]}));let N=S.length,A=U.length;return q({result:{...W,addedEntriesCount:N,removedEntriesCount:A,...R.length&&{context:je({categoryRejections:R})}},stack:I,info:P})}var Gse="ADMINISTRATION",u2e="CAPTAIN",c2e="COACH",Qr="COMPETITOR",d2e="DIRECTOR",p2e="HOSPITALITY",Hse="MEDIA",Wse="MEDICAL",yV="OFFICIAL",zse="OTHER",qse="SECURITY",f2e="STRINGER",h2e="SUPERVISOR",m2e="TRANSPORT",g2e="VOLUNTEER",bV={ADMINISTRATION:Gse,CAPTAIN:u2e,COACH:c2e,COMPETITOR:Qr,DIRECTOR:d2e,HOSPITALITY:p2e,MEDIA:Hse,MEDICAL:Wse,OFFICIAL:yV,OTHER:zse,SECURITY:qse,STRINGER:f2e,SUPERVISOR:h2e,TRANSPORT:m2e,VOLUNTEER:g2e};function wV({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return q({result:{error:Ie},stack:a});if(!i||!e)return q({result:{error:Je},stack:a});let s=(r.participants??[]).find(c=>c.participantId===i);if(!s)return q({result:{error:Gi},stack:a});if(![$t,ts].includes(s.participantType))return q({result:{participantType:s.participantType,error:Lo},stack:a});let o=Yse({individualParticipantIds:e,groupingParticipant:s,tournamentRecord:r,suppressErrors:n}),{removed:l,error:u}=o;if(u)return q({result:o,stack:a});if(t)for(let c of r.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l?.filter(f=>!d.includes(f));sl({participantIds:p,entryStatus:Es,tournamentRecord:r,event:c})}}return l&&at({topic:nn,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...W,...o}}function Yse({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){let s=[];if(!e)return{removed:s};let o=[],l=[];a||({participants:a,mappedMatchUps:n}=Ei({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let u=a?.find(({participantId:p})=>p===e.participantId)?.events?.map(({eventId:p})=>p),c=(e.individualParticipantIds??[]).filter(p=>{let f=t?.includes(p),h=f&&a?.find(g=>g.participantId===p)?.matchUps.filter(({eventId:g})=>u.includes(g)).map(({matchUpId:g})=>n?.[g]).filter(({winningSide:g,score:I})=>g||hr({score:I})),m=f&&!h?.length;if(f&&!m&&l.push(p),m){s.push(p);for(let g of i.events??[])for(let I of g.drawDefinitions??[]){let{extension:v}=rt({element:I,name:Cc}),w=v?.value[e.participantId];v&&w&&(v.value[e.participantId]=w.filter(b=>b.participantId!==p),It({element:I,extension:v}),xU({drawDefinition:I}));let y=xn({drawDefinition:I,inContext:!1}).matchUps??[];for(let b of y){let S=b.sides??[];for(let U of S){let T=U.lineUp??[];T.find(D=>D.participantId===p)&&(U.lineUp=T.filter(D=>D.participantId!==p),Dt({tournamentId:i?.tournamentId,drawDefinition:I,matchUp:b}))}}}}else o.push(p);return!m});e.individualParticipantIds=c;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:o,removed:s};return l.length&&!r&&{...d,cannotRemove:l,error:_M}||d}function MN({participantRole:t=Qr,individualParticipantIds:e=[],groupingTypes:i=[Gn,ts],tournamentRecord:r}){if(!r)return{error:Ie};let n=r.participants??[],{participants:a,mappedMatchUps:s}=Ei({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),o=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=Yse({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:s,participants:a});u&&o++}),o?W:{error:dre}}function rg(t){let e=He(t,[{[gr]:!0},{participantIds:!0,[Jn]:on,[zs]:Jd}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:r,participantIds:n}=t,a=r.participants?.length||0;if(!a)return{...W};let s=(r.events||[])?.filter(({eventType:h})=>h===lr).map(h=>h?.drawDefinitions?.map(({drawId:m})=>m)).flat(1/0),o=Ei({participantFilters:{participantIds:n},tournamentRecord:r,withDraws:!0}).participants??[],l=h=>{let m=(Tr({matchUpFilters:{drawIds:h,matchUpTypes:[Vt]},tournamentRecord:r}).matchUps??[]).flatMap(({sides:g})=>g?.map(({participantId:I})=>I||[])).filter(Boolean);return _i(m,n)},u=s?.length?l(s):[],c=o.filter(h=>h.draws?.filter(m=>(!s?.length||!s?.includes(m.drawId))&&m.positionAssignments).length);if(u?.length||c.length)return{error:Gv};let d={},p={};for(let h of r.events||[]){let m=tT({participantIds:n,event:h});if(m.error)return m;d[h.eventId]=m.participantIdsRemoved}r.participants=(r.participants??[]).filter(h=>{let m=n.includes(h.participantId)||h.participantType===mt&&h.individualParticipantIds?.some(g=>n.includes(g));if(!m&&h.participantType===lr&&h.individualParticipantIds?.some(g=>n.includes(g))&&(h.individualParticipantIds=h.individualParticipantIds.filter(g=>!n.includes(g))),m&&i&&h.participantType&&[mt,$t].includes(h.participantType))for(let g of h.individualParticipantIds||[])n.includes(g)||(p[h.participantId]||(p[h.participantId]=[]),p[h.participantId].push(g));return!m});let f=a-r.participants.length;if(MN({individualParticipantIds:n,tournamentRecord:r}),i)for(let h of r.events||[]){let m=d[h.eventId].map(g=>p[g]||[]).flat();sl({participantIds:m,entryStatus:Es,tournamentRecord:r,event:h})}return f&&at({payload:{participantIds:n,tournamentId:r.tournamentId},topic:_2}),f?{...W,participantsRemovedCount:f}:{error:_M}}function Kse({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){let s=n.entries??[];if(r){let{flightProfile:l}=Vi({event:n}),u=l?.flights?.find(c=>c.drawId===r);u?s=u.drawEntries:e.entries&&(s=e?.entries)}let o=s.filter(l=>(!i?.length||!l.entryStatus||i.includes(l.entryStatus))&&(!a||!l.entryStage||l.entryStage===a)&&(!t||l.entryStatus&&mo.includes(l.entryStatus)));return{entries:s,stageEntries:o}}function Xse({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:s}){let o="destroyGroupEntry";if(!e)return{error:Ie};if(!r)return q({result:{error:pr},stack:o});if(!s)return{error:ci};if(!s.eventType||![Ec,Ca].includes(s.eventType))return q({result:{error:bu},stack:o});let l=e.participants??[],u=l.find(I=>I.participantId===r);if(!u)return q({result:{error:Gi},stack:o});if(!u.participantType||![mt,Gn].includes(u.participantType)||u.participantType===Gn&&s.eventType!==Ca||u.participantType===mt&&s.eventType!==Ec)return{error:Lo};let c=(s.entries??[]).find(I=>I.participantId===r);if(!c)return{error:mre};let{stageEntries:d}=Kse({selected:!1,drawDefinition:i,drawId:n,event:s,stage:a}),p=d.map(wt),f=l.filter(({participantId:I})=>p.includes(I)).map(({individualParticipantIds:I})=>I).flat().filter(Boolean),h=u.individualParticipantIds?.filter(I=>nl(I,f).length===1),m=tT({participantIds:[r],event:s});if(m.error||h?.length&&(m=sl({participantIds:h,entryStatus:Es,entryStage:c.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:s}),m.error))return m;let g;return t&&rg({participantIds:[r],tournamentRecord:e}).success&&(g=!0),{...W,participantRemoved:g}}function SV({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return Xse({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function Jse(t){if(!t.tournamentRecord)return{error:Ie};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let s=Xse({participantId:a,...i});s.success&&(r+=1),s.error&&n.push(s.error)}return r?{destroyedCount:r,...W}:{error:n}}function bw(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:s,drawId:o}=t,l="removeDrawPositionAssignment",u=QU(t);if(u.error)return q({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:f}=t,h=Ct({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([qs,Mu].includes(a)&&c){let{tournamentRecord:g}=t,{participant:I}=ip({tournamentRecord:g,participantId:c}),{participantType:v,individualParticipantIds:w}=I??{};if(n&&v===mt){let y=SV({tournamentRecord:g,drawDefinition:r,participantId:c,event:p});if(y.error)return q({result:y,stack:l});w&&bE({participantIds:w,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}else bE({participantIds:[c],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}if(i){let g=ns({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:f,matchUpsMap:s,event:p});if(g.error)return q({result:g,stack:l})}let{structure:m}=tt({drawDefinition:r,structureId:f});return K2({structure:m,drawPositions:[d]}),FU({appliedPolicies:h,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:f}}),u}function Qse(t){return Object.assign(t,{entryStatus:Mu}),bw(t)}var Id=({finishingPosition:t=zm,hasExistingDrawDefinition:e,qualifyingRoundNumber:i,structureAbbreviation:r,seedAssignments:n=[],stageSequence:a=1,qualifyingOnly:s,structureOrder:o,seedingProfile:l,matchUpFormat:u,structureType:c,structureName:d,matchUps:p=[],matchUpType:f,structureId:h,roundOffset:m,roundLimit:g,stageOrder:I,structures:v,tieFormat:w,stage:y})=>{let b={structureId:h??Et(),structureAbbreviation:r,finishingPosition:t,seedAssignments:n,matchUpFormat:u,stageSequence:a,structureName:d};(s||e&&w)&&(b.tieFormat=w),o&&(b.structureOrder=o),c&&(b.structureType=c),l&&(typeof l=="string"?b.seedingProfile=l:typeof l=="object"&&typeof l.positioning=="string"&&(b.seedingProfile=l.positioning)),f&&(b.matchUpType=f),m&&(b.roundOffset=m),I&&(b.stageOrder=I),g&&(b.roundLimit=g),y&&(b.stage=y),i&&(b.qualifyingRoundNumber=i);let S=p.flatMap(({drawPositions:U})=>U).filter(Boolean);return v?b.structures=v:(b.matchUps=p,b.positionAssignments=lt(S).sort((U,T)=>U-T).map(U=>({drawPosition:U}))),b},cs=Id;function lF(t){return ai(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Zr(t){return ai(t)?lF(t.replace(/_/g," ")):""}function UV({structureName:t=Zr(Mr),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:$e};let a=cs({stage:Mr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),ri({drawDefinition:i,structureIds:[a.structureId]}),{...W}}function I2e({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(or),e.reverse(),e}function v2e({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function y2e({positioning:t,size:e}){let i=I2e({size:e}),r=[],n=[],a=p=>p[0],s=p=>p[p.length-1],o=(p,f)=>(t&&[PU,JM,qp].includes(t)&&f%2?s(p):a(p))||a(p),l=(p,f)=>{if(p.every(h=>!n.includes(h))){let h=o(p,f);return n.push(h),h}},u=p=>{let f=p.filter(h=>!n.includes(h));if(f.length)return n.push(...f),f},c=(p,f)=>{let h=o(p,f);if(!n.includes(h))return n.push(h),h},d=Ce(1,e+1);for(let p of i)if(p===1){let f=Sr(d,2),h=f.map(l).filter(Boolean);h.length&&r.push(h);let m=f.flatMap(u).filter(Boolean);m.length&&r.push(m)}else{let f=Sr(d,p).map(c).filter(Boolean);f.length&&r.push(f)}return{divisions:i,divisionGroupings:r}}function TV({drawPositions:t}){if(!t?.length)return{error:hU};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=lt(i.map(NN)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function NN(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(or).join("|")}function Zse({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,f)=>f),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),s=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,I)=>{n[p].push([a[I],s[I]])});let f=a.shift(),h=a.pop(),m=s.shift();a=[f,m,...a].filter(Boolean),s=[...s,h].filter(Boolean)});let o=a.shift(),l=a.pop(),u=s.shift();a=[o,u,...a].filter(Boolean),s=[...s,l].filter(Boolean);let c=d=>d[0].reduce((p,f)=>p+f);return[...n].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(f=>f<=t)).map(p=>{let f=p.map(h=>h+e);return NN(f)}))}function b2e({rounds:t,hash:e}){return t?.length?t?.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Je}}var w2e={getRoundRobinGroupMatchUps:TV,determineRoundNumber:b2e,drawPositionsHash:NN,groupRounds:Zse};function iT(t){let{hasExistingDrawDefinition:e,groupNameBase:i="Group",playoffAttributes:r,stageSequence:n=1,structureOptions:a,appliedPolicies:s,qualifyingOnly:o,seedingProfile:l,stage:u=ke,matchUpType:c,roundTarget:d,structureId:p,groupNames:f,tieFormat:h,drawSize:m,idPrefix:g,isMock:I,uuids:v}=t,w=t.structureName??r?.["0"]?.name??Zr(ke),{groupCount:y,groupSize:b}=S2e({structureOptions:a,appliedPolicies:s,drawSize:m}),S=Kp,U,T=Ce(1,y+1).map(P=>{let E=U2e({groupSize:b,structureOrder:P,matchUpType:c,drawSize:m,idPrefix:g,isMock:I});U=Array.isArray(E)?Math.max(...E.map(({roundNumber:C})=>C??0)):0;let R=f?.[P-1]??`${i} ${P}`;return Id({structureId:v?.pop(),hasExistingDrawDefinition:e,structureType:QM,finishingPosition:S,qualifyingOnly:o,structureOrder:P,structureName:R,tieFormat:h,matchUps:E})}),D=Id({structureId:p??v?.pop(),hasExistingDrawDefinition:e,structureType:In,finishingPosition:S,seedingProfile:l,structureName:w,stageSequence:n,structures:T,tieFormat:h,stage:u});return d&&It({extension:{name:xl,value:d},element:D}),{structures:[D],maxRoundNumber:U,groupCount:y,links:[],groupSize:b,...W}}function S2e({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e?.groupSize,n=e?.groupSizeLimit||8,{validGroupSizes:a}=rT({groupSizeLimit:n,drawSize:i}),s=a&&Math.max(...a);r&&a?.includes(r)||(r&&r>4||!a?.includes(4)?r=s:r=4);let o=Math.ceil(i/r);return{groupSize:r,groupCount:o}}function rT(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=Ce(3,e+1).filter(n=>{let a=Math.ceil(i/n),s=a*n-i,o=Math.ceil(i/a),l=Math.ceil(s/a);return(!s||s<n)&&o===n&&o>=3&&l<2});return{...W,validGroupSizes:r}}function U2e({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:s}){let o=(t-1)*i,l=Ce(1+o,i+1+o),u=TV({drawPositions:l}).uniqueMatchUpGroupings??[],c=Zse({groupSize:i,drawPositionOffset:o});return u.map(p).sort((f,h)=>(f.roundNumber??1/0)-(h.roundNumber??1/0));function d(f){return c.reduce((h,m,g)=>m.includes(f)?g+1:h,void 0)}function p(f){let h=NN(f),m=d(h),g=[1,r],I=T2e({structureOrder:t,drawPositions:f,roundNumber:m,idPrefix:n,uuids:s}),v={matchUpStatus:m?$i:"BYE",matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:f,roundNumber:m,matchUpId:I};return a&&(v.isMock=!0),v}}function T2e({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:n?.pop()||Et()}function DV(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!ct(i))return{seedBlocks:void 0,...q({result:{error:re},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=$v(i);if(e){let f=Math.min(e,n),h=[],m=1;for(Ce(0,f).forEach(()=>{h.push([m]),m++});m<n;){let g=Ce(m,m+f);m+=f,h.push(g)}return{...W,seedBlocks:h}}let a=Ce(1,n+1),s=[],o=n/2;for(;o>1;){let f=Sr(a,o),h=f.length;f.forEach((m,g)=>{let I,v=g<h/2,w=g%2===0,y=m[0],b=m[m.length-1];r&&h>4?h===8?I=v?b:y:I=w?y:b:I=v?y:b,$n(m,s)||s.push(I)}),o=o/2}let l=a.filter(f=>!s.includes(f));for(;l.length;)l.length%2===0?s.push(l.pop()):s.push(l.shift());let u=Ce(0,20).map(f=>Math.pow(2,f));u.unshift(1);let c=u.indexOf(n),d=0,p=[];return Ce(0,c).forEach(f=>{p.push(s.slice(d,d+u[f])),d+=u[f]}),{...W,seedBlocks:p}}function PV({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!ct(e))return{seedGroups:void 0,...q({result:{error:re},context:{drawSize:e},stack:i})};if(t){if(!ct(t))return{seedGroups:void 0,...q({context:{roundRobinGroupsCount:t},result:{error:re},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:Ce(0,n).map(()=>{let a=Ce(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=DV({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function EV({roundRobinGroupsCount:t,participantsCount:e}){if(t){let{validGroupSizes:n}=rT({drawSize:e});if(!n?.map(a=>Math.ceil(e/a))?.includes(t))return q({context:{roundRobinGroupsCount:t},result:{error:re}})}let{seedGroups:i}=PV({drawSize:e,roundRobinGroupsCount:t}),r=i?.map(n=>Math.min(...n))||[];return{...W,seedingThresholds:r}}function jI(t){if(!t)return 1/0;if(ct(t))return Ke(t);let e=t.split("-")[0];return ct(e)?Ke(e):1/0}function ng({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:s}){let o=[];if(!s)return{error:wf};let{matchUps:l,roundMatchUps:u}=Ot({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:s}),{seedAssignments:c}=ys({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:s}),{positionAssignments:d}=fr({structure:s}),p=d?.length,f=c?.length??0,h=[],m=Object.keys(u).map(A=>Number.parseInt(A)).sort((A,O)=>A-O).map(A=>{let O=u[A].map(F=>F.drawPositions).flat(1/0).filter(Boolean),k=O.filter(F=>!h.includes(F));return h=h.concat(...O),k}).filter(A=>A.length).reverse(),g=m.pop()??[],I=g&&Math.min(...g)-1||0;r=r??i?.seeding?.seedingProfile;let v=g?.length||0,w=m.filter(A=>A.filter(O=>O<=f).length),{stage:y,structureType:b,roundLimit:S}=s,U=b===In,T=!U&&m?.length,D=!U&&y===ze&&S,P=w.flat(1/0),E=T?P?.length:0,R=a?p:f,C=iV({drawDefinition:n,structure:s,matchUps:l}),M=C?0:!T&&R||R&&P.length<R&&R-P.length||0;if(D){let A=s?.matchUps?s.matchUps.filter(({roundNumber:k})=>k===s.roundLimit).length:0,O=g.length/A;if(!T){let k=nT(r),F=Sr(g,O),x=1,L=Ce(0,F[0].length).map(()=>{let $=Ce(x,x+F.length);return x+=F.length,$});({validSeedBlocks:o}=eoe({drawPositionBlocks:F,nonRandom:r?.nonRandom,positioning:k,seedGroups:L}))}}else U?{validSeedBlocks:o}=D2e({nonRandom:r?.nonRandom,seedingProfile:r,structure:s}):T?o=w.map(A=>({seedNumbers:A,drawPositions:A})):C&&Sr(g,2).map((A,O)=>({drawPositions:[A[0]],seedNumbers:[O+1]})).forEach(A=>o.push(A));if(!U&&!C&&!D){let{blocks:A}=P2e({drawPositionOffset:I,seedNumberOffset:E,seedCountGoal:M,seedingProfile:r,baseDrawSize:v});A.forEach(O=>o.push(O))}let N=o.flatMap(A=>A.drawPositions).reduce((A,O)=>g?.includes(O)&&A,!0);return!C&&!T&&!U&&!N?{error:Lie,validSeedBlocks:[],isContainer:U,isFeedIn:T}:{isLuckyStructure:C,validSeedBlocks:o,isContainer:U,isFeedIn:T}}function D2e({seedingProfile:t,structure:e,nonRandom:i}){let r=e.structures||[],n=r.length,a=Xt({structure:e})?.positionAssignments,s=nT(t),o=a?.length??0,{seedGroups:l}=PV({roundRobinGroupsCount:n,drawSize:o}),u=r.map(c=>Xt({structure:c}).positionAssignments?.map(d=>d.drawPosition));return eoe({drawPositionBlocks:u,positioning:s,seedGroups:l,nonRandom:i})}function eoe({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=y2e({size:i.length,positioning:e}),s=[];return i.forEach((o,l)=>{let u=v2e({blockPattern:a,index:l});o.forEach((c,d)=>{let p=l%2?t.length-d-1:d,f=t[p].slice().filter((m,g)=>u.includes(g+1)&&m);e!==qp?f=r?f:An(f):l%2&&f.reverse();let h=f.find(m=>!s.includes(m));h&&(s.push(h),n.push({drawPositions:[h],seedNumbers:[c]}))})}),{validSeedBlocks:n}}function P2e(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:s}=t,o,l=[],{seedBlocks:u}=DV({cluster:[PU,JM].includes(nT(n)),participantsCount:s,roundRobinGroupsCount:i});o=0;for(let c of u){if(o+1>a)break;let d=c.map(f=>f+e),p=E2e(o+1,c.length).map(f=>+f+r);o+=c.length,l.push({drawPositions:d,seedNumbers:p})}return{blocks:l}}function E2e(t,e){return Array.from(new Array(e),(i,r)=>r+t)}function SE({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){let{structure:s}=tt({drawDefinition:e,structureId:n});t??=Ct({drawDefinition:e}).appliedPolicies;let o=i?.validSeedBlocks;return!o&&s&&(o=ng({appliedPolicies:t,drawDefinition:e,structure:s})?.validSeedBlocks),t?.seeding?.validSeedPositions?.ignore?!0:t?.seeding?.validSeedPositions?.strict?(o.find(l=>l.seedNumbers.includes(a))?.drawPositions||[]).includes(r):o.flatMap(l=>l.drawPositions).includes(r)}function toe(t){let{provisionalPositioning:e,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:s}=t,{structure:o}=tt({drawDefinition:i,structureId:a}),{seedAssignments:l}=ys({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:o}),{positionAssignments:u}=fr({structure:o}),c=u?.filter(R=>R.participantId??R.bye??R.qualifier)?.map(R=>R.drawPosition).filter(Boolean),{appliedPolicies:d}=Ct({drawDefinition:i}),p=(n?.validSeedBlocks||o&&ng({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:r,structure:o})?.validSeedBlocks||[]).find(R=>R.drawPositions.filter(C=>!c?.includes(C)).length),f=l?.map(R=>R.participantId).filter(Boolean),h=u?.map(R=>R.participantId).filter(Boolean),m=f?.filter(R=>h?.includes(R)),g=f?.filter(R=>!h?.includes(R)),I=l?.filter(R=>g?.includes(R.participantId)),v=l?.filter(R=>!R.participantId),w=(I?.length&&I.length>0?I.length:v?.length??0)&&p?.drawPositions.filter(R=>!c?.includes(R))||[],y=s?An(w):w,b=[],S=y.map(()=>{let R=E(I,b)?.participantId;return R&&b.push(R),R}).filter(Boolean),U=l?.filter(R=>m?.includes(R.participantId)).map(R=>R.seedNumber),T=(p?.seedNumbers||[]).filter(R=>!U?.includes(R)),D=l?.filter(R=>T.includes(R.seedNumber)).map(R=>R.participantId),P=d?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:typeof P!="boolean"||P?S:D,unplacedSeedNumbers:T,unfilledPositions:y,unplacedSeedAssignments:I};function E(R,C){let M=R.filter(O=>!C.includes(O.participantId)),N=Math.min(...M.map(O=>jI(O.seedValue))),A=M.filter(O=>jI(O.seedValue)===N);return An(A).pop()}}function nT(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function ay({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:s,seedNumber:o,seedValue:l,eventId:u,event:c}){let d="assignSeed",{structure:p}=tt({drawDefinition:i,structureId:s}),{positionAssignments:f}=fr({structure:p}),h=ys({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,m=h.map(b=>b.seedNumber),g=Uh({drawDefinition:i,participantId:n});if(n&&!g)return q({result:{error:Fo},context:{participantId:n},stack:d});let I=c?Vi({event:c}).flightProfile?.flights?.length:0,v=I&&I>1,w=f?.find(b=>b.participantId===n)?.drawPosition;if(w&&!SE({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:s,seedNumber:o}))return q({result:{error:NB},context:{assignedDrawPosition:w},info:"invalid seed position",stack:d});m.includes(o)||h.push({seedNumber:o,seedValue:l});let y;return h.forEach(b=>{b.participantId===n&&b.seedNumber!==o&&(b.participantId=void 0),b.seedNumber===o&&(b.participantId=n,!r?.groupSeedingThreshold&&!v&&(b.seedValue=l??o),y=!0)}),y?(_ae({tournamentId:e?.tournamentId,drawDefinition:i,structure:p,eventId:u}),{...W}):q({result:{error:Fie},stack:d})}function RV({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:s}){let o=t?.sides?.[e]?.sideNumber,l=o&&a.sides?.find(p=>p.sideNumber===o),{extension:u}=rt({element:n,name:Cc}),c=u?.value||{},d=xe(c[i],!1,!0);if(l)a?.sides?.forEach(p=>{p.sideNumber===o&&(p.lineUp=d)});else{a.sides=[1,2].map(f=>({...a.sides?.find(h=>h.sideNumber===f)??{},sideNumber:f}));let p=a.sides.find(f=>f.sideNumber===o);p&&(p.lineUp=d)}Dt({tournamentId:r?.tournamentId,context:"updateSidLineUp",eventId:s?.eventId,drawDefinition:n,matchUp:a})}function ioe(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,s=i.roundNumber>1&&i.roundNumber-1,o=Ad({structureId:r.structureId,matchUpsMap:n});Wt({method:"getPairedPreviousMatchUpIsDoubleExit",color:"brightcyan",keyColors:{structureId:"brightyellow",sourceMatchUpId:"brightmagenta"},structureId:r.structureId?.slice(0,8),targetMatchUpId:i.matchUpId,targetRound:[i.roundNumber,i.roundPosition],previousRoundNumber:s,sourceMatchUpId:e?.matchUpId,sourceStructureId:e?.structureId?.slice(0,8),sourceRound:e?[e.roundNumber,e.roundPosition]:void 0,drawPosition:a,structureMatchUpCount:o?.length}),e&&e.structureId!==r.structureId&&a?(Wt({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"cross_structure_sourceMatchUp_resolving_in_target",originalSourceId:e?.matchUpId,originalSourceStructure:e?.structureId?.slice(0,8),targetStructure:r.structureId?.slice(0,8)}),e=o.find(({drawPositions:h,roundNumber:m})=>m===s&&h?.includes(a)),Wt({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"resolved_cross_structure_sourceMatchUp",resolvedMatchUpId:e?.matchUpId,resolvedRound:e?[e.roundNumber,e.roundPosition]:void 0,resolvedStatus:e?.matchUpStatus})):!e&&a&&(e=o.find(({drawPositions:h,roundNumber:m})=>m===s&&h?.includes(a)),Wt({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"resolved_sourceMatchUp_from_drawPosition",resolvedMatchUpId:e?.matchUpId,resolvedRound:e?[e.roundNumber,e.roundPosition]:void 0,resolvedStatus:e?.matchUpStatus}));let l=e?.roundPosition,u=l%2?1:-1,c=l+u,d=s&&o.find(({roundNumber:h,roundPosition:m})=>h===s&&m===c),p=d?.matchUpStatus,f=[Ui,zi].includes(p);return Wt({method:"getPairedPreviousMatchUpIsDoubleExit",color:f?"brightred":"brightgreen",keyColors:{pairedMatchUpId:"brightcyan",isDoubleExit:f?"brightred":"brightgreen"},sourceRoundPosition:l,offset:u,pairedRoundPosition:c,pairedMatchUpId:d?.matchUpId,pairedRound:d?[d.roundNumber,d.roundPosition]:void 0,pairedStatus:p,isDoubleExit:f}),{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:f}}function R2e({drawPosition:t,drawPositions:e}){let i=!1,r=!!e?.includes(t);return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(or).filter(Boolean),positionAdded:i,positionAssigned:r}}function roe({structureId:t,matchUpsMap:e,matchUp:i}){let r=i?.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:Ad({matchUpsMap:e,structureId:t}).find(({roundNumber:s,roundPosition:o})=>s===i?.roundNumber&&o===a)}}function noe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(o=>o.matchUpId===i),{pairedPreviousMatchUp:s}=roe({structureId:a?.structureId,matchUp:a,matchUpsMap:r});if(a&&s){let o=s?.matchUpId,l=t.find(c=>c.matchUpId===o),u=a?.structureId===l?.structureId?a?.roundPosition<l?.roundPosition&&1||2:a.structureId===l?.structureId&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(c=>{let d=ai(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function _D({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,s)=>a.drawPositions?.includes(e)?s+1:n,void 0)}function Th({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:s,matchUpsMap:o,matchUpId:l,event:u}){let c="assignMatchUpDrawPosition";o||(o=xr({drawDefinition:n})),t||(t=nr({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[]);let d=t.find(C=>C.matchUpId===l),p=d?.structureId,f=n?.structures?.find(C=>C.structureId===p);if(!f)return{error:yi};let h=o?.drawMatchUps?.find(C=>C.matchUpId===l),m=h?.drawPositions??[],{positionAdded:g,positionAssigned:I,updatedDrawPositions:v}=R2e({drawPositions:m,drawPosition:s}),{positionAssignments:w}=Xt({drawDefinition:n,structure:f}),y=w?.filter(C=>v.includes(C.drawPosition))?.find(({bye:C})=>C),b=h?.matchUpStatus&&Br(h.matchUpStatus)&&v.filter(Boolean).length<2;a=y&&"BYE"||a||b&&h.matchUpStatus||h?.matchUpStatus&&[Ui,zi].includes(h.matchUpStatus)&&h.matchUpStatus||$i;let S=!!(Br(h?.matchUpStatus)&&h?.winningSide);if(h&&g){t=nr({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[];let C=b&&_D({inContextDrawMatchUps:t,drawPosition:s,matchUpId:l})||S&&h.winningSide||void 0;h?.matchUpStatusCodes&&noe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:o,matchUp:h}),Object.assign(h,{drawPositions:v,winningSide:C,matchUpStatus:S?h?.matchUpStatus:a}),Dt({tournamentId:i?.tournamentId,eventId:d?.eventId,context:c,drawDefinition:n,matchUp:h})}let U=Bn({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:T,loserMatchUp:D,loserTargetDrawPosition:P},targetLinks:{loserTargetLink:E}}=U,R=Ad({structureId:f.structureId,matchUpsMap:o});if(I&&y){if(T)if(["BYE",Ui,zi].includes(a)){let C=Th({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(C.error)return C}else{let{structureId:C}=T;C!==f.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(I&&S){if(T){let C=Th({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(C.error)return C}}else if(T&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:C}=ioe({targetMatchUp:h,drawPosition:s,matchUpsMap:o,structure:f});if(C){let M=Th({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(M.error)return M}}if(h?.matchUpType===ti){let C=t?.find(({matchUpId:A})=>A===h.matchUpId),M=(C?.sides??[]).reduce((A,O,k)=>O.drawPosition===s?k:A,void 0),N=w?.find(A=>A.drawPosition===s)?.participantId;N&&M!==void 0&&RV({inContextTargetMatchUp:C,drawPositionSideIndex:M,teamParticipantId:N,tournamentRecord:i,drawDefinition:n,matchUp:h})}if(E?.linkCondition===wl&&v.filter(Boolean).length===2&&!y&&R.filter(({drawPositions:C,roundNumber:M})=>M===1&&$n(C,v)).every(({matchUpStatus:C})=>[xi,Ur].includes(C))&&D){let{structureId:C}=D,M=ns({drawPosition:P,tournamentRecord:i,drawDefinition:n,structureId:C,matchUpsMap:o,event:u});if(M.error)return M}return I?{...W}:q({result:{error:RI},context:{drawPosition:s},stack:c})}function aoe({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){let a=Qv({drawDefinition:e})?.containedStructures?.[n.structureId]?.map(({structureId:c})=>c)||[];a.push(n?.structureId);let s=i?.map(({drawPosition:c})=>c)||[],o=t?.filter(c=>a.includes(c.structureId)&&_i(c.drawPositions??[],s).length)??[],l=o.map(({matchUpId:c})=>c),u=r?.drawMatchUps?.filter(c=>l.includes(c.matchUpId))??[];return{drawPositions:s,matchUps:u,targetMatchUps:o}}function CV({lineUp:t}){if(!Array.isArray(t))return;let e={};return lt(t.flatMap(({collectionAssignments:i})=>i?.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:s}=yE({collectionPosition:a,collectionId:r,lineUp:t});s.forEach(o=>{e[o]||(e[o]=[]),e[o].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Zp(t){return`${t} must be an array`}function AN({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Zp("lineUp")),{valid:!1,errors:i,error:re};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:s,collectionAssignments:o}=a;return s?typeof s!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(o)?o.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Zp("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=lt(t.map(wt)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?re:void 0}}function ag({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:$e};if(typeof e!="string")return{error:pr};let n=AN({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=rt({element:t,name:Cc}),s=a?.value||{};return s[e]=CV({lineUp:r}),It({element:t,extension:{name:Cc,value:s}}),xU({drawDefinition:t}),{...W}}function MV({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:s,event:o}){if(!r)return{error:$e};let{drawPositions:l,matchUps:u,targetMatchUps:c}=aoe({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:s});for(let d of c)d.matchUpType===Wa&&(d.sides??[]).forEach((p,f)=>{if(p?.drawPosition&&l?.includes(p.drawPosition)){let h=u.find(({matchUpId:m})=>m===d.matchUpId);if(h?.sides?.[f]){if(delete h.sides[f].lineUp,e===!1){let m=d.tieFormat,g=p.participantId;m&&g&&ag({drawDefinition:r,participantId:g,lineUp:[],tieFormat:m})}Dt({tournamentId:i?.tournamentId,context:"resetLineUps",eventId:o?.eventId,drawDefinition:r,matchUp:h})}}});return{...W}}function Ul({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:o,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){let f="assignDrawPosition";if(!o&&!i)return q({result:{error:pr},stack:f});c=c??xr({drawDefinition:a}),e||({matchUps:e}=nr({inContext:!0,drawDefinition:a,matchUpsMap:c}));let h=tt({drawDefinition:a,structureId:d});if(h.error)return q({result:h,stack:f});let{structure:m}=h;if(!m)return{error:yi};if(Yn({structure:m}))return q({result:{error:fa},stack:f});let{seedAssignments:g}=ys({provisionalPositioning:t,drawDefinition:a,structure:m}),I=g?.find(D=>D.participantId===o)?.seedNumber,{appliedPolicies:v}=Ct({tournamentRecord:n,drawDefinition:a,structure:m,event:p});if(I&&!SE({seedNumber:I,appliedPolicies:v,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return q({result:{error:NB},context:{drawPosition:u},stack:f});let w=fr({structure:m}).positionAssignments||[],y=w?.find(D=>D.drawPosition===u);if(!y)return q({result:{error:_m},context:{drawPosition:u},stack:f});if(w?.map(wt).includes(o))return q({result:{error:Gv},context:{drawPosition:u},stack:f});let{containsParticipant:b,containsBye:S}=pV(y);if(S){let D=QU({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(D.error)return q({result:D,stack:f})}if(b&&y.participantId!==o){let{activeDrawPositions:D}=ty({drawDefinition:a,structureId:d});if(D.includes(u))return q({result:{error:mU},stack:f});MV({assignments:[y],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:m})}if(y.participantId=o,i&&(y.qualifier=!0),m.stage===ke&&(!m.stageSequence||m.stageSequence>1)||m.stage&&[rn,ki].includes(m.stage)){let D=m.stage===ze?ze:ke,P=(a.structures?.find(E=>E?.stage===D&&E?.stageSequence===1)?.seedAssignments??[]).find(E=>E.participantId===o);if(P?.participantId){let{participantId:E,seedNumber:R,seedValue:C}=P;ay({eventId:p?.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:E,seedNumber:R,seedValue:C,structureId:d,event:p})}}if(m.structureType===In){wse({positionAssignments:w,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:m});let{drawPositions:D,matchUps:P,targetMatchUps:E}=aoe({assignments:[y],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:m});if(D&&P?.length===1&&P[0].matchUpType===ti){let R=(E?.[0].sides??[]).reduce((C,M,N)=>D?.includes(M.drawPosition)?N:C,void 0);RV({inContextTargetMatchUp:E[0],teamParticipantId:o,matchUp:P[0],drawPositionSideIndex:R,tournamentRecord:n,drawDefinition:a})}}else C2e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:m,event:p});let U=a.entries?.find(D=>D.participantId===o),T=p?.entries?.find(D=>D.participantId===o);return!U&&T&&IV({entryStatus:T.entryStatus,entryStage:m.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:o,event:p}),Ac({tournamentId:n?.tournamentId,drawDefinition:a,structure:m,event:p}),{positionAssignments:w,...W}}function C2e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=Ot({provisionalPositioning:t,matchUpFilters:u,drawDefinition:n,matchUpsMap:s,structure:o,event:l}),{roundMatchUps:d}=Un({matchUps:c}),{initialRoundNumber:p}=Zh({drawPosition:a,matchUps:c}),f=p&&d?.[p].find(h=>h.drawPositions?.includes(a));if(f){let h=Th({matchUpId:f.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s});if(h.error)return q({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:h})}return{...W}}function NV(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:$e};let d=Ct({tournamentRecord:n,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:f}=t;f||(f=xr({drawDefinition:a}),Object.assign(t,{matchUpsMap:f})),p||({matchUps:p}=nr({inContext:!0,drawDefinition:a,matchUpsMap:f}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:h}=Xt({drawDefinition:a,structureId:l}),m=h?.find(y=>y.drawPosition===o);if(m?.participantId){let y=m.participantId,b=Ul({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:u});return b.success?w({appliedPolicies:d,removedParticipantId:y}):q({result:b,stack:c})}let g=QU({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:o,structureId:l,matchUpsMap:f,event:u});if(g.error)return q({result:g,stack:c});let I=g.participantId,v=Ul({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:u});if(!v.success)return q({result:v,stack:c});return w({appliedPolicies:d,removedParticipantId:I});function w({appliedPolicies:y,removedParticipantId:b}){let{structure:S}=tt({drawDefinition:a,structureId:l});K2({drawPositions:[o],structure:S});let U={[e]:s,name:r,drawPosition:o,structureId:l};return FU({appliedPolicies:y,drawDefinition:a,positionAction:U}),q({context:{removedParticipantId:b},result:{...W},stack:c})}}function M2e({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return NV({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function soe(t){return M2e(t)}function ooe({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let s of i.matchUps)e[s.matchUpId]&&(s.roundNumber=e[s.matchUpId],Dt({tournamentId:r?.tournamentId,eventId:a?.eventId,drawDefinition:n,matchUp:s}))}function loe(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=He(t,i);if(r.error)return r;let n=tt(t);if(n.error)return n;let a=n.structure;if(!Yn({structure:a}))return q({result:{error:bf,message:"structure must be adHoc"}});let{roundMatchUps:s=[],roundNumbers:o}=Un({matchUps:a?.matchUps});return o?.length?{valid:!0,structure:a,roundMatchUps:s,roundNumbers:o}:{error:Bu}}function uoe(t){let e=loe(t,[{targetRoundNumber:!0,roundNumber:!0,[Jn]:N_e}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e,{targetRoundNumber:a,roundNumber:s}=t;if(!n?.includes(s)||!n?.includes(a))return q({result:{error:re},info:"roundNumbers must be valid rounds"});let o=a>s,l=o?Ce(s+1,a+1):Ce(a,s),u={};return l.forEach(c=>(r?.[c]??[]).forEach(({matchUpId:d})=>{u[d]=c-(o?1:-1)})),r?.[s]?.forEach(({matchUpId:c})=>u[c]=a),ooe({params:t,modMap:u,structure:i}),{...W}}function coe({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){if(!r)return{error:$e};if(!Array.isArray(t))return{error:re};let a="setPositionAssignments";for(let o of t){let{structureId:l,positionAssignments:u}=o;if(!u)continue;let c=tt({drawDefinition:r,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:yi};let p=Xt({structure:d}).positionAssignments?.map(({drawPosition:g})=>g),f=u?.map(({drawPosition:g})=>g);if(_i(p,f).length!==p?.length)return q({result:{error:re},info:"drawPositions do not match",stack:a});let h=xr({drawDefinition:r}),{matchUps:m}=nr({inContext:!0,drawDefinition:r,matchUpsMap:h});for(let g of u||[]){let{drawPosition:I,participantId:v,bye:w,qualifier:y}=g;if(w){let b=ns({tournamentRecord:i,drawDefinition:r,drawPosition:I,matchUpsMap:h,structureId:l,structure:d,event:n});if(b?.error)return b}else if(y)u.forEach(b=>{b.drawPosition===I&&(b.qualifier=!0,delete b.participantId,delete b.bye)});else if(v){let b=Ul({provisionalPositioning:e,inContextDrawMatchUps:m,tournamentRecord:i,drawDefinition:r,participantId:v,drawPosition:I,matchUpsMap:h,structureId:l,event:n});if(b?.error)return b}}Ac({tournamentId:i?.tournamentId,drawDefinition:r,structure:d,event:n})}let s=t.map(({structureId:o})=>o);return ri({tournamentId:i?.tournamentId,eventId:n?.eventId,drawDefinition:r,structureIds:s}),{...W}}function doe(t){let e=loe(t,[{roundNumbers:!0,[Jn]:on,[Yr]:s=>s.length===2&&s.every(Ni)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(s=>n?.includes(s)))return q({result:{error:re,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((s,o)=>(r?.[s]??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-o]})),ooe({params:t,modMap:a,structure:i}),{...W}}function poe({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return NV({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function foe({drawDefinition:t,structureId:e}){if(!t)return{error:$e};let{structure:i}=tt({drawDefinition:t,structureId:e}),r=(t?.links||[]).filter(n=>n.source?.structureId===e).map(n=>n.target?.structureId);return{playoffStructures:(t?.structures||[]).filter(n=>r.includes(n.structureId)),structure:i}}function kN({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:s}){if(!a)return{error:ci};let o={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=so({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:r,stages:n,stage:s});if(l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function AV({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:s}){if(!e)return{error:Ie};let o={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=kN({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:u,stage:s});if(c&&l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function Au(t){if(!t?.drawDefinition)return!1;let e=EN(t),i=e?.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r?.filter(({matchUpType:s})=>s===ti),n=n?.filter(({matchUpType:s})=>s===ti),a=a?.filter(({matchUpType:s})=>s===ti)),!!(r?.length&&!n?.length&&!a?.length)}function kV(t){let{drawDefinition:e,structureId:i}=t;if(!e)return{error:$e};let{playoffStructures:r}=foe({drawDefinition:e,structureId:i});if(!r?.length)return!1;let n=e?.entries?.filter(s=>s?.entryStatus&&mo.includes(s.entryStatus))?.length??0,a=0;return(r||[]).reduce((s,o)=>!!((Xt({structure:o}).positionAssignments??[])?.filter(l=>(l.participantId&&a++,l?.bye??l?.participantId)).length&&s),!!r.length)||a===n}function uF({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i?.[n]){let s=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(o=>{let l=uF({accessors:s,significantCharacters:t,value:o});r.push(...l)});else if(i=i[n],s.length){let o=uF({accessors:s,significantCharacters:t,value:i});r.push(...o)}else a({value:i})}function a({value:s}){if(s&&["string","number"].includes(typeof s)){let o=t?s.slice(0,t):s;r.push(o)}}return r}function N2e({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:$B};if(!Array.isArray(r))return{error:yU};let n={};return t.forEach(a=>{let s=r.find(l=>l.participantId===a),{values:o}=hoe({policyAttributes:e,idCollections:i,participants:r,participant:s});o&&o.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function hoe({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:$B};if(!r)return{error:Vm};let n=[];return t.forEach(a=>{let{directive:s,groupings:o,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");n.push(...uF({significantCharacters:u,value:r,accessors:c}))}else if(s){let c=a?.includeIds,d=(e?.[s]||[]).filter(p=>!c||c.includes(p));d?.length&&i?.length&&d.forEach(p=>{let f=i.find(h=>h.participantId===p);if(f?.individualParticipantIds?.includes(r.participantId)){let h=f?.participantId;n.push(h)}})}else o&&Object.keys(o).forEach(c=>{o[c].includes(r.participantId)&&n.push(c)})}),{values:lt(n)}}function s3({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let s=n[a.participantId],{values:o}=hoe({participants:e,policyAttributes:i,idCollections:r,participant:s});return{...a,values:o}})}function moe({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r?.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,s=t?t[a]||[]:[],o=!!i.some(l=>s.includes(l));return{[n]:{participantGroups:s,includesGroupsToAvoid:o}}}))}function A2e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=moe(t);return i.map(a=>{let s=e.filter(u=>a.includes(u)),o=n(s),l=s.filter(u=>!o.includes(u)).filter(u=>{let c=o3(u);return!r[c]?.includesGroupsToAvoid});return{unassigned:s,unpaired:o,pairedNoConflict:l}});function n(a){return a.filter(o=>!s(o));function s(o){let l=o3(o);return!a.includes(l)}}}function k2e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=moe(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),s=a.length===n.length?a:[],o=n.filter(l=>r[l]?.includesGroupsToAvoid).length;return{unassigned:a,unpaired:s,pairedNoConflict:o?[]:a,conflictsCount:o}})}function o3(t){return Number(t%2?t+1:t-1)}function O2e({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function x2e({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let s=r.map(o=>a?k2e({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):A2e({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:o,unpaired:l,pairedNoConflict:u}}else{let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length);return{unassigned:o,unpaired:l,pairedNoConflict:u}}}function goe({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function F2e({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){let a=Object.assign({},...Object.keys(r).map(u=>[u,r[u].filter(c=>e.includes(c))]).filter(u=>u[1].length).map(([u,c])=>({[u]:c}))),s=Object.keys(a).reduce((u,c)=>a[c].length>u?a[c].length:u,0),o=Object.keys(a).filter(u=>a[u].length===s),l=xs(i?o:Object.keys(a));return n=t&&a[n]?.length?n:l,{participantId:n&&a[n]?xs(a[n]):xs(e),groupKey:n}}function L2e({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function _2e({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:s,groupKey:o}){let l=n.reduce((T,D)=>D.length>T?D.length:T,0)<=2,u=goe({positionAssignments:t,participantIds:e}),c=L2e({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=F2e({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:s,groupKey:o}),f=O2e({participantId:d,allGroups:s}),h=x2e({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:f,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:c}),{unassigned:m,unpaired:g,pairedNoConflict:I}=h,v=I?.length&&I[0],w=g?.length&&g[0],y=a&&v?v:w,b=a?w:v,S=y?.length&&y||b?.length&&b,U;if(S?.length){let T=wa(S);U=wa(T)}else{let T=wa(m[0]);U=wa(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:U}}function cF({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(o=>o.drawPosition),a=TV({drawPositions:n}).uniqueMatchUpGroupings??[],s=Object.assign({},...r.map(o=>({[o.drawPosition]:o})));a.forEach(o=>{$n(s[o[0]].values||[],s[o[1]].values||[])&&(i.push(o),r.conflict=!0)})}):e.forEach(r=>{$n(r[0]?.values||[],r[1]?.values||[])&&(i.push(r),r.conflict=!0)}),i}function $2e(t,e){let i=t.find(r=>r.includes(e));if(i)return i.find(r=>r!==e)}function l3(t,e){return t.find(i=>i.drawPosition===e)}function B2e({moveableParticipant:t,possibleDrawPosition:e,positionedParticipants:i,drawPositionGroups:r,isRoundRobin:n,getAvoidanceConflicts:a}){let s=$2e(r,e),o=l3(i,s),l=a({isRoundRobin:n,groupedParticipants:[[t,o]]}),u=[l3(i,e),o],c=a({isRoundRobin:n,groupedParticipants:[u]});return!l.length&&!c.length}function V2e({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.flatMap(a=>{let s=a.map(o=>o.drawPosition);return a.filter(o=>e.includes(o.drawPosition)).map(o=>{let l=e.filter(u=>!s?.includes(u)).filter(u=>B2e({moveableParticipant:o,possibleDrawPosition:u,positionedParticipants:t,drawPositionGroups:i,isRoundRobin:n,getAvoidanceConflicts:cF}));if(l.length)return{drawPosition:o.drawPosition,possibleDrawPositions:l}}).filter(Boolean)})}function u3(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:s,idCollections:o,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(w=>w?.length).filter(Boolean)),p=d>2,f=xe(e,!1,!0).filter(w=>!w.qualifier),h=e.filter(w=>!w.participantId&&(!w.bye||n?.includes(w.drawPosition))).map(w=>w.drawPosition);Ce(0,r).forEach(()=>{let{newGroupKey:w,selectedParticipantId:y,targetDrawPosition:b}=_2e({...t,candidatePositionAssignments:f,allGroups:l,groupKey:c});c=w,f.forEach(S=>{S.drawPosition===b&&(S.participantId=y)})});let m=s3({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=Sr(m,d),I=cF({groupedParticipants:g,isRoundRobin:p}),v=0;for(;v<20&&I.length;){let w=V2e({positionedParticipants:m,potentialDrawPositions:h,avoidanceConflicts:I,drawPositionGroups:a,isRoundRobin:p});if(w.length){let y=j2e({candidatePositionAssignments:f,swapOptions:w});y.error&&console.log({result:y}),m=s3({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=Sr(m,d),I=cF({groupedParticipants:g,isRoundRobin:p}),v++}else v=20}return f.forEach(w=>{if(w.bye&&w.participantId){let y=$x;u.push(y)}if(w.qualifier&&w.participantId){let y=$x;u.push(y)}}),{positionAssignments:f,conflicts:I.length,groupedParticipants:g,errors:u}}function j2e({candidatePositionAssignments:t,swapOptions:e}){let i=wa(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=wa(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===r),s=t.find(u=>u.drawPosition===n)??{},o={participantId:s?.participantId,qualifier:s?.qualifier,bye:s?.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,o),Object.assign(s,l),{...W}}function G2e({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){if(!c)return{error:Xie};let{candidatesCount:f=1,policyAttributes:h,targetDivisions:m}=c,{roundsToSeparate:g}=c,I="randomUnseededSeparation",{structure:v}=tt({drawDefinition:a,structureId:u}),{matchUps:w}=Ot({provisionalPositioning:t,matchUpsMap:l,structure:v,event:p});if(m&&xo(m)&&!g){let L=ELe(m)||0,$=w.reduce((V,_)=>_.roundNumber>V?_.roundNumber:V,0);g=$<L?1:$-L+1}let{positionAssignments:y}=fr({structure:v}),b=IN({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:o}).participantsWithGroupings,S=y?.filter(L=>!L.participantId),U=y?.map(L=>L.drawPosition),T=v?.structureType===In,D=T?{structure:v,matchUps:w,allDrawPositions:U,roundsToSeparate:g}:{matchUps:w,allDrawPositions:U,roundsToSeparate:g},{drawPositionGroups:P,drawPositionChunks:E}=T?H2e(D):W2e(D),R={groupParticipants:o.filter(L=>L.participantType===ts).map(L=>L.participantId),teamParticipants:o.filter(L=>L.participantType===$t).map(L=>L.participantId),pairParticipants:o.filter(L=>L.participantType===mt).map(L=>L.participantId)},C=N2e({targetParticipantIds:e,policyAttributes:h,idCollections:R,participants:o});if(C.error)return q({result:C,stack:I});let M=Object.assign({},...e.map(L=>{let $=Object.keys(C).filter(V=>(C[V]??[]).includes(L));return{[L]:$}})),N=goe({participantIds:e,positionAssignments:y});if(N.length>(S?.length||0))return{error:HB};let A,O=N.length,k=Ce(0,f).map(()=>u3({initialPositionAssignments:y,participantsWithGroupings:b,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:P,policyAttributes:h,idCollections:R,allGroups:C,drawSize:d}));if(A=k.reduce((L,$)=>!L||($.conflicts||0)<(L.conflicts||0)?$:L,void 0),!A||A.conflicts){let L=Ce(0,f).map(()=>u3({initialPositionAssignments:y,participantsWithGroupings:b,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:P,policyAttributes:h,idCollections:R,allGroups:C,drawSize:d}));A=k.concat(...L).filter($=>!$.errors?.length).reduce(($,V)=>!$||(V.conflicts||0)<($.conflicts||0)?V:$,void 0)}if(!A)return{error:jM};let F=(Xt({structure:v})?.positionAssignments??[]).filter(L=>L.participantId).map(L=>L.participantId),x=A.positionAssignments.filter(L=>!F.includes(L.participantId));for(let L of x)if(L.bye){let $=ns({tournamentRecord:n,drawDefinition:a,structureId:u,matchUpsMap:l,event:p,...L});if($.error)return q({result:$,stack:I})}else if(L.participantId){let $=Ul({inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,event:p,...L});if($.error)return q({result:$,stack:I,context:{assignment:L}})}return{...W}}function H2e(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function W2e({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),n=r.flat().sort(or),a=Math.max(...n),s=t.filter(c=>c>a),o=n.length,l=Ce(o===2?1:2,o).filter(c=>c===CB(c)),u=l.slice(0,e||l.length).reverse().map(c=>Sr(n,c));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:r,drawPositionChunks:u}}function z2e({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){let f="positionUnseededParticipants";c||({structure:c}=tt({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:h}=fr({structure:c}),{seedAssignments:m}=ys({provisionalPositioning:t,drawDefinition:a,structure:c}),g=m?.map(D=>D.participantId).filter(Boolean),{stage:I,stageSequence:v}=c,w=I===ze?rt({element:c,name:xl})?.extension?.value:void 0,y=Km({provisionalPositioning:t,drawDefinition:a,stageSequence:v,entryStatuses:Cf,structureId:u,roundTarget:w,stage:I}),b=y.filter(D=>!g?.includes(D.participantId)).map(D=>D.participantId),S=h?.filter(D=>!D.participantId&&!D.bye&&!D.qualifier).map(D=>D.drawPosition);if(!r&&b.length>(S?.length||0))return q({result:{error:HB},context:{unseededParticipantsCount:b.length,unfilledDrawPositionsCount:S?.length},stack:f});let{appliedPolicies:U}=Ct({tournamentRecord:n,drawDefinition:a,event:p}),T=U?.[mw];if(c.stage===ki){let D=y.reduce((P,E)=>(P[E.groupingValue]||(P[E.groupingValue]=[]),P[E.groupingValue].push(E.participantId),P),{});Object.keys(D).length&&(T||(T={policyName:"Playoff Avoidance"}),T.policyAttributes||(T.policyAttributes=[]),T.policyAttributes.push({groupings:D}))}return T&&o?G2e({provisionalPositioning:t,unseededParticipantIds:b,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:T,drawSize:d}):q2e({provisionalPositioning:t,unseededParticipantIds:b,inContextDrawMatchUps:e,unfilledDrawPositions:S,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function q2e({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?An(r):r.reverse();for(let f of e){let h=p.pop();if(!n||h){let m=Ul({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,participantId:f,drawPosition:h,matchUpsMap:l,structureId:u,event:d});if(m?.error&&console.log("!!!!!",{result:m}),m?.error)return q({result:m,stack:"randomUnseededDistribution"})}}return{...W}}function Y2e(t){let e=t.structure??tt(t).structure,i="positionQualifiers",r=[];if(e.stage===rn)return q({result:{error:Sf},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:s}=K2e(t);for(let o of Object.keys(n)){let l=a?.filter(u=>s[o].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(n[o]>(l||0))return q({result:{error:GB},context:{unfilledDrawPositions:l},stack:i});Ce(0,n[o]).forEach(()=>{let u=wa(l);r.push(u),a?.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...W,qualifierDrawPositions:r}}function K2e({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=tt({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=fr({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:s,roundQualifiersCounts:o}=ry({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(o?Object.keys(o):[]).map(m=>Ke(m)),{matchUps:u}=Ot({structure:e}),{roundProfile:c}=Un({matchUps:u}),d=Object.assign({},...l.filter(m=>c?.[m]).map(m=>({[m]:c?.[m]?.drawPositions?.filter(Boolean)??[]}))),p=r?.filter(m=>m.qualifier).map(m=>m.drawPosition),f=s-(p?.length??0),h=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=r?.filter(I=>I.qualifier&&d[m]?.drawPositions?.includes(I.drawPosition)).map(I=>I.drawPosition);return{[m]:(o?.[m]??0)-(g?.length??0)}})),unplacedQualifiersCount:f,placedQualifiersCount:h,roundQualifiersCounts:o,positionAssignments:r,roundDrawPositions:d,qualifiersCount:s}}function Ioe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:f}){let h=[],m=[],g=0;if(p||({structure:p}=tt({drawDefinition:a,structureId:c})),c||(c=p?.structureId),r||(r=Ct({drawDefinition:a}).appliedPolicies),!n){let I=p&&ng({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:s,structure:p});I?.error&&m.push(I.error),n=I?.validSeedBlocks}return u=u??n?.length??0,Ce(0,u).forEach(()=>{if(g<(u||0)){let I=X2e({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,structureId:c,matchUpsMap:d,event:f});I?.success&&(g++,h.push(...I.seedPositions??[])),I.error&&m.push({seedPositionError:I.error})}}),m.length?{error:m}:{...W,seedPositions:h}}function X2e({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:s,structureId:o,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=toe({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:o}),{appliedPolicies:p}=Ct({drawDefinition:r}),{avoidance:f}=p??{};f&&s&&c?.length>2;let h=[];for(let m of c){let g=d.pop();if(!g)return{error:Bv};h.push(g);let I=Ul({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:m,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:o,event:u});if(!I.success)return I}return{...W,seedPositions:h}}function J2e({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=fr({structure:i}),{seedAssignments:n}=ys({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(s=>s.participantId).map(s=>({[s.participantId]:s})));return r?.map(s=>a[s.participantId]?{...s,seedNumber:a[s.participantId].seedNumber,seedValue:a[s.participantId].seedValue}:"").filter(Boolean)}function Q2e({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>Z2e(a,i,r,t));let n=r.map(a=>Array.isArray(a)?An(a):a).flat(1/0);return mie(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function Z2e(t,e,i,r){if(e-i.length>t.drawPositions.length)i.push(...t.drawPositions);else{let n=dF(Sr(t.drawPositions,2));eVe(n,i,r)}}function eVe(t,e,i){let r,n=i[e.length];for(;r=$D(t,n);)e.push(r),n=i[e.length]}function $D(t,e){return Array.isArray(t)&&t.length!==2?t.pop():Array.isArray(t[0])?iVe(t,e):tVe(t,e)}function tVe(t,e){return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift()}function iVe(t,e){let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return $D(e?n:t[Math.round(Math.random())],e)}return i<r?$D(t[1],e):$D(t[0],e)}function dF(t){let e=Math.floor(t.length/2);return t.length>2?[dF(t.slice(0,e)),dF(t.slice(e))]:t}function rVe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:s,structure:o}){a||(a=ng({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:o}));let{isFeedIn:l,isLuckyStructure:u,isContainer:c}=a,{validSeedBlocks:d}=a;i?.seeding?.containerByesIgnoreSeeding&&(d=[]);let p=J2e({provisionalPositioning:t,drawDefinition:r,structure:o})??[],f=lt([].concat(...e.map(y=>y.drawPositions))),h=p.filter(y=>f.includes(y.drawPosition)),m=(y,b)=>jI(y.seedValue)-jI(b.seedValue),g=d.reduce((y,b)=>{let S=h.filter(U=>b.drawPositions?.includes(U.drawPosition)).sort(m);return y.concat(...S)},[]).map(y=>y.drawPosition),I=Q2e({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:s}),v=c3({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,s),w=c3({orderedSeedDrawPositions:I,relevantMatchUps:e}).slice(0,s);return{strictSeedOrderByePositions:v,blockSeedOrderByePositions:w,isLuckyStructure:u,positionedSeeds:p,isContainer:c,isFeedIn:l}}function c3({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r?.sort((n,a)=>n-a)).filter(r=>r?.[0]+1===r?.[1]);return t.map(r=>i.find(n=>n?.includes(r))).filter(Boolean).map(r=>r?.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function nVe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:s,isFeedIn:o}){let l=r?.seeding?.seedingProfile,u=s.stage===ze,{positionAssignments:c}=fr({structure:s}),d=c?.filter(N=>N.participantId).map(N=>N.drawPosition),p={isCollectionMatchUp:!1},{matchUps:f,roundMatchUps:h}=Ot({provisionalPositioning:t,matchUpFilters:p,structure:s}),m=h?.[1]||[],g=s.structureType===In?f:m,I=lt([].concat(...g.map(N=>N.drawPositions))),v=Math.min(...I)-1,w=d?.filter(N=>I.includes(N)),y=N=>{let A=Math.ceil(N.length/2),O=[N.slice(0,A),N.slice(A)],k=O.map(G=>[].concat(...G.flat(1/0)).length),F=Math.min(...k.flat(1/0)),x=Math.max(...k.flat(1/0)),L=k.indexOf(x),$=F!==x,V=An(O),[_,B]=!F||$?[O[L],O[1-L]]:[V[0],V[1]];return{greaterHalf:_,lesserHalf:B}},b=N=>{let{greaterHalf:A,lesserHalf:O}=y(N),{greaterHalf:k,lesserHalf:F}=y(A),x=An(k.flat(1/0)).pop(),L=k.flat().filter($=>$!==x);return{newlyFilteredChunks:[...O,...F,L],drawPosition:x}},S=N=>!e.includes(N),U=N=>!w?.includes(N),T=N=>{let A=Sr(N.sort(or),Math.ceil(N.length/4)).map(F=>F.filter(U)),O=[].concat(...A.flat(1/0)).length,k=[];for(let F=0;F<O;F++){let{newlyFilteredChunks:x,drawPosition:L}=b(A);k.push(L),A=x}return k},{validSeedBlocks:D}=ng({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:s}),P=D?.map(N=>N.drawPositions?.map(A=>A+v)),E;if(o){let N=I.length,{seedBlocks:A}=DV({cluster:[PU,JM].includes(nT(l)),participantsCount:N});E=A.map(O=>O.map(k=>k+v)).map(T).filter(O=>O.length)}else u?E=P?.map(N=>N.filter(U)):E=P?.map(T).filter(N=>N.length);let R=g.map(N=>N.drawPositions).map(N=>N?.sort((A,O)=>A-O)).filter(N=>N?.[0]+1===N?.[1]),C=N=>R.reduce((A,O)=>O.includes(N)?O.reduce((k,F)=>F!==N?F:k,void 0):A,void 0),M=E.map(N=>N.map(C)).flat(1/0).filter(U).filter(S).filter(Boolean);if(u&&!s.structures){let N=a%4,A=M.slice(0,N),O=h[s.roundLimit]?.length,k=Sr(M.slice(N),O).map(An).flat();M=A.concat(k)}return{unseededByePositions:M}}function aVe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){let a={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:o}=Ot({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:r,event:n}),l=o?.[1]||[],u=r?.structureType===In,c=u?s:l,d=u?r?.structures?.length||0:s.length,{structureId:p,stage:f,stageSequence:h}=r,m=Km({entryStatuses:mo,provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:f}),{qualifiersCount:g}=ry({provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:f}),I=m.length+g,{positionAssignments:v,unassignedPositions:w}=fr({structure:r}),y=w?.map(P=>P.drawPosition),b=v?.filter(P=>P.bye).length,S=v?.filter(P=>P.bye).map(P=>P.drawPosition),U=c.map(P=>P.drawPositions).filter(P=>P?.reduce((E,R)=>!S?.includes(R)&&E,!0)).flat(1/0).filter(P=>y?.includes(P)),T=v?.length,D=T?T-I:0;return D>d&&r.stageSequence===1&&r.stage!==rn&&(D=d),{placedByes:b,byesCount:D,relevantMatchUps:c,placedByePositions:S,roundMatchUps:o,positionsToAvoidDoubleBye:U}}function voe({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:s,structureId:o,structure:l,seedLimit:u,seedsOnly:c,event:d}){l||({structure:l}=tt({drawDefinition:r,structureId:o})),o||(o=l?.structureId);let p=!(l?.structures??l?.stage===ze),{byesCount:f,placedByes:h,relevantMatchUps:m}=aVe({provisionalPositioning:t,drawDefinition:r,matchUpsMap:s,structure:l,event:d}),g=f-(h||0);if(g<=0)return{...W};let{strictSeedOrderByePositions:I,blockSeedOrderByePositions:v,isLuckyStructure:w,isFeedIn:y}=rVe({provisionalPositioning:t,relevantMatchUps:m,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:l}),b=l?.structureType&&[In,QM].includes(l.structureType)&&i?.seeding?.containerByesIgnoreSeeding,S=p&&v?.length?v:I,{unseededByePositions:U}=nVe({provisionalPositioning:t,seedOrderByePositions:S,isLuckyStructure:w,appliedPolicies:i,drawDefinition:r,seedLimit:u,structure:l,isFeedIn:y}),T=R=>R%2,D=(R,C)=>(R||[]).every(M=>T(M)?C!==M+1:C!==M-1),P=[].concat(...S);if(!c)for(;U.length;){let R=U.find(C=>D(P,C));R?(P.push(R),U=U.filter(C=>C!==R)):(P.push(...U),U=[])}b&&(P=An(P),ha({ignoreSeededByes:b})&&console.log({byePositions:P}));let E=P.slice(0,g);for(let R of E){let C=ns({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:R,matchUpsMap:s,structureId:o,structure:l,event:d});if(C?.error)return C}return{...W,unseededByePositions:U,byeDrawPositions:E}}function Ry(t,e){return e||WM(),q({result:t,stack:"automatedPositioning"})}function sVe(t,e){return e||WM(),t}function oVe(t,e,i,r){let n=tt({drawDefinition:e,structureId:i});if(n.error)return{error:n.error};let a=n.structure;if(!a)return{error:yi};let s=t.appliedPolicies||Ct({drawDefinition:e,structure:a,event:r})?.appliedPolicies,{qualifiersCount:o}=ry({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,drawDefinition:e,structureId:i}),l=Cf,u=Km({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,placementGroup:t.placementGroup,drawDefinition:e,entryStatuses:l,structureId:i});return{structure:a,appliedPolicies:s,qualifiersCount:o,entries:u}}function lVe({placeByes:t,provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:u,event:c,structureSeedingProfile:d,seedingProfile:p,inContextDrawMatchUps:f,participants:h,positioningReport:m}){let g=t?voe({provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:u,event:c}):void 0;if(g?.error)return{error:g.error};let I=g?.unseededByePositions;return m.push({action:"positionByes",unseededByePositions:I}),g=Ioe({seedingProfile:d?{positioning:d}:p,provisionalPositioning:e,inContextDrawMatchUps:f,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:a.validSeedBlocks,drawDefinition:n,seedBlockInfo:a,participants:h,matchUpsMap:s,structure:o,event:c}),g.error?{error:g.error}:(m.push({seedPositions:g.seedPositions,action:"positionSeedBlocks"}),{unseededByePositions:I})}function uVe({drawType:t,LUCKY_DRAW:e,structureSeedingProfile:i,seedingProfile:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:u,seedBlockInfo:c,participants:d,matchUpsMap:p,structure:f,event:h,placeByes:m,seedLimit:g,seedsOnly:I,positioningReport:v}){let w;if(t!==e){let b=Ioe({seedingProfile:i?{positioning:i}:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:u,seedBlockInfo:c,participants:d,matchUpsMap:p,structure:f,event:h});if(b.error)return{error:b.error};v.push({action:"positionSeedBlocks",seedPositions:b.seedPositions})}let y=m?voe({provisionalPositioning:n,tournamentRecord:s,appliedPolicies:o,drawDefinition:u,seedBlockInfo:c,matchUpsMap:p,structure:f,seedLimit:g,seedsOnly:I,event:h}):void 0;return y?.error?{error:y.error}:(w=y?.unseededByePositions,v.push({action:"positionByes",byeDrawPositions:y?.byeDrawPositions,unseededByePositions:w}),{unseededByePositions:w})}function cVe({seedsOnly:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:u,positionQualifiers:c,positionUnseededParticipants:d,provisionalPositioning:p,unseededByePositions:f,multipleStructures:h,structureId:m,drawSize:g,event:I,positioningReport:v,conflicts:w}){if(t)return{};let y=c({inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:u});return y.error?{error:y.error}:(y.conflicts&&(w.qualifierConflicts=y.conflicts),v.push({action:"positionQualifiers",qualifierDrawPositions:y.qualifierDrawPositions}),y=d({provisionalPositioning:p,inContextDrawMatchUps:e,unseededByePositions:f,multipleStructures:h,tournamentRecord:i,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:m,structure:u,drawSize:g,event:I}),y.error?{error:y.error}:(y.conflicts&&(w.unseededConflicts=y.conflicts),v.push({action:"positionUnseededParticipants"}),{}))}function aT(t){let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:s,seedingProfile:o,structureId:l,seedLimit:u,seedsOnly:c,drawType:d,drawSize:p,event:f}=t,h=[];i||(Wre(),e=xe(e,!1,!0));let{structure:m,appliedPolicies:g,qualifiersCount:I,entries:v,error:w}=oVe(t,e,l,f);if(w)return Ry(w,i);if(!v?.length&&!I)return sVe({...W},i);let y=t.matchUpsMap??xr({drawDefinition:e}),b=t.inContextDrawMatchUps??nr({inContext:!0,drawDefinition:e,matchUpsMap:y})?.matchUps,S=ng({provisionalPositioning:r,appliedPolicies:g,drawDefinition:e,seedingProfile:o,structure:m});if(S.error)return Ry(S,i);let{validSeedBlocks:U}=S;h.push({validSeedBlocks:U});let T=t.participants||(s?Ei({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:s})?.participants:[]),D;if(nT(m.seedingProfile||o)===qp){let C=lVe({placeByes:a,provisionalPositioning:r,tournamentRecord:s,appliedPolicies:g,drawDefinition:e,seedBlockInfo:S,matchUpsMap:y,structure:m,seedLimit:u,seedsOnly:c,event:f,structureSeedingProfile:m.seedingProfile,seedingProfile:o,inContextDrawMatchUps:b,participants:T,positioningReport:h});if(C?.error)return Ry(C.error,i);D=C.unseededByePositions}else{let C=uVe({drawType:d,LUCKY_DRAW:Tf,structureSeedingProfile:m.seedingProfile,seedingProfile:o,provisionalPositioning:r,inContextDrawMatchUps:b,tournamentRecord:s,appliedPolicies:g,validSeedBlocks:U,drawDefinition:e,seedBlockInfo:S,participants:T,matchUpsMap:y,structure:m,event:f,placeByes:a,seedLimit:u,seedsOnly:c,positioningReport:h});if(C?.error)return Ry(C.error,i);D=C.unseededByePositions}let P={},E=cVe({seedsOnly:c,inContextDrawMatchUps:b,tournamentRecord:s,appliedPolicies:g,validSeedBlocks:U,drawDefinition:e,seedBlockInfo:S,participants:T,matchUpsMap:y,structure:m,positionQualifiers:Y2e,positionUnseededParticipants:z2e,provisionalPositioning:r,unseededByePositions:D,multipleStructures:n,structureId:l,drawSize:p,event:f,positioningReport:h,conflicts:P});if(E?.error)return Ry(E.error,i);let{positionAssignments:R}=Xt({drawDefinition:e,structure:m});return ri({drawDefinition:e,structureIds:[l]}),i||WM(),{positionAssignments:R,conflicts:P,...W,positioningReport:h}}function sy(t){let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,placeByes:o,seedsOnly:l}=t;if(!n)return{error:za};if(!Au({drawDefinition:n,structureId:s})&&!i)return{error:MB};let u=foe({drawDefinition:n,structureId:s}).playoffStructures?.sort((p,f)=>fE(p)-fE(f)),c=[],d=[];if(u)for(let p of u){let{structureId:f}=p,h=aT({structureId:f,provisionalPositioning:i,applyPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:o,seedsOnly:l});if(h.error)return h;h.positionAssignments&&c.push({positionAssignments:h.positionAssignments,structureId:f}),h.positioningReport&&d.push(h.positioningReport)}return{...W,structurePositionAssignments:c,positioningReports:d}}function yoe({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:s}){if(!i)return{error:$e};if(!n)return{error:es};let o=(e?.participants??[]).find(p=>p.participantId===r);if(e&&!o)return{error:Fo};let{structure:l}=tt({drawDefinition:i,structureId:n});if(!l)return{error:yi};if(!(!t||Ni(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Ni(p)&&Ke(p)>0)))return{error:re};let{seedAssignments:u}=ys({drawDefinition:i,structure:l}),c=u?.map(p=>p.seedNumber),d=u?.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(f=>parseInt(f)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return _ae({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:i,structure:l}),{...W}}function OV({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return NV({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function ww({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=Zv({drawDefinition:i,structureId:r})||{},s=(a?.target||[]).filter(({linkType:o})=>o===n).filter(({target:o})=>!t||t===o.roundNumber).map(o=>{let l=o.source.structureId,{structure:u}=tt({structureId:l,drawDefinition:i});if(!(e&&u?.finishingPosition!==e))return o}).filter(Boolean);return{sourceStructureIds:s.map(({source:o})=>o.structureId),relevantLinks:s}}var dVe=(t,e)=>{let i=[...new Set(e.slice(0,t.length))],r=[...i].sort((o,l)=>o-l),n=new Set,a=[];i.forEach(o=>{let l=t.indexOf(o);if(l!==-1&&!n.has(l))a.push(l),n.add(l);else{let u=r.indexOf(o),c=t.findIndex((d,p)=>!n.has(p));for(;n.has(c)&&c===-1&&n.size<t.length;)c=t.findIndex((d,p)=>!n.has(p)&&p>c);a.push(u),n.add(u)}});let s=t.filter((o,l)=>!n.has(l));return[...a,...s]};function boe({targetRoundNumber:t=1,tournamentRecord:e,drawDefinition:i,event:r,randomList:n}){let a=He({drawDefinition:i,event:r,tournamentRecord:e},[{[vn]:!0,[qc]:!0,[gr]:!0}]);if(a.error)return a;let s=[],o=[],l=i.structures?.find(g=>g.stage===ke&&g.stageSequence===1);if(!l)return q({result:{error:FB}});let u=(Ct({tournamentRecord:e,drawDefinition:i,structure:l,event:r}).appliedPolicies??{})[Cu]?.requireCompletedStructures,{qualifierPositions:c,positionAssignments:d}=fr({structure:l});if(!c.length)return q({result:{error:GB}});let p=Ce(0,c.length);n&&(p=dVe(p,n));let f=d.map(g=>g.participantId).filter(Boolean),{relevantLinks:h}=ww({structureId:l.structureId,targetRoundNumber:t,linkType:Tu,drawDefinition:i})||{},{relevantLinks:m}=ww({structureId:l.structureId,targetRoundNumber:t,linkType:Uu,drawDefinition:i})||{};for(let g of h){let I=i.structures?.find(w=>w.structureId===g.source.structureId);if(I?.stage!==ze)continue;let v=Au({structureId:g.source.structureId,drawDefinition:i});if(!u||v){let w=I.qualifyingRoundNumber,{matchUps:y}=Ot({matchUpFilters:{...w&&{roundNumbers:[w]},isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,inContext:!0,structure:I});for(let b of y){let S=b.matchUpStatus==="BYE"&&b.sides?.find(({participantId:T})=>T),U=b.sides.find(T=>T?.sideNumber===b.winningSide);if(U||S){let{participantId:T}=U||S||{};T&&!f.includes(T)&&o.push(T)}}}}for(let g of m){let I=i?.structures?.find(v=>v.structureId===g.source.structureId);if(I?.stage===ze&&Au({structureId:g.source.structureId,drawDefinition:i})){let{positionAssignments:v}=Xt({structure:I}),w=v?.map(y=>{let b=y.participantId,S=rt({element:y,name:Nc}).extension?.value;return S?{participantId:b,groupOrder:S?.groupOrder}:{}}).filter(({groupOrder:y,participantId:b})=>y===1&&!f.includes(b)).map(({participantId:y})=>y)??[];w&&o.push(...w)}}return o.length?(p.forEach((g,I)=>{let v=o[I],w=c[g].drawPosition;v&&OV({qualifyingParticipantId:v,structureId:l.structureId,drawPosition:w,tournamentRecord:e,drawDefinition:i})?.success&&s.push({participantId:v,drawPosition:w})}),q({result:je({...W,assignedParticipants:s})})):q({result:{error:ure}})}function woe({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>ct(i)))&&q({result:{error:re},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>PI(i.structureOrder)-PI(r.structureOrder)),{...W}):{error:$e}}function ON({drawDefinition:t}){let e=t.structures??[],i=t.links??[],r=new Map,n=g=>{let I=r.get(g)||r.set(g,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(g);if(I&&!I?.stage){let v=e.find(w=>w.structureId===g);I.stage=v?.stage}return I},a={},s={},o=i.map(g=>{let I=g.source.structureId,v=g.target.structureId,w=n(I),y=n(v);return[Yp,Fs,ZM,qp].includes(g.target.feedProfile)?(w?.targets.push(v),y?.sources.push(I)):g.target.feedProfile===So&&(y?.drawSources.push(I),w?.drawTargets.push(v)),s[v]=s[v]||g.target.feedProfile===So,a[v]=lt([...a[v]||[],I]).filter(Boolean),[g.source.structureId,g.target.structureId]});for(let g of r.keys()){let I=r.get(g);if(I){let v=I.targets??[];for(;v.length;){let w=v.pop(),y=w&&r[w];y?.targets?.length?v.push(...y.targets):y&&(I.rootStage=y.stage)}if(I.rootStage||(I.rootStage=I.stage),!I.targets?.length){let w=I.sources??[];for(;w.length;){let y=w.pop(),b=y&&r[y];if(b?.sources?.length){for(let S of b.sources)I.progeny?.includes(S)||I.progeny?.push(S);w.push(...b.sources)}}}}}let l=0;for(let g of r.keys()){let I=r.get(g);if(I&&I.rootStage===ze){let v=[I.drawTargets?.[0]],w=0;for(;v.length;){w+=1;let y=v.pop(),b=y?r.get(y):void 0;b?.drawTargets?.length&&v.push(b.drawTargets[0])}I.distanceFromMain=w,w>l&&(l=w)}}let u=o.length;Ce(0,Math.ceil(u/2)).forEach(()=>{o=Ce(0,u).map(g=>{let I=o[g],v=o.reduce((w,y)=>$n(I,y)?w.concat(...y):w,[])||[];return lt(I.concat(...v))})});let c=o[0],d=(g,I)=>_i(g,I).length===g.length,p=o.slice(1).reduce((g,I)=>g&&d(I,c),!0),f=[c].filter(Boolean),h=[c].filter(Boolean);e.forEach(g=>{let{structureId:I,stage:v}=g;f.find(w=>w.includes(I))||(f.push([I]),v!==Mr&&h.push([I]))});let m=p&&h.length===1;return!i?.length&&e.length===1&&n(e[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:m,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:s,structureGroups:f}}function Soe({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=ON({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...W}}function xV(t){let e=He(t,[{[gr]:!0,[vn]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return pVe({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function pVe(t){let e=He(t,[{[vn]:!0,[aN]:!0},{link:!0,[Jn]:Zn,[Sie]:OB}]);if(e.error)return e;let{drawDefinition:i,tournamentId:r,structure:n,eventId:a,link:s}=t,o=s.target.structureId,l=tt({drawDefinition:i,structureId:o});if(l.error)return q({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(n),i.links.push(s),Soe({drawDefinition:i});let u=Ot({structure:n})?.matchUps||[];return Nd({drawDefinition:i,tournamentId:r,matchUps:u,eventId:a}),ri({drawDefinition:i,structureIds:[n.structureId]}),{...W}}function Uoe({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:re};if(!t)return{error:$e};let i=Object.assign({},...e.map(r=>{if(!Ut(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Je};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let s=i[a.structureId];s&&(a.structureName=s)}}return{...W}}function FV({drawDefinition:t,timeItem:e}){if(!t)return{error:za};if(!e)return{error:YB};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:qB};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),xU({drawDefinition:t}),{...W}}function Toe(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,event:n}=t,a=He(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let s=i.structures??[],o=s.find(I=>I.structureId===r);if(!o)return{error:yi};let l=s.find(({stage:I,stageSequence:v})=>I===ke&&v===1),u=r===l?.structureId,c=s.filter(({stage:I})=>I===ze).map(Aa("structureId"));if(u&&!c.length)return{error:Tie};let d=c.includes(r),p=fVe({isQualifyingStructure:d,structure:o,...t});if(p?.error)return p;let{structureIdsToRemove:f,relatedStructureIdsMap:h}=mVe({qualifyingStructureIds:c,isQualifyingStructure:d,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureId:r}),{removedMatchUpIds:m,removedStructureIds:g}=gVe({relatedStructureIdsMap:h,qualifyingStructureIds:c,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:f,structureId:r});if(hVe({removedMatchUpIds:m,drawDefinition:i}),u){let I=(l.matchUps??[])?.map(Aa("matchUpId"));m.push(...I),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&Soe({drawDefinition:i}),ju({tournamentId:e?.tournamentId,matchUpIds:m,action:"removeStructure",eventId:n?.eventId,drawDefinition:i}),ri({drawDefinition:i,eventId:n?.eventId}),{...W,removedMatchUpIds:m,removedStructureIds:g}}function fVe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:s}){let o=[r];if(t){let l=c=>i.links?.find(d=>d.target.structureId===c),u=l(r)?.source.structureId;for(;u;)o.push(u),u=l(u)?.source.structureId}if(nr({matchUpFilters:{structureIds:o},drawDefinition:i}).matchUps?.some(({score:l})=>hr({score:l}))){let l=Ct({tournamentRecord:e,drawDefinition:i,structure:n,event:a})?.appliedPolicies;if(!(s??l?.[vs]?.allowDeletionWithScoresPresent?.structures))return{error:bU}}return{...W}}function hVe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=nr({drawDefinition:e});i?.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function mVe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let s=(n.structures??[]).map(Aa("structureId")),o=c=>n.links?.map(d=>d.source.structureId===c&&d.target.structureId!==r?.structureId&&d.target.structureId).filter(Boolean)??[],l=c=>n.links?.map(d=>t.includes(d.source.structureId)&&d.target.structureId===c&&d.source.structureId).filter(Boolean)??[],u=new Map;return s.forEach(c=>u.set(c,e?l(c):o(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function gVe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:s}){let o=[],l=[];for(;a?.length;){let u=a.pop();l.push(...yVe({idBeingRemoved:u,drawDefinition:n}));let c=vVe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:n,structureId:s});o.push(...c.removedStructureIds);let d=IVe({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:u,structureId:s});d?.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:o}}function IVe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){return t&&e.get(t)?.filter(n=>n!==i?.structureId||r===i.structureId)}function vVe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){let a=[];return r.links=r.links?.filter(s=>s.source.structureId!==i&&s.target.structureId!==i)??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function yVe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=tt({structureId:t,drawDefinition:e}),r=Ot({structure:i}).matchUps;return A2(r)}function UE({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:$e};if(!tV({drawDefinition:e,stage:r}))return{error:Sf};let n=y$e({drawDefinition:e,stage:r}),{qualifiersCount:a}=ry({drawDefinition:e,stageSequence:t,stage:r}),s=n+a;if(i<s)return{error:Cie};let{entryProfile:o}=eV({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return ri({drawDefinition:e}),{...W,entryProfile:o}}function Doe({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?tV({drawDefinition:e,stage:i})?(eV({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),ri({drawDefinition:e}),{...W}):{error:Sf}:{error:$e}}function bVe({drawDefinition:t,drawSize:e}){if(!t)return{error:$e};let i=UE({stage:Mr,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(ri({drawDefinition:t}),{...W})}function Poe(t){return bVe(t)}function Eoe({tournamentRecord:t,drawDefinition:e,event:i,structureId:r}){if(!e)return{error:$e};let n=e.structures?.find(s=>s.stage===ze&&s.structureId===r);if(!n)return{error:yi};if(n.matchUps?.some(({matchUpStatus:s,score:o})=>hr({score:o})??Qi.includes(s)))return{error:bU};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],ju({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),ri({tournamentId:t?.tournamentId,eventId:i?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...W}}var wVe="qualifierDrawPositionAssignment",SVe="withdrawParticipantAtDrawPosition",UVe="alternateDrawPositionAssignment",TVe="luckyLoserDrawPositionAssignment",d3="removeDrawPositionAssignment",Roe="swapDrawPositionAssignments",DVe="modifyPairAssignment",PVe="adHocPositionSwap",EVe="modifyParticipantOtherName",p3="assignDrawPosition",RVe="removeSeededParticipant",CVe="assignDrawPositionBye",MVe="modifySeedAssignment",Coe="addPenalty",LV="MODIFY_PAIR",xN="QUALIFIER",_V="ALTERNATE",$V="WITHDRAW",tm="ASSIGN",pF="REMOVE",BV="LUCKY",gb="REMOVE_SEED",FN="SWAP",Sw="NICKNAME",Dh="SEED_VALUE",im="PENALTY",NVe={MODIFY_PAIR_ASSIGNMENT:LV,QUALIFYING_PARTICIPANT:xN,ALTERNATE_PARTICIPANT:_V,WITHDRAW_PARTICIPANT:$V,ASSIGN_PARTICIPANT:tm,LUCKY_PARTICIPANT:BV,REMOVE_ASSIGNMENT:pF,SWAP_PARTICIPANTS:FN,ADD_NICKNAME:Sw,REMOVE_SEED:gb,ADD_PENALTY:im,ASSIGN_BYE:"BYE",SEED_VALUE:Dh};function Moe({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:$e};if(!r)return{error:es};if(i?.length!==2)return{error:re,drawPositions:i};let a=xr({drawDefinition:e}),{matchUps:s}=nr({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:o}=tt({drawDefinition:e,structureId:r});if(!o)return{error:yi};let l=Ct({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},u;if(o.structureType===In?u=OVe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}):u=AVe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}),u.error)return u;if(K2({structure:o,drawPositions:i}),FU({appliedPolicies:l,drawDefinition:e,positionAction:{name:Roe,drawPositions:i,structureId:r}}),Ac({tournamentId:t?.tournamentId,drawDefinition:e,structure:o,event:n}),n.eventType===Ca){let c=Ot({matchUpFilters:{matchUpTypes:[Wa]},inContext:!0,structure:o}).matchUps.filter(p=>p.drawPositions?.some(f=>i.includes(f))),d=Ot({matchUpFilters:{matchUpTypes:[Wa]},structure:o}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(f=>{let h=f?.drawPosition;if(i.includes(h)){let m=f.participantId,g=d.find(({matchUpId:v})=>v===p.matchUpId),I=p?.sides?.reduce((v,w,y)=>w.drawPosition===h?y:v,void 0);RV({inContextTargetMatchUp:p,drawPositionSideIndex:I,teamParticipantId:m,tournamentRecord:t,drawDefinition:e,matchUp:g,event:n})}})})}return ri({drawDefinition:e,structureIds:[r]}),{...W}}function AVe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a?.positionAssignments.filter(u=>r?.includes(u.drawPosition));if(!o)return{error:re,structure:a,info:"Missing positionAssignments"};if(o.filter(({bye:u})=>u).length===2)return{...W};if(o.filter(({qualifier:u})=>u).length===2)return{...W};let l=o.some(({qualifier:u})=>u);return o.some(({bye:u})=>u)&&!l?Noe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s}):kVe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s})}function Noe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=r.find(({bye:h})=>h),l=r.find(({participantId:h})=>h),u=o.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,f=bw({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return f.error||(f=bw({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),f.error)||(ns({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:s}),f=Ul({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:n,event:s}),f.error)?f:{...W}}function kVe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=Object.assign({},...r.map((l,u)=>{let{drawPosition:c}=l,d={...r[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>o[l.drawPosition]||l),MV({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:s}),{...W}}function OVe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a.structures?.reduce((u,c)=>{let d=c?.positionAssignments.filter(p=>r?.includes(p.drawPosition));return d&&u.push(...d),u},[]);if(o.filter(({bye:u})=>u).length===2)return{...W};if(o.filter(({qualifier:u})=>u).length===2)return{...W};MV({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:o,structure:a,event:s});let l=o.some(({qualifier:u})=>u);if(o.some(({bye:u})=>u)&&!l)Noe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s});else{let u=xe(o,!1,!0);o.forEach((c,d)=>{let p=u[1-d].participantId;c.qualifier=u[1-d].qualifier,c.participantId=p})}return{...W}}function Aoe({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){let n="removeSeededParticipant";if(!t)return{error:Ie};if(!e)return{error:$e};let a=(e.structures??[]).find(s=>s.structureId===r);return a?!a.stage||![ke,ze].includes(a.stage)||a.stage===ke&&a.stageSequence!==1?q({result:{error:bf},stack:n}):a.seedAssignments?.find(s=>s.participantId===i)?{...W}:q({info:"participant not seeded",result:{error:Gr},context:{participantId:i}}):q({result:{error:yi},stack:n})}function sT({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=Tu}){return!r||!n?{error:es}:{link:je({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:So,roundNumber:t,structureId:n}})}}function sg({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>oT({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function oT({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:s,matchUpType:o,collectionId:l,processCodes:u}=e||{},c=i??s??0,d=p=>{if(!n&&!r?.isMock)return a?.pop()??Et();let f=e?.collectionId;return a?.pop()??`${r?.matchUpId}-${f}-TMU-${p+1}`};return Ce(0,c).map(p=>{let f=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:$i,collectionPosition:f,collectionId:l,processCodes:u,matchUpType:o,isMock:n}})}function VV({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:r?.pop()||Et()}function TE({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:s,nodes:o}){let l=0,u=[],c=1,d=i-1,p=o?.length;for(;l<(p||0);){let f=o?.[l],h=o?.[l+1];d&&(f.roundNumber=d),h&&d&&(h.roundNumber=d);let m=VV({roundPosition:c,roundNumber:i,idPrefix:n,uuids:s}),g={roundPosition:c,children:[f,h],matchUpId:m};u.push(g);let I={drawPositions:g.children.map(v=>v?.drawPosition).filter(Boolean),matchUpStatus:$i,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(I.matchUpType=e),a&&(I.isMock=!0),r.push(I),c++,l+=2}return{roundNodes:u,matchUps:r}}function Tl({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:s,drawSize:o,isMock:l,uuids:u}){if(isNaN(o)||o<2||r&&o<=r)return{matchUps:[],roundsCount:0};if(r&&(!xo(o)||o%r)){let g=r;for(;g<o;)g=2*g;o=g}let c=r&&!(o%2)&&(!isNaN(r)||i&&!isNaN(i))&&(o/r===Math.round(o/r)||i&&o/i===Math.round(o/i));if(!xo(o)&&!c)return{matchUps:[],roundsCount:0};let d=Ce(1,o+1).map(g=>({drawPosition:g})),p,f=[],h=1;for({roundNodes:p,matchUps:f}=TE({matchUpType:n,roundNumber:h,idPrefix:s,matchUps:f,isMock:l,nodes:d,uuids:u}),h++,a=a??i;p.length>1;)r&&p.length===r&&(a=h-1),{roundNodes:p,matchUps:f}=TE({nodes:p,matchUpType:n,roundNumber:h,idPrefix:s,matchUps:f,isMock:l,uuids:u}),h++;let m=h-1;return f=XU({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:f}),a?f=f.filter(g=>a&&(g.roundNumber??0)<=a):a=h-1,{drawSize:o,matchUps:f,roundsCount:m,roundLimit:a}}function xVe(t,e){return t.drawDefinition?t.drawSize&&!ct(t.drawSize)||t.participantsCount&&!ct(t.participantsCount)||t.qualifyingPositions&&!ct(t.qualifyingPositions)?q({result:{error:re},stack:e}):t.drawSize?t.qualifyingPositions&&t.qualifyingPositions>=t.drawSize?q({result:{error:re},context:{drawSize:t.drawSize,qualifyingPositions:t.qualifyingPositions},stack:e}):null:q({result:{error:gU},context:{drawSize:t.drawSize},stack:e}):q({result:{error:$e},stack:e})}function FVe(t,e,i){let{structureProfiles:r}=ON({drawDefinition:t});return r[e]||q({result:{error:yi},context:{targetStructureId:e},stack:i})}function LVe(t){let{maxRoundNumber:e,structures:i,groupCount:r}=iT(t);return{qualifiersCount:r,roundLimit:e,structure:i[0],finishingPositions:[1]}}function _Ve(t){let{drawSize:e,matchUps:i,roundLimit:r,roundsCount:n}=Tl(t);r||(r=n);let a=cs({structureName:t.structureName,structureId:t.structureId,qualifyingRoundNumber:r,stage:ze,matchUpFormat:t.matchUpFormat,stageSequence:t.stageSequence,matchUpType:t.matchUpType,roundLimit:r,matchUps:i});t.roundTarget&&It({extension:{name:xl,value:t.roundTarget},element:a});let s=i?.filter(o=>o.roundNumber===r)?.length??0;return{drawSize:e,structure:a,matchUps:i,roundLimit:r,qualifiersCount:s}}function jV(t){let e="generateQualifyingStructure",i=xVe(t,e);if(i)return i;let r=t.drawSize??RB(t.participantsCount),{hasExistingDrawDefinition:n,qualifyingRoundNumber:a,qualifyingPositions:s,targetStructureId:o,structureOptions:l,appliedPolicies:u,qualifyingOnly:c,drawDefinition:d,matchUpFormat:p,structureName:f,structureId:h,roundTarget:m,tieFormat:g,drawType:I,idPrefix:v,isMock:w,uuids:y}=t,b=FVe(d,o,e);if(b?.error)return b;let S=d.matchUpType,U=1,T=m?`${m}-`:"",D=typeof b=="object"&&"stage"in b&&b.stage===ze,P=u?.[Rc]?.namingConventions?.pre??T$e[Rc]?.namingConventions?.pre,E=D&&P?`${P}-`:"",R=f??(T?`${E}${Zr(ze)} ${T}`:`${E}${Zr(ze)}`),C,M,N,A,O;if(I===no){let x=LVe({structureName:f??R,structureId:h??y?.pop(),hasExistingDrawDefinition:n,stage:ze,structureOptions:l,appliedPolicies:u,qualifyingOnly:c,stageSequence:U,matchUpType:S,roundTarget:m,tieFormat:g,idPrefix:v,drawSize:r,isMock:w,uuids:y});A=x.qualifiersCount,N=x.roundLimit,C=x.structure,O=x.finishingPositions}else{let x=_Ve({qualifyingRoundNumber:a,qualifyingPositions:s,matchUpType:S,idPrefix:v,drawSize:r,isMock:w,uuids:y,structureName:f??R,structureId:h??y?.pop(),matchUpFormat:p,stageSequence:U,roundTarget:m});r=x.drawSize,C=x.structure,N=x.roundLimit,A=x.qualifiersCount}let k=I===no?Uu:Tu,F=C&&N&&sT({sourceStructureId:C.structureId,sourceRoundNumber:N,targetStructureId:o,finishingPositions:O,linkType:k})?.link;return g&&(M=Ot({structure:C})?.matchUps||[],M?.forEach(x=>{let{tieMatchUps:L}=sg({tieFormat:g,matchUp:x,isMock:w});Object.assign(x,{tieMatchUps:L,matchUpType:S})})),{qualifyingDrawPositionsCount:r,qualifiersCount:A,...W,structure:C,link:F}}function koe(t){if(!t.tournamentRecord)return{error:Ie};let e=$Ve(t);return e.error,e}function $Ve(t){if(!t.drawDefinition)return{error:$e};if(!t.targetStructureId)return{error:es};let e=jV(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:re}:xV({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function Ooe(t){let e=He(t,[{[vn]:!0,[iN]:!0,[Ol]:!0},{[D_e]:!0,[Yr]:d=>Number.isInteger(d)&&d>0},{[Yr]:d=>Array.isArray(d)&&d.length===2&&d.every(ai),[Ya]:Ua,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=t,{structure:s}=tt({drawDefinition:i,structureId:r});if(!s)return{error:yi};if(!Yn({structure:s}))return{error:bf};let o=d=>d.sides?.map(p=>p.participantId).some(p=>t.participantIds.includes(p)),l=d=>d.roundNumber===t.roundNumber,u=d=>!hr(d),c=(s?.matchUps??[]).filter(l).filter(u).filter(o);if(c.length!==2)return{error:Ua};for(let d of c){let p=d?.sides?.find(f=>t.participantIds.includes(f?.participantId));if(p){let f=t.participantIds.find(h=>h!==p?.participantId);p.participantId=f,Dt({tournamentId:n?.tournamentId,eventId:a?.eventId,drawDefinition:i,matchUp:d})}}return ri({drawDefinition:i,structureIds:[r]}),{...W}}function BVe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:s,uuids:o,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Ce(0,c).map(m=>d?d+m:void 0),f=[];for(let m=0;m<c;m++){let g=p.shift(),I={drawPosition:g,fed:u+1,feed:!0},v=l[m];v.roundNumber=i-1;let w=VV({roundPosition:v.roundPosition,roundNumber:i,idPrefix:n,uuids:o}),y={roundPosition:v.roundPosition,drawPositions:[g],matchUpStatus:$i,roundNumber:i,matchUpId:w};t&&(y.matchUpType=r),s&&(y.isMock=!0),a.push(y);let b={children:[v,I]};f.push(b)}let h=e?e-c:void 0;return{roundNodes:f,matchUps:a,drawPosition:h}}function Od(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:s,finishingPositionOffset:o,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:f,uuids:h,fmlc:m}=t;a=a??M(e);let g=VVe({drawSize:a}),I=g.length,v=0;if(i?.length)v=i.reduce((N,A)=>N+A,0);else if(e){let N=e-a;i=g.filter(A=>A<=N?(N-=A,!0):!1),v=i.reduce((A,O)=>A+O,0),r=i.length}else n>=I?r=0:u&&(r=I-u,n=0),i=g.filter((N,A)=>u&&!r||r&&A>=n+r||A<n?0:N),v=i.reduce((N,A)=>N+A,0),r=i.length;let w=[...g,...i].sort((N,A)=>A-N),y=w.length,b=[...(l??[]).map(N=>N-1),...(s??[]).map(N=>y-N)].map(N=>w[N]).reduce((N,A)=>N+A,0);v=v-b;let S=0,U=[],T,D=1,P=Ce(0,a).map((N,A)=>({drawPosition:A+1+v})),E=v+1;for(let N of g){if({roundNodes:T,matchUps:U}=TE({matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:f,nodes:P,uuids:h}),D++,i.includes(N)){let A=Ra(i)[N],O=Ce(0,A),k=y+1-D,F=s?.includes(k)??l?.includes(D);O.forEach(()=>{({roundNodes:T,matchUps:U,drawPosition:E}=BVe({drawPosition:!F&&E||void 0,nodes:T,matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:f,uuids:h,fed:S})),D++,S+=1})}P=T}y!==D-1&&console.log("ERROR");let R=a-v;U=XU({finishingPositionOffset:c?R:o,positionsFed:v,roundsCount:y,matchUps:U,fmlc:m});let C=T?.length?T[0]:T;return C&&(C.roundNumber=D-1,C.matchUps=U),{draw:C,matchUps:U,roundsCount:y};function M(N){let A=CB(N);return A>N?A/2:A}}function VVe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Ce(0,e).reverse().map(i=>Math.pow(2,i))}function Jg(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,stageSequence:o=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:f,sequenceLimit:h,childStage:m,stage:g=ke,drawSize:I,idPrefix:v,isMock:w,uuids:y}=t;if(!(!s||!u||s?.[l])||I<2||h&&o>h)return{};let b=[],S=[],U=[],T=t.matchUpType??p?.matchUpType,D=e+1,P=e+I,E=`${D}-${P}`,R=s?.[l],C=r&&`${r} `||"",M=s?.[E]??n?.[E],N=t.structureName||M?.name||R?.name&&(i?`${C}${R?.name}`:R.name)||`${C}${E}`,A=M?.abbreviation??R?.abbreviation,O=t.structureId??R?.structureId??y?.pop(),k={idPrefix:v&&`${v}-${N}-RP`,finishingPositionOffset:e,matchUpType:T,drawSize:I,isMock:w,uuids:y},{matchUps:F}=f?Od(k):Tl(k),x=cs({structureAbbreviation:A,stageSequence:o,structureName:N,matchUpType:T,roundOffset:d,structureId:O,matchUps:F,stage:g});b.push(...F),S.push(x);let L=Math.ceil(Math.log(I)/Math.log(2)),$=c?Math.min(c-d,L):(!a||D<a)&&L||0;return I>2&&Ce(1,$+1).forEach(_=>V(_)),{structureId:x.structureId,matchUps:b,structureName:N,structures:S,links:U,...W};function V(_){let B=I/Math.pow(2,_);if(B<2)return;let G=I/Math.pow(2,_)+e;if(a&&G+1>a)return;let{structures:j,structureId:Y,matchUps:K,links:X}=Jg({finishingPositionOffset:G,exitProfile:`${l}-${_}`,roundOffset:d+_,stageSequence:o+1,stage:m??g,drawSize:B,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:h,childStage:m,matchUpType:T,idPrefix:v,uuids:y});if(x.structureId&&Y){let Z={linkType:Du,source:{roundNumber:_,structureId:x.structureId},target:{roundNumber:1,feedProfile:Fs,structureId:Y}};X&&x&&X.push(Z),X?.length&&U.push(...X)}return j?.length&&S.push(...j),K?.length&&b.push(...K),{structureId:Y,childLinks:X,structures:S}}}function GV({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=tt({drawDefinition:t,structureId:i});if(r.error)return q({result:r});let{matchUps:n}=Ot({structure:r.structure,matchUpsMap:e});return{...Un({matchUps:n}),matchUps:n,matchUpsMap:e}}function f3({finishingPositions:t,drawDefinition:e,structureId:i}){let{roundProfile:r}=GV({drawDefinition:e,structureId:i});return(r&&Object.keys(r))?.reduce((n,a)=>(xoe(r?.[a]).forEach(s=>{t.forEach(o=>{jVe({position:o,rangeDefinition:s})&&(n[o]={roundNumber:a})})}),n),{})}function jVe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return Ce(i,(r||i)+1).includes(t)}function xoe(t){return[lt(t?.finishingPositionRange?.loser||[]),lt(t?.finishingPositionRange?.winner||[])]}function GVe(t){return xoe(t).map(e=>Ce(e[0],e[1]&&e[1]+1||e[0]+1))}function oy({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:re,context:{structureIds:e}};if(!t)return{error:$e};e=e??(t.structures??[]).filter(a=>a.stage!==ze).map(({structureId:a})=>a);let r=e.map(a=>{let{roundProfile:s}=GV({drawDefinition:t,matchUpsMap:i,structureId:a});return(s&&Object.values(s))?.map(GVe).flat()}).flat(),n=r.filter(a=>a?.length===1).sort(or).flat();return{positionsNotPlayedOff:lt(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function Foe({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:$e};if(!r)return{error:es};if(!e)return{error:Je,info:"missing playoffPositions"};let n=oy({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,s=e.filter(I=>!a.includes(I)),o=f3({finishingPositions:s,drawDefinition:i,structureId:r}),l=Object.values(o).reduce((I,v)=>I.includes(v.roundNumber)?I:I.concat(v.roundNumber),[]).map(I=>Ke(I)).filter(I=>!t.includes(I)),u=f3({finishingPositions:a,drawDefinition:i,structureId:r}),c=u?Object.values(u):[],d=u?c.reduce((I,v)=>I.includes(v.roundNumber)?I:I.concat(v.roundNumber),[]).map(I=>Ke(I)):[],p=l.filter(I=>!d.includes(I)).sort(or),{roundProfile:f}=GV({drawDefinition:i,structureId:r}),h=p.map(I=>{let v=f?.[I].finishingPositionRange.loser,[w,y]=v??[0,0];return Ce(w,(y||w)+1)}).flat().sort(or),{playoffRoundsRanges:m}=HVe({playoffSourceRounds:p,roundProfile:f}),g=[...p,...d];return{playoffPositionsReturned:h,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:f}}function HVe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,s=Ce(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:s,roundNumber:i}})}}function lT({drawDefinition:t,structureId:e}){if(!t)return{error:$e};let{matchUps:i,matchUpsMap:r}=xn({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=oy({drawDefinition:t,matchUpsMap:r}),{structures:s}=so({drawDefinition:t}),o=s.filter(u=>!e&&u.stage!==Mr||u.structureId===e),l={};for(let u of o){let c=u?.structureId,d=WVe({playoffPositions:n,drawDefinition:t,structure:u,matchUps:i}),{error:p,...f}=d;if(p)return d;l[c]={structureId:c,...f}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function WVe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){let n=i?.structureId,{links:a}=Zv({drawDefinition:e,structureId:n});if(i.structureType===In||i.structures){let f=Xt({structure:i})?.positionAssignments?.length,h=i.structures.length,m=(f??0)/h,g=a.source?.flatMap(({source:P})=>P?.finishingPositions||[])||[],I=Ce(1,m+1).filter(P=>!g.includes(P)),v=r.find(P=>P.containerStructureId===n&&P.finishingPositionRange)?.finishingPositionRange?.winner||[0,1],w=a?.source.map(({target:P})=>P.structureId),{positionsPlayedOff:y=[],positionsNotPlayedOff:b=[]}=oy({structureIds:w,drawDefinition:e}),S=new Set([...y,...b]),U=Ce(v[0],v[1]+1).filter(P=>!S.has(P)),T=Sr(U,U.length/I.length),D=I.map((P,E)=>{let R=T[E],C=[Math.min(...R||[]),Math.max(...R||[])].join("-");return{finishingPosition:P,finishingPositions:R,finishingPositionRange:C}});return{positionsNotPlayedOff:U,playoffFinishingPositionRanges:D,finishingPositionsAvailable:I,finishingPositionsPlayedOff:g,positionsPlayedOff:y,groupCount:h,groupSize:m}}let s=a?.source?.filter(f=>f.linkCondition!==wl).map(f=>f.source?.roundNumber)||[],o=a?.source?.filter(f=>f.linkCondition===wl).map(f=>f.source?.roundNumber)||[],l=Foe({excludeRoundNumbers:s,playoffPositions:t,drawDefinition:e,structureId:n}),u=l?.playoffSourceRounds?[...l?.playoffSourceRounds||[]]:void 0,c=[...l?.playoffRoundsRanges||[]],{roundProfile:d,error:p}=l;for(let f of o){let h=a?.source.find(w=>w.source.roundNumber===f),m=h?.target.roundNumber,g=h?.target.structureId,I=r.filter(({roundNumber:w,structureId:y})=>y===g&&w===m),v=I.filter(({sides:w})=>w.find(y=>y.participantFed&&!y.participantId)).length;if(u&&v===I.length){u.push(f);let w=d?.[f]?.finishingPositionRange?.loser;if(w){let y=Math.min(...w),b=y+v,S=Ce(y,b),U={finishingPositionRange:[y,b-1].join("-"),finishingPositions:S,roundNumber:f};c.push(U)}}}return u&&u.sort(or),c.sort((f,h)=>f.roundNumber-h.roundNumber),{playoffRounds:u,playoffRoundsRanges:c,error:p}}function zVe({playoffGroups:t,drawDefinition:e,structureId:i}){if(!e)return{error:$e};if(!ai(i)||!Array.isArray(t))return{error:re};let r=t.map(({finishingPositions:n})=>n).flat();return{positionRangeMap:lT({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges?.filter(n=>r.includes(n.finishingPosition))?.reduce((n,a)=>(n[a.finishingPosition]=a,n),{})}}function Loe(t){let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:s=ke,matchUpType:o,structureId:l,idPrefix:u,drawSize:c,isMock:d,uuids:p}=t,f={finishingPositionOffset:e,matchUpType:o,drawSize:c,idPrefix:u,isMock:d,uuids:p},{matchUps:h}=n?Od(f):Tl(f),m=cs({structureName:a||i?.["0"]?.name||Zr(ke),structureId:l||p?.pop(),stageSequence:r,matchUpType:o,matchUps:h,stage:s}),g=[m],I=[];if(c>2){let v=c/2,{matchUps:w}=Tl({finishingPositionOffset:e+v,idPrefix:u&&`${u}-c`,drawSize:v,matchUpType:o,isMock:d}),y=Zr(rn),b=i?.["0-1"]?.name??t.consolationStructureName??(a?`${a} ${y}`:y),S=cs({structureName:b,matchUps:w,structureId:p?.pop(),stage:rn,stageSequence:1,matchUpType:o});g.push(S);let U={linkType:Du,source:{roundNumber:1,structureId:m.structureId},target:{roundNumber:1,feedProfile:Fs,structureId:S.structureId}};I.push(U)}return{...W,structures:g,links:I}}function _oe({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let s=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),o=n?.roundGroupedOrder||[],l=n?.roundFeedProfiles;return Ce(1+e,r+1+e).map(u=>{let c=l?.[u-1]?l[u-1]:u%2&&Fs||Yp,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:Du,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},f=o[u-1];return f&&(p.target.groupedOrder=f),ha()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=wl,p.target.feedProfile=Fs),s.includes(d)?p:void 0}).filter(Boolean)}function $oe(t){let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:s,stage:o=ke,matchUpType:l,structureId:u,drawSize:c,idPrefix:d,isMock:p,uuids:f}=t,h={finishingPositionOffset:i,matchUpType:l,drawSize:c,idPrefix:d,isMock:p,uuids:f},{matchUps:m,roundsCount:g}=s?Od(h):Tl(h),I=t.structureName??n?.["0"]?.name??Zr(ke),v=Id({structureId:u||f?.pop(),structureName:I,stageSequence:r,matchUpType:l,matchUps:m,stage:o}),w=[v],y=[];if(c>2){let b=[0,2].slice(0,c/16).map((S,U)=>{let T=U+1,{consolationStructure:D}=qVe({idPrefix:d&&`${d}-c${U}`,structureId:f?.pop(),playoffStructureNameBase:e,playoffAttributes:n,structureNameMap:a,stageSequence:T,roundOffset:S,matchUpType:l,drawSize:c,isMock:p,index:U,uuids:f});w.push(D);let P=_oe({consolationStructure:D,roundsCount:2,mainStructure:v,roundOffset:S});return{consolationStructure:D,links:P}}).map(S=>S.links).flat();if(y.push(...b),c>=4&&c<=16||c>32){let{matchUps:S}=Tl({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),U=n?.["3-4"]?.name??Zr(ki),T=a?.[U]||U,D=e?`${e} ${T}`:T,P=Id({structureId:f?.pop(),matchUps:S,stageSequence:2,stage:ki,structureName:D,matchUpType:l}),E={linkType:Du,source:{roundNumber:g-1,structureId:v.structureId},target:{structureId:P.structureId,feedProfile:Fs,roundNumber:1}};w.push(P),y.push(E)}}return{structures:w,links:y,...W}}function qVe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:s,idPrefix:o,drawSize:l,isMock:u,index:c,uuids:d}){let p=l/(2*Math.pow(2,n)),{matchUps:f,roundsCount:h}=Od({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:o,isMock:u,uuids:d}),m=c===0&&i?.["0-1"]?.name||c===1&&i?.["0-3"]?.name||`${Zr(rn)} ${c+1}`,g=r?.[m]||m,I=t?`${t} ${g}`:g;return{consolationStructure:Id({matchUps:f,stage:rn,structureName:I,stageSequence:e,matchUpType:a,structureId:s}),consolationRoundsCount:h}}function qf(t){let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:s,stage:o=ke,structureId:l,matchUpType:u,skipRounds:c,feedRounds:d,idPrefix:p,drawSize:f,isMock:h,uuids:m,fmlc:g}=t,I=t.feedPolicy||t.policyDefinitions?.[LI]||t.appliedPolicies?.[LI],v={finishingPositionOffset:e,matchUpType:u,skipRounds:c,drawSize:f,idPrefix:p,isMock:h,uuids:m},{matchUps:w}=a?Od(v):Tl(v),y=cs({structureName:s||r?.["0"]?.name||Zr(ke),structureId:l||m?.pop(),stageSequence:i,matchUpType:u,matchUps:w,stage:o}),b=[y],S=[],U=f/2,{matchUps:T,roundsCount:D}=Od({finishingPositionOffset:U,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:U,matchUpType:u,feedRounds:d,skipRounds:c,isMock:h,uuids:m,fmlc:g});if(f>2){let P=r?.["0-1"]?.name??Zr(rn),E=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${P}`:P,R=cs({matchUps:T,structureId:m?.pop(),stage:rn,stageSequence:1,structureName:E,matchUpType:u});b.push(R);let C=_oe({consolationStructure:R,mainStructure:y,roundsCount:D,feedPolicy:I,fmlc:g});S.push(...C)}return{...W,structures:b,links:S}}function Boe({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:s,playoffGroups:o,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:f}){u=u||n?.[LI];let h="processPlayoffGroups",m=0,g=[],I=[],v=[],{error:w,positionRangeMap:y}=zVe({structureId:r,drawDefinition:s,playoffGroups:o});if(w)return q({result:{error:w},stack:h});if(!(!y||o?.every(b=>{let{finishingPositions:S=[]}=b;if(!S.length)return!1;let U=[...S].sort(or).map((T,D)=>(S[D+1]||T)-T).every(T=>T<2);return(!t||U)&&S.every(T=>y[T])})))return q({context:{validFinishingPositions:Object.values(y)},result:{error:re},stack:h});for(let b of o){let S=b.finishingPositions,U=y&&S.flatMap(N=>y[N]?.finishingPositions??[]),T=c*S.length,D=$v(T),P=D===2&&al||b.drawType||al;U&&(m=Math.min(...U)-1);let E=U&&`${Math.min(...U)}-${Math.max(...U)}`,R=b.structureName||E&&b.playoffAttributes?.[E]?.name||b.playoffAttributes?.["0"]?.name,C={addNameBaseToAttributeName:b.addNameBaseToAttributeName,playoffStructureNameBase:b.playoffStructureNameBase,finishingPositionNaming:b.finishingPositionNaming,finishingPositionLimit:b.finishingPositionLimit,structureId:b.structureId??f?.pop(),playoffAttributes:b.playoffAttributes,structureNameMap:b.structureNameMap,sequenceLimit:b.sequenceLimit,structureName:R,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:m,stage:ki,stageSequence:a,matchUpType:l,drawSize:D,isMock:p,uuids:f},M=({playoffStructures:N,playoffLinks:A})=>{let[O]=N,k=YT({playoffStructureId:O.structureId,finishingPositions:S,sourceStructureId:r});v.push(k,...A),I.push(...N),g.push({structureId:O.structureId,finishingPositions:S}),m+=T};if(P===al){let{matchUps:N}=Tl({finishingPositionLimit:m+T,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,matchUpType:l,drawSize:D,isMock:p,uuids:f}),A=cs({structureId:b.structureId??f?.pop(),matchUpFormat:e,stage:ki,structureName:R,stageSequence:a,matchUps:N});I.push(A);let O=YT({playoffStructureId:A.structureId,finishingPositions:S,sourceStructureId:r});v.push(O),m+=T,g.push({structureId:A.structureId,finishingPositions:S})}else if([kI,OI,MU].includes(P)){let N={playoffAttributes:b.playoffAttributes??i,playoffStructureNameBase:b.playoffStructureNameBase,structureId:b.structureId??f?.pop(),structureName:b.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:m,stage:ki,roundOffset:0,stageSequence:a,drawSize:D,isMock:p,uuids:f};P===kI?Object.assign(N,{playoffAttributes:b?.playoffAttributes??i??g2,roundOffsetLimit:3}):P===OI&&Object.assign(N,{playoffAttributes:b?.playoffAttributes??i??I2,roundOffsetLimit:2});let A=Jg(N);if(A.error)return A;if(A.links?.length&&v.push(...A.links),A.structures?.length&&I.push(...A.structures),I.sort(Ym),A.structureId){let O=YT({playoffStructureId:A.structureId,finishingPositions:S,sourceStructureId:r});v.push(O),g.push({structureId:A.structureId,finishingPositions:S})}m+=T}else if([xI,CU,pw,dw,cw,fw].includes(P)){let N=[f?.pop(),f?.pop()],A={playoffStructureNameBase:b.playoffStructureNameBase,structureId:b.structureId??f?.pop(),playoffAttributes:b.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,uuids:N,stage:ki,structureName:R,matchUpType:l,feedPolicy:u,drawSize:D,isMock:p},O={[xI]:{fmlc:!0,feedRounds:1},[fw]:{feedRounds:1},[pw]:{feedsFromFinal:3},[dw]:{feedsFromFinal:2},[cw]:{feedsFromFinal:1}};Object.assign(A,O[P]||{});let{structures:k,links:F}=qf(A),[x]=k,L=YT({playoffStructureId:x.structureId,finishingPositions:S,sourceStructureId:r});v.push(L,...F),I.push(...k),g.push({structureId:x.structureId,finishingPositions:S}),m+=T}else if([no].includes(P)){let{structures:N,links:A}=iT({...C,structureOptions:b.structureOptions||{groupSize:4}});M({playoffStructures:N,playoffLinks:A})}else if([RU].includes(P)){let{structures:N,links:A}=Loe(C);M({playoffStructures:N,playoffLinks:A})}else if([y_e].includes(P)){let{structures:N,links:A}=$oe(C);M({playoffStructures:N,playoffLinks:A})}else if([ma].includes(P)){let N=cs({structureId:b.structureId??f?.pop(),structureName:b.structureName,finishingPosition:OD,stage:ki,stageSequence:a,matchUps:[]});M({playoffStructures:[N],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:y,structures:I,links:v}}function YT({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:Uu,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:So,roundNumber:1}}}function YVe(t){let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return q({result:{error:Je},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:s,groupCount:o,groupSize:l,event:u}=t,c=Boe({requireSequential:r,sourceStructureId:i,playoffGroups:s,groupCount:o,...t});if(c.error)return q({result:c,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:f,positionRangeMap:h}=c,m=f?.flatMap(({finishingPositions:T})=>T).flatMap(T=>h[T].finishingPositions);a.structures.push(...d),a.links.push(...p);let{matchUps:g,matchUpsMap:I}=nr({inContext:!0,drawDefinition:a}),v=new Set(d.map(({structureId:T})=>T)),w=g?.filter(({structureId:T})=>v.has(T)).map(yr),y=I?.drawMatchUps?.filter(({matchUpId:T})=>w?.includes(T));if(y?.length){let T=bn({drawDefinition:a,event:u})?.tieFormat;T&&y.forEach(D=>{let{tieMatchUps:P}=sg({isMock:t.isMock,tieFormat:T,matchUp:D});Object.assign(D,{tieMatchUps:P,matchUpType:Wa})})}let{positionAssignments:b}=Xt({structureId:i,drawDefinition:a}),S={};b?.forEach(T=>{let D=rt({element:T,name:Nc})?.extension?.value?.groupOrder;D&&(S[D]||(S[D]=[]),S[D].push(T.participantId))});let U=sy({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:n,drawDefinition:a});return U.error&&U.error?.code!==MB.code?q({result:U,stack:e}):{structures:d,links:p,positionsPlayedOff:m,drawDefinition:a,...W}}function HV({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!is(n))return{error:re};if(!t)return{error:re};let{policyDefinitions:s}=Kc({policyTypes:[E2],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:o}=gV({positionAssignments:t}),l=n.length?tg({policyDefinitions:s,matchUpFormat:r,subOrderMap:o,matchUps:n}):void 0;if(l?.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(f=>{let{participantId:h}=f;if(p.includes(h)){let m={value:u[h],name:Nc};It({element:f,extension:m}),u[h].ties||On({element:f,name:_I})}else On({element:f,name:Nc}),On({element:f,name:_I})}),ri({drawDefinition:i}),{...W,participantResults:u,bracketComplete:c,report:d}}function Voe({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function hi(t){let e=He(t,[{[vn]:!0,[Ol]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:s,matchUpId:o,inContext:l,context:u,event:c}=t,{structures:d=[]}=so({drawDefinition:a}),p=t.contextContent||n&&Xc({contextProfile:n,drawDefinition:a});for(let f of d){let{matchUps:h}=Ot({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:s,inContext:l,structure:f,context:u,event:c}),{matchUp:m}=Voe({matchUps:h,matchUpId:o});if(m)return{matchUp:m,structure:f}}return{error:pn}}function LN(t){return!Ut(t)||!t.notes?{error:Je}:Ut(t.element)?!ai(t.notes)&&!t.notes?.testing?{error:re}:(Object.assign(t.element,{notes:t.notes}),{...W}):{error:re}}function WV(t){return Ut(t)?Ut(t.element)?(t.element.notes&&delete t.element.notes,{...W}):{error:re}:{error:Je}}var _N={matchUpStatus:$i,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Co(t){let e="modifyMatchUpScore",i=t.matchUpFormat,r=t.matchUp,n,{matchUpStatusCodes:a,tournamentRecord:s,drawDefinition:o,matchUpStatus:l,removeScore:u,winningSide:c,matchUpId:d,event:p,notes:f,score:h}=t,m=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:Ct({policyTypes:[vs],tournamentRecord:s,drawDefinition:o,structure:n,event:p})?.appliedPolicies,g=r.matchUpType===ti;if(g&&o){if(d&&r.matchUpId!==d){let U=hi({drawDefinition:o,matchUpId:d,event:p});if(!U.matchUp)return{error:pn};({matchUp:r,structure:n}=U)}}else r.matchUpId!==d&&console.log("!!!!!");l&&[si,Ui].includes(l)||u?Object.assign(r,{..._N}):h&&(r.score=h);let I=l&&r?.matchUpStatus===Yt&&l!==Yt;l&&(r.matchUpStatus=l),i&&(r.matchUpFormat=i),a&&(r.matchUpStatusCodes=a),c&&(r.winningSide=c),t.removeWinningSide&&(r.winningSide=void 0),!n&&o&&({structure:n}=hi({drawDefinition:o,matchUpId:d,event:p})),l&&!r.winningSide&&hr(r)&&!Qi.includes(l)&&![qm,tp,Na].includes(l)&&(r.matchUpStatus=ho);let v;if((I&&r?.processCodes?.length||l===Yt)&&(v=m?.[vs]?.processCodes?.incompleteAssignmentsOnDefault),!r.collectionId){let U=n?.structureType===In,T=Yn({structure:n});if(iV({drawDefinition:o,structure:n})||T||U){let D=R=>{i=g?"SET1-S:T100":i??r.matchUpFormat??R?.matchUpFormat??o?.matchUpFormat??p?.matchUpFormat;let C=g?{matchUpTypes:[ti]}:void 0,{matchUps:M}=Ot({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:C,drawDefinition:o,structure:R,event:p});return T&&(R.positionAssignments=lt(M.flatMap(N=>(N.sides??[]).map(A=>A.participantId)).filter(Boolean)).map(N=>({participantId:N}))),HV({positionAssignments:R.positionAssignments,tournamentRecord:s,drawDefinition:o,matchUpFormat:i,matchUps:M,event:p})},P=U&&n.structures.find(R=>R?.matchUps.find(C=>C.matchUpId===d)),E=D(P||n);if(E.error)return q({result:E,stack:e})}}if(f){let U=LN({element:r,notes:f});if(U.error)return q({result:U,stack:e})}let w=s?.tournamentId,y=Ts().topics.includes(hN),b=(y||v)&&xr({drawDefinition:o}),S=b&&nr({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:o,matchUpsMap:b}).matchUps?.[0];if(y&&S&&r$e({tournamentId:w,inContextMatchUp:S}),Array.isArray(v)&&S&&!S.sides?.every(({participantId:U})=>U))if(l===Yt)r.processCodes=lt([...r.processCodes??[],...v]);else for(let U of v||[]){let T=U&&r?.processCodes?.lastIndexOf(U);r?.processCodes?.splice(T,1)}return Dt({eventId:p?.eventId,context:e,drawDefinition:o,tournamentId:w,matchUp:r}),{...W}}function zV(t){let{propagateExitStatus:e,matchUpStatusCodes:i,autoCalcDisabled:r,inContextMatchUp:n,matchUpStatus:a,dualMatchUp:s,structure:o,matchUp:l}=t,u=JU({matchUpStatus:a})||[Fl,Ma].includes(a)&&s||r,c=l?.sides?.map(m=>m.participantId).filter(Boolean).length||n?.sides?.map(m=>m.participantId).filter(Boolean).length,d="attemptToModifyScore";if(!(Yn({structure:o})&&c===1||a===Yt&&c||KVe({structure:o,matchUp:l,inContextMatchUp:n})||t.appliedPolicies?.[vs]?.requireParticipantsForScoring===!1||Br(a)&&c===1&&e))return q({result:{error:LB},stack:d});let p=[si].includes(a),f=u?a:t.winningSide&&xi||Na,h=Co({...t,winningSide:t.winningSide,matchUpStatusCodes:u&&i||[],matchUpStatus:f,removeScore:p});return q({result:h,stack:d})}function KVe({structure:t,matchUp:e,inContextMatchUp:i}){let{drawPositions:r}=e,{positionAssignments:n}=fr({structure:t}),a=n?.filter(o=>r?.includes(o.drawPosition)&&o.participantId),s=i?.sides?.every(o=>o.participantId);return a?.length===2||s}function joe({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>ct(r?.groupValue)&&r?.groupNumber).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>Ke(r));return{groupValueGroups:e,groupValueNumbers:i}}function XVe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(v=>v.collectionId===t.collectionId),s=[0,0],o=[0,0],l=a.every(v=>Qi.includes(v.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:f,scoreValue:h,setValue:m}=t,g=c&&e.includes(c),I=[0,0];if(a.forEach(v=>{v.winningSide&&(I[v.winningSide-1]+=1)}),ct(p)?a.forEach(v=>{v.winningSide&&(s[v.winningSide-1]+=p)}):ct(m)?a.forEach(v=>{v.score?.sets?.forEach(w=>{w.winningSide&&(s[w.winningSide-1]+=m)})}):ct(h)?a.forEach(v=>{v.score?.sets?.forEach(w=>{let{side1TiebreakScore:y=0,side2TiebreakScore:b=0,side1Score:S=0,side2Score:U=0}=w;(v.matchUpStatus===xi||v.winningSide||w.winningSide)&&(S||U?(s[0]+=S,s[1]+=U):(y||b)&&w.winningSide&&(s[w.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(v=>{if(v.winningSide){let w=v.collectionPosition,y=JVe({collectionDefinition:t,collectionPosition:w});ct(y)&&(s[v.winningSide-1]+=y)}}),ct(d)){let v;if(f?.aggregateValue)l&&(ct(p||m||h)&&s[0]!==s[1]?v=s[0]>s[1]?1:2:I[0]!==I[1]&&(v=I[0]>I[1]?1:2));else if(f?.valueGoal)v=s.reduce((w,y,b)=>y>=f.valueGoal?b+1:w,0);else{let w=Math.floor(t.matchUpCount/2)+1;v=I.reduce((y,b,S)=>b>=w?S+1:y,0)}v&&(g?i[c].values[v-1]+=d:o[v-1]+=d)}else g?(i[c].values[0]+=s[0]||0,i[c].values[1]+=s[1]||0):o=s;g?(i[c].sideWins[0]+=I[0]||0,i[c].sideWins[1]+=I[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):o.forEach((v,w)=>r[w]+=v||0)}function JVe({collectionDefinition:t,collectionPosition:e}){return(t.collectionValueProfiles||[])?.find(i=>i.collectionPosition===e)?.matchUpValue}function uT(t){let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:s,event:o}=t;if(!Array.isArray(e)||e.length!==2||Number.isNaN(e.reduce((y,b)=>y+b)))return{error:re};if(!s)return{error:pa};let l=bn({matchUp:s,drawDefinition:r,structure:a,event:o})?.tieFormat||t?.tieFormat;if(!l)return{error:jv};let u=qn({tieFormat:l});if(u.error)return u;let c=l?.collectionDefinitions||[],d=s?.tieMatchUps??[],p=[0,0],{groupValueGroups:f,groupValueNumbers:h}=joe(l);for(let y of c)XVe({collectionDefinition:y,groupValueNumbers:h,groupValueGroups:f,sideTieValues:p,tieMatchUps:d});for(let y of h){let b=f[y],{allGroupMatchUpsCompleted:S,matchUpCount:U,winCriteria:T,groupValue:D,sideWins:P,values:E}=b,R;if(T?.aggregateValue)S&&E[0]!==E[1]&&(R=E[0]>E[1]?1:2);else if(T?.valueGoal)R=E.reduce((C,M,N)=>M>=T.valueGoal?N+1:C,void 0);else{let C=Math.floor(U/2)+1;R=P.reduce((M,N,A)=>N>=C?A+1:M,void 0)}R&&(p[R-1]+=D||0)}let m=p.map((y,b)=>(y||0)+e[b]),g={side1Score:m[0],side2Score:m[1],winningSide:void 0},I=m.join(i),v=m.slice().reverse().join(i),w;if(l?.winCriteria){let{valueGoal:y,aggregateValue:b,tallyDirectives:S}=l.winCriteria;if(y?w=m.map((U,T)=>({sideNumber:T+1,points:U})).find(({points:U})=>U>=y)?.sideNumber:b&&d.every(U=>U.matchUpStatus&&Qi.includes(U.matchUpStatus)||U.winningSide)&&m[0]!==m[1]&&(w=m[0]>m[1]?1:2),!w&&S){let U=s.matchUpId,T=s.hasContext?s:n?.drawMatchUps?.[U]||r&&hi({inContext:!0,drawDefinition:r,matchUpId:U})?.matchUp;if(T){let{completedTieMatchUps:D,order:P}=tg({matchUps:[T]});if(D&&P?.length){let E=P[0].participantId;w=T.sides.find(({participantId:R})=>R===E)?.sideNumber}}}}return w&&(g.winningSide=w),{scoreStringSide1:I,scoreStringSide2:v,winningSide:w,set:g}}function cT({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){if(r){t||(t=hi({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e})?.matchUp);let{extension:a}=rt({element:e,name:Cc}),s=xe(a?.value||{},!1,!0),o=({displaySideNumber:l,drawPosition:u,sideNumber:c})=>({drawPosition:u,sideNumber:c,displaySideNumber:l});r.sides=t?.sides?.map(l=>{let u=l.participantId,c=u&&s[u]||void 0,{lineUp:d,...p}=r.sides?.find(({sideNumber:h})=>h===l.sideNumber)??{},f=d?.length?d:c;return{...o(l),...p,lineUp:f}}),Dt({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function zr(t){if(t)return xe(t,!1,!0)}function qV(t){let e=He(t,[{[fn]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:o})=>o),s=n.map(o=>(o.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...s),i.eventIds.push(...a),i.drawIds.push(...s),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function Goe({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=qV({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&r?.[n].includes(e)||i&&r?.[n].includes(i))}function Jc(t){let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:s,event:o}=t,l=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord?.tournamentId]:t.tournamentRecord}||{},u=t.tournamentId||t.tournamentRecord?.tournamentId;l&&Goe({tournamentRecords:l,...t});let c=u&&l[u];if(!c)return{error:Ie};let d=hi({drawDefinition:i,event:o,matchUpId:s});if(d.error)return d;if(!d.matchUp)return{error:pn};let{matchUp:p,structure:f}=d;if(!p.tieMatchUps)return{error:fa};cT({tournamentId:c?.tournamentId,eventId:o?.eventId,dualMatchUp:p,drawDefinition:i});let{extension:h}=rt({name:Jh,element:p});if(h?.value)if(n)On({element:p,name:Jh});else return{...W,score:p.score};let m=bn({drawDefinition:i,structure:f,matchUp:p,event:o})?.tieFormat;p.tieFormat=zr(m);let g=uT({drawDefinition:i,matchUpsMap:a,structure:f,matchUp:p,event:o}),{winningSide:I,set:v,scoreStringSide1:w,scoreStringSide2:y}=g,b=v?.side1Score||v?.side2Score;if(e&&!p.score&&!b)return{...W};let S={scoreStringSide1:w,scoreStringSide2:y,sets:v?[v]:[]},U=I&&[1,2].includes(I),T=U&&xi||cV({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:S})&&ho||$i,D=!!(p.winningSide&&!U),P=p.tieMatchUps.find(({score:R,winningSide:C,matchUpStatus:M})=>R?.sets?.length&&(R.sets[0].side1Score||R.sets[0].side2Score)||M&&Qi.includes(M)||C),E;if(p.tieFormat&&!U&&!P){let R=bn({drawDefinition:i,structure:f,event:o})?.tieFormat;R&&JSON.stringify(m)===JSON.stringify(R)&&(p.tieFormatId=void 0,p.tieFormat=void 0,E=!0)}return Co({appliedPolicies:t.appliedPolicies,matchUpStatus:T,score:S,removeWinningSide:D,tournamentRecord:c,drawDefinition:i,removeScore:n,winningSide:I,matchUpId:s,matchUp:p,event:o}),{...W,score:S,removeWinningSide:D,tieFormatRemoved:E,winningSide:I}}function QVe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:s,sourceMatchUpId:o,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){let f="directWinner";if(s){let h=u.drawPositions||[],m=h[t],g=s.source.structureId,I=tt({structureId:g,drawDefinition:l});if(I.error)return I;let{structure:v}=I,{positionAssignments:w}=fr({structureId:g,drawDefinition:l}),y=w?.find(P=>P.drawPosition===n)?.participantId,b=s.target.structureId,{positionAssignments:S}=fr({structureId:b,drawDefinition:l}),U=S?.find(P=>P.participantId===y)?.drawPosition,T=S?.filter(P=>{let E=h.includes(P.drawPosition),R=!P.participantId&&!P.bye&&!P.qualifier;return E&&R}).map(P=>P.drawPosition),D=T?.includes(m);if(y&&s.target.roundNumber===1&&D)Ul({drawPosition:m,participantId:y,structureId:b,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(y&&T?.length){let P=T.pop();P&&Ul({participantId:y,structureId:b,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:P,matchUpsMap:d,event:p})}else if(U){let P=Th({drawPosition:U,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(P.error)return q({result:P,stack:f})}else if(v?.stage!==ze){let P="winner target position unavaiallble";console.log(P),q({stack:f,result:{error:P}})}if(v?.seedAssignments&&v.structureId!==b){let P=v.seedAssignments.find(({participantId:R})=>R===y),E=P?.participantId;P&&E&&ay({eventId:u?.eventId,structureId:b,...P,tournamentRecord:a,drawDefinition:l,participantId:E})}}else{let h=Th({matchUpId:u.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(h.error)return h}if(c&&i){let h=c.sides?.find(m=>m.sideNumber===i);if(h?.lineUp){let m=c.roundPosition,g=u.roundPosition,I=m===g&&m!==1||Math.floor(m/2)===g?2:1,v=d?.drawMatchUps?.find(({matchUpId:b})=>b===u.matchUpId),w=[1,2].map(b=>({...v.sides?.find(S=>S.sideNumber===b)||{},sideNumber:b}));v.sides=w;let y=v.sides.find(b=>b.sideNumber===I);if(y){let b=h.lineUp?.filter(S=>S?.participantId);y.lineUp=CV({lineUp:b}),Dt({tournamentId:a?.tournamentId,eventId:u?.eventId,matchUp:v,context:f,drawDefinition:l})}}}return{...W}}function ZVe(t){let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:r,propagateExitStatus:n,sourceMatchUpStatus:a,loserDrawPosition:s,tournamentRecord:o,loserTargetLink:l,drawDefinition:u,loserMatchUp:c,dualMatchUp:d,matchUpsMap:p,event:f}=t,h="directLoser",m=l.linkCondition,g=c.drawPositions||[],I=m===wl&&c.roundNumber===2&&Math.min(...g.filter(Boolean)),v=I||g[e],w=I||g[1-e],y=l.source.structureId,{structure:b}=tt({structureId:y,drawDefinition:u}),{matchUps:S}=Ot({afterRecoveryTimes:!1,inContext:!0,drawDefinition:u,structure:b,event:f}),U=S.filter(_=>_.drawPositions?.includes(s)).filter(_=>{let B=_.sides.find(j=>j.drawPosition===s),G=_.matchUpStatus===si||_.matchUpStatus===Yt&&!hr(_);return B?.sideNumber===_.winningSide&&!G}),T=m===wl&&U.length===0,{positionAssignments:D}=fr({structureId:y,drawDefinition:u}),P=D?.find(_=>_.drawPosition===s)?.participantId,E={loserParticipantId:P},R=l.target.structureId,{positionAssignments:C}=fr({structureId:R,drawDefinition:u}),M=C?.filter(({drawPosition:_})=>g.includes(_)),N=M?.some(_=>_.participantId&&P&&_.participantId===P),A=n&&[Ur,si,Yt].includes(a||"");if(N)return{...W,stack:h};let O=M?.filter(_=>{let B=g.includes(_.drawPosition),G=!_.participantId&&!_.bye&&!_.qualifier;return B&&G}).map(_=>_.drawPosition),k=O?.includes(v),F=l.target.roundNumber>1&&O?.length,x=l.target.roundNumber===1&&k;if(I){let _=L();if(_.context&&Object.assign(E,_.context),_.error)return q({result:_,stack:h})}else if(x){let _=V();if(_.context&&Object.assign(E,_.context),_.error)return q({result:_,stack:h})}else if(P&&F){O.sort(or);let _=O[0],B=Ul({participantId:P,structureId:R,drawPosition:_,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:u,matchUpsMap:p,event:f});if(B.error)return q({result:B,stack:h});if(!B.error&&A&&n)return{stack:h,context:{progressExitStatus:!0,loserParticipantId:P}}}else return q({context:{loserDrawPosition:s,loserTargetLink:l,targetDrawPositionIsUnfilled:k},result:{error:k?_m:BLe},stack:h});if(b?.seedAssignments&&b.structureId!==R){let _=b.seedAssignments.find(({participantId:G})=>G===P),B=_?.participantId;_&&B&&ay({eventId:c?.eventId,structureId:R,..._,tournamentRecord:o,drawDefinition:u,participantId:B})}if(d&&r){let _=d.sides?.find(B=>B.sideNumber===3-r);if(_?.lineUp){let{roundNumber:B,eventId:G}=c,{roundPosition:j}=d,Y=B===1?2-j%2:1,K=p?.drawMatchUps?.find(({matchUpId:Q})=>Q===c.matchUpId),X=[1,2].map(Q=>({...K.sides?.find(ae=>ae.sideNumber===Q)||{},sideNumber:Q}));K.sides=X;let Z=K.sides.find(Q=>Q.sideNumber===Y);Z&&(Z.lineUp=CV({lineUp:_.lineUp}),Dt({tournamentId:o?.tournamentId,matchUp:K,context:h,drawDefinition:u,eventId:G}))}}return q({result:{...W},stack:h,context:E});function L(){let _="loserLinkFedFMLC";return q(T?{result:V(),stack:_}:{result:$(),stack:_})}function $(){let _=ns({drawPosition:w,structureId:R,tournamentRecord:o,drawDefinition:u,event:f});return q({result:_,stack:"assignLoserPositionBye"})}function V(){let _=P?Ul({drawPosition:v,participantId:P,structureId:R,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:u,matchUpsMap:p,event:f}):{error:pr};return!_.error&&A&&n?{stack:h,context:{progressExitStatus:!0}}:q({result:_,stack:"assignLoserDrawPosition"})}}function Hoe(t){let e="directParticipants",i=zV(t);if(i.error)return q({result:i,stack:e});let r=JU({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,matchUpStatusCodes:l,tournamentRecord:u,drawDefinition:c,matchUpStatus:d,dualMatchUp:p,matchUpsMap:f,winningSide:h,targetData:m,matchUpId:g,structure:I,matchUp:v,event:w}=t,y=!!v.collectionId,b=Yn({structure:I}),S=v.drawPositions,U;if(y){let{matchUpTieId:T,matchUpsMap:D}=t,P=Jc({appliedPolicies:t.appliedPolicies,matchUpId:T,tournamentRecord:u,drawDefinition:c,matchUpsMap:D,event:w});if(U=P&&{tieMatchUpResult:P},S=a.find(({matchUpId:E})=>E===T)?.drawPositions,!n)return q({result:{...W,...U},stack:e})}if(b)return q({result:{...W,...U},stack:e});if(S){let T=s?s-1:h-1,D=1-T,P=S[T],E=S[D],R={},{targetLinks:{loserTargetLink:C,winnerTargetLink:M,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:A,loserMatchUpDrawPositionIndex:O,winnerMatchUp:k,loserMatchUp:F,byeMatchUp:x}}=m;if(k){let L=QVe({sourceMatchUpStatus:r&&d||xi,winnerMatchUpDrawPositionIndex:A,sourceMatchUpId:g,inContextDrawMatchUps:a,projectedWinningSide:s,winningDrawPosition:P,tournamentRecord:u,winnerTargetLink:M,drawDefinition:c,winnerMatchUp:k,dualMatchUp:p,matchUpsMap:f,event:w});if(L.error)return q({result:L,stack:e})}if(F){let L=ZVe({sourceMatchUpStatus:r&&d||xi,loserMatchUpDrawPositionIndex:O,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,loserDrawPosition:E,tournamentRecord:u,loserTargetLink:C,drawDefinition:c,loserMatchUp:F,matchUpsMap:f,dualMatchUp:p,event:w});if(L.context?.progressExitStatus&&Object.assign(R,L.context,{sourceMatchUpStatus:r&&d||xi,sourceMatchUpStatusCodes:l||[],loserMatchUp:F,matchUpsMap:f}),L.error)return q({result:L,stack:e})}if(x){let L=x.drawPositions||[],$=Math.min(...L.filter(Boolean)),V=N.target.structureId,_=ns({drawPosition:$,structureId:V,tournamentRecord:u,drawDefinition:c,event:w});if(_.error)return q({result:_,stack:e})}return q({result:{...W,...U},stack:e,context:R})}else return q({result:{error:hU},stack:e})}function YV(t){let e="genPlayoffStructure";if(!t.drawDefinition)return q({result:{error:$e},stack:e});let i=lT(t);if(i.error)return q({result:i,stack:e});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:s,finishingPositionLimit:o,playoffAttributes:l,playoffPositions:u,roundOffsetLimit:c,tournamentRecord:d,exitProfileLimit:p,roundProfiles:f,roundNumbers:h,idPrefix:m,isMock:g,event:I,uuids:v}=t,w=xe(t.drawDefinition,!1,!0),{structure:y}=tt({structureId:r,drawDefinition:w});if(!y)return q({result:{error:yi},stack:e});if(y.structureType===In||y.structures)return YVe({sourceStructureId:y.structureId,...t,...i,drawDefinition:w});let{playoffRoundsRanges:b,playoffRounds:S}=i,{playoffPositionsReturned:U,error:T,playoffSourceRounds:D,playoffRoundsRanges:P}=Foe(t);if(T)return q({result:{error:T},stack:e});let E=f?.length&&Object.assign({},...f),R=h||typeof f=="object"&&f.map(j=>Object.keys(j)).flat(),C=Array.isArray(R)&&R.map(j=>!isNaN(j)&&Ke(j)).filter(Boolean);if(C){if(!Array.isArray(C))return q({result:{error:re},context:{validRoundNumbers:C},stack:e});C.forEach(j=>{if(!S?.includes(j))return q({result:{error:re},context:{roundNumber:j},stack:e})})}u&&u.forEach(j=>{if(!U?.includes(j))return q({result:{error:re},context:{playoffPosition:j},stack:e})});let M=C||D,N=C?b:P,A=[],O=[];for(let j of M??[]){let Y=N?.find(le=>le.roundNumber===j);if(!Y)return q({result:{error:re},context:{roundNumber:j},stack:e});let K=Y.finishingPositions.length,X=Math.min(...Y.finishingPositions)-1,Z=2,Q=j&&E?.[j]&&Z+E[j]-1,ae=Jg({exitProfile:`0-${j}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:X,playoffAttributes:l,exitProfileLimit:p,stage:ki,roundOffset:0,drawDefinition:w,sequenceLimit:Q,stageSequence:Z,drawSize:K,idPrefix:m,isMock:g,uuids:v,finishingPositionNaming:s,finishingPositionLimit:o,roundOffsetLimit:c});if(ae.error)return q({result:ae,stack:e});let{structures:te,links:ne}=ae;if(te?.length&&A.push(...te),ne?.length&&O.push(...ne),ae.structureId&&j){let le={linkType:Du,source:{structureId:r,roundNumber:j},target:{structureId:ae.structureId,feedProfile:Fs,roundNumber:1}};O.push(le)}}if(!A.length)return q({result:{error:re},info:"No structures generated",stack:e});w.structures.push(...A),w.links.push(...O);let{matchUps:k,matchUpsMap:F}=nr({inContext:!0,drawDefinition:w}),x=A.map(({structureId:j})=>j),L=k?.filter(({structureId:j})=>x.includes(j)).map(yr),$=F?.drawMatchUps?.filter(({matchUpId:j})=>L?.includes(j));if($?.length){let j=bn({drawDefinition:w,event:I})?.tieFormat;j&&$.forEach(Y=>{let{tieMatchUps:K}=sg({matchUp:Y,tieFormat:j,isMock:g});Object.assign(Y,{tieMatchUps:K,matchUpType:ti})})}k?.filter(j=>Dp({matchUp:j})&&j.structureId===r)?.forEach(j=>{let{matchUpId:Y,score:K,winningSide:X}=j,Z=Bn({inContextDrawMatchUps:k,drawDefinition:w,matchUpId:Y}),Q=Hoe({inContextDrawMatchUps:k,tournamentRecord:d,drawDefinition:w,matchUpsMap:F,winningSide:X,targetData:Z,matchUpId:Y,structure:y,matchUp:j,score:K,event:I});Q.error&&console.log(Q.error)}),k?.filter(j=>j.matchUpStatus==="BYE"&&j.structureId===r)?.forEach(j=>{let{matchUpId:Y}=j,K=Bn({inContextDrawMatchUps:k,drawDefinition:w,matchUpId:Y}),{targetLinks:{loserTargetLink:X},targetMatchUps:{loserMatchUpDrawPositionIndex:Z,loserMatchUp:Q}}=K;if(X&&Q){let ae=X.target.structureId,te=Q.drawPositions[Z],ne=ns({drawPosition:te,structureId:ae,tournamentRecord:d,drawDefinition:w,event:I});ne.error&&console.log(ne.error)}});let V=[],_=Qp({inContextDrawMatchUps:k,drawDefinition:w,matchUpsMap:F}).goesToMap,{structure:B}=tt({drawDefinition:t.drawDefinition,structureId:r}),{matchUps:G}=Ot({structure:B});return G.forEach(j=>{let Y=_?.loserMatchUpIds[j.matchUpId];if(Y&&j.loserMatchUpId!==Y){j.loserMatchUpId=Y;let X={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:j};V.push(X)}let K=_?.winnerMatchUpIds[j.matchUpId];if(K&&j.winnerMatchUpId!==K){j.winnerMatchUpId=K;let X={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:j};V.push(X)}}),{structures:A,matchUpModifications:V,links:O,drawDefinition:w,...W}}function Woe({element:t}){if(!t)return{error:re};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:re};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function Ll(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:YB};let a=Gae(t);if(a.error)return a;if(!(Ut(n)&&ai(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:qB};if(!a.timeItems)a.timeItems=[];else if(eje({element:a,duplicateValues:e,timeItem:n}))return{...W};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let s=new Date().toISOString();Object.assign(n,{createdAt:s})}return r&&(a.timeItems=a.timeItems.filter(({itemType:s})=>n.itemType!==s)),r&&!n.itemValue||a.timeItems.push(n),{...W}}function eje({element:t,duplicateValues:e,timeItem:i}){let{itemType:r,itemSubTypes:n,itemValue:a}=i,s=r&&Ps({itemSubTypes:n,itemType:r,element:t})?.timeItem;return s&&JSON.stringify(s?.itemValue)===JSON.stringify(a)&&!e}function KV({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:Ie};if(!n)return{error:pr};let s=ip({tournamentRecord:i,participantId:n});return s.error?s:Ll({element:s.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function dT(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:Ie};let s=Ll({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(s.error)return s;let o=Woe({element:i});return at({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:o},topic:Df}),s}function og(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?Ll({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:gs}}function zoe(t){return $N({...t,itemType:"attachConsolationStructures"})}function XV(t){return $N({...t,itemType:"attachPlayoffStructures"})}function $N({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:s}){let o="attachStructures";if(!r)return{error:$e};if(!Array.isArray(n)||!Array.isArray(a))return q({result:{error:re},stack:o});let l=g=>[g.source.structureId,g.source.roundNumber||g.source.finishingPositions?.join("|"),g.target.roundNumber].join("|"),u=r.links?.map(l);if(a.some(g=>{let I=l(g);return u?.includes(I)}))return q({result:{error:e2},info:"playoff structure exists",stack:o});a.length&&r.links?.push(...a);let c=n.map(({structureId:g})=>g),d=r.structures?.map(({structureId:g})=>g);r.structures=(r.structures??[]).map(g=>c.includes(g.structureId)?n.find(({structureId:I})=>I===g.structureId):g);let p=n?.filter(({structureId:g})=>!d?.includes(g));p.length&&r.structures.push(...p),Qp({drawDefinition:r});let f=n.map(g=>Ot({structure:g})?.matchUps||[]).flat();Nd({tournamentId:i?.tournamentId,eventId:s?.eventId,drawDefinition:r,matchUps:f});let h=n.map(({structureId:g})=>g);if(ri({drawDefinition:r,structureIds:h}),e?.length){let g={};e.forEach(v=>{let w=v.matchUp?.matchUpId;w&&(g[w]=v)});let I=v=>{v.matchUps.forEach(w=>{if(g[w.matchUpId]){let{tieMatchUps:y,...b}=g[w.matchUpId].matchUp;if(Object.assign(w,b),y?.length){let S={};y.forEach(U=>g[U.matchUpId]=U),w.tieMatchUps.forEach(U=>Object.assign(U,S[U.matchUpId]))}g[w.matchUpId].matchUp=w,Dt(g[w.matchUpId])}})};r.structures.forEach(v=>{if(d?.includes(v.structureId))if(v.structures)for(let w of v.structures)I(w);else I(v)})}let m=p.map(Aa("structureId"));if(i){let g={itemValue:{structureIds:h,drawId:r.drawId},itemType:t};Ll({element:i,timeItem:g})}return{...W,addedStructureIds:m}}function BN(t){let{structures:e,links:i,matchUpModifications:r,error:n}=YV(t);if(n)return{error:n};let a=t.drawDefinition;return XV({tournamentId:t.tournamentRecord?.tournamentId,eventId:t.event?.eventId||t.eventId,matchUpModifications:r,drawDefinition:a,structures:e,links:i})}function ef(t){let e=He(t,[{_anyOf:{[fn]:!1,[gr]:!1,[vn]:!1,[qc]:!1},[v2]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=h3(t,r);if(n.error)return n;i.push(...n?.applied??[]),t.drawDefinition&&ri({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:Ie};for(let a of n){let s=t.tournamentRecords[a],o=h3(t,s);if(o.error)return o;i.push(...o?.applied??[])}}else return{error:Ie};return i.length?{...W,applied:i}:{error:BB}}function h3(t,e){let i=Ct(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:OM};for(let a of n)if(!i[a]||t.allowReplacement){let s=t.policyDefinitions[a];if(!s)continue;if(!Ut(s))return{error:re};let{policyName:o,...l}=s;if(!l||!Object.keys(l).length||o&&!ai(o))return{error:re};i[a]=t.policyDefinitions[a],r.push(a)}return r?.length?{...It({element:e,extension:{name:gw,value:i}}),applied:r}:{applied:r,error:BB}}function JV({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){if(!r||typeof r!="string")return q({result:{error:re},context:{drawName:r}});i||(i=Vi({event:a}).flightProfile);let s=i?.flights?.find(o=>o.drawId===n);if(s){s.drawName=r;let o={name:ao,value:{...i,flights:i.flights}};ep({event:a,extension:o})}return e&&(e.drawName=r,ri({tournamentId:t?.tournamentId,drawDefinition:e})),!s&&!e?{error:$e}:{...W,flight:s}}function qoe({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){if(!Ut(i))return{error:re};let a=Vi({event:n}).flightProfile,s=i.drawName&&JV({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:r,event:n});if(s?.error)return s?.error;let o=s?.flight||a?.flights?.find(l=>l.drawId===r);if(!o&&!e)return{error:$e};if(o){let l={name:ao,value:{...a,flights:a.flights}};ep({event:n,extension:l})}return e&&(i.policyDefinitions&&ef({policyDefinitions:i.policyDefinitions,drawDefinition:e}),ri({tournamentId:t?.tournamentId,drawDefinition:e})),{...W}}function Yoe({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){if(!i)return{error:$e};let r=xr({drawDefinition:i}),n=s=>r?.drawMatchUps?.find(o=>o.matchUpId===s);for(let s of i.structures||[]){let{positionAssignments:o,stage:l,stageSequence:u}=s;o&&(u!==1||![ze,ke].includes(l))&&(s.positionAssignments=o.map(p=>(delete p.participantId,p)),s.seedAssignments=[]);let{matchUps:c,isRoundRobin:d}=Ot({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:s});for(let p of c){let{matchUpId:f,roundNumber:h}=p,m=p.sides||[],g=n(f);if(g){if(delete g.extensions,delete g.notes,g.matchUpStatus!=="BYE"&&Object.assign(g,_N),h&&h>1&&g.drawPositions?.length&&!d){let I=m?.map(({drawPosition:w,participantFed:y})=>!y&&w).filter(Boolean),v=g.drawPositions.map(w=>I.includes(w)?void 0:w);g.drawPositions=v}e?delete g.timeItems:g.timeItems?.length&&(g.timeItems=g.timeItems.filter(I=>I.itemType&&![Nu,kd,Xm,aV,Jm,Qm].includes(I.itemType))),Dt({tournamentId:t?.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:g})}}}i.extensions=i.extensions.filter(s=>s.name!==Xg);let a=(i.structures||[]).map(({structureId:s})=>s);return ri({drawDefinition:i,structureIds:a}),{...W}}function pT({tournamentRecord:t}){if(!t)return{error:Ie};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return(t.events?.flatMap(r=>{let n=r.eventId;return i[n]=r,(r?.drawDefinitions||[]).map(a=>({drawDefinition:a,eventId:n}))}).filter(Boolean)).forEach(({drawDefinition:r,eventId:n})=>{let a=0,s=0,o=0,{allStructuresLinked:l}=ON({drawDefinition:r}),u=i[n],c=(r?.structures||[]).map(w=>{let{stage:y,stageSequence:b,structureId:S}=w,U=Kh[y],{inContextStructureMatchUps:T}=ty({drawDefinition:r,structureId:S,structure:w,event:u}),D=T?.filter(({winningSide:$})=>$),P=D.filter(Boolean).length||0;s+=P,o+=T.length-s;let E=Math.max(D.filter(({roundNumber:$})=>$===1).map(({roundPosition:$})=>$)),{positionAssignments:R}=Xt({structure:w}),C=R?.filter(({participantId:$})=>$);a+=C?.length??0;let M=(R?.length??0)-(C?.length??0),{roundMatchUps:N,roundProfile:A,roundNumbers:O,maxMatchUpsCount:k}=Un({matchUps:T}),F=A&&Object.keys(A).filter($=>!A[$].inactiveRound).map($=>Number.parseInt($)),x=A&&Object.keys(A).filter($=>A[$].inactiveRound).map($=>Number.parseInt($)),L=A&&Object.values(A).every($=>$.inactiveRound);return{positionsAssignedCount:C?.length??0,maxWinningSideFirstRoundPosition:E,unassignedPositionsCount:M,inactiveStructure:L,maxMatchUpsCount:k,inactiveRounds:x,roundMatchUps:N,activeRounds:F,roundNumbers:O,roundProfile:A,structureId:S,stageSequence:b,orderNumber:U,stage:y}}),d=c.find(w=>w.orderNumber===2&&w.stageSequence===1),p=c.filter(({inactiveStructure:w})=>!w).length,{links:f}=Zv({structureId:d.structureId,drawDefinition:r}),h=Ke(d.activeRounds[0])===1&&d.activeRounds.length===1&&p===1,m=c?.every(({inactiveStructure:w})=>w),g=!f.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),I=r.drawId;a&&!s&&e.positionsNoOutcomes.push(I),m&&e.inactive.push(I),h&&e.matchPlay.push(I),g&&e.canBePruned.push(I);let v={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:o,positionsAssignedCount:a,allStructuresLinked:l,structuresData:c,inactiveDraw:m,isMatchPlay:h,drawId:I};e.drawAnalysis[I]=v}),{...W,drawsAnalysis:e}}function Koe({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){if(!e)return{error:Ie};if(!i)return{error:$e};let n=[],{drawsAnalysis:a}=pT({tournamentRecord:e});if(a.canBePruned.includes(r)){let s=a.matchPlay.includes(r),o=a.drawAnalysis[r],{structures:[l]}=so({stageSequence:1,drawDefinition:i,stage:ke}),u=o.structuresData.find(({structureId:f})=>l.structureId===f),c=(l.matchUps??[]).sort((f,h)=>f.roundPosition-h.roundPosition);n=c.filter(({roundNumber:f})=>!u.inactiveRounds.includes(f));let d=n.map(yr),p=c.map(yr).filter(f=>!d.includes(f));if(s){let f=n.filter(({roundNumber:v})=>!u.inactiveRounds.includes(v)).filter(({winningSide:v})=>v),h=f.map(yr),m=d.filter(v=>!h.includes(v));p.push(...m);let g=f.flatMap(v=>v.drawPositions??[]).filter(Boolean).flat(),I=Object.assign({},...g.map((v,w)=>({[v]:w+1})));if(f.forEach(v=>{t?v.drawPositions=v.drawPositions.map(w=>I[w]):delete v.drawPositions}),t){let v=l?.positionAssignments?.filter(w=>g.includes(w.drawPosition)).map(w=>(w.drawPosition=I[w.drawPosition],w));l.positionAssignments=v}else l.positionAssignments=[];l.matchUps=f,n=f}ju({tournamentId:e?.tournamentId,matchUpIds:p,drawDefinition:i}),ri({drawDefinition:i})}return{...W,matchUps:n}}function tje({isPositionAction:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,loserMatchUp:n,matchUpsMap:a,structureId:s,structure:o,event:l}){if(!i)return{error:$e};if(o||({structure:o}=tt({drawDefinition:i,structureId:s})),!o)return{error:yi};s||({structureId:s}=o);let u="assignDrawPositionQualifier";Wt({method:u,color:"cyan",drawPosition:r}),a??=xr({drawDefinition:i});let{positionAssignments:c}=Xt({structure:o}),{activeDrawPositions:d}=ty({drawDefinition:i,structureId:s});if(c?.find(I=>I.drawPosition===r)?.qualifier)return{...W};let p=!!(n&&a.drawMatchUps.some(I=>I.loserMatchUpId===n?.matchUpId&&Br(I.matchUpStatus)));if(d?.includes(r)&&!p)return{error:mU};let f=c?.find(I=>I.drawPosition===r);if(!f)return{error:_m};let{containsQualifier:h,containsParticipant:m}=pV(f);if(h)return{...W};let g=Ct({tournamentRecord:e,drawDefinition:i,event:l}).appliedPolicies??{};return c?.forEach(I=>{I.drawPosition===r&&(I.qualifier=!0,p&&(I.participantId=void 0,console.log("oddity: invalid participantId on qualifier position cleared")))}),Ac({tournamentId:e?.tournamentId,drawDefinition:i,structure:o,event:l}),ije({assignedParticipantId:m,isPositionAction:t,appliedPolicies:g,drawDefinition:i,drawPosition:r,structureId:s,stack:u})}function ije({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&FU({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),q({result:{...W},stack:s})}function Xoe({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:s,bye:o}){if(!e)return{error:$e};if(!r)return{error:Bv};if(!n)return{error:es};if(o){let l=ns({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else if(a){let l=tje({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else{let l=Ul({participantId:i,tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}return{...W}}function Joe(t){let e=t.matchUpIds??[],{drawDefinition:i}=t,r=t.structureId??i?.structures?.find(l=>l.matchUps?.some(({matchUpId:u})=>e.includes(u)))?.structureId??i?.structures?.[0]?.structureId;if(!r)return{error:yi};let n=i.structures?.find(l=>l.structureId===r);if(!n)return{error:yi};let a=n?.matchUps,s=a?.find(l=>!!l.roundPosition);if(n.structures||s||n.finishingPosition===zm)return{error:bf};let o=a.filter(({roundNumber:l})=>t.roundNumbers?.includes(l)).map(yr);return e=e.filter(l=>!o.includes(l)),t.roundNumbers&&!e.length&&(e=o),{existingMatchUps:a,matchUpIds:e,structureId:r,structure:n}}function Qoe(t){let e=He(t,[{[vn]:!0},{[FI]:{[NU]:!1,roundNumbers:!1},[Ya]:re,[Jn]:on}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:s,event:o}=t,l=Joe(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,f=[],h=d?.filter(({matchUpId:I,score:v,winningSide:w})=>{if(w&&!n)return!1;if(w||hr({score:v})){if(!w&&!i)return!1;f.push(I)}else if(!r)return!1;return p?.includes(I)})??[],m=h.map(yr),g=h.map(({tieMatchUps:I})=>I?.map(yr)).filter(Boolean).flat();if(m.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:w})=>!m.includes(w)),ju({tournamentId:a?.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:o?.eventId,drawDefinition:s});let I=lt(u.matchUps.map(Aa("roundNumber"))),v=FLe(I);if(v.length){v.reverse();for(let w of v)u.matchUps.forEach(y=>{y.roundNumber&&y.roundNumber>w&&(y.roundNumber-=1,Dt({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:o?.eventId,drawDefinition:s,matchUp:y}))})}if(f.length){u.positionAssignments=lt(u.matchUps.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U}));let w=u?.matchUpFormat??s?.matchUpFormat??o?.matchUpFormat,y=l.existingMatchUps.some(U=>U.matchUpType===Wa)?{matchUpTypes:[Wa]}:void 0,{matchUps:b}=Ot({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:y,structure:u,event:o});Yn({structure:u})&&(u.positionAssignments=lt(b.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U})));let S=HV({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:s,matchUpFormat:w,matchUps:b,event:o});S.error&&console.log(S)}ri({structureIds:[c],eventId:o?.eventId,drawDefinition:s})}return!m.length&&p.length?{error:bU}:{...W,deletedMatchUpsCount:[...m,...g].length}}function Zoe({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:Ie};if(!i)return{error:$e};if(!n)return q({result:{error:Je},info:"roundNumber required"});let s=tt({drawDefinition:i,structureId:r});if(s.error)return s;let o=s.structure;return o?.structures?{error:bf}:Yn({structure:o})?rje({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:o}):(console.log("not implemented"),{...W})}function rje({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let s=n?.matchUps??[],o=[],l=[],u=!1;if(s.reduce((c,d)=>{let p=d?.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(or).includes(r)){let c=s.filter(d=>{let p=d.roundNumber===r&&(!Qi.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&o.push(...d.tieMatchUps.map(yr))),!p});l.length&&(ju({matchUpIds:[...o,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===r)||(c.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Dt({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),n.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...W}}function VN(t){let{suppressNotifications:e,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=t;if(typeof r!="object")return{error:$e};let s=t?.structureId;if(!s&&r.structures?.length===1&&(s=r.structures?.[0]?.structureId),typeof s!="string")return{error:es};if(!is(n))return{error:re,info:Zp("matchUps")};let o=r.structures?.find(p=>p.structureId===s);if(!o)return{error:yi};let l=(o?.matchUps).find(p=>!!p.roundPosition);if(o.structures||l||o.finishingPosition===zm)return{error:bf};let u=Tr({tournamentRecord:i,inContext:!1})?.matchUps?.map(yr)??[],c=n.map(yr);if($n(u,c))return{error:Fre,info:"One or more matchUpIds already present in tournamentRecord"};o.matchUps.push(...n);let d=n.map(({tieMatchUps:p})=>p).filter(Boolean).flat();return e||(Nd({tournamentId:i?.tournamentId,matchUps:[...d,...n],eventId:a?.eventId,drawDefinition:r}),ri({drawDefinition:r,structureIds:[s]})),{...W}}function ele({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){if(!e)return{error:$e};if(!r)return{error:es};if(!i)return{error:Bv};let{structure:s}=tt({drawDefinition:e,structureId:r});if(!s)return{error:yi};let o=s;s.structures&&s.structureType===In&&(o=s.structures?.find(f=>f.positionAssignments?.find(h=>h.drawPosition===i)));let l=o?.positionAssignments,u=l?.find(f=>f.drawPosition===i);u&&It({element:u,extension:{name:_I,value:n}});let c=(a?.eventType===ti||e.matchUpType===ti||(a?.tieFormat??e?.tieFormat??s?.tieFormat))&&{matchUpTypes:[ti]},{matchUps:d}=Ot({structure:o,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:c,event:a}),p=s?.matchUpFormat??e.matchUpFormat;return HV({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),ri({drawDefinition:e,structureIds:[r]}),{...W}}var tle={};ft(tle,{addGoesTo:()=>Qp,allPlayoffPositionsFilled:()=>kV,checkValidEntries:()=>WN,findDrawDefinition:()=>tj,getAssignedParticipantIds:()=>Af,getAvailableMatchUpsCount:()=>jN,getAvailablePlayoffProfiles:()=>lT,getDrawDefinitionTimeItem:()=>X2,getDrawParticipantRepresentativeIds:()=>ZV,getDrawStructures:()=>so,getDrawTypeCoercion:()=>mT,getEligibleVoluntaryConsolationParticipants:()=>QV,getMatchUpsMap:()=>xr,getParticipantIdFinishingPositions:()=>ej,getPositionAssignments:()=>GI,getPositionsPlayedOff:()=>oy,getRandomQualifierList:()=>nj,getSeedingThresholds:()=>EV,getSeedsCount:()=>gT,getStructureSeedAssignments:()=>ys,getTeamLineUp:()=>Jp,getValidGroupSizes:()=>rT,isAdHoc:()=>Yn,isCompletedStructure:()=>Au,isValidForQualifying:()=>aj,positionActions:()=>rj});function QV({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:s,drawDefinition:o,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:f}){if(!o)return{error:$e};let h=[ke,ki];i&&h.push(ze);let m=f?.eventType?{matchUpTypes:[f.eventType]}:void 0,g=o?.matchUpType?{matchUpTypes:[o.matchUpType]}:void 0,I=e&&f?Gu({contextFilters:{stages:h},matchUpFilters:m,tournamentRecord:s,inContext:!0,event:f})?.matchUps??[]:xn({contextFilters:{stages:h},matchUpFilters:g,tournamentRecord:s,inContext:!0,drawDefinition:o})?.matchUps??[],v=Km({stage:Mr,drawDefinition:o}),w=new Set(v.map(({participantId:F})=>F)),y={},b={},S={},U={};n??=Kc({policyTypes:[Jx],tournamentRecord:s,drawDefinition:o,event:f}).policyDefinitions;let T=n?.[Jx];t=t.length&&t||T?.excludedMatchUpStatuses||[],e=e??T?.includeEventParticipants,d=d??T?.allEntries,r=r??T?.finishingRoundLimit,a=a??T?.roundNumberLimit,l=l??T?.matchUpsLimit,u??=T?.requirePlay??!0,c??=T?.requireLoss??!0,p=p??T?.winsLimit;for(let F of I){if(u&&F.winningSide&&![1,2].includes(F.winningSide)&&F.matchUpStatus!==Ui||F.finishingRound&&r&&F.finishingRound>=r||F.finishingRound&&a&&F.finishingRound<=a)continue;let x=F.sides?.find(({sideNumber:$})=>F.winningSide&&$===3-F.winningSide),L=F.sides?.find(({sideNumber:$})=>F.winningSide&&$===F.winningSide);if(F.sides?.forEach($=>{let V=$?.participant?.participantId;V&&(S[V]=$.participant,F.matchUpStatus===Ui&&!u&&(b[V]=$.participant,y[V]||(y[V]=0),(!F.matchUpStatus||!t.includes(F.matchUpStatus))&&(y[V]+=1)))}),x?.participant){let $=x.participant.participantId;b[$]=x.participant,y[$]||(y[$]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[$]+=1)}if(L?.participant){let $=L.participant.participantId;U[$]||(U[$]=0),U[$]+=1,y[$]||(y[$]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[$]+=1)}}let D=s?.participants&&!u&&!c&&d,P;e&&f?P=f.entries:P=o.entries;let E=D?(P??[]).filter(F=>![Mu,Es].includes(F.entryStatus)).map(({participantId:F})=>F):[],R=Object.keys(b),C=D?(s?.participants??[]).filter(({participantId:F})=>E.includes(F)):c&&Object.values(b)||Object.values(S),M=F=>!c||R.includes(F),N=F=>!u||(y[F]||0)>=0,A=F=>!p||(U[F]||0)<=p,O=F=>!l||y[F]<=l,k=F=>!w.has(F);return{eligibleParticipants:C.filter(F=>M(F.participantId)&&N(F.participantId)&&A(F.participantId)&&O(F.participantId)&&k(F.participantId)).map(F=>({...F,individualParticipants:F.individualParticipantIds?.map(x=>s?.participants?.find(L=>L.participantId===x))})),losingParticipantIds:R,...W}}function jN(t){let e=He(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:r}=t,n=t.structureId??(i.structures?.length===1&&i.structures?.[0]?.structureId);if(typeof n!="string")return{error:es};let a=i.structures?.find(h=>h.structureId===n);if(!a)return{error:yi};let s,o=(a.matchUps??[])?.reduce((h,m)=>(m.roundPosition&&(s=!0),(m?.roundNumber||0)>h?m.roundNumber:h),0);if(a.structures||s||a.finishingPosition===zm)return{error:bf};let l=i?.entries?.filter(h=>{let m=h.entryStatus;return mo.includes(m)})??[],u=Math.floor(l?.length/2)||1,c=r??o??1,d=a.matchUps?.filter(h=>h.roundNumber===c)?.length??0,p=u-d,f=p>0?p:0;return{...W,availableMatchUpsCount:f,lastRoundNumber:o,roundMatchUpsCount:u}}function ZV({drawDefinition:t}){let e=rt({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:e.extension?.value||[]}}function nje({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:$e};let r=nr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=xe(r.matchUps,!1,!0),a=lt(n.reduce((o,l)=>o.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),s=Object.assign({},...a.map(o=>{let l=n.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(o));return{[o]:l}}));return{participantIds:a,participantIdMatchUps:s}}function GI({tournamentRecord:t,drawDefinition:e,stage:i=ke,structureId:r,structure:n}){if(!t)return{error:Ie};if(!n&&!e)return{error:$e};if(!n&&!r&&e?.structures?.filter(o=>o.stage===i).length===1&&(n=e.structures.find(o=>o.stage===i)),!n&&!r)return{error:es};let{error:a,positionAssignments:s}=Xt({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:s??[],structureId:n?.structureId,error:a}}function ile({dates:t=[],extension:e}){if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=Ut(e.value)?e.value?.dates:void 0;if(Array.isArray(i))return i?.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function aje({inContextCourt:t,venue:e}){let{defaultStartTime:i,defaultEndTime:r,dateAvailability:n}=e;if(!(i||r||n?.length))return;let a=t.dateAvailability;if(!a?.length){n?.length?t.dateAvailability=n.map(s=>({...s})):i&&r&&(t.dateAvailability=[{startTime:i,endTime:r}]);return}t.dateAvailability=a.map(s=>{let o=sje({date:s.date,venueDateAvailability:n,defaultStartTime:i,defaultEndTime:r});if(!o)return s;let l=oje(s.startTime,o.startTime),u=lje(s.endTime,o.endTime),c=uje(s.bookings,o.bookings);return{...s,startTime:l,endTime:u,...c.length?{bookings:c}:{}}})}function sje({date:t,venueDateAvailability:e,defaultStartTime:i,defaultEndTime:r}){if(e?.length){if(t){let a=e.find(s=>s.date===t);if(a)return a}let n=e.find(a=>!a.date);if(n)return n}if(i||r)return{startTime:i,endTime:r}}function oje(t,e){return t?e?t>e?t:e:t:e}function lje(t,e){return t?e?t<e?t:e:t:e}function uje(t,e){let i=[];return t?.length&&i.push(...t),e?.length&&i.push(...e),i}function rle({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){let n={...xe(r,t,!0),venueId:i.venueId},{extension:a}=rt({name:Eo,element:r});if(e&&a){let s=Ut(a.value)?a.value?.dates:void 0,o=a?.value===!0?[]:n.dateAvailability.map(l=>{let u=l.date;if(!(!u||s.includes(u)))return l}).filter(Boolean);n.dateAvailability=o}return aje({inContextCourt:n,venue:i}),{inContextCourt:n}}function cje(t,e,i){if(e.length&&!e.includes(t.venueId))return!1;if(i){let{extension:r}=rt({name:Eo,element:t});if(r?.value)return!1}return!0}function dje({venue:t,convertExtensions:e,ignoreDisabled:i,dates:r,uniqueVenueIds:n,venues:a,uniqueCourtIds:s,courts:o}){n.includes(t.venueId)||(a.push(xe(t,e,!0)),n.push(t.venueId));for(let l of t.courts??[])if(!s.includes(l.courtId)){if(i){let{extension:c}=rt({name:Eo,element:l});if(ile({extension:c,dates:r}))continue}let{inContextCourt:u}=rle({convertExtensions:e,ignoreDisabled:i,venue:t,court:l});o.push(u),s.push(l.courtId)}}function Hu(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},s=[],o=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])cje(p,r,!!i)&&dje({venue:p,convertExtensions:e,ignoreDisabled:i,dates:n,uniqueVenueIds:s,venues:u,uniqueCourtIds:o,courts:l})}),{courts:l,venues:u,...W}}function pje({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:Ci};let n=xe(e.venues??[],t).filter(s=>{if(!i)return s;let{extension:o}=rt({name:Eo,element:s});return!o?.value&&s}).filter(Boolean),a=n.reduce((s,o)=>{let l=(o?.courts||[]).filter(u=>{if(!i&&!r?.length)return u;let{extension:c}=rt({name:Eo,element:u});return ile({extension:c,dates:r})}).filter(Boolean).map(u=>{let{inContextCourt:c}=rle({convertExtensions:t,ignoreDisabled:i,venue:o,court:u});return c});return l.length?s.concat(l):s},[]);return{venues:n,courts:a}}function fT({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Ci}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:s}=pje({tournamentRecord:a,dates:i});return s?.forEach(o=>{let{venueId:l,courts:u}=o;(!e||u?.length)&&!r.venueIds.includes(l)&&(r.venues.push(o),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function nle({event:t}){let{surfaceCategory:e,onlineResources:i,matchUpFormat:r,discipline:n,eventLevel:a,eventName:s,eventType:o,startDate:l,category:u,ballType:c,eventId:d,endDate:p,gender:f,notes:h}=t;return{eventInfo:{drawDefinitionCount:t.drawDefinitions?.length,surfaceCategory:e,onlineResources:i,matchUpFormat:r,discipline:n,eventLevel:a,eventName:s,eventType:o,ballType:c,startDate:l,category:u,endDate:p,eventId:d,gender:f,notes:h}}}var fje="IN_PROGRESS",hje="ABANDONED",mje="CANCELLED",gje="COMPLETED",Ije="ACTIVE",ale="tournamentImage",sle={TOURNAMENT_IMAGE_RESOURCE_NAME:ale,IN_PROGRESS:fje,ABANDONED:hje,CANCELLED:mje,COMPLETED:gje,ACTIVE:Ije},vje={[Kv]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},yje=vje;function lg(t){let{tournamentRecord:e,withMatchUpStats:i,withStructureDetails:r,withVenueData:n}=t??{};if(!e)return{error:Ie};let a=(({tournamentId:h,tournamentRank:m,tournamentStatus:g,formalName:I,tournamentName:v,promotionalName:w,onlineResources:y,localTimeZone:b,activeDates:S,startDate:U,endDate:T,hostCountryCode:D,venues:P,notes:E,updatedAt:R})=>({tournamentId:h,tournamentRank:m,tournamentStatus:g,formalName:I,tournamentName:v,promotionalName:w,onlineResources:y,localTimeZone:b,activeDates:S,startDate:U,endDate:T,hostCountryCode:D,venues:P,notes:E,updatedAt:R}))(e),s=e.venues?.find(h=>h.isPrimary);s?.addresses?.length&&(a.tournamentAddress=s.addresses[0]);let o=Ei({participantFilters:{participantRoles:[Gse,yV,Hse,Wse,qse]},policyDefinitions:yje,tournamentRecord:e})?.participants??[];o&&(a.tournamentContacts=o);let l=e?.onlineResources?.find(h=>h.name===ale&&h.resourceType==="URL")?.identifier;l&&(a.imageUrl=l);let u=ig({tournamentRecord:e})?.publishState,c=u?.tournament?.status?.publishedEventIds||[],d=[];for(let h of e.events??[])if(!t?.usePublishState||c.includes(h.eventId)){let m=nle({event:h}).eventInfo;m&&d.push(m)}a.timeItemValues=Woe({element:e}),a.publishState=u?.tournament,a.eventInfo=d;let p=[],f=[];if(i||r)for(let h of e.events??[])for(let m of h.drawDefinitions??[])for(let g of m.structures??[])f.push(...g.matchUps??[]),p.push(je({eventId:h.eventId,eventName:h.eventName,eventType:h.eventType,drawId:m.drawId,drawName:m.drawName,drawType:m.drawType,structureId:g.structureId,structureName:g.structureName,stage:g.stage,stageSequence:g.stageSequence,positionAssignments:g.positionAssignments,seedAssignments:g.seedAssignments,matchUpFormat:g.matchUpFormat}));if(r&&(a.structures=p),i){let h=e.participants?.filter(S=>S.participantType===yt).length??0,m=e.participants?.filter(S=>S.participantType===$t).length??0,g=e.events?.length??0,I=f?.filter(S=>S.matchUpStatus!=="BYE"),v=I?.length,w=I?.filter(S=>Qi.includes(S.matchUpStatus)||S.winningSide)?.length,y=I?.filter(S=>Nf({matchUp:S})?.scheduledDate||oV({matchUp:S})?.scheduledTime)?.length,b=v>0?Math.round(w/v*100):0;a.matchUpStats={total:v,completed:w,scheduled:y,percentComplete:b},a.individualParticipantCount=h,a.teamParticipantCount=m,a.eventCount=g}if(n){let{venues:h}=Hu({tournamentRecord:e});a.venues=h??[]}return{tournamentInfo:xe(je(a),!1,!0),...W}}function ole({publishStatus:t,drawId:e}){return t?.drawDetails?Ko(t.drawDetails?.[e]?.publishingDetail):t?.drawIds?t.drawIds.includes(e):!0}var lle="PUBLIC",bje="ADMIN",wje={PUBLIC_DISPLAY:lle,ADMIN_DISPLAY:bje};function GN(t){let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:s,status:o=rs,pressureRating:l,refreshResults:u,contextProfile:c,drawDefinition:d,noDeepCopy:p,sortConfig:f,context:h,event:m}=t;if(!d)return{error:$e};let{matchUpFormat:g,updatedAt:I,drawType:v,drawName:w,drawId:y}=d,b={matchUpFormat:g,updatedAt:I,drawName:w,drawType:v,drawId:y};b.display=rt({element:d,name:dE}).extension?.value;let S={},U,T,{allStructuresLinked:D,sourceStructureIds:P,hasDrawFeedProfile:E,structureGroups:R}=ON({drawDefinition:d});if(!D)return{error:$ie};let C=t?.eventPublishState??ig({event:m}).publishState,M=t?.publishStatus??Fa({event:m,status:o}),N=C?.status?.drawDetails?.[d.drawId],A=!!C?.status?.published,O=N?.structureDetails,k=!1,F=!1,x=R.map(L=>{let $={},V=L.map(_=>{let{structure:B}=tt({drawDefinition:d,structureId:_}),{seedAssignments:G}=ys({drawDefinition:d,structure:B});return B?.stage===ke&&B.stageSequence===1&&(U=G),B?.stage===ze&&(S[B.stageSequence??0]=G),B}).sort((_,B)=>Ym(_,B,f)).map(_=>{if(!_)return;let B=_?.structureId,G=[];_.stage&&[ke,rn,ki].includes(_.stage)&&(G=U),_?.stage===ze&&(G=S[_.stageSequence??0]);let{matchUps:j,roundMatchUps:Y,roundProfile:K}=Ot({seedAssignments:_?.seedAssignments?.length?void 0:G,context:{drawId:b.drawId,...h},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:e,policyDefinitions:r,tournamentRecord:n,usePublishState:s,publishStatus:M,contextProfile:c,drawDefinition:d,inContext:a,structure:_,event:m}),{positionAssignments:X}=Xt({structure:_}),Z=X?.filter(Aa(Eu)).map(ne=>{let le=rt({element:ne,name:Nc})?.extension?.value,{drawPosition:de,participantId:pe}=ne;return F=!0,{participantResult:le,participantId:pe,drawPosition:de}});if(j.length&&(!Z?.length&&t.allParticipantResults||u&&!_.structures)){let{subOrderMap:ne}=gV({positionAssignments:X}),le=j.some(pe=>pe.matchUpType===Wa)?j.filter(pe=>pe.matchUpType===Wa):j,de=tg({matchUpFormat:_.matchUpFormat,matchUps:le,policyDefinitions:r,pressureRating:l,subOrderMap:ne});T=de?.report,Z=X?.filter(Aa(Eu)).map(pe=>{let{drawPosition:ve,participantId:Me}=pe;return F=!0,{participantResult:Me&&de?.participantResults?.[Me],participantId:Me,drawPosition:ve}})}let Q=_?{stageSequence:_.stageSequence,structureName:_.structureName,structureType:_.structureType,matchUpFormat:_.matchUpFormat,stage:_.stage}:{},ae=rt({element:_,name:dE}).extension?.value;Q.display=ae?.[lle]??ae,Q.sourceStructureIds=P[B],Q.hasDrawFeedProfile=E[B],Q.positionAssignments=X,Q.structureActive=j.reduce((ne,le)=>{let de=[Ui,zi,ho,xi,Fl,Yt,Ur,si].includes(le.matchUpStatus);return ne||de||!!le.winningSide||!!le.score?.scoreStringSide1},!1);let te=j.every(ne=>[...Qi,"BYE"].includes(ne.matchUpStatus));return Q.structureCompleted=te,$[B]=te,Q.structureActive&&(k=!0),{...Q,participantResults:Z,seedAssignments:G,roundMatchUps:Y,roundProfile:K,structureId:B,report:T}});return V.forEach(_=>{i||delete _.positionAssignments,_.sourceStructuresComplete=_.sourceStructureIds?.every(B=>$[B])}),V}).flat().filter(L=>!s||Ko(O?.[L?.structureId])||!0);return b.drawActive=k,b.participantPlacements=F,b.drawGenerated=x?.reduce((L,$)=>L||!!$?.roundMatchUps,!1),b.drawCompleted=x?.reduce((L,$)=>L&&$.structureCompleted,!0),b.drawPublished=s?A&&ole({publishStatus:M,drawId:b.drawId}):void 0,{structures:!s||b.drawPublished?p&&x||xe(x,!1,!0):void 0,drawInfo:p?b:xe(b,!1,!0),...W}}function hT(t){let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=rs,contextProfile:s,sortConfig:o}=t,l=He(t,[{tournamentRecord:!0},{[D2]:{event:!1,eventId:!1}}]);if(l.error)return l;let u=xe(t.tournamentRecord,!1,!0),c=t.event==null?Kn({tournamentRecord:u,eventId:t.eventId}).event:void 0,d=t.event?xe(t.event,!1,!0):c&&xe(c,!1,!0)||void 0;if(!d)return{error:gs};let{eventId:p}=d,{tournamentId:f,endDate:h}=u,m=Fa({event:d,status:a}),g=ig({event:d}).publishState??{},I=!!g?.status?.published,{participants:v}=Ei({participantFilters:t.participantFilters,withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:u}),w=({stage:C,drawId:M})=>{if(!n)return!0;let N=m?.drawDetails?.[M]?.stageDetails;return!N||!Object.keys(N).length?!0:Ko(N[C])},y=({structureId:C,drawId:M})=>{if(!n)return!0;let N=m?.drawDetails?.[M]?.structureDetails;return!N||!Object.keys(N).length?!0:Ko(N[C])},b=({drawId:C})=>n?ole({publishStatus:m,drawId:C}):!0,S=({drawId:C,drawType:M,structure:N})=>{if(!n||M!==ma)return N;let A=m?.drawDetails?.[C]?.structureDetails?.[N.structureId]?.roundLimit;if(ct(A)){let O=Ce(1,A+1),k={},F={};for(let x of O)N.roundMatchUps[x]&&(k[x]=N.roundMatchUps[x],F[x]=N.roundProfile[x]);N.roundMatchUps=k,N.roundProfile=F}return N},U=d.drawDefinitions||[],T=!n||I?U.filter(b).map(C=>(({drawInfo:M,structures:N})=>({...M,structures:N}))(GN({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:p,tournamentId:f,endDate:h},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:v,eventPublishState:g,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:u,usePublishState:n,contextProfile:s,drawDefinition:C,publishStatus:m,sortConfig:o,event:d}))).map(({structures:C,...M})=>{let N=C?.filter(({stage:A,structureId:O})=>y({structureId:O,drawId:M.drawId})&&w({stage:A,drawId:M.drawId})).map(A=>S({drawId:M.drawId,drawType:M.drawType,structure:A}));return{...M,structures:N}}).filter(C=>C.structures?.length):void 0,D=(Array.isArray(u.venues)?u.venues:[]).map(C=>{let{venueData:M}=VI({venueId:C.venueId,tournamentRecord:u});return{...M}}),P=(({eventId:C,eventName:M,eventType:N,eventLevel:A,surfaceCategory:O,matchUpFormat:k,category:F,gender:x,startDate:L,endDate:$,ballType:V,discipline:_})=>({eventId:C,eventName:M,eventType:N,eventLevel:A,surfaceCategory:O,matchUpFormat:k,category:F,gender:x,startDate:L,endDate:$,ballType:V,discipline:_}))(d);P.display=rt({element:d,name:dE}).extension?.value;let{tournamentInfo:E}=lg({tournamentRecord:u}),R={tournamentInfo:E,venuesData:D,eventInfo:P,drawsData:T};return R.eventInfo.publishState=g,R.eventInfo.published=g?.status?.published,{...W,eventData:R,participants:v}}function ej({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i,event:r}){if(!i)return{error:$e};let{participantIds:n,participantIdMatchUps:a}=nje({tournamentParticipants:e?.participants,drawDefinition:i}),s=Object.values(a).some(p=>p.some(f=>f.containerStructureId)),o=(s&&hT({tournamentRecord:e,event:r}))?.eventData?.drawsData?.find(p=>p.drawId===i.drawId)?.structures,l=i?.structures?.find(p=>p.stage===ke&&p.stageSequence===1),u=l?.structureType===In&&l.structures,c=(s?GI({tournamentRecord:e,drawDefinition:i,structureId:l?.structureId})?.positionAssignments:void 0)?.length||0,d=n?.map(p=>{let f=a[p].filter(I=>[xi,"BYE"].includes(I.matchUpStatus)||I.winningSide),h=f.map(I=>{let v=I.sides.find(y=>y.bye),w=I.sides.find(y=>y.participantId===p).sideNumber;if(I.containerStructureId){let y=Sje({containedStructures:u,drawPositionsCount:c,drawDataStructures:o,drawDefinition:i,participantId:p,matchUp:I});if(y)return y}return(I.winningSide||t&&v&&w)===w?I.finishingPositionRange.winner:I.finishingPositionRange.loser}),m=I=>Math.abs(I[0]-I[1]),g=h.reduce((I,v)=>I&&m(I)<m(v)?I:v,void 0);return{[p]:{finishingPositionRanges:h,finishingPositionRange:g,relevantMatchUps:f}}})||[];return Object.assign({},...d)}function Sje({containedStructures:t,drawPositionsCount:e,drawDataStructures:i,drawDefinition:r,participantId:n,matchUp:a}){let s=t?.find(f=>f.structureId===a.structureId)?.positionAssignments?.length,o=i.find(f=>f.structureId===a.containerStructureId)?.participantResults?.find(f=>f.participantId===n)?.participantResult,{ties:l,groupOrder:u,provisionalOrder:c}=o||{},d=t?.length,p=r.structure?.find(f=>f.stage===ki);if(ha()&&console.log({drawPositionsCount:e,provisionalOrder:c,bracketsCount:d,bracketSize:s,groupOrder:u,ties:l}),e===s&&u)return[u,u];if(d>1&&u&&!p)return[1,d];if(d>1&&u&&p){let f=r.links?.find(m=>m.source.structureId===a.containerStructureId)?.source?.finishingPositions,h=f.length*d;if(u in f)return[1,h];{let m=(s-u)*d;return[h+1,e-m]}}}function sp({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:Ie};if(!r)return{error:jo};if(!e&&t){if(typeof i!="string"&&(i=Goe({tournamentRecords:t,drawId:r}),!i))return{error:EI};if(e=t[i],!e)return{error:Ie}}let n=e&&Kn({tournamentRecord:e,drawId:r});return n?.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...W}:q({result:{error:za},stack:"findDrawDefinition"})}function tj(t){let{drawDefinition:e,error:i}=sp(t);return i?{error:i}:{drawDefinition:xe(e)}}function Uje({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){let s=a?.entries?.filter(({entryStatus:o})=>[Es,Rf].includes(o)).map(({participantId:o})=>o)||[];if(s.length){let o=r.individualParticipantIds,l=e?t.filter(({participantId:c})=>s.includes(c)):void 0,u=e?t.filter(({participantId:c})=>o.includes(c)):void 0;return{validModifyAssignedPairAction:je({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:DVe,availableIndividualParticipantIds:s,availableIndividualParticipants:l,existingIndividualParticipantIds:o,existingIndividualParticipants:u,type:LV},!1,!1,!0)}}return{}}function tf(t){let{inContextDrawMatchUps:e,targetData:i,drawDefinition:r,relevantLink:n}=t;if(n?.linkCondition===wl&&i?.matchUp?.matchUpStatus==="BYE")return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:s},targetLinks:o}=i,l=a&&Bn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),u=l?.targetMatchUps?.loserMatchUp,c=l?.targetMatchUps?.loserMatchUpDrawPositionIndex,d=u?.sides[c]?.participant,p=Br(a?.matchUpStatus),f=p&&!d,h=a?.sides?.filter(w=>w?.participant).length??0,m=a?.winningSide&&p&&h===1,g=s?.drawPositions?.filter(Boolean).length||0;if(!m&&(a?.winningSide&&!f||s?.winningSide&&g===2&&(!s.feedRound||!Br(s?.matchUpStatus))))return!0;let I=s&&Bn({matchUpId:s.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),v=l&&tf({relevantLink:o?.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:r});return!!(I&&tf({targetData:I,inContextDrawMatchUps:e,drawDefinition:r})||v)}var ule={[Cu]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[ze,ke],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[Sw,im,xN,Dh],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},BD="positionAction",fF="matchUpAction";function cle({actionType:t=BD,appliedPolicies:e,drawDefinition:i,structure:r}){let n=t===BD&&Cu||t===fF&&Nr,a=t===BD&&ule||t===fF&&jse,s=n&&(e?.[n]||a?.[n]),o=i.links?.filter(d=>d?.target?.structureId===r?.structureId)?.map(({target:d})=>d.feedProfile)??[],{enabledStructures:l,disabledStructures:u}=s||{},c=u?.find(d=>{let{stages:p,stageSequences:f,structureTypes:h,feedProfiles:m}=d;return(!m?.length||Array.isArray(m)&&m.some(g=>o.includes(g)))&&(!p?.length||Array.isArray(p)&&p?.includes(r?.stage))&&(!h?.length||Array.isArray(h)&&h?.includes(r?.structureType))&&(!f?.length||Array.isArray(f)&&f.includes(r?.stageSequence))});return{enabledStructures:l,actionsDisabled:c,actionsPolicy:s}}function Tje({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function dle({enabledStructures:t,drawDefinition:e,structure:i}){if(t===!1)return{};if(!t?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},s=e.links?.filter(o=>o?.target?.structureId===i?.structureId)?.map(({target:o})=>o.feedProfile)||[];return{policyActions:t.find(o=>{let{stages:l,stageSequences:u,structureTypes:c,feedProfiles:d}=o||{},p=!l?.length||Array.isArray(l)&&l.includes(r),f=!u?.length||Array.isArray(u)&&u.includes(n),h=!c?.length||Array.isArray(c)&&c.includes(a),m=!d?.length||Array.isArray(d)&&d.some(g=>s.includes(g));return f&&h&&m&&o&&p})}}function sa({action:t,policyActions:e}){let i=!e?.enabledActions||e?.disabledActions?.length&&e.disabledActions.includes(t);return i?!1:(e?.enabledActions.length===0||e?.enabledActions.includes(t))&&!i}var ple="replaceTieMatchUpParticipantId",fle="assignTieMatchUpParticipantId",hF="removeTieMatchUpParticipantId",m3="assignMatchUpSideParticipant",Dje="removeMatchUpSideParticipant",hle="substituteParticipant",mF="REMOVE_SUBSTITUTION",mle="REPLACE_PARTICIPANT",ij="REMOVE_PARTICIPANT",gF="setMatchUpStatus",IF="SUBSTITUTION",gle="SCHEDULE",Pje="PENALTY",vF="REFEREE",Ile="STATUS",yF="START",vle="SCORE",Eje={REPLACE_TEAM_POSITION_METHOD:ple,ASSIGN_TEAM_POSITION_METHOD:fle,REMOVE_TEAM_POSITION_METHOD:hF,REPLACE_PARTICIPANT:mle,SUBSTITUTION_METHOD:hle,REMOVE_SUBSTITUTION:mF,REMOVE_PARTICIPANT:ij,SCHEDULE_METHOD:gF,SUBSTITUTION:IF,SCHEDULE:gle,PENALTY:Pje,REFEREE:vF,STATUS:Ile,SCORE:vle,START:yF,END:"END"};function Rje({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:s,participantId:o,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){let f=[],h=n.sides?.find(M=>M.participant),m=Ba(n.gender)&&n.sideNumber&&n.sides?.filter(M=>M.particiapntId).length===1&&h?.participant?.person?.sex,g=n.matchUpType,I=(s??r?.participants?.enforceGender)!==!1?n.gender:void 0,v=n.sides?.flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean)?.map(wt),w=n.sides?.filter(M=>!l||M.sideNumber===l).flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean),y=w?.map(wt),b=e?.find(M=>M.matchUpId===n.matchUpTieId)?.sides?.map(M=>M?.participant?.individualParticipants?.filter(({participantId:N,person:A})=>!y?.includes(N)&&(!I||wu(I)||A.sex===I||Ba(I)&&!m||m&&A.sex!==m))),S=l?b?.[l-1]:b?.map((M,N)=>({participants:M,sideNumber:N+1})),U=l?b?.[l-1]?.map(wt):b?.map((M,N)=>({participants:M?.map(wt),sideNumber:N+1})),T=l&&(Di(bh)(g)&&!y?.length||Di(Hp)(g)&&(y?.length??0)<2)||!l&&(Di(bh)(g)&&(y?.length??0)<2||Di(Hp)(g)&&(y?.length??0)<4),D=U?.filter(M=>!v?.includes(M)),P=S?.filter(({participantId:M})=>D.includes(M));if(T&&D?.length&&f.push({availableParticipantIds:D,method:fle,availableParticipants:P,type:tm,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),y?.length&&(!hr(c)||p?.substitutions?.length)&&f.push({method:hF,type:ij,existingParticipantIds:y,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),P?.length&&(!l&&y?.length||l&&p?.participant)&&f.push({availableParticipantIds:D,method:ple,availableParticipants:P,type:mle,existingParticipantIds:y,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),sa({policyActions:a,action:mF})&&p?.substitutions?.length){let M=p.participant?.participantType===yt&&[p.participantId]||p.participant?.participantType===mt&&p.participant.individualParticipantIds||[],N=p.substitutions.map(A=>A.participantId).filter(A=>M.includes(A));(!o||N.includes(o))&&f.push({method:hF,type:mF,substitutedParticipantIds:N,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let E=t?.[Nr],R=E?.substituteWithoutScore,C=E?.substituteAfterCompleted;if(sa({policyActions:a,action:IF})&&i.length===2&&(!l&&y?.length||l&&p?.participant)&&(R||hr(c))&&(C||c.matchUpStatus&&!Qi.includes(c.matchUpStatus))&&w?.length&&S.length){let M=w.map(wt);f.push({info:"list of team players available for substitution",method:hle,availableParticipantIds:U,existingParticipantIds:M,availableParticipants:S,existingParticipants:w,type:IF,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return f}function Cje({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:s,drawPosition:o,validActions:l,structureId:u,structure:c,drawId:d,event:p}){if(i.includes(o))return{};let f=l.find(U=>U.type===tm)?.availableParticipantIds,h=a?.[Cu]?.otherFlightEntries,m=a?.[Cu]?.restrictQualifyingAlternates,g=(s.entries??[]).filter(({entryStage:U})=>!m||(c.stage===ze?U===ze:U!==ze)).sort((U,T)=>(U.entryPosition??1/0)-(T.entryPosition??1/0)).map(({participantId:U})=>U).filter(Boolean),{allPositionedParticipantIds:I}=Cae({drawDefinition:s}),v=r.map(U=>U.participantId).filter(Boolean),w=g.filter(U=>c.stage&&[ze,ke,ki].includes(c.stage)?!I?.includes(U):!v.includes(U)),y=(p?.entries??[]).filter(U=>U.entryStatus===qs&&yle({restrictQualifyingAlternates:m,structure:c,entry:U})&&(c.stage&&[ze,ke,ki].includes(c.stage)?!I?.includes(U.participantId):!v.includes(U.participantId))).sort((U,T)=>(U.entryPosition??1/0)-(T.entryPosition??1/0)).map(U=>U.participantId),b=lt(w.concat(y));if(h){let U=(p?Vi({event:p}).flightProfile:void 0)?.flights?.filter(T=>T.drawId!==d).map(T=>T.drawEntries.filter(D=>D.participantId&&![Mu,Es,Rf].includes(D.entryStatus)&&!g.includes(D.participantId)).map(({participantId:D})=>D)).flat().filter(Boolean);U?.length&&b.push(...U)}f?.length&&(b=b.filter(U=>!f.includes(U)));let S=n?t?.filter(U=>b.includes(U.participantId)):void 0;return S?.forEach(U=>{let T=(s.entries??[]).find(D=>D.participantId===U.participantId);U.entryPosition=T?.entryPosition}),S?.sort((U,T)=>(U.entryPosition||1/0)-(T.entryPosition||1/0)),b.length?{validAlternatesAction:je({payload:{drawId:d,structureId:u,drawPosition:o},willDisableLinks:e,method:UVe,availableAlternatesParticipantIds:b,type:_V,availableAlternates:S})}:{}}function yle({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===ze&&!t||i.entryStage===ke&&r===rn)return!0}function Mje({eventEntries:t,structure:e}){let i=n=>n.entryStatus===qs&&yle({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(wt)}function Nje({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:s,matchUpId:o,structure:l,matchUp:u,drawId:c,event:d}){let p=[],f=l?.matchUps??[],h=u.sides?.find(T=>T.sideNumber===s)?.participantId,m=f.filter(({roundNumber:T})=>T===u.roundNumber),g=n?.entries?.filter(({entryStatus:T})=>T&&Cf.includes(T)).map(wt)??[],I=m.map(T=>(T.sides??[]).flatMap(wt)).flat().filter(Boolean),v=g.filter(T=>!i.includes(T)&&(!t||!I.includes(T))),w=e?.filter(T=>v?.includes(T.participantId)).map(T=>xe(T,void 0,!0));w?.forEach(T=>{let D=(n.entries??[]).find(P=>P.participantId===T.participantId);T.entryPosition=D?.entryPosition}),v.length&&p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:m3,type:tm,availableParticipantIds:v,participantsAvailable:w});let y=d?.entries??[],b=Mje({eventEntries:y,structure:l}),S=lt(g.concat(b));if(r){let T=(d?Vi({event:d}):void 0)?.flights?.filter(D=>D.drawId!==c).flatMap(D=>D.drawEntries.filter(P=>P.participantId&&![Mu,Es,Rf].includes(P.entryStatus)).map(({participantId:P})=>P)).filter(Boolean);T?.length&&S.push(...T)}S=S.filter(T=>!i.includes(T)&&!v.includes(T)&&(!t||!I.includes(T)));let U=e?.filter(T=>S.includes(T.participantId)).map(T=>xe(T,void 0,!0));if(U?.forEach(T=>{let D=(n.entries??[]).find(P=>P.participantId===T.participantId);T.entryPosition=D?.entryPosition}),U?.sort((T,D)=>(T.entryPosition||1/0)-(D.entryPosition||1/0)),S.length&&p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},availableParticipantIds:S,participantsAvailable:U,method:m3,type:qs}),!hr(u)&&s&&h){p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:Dje,type:ij});let T=A=>A.sides.map(wt),D=({matchUpId:A})=>A!==u.matchUpId,P=A=>!hr(A),E=u.sides?.find(A=>A.sideNumber!==s)?.participantId,R=f.filter(({roundNumber:A})=>A!==u.roundNumber).filter(D).map(T),C=[E,...R.filter(A=>A.includes(h)).flat()].filter(Boolean),M=A=>!C.flat().includes(A),N=m.filter(P).filter(D).map(T).flat().filter(M);if(N.length){let A=e?.filter(O=>N.includes(O.participantId)).map(O=>xe(O,void 0,!0));p.push({payload:{participantIds:[h],roundNumber:u.roundNumber,structureId:a,sideNumber:s,matchUpId:o,drawId:c},swappableParticipantIds:N,method:PVe,type:FN,swappableParticipants:A})}}return p}function HN(t){if(!t)return{error:re};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l}=t,u=t.tournamentRecord??(t.tournamentId&&ai(t.tournamentId)&&t.tournamentRecords?.[t.tournamentId]);if(!u)return{error:Ie};if(!l||!ai(l))return{error:Dn};if(o&&![1,2].includes(o))return q({result:{error:re},context:{sideNumber:o}});if(!e){let K=(Tr({tournamentRecord:u}).matchUps??[]).find(Z=>Z.matchUpId===l);i=(u?.events??[]).find(Z=>Z.eventId===K?.eventId);let X=(i?.drawDefinitions??[]).find(Z=>Z.drawId===K?.drawId);X&&(e=X)}if(!e)return{error:$e};let c=Ei({withIndividualParticipants:!0,tournamentRecord:u}).participants,{drawId:d}=e,{matchUp:p,structure:f}=hi({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:pn};let h=Ct({tournamentRecord:u,drawDefinition:e,structure:f,event:i}).appliedPolicies??{};Object.assign(h,n??{});let m=h?.[Cu]?.otherFlightEntries,g=h?.[Nr]??ny[Nr],{enabledStructures:I}=cle({actionType:fF,appliedPolicies:h,drawDefinition:e,structure:f}),{policyActions:v}=dle({enabledStructures:I,drawDefinition:e,structure:f}),w=t.matchUpsMap??xr({drawDefinition:e}),y=t.inContextDrawMatchUps??nr({tournamentParticipants:c,inContext:!0,drawDefinition:e,matchUpsMap:w,event:i}).matchUps,b=y?.find(K=>K.matchUpId===l),S=o&&b?.sides?.find(K=>K.sideNumber===o),U=b?.sides?.map(K=>K.participantId||K.participant?.participantid).filter(Boolean)??[],{assignedPositions:T,allPositionsAssigned:D}=fr({structure:f}),{structureId:P}=f??{},E=[];if(!P)return{validActions:E};let R=Yn({structure:f}),C=!!p.collectionId;if(R&&!C){let K=Nje({restrictAdHocRoundParticipants:r,tournamentParticipants:c,matchUpParticipantIds:U,otherFlightEntries:m,drawDefinition:e,structureId:P,sideNumber:o,matchUpId:l,structure:f,matchUp:p,drawId:d,event:i});E.push(...K)}let M=Au({drawDefinition:e,structure:f}),N=T?.filter(K=>K.participantId).map(K=>K.drawPosition),A=T?.filter(K=>K.bye).map(K=>K.drawPosition),O=p.matchUpStatus==="BYE"||!C&&p.drawPositions?.reduce((K,X)=>A?.includes(X)||K,!1);if(O)return{validActions:E,isByeMatchUp:O};sa({policyActions:v,action:vF})&&E.push({type:vF,payload:{matchUpId:l}});let k=!JU({matchUpStatus:p.matchUpStatus}),F=h?.scoring?.structures,x=f?.stage&&F?.stage?.[f.stage],L=f?.stageSequence&&x?.stageSequence?.[f.stageSequence],$=!(h?.scoring?.requireAllPositionsAssigned||x?.requireAllPositionsAssigned||L?.requireAllPositionsAssigned)||D,V=p.sides?.filter(K=>K?.participantId).length===2,_=p.matchUpStatus&&[Ui,zi].includes(p.matchUpStatus),B=Bn({inContextDrawMatchUps:y,drawDefinition:e,matchUpId:l}),G=tf({inContextDrawMatchUps:y,drawDefinition:e,targetData:B}),j=(b?.drawPositions?.length===2&&b.drawPositions.every(K=>N?.includes(K))&&b?.sides?.length===2&&b.sides.every(({participantId:K})=>K)||V)&&!(_&&G),Y={method:Coe,type:im,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(k&&E.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:gF,type:gle}),sa({policyActions:v,action:im})&&(S?.participant||!o&&U?.length)&&E.push(Y),k&&j&&E.push({type:Ile}),$&&j){let{matchUpId:K,matchUpFormat:X}=p,Z={drawId:d,matchUpId:K,matchUpFormat:X,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};E.push({info:"set outcome and winningSide",method:gF,type:vle,payload:Z}),sa({policyActions:v,action:yF})&&E.push({type:yF}),sa({policyActions:v,action:"END"})&&E.push({type:"END"})}if(C&&b){let K=Rje({specifiedPolicyDefinitions:n,inContextDrawMatchUps:y,matchUpParticipantIds:U,matchUpActionsPolicy:g,inContextMatchUp:b,policyActions:v,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l,matchUp:p,drawId:d,side:S});E.push(...K)}return{structureIsComplete:M,validActions:E,isDoubleExit:_,...W}}function Aje({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:s,drawPosition:o,structureId:l,structure:u,drawId:c,event:d}){if(n.includes(o)||r&&!e)return{};let{sourceStructureIds:p,targetStructureIds:f}=s.links?.reduce((I,v)=>{let w=v.source?.structureId,y=v.target?.structureId;return I.sourceStructureIds.includes(w)||I.sourceStructureIds.push(w),I.targetStructureIds.includes(y)||I.targetStructureIds.push(y),I},{sourceStructureIds:[],targetStructureIds:[]})||{},h=[],m=s.links?.filter(I=>I.target?.structureId===u.structureId)??[];for(let I of m){let v=I?.source?.structureId,{structure:w}=tt({structureId:v,drawDefinition:s}),y=w?.finishingPosition===zm&&(p?.length!==1||f?.length!==1),b={};if(y){let{matchUps:T}=Ot({drawDefinition:s,structure:u,event:d}),{initialRoundNumber:D}=Zh({drawPosition:o,matchUps:T}),P=s.links?.find(E=>E.target?.structureId===u?.structureId&&E.target.roundNumber===D)?.source?.roundNumber;b.roundNumbers=[P]}let{completedMatchUps:S}=EN({structureId:v,inContext:!0,matchUpFilters:b,drawDefinition:s}),U=a.map(T=>T.participantId).filter(Boolean);S?.filter(({matchUpType:T,winningSide:D})=>D&&(d?.eventType!==lr||T===lr)).map(({winningSide:T,sides:D})=>T&&D?.[1-(T-1)]).map(wt).filter(T=>T&&!U.includes(T))?.forEach(T=>{h.includes(T)||h.push(T)})}let g=t?.filter(I=>h?.includes(I.participantId));return g?.forEach(I=>{let v=(s.entries??[]).find(w=>w.participantId===I.participantId);I.entryPosition=v?.entryPosition}),h?.length?{validLuckyLosersAction:{type:BV,method:TVe,availableLuckyLosers:g,availableLuckyLoserParticipantIds:h,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:o}}}:{}}function kje({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:f,event:h}){let{drawId:m}=u,g=[],I,v,w=[],y=l?.[As]?.validSeedPositions?.ignore;if(y||({unplacedSeedParticipantIds:I,unplacedSeedAssignments:v,unfilledPositions:w}=toe({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:f})),w?.length||(w=s.filter(b=>!b.participantId&&!b.bye&&!b.qualifier).map(b=>b.drawPosition)),d||g.push({payload:{drawId:m,structureId:f,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:CVe,type:"BYE"}),a&&y){let b=s.map(P=>P.participantId).filter(Boolean),S={structureIds:t},{completedMatchUps:U}=ey({inContext:!0,matchUpFilters:S,drawDefinition:u}),T=lt((U??[]).filter(({matchUpType:P})=>h?.eventType!==lr||P===lr)?.map(({sides:P})=>P?.map(wt)).flat().filter(P=>P&&!b.includes(P))),D=o?n?.filter(P=>T?.includes(P.participantId)).map(P=>xe(P,void 0,!0)):void 0;return D?.forEach(P=>{let E=(u.entries??[]).find(R=>R.participantId===P.participantId);P.entryPosition=E?.entryPosition}),D?.length&&g.push(je({payload:{drawId:m,structureId:f,drawPosition:p},willDisableLinks:i,method:p3,type:tm,availableParticipantIds:T,participantsAvailable:D})),{validAssignmentActions:g}}if(w.includes(p)||d){let b;if(v?.length){let U=v.filter(T=>I?.includes(T.participantId));U.sort(Oje),b=U.map(T=>T.participantId)}else b=e;let S=o?n?.filter(U=>b.includes(U.participantId)).map(U=>xe(U,void 0,!0)):void 0;S?.length&&g.push(je({payload:{drawId:m,structureId:f,drawPosition:p},willDisableLinks:i,method:p3,type:tm,availableParticipantIds:b,participantsAvailable:S}))}return{validAssignmentActions:g}}function Oje(t,e){return t.bye||jI(t.seedValue)<jI(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function xje({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:s,structureId:o,drawId:l}){let u=[],c=[],d=[],p=[],f=new Set(i.map(b=>b.participantId).filter(Boolean)),h=n?.[Cu],m=!h?.disableRoundRestrictions&&t[s],g=h?.requireCompletedStructures,{sourceStructureIds:I,relevantLinks:v}=ww({targetRoundNumber:m,linkType:Tu,drawDefinition:a,structureId:o})||{};I?.length&&p.push(...I);let{sourceStructureIds:w,relevantLinks:y}=ww({targetRoundNumber:m,linkType:Uu,drawDefinition:a,structureId:o})||{};w?.length&&p.push(...w);for(let b of v){let S=a.structures?.find(T=>T.structureId===b.source.structureId);if(S?.stage!==ze)continue;let U=Au({structureId:b.source.structureId,drawDefinition:a});if(!g||U){let T=S.qualifyingRoundNumber,{matchUps:D}=Ot({matchUpFilters:{roundNumbers:[T],isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:S});for(let P of D){let E=P.sides.find(C=>C?.sideNumber===P.winningSide),R=P.matchUpStatus==="BYE"&&P.sides?.find(({participantId:C})=>C);if(E||R){let{participantId:C,participant:M}=E||R||{};C&&!f.has(C)&&(M&&r&&u.push(M),c.push(C))}}}}for(let b of y){let S=a.structures?.find(T=>T.structureId===b.source.structureId);if(S?.stage!==ze)continue;let U=Au({structureId:b.source.structureId,drawDefinition:a});if(!g||U){let{positionAssignments:T}=Xt({structure:S}),D=T?.map(P=>{let E=P.participantId,R=rt({element:P,name:Nc}).extension?.value;return R?{participantId:E,groupOrder:R?.groupOrder}:{}}).filter(({groupOrder:P,participantId:E})=>P===1&&!f.has(E)).map(({participantId:P})=>P)??[];if(D&&c.push(...D),r){let P=e.filter(({participantId:E})=>D.includes(E));u.push(...P)}}}return c.length&&d.push(je({qualifyingParticipants:r?u:void 0,method:wVe,type:xN,qualifyingParticipantIds:c,payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:o,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function Fje({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:s,byeDrawPositions:o,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:f,event:h}){if(n.includes(c))return{};let m=P=>!t||P.participantId||P.qualifier||P.bye,g=r?.filter(P=>P!==c&&!(u&&o.includes(P))),I=a?.filter(P=>m(P)&&g?.includes(P.drawPosition))??[],v=I.map(({drawPosition:P})=>P),{matchUps:w}=Ot({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:h}),y=w.filter(({drawPositions:P})=>$n(P,v)),b=Object.assign({},...y.map(P=>P.sides?.filter(({sourceDrawPositionRange:E})=>E).map(({drawPosition:E,sourceDrawPositionRange:R})=>({[E]:R}))).flat()),S=I.map(P=>P.participantId).filter(Boolean),U=(i??[]).filter(P=>S.includes(P.participantId)),T=Object.assign({},...U.map(P=>({[P.participantId]:P}))),D=I.map(P=>{let E=T?.[P.participantId],R=b[P.drawPosition];return je({...P,participant:s?xe(E,!1,!0):void 0,sourceDrawPositionRange:R})});return D.length?{validSwapAction:{payload:{drawId:f,structureId:d,drawPositions:[c]},willDisableLinks:e,method:Roe,type:FN,availableAssignments:D}}:{}}function Lje(t,e){return t.filter(i=>!e.includes(i.participantId)).map(i=>i.participantId)}function _je({validActions:t,policyActions:e,isActiveDrawPosition:i,positionAssignments:r,disablePlacementActions:n,positionAssignment:a,isByePosition:s,getValidAssignmentActions:o,positionSourceStructureIds:l,unassignedParticipantIds:u,possiblyDisablingAction:c,isWinRatioFedStructure:d,tournamentParticipants:p,returnParticipants:f,appliedPolicies:h,drawDefinition:m,drawPosition:g,structureId:I,event:v}){if(sa({policyActions:e,action:tm})&&!i&&r&&!n&&(!a||s)){let{validAssignmentActions:w}=o({positionSourceStructureIds:l,unassignedParticipantIds:u,possiblyDisablingAction:c,isWinRatioFedStructure:d,tournamentParticipants:p,positionAssignments:r,returnParticipants:f,appliedPolicies:h,drawDefinition:m,isByePosition:s,drawPosition:g,structureId:I,event:v});w?.forEach(y=>t.push(y))}}function $je({validActions:t,policyActions:e,isActiveDrawPosition:i,getValidQualifiersAction:r,drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,drawId:p}){if(sa({policyActions:e,action:xN})&&!i){let{validAssignmentActions:f}=r({drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,drawId:p});f?.forEach(h=>t.push(h))}}function Bje({validActions:t,policyActions:e,isActiveDrawPosition:i,drawId:r,structureId:n,drawPosition:a,possiblyDisablingAction:s,isByePosition:o}){sa({policyActions:e,action:pF})&&!i&&(t.push({type:pF,method:d3,payload:{drawId:r,structureId:n,drawPosition:a},willDisableLinks:s}),o||t.push({type:$V,method:SVe,payload:{drawId:r,structureId:n,drawPosition:a},willDisableLinks:s}),sa({policyActions:e,action:"BYE"})&&!o&&t.push({type:"BYE",method:d3,payload:{drawId:r,structureId:n,drawPosition:a,replaceWithBye:!0},willDisableLinks:s}))}function Vje({validActions:t,policyActions:e,activePositionsCheck:i,activePositionOverrides:r,activeDrawPositions:n,drawDefinition:a,structureId:s,drawPosition:o,structure:l,isByePosition:u,participantId:c,participant:d,drawId:p}){let f=l.stage===ze||l.stage===ke&&l.stageSequence===1;if(!u&&i({activePositionOverrides:r,activeDrawPositions:n,action:Dh})&&sa({policyActions:e,action:Dh})&&SE({drawDefinition:a,structureId:s,drawPosition:o})&&f){let{seedAssignments:h}=ys({returnAllProxies:!0,drawDefinition:a,structure:l}),{seedNumber:m,seedValue:g}=h?.find(I=>I.participantId===c)??{};t.push({type:Dh,method:MVe,participant:d,seedNumber:m,payload:{drawId:p,structureId:s,participantId:c,seedValue:g}})}if(!u&&i({activePositionOverrides:r,activeDrawPositions:n,action:gb})&&sa({policyActions:e,action:gb})&&SE({drawDefinition:a,structureId:s,drawPosition:o})&&f){let{seedAssignments:h}=ys({returnAllProxies:!0,drawDefinition:a,structure:l}),{seedNumber:m}=h?.find(g=>g.participantId===c)??{};t.push({method:RVe,type:gb,participant:d,seedNumber:m,payload:{participantId:c,structureId:s,drawId:p}})}}function jje({validActions:t,policyActions:e,isByePosition:i,participantId:r,participant:n,drawId:a}){if(!i&&r){if(sa({policyActions:e,action:im})){let s={type:im,method:Coe,participant:n,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:a}};t.push(s)}if(sa({policyActions:e,action:Sw})){let s={type:Sw,method:EVe,participant:n,payload:{participantId:r,otherName:void 0}};t.push(s)}}}function Gje({validActions:t,policyActions:e,getValidSwapAction:i,possiblyDisablingAction:r,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:s,positionAssignments:o,returnParticipants:l,byeDrawPositions:u,drawDefinition:c,isByePosition:d,drawPosition:p,structureId:f,structure:h,drawId:m}){if(sa({policyActions:e,action:FN})){let{validSwapAction:g}=i({possiblyDisablingAction:r,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:s,positionAssignments:o,returnParticipants:l,byeDrawPositions:u,drawDefinition:c,isByePosition:d,drawPosition:p,structureId:f,structure:h,drawId:m});g&&t.push(g)}}function Hje({validActions:t,policyActions:e,getValidAlternatesAction:i,possiblyDisablingAction:r,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f,event:h,disablePlacementActions:m}){if(sa({policyActions:e,action:_V})&&!m){let{validAlternatesAction:g}=i({possiblyDisablingAction:r,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,validActions:t,structureId:d,structure:p,drawId:f,event:h});g&&t.push(g)}}function Wje({validActions:t,policyActions:e,getValidLuckyLosersAction:i,sourceStructuresComplete:r,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:s,activeDrawPositions:o,positionAssignments:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f,disablePlacementActions:h,isActiveDrawPosition:m}){if(sa({policyActions:e,action:BV})&&!h&&!m&&l){let{validLuckyLosersAction:g}=i({sourceStructuresComplete:r,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:s,activeDrawPositions:o,positionAssignments:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f});g&&t.push(g)}}function zje({validActions:t,policyActions:e,getValidModifyAssignedPairAction:i,participant:r,tournamentParticipants:n,returnParticipants:a,drawPosition:s,drawId:o,event:l}){if(r?.participantType===mt&&sa({policyActions:e,action:LV})){let{validModifyAssignedPairAction:u}=i({tournamentParticipants:n,returnParticipants:a,drawPosition:s,participant:r,drawId:o,event:l});u&&t.push(u)}}function rj(t){return qje(t)}function qje(t){let e=He(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:s,drawPosition:o,event:l}=t,u=t.tournamentParticipants??(a&&Ei({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],c=tt({structureId:t.structureId,drawDefinition:s});if(c.error)return c;let d=c.containingStructure||c.structure;if(!d)return{error:yi};let p=d.structureId;if(c=ty({drawDefinition:s,structureId:p}),o===void 0&&!c.isAdHoc)return{error:Bv};if(c.isAdHoc)return HN(t);if(c.error)return c;let{drawPositionInitialRounds:f,inactiveDrawPositions:h,activeDrawPositions:m,byeDrawPositions:g}=c,I=Ct({tournamentRecord:a,drawDefinition:s,structure:d,event:l}).appliedPolicies??{};Object.assign(I,i??{});let{actionsPolicy:v,enabledStructures:w,actionsDisabled:y}=cle({actionType:BD,appliedPolicies:I,drawDefinition:s,structure:d}),b=v?.activePositionOverrides||[],{sourceStructureIds:S}=ww({finishingPosition:Kp,targetRoundNumber:1,linkType:Uu,drawDefinition:s,structureId:p})||{},U;S?.length&&(U=S.every(Y=>Au({structureId:Y,drawDefinition:s})));let T=S.length,D=S.length&&!U,{policyActions:P}=dle({enabledStructures:w,drawDefinition:s,structure:d}),E=![ze,ke].includes(d.stage)||d.stageSequence!==1,{drawId:R}=s,C=[],{assignedPositions:M,positionAssignments:N}=fr({structure:d}),A=M?.find(Y=>Y.drawPosition===o),O=!!A;if(!N?.map(Y=>Y.drawPosition)?.includes(o))return{error:_m};let{stage:k,stageSequence:F}=d,x=[k];k===rn&&x.push(ke),k===ke&&x.push(rn);let L=Km({entryStatuses:Cf,provisionalPositioning:n,drawDefinition:s,stageSequence:F,structureId:p,stages:x}),$=Af({drawDefinition:s,stages:x}).assignedParticipantIds??[],V=Lje(L,$),_=g.includes(o),B=m.includes(o);if(y)return{info:"Actions Disabled for structure",isActiveDrawPosition:B,isDrawPosition:!0,hasPositionAssigned:O,validActions:[],isByePosition:_};_je({validActions:C,policyActions:P,isActiveDrawPosition:B,positionAssignments:N,disablePlacementActions:D,positionAssignment:A,isByePosition:_,getValidAssignmentActions:kje,positionSourceStructureIds:S,unassignedParticipantIds:V,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,event:l}),$je({validActions:C,policyActions:P,isActiveDrawPosition:B,getValidQualifiersAction:xje,drawPositionInitialRounds:f,tournamentParticipants:u,positionAssignments:N,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,drawId:R});let{participantId:G}=A||{},j=G&&u.find(Y=>Y.participantId===G);return A&&(Bje({validActions:C,policyActions:P,isActiveDrawPosition:B,drawId:R,structureId:p,drawPosition:o,possiblyDisablingAction:E,isByePosition:_}),Vje({validActions:C,policyActions:P,activePositionsCheck:Tje,activePositionOverrides:b,activeDrawPositions:m,drawDefinition:s,structureId:p,drawPosition:o,structure:d,isByePosition:_,participantId:G,participant:j,drawId:R}),jje({validActions:C,policyActions:P,isByePosition:_,participantId:G,participant:j,drawId:R}),Gje({validActions:C,policyActions:P,getValidSwapAction:Fje,possiblyDisablingAction:E,tournamentParticipants:u,inactiveDrawPositions:h,activeDrawPositions:m,positionAssignments:N,returnParticipants:r,byeDrawPositions:g,drawDefinition:s,isByePosition:_,drawPosition:o,structureId:p,structure:d,drawId:R})),Hje({validActions:C,policyActions:P,getValidAlternatesAction:Cje,possiblyDisablingAction:E,tournamentParticipants:u,positionAssignments:N,activeDrawPositions:m,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:R,event:l,disablePlacementActions:D}),Wje({validActions:C,policyActions:P,getValidLuckyLosersAction:Aje,sourceStructuresComplete:U,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,activeDrawPositions:m,positionAssignments:N,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:R,disablePlacementActions:D,isActiveDrawPosition:B}),zje({validActions:C,policyActions:P,getValidModifyAssignedPairAction:Uje,participant:j,tournamentParticipants:u,returnParticipants:r,drawPosition:o,drawId:R,event:l}),{isActiveDrawPosition:B,isDrawPosition:!0,hasPositionAssigned:O,isByePosition:_,validActions:C,...W}}function mT({policyDefinitions:t,appliedPolicies:e,drawType:i}){let r=t?.[cE]?.drawTypeCoercion,n=e?.[cE]?.drawTypeCoercion;return(typeof r=="boolean"?r:void 0)??(i&&r?.[i])??(typeof n=="boolean"?n:void 0)??(i&&n?.[i])??!0}var nj=({drawDefinition:t})=>{let e=He({drawDefinition:t},[{[vn]:!0}]);if(e.error)return e;let i=t.structures?.find(n=>n.stage===ke&&n.stageSequence===1);if(!i)return q({result:{error:FB}});let{qualifierPositions:r}=fr({structure:i});return Ce(0,r.length).sort(()=>Math.random()-.5)};function aj({structureId:t,drawDefinition:e}){if(!e)return{error:$e};if(!ai(t))return{error:re};let i=Zv({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!_i([Yp,Fs,ZM,qp],r).length;return{...W,valid:n}}function ble({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:re};let i=$v(t);return i?{drawSize:i}:q({result:{error:re},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function gT(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:s,event:o}=t||{},l="getSeedsCount",u=t?.participantsCount??t?.participantCount;if(!i){let h=Kc({tournamentRecord:a,drawDefinition:s,event:o});if(h.error)return q({result:h,stack:l});i=h.policyDefinitions}let c=ct(u);if(u&&!c)return q({result:{error:re},context:{participantsCount:u},stack:l});if(n&&!c)return q({result:{error:pre},stack:l});if(Number.isNaN(Number(r)))if(u)({drawSize:r}=ble({participantsCount:u}));else return q({result:{error:gU},stack:l});let d=n&&u||r;if(d&&d>r)return{error:jB};let p=i?.[As];if(!p)return{error:Jie};let f=p.seedsCountThresholds;return f?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:f.filter(h=>e?h.drawSize<=r:r===h.drawSize).reduce((h,m)=>u&&u>=m.minimumParticipantCount?m.seedsCount:h,0)}):{error:kie}}function WN({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:s,event:o}){if((!s||!n)&&i&&({participants:s,participantMap:n}=Ei({tournamentRecord:i})),!s)return{error:yU};if(!Array.isArray(s))return{error:re};if(!o)return{error:ci};let l=e?.[Nr]??r?.[Nr]??ny[Nr],u=(a??l?.participants?.enforceGender)!==!1,{eventType:c,gender:d}=o,p=c===Ec,f=c===Ca&&$t||p&&mt||yt,h=Object.assign({},...(t??o.entries??[]).map(I=>({[I.participantId]:I.entryStatus}))),m=Object.keys(h),g=s.filter(I=>m.includes(I.participantId)).filter(I=>{let v=Yje({participant:I,participantType:f,eventType:c,entryStatusMap:h}),w=Kje({genderEnforced:u,participantMap:n,eventGender:d,participant:I,isDoubles:p,mismatch:v});return v||!w});if(g.length){let I=g.map(v=>v.participantId);return{error:jie,invalidParticipantIds:I}}return{...W,valid:!0}}function Yje({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[Ec,Ca].includes(i)&&t.participantType===yt&&(vp(n)||n===Mu);return t.participantType!==e&&!a}function Kje(t){let{participant:e,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:s}=t,o=!n&&a&&lt(e?.individualParticipantIds?.map(d=>i?.[d]?.participant?.person?.sex).filter(Boolean)??[])||[],l=!r||!o?.length||wu(r)||vl(r)&&un(o[0])===un(r)||Ba(r)&&(o.length===1&&e.individualParticipantIds?.length===1||o.length===2),u=e?.person?.sex,c=!e?.person||!r||Ba(r)||wu(r)||vl(r)&&un(u)===un(r);return!s||l&&c}function wle({hasExistingDrawDefinition:t,qualifyingProfiles:e,appliedPolicies:i,qualifyingOnly:r,tieFormat:n,idPrefix:a,isMock:s,uuids:o}){let l="generateQualifyingSTructures",u=[],c=[],d=[],p=(v,w)=>v.stageSequence-w.stageSequence,f=(v,w)=>v.roundTarget-w.roundTarget,h=0,m=0,g,I=1;for(let v of e.sort(f)){let w=v.structureProfiles||[];I=v.roundTarget||I;let y=1,b=0,S,U,T;for(let D of(w||[]).sort(p)){let P=RB(D.drawSize||D.participantsCount),{qualifyingRoundNumber:E,structureOptions:R,matchUpFormat:C,structureName:M,structureId:N,drawType:A}=D,O=D.matchUpType,k=D.qualifyingPositions||Xje({drawSize:P,qualifyingRoundNumber:E}),F,x,L;if(!ct(P))return q({result:{error:gU},stack:l});let $=e.length>1?`${I}-`:"",V=w.length>1||$?y:"",_=M||($||V?`${Zr(ze)} ${$}${V}`:Zr(ze));if(A===no){let{structures:B,groupCount:G,maxRoundNumber:j}=iT({structureName:D.structureName||_,structureId:N||o?.pop(),hasExistingDrawDefinition:t,stage:ze,structureOptions:R,appliedPolicies:i,qualifyingOnly:r,stageSequence:y,matchUpType:O,roundTarget:I,tieFormat:n,drawSize:P,idPrefix:a,isMock:s,uuids:o});b=G,F=j,x=B[0],g=[1]}else({drawSize:P,matchUps:L,roundLimit:F}=Tl({qualifyingRoundNumber:E,qualifyingPositions:k,matchUpType:O,drawSize:P,idPrefix:a,isMock:s,uuids:o})),x=cs({structureName:D.structureName||_,structureId:N||o?.pop(),qualifyingRoundNumber:F,hasExistingDrawDefinition:t,stage:ze,qualifyingOnly:r,matchUpFormat:C,stageSequence:y,matchUpType:O,roundLimit:F,tieFormat:n,matchUps:L}),I&&It({extension:{name:xl,value:I},element:x}),b=L?.filter(B=>B.roundNumber===F)?.length||0;if(y>1){let{link:B}=sT({sourceStructureId:U,sourceRoundNumber:S,targetStructureId:x.structureId,finishingPositions:T===Uu?[1]:void 0,linkType:T});d.push(B),h+=(P||0)-b}else h+=P||0;T=A===no?Uu:Tu,U=x.structureId,S=F,n&&(L=Ot({structure:x})?.matchUps||[],L?.forEach(B=>{let{tieMatchUps:G}=sg({tieFormat:n,matchUp:B,isMock:s});Object.assign(B,{tieMatchUps:G,matchUpType:O})})),c.push(x),y+=1}m+=b,u.push({qualifiersCount:b,finalQualifyingRoundNumber:S,finalQualifyingStructureId:U,finishingPositions:g,roundTarget:I,linkType:T}),I+=1}return{qualifiersCount:m,qualifyingDrawPositionsCount:h,qualifyingDetails:u,structures:c,...W,links:d}}function Xje({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function Sle(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=Ke(t.drawSize),n=e&&t.drawType!==ma&&(typeof e=="boolean"||e<=2)&&r===2&&al||t.drawType||al,a=tae.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=al;else if(r<4&&i)return{...q({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:kM},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function Jje(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:Zr(ke),...t,stage:ke},{structures:a,groupCount:s}=iT(n);if(s<1)return{error:Mre};let o=i?.playoffGroups||[{finishingPositions:[1],structureName:Zr(ki)}],[l]=a,{structures:u,links:c}=Boe({sourceStructureId:l.structureId,requireSequential:r,drawDefinition:e,playoffGroups:o,groupCount:s,...t});return u&&a.push(...u),{...W,structures:a,links:c}}function Qje({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),n=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),s=r.map((u,c)=>{let d=r.indexOf(u)%2?Fs:Yp,p=1+c;return{linkType:Du,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),o={linkType:Tu,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Fs,roundNumber:n,structureId:t.structureId}},l=[{linkType:Tu,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Fs,roundNumber:1,structureId:i.structureId}},{linkType:Du,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Fs,roundNumber:1,structureId:i.structureId}}];return[...s,o,...l]}function Zje({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let s=[],{matchUps:o}=Od({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=Id({structureName:t||Zr(ke),structureId:a?.pop(),stageSequence:1,stage:ke,matchUpType:e,matchUps:o});s.push(l);let u=r/2,{matchUps:c}=Od({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=Id({structureName:Zr(eae),matchUps:c,structureId:a?.pop(),stage:rn,stageSequence:2,matchUpType:e});s.push(d);let{matchUps:p}=Tl({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),f=Id({structureName:Zr(Zne),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:ki,matchUpType:e});s.push(f);let h=Qje({mainStructure:l,consolationStructure:d,deciderStructure:f});return{structures:s,links:h,...W}}function eGe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:s,isMock:o,uuids:l}=t;if(!ct(s)||s<2)return{matchUps:[],roundsCount:0};if(xo(s))return Tl(t);let u=tGe(s),c=u.shift(),d=Ce(1,(c?.participantsCount||0)+1).map(g=>({drawPosition:g})),p=[],f=1;({matchUps:p}=TE({roundNumber:f,matchUpType:n,idPrefix:a,matchUps:p,isMock:o,nodes:d,uuids:l})),f++;let h=t.roundLimit||e;for(let g of u){let I=g.participantsCount/2,v=Ce(1,I+1);r&&I===r&&(h=f-1);let w=v.map(y=>{let b=VV({roundPosition:y,roundNumber:f,idPrefix:a,uuids:l});return{roundPosition:y,roundNumber:f,matchUpId:b}});p.push(...w),f++}let m=f-1;return p=XU({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:h,matchUps:p}),h&&(p=p.filter(g=>g.roundNumber<=h)),{matchUps:p,roundsCount:m,roundLimit:h}}function tGe(t){let e=Ke(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),s=a===1,o=!!(!s&&a%2);i=!s&&o?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:o})}return n}function Ule(t){let{playoffAttributes:e,stageSequence:i=1,stage:r=ke,tieFormat:n,matchUpType:a,drawSize:s,uuids:o}=t,l=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,u=t.structureId||l()||o?.pop(),c=t.appliedPolicies??Ct(t),d=t.policyDefinitions?.[LI]||c?.[LI];t.skipRounds=t.skipRounds||s<=4&&(d?.feedFromMainFinal?0:1)||0;let p=t.structureName??e?.["0"]?.name??Zr(ke),f=()=>{let{matchUps:h}=Tl(t);return{structures:[cs({stageSequence:i,structureName:p,matchUpType:a,structureId:u,tieFormat:n,matchUps:h,stage:r})],links:[],...W}};return{generators:{[ma]:()=>({structures:[cs({finishingPosition:Kp,stageSequence:i,structureName:p,matchUps:[],matchUpType:a,structureId:u,stage:r})],links:[],...W}),[Tf]:()=>{let{matchUps:h}=eGe(t);return{structures:[cs({stageSequence:i,structureName:p,matchUpType:a,structureId:u,matchUps:h,stage:r})],links:[],...W}},[al]:()=>f(),[tN]:()=>f(),[EU]:()=>Zje(t),[kI]:()=>Jg({...t,childStage:ki,roundOffsetLimit:3,playoffAttributes:e??g2}),[OI]:()=>Jg({...t,childStage:ki,roundOffsetLimit:2,playoffAttributes:e??I2}),[MU]:()=>Jg({...t,childStage:ki}),[zv]:()=>{let{matchUps:h}=Od({drawSize:s,uuids:o,matchUpType:a});return{structures:[cs({stageSequence:i,structureName:p,matchUpType:a,structureId:u,stage:ke,tieFormat:n,matchUps:h})],links:[],...W}},[RU]:()=>Loe(t),[xI]:()=>qf({...t,feedRounds:1,fmlc:!0}),[Qne]:()=>qf({...t,feedRounds:1}),[f2]:()=>qf({...t,feedsFromFinal:1}),[h2]:()=>qf({...t,feedsFromFinal:2}),[m2]:()=>qf({...t,feedsFromFinal:3}),[CU]:()=>qf(t),[eN]:()=>$oe(t),[no]:()=>iT(t),[Pu]:()=>Jje(t)}}}function sj(t){let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:r,qualifyingOnly:n,staggeredEntry:a,drawDefinition:s,tieFormat:o,isMock:l,uuids:u}=t||{},c=Ke(t.drawSize),d=t.drawTypeCoercion??mT({appliedPolicies:r,drawType:t.drawType}),p="generateDrawStructuresAndLinks",f=Sle({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:d,drawSize:c});if(f.error)return f;let h=f.drawType,m=[],g=[],I=t?.matchUpType??qt,v=s?.structures?.filter(({stage:V})=>V===ze);v&&m.push(...v);let w=v?.map(({structureId:V})=>V),y=s?.structures?.find(({stage:V,stageSequence:_})=>V===ke&&_===1),b=s?.links?.filter(V=>V.target.structureId===y?.structureId&&w?.includes(V.source.structureId)),S=(V,_)=>{if(V.linkType===Uu&&_?.structures){let B=V.source.finishingPositions||[];return _.structures.length*B.length}else if(V.linkType===Tu&&_?.matchUps?.length){let B=V.source.roundNumber;return _.matchUps.filter(({roundNumber:G})=>G===B).length}},U=v?.map(V=>{let _=b?.find(K=>K.target.structureId===V.structureId),B=Xt({structure:V})?.positionAssignments?.length??0;if(!_)return B;let G=_?.source.structureId,j=s.structures?.find(K=>K.structureId===G),Y=S(_,j)||0;return B-Y}).filter(Boolean).reduce((V,_)=>V+_,0),T=b?.map(V=>{let _=V.source.structureId,B=v?.find(G=>G.structureId===_);return S(V,B)}).filter(Boolean).reduce((V,_)=>V+_,0),D=!!(y&&!y?.matchUps?.length);if(v?.length&&!D)return{error:Wx};let P=!v?.length&&t.qualifyingProfiles,E=P?.length&&wle({idPrefix:t.idPrefix,qualifyingProfiles:P,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,isMock:l,uuids:u});if(E?.error)return E;let{qualifyingDrawPositionsCount:R,qualifyingDetails:C,qualifiersCount:M}=E||{qualifyingDrawPositionsCount:U,qualifiersCount:T};R&&(E?.structures&&m.push(...E.structures),E?.links&&g.push(...E.links)),Object.assign(t,je({drawSize:c,matchUpType:I,tieFormat:o}));let N=h!==ma&&h!==tN&&(!c||c<2||!a&&![zv,Tf].includes(h)&&([Pu,no].includes(h)&&c<3||![no,Pu].includes(h)&&!xo(c)));if(N&&!R)return q({context:{drawSize:c,invalidDrawSize:N},result:{error:kM},stack:p});let{generators:A,error:O}=Ule(t);if(O)return{error:O};let k=A[h];if(!k)return{error:AB};let F=k?.();if(F.error)return F;let{structures:x,links:L}=F;if(x?.length){let V=x.find(({stage:_,stageSequence:B})=>_===ke&&B===1);if(y&&V){if(D){let _=V.structureId;if(V.structureId=y.structureId,L?.length)for(let B of L)B.source.structureId===_&&(B.source.structureId=y.structureId),B.target.structureId===_&&(B.target.structureId=y.structureId)}else if(!i)return{error:Wx}}m.push(...x)}m.sort(Ym),L?.length&&g.push(...L);let $=F.structures.find(({stage:V,stageSequence:_})=>V===ke&&_===1);for(let V of C||[]){let{finalQualifyingRoundNumber:_,finalQualifyingStructureId:B,roundTarget:G,finishingPositions:j,linkType:Y}=V,K=$&&sT({targetStructureId:$.structureId,sourceStructureId:B,sourceRoundNumber:_,finishingPositions:j,targetEntryRound:G,linkType:Y})?.link;if(K?.error)return K;K&&g.push(K)}return b&&g.push(...b),{...W,qualifyingResult:{qualifyingDrawPositionsCount:R,qualifiersCount:M},structures:m,links:g}}function oj(t){let{modifyOriginal:e=!0,stageSequence:i=1,isMock:r}=t||{},n="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return q({result:{error:$e},stack:n});let a=e?t.drawDefinition:xe(t.drawDefinition,!1,!0),{tieFormat:s,matchUpType:o}=t;if(s){let w=qn({tieFormat:s});if(w.error)return w}s=zr(s??bn({drawDefinition:a})?.tieFormat),o=o??(a.matchUpType||qt),t.tieFormat=s,t.matchUpType=o;let l=wE({drawDefinition:a,stage:ke});t.drawSize=t.drawSize??l,!l&&t.drawSize&&UE({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:ke});let u=xr({drawDefinition:a}).drawMatchUps.map(yr),c=sj(t);if(c.error)return q({result:c,stack:n});let{structures:d,links:p,qualifyingResult:f}=c;a.structures=d,a.links=p;let h=Math.max(t.qualifiersCount??0,f?.qualifiersCount||0);if(f?.qualifyingDrawPositionsCount&&!wE({stage:ze,drawDefinition:a})){let w=UE({drawSize:f.qualifyingDrawPositionsCount,stage:ze,drawDefinition:a});if(w.error)return w}if(h){let w=Doe({qualifiersCount:h,drawDefinition:a,stage:ke});if(w.error)return w}let m=t.drawSize??l;Object.assign(t,je({drawSize:m,matchUpType:o,tieFormat:s}));let{matchUps:g,matchUpsMap:I}=nr({drawDefinition:a});s&&g?.forEach(w=>{if(!u.includes(w.matchUpId)){let{tieMatchUps:y}=sg({tieFormat:s,matchUp:w,isMock:r});Object.assign(w,{tieMatchUps:y,matchUpType:o})}});let{inContextDrawMatchUps:v}=Qp({drawDefinition:a,matchUpsMap:I});return ri({tournamentId:t.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:v,drawDefinition:a,matchUpsMap:I,...W,structures:d,matchUps:g,links:p}}function ly(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,s;if(!Dle({scaleItem:n}))return{error:qh};if(r&&Array.isArray(i.participants)&&(s=i.participants.find(o=>o.participantId===r),s)){if(s.participantType===Gn&&n?.eventType!==Ca)return{error:qh};let o=Ple({removePriorValues:e,participant:s,scaleItem:n});if(o.error)return o;a=!o.valueChanged;let{topics:l}=Ts();l.includes(nn)&&at({topic:nn,payload:{tournamentId:i.tournamentId,participants:[s]}})}return a&&{...W,info:JB,existingValue:n?.scaleValue}||s&&{...W,newValue:n?.scaleValue}||{error:Gi}}function Tle(t){let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=t;if(!r)return{error:Ie};if(!r.participants)return{error:yU};let s=0,o={},l=[];for(let d of e){let p=d?.participantId;if(Array.isArray(d?.scaleItems))for(let f of d.scaleItems)if(Dle({scaleItem:f}))Array.isArray(o[p])||(o[p]=[]),o[p].push(f);else return{error:qh}}for(let d of r.participants){let{participantId:p}=d||{};if(Array.isArray(o[p]))for(let f of o[p]){if(d.participantType===Gn&&f?.eventType!==Ca)return q({context:{participantId:p,scaleItem:f,participantType:d.participantType},info:"Invalid participantType for eventType",result:{error:qh}});Ple({participant:d,scaleItem:f,removePriorValues:i}),l.push(d),s++}}let u=s?void 0:Hv,{topics:c}=Ts();if(c.includes(nn)&&s&&at({topic:nn,payload:{tournamentId:r.tournamentId,participants:l}}),a){let{eventId:d,drawId:p,...f}=a,h=f.scaleAttributes?.scaleType&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let m={itemType:F2,itemValue:f};if(h&&(m.itemSubTypes=h),p||d){let{drawDefinition:g,event:I}=Kn({tournamentRecord:r,eventId:d,drawId:p});p&&FV({drawDefinition:g,timeItem:m}),d&&og({event:I,timeItem:m})}else dT({tournamentRecord:r,timeItem:m})}}return n&&c.includes(lc)&&at({topic:lc,payload:n}),je({...W,modificationsApplied:s,info:u})}function Dle({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e?.includes(r)).length===i.length}function Ple({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:Vm};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(u=>r.includes(u)&&i[u]).length!==n.length)return{error:qh};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:s}=su({scaleAttributes:i,participant:e}),o=u=>[void 0,null,""].includes(u),l=!(o(s?.scaleValue)&&o(i.scaleValue))&&JSON.stringify(s?.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[Rd,u,c,d].join("."),f=je({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(f.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(h=>h.itemType!==p)),e.timeItems.push(f)}return{...W,valueChanged:l,newValue:i.scaleValue}}function lj(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=He(t,[{[gr]:!0},{modifiedScaleValues:!0,[Jn]:Zn}]);if(n.error)return n;for(let a in i){let s=ly({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(s.error)return s}return{...W}}var iGe=(t=0)=>250/Math.pow(t+5,.4),rGe=()=>1;function nGe(t=3,e=2){let i=t/e;return Number.isNaN(i)?Rg.kDefault():i}var Rg={nSpread:400,diffThreshold:.125,kCalc:iGe,kMultiplier:nGe,kDefault:rGe};function Ele(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=Er,winnerCountables:n=1,loserCountables:a=0,ratingType:s="ELO",maxCountables:o,countables:l}=t||{},u=r?.[s];if(!u)return{error:Je};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,f=d?c.slice().reverse():c,h=(A,O)=>Number.parseFloat(O)>=Math.min(...A)&&Number.parseFloat(O)<=Math.max(...A);(!h(c,e)||!h(c,i))&&(h(c,e)||(e=u.defaultInitialization),h(c,i)||(i=u.defaultInitialization));let m=Vg({targetRange:Er.ELO.range,sourceRange:f,value:d?c[0]-e:e}),g=Vg({targetRange:Er.ELO.range,sourceRange:f,value:d?c[0]-i:i}),I=(A,O)=>1/(1+Math.pow(10,(O-A)/Rg.nSpread)),v=I(m,g),w=I(g,m),y=Rg.kCalc(n),b=Rg.kCalc(a),S=Rg.kMultiplier(o,l),U=m+S*y*(1-v),T=g+S*b*(0-w),D=Vg({sourceRange:Er.ELO.range,value:U,targetRange:f}),P=Vg({sourceRange:Er.ELO.range,value:T,targetRange:f}),E=d?c[0]-D:D,R=Number.parseFloat(E.toFixed(p)),C=d?c[0]-P:P,M=Number.parseFloat(C.toFixed(p)),N=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(D>P&&N>Rg.diffThreshold||R<0||M<0)&&(R=e,M=i),{newWinnerRating:R,newLoserRating:M}}var aGe=t=>t?.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0])||[0,0];function Rle(t){let e=He(t,[{[gr]:!0},{matchUpIds:!0,[Jn]:on,[zs]:$m},{ratingType:!1,[Yr]:v=>Er[v]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a="ELO",refreshDynamic:s,considerGames:o,drawDefinition:l,matchUpIds:u,asDynamic:c}=t,d=Er[a],{accessor:p}=d,f={},h=(t.matchUps||s&&xn({drawDefinition:l,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:Qi}}).matchUps||Tr({matchUpFilters:{matchUpIds:u,matchUpStatuses:Qi},tournamentRecord:n,inContext:!0}).matchUps)??[],m=`${a}.${P2}`,g=c?m:a;h.sort(eg);for(let v of h){let{endDate:w,matchUpFormat:y,score:b,sides:S,winningSide:U}=v,T=v.matchUpType,D={eventType:T,scaleName:a,scaleType:md},P={scaleName:m,eventType:T,scaleType:md},E=Object.assign({},...(S??[]).map(x=>{let{sideNumber:L,participant:$}=x;return L&&{[L]:[$?.participantId,...$?.individualParticipantIds??[]].filter(Boolean).flat()}})),R=Object.assign({},...Object.values(E).flat().map(x=>{let L=f[x],$=!s||L?em({scaleAttributes:P,tournamentRecord:n,participantId:x}).scaleItem:void 0,V=em({tournamentRecord:n,scaleAttributes:D,participantId:x}).scaleItem,_=p?{[p]:void 0}:void 0;return x&&{[x]:$??V??{scaleName:g,eventType:T,scaleDate:w,scaleType:md,scaleValue:_}}})),C=y?Xi(y):{},M=C?.bestOf||1,N=C?.setsTo||1,A=o?M&N:M,O=b?.sets&&aGe(b.sets)||U===1&&[1,0]||[0,1],k=U?E[U]:[],F=U?E[3-U]:[];for(let x of k){let L=R[x]?.scaleValue,$=typeof L=="object"?L[p]:L;for(let V of F){let _=R[V]?.scaleValue,B=typeof _=="object"?_[p]:_,G=U?O[U]:[0,0],j=U?O[3-U]:[0,0],{newWinnerRating:Y,newLoserRating:K}=Ele({winnerCountables:G,loserCountables:j,maxCountables:A,winnerRating:$,loserRating:B,ratingType:a}),X=p?{...L,[p]:Y}:Y,Z=p?{..._,[p]:K}:K;R[x].scaleValue=X,R[V].scaleValue=Z,R[x].scaleName=g,R[V].scaleName=g}}Object.assign(f,R),i&&lj({tournamentRecord:n,modifiedScaleValues:f,removePriorValues:r})}let I=h.map(({matchUpId:v})=>v);return{...W,modifiedScaleValues:f,outputScaleName:g,processedMatchUpIds:I}}function zN(t){let{matchUpIds:e=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:s}=t;if(typeof i!="object")return{error:$e};let{participantIdPairings:o,matchUpsCount:l}=t,u=jN(t);if(u.error)return q({result:u});let{lastRoundNumber:c,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=u;if(!l)n?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return q({result:{error:re,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(o&&!Array.isArray(o)||l&&!ct(l)||e&&!Array.isArray(e)||!o&&!l)return{error:re,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:re,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(c||0))return{error:re,info:"roundNumber error"};let f=r??(n&&(c??0)+1||c||1);o=o??Ce(0,l).map(()=>({participantIds:[void 0,void 0]}));let h=g=>{if(!t.idPrefix)return;let I=i.drawId,v=t.idPrefix??"ah";return`${I}-${v}-${f}-${g}`},m=o?.map((g,I)=>{let v=g?.participantIds??[void 0,void 0];v.push(void 0,void 0);let w=v.slice(0,2).map((b,S)=>je({sideNumber:S+1,participantId:b})),y=e[I]??h(I)??Et();return{roundNumber:f,matchUpStatus:$i,matchUpId:y,sides:w}});if(m?.length){let g=bn({drawDefinition:i,event:s})?.tieFormat;g&&m.forEach(I=>{let{tieMatchUps:v}=sg({tieFormat:g,matchUp:I,isMock:a});Object.assign(I,{tieMatchUps:v,matchUpType:ti})})}return{roundNumber:f,matchUpsCount:m?.length??0,matchUps:m,...W}}function sGe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(v=>({[v.pairing]:v.value}))),s=Object.keys(i),o=[],l=g3({actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),u=[jk(l)];o.push(l);let c=l.value,d=l,p=1,f=0,h=s.length,m;do h-=1,m=s.length*i[s[0]].length;while(m>t&&h>5);let g=[];s.forEach(v=>{i[v].slice(0,h).forEach(w=>{f+=1;let y=Ph(v,w.opponent);if(!g.includes(y)){let b=g3({stipulated:[[v,w.opponent]],actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!u.includes(jk(b))){u.push(jk(b)),o.push(b);let{maxDelta:S,value:U}=b;S<d.maxDelta&&(d=b),(U<c||U===c&&Math.round(Math.random()))&&(c=U),g.push(y),p+=1}}}),o=o.filter(w=>Math.abs(w.value-c)<5)}),o.sort((v,w)=>v.maxDiff-w.maxDiff);let I=wa(o);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:f,candidate:I}}function jk(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function g3({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let s=e.flat(),o=[],l=0;e.filter(Boolean).forEach(d=>{let[p,f]=d,h=Ph(p,f),m=i[h];o.push({participantIds:d,value:m}),l+=i[h]}),Sr(t,a).flatMap(d=>An(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((f,h)=>s.includes(h)||f,!1)){s.push(...p);let f=d.value;l+=f,o.push({participantIds:p,value:f})}}),o.sort((d,p)=>d.value-p.value);let u=o.reduce((d,p)=>{let[f,h]=p.participantIds,m=Ph(f,h),g=r[m];return Math.max(g,d)},0),c=o.reduce((d,p)=>{let[f,h]=p.participantIds,m=Ph(f,h),g=n[m];return Math.max(g,d)},0);return{value:l,participantIdPairings:o,maxDelta:u,maxDiff:c}}function Ph(t,e){return[t,e].sort(CN).join("|")}function Cle({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let s=Ph(a,n);i.includes(s)||i.push(s)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function oGe({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(wt);if(r.length===2){let[n,a]=r,s=Ph(n,a);e.includes(s)||e.push(s)}}return{encounters:e}}function lGe({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(s=>r(n,s));i[n]=a.sort((s,o)=>s.value-o.value)}function r(n,a){let s=Ph(n,a);return{opponent:a,value:e[s]}}return{pairingValues:i}}var uGe=0;function cGe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){let a=Er[r]?.defaultInitialization??uGe;return n.split("|").map(s=>{if(i===Is){let o=t?.find(l=>l.participantId===s)?.individualParticipantIds;return o?o?.map(l=>e[l]||a):a*2}else return e[s]||a})}function dGe(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:s,deltaObjects:o,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;n.forEach(w=>{let y=cGe({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:w}),b=typeof d=="number"&&d||.5,S=d&&(Math.round(Math.random())?b:b*-1)||0,U=Math.abs(y[0]-y[1])+S,T=Math.abs(y[0]-y[1]);o[w]=T,l[w]||(l[w]=0),l[w]+=U?Math.pow(U,2):0});let p=n.map(w=>({pairing:w,value:l[w]})).sort((w,y)=>w.value-y.value),{pairingValues:f}=lGe({possiblePairings:r,valueObjects:l}),{candidate:h,candidatesCount:m,deltaCandidate:g,iterations:I}=sGe({valueSortedPairings:p,maxIterations:a,pairingValues:f,deltaObjects:o,valueObjects:l}),{participantIdPairings:v}=s?g:h;return{participantIdPairings:v,candidatesCount:m,deltaCandidate:g,iterations:I,candidate:h}}var pGe=100,fGe=100,hGe=4e3;function uj(t){let{encounterValue:e=pGe,sameTeamValue:i=fGe,maxIterations:r=hGe,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:s,iterationMatchUps:o,tournamentRecord:l,dynamicRatings:u,refreshDynamic:c,participantIds:d,drawDefinition:p,roundNumber:f,structureId:h,matchUpIds:m,eventType:g,scaleName:I,idPrefix:v,isMock:w,salted:y,event:b}=t;if(!p)return{error:$e};if(!t.structure&&!h)return{error:yi};let S=t.structure||tt({drawDefinition:p,structureId:h}).structure;if(!Ut(S))return{error:wf};if(!d?.length)return{error:Jd};let U=[...o??[],...S?.matchUps??[]],{encounters:T}=oGe({matchUps:U}),D=l?.participants??[],P={};if(u){let G=lt(S?.matchUps?S.matchUps.map(({roundNumber:Y})=>Y):[]),j=Math.max(...G,0);if(j){let Y=S?.matchUps?.filter(({roundNumber:X})=>X===j).map(({matchUpId:X})=>X),K=Rle({ratingType:I??b?.category?.ratingType,updateParticipantRatings:n,tournamentRecord:l,asDynamic:!0,refreshDynamic:c,drawDefinition:p,matchUpIds:Y});if(K.error)return K;K.modifiedScaleValues&&(P=K.modifiedScaleValues)}}let{valueObjects:E}=mGe({tournamentParticipants:D,encounterValue:e,sameTeamValue:i,encounters:T}),{uniquePairings:R,possiblePairings:C,deltaObjects:M}=Cle({participantIds:d}),N=Object.values(P).length?P:t.adHocRatings,A={tournamentParticipants:D,possiblePairings:C,uniquePairings:R,maxIterations:r,adHocRatings:N,deltaObjects:M,valueObjects:E,eventType:g,scaleName:I,salted:y},{candidatesCount:O,participantIdPairings:k,deltaCandidate:F,iterations:x,candidate:L}=dGe(A);if(!O)return{error:jM};let $,V;if(a){let G=zN({structureId:S?.structureId,ignoreLastRoundNumber:s,participantIdPairings:k,newRound:!0,drawDefinition:p,roundNumber:f,matchUpIds:m,idPrefix:v,isMock:w,event:b});if(G.error)return G;$=G.roundNumber,V=G.matchUps}let{maxDelta:_,maxDiff:B}=L;return{roundNumber:$,participantIdPairings:k,modifiedScaleValues:P,candidatesCount:O,deltaCandidate:F,...W,iterations:x,matchUps:V,maxDelta:_,maxDiff:B}}function mGe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let s of t)n[s]||(n[s]=0),n[s]+=i;let a=e?.filter(({participantType:s})=>s===$t);if(a)for(let s of a){let o=s.individualParticipantIds??[],{uniquePairings:l}=Cle({participantIds:o});for(let u of l)n[u]||(n[u]=0),n[u]+=r}return{valueObjects:n}}function Mle(t){let{drawType:e=al,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:s,placeByes:o,isMock:l,event:u}=t,c=t?.drawDefinition;if(!c)return{error:$e};let d=Mr,p=Km({stageSequence:1,drawDefinition:c,stage:d}),f=[no,EU,Pu].includes(e)?p.length:$v(p.length);if(!a&&e===zv&&p.length<2||e===no&&p.length<3)return{error:kM};let{tieFormat:h,matchUpType:m}=t;if(h){let E=qn({tieFormat:h});if(E.error)return E}h=zr(h??bn({drawDefinition:c})?.tieFormat),m=m??c.matchUpType;let{structures:g}=so({stageSequence:1,drawDefinition:c,stage:d});if(g.length>1)return{error:Hie};if(g?.[0]?.matchUps?.length)return{error:e2};let I=g?.[0]?.structureId;Object.assign(t,je({structureName:t.structureName??Zr(Mr),structureId:I,matchUpType:m,tieFormat:h,drawSize:f,stage:d}));let v=Ule(t);if(v.error)return v;let w=v.generators[e];if(!w)return{error:AB};let y=w?.();if(y.error)return y;let{structures:b,links:S}=y,U=b.flatMap(E=>Ot({structure:E}).matchUps);h&&U.forEach(E=>{let{tieMatchUps:R}=sg({matchUp:E,tieFormat:h,isMock:l});Object.assign(E,{tieMatchUps:R,matchUpType:m})}),(!r||!i)&&(c=xe(c,!1,!0)),c.links??=[],S.length&&c.links.push(...S);let T=new Set(b.map(({structureId:E})=>E));c.structures??=[];let D=new Set(c.structures.map(({structureId:E})=>E));c.structures=c.structures.map(E=>T.has(E.structureId)?b.find(({structureId:R})=>R===E.structureId):E);let P=b.filter(({structureId:E})=>!D.has(E));return P.length&&c.structures.push(...P),s&&aT({seedingProfile:t.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:c,structureId:I,placeByes:o,drawSize:f,event:u}),i&&ri({drawDefinition:c}),{links:S,structures:b,...W}}var cj={};ft(cj,{ScoringEngine:()=>Lle,addPoint:()=>Ep,analyzeScore:()=>Cj,analyzeSequence:()=>Iue,analyzeSet:()=>Tw,calculateMatchStatistics:()=>wj,calculatePointsTo:()=>YN,checkScoreHasValue:()=>hr,checkSetIsComplete:()=>QN,createMatchUp:()=>dd,deduceMatchUpFormat:()=>nA,enrichPointHistory:()=>xle,exportMatchUpJSON:()=>OWe,generate:()=>Nle,generateScoreString:()=>ou,generateTieMatchUpScore:()=>uT,getEpisodes:()=>bj,getQuickStats:()=>Fle,getScore:()=>xd,getScoreboard:()=>Ij,getSetComplement:()=>Nj,getSetScoreString:()=>IWe,getTiebreakComplement:()=>rA,getWinner:()=>vj,groupByMatch:()=>wue,helpers:()=>$le,inferServeSide:()=>pj,isComplete:()=>yj,isValidMatchUpFormat:()=>qa,keyValueScore:()=>sue,mcpValidator:()=>kWe,mutate:()=>_le,parseCSV:()=>bue,parseMCPPoint:()=>yue,parseMatchUpFormat:()=>Xi,parseScoreString:()=>IT,pbpValidator:()=>yWe,pointParser:()=>vue,query:()=>due,resolvePointValue:()=>fj,reverseScore:()=>Ale,shotParser:()=>TF,shotSplitter:()=>gue,stringifyMatchUpFormat:()=>KM,tidyScore:()=>cue,toStatObjects:()=>Sj,validateMCPMatch:()=>Sue,validateMatchUp:()=>fue,validateMatchUpScore:()=>pue,validateScore:()=>Mj,validateSet:()=>vWe,validateSetScore:()=>Rj,validateTieFormat:()=>qn});var Nle={};ft(Nle,{ScoringEngine:()=>Lle,generateScoreString:()=>ou,generateTieMatchUpScore:()=>uT,reverseScore:()=>Ale});function ou(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:r,reversed:n=!1,matchUpStatus:a,matchUpFormat:s,autoComplete:o,winningSide:l,sets:u}=t;if(!u)return{error:Je,info:"missing sets"};let c=s&&Xi(s),{bestOf:d,finalSetFormat:p,setFormat:f}=c??{},h=n||!(!e||!l||l===1),m=r?gGe({matchUpStatus:a}):"",g=u?.sort(IGe).map(I).filter(Boolean).join(" ")||"";if(!m)return g;if(l===2)return`${m} ${g}`;return`${g} ${m}`;function I(v){let w=d&&v.setNumber===d&&p?p:f,y=V=>Ni(V?.side1Score)||Ni(V?.side2Score),b=(V=>Ni(V?.side1TiebreakScore)||Ni(V?.side2TiebreakScore))(v),S=w?.tiebreakSet||!y(v)&&b,{side1Score:U,side2Score:T,side1TiebreakScore:D,side2TiebreakScore:P}=v,E=D||(Ni(D)||b&&o?0:""),R=P||(Ni(P)||b&&o?0:"");if(S){let V=y(v)&&!b,_=V?U:E,B=V?T:R;return`[${(h?[B,_]:[_,B]).join("-")}]`}let C=b?Math.min(E,R):"",M=C===E?1:2,N=Ni(C)?`(${C})`:"",A=U||(Ni(U)||o?0:""),O=T||(Ni(T)||o?0:""),k=V=>!i&&M===V?N:"",F=`${A}${k(1)}`,x=`${O}${k(2)}`,L=i&&b?`(${C})`:"",$=h?`${[x,F].join("-")}${L}`:`${[F,x].join("-")}${L}`;return["-"," "].includes($)&&($=""),$}}function gGe({matchUpStatus:t}){let e={[Ur]:"RET",[si]:"WO",[zi]:"DF/DF",[Ui]:"WO/WO",[tp]:"SUS",[Ma]:"ABN",[Yt]:"DEF",[Jv]:"DR"};return t&&e[t]||""}function IGe(t,e){return t.setNumber-e.setNumber}function Ale(t){if(!t?.score)return{error:Je};let{sets:e}=t.score,i=e.map(s=>{let{side1TiebreakScore:o,side2TiebreakScore:l,winningSide:u,side1Score:c,side2Score:d,setNumber:p}=s;return je({winningSide:u?3-u:void 0,side1TiebreakScore:l,side2TiebreakScore:o,side1Score:d,side2Score:c,setNumber:p})}),r=t?.setTBlast,n=ou({setTBlast:r,sets:i}),a=ou({sets:i,reversed:!0,setTBlast:r});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:a},...W}}function dd(t){let{matchUpId:e=Et(),matchUpFormat:i,participants:r=[],isDoubles:n=!1,matchUpType:a}=t,s=a||(n?"DOUBLES":"SINGLES"),o=r.map((l,u)=>({sideNumber:u+1,participantId:l.participantId,participant:l}));return o.length===0&&o.push({sideNumber:1},{sideNumber:2}),{matchUpId:e,matchUpFormat:i,matchUpStatus:"TO_BE_PLAYED",matchUpType:s,sides:o,score:{sets:[]},createdAt:new Date().toISOString()}}function dj(t){return t?!!t.aggregate:!1}function qN(t,e){let i=t.bestOf||t.exactly||3,r=Math.ceil(i/2);if(e[0]===r-1&&e[1]===r-1&&t.finalSetFormat){let a=t.finalSetFormat;return a.tiebreakSet?"matchTiebreak":a.timed?"timed":"standard"}let n=t.setFormat;return n?n.tiebreakSet?"tiebreakOnly":n.timed?"timed":"standard":"standard"}function YN(t,e,i,r,n){if(i==="timed"||!r)return;let a=vGe(t),s=yGe(t),o=e.exactly||e.bestOf||3,l=Math.ceil(o/2),{side1Points:u,side2Points:c}=bGe(a),d=wGe(u,c,r,i,e,a),p=UGe(a,r,i),f=TGe(d,p,r,i),h=DGe(f,s,l,e),m=EGe(d,n);return{pointsToGame:d,pointsToSet:f,pointsToMatch:h,gamesToSet:p,isBreakpoint:m}}function vGe(t){let e=t.score.sets;if(e.length===0)return;let i=e.at(-1);return i?.winningSide===void 0?i:void 0}function yGe(t){let e=[0,0];return t.score.sets.forEach(i=>{i.winningSide===1&&e[0]++,i.winningSide===2&&e[1]++}),e}function bGe(t){if(!t)return{side1Points:0,side2Points:0};let e=t.side1GameScores||[],i=t.side2GameScores||[];if(e.length===0&&i.length===0)return{side1Points:0,side2Points:0};let r=Math.max(e.length,i.length)-1;return{side1Points:e[r]??0,side2Points:i[r]??0}}function wGe(t,e,i,r,n,a){if(r==="tiebreakOnly"){let s=i.tiebreakSet?.tiebreakTo||11,o=i.tiebreakSet?.NoAD||!1;return Gk(t,e,s,o)}if(r==="matchTiebreak"){let s=n.finalSetFormat?.tiebreakSet?.tiebreakTo||10,o=n.finalSetFormat?.tiebreakSet?.NoAD||!1;return Gk(t,e,s,o)}if(a){let s=a.side1Score||0,o=a.side2Score||0,l=i.setTo||6,u=(typeof i.tiebreakAt=="number"?i.tiebreakAt:void 0)??l;if(!i.noTiebreak&&s===u&&o===u){let c=i.tiebreakFormat?.tiebreakTo||7,d=i.tiebreakFormat?.NoAD||!1;return Gk(t,e,c,d)}}if(n.gameFormat?.type==="CONSECUTIVE"){let s=n.gameFormat.count||3;return[s,s]}return SGe(t,e,i)}function SGe(t,e,i){let r=i.gameFormat?.NoAD||i.NoAD||!1,n=4;return[I3(t,e,n,r),I3(e,t,n,r)]}function I3(t,e,i,r){if(t>=i-1&&e>=i-1){if(r)return t>e?0:t===e?1:2;let n=t-e;return n>=2?0:n===1?1:2}return t>=i?0:i-t}function Gk(t,e,i,r){return[v3(t,e,i,r),v3(e,t,i,r)]}function v3(t,e,i,r){if(t>=i&&(t-e>=2||r&&t>e))return 0;if(t>=i-1&&e>=i-1){if(r)return t>e?0:t===e?1:2;let n=t-e;return n>=2?0:n===1?1:2}return t>=i?0:i-t}function UGe(t,e,i){if(i==="tiebreakOnly"||i==="matchTiebreak")return!t||t.winningSide!==void 0?[1,1]:[1,1];let r=t?.side1Score||0,n=t?.side2Score||0,a=e.setTo||6,s=(typeof e.tiebreakAt=="number"?e.tiebreakAt:void 0)??a,o=e.noTiebreak||!1,l=e.winBy||2;return[y3(r,n,a,s,o,l),y3(n,r,a,s,o,l)]}function y3(t,e,i,r,n,a){if(!n&&t===r&&e===r)return 1;if(t>=i){let o=t-e;return o>=a?0:a-o}let s=i-t;if(e>=i-1&&t>=i-1){if(!n)return Math.max(1,i-t);let o=t-e;return o>=a?0:a-o}return s}function TGe(t,e,i,r){if(r==="tiebreakOnly"||r==="matchTiebreak")return[...t];let n=4;return[b3(t[0],e[0],n),b3(t[1],e[1],n)]}function b3(t,e,i){if(e<=0)return 0;let r=Math.max(0,e-1);return t+r*i}function DGe(t,e,i,r){let n=r.setFormat,a=PGe(n,r);return[w3(t[0],e[0],i,a),w3(t[1],e[1],i,a)]}function PGe(t,e){if(!t)return 24;if(t.tiebreakSet)return t.tiebreakSet.tiebreakTo||11;if(t.timed)return 0;let i=t.setTo||6,r=e.gameFormat?.type==="CONSECUTIVE"?e.gameFormat?.count||3:4;return i*r}function w3(t,e,i,r){if(e>=i)return 0;let n=Math.max(0,i-e-1);return t+n*r}function EGe(t,e){if(e===void 0)return!1;let i=1-e;return t[i]===1}function pj(t,e,i){if(i==="timed")return;let r=RGe(t);return dj(e)?CGe(t,r):i==="tiebreakOnly"||i==="matchTiebreak"?MGe(r):NGe(t,e,r)}function RGe(t){let e=t.score.sets;if(e.length===0)return;let i=e[e.length-1];return i.winningSide===void 0?i:void 0}function CGe(t,e){let i=0;for(let r of t.score.sets)r.winningSide!==void 0&&(r.side1TiebreakScore!==void 0?i+=(r.side1TiebreakScore??0)+(r.side2TiebreakScore??0):i+=(r.side1Score??0)+(r.side2Score??0));if(e&&e.winningSide===void 0){let r=e.side1GameScores||[],n=e.side2GameScores||[];if(r.length>0||n.length>0){let a=Math.max(r.length,n.length)-1;i+=(r[a]??0)+(n[a]??0)}else i+=(e.side1Score??0)+(e.side2Score??0)}return i%2===0?"deuce":"ad"}function MGe(t){if(!t)return"deuce";let e=t.side1GameScores||[],i=t.side2GameScores||[];return e.length===0&&i.length===0||((e[0]??0)+(i[0]??0))%2===0?"deuce":"ad"}function NGe(t,e,i){if(!i)return"deuce";let r=i.side1GameScores||[],n=i.side2GameScores||[];if(r.length===0&&n.length===0)return"deuce";let a=Math.max(r.length,n.length)-1;return((r[a]??0)+(n[a]??0))%2===0?"deuce":"ad"}function fj(t,e){if(!e.length)return 1;for(let{condition:i,value:r}of e)if(i.results&&t.result&&i.results.includes(t.result)||i.strokes&&t.stroke&&i.strokes.includes(t.stroke))return r;return 1}function Ep(t,e,i){if(!Ut(e))return t;let r=e.winner,n=e.server,{timestamp:a}=e;if(r===void 0&&e.winningSide!==void 0&&(r=e.winningSide-1),n===void 0&&e.serverSideNumber!==void 0&&(n=e.serverSideNumber-1),r==null)return t;let s=t;s.history??={points:[]};let o=Xi(t.matchUpFormat);if(!o)throw new Error(`Invalid matchUpFormat: ${t.matchUpFormat}`);let l=o.exactly||o.bestOf||3,u=Math.ceil(l/2),c=s.history.points.length+1,d=s.history.points.length,p=[0,0];s.score.sets.forEach(U=>{U.winningSide===1&&p[0]++,U.winningSide===2&&p[1]++});let f=qN(o,p),h=p[0]===u-1&&p[1]===u-1,m=h&&o.finalSetFormat?o.finalSetFormat:o.setFormat,g=m?.tiebreakSet?.modifier==="RALLY"||m?.modifier==="RALLY";n===void 0&&!g&&(n=gj(s,o,f));let I=e.code;!I&&r!==void 0&&n!==void 0&&(I=r===n?"S":"R");let v={...e,pointNumber:c,winner:r,winningSide:r+1,server:n,serverSideNumber:n!==void 0?n+1:void 0,serverParticipantId:e.serverParticipantId,timestamp:a||new Date().toISOString()};I&&(v.code=I),v.index=d;let w=YN(s,o,f,m,n);w&&(v.pointsToGame=w.pointsToGame,v.pointsToSet=w.pointsToSet,v.pointsToMatch=w.pointsToMatch,v.gamesToSet=w.gamesToSet,v.isBreakpoint=w.isBreakpoint);let y=pj(s,o,f);y!==void 0&&(v.serveSide=y);let b=i?.pointMultipliers||[],S=e.scoreValue??fj(v,b);switch(S!==1&&(v.scoreValue=S),s.history.points.push(v),s.matchUpStatus==="TO_BE_PLAYED"&&(s.matchUpStatus="IN_PROGRESS"),f){case"tiebreakOnly":kGe(s,v,r,o,m,p,u,S);break;case"matchTiebreak":OGe(s,v,r,o,p,u,S);break;case"timed":xGe(s,v,r,m,S);break;default:AGe(s,v,r,o,m,p,u,h);break}return s}function AGe(t,e,i,r,n,a,s,o){let l=KN(t,!1,!1),u=t.score.sets.indexOf(l),c=l.side1Score||0,d=l.side2Score||0,p=l.side1GameScores||[],f=l.side2GameScores||[];p.length===0&&f.length===0&&(p.push(0),f.push(0));let h=Math.max(p.length,f.length)-1,m=h>=0?p[h]??0:0,g=h>=0?f[h]??0:0,I=Math.max(p.length,f.length)-1,v=c+d-I;e.set=u,e.game=v+h,e.number=m+g;let w=n.setTo||6,y=(typeof n.tiebreakAt=="number"?n.tiebreakAt:void 0)??w,b=o&&r.finalSetFormat?.noTiebreak;i===0?(m++,p[p.length-1]=m):(g++,f[f.length-1]=g),l.side1GameScores=p,l.side2GameScores=f;let S=r.gameFormat?.type==="CONSECUTIVE",U=r.gameFormat?.count||3;if(S){let E=l.currentStreak;E&&E.side===i?l.currentStreak={side:i,count:E.count+1}:l.currentStreak={side:i,count:1}}let T=!b&&c===y&&d===y,D;S&&!T?D=l.currentStreak.count>=U?l.currentStreak.side:void 0:D=FGe(m,g,n,T);let P=D===void 0?kle(m,g,T,S&&!T):"0-0";if(e.score=P,D!==void 0){S&&(l.currentStreak=void 0),D===0?l.side1Score=c+1:l.side2Score=d+1,T&&(l.side1TiebreakScore=m,l.side2TiebreakScore=g);let E=LGe(l.side1Score||0,l.side2Score||0,n,o,r.finalSetFormat);typeof E=="number"?(l.winningSide=E+1,hj(t,r,s)):(l.side1GameScores.push(0),l.side2GameScores.push(0))}}function kGe(t,e,i,r,n,a,s,o=1){let l=KN(t,!0,!1),u=t.score.sets.indexOf(l),c=n.tiebreakSet.tiebreakTo||11,d=n.tiebreakSet.NoAD||!1,p=l.side1GameScores||[],f=l.side2GameScores||[];p.length===0&&f.length===0&&(p.push(0),f.push(0),l.side1GameScores=p,l.side2GameScores=f);let h=p[0]||0,m=f[0]||0;e.set=u,e.game=0,e.number=h+m,i===0?(h+=o,p[0]=h):(m+=o,f[0]=m),l.side1GameScores=p,l.side2GameScores=f;let g=mj(h,m,c,d);e.score=g===void 0?`${h}-${m}`:"0-0",g!==void 0&&(l.winningSide=g+1,l.side1TiebreakScore=h,l.side2TiebreakScore=m,l.side1Score=g===0?1:0,l.side2Score=g===0?0:1,hj(t,r,s))}function OGe(t,e,i,r,n,a,s=1){let o=r.finalSetFormat?.tiebreakSet?.tiebreakTo||10,l=r.finalSetFormat?.tiebreakSet?.NoAD||!1,u=KN(t,!1,!1),c=t.score.sets.indexOf(u),d=u.side1GameScores||[],p=u.side2GameScores||[];d.length===0&&p.length===0&&(d.push(0),p.push(0),u.side1GameScores=d,u.side2GameScores=p);let f=d[0]||0,h=p[0]||0;e.set=c,e.game=0,e.number=f+h,i===0?(f+=s,d[0]=f):(h+=s,p[0]=h),u.side1GameScores=d,u.side2GameScores=p;let m=mj(f,h,o,l);e.score=m===void 0?`${f}-${h}`:"0-0",m!==void 0&&(u.side1TiebreakScore=f,u.side2TiebreakScore=h,u.side1Score=m===0?1:0,u.side2Score=m===0?0:1,u.winningSide=m+1,hj(t,r,a))}function xGe(t,e,i,r,n=1){let a=KN(t,!1,!0),s=t.score.sets.indexOf(a);e.set=s,e.game=0,e.number=(a.side1Score||0)+(a.side2Score||0),i===0?a.side1Score=(a.side1Score||0)+n:a.side2Score=(a.side2Score||0)+n;let o=a.side1Score||0,l=a.side2Score||0;e.score=`${o}-${l}`}function KN(t,e,i){let r=t.score.sets.length-1;if(r>=0&&t.score.sets[r].winningSide===void 0)return t.score.sets[r];let n={setNumber:t.score.sets.length+1,side1Score:0,side2Score:0,side1GameScores:[],side2GameScores:[]};return e&&(n.isTiebreakOnly=!0),i&&(n.isTimed=!0),t.score.sets.push(n),n}function hj(t,e,i){let r=[0,0];t.score.sets.forEach(o=>{o.winningSide===1&&r[0]++,o.winningSide===2&&r[1]++});let n=dj(e),a=e.exactly;if(n){let o=a||e.bestOf||3;if(t.score.sets.filter(u=>u.winningSide!==void 0).length<o)return;let l=t.score.sets.reduce((u,c)=>(c.side1TiebreakScore!==void 0&&c.side2TiebreakScore!==void 0?(u[0]+=c.side1TiebreakScore,u[1]+=c.side2TiebreakScore):(u[0]+=c.side1Score??0,u[1]+=c.side2Score??0),u),[0,0]);l[0]!==l[1]&&(t.matchUpStatus="COMPLETED",t.winningSide=l[0]>l[1]?1:2,t.endTime=new Date().toISOString());return}if(!(r[0]>=i||r[1]>=i)||a&&t.score.sets.filter(o=>o.winningSide!==void 0).length<a)return;let s=r[0]>=i?0:1;t.matchUpStatus="COMPLETED",t.winningSide=s+1,t.endTime=new Date().toISOString()}function mj(t,e,i,r=!1){let n=Math.abs(t-e),a=r?1:2;if((t>=i||e>=i)&&n>=a)return t>e?0:1}function FGe(t,e,i,r){let n=i.gameFormat?.NoAD||i.NoAD||!1;if(r){let o=i.tiebreakFormat?.tiebreakTo||7,l=i.tiebreakFormat?.NoAD||!1;return mj(t,e,o,l)}let a=4,s=Math.abs(t-e);if(n)return t>=a||e>=a?t>e?0:1:void 0;if((t>=a||e>=a)&&s>=2)return t>e?0:1}function LGe(t,e,i,r,n){let a=i.setTo||6,s=(typeof i.tiebreakAt=="number"?i.tiebreakAt:void 0)??a,o=r&&n?.noTiebreak;if(a===1)return t>=1||e>=1?t>e?0:1:void 0;let l=(r&&n?n:i).winBy||2;if(!o&&(t===s+1||e===s+1)||(t>=a||e>=a)&&Math.abs(t-e)>=l)return t>e?0:1}function gj(t,e,i){let r=_Ge(t,e,i);return t.history?.points?.[0]?.server===1?1-r:r}function _Ge(t,e,i){let r=t.score.sets.length-1,n=r>=0?t.score.sets[r]:void 0;if(i==="tiebreakOnly"||i==="matchTiebreak"){let u=n?.side1GameScores||[],c=n?.side2GameScores||[],d=(u[0]||0)+(c[0]||0),p=0;for(let m=0;m<t.score.sets.length-1;m++){let g=t.score.sets[m];p+=(g.side1Score||0)+(g.side2Score||0)}let f=p%2,h=Math.floor(d/2)%2;return(f+h)%2}if(i==="timed")return((n?.side1Score||0)+(n?.side2Score||0))%2;let a=n?.side1Score||0,s=n?.side2Score||0,o=e.setFormat?.setTo||6,l=(typeof e.setFormat?.tiebreakAt=="number"?e.setFormat.tiebreakAt:void 0)??o;if(!e.finalSetFormat?.noTiebreak&&a===l&&s===l){let u=n?.side1GameScores||[],c=n?.side2GameScores||[],d=(u.at(-1)||0)+(c.at(-1)||0),p=(a+s)%2,f=Math.floor(d/2)%2;return(p+f)%2}return(a+s)%2}function kle(t,e,i,r){if(i||r)return`${t}-${e}`;let n=["0","15","30","40"];if(t<4&&e<4)return`${n[t]}-${n[e]}`;if(t>=3&&e>=3&&t===e)return"40-40";if(t>=3&&e>=3){let a=t-e;if(a===1)return"A-40";if(a===-1)return"40-A";if(a>=2)return"G-40";if(a<=-2)return"40-G"}return t>=3?`40-${e<4?n[e]:"40"}`:e>=3?`${t<4?n[t]:"40"}-40`:`${t<4?n[t]:"0"}-${e<4?n[e]:"0"}`}function xd(t,e){let i=t.score.sets,r=VGe(t,e?.useBracketNotation),n=i.length>0?i.at(-1):null,a=n&&n.winningSide===void 0?[n.side1Score||0,n.side2Score||0]:[0,0],s=[0,0];if(n?.side1GameScores&&n.side2GameScores){let u=Math.max(n.side1GameScores.length,n.side2GameScores.length)-1;u>=0&&(s=[n.side1GameScores[u]||0,n.side2GameScores[u]||0])}let o=$Ge(t,s),l=BGe(t);return{sets:i,scoreString:r,games:a,points:s,pointDisplay:o,situation:l}}function $Ge(t,e){if(t.matchUpStatus==="COMPLETED"||t.matchUpStatus==="TO_BE_PLAYED")return;let i=Xi(t.matchUpFormat);if(!i)return;let r=t.score.sets.at(-1);if(!r||r.winningSide!==void 0)return;let n=[0,0];t.score.sets.forEach(c=>{c.winningSide===1&&n[0]++,c.winningSide===2&&n[1]++});let a=qN(i,n),s=a==="tiebreakOnly"||a==="matchTiebreak",o=i.gameFormat?.type==="CONSECUTIVE",l=s;if(!l&&a==="standard"){let c=i.exactly||i.bestOf||3,d=Math.ceil(c/2),p=n[0]===d-1&&n[1]===d-1,f=p&&i.finalSetFormat?i.finalSetFormat:i.setFormat;if(f){let h=r.side1Score||0,m=r.side2Score||0,g=f.setTo||6,I=(typeof f.tiebreakAt=="number"?f.tiebreakAt:void 0)??g,v=f.noTiebreak||!1,w=p&&i.finalSetFormat?.noTiebreak;l=!v&&!w&&h===I&&m===I}}let u=kle(e[0],e[1],l,o&&!l).split("-");return u.length===2?[u[0],u[1]]:[String(e[0]),String(e[1])]}function BGe(t){if(t.matchUpStatus==="COMPLETED"||t.matchUpStatus==="TO_BE_PLAYED")return;let e=Xi(t.matchUpFormat);if(!e)return;let i=e.exactly||e.bestOf||3,r=Math.ceil(i/2),n=[0,0];t.score.sets.forEach(y=>{y.winningSide===1&&n[0]++,y.winningSide===2&&n[1]++});let a=qN(e,n),s=n[0]===r-1&&n[1]===r-1,o=s&&e.finalSetFormat?e.finalSetFormat:e.setFormat,l=o?.tiebreakSet?.modifier==="RALLY"||o?.modifier==="RALLY",u;l||(u=gj(t,e,a));let c=YN(t,e,a,o,u);if(!c)return{isBreakPoint:!1,isGamePoint:!1,isSetPoint:!1,isMatchPoint:!1,isGoldenPoint:!1,isTiebreak:!1,server:u};let{pointsToGame:d,pointsToSet:p,pointsToMatch:f,isBreakpoint:h}=c,m=a==="tiebreakOnly"||a==="matchTiebreak";if(!m&&a==="standard"&&o){let y=t.score.sets.at(-1);if(y){let b=y.side1Score||0,S=y.side2Score||0,U=o.setTo||6,T=(typeof o.tiebreakAt=="number"?o.tiebreakAt:void 0)??U,D=o.noTiebreak||!1,P=s&&e.finalSetFormat?.noTiebreak;m=!D&&!P&&b===T&&S===T}}let g=!!(o?.NoAD||o?.gameFormat?.NoAD||m&&(o?.tiebreakFormat?.NoAD||o?.tiebreakSet?.NoAD||e.finalSetFormat?.tiebreakSet?.NoAD))&&d[0]===1&&d[1]===1,I=u===void 0?!1:d[u]===1,v=Math.min(p[0],p[1])===1,w=Math.min(f[0],f[1])===1;return{isBreakPoint:h,isGamePoint:I,isSetPoint:v,isMatchPoint:w,isGoldenPoint:g,isTiebreak:m,server:u}}function VGe(t,e=!1){let i=t.score.sets;return i.length===0?"0-0":i.map(r=>{let n=r.side1Score||0,a=r.side2Score||0;if(r.side1TiebreakScore!==void 0||r.side2TiebreakScore!==void 0){let s=r.side1TiebreakScore||0,o=r.side2TiebreakScore||0;return e&&(n===0&&a===1||n===1&&a===0)?`[${s}-${o}]`:n>a?`${n}-${a}(${o})`:`${n}(${s})-${a}`}return`${n}-${a}`}).join(", ")}function Ij(t,e){let i=t.score.sets;if(i.length===0)return"0-0";let r=e?.perspective,n=i.map(s=>{let o=s.side1Score||0,l=s.side2Score||0;if(r===1&&([o,l]=[l,o]),s.side1TiebreakScore!==void 0||s.side2TiebreakScore!==void 0){let u=s.side1TiebreakScore||0,c=s.side2TiebreakScore||0;return r===1&&([u,c]=[c,u]),o>l?`${o}-${l}(${c})`:`${o}(${u})-${l}`}return`${o}-${l}`}),a=i.at(-1);if(t.matchUpStatus==="IN_PROGRESS"&&a&&!a.winningSide){let s=a.side1GameScores||[],o=s.length-1;if(o>=0&&s.length>0){let l=s[o]||0,u=(a.side2GameScores||[])[o]||0;if(l===0&&u===0)return n.join(", ");r===1&&([l,u]=[u,l]);let c=a.side1Score||0,d=a.side2Score||0,p=t.matchUpFormat?Xi(t.matchUpFormat):void 0,f=p?.setFormat?.setTo||6,h=(typeof p?.setFormat?.tiebreakAt=="number"?p.setFormat.tiebreakAt:void 0)??f,m=c===h&&d===h,g=p?.gameFormat?.type==="CONSECUTIVE",I=n.at(-1),v=`${n.slice(0,-1).join(", ")}${n.length>1?", ":""}${I}`;if(m||g)return`${v} (${l}-${u})`;{let w=jGe(l,u);return`${v} (${w})`}}}return n.join(", ")}function jGe(t,e){let i=["0","15","30","40"];if(t<=3&&e<=3)return`${i[t]}-${i[e]}`;if(t>=3&&e>=3){let r=t-e;return r===0?"40-40":r===1?"A-40":r===-1?"40-A":r>=2?"G-40":"40-G"}return t>=3?"G-40":e>=3?"40-G":`${i[t]}-${i[e]}`}function vj(t){if(t.matchUpStatus==="COMPLETED")return t.winningSide}function yj(t){return t.matchUpStatus==="COMPLETED"}function bj(t){if(!t)return[];let e=t.history?.points;if(!e||e.length===0)return[];let i=[];for(let r=0;r<e.length;r++){let n=e[r],a=r<e.length-1?e[r+1]:void 0,s=n.set??0,o=n.game??0,l=n.number??0,u=a?a.set??0:void 0,c=a?a.game??0:void 0,d=r===e.length-1,p=d?t.matchUpStatus==="COMPLETED"||u===void 0&&c===void 0:u!==s||c!==o,f=d?t.matchUpStatus==="COMPLETED"||!1:a!==void 0&&u!==s,h;p&&(h=n.winner);let m;if(f){let b=t.score.sets[s];b?.winningSide!==void 0&&(m=b.winningSide-1)}let g={};n.pointsToGame&&(g.pointsToGame=n.pointsToGame),n.pointsToSet&&(g.pointsToSet=n.pointsToSet),n.pointsToMatch&&(g.pointsToMatch=n.pointsToMatch),n.gamesToSet&&(g.gamesToSet=n.gamesToSet),n.isBreakpoint!==void 0&&(g.isBreakpoint=n.isBreakpoint);let I=a?.server??n.server??0,v=t.score.sets[s],w=!!(v?.isTiebreakOnly||o>0&&v&&v.side1Score!==void 0&&v.side2Score!==void 0&&!v.isTiebreakOnly),y={action:"addPoint",point:{index:r,number:l,winner:n.winner,server:n.server,score:n.score,result:n.result},game:{index:o,isTiebreak:w,complete:p,winner:h},set:{index:s,complete:f,winner:m},needed:g,nextService:I,result:n.result,complete:d&&t.matchUpStatus==="COMPLETED"};i.push(y)}return i}var GGe={A:"Ace",D:"Double Fault",S:"Serve Winner",R:"Return Winner",W:"Winner",E:"Unforced Error",F:"Forced Error"},HGe=new Set(["A","S"]),WGe=new Set(["D","R","E","F"]);function zGe(t,e){let i={...t};return i.server=e.server,i.index=e.index,i.set=e.set,i.game=e.game,i.code&&!i.winner&&(i.winner=qGe(i.code,e.server)),i.code&&!i.result&&(i.result=GGe[i.code]),i.first_serve?i.serve=2:i.serve||(i.serve=1),i}function qGe(t,e){return HGe.has(t)?e:WGe.has(t)?1-e:e}function YGe(t){let e=[],i=[],r=t.result?.toLowerCase()||"";return r.includes("ace")&&e.push("aces"),(r.includes("winner")||r.includes("ace"))&&e.push("winners"),r.includes("double fault")&&i.push("doubleFaults"),r.includes("unforced error")&&i.push("unforcedErrors"),r.includes("forced error")&&i.push("forcedErrors"),t.winner===t.server?(e.push("servesWon"),t.serve===1?e.push("serves1stWon"):t.serve===2&&e.push("serves2ndWon")):(e.push("returns"),t.serve===1?e.push("received1stWon"):t.serve===2&&e.push("received2ndWon")),e.push("pointsWon"),{winner:e,loser:i}}function Ole(t,e){let i={players:{},teams:{}};for(let a=0;a<2;a++)i.players[a]={},i.teams[a]={};let r=t;e?.setFilter!==void 0&&(r=t.filter(a=>a.set===e.setFilter));let n;return r.forEach((a,s)=>{if(a.winner===void 0){console.warn("Point missing winner:",a);return}let{winner:o,loser:l}=YGe(a),u=a.winner,c=1-u;if(o.forEach(d=>{i.teams[u][d]||(i.teams[u][d]=[]),i.teams[u][d].push(a),i.players[u][d]||(i.players[u][d]=[]),i.players[u][d].push(a)}),l.forEach(d=>{i.teams[c][d]||(i.teams[c][d]=[]),i.teams[c][d].push(a),i.players[c][d]||(i.players[c][d]=[]),i.players[c][d].push(a)}),a.server!==void 0){let d=a.server;i.teams[d].pointsServed||(i.teams[d].pointsServed=[]),i.teams[d].pointsServed.push(a),a.serve===1?(i.teams[d].serves1stIn||(i.teams[d].serves1stIn=[]),i.teams[d].serves1stIn.push(a)):a.serve===2&&(i.teams[d].serves2ndIn||(i.teams[d].serves2ndIn=[]),i.teams[d].serves2ndIn.push(a))}if(a.hand){let d=a.hand;i.teams[u][d]||(i.teams[u][d]=[]),i.teams[u][d].push({point:a,index:s})}if(KGe(a,n)&&n?.winner!==void 0){let d=n.winner;i.teams[d].gamesWon||(i.teams[d].gamesWon=[]),i.teams[d].gamesWon.push(n),i.players[d].gamesWon||(i.players[d].gamesWon=[]),i.players[d].gamesWon.push(n)}if(a.breakpoint){let d=a.server;i.teams[d].breakpointsFaced||(i.teams[d].breakpointsFaced=[]),i.teams[d].breakpointsFaced.push(a),u===d&&(i.teams[d].breakpointsSaved||(i.teams[d].breakpointsSaved=[]),i.teams[d].breakpointsSaved.push(a))}n=a}),i}function KGe(t,e){return e&&t.game!==void 0&&e.game!==void 0?t.game!==e.game:!1}function XGe(t){let e={totalPoints:0,byTeam:[0,0],byCategory:{}};for(let r=0;r<2;r++)if(t.teams[r].pointsWon){let n=t.teams[r].pointsWon.length;e.byTeam[r]=n,e.totalPoints+=n}let i=new Set;for(let r=0;r<2;r++)Object.keys(t.teams[r]).forEach(n=>i.add(n));return i.forEach(r=>{e.byCategory[r]=0;for(let n=0;n<2;n++)t.teams[n][r]&&(e.byCategory[r]+=t.teams[n][r].length)}),e}function JGe(t){if(!t?.teams)return[];let e=[];return Object.values({Aces:{category:"Aces",numerators:["aces"],calc:"number"},"Double Faults":{category:"Double Faults",numerators:["doubleFaults"],calc:"number"},Winners:{category:"Winners",numerators:["winners"],calc:"number"},"Unforced Errors":{category:"Unforced Errors",numerators:["unforcedErrors"],calc:"number"},"Forced Errors":{category:"Forced Errors",numerators:["forcedErrors"],calc:"number"},"Total Points Won":{category:"Total Points Won",numerators:["pointsWon"],calc:"number"},"Max Pts/Row":{category:"Max Pts/Row",numerators:["pointsWon"],calc:"maxConsecutive",attribute:"index"},"Max Games/Row":{category:"Max Games/Row",numerators:["gamesWon"],calc:"maxConsecutive",attribute:"game"},"First Serve %":{category:"First Serve %",numerators:["serves1stIn"],denominators:["pointsServed"],calc:"percentage"},"Points Won 1st":{category:"Points Won 1st",numerators:["serves1stWon"],denominators:["serves1stIn"],calc:"percentage"},"Points Won 2nd":{category:"Points Won 2nd",numerators:["serves2ndWon"],denominators:["serves2ndIn"],calc:"percentage"},"Points Won Receiving":{category:"Points Won Receiving",numerators:["received1stWon","received2ndWon"],denominators:["-pointsServed"],calc:"percentage"},"Breakpoints Saved":{category:"Breakpoints Saved",numerators:["breakpointsSaved"],denominators:["breakpointsFaced"],calc:"percentage"},"Breakpoints Converted":{category:"Breakpoints Converted",numerators:["-breakpointsSaved"],denominators:["-breakpointsFaced"],calc:"difference"},"Games Won":{category:"Games Won",numerators:["gamesWon"],calc:"number"},"Service Points Won":{category:"Service Points Won",numerators:["servesWon"],denominators:["pointsServed"],calc:"percentage"},"Aggressive Margin":{category:"Aggressive Margin",numerators:["*doubleFaults","*unforcedErrors"],denominators:["*aces","*winners","-*forcedErrors"],calc:"aggressiveMargin"}}).forEach(i=>{let r=[S3(i,t.teams,0),S3(i,t.teams,1)];(r[0].value!==0||r[1].value!==0)&&e.push({category:i.category,teams:r})}),e}function S3(t,e,i){switch(t.calc){case"number":return QGe(t,e,i);case"percentage":return ZGe(t,e,i);case"maxConsecutive":return eHe(t,e,i);case"difference":return tHe(t,e,i);case"aggressiveMargin":return iHe(t,e,i)}}function QGe(t,e,i){let r=rm(t.numerators,e,i);return{value:r,display:String(r),numerators:t.numerators}}function ZGe(t,e,i){let r=rm(t.numerators,e,i),n=rm(t.denominators||[],e,i);if(!n)return{value:0,display:"0",numerators:t.numerators};let a=Math.round(r/n*100);return{value:a,display:`${a}% (${r}/${n})`,numerators:t.numerators}}function eHe(t,e,i){let r=t.numerators[0],n=t.attribute||"index";if(!e[i][r])return{value:0,display:"0"};let a=e[i][r],s=0,o=a.length?1:0,l;return a.forEach(u=>{let c=u[n];l!==void 0&&c===l+1?o++:(o>s&&(s=o),o=1),l=c}),o>s&&(s=o),{value:s,display:String(s)}}function tHe(t,e,i){let r=rm(t.numerators,e,i),n=rm(t.denominators||[],e,i);if(!n)return{value:0,display:"0",numerators:t.numerators};let a=Math.abs(n-r),s=Math.round(a/n*100);return{value:s,display:`${s}% (${a}/${n})`,numerators:t.numerators}}function iHe(t,e,i){let r=rm(t.denominators||[],e,i),n=rm(t.numerators,e,i),a=r-n;return{value:a,display:String(a)}}function rm(t,e,i){return t?t.reduce((r,n)=>{let a=n.startsWith("-");n.includes("*");let s=n.replace("-","").replace("*",""),o=a?1-i:i,l=e[o]?.[s];return l?r+l.length:r},0):0}function wj(t,e,i){let r=Ole(e||[],i),n=JGe(r),a=XGe(r);return{counters:r,calculated:n,summary:a}}function xle(t){if(!t)return[];let e=[],i=0,r=0,n=0;return t.forEach((a,s)=>{let o=zGe(a,{server:i,index:s,set:r,game:n});e.push(o)}),e}function Fle(t,e){let i=Ole(t||[],e);return{aces:[i.teams[0].aces?.length||0,i.teams[1].aces?.length||0],doubleFaults:[i.teams[0].doubleFaults?.length||0,i.teams[1].doubleFaults?.length||0],winners:[i.teams[0].winners?.length||0,i.teams[1].winners?.length||0],unforcedErrors:[i.teams[0].unforcedErrors?.length||0,i.teams[1].unforcedErrors?.length||0],totalPoints:[i.teams[0].pointsWon?.length||0,i.teams[1].pointsWon?.length||0]}}function Gt(t,e,i){return t.teams[e]?.[i]?.length??0}function Cs(t,e){return!e||!t?0:Number.parseFloat((t/e*100).toFixed(2))}function KT(t,e,i){return t.find(r=>r.category===e)?.teams[i]?.value??0}function Sj(t){if(!t?.counters?.teams)return[];let{counters:e,calculated:i}=t,r=[];r.push({name:"Aces",numerator:[Gt(e,0,"aces"),Gt(e,1,"aces")],default:"numerator"},{name:"Double Faults",numerator:[Gt(e,0,"doubleFaults"),Gt(e,1,"doubleFaults")],default:"numerator"});let n=[Gt(e,0,"serves1stWon"),Gt(e,1,"serves1stWon")],a=[Gt(e,0,"servesWon"),Gt(e,1,"servesWon")];if(n[0]+n[1]>0&&(a[0]!==n[0]||a[1]!==n[1])){let y=[Gt(e,0,"pointsServed"),Gt(e,1,"pointsServed")],b=[Gt(e,0,"serves1stIn"),Gt(e,1,"serves1stIn")],S=[Gt(e,0,"serves2ndWon"),Gt(e,1,"serves2ndWon")],U=[Gt(e,0,"serves2ndIn"),Gt(e,1,"serves2ndIn")];r.push({name:"1st Serve In",numerator:b,denominator:y,pct:[Cs(b[0],y[0]),Cs(b[1],y[1])]},{name:"1st Serve Points Won",numerator:n,denominator:b,pct:[Cs(n[0],b[0]),Cs(n[1],b[1])]},{name:"2nd Serve Points Won",numerator:S,denominator:U,pct:[Cs(S[0],U[0]),Cs(S[1],U[1])]})}r.push({name:"Total Points Won",numerator:[Gt(e,0,"pointsWon"),Gt(e,1,"pointsWon")],default:"numerator"});let s=Gt(e,0,"received1stWon")+Gt(e,0,"received2ndWon"),o=Gt(e,1,"received1stWon")+Gt(e,1,"received2ndWon"),l=Gt(e,1,"pointsServed"),u=Gt(e,0,"pointsServed");r.push({name:"Receiving Points Won",numerator:[s,o],denominator:[l,u],pct:[Cs(s,l),Cs(o,u)]});let c=Gt(e,1,"breakpointsFaced")-Gt(e,1,"breakpointsSaved"),d=Gt(e,0,"breakpointsFaced")-Gt(e,0,"breakpointsSaved"),p=Gt(e,1,"breakpointsFaced"),f=Gt(e,0,"breakpointsFaced");r.push({name:"Break Points Won",numerator:[c,d],denominator:[p,f],pct:[Cs(c,p),Cs(d,f)]});let h=Gt(e,0,"breakpointsSaved"),m=Gt(e,1,"breakpointsSaved"),g=Gt(e,0,"breakpointsFaced"),I=Gt(e,1,"breakpointsFaced");r.push({name:"Break Points Saved",numerator:[h,m],denominator:[g,I],pct:[Cs(h,g),Cs(m,I)]},{name:"Winners",numerator:[Gt(e,0,"winners"),Gt(e,1,"winners")],default:"numerator"},{name:"Unforced Errors",numerator:[Gt(e,0,"unforcedErrors"),Gt(e,1,"unforcedErrors")],default:"numerator"},{name:"Forced Errors",numerator:[Gt(e,0,"forcedErrors"),Gt(e,1,"forcedErrors")],default:"numerator"});let v=a,w=[Gt(e,0,"pointsServed"),Gt(e,1,"pointsServed")];return r.push({name:"Service Points Won",numerator:v,denominator:w,pct:[Cs(v[0],w[0]),Cs(v[1],w[1])]},{name:"Games Won",numerator:[Gt(e,0,"gamesWon"),Gt(e,1,"gamesWon")]},{name:"Most Consecutive Points Won",numerator:[KT(i,"Max Pts/Row",0),KT(i,"Max Pts/Row",1)]},{name:"Most Consecutive Games Won",numerator:[KT(i,"Max Games/Row",0),KT(i,"Max Games/Row",1)]}),r}var Lle=class{constructor(t={}){this.redoStack=[],this.pointMultipliers=[],t.competitionFormat?(this.competitionFormat=t.competitionFormat,this.matchUpFormat=t.matchUpFormat||t.competitionFormat.matchUpFormat||"SET3-S:6/TB7",this.pointMultipliers=t.pointMultipliers||t.competitionFormat.pointMultipliers||[]):(this.matchUpFormat=t.matchUpFormat||"SET3-S:6/TB7",this.pointMultipliers=t.pointMultipliers||[]),this.matchUpId=t.matchUpId,this.isDoubles=t.isDoubles||!1,this.eventHandlers=t.eventHandlers,this.state=dd({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles}),this.cacheFormatStructure()}setState(t){this.state=t,this.matchUpFormat=t.matchUpFormat,this.matchUpId=t.matchUpId,this.isDoubles=t.matchUpType==="DOUBLES",this.redoStack=[],this.initialScore=void 0,this.cacheFormatStructure()}getState(){return this.state}addPoint(t){let e=this.state.history?.points.length||0,i=this.state.score.sets.reduce((s,o)=>s+(o.side1Score||0)+(o.side2Score||0),0),r=this.state.score.sets.filter(s=>s.winningSide!==void 0).length,n=this.state.matchUpStatus==="COMPLETED",a=this.hasLineUp()?this.getActivePlayers():void 0;if(this.state=Ep(this.state,t,{pointMultipliers:this.pointMultipliers}),a){let s=this.state.history.points[this.state.history.points.length-1];this.isDoubles?s.activePlayers=[a.side1,a.side2]:s.activePlayers=[a.side1[0]||"",a.side2[0]||""]}if(t.penaltyType){let s=this.state.history.points[this.state.history.points.length-1];s.penaltyType=t.penaltyType}if(this.ensureHistory(),this.state.history.entries.push({type:"point",data:{winner:t.winner,winningSide:t.winningSide,server:t.server,serverSideNumber:t.serverSideNumber,serverParticipantId:t.serverParticipantId,timestamp:t.timestamp,rallyLength:t.rallyLength,result:t.result,penaltyType:t.penaltyType},timestamp:t.timestamp||new Date().toISOString(),pointIndex:e}),this.redoStack=[],this.eventHandlers){let s=this.buildEventContext();if(this.eventHandlers.onPoint?.(s),this.state.score.sets.reduce((o,l)=>o+(l.side1Score||0)+(l.side2Score||0),0)>i&&this.eventHandlers.onGameComplete?.({...s,gameWinner:t.winner}),this.state.score.sets.filter(o=>o.winningSide!==void 0).length>r){let o=this.state.score.sets.findLast(l=>l.winningSide!==void 0)?.winningSide===1?0:1;this.eventHandlers.onSetComplete?.({...s,setWinner:o})}if(!n&&this.state.matchUpStatus==="COMPLETED"){let o=this.state.winningSide===1?0:1;this.eventHandlers.onMatchComplete?.({...s,matchWinner:o})}}}addSet(t){this.applyAddSet(t),this.ensureHistory();let e=this.state.score.sets.at(-1)?.winningSide;this.state.history.entries.push({type:"set",data:{...t,winningSide:e},timestamp:t.timestamp||new Date().toISOString()}),this.redoStack=[]}addGame(t){this.applyAddGame(t),this.ensureHistory(),this.state.history.entries.push({type:"game",data:t,timestamp:t.timestamp||new Date().toISOString()}),this.redoStack=[]}endSegment(t){this.applyEndSegment(t),this.ensureHistory();let e=(t?.setNumber??this.state.score.sets.length)-1;this.state.history.entries.push({type:"endSegment",data:{setNumber:e+1,...t},timestamp:t?.timestamp||new Date().toISOString()})}setInitialScore(t){this.initialScore=t,this.redoStack=[],this.applyInitialScore(this.state,t),this.ensureHistory(),this.state.history.entries.push({type:"setInitialScore",data:t,timestamp:new Date().toISOString()}),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS")}undo(t=1){let e=this.state.history?.entries;if(e&&e.length>0){let n=Math.min(t,e.length);for(let a=0;a<n;a++){let s=e.pop();this.redoStack.push(s),s.type==="point"&&this.state.history.points.pop()}return this.rebuildFromEntries(),this.eventHandlers?.onUndo?.(this.buildEventContext()),!0}let i=this.state.history?.points||[];if(i.length===0)return!1;let r=Math.min(t,i.length);for(let n=0;n<r;n++){let a=i.pop();this.redoStack.push({type:"point",data:{winner:a.winner,server:a.server,timestamp:a.timestamp,rallyLength:a.rallyLength},timestamp:a.timestamp||""})}return this.rebuildState(),this.eventHandlers?.onUndo?.(this.buildEventContext()),!0}redo(t=1){if(this.redoStack.length===0)return!1;let e=Math.min(t,this.redoStack.length);for(let i=0;i<e;i++){let r=this.redoStack.pop();this.ensureHistory(),this.state.history.entries.push(r),r.type}return this.rebuildFromEntries(),this.eventHandlers?.onRedo?.(this.buildEventContext()),!0}canUndo(){let t=this.state.history?.entries;return t&&t.length>0?!0:(this.state.history?.points.length||0)>0}canRedo(){return this.redoStack.length>0}getUndoDepth(){let t=this.state.history?.entries;return t&&t.length>0?t.length:this.state.history?.points.length||0}getRedoDepth(){return this.redoStack.length}getScore(){return xd(this.state)}getScoreboard(t){return Ij(this.state,t)}getWinner(){return vj(this.state)}isComplete(){return yj(this.state)}getPointCount(){return this.state.history?.points.length||0}getFormat(){return this.state.matchUpFormat}getStatistics(t){let e=this.state.history?.points||[];return wj(this.state,e,t)}getStatObjects(t){return Sj(this.getStatistics(t))}getNextServer(){if(this.competitionFormat?.serverRule==="WINNER_SERVES"){let i=this.state.history?.points.at(-1);return i?i.winner:0}if(!this.cachedFormatStructure)return 0;let t=[0,0];this.state.score.sets.forEach(i=>{i.winningSide===1&&t[0]++,i.winningSide===2&&t[1]++});let e=qN(this.cachedFormatStructure,t);return gj(this.state,this.cachedFormatStructure,e)}getEpisodes(){return bj(this.state)}isNoAd(){return!!(this.cachedFormatStructure?.setFormat?.NoAD||this.cachedFormatStructure?.setFormat?.gameFormat?.NoAD)}getSetsToWin(){if(!this.cachedFormatStructure)return 2;let t=this.cachedFormatStructure.exactly||this.cachedFormatStructure.bestOf||3;return Math.ceil(t/2)}getTiebreakAt(){let t=this.cachedFormatStructure?.setFormat;if(!t||t.tiebreakSet||t.timed||t.noTiebreak)return null;let e=t.setTo||6;return(typeof t.tiebreakAt=="number"?t.tiebreakAt:void 0)??e}hasFinalSetTiebreak(){let t=this.cachedFormatStructure?.finalSetFormat;return t?t.tiebreakSet?!0:t.noTiebreak?!1:!!(t.tiebreakFormat||t.tiebreakAt!==void 0):this.getTiebreakAt()!==null}getFormatStructure(){return this.cachedFormatStructure}getInputMode(){let t=this.state.history?.entries||[];if(t.length===0)return(this.state.history?.points.length||0)>0?"points":"none";let e=new Set(t.filter(i=>i.type!=="setInitialScore"&&i.type!=="endSegment").map(i=>i.type));if(e.size===0)return"none";if(e.size===1){let i=e.values().next().value;if(i==="point")return"points";if(i==="game")return"games";if(i==="set")return"sets"}return"mixed"}setLineUp(t,e){let i=this.state.sides.find(r=>r.sideNumber===t);i&&(i.lineUp=e),this.initialLineUps??={},this.initialLineUps[t]=e.map(r=>({...r}))}substitute(t){let e=this.state.sides.find(n=>n.sideNumber===t.sideNumber);if(!e?.lineUp)return;let i=e.lineUp.findIndex(n=>n.participantId===t.outParticipantId);if(i===-1)return;this.ensureHistory(),this.state.history.substitutions??=[];let r={sideNumber:t.sideNumber,outParticipantId:t.outParticipantId,inParticipantId:t.inParticipantId,beforePointIndex:this.state.history.points.length,timestamp:t.timestamp};this.state.history.substitutions.push(r),e.lineUp[i]={...e.lineUp[i],participantId:t.inParticipantId},this.state.history.entries.push({type:"substitution",data:r,timestamp:t.timestamp||new Date().toISOString()}),this.redoStack=[]}getActivePlayers(){let t=this.state.sides.find(i=>i.sideNumber===1),e=this.state.sides.find(i=>i.sideNumber===2);return{side1:t?.lineUp?.map(i=>i.participantId)||[],side2:e?.lineUp?.map(i=>i.participantId)||[]}}hasLineUp(){return this.state.sides.some(t=>t.lineUp&&t.lineUp.length>0)}setPointMultipliers(t){this.pointMultipliers=t}getPointMultipliers(){return this.pointMultipliers}getSupplementaryState(){return{redoStack:[...this.redoStack],initialLineUps:this.initialLineUps?Object.fromEntries(Object.entries(this.initialLineUps).map(([t,e])=>[t,e.map(i=>({...i}))])):void 0}}loadSupplementaryState(t){t.redoStack&&(this.redoStack=[...t.redoStack]),t.initialLineUps&&(this.initialLineUps=Object.fromEntries(Object.entries(t.initialLineUps).map(([e,i])=>[e,i.map(r=>({...r}))])))}getPenaltyProfile(){return this.competitionFormat?.penaltyProfile}getPointProfile(){return this.competitionFormat?.pointProfile}getTimerProfile(){return this.competitionFormat?.timerProfile}getTimeoutRules(){return this.competitionFormat?.timeoutRules}getSubstitutionRules(){return this.competitionFormat?.substitutionRules}getPlayerRules(){return this.competitionFormat?.playerRules}setEventHandlers(t){this.eventHandlers=t}getEventHandlers(){return this.eventHandlers}decoratePoint(t,e){let i=this.state.history?.points[t];i&&Object.assign(i,e)}markHardBoundary(t){let e=this.state.score.sets[t.setIndex];e&&(e.hardBoundaries??=[],e.hardBoundaries.includes(t.gameIndex)||(e.hardBoundaries.push(t.gameIndex),e.hardBoundaries.sort((i,r)=>i-r)))}editPoint(t,e,i){let r=this.state.history?.points;if(!r||t<0||t>=r.length)return;let n=i?.recalculate!==!1,a=r[t];if(e.winner!==void 0&&(a.winner=e.winner),e.server!==void 0&&(a.server=e.server),e.timestamp!==void 0&&(a.timestamp=e.timestamp),e.rallyLength!==void 0&&(a.rallyLength=e.rallyLength),e.wrongSide!==void 0&&(a.wrongSide=e.wrongSide),e.wrongServer!==void 0&&(a.wrongServer=e.wrongServer),e.penaltyPoint!==void 0&&(a.penaltyPoint=e.penaltyPoint),!n)return;let s=this.state.history?.entries;if(s){let o=s.find(l=>l.type==="point"&&l.pointIndex===t);o&&(e.winner!==void 0&&(o.data.winner=e.winner),e.server!==void 0&&(o.data.server=e.server))}s&&s.length>0?this.rebuildFromEntries():this.rebuildState(),this.redoStack=[]}reset(){this.state=dd({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles}),this.redoStack=[],this.initialScore=void 0,this.initialLineUps=void 0,this.eventHandlers?.onReset?.(this.buildEventContext())}ensureHistory(){this.state.history??={points:[]},this.state.history.entries??=[]}buildEventContext(){return{state:this.state,score:xd(this.state)}}cacheFormatStructure(){this.cachedFormatStructure=Xi(this.matchUpFormat)}getInitialLineUps(){return this.initialLineUps}applyAddSet(t){let{side1Score:e,side2Score:i,side1TiebreakScore:r,side2TiebreakScore:n}=t,a=t.winningSide;a===void 0&&(e>i?a=1:i>e&&(a=2));let s={setNumber:this.state.score.sets.length+1,side1Score:e,side2Score:i,winningSide:a};r!==void 0&&(s.side1TiebreakScore=r),n!==void 0&&(s.side2TiebreakScore=n),this.state.score.sets.push(s),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS"),a!==void 0&&this.checkMatchCompletion()}applyAddGame(t){let{winner:e,tiebreakScore:i}=t,r=this.state.score.sets.length>0?this.state.score.sets.at(-1):void 0;(!r||r.winningSide!==void 0)&&(r={setNumber:this.state.score.sets.length+1,side1Score:0,side2Score:0},this.state.score.sets.push(r)),e===0?r.side1Score=(r.side1Score||0)+1:r.side2Score=(r.side2Score||0)+1,i&&(r.side1TiebreakScore=i[0],r.side2TiebreakScore=i[1]),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS"),this.checkSetCompletion(r),r.winningSide!==void 0&&this.checkMatchCompletion()}applySubstitution(t){let e=this.state.sides.find(r=>r.sideNumber===t.sideNumber);if(!e?.lineUp)return;let i=e.lineUp.findIndex(r=>r.participantId===t.outParticipantId);i!==-1&&(e.lineUp[i]={...e.lineUp[i],participantId:t.inParticipantId},this.state.history??={points:[]},this.state.history.substitutions??=[],this.state.history.substitutions.push(t))}applyEndSegment(t){let e=(t?.setNumber??this.state.score.sets.length)-1,i=this.state.score.sets[e];if(!i||i.winningSide!==void 0)return;let r=i.side1Score||0,n=i.side2Score||0;r>n?i.winningSide=1:n>r&&(i.winningSide=2),this.checkMatchCompletion()}checkSetCompletion(t){let e=Xi(this.state.matchUpFormat);if(!e)return;let i=e.exactly||e.bestOf||3,r=Math.ceil(i/2),n=[0,0];this.state.score.sets.forEach(l=>{l.winningSide===1&&n[0]++,l.winningSide===2&&n[1]++});let a=n[0]===r-1&&n[1]===r-1&&e.finalSetFormat?e.finalSetFormat:e.setFormat;if(!a)return;let s=t.side1Score||0,o=t.side2Score||0;if(a.tiebreakSet){let l=a.tiebreakSet.tiebreakTo||11,u=a.tiebreakSet.NoAD?1:2;(s>=l||o>=l)&&Math.abs(s-o)>=u&&(t.winningSide=s>o?1:2)}else if(!a.timed){let l=a.setTo||6,u=(typeof a.tiebreakAt=="number"?a.tiebreakAt:void 0)??l,c=a.noTiebreak||!1,d=a.winBy||2;(!c&&t.side1TiebreakScore!==void 0&&(s===u+1||o===u+1)||(s>=l||o>=l)&&Math.abs(s-o)>=d)&&(t.winningSide=s>o?1:2)}}checkMatchCompletion(){let t=Xi(this.state.matchUpFormat);if(!t)return;let e=t.exactly||t.bestOf||3,i=Math.ceil(e/2),r=dj(t),n=t.exactly;if(r){let a=n||e;if(this.state.score.sets.filter(s=>s.winningSide!==void 0).length>=a){let s=this.state.score.sets.reduce((o,l)=>(l.side1TiebreakScore===void 0?(o[0]+=l.side1Score??0,o[1]+=l.side2Score??0):(o[0]+=l.side1TiebreakScore,o[1]+=l.side2TiebreakScore??0),o),[0,0]);s[0]!==s[1]&&(this.state.matchUpStatus="COMPLETED",this.state.winningSide=s[0]>s[1]?1:2,this.state.endTime=new Date().toISOString())}}else{let a=[0,0];if(this.state.score.sets.forEach(s=>{s.winningSide===1&&a[0]++,s.winningSide===2&&a[1]++}),(a[0]>=i||a[1]>=i)&&(!n||this.state.score.sets.filter(s=>s.winningSide!==void 0).length>=n)){let s=a[0]>=i?0:1;this.state.matchUpStatus="COMPLETED",this.state.winningSide=s+1,this.state.endTime=new Date().toISOString()}}}rebuildFromEntries(){let t=this.state.history?.entries||[],e=this.getInitialLineUps(),i=dd({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles});if(e)for(let r of i.sides)e[r.sideNumber]&&(r.lineUp=e[r.sideNumber].map(n=>({...n})));this.initialScore&&(this.applyInitialScore(i,this.initialScore),i.matchUpStatus==="TO_BE_PLAYED"&&(i.matchUpStatus="IN_PROGRESS")),i.history={points:[],entries:[...t]},this.state=i;for(let r of t)switch(r.type){case"point":this.state=Ep(this.state,r.data,{pointMultipliers:this.pointMultipliers}),this.state.history.entries=i.history.entries;break;case"set":this.applyAddSet(r.data);break;case"game":this.applyAddGame(r.data);break;case"endSegment":this.applyEndSegment(r.data);break;case"substitution":this.applySubstitution(r.data);break}}rebuildState(){let t=this.state.history?.points||[],e=dd({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles});this.initialScore&&(this.applyInitialScore(e,this.initialScore),e.matchUpStatus==="TO_BE_PLAYED"&&(e.matchUpStatus="IN_PROGRESS"));for(let i of t)e=Ep(e,{winner:i.winner,server:i.server,timestamp:i.timestamp,rallyLength:i.rallyLength,result:i.result},{pointMultipliers:this.pointMultipliers});this.state=e}applyInitialScore(t,e){t.score.sets=[];for(let i=0;i<e.sets.length;i++){let r=e.sets[i],n={setNumber:i+1,side1Score:r.side1Score,side2Score:r.side2Score};r.side1TiebreakScore!==void 0&&(n.side1TiebreakScore=r.side1TiebreakScore),r.side2TiebreakScore!==void 0&&(n.side2TiebreakScore=r.side2TiebreakScore),r.winningSide!==void 0?n.winningSide=r.winningSide:r.side1Score>r.side2Score?n.winningSide=1:r.side2Score>r.side1Score&&(n.winningSide=2),t.score.sets.push(n)}if(e.currentSetScore){let i={setNumber:t.score.sets.length+1,side1Score:e.currentSetScore.side1Score,side2Score:e.currentSetScore.side2Score,side1GameScores:[],side2GameScores:[]};e.currentGameScore?(i.side1GameScores=[e.currentGameScore.side1Points],i.side2GameScores=[e.currentGameScore.side2Points]):(i.side1GameScores=[0],i.side2GameScores=[0]),t.score.sets.push(i)}}},_le={};ft(_le,{addPoint:()=>Ep,calculatePointsTo:()=>YN,createMatchUp:()=>dd,inferServeSide:()=>pj,resolvePointValue:()=>fj});var $le={};ft($le,{keyValueScore:()=>sue,parseMatchUpFormat:()=>Xi,stringifyMatchUpFormat:()=>KM,tidyScore:()=>cue});var rHe="COMPLETED",nHe="WO/WO",Ble=["RET","DEF","WO",nHe,"ABN","SUS","INT"],bF="DEFAULTED",Vle="WALKOVER",jle="ABANDONED",Gle="SUSPENDED",Hle="RETIRED",Wle="INTERRUPTED",aHe=[Hle,bF,Vle],sHe="Enter Score",nm="()",rf="[]",Uj=["up","left","shift+tab"],Tj=["enter","down","tab","right"],DE="backspace",zle="r",qle="s",Yle="a",Kle="d",Xle="w",Jle="i",XN=[zle,Kle,Xle,Yle,qle,Jle],JN="space",Hk=["[","("],PE=[...Uj,...Tj,JN,"]"],Qle="-",oHe="/",Eh=Qle,lu=Qle,Zle=[oHe],lHe=0,uHe=["=","+","num_1","num_2","shift+=","shift+-"],Dj=["0","1","2","3","4","5","6","7","8","9"].concat(XN),eue=Dj.map(t=>`shift+${t}`),tue=[Eh,DE].concat(PE,Zle),iue=[Dj,eue,tue].join(","),cHe=[iue,Uj,Tj,uHe].join(","),dHe={OUTCOMEKEYS:XN,SIDE1KEYS:Dj,SIDE2KEYS:eue,MODIFIERS:tue,PROMPT:sHe,MOVEUP:Uj,MOVEDOWN:Tj,HOTKEYS:cHe};function bg({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=rue({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==" "?" ":"";return t+r+i}else return i+" "+t}function rue({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of Ble){let r=t?.indexOf(i);r===0?t=t.slice(i.length+1).trim()+" ":r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t?.trim()||(t=""),{scoreString:t,removed:e}}function wF({analysis:t,scoreString:e,sets:i,lowSide:r}){let n,a;if(!e)return{scoreString:e,sets:i};let{scoreString:s,removed:o}=rue({scoreString:e});if(e=s,o)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},u=Object.values(l).filter(m=>m!==void 0).length;l.setNumber&&u===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:c}=t.setFormat,{tiebreakTo:d,NoAD:p}=c||{},{isTiebreakEntry:f}=Qg({brackets:rf,scoreString:e}),h=fHe(e);if(h>=0){n=e.slice(0,h);let{isTiebreakEntry:m}=Qg({brackets:nm,scoreString:n}),{lastOpenBracketIndex:g,isTiebreakEntry:I}=Qg({brackets:rf,scoreString:n}),v=n&&n[n.length-1].trim(),w=n&&!isNaN(v),y=t.isIncompleteSetScore;if(f&&I){let b=n.slice(g+1).split(lu),S=b?.length>0&&b[0]!==void 0&&!isNaN(parseInt(b[0]))&&parseInt(b[0])||void 0,U=b?.length>1&&b[1]!==void 0&&parseInt(b[1])||void 0,T=[S,U];if(U){let D=r===1?1:0;T[D]=(T?.[1-D]||0)+(p?1:2),(T[D]||0)<d&&(T[D]=d),n=e.slice(0,g+1),n+=T.join(lu)}else S!==void 0?(n=e.slice(0,g+1),n+=S):(n=e.slice(0,g),y=!0);l.side1TiebreakScore=T[0]||0,l.side2TiebreakScore=T[1]||0}if(n.length||(n=void 0),y){let b=l.side1Score?.toString();if(b){let S=b?.slice(0,b.length-1);l.side1Score=!isNaN(S)&&parseInt(S)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:i?.slice(0,i.length-1)||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]}else if(w){let b=l.side2Score?.toString(),S=l.side1Score?.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let U=b?.slice(0,b.length-1);l.side2Score=!isNaN(U)&&parseInt(U)||void 0}else{let U=S?.slice(0,S.length-1);l.side1Score=!isNaN(U)&&parseInt(U)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else m?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(f&&!I?a=i?.slice(0,i.length-1)||[]:(a=i,a[i.length-1]=l),f||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:e,sets:i}}function Qg({brackets:t=nm,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...nl(i,n)),s=Math.max(...nl(r,n));return{isTiebreakEntry:a>s,lastOpenBracketIndex:a}}function pHe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=rf.split(""),a=t.split(""),s=Math.max(...nl(r,a)),o=Math.max(...nl(n,a)),l=Math.max(...nl(lu,a));return i&&s>o&&l>s}function fHe(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function nue(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function U3({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){let n=Xi(t),{bestOf:a}=n,s=Math.ceil(a/2),o=r?.reduce((l,u)=>{let{winningSide:c}=u;return c&&l[c-1]++,l},[0,0])?.indexOf(s)+1||void 0;return aHe.includes(e)&&i&&(o=i),{matchUpWinningSide:o}}function QN({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:s}){if(!s)return{error:Je,info:"missing set"};e=e||i&&Xi(i);let o=n&&e.finalSetFormat||e?.setFormat||{},{side1Score:l,side2Score:u}=s,{setTo:c,tiebreakAt:d}=o,p=l||u,f=ZN({set:s}),h=Math.abs(l-u),m=l>=c||u>=c,g=r||l>=c&&u>=c||d&&d<c&&(l===d||u===d),I=t||g&&(f===1&&s.side1TiebreakScore>s.side2TiebreakScore||f===2&&s.side2TiebreakScore>s.side1TiebreakScore),v=!g&&o.NoAD||g||r&&o.tiebreakFormat?.NoAD?1:2,w=h>=v;return!!((a&&p||m&&(w||g)||r)&&(!g||I))}function ZN({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function Pj({analysis:t,set:e}){let i=ZN({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return QN({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function hHe({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!i?.length)return{sets:[]};let a=i[i.length-1];r=Ke(r);let{validSide2Score:s,requiresTiebreak:o}=mHe({analysis:t,set:a,value:r});if(s){n=!0,e=(e||"")+r,a.side2Score=r;let l=Pj({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,o){let u=nm.split("")[0];e+=u}else t.isDecidingSet||(e+=" ")}return{sets:i,scoreString:e,updated:n}}function mHe({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:s}=r,{side1Score:o}=e,l,u;return n&&n<a?o===n?l=i<=a:l=i<=n:o===a?s?l=i<a:l=i<=a+1:o===a-1?s?l=i<=a:l=i<=a+1:o===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?u=o===a&&i===n||o===n&&i===a:u=o>=a&&i>=a&&o!==i),{validSide2Score:l,requiresTiebreak:u}}function aue({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let s;return e===zle?r?(s=!0,r=bg({scoreString:r,lowSide:t,outcome:"RET"}),n=t===2?1:2,a=Hle):(s=!0,r=bg({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=bF):e===Kle?(s=!0,r=bg({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=bF):e===Xle?(s=!0,i=[],r="WO",n=t===2?1:2,a=Vle):e===qle&&r?(s=!0,r=bg({scoreString:r,lowSide:t,outcome:"SUS"}),a=Gle,n=void 0):e===Yle?(s=!0,r=bg({scoreString:r,lowSide:t,outcome:"ABN"}),a=jle,n=void 0):e===Jle&&r&&(s=!0,r=bg({scoreString:r,lowSide:t,outcome:"INT"}),a=Wle,n=void 0),{updated:s,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function gHe(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:s,lowSide:o,value:l}=t,u,c;!e?.length&&l!==DE&&(e=[{setNumber:1}]);let d=e.length-1;if(XN.includes(l)){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p;f&&!h?i="missing side2Score":s.finalSetIsComplete||n?i="final set is already complete":s.isIncompleteSetScore?i="incomplete set scoreString":s.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:u}=aue({lowSide:o,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===DE){if({scoreString:r,sets:e,outcomeRemoved:c}=wF({analysis:s,scoreString:r,sets:e}),r?.trim()===""&&(r=r.trim()),r||(e=[]),c){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p;if(f&&h){let m=f>h&&1||h>f&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,u=!0}else if(s.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===JN){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p,m=f>h&&1||h>f&&2||void 0;m&&!n&&!s.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),r+=" ",u=!0)}else if(l===Eh&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&s.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let f=Ke((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=Ke(f),p=e[d].side1Score.toString(),u=!0}else{let f=Ke((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=Ke(f),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let f=(e.slice(0,d)||[]).filter(h=>h).map(h=>{let{side1Score:m,side2Score:g}=h;return[m,g].join("-")}).join(" ");f?r=f+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:u}}function IHe({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){let s,o,{tiebreakSet:{tiebreakTo:l,NoAD:u}}=t.setFormat,[c]=rf.split("");if(t.isMatchTiebreakEntry||(r+=c),n[t.setNumber-1]){let{lastOpenBracketIndex:d}=Qg({brackets:rf,scoreString:r}),p=(r.slice((d??0)+1)+(e?"":a)).split(lu);if((p[i-1]?.length||0)>=2)o="tiebreak digit limit";else if(e){i===1&&(p[0]=(p[0]||"")+a),i===2&&(p[1]=(p[1]||"")+a);let f=[p[0]||0,p[1]||0].map(g=>Ke(g)),h=i===1?1:0;f[h]=f[1-h]+(u?1:2),f[h]<l&&(f[h]=l);let m=n[n.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],r=r.slice(0,(d??0)+1),r+=f.join(lu),s=!0}else{let f=[p[0]||0,p[1]||0].map(m=>Ke(m)),h=n[n.length-1];h.side1TiebreakScore=f[0],h.side2TiebreakScore=f[1],r+=a,s=!0}}else{let d=nue({lowValue:Ke(a||0),tiebreakTo:l,NoAD:u}),p=[Ke(a),d];i===2&&p.reverse();let f={side1TiebreakScore:p[0],side2TiebreakScore:p[1],setNumber:n?.length+1||1};n.push(f),r+=p.join(lu),s=!0}return{info:o,scoreString:r,sets:n,updated:s}}function vHe({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:s}=t?.setFormat||{},o=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(s&&r===n||r>n)return{scoreString:i};let l=h(),u=[r,l];e===2&&u.reverse();let c=nm.split("")[0],d=u.join(Eh)+(o?c:" ");i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},f=Pj({analysis:t,set:p});return p.winningSide=f||void 0,{scoreString:i,set:p};function h(){return o?r+1:r+1===n?r+(s?1:2):n}}function yHe({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){let a=(n?.filter(F=>F?.winningSide)?.length||0)+(i?0:1),s=Xi(t),o=a===s?.bestOf,l=o&&s?.finalSetFormat||s?.setFormat||{},u=l?.timed,c=o&&n[s?.bestOf-1],d=c?.winningSide,{isTiebreakEntry:p}=Qg({brackets:nm,scoreString:e}),{isTiebreakEntry:f}=Qg({brackets:rf,scoreString:e}),h=p||f,m=!!l.tiebreakSet,g=e?.[e.length-1]?.trim(),I=e&&!isNaN(g),v=!h&&g===Eh,w=p&&Hk.includes(g),y=f&&Hk.includes(g),b=f&&g===lu,S=e?.split(""),[U]=rf.split(""),T=S&&Math.max(...nl(U,S)),D=S&&Math.max(...nl(lu,S)),P=S&&D>T,E=n[n.length-1]?.winningSide,R=n?.length&&!E,C=Ble.find(F=>e?.indexOf(F)>=0),M=!isNaN(r),N=r===JN,A=PE.includes(r),O=e?.split("").find(F=>Hk.includes(F)),k=A&&f&&!y&&(b||!pHe({scoreString:e}));return{isTiebreakSetValue:m&&M,matchUpScoringFormat:s,setNumber:a,setFormat:l,matchTiebreakHasJoiner:P,isGameScoreEntry:R,isSpace:N,isCloser:A,isTiebreakCloser:A&&O&&h&&I,isDecidingSet:o,isTiebreakSet:m,isTimedSet:u,isNumericEnding:I,isNumericValue:M,hasOpener:O,hasOutcome:C,finalSet:c,finalSetIsComplete:d,lastSetIsComplete:E,isInvalidSetTiebreakValue:N&&h&&w,isInvalidMatchTiebreakValue:k,isTiebreakEntry:h,isSetTiebreakEntry:p,isMatchTiebreakEntry:f,isIncompleteSetScore:v,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:y,isPartialMatchTiebreakValue:b}}function sue(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:s}=t,{matchUpFormat:o,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!iue.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:f}=U3({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});a=f;let h=yHe({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:o});if(Zle.includes(i)&&(i=Eh),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&p&&Ke(i)===0&&(h.isTiebreakCloser=!0),PE.includes(i)&&h.hasOpener&&(i=""),PE.includes(i)&&(i=JN),h.lastSetIsComplete){let m=r?.length&&r[r.length-1];r&&m!==" "&&(r+=" ")}if(h.isTimedSet)({info:d,sets:n,scoreString:r,updated:c,matchUpStatus:s,winningSide:a}=gHe({analysis:h,lowSide:e,scoreString:r,sets:n,matchUpStatus:s,winningSide:a,value:i}));else if(XN.includes(i))h.finalSetIsComplete||a?d="final set is already complete":!h.isTiebreakEntry&&!h.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:s,winningSide:a,updated:c}=aue({lowSide:e,sets:n,scoreString:r,matchUpStatus:s,winningSide:a,value:i}):h.isTiebreakEntry||h.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===DE)c=!0,{scoreString:r,sets:n}=wF({analysis:h,scoreString:r,sets:n,lowSide:e}),r||(n=[]),s=void 0,a=void 0;else if(h.hasOutcome)d="has outcome";else if(i===Eh&&!h.isMatchTiebreakEntry)(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(c=!0,{scoreString:r,sets:n}=wF({analysis:h,scoreString:r,sets:n,lowSide:e}),s=void 0);else if(i===lu&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?d="existing joiner":h.isNumericEnding&&(c=!0,r+=lu);else if([Eh,lu].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:n,scoreString:r,updated:c}=hHe({analysis:h,scoreString:r,sets:n,value:i}));else if(h.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(h.isTiebreakCloser){let m=h.isSetTiebreakEntry?nm:rf,g=m.split("").reverse()[0],I=m.split("")[0],v=n[n.length-1],{tiebreakFormat:w}=h.setFormat,{tiebreakTo:y,NoAD:b}=w||{},S=ZN({set:v});if(!h.isTiebreakSet){let T=Number.parseInt(r.split(I).reverse()[0]),D=nue({lowValue:T,tiebreakTo:y,NoAD:b});S===1?(v.side1TiebreakScore=D,v.side2TiebreakScore=T):(v.side1TiebreakScore=T,v.side2TiebreakScore=D)}r=(r||"")+g,h.isDecidingSet||(r+=" ");let U=Pj({analysis:h,set:v});v.winningSide=U||void 0,c=!0}else if(h.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:c}=IHe({analysis:h,auto:u,lowSide:e,scoreString:r,sets:n,value:i}));else if(h.isSetTiebreakEntry){let[m]=nm.split(""),g=Math.max(...nl(m,r.split(""))),I=r.slice(g+1),v=I&&Ke(I)===lHe,w=Ke(I?I+i:i),{tiebreakFormat:y}=h.setFormat,{tiebreakTo:b,NoAD:S}=y||{};!v&&I.length<2?S&&w>b-1?d="invalid low value for NoAD tiebreak":(c=!0,r=(r||"")+i):d=v?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)d=`invalid key: ${i}`;else if(h.isGameScoreEntry)d="game scoreString entry";else if(h.lastSetIsComplete||!n.length){c=!0;let{scoreString:m,set:g}=vHe({analysis:h,lowSide:e,scoreString:r,value:Ke(i)});g&&(g.setNumber=n?.length+1||1),n=n?.concat(g).filter(Boolean)||[g],r=m||void 0}else console.log("error: unknown outcome")}if(c){n=n?.filter(Boolean);let{matchUpWinningSide:m}=U3({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});return a=m,m&&(!s||[$i,Na].includes(s))?(s=rHe,n=n.filter(g=>{let{side1Score:I,side2Score:v,side1TiebreakScore:w,side2TiebreakScore:y}=g;return I||v||w||y})):r&&!a&&![Gle,jle,Wle].includes(s)&&(s=void 0),{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}return{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}var eA="\\d+-\\d+",Uw="\\d+-\\d+\\(\\d+\\)",Ej="\\[\\d+-\\d+\\]",bHe="\\d+-\\d+\\(\\d+-\\d+\\)",wHe=new RegExp(`(${eA}),`,"g"),SHe=new RegExp(`(${Uw}),`,"g"),UHe=[eA,Uw,Ej,bHe],THe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],DHe=THe.map(t=>{let e=t.split("").map(i=>UHe[i]).join(" ");return new RegExp(`^${e}$`)});function T3(t){return!t||DHe.some(e=>e.test(t))}function PHe(t){let e="[];()",i=["[","("],r=Object.assign({},...e.split("").map(s=>({[s]:0}))),n="",a=t.split("").map(s=>{let o=e.includes(s)&&s,l=i.includes(o);if(l&&o)return r[o]+=1,n=o,s;if(!l&&o&&n&&o!==n){r[n]-=1;let u="[];".includes(n)&&"[];"||"()".includes(n)&&"()"||"",c=u.split("").find(d=>d!==n);if(u.includes(o))r[n]||(n="");else return r[o]||(n=""),c}return s}).join("");return t!==a?a:t}function VD(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function EHe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function HI(t){let e=(i=>i?.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function EE(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function D3(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function RHe(t){return t.startsWith("(")&&t.endsWith(")")}function CHe({score:t,applied:e}){t=PHe(t);let i=/\)(\d+)/g;if(i.test(t))for(let S of t.match(i)){let U=S.replace(")",") ");t=t.replace(S,U)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let S of a||[]){let[U]=S.match(n).slice(1),T=U.replace(/ /g,"");t=t.replace(S,`(${T})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){let S=t.match(s);S.length&&S.forEach(U=>{let T=U.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(U,T)})}if(s=/\(\((\d)\)\)/g,s.test(t)){let S=t.match(s);S.length&&S.forEach(U=>{let T=U.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(U,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);t=t.replace(o,"-"),["- "," -"].forEach(S=>{let U=new RegExp(`(\\d+)${S}(\\d+)`,"g"),T=t.match(U);T&&T.forEach(D=>t=t.replace(D,D.split(S).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(S=>{let[U]=S.match(/\((\d+), \)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&U==="6"&&(t=t.replace(S,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(S=>{let[U]=S.match(/\((\d+)\/\)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&U==="6"?t=t.replace(S,"(6-0)"):t=t.replace(S,`(${U})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(S=>{let[U]=S.match(/(\d\/\d)\/,/).slice(1);t=t.replace(S,`${U},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(S=>{let[U]=S.match(/\(\/(\d+)\)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&parseInt(U)<6?t=t.replace(S,`(6-${U})`):t=t.replace(S,`(${U})`)});let p,f,h,m,g,I=()=>{g=Ra(t.split("")),f=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],h=g["["]===g["]"]+1,m=f&&!h};I();let v=/(\d+-\d+\(\d+)0,/;if(v.test(t)){let[S]=t.match(v).slice(1);t=t.replace(v,S+")")}if(g["("]===g[")"]&&g["("]>1){let S=t.split(")(").join(") (").split(" ");S.every(RHe)?t=S.map(U=>{let T=U.slice(1,U.length-1);return T.length>2?T:U}).join(" "):t=S.join(" ")}I();let w=/[A-Za-z]+/.test(t),y=/\d+/.test(t);if(!w&&!y)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(S=>g[S])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(S=>g[S]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",I()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",I()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let S=[],U=0;for(let T of t.split("").reverse())T===")"&&(U?S.push("("):U+=1),T==="("&&(U-=1),S.push(T);S.reverse(),t=S.join("")}I()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),I()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",I()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",I()),m){let S="",U=0;for(let T of t.split(""))T==="("&&(U?S+=")":U+=1),T===")"&&(U-=1),S+=T;t=S}I(),h&&!f&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),I()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),I(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),I());let b=S=>{let U=S.indexOf("("),T=S.indexOf(")");return U>=0&&T>=0&&U<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let S=t.slice(1,t.length-1);b(S)&&(t=S,I())}return{score:t,applied:e}}function tA(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=nl("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,s)=>s%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function MHe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[wHe,SHe].forEach(i=>{let r=t.match(i);r?.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(tA).join(" "),{score:t,applied:e}}function NHe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p?.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let f=/^-(\d+)$/;if(f.test(p)){let[h]=p.match(f).slice(1);if(h.length===2)return h.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(VD),a=0,s="";for(let p of n){let f=nl(p,r).find(I=>!a||I>a),h=r.slice(a,f-1),m=r[f-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let I=g.split(""),v=Math.abs(I.reduce((w,y)=>+w-+y));if(v===1){let w=[h.join(" "),[m,p].join("")].join(" ");s+=w,a=f+1}else if(v===0){let w=Math.max(...I);if([4,5,6,7,8,9].includes(w)){let y=[6,4].includes(w)?w+1:w-1,b=[w,y].sort().reverse().join("-"),S=[h.join(" "),[b,p].join("")].join(" ");s+=S,a=f+1}}}}if(n.length&&s.length){let p=r.slice(a).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((f,h)=>+f-+h,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let o=r.map(p=>EHe(p)&&"bracket"||HI(p)&&"set");if(o.includes("set")&&o.includes("bracket")){let p,f="";return r.forEach((h,m)=>{o[m]==="bracket"&&p==="set"?(h=i(h),f+=h):f+=` ${h}`,p=o[m]}),{score:f.trim()}}r=t.split(" ");let l,u=r.map(p=>{let f=new RegExp(/^(\d+)-(\d+)$/);if(f.test(p)){let[h,m]=p.match(f).slice(1),g=Math.abs([h,m].reduce((v,w)=>+v-+w,0)),I=Math.max(h,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&I>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=nl("tiebreak",u);if(c.length){let p="";r.forEach((f,h)=>{c.includes(h)?p+=`(${f}) `:c.includes(h+1)?p+=`${f}`:p+=`${f} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,f,h]=t.match(d).slice(1),m=Math.max(f,h)>=10;!HI(p)&&m&&(t=t.replace(d,`${p} [${f}-${h}]`))}return u=[],t=t.split(" ").map(p=>{let f=/^\((.*)\)$/,h=f.test(p),m=new RegExp(Ej).test(p)&&"super"||new RegExp(Uw).test(p)&&"tiebreak"||new RegExp(eA).test(p)&&"standard"||"unknown";return u.push(m),m==="standard"&&h?p.match(f)[1]:p}).join(" "),{score:t}}function AHe({score:t,applied:e}){for(let T of[".",","," ","/"]){let D=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(D.test(t)){let P=t.match(D).slice(1).map(R=>parseInt(R)),E=Math.abs(P[0]-P[1]);E<=10&&E>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,D,P,E,R,C]=t.match(i).slice(1);t=t.replace(i,`${T}${D}-${P} ${E}-${R}${C}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let s=tA(t);s!==t&&(t=s,e.push("deDashMash"));let o=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(o.test(t)){let[T,D,P]=t.match(o).slice(1),[E,R]=D.split("");t=`${T}-${E} ${R}-${P}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[T,D]=t.match(u).slice(1),P=T.trim(),E=D.trim();if(l.test(P)&&l.test(E)){let R=P.match(l).slice(1,3).join("-"),C=E.match(l).slice(1,3).join("-");t=`${R} ${C}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[T,D]=t.match(c).slice(1),P=T.trim(),E=D.trim();if(l.test(P)&&l.test(E)){let R=P.match(l).slice(1,3).join("-"),C=E.match(l).slice(1,3).join("-");t=`${R} ${C}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("singleSetCommaSeparationPattern")}let p=0,f=/(\d+)-(\d{2})-(\d+)/;for(;f.test(t)&&p<3;){let[T,D,P]=t.match(f).slice(1),E=D.split(""),R=`${T}-${E[0]} ${E[1]}-${P}`;t=t.replace(f,R),e.push("noSetSeparationPattern"),p+=1}let h=/(^|\s)7-6\s(\d+)\s/g,m=t.match(h);if(m?.length){let T=/(^|\s)7-6\s(\d+)\s/;m.forEach(D=>{let P=D.match(T).slice(2)[0];t=t.replace(D,`7-6(${P}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g?.forEach(T=>{let D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g?.forEach(T=>{let D=" "+T.slice(1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern2")});let I=/^\d, *\d\/\d, *\d/;if(I.test(t)){let T=t.match(I)[0],D=T.split("/").map(P=>`(${P})`).join(" ")+" ";t=t.replace(T,D),e.push("slashCommaSetPattern")}let v=/\(6-\)/g;v.test(t)&&(t=t.replace(v,"(6-0)"),e.push("missingZeroPattern2"));let w=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(w.test(t)){let T=t.match(w),D=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),P=t;T.forEach(E=>{let[R,C]=E.match(D).slice(1),M=`${R}-${C}`;P=P.replace(E,M)}),t=P,e.push("slashSetPattern")}let y=/(.*)\s(1\d)\s(\d+)$/;if(y.test(t)){let[T,D,P]=t.match(y).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${D}${P}`,e.push("spaceSeparatedSuperPattern"))}let b=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(b)||[]){let[D,P,E,R]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[C,M]=P.split("-").map(N=>parseInt(N));Math.abs(C-M)===1&&(t=t.replace(T,`${D}${P}(${E})${R}`),e.push("spaceSeparatedSetPattern"))}let S=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(S)||[]){let D=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[P,E,R]=T.match(D).slice(1),[C,M]=P.split("-").map(N=>parseInt(N));Math.abs(C-M)===1&&(t=t.replace(T,`${P}(${E})${R}`),e.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let T of t.match(U)||[]){let D=/(^|\s)(\d \d)\(/,[P,E]=T.match(D).slice(1);t=t.replace(T,`${P}${E.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function kHe({score:t,matchUpStatus:e}){let i=t?.split(" ");t=i.map(o=>{if(o.endsWith("]")){let l=o.split("[");if(HI(l[0]))return l[0]+`(${l[1].slice(0,-1)})`}return o}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let o of t.match(r)){let l=o.replace(" ","-").match(/\((.*)\)/)?.[1];if(Ni(l)&&l?.[0]>2){if([2,4].includes(l.length))l=l.split("").join("-");else if(l.length===3){let u=l.indexOf("1");l=EE(l.split(""),u)}}t=t.replace(o,`(${l})`)}i=t?.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((o,l)=>{let u=[void 0,"","COMPLETED"].includes(e)||l!==a;if(n.test(o)&&u){let[c,d,p]=Array.from(o.match(n)).slice(1),f=Math.min(d,p);return`${c}(${f})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l,u]=Array.from(o.match(n)).slice(1),c=l.split("");return`${c[0]}-${c[1]}(${u})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(o=>{if(n.test(o)){let[l,u]=Array.from(o.match(n)).slice(1);return HI(l)?`${l}(${u})`:l}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l]=o.match(n).slice(1);return`[${l<9?10:Number.parseInt(l)+2}-${l}]`}return o}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let o=t.match(s)[1];t=t.replace(s,`(${o}) `)}return{score:t}}function OHe({score:t,attributes:e,identifier:i}){if(typeof t!="string")return{score:t,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=t.match(r);for(let c of n||[]){let d=c.match(/^\((.*)\)$/)?.slice(1)?.[0],p=t.split(c)[0].split(")").reverse()[0].replace(/\D/g,"");if(d?.length===2&&p?.length>=2){let m=p.slice(p.length-2).split("").map(g=>parseInt(g));if(Math.abs(m[0]-m[1])===1)continue}let f=D3(d),h=tA(f);t=t.replace(c,`(${h})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);t.match(a)?.forEach(c=>{let d=D3(c.match(/^\[(.*)\]$/)[1]);t=t.replace(c,`(${d}) `).trim()});let s=[")","]"],o=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&s.some(c=>t.endsWith(c))&&o.some(c=>t.includes(c))){let c="",d=t.split(/[)\]]/).filter(Boolean).map(g=>(g.startsWith(",")&&(g=g.slice(1)),g.trim())),p=d.every(g=>g.includes(",")||VD(g)),f=d.every(g=>g.includes("/")||VD(g)),h=d.every(g=>g.includes("-")||VD(g)),m=p&&","||h&&"-"||f&&"/";if(m){let g;d.forEach(I=>{if(I.startsWith("("))if(g==="set"&&(c+=" "),I.includes(m))c+=I.slice(1).split(m).map(v=>v.trim()).join("-"),g="set";else{let v=I.slice(1);c+=`(${v}) `,g="tiebreak"}else if(I.startsWith("[")){let v=I.slice(1).split(m).map(y=>parseInt(y.trim())),w=Math.min(...v);g==="set"?c+=`(${w}) `:c+=`[${v.join("-")}] `,g="tiebreak"}}),t=c.trim()}}let l=Ra(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&HI(t)&&Ni(e?.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let u=/\(\)/g;return u.test(t)&&(t=t.replace(u,"").trim()),{score:t}}function oue({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let o=`${r[0]}-${r[1]}`;return r[2]&&(o+=` (${r[2]})`),n(),r.push(r),o};n();let s=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let o=e.shift(),l=Ni(o)&&parseInt(o),u=r[0]!==void 0&&r[1]!==void 0;if(Ni(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,s())){i.push(a()),r=[void 0,void 0];continue}if(u&&e.length===1&&Ni(e[0])){let c=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=c,i.push(a()),r=[void 0,void 0]}u&&s()}}return{sets:i}}function SF(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=EE(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=EE(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function lue(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e?.toString().split(""),a=n?.every(o=>Ni(o)),s=o=>Math.abs(o[0]-o[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let o=a?n.map(u=>parseInt(u)):e.split("").map(u=>parseInt(u)),{sets:l}=oue({score:e});if(o.length,e.length===3&&s(o.slice(0,2))===1){let[u,c,d]=o;e=`${u}-${c}(${d})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&o[0]===1){let[u,c,d]=o;e=`[${u}${c}-${d}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&s(o.slice(0,2))===1&&"987654".split("").includes(o[0].toString())){let[u,c,d,p]=o,f=Math.min(d,p);e=`${u}-${c}(${f})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&o[0]===1&&o[2]===1){let[u,c,d,p]=o;e=`[${u}${c}-${d}${p}]`,i.push("bigSuper")}else if(e.length===4){let[u,c,d,p]=o;e=`${u}${c} ${d}${p}`,i.push("split4")}else if(e.length===5&&s(o.slice(0,2))===1){let[u,c,d,p,f]=o;e=`${u}-${c}(${d}) ${p}-${f}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&s(o.slice(3))===1){let[u,c,d,p,f]=o;e=`${u}-${c} ${d}-${p}(${f})`,i.push("numericTiebreakPattern5")}else if(o.length===7)if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&o[4]===1){let[u,c,d,p,f,h,m]=o;e=`${u}-${c} ${d}-${p} [${f}${h}-${m}]`,i.push("numericTiebreakPattern6")}else if(s(o.slice(0,2))===1&&s(o.slice(3,5))>1&&s(o.slice(5,7))>1){let[u,c,d,p,f,h,m]=o;e=`${u}-${c}(${d}) ${p}-${f} ${h}-${m}`,i.push("numericTiebreakPattern7")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))===1&&s(o.slice(5,7))>1){let[u,c,d,p,f,h,m]=o;e=`${u}-${c} ${d}-${p}(${f}) ${h}-${m}`,i.push("numericTiebreakPattern8")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&s(o.slice(4,6))===1){let[u,c,d,p,f,h,m]=o;e=`${u}-${c} ${d}-${p} ${f}-${h}(${m})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let u=SF(e);u&&e!==u&&i.push("parsedSuperPattern"),e=u??e}else{let u=Sr(e.split(""),2).map(I=>I.join("")),c=u.map(I=>{let[v,w]=I.split("").map(S=>parseInt(S)),y=Math.abs(v-w),b=v>w?1:2;return y>1&&b||b*-1}),d=c.reduce((I,v)=>I>0&&v>0,1),p=Ra(c),f=c.map(I=>Math.abs(I)),h=Ra(f),m=c[0]<0,g=!m&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[u.slice(0,2).join(" "),u.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(d)e=u.join(" "),i.push("chunkSplit");else if(o.length===6){if(p[1]===2||p[2]===2)if(!Object.values(h).includes(3))e=u.join(" "),i.push("chunkSplit");else{let[I,v,w,y,b,S]=o,U=c.reduce((T,D,P)=>D<0?P:T,void 0);if(U===0){let T=Math.min(w,y);e=`${I}-${v}(${T}) ${b}-${S}`,i.push("chunkSplitTiebreak1")}else if(U===1){let T=Math.min(b,S);e=`${I}-${v} ${w}-${y}(${T})`,i.push("chunkSplitTiebreak2")}else e=`${I}-${v} ${w}-${y}`,i.push("chunkSplitTrimExtraneous")}}else if(o.length===8){let[I,v,w,y,b,S,U,T]=o;m||g?o[5]===1&&(m?e=`${I}-${v}(${w}) ${y}-${b} [${S}${U}-${T}]`:e=`${I}-${v} ${w}-${y}(${b}) [${S}${U}-${T}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:r}}function uue(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let u=l.match(n).slice(1).map(d=>Number.parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],o=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:s,setWinners:i,totalSets:o,winningSide:a}}function xHe({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),s=a.length;t=a.map((c,d)=>{if(new RegExp(Uw).test(c)){let f=c.slice(3),h=c.slice(0,3),m=h.split("-");if(!HI(h)&&!e){let g=Math.max(...m),I=h.indexOf(g),v=[g,g-1];return I&&v.reverse(),v.join("-")+f}}else if(c.length===2&&Ni(c))return c.split("").join("-");c=tA(c);let p=new RegExp(`^${Ej}$`).test(c)&&"super"||new RegExp(`^${Uw}$`).test(c)&&"tiebreak"||new RegExp(`^${eA}$`).test(c)&&"standard"||"unknown";if(r.push(p),s>1&&p==="standard"&&d<2){let[f,h]=c.split("-"),m=Math.abs(parseInt(f)-parseInt(h)),g=Math.max(f,h),I=Math.min(f,h),v=[parseInt(f),parseInt(h)].indexOf(I);if(g>9&&m>2){let w=g.toString().split(""),y=w.find(b=>parseInt(b)>I||d&&parseInt(b)<=n)??w[0];y&&(c=v?[y,I].join("-"):[I,y].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[f,h]=c.split("-");if(!Math.abs(parseInt(f)-parseInt(h))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:o,setWinners:l,totalSets:u}=uue(t);if(u===1&&i?.removed==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...o)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...o)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function FHe({score:t}){let{setsTied:e,winningSide:i}=uue(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let o=t.match(r).slice(1)[0],l=o<=8?10:o+2;t=t.replace(r,` [${l}-${o}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let s=a.split("(").join("").split(")").join("").split("-");if(!s.every(o=>Ni(o)))return{score:t};if(s[0]==="76"){let o=s[1].length===2?Math.min(...s[1].split("").map(l=>parseInt(l))):s[1];t=[...n.slice(0,n.length-1),`7-6(${o})`].join(" ")}else{s=s.map(u=>parseInt(u));let o=Math.max(...s),l=Math.abs(s[0]-s[1]);if(o>=10){if(l>2&&s.every(u=>+u>=10)){let u=s.map(c=>c===o?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(s=u)}t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" ")}else n.length===3&&o>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function LHe({score:t}){return t=t?.toString().toLowerCase()||"",{score:t}}function _He({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function $He({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=EE(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=lue({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function BHe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&SF(t)?{score:SF(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function VHe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t?.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function jHe({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let n=e?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function GHe({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(def|defaulted)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleDefaulted"),{score:s.trim(),matchUpStatus:"defaulted",applied:i}}let n=e?.matchUpStatuses?.defaulted,a=["dft",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleDefaulted"),{matchUpStatus:"defaulted",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function HHe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function WHe({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function zHe({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function qHe({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function YHe({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[s,o]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${s}-${o}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Ni(i))&&e.length===4&&(t=e)}return{score:t}}function KHe({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var XHe={handleTiebreakSlashSeparation:qHe,handleSetSlashSeparation:WHe,punctuationAdjustments:CHe,handleGameSeparation:zHe,joinFloatingTiebreak:NHe,handleBracketSpacing:MHe,handleSpaceSeparator:YHe,separateScoreBlocks:$He,matchKnownPatterns:AHe,removeDanglingBits:HHe,removeErroneous:BHe,handleDefaulted:GHe,handleWalkover:VHe,properTiebreak:kHe,handleNumeric:lue,handleRetired:jHe,containedSets:OHe,sensibleSets:xHe,stringScore:LHe,superSquare:FHe,setBuilder:oue,excisions:KHe,replaceOh:_He},Wk={},JHe=["handleNumeric","handleWalkover","handleRetired","handleDefaulted","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],QHe=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function cue(t){if(!t.score)return{error:re};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:s,profile:o}=t,l=[],u,c=[],d,p,f=e,h=g=>{g.forEach(I=>{p=XHe[I]({profile:o,identifier:r,matchUpStatus:u,attributes:d,applied:c,score:f});let v=p.score!==f;v&&l.push({method:I,score:p.score}),a&&(s||v||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},I),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),f=p.score})};h(JHe);let m=T3(f);return m||(f=e.toString().replaceAll(/\D/g,""),d?.removed&&(d.removed=void 0),h(QHe),m=T3(f),m||(f="")),c.forEach(g=>{Wk[g]||(Wk[g]=0),Wk[g]+=1}),{matchUpStatus:u?.toUpperCase(),modifications:l,attributes:d,isValid:m,score:f}}var due={};ft(due,{analyzeScore:()=>Cj,analyzeSet:()=>Tw,calculateMatchStatistics:()=>wj,checkScoreHasValue:()=>hr,checkSetIsComplete:()=>QN,deduceMatchUpFormat:()=>nA,enrichPointHistory:()=>xle,getEpisodes:()=>bj,getQuickStats:()=>Fle,getScore:()=>xd,getScoreboard:()=>Ij,getSetComplement:()=>Nj,getTiebreakComplement:()=>rA,getWinner:()=>vj,isComplete:()=>yj,isValidMatchUpFormat:()=>qa,parseScoreString:()=>IT,toStatObjects:()=>Sj,validateMatchUpScore:()=>pue,validateScore:()=>Mj,validateSetScore:()=>Rj,validateTieFormat:()=>qn});function ZHe(t,e,i,r,n,a=!1){return n?{isValid:!0}:t===0&&e===0?{isValid:!1,error:"Tiebreak-only set requires both scores"}:t<r?{isValid:!1,error:`Tiebreak-only set winner must reach at least ${r}, got ${t}`}:i<(a?1:2)?{isValid:!1,error:a?`Tiebreak-only set (NoAD) must be won by at least 1 point, got ${t}-${e}`:`Tiebreak-only set must be won by at least 2 points, got ${t}-${e}`}:a?{isValid:!0}:t===r&&e>r-2?{isValid:!1,error:`Tiebreak-only set at ${r}-${e} requires playing past ${r}`}:t>r&&i!==2?{isValid:!1,error:`Tiebreak-only set past ${r} must be won by exactly 2 points, got ${t}-${e}`}:{isValid:!0}}function eWe(t,e,i,r){let n=r===i?i+1:i,a=r;return t!==n?{isValid:!1,error:`Tiebreak set winner must have ${n} games, got ${t}`}:e!==a?{isValid:!1,error:`Tiebreak set loser must have ${a} games, got ${e}`}:{isValid:!0}}function tWe(t,e,i){let r=Math.max(t||0,e||0),n=Math.min(t||0,e||0),a=r-n,s=i.tiebreakTo||7;return r<s?{isValid:!1,error:`Tiebreak winner must reach ${s} points, got ${r}`}:a<2?{isValid:!1,error:`Tiebreak must be won by 2 points, got ${r}-${n}`}:n>=s-1&&a>2?{isValid:!1,error:`Tiebreak score ${r}-${n} is invalid`}:{isValid:!0}}function iWe(t,e,i,r){return r?t===i+1&&e<i-1?{isValid:!1,error:`With tiebreak format, if side 1 has ${i+1} games, side 2 must be at least ${i-1}, got ${e}`}:e===i+1&&t<i-1?{isValid:!1,error:`With tiebreak format, if side 2 has ${i+1} games, side 1 must be at least ${i-1}, got ${t}`}:{isValid:!0}:{isValid:!0}}function rWe(t,e,i,r,n){if(t<r)return{isValid:!1,error:`Set winner must reach ${r} games, got ${t}`};let a=n&&t===r&&e===n&&i===1;if(i<2&&!a)return{isValid:!1,error:`Set must be won by at least 2 games, got ${t}-${e}`};if(n){if(e>=n&&!a)return{isValid:!1,error:`When tied at ${n}-${n}, must play tiebreak. Use format like ${n+1}-${n}(5)`};let s=n===r?r+1:r;if(t>s)return{isValid:!1,error:`With tiebreak format, set score cannot exceed ${s}-${n}. Got ${t}-${e}`}}else if(t>r+10)return{isValid:!1,error:`Set score ${t}-${e} exceeds reasonable limits`};return{isValid:!0}}function nWe(t,e,i){let r=t.side1TiebreakScore,n=t.side2TiebreakScore,a=e&&i?r:t.side1Score||t.side1||0,s=e&&i?n:t.side2Score||t.side2||0;return{side1Score:a,side2Score:s,side1TiebreakScore:r,side2TiebreakScore:n}}function aWe(t,e,i,r,n,a,s){if(i&&r){let o=eWe(t,e,i,r);if(!o.isValid)return o}return(n!==void 0||a!==void 0)&&s?tWe(n,a,s):{isValid:!0}}function sWe(t,e,i){return i&&(t>i+10||e>i+10)?{isValid:!1,error:`Set score ${t}-${e} exceeds expected range for ${i}-game sets`}:{isValid:!0}}function oWe(t,e,i){let{side1:r,side2:n,winner:a,loser:s,diff:o}=t,{setTo:l,tiebreakAt:u}=e;if(l&&u){let c=iWe(r,n,l,u);if(!c.isValid)return c}return i?sWe(a,s,l):l?rWe(a,s,o,l,u):{isValid:!0}}function Rj(t,e,i,r){if(!e)return{isValid:!0};let n=Xi(e);if(!n)return{isValid:!0};let a=i&&n.finalSetFormat?n.finalSetFormat:n.setFormat;if(!a)return{isValid:!0};if(a.timed){if(!r){let S=t.side1Score??0,U=t.side2Score??0;if(S===0&&U===0)return{isValid:!1,error:"Timed set requires at least one side to have scored"};if(a.based==="P"&&S===U&&S>0&&a.tiebreakFormat&&!(t.side1TiebreakScore!==void 0||t.side2TiebreakScore!==void 0))return{isValid:!1,error:"Tied timed set requires tiebreak"}}return{isValid:!0}}let{setTo:s,tiebreakAt:o,tiebreakFormat:l,tiebreakSet:u}=a,c=u?.tiebreakTo,d=!!c&&!s,p=t.side1TiebreakScore!==void 0&&t.side2TiebreakScore!==void 0,{side1Score:f,side2Score:h,side1TiebreakScore:m,side2TiebreakScore:g}=nWe(t,d,p),I=Math.max(f,h),v=Math.min(f,h),w=I-v;if(d){let S=t.NoAD??a.tiebreakSet?.NoAD??!1;return ZHe(I,v,w,c,r??!1,S)}let y=m!==void 0||g!==void 0,b=s&&I===s+1&&v===s;return y||b?aWe(I,v,s,o,m,g,l):oWe({side1:f,side2:h,winner:I,loser:v,diff:w},{setTo:s,tiebreakAt:o},r)}function pue(t,e,i){if(!t||t.length===0)return{isValid:!0};let r=e?.match(/SET(\d+)/)?.[1],n=r?Number.parseInt(r):3,a=[Ur,si,Yt].includes(i||"");for(let s=0;s<t.length;s++){let o=t[s],l=s+1===n,u=o.winningSide!==void 0,c=Rj(o,e,l,a||i===void 0&&!u);if(!c.isValid)return{isValid:!1,error:`Set ${s+1}: ${c.error}`}}return{isValid:!0}}function iA(t){return!!t?.aggregate}function lWe(t,e,i,r,n,a){let{tiebreakTo:s,NoAD:o}=t||{},l=Math.max(e??0,i??0);return!(o&&l>s||l<s&&r&&(n&&!a||!n))}function uWe(t,e,i,r,n,a){let s=e+1===r,{side1Score:o,side2Score:l,side1TiebreakScore:u,side2TiebreakScore:c,winningSide:d}=t,p=Math.max(o??0,l??0),f=u??c,{finalSetFormat:h,setFormat:m}=i,g=s&&h||m;return f&&!lWe(g?.tiebreakFormat,u,c,d,n,a)?!1:g.setTo?!(!g.noTiebreak&&p>g.setTo+1):!0}function cWe(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i[0]+=r.side1Score??0,i[1]+=r.side2Score??0),i),[0,0]);return e[0]>e[1]?1:e[1]>e[0]?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function dWe(t,e,i,r,n){return(!n||t===e)&&i===1&&r.indexOf(t)+1||void 0}function Cj({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){let a=n?.sets??[],s=(a?.filter(T=>T?.winningSide)||[]).reduce((T,D)=>{let{winningSide:P}=D;if(!P)return T;let E=P-1;return T[E]++,T},[0,0]),o=r?r-1:void 0,l=o!==void 0&&[0,1].includes(o)?1-o:void 0,u=o!==void 0&&s[o],c=l!==void 0&&s[l],d=e?Xi(e):void 0,p=Math.max(...s),f=Ra(s)[p],h=d?.setFormat?.timed||d?.finalSetFormat?.timed,m=d?.bestOf||d?.exactly,g=m&&Math.ceil(m/2)||1,I=i??t,v=!!(I&&[Yt,Ur,si].includes(I)),w=!d||!a.length||a.every((T,D)=>uWe(T,D,d,m??0,D===a.length-1,v)),y=d?.exactly,b=!y||!I||I!==xi||v||a.length>=y,S=iA(d),U=S&&a.length>0?cWe(a):dWe(p,g,f,s,e);return{valid:!!(w&&b&&(r&&S&&r===U||r&&!S&&u>c&&r===U||r&&v||!r&&!U&&(![xi,Yt,Ur,si].includes(I)||h&&I===xi)))}}function Mj({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:re};let{sets:a,scoreStringSide1:s,scoreStringSide2:o}=n,l="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:re,info:l};if(o!==void 0&&typeof o!="string")return{error:re,info:l};if(a!==void 0&&!Array.isArray(a))return{error:re,info:Zp("sets")};if(a?.length){let u=a.map(d=>d?.setNumber).filter(Boolean);if(u.length!==lt(u).length)return{error:re,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:f,side1TiebreakScore:h,side2TiebreakScore:m,side1PointScore:g,side2PointScore:I,winningSide:v,setNumber:w}=d;if(![[p,f],[h,m],[g,I]].filter(y=>y.some(b=>![void 0,null].includes(b))).every(y=>y.every(b=>ct(b))))return{error:re,info:"non-numeric values"};if(![w,v].filter(y=>![void 0,null].includes(y)).every(y=>ct(y)))return{error:re,info:"non-numeric values"};if(v&&![1,2].includes(v))return{error:re,info:"winningSide must be 1 or 2"}}let{valid:c}=Cj({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!c)return{error:nre,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var Nj=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let s=Ke(i);s?.toString().length>2&&(s=Number.parseInt(s.toString().slice(0,2))),n&&n<r&&s>n&&(s=n);let o;return a&&!n?s>r?o=r:o=s<r?r:r-1:o=s+1<r&&r||n&&n<r&&s===n&&r||!n&&s+2||r+1,[e?s:o,e?o:s]},rA=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?Number.parseInt(i):i;a?.toString().length>2&&(a=Number.parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let s=pWe({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:s,e?s:a]};function pWe(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function UF(t,e){return t>e&&1||t<e&&2||void 0}function fWe(t,e){return e?{side1Score:t[0],side2Score:t[1],winningSide:UF(t[0],t[1])}:{side1TiebreakScore:t[0],side2TiebreakScore:t[1],winningSide:UF(t[0],t[1])}}function IT({tiebreakTo:t=7,scoreString:e="",matchUpFormat:i}){let r,n=3;if(i)try{r=Xi(i);let c=/SET(\d+)/.exec(i)?.[1];n=c?Number.parseInt(c):3}catch{}return e?.split(" ").filter(Boolean).map((c,d)=>u({set:c,setNumber:d+1}));function a(c,d){if(!r||!d)return!1;let p=c===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;if(!p)return!1;let f=p.tiebreakSet?.tiebreakTo,h=p.setTo;return!!f&&!h}function s(c){if(!r)return t;let d=c===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;return d?.tiebreakSet?.tiebreakTo??d?.tiebreakFormat?.tiebreakTo??t}function o(c,d,p){let f=c[1],h=s(p),m=rA({lowValue:f,isSide1:d===2,tiebreakTo:h});return Array.isArray(m)?[m[0],m[1]]:[void 0,void 0]}function l(c,d,p,f){let h=(d&&c.replace(d[0],"")||p&&c.replace(p[0],"")||c).split("-").map(y=>Number.parseInt(y)),m=h[0],g=h[1],I=UF(m,g),v,w;if(d&&([v,w]=o(d,I,f)),p){let y=p[1].split("-").map(b=>Number.parseInt(b));v=y[0],w=y[1]}return{side1Score:m,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:w,winningSide:I}}function u({set:c,setNumber:d}){let p=/\(([^)]+)\)/,f=/\[([^\]]+)\]/,h=p.exec(c),m=f.exec(c),g=c?.startsWith("[")&&m,I=a(d,!!g),v=s(d),w=I&&v===1,y;if(g){let b=m[1].split("-").map(S=>Number.parseInt(S));y=fWe(b,I)}else y=l(c,h,m,d);return{side1Score:y.side1Score,side2Score:y.side2Score,side1TiebreakScore:y.side1TiebreakScore,side2TiebreakScore:y.side2TiebreakScore,winningSide:y.winningSide,setNumber:d,...w&&{NoAD:!0},...I&&{tiebreakSet:!0}}}}function hWe({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=ZN({set:n});return QN({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function Tw(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:xM};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},s=n||a,o=!!(r&&s&&r===s),l=o&&i?.finalSetFormat||i?.setFormat,u=!!l?.tiebreakSet,c=!!l?.timed,d=!u&&!c,p=!!(r&&s&&r<=s),f=[e?.side1Score,e?.side2Score],h=[e?.side1PointScore,e?.side2PointScore],m=[e?.side1TiebreakScore,e?.side2TiebreakScore],g=f.filter(k=>k!==void 0).length,I=h.filter(k=>k!==void 0).length,v=m.filter(k=>k!==void 0).length,w=f?.filter(k=>!isNaN(k)).length,y=m?.filter(k=>!isNaN(k)).length,{tiebreakAt:b}=l||{},S=b&&f.filter(k=>k>=b).length===2,U=S&&(f[0]>f[1]&&1||f[1]>f[0]&&2||void 0),T=!!(y&&!w),D=!!e?.winningSide,{error:P,result:E}=mWe({sideTiebreakScores:m,sideGameScores:f,setFormat:l,setObject:e}),{error:R,result:C}=gWe({sideTiebreakScores:m,setObject:e,setFormat:l}),M=d&&!T&&E||u&&T&&C||c,N=p&&!(u&&!T)&&!(d&&T)&&(!D||M),A=hWe({isTimedSet:c,matchUpScoringFormat:i,isDecidingSet:o,isTiebreakSet:T,setObject:e}),O={expectTiebreakSet:u,expectTimedSet:c,hasTiebreakCondition:S,isCompletedSet:D,isDecidingSet:o,isTiebreakSet:T,isValidSet:N,isValidSetNumber:p,isValidSetOutcome:M,leadingSide:U,setFormat:l,sideGameScores:f,sideGameScoresCount:g,sidePointScores:h,sidePointScoresCount:I,sideTiebreakScores:m,sideTiebreakScoresCount:v,winningSide:A};return e?.winningSide!==void 0&&(T?(O.isValidTiebreakSetOutcome=C,C||(O.tiebreakSetError=R)):(O.isValidStandardSetOutcome=E,E||(O.standardSetError=P))),O}function mWe({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:xM};let n=!!e?.tiebreakSet,a=!!e?.timed;if(!e||n||a)return{result:!1,error:re};if(i?.filter(U=>!isNaN(U)).length!==2)return{result:!1,error:Vx};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,NoAD:u}=e||{};if(!(s&&i?.find(U=>U>=s)))return{result:!1,error:Vx};let c=[1,2].includes(t?.winningSide);if(!t||!c)return{result:!1,error:LM};let d=t?.winningSide-1,p=1-d,f=i[d],h=i[p],m=f-h;if(!(f>h))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=o&&l,I=r?.filter(U=>!isNaN(U)).length===2,v=r?.[d],w=r?.[p],y=o&&i.filter(U=>U>=o).length===2;if(g){let{NoAD:U,tiebreakTo:T}=l;if(y){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!I)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&r?.find(C=>C>=T)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let D=o<s?s:s+1;if(f>D)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!v||!w||v<w)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let P=U?1:2,E=v-w,R=w>=T-1;if(E&&R&&E<P)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(f>s&&!y)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let b=u?1:2,S=h>=s-1;return m&&S&&!y&&m<b?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>b&&f>s?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function gWe({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:xM};let r=!!e?.tiebreakSet,n=!!e?.timed;if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t?.winningSide);if(!t||!a)return{result:!1,error:LM};let{tiebreakSet:s}=e||{},{NoAD:o,tiebreakTo:l}=s||{};if(i?.filter(g=>!isNaN(g)).length!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!i?.find(g=>g>=l))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=t?.winningSide-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let f=o?1:2,h=d-p,m=p>=l-1;return h&&m&&h<f?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var zk="SET3-S:6/TB7";function nA(t){let e=t.split(/[\s,]+/).filter(o=>o.length>0);if(e.length===0)return zk;let i;e.length===1?i=1:e.length===2?i=3:i=5;for(let o of e){let l=o.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(u=>Number.parseInt(u,10))||[];if(l.length===2){let u=Math.max(...l),c=Math.min(...l),d=u-c;if(u===10||u>10&&d<=2)return`SET${i}-S:TB10`}}let r=null;for(let o of e)if(/\(/.test(o)){r=o;break}let n;if(r){let o=r.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(c=>parseInt(c,10))||[];if(o.length===0)return zk;let l=Math.max(...o),u=Math.min(...o);l===u+1?n=u:n=l-1}else{let o=[];for(let u of e){let c=u.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(d=>parseInt(d,10))||[];c.length>0&&o.push(Math.max(...c))}if(o.length===0)return zk;let l=Math.max(...o);l>=6?n=6:n=l}let a=!1;if(e.length>=3){let o=e.at(-1).replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(l=>Number.parseInt(l,10))||[];if(o.length===2){let l=Math.max(...o),u=Math.min(...o);l>n+1&&l-u===2&&(a=!0)}}let s;return n===6?s=`SET${i}-S:6/TB7`:n===4?s=`SET${i}-S:4/TB7`:s=`SET${i}-S:${n}/TB7`,a&&(s+=`-F:${n}`),s}function fue(t){let{matchUp:e,expectedScore:i}=t;if(!e)return{isValid:!1,errors:["No matchUp provided"],warnings:[],actual:{sets:[],scoreString:""},expected:{sets:i?.sets,scoreString:i?.scoreString},pointsProcessed:0,pointsRejected:0};let r=[],n=[],a=dd({matchUpFormat:e?.matchUpFormat,matchUpId:e?.matchUpId,participants:e?.sides?.map(c=>c.participant).filter(c=>c!==void 0)}),s=e?.history?.points||[];s.length===0&&n.push("No points found to validate");let o=0,l=0;for(let c of s)try{a=Ep(a,{winner:c.winner,server:c.server}),o++}catch(d){l++;let p=d instanceof Error?d.message:String(d);r.push(`Point ${c.pointNumber||o+1}: ${p}`)}let u=xd(a);return i&&(i.sets&&(u.sets.length!==i.sets.length&&r.push(`Set count mismatch: expected ${i.sets.length}, got ${u.sets.length}`),i.sets.forEach((c,d)=>{let p=u.sets[d];if(!p){r.push(`Missing set ${d+1}`);return}c.side1Score!==void 0&&p.side1Score!==c.side1Score&&r.push(`Set ${d+1} side1Score: expected ${c.side1Score}, got ${p.side1Score}`),c.side2Score!==void 0&&p.side2Score!==c.side2Score&&r.push(`Set ${d+1} side2Score: expected ${c.side2Score}, got ${p.side2Score}`),c.side1TiebreakScore!==void 0&&p.side1TiebreakScore!==c.side1TiebreakScore&&r.push(`Set ${d+1} side1TiebreakScore: expected ${c.side1TiebreakScore}, got ${p.side1TiebreakScore}`),c.side2TiebreakScore!==void 0&&p.side2TiebreakScore!==c.side2TiebreakScore&&r.push(`Set ${d+1} side2TiebreakScore: expected ${c.side2TiebreakScore}, got ${p.side2TiebreakScore}`)})),i.scoreString&&u.scoreString!==i.scoreString&&r.push(`Score string mismatch: expected "${i.scoreString}", got "${u.scoreString}"`)),{isValid:r.length===0,errors:r,warnings:n,actual:{sets:u.sets,scoreString:u.scoreString},expected:{sets:i?.sets,scoreString:i?.scoreString},pointsProcessed:o,pointsRejected:l}}function IWe(t){let e=t?.side1Score||0,i=t?.side2Score||0;if(t?.side1TiebreakScore!==void 0||t?.side2TiebreakScore!==void 0){let r=t?.side1TiebreakScore||0,n=t?.side2TiebreakScore||0;return e>i?`${e}-${i}(${n})`:`${e}(${r})-${i}`}return`${e}-${i}`}function vWe(t){let{points:e,matchUpFormat:i,expectedGames:r,expectedTiebreak:n}=t,a={matchUpId:"validation",matchUpFormat:i,matchUpStatus:"TO_BE_PLAYED",matchUpType:"SINGLES",sides:[{sideNumber:1},{sideNumber:2}],score:{sets:[]},history:{points:e?.map((s,o)=>({...s,pointNumber:o+1,timestamp:"",winner:s.winner,server:s.server}))}};return fue({matchUp:a,expectedScore:{sets:[{side1Score:r?.[0],side2Score:r?.[1],side1TiebreakScore:n?.[0],side2TiebreakScore:n?.[1]}]}})}function yWe(t){let{points:e,expectedScore:i,matchUpFormat:r,allowExtraPoints:n=!1,debug:a=!1}=t,s=[],o=[],l=[],u,c=!1;r?u=r:i?(u=nA(i),c=!0,a&&console.log(`Deduced format: ${u} from score: ${i}`)):(u="SET3-S:6/TB7",c=!0,o.push("No format provided, using default SET3-S:6/TB7"));let d=dd({matchUpFormat:u}),p=e?.split("").map(v=>{let w=Number.parseInt(v,10);return Number.isNaN(w)||w!==0&&w!==1?null:w}).filter(v=>v!==null);if(p?.length===0)return s.push("No valid points found in point string"),{valid:!1,errors:s,warnings:o,pointsProcessed:0,pointsRejected:[],actualScore:"0-0",matchUpFormat:u,formatDeduced:c,sets:[]};let f=0;for(let v=0;v<p?.length;v++){let w=p[v];if(d.matchUpStatus==="COMPLETED"&&!n){l.push(w),a&&console.log(`Point ${v+1}: Rejected (match complete)`);continue}try{if(d=Ep(d,{winner:w}),f++,a){let y=xd(d);console.log(`Point ${v+1}: ${w} â†’ ${y.scoreString}`)}}catch(y){l.push(w);let b=y instanceof Error?y.message:String(y);s.push(`Point ${v+1}: ${b}`),a&&console.log(`Point ${v+1}: Error - ${b}`)}}let h=xd(d),m=h.scoreString,g=h.sets.map(v=>{let w=[v.side1Score||0,v.side2Score||0],y=v.side1TiebreakScore===void 0?void 0:[v.side1TiebreakScore,v.side2TiebreakScore||0],b=`${w[0]}-${w[1]}`;return y&&(b=w[0]>w[1]?`${w[0]}-${w[1]}(${y[1]})`:`${w[0]}(${y[0]})-${w[1]}`),{games:w,tiebreak:y,scoreString:b}}),I=!0;if(i){let v=P3(i),w=P3(m);v!==w&&(I=!1,s.push(`Score mismatch: expected "${i}", got "${m}"`))}return l.length>0&&o.push(`${l.length} excess points after match complete`),s.length>0&&(I=!1),{valid:I,errors:s,warnings:o,pointsProcessed:f,pointsRejected:l,expectedScore:i,actualScore:m,matchUpFormat:u,formatDeduced:c,sets:g}}function P3(t){return t.replace(/\s+/g,"").replace(/,/g,", ").toLowerCase()}var bWe={4:"Wide",5:"Body",6:"T"},hue={f:"Forehand",r:"Forehand Slice",v:"Forehand Volley",o:"Overhead Smash",u:"Forehand Drop Shot",l:"Forehand Lob",h:"Forehand Half-volley",j:"Forehand Drive Volley"},mue={b:"Backhand",s:"Backhand Slice",z:"Backhand Volley",p:"Backhand Overhead Smash",y:"Backhand Drop Shot",m:"Backhand Lob",i:"Backhand Half-volley",k:"Backhand Drive Volley"},wWe={t:"Trick Shot",q:"Unknown Shot"},SWe={...hue,...mue,...wWe},UWe={7:"shallow",8:"deep",9:"very deep"},TWe={1:1,2:2,3:3},DWe={"+":"approach","-":"net","=":"baseline"},Yf={n:"Net",w:"Out Wide",d:"Out Long",x:"Out Wide and Long",g:"Foot Fault",e:"Unknown","!":"Shank"};function PWe(t,e){return t.PtWinner===t.Svr?e:1-e}function gue(t){let e=[],i="",r="fbrsvzouymlhijkpqt";for(let n=0;n<t.length;n++){let a=t[n];a&&(r.includes(a)||"456".includes(a)?(i&&e.push(i),i=a):i+=a)}return i&&e.push(i),e}function EWe(t){if(t.includes("*"))return"*";if(t.includes("#"))return"#";if(t.includes("@"))return"@"}function Wl(t){if(t){for(let e of Object.keys(Yf))if(t.includes(e))return e}}function RWe(t){let e=[];for(let i of t){if(!i)continue;let r=i[0];if(r&&/[456]/.test(r))e.push(i);else break}return e}function Iue(t){if(!ai(t))return{serves:[],rally:[]};let e,i,r,n=t.split("c").length-1;t=t.split("c").join("");let a=gue(t),s=a;for(let c=a.length-1;c>=0;c--){let d=a[c];if(d&&(i=EWe(d),i)){s=a.slice(0,c+1),r=a.slice(c+1),e=d;break}}let o=RWe(s),l=o.length?s.slice(o.length):s;if(!i&&!o.length&&l.length===1){let c=l[0];c&&["S","P","Q","R"].includes(c)&&(e=c,l.length=0)}let u={serves:o,rally:l};return n&&(u.lets=n),i&&(u.terminator=i),e&&(u.result=e),r?.length,u}function vue(t){let e=t.join("|"),i=TF(t[0],1);if(i.winner==="S"||!t[1])return i.serve=1,i.code=e,i;let r=TF(t[1],2);return r.serve=2,r.first_serve={serves:i.serves},i.lets&&(r.first_serve.lets=i.lets),i.error&&(r.first_serve.error=i.error),i.parse_notes&&(r.first_serve.parse_notes=i.parse_notes),r.code=e,r}function TF(t,e){let i=Iue(t);if(["Q","S"].includes(i.result||""))return i.winner="S",i;if(["P","R"].includes(i.result||"")||!i.terminator&&!Wl(i.serves[0])&&i.serves.length>2)return i.winner="R",i;let r=(i.serves.length+i.rally.length)%2===0?"R":"S",n;if(i.rally.length>0?n=i.rally[i.rally.length-1]:i.serves.length>0&&(n=i.serves[i.serves.length-1]),!n)return{...i,winner:void 0};if(!i.rally.length){if(i.terminator==="*")i.result="Ace",i.winner="S";else if(i.terminator==="#")i.result="Serve Winner",i.winner="S";else{let a=Wl(i.serves[0]);a?(i.error=Yf[a],e===2&&(i.result="Double Fault",i.winner="R")):(i.parse_notes="treated as a fault",e===2&&(i.result="Double Fault",i.winner="R"))}return i}if(i.rally.length===1&&n.includes("#")){i.result="Serve Winner",i.winner="S";let a=Wl(n);return a&&(i.error=Yf[a]),i}return n.includes("#")?(i.result="Forced Error",i.error=Yf[Wl(n)],i.winner=r==="R"?"S":"R"):n.includes("*")?(i.result="Winner",i.winner=r):n.includes("@")?(i.result="Unforced Error",i.error=Yf[Wl(n)],i.winner=r==="R"?"S":"R"):Wl(i.serves[0])?i.rally.length===1&&Wl(n)&&(i.error=Yf[Wl(n)],i.winner=r==="R"?"S":"R"):i.serves.length&&i.rally.length?(i.parse_notes="no terminator: receiver wins point",i.result="Unknown",i.winner="R"):i.rally.length===1&&Wl(n)&&(i.error=Yf[Wl(n)],i.winner=r==="R"?"S":"R"),i}function DF(t){if(t)for(let e of t){let i=SWe[e];if(i)return i}}function CWe(t){if(t)for(let e of t){let i=bWe[e];if(i)return i}}function MWe(t,e,i){let r=[],n=1,a=i;if(t.length>0&&!Wl(t[t.length-1])){let s=t[t.length-1],o=DF(s)||"Forehand";r.push({shotNumber:n++,player:a,stroke:o,code:s}),a=1-a}for(let s of e){let o=DF(s);if(!o)continue;let l={shotNumber:n++,player:a,stroke:o,code:s};for(let u of s){let c=TWe[u];c!==void 0&&(l.direction=c)}for(let u of s){let c=UWe[u];c&&(l.depth=c)}for(let u of s){let c=DWe[u];c&&(l.position=c)}r.push(l),a=1-a}return r}function yue(t,e){let i=PWe(t,e),r=t["1st"]||"",n=t["2nd"]||"";if(!r&&!n)return{winner:i,server:e,result:"Unknown"};let a=vue([r,n]),s={winner:i,server:e};a.result&&(s.result=a.result),a.serve&&(s.serve=a.serve);let o=a.serve===1?r:n,l=CWe(o);l&&(s.serveLocation=l);let u=a.rally[a.rally.length-1];if(u){let d=DF(u);d&&(s.stroke=d,Object.values(hue).includes(d)?s.hand="Forehand":Object.values(mue).includes(d)&&(s.hand="Backhand"))}let c=MWe(a.serves,a.rally,e);return c.length>0&&(s.rally=c,s.rallyLength=c.length),a.code&&(s.code=a.code),s}function bue(t){if(!t||!ai(t))return[];let e=t.trim().split(`
`);if(e.length<2)return[];let i=e[0]?.split(",")||[],r=[];for(let n=1;n<e.length;n++){let a=e[n];if(!a)continue;let s=a.split(","),o={};for(let l=0;l<i.length;l++){let u=i[l];u&&(o[u]=s[l]||"")}r.push(o)}return r}function wue(t){if(!Array.isArray(t))return[];let e=new Map;for(let i of t){let r=i.match_id;e.has(r)||e.set(r,[]),e.get(r).push(i)}return Array.from(e.entries()).map(([i,r])=>({match_id:i,points:r}))}function NWe(t){let e=t?.split("-")||[];if(e.length<6)return{player1:"Player 1",player2:"Player 2"};let i=e[0],r=e[2]?.replace(/_/g," "),n=e[4]?.replace(/_/g," ")||"Player 1",a=e[5]?.replace(/_/g," ")||"Player 2";return{player1:n,player2:a,date:i,tournament:r}}function AWe(t){if(!t||t.length===0)return;let e=t.at(-1);if(!e)return;let i=e.Set1,r=e.Set2,n=e.Set3,a=e.Set4,s=e.Set5,o=[];return i&&o.push(`${i}-${r}`),n&&o.push(`${n}-${r||"0"}`),a&&o.push(`${a}-${r||"0"}`),s&&o.push(`${s}-${r||"0"}`),o.length>0?o.join(", "):void 0}function Sue(t,e={}){let{matchUpFormat:i,validateScore:r=!0,debug:n=!1}=e,a=[],s=[],o=NWe(t.match_id),l=AWe(t.points),u,c=!1;i?u=i:l?(u=nA(l),c=!0,n&&console.log(`Deduced format: ${u} from score: ${l}`)):(u="SET3-S:6/TB7",c=!0,s.push("No format provided, using default SET3-S:6/TB7")),n&&(console.log(`Validating match: ${o.player1} vs ${o.player2}`),console.log(`Format: ${u}`),console.log(`Total points: ${t.points.length}`),l&&console.log(`Expected score: ${l}`));let d=dd({matchUpFormat:u,matchUpId:t.match_id});d.sides[0]&&(d.sides[0].participant={participantId:"player1",participantName:o.player1,participantType:"INDIVIDUAL",participantRole:"COMPETITOR"}),d.sides[1]&&(d.sides[1].participant={participantId:"player2",participantName:o.player2,participantType:"INDIVIDUAL",participantRole:"COMPETITOR"});let p=0,f=0,h=0,m=0,g=0,I,v=0;for(let S=0;S<t.points?.length;S++){let U=t.points[S];if(U){I=U.Svr==="1"?0:1;try{let T=yue(U,I),D={winner:T.winner,server:T.server};if(d=Ep(d,D),d.history?.points&&d.history.points.length>0){let P=d.history.points[d.history.points.length-1];P&&(T.result&&(P.result=T.result),T.stroke&&(P.stroke=T.stroke),T.hand&&(P.hand=T.hand),T.serve&&(P.serve=T.serve),T.serveLocation&&(P.serveLocation=T.serveLocation),T.rally&&(P.rally=T.rally),T.rallyLength&&(P.rallyLength=T.rallyLength),T.code&&(P.code=T.code))}if(v++,T.result==="Ace"&&p++,T.result==="Double Fault"&&f++,T.result==="Winner"&&h++,T.result==="Unforced Error"&&m++,T.result==="Forced Error"&&g++,n&&(S<5||S===t.points.length-1)){let P=xd(d);console.log(`Point ${S+1}: ${T.result||"Rally"} â†’ ${P.scoreString}`)}}catch(T){let D=T instanceof Error?T.message:String(T);a.push(`Point ${S+1}: ${D}`),n&&console.error(`Point ${S+1} failed:`,D)}}}let w=xd(d).scoreString,y=d.matchUpStatus==="COMPLETED";y||s.push(`Match not complete. Final score: ${w}`);let b;if(r&&l){let S=E3(l),U=E3(w);b=S===U,b||a.push(`Score mismatch: expected "${l}", got "${w}"`),n&&(console.log(`Expected: ${l} â†’ ${S}`),console.log(`Actual: ${w} â†’ ${U}`),console.log(`Score matches: ${b}`))}return n&&(console.log(`Final score: ${w}`),console.log(`Match complete: ${y}`),console.log(`Stats: ${p} aces, ${f} DFs, ${h} winners, ${m} UEs, ${g} FEs`)),{valid:a.length===0,errors:a,warnings:s,matchUp:d,pointsProcessed:v,expectedScore:l,actualScore:w,scoreMatches:b,formatDeduced:c,aces:p,doubleFaults:f,winners:h,unforcedErrors:m,forcedErrors:g}}function E3(t){return t.replace(/\s+/g,"").replace(/,/g,", ").toLowerCase()}function kWe(t){let{csvData:e,matchId:i,matchUpFormat:r,debug:n=!1}=t,a=[],s=[],o=[],l;try{l=bue(e)}catch(I){let v=I instanceof Error?I.message:String(I);return a.push(`Failed to parse CSV: ${v}`),{valid:!1,errors:a,warnings:s,matchesProcessed:0,pointsProcessed:0,matchUps:[],totalAces:0,totalDoubleFaults:0,totalWinners:0,totalUnforcedErrors:0,totalForcedErrors:0}}let u=wue(l);n&&console.log(`Parsed ${l.length} points from ${u.length} matches`);let c=i?u.filter(I=>I.match_id===i):u;if(c.length===0)return a.push(i?`Match ID not found: ${i}`:"No matches found in CSV data"),{valid:!1,errors:a,warnings:s,matchesProcessed:0,pointsProcessed:0,matchUps:[],totalAces:0,totalDoubleFaults:0,totalWinners:0,totalUnforcedErrors:0,totalForcedErrors:0};let d=0,p=0,f=0,h=0,m=0,g=0;for(let I of c){let v=Sue(I,{matchUpFormat:r,debug:n});v.valid||a.push(...v.errors),s.push(...v.warnings),o.push(v.matchUp),d+=v.pointsProcessed,p+=v.aces,f+=v.doubleFaults,h+=v.winners,m+=v.unforcedErrors,g+=v.forcedErrors}return{valid:a.length===0,errors:a,warnings:s,matchesProcessed:c.length,pointsProcessed:d,matchUps:o,totalAces:p,totalDoubleFaults:f,totalWinners:h,totalUnforcedErrors:m,totalForcedErrors:g}}function OWe(t){return JSON.stringify(t,null,2)}function xWe(t){let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:s,isMock:o,event:l}=t,{tieFormat:u,matchUpFormat:c}=t;if(a===lr&&s===lr){let d=e?.structures?.find(({stage:p})=>p===ke)?.tieFormat;u=u||d||n&&l?.tieFormat?.tieFormatName===n&&l.tieFormat||n&&Pc({namedFormat:n,hydrateCollections:i,isMock:o,event:l})||l?.tieFormat||Pc({event:l,isMock:o,hydrateCollections:i}),c=void 0}else c||(u=void 0,l?.matchUpFormat||(c=Ws));if(u){let d=qn({gender:l?.gender,enforceGender:r,tieFormat:u});if(d.error)return d}return{tieFormat:u,matchUpFormat:c}}function FWe(t){let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,qualifyingOnly:n,drawEntries:a,structureId:s,tieFormat:o,idPrefix:l,isMock:u,event:c}=t,d=t.qualifyingProfiles,p=d?.length?wle({hasExistingDrawDefinition:!0,uuids:t.uuids,qualifyingProfiles:d,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,idPrefix:l,isMock:u}):void 0;if(p?.error)return p;e.structures=e.structures?.filter(({structureId:b})=>b!==i),e.links=e.links?.filter(({source:b})=>b.structureId!==i);let{qualifiersCount:f,qualifyingDrawPositionsCount:h,qualifyingDetails:m}=p??{};h&&(p?.structures&&e.structures?.push(...p.structures),p?.links&&e.links?.push(...p.links));let g=e.structures?.find(({stage:b,stageSequence:S})=>b===ke&&S===1),{qualifiersCount:I}=ry({stageSequence:1,drawDefinition:e,structureId:s,stage:ke}),v=Math.max(f??0,I??0),w=Doe({qualifiersCount:v,drawDefinition:e,stage:ke});if(w.error||(w=UE({drawSize:h,stage:ze,drawDefinition:e}),w.error))return w;LWe({drawDefinition:e,drawEntries:a,event:c});let y=_We({mainStructure:g,qualifyingDetails:m,drawDefinition:e});return y.error?y:{drawDefinition:e,structureId:s}}function LWe({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===ze)){let n={...r,entryStage:r.entryStage??ke,drawDefinition:t,event:i};IV(n)}}function _We({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){for(let r of e||[]){let{finalQualifyingRoundNumber:n,finalQualifyingStructureId:a,roundTarget:s,finishingPositions:o,linkType:l}=r,u=t&&sT({targetStructureId:t.structureId,sourceStructureId:a,sourceRoundNumber:n,finishingPositions:o,targetEntryRound:s,linkType:l})?.link;if(u?.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function Uue(t){let{participantIds:e}=t,i=t.drawDefinition?.entries?.filter(r=>{let n=r.entryStatus;return!t.restrictEntryStatus||mo.includes(n)}).map(wt)??[];if(e){let r=e.filter(n=>!i?.includes(n));if(r?.length)return q({result:{error:Fo},info:{invalidParticipantIds:r}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:re,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:re,info:"roundsCount must be less than 32"}:{participantIds:e}}function Aj(t){let e=[],{roundsCount:i=1,drawDefinition:r,matchUpsCount:n,structureId:a,idPrefix:s,isMock:o,event:l}=t,u,c=Uue(t);if(c.error)return c;for(let d of Ce(1,i+1)){let p=zN({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:r,matchUpsCount:n,structureId:a,roundNumber:u,idPrefix:s,isMock:o,event:l});if(p.error)return q({result:p,info:{iteration:d}});p.matchUps?.length&&e.push(...p.matchUps),u=(p?.roundNumber??1)+1}return{matchUps:e}}function $We(t){let{tournamentRecord:e,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=t,s=t.scaleAccessor??Er[r]?.accessor,o=e.participants??[];for(let l of i??[]){let u=o?.find(d=>d.participantId===l),c=R3({scaleName:`${r}.${P2}`,participant:u,eventType:n});!c&&r&&(c=R3({scaleAccessor:s,participant:u,scaleName:r,eventType:n})),c&&!a[l]&&(a[l]=c)}return a}function R3({scaleType:t=md,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){let a=(i&&su({scaleAttributes:{eventType:n??Yh,scaleType:t,scaleName:r},participant:i}))?.scaleItem?.scaleValue;return e&&Ut(a)?a[e]:a}function kj(t){let e=VWe(t);if(e?.error)return e;let i=Uue(t);if(i.error)return i;let r=BWe(t);if(r.error)return r;let n=$We(t),a=t.tournamentRecord?.isMock??t.isMock,s=t.eventType??t.event?.eventType,o=[],l=[],u;for(let c of Ce(1,(t.roundsCount??1)+1)){let d=uj({...t,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:o,adHocRatings:n,roundNumber:u,eventType:s,isMock:a});if(d.error)return d;let{matchUps:p,...f}=d;f.modifiedScaleValues&&(n=f.modifiedScaleValues),l.push({...f,iteration:c,matchUpsCount:p?.length}),u=(f?.roundNumber??1)+1,p?.length&&o.push(...p)}return{...W,matchUps:o,roundResults:l}}function BWe(t){if(t.structureId)return t.structureId;let e=t.drawDefinition,i=e?.structures?.filter(n=>n.stageSequence===1)?.reduce((n,a)=>{let s=a.stage&&Kh[a.stage];return Yn({structure:a})&&s>(Kh[n?.stage]||1)?a:n},void 0),r=e?.structures?.find(n=>n.structureId===i?.structureId);return r?Yn({structure:r})?{structure:r}:{error:Sh}:{error:yi}}function VWe(t){return t.roundsCount&&typeof t.roundsCount!="number"?{error:re,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==ma?{error:Sh}:!Array.isArray(t.drawDefinition?.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:re,info:"Missing Entries"}:{error:void 0}}function jWe(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:s}=t,o=s?.entries?.filter(({entryStage:c,entryStatus:d})=>(!c||c===ke)&&d&&mo.includes(d)),l=o?.map(wt),u=o?Math.floor(o.length/2):0;if(t.automated)return GWe({...t,participantIds:l});{let c=Aj({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:u,idPrefix:n,isMock:a,event:s});if(c.error)return c;c.matchUps?.length&&VN({matchUps:c.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:r,event:s})}return{...W}}function GWe(t){let{restrictEntryStatus:e,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:s}=t.drawMatic??{},o=kj({...t,eventType:t.drawMatic?.eventType??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:s??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:r,matchUpIds:n});return o.error?o:(o?.matchUps?.length&&VN({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:o.matchUps,event:t.event,structureId:r}),{...W})}function HWe({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,seedsCount:u}){r=r??n;let c=tt({drawDefinition:s,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:yi};let{positionAssignments:p}=fr({structure:d}),f=p?.length||0;if(u>f)return{error:Aie};let h=d.structures?.length,m=ct(o?.groupSeedingThreshold)&&o?.groupSeedingThreshold,g=PV({roundRobinGroupsCount:h,drawSize:f})?.seedGroups,{seedsCount:I}=gT({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:f});return I&&a?.[As]&&u>I&&e&&(u=I),d.seedLimit=u,d.seedAssignments=Ce(1,u+1).map(v=>{let w=g?.find(S=>S.includes(v)),y=w&&Math.min(...w),b=m&&v>=m?y:v;return{participantId:void 0,seedNumber:v,seedValue:b}}),ri({drawDefinition:s,structureIds:[l]}),{...W,seedLimit:u}}function ug({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:s,stage:o}){if(!e)return{error:Ie};a=a??s?.entries??[];let l=a.filter(f=>(!o||!f.entryStage||f.entryStage===o)&&(!n||!f.entryStageSequence||f.entryStageSequence===n)&&mo.includes(f.entryStatus)),u={...i};return{scaledEntries:l.map(f=>{let{participantId:h}=f,{scaleItem:m}=em({tournamentRecord:e,scaleAttributes:i,participantId:h});return{...f,...m}}).filter(f=>{let h=f.scaleValue;return!r&&(Number.isNaN(h)||!Number.parseFloat(h))?!1:h}).sort(r||(t||u?.ascending===!1?d:c))};function c(f,h){return p(f)-p(h)}function d(f,h){return p(h)-p(f)}function p(f){return Number.parseFloat(f.scaleValue||(t?-1:1e5))}}function Tue(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=so({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r?.find(({structureId:f})=>!n.includes(f));if(!a)return q({result:{error:yi},stack:e});let s=a?.structureId,{seedsCount:o,stageEntries:l,seedLimit:u}=QWe({...t,structureId:s});(t.seededParticipants||t.event||t.seedingScaleName)&&qWe({...t,seedsCount:o,structure:a,structureId:s});let c=t.automated!==!1&&t.drawType!==ma&&!(t.qualifyingOnly&&t.stage!==ze),d=(r?.length||0)>1,p=c?zWe({...t,multipleStructures:d,seedLimit:u,structureId:s}):{};return p?.error?q({result:p,stack:e}):{...p,stageEntries:l,structureId:s,seedsCount:o}}function WWe({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{let a=rt({name:xl,element:n})?.extension?.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!a||a===r)&&Cf.includes(n.entryStatus)})}function zWe(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=aT({...t,seedsOnly:e});if(i.error)return i;let r=i?.positionAssignments,n=i?.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function qWe(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(wt);e?YWe({...t,enteredParticipantIds:a}):(n||i)&&KWe({...t,enteredParticipantIds:a})}function YWe(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,structure:u,event:c}=t,d=u?ng({provisionalPositioning:e,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structure:u}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,f)=>p.seedNumber<f.seedNumber?-1:p.seedNumber<f.seedNumber?1:0).forEach(p=>{let{participantId:f,seedNumber:h,seedValue:m}=p;ay({provisionalPositioning:e,tournamentRecord:n,drawDefinition:s,seedingProfile:o,participantId:f,seedBlockInfo:d,structureId:l,seedNumber:h,seedValue:m,event:c})})}function KWe(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:s,drawDefinition:o,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:f}=d?.category||{};d?.eventType;let h=XWe({...t})||l&&JWe({...t}),m=h?.length??0;m<e&&(e=m),h?.filter(({participantId:g})=>r.includes(g)).slice(0,a||e).forEach((g,I)=>{let v=I+1,{participantId:w,scaleValue:y}=g,b=n?.[v]||y||v;ay({provisionalPositioning:i,tournamentRecord:s,drawDefinition:o,seedingProfile:u,participantId:w,structureId:c,seedNumber:v,seedValue:b,event:d})})}function XWe(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:s}=t,{categoryName:o,ageCategoryCode:l}=s?.category||{},u=s?.eventType,c={scaleName:i||o||l||s.eventId,scaleType:nu,eventType:u};return ug({scaleAttributes:c,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function JWe(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:s,ageCategoryCode:o}=r?.category||{},l=r?.eventType;return ug({scaleAttributes:{scaleName:s||o,scaleType:Ru,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function QWe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=WWe(t);e>i.length&&(e=i.length);let{seedLimit:r}=HWe({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function ZWe(t){let e=oj({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:s,seedingProfile:o,participants:l,drawEntries:u,placeByes:c,drawSize:d,drawType:p,entries:f}=t,h=[],m=[],g=eze({ignoreStageSpace:n,drawDefinition:i,drawEntries:u,drawType:p,entries:f});if(g.error)return g;let I=p===Tf?0:Ke(t.seedsCount??0),v=Tue({...t,qualifyingOnly:!d||s,appliedPolicies:a,drawDefinition:i,seedingProfile:o,participants:l,stage:ke,seedsCount:I,placeByes:c,drawSize:d,entries:f});if(v.error&&!v.conflicts)return v;v.positioningReport?.length&&h.push({[ke]:v.positioningReport});let w=v.structureId;return v.conflicts&&(m=v.conflicts),p===ma&&t.roundsCount&&jWe({...t,drawDefinition:i,structureId:w}),{drawDefinition:i,positioningReports:h,conflicts:m,structureId:w}}function eze(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let s of a){if(r&&s.entryStage&&s.entryStage!==ke)continue;let o={...s,ignoreStageSpace:e??n===ma,entryStage:s.entryStage??ke,event:t.event,drawDefinition:i,drawType:n},l=IV(o);if(r&&l.error)return l}return{error:void 0}}var tze=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),ize=tze;function rze(t){let{drawId:e=Et(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=ize();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function Oj(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:s,event:o}=t,l=He(t,[{[vn]:!0,[b2]:!0}]);if(l.error)return l;if(!qa({matchUpFormat:n}))return{error:IU};let u="setMatchUpFormat";if(s){let c=hi({drawDefinition:r,matchUpId:s,event:o});if(c.error)return c;let d=c.matchUp;if(d?.matchUpType===lr)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:fa};d&&(d.matchUpFormat=n,Dt({tournamentId:i?.tournamentId,eventId:o?.eventId,context:u,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if(o?.eventType===lr)return{error:bu};for(let c of e){let d=tt({drawDefinition:r,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if(o?.eventType===lr)return{error:bu};let c=tt({drawDefinition:r,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),ri({drawDefinition:r,structureIds:e}),{...W}}function nze({tieFormat:t}){let e=qn({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Et());return{tieFormat:t}}function aze({existingQualifyingStructures:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUpType:n,tieFormat:a,event:s}){if((r||a)&&!(r&&s?.matchUpFormat===r||s?.tieFormat&&a&&JSON.stringify(s.tieFormat)===JSON.stringify(a))){if(a){let o=nze({tieFormat:a});if(o.error)return o;let l=t?.every(u=>u.tieFormat);(!t?.length||l)&&(i.tieFormat=o.tieFormat??a)}else if(r){let o=Oj({tournamentRecord:e,drawDefinition:i,matchUpFormat:r,event:s});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(i.matchUpType=n)}return{error:void 0}}var Due={};ft(Due,{attachPolicies:()=>ef,findPolicy:()=>Ef,getAppliedPolicies:()=>Ct,getPolicyDefinitions:()=>Kc,mutate:()=>Pue,query:()=>Rue,removePolicy:()=>Eue});var Pue={};ft(Pue,{attachPolicies:()=>ef,removePolicy:()=>Eue});function Eue(t){let e=He(t,[{[P_e]:!0,_anyOf:{[fn]:!1,[gr]:!1,[vn]:!1,[qc]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return C3(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:Ie};for(let a of n){let s=t.tournamentRecords[a],o=C3(t,s);if(o.error)return o;i=!0}}else return{error:Ie};return i?{...W}:{error:vU}}function C3(t,e){let i=Ct(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?It({element:e,extension:{name:gw,value:i}}):On({element:e,name:gw}),{...W}):{error:vU}}var Rue={};ft(Rue,{findPolicy:()=>Ef,getAppliedPolicies:()=>Ct,getPolicyDefinitions:()=>Kc});var Cue={[As]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Pu]:{positioning:qp},[no]:{positioning:qp}},positioning:Jne},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},PF=Cue;function sze({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return q({info:"policyDefinitions must be an object",result:{error:re},stack:r});let n={[mw]:t?.[mw]};return e?oze({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&ef({drawDefinition:i,policyDefinitions:n}),!t?.[As]&&!e?.[As]&&(ef({policyDefinitions:PF,drawDefinition:i}),t&&Object.assign(t,PF)),{error:void 0}}function oze({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e?.[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(ef({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function lze(t){let{tournamentRecord:e,policyDefinitions:i,appliedPolicies:r,matchUpFormat:n,matchUpType:a,tieFormat:s,drawType:o,stack:l,event:u}=t,c=t.drawId?u?.drawDefinitions?.find(I=>I.drawId===t.drawId):void 0,d=c?.structures?.find(I=>I.stage===ke&&I.stageSequence===1)?.structureId,p=c?c.structures?.filter(I=>I.stage===ze):[],f=p?.length===1&&!p[0].matchUps?.length&&p[0].structureId;c&&o!==c.drawType&&(c.drawType=o);let h=c??rze({processCodes:t.processCodes,drawId:t.drawId,drawType:o}),m=aze({existingQualifyingStructures:p,tournamentRecord:e,drawDefinition:h,matchUpFormat:n,matchUpType:a,tieFormat:s,event:u});if(m.error)return q({result:m,stack:l});let g=sze({appliedPolicies:r,policyDefinitions:i,drawDefinition:h,stack:l});return g.error?g:{drawDefinition:h,structureId:d,existingDrawDefinition:c,existingQualifyingPlaceholderStructureId:f}}function uze(t){let e="generateOrGetExisting",i=[],r=[],n=lze(t);if(n.error)return q({result:n,stack:e});let a=n.existingDrawDefinition,s,o,l=t.drawEntries??t.eventEntries??[],u=n.existingQualifyingPlaceholderStructureId&&FWe({...t,...n})||ZWe({...t,...n,entries:l});return u.error?q({result:u,stack:e}):(u.positioningReports?.length&&i.push(...u.positioningReports??[]),u.conflicts?.length&&r.push(...u.conflicts??[]),s=u.drawDefinition,o=u.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:s,structureId:o,conflicts:r,entries:l})}function cze(t){let{qualifyingPlaceholder:e,existingDrawDefinition:i,positioningReports:r,qualifyingProfiles:n,appliedPolicies:a,qualifyingOnly:s,drawDefinition:o,seedingProfile:l,participants:u,structureId:c,tieFormat:d,entries:p,stack:f}=t,h=e&&!n?.length&&!i,m=[];if(n){let g=(y,b)=>y.stageSequence-b.stageSequence,I=(y,b)=>y.roundTarget-b.roundTarget,v=[],w=1;n.sort(I);for(let y of n){if(!Array.isArray(y.structureProfiles))return q({info:Zp("structureProfiles"),result:{error:Je},stack:f});w=y.roundTarget||w;let b=y.structureProfiles?.sort(g)||[],S=1;for(let U of b){let{qualifyingRoundNumber:T,qualifyingPositions:D,seededParticipants:P,seedingScaleName:E,seedsCount:R=0,seedByRanking:C,placeByes:M,drawSize:N}=U,A=Tue({...t,seedingProfile:U.seedingProfile??l,stageSequence:S,qualifyingRoundNumber:T,preparedStructureIds:v,qualifyingPositions:D,seededParticipants:P,stage:ze,seedingScaleName:E,appliedPolicies:a,drawDefinition:o,qualifyingOnly:s,seedByRanking:C,participants:u,roundTarget:w,seedsCount:R,placeByes:M,drawSize:N,entries:p});if(A.error)return A;A.structureId&&v.push(A.structureId),S+=1,A.conflicts?.length&&m.push(...A.conflicts),A.positioningReport?.length&&r.push({[ze]:A.positioningReport})}w+=1}}else if(c&&h){let g=cs({structureName:Zr(ze),stage:ze,qualifyingOnly:s,tieFormat:d}),{link:I}=sT({sourceStructureId:g.structureId,targetStructureId:c,sourceRoundNumber:0,linkType:Uu});o.structures||(o.structures=[]),o.structures.push(g),o.links||(o.links=[]),o.links.push(I)}return{qualifyingConflicts:m,error:void 0}}var Mue={};ft(Mue,{addGoesTo:()=>Qp,allCompetitionMatchUps:()=>_o,allDrawMatchUps:()=>xn,allEventMatchUps:()=>Gu,allPlayoffPositionsFilled:()=>kV,allTournamentMatchUps:()=>Tr,analyzeDraws:()=>pT,analyzeMatchUp:()=>Pw,analyzeTournament:()=>Wj,bulkUpdatePublishedEventIds:()=>Xj,calculateWinCriteria:()=>cg,categoryCanContain:()=>TU,checkMatchUpIsComplete:()=>Dp,checkValidEntries:()=>WN,cleanExpiredMutationLocks:()=>Vj,compareTieFormats:()=>xc,competitionScheduleMatchUps:()=>wT,courtGridRows:()=>fA,credits:()=>dze,drawMatchUps:()=>cG,eventMatchUps:()=>gA,filterMatchUps:()=>rc,filterParticipants:()=>eT,findDrawDefinition:()=>tj,findExtension:()=>rt,findVenue:()=>go,getAggregateTeamResults:()=>Hj,getAllDrawMatchUps:()=>nr,getAllEventData:()=>Jj,getAllStructureMatchUps:()=>Ot,getAllowedDrawTypes:()=>aA,getAllowedMatchUpFormats:()=>Bj,getAppliedPolicies:()=>Ct,getAssignedParticipantIds:()=>Af,getAvailableMatchUpsCount:()=>jN,getAvailablePlayoffProfiles:()=>lT,getCategoryAgeDetails:()=>zp,getCheckedInParticipantIds:()=>Zm,getCompetitionDateRange:()=>oA,getCompetitionMatchUps:()=>Dw,getCompetitionParticipants:()=>xj,getCompetitionPenalties:()=>jj,getCompetitionVenues:()=>fT,getCourtInfo:()=>TN,getCourts:()=>dG,getDrawData:()=>GN,getDrawDefinitionTimeItem:()=>X2,getDrawParticipantRepresentativeIds:()=>ZV,getDrawStructures:()=>so,getDrawTypeCoercion:()=>mT,getEligibleVoluntaryConsolationParticipants:()=>QV,getEntriesAndSeedsCount:()=>hA,getEvent:()=>hG,getEventData:()=>hT,getEventMatchUpFormatTiming:()=>tG,getEventProperties:()=>pG,getEventPublishStatus:()=>Fa,getEventStructures:()=>kN,getEventTimeItem:()=>_U,getEvents:()=>fG,getFlightProfile:()=>Vi,getHomeParticipantId:()=>aG,getLinkedTournamentIds:()=>OU,getMatchUpCompetitiveProfile:()=>qU,getMatchUpContextIds:()=>sG,getMatchUpDailyLimits:()=>vA,getMatchUpDailyLimitsUpdate:()=>iG,getMatchUpDependencies:()=>Io,getMatchUpFormat:()=>oG,getMatchUpFormatTiming:()=>YU,getMatchUpFormatTimingUpdate:()=>eG,getMatchUpScheduleDetails:()=>DN,getMatchUpType:()=>PN,getMatchUpsMap:()=>xr,getMatchUpsStats:()=>lG,getMatchUpsToSchedule:()=>uA,getMaxEntryPosition:()=>Zj,getModifiedMatchUpFormatTiming:()=>mA,getMutationLocks:()=>Yj,getPairedParticipant:()=>oo,getParticipantEventDetails:()=>Fj,getParticipantIdFinishingPositions:()=>ej,getParticipantMembership:()=>Lj,getParticipantResults:()=>ZU,getParticipantScaleItem:()=>em,getParticipantSchedules:()=>_j,getParticipantSignInStatus:()=>$j,getParticipantTimeItem:()=>J2,getParticipants:()=>Ei,getPersonRequests:()=>kf,getPolicyDefinitions:()=>Kc,getPositionAssignments:()=>GI,getPositionsPlayedOff:()=>oy,getPredictiveAccuracy:()=>nG,getProfileRounds:()=>pA,getPublishState:()=>ig,getRandomQualifierList:()=>nj,getRoundMatchUps:()=>Un,getRounds:()=>uG,getScaleValues:()=>Yv,getScaledEntries:()=>ug,getScheduledRoundsDetails:()=>vT,getSchedulingProfile:()=>Qc,getSchedulingProfileIssues:()=>Qj,getSeedingThresholds:()=>EV,getSeedsCount:()=>gT,getStructureSeedAssignments:()=>ys,getTeamLineUp:()=>Jp,getTieFormat:()=>lA,getTimeItem:()=>Ps,getTournamentIds:()=>AU,getTournamentInfo:()=>lg,getTournamentPenalties:()=>sA,getTournamentPersons:()=>Gj,getTournamentPoints:()=>uy,getTournamentPublishStatus:()=>iy,getTournamentStructures:()=>AV,getTournamentTimeItem:()=>vN,getValidGroupSizes:()=>rT,getVenueData:()=>VI,getVenuesAndCourts:()=>Hu,isAdHoc:()=>Yn,isCompletedStructure:()=>Au,isValidForQualifying:()=>aj,isValidMatchUpFormat:()=>qa,matchUpActions:()=>HN,participantScaleItem:()=>su,participantScheduledMatchUps:()=>rG,positionActions:()=>rj,publicFindCourt:()=>uV,publicFindVenue:()=>lV,tallyParticipantResults:()=>tg,tieFormatGenderValidityCheck:()=>YM,tournamentMatchUps:()=>IA,validMatchUp:()=>yN,validMatchUps:()=>is,validateCollectionDefinition:()=>DU,validateLineUp:()=>AN});function dze(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Miro, Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var Nue={};ft(Nue,{filterParticipants:()=>eT,getCompetitionParticipants:()=>xj,getPairedParticipant:()=>oo,getParticipantEventDetails:()=>Fj,getParticipantMembership:()=>Lj,getParticipantScaleItem:()=>em,getParticipantSchedules:()=>_j,getParticipantSignInStatus:()=>$j,getParticipantTimeItem:()=>J2,getParticipants:()=>Ei,getScaleValues:()=>Yv,participantScaleItem:()=>su,validateLineUp:()=>AN});function xj(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Ci};let i=[],r={},n={},a={},s=[],o={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:f,matchUps:h,derivedEventInfo:m,derivedDrawInfo:g}=Ei({...t,tournamentRecord:u});Object.assign(o,d),Object.assign(r,p),Object.assign(n,m),Object.assign(a,g),i.push(...f??[]),s.push(...h??[]),c?.forEach(I=>{l.includes(I)||l.push(I)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:o,participants:i,...W,matchUps:s}}function Fj({tournamentRecord:t,participantId:e}){if(!t)return{error:Ie};if(!e)return{error:pr};let i=[e].concat((t.participants??[]).filter(r=>r?.participantType&&[$t,mt].includes(r.participantType)&&r.individualParticipantIds?.includes(e)).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=(r?.entries??[]).map(a=>a.participantId);return $n(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function Lj({tournamentRecord:t,participantId:e}){if(!t)return{error:Ie};if(!e)return{error:pr};let{participants:i}=Ei({participantFilters:{participantTypes:[$t,mt,ts]},tournamentRecord:t});return(i??[]).filter(r=>r.individualParticipantIds?.includes(e)).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function _j({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:Ie};if(typeof t!="object")return{error:zc,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=Tr({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),s=Io({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],o={};for(let l of a){let{sides:u}=l,c,d=u?.map(f=>{if(f.participant)return[f.participant].concat(...f.participant.individualParticipants||[]);s[l.matchUpId]&&!c&&(c=(s[l.matchUpId]||[]).map(h=>n[h]).filter(({winningSide:h,bye:m})=>!h&&!m))}).filter(Boolean).flat()??[];for(let f of d){let{participantId:h}=f;o[h]||(o[h]={potentialMatchUps:[],participant:f,matchUps:[]}),o[h].matchUps.push(l)}let p=c?.map(({sides:f})=>f).flat().map(({participant:f})=>f&&[f].concat(...f.individualParticipants||[])).filter(Boolean).flat()||[];for(let f of p){let{participantId:h}=f;o[h]||(o[h]={potentialMatchUps:[],participant:f,matchUps:[]}),o[h].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(o).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...W}}function $j({tournamentRecord:t,participantId:e}){if(!t)return{error:Ie};if(!e)return{error:pr};let{participant:i}=ip({tournamentRecord:t,participantId:e});if(!i)return{error:Gi};let{timeItem:r}=Ps({itemType:LU,element:i});return r&&r.itemValue===Iw&&Iw}var Aue={};ft(Aue,{analyzeDraws:()=>pT,analyzeTournament:()=>Wj,cleanExpiredMutationLocks:()=>Vj,getAggregateTeamResults:()=>Hj,getAllowedDrawTypes:()=>aA,getAllowedMatchUpFormats:()=>Bj,getAppliedPolicies:()=>Ct,getCompetitionDateRange:()=>oA,getCompetitionPenalties:()=>jj,getMutationLocks:()=>Yj,getPolicyDefinitions:()=>Kc,getTournamentInfo:()=>lg,getTournamentPenalties:()=>sA,getTournamentPersons:()=>Gj,getTournamentPoints:()=>uy,getTournamentStructures:()=>AV,getTournamentTimeItem:()=>vN});function Bj({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:Ie};let{appliedPolicies:r}=Ct({tournamentRecord:t});return(r?.[vs]?.matchUpFormats||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function aA({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:Ie};let{appliedPolicies:r}=Ct({tournamentRecord:t});return(r?.[cE]?.allowedDrawTypes||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function Vj(t){let{tournamentRecord:e}=t;if(!e)return{error:Ie};let i=new Date().toISOString(),r=0,n=o=>{let{extension:l}=rt({element:o,name:En});if(!l?.value?.locks?.length)return;let u=l.value,c=u.locks.length;u.locks=u.locks.filter(p=>p.expiresAt===null||p.expiresAt>i);let d=c-u.locks.length;d>0&&(r+=d,It({element:o,extension:{name:En,value:u},creationTime:!1}))};n(e);let a=e.events??[];for(let o of a){n(o);let l=o.drawDefinitions??[];for(let u of l)n(u)}let s=e.venues??[];for(let o of s)n(o);return{...W,removedCount:r}}function sA({tournamentRecord:t}){if(!t)return{error:Ie};let e=(t?.participants??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:s}=a||{};i[s]?i[s].participants.push(n):i[s]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function jj({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let e=[];for(let i of Object.values(t)){let{penalties:r}=sA({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function oA({tournamentRecords:t}){if(!Ut(t))return{error:Ci};let e=Object.keys(t??{}).reduce((n,a)=>{let s=t[a],{tournamentInfo:{startDate:o,endDate:l}}=lg({tournamentRecord:s}),u=o&&Ze(o),c=u&&new Date(u);(!n.startDate||c&&c<n.startDate)&&(n.startDate=c);let d=l&&Ze(l),p=d&&new Date(d);return(!n.endDate||p&&p>n.endDate)&&(n.endDate=p),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&Ze(e.startDate.toISOString()),r=e.endDate&&Ze(e.endDate.toISOString());return!i||!r?{error:ere}:{startDate:i,endDate:r}}function Gj({tournamentRecord:t,participantFilters:e}){if(!t)return{error:Ie};let i=t.participants||[];e&&(i=eT({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:s}=a.person;r[s]?r[s].participantIds.push(a.participantId):r[s]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function Hj(t){let e=He(t,[{[gr]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},r={},n=d=>{let p=d?.individualParticipants?.map(f=>f.teams?.length===1&&f.teams[0]);return d?.teams?.length===1&&d?.teams?.[0]||p?.[0].participantId===p?.[1].participantId&&p?.[0]},{matchUps:a,participants:s}=Ei({participantFilters:{participantTypes:[yt]},withRankingProfile:!0,withStatistics:!0,...t});for(let d of s??[]){if(d.participantType===Gn)continue;d.draws?.[0]?.drawId==="draw-0-3"&&console.log(d.participantType,d.draws[0].finishingPositionRange);let p=n(d);if(p)for(let f of d?.draws??[]){let h=f?.finishingPositionRange?.join("-");if(h&&i?.[h]){let m=p?.participantId,g=f?.drawId,I=`${m}|${g}|${h}`;r[I]=i[h]}}}let o=d=>({teamName:d,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(d,p,f)=>{d[p]===void 0&&(d[p]=0),d[p]+=f},u={},c={};for(let d of a??[]){let{sides:p,matchUpFormat:f}=d,h=f&&Xi(f);if(p?.length===2&&h.setFormat?.timed&&(!h.finalSetFormat||h.finalSetFormat?.timed))for(let m of p){let g=n(m.participant),I=g?.participantId,v=m.participant?.participantId,w=g?.participantName,y=m.sideNumber,b=m.participant?.individualParticipantIds||v&&[v]||[];if(b.forEach(S=>{S&&!u[S]&&(u[S]=o(w))}),I&&y){c[I]||(c[I]=o(w));let S=[...b.map(T=>u[T]),c[I]];d.winningSide&&(y===d.winningSide?S.forEach(T=>l(T,"win",1)):S.forEach(T=>l(T,"loss",1)));let U=d.score?.sets||[];for(let T of U){let D=T?.[`side${3-y}Score`]||0,P=T?.[`side${y}Score`]||0,E=P-D;S.forEach(R=>l(R,"pointsPlayed",P+D)),S.forEach(R=>l(R,"points",P)),S.forEach(R=>l(R,"diff",E))}}}}for(let d of Object.keys(r)){let[p]=d.split("|");c[p]&&(c[p].bonus+=r[d],c[p].pointsPct=parseFloat((c[p].points/c[p].pointsPlayed).toFixed(2)),c[p].standingPoints=c[p].win+c[p].bonus)}for(let d of Object.keys(u))u[d].pointsPct=parseFloat((u[d].points/u[d].pointsPlayed).toFixed(2));return{...W,individualResults:u,teamResults:c}}function pze(t){let e=t.participants?.filter(({participantType:a})=>a===$t)?.length===2,i=t.events?.length===1&&t.events[0],r=i?.drawDefinitions?.length===1&&i.drawDefinitions[0],n=(r?.structures?.length===1&&r.structures[0])?.positionAssignments?.length===2;return!!(i.tieFormat&&e&&n)}function Wj({tournamentRecord:t}){if(!t)return{error:Ie};let{drawsAnalysis:e}=pT({tournamentRecord:t}),i={isDual:pze(t),drawsAnalysis:e},r=Ei({tournamentRecord:t});return r.missingParticipantIds?.length&&(i.missingParticipantIds=r.missingParticipantIds),{...W,analysis:i}}function Gg(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function zj({qualityWinProfiles:t,wonMatchUpIds:e,mappedMatchUps:i,participantSideMap:r,tournamentParticipants:n,tournamentStartDate:a,level:s}){let o=0,l=[],u={};for(let c of n)u[c.participantId]=c;for(let c of t){let{rankingScaleName:d,rankingSnapshot:p="latestAvailable",includeWalkovers:f=!1,rankingRanges:h=[],maxBonusPerTournament:m,unrankedOpponentBehavior:g="noBonus"}=c,I=0;for(let v of e){let w=i[v];if(!w)continue;let{matchUpStatus:y,sides:b=[],winningSide:S}=w;if(!f&&(y===si||y===Yt))continue;let U=r[v];if(!U||S!==U)continue;let T=b.find(R=>R.sideNumber!==U)?.participantId;if(!T)continue;let D=u[T];if(!D)continue;let P=fze({participant:D,rankingScaleName:d,rankingSnapshot:p,tournamentStartDate:a});if(!P){if(g==="noBonus")continue;continue}let E=h.find(R=>P>=R.rankRange[0]&&P<=R.rankRange[1]);if(E){let R;if(typeof E.value=="number")R=E.value;else if(typeof E.value=="object"){let C=Gg(s,E.value.level??E.value);typeof C=="number"&&(R=C)}R&&(I+=R,l.push({opponentParticipantId:T,opponentRank:P,points:R,matchUpId:v}))}}m!==void 0&&I>m&&(I=m),o+=I}return{qualityWinPoints:o,qualityWins:l}}function fze({participant:t,rankingScaleName:e,rankingSnapshot:i,tournamentStartDate:r}){let n=(t.timeItems||[]).filter(o=>{if(!o?.itemType)return!1;let l=o.itemType.split(".");return l[0]===Rd&&l[1]===Ru&&l[3]===e});if(!n.length)return;let a=n;if(i==="tournamentStart"&&r){let o=new Date(r).getTime();a=n.filter(l=>(l.itemDate?new Date(l.itemDate).getTime():0)<=o)}if(!a.length)return;a.sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0));let s=a[a.length-1]?.itemValue;return typeof s=="number"?s:void 0}var hze="RANKING_POINTS",mze="QUALITY_WIN",gze="fullToEach",kue="splitEven",Ize="teamOnly",Oue=["ageCategoryCodes","genders","categoryNames","categoryTypes","ratingTypes","ballTypes","wheelchairClasses","subTypes"],xue=["eventTypes","drawTypes","drawSizes","maxDrawSize","stages","stageSequences","levels","maxLevel","flights","maxFlightNumber","participationOrder","dateRanges"],vze={RANKING_POINTS:hze,QUALITY_WIN:mze,FULL_TO_EACH:gze,SPLIT_EVEN:kue,TEAM_ONLY:Ize,CATEGORY_SCOPE_FIELDS:Oue,PROFILE_SCOPE_FIELDS:xue};function qj(t){let{participation:e={},awardProfiles:i,wheelchairClass:r,startDate:n,eventType:a,drawSize:s,drawType:o,category:l,endDate:u,gender:c,level:d}=t,{participationOrder:p,flightNumber:f,rankingStage:h}=e,m=b=>!n&&!u||!b.dateRanges?!0:b.dateRanges.some(S=>{let U=!n||!S.startDate||new Date(n)>new Date(S.startDate),T=!u||!S.endDate||new Date(u)<=new Date(S.endDate);return U&&T}),g=b=>{if(!b)return!0;let S=l||{};return!(b.ageCategoryCodes?.length&&!b.ageCategoryCodes.includes(S.ageCategoryCode)||b.genders?.length&&!b.genders.includes(c)||b.categoryNames?.length&&!b.categoryNames.includes(S.categoryName)||b.categoryTypes?.length&&!b.categoryTypes.includes(S.type)||b.ratingTypes?.length&&!b.ratingTypes.includes(S.ratingType)||b.ballTypes?.length&&!b.ballTypes.includes(S.ballType)||b.wheelchairClasses?.length&&!b.wheelchairClasses.includes(r)||b.subTypes?.length&&!b.subTypes.includes(S.subType))},I=b=>m(b)&&(!b.maxFlightNumber||f<=b.maxFlightNumber)&&(!b.drawTypes?.length||b.drawTypes?.includes(o))&&(!b.drawSizes?.length||b.drawSizes.includes(s))&&(!b.stages?.length||b.stages.includes(h))&&(!b.levels?.length||b.levels.includes(d))&&(!b.maxDrawSize||s<=b.maxDrawSize)&&(!b.drawSize||b.drawSize===s)&&(!b.maxLevel||d<=b.maxLevel)&&(!f||!b.flights?.flightNumbers?.length||b.flights.flightNumbers.includes(f))&&(!b.participationOrder||b.participationOrder===p)&&g(b.category)&&(!b.eventTypes?.length||b.eventTypes?.includes(a)),v=i.filter(I);if(v.length===0)return{awardProfile:void 0};if(v.length===1)return{awardProfile:v[0]};let w=v.filter(b=>b.priority!==void 0);if(w.length){let b=Math.max(...w.map(S=>S.priority));return{awardProfile:w.find(S=>S.priority===b)}}let y=v.map((b,S)=>({profile:b,score:yze(b),index:S}));return y.sort((b,S)=>S.score-b.score||b.index-S.index),{awardProfile:y[0].profile}}function yze(t){let e=0;for(let i of xue){let r=t[i];if(r!=null){if(Array.isArray(r)&&r.length===0)continue;e+=1}}if(t.category)for(let i of Oue){let r=t.category[i];Array.isArray(r)&&r.length>0&&(e+=1)}return e}function RE({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){let s=(h,m)=>{if(h){if(Array.isArray(m)){let g=m.find(I=>I.flight===h||I.f===h);return g.value||g.v}if(typeof m=="object"){let g=m.flights||m.f;if(Array.isArray(g))return g[h-1]}}},o=(h,m)=>{let g=h?.value||h?.v||(ct(h)?h:0),I=Gg(a,h?.level);return{value:s(m,I)||ct(I)&&I||g}},l=0,u,c,d,p,f=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let h=i.find(I=>I.drawSize===r||I.drawSizes?.includes(r)),m=i.find(I=>I.drawSize&&I.threshold&&r>I.drawSize),g=i.find(I=>!I.drawSize&&!I.drawSizes?.length);f!==void 0&&(h=h?.[f],m=m?.[f],g=g?.[f]),c=o(h,e).value,d=o(m,e).value,p=o(g,e).value,l=c||d||p,u=c&&h.requireWin||d&&m.requireWin||g?.requireWin}else if(typeof i=="object"){let h=i?.drawSizes?.[r],m=i;f!==void 0&&(h=h?.[f],m=m?.[f]),c=o(h,e).value,p=o(m,e).value,l=c||p,u=c?h.requireWin:m?.requireWin}else ct(i)&&f===void 0&&(l=i);return e&&n?.pct?.[e]&&(l=Math.round(l*n.pct[e])),{awardPoints:l,requireWin:u}}function uy({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){if(!i)return{error:Ie};let n=ha(),{policyDefinitions:a}=Kc({policyTypes:[kD],tournamentRecord:i}),s=e?.[kD]??a?.[kD];if(!s)return{error:OM};let o=s.awardProfiles,l=s.requireWinFirstRound,u=s.requireWinForPoints,c=s.doublesAttribution,d=s.qualityWinProfiles,{participants:p,derivedEventInfo:f,derivedDrawInfo:h,mappedMatchUps:m}=Ei({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),g=p?.filter(S=>S.draws?.length),I={},v={};for(let S of i.participants||[])S.person?.personId&&(I[S.participantId]=S.person.personId),S.individualParticipantIds?.length&&(v[S.participantId]=S.individualParticipantIds);let w={},y={},b={};for(let S of g??[]){let{participantType:U,participantId:T,person:D,draws:P}=S;for(let E of P){let{drawId:R,structureParticipation:C,eventId:M}=E,N=f[M],A=h[R],O=A?.drawType,{category:k,eventType:F,gender:x,wheelchairClass:L}=N||{},$=E.startDate||N.startDate||i.startDate,V=E.endDate||N.endDate||i.endDate;if(F===Ca&&U!==Gn)continue;let _;if(o){let B=u,G=0,j=0,Y=0,K=0,X,Z,Q=0,ae,te,ne;for(let le of C){let{finishingPositionRange:de,participationOrder:pe,participantWon:ve,flightNumber:Me,rankingStage:Ee,winCount:Be}=le;if(G+=Be||0,Array.isArray(de)&&de.length){let ce=Math.min(...de);(te===void 0||ce<te)&&(te=ce)}let fe=A?.drawSize,{awardProfile:Te}=qj({wheelchairClass:L,awardProfiles:o,participation:le,eventType:F,startDate:$,category:k,drawSize:fe,drawType:O,endDate:V,gender:x,level:r});if(Te){if(!fe)continue;if(Te.profileName&&(Z=Te.profileName),ne||(ne=Te),ae===void 0&&Te.maxCountableMatches!==void 0){let ee=Te.maxCountableMatches;if(typeof ee=="number")ae=ee;else if(typeof ee=="object"){let Se=Gg(r,ee.level??ee);typeof Se=="number"&&(ae=Se)}}let ce=Array.isArray(de)&&Math.max(...de),be=lt(de||[]).join("-"),we=ce&&Ee!==ze&&de?.includes(fe);Te.requireWinForPoints!==void 0&&(B=Te.requireWinForPoints),Te.requireWinFirstRound!==void 0&&(l=Te.requireWinFirstRound);let{finishingPositionPoints:Ae={},finishingPositionRanges:ye,finishingRound:Ne,pointsPerWin:he,flights:De}=Te,Le=Array.isArray(Te.perWinPoints)?Te.perWinPoints?.find(ee=>ee.participationOrders?.includes(pe)):Te.perWinPoints,J=Ae.participationOrders,se=0,oe;if((!J||J.includes(pe))&&ye&&ce){let ee=ye[ce];ee&&({awardPoints:se,requireWin:oe}=RE({flightNumber:Me,valueObj:ee,drawSize:fe,flights:De,level:r}))}if(!se&&Ne&&pe===1&&ce){let ee=Ne[ce];ee&&({awardPoints:se,requireWin:oe}=RE({participantWon:ve,flightNumber:Me,valueObj:ee,drawSize:fe,flights:De,level:r}))}we&&l!==void 0&&(B=l),oe!==void 0&&(B=oe),se>j&&(!B||Be)&&(j=se,X=ce,ne=Te);let ue=ae!==void 0?Math.min(Be||0,Math.max(0,ae-Q)):Be;if(!se&&he&&ue&&(Y+=ue*he,Q+=ue,X=be),!se&&Be&&Le){let ee=Gg(r,Le?.level);typeof ee=="number"?(Y+=(ue||0)*ee,Q+=ue||0):!ee&&Le.value&&(Y+=(ue||0)*Le.value,Q+=ue||0)}}if(U===Gn&&Te){let ce=Array.isArray(Te.perWinPoints)?Te.perWinPoints?.find(we=>we.participationOrders?.includes(pe)):Te.perWinPoints,be=ce&&Gg(r,ce.level);if(be){let we=(S.matchUps||[]).filter(({structureId:Ae})=>Ae===le.structureId);for(let{matchUpId:Ae}of we){let ye=m[Ae],Ne=ye?.sides?.find(he=>he.participantId===T)?.sideNumber;if(!(!Ne||ye.winningSide!==Ne))for(let he of ye.tieMatchUps||[]){if(!he.winningSide)continue;let{collectionPosition:De}=he,Le;if(typeof be=="object"&&be.line){if(be.limit&&De>be.limit)continue;Le=be.line[De-1]}else typeof be=="number"&&(Le=be);if(Le)for(let J of he.sides||[]){if(J.sideNumber!==he.winningSide)continue;let se=J.participantId;if(!se)continue;let oe=v[se]||[se];for(let ue of oe){let ee=I[ue];ee&&(w[ee]||(w[ee]=[]),w[ee].push({linePoints:Le,collectionPosition:De,eventType:F,drawId:R}))}}}}}}}if(ne?.bonusPoints&&te!==void 0){for(let le of ne.bonusPoints)if(le.finishingPositions?.includes(te)){let de=le.value;if(typeof de=="number")K=de;else if(typeof de=="object"){let pe=Gg(r,de.level??de);typeof pe=="number"&&(K=pe)}break}}if(_=j+Y+K,Y||j||K){let le={winCount:G,positionPoints:j,rangeAccessor:X,perWinPoints:Y,bonusPoints:K,eventType:F,drawId:R,points:_,category:k,drawType:O,startDate:$,endDate:V,level:r};n&&Z&&(le.profileName=Z);let de=D?.personId;if(de)w[de]||(w[de]=[]),w[de].push(le);else if(U===mt){if(b[T]||(b[T]=[]),b[T].push(le),c){let pe=c===kue?.5:1,ve=v[T]||[];for(let Me of ve){let Ee=I[Me];if(!Ee)continue;let Be={...le,points:Math.round(le.points*pe),positionPoints:Math.round(le.positionPoints*pe),perWinPoints:Math.round(le.perWinPoints*pe),bonusPoints:Math.round(le.bonusPoints*pe),doublesParticipantId:T};w[Ee]||(w[Ee]=[]),w[Ee].push(Be)}}}else U===Gn&&(y[T]||(y[T]=[]),y[T].push(le))}if(d?.length&&S.matchUps){let le=Object.values(S.matchUps).filter(de=>de.drawId===R&&de.participantWon);if(le.length){let de=le.map(Ee=>Ee.matchUpId),pe={};for(let Ee of le)pe[Ee.matchUpId]=Ee.sideNumber;let{qualityWinPoints:ve,qualityWins:Me}=zj({qualityWinProfiles:d,wonMatchUpIds:de,mappedMatchUps:m,participantSideMap:pe,tournamentParticipants:i.participants||[],tournamentStartDate:i.startDate,level:r});if(ve>0){let Ee=D?.personId;Ee&&(w[Ee]||(w[Ee]=[]),w[Ee].push({qualityWinPoints:ve,qualityWins:Me,eventType:F,drawId:R}))}}}}}}return{participantsWithOutcomes:g,personPoints:w,pairPoints:b,teamPoints:y,...W}}function Yj(t){let{tournamentRecord:e,scope:i}=t;if(!e)return{error:Ie};let r=new Date().toISOString(),n=[],a=(l,u)=>{let{extension:c}=rt({element:l,name:En}),d=c?.value??{locks:[]};for(let p of d.locks)p.expiresAt!==null&&p.expiresAt<=r||i&&p.scope!==i||n.push({...p,...u})};a(e);let s=e.events??[];for(let l of s){a(l,{eventId:l.eventId});let u=l.drawDefinitions??[];for(let c of u)a(c,{eventId:l.eventId,drawId:c.drawId})}let o=e.venues??[];for(let l of o)a(l,{venueId:l.venueId});return{...W,mutationLocks:n}}var Fue={};ft(Fue,{compareTieFormats:()=>xc,getTieFormat:()=>lA,tieFormatGenderValidityCheck:()=>YM,validateCollectionDefinition:()=>DU});function CE(t){if(!t)return{};let e=[],i=t.tieFormatName,r=t.collectionDefinitions?.map(n=>{let{matchUpType:a,matchUpFormat:s,matchUpCount:o,category:l,gender:u}=n;e.includes(s)||e.push(s);let c=l?.ageCategoryCode;return[o,a===Hp?"D":"S",c,s,u].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:r}}function xc({considerations:t={},descendant:e,ancestor:i}){let r={},n={},{matchUpFormats:a,tieFormatDesc:s}=CE(e),{matchUpFormats:o,tieFormatDesc:l}=CE(i),u=lt((a??[]).filter(b=>!(o??[]).includes(b)).concat((o??[]).filter(b=>!(a??[]).includes(b)))),c=!!(t?.collectionName&&e.collectionDefinitions.map(({collectionName:b})=>b).join("|")!==i.collectionDefinitions.map(({collectionName:b})=>b).join("|")),d=!!(t?.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:b})=>b).join("|")!==i.collectionDefinitions.map(({collectionOrder:b})=>b).join("|")),p=Object.assign({},...(e?.collectionDefinitions||[]).map(b=>({[b.collectionId]:b}))),f=Object.assign({},...(i?.collectionDefinitions||[]).map(b=>({[b.collectionId]:b})));r.collectionIds=Vq(Object.keys(p),Object.keys(f)),n.collectionIds=Vq(Object.keys(f),Object.keys(p)),r.collectionsValue=M3(p),n.collectionsValue=M3(f),r.groupsCount=i?.collectionGroups?.length??(0-(e?.collectionGroups?.length??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let h=r.collectionsValue.totalValue-n.collectionsValue.totalValue,m=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,I=n.collectionsValue.assignmentValues.some((b,S)=>{let U=r.collectionsValue.assignmentValues[S];return!U||b.valueKey!==U.valueKey||b.value!==U.value?!0:Array.isArray(b.value)?b.value.every((T,D)=>U.value[D]===T):!1}),v=c||d||l!==s||g||I||h!==0,w=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],y=w.length&&w;return{matchUpFormatDifferences:u,matchUpCountDifference:m,descendantDifferences:r,ancestorDifferences:n,orderDifference:d,valueDifference:h,nameDifference:c,descendantDesc:s,ancestorDesc:l,...W,different:v,invalid:y}}function M3(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(CN).reduce((n,a)=>{let s=t[a],{collectionValueProfiles:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=s,f={collectionValueProfiles:o,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},h=Object.keys(f).filter(g=>![void 0,null].includes(f[g])&&(!Array.isArray(f[g])||f[g].length>0));h.length!==1&&e.push({collectionId:a});let m=h[0];if(m){let g=m==="collectionValueProfiles"?Object.values(o):f[m];i.push({valueKey:m,value:g})}return r+=u,o?.length?n+o.reduce((g,I)=>g+I.value,0):u?ct(c)?n+c*u:ct(d)?n+d*u:ct(p)?n+p*u:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function Kj(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=Lue(t);return{matchUp:xe(e,!0,!0),error:i}}function Lue({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,matchUpId:o,inContext:l,eventId:u,drawId:c,event:d}){if(!i)return{error:Ie};if(typeof o!="string")return{error:Dn};if(!a||!d){let h=(Tr({tournamentRecord:i,nextMatchUps:s}).matchUps??[]).find(m=>m.matchUpId===o);if(!h)return{error:pn};({eventId:u,drawId:c}=h),{event:d,drawDefinition:a}=Kn({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:za};n&&!r&&(r=Xc({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:d?.surfaceCategory??i.surfaceCategory,indoorOutDoor:d?.indoorOutdoor??i.indoorOutdoor,endDate:d?.endDate??i.endDate,tournamentId:i.tournamentId,eventId:u??d?.eventId,drawId:c},{participants:f=[]}=Pf({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(s){let h=(xn({context:l?p:void 0,participants:f,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,inContext:l,event:d}).matchUps??[]).find(g=>g.matchUpId===o);if(!h)return{error:pn};let m=a?.structures?.find(g=>g.structureId===h.structureId);return{drawDefinition:a,structure:m,matchUp:h}}else{let{matchUp:h,structure:m}=hi({context:l?p:void 0,tournamentParticipants:f,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:o,inContext:l,event:d});return{matchUp:h,structure:m,drawDefinition:a}}}function lA({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:s,event:o}){if(!t)return{error:Ie};if(!s&&!o&&!i&&!r)return q({result:{error:Je},stack:"getTieFormat"});a&&!o&&(o=t.events?.find(f=>f.eventId===a));let l=Kj({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:s,event:o});if(r&&l?.error)return l;if(!e&&l?.drawDefinition&&(e=l?.drawDefinition),n=n??l?.structure,!n&&i&&!r){if(!e)return{error:jo};let f=tt({drawDefinition:e,structureId:i});if(f.error)return f;n=f.structure}let u=(n?.tieFormat||n?.tieFormatId)&&bn({structure:n,drawDefinition:e,event:o})?.tieFormat,c=(e?.tieFormat||e?.tieFormatId)&&bn({drawDefinition:e,event:o})?.tieFormat,d=bn({event:o})?.tieFormat,p=bn({matchUp:l?.matchUp,drawDefinition:e,structure:n,event:o})?.tieFormat;return{...W,matchUp:l?.matchUp,structureDefaultTieFormat:zr(u),eventDefaultTieFormat:zr(d),drawDefaultTieFormat:zr(c),tieFormat:zr(p),structure:n}}var _ue={};ft(_ue,{bulkUpdatePublishedEventIds:()=>Xj,getAllEventData:()=>Jj,getCourtInfo:()=>TN,getDrawData:()=>GN,getEventData:()=>hT,getEventPublishStatus:()=>Fa,getPublishState:()=>ig,getTournamentPublishStatus:()=>iy,getVenueData:()=>VI});function Xj({tournamentRecord:t,outcomes:e}){if(!t)return{error:Ie};if(!e?.length)return{error:Je,info:"Missing outcomes"};let i=e.reduce((n,a)=>{let{drawId:s,eventId:o}=a;return o&&s&&(n[o]?n[o].includes(s)||n[o].push(s):n[o]=[s]),n},{}),r=Object.keys(i);return{publishedEventIds:(t.events?.filter(n=>r.includes(n.eventId))).filter(n=>{let a=Fa({event:n}),{drawDetails:s,drawIds:o}=a??{},{eventId:l}=n;return i[l].filter(u=>{let c=s?Object.keys(a.drawDetails).filter(d=>RN({drawId:d,drawDetails:s})):[];return o?.includes(u)||c.includes(u)}).length}).map(n=>n.eventId),eventIdPublishedDrawIdsMap:i}}function Jj({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:Ie};let i=t.events||[],r=t?.participants||[],{tournamentInfo:n}=lg({tournamentRecord:t}),{venues:a}=Hu({tournamentRecord:t}),s=i.map(o=>{let{eventId:l}=o,u=nle({event:o}).eventInfo,c=$U({tournamentRecord:t,event:o}).scheduleTiming,d=(o.drawDefinitions||[]).map(f=>{let{drawId:h,drawName:m,matchUpFormat:g,updatedAt:I}=f,v={drawId:h,drawName:m,matchUpFormat:g,updatedAt:I},{abandonedMatchUps:w,completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S}=ey({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:f,event:o});return{drawInfo:v,matchUps:{abandonedMatchUps:w,completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S}}}),p=Fa({event:o});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:s}}}var $ue={};ft($ue,{courtGridRows:()=>fA,findVenue:()=>go,getMatchUpsToSchedule:()=>uA,getPersonRequests:()=>kf,getProfileRounds:()=>pA,getScheduledRoundsDetails:()=>vT,getSchedulingProfile:()=>Qc,getSchedulingProfileIssues:()=>Qj,publicFindCourt:()=>uV});function WI({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){let{individualParticipantIds:n}=gN(r);i=i??r.schedule?.timeAfterRecovery;let a=u=>{t[u]||(t[u]=[]),t[u]=lt(t[u].concat(...n))},s=u=>{i&&(!e[u]||i>e[u])&&(e[u]=i)},o=r.winnerTo?.matchUpId||r.winnerMatchUpId;o&&(i&&s(o),a(o));let l=r.loserTo?.matchUpId||r.loserMatchUpId;l&&(i&&s(l),a(l)),r.sidesTo?.length&&r.sidesTo.forEach(({matchUpId:u})=>{u&&(i&&s(u),a(u))})}function uA(t){let e=He(t,[{[U2]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,orderedMatchUpIds:o,clearDate:l,matchUps:u}=t,c=s?Object.keys(s):[],d=(o??[]).map(f=>u.find(h=>h.matchUpId===f)).filter(Boolean).filter(f=>{let h=!l&&(r.includes(f.matchUpId)||c.includes(f.matchUpId)),m=["BYE",Yt,xi,Ma,Ur,si,Ui,zi].includes(f?.matchUpStatus);return n||!h&&!f.winningSide&&!m}),p=i&&a?d.reduce((f,h)=>{let{drawId:m,tournamentId:g}=h;return f.matchUpMap[g]||(f.matchUpMap[g]={}),f.matchUpMap[g][m]?f.matchUpMap[g][m].push(h):f.matchUpMap[g][m]=[h],WI({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:h}),f},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function cA({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:s,eventType:o,eventId:l}){if(!qa({matchUpFormat:r}))return{error:IU};let u=Object.keys(i).filter(d=>!s||d===s),c;return u.forEach(d=>{if(c)return;let p=i[d],f=l?Kn({tournamentRecord:p,eventId:l})?.event:void 0;return c=YU({tournamentRecord:p,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:f}),c?.averageMinutes||c?.recoveryMinutes}),{recoveryMinutes:c?.recoveryMinutes||t,averageMinutes:c?.averageMinutes||e,typeChangeRecoveryMinutes:c?.typeChangeRecoveryMinutes||c?.recoveryMinutes||t}}function vT(t){let e=He(t,[{[D2]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[Jn]:on}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:Ci};let a={},s=[],o=t.rounds.toSorted((h,m)=>(h.sortOrder??0)-(m.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(h=>Qv({tournamentRecord:h}).containedStructures)),u=t.matchUps??_o({nextMatchUps:!0,tournamentRecords:n}).matchUps,c=0,d={},p={},f={};return{scheduledRoundsDetails:o.flatMap(h=>{let m=h.periodLength||r,g=[];l?.[h.structureId]?g.push(...l[h.structureId]):g.push(h.structureId);let I=u?rc({tournamentIds:[h.tournamentId],roundNumbers:[h.roundNumber],matchUpIds:h.matchUpIds,eventIds:[h.eventId],drawIds:[h.drawId],processContext:!0,structureIds:g,matchUps:u}).sort(eg):[],{segmentNumber:v,segmentsCount:w}=h.roundSegment||{};if(ct(v)&&xo(I?.length)&&xo(w)&&v>0&&v<=w&&w<I?.length&&!h.matchUpIds?.length){let U=I.length/w,T=U*(v-1);I=I.slice(T,T+U)}let y=n[h.tournamentId],b=Kn({drawId:h.drawId,tournamentRecord:y}).event,S=[];for(let U of I){let T=U.matchUpFormat;T&&(a[T]||(a[T]=[],a[T].push(U)),S.push(T))}for(let U of S){let{eventType:T,category:D}=b??{},{categoryName:P,ageCategoryCode:E}=D??{},{typeChangeRecoveryMinutes:R,recoveryMinutes:C,averageMinutes:M,error:N}=cA({categoryName:P??E,categoryType:D?.categoryType,tournamentId:h.tournamentId,eventId:h.eventId,tournamentRecords:n,matchUpFormat:U,eventType:T});if(N)return{error:N,round:h};let A=I.filter(k=>(i||!Qi.includes(k.matchUpStatus))&&k.matchUpStatus!=="BYE").map(yr);A.forEach(k=>{f[k]={typeChangeRecoveryMinutes:R,recoveryMinutes:C,averageMinutes:M},d[k]=C,p[k]=M}),s.push(...A),c=Math.max(M||0,c);let O=`${M}|${m}`;return{roundPeriodLength:m,recoveryMinutes:C,averageMinutes:M,matchUpIds:A,hash:O}}}),greatestAverageMinutes:c,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:s,minutesMap:f,...W}}function Bue({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t?.map(o=>{let l=Ze(o?.scheduleDate);if(!l){n.push(`Invalid date: ${o?.scheduledDate}`);return}let u=(o?.venues||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!e?.includes(p)){n.push(`Missing venueId: ${p}`);return}let f=d.filter(h=>{let m=i.includes(h.eventId)&&r.includes(h.drawId);return m||n.push(`Invalid eventId: ${h.eventId} or drawId: ${h.drawId}`),m});if(f.length)return{venueId:p,rounds:f}}).filter(Boolean);return u.length&&l&&{...o,venues:u}}).filter(Boolean),s=n.length;return{updatedSchedulingProfile:a,modifications:s,issues:n}}function dA({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:re};let{venueIds:i,tournamentsMap:r}=wze({tournamentRecords:t}),n,a,s=e.every(o=>{let{scheduleDate:l,venues:u}=o;return kn(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(f=>{if(!f)return a="empty round",!1;let{roundSegment:h,tournamentId:m,structureId:g,roundNumber:I,eventId:v,drawId:w}=f,y=r?.[m]?.[v]?.[w]?.[g]?.includes(I);y||(a="Invalid rounds");let{segmentNumber:b,segmentsCount:S}=h||{},U=!h||ct(b)&&xo(S)&&b<=S;return U||(a="Invalid segment"),y&&U}):(n=Uf,!1):(a="rounds should be an array",!1)}):!1});return!s&&!n&&(n=re),{valid:!!s,error:n,info:a}}function bze(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],s=[],o=[],l=(e?.venues||[]).map(({venueId:c,courts:d})=>(!r||d?.length)&&c),u=e?.tournamentId;if(u){n.push(u),i[u]={};let c=e?.events||[];for(let d of c){let p=d.eventId;s.push(p),i[u][p]={};let f=h=>parseInt(h);for(let h of d.drawDefinitions||[]){let m=h.drawId;o.push(m),i[u][p][m]={};let{structures:g}=so({drawDefinition:h});for(let I of g||[]){let v=I.structureId,{matchUps:w}=Ot({structure:I}),{roundMatchUps:y}=Un({matchUps:w}),b=y&&Object.keys(y).map(f);if(i[u][p][m][v]=b,a.push(v),I.structures?.length)for(let S of I.structures)a.push(S.structureId),i[u][p][m][S.structureId]=b}}}}return{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:s,drawIds:o}}function wze(t){let e=t?.tournamentRecords&&Object.values(t?.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:s,tournamentIds:o}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:f,eventIds:h,drawIds:m}=bze({tournamentRecord:u});return f.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...h),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:o,structureIds:s,venueIds:r,eventIds:n,drawIds:a}}function Qc({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let{extension:i}=rt({element:e,name:Qh,tournamentRecords:t,discover:!0}),r=i?.value||[];if(r.length){let{venueIds:n}=fT({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:s}=qV({tournamentRecords:t}),{updatedSchedulingProfile:o,modifications:l,issues:u}=Bue({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:s});if(l){r=o;let c=cy({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return c.error?c:{schedulingProfile:r,modifications:l,issues:u}}}return{schedulingProfile:r,modifications:0}}function cy({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=dA({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?It({tournamentRecords:t,discover:!0,extension:{name:Qh,value:i}}):On({element:e,name:Qh,tournamentRecords:t,discover:!0})}function yT(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=Qc({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:r}=fT({tournamentRecords:i}),{eventIds:n,drawIds:a}=qV({tournamentRecords:i}),{updatedSchedulingProfile:s,modifications:o,issues:l}=Bue({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return o?{...cy({schedulingProfile:s,tournamentRecords:i}),modifications:o,issues:l}:{...W,modifications:o,issues:l}}function Qj(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:fU};if(!Array.isArray(e))return{error:re};if(!e.every(kn))return{error:Yi};let n=[],a=0,s={},{schedulingProfile:o}=Qc({tournamentRecords:i});if(!o)return{issues:n,...W};let{matchUps:l}=_o({nextMatchUps:!0,tournamentRecords:i});for(let c of o){let{scheduleDate:d,venues:p=[]}=c;if(!e?.length||e.includes(d)){for(let f of p||[])if(f){let{rounds:h}=f,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:I}=vT({tournamentRecords:i,periodLength:r,matchUps:l,rounds:h}),{matchUpDependencies:v}=Io({tournamentRecords:i,matchUps:l}),w=y=>{let b;return I?.find((S,U)=>{let T=S.matchUpIds.includes(y);return T&&(b=U),T}),b};if(g?.forEach((y,b)=>{let S=g.slice(b+1),U=_i(S,v?.[y]?.matchUpIds||[]);U.length&&m.push({matchUpId:y,shouldBeAfter:U})}),m.length){a+=m.length;let y=m.map(({matchUpId:b,shouldBeAfter:S})=>{let U=w(b),T=lt(S.map(w));return s[d]||(s[d]={}),s[d][U]||(s[d][U]=[]),T.forEach(D=>{s[d][U].includes(D)||s[d][U].push(D)}),{matchUpId:b,matchUpRoundIndex:U,earlierRoundIndices:T,shouldBeAfter:S}});n.push(...y)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...n.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:f}=c;return{[d]:{earlierRoundIndices:f,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:s,...W}}function kf(t){let{tournamentRecords:e,requestType:i}=t,r=He(t,[{[fn]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:s}=rt({element:a,name:Xv}),o=s?.value||[];for(let l of o){let{personId:u,requests:c}=l||{};n[u]||(n[u]=[]);for(let d of c)i&&d.requestType!==i||n[u].push(d)}}return{personRequests:n,...W}}function EF(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:s,eventId:o,drawId:l}=t,u=r?e:s,c=[n,o,l,u,a].join("|");return je({structureId:u,roundSegment:i,tournamentId:n,roundNumber:a,eventId:o,drawId:l,id:c})}function N3({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:s,categoryType:o}=n||{},{categoryName:l,ageCategoryCode:u}=s||{},c=Ra(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let f=c[p],h=cA({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:o,eventType:a});if(h.error)return h;let m=h.averageMinutes*f;isNaN(d)||(d+=m)}),{roundMinutes:d}}function Sze(t){return(t||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((a,s)=>a+s,0),n=(i.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:n}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function A3(t){let e=t.length,i=t.filter(({sides:u})=>u?.some(({bye:c})=>c)).length||0,r=t.filter(({winningSide:u,matchUpStatus:c})=>u||Qi.includes(c)).length||0,n=t.filter(({schedule:u,matchUpStatus:c})=>u?.scheduledDate&&u?.scheduledTime&&c!=="BYE").length||0,a=e-i,s=a===r,o=a-n,l=a-n;return{unscheduledCount:o,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:s,byeCount:i}}function pA({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:fU};t={[i.tournamentId]:i}}if(e){let a=dA({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=Qc({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:Gr};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:s})=>a.map(({rounds:o})=>o.map(l=>{let u=EF(l);return u.roundSegment?.segmentsCount&&(n[u.id]=u.roundSegment.segmentsCount),je({id:r?u.id:void 0,scheduleDate:s,...u})}))).flat(1/0),segmentedRounds:n}}function Fd({court:t,date:e}){let i=e&&t.dateAvailability?.find(n=>Su(n.date,e)),r=t.dateAvailability?.find(n=>!n.date);return i||r}function Uze({court:t,date:e}){let i=Fd({court:t,date:e}),r=new Map,n=[];return(i?.bookings||[]).forEach(a=>{if(typeof a.courtOrder=="number"){let s=a.rowCount||1;for(let o=0;o<s;o++)r.set(a.courtOrder+o,a)}else n.push(a)}),{gridBookings:r,timeBookings:n}}function fA({courtPrefix:t="C|",minRowsCount:e,courtsData:i,scheduledDate:r}){if(!Array.isArray(i))return{error:re};let n=i?.reduce((o,l)=>{let u=l.matchUps||[],c=Math.max(0,...u.map(d=>d.schedule.courtOrder||0));return Math.max(c,o)},1),a=Math.max(e||0,n),s=Ce(0,a).map(o=>({matchUps:Ce(0,i.length).map(l=>{let u=i[l],{courtId:c,venueId:d}=u;if(r){let{gridBookings:p}=Uze({court:u,date:r});if(p.has(o+1)){let f=p.get(o+1);return{schedule:{courtOrder:o+1,venueId:d,courtId:c},isBlocked:!0,booking:f}}}return{schedule:{courtOrder:o+1,venueId:d,courtId:c}}})}));return i.forEach((o,l)=>{for(let u of o.matchUps){let c=u.schedule?.courtOrder;c&&(s[c-1].matchUps[l]=u)}}),{courtPrefix:t,rows:s.map((o,l)=>Object.assign({rowId:`rowId-${l+1}`},...o.matchUps.map((u,c)=>({[`${t}${c}`]:u}))))}}var Vue={};ft(Vue,{getEntriesAndSeedsCount:()=>hA,getMaxEntryPosition:()=>Zj});function hA({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:ci};let{entries:s,stageEntries:o}=Kse({drawDefinition:e,drawId:r,stage:a,event:n}),l=o.length,{drawSize:u}=ble({participantsCount:l}),c=gT({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return q({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:s,seedsCount:d,stageEntries:o}}function Zj(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>Ke(n||0)),0)}var jue={};ft(jue,{allCompetitionMatchUps:()=>_o,allDrawMatchUps:()=>xn,allEventMatchUps:()=>Gu,allTournamentMatchUps:()=>Tr,analyzeMatchUp:()=>Pw,calculateWinCriteria:()=>cg,checkMatchUpIsComplete:()=>Dp,competitionScheduleMatchUps:()=>wT,drawMatchUps:()=>cG,eventMatchUps:()=>gA,filterMatchUps:()=>rc,getAllDrawMatchUps:()=>nr,getAllStructureMatchUps:()=>Ot,getCheckedInParticipantIds:()=>Zm,getCompetitionMatchUps:()=>Dw,getEventMatchUpFormatTiming:()=>tG,getHomeParticipantId:()=>aG,getMatchUpCompetitiveProfile:()=>qU,getMatchUpContextIds:()=>sG,getMatchUpDailyLimits:()=>vA,getMatchUpDailyLimitsUpdate:()=>iG,getMatchUpDependencies:()=>Io,getMatchUpFormat:()=>oG,getMatchUpFormatTiming:()=>YU,getMatchUpFormatTimingUpdate:()=>eG,getMatchUpScheduleDetails:()=>DN,getMatchUpType:()=>PN,getMatchUpsStats:()=>lG,getModifiedMatchUpFormatTiming:()=>mA,getParticipantResults:()=>ZU,getPredictiveAccuracy:()=>nG,getRoundMatchUps:()=>Un,getRounds:()=>uG,isValidMatchUpFormat:()=>qa,matchUpActions:()=>HN,participantScheduledMatchUps:()=>rG,tallyParticipantResults:()=>tg,tournamentMatchUps:()=>IA,validMatchUp:()=>yN,validMatchUps:()=>is});function Gue({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let i=[],r;for(let n of Object.values(t)){let{extension:a}=rt({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let s=n.events??[];for(let o of s){let{eventId:l}=o,{extension:u}=rt({name:e,element:o});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function eG({tournamentRecords:t}){return Gue({extensionName:Mc,tournamentRecords:t})}var qk="ADULT",Yk="JUNIOR",XT="WHEELCHAIR",Hue={[Zd]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Vt]:30,default:60}}]},defaultDailyLimits:{[qt]:2,[Vt]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Ws],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[XT],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[qk,XT],minutes:{default:60,[Vt]:30}},{categoryTypes:[Yk],minutes:{default:60,[Vt]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[qk,XT],minutes:{default:30}},{categoryTypes:[Yk],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[qk,Yk],minutes:{default:30}},{categoryTypes:[XT],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},Tze=Hue;function tG({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:ci};let n,a;if(e?.length){let d=[];n=e.map(p=>{let f=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(f?.matchUpFormat)&&qa({matchUpFormat:f?.matchUpFormat}))return d.push(f.matchUpFormat),f}).filter(Boolean)}else{let{policy:d}=Ef({policyType:vs,tournamentRecord:t,event:r});if(d?.matchUpFormats)n=d?.matchUpFormats;else{let{extension:p}=rt({name:Mc,element:r}),f,h;p?.value?{matchUpAverageTimes:f,matchUpRecoveryTimes:h}=p.value:{matchUpAverageTimes:f,matchUpRecoveryTimes:h}=Tze[Zd],n=lt([...(f||[]).map(m=>m.matchUpFormatCodes),...(h||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:s,eventId:o,category:l}=r,u=l?.categoryName??l?.ageCategoryCode??o;if(!o)return{error:ci};let c=n.map(({matchUpFormat:d,description:p})=>{let f=YU({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:s,event:r});return{matchUpFormat:d,description:p,...f}});return je({eventMatchUpFormatTiming:c,info:a})}function mA(t){let e=He(t,[{[gr]:!0},{[Yr]:m=>qa({matchUpFormat:m}),[Ya]:IU,[b2]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=rt({name:Mc,element:n}),s=a?.value,{extension:o}=rt({element:i,name:Mc}),l=o?.value,u=s?.matchUpAverageTimes&&hb({...s,matchUpFormat:r}),c=l?.matchUpAverageTimes&&hb({...l,matchUpFormat:r}),d=[u,c].find(m=>m),p=s?.matchUpRecoveryTimes&&mb({...s,matchUpFormat:r}),f=l?.matchUpRecoveryTimes&&mb({...l,matchUpFormat:r}),h=[p,f].find(m=>m);return{matchUpFormat:r,recoveryTimes:h,averageTimes:d}}function iG({tournamentRecords:t}){return Gue({extensionName:kU,tournamentRecords:t})}var bT=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function rG({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!is(e))return{error:Bu};if(!Array.isArray(t))return{error:re};let i=e.filter(Boolean).filter(({schedule:r})=>bT({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,s=Ze(a?.scheduledDate),o=fi(a?.scheduledTime);return s&&o&&(r[s]?r[s].push(n):r[s]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>une(fi(n.schedule?.scheduledTime),fi(a.schedule?.scheduledTime)))}),{...W,scheduledMatchUps:i}}function Dze({tournamentRecords:t}){let e={},i=[];for(let r of Object.values(t))for(let n of r.events??[]){let a=Fa({event:n}),s=a?.drawDetails;Ut(s)?(Object.assign(e,s),i.push(...Object.keys(s).filter(o=>RN({drawId:o,drawDetails:s})))):a?.drawIds?.length&&i.push(...a.drawIds)}return{drawIds:i,detailsMap:e}}function ME({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:o,drawId:l,structureId:u,roundNumber:c})=>`${o}|${l}|${u}${c}`;t?.length&&t.flatMap(({venues:o})=>o.map(({rounds:l})=>l)).forEach(o=>{o.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let f=r({eventId:l,drawId:u,structureId:c,roundNumber:d});i[f]=p})});let n=[],a={noScheduledDate:[]};for(let o of e){let l=o.schedule||{},u=l.scheduledDate&&Ze(l.scheduledDate)||l.scheduledTime&&Ze(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(o)}let s=Object.keys(a).sort((o,l)=>o.localeCompare(l));for(let o of s){let l=a[o],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},f=p.scheduledTime&&fi(p.scheduledTime)||"noScheduledTime";u[f]||(u[f]=[]),u[f].push(d)}for(let d of Object.keys(u)){let p=u[d].sort((f,h)=>(f.roundNumber||0)-(h.roundNumber||0));u[d]=p}let c=Object.keys(u).sort((d,p)=>d.localeCompare(p));for(let d of c){let p=u[d];p.sort((f,h)=>{let m=i[r(f)]||0,g=i[r(h)]||0;return m-g}),n.push(...p)}}return n}function gA(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:h,nextMatchUps:m,tournamentId:g,inContext:I,context:v,event:w}=t;if(!w)return{error:ci};let{eventId:y,eventName:b,endDate:S,eventType:U,category:T,gender:D}=w??{},P={...v,...je({surfaceCategory:w.surfaceCategory??c?.surfaceCategory,indoorOutDoor:w.indoorOutdoor??c?.indoorOutdoor,tournamentId:g??c?.tournamentId,endDate:S??c?.endDate,eventName:b,eventType:U,category:T,eventId:y,gender:D})},E;!e&&c&&({participants:e,participantMap:r,groupInfo:E}=Pf({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:h,inContext:I})),h&&!i&&(i=Xc({policyDefinitions:l,tournamentRecord:c,contextProfile:h,event:w}));let R=Fa({event:w});return{...(w.drawDefinitions??[]).reduce((C,M)=>{let N=ey({hydrateParticipants:t.hydrateParticipants,context:P,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:f,participantMap:r,publishStatus:R,contextProfile:h,drawDefinition:M,nextMatchUps:m,inContext:I,event:w});return Object.keys(N)?.forEach(A=>{Array.isArray(N[A])&&(C[A]||(C[A]=[]),C[A]=C[A].concat(N[A]))}),C},{}),...W,groupInfo:E}}function IA(t){if(!t?.tournamentRecord)return{error:Ie};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,inContext:o=!0,usePublishState:l,contextFilters:u,matchUpFilters:c,contextProfile:d,nextMatchUps:p,context:f}=t,h=t.tournamentId??s.tournamentId,m=s?.events??[],{participants:g,participantMap:I,groupInfo:v}=Pf({participantsProfile:r,tournamentRecord:s,contextProfile:d,inContext:o});d&&!e&&(e=Xc({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));let{appliedPolicies:w}=Ct({tournamentRecord:s}),y=u?.eventIds??[];return{...m.filter(b=>!y.includes(b.eventId)).map(b=>{let S={eventDrawsCount:Vi({event:b}).flightProfile?.flights?.length||b.drawDefinitions?.length||0,...f};return gA({hydrateParticipants:t.hydrateParticipants,context:S,tournamentAppliedPolicies:w,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,contextFilters:u,contextProfile:d,contextContent:e,matchUpFilters:c,participantMap:I,participants:g,tournamentId:h,nextMatchUps:p,inContext:o,event:b})}).reduce((b,S)=>((S&&Object.keys(S).filter(U=>!["success","matchUpsMap"].includes(U)))?.forEach(U=>{Array.isArray(S[U])&&(b[U]||(b[U]=[]),b[U]=b[U].concat(S[U]),b.matchUpsCount!==void 0?b.matchUpsCount+=S[U].length:b.matchUpsCount=S[U].length)}),b),{matchUpsCount:0}),groupInfo:v,participants:g}}function Dw({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,useParticipantMap:n,policyDefinitions:a,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c}){if(typeof r!="object"||!Object.keys(r).length)return{error:Ci};let d=Object.keys(r).map(h=>{let m=r[h];return IA({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:a,tournamentRecord:m,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c})}),p={},f={};return{...d.reduce((h,m)=>(Object.keys(m).forEach(g=>{if(g==="groupInfo")Object.assign(f,m[g]);else if(g==="participants")for(let I of m[g]??[])p[I.participantId]=I;else Array.isArray(m[g])&&(h[g]||(h[g]=[]),h[g]=h[g].concat(m[g]))}),h),{}),groupInfo:f,mappedParticipants:p}}function wT(t){if(typeof t?.tournamentRecords!="object"||!Object.keys(t?.tournamentRecords).length)return{error:Ci};let{courts:e,venues:i}=Hu(t),r=Qc(t).schedulingProfile,{sortDateMatchUps:n=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:s,activeTournamentId:o,tournamentRecords:l,withCourtGridRows:u,minCourtGridRows:c,usePublishState:d,status:p=rs,sortCourtsData:f}=t,h=o??jm()??Object.keys(l)[0],m=d?iy({tournamentRecord:l[h],status:p}):void 0,g=s?Dw({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[xi]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!Ko(m?.orderOfPlay))return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let I,v;d&&({drawIds:I,detailsMap:v}=Dze({tournamentRecords:l})),I?.length&&(t.contextFilters??={},t.contextFilters.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(N=>I.includes(N)):t.contextFilters.drawIds=I);let w=m?.orderOfPlay;w?.eventIds?.length&&(t.matchUpFilters??={},t.matchUpFilters?.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(N=>w.eventIds.includes(N)):t.matchUpFilters.eventIds=w.eventIds),w?.scheduledDates?.length&&(t.matchUpFilters??={},t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(N=>w.scheduledDates.includes(N)):t.matchUpFilters.scheduledDates=w.scheduledDates),s&&(t.matchUpFilters??={},t.matchUpFilters?.excludeMatchUpStatuses?.length?t.matchUpFilters.excludeMatchUpStatuses.includes(xi)||t.matchUpFilters.excludeMatchUpStatuses.push(xi):t.matchUpFilters.excludeMatchUpStatuses=[xi]);let{completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S,abandonedMatchUps:U,groupInfo:T,mappedParticipants:D}=Dw({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),P=[...b??[],...S??[]];v&&(!I?.length||Object.keys(v).length)&&(P=P.filter(N=>{let{drawId:A,structureId:O,stage:k}=N;if(!Ko(v?.[A]?.publishingDetail))return!1;let F=Object.keys(v[A].stageDetails??{});if(F.length){let L=F.filter(V=>!Ko(v[A].stageDetails[V])),$=F.filter(V=>Ko(v[A].stageDetails[V]));return L.length&&L.includes(k)?!1:$.length&&$.includes(k)?!0:L.length&&!L.includes(k)&&!$.length}let x=Object.keys(v[A].structureDetails??{});if(x.length){let L=x.filter(V=>!Ko(v[A].structureDetails[V])),$=x.filter(V=>Ko(v[A].structureDetails[V]));return L.length&&L.includes(O)?!1:$.length&&$.includes(O)?!0:L.length&&!L.includes(O)&&!$.length}return!0})),v&&d&&(P=P.filter(N=>{let{drawId:A,structureId:O,roundNumber:k}=N;if(!ct(k))return!0;let F=v[A]?.structureDetails?.[O];if(!F)return!0;let{scheduledRounds:x,roundLimit:L}=F;if(ct(L)&&k>L)return!1;if(x){let $=x[k];return $?Ko($):!1}return!0}));let E=n?ME({matchUps:P,schedulingProfile:r}):P,R=e?.map(N=>{let A=M(N);return{surfaceCategory:N?.surfaceCategory??"",matchUps:A,...N}}),C={completedMatchUps:s?g:y,mappedParticipants:t.hydrateParticipants?void 0:D,dateMatchUps:E,courtsData:R,groupInfo:T,venues:i};if(u){let N=t.matchUpFilters?.scheduledDate,{rows:A,courtPrefix:O}=fA({minRowsCount:Math.max(c||0,E.length||0),scheduledDate:N,courtsData:R});C.courtPrefix=O,C.rows=A}return{...C,...W};function M({courtId:N}){let A=(a?E.concat(y??[],U??[]):E).filter(O=>O.schedule?.courtId===N||O.schedule?.allocatedCourts?.map(({courtId:k})=>k).includes(N));return f?ME({matchUps:A,schedulingProfile:r}):A}}function vA({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:s}=Pze({tournamentRecord:a});r=s}),{matchUpDailyLimits:r}}function Pze(t){let e=He(t,[{[gr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:r}=Ef({policyType:Zd,tournamentRecord:i}),{extension:n}=rt({element:i,name:kU}),a=n?.value?.dailyLimits,s=r?.defaultDailyLimits;return{matchUpDailyLimits:a||s}}function nG(t){let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:s,zoneDoubling:o,matchUpType:l,scaleName:u,eventId:c,zonePct:d,drawId:p,event:f}=t;if(!r&&!e)return{error:Ie};if(l&&![qt,Vt].includes(l))return{error:re,info:{matchUpType:l}};if(e&&!is(e))return{error:re,context:{matchUps:e}};let h=Er[u],m=h?.ascending??t.ascending??!1,g=h?.accessor??t.valueAccessor,I=Array.isArray(h?.range)?Math.abs(h.range[0]-h.range[1]):0,v=ct(d)&&I?(d??0/100)*I:t.zoneMargin??I,w={withScaleValues:!0,withCompetitiveness:!0},y={matchUpTypes:l?[l]:[qt,Vt]},b=r?.participants;e?.[0]?.hasContext?p?e=e.filter(M=>M.drawId===p):c&&(e=e.filter(M=>M.eventId===c)):e??=p&&!n&&[]||!p&&c&&!f&&[]||p&&xn({inContext:!0,drawDefinition:n,contextFilters:y,contextProfile:w,participants:b})?.matchUps||!p&&c&&Gu({inContext:!0,contextFilters:y,contextProfile:w,participants:b,event:f})?.matchUps||Tr({tournamentRecord:r,contextFilters:y,contextProfile:w})?.matchUps||[],l&&(e=e.filter(M=>M.matchUpType===l));let S=e.filter(({winningSide:M,score:N,sides:A,matchUpStatus:O})=>![Ur,Yt,si,Jv,Ma].includes(O??"")&&hr({score:N})&&A?.length===2&&M),U=Rze({matchUps:S,excludeMargin:a,exclusionRule:s,valueAccessor:g,ascending:m,scaleName:u}),T=!o||Di(qt)(l)?v:(v||0)*2,D=v?S.map(({competitiveProfile:M,matchUpType:N,score:A,sides:O})=>{let k=Wue({singlesForDoubles:i,valueAccessor:g,matchUpType:N,scaleName:u,sides:O}),F=Math.abs(k[0].value-k[1].value);return{competitiveness:M?.competitiveness,valuesGap:F,score:A}}).filter(({valuesGap:M})=>M<=T):[],P=Eze({zoneData:D}),E=P&&Object.values(P).flat().length,R=E&&Object.assign({},...Object.keys(P).map(M=>({[M]:Math.round(1e4*P[M].length/E)/100}))),C=S.length-(D?.length||0);return{...W,relevantMatchUps:S,zoneDistribution:R,zoneData:D,accuracy:U,nonZone:C}}function Eze({zoneData:t}){let e={[Q2]:[],[vw]:[],[yw]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function Wue({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let s=e?.range.sort(),o=l=>{let u=l?.[e?.valueAccessor];return{exclude:e&&u>=s[0]&&u<=s[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l?.individualParticipants;if(c?.length){let d=[],p=0;for(let f of c){let{scaleValue:h,value:m}=k3({singlesForDoubles:t,valueAccessor:i,participant:f,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:I}=o(h);g&&u.push(I),d.push(h),m&&!Number.isNaN(Number(p))?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=k3({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:f,exclusionValue:h}=o(d);return f&&u.push(h),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function k3({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){let a=t?qt:i,s=r?.rankings?.[a]?.find(u=>u.scaleName===n),o=(r?.ratings?.[a]?.find(u=>u.scaleName===n)||s)?.scaleValue,l=e?o?.[e]:o;return{scaleValue:o,value:l}}function Rze({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let s={affirmative:[],negative:[],excluded:[]};for(let u of a)Cze({matchUp:u,accuracy:s,excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n});let o=s.affirmative.length+s.negative.length,l=o&&s.affirmative.length/o*100;return s.percent=l?Math.round(100*l)/100:0,s}function Cze({matchUp:t,accuracy:e,excludeMargin:i,exclusionRule:r,valueAccessor:n,ascending:a,scaleName:s}){let{matchUpType:o,sides:l,score:u,winningSide:c}=t;if(!c)return;if(r&&(!r.valueAccessor||!r.range)){e.error={info:"exclusionRule requires valueAccessor and range",error:Je};return}let d=c-1,p=Wue({exclusionRule:r,valueAccessor:n,matchUpType:o,scaleName:s,sides:l});if(Mze({exclusionRule:r,sideValues:p,accuracy:e,score:u,winningSide:c}))return;if(Nze(p)){e.excluded.push({scoreString:u?.scoreStringSide1,missingValues:!0,winningSide:c,sideValues:p});return}let f=p[d].value-p[1-d].value;if(Aze({excludeMargin:i,valuesGap:f})){e.excluded.push({scoreString:u?.scoreStringSide1,excludeMargin:i,winningSide:c,excludeGap:!0,sideValues:p,valuesGap:f});return}let h=a?f:f*-1,m=c===1?u?.scoreStringSide1:u?.scoreStringSide2;h>0?e.affirmative.push({winningScoreString:m,winningSide:c,sideValues:p,valuesGap:f,score:u}):e.negative.push({winningScoreString:m,winningSide:c,sideValues:p,valuesGap:f,score:u})}function Mze({exclusionRule:t,sideValues:e,accuracy:i,score:r,winningSide:n}){if(t){let a=e.flatMap(({exclusionValues:s})=>s);if(a.length)return i.excluded.push({scoreString:r?.scoreStringSide1,exclusionValues:a,winningSide:n,sideValues:e}),!0}return!1}function Nze(t){return t.filter(e=>![void 0,"",null].includes(e.value)).length<2}function Aze({excludeMargin:t,valuesGap:e}){let i=Number.parseFloat(t||0);return i&&Math.abs(e)<i}function cg({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=joe({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:s,collectionGroupNumber:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,f=o&&r.includes(o);if(ct(p||d))n=!0;else{if(f)continue;if(typeof l=="number"&&ct(l))i+=l;else if(Array.isArray(s)&&s?.length)for(let h of s)i+=h.matchUpValue;else typeof c=="number"&&ct(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...W}:{valueGoal:Math.floor(i/2)+1,...W}}function aG(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=He(t,[{[Vu]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:s}=Mf({timeItems:r?.timeItems||[],itemType:nV});return!i||s&&e&&new Date(s).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function sG({matchUps:t,matchUpId:e}){if(!is(t))return{error:re};let i=t.find(o=>o.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:s}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:s}}function dy(t,e){if(!Ut(t))return{error:re};if(!Array.isArray(e))return{error:re};let i={};for(let{param:r,error:n,attr:a}of e){let s=kze({params:t,param:r,attr:a,error:n});if(s?.error)return s;i[r]=s}return i}function kze({params:t,param:e,attr:i,error:r}){if(e===aN&&Ut(t.drawDefinition)&&ai(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===Vu){let n=Lue({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:Gr,info:{param:e}}}function oG(t){let{structureId:e,matchUpId:i,event:r}=t,n=t.drawDefinition,a=He(t,[{[gr]:!0},{[D2]:{[iN]:!1,[Ol]:!1,[uae]:!1,[qc]:!1}}]);if(a[zs])return a;let s=dy(t,[{[qv]:Vu,[zs]:Je}])?.matchUp;if(i&&s?.error)return s;!n&&s?.drawDefinition&&(n=s?.drawDefinition);let o=s?.structure;if(!o&&e&&!i){if(!n)return{error:jo};let p=tt({drawDefinition:n,structureId:e});if(p.error)return p;o=p.structure}let l=o?.matchUpFormat,u=n?.matchUpFormat,c=r?.matchUpFormat,d=s?.matchUp?.matchUpFormat||l||u||c;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:c,drawDefaultMatchUpFormat:u,matchUpFormat:d}}function lG({profileBands:t,tournamentRecord:e,matchUps:i}){if(!is(i))return{error:Bu};let r=!t&&Ef({policyType:ic,tournamentRecord:e}).policy,n=t||r?.profileBands||Z2[ic].profileBands,a=i.filter(({winningSide:p})=>p),s=a.map(Qae),o=(p,f)=>{let h=Jae(f,n);return p[h]+=1,p},l=Zae(s).reduce((p,f)=>o(p,f),{[Q2]:0,[vw]:0,[yw]:0,[Wae]:0}),u=Object.keys(l).reduce((p,f)=>(l[f]||0)+p,0),c=Object.keys(l).map(p=>{let f=Number.parseFloat((l[p]/u).toFixed(4));return{[p]:f*100}}),d=a.filter(({matchUpStatus:p})=>p===Xq).length;return c.push({[Xq]:Number.parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...W}}var{stageOrder:O3}=S_e;function Oze(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(O3[t?.stage]||0)-(O3[e?.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function uG({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:s,withSplitRounds:o,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:re,inContextMatchUps:r};if(s&&!n){if(typeof s!="object")return{error:fU};n={[s.tournamentId]:s}}let f=typeof n!="object"||!Object.keys(n).length;if((d||u||!r||!a&&(t||i||a||o))&&f)return{error:Ci};let h=Object.assign({},...Object.values(n??{}).map(({venues:S=[],tournamentId:U})=>({[U]:S?.map(({venueId:T})=>T)}))),m=Object.values(n??{}).map(({events:S=[],tournamentId:U,startDate:T,endDate:D})=>S.map(P=>({...P,validVenueIds:h[U],startDate:P.startDate??T,endDate:P.endDate??D}))).flat(),{segmentedRounds:g,profileRounds:I}=n&&(t||i||a||o)&&pA({tournamentRecords:n,schedulingProfile:a})||{},v=t&&Object.assign({},...I.map(S=>({[S.id]:S}))),w=r||n&&_o({tournamentRecords:n,matchUpFilters:l})?.matchUps||[],y=[],b=w&&Object.values(w.reduce((S,U)=>{let T=EF(U).id,D=g?.[T],P=[...S[T]?.matchUps??[],U],{containerStructureId:E,stageSequence:R,structureName:C,tournamentId:M,isRoundRobin:N,matchUpType:A,roundNumber:O,roundOffset:k,structureId:F,eventName:x,roundName:L,drawName:$,eventId:V,drawId:_}=U,B=N?E:F;return{...S,[T]:{id:c?T:void 0,structureId:B,stageSequence:R,segmentsCount:D,structureName:C,tournamentId:M,matchUpType:A,roundNumber:O,roundOffset:k,eventName:x,roundName:L,drawName:$,matchUps:P,eventId:V,drawId:_}}},{})).map(S=>{let{minFinishingSum:U,winnerFinishingPositionRange:T}=Sze(S.matchUps),D=S.segmentsCount;if(D){let O=S.matchUps.length/D;return Sr(S.matchUps.sort((k,F)=>k.roundPosition-F.roundPosition),O).map((k,F)=>{let{unscheduledCount:x,incompleteCount:L,matchUpsCount:$,isScheduled:V,isComplete:_,byeCount:B}=A3(k),G=N3({matchUps:S.matchUps,tournamentRecords:n,events:m,round:S});return je({...S,...p,roundSegment:{segmentsCount:D,segmentNumber:F+1},winnerFinishingPositionRange:T,unscheduledCount:x,incompleteCount:L,minFinishingSum:U,matchUpsCount:$,isScheduled:V,roundTiming:G,isComplete:_,byeCount:B,matchUps:k})})}let{unscheduledCount:P,incompleteCount:E,matchUpsCount:R,isScheduled:C,isComplete:M,byeCount:N}=A3(S.matchUps),A=N3({matchUps:S.matchUps,tournamentRecords:n,events:m,round:S});return je({...S,...p,winnerFinishingPositionRange:T,unscheduledCount:P,incompleteCount:E,minFinishingSum:U,matchUpsCount:R,isScheduled:C,roundTiming:A,isComplete:M,byeCount:N})}).flat().filter(S=>{if(t){let F=Ze(t),x=c?S.id:EF(S).id;if(F&&v[x]&&Ze(v[x].scheduleDate)===F)return!1}let{isComplete:U,isScheduled:T}=S,D=!i||!U,P=!e||!T,E=d||u?m?.find(({eventId:F})=>F===S.eventId):void 0,R=E?.startDate??s?.startDate,C=E?.endDate??s?.endDate,M=!u||!R||new Date(u)>=new Date(R),N=!u||!C||new Date(u)<=new Date(C),A=M&&N,O=!d||E?.validVenueIds.includes(d),k=D&&P&&O&&A;return k||y.push(S),k}).sort(Oze)||[];return{...W,rounds:b,excludedRounds:y}}function Pw(t){let{matchUp:e,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=t||{},{matchUpFormat:s}=t||{};if(!e)return{error:pa};s=s||e?.matchUpFormat;let o=Xi(s),l=!!e?.winningSide,u=e.score?.sets,c=u?.length,d=r&&r-1,p=!!u?.find((B,G)=>B.setNumber===r&&G===d),f=u?.filter(B=>B?.winningSide)||[],h=f?.length||0,m=r&&u?.slice(r)||[],g=!!(c&&r&&m?.reduce((B,G)=>(!G||!G.side1Score&&!G.side2Score&&!G.side1TiebreakScore&&!G.side2TiebreakScore&&!G.side1PointScore&&!G.side2PointScore)&&B,!0)),I=r<=c&&u.find(B=>B.setNumber===r),v=I&&Tw({setObject:I,matchUpScoringFormat:o}),{isCompletedSet:w,sideGameScores:y,sideTiebreakScores:b}=v||{},S=!!(I&&!w&&g||r&&r===c+1&&!l),U=[1,2].includes(i),T=U?i-1:0,D=I&&U&&(!n&&!a&&y[T]!==void 0&&y[T]||n&&b[T]!==void 0&&b[T]),P=!!D,E=f?.map(B=>Tw({setObject:B,matchUpScoringFormat:o}).isValidSetOutcome).reduce((B,G)=>B&&G,!0),R=f.reduce((B,G)=>{let{winningSide:j}=G,Y=j-1;return B[Y]++,B},[0,0]),C=e?.winningSide,M=C&&C-1,N=1-M,A=R[M],O=R[N],k=Math.max(...R),F=Ra(R)[k],{bestOf:x,exactly:L}=o??{},$=Math.ceil((x||L||1)/2),V=k===$&&F===1&&R.indexOf(k)+1||void 0,_=A>O&&C===V;return{completedSetsHaveValidOutcomes:E,validMatchUpWinningSide:_,calculatedWinningSide:V,matchUpScoringFormat:o,validMatchUpOutcome:V&&E&&_,isLastSetWithValues:g,completedSetsCount:h,isCompletedMatchUp:l,isValidSideNumber:U,hasExistingValue:P,existingValue:D,isExistingSet:p,isActiveSet:S,...v}}function cG({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:f,contextProfile:h,drawDefinition:m,nextMatchUps:g,tournamentId:I,inContext:v,context:w,event:y}){let{eventId:b,eventName:S,endDate:U,eventType:T,category:D,gender:P}=y??{},E={...w,...je({surfaceCategory:y?.surfaceCategory??o?.surfaceCategory,indoorOutDoor:y?.indoorOutdoor??o?.indoorOutdoor,endDate:U??y?.endDate??o?.endDate,tournamentId:I??o?.tournamentId,eventName:S,eventType:T,category:D,eventId:b,gender:P})},R;return!t?.length&&o&&({participants:t,participantMap:p,groupInfo:R}=Pf({participantsProfile:r,useParticipantMap:s,tournamentRecord:o,contextProfile:h,inContext:v})),y&&h&&!c&&(c=Xc({policyDefinitions:a,tournamentRecord:o,contextProfile:h,drawDefinition:m,event:y})),{...ey({context:E,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:f,contextProfile:h,drawDefinition:m,nextMatchUps:g,inContext:v,event:y}),groupInfo:R}}var zue={};ft(zue,{getCompetitionVenues:()=>fT,getCourts:()=>dG,getVenuesAndCourts:()=>Hu,publicFindVenue:()=>lV});function dG({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=xe(r.courts||[]);return a.forEach(s=>Object.assign(s,{venueId:n})),a}).flat()}:{error:Ie}}var que={};ft(que,{categoryCanContain:()=>TU,getCategoryAgeDetails:()=>zp,getEvent:()=>hG,getEventProperties:()=>pG,getEventStructures:()=>kN,getEventTimeItem:()=>_U,getEvents:()=>fG,getFlightProfile:()=>Vi,getScaledEntries:()=>ug});function pG({tournamentRecord:t,event:e}){if(!t)return{error:Ie};if(!e)return{error:ci};let i=e.entries||[],r=t.participants||[],n=e.category?.categoryName||e.category?.ageCategoryCode,{eventType:a}=e,s=new Set(i.map(d=>d.participantId)),o=r.filter(d=>s.has(d.participantId)),l,u,c;return{entryScaleAttributes:o.map(d=>{let{participantId:p,participantName:f,name:h}=d,m={scaleType:sV,eventType:a,scaleName:n},g=su({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;m={scaleType:lse,eventType:a,scaleName:n};let I=su({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;m={scaleType:ose,eventType:a,scaleName:n};let v=su({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;return l=!!(l||g),u=!!(u||I),c=!!(c||v),{participantId:p,participantName:f||h,seed:g,ranking:I,rating:v}}),hasSeededParticipants:l,hasRankedParticipants:u,hasRatedParticipants:c}}function fG({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:s}){if(!t)return{error:Ie};let{tournamentId:o}=t,l=(t.events??[]).filter(({eventId:c})=>!n||Array.isArray(n)&&n.includes(c)).map(c=>{let d=c.drawDefinitions?.map($I);if(a?.length&&!_i(a,d).length)return;let p=xe(c);return r&&Object.assign(p,{tournamentId:o}),s&&Object.assign(p,s),p}).filter(Boolean),u={};if(e){let c=Ei({withScaleValues:!0,tournamentRecord:t}).participantMap,d=p=>p.reduce((f,h)=>f+Number.parseFloat(h),0);for(let p of l){let f=i??p.eventType,h=p.eventId;u[h]||(u[h]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let m=(p.entries??[]).filter(({entryStatus:S})=>mo.includes(S)).map(wt),g=S=>{if(S?.ratings?.[f])for(let U of S?.ratings?.[f]??[]){let T=U.scaleName;u[h].ratings[T]||(u[h].ratings[T]=[]);let D=Er[T]?.accessor;if(D){let P=Number.parseFloat(U.scaleValue?.[D]);P&&u[h].ratings[T].push(P)}}if(S?.rankings?.[f])for(let U of S?.rankings?.[f]??[]){let T=U.scaleName;u[h].ranking[T]||(u[h].ranking[T]=[]),U.scaleValue&&u[h].ranking[T].push(U.scaleValue)}};for(let S of m){let U=c?.[S]?.participant;if(U?.participantType===yt)g(U);else for(let T of U?.individualParticipantIds??[]){let D=c?.[T]?.participant;g(D)}}let I=u[h].ratings;for(let S of Object.keys(I)){let U=I[S];if(!U.length)continue;let T=Bq(U)?.toFixed(2);u[h].ratingsStats[S]={avg:Number.parseFloat((d(U)/U.length).toFixed(2)),median:T?Number.parseFloat(T):void 0,max:Math.max(...U),min:Math.min(...U)}}let v=(S,U)=>{let T=D=>{if(u[h].draws?.[S]&&D?.ratings?.[f])for(let P of D?.ratings?.[f]??[]){let E=P.scaleName;u[h].draws[S]?.ratings[E]||(u[h].draws[S].ratings[E]=[]);let R=Er[E]?.accessor;if(R){let C=Number.parseFloat(P.scaleValue?.[R]);C&&u[h].draws[S].ratings[E].push(C)}}if(u[h].draws?.[S]&&D?.rankings?.[f])for(let P of D?.rankings?.[f]??[]){let E=P.scaleName;u[h].draws[S]?.ranking[E]||(u[h].draws[S].ranking[E]=[]);let R=P.scaleValue;R&&u[h].draws[S].ranking[E].push(R)}};for(let D of U.filter(Boolean)){let P=c?.[D]?.participant;if(P?.participantType===yt)T(P);else for(let E of P?.individualParticipantIds??[]){let R=c?.[E]?.participant;T(R)}}},w=[],y=S=>a?.length&&a.includes(S)||w.includes(S);for(let S of p.drawDefinitions??[]){let U=S.drawId;if(y(U))continue;let T=Af({drawDefinition:S}).assignedParticipantIds??[];u[h].draws[U]||(u[h].draws[U]={ratingsStats:{},ratings:{},ranking:{}}),w.push(U),v(U,T)}let b=Vi({event:p}).flightProfile;for(let S of b?.flights??[]){let U=S.drawId;if(y(U))continue;let T=S.drawEntries.map(wt);v(U,T)}for(let S of w){let U=u[h].draws[S].ratings;for(let T of Object.keys(U)){let D=U[T];if(!D.length)continue;let P=Bq(D)?.toFixed(2);u[h].draws[S].ratingsStats[T]={avg:Number.parseFloat((d(D)/D.length).toFixed(2)),median:P?Number.parseFloat(P):void 0,max:Math.max(...D),min:Math.min(...D)}}}}}return je({eventScaleValues:u,events:l,...W})}function hG({tournamentRecord:t,drawDefinition:e,context:i,event:r}){if(!t)return{error:Ie};if(!r)return{error:ci};let n=xe(r);i&&Object.assign(n,i);let a=e&&n.drawDefinitions?.find(({drawId:s})=>e.drawId===s);return je({drawDefinition:a,event:n})}function xze(t){let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=_ze(t),n=$ze({...t,policyDefinitions:r,appliedPolicies:i}),a=Lze(t),s=Bze({...t,consideredEntries:a,appliedPolicies:i});if(s?.error)return q({result:s,stack:e});let o=Vze({...t,consideredEntries:a}),l=Fze({...t,appliedPolicies:i,policyDefinitions:r,drawSize:o});if(l.error)return q({result:l,stack:e});let u=l.drawType;if(isNaN(o)&&u!==ma)return q({result:{error:gU},stack:e});let c=r?.[As]??i?.[As],d=t.seedingProfile??c?.seedingProfile?.drawTypes?.[u??""]??c?.seedingProfile;t.seedingProfile&&(r[As]||(r[As]={...PF[As]}),r[As].seedingProfile=d);let p=jze({...t,drawType:u});return p?.error?q({result:p,stack:e}):{drawSize:o,drawType:u,enforceGender:n,seedingProfile:d,appliedPolicies:i,policyDefinitions:r}}function Fze(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??mT({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),s=Sle({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return s.error?s:{drawType:s.drawType}}function Yue(t){return t?.filter(e=>e.entryStatus&&[...mo,WU].includes(e.entryStatus))}function Lze({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||Yue(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===ke)}function _ze(t){let{tournamentRecord:e,event:i}=t,r={...t?.appliedPolicies,...Ct({tournamentRecord:e,event:i}).appliedPolicies??{}},n=xe(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function $ze({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){return t??e?.[Nr]?.participants?.enforceGender??i?.[Nr]?.participants?.enforceGender}function Bze(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:s,event:o}=t;return o&&s&&WN({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:s,event:o})}function Vze(t){return!t.drawSize&&t.consideredEntries.length&&![ma,EU,zv,no,Pu].includes(t.drawType??"")&&$v(t.consideredEntries.length)||t.drawSize&&Ke(t.drawSize)||!1}function jze(t){let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:r,drawType:n}=t,a=!r&&e&&aA({tournamentRecord:e,categoryType:i?.category?.categoryType,categoryName:i?.category?.categoryName});return a?.length&&!a.includes(n)?{error:kB}:{...W}}function Kue(t){let{drawDefinition:e,appliedPolicies:i}=t,r=i?.[Rc],n=xr({drawDefinition:e});return e.structures?.forEach(a=>{let s=Ad({structureId:a.structureId,matchUpsMap:n}),o=Xae({roundNamingPolicy:r,drawDefinition:e,structure:a,matchUps:s}),{roundNamingProfile:l,roundProfile:u}=o;(a.structures||[a]).forEach(c=>{(c.matchUps??[]).forEach(d=>{let p=d?.roundNumber?.toString();if(p){let f=l?.[p]?.roundName,h=l?.[p]?.abbreviatedRoundName,m=u?.[p]?.feedRound;Object.assign(d,{abbreviatedRoundName:h,feedRound:m,roundName:f})}})})}),{drawDefinition:e}}function ST(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:s}=Ei({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),o=Yue(r?.entries)??[],l=xze({...t,participantMap:s,participants:a,eventEntries:o});if(l.error)return q({result:l,stack:n});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:f,seedingProfile:h}=l,m=r?.eventType,g=t.matchUpType??m,I=xWe({...t,enforceGender:f,eventType:m,matchUpType:g});if(I.error)return q({result:I,stack:n});let{matchUpFormat:v,tieFormat:w}=I;if(t.drawId&&typeof t.drawId!="string")return q({result:{error:re},stack:n});let y=uze({...t,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:v,seedingProfile:h,participants:a,eventEntries:o,matchUpType:g,tieFormat:w,drawSize:d,drawType:p,event:r});if(y.error)return q({result:y,stack:n});let{existingDrawDefinition:b,positioningReports:S,drawDefinition:U,structureId:T,conflicts:D,entries:P}=y;if(!U)return q({result:{error:re},stack:n});let E=cze({...t,existingDrawDefinition:b,positioningReports:S,appliedPolicies:u,drawDefinition:U,seedingProfile:h,participants:a,structureId:T,entries:P,params:t,stack:n});if(E.error)return E;let{qualifyingConflicts:R}=E;return U.drawName=t.drawName??(p&&Zr(p)),d&&typeof e=="object"&&d>=4&&UV({...e,drawDefinition:U,matchUpType:g}),t.hydrateRoundNames&&u?.[Rc]&&Kue({drawDefinition:U,appliedPolicies:u}),{existingDrawDefinition:!!b,qualifyingConflicts:R,positioningReports:S,drawDefinition:U,structureId:T,...W,conflicts:D}}function Gze({matchUps:t,matchUpType:e}){if(!t)return{error:Bu};let i=[],r=[],n=0;e&&(t=t.filter(T=>T.matchUpType===e));let a=lt(t.map(({matchUpType:T})=>T));if(a.length>1)if(wh(a,ti))t=t.filter(Di(ti));else if(wh(a,qt))t=t.filter(Di(qt));else if(wh(a,Vt))t=t.filter(Di(Vt));else return{};if(!is(t)||!t.length)return{};let s=(T,D)=>Ke(T)-Ke(D),o=lt(t.flatMap(T=>T.drawPositions).filter(Boolean)).sort(s),l=Ce(1,Math.max(...o)+1).filter(T=>!o.includes(T)).sort(s),{roundMatchUps:u}=Un({matchUps:t}),c=u?.[1],d=u?.[2]??[],p=c?.[0],f=p?.drawId,h=p?.structureId,m=u?Object.keys(u).map(T=>Ke(T)):[],g=Math.max(...m),I=u?.[g]?.length??0,v=Math.ceil(Math.log(I)/Math.log(2)),w=Ce(1,v+1).map(T=>{let D=Math.pow(2,T-1),P=g+v-T+1;return Ce(1,D+1).map(E=>({drawId:f,structureId:h,matchUpId:Et(),drawPositions:[],sides:[],roundNumber:P,roundPosition:E,finishingRound:T}))});v&&(t=t.concat(...w.flat()));let y=c?.map(T=>T.drawPositions)?.flat(1/0),b=d.map(T=>T.drawPositions).flat(1/0).filter(T=>!y?.includes(T)).sort(s),S=d.filter(T=>T.drawPositions?.find(D=>b.includes(D))).map(T=>{let D=T.drawPositions?.find(R=>b.includes(R)),P=D&&T.drawPositions?.indexOf(D),E=P!==void 0&&T.sides?.[P];return D&&{[D]:E}});if(l?.length&&b?.length===l?.length){let T=b.map((R,C)=>[R,l[C]].sort(s)),D=Object.assign({},...S),P=xe(c?.[0].finishingRound,!1,!0),E=xe(c?.[0].finishingPositionRange,!1,!0);r=T.map((R,C)=>{let M=Math.max(...R||[])/2,N=R?.map(A=>D[A]||{bye:!0,drawPosition:A});return{finishingPositionRange:E,sideNumber:C+1,matchUpStatus:"BYE",matchUpId:Et(),finishingRound:P,roundNumber:1,drawPositions:R,roundPosition:M,structureId:h,drawId:f,sides:N}}),t=t.concat(...r)}let U=g+v;return Ce(1,U+1).forEach(T=>{let D=[],P=x3({matchUps:t,roundNumber:T}),E=x3({matchUps:t,roundNumber:T-1}),R=new Set(E.map(Hze).filter(Boolean)),C=P?.length===i?.length,M=P?.length===i?.length/2;T===1&&P.forEach(N=>{let A=N.drawPositions||[],{matchUpId:O,structureId:k}=N,F=[{...N.sides[0],drawPosition:A[0],matchUpId:O,structureId:k},{...N.sides[1],drawPosition:A[1],matchUpId:O,structureId:k}],x={...N,children:F};D.push(x)}),C?(n++,P.forEach((N,A)=>{let O=N.drawPositions||[],{matchUpId:k,structureId:F}=N,x=O.filter(Boolean).reduce((V,_)=>y?.includes(_)?V:_,void 0),L=[{...N.sides.filter(Boolean).reduce((V,_)=>_.participantId&&!R.has(_.participantId)?_:V,void 0),drawPosition:x,feedRoundNumber:n,sides:N.sides,matchUpId:k,structureId:F},i[A]],$={...N,children:L};D.push($)})):M&&P.forEach((N,A)=>{let O=[i[A*2],i[A*2+1]],k={...N,children:O};D.push(k)}),i=D}),{hierarchy:i[0],missingMatchUps:r,maxRound:g,finalRound:U,matchUps:t}}function x3({matchUps:t,roundNumber:e}){return t.filter(i=>i.roundNumber===e).sort((i,r)=>i.roundPosition-r.roundPosition)}function Hze(t){if(t.matchUpStatus==="BYE")return t.sides.reduce((e,i)=>i.participantId||e,void 0);if(t.winningSide)return t.sides.reduce((e,i)=>i.sideNumber===t.winningSide?i.participantId:e,void 0)}function Xue({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Je,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:o},l)=>({[o]:l+1})));n=n||t.scaleName;let s=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:o})=>({scaleItems:[{scaleValue:a[o],eventType:t.eventType,scaleType:nu,scaleName:n,scaleDate:s}],participantId:o}))}}function Wze({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:s,event:o,stage:l,sortDescending:u,scaleSortMethod:c}){let d=hA({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:s,event:o,stage:l});if(d.error)return d;let{entries:p,seedsCount:f,stageEntries:h}=d;if(!h||!f)return{error:re};let m=ug({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=Xue({scaleAttributes:r,scaledEntries:m,stageEntries:h,seedsCount:f,scaleName:n});return{scaleItemsWithParticipantIds:g}}var Jue={};ft(Jue,{addDrawEntries:()=>vV,addEventEntries:()=>sl,addEventEntryPairs:()=>ice,destroyPairEntries:()=>Jse,destroyPairEntry:()=>SV,getEntriesAndSeedsCount:()=>hA,getMaxEntryPosition:()=>Zj,modifyEntriesStatus:()=>bE,modifyEventEntries:()=>rce,mutate:()=>Que,promoteAlternate:()=>ece,promoteAlternates:()=>gG,query:()=>Vue,removeDrawEntries:()=>tce,removeEventEntries:()=>tT,setEntryPosition:()=>mG,setEntryPositions:()=>Zue});var Que={};ft(Que,{addDrawEntries:()=>vV,addEventEntries:()=>sl,addEventEntryPairs:()=>ice,destroyPairEntries:()=>Jse,destroyPairEntry:()=>SV,modifyEntriesStatus:()=>bE,modifyEventEntries:()=>rce,promoteAlternate:()=>ece,promoteAlternates:()=>gG,removeDrawEntries:()=>tce,removeEventEntries:()=>tT,setEntryPosition:()=>mG,setEntryPositions:()=>Zue});function mG({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let s="setEntryPositions";if(!t)return{error:Ie};if(!i)return q({result:{error:pr},stack:s});if(r!==void 0&&!Number.isSafeInteger(r))return{error:re,entryPosition:r};(a?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),(e?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let o=l=>{l.entries.forEach(u=>{u.entryPosition===r&&u.participantId!==i&&(u.entryPosition+=.1)})};return n||(a?.entries&&(o(a),a.entries=Ro({entries:a.entries})),e?.entries&&(o(e),e.entries=Ro({entries:e.entries}))),{...W}}function Zue({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:Ie};if(!Array.isArray(e))return{error:re};for(let n of e){let{participantId:a,entryPosition:s}=n,o=mG({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:s,event:r});if(o.error)return o}return r?.entries&&(r.entries=Ro({entries:r.entries})),i?.entries&&(i.entries=Ro({entries:i.entries})),{...W}}function ece(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:re,participantId:e}:gG({...t,participantIds:[e].filter(Boolean)})}function gG({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=ke,eventId:a,event:s}){if(!t)return{error:Ie};if(!Array.isArray(i))return{error:re,participantIds:i};if(!s)return{error:ci};let o="promoteAlternates";if(s){let l=F3({element:s,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=F3({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?q({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...W},stack:o}):l}return{...W}}function F3({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===qs),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),s=n.reduce((d,p)=>{let{entryPosition:f}=p;return isNaN(f)&&d||(!d||f<d.entryPosition)&&p||d},void 0),o=a.length?a:[s].filter(Boolean);if(!o?.length)return{error:mre};let l=o.filter(({entryStatus:d})=>d!==qs);if(l.length)return{error:jx,invalidEntryStatus:l};let u=o.filter(({entryStage:d})=>d&&d!==r);if(u.length)return{error:QLe,invalidStage:u};let c=e&&o.filter(d=>d.stageSequence!==e);if(c?.length)return{error:ZLe,invalidStageSequence:c};for(let d of o){d.entryStatus=ga;let p=d?.entryPosition;isNaN(p)||i.entries.forEach(h=>{h.entryStatus===qs&&h.entryPosition>p&&(h.entryPosition=h.entryPosition-1)});let f=Math.max(...i.entries.filter(h=>h.entryStatus===ga&&!isNaN(h.entryPosition)).map(({entryPosition:h})=>Ke(h||0)),0);d.entryPosition=f||0}return{...W}}function tce({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){if(!a)return{error:ci};if(!r)return{error:jo};if(!e?.length)return{error:Jd};let s=Af({drawDefinition:i,stages:n}).assignedParticipantIds??[];if($n(s,e))return{error:Gv};let o=c=>{let d=c.participantId;return!e.includes(d)},{flightProfile:l}=Vi({event:a}),u=l?.flights?.find(c=>c.drawId===r);return u?.drawEntries&&(u.drawEntries=u.drawEntries.filter(o),t&&(u.drawEntries=Ro({entries:u.drawEntries}))),i?.entries&&(i.entries=i.entries.filter(o),t&&(i.entries=Ro({entries:i.entries}))),{...W}}function Dl(t){let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:s}=t,o=t.tournamentId?t.tournamentRecords?.[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&t.tournamentRecords?.[t.activeTournamentId]);if(!o)return{error:Ie};if(!s)return q({result:{error:Vm},stack:e});s.participantId||(s.participantId=Et()),o.participants||(o.participants=[]);let{participantId:l,individualParticipantIds:u}=s;if(o.participants.reduce((m,g)=>g.participantId===l||m,!1))return{error:cre};let{participantType:c,participantRole:d}=s;if(!c||!Object.keys(pb).includes(c))return{error:Lo,participantType:c};if(!d)return{error:lre};let p=o.participants||[],f=p.filter(m=>m.participantType===yt).map(m=>m.participantId);if(c!==yt&&s.person)return{error:re,person:s.person};if(u&&!Array.isArray(u))return{error:re,individualParticipantIds:u};if(c===mt){if(s.person)return{error:re,person:s.person};if(s.individualParticipantIds){if(s.individualParticipantIds.length!==2&&!a)return q({info:"PAIR must be 2 individualParticipantIds",result:{error:Ua},stack:e});{let I=p.filter(v=>v.participantType===yt).map(v=>v.participantId);if(!Array.isArray(s.individualParticipantIds))return q({result:{error:Ua},stack:e});if(!s.individualParticipantIds.reduce((v,w)=>I.includes(w)&&v,!0))return q({result:{error:Ua},stack:e})}}else return q({result:{error:Jd},stack:e});let m=p.filter(I=>I.participantType===mt).map(I=>({individualParticipantIds:I.individualParticipantIds,participant:I})),g=s.participantType===mt&&m.find(I=>_i(I.individualParticipantIds,s.individualParticipantIds).length===2);if(g&&!i)return{...W,existingParticipant:!0,participant:r&&xe(g.participant)};if(!s.participantName){let I=p.filter(w=>s.individualParticipantIds?.includes(w.participantId)),v=I.map(w=>w.person?.standardFamilyName).filter(Boolean).join("/");I.length===1&&(v+="/Unknown"),s.participantName=v}}else if(c===yt){if(!s.person?.standardFamilyName||!s.person?.standardGivenName)return{error:hre};if(!s.participantName){let m=`${s.person.standardFamilyName.toUpperCase()}, ${s.person.standardGivenName}`;s.participantName=m}}else if(c&&[$t,ts].includes(c)){if(u||(s.individualParticipantIds=[]),s.individualParticipantIds?.length)for(let m of s.individualParticipantIds){if(typeof m!="string")return q({result:{participantId:m,error:re},stack:e});if(!f.includes(m))return q({result:{participantId:m,error:Gi},stack:e})}}else return{error:Lo};o.participants.push(s),n||at({payload:{tournamentId:o.tournamentId,participants:[s]},topic:Md});let h={participant:r&&xe(s),...W};return je(h)}function lo({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:Ie};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=Et())});let a=r.filter(d=>!n.includes(d.participantId)),s=r.filter(d=>n.includes(d.participantId)),o=a.filter(d=>d.participantType===yt),l=a.filter(d=>d.participantType!==yt),u=o.concat(...l),c=[];if(u.length){for(let p of u){let f=Dl({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(f.error)return f;f.success&&!f.existingParticipant&&c.push(f.participant)}c.length&&at({topic:Md,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&xe(c),addedCount:c.length,...W};return s.length&&Object.assign(d,{notAdded:s,info:BM}),je(d)}else return{info:"No new participants to add",addedCount:0,...W}}function ice(t){let e=He(t,[{[gr]:!0,[qc]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=qs,participantIdPairs:n=[],entryStage:a=ke,tournamentRecord:s,drawDefinition:o,event:l,uuids:u}=t;if(l.eventType!==Vt)return{error:bu};let c=[],d=new Map;for(let y of s.participants??[]){let{participantType:b,participantId:S,person:U,individualParticipantIds:T}=y;b===yt&&U?.sex?d.set(S,U.sex):b===mt&&T&&c.push(T)}let p=n.filter(y=>{if(y.length!==2)return!0;if(!l.gender||wu(l.gender))return!1;if(!d.has(y[0])||!d.has(y[1]))return!0;let b=y.map(U=>d.get(U)),S=rh(l.gender)&&(!rh(b[0])||!rh(b[1]))||gp(l.gender)&&(!gp(b[0])||!gp(b[1]));return Ba(l.gender)&&(b.sort(CN),(!gp(b[0])||!rh(b[1]))&&(S=!0)),S});if(p.length)return{error:Ua,invalidParticipantIdPairs:p};let f=n.map(y=>({participantId:u?.pop()??Et(),participantRole:Qr,individualParticipantIds:y,participantType:mt})),h=i?f:f.filter(y=>!c.find(b=>_i(b,y.individualParticipantIds).length===2)),m,g=[];if(h){let y=lo({allowDuplicateParticipantIdPairs:i,participants:h,returnParticipants:!0,tournamentRecord:s});if(y.error)return y;g=y.participants||[],m=y.info}let I=n.map(y=>{let b=g.find(U=>_i(U.individualParticipantIds,y).length===2);if(b)return b;let{participant:S}=oo({tournamentRecord:s,participantIds:y});return S}).map(y=>y.participantId),v=sl({participantIds:I,tournamentRecord:s,drawDefinition:o,entryStatus:r,entryStage:a,event:l});h.length&&at({payload:{participants:h},topic:Md});let w=h.map(wt);return{...v,info:m,newParticipantIds:w}}function rce({entryStatus:t=ga,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=ke,tournamentRecord:n,event:a}){if(!n)return{error:Ie};if(!a)return{error:ci};let s=n.participants??[],o=s.filter(m=>m.participantType===yt).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!o.includes(m));if(l.length)return{error:Ua,invalidParticipantIds:l};let u=i.filter(m=>m.length!==2);if(u.length)return{error:Ua,invalidParticipantIdPairs:u};let c=s.filter(m=>m.participantType===mt).map(m=>m.individualParticipantIds),d=i.filter(m=>!c.find(g=>_i(g,m).length===2)).map(m=>({participantType:mt,participantRole:Qr,individualParticipantIds:m})),p=lo({participants:d,tournamentRecord:n});if(p.error)return p;let f=i.map(m=>{let{participant:g}=oo({tournamentRecord:n,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:r})),h=e.map(m=>({entryStatus:Es,participantId:m,entryStage:r}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===r),a.entries=a.entries.concat(...f,...h),{...W}}var nce={};ft(nce,{addDrawDefinition:()=>UT,addEvent:()=>py,addFlight:()=>SA,assignSeedPositions:()=>Ice,attachFlightProfile:()=>UG,categoryCanContain:()=>TU,deleteDrawDefinitions:()=>yA,deleteEvents:()=>yce,deleteFlightAndFlightDraw:()=>mce,deleteFlightProfileAndFlightDraws:()=>cce,generate:()=>ace,generateEventsFromTieFormat:()=>oce,getCategoryAgeDetails:()=>zp,getEvent:()=>hG,getEventProperties:()=>pG,getEventStructures:()=>kN,getEventTimeItem:()=>_U,getEvents:()=>fG,getFlightProfile:()=>Vi,getScaledEntries:()=>ug,modifyEvent:()=>bce,modifyEventMatchUpFormatTiming:()=>dce,modifyPairAssignment:()=>gce,mutate:()=>lce,query:()=>que,refreshEventDrawOrder:()=>SG,removeEventMatchUpFormatTiming:()=>bA,removeScaleValues:()=>TG,removeSeeding:()=>vce,setEventDates:()=>bG,setEventDisplay:()=>wA,setEventEndDate:()=>yG,setEventStartDate:()=>vG,updateDrawIdsOrder:()=>wG,validateCategory:()=>uw});var ace={};ft(ace,{generateEventsFromTieFormat:()=>oce});function zze({tournamentId:t,event:e}){return e?(at({payload:{tournamentId:t,event:e},key:e.eventId,topic:Mae}),{...W}):{error:ci}}var qze={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},Yze={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},Kze={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},sce={COLLEGE_D3:qze,COLLEGE_DEFAULT:Yze,COLLEGE_JUCO:Kze,DOMINANT_DUO:Une,DOMINANT_DUO_MIXED:vne,LAVER_CUP:Rne,TEAM_DOUBLES_3_AGGREGATION:fne,TIME_TENNIS_DUAL:yne,TIME_TENNIS_PRO_CIRCUIT:Ine,USTA_BREWER_CUP:bne,USTA_OZAKI_CUP:wne,USTA_COLLEGE:Tne,USTA_GOLD_TEAM_CHALLENGE:pne,USTA_INTERSECTIONAL:gne,USTA_LEVEL_1:Dne,USTA_SECTION_BATTLE:mne,USTA_SOUTHERN_LEVEL_5:hne,USTA_TOC:Cne,USTA_WTT_ITT:Pne,USTA_ZONAL:Ene};function py({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){if(!e)return{error:Ie};if(e.events||(e.events=[]),!r)return{error:ci};let{startDate:n,endDate:a}=e;if(!i&&(r.entries?.length||r.drawDefinitions?.length)){let o=je({drawDefinitions:!!r.drawDefinitions?.length,entries:!!r.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:re,context:o}}let s={eventType:Yh,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===Ca){if(r.tieFormat){let o=qn({tieFormat:r.tieFormat});if(o.error)return o}else if(r.tieFormatName){if(!sce[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:re};let o=Pc({isMock:e?.isMock,namedFormat:r.tieFormatName,event:r});s.tieFormat=o}}if(s.eventId||(s.eventId=Et()),e.events.reduce((o,l)=>o||l.eventId===s.eventId,void 0))return{error:Bie};{let o=s;if(e.events.push(o),!t){let{topics:l}=Ts();if(l.includes(fN)){let d=Gu({event:r}).matchUps??[];Nd({tournamentId:e?.tournamentId,eventId:r.eventId,matchUps:d})}let{drawDefinitions:u,...c}=r;for(let d of u||[])xU({drawDefinition:d});zze({tournamentId:e?.tournamentId,event:c})}return{...W,event:s}}}function oce(t){let e=He(t,[{[FI]:{[rN]:!0,[rae]:!0}},{[gr]:!0}]);if(e.error)return e;let i=t.tieFormat||Pc({namedFormat:t.tieFormatName}),r=t.uuids||[dne(i.collectionDefinitions.length)],n={[er]:[],[_r]:[]};if(t.addEntriesFromTeams){let s=t.tournamentRecord.participants?.filter(o=>o.participantType===Gn)?.flatMap(o=>o.individualParticipantIds??[]);for(let o of t.tournamentRecord.participants??[])if(s?.includes(o.participantId)){let l=o.person?.sex;if(l&&vl(l)){let u=un(l);u&&n[u].push(o.participantId)}}}let a=[];for(let s of i.collectionDefinitions??[]){let o=r?.pop()?.toString()||Et(),l=s.matchUpType,u=s.gender,c={matchUpFormat:s.matchUpFormat,eventName:s.collectionName,category:s.category,gender:u,eventType:l,eventId:o};if(t.addEntriesFromTeams){let d=l===Ec?Es:t.entryStatus||ga,p=Ba(u)?[...n[er],...n[_r]]:n[un(u)||tc]??[];if(p.length){let f=sl({participantIds:p,entryStatus:d,event:c});if(f.error)return f}}if(a.push(c),t.addEvents!==!1){let d=py({internalUse:!0,tournamentRecord:t.tournamentRecord,event:c});if(d.error)return d}}return{...W,events:a}}var lce={};ft(lce,{addDrawDefinition:()=>UT,addEvent:()=>py,addFlight:()=>SA,assignSeedPositions:()=>Ice,attachFlightProfile:()=>UG,deleteDrawDefinitions:()=>yA,deleteEvents:()=>yce,deleteFlightAndFlightDraw:()=>mce,deleteFlightProfileAndFlightDraws:()=>cce,modifyEvent:()=>bce,modifyEventMatchUpFormatTiming:()=>dce,modifyPairAssignment:()=>gce,refreshEventDrawOrder:()=>SG,removeEventMatchUpFormatTiming:()=>bA,removeScaleValues:()=>TG,removeSeeding:()=>vce,setEventDates:()=>bG,setEventDisplay:()=>wA,setEventEndDate:()=>yG,setEventStartDate:()=>vG,updateDrawIdsOrder:()=>wG,validateCategory:()=>uw});function fy({removePriorValues:t=!0,status:e=rs,statusObject:i,event:r}){if(!Ut(i))return{error:re};let n=Fa({event:r,status:e}),a=`${rp}.${np}`,s={itemValue:{[e]:{...n,...i}},itemType:a};return og({timeItem:s,removePriorValues:t,event:r})}function hy(t){let e=He(t,[{[gr]:!0,[qc]:!0},{eventDataParams:!1,[Jn]:Zn}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=rs,event:s,drawIdsToRemove:o,drawIdsToAdd:l}=t,{appliedPolicies:u}=Ct({tournamentRecord:n,event:s}),c={...u,...t.policyDefinitions},d=s?.drawDefinitions?.map(({drawId:b})=>b)??[],p=t.drawDetails?Object.keys(t.drawDetails):[],f=p.length?[]:t.drawIds,h=(l??[]).concat(...o??[],...f??[],...p),m=h.filter(b=>!d.includes(b));if(m.length)return q({result:{error:za},context:{invalidDrawIds:m}});if(t.drawDetails)for(let b of Object.keys(t.drawDetails)){let S=t.drawDetails[b];if(S.publishingDetail?.embargo&&!cd(S.publishingDetail.embargo))return{error:Bg};if(S.stageDetails){for(let U of Object.keys(S.stageDetails))if(S.stageDetails[U].embargo&&!cd(S.stageDetails[U].embargo))return{error:Bg}}if(S.structureDetails)for(let U of Object.keys(S.structureDetails)){let T=S.structureDetails[U];if(T.embargo&&!cd(T.embargo))return{error:Bg};if(T.scheduledRounds){for(let D of Object.keys(T.scheduledRounds))if(T.scheduledRounds[D].embargo&&!cd(T.scheduledRounds[D].embargo))return{error:Bg}}}}let g=Fa({event:s,status:a}),I=Object.keys(g?.drawDetails||{}).filter(b=>d.includes(b)).reduce((b,S)=>(b[S]=g.drawDetails[S],b),{});for(let b of d)if((!h.length||h.includes(b))&&(o?.includes(b)||f?.length&&!f.includes(b)?I[b]={...I[b],publishingDetail:{published:!1}}:(l?.includes(b)||f?.includes(b)||!f?.length)&&(I[b]={...I[b],publishingDetail:{published:!0}})),t.drawDetails?.[b]){let S=t.drawDetails[b],U=S.structureDetails??I[b].structureDetails,T=S.stageDetails??I[b].stageDetails??{},{structureIdsToRemove:D=[],structureIdsToAdd:P=[],publishingDetail:E={},stagesToRemove:R=[],stagesToAdd:C=[]}=S;if((P||C)&&(E.published=!0),I[b]={publishingDetail:E,structureDetails:U,stageDetails:T},P.length||D.length){let N=(s?.drawDefinitions?.find(O=>O.drawId===b)?.structures??[]).map(({structureId:O})=>O),A=(P??[]).concat(D??[]).filter(O=>!N.includes(O));if(A.length)return q({result:{error:yi},context:{invalidStructureIds:A}});U=U??{};for(let O of N)D.includes(O)?U[O]={published:!1}:U[O]={published:!0};I[b].structureDetails=U}let M=(s?.drawDefinitions?.find(N=>N.drawId===b)?.structures??[]).map(({stage:N})=>N);if(C.length){for(let N of C)T[N]={published:!0};for(let N of M)T[N]||(T[N]={published:!1})}if(C.length||R.length){for(let N of R)T[N]={published:!1};for(let N of M)T[N]||(T[N]={published:!0})}(C.length||R.length)&&(I[b].stageDetails=T)}fy({statusObject:{drawDetails:I},removePriorValues:r,status:a,event:s});let{topics:v}=Ts(),w=v.includes(tF),y=w||t.returnEventData?hT({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:c,event:s})?.eventData:void 0;return w&&at({payload:{eventData:y,tournamentId:n.tournamentId},topic:tF}),{...W,eventData:y}}var uce="deleteDrawDefinitions",RF="autoSchedulingAudit",jD="deleteEvents",Xze={AUTO_SCHEDULING_AUDIT:RF,DELETE_EVENTS:jD,DELETE_DRAW_DEFINITIONS:uce};function yA(t){if(!t.tournamentRecord)return{error:Ie};let e="deleteDrawDefinitions",i=t.drawIds??[],r=t.event,{autoPublish:n=!0,tournamentRecord:a,auditData:s,eventId:o,force:l}=t,{appliedPolicies:u}=Ct({tournamentRecord:a,event:r}),c={...u,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!r){let T=Kn({tournamentRecord:a,eventId:o,drawId:d});if(T.error)return T;r=T.event}let p=[],f=[],h=[];if(!r?.drawDefinitions)return q({info:"event has no drawDefinition",result:{...W},stack:e});let m=r.drawDefinitions.map(({drawId:T})=>T);if(i.length||(i=m),i=i.filter(T=>m.includes(T)),!i.length)return q({info:"nothing to do; no matching drawIds in event.",result:{...W},stack:e});let g=xe(Vi({event:r}).flightProfile,!1,!0),I=({participantId:T,drawPosition:D,qualifier:P,bye:E})=>({bye:E,qualifier:P,drawPosition:D,participantId:T}),v=l??u?.[vs]?.allowDeletionWithScoresPresent?.drawDefinitions,w=Fa({event:r})??{},y=w.drawIds??(w.drawDetails&&Object.keys(w.drawDetails))??[],b,S=[],U=r.drawDefinitions.filter(T=>{if(i.includes(T.drawId)){let D=xn({event:r,drawDefinition:T})?.matchUps??[];if(D.some(({score:F})=>hr({score:F}))&&!v)return S.push(T.drawId),!0;let{drawId:P,drawType:E,drawName:R}=T,C=g?.flights?.find(F=>F.drawId===T.drawId);C&&(C.drawEntries=C.drawEntries?.filter(F=>mo.includes(F.entryStatus))),y.includes(P)&&(y=y.filter(F=>F!==P),b=!0);let M=so({stageSequence:1,drawDefinition:T,stage:ke})?.structures?.[0],N=(M?GI({structureId:M.structureId,tournamentRecord:a,drawDefinition:T}):void 0)?.positionAssignments?.map(I),A=so({stage:ze,drawDefinition:T})?.structures,O=A?.length?A.map(F=>{let x=F.stageSequence;return{positionAssignments:GI({structureId:F.structureId,tournamentRecord:a,drawDefinition:T})?.positionAssignments.map(I),stageSequence:x}}):void 0,k={action:uce,payload:{drawDefinitions:[T],eventId:o??r?.eventId,auditData:s}};h.push(k),p.push(je({tournamentId:a.tournamentId,eventId:o??r?.eventId,qualifyingPositionAssignments:O,positionAssignments:N,auditData:s,drawType:E,drawName:R,drawId:P})),D?.forEach(({matchUpId:F})=>f.push(F))}return!i.includes(T.drawId)});if(S.length&&!l)return q({context:{drawIdsWithScoresPresent:S},result:{error:bU},stack:e});if(r.drawDefinitions=U,g&&ep({event:r,extension:{name:ao,value:g}}),yT({tournamentRecord:a}),b){let T={};for(let P of y)T[P]=w.drawDetails?.[P]??{published:!0};let D=fy({statusObject:{drawDetails:T},event:r});if(D.error)return{error:D.error}}if(h.length)if(SU(lc)){let T=a.tournamentId;at({topic:lc,payload:{tournamentId:T,detail:h}});let D=(Ps({element:r,itemType:Tp})?.timeItem?.itemValue||0)+1;Ll({element:r,timeItem:{itemType:Tp,itemValue:D},removePriorValues:!0})}else Jze({appliedPolicies:u,event:r,deletedDrawsDetail:p,auditData:s});if(f.length&&ju({tournamentId:a?.tournamentId,matchUpIds:f}),i.forEach(T=>n$e({drawId:T})),n&&b){let T=hy({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:c,tournamentRecord:a,event:r});if(T.error)return{...W,info:T.error}}return{...W}}function Jze({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){if(t?.audit?.[Tp]===!1)return;let{extension:n}=rt({name:Tp,element:e}),a={...r,deletedDrawsDetail:i},s={value:Array.isArray(n?.value)?n?.value.concat(a):[a],name:Tp};It({element:e,extension:s})}function cce({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){if(!e)return{error:Ie};if(!r)return{error:ci};let{flightProfile:a}=Vi({event:r});if(a){let s=a.flights?.map(({drawId:l})=>l).filter(Boolean),o=yA({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return o.error?o:uN({event:r,name:ao})}return{...W}}function IG(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,s=t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(s).length)return{error:Ci};let o=Object.keys(s).filter(u=>!n||n===u);if(n&&!o.includes(n))return{error:re};let l;for(let u of o){let c=s[u],{event:d}=Kn({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=Qze({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...W}:{error:gs}}function Qze({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:Ie};if(r&&!Array.isArray(r))return{error:re};if(e&&!Array.isArray(e))return{error:re};let a=Mc;if(n){let{extension:s}=rt({element:n,name:a}),o=s?.value||{},l=L3({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});It({element:n,extension:{name:a,value:l}})}else{let{extension:s}=rt({element:t,name:a}),o=s?.value||{},l=L3({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});It({extension:{name:a,value:l},element:t})}return{...W}}function L3(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let s=n?.length&&i.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(u=>u!==r)}:l).filter(({matchUpFormatCodes:l})=>l?.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let o=a?.length&&e.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(u=>u!==r)}:l).filter(({matchUpFormatCodes:l,averageTimes:u})=>l?.length||u).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:s?.length&&s||i,matchUpRecoveryTimes:o?.length&&o||e}}function dce(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:s,event:o}=t;if(!e)return{error:Ie};if(!qa({matchUpFormat:n}))return{error:re};if(!o)return{error:ci};let{averageTimes:l=[],recoveryTimes:u=[]}=mA({tournamentRecord:e,matchUpFormat:n,event:o}),c=o.category,d=c?.categoryName||c?.ageCategoryCode||o?.eventId,p={categoryNames:[d],minutes:{}},f={categoryNames:[d],minutes:{}},h=w=>{if(w.categoryTypes?.includes(a)&&console.log("encountered:",{categoryType:a}),!(w.categoryNames?.includes(d)&&(w.categoryNames=w.categoryNames.filter(y=>y!==d),p={minutes:w.minutes,categoryNames:[d]},!w.categoryNames.length)))return w},m=r&&!isNaN(Ke(r)),g=i&&!isNaN(Ke(i)),I=l.map(h).filter(w=>w?.categoryNames?.length),v=u.map(h).filter(w=>w?.categoryNames?.length);return m&&(Object.assign(p.minutes,{[o?.eventType||qt]:r}),I.push(p)),g&&(Object.assign(f.minutes,{[o?.eventType||qt]:i}),v.push(f)),!m&&!g?{error:re}:IG({averageTimes:m&&I,recoveryTimes:g&&v,tournamentRecord:e,matchUpFormat:n,eventId:s})}function bA(t){if(t.event)return _3({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=He(t,[{[fn]:!0,[lae]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=Kn({tournamentRecord:n,eventId:r});if(a)return _3({event:a})}}return{error:gs}}function _3({event:t}){return uN({event:t,name:Mc})}var pce={MON:"MON",TUE:"TUE",WED:"WED",THU:"THU",FRI:"FRI",SAT:"SAT",SUN:"SUN"};function fce(t){return!Array.isArray(t)||lt(t).length!==t.length?!1:t.every(e=>Object.keys(pce).includes(e))}function vG({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:Ie};if(!e)return{error:ci};if(!yl.test(i))return{error:Yi};let r=hce(t),n="setEventStartDate";if(r.error)return q({result:r,stack:n});let{tournamentStartDate:a,tournamentEndDate:s}=r,o=new Date(Ze(i)).getTime();if(!a||!s||o<a||o>s)return q({result:{error:Yi},stack:n,info:"startDate must be within tournament start and end dates"});let l=e.endDate&&new Date(Ze(e.endDate)).getTime();return l&&o>l&&(e.endDate=i),e.startDate=i,{...W}}function yG(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:Ie};if(!i)return{error:ci};if(!yl.test(r))return{error:Yi};let n=hce(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:s}=n,o=new Date(Ze(r)).getTime();if(!a||!s||o<a||o>s)return{error:Yi};let l=i.startDate&&new Date(Ze(i.startDate)).getTime();return l&&o<l&&(i.startDate=r),i.endDate=r,{...W}}function bG(t){let e="setEventDates",i=He(t,[{tournamentRecord:!0,event:!0},{[Yr]:u=>yl.test(u),[Ya]:Yi,startDate:!1,endDate:!1},{[Yr]:u=>u.filter(Boolean).every(c=>yl.test(c)),[Ya]:Yi,activeDates:!1},{[Yr]:fce,weekdays:!1}]);if(i.error)return i;let{tournamentRecord:r,weekdays:n,event:a,startDate:s,endDate:o}=t,l=t.activeDates?.filter(Boolean);if(s&&o){let u=new Date(Ze(s)).getTime(),c=new Date(Ze(o)).getTime();if(u>c)return q({result:{error:re},stack:e,info:"startDate cannot be after endDate"})}if(l){let u=s||r.startDate,c=o||r.endDate,d=!u||l.every(f=>new Date(f)>=new Date(u)),p=!c||l.every(f=>new Date(f)<=new Date(c));if(!d||!p)return q({result:{error:Yi},stack:e})}if(s){let u=vG({tournamentRecord:r,event:a,startDate:s});if(u.error)return q({result:u,stack:e})}if(o){let u=yG({tournamentRecord:r,event:a,endDate:o});if(u.error)return q({result:u,stack:e})}return l&&(a.activeDates=l),n&&(a.weekdays=n),{...W}}function hce(t){let{startDate:e,endDate:i}=t;return!yl.test(e)||!yl.test(i)?q({result:{error:rre},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Ze(e)).getTime(),tournamentEndDate:new Date(Ze(i)).getTime()}}function wG({event:t,orderedDrawIdsMap:e}){if(typeof t!="object")return{error:ci};if(!e)return{error:Je,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:re,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(n=>!Number.isNaN(Number(n))))return{error:re,info:"drawOrder must be numeric"};if(lt(i).length!==i.length)return{info:"drawOrder values must be unique",error:re};if(t.drawDefinitions?.length){let n=(t.drawDefinitions||[]).map(({drawId:s})=>s),a=Object.keys(e);if(a?.length&&_i(n,a).length!==n.length)return{error:re,info:"Missing drawIds"};t.drawDefinitions.forEach(s=>{s.drawOrder=e[s.drawId]})}let{flightProfile:r}=Vi({event:t});return r?.flights?.forEach(n=>{n.flightNumber=e[n.drawId]}),{...W}}function SG({tournamentRecord:t,event:e}){if(!t)return{error:Ie};if(!e)return{error:ci};let{flightProfile:i}=Vi({event:e}),r=i?.flights?.sort((s,o)=>s.flightNumber-o.flightNumber).map(s=>s.drawId).filter(Boolean),n=e.drawDefinitions?.sort((s,o)=>s.drawOrder-o.drawOrder).map(s=>s.drawId).filter(Boolean).filter(s=>!r?.includes(s)),a=Object.assign({},...[...r||[],...n||[]].map((s,o)=>({[s]:o+1})));return a?wG({event:e,orderedDrawIdsMap:a}):{...W}}function mce({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){if(!e)return{error:Ie};if(!r)return{error:jo};if(!n)return{error:ci};let{flightProfile:s}=Vi({event:n});if(s&&s.flights?.find(o=>o.drawId===r)){let o=s.flights.filter(u=>u.drawId!==r),l={name:ao,value:{...s,flights:o}};ep({event:n,extension:l})}if(n.drawDefinitions?.find(o=>o.drawId===r)){let o=yA({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(o.error)return o}return SG({tournamentRecord:e,event:n})}function gce(t){let e=He(t,[{[qc]:!0,[gr]:!0,[T2]:!1},{replacementIndividualParticipantId:!0,[Yr]:g=>ai(g),existingIndividualParticipantId:!0,[zs]:pr,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:r,tournamentRecord:n,drawDefinition:a,participantId:s,event:o,uuids:l}=t;if(e.error)return e;if(o?.eventType!==Is)return{error:bu};if(!(o?.entries?.filter(({entryStatus:g})=>[Es,Rf].includes(g)).map(({participantId:g})=>g)||[]).includes(i))return{error:Fo};let u=(n.participants||[]).find(g=>g.participantId===s);if(u?.participantType!==mt)return{error:Wp,participant:u};let c=u.individualParticipantIds,d=[i,...c.filter(g=>g!==r)],{participant:p}=oo({participantIds:d,tournamentRecord:n}),f;if(p)f=p.participantId;else{let g={participantId:l?.pop(),participantRole:Qr,individualParticipantIds:d,participantType:mt},I=Dl({participant:g,returnParticipant:!0,tournamentRecord:n});if(I.error)return I;f=I.participant.participantId}let{flightProfile:h}=Vi({event:o});if(a){let g=h?.flights?.find(({drawId:I})=>I===a.drawId);g&&(g.drawEntries=g.drawEntries.map(I=>I.participantId===s?{...I,participantId:f}:I)),a.entries=a.entries.map(I=>I.participantId===s?{...I,participantId:f}:I);for(let I of a.structures||[])if(I.structures){I.positionAssignments=void 0;for(let v of I.structures)v.positionAssignments=v.positionAssignments.map(w=>w.participantId===s?{...w,participantId:f}:w)}else I.positionAssignments&&(I.positionAssignments=I.positionAssignments.map(v=>v.participantId===s?{...v,participantId:f}:v))}o.entries=o.entries.map(g=>g.participantId===s&&{...g,participantId:f}||g.participantId===i&&{...g,participantId:r}||g);let m=n.events.some(({entries:g,eventId:I,drawDefinitions:v})=>o.eventId===I?v.some(({drawId:w,entries:y})=>w===a?.drawId?!1:y?.find(b=>b.participantId===s)):g?.find(w=>w.participantId===s));if(!m){let g=rg({addIndividualParticipantsToEvents:!1,participantIds:[s],tournamentRecord:n});if(g.error)return g}return{...W,participantOtherEntries:m,newPairParticipantId:f}}function UT(t){let{flight:e,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:s,tournamentRecord:o,drawDefinition:l,event:u}=t;if(!l)return{error:$e};if(!u)return{error:ci};u.drawDefinitions||(u.drawDefinitions=[]);let{drawId:c,drawName:d,entries:p}=l,{entries:f}=u,h=0;if(n!==void 0&&n!==u.drawDefinitions.length)return{error:re,info:"drawDefintions count mismatch"};let{flightProfile:m}=Vi({event:u}),g=e&&m?.flights?.find(R=>R.flightNumber===e.flightNumber),I=m?.links?.find(R=>R?.target?.drawId===c)?.source?.drawId;if(I&&!u.drawDefinitions.find(R=>R.drawId===I))return q({result:{error:$e},info:{sourceDrawId:I}});if(g&&g.drawId!==l.drawId)return q({result:{error:Sh},info:{relevantFlight:g}});let v=p?.every(({participantId:R,entryStatus:C})=>{let M=g?.drawEntries.find(N=>N.participantId===R);return!C||M?.entryStatus===C}),w=!s||f&&p?.every(({participantId:R,entryStatus:C,entryStage:M})=>f.find(N=>N.participantId===R&&(!N.entryStage||N.entryStage===M))?.entryStatus===C);if(g&&!v)return q({result:{error:Sh},context:{drawEntriesPresentInFlight:v,matchingEventEntries:w,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&p?.filter(Boolean).forEach(R=>{if(R?.entryStatus&&mo.includes(R?.entryStatus)){let C=f?.filter(Boolean).find(M=>M.participantId===R.participantId);C&&R.entryStatus&&C?.entryStatus!==R.entryStatus&&(C.entryStatus=R.entryStatus,h+=1)}}),f&&!w)return q({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:w,eventEntries:f},error:Sh}});let y=m?.flights?.map(({flightNumber:R})=>!isNaN(R)&&Ke(R))?.filter(Boolean)||[],b=u.drawDefinitions.map(({drawOrder:R})=>R&&Ke(R))?.filter(Boolean)||[],S=Math.max(0,...b,...y)+1,U=m?.flights?.find(R=>R.drawId===c),T;if(U){U.drawName=l.drawName,T={name:ao,value:{...m,flights:m.flights}};let R=U.flightNumber;R&&!b.includes(R)?S=R:U.flightNumber=S}else{let R=m?.flights||[];R.push({manuallyAdded:!0,flightNumber:S,drawEntries:p,drawName:d,drawId:c}),T={name:ao,value:{...m||{},flights:R}}}ep({event:u,extension:T}),Object.assign(l,{drawOrder:S});let D=u.drawDefinitions.find(R=>R.drawId===c),P=o?.tournamentId,E=u.eventId;if(D){if(!a)return{error:Mie};let R=xn({drawDefinition:D})?.matchUps?.map(yr)??[],C=xn({drawDefinition:l})?.matchUps;if(!i){R?.length&&ju({matchUpIds:R,action:"modifyDrawDefinition",tournamentId:P,eventId:E}),C?.length&&Nd({matchUps:C,tournamentId:P,eventId:E}),u.drawDefinitions=u.drawDefinitions.map(N=>N.drawId===c?l:N);let M=l.structures?.map(({structureId:N})=>N);ri({drawDefinition:l,tournamentId:P,structureIds:M,eventId:E})}}else if(u.drawDefinitions.push(l),!i){let{matchUps:R}=xn({drawDefinition:l,event:u});R&&Nd({tournamentId:o?.tournamentId,matchUps:R}),xU({drawDefinition:l,tournamentId:P,eventId:E})}return{...W,modifiedEventEntryStatusCount:h}}function Ice(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,assignments:o,drawId:l,event:u}=t,c=0;if(!o?.length)return{error:LB};if(!r)return{error:Ie};if(!l)return{error:jo};let d=ys({provisionalPositioning:e,drawDefinition:n,structureId:s});if(d.error)return d;let{seedAssignments:p,seedLimit:f}=d,h=Object.assign({},...(p??[]).filter(I=>I.seedNumber).map(I=>({[I.seedNumber]:I})));o.forEach(I=>{let{seedNumber:v}=I;f&&v<=f&&(!i||h[v])&&(h[v]=I)});let m=Object.values(h),g=m.map(I=>I?.participantId).filter(Boolean);if(g.length!==vie(g).length)return{error:Nie};for(let I of m){let v=ay({...I,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,event:u});if(v?.error)return v;v?.success&&c++}return c?{...W,modifications:c}:{error:Hv}}function UG({deleteExisting:t,event:e,flightProfile:i}){let r="attachFlightProfile";if(!i)return q({result:{error:Je},stack:r});if(!e)return q({result:{error:ci},stack:r});let{flightProfile:n}=Vi({event:e});return n&&!t?q({result:{error:ZB},stack:r}):e.drawDefinitions?.length?q({result:{error:Die},stack:r}):(ep({event:e,extension:{name:ao,value:i}}),{flightProfile:xe(i,!1,!0),...W})}function Zze({tournamentRecord:t,scaleAttributes:e,participantIds:i}){if(!t)return{error:Ie};if(!i)return{error:Jd};if(!e)return{error:Je,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=e,s=[sse,r,n,a].join(".");return t.participants?.forEach(o=>{i.includes(o.participantId)&&o.timeItems&&(o.timeItems=o.timeItems.filter(l=>l&&l?.itemType!==s))}),{...W}}function TG({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:s}){if(!a)return{error:ci};if(r&&!Array.isArray(r))return q({result:{error:re},info:Zp("entryStatus"),stack:"removeScaleValues"});let o=a.entries;if(n){let{flightProfile:u}=Vi({event:a}),c=u?.flights?.find(d=>d.drawId===n);c?o=c.drawEntries:o=i?.entries}let l=(o||[]).filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!r||r.includes(u.entryStatus))).map(wt);return Zze({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function wA({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=rs,event:n}){if(!e)return q({result:{error:Ie}});if(!n)return q({result:{error:ci}});if(!Ut(i))return q({result:{error:Je}});if(Ut(i.draws))for(let s of Object.keys(i.draws)){let o=i.draws[s].scheduleDetails??[];if(o.length){let l=[];for(let u of o){let c=l.find(d=>TLe(d.attributes,u.attributes));c?.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[s].scheduleDetails=l}}let a=fy({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...W}}function vce({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:s}){if(!t)return{error:Ie};if(!a)return{error:ci};r=r||a.category?.categoryName||a.category?.ageCategoryCode;let o={eventType:a.eventType,scaleType:nu,scaleName:r};return TG({tournamentRecord:t,scaleAttributes:o,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:s})}function yce(t){let e=He(t,[{[gr]:!0},{eventIds:!0,[Jn]:on}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],s=[],o=[],l=[];if(r.events=(r.events||[]).filter(u=>{if(n.includes(u.eventId)){let p={action:jD,payload:{events:[u]}};a.push(p),s.push({tournamentId:r.tournamentId,eventName:u.eventName,eventType:u.eventType,category:u.category,eventId:u.eventId,gender:u.gender})}let c=u.eventType===Is?(u.entries||[]).map(({entryStatus:p,participantId:f})=>p!==Es&&f).filter(Boolean):[],d=n.includes(u.eventId);return d?l.push(...c):o.push(...c),!d}),i){let u=l.filter(c=>!o.includes(c));r.participants=r.participants.filter(({participantId:c})=>!u.includes(c))}if(yT({tournamentRecord:r}),a.length)if(SU(lc)){let u=r.tournamentId;at({topic:lc,payload:{type:jD,tournamentId:u,detail:a}})}else dT({tournamentRecord:r,timeItem:{itemValue:s,itemType:jD}});return{...W}}function bce(t){let e=He(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:Zn}]);if(e.error)return e;let{eventUpdates:i,event:r}=t,n="modifyEvent",a=nqe(t),s=aqe({enteredParticipants:a}),{enteredParticipantGenders:o,enteredParticipantTypes:l}=s,u=Vi({event:r})?.flightProfile?.flights,c=!r.drawDefinitions?.length&&!u?.length,d=sqe({noFlightsNoDraws:c,enteredParticipantGenders:o,eventUpdates:i,stack:n});if(d.error)return d;let p=oqe({enteredParticipantTypes:l,eventUpdates:i,stack:n});if(p.error)return p;let f=eqe({...t,...s,enteredParticipants:a,stack:n});if(f.error)return f;let h=rqe({...t,stack:n});return h.error?h:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{...W})}function eqe(t){let e=t.eventUpdates?.category;if(!e)return{...W};let i=uw({category:e});if(i.error)return i;if(t.event.eventType===lr){let r=tqe(t);if(r.error)return r}if(t.enteredParticipants?.length){let r=iqe(t,e);if(r.error)return r}return{...W}}function tqe(t){let e=t.event?.drawDefinitions?.map(n=>Yo(n))??[],i=Yo(t.event),r=(Gu(t)?.matchUps??[]).map(n=>Yo(n))??[];return[i,...e,...r].filter(Boolean).every(n=>n.collectionDefinitions.every(a=>!a.category||TU({category:t.eventUpdates.category,childCategory:a.category})))?{...W}:q({result:{error:rw},stack:t.stack})}function iqe(t,e){let i=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,r=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,n=t.enteredParticipants.flatMap(o=>o.participantType===yt?[o]:o.individualParticpants??[]),a=zp({category:e,consideredDate:i}),s=zp({category:e,consideredDate:r});if(a?.ageMinDate||a?.ageMaxDate||s?.ageMinDate||s?.ageMaxDate)for(let o of n){let l=o.person?.birthDate;if(!l)return q({result:{error:Zie},stack:t.stack});let u=new Date(l).getTime(),c=$3(u,a,t.stack);if(c)return c;let d=$3(u,s,t.stack);if(d)return d}return{...W}}function $3(t,e,i){if(!e)return null;if(e.ageMinDate||e.ageMaxDate){let r=new Date(e.ageMinDate).getTime(),n=new Date(e.ageMaxDate).getTime();if(t<r||t>n)return q({result:{error:sre},stack:i})}return null}function rqe(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=bG({startDate:i.startDate||r.startDate||e.startDate,endDate:i.endDate||r.endDate||e.endDate,tournamentRecord:e,event:r});if(a.error)return q({result:a,stack:n})}return{...W}}function nqe(t){let{tournamentRecord:e,event:i}=t,r=i?.entries?.filter(({entryStatus:n})=>{let a=n;return[...mo,qs].includes(a)}).map(({participantId:n})=>n)??[];return r?Ei({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function aqe({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{let s=a.person?.sex?[a.person.sex]:a.individualParticpants?.map(o=>o.person?.sex)||[];return e.push(...s),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=lt(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function sqe({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||wu(i.gender)||e.length===1&&e[0]===i.gender||t&&Ba(i.gender);return i.gender&&!n?q({context:{gender:i.gender,validGender:n},result:{error:ub},stack:r}):{...W}}function oqe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(lr)&&[lr]||t.includes(yt)&&[bl]||t.includes(mt)&&[Is]||[Is,bl,lr]).includes(e.eventType??"");return e.eventType&&!r?q({context:{participantType:e.eventType,validEventType:r},result:{error:bu},stack:i}):{...W}}function SA({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){let s="addFlight";if(!n)return q({result:{error:ci},stack:s});if(!i)return q({result:{error:Je},stack:s});if(e?.length){let f=(n.entries??[]).map(wt),h=e.map(wt);if(_i(h,f).length!==h.length)return q({result:{error:re},stack:s})}let o=Vi({event:n})?.flightProfile,l=o?.flights?.map(({flightNumber:f})=>!isNaN(f)&&Ke(f))?.filter(Boolean)||[],u=Math.max(0,...l)+1,c={drawId:r||Et(),flightNumber:u,drawEntries:e,drawName:i};if(a&&(c.stage=a),t&&(c.qualifyingPositions=t),(o?.flights||[]).find(({drawId:f})=>f===c.drawId))return q({result:{error:Ore},stack:s});let d=(o?.flights||[]).concat(c),p={name:ao,value:{...o||{},flights:d}};return ep({event:n,extension:p})}var wce={};ft(wce,{drawMatic:()=>kj,garman:()=>Ece,generateAdHocMatchUps:()=>zN,generateAdHocRounds:()=>Aj,generateAndPopulatePlayoffStructures:()=>YV,generateCourts:()=>DG,generateDrawDefinition:()=>ST,generateDrawMaticRound:()=>uj,generateDrawStructuresAndLinks:()=>sj,generateDrawTypeAndModifyDrawDefinition:()=>oj,generateFlightProfile:()=>cqe,generateLineUps:()=>Pce,generateQualifyingStructure:()=>jV,generateSeedingScaleItems:()=>Xue,generateStatCrew:()=>dqe,generateVoluntaryConsolation:()=>Mle,roundRobinGroups:()=>w2e});var lqe="splitLevelBased",Sce="splitWaterfall",Uce="splitShuttle",uqe={SPLIT_LEVEL_BASED:lqe,SPLIT_WATERFALL:Sce,SPLIT_SHUTTLE:Uce};function cqe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:s,sortDescending:o,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:f}=t;if(!p)return{error:ci};let h=p.entries??[],{flightProfile:m}=Vi({event:p});if(m&&i&&!s)return{error:ZB};let g=t.scaledEntries??ug({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:o,event:p,stage:f}).scaledEntries,I=new Set(g.map(wt)),v=An(h.filter(({participantId:P})=>!I.has(P)).filter(P=>(!f||!P.entryStage||P.entryStage===f)&&(!P.entryStatus||Cf.includes(P.entryStatus)))),w=g.concat(...v),y=w.length,b=Math.ceil(y/u),S=Sr(w,b);c===Sce?S=Fx(w,u):c===Uce&&(S=Fx(w,u,!0));function U(P){return(P||[]).map(({participantId:E,scaleValue:R})=>{let C=h.find(M=>M.participantId===E);return C?.scaleValue&&R&&(C.scaleValue=R),C}).sort((E,R)=>E.scaleValue-R.scaleValue).map((E,R)=>(E.scaleValue&&(E.seedNumber=R+1),E))}let T=Ce(0,u).map(P=>{let E=P+1;return{flightNumber:E,drawId:d?.pop()??Et(),drawEntries:U(S[P]),drawName:l?.length&&l[P]||`${e} ${E}`}}),D={scaleAttributes:n,splitMethod:c,flights:T};if(i){let P=UG({flightProfile:D,deleteExisting:s,event:p});return{splitEntries:ha()&&S||void 0,...P}}else return{flightProfile:D,...W}}function Tce({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(s=>typeof s=="object"&&Object.keys(s).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return Dce({tagName:e,attributes:n,childArrays:i,childObjects:r})}function Dce(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,s=f=>{let h=Object.keys(f)[0],m=f[h];return{key:h,value:m}},o=r?.map(({key:f,value:h})=>Dce({tagName:f,childObjects:h.map(s)})).join(`\r
`),l=n?.map(({key:f,value:h})=>Tce({tagName:f,json:h??[]})).join(`\r
`),u=i?.map(({key:f,value:h})=>`${f}="${h}"`).join(" "),c=u?` ${u}`:"";if(e==="childArray")return l;let d=l?.length?`${a}${l}${a}`:"",p=o?.length?`${a}${o}${a}`:"";return`<${e}${c}>${d}${p}</${e}>`}function dqe(t){let e=He(t,[{[gr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:r,tournamentId:n,tournamentName:a}=i,{participantMap:s,matchUps:o,mappedMatchUps:l}=Ei({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),u=i.participants.filter(w=>w.participantType===$t),c=o?.filter(w=>w.matchUpType===$t)??[],d=c?.reduce((w,y)=>{let b=y?.tieMatchUps??[];return b&&[...w,...b]},[])??[],p=o?.filter(w=>w.matchUpType===qt)??[],f=o?.filter(w=>w.matchUpType===Vt)??[],h=d.length===p.length+f.length,m=c.length===1&&h,g={mappedMatchUps:l,participantMap:s,tournamentName:a,tournamentId:n,tournament:h?"N":"Y",startDate:r},I=[],v=[];if(m){let w=c[0],{json:y,xml:b}=B3({teamParticipants:u,teamMatchUp:w,...g,doubles:f,singles:p});v.push(y),I.push(b)}else for(let w of c){let y=w?.sides?.map(({participant:T})=>T?.participantId).filter(Boolean);if(y?.length!==2)continue;let b=y.map(T=>T&&s?.[T]?.participant),{xml:S,json:U}=B3({doubles:w.tieMatchUps?.filter(T=>T.matchUpType===Vt),singles:w.tieMatchUps?.filter(T=>T.matchUpType===qt),teamParticipants:b,teamMatchUp:w,...g});v.push(U),I.push(S)}return{json:v,xml:I,...W}}function B3({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:s,startDate:o,doubles:l,singles:u}){let c=t?.find(y=>y.participantRoleResponsibilities?.includes("Home")),d=t?.filter(y=>y.participantId!==c?.participantId),p=Hs(o,"/","MDY"),f=c?.participantName||d?.[1]?.participantName,h=c?.participantId||d?.[1]?.participantId,m=d?.[0]?.participantName,g=d?.[0]?.participantId,I={},v=t.map(y=>({team:{...hqe({teamParticipant:y,teamMatchUp:a,uniValues:I,participantMap:i,mappedMatchUps:e,homeid:h})}})),w=je({venue:{tournamentname:s?r:void 0,neutralgame:c?"N":"Y",gameid:n,officials:{},tournament:s,rules:{},homename:f,visname:m,homeid:h,visid:g,date:p},childArray:v,singles_matches:u?.map(y=>V3({matchUp:y,homeid:h,uniValues:I})),doubles_matches:l?.map(y=>V3({matchUp:y,homeid:h,uniValues:I}))});return{json:w,xml:Tce({json:w,tagName:"tngame"})}}function pqe({homeid:t,uniValues:e,participant:i}){if(!i)return{};let r=i.individualParticipants?.length===2,n=r?lt(i.individualParticipants?.map(m=>m.teams?.[0]?.participantId)):[],a=r?lt(i.individualParticipants?.map(m=>m.teams?.[0]?.teamId)):[],s=!r&&i.teams?.[0]?.participantId||n?.length===1&&n[0]||void 0,o=!r&&i.teams?.[0]?.teamId||a?.length===1&&a[0]||s,l=r?void 0:i.participantName,u=i.individualParticipants?.[0]?.participantName,c=i.individualParticipants?.[1]?.participantName,d=t&&(s===t?"H":"V")||"",p=r?void 0:e[s][i.participantId],f=e[s][i.individualParticipants?.[0]?.participantId],h=e[s][i.individualParticipants?.[1]?.participantId];return je({vh:d,uni:p,uni_1:f,uni_2:h,team:o,name:l,name_1:u,name_2:c})}function fqe({sets:t,sideNumber:e}){return Object.assign({},...t?.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o}=i,l=`set_${r}`,u=`tie_${r}`,c=e===1?n:a,d=e===1?s:o;return{[l]:c,[u]:d}})??[])}function hqe({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){let{participantId:s,participantName:o}=t,l=n&&(s===n?"H":"V")||"",u=i?.[s]?.matchUps,c=u&&Object.keys(u),d=e?.sides?.find(({participant:y})=>y.participantId===s)?.sideNumber,p=e?.score?.sets?.[0]?.[`side${d}Score`]??0;a[s]={};let f={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},h=[],m=[],g=0;for(let y of c??[]){let b=r?.[y],S=b.sides.find(({participant:T})=>T.participantId===s)?.sideNumber,U=b.score?.sets?.[0]?.[`side${S}Score`]??0;g+=U;for(let T of b.tieMatchUps??[]){let{matchUpType:D,winningSide:P}=T,E=P&&(P===S?"w":"l")||"";E&&(f[D][E]+=1);let R=E==="w"?"1":"0",C=E==="l"?"1":"0";if(D===qt){let M=m.length+1;m.push({singles_pair:{pair:M,won:R,lost:C,tied:"0"}})}else if(D===Vt){let M=h.length+1;h.push({doubles_pair:{pair:M,won:R,lost:C,tied:"0"}})}}}let I=[{singles:{childArray:m,won:f.SINGLES.w,lost:f.SINGLES.l}},{doubles:{childArray:h,won:f.DOUBLES.w,lost:f.DOUBLES.l}}],v=[],w=1;for(let y of t.individualParticipantIds){let b=i?.[y];if(b){let{participant:S,counters:U}=b,T={won:U?.DOUBLES?.wins||0,lost:U?.DOUBLES?.losses||0},D={won:U?.SINGLES?.wins||0,lost:U?.SINGLES?.losses||0},{participantName:P,participantId:E}=S;a[s][E]=w,v.push({player:{name:P,uni:w,singles:D,doubles:T}})}w+=1}return{vh:l,id:s,name:o,score:p||g,totals:I,childArray:v}}function V3({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:s}=t??{},o=s?.map(l=>{let{sideNumber:u,participant:c}=l,d=fqe({sets:t.score?.sets,sideNumber:u});return{[a===qt?"singles_score":"doubles_score"]:{...pqe({homeid:e,uniValues:i,participant:c}),...d}}});return{[a===qt?"singles_match":"doubles_match"]:{match:r,order:n,childArray:o}}}var mqe="DESC",CF="DESC",gqe={ASC:"ASC",ASCENDING:"ASC",DESC:mqe,DESCENDING:CF};function Pce(t){let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:s,attach:o,event:l}=t;if(l?.eventType!==Ca)return{error:bu};if(!r)return{error:Ie};if(!e&&!n)return{error:za};if(e=e??bn({drawDefinition:n,event:l})?.tieFormat,qn({tieFormat:e}).error)return{error:iu};if(typeof a!="object"&&!i)return{error:re,context:{scaleAccessor:a}};let u={},c=(n?.entries??l?.entries??[]).filter(E=>E?.entryStatus===ga).map(wt),{participants:d=[]}=Ei({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=d.filter(({participantId:E})=>c.includes(E)),f=E=>E===Ru?"rankings":"ratings",h=l?.category?.categoryName??l?.category?.ageCategoryCode,{scaleName:m=h,scaleType:g=Ru,sortOrder:I,accessor:v}=a||{},w=f(g),y=(E,R)=>{let C=E[w]?.[R];if(!C&&i&&(C=E[w]?.[bh]),Array.isArray(C)){let M=C.find(N=>N.scaleName===m)?.scaleValue;if(Ni(M))return M;if(v&&typeof M=="object")return M[v]}return 0},b=(E,R,C)=>{let M=I===CF?R:E,N=I===CF?E:R;return y(M,C)-y(N,C)},S=(E,R)=>b(E,R,bh),U=(E,R)=>b(E,R,Hp),T=[],D=e?.collectionDefinitions??[];for(let E of p){let R=E.individualParticipants?.sort(S)??[],C=s?R:E.individualParticipants?.sort(U)??[],M={};for(let A of D){let O=[],{collectionId:k,matchUpCount:F,matchUpType:x,gender:L}=A,$=Di(bh)(x);Ce(0,F).forEach(V=>{let _=$?R:C??[],B=V+1,G=[];Ce(0,$?1:2).forEach(j=>{let Y=_?.find(K=>{let X=un(L),Z=X&&(vl(L)&&X||Ba(L)&&[er,_r][j]);return(!Z||Z===K.person?.sex)&&!O.includes(K.participantId)})?.participantId;Y&&(G.push(Y),O.push(Y),M[Y]||(M[Y]=[]),M[Y].push({collectionPosition:B,collectionId:k}))}),$||T.push(G)})}let N=Object.keys(M).map(A=>({collectionAssignments:M[A],participantId:A}));u[E.participantId]=N}let P=[];for(let E of T){let{participant:R}=oo({tournamentParticipants:d,participantIds:E});if(!R){let C={individualParticipantIds:E,participantRole:Qr,participantType:mt};P.push(C)}}if(o){for(;P.length;)Dl({participant:P.pop(),tournamentRecord:r});It({element:n,extension:{name:Cc,value:u}})}return{...W,lineUps:u,participantsToAdd:P}}function DG(t){if(!t)return{error:Je};let e=He(t,[{dates:!1,[Yr]:s=>Array.isArray(s)&&s.every(kn)},{uuids:!1,[Yr]:s=>Array.isArray(s)&&s.every(ai)},{startTime:!1,endTime:!1,[Yr]:u2},{idPrefix:!1,namePrefix:!1,[Yr]:ai},{count:!0,[Yr]:Ni}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&NI(i,r)||[],a=Ce(1,t.count+1).map(s=>je({courtId:t.uuids?.pop()??(t.idPrefix&&`${t.idPrefix}-${s}`)??Et(),courtName:t.courtNames?.pop()??(t.namePrefix&&`${t.namePrefix} ${s}`),dateAvailability:n.map(o=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:o}))}));return{...W,courts:a}}var Ece={};ft(Ece,{default:()=>yqe,garman:()=>Mce});function my(t){let e=He(t,[{courtDate:!0,_ofType:Zn}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=ir(r.startTime);(r.bookings||[]).filter(o=>!o.bookingType||!i.includes(o.bookingType)).sort((o,l)=>(aE(o.startTime)||"").localeCompare(aE(l.startTime)||"")).forEach(o=>{let l={startTime:fi(a.toISOString()),endTime:o.startTime};ir(o.startTime)>a&&n.push(l),ir(o.endTime)>a&&(a=ir(o.endTime))});let s={startTime:fi(a.toISOString()),endTime:r.endTime};return ir(r.endTime)>a&&n.push(s),{timeSlots:n}}function Iqe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=s=>{let{timeSlots:o}=my({includeBookingTypes:e,courtDate:s});return!!o?.filter(a)?.length};function a(s){let o=ir(s.startTime),l=ir(s.endTime);return o>i||l<r?!1:UU(i,l)>=t}return{enoughTime:n}}function Rce(t){let e=He(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:on}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,s=t.courts,o=ir(n),l=d2(o,i),{enoughTime:u}=Iqe({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:o,periodEndTime:l});return{availableToScheduleCount:(s?.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=Fd({date:a,court:c});return!!(d&&u(d))})||[]).length,...W}}function UA(t){let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(a)||!a.length)return{error:re,courts:a};if(!Array.isArray(s))return{error:iE};if(!kn(n))return{error:Yi};i&&(Array.isArray(i)?i.includes(n)&&(s=[]):s=[]);let{courtBookings:o,unassignedBookings:l}=s.reduce((p,f)=>{let{courtId:h}=f;return h?p.courtBookings[h]?p.courtBookings[h].push(f):p.courtBookings[h]=[f]:p.unassignedBookings.push(f),p},{courtBookings:{},unassignedBookings:[]}),u=a.map((p,f)=>{let{courtId:h,courtName:m}=p,g=o[h]||[],I=Fd({date:n,court:p})||{},{bookings:v=[],startTime:w,endTime:y,date:b}=I,S=[e[f]&&{startTime:w,endTime:e[f]},...xe(v,!1,!0),...g].filter(Boolean);return{courtId:h,courtName:m,dateAvailability:{bookings:S,startTime:w,endTime:y,date:b}}});l.sort((p,f)=>Nt(p.startTime)-Nt(f.startTime));let c=()=>u.flatMap(p=>{let f=p.dateAvailability,{timeSlots:h=[]}=my({courtDate:f});return{courtName:p.courtName,courtId:p.courtId,timeSlots:h}}),d=[];for(let p of l){let{startTime:f,endTime:h,averageMinutes:m,recoveryMinutes:g,matchUpId:I}=p,v=Nt(f),w=Nt(h),y=c().reduce((b,{courtId:S,courtName:U,timeSlots:T})=>{let D;return T.find(({startTime:P,endTime:E})=>{D=Nt(P)-v;let R=v>=Nt(P);return w<=Nt(E)&&b.startDifference!==0&&((D===0||D+r>=0)&&(b.startDifference===void 0||D<b.startDifference)||R)})?{courtName:U,courtId:S,startDifference:D}:b},{});if(y.courtId){let b={averageMinutes:m,recoveryMinutes:g,matchUpId:I,startTime:f,endTime:h};d.push(b),u.find(({courtId:S})=>S===y.courtId)?.dateAvailability.bookings.push(b)}else console.log({unassignedBooking:p})}return{virtualCourts:u.map(({courtId:p,courtName:f,dateAvailability:h})=>({dateAvailability:[h],courtName:f,courtId:p})),assignedBookings:d}}function TA({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function Cce(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return Ce(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function zI({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,s)=>{let o=Fd({date:t,court:s}),l=n&&(o?.[n]||s[n]);return l&&(!a||e&&Nt(l)<Nt(a)||i&&Nt(l)>Nt(a))?l:a},void 0)}function vqe({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||zI({courts:r,scheduleDate:n,startTime:!0}),i=i||zI({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let s=ir(e),o=ir(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let u=Fd({court:l,date:n}),{timeSlots:c}=my({courtDate:u});c?.forEach(d=>{let p=ir(d.startTime),f=ir(d.endTime);if(p>o||p<s||f<s)return!1;if(UU(p,f)>=t){let h=fi(p.toISOString());h&&(!a||h<a)&&(a=h)}})}}return{firstTimeSlotStartTime:a}}function PG(t){let e=He(t,[{courts:!0,_ofType:on}]);if(e.error)return e;let{date:i=l2(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:s}=t,{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||TA({averageMatchUpMinutes:u}),i=Ze(i),r=fi(r),n=fi(n);let f=0,h=0,m=0,g=0,I=0;!s&&d&&(s=Cce({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:v}=UA({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:s}),{firstTimeSlotStartTime:w}=vqe({averageMinutes:u,courts:v,startTime:r,endTime:n,date:i});o&&w&&(r=w??r);let y=Nt(r),b=Nt(n)-y,S=Math.floor(b/a),U=Ce(0,S+1).map(T=>{let D=y+T*a,P=Y0e(D),E=Rce({courts:v??[],averageMatchUpMinutes:u,periodStart:P,date:i});if(E.error)return{error:E.error};let{availableToScheduleCount:R=0}=E,C=R>h?R-h:0;I+=T?R:0;let M=T?I/T:R,N=a*M/u,A=T?N*(T-1)+M:M,O=R?h&&A-f||C:0;f=A,h=R,m+=O;let k=Ke(m)-g;return g+=k,{periodStart:P,add:k,availableToScheduleCount:R,newCourts:C,totalMatchUps:g}});return{scheduleTimes:U.reduce((T,D)=>{let P=Ce(0,D.add).map(()=>({scheduleTime:D.periodStart}));return T.concat(...P)},[]).flat(),timingProfile:U,totalMatchUps:g}}var Mce={getCourtsAvailableAtPeriodStart:Rce,generateTimeSlots:my,getScheduleTimes:PG,courtGenerator:Cce},yqe=Mce,Nce={};ft(Nce,{isAggregateFormat:()=>iA,isValid:()=>qa,isValidMatchUpFormat:()=>qa,parse:()=>Xi,stringify:()=>KM});var Ace={};ft(Ace,{allCompetitionMatchUps:()=>_o,allDrawMatchUps:()=>xn,allEventMatchUps:()=>Gu,allTournamentMatchUps:()=>Tr,analyzeMatchUp:()=>Pw,applyLineUps:()=>tde,assignMatchUpSideParticipant:()=>Oce,assignTieMatchUpParticipantId:()=>NE,bulkMatchUpStatusUpdate:()=>Jce,calculateWinCriteria:()=>cg,checkInParticipant:()=>RG,checkMatchUpIsComplete:()=>Dp,checkOutParticipant:()=>EG,competitionScheduleMatchUps:()=>wT,disableTieAutoCalc:()=>Yce,drawMatchUps:()=>cG,enableTieAutoCalc:()=>Wce,eventMatchUps:()=>gA,filterMatchUps:()=>rc,findMatchUp:()=>Kj,getAllDrawMatchUps:()=>nr,getAllStructureMatchUps:()=>Ot,getCheckedInParticipantIds:()=>Zm,getCompetitionMatchUps:()=>Dw,getEventMatchUpFormatTiming:()=>tG,getHomeParticipantId:()=>aG,getMatchUpCompetitiveProfile:()=>qU,getMatchUpContextIds:()=>sG,getMatchUpDailyLimits:()=>vA,getMatchUpDailyLimitsUpdate:()=>iG,getMatchUpDependencies:()=>Io,getMatchUpFormat:()=>oG,getMatchUpFormatTiming:()=>YU,getMatchUpFormatTimingUpdate:()=>eG,getMatchUpScheduleDetails:()=>DN,getMatchUpType:()=>PN,getMatchUpsStats:()=>lG,getModifiedMatchUpFormatTiming:()=>mA,getParticipantResults:()=>ZU,getPredictiveAccuracy:()=>nG,getRoundMatchUps:()=>Un,getRounds:()=>uG,isValidMatchUpFormat:()=>qa,matchUpActions:()=>HN,mutate:()=>kce,participantScheduledMatchUps:()=>rG,query:()=>jue,removeDelegatedOutcome:()=>zce,removeMatchUpSideParticipant:()=>NG,removeTieMatchUpParticipantId:()=>Fce,replaceTieMatchUpParticipantId:()=>MG,resetAdHocMatchUps:()=>Zce,resetMatchUpLineUps:()=>_G,resetScorecard:()=>BG,resetTieFormat:()=>$G,setDelegatedOutcome:()=>Qce,setMatchUpFormat:()=>Kce,setMatchUpState:()=>Of,setMatchUpStatus:()=>TT,setOrderOfFinish:()=>ede,substituteParticipant:()=>qce,tallyParticipantResults:()=>tg,toggleParticipantCheckInState:()=>DA,tournamentMatchUps:()=>IA,updateTieMatchUpScore:()=>Jc,validMatchUp:()=>yN,validMatchUps:()=>is});var kce={};ft(kce,{applyLineUps:()=>tde,assignMatchUpSideParticipant:()=>Oce,assignTieMatchUpParticipantId:()=>NE,bulkMatchUpStatusUpdate:()=>Jce,checkInParticipant:()=>RG,checkOutParticipant:()=>EG,disableTieAutoCalc:()=>Yce,enableTieAutoCalc:()=>Wce,findMatchUp:()=>Kj,removeDelegatedOutcome:()=>zce,removeMatchUpSideParticipant:()=>NG,removeTieMatchUpParticipantId:()=>Fce,replaceTieMatchUpParticipantId:()=>MG,resetAdHocMatchUps:()=>Zce,resetMatchUpLineUps:()=>_G,resetScorecard:()=>BG,resetTieFormat:()=>$G,setDelegatedOutcome:()=>Qce,setMatchUpFormat:()=>Kce,setMatchUpState:()=>Of,setMatchUpStatus:()=>TT,setOrderOfFinish:()=>ede,substituteParticipant:()=>qce,toggleParticipantCheckInState:()=>DA,updateTieMatchUpScore:()=>Jc});function Oce({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){if(i&&typeof i!="string")return{error:Fo};if(!e)return{error:$e};if(!n)return{error:Dn};let s=r===void 0;if(s&&(r=1),![1,2].includes(r))return q({result:{error:re,context:{sideNumber:r}}});let{matchUp:o,structure:l}=hi({drawDefinition:e,matchUpId:n,event:a});if(!o)return{error:pn};if(!(!l?.structures&&!(e.drawType&&e.drawType!==ma)&&!l?.matchUps?.find(({roundPosition:u})=>!!u)))return{error:kB};if(!i&&(o?.score?.scoreStringSide1||Qi.includes(o?.matchUpstatus)||o?.matchUpStatus&&[Ui,zi].includes(o.matchUpStatus)))return{error:_M,info:"matchUp has completed status or score"};if(o){if(o.sides=[1,2].map(u=>{let c=o.sides?.find(d=>d.sideNumber===u)??{sideNumber:u};return r===u?{...c,participantId:i}:c}),s)for(let u of o.sides)u.sideNumber&&(u.sideNumber=3-u.sideNumber);Dt({tournamentId:t?.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:o})}return{...W,sidesSwapped:s}}function ka({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s,event:o}){let{matchUp:l}=hi({drawDefinition:r,event:o,matchUpId:a});if(!l)return{error:pn};let u=Ll({removePriorValues:t,element:l,duplicateValues:i,timeItem:s});return n||Dt({tournamentId:e?.tournamentId,eventId:o?.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),u}function EG(t){let e=[{[gr]:!0},{[vn]:!0},{[Eu]:!0},{[Ol]:!0}],i=He(t,e);if(i.error)return i;let r=dy(t,[{[qv]:Vu,attr:{[nN]:!0}}]);if(r.error)return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=r?.matchUp?.matchUp,{matchUpStatus:u,score:c}=l??{};if(u&&O2.includes(u)||u&&Qi.includes(u)||hr({score:c}))return{error:Oie};let d=Zm({matchUp:l});if(d?.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:f}=d??{};if(!f?.includes(s))return{error:Fo};if(!p?.includes(s))return{error:fre};let h=ese({matchUp:l});if(h?.error)return h;let{sideParticipantIds:m,nestedIndividualParticipantIds:g}=h??{},I=m?.indexOf(s);return I!==void 0&&[0,1].includes(I)&&(g?.[I]??[]).forEach(v=>{ka({drawDefinition:a,matchUpId:o,timeItem:{itemType:gE,itemValue:v}})}),ka({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:gE}}),{...W,checkedOut:!0}}function RG(t){let e=[{[gr]:!0},{[vn]:!0},{[Eu]:!0},{[Ol]:!0}],i=He(t,e);if(i[zs])return i;let r=dy(t,[{[qv]:Vu,attr:{[nN]:!0}}]);if(r[zs])return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=Zm({matchUp:r?.matchUp?.matchUp});if(l?.error)return l;let{checkedInParticipantIds:u,allRelevantParticipantIds:c}=l??{};if(!c?.includes(s))return{[zs]:Fo};let d={...W,checkedIn:!0};return u?.includes(s)||ka({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:mE}}),d}function DA(t){let e=He(t,[{[Eu]:!0,[vn]:!0,[Ol]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,r=t.tournamentRecord??(i&&t.tournamentRecords?.[i]);if(!r)return{error:Ie};let n=dy(t,[{[qv]:Vu,attr:{[nN]:!0},[zs]:pn}]).matchUp?.matchUp;if(!n)return{error:pn};let{checkedInParticipantIds:a=[]}=Zm({matchUp:n}),{participantId:s,matchUpId:o,drawDefinition:l}=t;return s&&a.includes(s)?EG({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n}):RG({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n})}function CG({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){if(!t)return{error:Ie};if(!e)return{error:jo};if(!r)return{error:gs};let n=xr({drawDefinition:e}),{matchUp:a}=hi({matchUpId:i,drawDefinition:e,matchUpsMap:n});if(!a)return{error:pn};let{matchUp:s,structure:o}=hi({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:n,event:r});if(!s)return{error:pn};let{collectionPosition:l,drawPositions:u,collectionId:c,matchUpTieId:d,matchUpType:p}=s;if(p&&!wh([qt,Vt],p))return{error:fa};let{positionAssignments:f}=Xt({structure:o}),h=f?.filter(S=>u?.includes(S.drawPosition)),{matchUp:m}=hi({matchUpId:d,drawDefinition:e,matchUpsMap:n}),g=m?.sides?.map(wt)??[],I=h?.map(wt)??[],v=[...g,...I],{participants:w}=Ei({tournamentRecord:t,participantFilters:{participantTypes:[$t],participantIds:v}}),{matchUp:y}=hi({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:n}),b=bn({matchUp:m,drawDefinition:e,structure:o,event:r})?.tieFormat;return{inContextDualMatchUp:y,inContextTieMatchUp:s,relevantAssignments:h,collectionPosition:l,teamParticipants:w,collectionId:c,matchUpType:p,dualMatchUp:m,tieMatchUp:a,tieFormat:b,structure:o,...W}}function MG(t){let e=CG(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:s,substitution:o,event:l}=t;if(!r||!a)return q({result:{error:pr},stack:i});if(r===a)return{...W};let{inContextDualMatchUp:u,inContextTieMatchUp:c,collectionPosition:d,collectionId:p,dualMatchUp:f,tieMatchUp:h,tieFormat:m}=e,g=c?.matchUpType,I=c?.sides?.find(k=>k.participant?.participantId===r||k.participant?.individualParticipantIds?.includes(r));if(!I)return{error:Gi};let v=Ei({tournamentRecord:n,participantFilters:{participantIds:[r,a]}})?.participants??[];if(v.length!==2)return q({result:{error:pr},stack:i});if(v[0].participantType!==v[1].participantType)return q({result:{error:Lo},stack:i});let{appliedPolicies:w}=Ct({tournamentRecord:n,drawDefinition:s,event:l}),y=t.policyDefinitions?.[Nr]??w?.[Nr]??ny[Nr],b=v.find(({participantId:k})=>k===a);if((t.enforceGender??y?.participants?.enforceGender)!==!1&&vl(c?.gender)&&un(c?.gender)!==un(b?.person?.sex))return{error:Wp,info:"Gender mismatch"};let S=y?.processCodes?.substitution;cT({tournamentId:n.tournamentId,eventId:l.eventId,inContextDualMatchUp:u,drawDefinition:s,dualMatchUp:f});let U=f?.sides?.find(({sideNumber:k})=>k===I.sideNumber);if(!U)return q({result:{sideNumber:I.sideNumber,existingParticipantId:r,error:Gr},stack:i});if(c?.sides?.flatMap(k=>k.participant?.individualParticipantIds||k.participant?.participantId||[])?.includes(a))return q({result:{error:BM},stack:i});let T=u?.sides?.find(({sideNumber:k})=>k===I.sideNumber)?.participantId,D=U.lineUp,P=D?.find(({participantId:k})=>a===k),E=D?.reduce((k,F)=>F.substitutionOrder>k?F.substitutionOrder:k,0),R=D?.map(k=>{let F=xe(k,!1,!0);if(![r,a].includes(F.participantId))return F;if(!o&&[r,a].includes(F.participantId)&&(F.collectionAssignments=F.collectionAssignments?.filter(x=>!(x.collectionPosition===d&&x.collectionId===p))),o&&r===F.participantId&&(F.collectionAssignments=F.collectionAssignments.map(x=>x.collectionPosition===d&&x.collectionId===p&&x.substitutionOrder===void 0?{...x,substitutionOrder:E}:x)),F.participantId===a){F.collectionAssignments||(F.collectionAssignments=[]);let x={collectionId:p,collectionPosition:d};o&&(x.previousParticipantId=r,x.substitutionOrder=(E??0)+1),F.collectionAssignments.push(x)}return F})??[];if(!P){let k={collectionId:p,collectionPosition:d};o&&(k.substitutionOrder=(E??0)+1,k.previousParticipantId=r);let F={collectionAssignments:[k],participantId:a};R.push(F)}let C=g===Vt,{assignedParticipantIds:M}=yE({lineUp:D,collectionPosition:d,collectionId:p}),{assignedParticipantIds:N}=yE({lineUp:R,collectionPosition:d,collectionId:p});if(U.lineUp=R,T&&m){let k=ag({participantId:T,lineUp:R,drawDefinition:s,tieFormat:m});if(k.error)return q({result:k,stack:i})}else console.log("team participantId not found");let A,O;if(C){let{tournamentRecord:k}=t,F=oo({participantIds:N,tournamentRecord:k});if(!F.participant){let L=Dl({returnParticipant:!0,pairOverride:!0,tournamentRecord:k,participant:{participantRole:Qr,individualParticipantIds:N,participantType:mt}});if(L.error)return q({result:L,stack:i});A=L.participant?.participantId}F=oo({participantIds:M,tournamentRecord:k});let x=F.participant?.participantId;x&&rg({participantIds:[x],tournamentRecord:k}).success&&(O=x)}if(o||I.substitutions?.length===1){if(o)S&&h&&(h.processCodes=lt([...h?.processCodes??[],...S]));else for(let k of S||[]){let F=h?.processCodes?.lastIndexOf(k);F!==void 0&&h?.processCodes?.splice(F,1)}h&&Dt({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:s})}return f&&Dt({tournamentId:n?.tournamentId,matchUp:f,context:i,drawDefinition:s}),{...W,modifiedLineUp:R,participantRemoved:O,participantAdded:A}}function xce({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){if(!a||!t||!Array.isArray(n))return{modifiedLineUp:i?.lineUp||[],error:re};let s=i?.lineUp||Jp({participantId:e,drawDefinition:r})?.lineUp,o=[],l=[];return{modifiedLineUp:s?.map(u=>{if(!n.includes(u.participantId))return u;let c=u.collectionAssignments?.filter(d=>{let p=d.collectionId===a&&d.collectionPosition===t;return p&&(d.previousParticipantId&&o.push(d.previousParticipantId),l.push({participantId:u.participantId,...d})),!p});return{participantId:u.participantId,collectionAssignments:c}}).filter(Boolean)||[],assignmentsRemoved:l,previousParticipantIds:o}}function bqe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r=(i.events||[]).filter(a=>a?.eventType===lr&&a?.entries?.some(s=>s.participantId===e)),n=a=>!t.includes(a.participantId);for(let a of r){a.entries=(a.entries||[]).filter(n);let{flightProfile:s}=Vi({event:a});s?.flights?.forEach(o=>{o.drawEntries=(o.drawEntries||[]).filter(n)}),a?.drawDefinitions?.forEach(o=>{o.entries=(o.entries||[]).filter(n)})}return{...W}}function PA({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return q({result:{error:Ie},stack:n});if(!e||!t)return q({result:{error:Je},stack:n});let a=r.participants??[],s=a.find(d=>d.participantId===e);if(!s)return q({result:{error:Gi},stack:n});if(s?.participantType&&![$t,ts].includes(s.participantType))return q({context:{participantType:s.participantType},result:{error:Lo},stack:n});let o=t.filter(d=>a.find(p=>p.participantId===d)?.participantType!==yt);if(o.length)return q({result:{error:Ua,invalidParticipantIds:o},stack:n});s.individualParticipantIds||(s.individualParticipantIds=[]);let l=s.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&MN({individualParticipantIds:u,tournamentRecord:r}),s.individualParticipantIds=s.individualParticipantIds.concat(...u));let{topics:c}=Ts();if(c.includes(nn)){let d=a.find(({participantId:p})=>p===e);at({topic:nn,payload:{participants:[d]}})}return bqe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:xe(s,!1,!0),added:u.length,...W}}function EA(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:s}=t;if(!n)return{error:Ie};if(!s)return{error:Vm};if(!s.participantId)return Dl({tournamentRecord:n,participant:s});let{participant:o}=ip({participantId:s.participantId,tournamentRecord:n});if(!o)return Dl({tournamentRecord:n,participant:s});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:f,onlineResources:h,contacts:m,person:g}=s;if(f&&o.participantType!==f)return{error:are};let I={};if(m&&(I.contacts=m),h&&(I.onlineResources=h),c&&ai(c)&&(I.participantOtherName=c),d&&ai(d)&&(I.participantName=d),Array.isArray(u)){let{participants:v}=Ei({participantFilters:{participantTypes:[yt]},tournamentRecord:n}),w=v?.map(wt);if(w){let y=u.filter(b=>ai(b)&&w.includes(b));([ts,ti].includes(f||o.participantType)||f===mt&&(y.length===2||a))&&(I.individualParticipantIds=y),o.participantType===pb.PAIR&&e&&(I.participantName=wqe({individualParticipants:v,newValues:I}))}}return Object.keys(bV).includes(p)&&(I.participantRole=p),Object.keys(pb).includes(f)&&(I.participantType=f),Array.isArray(l)&&(I.participantRoleResponsibilties=l),o.participantType===pb.INDIVIDUAL&&g&&Sqe({updateParticipantName:e,existingParticipant:o,newValues:I,person:g}),Object.assign(o,je(I)),i&&PA({individualParticipantIds:[o.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),at({topic:nn,payload:{tournamentId:n.tournamentId,participants:[o]}}),{participant:xe(o),...W}}function wqe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n?.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function Sqe({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:s,nationalityCode:o,personId:l,birthdate:u,tennisId:c,sex:d}=r;d&&Object.keys(s2).includes(d)&&(n.sex=d);let p;if(ai(l)&&(n.personId=l),o&&ai(o)&&(Uqe(o)||o==="")&&(n.nationalityCode=o),a&&typeof ai(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),s&&typeof ai(s)&&s.length>1&&(n.standardGivenName=s,p=!0),p&&t){let f=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=f}u&&kn(u)&&(n.birthdate=u),c&&ai(c)&&(n.tennisId=c),Object.assign(e.person,n)}function Uqe(t){return gd.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function NE(t){let e=CG(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",r=t.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:s,event:o}=t;if(!s)return q({result:{error:pr},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return q({result:{error:Qie},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:u,relevantAssignments:c,collectionPosition:d,teamParticipants:p,collectionId:f,matchUpType:h,dualMatchUp:m,tieFormat:g}=e;if(u?.sides?.flatMap(x=>x.participant?.individualParticipantIds||x.participant?.participantId||[])?.includes(s))return q({result:{...W},stack:i});r=r??(t.sideNumber?l?.sides?.find(x=>x.sideNumber===t.sideNumber)?.participantId:void 0);let I=Ei({participantFilters:{participantIds:[s]},tournamentRecord:n})?.participants?.[0];if(!I)return q({result:{error:Gi},stack:i});let{appliedPolicies:v}=Ct({tournamentRecord:n,drawDefinition:a,event:o}),w=t.policyDefinitions?.[Nr]??v?.[Nr]??ny[Nr];if((t.enforceGender??w?.participants?.enforceGender)!==!1&&vl(u?.gender)&&un(u?.gender)!==un(I.person?.sex))return{error:Wp,info:"Gender mismatch"};let{individualParticipantIds:y,participantType:b}=I;if(Di(qt)(h)&&b!==yt)return{error:Lo};let S=b===yt?[s]:y,U=r&&p?.find(({participantId:x})=>x===r)||p?.find(({individualParticipantIds:x})=>$n(S,x));if(!U)return{error:XB};if(r||(r=U.participantId),!r)return{error:Gi};let T=c?.find(x=>x.participantId===U?.participantId)?.drawPosition,D=m?.sides?.find(x=>x.participantId===r)?.sideNumber,P=u?.sides?.find(x=>T&&x.drawPosition===T)?.sideNumber,E=D??P??t.sideNumber;if(!g)return{error:jv};if(!g.collectionDefinitions?.find(x=>x.collectionId===f))return{error:Kie};cT({tournamentId:n.tournamentId,eventId:o.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:m});let R=m?.sides?.find(x=>x.sideNumber===E),C=u?.sides?.find(x=>x.sideNumber===E),M=(R?.lineUp??Jp({participantId:r,drawDefinition:a})?.lineUp)?.filter(x=>x.collectionAssignments?.find(L=>L.collectionPosition===d&&L.collectionId===f&&!L.previousParticipantId))?.map(x=>x?.participantId),N=M?.length>1&&M||(b===mt?I.individualParticipantIds:[s]),A=xce({collectionPosition:d,teamParticipantId:r,dualMatchUpSide:R,drawDefinition:a,participantIds:N,collectionId:f});if(A.error)return q({result:A,stack:i});let{modifiedLineUp:O}=A,k;if(h===Vt){if(b!==mt){let x=Kk({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:g});if(x?.error)return q({result:x,stack:i});if(x=F({side:C}),x.error)return x;k=x.deletedParticipantId,R&&(R.lineUp=O),m&&Dt({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:a})}else if(b===mt)for(let x of N)Kk({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:x,collectionId:f,tieFormat:g})}else{let x=Kk({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:g});if(x?.error)return x}if(R&&(R.lineUp=O),m&&Dt({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:a}),k){let{error:x}=rg({participantIds:[k],tournamentRecord:n});x&&console.log("cleanup")}return{...W,modifiedLineUp:O};function F({side:x}){let L;if(x.participant){let $=x.participant.individualParticipantIds||[];if($.filter(Boolean).length===1){let{participant:V}=oo({participantIds:$,tournamentRecord:n});$.push(s);let{participant:_}=oo({participantIds:$,tournamentRecord:n});if(!_&&V){V.individualParticipantIds=$;let B=EA({pairOverride:!0,tournamentRecord:n,participant:V});if(B.error)return B}else L=V?.participantId}}else{let $=Dl({participant:{individualParticipantIds:[s],participantRole:Qr,participantType:mt},pairOverride:!0,tournamentRecord:n});if($.error)return $}return{...W,deletedParticipantId:L}}}function Kk({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:s}){let o=Jp({participantId:e,drawDefinition:i})?.lineUp,l=(r||o)?.find(c=>c?.participantId===n),u={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(u);else{let c={collectionAssignments:[u],participantId:n};r.push(c)}return ag({participantId:e,lineUp:r,drawDefinition:i,tieFormat:s})}function Fce(t){let{tournamentRecord:e,drawDefinition:i,participantId:r,event:n}=t,a="removeTieMatchUpParticiapantId";if(!r)return q({result:{error:pr},stack:a});let s=CG(t);if(s.error)return s;let{appliedPolicies:o}=Ct({tournamentRecord:e,drawDefinition:i,event:n}),l=(t.policyDefinitions?.[Nr]??o?.[Nr]??ny[Nr])?.processCodes?.substitution,{inContextDualMatchUp:u,inContextTieMatchUp:c,relevantAssignments:d,collectionPosition:p,teamParticipants:f,collectionId:h,matchUpType:m,dualMatchUp:g,tieMatchUp:I,tieFormat:v}=s;if(!g)return q({result:{error:pa},stack:a});let w=c?.sides?.find(E=>E.participant?.participantId===r||E.participant?.individualParticipantIds?.includes(r));if(!w)return q({result:{error:Gi},stack:a});let y=t.policyDefinitions?.[vs]??o?.[vs];if(!w.substitutions?.length&&(hr({score:c?.score})||c?.winningSide)&&y?.requireParticipantsForScoring!==!1)return q({result:{error:xre},stack:a});let b=u?.sides?.find(({sideNumber:E})=>E===w.sideNumber)?.participantId;if(!b)return q({result:{error:Gi},stack:a});let S=Ei({participantFilters:{participantIds:[r]},tournamentRecord:e})?.participants?.[0];if(!S)return q({result:{error:Gi},stack:a});if(m===qt&&S.participantType===mt)return q({result:{error:Wp},stack:a});let U=S.participantType===yt?[r]:S.individualParticipantIds;cT({tournamentId:e.tournamentId,eventId:n.eventId,inContextDualMatchUp:u,drawDefinition:i,dualMatchUp:g});let T=g.sides?.find(({sideNumber:E})=>E===w.sideNumber);if(!T&&(g.sides?.filter(({lineUp:E})=>!E).length||0)<2){let E=f?.map(({participantId:R})=>({drawPosition:d?.find(C=>C.participantId===R)?.drawPosition,teamParticipantId:R}));T=g.sides?.find(R=>E?.find(({drawPosition:C})=>C===R.drawPosition)?.teamParticipantId===b)}if(!T)return q({result:{error:Gi,context:{participantId:r}}});let{modifiedLineUp:D,previousParticipantIds:P}=xce({collectionPosition:p,teamParticipantId:b,dualMatchUpSide:T,participantIds:U,drawDefinition:i,collectionId:h});if(T.lineUp=D,b&&v&&ag({participantId:b,lineUp:D,drawDefinition:i,tieFormat:v}),m===Vt&&S.participantType===yt){let E=c?.sides?.find(M=>M.sideNumber===T?.sideNumber),{participantId:R}=E??{},C=R&&Ei({participantFilters:{participantIds:[R]},tournamentRecord:e,withDraws:!0})?.participants?.[0];if(C){let M=C?.individualParticipantIds?.filter(N=>N!==r)??[];if(P&&M.push(...P),M.length>2)return q({result:{error:Ua},stack:a});if(C.draws?.length){if(M.length===1){let{participant:N}=oo({participantIds:M,tournamentRecord:e});if(!N){let A=Dl({participant:{participantRole:Qr,individualParticipantIds:M,participantType:mt},pairOverride:!0,tournamentRecord:e});if(A.error)return q({result:A,stack:a})}}}else if(M.length){C.individualParticipantIds=M;let N=EA({participant:C,pairOverride:!0,tournamentRecord:e});if(N.error)return q({result:N,stack:a})}else{let N=rg({participantIds:[R],tournamentRecord:e});N.error&&console.log("cleanup",{result:N})}}else return q({result:{error:Gi},stack:a})}if(w.substitutions?.length===1&&!c?.sides?.find(E=>E.sideNumber!==w.sideNumber)?.substitutions?.length&&I?.processCodes?.length){for(let E of l||[]){let R=I.processCodes.lastIndexOf(E);I.processCodes.splice(R,1)}Dt({tournamentId:e?.tournamentId,matchUp:I,context:a,drawDefinition:i})}return Dt({tournamentId:e?.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...W,modifiedLineUp:D}}function NG(t){let e=He(t,[{[gr]:!0,[vn]:!0,[Ol]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=t;if(r&&![1,2].includes(r))return{error:re,sideNumber:r};let{matchUp:s,structure:o}=hi({drawDefinition:i,matchUpId:n,event:a});return s?Yn({structure:o})?(s.sides?.forEach(l=>{(!r||l.sideNumber===r)&&delete l.participantId}),Dt({tournamentId:t.tournamentRecord?.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:s}),{...W}):{error:kB}:{error:pn}}function Tqe({matchUpStatuses:t=["BYE",si,Yt],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){let n=e?.reduce((c,d)=>!c||d.roundNumber>c.roundNumber?d:c,void 0),a=n?.drawPositions?.find(c=>c!==i),s=r.filter(c=>c?.drawPositions?.includes(a)).map(c=>c.matchUpStatus),o=r.filter(c=>c?.drawPositions?.includes(i)).map(c=>c.matchUpStatus),l=$n(s||[],t),u=$n(o||[],t);return{sourceMatchUp:n,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:s,loserHadMatchUpStatus:u,loserMatchUpStatuses:o}}function Dqe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:s,dualMatchUp:o,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=tt({drawDefinition:a,structureId:s});if(d?.structureType===In)return{...W};u=u??xr({drawDefinition:a});let p=(u?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:f}=Zh({drawPosition:i,matchUps:p}),h=p?.filter(g=>g.roundNumber>=l&&g.roundNumber!==f&&g.drawPositions?.includes(i)),{positionAssignments:m}=Xt({drawDefinition:a,structureId:s});for(let g of h??[])Pqe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:o,matchUpsMap:u,matchUp:g,event:c});return{...W}}function Pqe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:o,matchUpsMap:l,matchUp:u,event:c}){let d="removeSubsequentDrawPosition";if(o){let f=t.find(({matchUpId:m})=>u.matchUpId===m).sides?.find(m=>m.drawPosition===r)?.sideNumber,h=u.sides?.find(m=>m.sideNumber===f);h&&delete h.lineUp}u.drawPositions=(u.drawPositions||[]).map(f=>f===r?void 0:f).filter(Boolean);let p=e.filter(({drawPosition:f})=>u.drawPositions?.includes(f)).filter(f=>f.bye).length;return u.matchUpStatus=p&&"BYE"||Br(u.matchUpStatus)&&u.matchUpStatus||$i,Br(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&noe({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),Dt({tournamentId:n?.tournamentId,eventId:c?.eventId,context:`${d}-${r}`,drawDefinition:s,matchUp:u}),{...W}}function gy(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:s,dualMatchUp:o,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,f=Yn({structure:c}),{drawPositions:h,winningSide:m}=l.matchUp||{};if(!f&&!h)return{error:hU};let{targetLinks:{loserTargetLink:g,winnerTargetLink:I,byeTargetLink:v},targetMatchUps:{loserMatchUp:w,winnerMatchUp:y,byeMatchUp:b}}=l,S=Co({...t,matchUpStatus:a||$i,removeWinningSide:!0});if(S.error)return S;let U;if(p){let{matchUpTieId:O,matchUpsMap:k}=t;if(U=Jc({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:k,event:d}),!e&&!U.removeWinningSide)return{...W}}if(f)return{...W};let{matchUps:T}=Ot({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:s,structure:c}),{positionAssignments:D}=fr({structure:c}),P=m-1,E=1-P,R=h[P],C=h[E],{winnerParticipantId:M,loserParticipantId:N}=D?.reduce((O,k)=>(k.drawPosition===C&&(O.loserParticipantId=k.participantId),k.drawPosition===R&&(O.winnerParticipantId=k.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},A=T.filter(O=>O.drawPositions?.includes(C));if(y&&Lce({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:M,tournamentRecord:r,winnerTargetLink:I,drawDefinition:n,winnerMatchUp:y,dualMatchUp:o,matchUpsMap:s}),w){let{winnerHadMatchUpStatus:O}=Tqe({drawPositionMatchUps:A,loserDrawPosition:C,sourceMatchUps:T}),k=g.linkCondition===wl;if(O&&k){let x=Math.min(...w.drawPositions);MF({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:x,matchUpsMap:s,event:d})}let F=Eqe({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:N,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:w,dualMatchUp:o,matchUpsMap:s,event:d});if(F.error)return F}if(b){let O=Math.min(...b.drawPositions);MF({targetLink:v,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:s,event:d})}return{...W,...U&&{tieMatchUpResult:U}}}function Lce({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:o,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){let{structureId:p,roundNumber:f}=l,h="removeDirectedWinner";if(a){let m=a.target.structureId,{structure:g}=tt({drawDefinition:o,structureId:m});if(!g)return{error:yi};let{positionAssignments:I}=fr({structure:g});g.seedAssignments=(g.seedAssignments??[]).filter(U=>U.participantId!==r);let v=I?.find(U=>U.participantId===r)?.drawPosition,{matchUps:w}=Ot({drawDefinition:o,structure:g,event:d}),y=w.map(U=>U.drawPositions).flat(1/0).filter(Boolean),b=Ra(y);if((v?b[v]:void 0)===1)I?.forEach(U=>{U.participantId===r&&delete U.participantId});else{let U=w.filter(({drawPositions:T})=>T.includes(v));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:U,winnerTargetLink:a})}let S=u?.drawMatchUps?.find(({matchUpId:U})=>U===l.matchUpId);S&&Dt({tournamentId:n?.tournamentId,eventId:d?.eventId,matchUp:S,context:h,drawDefinition:o})}return f&&Dqe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:s,drawDefinition:o,dualMatchUp:c,matchUpsMap:u,roundNumber:f,structureId:p}),{...W}}function Eqe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,dualMatchUp:l,event:u}){let c="removeDirectedLoser",d=r.target.structureId,{structure:p}=tt({drawDefinition:a,structureId:d});if(!p)return{error:yi};let{positionAssignments:f}=fr({structure:p}),h=f?.find(m=>m.participantId===e)?.drawPosition;if(f?.forEach(m=>{m.participantId===e&&delete m.participantId}),n&&t){let m=o?.drawMatchUps?.find(({matchUpId:g})=>g===s.matchUpId);m.matchUpStatusCodes=t===Ui?["WO","WO"]:[]}if(p.seedAssignments=(p.seedAssignments??[]).filter(m=>m.participantId!==e),l){let m=s?.sides.reduce((v,w,y)=>w.drawPosition===h?y:v,void 0),g=o?.drawMatchUps?.find(({matchUpId:v})=>v===s.matchUpId),I=g?.sides?.[m];I&&(delete I.lineUp,Dt({tournamentId:i?.tournamentId,eventId:u?.eventId,matchUp:g,context:c,drawDefinition:a}))}return{...W}}function MF({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:s}){let o=a.target.structureId,l="removeDirectedBye";Wt({color:"brightyellow",method:l,drawPosition:r});let u=QU({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:o,event:s});return q({result:u,stack:l})}function Rqe(t){let{matchUpFormat:e,score:i}=t,r=i?.sets?.length,n=e&&Xi(e),{setFormat:a,finalSetFormat:s,bestOf:o}=n??{};return(o&&r===o&&s||a)?.timed||!1}function Cqe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){let n="attemptToSetMatchUpStatusBYE";if(r?.winningSide)return q({result:{error:Vv},context:{matchUpStatus:"BYE"},stack:n});let{positionAssignments:a}=fr({structure:i}),s=a?.filter(o=>o.bye).map(o=>o.drawPosition);return r.drawPositions?.some(o=>s?.includes(o))?(r.matchUpStatus="BYE",r.matchUpStatusCodes=[],Dt({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:r}),{...W}):q({result:{error:zie},info:"matchUp does not include BYE",stack:n})}function Ib(t){let{tournamentRecord:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:s,event:o}=t,l="doubleExitAdvancement";if(s.structureType===In)return q({result:{...W},stack:l});let{matchUp:u,targetMatchUps:c,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:f,loserTargetDrawPosition:h}=c,m=Br(p?.matchUpStatus)&&!p.sides?.map(I=>I.participantId??I.participant).filter(Boolean).length,g=p?.matchUpStatus===Ui;if(Wt({method:l,newline:!0,color:"brightyellow",keyColors:{sourceMatchUpId:"brightcyan",loserMatchUpId:"brightmagenta",winnerMatchUpId:"brightgreen"},sourceMatchUpId:u?.matchUpId,sourceStatus:t.matchUpStatus,sourceDP:JSON.stringify(u?.drawPositions),loserMatchUpId:p?.matchUpId,loserStatus:p?.matchUpStatus,loserDP:JSON.stringify(p?.drawPositions),loserTargetDP:h,loserIsEmptyExit:m,loserIsDoubleExit:g,loserSides:JSON.stringify(p?.sides?.map(I=>({sn:I.sideNumber,pid:I.participantId?.slice(0,8),fed:I.participantFed}))),winnerMatchUpId:f?.matchUpId,winnerStatus:f?.matchUpStatus,winnerDP:JSON.stringify(f?.drawPositions)}),p&&p.matchUpStatus!=="BYE"){let{loserTargetLink:I}=d,v=i?.progression?.doubleExitPropagateBye,w=p.feedRound&&p.sides?.[0]?.participantFed;if(v||w){Wt({method:l,color:"cyan",decision:"advanceByeToLoserMatchUp",propagateBye:v,targetFedIn:!!w});let y=_ce({loserTargetDrawPosition:h,tournamentRecord:e,loserTargetLink:I,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:o});if(y.error)return q({result:y,stack:l})}else if(m){let y=t.matchUpStatus===zi?zi:Ui,b=t.matchUpStatus===zi?Yt:si,S=n.drawMatchUps.find(U=>U.matchUpId===p.matchUpId);if(Wt({method:l,color:"brightred",decision:"EMPTY_EXIT_converting_to_DOUBLE_EXIT",loserMatchUpId:p.matchUpId,currentStatus:p.matchUpStatus,newStatus:y}),S){let U=[{matchUpStatus:b,previousMatchUpStatus:y,sideNumber:1},{matchUpStatus:b,previousMatchUpStatus:t.matchUpStatus,sideNumber:2}].map(D=>je(D)),T=Co({...t,matchUp:S,matchUpId:p.matchUpId,matchUpStatus:y,matchUpStatusCodes:U,winningSide:void 0,removeScore:!0});if(T.error)return q({result:T,stack:l})}}else if(g)Wt({method:l,color:"brightyellow",decision:"SKIP_loserMatchUp_already_doubleExit",loserMatchUpId:p.matchUpId});else{let{feedRound:y,drawPositions:b,matchUpId:S}=p,U=y?2:2-b.indexOf(h);Wt({method:l,color:"cyan",decision:"conditionallyAdvanceLoser",feedRound:y,walkoverWinningSide:U,loserMatchUpId:S});let T=j3({...t,targetMatchUp:p,walkoverWinningSide:U,tournamentRecord:e,sourceMatchUp:u,matchUpId:S});if(T.error)return q({result:T,stack:l})}}if(f){Wt({method:l,color:"cyan",decision:"conditionallyAdvanceWinner",winnerMatchUpId:f.matchUpId});let I=j3({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:e,sourceMatchUp:u});if(I.error)return q({result:I,stack:l})}return q({result:{...W},stack:l})}function j3(t){let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s}=t,o=r.structures.find(({structureId:_})=>_===a.structureId),l=t.matchUpStatus===zi?zi:Ui,u=t.matchUpStatus===zi?Yt:si,c="conditionallyAdvanceDrawPosition",d=s.drawMatchUps.find(_=>_.matchUpId===a.matchUpId);if(!d)return{error:pa};let p=n?.drawPositions||[],f=d.drawPositions?.filter(Boolean),h=n?.structureId===a.structureId;if(Wt({method:c,newline:!0,color:"magenta",keyColors:{targetMatchUpId:"brightcyan",sourceMatchUpId:"brightyellow"},targetMatchUpId:a.matchUpId,targetStructureId:a.structureId?.slice(0,8),targetRound:[a.roundNumber,a.roundPosition],targetDP:JSON.stringify(d.drawPositions),targetStatus:d.matchUpStatus,targetFeedRound:a.feedRound,sourceMatchUpId:n?.matchUpId,sourceStructureId:n?.structureId?.slice(0,8),sourceRound:n?[n.roundNumber,n.roundPosition]:void 0,sourceDP:JSON.stringify(p),sameStructure:h,paramMatchUpStatus:t.matchUpStatus,EXIT:u,DOUBLE_EXIT:l}),h&&$n(p,f)&&(f=f.filter(_=>!p.includes(_))),h&&f.length>1)return q({result:{error:RI},stack:c});let{pairedPreviousMatchUpIsDoubleExit:m,pairedPreviousMatchUp:g}=ioe({...t,structure:o});Wt({method:c,color:"magenta",keyColors:{pairedMatchUpId:"brightcyan"},pairedMatchUpId:g?.matchUpId,pairedRound:g?[g.roundNumber,g.roundPosition]:void 0,pairedStatus:g?.matchUpStatus,pairedStructureId:g?.structureId?.slice(0,8),pairedIsDoubleExit:m});let I=Bn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:v,targetLinks:w}=I,{loserTargetDrawPosition:y,winnerMatchUp:b,loserMatchUp:S}=v;if(S){let{loserTargetLink:_}=w,B=_ce({loserTargetDrawPosition:y,loserMatchUp:S,tournamentRecord:i,loserTargetLink:_,drawDefinition:r,matchUpsMap:s});if(B.error)return q({result:B,stack:c})}let U=d.drawPositions?.filter(Boolean)||[],T=U.length===1,D=t.walkoverWinningSide||T&&_D({drawPosition:U[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,P=Br(d.matchUpStatus)&&!U.length,E=P?l:u;Wt({method:c,color:"brightyellow",keyColors:{matchUpStatus:"brightgreen",existingExit:"brightred"},existingExit:P,matchUpStatus:E,targetCurrentStatus:d.matchUpStatus,targetDP:JSON.stringify(U),hasDrawPosition:T,walkoverWinningSide:D});let R=e.find(_=>_.matchUpId===g.matchUpId),C=[],M;n&&(n?.structureId===R?.structureId?n.roundPosition<g?.roundPosition?M=1:M=2:a.feedRound?n.structureId===a.structureId?M=2:M=1:D&&(M=3-D),Wt({method:c,color:"cyan",keyColors:{sourceSideNumber:"brightgreen"},sourceSideNumber:M,sourceStructureId:n.structureId?.slice(0,8),pairedStructureId:R?.structureId?.slice(0,8),targetStructureId:a.structureId?.slice(0,8),sameStructureAsPaired:n?.structureId===R?.structureId,targetFeedRound:a.feedRound,sourceRP:n.roundPosition,pairedRP:g?.roundPosition}));let N=t.matchUpStatus,A=g?.matchUpStatus;M===1?C=[{matchUpStatus:JT(N),previousMatchUpStatus:N,sideNumber:1},{matchUpStatus:JT(A),previousMatchUpStatus:A,sideNumber:2}]:M===2&&(C=[{matchUpStatus:JT(A),previousMatchUpStatus:A,sideNumber:1},{matchUpStatus:JT(N),previousMatchUpStatus:N,sideNumber:2}]),C.length&&(C=C.map(_=>je(_))),Wt({method:c,color:"brightgreen",keyColors:{matchUpStatus:"brightcyan",winningSide:"brightyellow"},action:"modifyMatchUpScore",targetMatchUpId:d.matchUpId,matchUpStatus:E,winningSide:D,matchUpStatusCodes:JSON.stringify(C),sourceStatus:N,pairedStatus:A});let O=Co({...t,winningSide:D,matchUp:d,matchUpStatusCodes:C,matchUpStatus:E});if(O.error)return q({result:O,stack:c});if(P)return Wt({method:c,color:"brightred",decision:"EXISTING_EXIT_triggers_recursive_doubleExitAdvancement",targetMatchUpId:d.matchUpId,matchUpStatus:E}),Ib({...t,matchUpStatus:E,targetData:I});if(!b)return q({result:{...W},stack:c});let k=f.length===2?f[D-1]:f[0],{positionAssignments:F}=Xt({structure:o}),x=F?.find(_=>_.drawPosition===k),L=s.drawMatchUps.find(_=>_.matchUpId===b.matchUpId),$=L?.drawPositions?.filter(Boolean),V=$.length===1;if(k){if(x?.bye){let _=Bn({matchUpId:L.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(V){let B=$.filter(Boolean)[0],G=_D({drawPosition:B,matchUpId:L.matchUpId,inContextDrawMatchUps:e}),j=Co({appliedPolicies:t.appliedPolicies,matchUpId:L.matchUpId,matchUp:L,matchUpStatus:u,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,winningSide:G});return j.error?q({result:j,stack:c}):fV({drawPositionToAdvance:B,matchUpId:L.matchUpId,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}else if(Br(b.matchUpStatus)){let B=Ib({...t,matchUpId:L.matchUpId,matchUpStatus:E,targetData:_});if(B.error)return q({result:B,stack:c})}return q({result:{...W},stack:c})}return Th({matchUpId:b.matchUpId,drawPosition:k,inContextDrawMatchUps:e,drawDefinition:r})}else if(m){if(!L)return{error:pa};if(V){let G=$[0],j=_D({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:G});console.log("existing drawPosition is winningSide",{walkoverWinningSide:j})}let _=Br(L.matchUpStatus)?u:l,B=Co({matchUpId:L.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:L,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,matchUpStatus:_});if(B.error)return q({result:B,stack:c});if(_===l){let G=Ib({...t,matchUpId:a.matchUpId,matchUpStatus:_,targetData:I});if(G.error)return G}}return q({result:{...W},stack:c})}function _ce(t){let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:s,loserMatchUp:o}=t,l=r?.target?.structureId,{structure:u}=tt({drawDefinition:n,structureId:l});return u?ns({drawPosition:e,tournamentRecord:i,drawDefinition:n,structureId:l,matchUpsMap:a,loserMatchUp:o,event:s}):{error:wf}}function JT(t){return t===Ui?si:t===zi?Yt:t}function Mqe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,s=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),o="attemptToSetMatchUpStatus",l=r==="BYE",u=a.winningSide,c=[Ui,zi].includes(r),d=JU({matchUpStatus:r}),p=sF({matchUpStatus:r}),f=!d&&!p,h=t.matchUpTieId||u&&d&&!c,m=u&&c;Wt({method:o,newline:!0,color:"brightyellow",keyColors:{matchUpStatus:"brightcyan",matchUpId:"brightmagenta"},matchUpId:a.matchUpId,matchUpStatus:r,existingStatus:a.matchUpStatus,existingWinningSide:u,isDoubleExit:c,isBYE:l,directing:d,nonDirecting:p,unrecognized:f,onlyModifyScore:h,changeCompletedToDoubleExit:m,propagateExitStatus:t.propagateExitStatus,teamRoundRobinContext:s});let g=()=>Co({...t,removeScore:[Fl,si].includes(r),matchUpStatus:r||$i}),I=f&&"unrecognized"||h&&"onlyModifyScore"||m&&"changeCompletedToDoubleExit"||u&&"existingWinningSide_removeDirected"||p&&"nonDirecting_clearScore"||l&&"isBYE"||!d&&"notDirecting_error"||c&&"isDoubleExit_modifyAndAdvance"||s&&"teamRoundRobinContext"||t.propagateExitStatus&&"propagateExitStatus"||"fallthrough_error";return Wt({method:o,color:"brightgreen",keyColors:{route:"brightcyan"},route:I,matchUpId:a.matchUpId}),f&&{error:Bx}||h&&GD(t)||m&&Nqe(t)||u&&gy(t)||p&&g()||l&&Cqe({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:Bx}||c&&Aqe(t)||s&&GD(t)||t.propagateExitStatus&&GD(t)||q({result:{error:Vv,info:"matchUpStatus: "+r},stack:o})}function Nqe(t){let e=gy(t);return e.error?e:Ib(t)}function Aqe(t){let e=GD({...t,removeScore:!0});return e.error?e:Ib(t)}function GD(t){let e="scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide){let n=gy(t);if(n.error)return q({result:n,stack:e})}let i=!!t.matchUp.collectionId,r=Co({...t});if(i){let{matchUpTieId:n,drawDefinition:a,matchUpsMap:s}=t,o=Jc({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,event:t.event,drawDefinition:a,matchUpsMap:s});if(o.error)return q({result:o,stack:e});Object.assign(r,{tieMatchUpResult:o})}return q({result:r,stack:e})}function kqe({drawDefinition:t,structure:e,matchUp:i}){let{drawPositions:r}=i,{positionAssignments:n}=Xt({drawDefinition:t,structure:e}),a=n?.filter(({drawPosition:l})=>r?.includes(l))?.map(l=>{let{extension:u}=rt({element:l,name:Nc});return u?.value?.groupOrder}),{containerStructures:s}=Qv({drawDefinition:t}),o=s[e.structureId];return{structureIds:Zv({drawDefinition:t,structureId:o})?.links?.source?.filter(l=>$n(a,l.source?.finishingPositions||[])).map(l=>l.source.structureId)}}function $ce({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===Kp&&Au({drawDefinition:t,structure:e})){let{structureIds:n}=kqe({drawDefinition:t,structure:e,matchUp:i});n?.length&&r.push(...n)}return{connectedStructureIds:r}}function Oqe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===So){let o=r.sides.find(({sideNumber:u})=>u!==a).participantId,l=i.find(u=>u.structureId===s.target.structureId&&u.roundNumber===s.target.roundNumber&&u.sides.some(({participantId:c})=>c===o));if(l?.matchUpStatus===$i){let u=Bn({matchUpId:l.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!tf({inContextDrawMatchUps:i,drawDefinition:n,targetData:u})){let{structure:c}=tt({structureId:l.structureId,drawDefinition:n}),d=Xt({structure:c}).positionAssignments;for(let p of d||[])if(p.participantId===o){let f=r.sides.find(({sideNumber:h})=>h===a).participantId;if(p.participantId=f,c?.positionAssignments)c.positionAssignments=d;else if(c?.structures){let h=Object.assign({},...(d||[]).map(m=>({[m.drawPosition]:m.participantId})));for(let m of c.structures)m.positionAssignments?.forEach(g=>g.participantId=h[g.drawPosition])}Ac({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:c}),e=!0}}}}return{...W,qualifierReplaced:e}}function xqe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===So){let o=r.sides.find(({sideNumber:c})=>c===a)?.participantId,l=i.filter(c=>c.structureId===s.target.structureId&&c.roundNumber===s.target.roundNumber&&c.sides.some(({participantId:d,qualifier:p})=>p&&!d)),u=xs(l);if(u?.matchUpStatus===$i){let c=Bn({matchUpId:u.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!tf({inContextDrawMatchUps:i,drawDefinition:n,targetData:c})){let d=u.sides.find(h=>h.qualifier&&!h.participantId)?.drawPosition,{structure:p}=tt({structureId:u.structureId,drawDefinition:n});if(!p)return{error:yi};let f=Xt({structure:p}).positionAssignments;for(let h of f||[])if(h.drawPosition===d&&!h.participantId){if(h.participantId=o,p.positionAssignments)p.positionAssignments=f;else if(p.structures){let m=Object.assign({},...(f||[]).map(g=>({[g.drawPosition]:g.participantId})));for(let g of p.structures)g.positionAssignments?.forEach(I=>I.participantId=m[I.drawPosition])}Ac({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:p}),e=!0}}}}return{...W,qualifierPlaced:e}}function Fqe(t){let e="attemptToSetWinningSide",i,r={},{appliedPolicies:n,disableAutoCalc:a,drawDefinition:s,dualMatchUp:o,winningSide:l,structure:u,matchUp:c}=t;if(o?._disableAutoCalc&&a!==!1)return zV(t);if(c.winningSide&&c.winningSide!==l){let{connectedStructureIds:h}=$ce({drawDefinition:s,structure:u,matchUp:c});h.length&&(console.log({connectedStructureIds:h}),i=!0);let m=gy(t);if(m.error)return m}let d=Hoe(t);if(d.context?.progressExitStatus&&Object.assign(r,d.context),d.error)return q({result:d,stack:e});let p,f;return t.qualifierChanging&&n?.[hw]?.autoReplaceQualifiers&&(p=Oqe(t).qualifierReplaced),t.qualifierAdvancing&&n?.[hw]?.autoPlaceQualifiers&&(f=xqe(t).qualifierPlaced),q({result:je({...W,...d,connectedStructures:i,qualifierReplaced:p,qualifierPlaced:f,context:r}),stack:e})}var HD={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function Bce(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:s}=t,{matchUpId:o}=s,{iteration:l=0}=t;l+=1;let u="removeDoubleExit";Wt({color:"brightyellow",method:u,matchUpId:o,iteration:l,keyColors:HD});let{targetMatchUps:{loserMatchUp:c,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:f}}=a;if(d&&d.matchUpStatus!=="BYE"){let{stage:g,roundNumber:I,roundPosition:v,structureName:w}=d;Wt({winner:"winner",roundPosition:v,structureName:w,roundNumber:I,keyColors:HD,stage:g}),G3({...t,targetMatchUp:d,sourceMatchUp:s,iteration:l})}let h=c?.matchUpStatus==="BYE"&&(c?.feedRound||c?.roundNumber===1),m=a?.targetLinks?.loserTargetLink?.linkCondition===wl;if(h&&m){let g=e.filter(({roundNumber:w,structureId:y})=>y===s.structureId&&w===1),I=g.map(({roundPosition:w})=>w),v=Sr(I.sort(),2).find(w=>w.includes(s.roundPosition));if((g.filter(({roundPosition:w})=>v.includes(w))?.map(({matchUpStatus:w})=>w)).every(w=>[zi,Ui].includes(w)))return q({result:{...W},stack:u})}if(c&&(c.matchUpStatus!=="BYE"||h)){let g=e.find(({matchUpId:U})=>U===c.matchUpId),{structure:I}=tt({drawDefinition:r,structureId:g.structureId}),{stage:v,roundNumber:w,roundPosition:y,feedRound:b,structureName:S}=c;if(Wt({loser:"loser",roundPosition:y,structureName:S,roundNumber:w,keyColors:HD,feedRound:b,stage:v}),i?.progression?.doubleExitPropagateBye||h)MF({drawPosition:p,targetLink:f,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:n});else{let U=G3({...t,targetMatchUp:c,structure:I,iteration:l});if(U.error)return q({result:U,stack:u})}}return q({result:{...W},stack:u})}function G3(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s,structure:o,iteration:l}=t,u="conditionallyRemoveDrawPosition";Wt({method:u,structureName:o?.structureName,iteration:l});let c=Bn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:d}}=c,p=s?.drawMatchUps.find(w=>w.matchUpId===a.matchUpId),f,h,m;if(a.feedRound)m=d?.drawPositions?.filter(Boolean)?.find(w=>a.drawPositions.includes(w));else if(n==null)m=_i(a?.drawPositions||[],d?.drawPositions||[])?.[0];else{h=roe({structureId:o.structureId,matchUp:n,matchUpsMap:s})?.pairedPreviousMatchUp,f=[Ui,zi].includes(h?.matchUpStatus);let w=h?.drawPositions?.filter(Boolean)||[];if([...Qi,"BYE"].includes(h?.matchUpStatus)||h?.winningSide){let y=n.drawPositions||[],b=a.drawPositions?.filter(Boolean);$n(y,b)&&(b=b?.filter(S=>!y.includes(S))),m=y.concat(w).find(S=>b?.includes(S))}}if(d&&m){let{stage:w,roundNumber:y,roundPosition:b,structureName:S}=d;Wt({method:"removeDirectedWinner",drawPositionToRemove:m,color:"brightgreen",roundPosition:b,structureName:S,roundNumber:y,keyColors:HD,stage:w}),Lce({winningDrawPosition:m,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}let g=Bce({targetData:c,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:s,structure:o,iteration:l});if(g.error)return q({result:g,stack:u});let I=Lqe({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),v=!f;return g=Co({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],matchUpStatus:I,removeScore:v,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),g.error?q({result:g,stack:u}):{...W}}function Lqe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus==="BYE"?"BYE":t?[zi,Yt].includes(e?.matchUpStatus)?Yt:si:$i}function _qe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=t,a=t.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===So){let s=r.sides?.find(({sideNumber:l})=>l===r.winningSide)?.participantId,o=i.find(l=>l.structureId===a.target.structureId&&l.roundNumber===a.target.roundNumber&&l.sides?.some(({participantId:u})=>u===s));if(o&&o.matchUpStatus===$i){let l=Bn({matchUpId:o.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!tf({inContextDrawMatchUps:i,drawDefinition:n,targetData:l})){let{structure:u}=tt({structureId:o.structureId,drawDefinition:n}),c=Xt({structure:u}).positionAssignments;for(let d of c||[])if(d.participantId===s){if(d.participantId=void 0,u?.positionAssignments)u.positionAssignments=c;else if(u?.structures){let p=Object.assign({},...(c||[]).map(f=>({[f.drawPosition]:f.participantId})));for(let f of u?.structures||[])f.positionAssignments?.forEach(h=>h.participantId=p[h.drawPosition])}Ac({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:u}),e=!0}}}}return{qualifierRemoved:e}}function $qe(t){let{matchUp:e,matchUpStatus:i,score:r,winningSide:n}=t,a="noDownStreamDependencies";if([Ui,zi].includes(e?.matchUpStatus)&&![Ui,zi].includes(i)){let g=Bce(t);if(g.error)return q({result:g,stack:a})}let s=i===Ui,o=hr({score:r})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!n),l=t?.inContextMatchUp?.collectionId&&Rqe(t.inContextMatchUp),u=t.removeScore||!l&&![Na,Ma].includes(i||Na),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!n&&!hr({score:r}),d=g=>{let I,{structure:v,drawDefinition:w,dualMatchUp:y,disableAutoCalc:b}=t;if(y?._disableAutoCalc&&b!==!1)return zV({...t,removeWinningSide:c});let{connectedStructureIds:S}=$ce({drawDefinition:w,structure:v,matchUp:e});S.length&&(console.log({connectedStructureIds:S}),I=!0),Object.assign(t,{removeScore:g});let U=gy(t);if(U.error)return U;if(t.removingQualifier&&t.appliedPolicies?.[hw]?.autoRemoveQualifiers){let T=_qe(t);return{...W,connectedStructures:I,...T}}return{...W,connectedStructures:I}};if(c&&n&&t.isCollectionMatchUp)return H3(t);let p=[Fl,Ma].includes(i)&&t.dualWinningSideChange,f=i&&i!==$i,h=t.propagateExitStatus&&Br(i),m=(n||p||h)&&Fqe(t)||o&&d(u)||f&&Mqe(t)||c&&d(u)||e&&H3({...t,removeScore:!0})||{...W};return q({result:m,stack:a})}function H3(t){let e="ndd:scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let r=gy(t);if(r.error)return r}let i=Co({...t});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:n,event:a,matchUpsMap:s}=t,{removeWinningSide:o}=Jc({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:n,matchUpsMap:s,event:a});o&&console.log("REMOVE WINNING SIDE")}return q({result:i,stack:e})}function AG(t){let e=He(t,[{[gr]:!0,[vn]:!0,[Ol]:!0},{homeParticipantId:!0,[zs]:pr}]);if(e.error)return e;let i=dy(t,[{[qv]:Vu,attr:{[nN]:!0}}]);if(i.error)return i;let r=i?.matchUp?.matchUp?.sides?.map(c=>c?.participantId);if(t.homeParticipantId&&!r?.includes(t.homeParticipantId))return{error:Fo};let{disableNotice:n,homeParticipantId:a,removePriorValues:s,tournamentRecord:o,drawDefinition:l,matchUpId:u}=t;return ka({duplicateValues:!1,removePriorValues:s,tournamentRecord:o,drawDefinition:l,disableNotice:n,matchUpId:u,timeItem:{itemType:nV,itemValue:a}})}function Vce({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Mf({timeItems:i?.timeItems||[],itemType:wN});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function op(t){let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,scheduledTime:o,matchUpId:l}=t;if(!l)return q({result:{error:Dn},stack:e});if(!Wv(o))return q({result:{error:Ns},stack:e});if(!i){let f=hi({drawDefinition:a,matchUpId:l});if(f.error)return q({result:f,stack:e});i=f.matchUp}let u=Ze(o),c=Nf({matchUp:i}).scheduledDate,d=u&&!c;if((Vce({matchUp:i}).timeModifiers||[])?.length){let f=jce({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(f?.error)return q({result:f,stack:e})}let p=Wm(o,!0,d);return ka({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,matchUpId:l,timeItem:{itemType:Qm,itemValue:p}})}function jce({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:s}){let o="addMatchUpTimeModifiers";if(!a)return q({result:{error:Dn},stack:o});if(n!==void 0&&!Array.isArray(n))return q({info:Zp("timeModifiers"),result:{error:re},stack:o});if(!s){let d=hi({drawDefinition:i,matchUpId:a});if(d.error)return q({result:d,stack:o});s=d.matchUp}let l=Vce({matchUp:s}).timeModifiers||[],u=n.filter(d=>!l.includes(d));if(n.length&&!u.length)return{...W};if(u.some(d=>rF.includes(d))){l=l.filter(p=>!rF.includes(p));let d=op({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return q({result:d,stack:o})}let c=n?.length?[...u,...l]:void 0;return ka({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:wN,itemValue:c}})}function RA({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:Dn};let s=t&&yl.test(t);if(t&&!s)return{error:Yi};let o={itemValue:Ze(t),itemType:Jm};return ka({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o})}function CA({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtIds:o}){if(!i&&!e)return{error:Ie};if(!s)return{error:Dn};let l=hi({drawDefinition:r,matchUpId:s});if(l.error)return l;if(l?.matchUp?.matchUpType!==Wa)return{error:fa};if(!(o===void 0||Array.isArray(o)&&o.length&&o.every(c=>typeof c=="string")))return{error:re,context:{courtIds:o}};let u;if(o){let c=e||i&&{[i.tournamentId]:i},d=Hu({tournamentRecords:c});if(d.error)return d;let p=d.courts?.filter(f=>o.includes(f.courtId));if(p?.length!==o.length)return{error:re,context:{courtIds:o}};u=p?.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return ka({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:Nu,itemDate:a,itemValue:u}})}function Iy({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:s}){if(!i)return{error:Ie};if(!a)return{error:Dn};if(s){let o=go({tournamentRecords:e,tournamentRecord:i,venueId:s});if(o.error)return o}return ka({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Xm,itemValue:s}})}function dg({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtId:o}){if(!i&&!e)return{error:Ie};if(!s)return{error:Dn};if(o){let l=ap({tournamentRecords:e,tournamentRecord:i,courtId:o});if(l.error)return l;let u=l.venue?.venueId;Iy({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,venueId:u})}return ka({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:kd,itemDate:a,itemValue:o}})}function Zo(t,e){let i=lne.test(t)?t:fi(t),r=Ze(t)||Ze(e)||Hs(new Date);return new Date(`${r}T${i}`).getTime()}function MA(t){let e="addMatchUpScheduleItems",i=He(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[Jn]:Zn}],e);if(i.error)return i;let{matchUpDependencies:r,inContextMatchUps:n}=t,{proConflictDetection:a=!1,errorOnAnachronism:s=!1,checkChronology:o=!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,disableNotice:p,drawMatchUps:f,matchUpId:h,schedule:m,event:g}=t,I,v;if(f)I=f.find(A=>A.matchUpId===h);else{let A=hi({drawDefinition:d,event:g,matchUpId:h});if(A.error)return A;I=A.matchUp}let{endTime:w,courtId:y,courtIds:b,courtOrder:S,resumeTime:U,homeParticipantId:T,scheduledDate:D,scheduledTime:P,startTime:E,stopTime:R,timeModifiers:C,venueId:M}=m;o&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=Io({drawDefinition:d}));let N=r?.[h]?.matchUpIds;if(m.scheduledDate&&o&&N){let A=n?.filter(O=>(O.schedule?.scheduledDate||Ze(O.schedule?.scheduledTime))&&N.includes(O.matchUpId)).map(({schedule:O})=>{let k=rE(O);return new Date(k??"").getTime()});if(A?.length){let O=rE(m),k=new Date(O??"").getTime();if(Math.max(...A)>=k){if(s)return q({result:{error:Lx},stack:e});v=Lx}}}if(D!==void 0){let A=RA({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledDate:D,matchUpId:h});if(A?.error)return q({result:A,stack:e,context:{scheduledDate:D}})}if(P!==void 0){let A=op({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledTime:P,matchUpId:h,matchUp:I});if(A?.error)return q({result:A,stack:e,context:{scheduledTime:P}})}if(E!==void 0){let A=OG({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,startTime:E,event:g});if(A?.error)return q({result:A,stack:e,context:{startTime:E}})}if(R!==void 0){let A=FG({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,stopTime:R,event:g});if(A?.error)return q({result:A,stack:e,context:{stopTime:R}})}if(U!==void 0){let A=LG({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,resumeTime:U,matchUpId:h,event:g});if(A?.error)return q({result:A,stack:e,context:{resumeTime:U}})}if(w!==void 0){let A=xG({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,endTime:w,event:g});if(A?.error)return q({result:A,stack:e,context:{endTime:w}})}if(b!==void 0){let A=CA({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,courtIds:b});if(A?.error)return q({result:A,stack:e,context:{courtIds:b}})}if(a&&y!==void 0&&D!==void 0&&S!==void 0&&ct(S)){let A=Ke(S),O=(Tr({tournamentRecord:c})?.matchUps??[]).find(k=>{if(k.matchUpId===h)return!1;let F=k.schedule?.courtOrder?Ke(k.schedule.courtOrder):void 0;return k.schedule?.courtId===y&&F===A&&k.schedule?.scheduledDate===D});if(O)return q({result:{error:Eie,info:`Court slot already occupied by matchUp ${O.matchUpId}`},stack:e,context:{courtId:y,courtOrder:S,scheduledDate:D}})}if(y!==void 0&&D!==void 0){let A=dg({courtDayDate:D,disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:h,courtId:y});if(A?.error)return q({result:A,stack:e,context:{courtId:y}})}if(M!==void 0){let A=Iy({disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:h,venueId:M});if(A?.error)return q({result:A,stack:e,context:{venueId:M}})}if(S!==void 0&&ct(S)){let A=kG({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,courtOrder:S,matchUpId:h});if(A?.error)return q({result:A,stack:e,context:{courtOrder:S}})}if(C!==void 0){let A=jce({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,timeModifiers:C,matchUpId:h,matchUp:I});if(A?.error)return q({result:A,stack:e,context:{timeModifiers:C}})}return ai(T)&&AG({disableNotice:!0,homeParticipantId:T,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h}),p||Dt({tournamentId:c?.tournamentId,eventId:g?.eventId,context:e,drawDefinition:d,matchUp:I}),v?{...W,warnings:[v]}:{...W}}function kG({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:Dn};if(n&&!ct(n))return{error:re,info:"courtOrder must be numeric"};let s=n&&Ke(n);return ka({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:bN,itemValue:s}})}function Gce({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:s}){if(!s)return{error:Dn};if(!n)return{error:pr};if(e){let l=Ei({tournamentRecord:e,participantFilters:{participantTypes:[yt],participantRoles:[yV]}}).participants??[];if(!Cd({tournamentParticipants:l,participantId:n}))return{error:Gi}}let o={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(o.itemSubTypes=[a]),ka({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:s,timeItem:o})}function OG({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:s}){if(!n)return{error:Dn};if(!Wv(a))return{error:Ns};let{matchUp:o}=hi({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=Nf({matchUp:o}),u=(o?.timeItems??[]).filter(c=>[uc,au,Oc].includes(c?.itemType)).map(c=>Zo(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||Zo(a,l)<u){o?.timeItems&&(o.timeItems=o.timeItems.filter(d=>d.itemType!==Uo));let c=Wm(a,!0,!0);return ka({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:Uo,itemValue:c}})}else return{error:Dre}}function xG({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:s,event:o}){if(!a)return{error:Dn};if(!Wv(s))return{error:Ns};let{matchUp:l}=hi({drawDefinition:r,event:o,matchUpId:a}),{scheduledDate:u}=Nf({matchUp:l}),c=(l?.timeItems??[]).filter(d=>[Uo,au,uc].includes(d?.itemType)).map(d=>Zo(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||Zo(s,u)>c){l?.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Oc));let d=Wm(s,!0,!0);return ka({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Oc,itemValue:d}})}else return{error:Ure}}function FG({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:s}){if(!n)return{error:Dn};if(!Wv(a))return{error:Ns};let{matchUp:o}=hi({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=Nf({matchUp:o}),u=o?.timeItems??[];if(u.reduce((h,m)=>m.itemType===Oc||h,void 0))return{error:zB};let c=u.filter(h=>[Uo,au,uc].includes(h?.itemType)).sort((h,m)=>Zo(h.itemValue,l)-Zo(m.itemValue,l)),d=c.at(-1),p=d?.itemType===uc,f=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Zo(h.itemValue,l)).reduce((h,m)=>!h||m>h?m:h,void 0);if(Zo(a,l)>f){if(o?.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let h={itemValue:Wm(a,!0,!0),itemType:uc};return ka({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:h})}else return{error:Tre}}function LG({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:s}){if(!a)return{error:Dn};if(!Wv(n))return{error:Ns};let{matchUp:o}=hi({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:l}=Nf({matchUp:o}),u=o?.timeItems??[];if(u.reduce((h,m)=>m.itemType===Oc||h,void 0))return{error:zB};let c=u.filter(h=>[Uo,au,uc].includes(h?.itemType)).sort((h,m)=>Zo(h.itemValue,l)-Zo(m.itemValue,l)),d=c.at(-1),p=d?.itemType===au,f=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Zo(h.itemValue,l)).reduce((h,m)=>!h||m>h?m:h,void 0);if(Zo(n,l)>f){if(o?.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let h={itemValue:Wm(n,!0,!0),itemType:au};return ka({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:h})}else return{error:e0e}}function Bqe(t){let{targetData:e,matchUpsMap:i}=t,{targetMatchUps:{loserMatchUp:r}}=e,n=Br(r?.matchUpStatus),a=!!i?.drawMatchUps.find(s=>s.loserMatchUpId===r?.matchUpId&&Br(s.matchUpStatus));return a&&r?.matchUpStatus===Ui||a&&n}function Vqe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:s,matchUp:o,event:l,score:u}){let c=xe(n,void 0,!0);for(let p of c?.tieMatchUps||[])p.matchUpId===o.matchUpId&&(p.winningSide=r,p.score=u,!hr({score:u})&&!e?Object.assign(p,{..._N}):e&&(p.matchUpStatus=e));a=a??bn({matchUp:o,structure:s,drawDefinition:t,event:l})?.tieFormat;let{winningSide:d}=uT({matchUp:c,drawDefinition:t,matchUpsMap:i,structure:s,tieFormat:a,event:l});return{projectedWinningSide:d}}function jqe(t){let{tournamentRecord:e,inContextMatchUp:i,structure:r,drawDefinition:n}=t,a=i.roundNumber,s=i.sides.find(b=>b.sideNumber===i.winningSide),o=i.sides.find(b=>b.sideNumber!==i.winningSide),{drawPosition:l,participantId:u}=s,{drawPosition:c,participantId:d}=o,p="swapWinnerLoser",{matchUps:f}=Ot(t),h=f.filter(({drawPositions:b,roundNumber:S})=>b?.includes(l)&&S>a);ha({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:h}),h.forEach(b=>{b.drawPositions=b.drawPositions?.map(S=>S===l?c:S)||[],Dt({tournamentId:e?.tournamentId,eventId:t.event?.eventId,context:p,drawDefinition:n,matchUp:b})});let{stage:m,stageSequence:g}=r,I=n.structures.filter(({stage:b,stageSequence:S})=>b===m&&S>g).map(({structureId:b})=>b),{targetLinks:{loserTargetLink:v,winnerTargetLink:w}}=t.targetData,y=[v?.target.structureId,w?.target?.structureId].filter(Boolean);return n.structures.filter(({stage:b,structureId:S})=>b!==m&&y.includes(S)).forEach(({stage:b,stageSequence:S,structureId:U})=>{I.includes(U)||I.push(U),n.structures.filter(({stage:T,stageSequence:D})=>T===b&&D>S).forEach(({structureId:T})=>{I.includes(T)||I.push(T)})}),n.structures.filter(({structureId:b})=>I.includes(b)).forEach(b=>{let{positionAssignments:S}=Xt({structure:b}),U=S?.find(({participantId:D})=>D===u),T=S?.find(({participantId:D})=>D===d);U&&(U.participantId=d),T&&(T.participantId=u)}),Co({...t})}function Of(t){let e="setMatchUpStatus";t.matchUpStatus&&[si,Ui].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,propagateExitStatus:n,tournamentRecords:a,tournamentRecord:s,disableAutoCalc:o,enableAutoCalc:l,drawDefinition:u,matchUpStatus:c,winningSide:d,matchUpId:p,event:f,score:h}=t;if(!u)return{error:$e};if(c&&[Fl,Na,Ma,$i].includes(c)&&d)return{error:re,winningSide:d,matchUpStatus:c};if(![void 0,...Dae].includes(c))return q({result:{error:Vv},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let m=xr({drawDefinition:u}),{matchUps:g}=nr({nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:m,event:f}),I=m.drawMatchUps.find(V=>V.matchUpId===p),v=g?.find(V=>V.matchUpId===p);if(!I||!g)return{error:pn};if((I.winningSide||d)&&c==="BYE")return{context:"Cannot have Bye with winningSide",error:ND,matchUpStatus:c};let w=v?.structureId,{structure:y}=tt({drawDefinition:u,structureId:w}),b=Di(ti)(I.matchUpType),S=v?.drawPositions?.filter(Boolean),U=v?.matchUpTieId,T=Bn({matchUpId:U||p,inContextDrawMatchUps:g,drawDefinition:u});Object.assign(t,{inContextDrawMatchUps:g,inContextMatchUp:v,matchUpTieId:U,matchUpsMap:m,targetData:T,structure:y,matchUp:I});let D=c===$i&&h?.scoreStringSide1===""&&h?.scoreStringSide2===""&&!d;if(Bqe(t)&&D)return{error:jLe};let P=tf(t),E;if(b){if(o)It({extension:{name:Jh,value:!0},element:I});else if(l){let V=I.winningSide,{winningSide:_,scoreStringSide1:B,scoreStringSide2:G,set:j}=uT({drawDefinition:u,matchUpsMap:m,structure:y,matchUp:I,event:f}),Y={scoreStringSide1:B,scoreStringSide2:G,sets:j?[j]:[]};if(E=_!==V,P&&E)return q({stack:"winningSideWithDownstreamDependencies",result:{error:$M},context:{winningSide:d,matchUp:I}});On({name:Jh,element:I}),Object.assign(t,{winningSide:_,dualWinningSideChange:E,projectedWinningSide:_,score:Y})}cT({tournamentId:s?.tournamentId,inContextDualMatchUp:v,eventId:f?.eventId,dualMatchUp:I,drawDefinition:u})}if(b&&c&&[qm].includes(c))return{info:"Not supported for matchUpType: TEAM",error:re};if(h&&!b&&!r){let V=I.matchUpFormat??y?.matchUpFormat??u?.matchUpFormat??f?.matchUpFormat,_=Mj({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:V,matchUpStatus:c,winningSide:d,score:h});if(_.error)return _}let R=Ct({policyTypes:[hw,vs],tournamentRecord:s,drawDefinition:u,event:f})?.appliedPolicies??{};Ut(t.policyDefinitions)&&Object.assign(R,t.policyDefinitions);let C=Hqe({assignedDrawPositions:S,propagateExitStatus:n,inContextMatchUp:v,appliedPolicies:R,drawDefinition:u,matchUpStatus:c,structure:y,matchUp:I});if(C?.error)return C;let M=v?.stage===ze&&v.finishingRound===1,N=M&&d,A=M&&I.winningSide&&!d&&(!t.matchUpStatus||t.matchUpStatus&&sF({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!hr({outcome:t.outcome})),O=N&&d!==I.winningSide&&I.winningSide;if(Object.assign(t,{qualifierAdvancing:N,qualifierChanging:O,removingQualifier:A,appliedPolicies:R}),U){let{matchUp:V}=hi({matchUpId:U,inContext:!0,drawDefinition:u,matchUpsMap:m,event:f});if(V){let _=bn({matchUp:V,drawDefinition:u,structure:y,event:f})?.tieFormat,{projectedWinningSide:B}=Vqe({drawDefinition:u,matchUpStatus:c,dualMatchUp:V,matchUpsMap:m,winningSide:d,tieFormat:_,structure:y,matchUp:I,event:f,score:h}),G=V.winningSide;E=B!==G;let j=V._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:E,projectedWinningSide:B,autoCalcDisabled:j,matchUpTieId:U,dualMatchUp:V,tieFormat:_})}}let k=JU({matchUpStatus:c});if(!U){if(P&&!d&&(c&&sF({matchUpStatus:c})||c&&[Ui,zi].includes(c)))return{error:ND,activeDownstream:P,winningSide:d};if(d&&d===I.winningSide&&c&&!k)return{context:"winningSide must include directing matchUpStatus",error:ND,directingMatchUpStatus:k,matchUpStatus:c}}let{schedule:F}=t;if(F){let V=MA({disableNotice:!0,tournamentRecords:a,tournamentRecord:s,drawDefinition:u,matchUpId:p,schedule:F});if(V.error)return V}let x=!b&&!E&&d&&I.winningSide&&I.winningSide!==d;if(i&&x&&I.roundPosition)return jqe(t);let L=d&&!U||t.projectedWinningSide;Wt({activeDownstream:P,matchUpWinner:L,method:e,winningSide:d});let $=!P&&$qe(t)||L&&Gqe(t)||(k||t.autoCalcDisabled)&&Hce(t)||{error:kre};return q({result:$,stack:e})}function Gqe(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?Hce(t):q({stack:"winningSideWithDownstreamDependencies",result:{error:$M},context:{winningSide:i,matchUp:e}})}function Hce(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!hr({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&$i||t.winningSide&&xi||Na:t.matchUpStatus||xi,s=t.removeScore||[Fl,si].includes(a)&&![Na,Ma].includes(a),o=Co({...t,matchUpStatus:a,removeWinningSide:n,removeScore:s});if(o.error)return o;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=Jc({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:r});if(d.error)return d;Object.assign(o,{tieMatchUpResult:d})}return o}function Hqe({assignedDrawPositions:t,propagateExitStatus:e,inContextMatchUp:i,appliedPolicies:r,drawDefinition:n,matchUpStatus:a,structure:s,matchUp:o}){if(r?.[vs]?.requireParticipantsForScoring===!1)return{...W};let l=i?.sides?.map(d=>d.participantId).filter(Boolean).length,u=o?.sides?[]:Xt({structureId:s?.structureId,drawDefinition:n}).positionAssignments,c=l&&l===2||o.collectionId&&Yn({structure:s})&&l&&l>=1||t?.length===2&&u?.filter(d=>t.includes(d.drawPosition)).every(d=>d.participantId);return a&&[si,Yt,Ui].includes(a)&&l===1&&e?{...W}:a&&Tae.includes(a)&&!c?q({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:a,requiredParticipants:c},result:{error:Vv}}):{...W}}function Wce({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:$e};let{matchUp:n}=hi({drawDefinition:e,matchUpId:i,event:r});return n?.matchUpType!==Wa?{error:fa}:Of({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function zce({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:$e};if(!i)return{error:Dn};let{matchUp:r}=hi({drawDefinition:t,event:e,matchUpId:i});return r?On({name:cN,element:r}):{error:pn}}function Wqe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:s}){let o="substituteParticipant";if(!r)return{error:$e};if(!a)return{error:Dn};if(!e||!t)return q({result:{error:pr},stack:o});let{matchUp:l}=hi({drawDefinition:r,matchUpId:a,event:s});if(!l)return{error:pn};if(!l.collectionId)return q({result:{error:fa},stack:o});let u=xr({drawDefinition:r}),{matchUps:c}=nr({tournamentParticipants:i?.participants,inContext:!0,drawDefinition:r,matchUpsMap:u}),d=c?.find(f=>f.matchUpId===a),p=c?.find(f=>f.matchUpId===d?.matchUpTieId)?.sides?.find(f=>f.participant.individualParticipants.some(({participantId:h})=>h===e));return!p||n&&p.sideNumber!==n?{error:Fo}:p.participant?.individualParticipants?.map(wt).filter(f=>f!==e)?.includes(t)?MG({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:s}):q({result:{error:Fo},stack:o})}function qce(t){return Wqe(t)}function Yce({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:$e};let{matchUp:r}=hi({drawDefinition:t,matchUpId:e,event:i});return It({extension:{name:Jh,value:!0},element:r})}function Kce(t){let e="setMatchUpFormat",i=He(t,[{tournamentRecord:!0},{[Yr]:b=>qa({matchUpFormat:b}),[Ya]:IU,matchUpFormat:!0}]);if(i.error)return q({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:s,matchUpFormat:o,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:f,event:h,force:m}=t;if(a&&!Array.isArray(a))return q({result:{error:re,scheduledDates:a},stack:e});if(u&&!wh([bl,Is],u))return q({result:{error:bu},stack:e});let g=0,I=t.structureIds||l&&[l].filter(Boolean)||[],v=t.eventIds||d&&[d].filter(Boolean)||[],w=t.drawIds||f&&[f].filter(Boolean)||[];if((l||I?.length)&&!n)return q({result:{error:$e},stack:e});if(f&&c&&n){let b=Oj({tournamentRecord:r,drawDefinition:n,matchUpFormat:o,structureIds:I,structureId:l,matchUpId:c});if(b.error)return b;g+=1}let y=b=>{let S=[];for(let U of b.structures||[]){if(Array.isArray(p)&&!p.includes(U.stage)||Array.isArray(s)&&!s.includes(U.stageSequence)||I?.length&&!I.includes(U.structureId))continue;I?.length&&U.matchUpFormat!==o&&(U.matchUpFormat=o,S.push(U.structureId),g+=1);let T=((m||a)&&Ot({matchUpFilters:{matchUpStatuses:[$i]},structure:U}).matchUps)??[],D=(a&&Ot({matchUpFilters:{matchUpStatuses:[$i]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:U}).matchUps)??[];if(T?.length){let P=D?D.map(yr):T.map(yr);for(let E of T)P.includes(E.matchUpId)&&(E.matchUpFormat=a?.length?o:void 0,Dt({tournamentId:r?.tournamentId,eventId:h?.eventId,context:e,drawDefinition:b,matchUp:E}))}}return!S.length&&b.matchUpFormat!==o&&(b.matchUpFormat=o,g+=1),S};for(let b of r?.events||[])if(!(v?.length&&!v.includes(b.eventId)||u&&u!==b.eventType||u===lr))if(Array.isArray(s)||Array.isArray(p)||I?.length||w?.length)for(let S of b.drawDefinitions||[]){if(Array.isArray(w)&&!w.includes(S.drawId))continue;let U=y(S);ri({structureIds:U,drawDefinition:S})}else b.matchUpFormat!==o&&(b.matchUpFormat=o,g+=1);return g?{...W,modificationsCount:g}:{...W,info:Hv}}function _G({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){if(!i)return{error:$e};let a=hi({drawDefinition:i,matchUpId:r})?.matchUp;if(!a?.tieMatchUps)return{error:fa};let s=hi({inContext:!0,drawDefinition:i,matchUpId:r,event:n})?.matchUp,o=0;return(a?.sides||[]).forEach(l=>{l.lineUp&&delete l.lineUp}),(s?.sides||[]).forEach(l=>{if(o+=1,t===!1){let u=s?.tieFormat,c=l.participantId;u&&c&&ag({drawDefinition:i,participantId:c,lineUp:[],tieFormat:u})}Dt({tournamentId:e?.tournamentId,context:"resetMatchUpLineUps",eventId:n?.eventId,drawDefinition:i,matchUp:a})}),{...W,modificationsCount:o}}function Xce(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n,setTBlast:a}=t;if(!n)return{sets:[]};let s=n.sets||[],o=ou({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),l=ou({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),u=ou({matchUpFormat:e,matchUpStatus:i,winningSide:r,setTBlast:a,sets:s}),c=o===u?l:o;return r&&(o=r===1?u:c,l=r===2?u:c),{score:{sets:s,scoreStringSide1:o,scoreStringSide2:l}}}function zqe({sourceMatchUpStatusCodes:t,propagateExitStatus:e,sourceMatchUpStatus:i,loserParticipantId:r,tournamentRecord:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,event:l}){let u="progressExitStatus";Wt({method:u,newline:!0,color:"magenta",keyColors:{loserMatchUpId:"brightcyan",sourceMatchUpStatus:"brightyellow"},loserMatchUpId:s?.matchUpId,loserMatchUpStatus:s?.matchUpStatus,sourceMatchUpStatus:i,sourceMatchUpStatusCodes:JSON.stringify(t),loserParticipantId:r?.slice(0,8),propagateExitStatus:e});let c=Br(i)&&i!==Ur&&i||si,d=nr({inContext:!0,drawDefinition:a,matchUpsMap:o})?.matchUps,p=c,f=d?.find(h=>h.matchUpId===s?.matchUpId);if(Wt({method:u,color:"magenta",carryOverMatchUpStatus:c,updatedLoserMatchUpId:f?.matchUpId,updatedLoserStatus:f?.matchUpStatus,updatedLoserSides:JSON.stringify(f?.sides?.map(h=>({sn:h.sideNumber,pid:h.participantId?.slice(0,8),bye:h.bye}))),updatedLoserDP:JSON.stringify(f?.drawPositions),existingStatusCodes:JSON.stringify(f?.matchUpStatusCodes)}),f?.matchUpId&&p){let h,m=f.matchUpStatusCodes?.map(v=>typeof v=="string"?v:"WO")??[],g=f.sides?.find(v=>v.participantId===r);if(g?.sideNumber){let v=f?.sides?.reduce((w,y)=>y?.participantId?w+1:w,0);if(Wt({method:u,color:"brightyellow",keyColors:{decision:"brightgreen"},loserSideNumber:g.sideNumber,participantsCount:v,statusCodesLength:m.length,existingStatusCodes:JSON.stringify(m),loserMatchUpIsExit:Br(s.matchUpStatus),loserMatchUpOriginalStatus:s.matchUpStatus}),v===1&&m.length===0)h=g.sideNumber===1?2:1,m[0]=t[0],Wt({method:u,color:"brightgreen",decision:"SINGLE_PARTICIPANT_no_existing_codes",winningSide:h,statusCodes:JSON.stringify(m)});else if(!Br(s.matchUpStatus))h=g.sideNumber===1?2:1,m[0]=t[0],Wt({method:u,color:"brightgreen",decision:"TWO_PARTICIPANTS_not_exit",winningSide:h,statusCodes:JSON.stringify(m)});else{let w=m[0];m[g.sideNumber-1]=t[0];let y=g.sideNumber===1?2:1;m[y-1]=w,p=Ui,h=void 0,Wt({method:u,color:"brightred",decision:"BOTH_EXITS_converting_to_DOUBLE_WALKOVER",loserMatchUpStatus:p,winningSide:h,statusCodes:JSON.stringify(m)})}}else Wt({method:u,color:"brightyellow",decision:"NO_LOSER_PARTICIPANT_SIDE_FOUND",loserParticipantId:r?.slice(0,8),availableSides:JSON.stringify(f.sides?.map(v=>({sn:v.sideNumber,pid:v.participantId?.slice(0,8)})))});Wt({method:u,color:"brightmagenta",keyColors:{finalStatus:"brightgreen",finalWinningSide:"brightyellow"},action:"calling_setMatchUpState",loserMatchUpId:s.matchUpId,finalStatus:p,finalWinningSide:h,finalStatusCodes:JSON.stringify(m)});let I=Of({matchUpStatus:p,matchUpId:s.matchUpId,matchUpStatusCodes:m,allowChangePropagation:!0,propagateExitStatus:e,tournamentRecord:n,drawDefinition:a,winningSide:h,event:l});return q({result:I,stack:u,context:{progressExitStatus:!0}})}return q({result:{error:pa},stack:u})}function TT(t){let e=He(t,[{[Ol]:!0,[vn]:!0}]);if(e.error)return e;let i="setMatchUpStatus",r=Ds(t);if(!t.drawDefinition){let b=t.tournamentRecord??(t.tournamentId&&r[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=b);let S=Kn({eventId:t.eventId,drawId:t.drawId,tournamentRecord:b});if(S.error)return S;S.drawDefinition&&(t.drawDefinition=S.drawDefinition),t.event=S.event}let{disableScoreValidation:n,propagateExitStatus:a,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpId:d,schedule:p,event:f,notes:h}=t,m=t.matchUpFormat||t.outcome?.matchUpFormat,{policy:g}=Ef({policyType:vs,tournamentRecord:o,event:f}),I=t.allowChangePropagation!==void 0&&t.allowChangePropagation||g?.allowChangePropagation!==void 0&&g.allowChangePropagation||void 0,{outcome:v,setTBlast:w}=t;if(v?.winningSide&&![1,2].includes(v.winningSide))return{error:LM};if(m){let b=Oj({tournamentRecord:o,drawDefinition:c,matchUpFormat:m,matchUpId:d,event:f});if(b.error)return b}if(v?.score?.sets&&!v.score.scoreStringSide1){let{score:b}=Xce({...v,setTBlast:w});v.score=b,v.score.sets=v.score.sets.filter(S=>S.side1Score||S.side2Score||S.side1TiebreakScore||S.side2TiebreakScore)}let y=Of({matchUpStatusCodes:v?.matchUpStatusCodes,matchUpStatus:v?.matchUpStatus,winningSide:v?.winningSide,allowChangePropagation:I,disableScoreValidation:n,score:v?.score,propagateExitStatus:a,tournamentRecords:r,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpFormat:m,matchUpId:d,schedule:p,event:f,notes:h});if(y.context?.progressExitStatus){let b=!0,S=0;for(;b&&S<10;){b=!1,S+=1;let U=zqe({sourceMatchUpStatusCodes:y.context.sourceMatchUpStatusCodes,sourceMatchUpStatus:y.context.sourceMatchUpStatus,loserParticipantId:y.context.loserParticipantId,propagateExitStatus:t.propagateExitStatus,tournamentRecord:t.tournamentRecord,loserMatchUp:y.context.loserMatchUp,matchUpsMap:y.context.matchUpsMap,drawDefinition:t.drawDefinition,event:t.event});U.context?.loserMatchUp&&(Object.assign(y.context,U.context),b=!0)}}return q({result:y,stack:i})}function Jce(t){if(!t?.outcomes)return{error:Je};if(!Array.isArray(t.outcomes))return{error:Je,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:Ie};let s=i.filter(o=>o.tournamentId===n);if(s.length){let o=qqe({outcomes:s,tournamentRecord:a});if(o.error)return o}}return{...W}}function qqe(t){let{tournamentRecords:e,tournamentRecord:i,outcomes:r,policyDefinitions:n}=t,a={};r.forEach(s=>{let{eventId:o}=s;a[o]||(a[o]=[]),a[o].push(s)});for(let s of Object.keys(a)){let{event:o}=Kn({tournamentRecord:i,eventId:s});for(let l of a[s]){let{drawId:u}=l,c=o?.drawDefinitions?.find(d=>d.drawId===u);if(c&&u){let{matchUpFormat:d,matchUpId:p}=l,f=TT({schedule:l?.schedule,tournamentRecords:e,policyDefinitions:n,tournamentRecord:i,drawDefinition:c,matchUpFormat:d,matchUpId:p,outcome:l,drawId:u,event:o});if(f.error)return f}}}return{...W}}function Yqe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){if(!r&&!t)return{error:$e};if(!i)return{error:Je,info:"missing outcome"};if(!r&&!e)return{error:pa};if(!r){let n=hi({drawDefinition:t,matchUpId:e});if(n.error)return n;r=n.matchUp}return typeof i!="object"||!i.score?.scoreStringSide1||!i.score?.scoreStringSide2?{error:re}:It({element:r,extension:{name:cN,value:i}})}function Qce(t){return Yqe(t)}function $G(t){let e="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=t,a=He(t,[{[gr]:!0,[Ol]:!0}],e);if(a.error)return a;let s=dy(t,[{[qv]:Vu}]);if(s[zs])return s;let o=t.tournamentRecord?.tournamentId,{matchUp:l,structure:u}=s?.matchUp??{};if(!l?.tieMatchUps)return q({result:{error:fa},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...W};let c=bn({structure:u,drawDefinition:i,event:r})?.tieFormat;if(!c)return q({result:{error:Gr},info:"No inherited tieFormat",stack:e});let d=[],p=[],f=[],h=[];for(let m of c.collectionDefinitions){let{matchUpCount:g,collectionId:I}=m;p.push(I);let v=(l.tieMatchUps||[]).filter(w=>w.collectionId===I);if(v.length>g)v.sort((w,y)=>(w.matchUpStatus===$i?1:0)-(y.matchUpStatus===$i?1:0)),f.push(...v.slice(0,g)),d.push(...v.slice(3).map(yr));else if(f.push(...v),v.length<g){let w=g-v.length,y=oT({collectionDefinition:m,matchUpsLimit:w,matchUp:l,uuids:n});h.push(...y)}}for(let m of l?.tieMatchUps||[])m.collectionId&&!p.includes(m.collectionId)&&d.push(m.matchUpId);return h.length&&(f.push(...h),Nd({eventId:r?.eventId,matchUps:h,drawDefinition:i,tournamentId:o})),d.length&&ju({matchUpIds:d,eventId:r?.eventId,drawDefinition:i,tournamentId:o}),l&&(l.tieMatchUps=f,l.tieFormatId=void 0,l.tieFormat=void 0,Dt({structureId:u?.structureId,eventId:r?.eventId,context:e,drawDefinition:i,tournamentId:o,matchUp:l})),{...W,newMatchUps:h,deletedMatchUpIds:d}}function BG(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}=t,a="resetScorecard";if(!i)return q({result:{error:$e},stack:a});if(!r)return q({result:{error:Dn},stack:a});if(!ai(r))return q({result:{error:re,matchUpId:r},stack:a});let s=xr({drawDefinition:i}),{matchUps:o}=nr({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:s}),l=s.drawMatchUps.find(m=>m.matchUpId===r),u=o?.find(m=>m.matchUpId===r);if(!l||!o)return{error:pn};if(l.matchUpType!==Ca)return{error:fa};let c=Bn({inContextDrawMatchUps:o,drawDefinition:i,matchUpId:r}),d=u?.structureId,{structure:p}=tt({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:o,inContextMatchUp:u,matchUpsMap:s,targetData:c,structure:p,matchUp:l}),tf(t))return{error:$M};if(l.tieMatchUps?.length)for(let m of l.tieMatchUps){let g=Of({matchUpId:m.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:n});if(g.error)return q({result:g,stack:a})}let f=Ct({tournamentRecord:e,drawDefinition:i,event:n})?.appliedPolicies,h=Jc({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:f,drawDefinition:i,matchUpsMap:s,matchUpId:r});if(h.error)return q({result:h,stack:a});if(t.tiebreakReset&&!h.tieFormatRemoved){let m=bn({drawDefinition:i,structure:p,event:n})?.tieFormat;if(l.tieFormat&&m){let{matchUpCountDifference:g,descendantDifferences:I,ancestorDifferences:v,valueDifference:w}=xc({descendant:l.tieFormat,ancestor:m});if(I.collectionIds.length===1&&!v.collectionIds.length&&!v.groupsCount&&g===1&&w===1){let y=$G({tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n});if(y.error)return y}}}return{...W}}function Zce(t){let e=He(t,[{[vn]:!0,[qc]:!0},{[FI]:{[NU]:!1,roundNumbers:!1},[cae]:"At least one must be provided",[Jn]:on}]);if(e.error)return e;let i=Joe(t);if(i.error)return i;let{matchUpIds:r}=i,n=Di(Ca)(t.event.eventType),{tournamentRecord:a,drawDefinition:s,event:o}=t;for(let l of r){if(n){let c=BG({tiebreakReset:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(c.error||t.removeAssignments&&_G({inheritance:!1,drawDefinition:s,matchUpId:l}).error)return c}let u=Of({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(u.error)return u;if(t.removeAssignments){let c=NG({...t,matchUpId:l});if(c.error)return c}}return{...W}}function Kqe({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){if(!e)return{error:$e};let r="setOrderOfFinish";if(!Array.isArray(i))return q({info:Zp("finishingOrder"),result:{error:re},stack:r});let{completedMatchUps:n,matchUpsMap:a}=ey({inContext:!0,drawDefinition:e}),s=n?.map(yr)??[],o=i.map(yr),{matchUpTypes:l,roundNumbers:u,structureIds:c,matchUpTieIds:d}=(n??[]).filter(({matchUpId:v})=>o.includes(v)).reduce((v,w)=>{let{matchUpTieId:y,matchUpType:b,roundNumber:S,structureId:U}=w;return v.matchUpTypes.includes(b)||v.matchUpTypes.push(b),v.roundNumbers.includes(S)||v.roundNumbers.push(S),v.structureIds.includes(U)||v.structureIds.push(U),v.matchUpTieIds.includes(y)||v.matchUpTieIds.push(y),v},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||u.length>1||c.length>1)return q({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:re},stack:r});let p,f,h={},m=[],g=[];if(!i.every(({orderOfFinish:v,matchUpId:w})=>(m.push(w),v&&g.push(v),h[w]=v,p=s.includes(w),f=v===void 0||ct(v)&&Math.floor(v)>0,p&&f)))return q({result:{error:p?re:Vv},info:!p&&"matchUps must be completed"||!f&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let I=n?.filter(v=>v.structureId===c[0]&&v.roundNumber===u[0]&&v.matchUpType===l[0]&&v.matchUpTieId===d[0]&&!m.includes(v.matchUpId));for(let v of I??[]){let{orderOfFinish:w}=v||{};if(w){if(!ct(w))return q({context:{orderOfFinish:w,matchUp:v},result:{error:re},stack:r});g.push(w)}}if(vie(g).length!==g.length||Math.max(...g)>g.length)return q({info:"Values not unique or greater than expected number of values",result:{error:re},stack:r});if(c.length){let v=EN({matchUpFilters:{matchUpIds:o},structureId:c[0],drawDefinition:e,matchUpsMap:a});if(v.error)return q({result:v,stack:r});v.completedMatchUps?.forEach(w=>{w.orderOfFinish=h[w.matchUpId],Dt({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:w})})}return{...W}}function ede(t){return Kqe(t)}function tde(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=t,s="applyLineUps",o=He(t,[{[gr]:!0,[vn]:!0,[Ol]:!0},{lineUps:!0,[Jn]:on}],s);if(o.error)return o;let l=e.participants||[],u=hi({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:r});if(u.error)return u;if(!u.matchUp)return{error:pn};let{matchUp:c,structure:d}=u,{drawPositions:p,matchUpType:f}=c;if(f!==ti)return{error:fa};if(!p?.length)return{error:hU};let h=bn({matchUp:c,drawDefinition:i,structure:d,event:a})?.tieFormat,m={};for(let I of n){if(!Array.isArray(I))return{error:re,lineUp:I};let v={},w=[];for(let T of I){if(typeof T!="object")return{error:re,lineUpAssignment:T};let{participantId:D,collectionAssignments:P=[]}=T;if(!Array.isArray(P))return{error:re,collectionAssignments:P};let E=l.find(C=>C.participantId===D);if(!E)return{error:Gi};if(E.participantType!==yt)return{error:Lo};let R=c.sides?.find(C=>C.participant?.individualParticipantIds?.includes(D))?.sideNumber;R&&w.push(R);for(let C of P){if(typeof C!="object")return{error:re,collectionAssignment:C};let{collectionId:M,collectionPosition:N}=C,A=h?.collectionDefinitions?.find(F=>F.collectionId===M);if(!A)return{error:re,collectionId:M};let O=`${M}-${N}`;v[O]||(v[O]=[]);let k=v[O].length;if(Di(qt)(A.matchUpType)&&k||A.matchUpType===Vt&&k>1)return{info:"Excessive collectionPosition assignments",error:re};v[O].push(D)}}let y=Object.values(v);for(let T of y)if(T.length===2){let{participant:D}=oo({tournamentParticipants:l,participantIds:T});if(!D){let P=Dl({participant:{participantType:mt,participantRole:Qr,individualParticipantIds:T},pairOverride:!0,tournamentRecord:e});if(P.error)return P}}let b=Ra(w),S=(b[1]||0)>(b[2]||0)&&1||(b[2]||0)>(b[1]||0)&&2||void 0,U=Object.keys(m).map(T=>parseInt(T));S&&!U.includes(S)&&(m[S]=I)}if(!Object.keys(m).length)return{error:JB};if(u=hi({drawDefinition:i,matchUpId:r}),u.error)return u;if(!u.matchUp)return{error:pn};let{matchUp:g}=u;g.sides??=[];for(let I of[1,2]){let v=g.sides.find(y=>y.sideNumber===I),w=m[I];if(w)v?v.lineUp=w:g.sides.push({lineUp:w,sideNumber:I});else continue}return Dt({tournamentId:e?.tournamentId,context:s,drawDefinition:i,matchUp:g}),{...W}}var VG={};ft(VG,{anonymizeTournamentRecord:()=>Ude,generate:()=>ide,generateEventWithDraw:()=>FA,generateOutcome:()=>KG,generateOutcomeFromScoreString:()=>jG,generateParticipants:()=>vy,generateTournamentRecord:()=>wde,modifyTournamentRecord:()=>Dde,mutate:()=>Sde});var ide={};ft(ide,{generateEventWithDraw:()=>FA,generateOutcome:()=>KG,generateOutcomeFromScoreString:()=>jG,generateParticipants:()=>vy,generateTournamentRecord:()=>wde});function Xqe(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i.side1+=r.side1Score??0,i.side2+=r.side2Score??0),i),{side1:0,side2:0});return e.side1>e.side2?1:e.side2>e.side1?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function Jqe(t){let e={side1:0,side2:0};if(t.forEach(i=>{i.winningSide===1?e.side1++:i.winningSide===2&&e.side2++}),e.side1>e.side2)return 1;if(e.side2>e.side1)return 2}function Qqe(t,e,i){if(t||!e||!i)return t;let r=Xi(e);return iA(r)?Xqe(i):Jqe(i)}function Zqe(t,e,i){let r=IT({scoreString:t,matchUpFormat:e});return{sets:r,scoreStringSide1:ou({sets:r,matchUpFormat:e,setTBlast:i}),scoreStringSide2:ou({sets:r,reversed:!0,matchUpFormat:e,setTBlast:i})}}function e3e(t,e,i,r){let n=ou({sets:t,matchUpFormat:i,setTBlast:r}),a=ou({sets:t,reversed:!0,matchUpFormat:i,setTBlast:r});if(typeof n!="string")return n;if(typeof a!="string")return a;let s=e===2?a:n,o=e===2?n:a;return{sets:IT({scoreString:s,matchUpFormat:i}),scoreStringSide1:s,scoreStringSide2:o}}function jG(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n,setTBlast:a,preserveSideOrder:s=!1}=t;if(!n)return{outcome:{..._N,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:re,winningSide:r};let o=n&&IT({scoreString:n,matchUpFormat:e}),l=n?.trim().startsWith("["),u=Qqe(r,e,o),c=Xi(e),d=s||l||iA(c)?Zqe(n,e,a):e3e(o,u,e,a);return je({outcome:{matchUpStatus:i,winningSide:u,score:d}})}function GG({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){let n=(e?.[r.matchUpId]?.matchUpIds||[]).filter(a=>i.includes(a)).filter(a=>!t[a]);return{dependenciesScheduled:!n?.length,remainingDependencies:n}}function DT({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function t3e({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function Ew({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:s=0,scheduleTime:o,matchUp:l}){let u=fi(l?.schedule?.endTime),c=u?aa(u,Ke(s)):aa(o,Ke(r)+Ke(s)),d=i&&(u?aa(fi(u),i):aa(o,Ke(r)+Ke(i))),p=a?.[l.matchUpId]?.participantIds||[],f=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(h=>{DT({individualParticipantProfiles:e,participantId:h});let m=e[h].priorMatchUpType!==l.matchUpType&&d||c;f.includes(h)?t3e({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:m,participantId:h,scheduleTime:o}):(e[h].timeAfterRecovery=m,e[h].bookings.push({scheduleTime:o,timeAfterRecovery:m}))}),WI({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:c,matchUp:l})}function rde({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){let a,s=n.minutesMap?.[r]?.recoveryMinutes,o=(n.minutesMap?.[r]?.averageMinutes||0)+(s||0),l=aa(i,o),u=e?.[r]?.dependentMatchUpIds||[];if(u.length){let c=u.reduce((d,p)=>{let f=t[p];if(!f)return d;let h={scheduleTime:f,matchUpId:p};return f&&!d.matchUpId||Nt(f)<Nt(d.scheduleTime)?h:d},{});c.scheduleTime&&Nt(l)>Nt(c.scheduleTime)&&(a=c)}return{scheduledDependent:a}}function i3e(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>i===Vt&&(r?.participant?.individualParticipants||[])||r?.participant&&[r.participant]||[]).flat()}var PT="DO_NOT_SCHEDULE",r3e={DO_NOT_SCHEDULE:PT};function HG({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:s}){let o=i3e(s).map(({person:f})=>f?.personId);if(i){let f=(s?.potentialParticipants||[]).flat().map(({person:h})=>h?.personId);o.push(...f)}let l=o.map(f=>r[f]?.map(h=>({...h,personId:f}))).filter(Boolean).flat().filter(f=>f.requestType===PT&&Su(a,f.date)),u=[],c=s?.matchUpId,d=ir(fi(n),Ze(a)),p=fi(d2(d,t).toISOString());for(let f of l){let{requestId:h,startTime:m,endTime:g}=f;(n>m&&n<g||p&&p>m&&p<g)&&(u.push({matchUpId:c,request:f,scheduleTime:n}),e[h]?(e[h].scheduleTimes.includes(n)||e[h].scheduleTimes.push(n),e[h].matchUpIds.includes(c)||e[h].matchUpIds.push(c)):e[h]={request:f,scheduleTimes:[n],matchUpIds:[c]})}return{conflicts:u}}function NF({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=gN(i),s=(t[i.matchUpId]||[]).filter(o=>!$n(o,a)).flat();[...a,...s].forEach(o=>{if(DT({individualParticipantProfiles:e,participantId:o}),!e[o].potentialCounted[i.drawId]){let l=e[o].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[Ys]?l[Ys]+=r:r>0&&(l[Ys]=r),s.includes(o)&&(e[o].potentialCounted[i.drawId]=!0)}})}function n3e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,matchUpDependencies:o,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){let p=[];i||(n=d?.filter(m=>{let g=m.schedule||{},I=m.matchUpStatus==="BYE";return I&&p.push({tournamentId:m.tournamentId,matchUpId:m.matchUpId}),!I&&bT({schedule:g})&&(!u||m.schedule.scheduledDate===u)}),i=n.map(yr));let f=Array.isArray(l)?l.includes(u):l,h=f?[]:d.filter(({matchUpId:m})=>i.includes(m));for(let m of h){NF({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:m});let g=m.schedule?.scheduledTime;if(g){s[m.matchUpId]=g;let I=c?.[m.matchUpId]?.recoveryMinutes;Ew({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:o,averageMatchUpMinutes:r,recoveryMinutes:I,scheduleTime:g,matchUp:m})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:f}}function NA({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:s,matchUps:o}){if(typeof r!="object")return{error:Ci};if(!is(o)&&!Array.isArray(i))return{error:Bu};a=a??TA({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).flatMap(d=>(d.events??[]).map(p=>{let{scheduleTiming:f}=$U({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:f}}}))),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i??=o?.filter(d=>{let p=d.schedule;return bT({schedule:p})&&(!s||d.schedule.scheduledDate===s)});let c=i?.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!=="BYE");return{bookings:c?.map(({eventId:d,schedule:p,matchUpFormat:f})=>{let{event:h,scheduleTiming:m}=l[d],g=h?.eventType,I={...m,defaultTiming:u,matchUpFormat:f},{averageMinutes:v,recoveryMinutes:w}=SN({timingDetails:I,eventType:g}),{courtId:y,venueId:b}=p,S=fi(p.scheduledTime),U=aa(S,v);return{recoveryMinutes:w,averageMinutes:v,periodLength:a,startTime:S,courtId:y,endTime:U,venueId:b}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function a3e({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:s,periodLength:o,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(s&&!a&&(a={[s.tournamentId]:s}),typeof a!="object"||!Object.keys(a).length)return{error:Ci};o=o??TA({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:f,venues:h}=Hu({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=f?.filter(b=>!c||c.includes(b.venueId))??[];u=u??zI({courts:m,scheduleDate:l,startTime:!0}),p=p??zI({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:I}=NA({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:o,venueIds:c,matchUps:d}),v={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:o,startTime:u,bookings:g,endTime:p,courts:m},{scheduleTimes:w}=PG(v),y=c?.length===1&&c[0]||h?.length===1&&h[0].venueId||void 0;return{dateScheduledMatchUpIds:I?.map(Aa("matchUpId")),dateScheduledMatchUps:I,scheduleTimes:w,venueId:y}}function s3e({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,s,o,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(n=n.concat(u.matchUpIds)),u.hash,o=e,s=u.recoveryMinutes,a=u.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:s,averageMinutes:o}),{groupedRounds:r}}function nde({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:f,venues:h}){let m={},g=[],I=[],v=[];for(let w of h){let{rounds:y=[],venueId:b}=w,{scheduledRoundsDetails:S,greatestAverageMinutes:U,orderedMatchUpIds:T,minutesMap:D}=vT({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:u,matchUps:p,rounds:y});v.push(...T??[]);let{groupedRounds:P}=s3e({scheduledRoundsDetails:S,greatestAverageMinutes:U,garmanSinglePass:!0}),E,R=[];d&&({scheduleTimes:R,dateScheduledMatchUpIds:E}=a3e({averageMatchUpMinutes:P[0]?.averageMinutes,scheduleDate:Ze(c),venueIds:[w.venueId],clearScheduleDates:o,tournamentRecords:l,periodLength:u,matchUps:p}));let C=n3e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:E,greatestAverageMinutes:U,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,scheduleDate:c,minutesMap:D,matchUps:p});({dateScheduledMatchUpIds:E}=C);let M=C,{byeScheduledMatchUpDetails:N,clearDate:A}=C;N?.length&&I.push(...N);let{matchUpsToSchedule:O,matchUpMap:k}=uA({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:E,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:T,clearDate:A,matchUps:p}),F=f.filter(x=>x.venueId===b);m[b]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:U,scheduledRoundsDetails:S,dateScheduledMatchUps:M,matchUpsToSchedule:O,scheduleTimes:R,groupedRounds:P,venueCourts:F,minutesMap:D,matchUpMap:k},o||g.push(...E)}return{allDateScheduledByeMatchUpDetails:I,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:m,allDateMatchUpIds:v}}function o3e(t,e){let i=Nt(t.scheduleTime),r=Nt(t.timeAfterRecovery),n=Nt(e.scheduleTime),a=Nt(e.timeAfterRecovery),s=i===n||r===a,o=i>n&&i<a,l=n>i&&n<r,u=r>n&&r<a,c=a>i&&a<r;return je({hasOverlap:s||o||u||l||c,startAisContained:o,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function WG({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){let s=(i?.[n.matchUpId]?.participantIds||[]).flat(),o=a?.minutesMap?.[n.matchUpId]?.averageMinutes||0,l=a?.minutesMap?.[n.matchUpId]?.recoveryMinutes||0,u=s.every(p=>{DT({individualParticipantProfiles:t,participantId:p});let f=t[p];if(!f.timeAfterRecovery)return!0;let h=fi(n?.schedule?.endTime),m=h?aa(h,Ke(l)):aa(r,Ke(o)+Ke(l));return![...Object.keys(f.potentialBookings).filter(g=>g!==n.drawId).map(g=>f.potentialBookings[g]).flat(),...f.bookings].find(g=>o3e({scheduleTime:r,timeAfterRecovery:m},g).hasOverlap)}),c=e[n.matchUpId],d=(c?UU(ir(c),ir(r),!1):0)>=0;return{enoughTime:u&&d}}function ade({autoSchedulingAudit:t,tournamentRecords:e}){at({topic:lc,payload:t});let i=s=>s?Object.values(s).reduce((o,l)=>o+l.length||0,0):0,r=(t?.schedulingProfile||[]).reduce((s,o)=>s+o.venues.reduce((l,u)=>l+u.rounds.length,0),0),n={scheduledDatesCount:t.scheduledDates?.length,noTimeMatchUpIdsCount:i(t?.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t?.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t?.overLimitMatchUpIds),requestConflictsCount:i(t?.requestConflicts),profileRoundsCount:r},a={itemType:RF,itemValue:n};for(let s of Object.values(e)){let o=s.tournamentId;SU(lc)?at({payload:{type:RF,tournamentId:o,detail:n},topic:lc}):dT({tournamentRecord:s,timeItem:a})}}function zG({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=gN(r),{matchUpId:a,matchUpType:s}=r,o=(r.roundPosition&&t[a]||[]).flat(),l=lt(n.concat(...o));return l.forEach(u=>{DT({individualParticipantProfiles:e,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=e[u];if(c)return[s,Ys].find(d=>{let p=c.counters?.[d]||0,f=i[d]||0;return p&&f&&p>=f})}),relevantParticipantIds:l}}function Rw({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:s,tournamentRecord:o,matchUpDetails:l,matchUpIds:u,schedule:c}){if(!o)return{error:Ie};if(!l&&(!u||!Array.isArray(u)))return{error:$m};if(!l&&(!c||typeof c!="object"))return{error:Ere};let d,p=[],f=0;if(r&&!n){let g=Io({tournamentRecords:s,tournamentRecord:o});n=g.matchUpDependencies,d=g.matchUps}d||(d=Tr({tournamentRecord:o})?.matchUps??[]);let h=d.reduce((g,I)=>{let{matchUpId:v,drawId:w,matchUpStatus:y}=I;return(e||y!=="BYE")&&(t||!Qi.includes(y))&&(g[w]?g[w].push(v):g[w]=[v]),g},{}),m=l?.map(g=>g.matchUpId);for(let g of Object.keys(h)){let{drawDefinition:I}=sp({tournamentRecord:o,drawId:g});if(!I)continue;let v=h[g].filter(y=>u?.includes(y)??m?.includes(y)),w=xn({inContext:!1,drawDefinition:I}).matchUps;for(let y of v){let b=l?.find(U=>U.matchUpId===y)?.schedule||c,S=MA({schedule:b,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:s,tournamentRecord:o,checkChronology:r,drawDefinition:I,drawMatchUps:w,matchUpId:y});if(S?.warnings?.length&&p.push(...S.warnings),S?.success&&(f+=1),S.error)return S}}return p.length?{...W,scheduled:f,warnings:p}:{...W,scheduled:f}}function ET(t){let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:s,checkChronology:o,matchUpDetails:l,schedule:u}=t;if(t.matchUpIds&&!n)return Rw(t);let c=He(t,[{[fn]:!0},{[FI]:{matchUpContextIds:!1,matchUpDetails:!1},[Ya]:re,[Jn]:on}]);if(c.error)return c;if((!l||n)&&!u)return{error:Je,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:f}=Io({tournamentRecords:s});for(let h of Object.values(s)){let{tournamentId:m}=h,g=n?.filter(v=>v.tournamentId===m).map(yr),I=l?.filter(v=>v?.tournamentId===m);if(g?.length||I?.length){let v=Rw({matchUpDetails:I,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:h,checkChronology:o,matchUpIds:g,schedule:u});if(v.warnings?.length&&d.push(...v.warnings),v.scheduled&&(p+=v.scheduled),v.error)return v}}return d.length?{...W,scheduled:p,warnings:d}:{...W,scheduled:p}}function l3e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:f,courts:h,dryRun:m}){let g={},I={},v={},w={},y={},b={},S={},U={},T={},D={};for(let R of n){let C=Ze(R?.scheduleDate),M=R?.venues||[],N={},A={},O=(G,j)=>{G.forEach(Y=>{let K=A[Y].counters;K[j]?K[j]+=1:K[j]=1,K[Ys]?K[Ys]+=1:K[Ys]=1})};v[C]={},w[C]={},g[C]={},I[C]={},S[C]=[],U[C]=[],T[C]=[],D[C]=[];let k={};f.forEach(G=>{G.schedule?.scheduledDate&&Su(C,Ze(G.schedule.scheduledDate))&&WI({matchUpPotentialParticipantIds:N,matchUpNotBeforeTimes:k,matchUp:G})});let{allDateScheduledByeMatchUpDetails:F,venueScheduledRoundDetails:x,allDateMatchUpIds:L}=nde({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:k,matchUpScheduleTimes:b,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:C,matchUps:f,courts:h,venues:M}),$=10,V=0,_,B=10;for(;!_;){for(let{venueId:G}of M){let j=0,Y=x[G];for(;Y.courtsCount&&Y.scheduleTimes?.length&&Y.matchUpsToSchedule?.length&&j<=Y.courtsCount;){let{scheduleTime:K,attempts:X=0}=Y.scheduleTimes.shift(),Z=Y.matchUpsToSchedule.find(Q=>{let{matchUpId:ae,matchUpType:te}=Q,{participantIdsAtLimit:ne,relevantParticipantIds:le}=zG({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,matchUpDailyLimits:o,matchUp:Q});if(ne.length)return U[C].includes(ae)||U[C].push(ae),!1;let{scheduledDependent:de}=rde({matchUpScheduleTimes:b,matchUpDependencies:s,scheduleTime:K,matchUpId:ae,details:Y});if(de)return!1;let{dependenciesScheduled:pe,remainingDependencies:ve}=GG({matchUpScheduleTimes:b,matchUpDependencies:s,allDateMatchUpIds:L,matchUp:Q});if(!pe)return w[C][ae]||(w[C][ae]=[]),w[C][ae].push({scheduleTime:K,remainingDependencies:ve}),!1;let{enoughTime:Me}=WG({individualParticipantProfiles:A,matchUpNotBeforeTimes:k,matchUpDependencies:s,scheduleTime:K,details:Y,matchUp:Q});if(!Me)return v[C][ae]||(v[C][ae]=[]),v[C][ae].push({scheduleTime:K}),!1;let Ee=Y.greatestAverageMinutes,{conflicts:Be}=HG({potentials:e,averageMatchUpMinutes:Ee,requestConflicts:D,personRequests:d,scheduleTime:K,scheduleDate:C,matchUp:Q});if(Be?.length)return y[C]||(y[C]=[]),y[C].push(...Be),!1;O(le,te);let fe=Y.minutesMap?.[ae]?.recoveryMinutes;return Ew({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,matchUpNotBeforeTimes:k,averageMatchUpMinutes:Ee,matchUpDependencies:s,recoveryMinutes:fe,scheduleTime:K,matchUp:Q}),b[ae]=K,!0});Y.matchUpsToSchedule=Y.matchUpsToSchedule.filter(({matchUpId:Q})=>Q!==Z?.matchUpId),Z?j+=1:(I[C][G]||(I[C][G]=[]),I[C][G].push({scheduleTime:K,attempts:X+1}))}Y.matchUpsToSchedule?.length&&(I[C][G]=I[C][G]?.filter(K=>{let X=K.attempts<$;return X&&Y.scheduleTimes.push(K),!X})),(!Y.scheduleTimes?.length||!Y.matchUpsToSchedule?.length)&&(Y.complete=!0)}V+=1,_=M.every(({venueId:G})=>x[G].complete)||V===B}for(let{venueId:G}of M){let j=x[G].matchUpMap;Object.keys(j).forEach(Y=>{let K=u[Y];K&&Object.keys(j[Y]).forEach(X=>{let{drawDefinition:Z}=sp({tournamentRecord:K,drawId:X});Z&&j[Y][X].forEach(({matchUpId:Q})=>{let ae=b[Q];if(ae){let te=ae.split(":").map(us).join(":"),ne=`${Ze(C)}T${te}`;m?S[C].push(Q):(op({drawDefinition:Z,scheduledTime:ne,matchUpId:Q}).success&&S[C].push(Q),G&&Iy({tournamentRecord:K,drawDefinition:Z,matchUpId:Q,venueId:G}))}})})}),T[C]=x[G].matchUpsToSchedule.map(yr),g[C][G]=x[G].scheduleTimes.sort((Y,K)=>Nt(Y.scheduleTime)-Nt(K.scheduleTime))}!m&&F?.length&&ET({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let G of R.venues)for(let j of G.rounds){let Y=(j.matchUps?.map(({matchUpId:X})=>X)||[]).filter(X=>S[C].includes(X));j.canScheduledMatchUpIds=Y;let K=Math.round(Y.length/j.matchUpsCount*1e4)/100;(K===1/0||isNaN(K))&&(K=0),j.possibleToSchedulePct=K,j.matchUpsCount===Y.length&&(j.possibleToSchedule=!0)}}let P=n.map(({scheduleDate:R})=>R),E={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:S,schedulingProfile:c,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:P};return ade({tournamentRecords:u,autoSchedulingAudit:E}),{...W,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:I,recoveryTimeDeferredMatchUpIds:v,dependencyDeferredMatchUpIds:w,matchUpScheduleTimes:b,overLimitMatchUpIds:U,scheduledMatchUpIds:S,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:P}}function W3({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Je,stack:"getEarliestCourtTime"};let a=zI({scheduleDate:n,courts:[r],startTime:!0}),s=zI({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||s;let o=Fd({court:r,date:n}),{timeSlots:l}=my({courtDate:o}),u=ir(e),c=ir(i);return{earliestCourtTime:l?.reduce((d,p)=>{let f=ir(p.startTime),h=ir(p.endTime);if(f>c||h<u)return d;let m=u>f?u:f;if(UU(m,h)>=t){let g=fi(m.toISOString());g&&(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:s}}function u3e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:f=[],courts:h,dryRun:m}){let g={},I={},v={},w={},y={},b={},S={},U={},T={};for(let E of n??[]){let R=Ze(E?.scheduleDate),C=E?.venues||[],M={},N={},A=(Z,Q)=>{Z.forEach(ae=>{let te=N[ae].counters;te[Q]?te[Q]+=1:te[Q]=1,te[Ys]?te[Ys]+=1:te[Ys]=1})};g[R]={},I[R]={},b[R]=[],S[R]=[],U[R]=[],T[R]=[];let O={};f?.forEach(Z=>{Z.schedule?.scheduledDate&&Su(R,Ze(Z.schedule.scheduledDate))&&WI({matchUpPotentialParticipantIds:M,matchUpNotBeforeTimes:O,matchUp:Z})});let{allDateScheduledByeMatchUpDetails:k,allDateScheduledMatchUpIds:F,venueScheduledRoundDetails:x,allDateMatchUpIds:L}=nde({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:O,matchUpScheduleTimes:y,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:R,matchUps:f,courts:h,venues:C}),$=f?.filter(({matchUpId:Z})=>F.includes(Z)),{bookings:V}=NA({dateScheduledMatchUps:$,tournamentRecords:u,scheduleDate:R,periodLength:c}),{virtualCourts:_}=UA({scheduleDate:R,periodLength:c,bookings:V,courts:h}),B=_?.reduce((Z,Q)=>{let{earliestCourtTime:ae,courtEndTime:te}=W3({date:R,averageMinutes:0,court:Q});return(!Z.startTime||ir(ae)<ir(Z.startTime))&&(Z.startTime=ae),(!Z.endTime||ir(te)>ir(Z.endTime))&&(Z.endTime=te),Z},{}),G=B.startTime,j=({courtId:Z,booking:Q})=>_?.find(ae=>ae.courtId===Z)?.dateAvailability[0].bookings.push(Q),Y=10,K=0,X;for(;!X;){for(let{venueId:Z}of C){let Q=x[Z],ae=Q.matchUpsToSchedule.length,te=[],ne=[],le,de=0;for(;!le;){for(let pe of Q.matchUpsToSchedule){if(ne.length===Q.courtsCount||te.length===Q.courtsCount){le=!0;break}let{matchUpId:ve,matchUpType:Me}=pe,{participantIdsAtLimit:Ee,relevantParticipantIds:Be}=zG({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpDailyLimits:o,matchUp:pe});if(Ee.length){S[R].includes(ve)||S[R].push(ve);continue}let{dependenciesScheduled:fe,remainingDependencies:Te}=GG({matchUpScheduleTimes:y,matchUpDependencies:s,allDateMatchUpIds:L,matchUp:pe});if(!fe){I[R][ve]||(I[R][ve]=[]),I[R][ve].push({remainingDependencies:Te});continue}let ce=[],be=_?.reduce((we,Ae)=>{if(ne.includes(Ae.courtId))return we;let{earliestCourtTime:ye}=W3({averageMinutes:Q.greatestAverageMinutes,startTime:G,date:R,court:Ae});if(we.scheduleTime&&Nt(ye)>=Nt(we.scheduleTime))return we;let{scheduledDependent:Ne}=rde({matchUpScheduleTimes:y,matchUpDependencies:s,scheduleTime:ye,matchUpId:ve,details:Q});if(Ne)return we;let{enoughTime:he}=WG({individualParticipantProfiles:N,matchUpNotBeforeTimes:O,matchUpDependencies:s,scheduleTime:ye,details:Q,matchUp:pe});if(!he)return g[R][ve]||(g[R][ve]=[]),g[R][ve].includes(ye)||g[R][ve].push(ye),we;let De=Q.minutesMap?.[ve]?.averageMinutes||Q.greatestAverageMinutes,{conflicts:Le}=HG({potentials:e,averageMatchUpMinutes:De,requestConflicts:T,personRequests:p,scheduleTime:ye,scheduleDate:R,matchUp:pe});if(Le?.length)return ce.push(...Le),!1;A(Be,Me);let J=Q.minutesMap?.[ve]?.recoveryMinutes;return Ew({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpNotBeforeTimes:O,averageMatchUpMinutes:De,matchUpDependencies:s,recoveryMinutes:J,scheduleTime:ye,matchUp:pe}),(!we.scheduleTime||Nt(ye)<Nt(we.scheduleTime))&&(we.averageMatchUpMinutes=De,we.recoveryMinutes=J,we.scheduleTime=ye,we.courtName=Ae.courtName,we.courtId=Ae.courtId),we},{});if(be.scheduleTime){let{averageMatchUpMinutes:we,recoveryMinutes:Ae,scheduleTime:ye,courtId:Ne}=be;y[ve]=ye,w[ve]=Ne,te.push(ve),ne.push(Ne);let he=ye,De=aa(he,we);j({courtId:Ne,booking:{averageMatchUpMinutes:we,recoveryMinutes:Ae,periodLength:c,matchUpId:ve,startTime:he,courtId:Ne,endTime:De,venueId:Z}}),Q.matchUpsToSchedule=Q.matchUpsToSchedule.filter(Le=>Le.matchUpId!==ve)}else ce?.length&&(v[R]||(v[R]=[]),v[R].push(...ce))}(ne.length===Q.courtsCount||te.length===Q.courtsCount||!Q.matchUpsToSchedule.length)&&(le=!0),Q.matchUpsToSchedule.length&&te<Q.courtsCount&&(ir(G)<ir(B.endTime)?G=aa(G,c):(le=!0,Q.complete=!0)),de+=1,!le&&de>=ae&&(le=!0)}Q.matchUpsToSchedule?.length||(Q.complete=!0)}K+=1,X=C.every(({venueId:Z})=>x[Z].complete)||K===Y}for(let{venueId:Z}of C){let Q=x[Z].matchUpMap;Object.keys(Q).forEach(ae=>{let te=u[ae];te&&Object.keys(Q[ae]).forEach(ne=>{let{drawDefinition:le}=sp({tournamentRecord:te,drawId:ne});le&&Q[ae][ne].forEach(({matchUpId:de})=>{let pe=y[de],ve=w[de];if(pe){let Me=pe.split(":").map(us).join(":"),Ee=`${Ze(R)}T${Me}`;m||(op({drawDefinition:le,scheduledTime:Ee,matchUpId:de}),dg({courtDayDate:R,tournamentRecords:u,tournamentRecord:te,drawDefinition:le,matchUpId:de,courtId:ve})),b[R].push(de)}})})}),U[R]=x[Z].matchUpsToSchedule.map(yr)}!m&&k?.length&&ET({matchUpDetails:k,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let Z of E.venues)for(let Q of Z.rounds){let ae=(Q.matchUps??[]).map(({matchUpId:ne})=>ne)?.filter(ne=>b[R].includes(ne));Q.canScheduledMatchUpIds=ae;let te=Math.round((ae?.length||0)/Q.matchUpsCount*1e4)/100;(te===1/0||isNaN(te))&&(te=void 0),Q.possibleToSchedulePct=te,Q.matchUpsCount===ae?.length&&(Q.possibleToSchedule=!0)}}let D=(n??[]).map(({scheduleDate:E})=>E),P={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:b,schedulingProfile:d,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:D};return ade({tournamentRecords:u,autoSchedulingAudit:P}),{...W,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:y,overLimitMatchUpIds:S,scheduledMatchUpIds:b,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:D}}function AA(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=Qi,scheduledDates:r,venueIds:n}=t,a=Ds(t),s=Ut(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!s?.length)return{error:Ci};let o=0;for(let l of s){let u=a[l],c=c3e({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:r,venueIds:n});if(c.error)return c;o+=c.clearedScheduleCount??0}return{...W,clearedScheduleCount:o}}function c3e({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=Qi,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:Ie};if(!Array.isArray(e)||!Array.isArray(n))return{error:re};n.length&&t.push("venueId");let a=Tr({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],s={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&bT({schedule:c,scheduleAttributes:t})&&(!n?.length||n.includes(c.venueId))&&(s[d]||(s[d]=[]),s[d].push(p))});let o=i.tournamentId,l=0;for(let u in s){let{event:c,drawDefinition:d}=Kn({tournamentRecord:i,drawId:u}),p=xn({drawDefinition:d,matchUpFilters:{matchUpIds:s[u]}}).matchUps??[];for(let f of p){let h=!1;f.timeItems=(f.timeItems??[]).filter(m=>{let g=m?.itemType&&![Nu,kd,Xm,bN,Jm,Qm].includes(m?.itemType);return g||(h=!0),g}),h&&(Dt({context:"clear schedules",eventId:c?.eventId,drawDefinition:d,tournamentId:o,matchUp:f}),l+=1)}}return{...W,clearedScheduleCount:l}}function kA(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:s,useGarman:o,dryRun:l,pro:u}=t,c=He(t,[{[fn]:!0},{[Yr]:D=>!D||Array.isArray(D)&&D.every(kn),[nae]:!1,[Jn]:on}]);if(c.error)return c;let d=Qc({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...W};let{modifications:p,issues:f=[],schedulingProfile:h=[]}=d,m=Object.assign({},...Object.values(a).map(D=>Qv({tournamentRecord:D}).containedStructures)),g=new Set(n.map(D=>{if(kn(D))return Ze(D)}).filter(Boolean)),I=h.map(D=>D.scheduleDate).map(D=>kn(D)&&Ze(D)).filter(D=>D&&(!n.length||g.has(D)));if(!I.length)return{error:tre};if(r&&!l){let D=Array.isArray(r)?r:[];AA({tournamentRecords:a,scheduledDates:D})}let v=Hu({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:w}=_o({matchUpFilters:{matchUpTypes:[qt,Vt]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:y}=Io({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:w}),{matchUpDailyLimits:b}=vA({tournamentRecords:a}),{personRequests:S}=kf({requestType:PT,tournamentRecords:a}),U=h.filter(D=>{let P=Ze(D?.scheduleDate);return I.includes(P)}).sort((D,P)=>new Date(D.scheduleDate).getTime()-new Date(P.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:f,dateSchedulingProfiles:U,containedStructureIds:m,matchUpDependencies:y,matchUpDailyLimits:b,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:h,personRequests:S,periodLength:s,matchUps:w,dryRun:l,courts:v};return u?u3e(T):l3e(T)}function OA(t){if(!t||typeof t!="string")return!1;try{return Intl.DateTimeFormat(void 0,{timeZone:t}),!0}catch{return!1}}function AF(t,e){let i=e??new Date,r=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).formatToParts(i).find(l=>l.type==="timeZoneName")?.value??"";if(r==="GMT")return 0;let n=r.match(/GMT([+-])(\d{2}):(\d{2})/);if(!n)return 0;let a=n[1]==="+"?1:-1,s=Number.parseInt(n[2],10),o=Number.parseInt(n[3],10);return a*(s*60+o)}function sde(t,e,i){if(!OA(i))return{error:FM};let[r,n]=e.split(":").map(Number),[a,s,o]=t.split("-").map(Number),l=new Date(Date.UTC(a,s-1,o,r,n,0,0)),u=AF(i,l),c=l.getTime()-u*60*1e3,d=new Date(c),p=AF(i,d);if(p!==u){let f=l.getTime()-p*60*1e3;return new Date(f).toISOString()}return d.toISOString()}function d3e(t,e){if(!OA(e))return{error:FM};let i=new Date(t),r=new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(i),n=o=>r.find(l=>l.type===o)?.value??"",a=`${n("year")}-${n("month")}-${n("day")}`,s=`${n("hour")==="24"?"00":n("hour")}:${n("minute")}`;return{date:a,time:s}}function p3e(t,e,i){let r=sde(t,e,i);return typeof r!="string"||cd(r)?r:{error:FM}}var f3e={isValidIANATimeZone:OA,getTimeZoneOffsetMinutes:AF,wallClockToUTC:sde,utcToWallClock:d3e,toEmbargoUTC:p3e};function xA(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};if(n.tournamentId||(n.tournamentId=Et()),n.startDate&&!ru(n.startDate)&&!cb.test(n.startDate))return{error:Yi};if(n.endDate&&!ru(n.endDate)&&!cb.test(n.endDate))return{error:Yi};if(n.activeDates){let a=n.activeDates.filter(Boolean);if(!a.every(s=>ru(s)||cb.test(s)))return{error:Yi};if(a.length){let s=[...a].sort();n.startDate||(n.startDate=s[0]),n.endDate||(n.endDate=s[s.length-1]);let o=a.every(u=>new Date(u)>=new Date(n.startDate)),l=a.every(u=>new Date(u)<=new Date(n.endDate));if(!o||!l)return{error:Yi}}n.activeDates=a}return n.localTimeZone&&!OA(n.localTimeZone)?{error:FM}:(n.extensions&&(n.extensions=n.extensions.filter(Sl)),{...n})}function qG({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:s}){if(!i)return{error:Ie};let o={},l=(i.participants??[]).filter(({participantType:h,participantRole:m})=>h===yt&&m===Qr),u=0;for(let h of l){let m=a&&Pp({element:h,accessor:a})?.value||r&&h.person?.[r]||e&&h[e];if(m){if(!Object.keys(o).includes(m)){o[m]={participantName:n?.[u]??m,participantId:s?.pop()??Et(),individualParticipantIds:[],participantRole:Qr,participantType:$t};let g={value:r??e,name:Qx};It({element:o[m],extension:g}),u+=1}o[m].individualParticipantIds.push(h.participantId)}}let c=Object.keys(o),d=(i.participants??[]).map(h=>{if(h.participantType!==$t||h.participantRole!==Qr)return;let{extension:m}=rt({name:Qx,element:h}),g=m?.value;if(c.includes(g))return h.participantId}).filter(Boolean),p=0,f=[];return Object.keys(o).forEach(h=>{let m=o[h],{participantId:g}=m;d.includes(g)||(i.participants||(i.participants=[]),t&&i.participants.push(m),f.push(m),p++)}),t&&p?(at({payload:{tournamentId:i.tournamentId,participants:f},topic:Md}),{...W,participantsAdded:p}):f.length?{...W,newParticipants:f}:{error:XLe}}var h3e=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],m3e=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function ode({count:t=1,participantsCount:e=32}={}){let i=An(m3e),r=i.slice(0,t);return{cities:Ce(0,e).map(n=>n<Math.min(t,i.length)?r[n]:xs(r))}}function lde({count:t=1,participantsCount:e=32}={}){let i=An(h3e),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:Ce(0,e).map(n=>n<Math.min(t,i.length)?r[n]:xs(r))}}function ude({count:t=1,participantsCount:e=32}={}){let i=Ce(0,t).map(()=>Ce(0,5).map(()=>ta(0,9)).join(""));return{postalCodes:Ce(0,e).map(r=>r<t?i[r]:xs(i))}}function AE({idPrefix:t,participantType:e,index:i,uuids:r}){let n=ai(e)?e[0]:"X";return t?`${t}-${n}-${i}`:r?.pop()||Et()}function cde(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r?.[a],state:i?.[a],city:e?.[a],countryCode:n}}var g3e={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood","Zecic"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Miro","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function Xk(t){let{count:e=100,sex:i}=t||{};if(!e||i&&!vl(i))return{personData:[],error:re};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:s}=g3e,o=gd.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(r/n.length),u=Math.ceil(r/a.length),c=Math.ceil(r/s.length),d=Ce(0,l).flatMap(()=>{let m=xe(n,!1,!0);return Ce(0,n.length).map(()=>wa(m))}),p=Ce(0,u).flatMap(()=>{let m=xe(a,!1,!0);return Ce(0,a.length).map(()=>wa(m))}),f=Ce(0,c).flatMap(()=>{let m=xe(s,!1,!0);return Ce(0,s.length).map(()=>wa(m))}),h={};for(let m=0;m<r;m++){let g=d.pop(),I=i||xs([er,_r]),v=I===er?f.pop():p.pop(),w=xs(o);h[`${v}${g}`]={nationalityCode:w,sex:I,firstName:v,lastName:g}}return{personData:Object.values(h).slice(0,e)}}function dde(t){let e=t?.count||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:s,category:o,sex:l}=t||{};if(Number.isNaN(Number(e)))return{error:re};let u=a?.[er]||rh(l)&&e||0,c=a?.[_r]||gp(l)&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&Xk({count:u,sex:er}).personData||[],f=c&&Xk({count:c,sex:_r}).personData||[],h=[...p,...f,...d&&Xk({count:d}).personData||[]],m=h.filter(T=>!l||u&&c||T.sex===l),g=[];if(Array.isArray(s)){let T=s.filter(D=>typeof D.firstName!="string"||typeof D.lastName!="string"||D.sex&&![er,_r].includes(D.sex)||D.nationalityCode&&(typeof D.nationalityCode!="string"||D.nationalityCode.length>3||!gd.some(({iso:P,ioc:E})=>[P,E].includes(D.nationalityCode)))?!1:(D.nationalityCode&&g.push(D.nationalityCode),!0));if(T.length)m=T;else return{error:re}}let I=s?m:An(m);if(I.length<e){let{maleFirstNames:T,maleLastNames:D,femaleFirstNames:P,femaleLastNames:E,nationalityCodes:R}=h.reduce((C,M)=>{let{firstName:N,lastName:A,nationalityCode:O}=M;return M.sex===er?(C.maleFirstNames.includes(N)||C.maleFirstNames.push(N),C.maleLastNames.includes(A)||C.maleLastNames.push(A)):(C.femaleFirstNames.includes(N)||C.femaleFirstNames.push(N),C.femaleLastNames.includes(A)||C.femaleLastNames.push(A)),C.nationalityCodes.includes(O)||C.nationalityCodes.push(O),C},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Ce(0,e-I.length).forEach(()=>{let C=l||xs([er,_r]),M=xs(R),N=xs(C===er?T:P),A=xs(C===er?D:E),O={firstName:N,lastName:A,sex:C,nationalityCode:M};I.push(O)})}let{ageMinDate:v,ageMaxDate:w}=zp({consideredDate:r,category:o}),y=Ke(v?.slice(0,4)||0)||Ke(w?.slice(0,4)||0)-3,b=Ke(w?.slice(0,4)||0)||Ke(v?.slice(0,4)||0)+3,S=(v||w)&&[y,b],U=I.slice(0,e).map((T,D)=>{let[P,E]=S||[],R=S&&wa(Ce(P,E)),C=wa(Ce(0,365)),M=R&&Z0e(R,C);return Object.assign(je({extensions:i||[{name:"regionCode",value:D+1}],birthDate:M,isMock:n}),T)});return{persons:U.length&&U||I[0],nationalityCodes:g}}var I3e=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function kE({nameRoot:t="TEAM",count:e=1}={}){let i=An(I3e).slice(0,e);return i.length<e&&Ce(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function vy(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=Er,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:s,categories:o,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:f,teamSize:h=8,personIds:m,idPrefix:g,uuids:I,personExtensions:v,addressProps:w,gendersCount:y,matchUpType:b,personData:S,sex:U,inContext:T,withISO2:D,withIOC:P,scaleAllParticipants:E}=t,R=f===mt||b===Hp,C=f===$t||b===$t;i&&(!Array.isArray(i)||!i.every(fe=>Ni(fe))||i.length!==2)&&(i=void 0),e=E?p:e;let M=1e3,N=e&&e>M?e:M;i=i||[1,N],i[1]+=1;let A=p*(R&&2||C&&(h??8)||1),O=dde({count:A,personExtensions:v,consideredDate:s,gendersCount:y,personData:S,category:l,sex:U});if(O.error)return O;let{nationalityCodes:k,persons:F}=O,x={},L={},$={},V={},_=fe=>{Object.assign(x,fe.doublesRankings),Object.assign(L,fe.singlesRankings),Object.assign(V,fe.doublesRatings),Object.assign($,fe.singlesRatings)};if(Ut(l)){let fe=z3({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:l});_(fe)}Array.isArray(o)&&o.forEach(fe=>{let Te=z3({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:fe});_(Te)});let B=gd.filter(fe=>c==="IOC"&&fe.ioc||fe.iso);function G(fe){let Te=Math.ceil(A/fe);return n&&Te>n?Math.ceil(A/n):fe}let{postalCodesProfile:j,postalCodesCount:Y,statesProfile:K,citiesProfile:X,citiesCount:Z,statesCount:Q}=w||{},ae=fe=>Object.keys(fe).flatMap(Te=>Ce(0,K[Te]).map(()=>Te)),te=X&&ae(X)||w?.cities||ode({count:Z||A,participantsCount:A}).cities,ne=K&&ae(K)||w?.states||lde({count:Q||A,participantsCount:A}).states,le=j&&ae(j)||w?.postalCodes||ude({count:Y||A,participantsCount:A}).postalCodes,de={cities:te,states:ne,postalCodes:le},pe=G(u),ve=pe?An(B).slice(0,u):d&&B.filter(fe=>d.includes(fe.iso))||B,Me=An(Ce(0,Math.ceil(A/(pe||1))).map(()=>ve).flat(1/0)),Ee=kE({count:p}).names;return{participants:Ce(0,p).flatMap(fe=>{let Te=R&&2||C&&(h??8)||1,ce=Ce(0,Te).map(Ne=>{let he=fe*Te+Ne;return Be(he)}),be=ce.map(Ne=>Ne.participantId),we=ce.map(Ne=>Ne.person.standardFamilyName).join("/"),Ae=R?mt:$t,ye={participantId:AE({participantType:Ae,index:fe,idPrefix:g,uuids:I}),participantName:R?we:Ee[fe],participantRole:Qr,individualParticipantIds:be,participantType:Ae};return T&&(ye.individualParticipants=ce),R||C?[ye,...ce]:ce}),...W};function Be(fe){let Te=F[fe],{nationalityCode:ce,participantExtensions:be,participantTimeItems:we,extensions:Ae,firstName:ye,birthDate:Ne,lastName:he,personId:De,sex:Le}=Te||{},J=ye||"GivenName",se=he||"FamilyName",oe=`${J} ${se}`,ue=Me[fe],ee=k?.length&&ce||ue&&(c==="IOC"?ue.ioc||ue.iso:ue.iso||ue.ioc)||ce;Me?.length&&!ee&&!ce&&console.log("%c Invalid Nationality Code",{participantIndex:fe,country:ue});let Se=cde({...de,participantIndex:fe,nationalityCode:ee}),Pe=je({participantId:AE({participantType:yt,index:fe,idPrefix:g,uuids:I}),extensions:be,timeItems:we,participantRole:Qr,participantType:yt,participantName:oe,person:{personId:De||m?.length&&m[fe]||Et(),birthDate:kn(Ne)?Ne:void 0,addresses:[Se],standardFamilyName:se,standardGivenName:J,nationalityCode:ee,extensions:Ae,sex:Le}});if(P&&ee){let Ue=gd.find(({iso:dt})=>dt===ee);Ue?.ioc&&(Pe.person.iocNationalityCode=Ue.ioc),Ue?.label&&(Pe.person.countryName=Ue.label)}if(D&&ee){let Ue=gd.find(({iso:dt})=>dt===ee);Ue?.iso2&&(Pe.person.iso2NationalityCode=Ue.iso2),Ue?.label&&(Pe.person.countryName=Ue.label)}let st=Ue=>{let dt=Ue.categoryName||Ue.ratingType||Ue.ageCategoryCode,bi=L[dt]?.[fe],qe=x[dt]?.[fe];QT({scaleValue:bi,eventType:Yh,scaleType:Ru,participant:Pe,category:Ue}),QT({scaleValue:qe,eventType:Ec,scaleType:Ru,participant:Pe,category:Ue});let wi=$[dt]?.[fe],li=V[dt]?.[fe];QT({scaleValue:wi,eventType:Yh,scaleType:md,participant:Pe,category:Ue}),QT({scaleValue:li,eventType:Ec,scaleType:md,participant:Pe,category:Ue})};return Array.isArray(o)?o.forEach(Ue=>st(Ue)):l&&st(l),Pe}}function QT({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,s=[Rd,r,i,a].join("."),o={itemValue:t,itemType:s};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function z3(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,s=e.rankingRange||t.rankingRange||[1,1e3],o={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:f}=e,h=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!f){let[m,g]=s||[];if(l[h]=An(Ce(m,g)).slice(0,i||ta(20,30)),[mt,$t].includes(n)){let[I,v]=s||[];o[h]=An(Ce(I,v)).slice(0,i||ta(20,30))}}if(f&&r[f]){let{ratingMax:m,ratingMin:g,ratingAttributes:I}=e,v={...r[f],...I||{}},{attributes:w={},decimalsCount:y,accessors:b,range:S,step:U}=v,T=C=>{let M={},N=Object.keys(C||{});for(let A of N){let O=C[A];if(typeof O=="object"&&O.generator){let{range:k}=O,[F,x]=k.slice().sort();M[A]=ta(F,x)}else M[A]=O}return M},D=S[0]>S[1]?2:.7,[P,E]=S.slice().sort(),R=Ce(0,2e3).map(()=>gie(P,E,D,U,y)).filter(C=>(!m||C<=m)&&(!g||C>=g)).slice(0,i||ta(20,30)).map(C=>b?Object.assign({},...b.map(M=>({[M]:C})),T(w)):C);u[h]=[...a,...R],[mt,$t].includes(n)&&(c[h]=[...a,...R])}return{singlesRankings:l,doublesRankings:o,singlesRatings:u,doublesRatings:c}}function YG(t){let{alternatesCount:e=0,tieFormatName:i,drawSize:r}=t,n=0,a=0,s=0,o=0,l={},u={[er]:0,[_r]:0,[Hm]:0,[tc]:0,ANY:0};(Ut(t.tieFormat)?t.tieFormat:Pc({namedFormat:i}))?.collectionDefinitions?.filter(Boolean).forEach(f=>{let{category:h,collectionId:m,matchUpType:g,matchUpCount:I,gender:v}=f;if(vl(v)){let w=un(v),y=I*(g===Vt?2:1);w&&u[w]<y&&(u[w]=y)}else Ba(v)&&(u[er]<I&&(u[er]=I),u[_r]<I&&(u[_r]=I));if(h){let w=JSON.stringify(h);l[w]=h}if(m||(f.collectionId=Et()),Di(Vt)(g)){let w=I;o+=I,n=Math.max(n,w)}if(Di(qt)(g)){let w=I;s+=I,a=Math.max(a,w)}});let c=Object.keys(l).length?Math.max(s,o*2):Math.max(a,n*2),d=n*(r+e),p=a*(r+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:c,genders:u}}function v3e({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=yt}=t||{},a=r||0,s={[_r]:0,[Hm]:0,[tc]:0,[er]:0,ANY:0},o=0,l=0,u=0,c=0,d=0,p=({alternatesCount:h=0,uniqueParticipants:m,tieFormatName:g,drawSize:I=0,eventType:v,tieFormat:w,category:y,gender:b,stage:S})=>{let U=v===Is,T=v===lr,D=!!(m||S===ze||y||b);if(T){c=Math.max(c,I+h),w=typeof w=="object"?w:Pc({namedFormat:g});let{teamSize:P,maxDoublesDraw:E,maxSinglesDraw:R,genders:C}=YG({alternatesCount:h,tieFormatName:g,tieFormat:w,drawSize:I});u=Math.max(u,P),l=Math.max(l,R),D||(o=Math.max(o,E)),Object.keys(C).forEach(M=>s[M]+=C[M])}else if(U)if(D){let P=(I+h)*2;d+=P,b&&(s[b]+=P)}else I+h&&I+h>o&&(o=I+h);else if(D){let P=I+h;b&&(s[b]+=P),d+=P}else I&&I>l&&(l=I+h)};if(e?.forEach(h=>{let{tieFormatName:m,tieFormat:g,drawProfiles:I,eventType:v,category:w,gender:y}=h;if(I)for(let b of I){let{tieFormatName:S,tieFormat:U}=b;p({...b,tieFormatName:S||m,tieFormat:U||g,eventType:v,category:w,gender:y})}}),Array.isArray(i))for(let h of i)p(h);let f=Math.max(c*u,o*2,l);return o&&(n=mt),(r||a)<f&&(r=f),r&&o&&[mt,lr].includes(n)&&(l&&Math.floor(l/2)>o?r=Math.floor(l/2):(!l||o*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!e?.length&&!i?.length?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:c,largestTeamSize:u,participantType:n,gendersCount:s}}function pde({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if(t?.participantsCount===0)return{addedCount:0,...W};let{participantsCount:s,participantType:o,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=v3e({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t?.teamKey,p=vy({consideredDate:n,...t,participantsCount:s,participantType:o,gendersCount:c,uuids:a}).participants,f=0,h=lo({tournamentRecord:e,participants:p});if(h.error)return h;if(f+=h.addedCount,d){let v=qG({tournamentRecord:e,...d});if(v.error)return v}let m=p.filter(({participantType:v})=>v===yt).map(wt),g=t?.idPrefix?`${$t}-${t.idPrefix}`:void 0,I=Ce(0,l).map(v=>{let w=m.slice(v*u,(v+1)*u),y=AE({index:v,participantType:o,idPrefix:g,uuids:a});return{participantName:`Team ${v+1}`,participantRole:Qr,individualParticipantIds:w,participantType:$t,participantId:y}});return h=lo({participants:I,tournamentRecord:e}),h.error?h:(f+=h.addedCount,{addedCount:f,...W})}function fde({drawProfiles:t,category:e,gender:i}){let r={},n=t?.reduce((s,o)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=ke,drawSize:p=0}=o||{};Object.keys(s).includes(d)||(s[d]=0);let f=(u||p)-l;return c||i||e||d===ze?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=f):s[d]=Math.max(s[d],f),s},{}),a=Object.keys(r);return a.forEach(s=>n[s]+=r[s]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function hde({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[ke]||0,a=e[ze]||0;return{stageParticipants:{QUALIFYING:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(0,a),MAIN:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(a,a+n)}}}var y3e={[si]:2,[Ui]:1,[zi]:1,[Ur]:1,[Yt]:4};function KG(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=y3e,matchUpFormat:n=Ws,pointsPerMinute:a=2.5,sideWeight:s=4}=t;if(!qa({matchUpFormat:n}))return{error:qie};if(typeof r!="object")return{error:re};if(e>100&&(e=100),Number.isNaN(Number(e))||Number.isNaN(Number(a))||Number.isNaN(Number(s)))return{error:re};let o=Object.keys(r).filter(D=>Object.keys(pN).includes(D)&&D!==xi);if(Object.keys(o).reduce((D,P)=>D+r[P],0)>100)return{error:re,matchUpStatusProfile:r};let l=o.reduce((D,P)=>(D.pointer=D.pointer+r[P],D.valueMap.push([D.pointer,P]),D),{pointer:0,valueMap:[]}),u=ta(1,100),c=(l.valueMap.find(D=>u<=D[0])??[100,xi])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if(Br(c)){i=i||ta(1,2);let D={score:d,matchUpStatus:c,winningSide:i};if(!(c===Yt&&ta(1,100)>100-e))return{outcome:D}}else if([Ui,zi].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=Xi(n),{bestOf:f=1,exactly:h,setFormat:m,finalSetFormat:g}=p??{},I=[],v=ta(0,1),w=i?[i-1]:[...Ce(0,s).map(()=>v),1-v],y=[Ur,Yt,Na,tp].includes(c)&&(wa(Ce(1,h||f))||1),b,S=Ce(1,(h??f)+1);for(let D of S){let P=D===(h??f),{set:E,incomplete:R,winningSideNumber:C}=b3e({setFormat:P&&g||m,incomplete:y===D,pointsPerMinute:a,matchUpStatus:c,weightedRange:w,setNumber:D});if(I.push(E),R){b=C;break}if(Pw({matchUp:{score:{sets:I},matchUpFormat:n}}).calculatedWinningSide&&!p?.aggregate)break}let U;if(b)U=i||b;else if(p?.aggregate&&I.length>0){let D=I.reduce((R,C)=>R+(C.side1Score??0),0),P=I.reduce((R,C)=>R+(C.side2Score??0),0),E=ta(0,I.length-1);if(i){if(i===1&&D<=P||i===2&&P<=D){let R=Math.abs(D-P)+ta(1,3);i===1?I[E].side1Score+=R:I[E].side2Score+=R}U=i}else if(D===P){let R=ta(1,2);R===1?I[E].side1Score+=1:I[E].side2Score+=1,U=R}else U=D>P?1:2}else U=Pw({matchUp:{score:{sets:I},matchUpFormat:n,winningSide:i}}).calculatedWinningSide;let{score:T}=Xce({winningSide:U,score:{sets:I},matchUpStatus:c});return{outcome:{winningSide:U,matchUpStatus:c,score:T}}}function b3e({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let s={setNumber:a},{setTo:o,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=n,f=ta(0,t.length-1),h=t[f],m;if(d){let g=p*e,I=Math.round(g*.2),v=g+wa([1,-1])*I,w=RLe(v,2),y=[w,v-w];h&&y.reverse(),m=t[f]+1;let b=y[0]>y[1]&&1||y[1]>y[0]&&2||0;if(r){let[T,D]=y;return Object.assign(s,{side1Score:T,side2Score:D}),Qi.includes(i)?{set:s,incomplete:r,winningSideNumber:m}:{set:s,incomplete:r}}b||(y[ta(0,1)]+=1),b=y[0]>y[1]?1:2,b!==m&&y.reverse();let[S,U]=y;return Object.assign(s,{side1Score:S,side2Score:U,winningSide:m}),{set:s}}else{if(r)return s.side1Score=ta(0,u),s.side2Score=ta(0,u),Qi.includes(i)&&(m=t[f]+1),{set:s,incomplete:r,winningSideNumber:m};{let g=Ce(1,o+1).flatMap(U=>Ce(0,o+2-U).map(()=>U)),I=g[ta(0,g.length-1)],v=o&&Nj({isSide1:!0,tiebreakAt:u,lowValue:I,setTo:o}),w=!v,y=t.length===1&&t[f]+1;if(!w){y?(v[0]>v[1]?1:2)!==y&&v.reverse():h&&v.reverse();let[U,T]=v;Object.assign(s,{side1Score:U,side2Score:T})}let b=Tw({matchUpScoringFormat:{setFormat:n},setObject:s}),S;if(b.hasTiebreakCondition||w){let{NoAD:U,tiebreakTo:T}=l||c||{},D=Ce(1,T+1).flatMap(R=>Ce(0,T+2-R).map(()=>R)),P=D[ta(0,D.length-1)],E=rA({isSide1:!0,tiebreakNoAd:U,tiebreakTo:T,lowValue:P});if(E)if(w){let R=E[0]>E[1]?1:2;y?R!==y&&E.reverse():h&&E.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=E,S=E[0]>E[1]&&1||E[1]>E[0]&&2||void 0}else b.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=E:[s.side2TiebreakScore,s.side1TiebreakScore]=E}s.winningSide=b.winningSide||b.leadingSide||y||S}}return{set:s}}function w3e({firstRoundDualMatchUps:t,event:e,tournamentRecord:i,drawDefinition:r}){let n=e?.category?.ageCategoryCode||e?.category?.categoryName;if(n){let d=Pce({singlesOnly:!0,tournamentRecord:i,drawDefinition:r,scaleAccessor:{scaleName:n,sortOrder:"ASC",scaleType:Ru},event:e});if(d.error)return d;let{lineUps:p,participantsToAdd:f}=d;lo({tournamentRecord:i,participants:f}),It({element:r,extension:{name:Cc,value:p}});return}let a=t[0]?.structureId,{positionAssignments:s}=Xt({drawDefinition:r,structureId:a});if(!s?.length)return;let{participants:o}=Ei({participantFilters:{participantTypes:[ti]},tournamentRecord:i});function l(d){return o?.find(p=>{let{participantId:f}=p;return s.find(h=>h.participantId===f)?.drawPosition===d})}function u(d,p,f){d.sides.forEach(h=>{let{drawPosition:m}=h,g=l(m);if(g){let I=g.individualParticipantIds?.[p];I&&NE({teamParticipantId:g.participantId,participantId:I,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e});return}})}function c(d,p,f){d.sides.forEach(h=>{let{drawPosition:m}=h,g=l(m);g&&g.individualParticipantIds?.slice(p*2,p*2+2)?.forEach(I=>{NE({teamParticipantId:g.participantId,participantId:I,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e})})})}t.forEach(d=>{let p=d.tieMatchUps.filter(Di(qt)),f=d.tieMatchUps.filter(Di(Vt));p.forEach((h,m)=>{let g=h.matchUpId;u(h,m,g)}),f.forEach((h,m)=>{let g=h.matchUpId;c(h,m,g)})})}function S3e({structure:t,matchUpsMap:e,drawDefinition:i,tournamentRecord:r,event:n,matchUpStatusProfile:a,matchUpFormat:s,matchUpStatus:o,scoreString:l,randomWinningSide:u,completionGoal:c,completedCount:d}){let p=Ot({contextFilters:{matchUpTypes:[Vt,qt]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}).matchUps.filter(({winningSide:f})=>!f).sort(eg).map(yr);for(let f of p){if(!Number.isNaN(Number(c))&&d.value>=c)break;let{matchUps:h}=Ot({matchUpFilters:{matchUpTypes:[Vt,qt]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}),m=h.find(I=>I.matchUpId===f),g=[Ui,zi].includes(m.matchUpStatus);if(m?.readyToScore&&!g){let I=U3e({matchUpStatusProfile:a,tournamentRecord:r,drawDefinition:i,targetMatchUp:m,matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:!u&&1,event:n});if(I?.error)return I;d.value+=1}}}function OE(t){let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:s,event:o}=t;if(!s)return{error:$e};let l=t.matchUpFormat||s.matchUpFormat||o?.matchUpFormat,u=s.structures.slice().sort(Ym),c={value:0},{matchUps:d,matchUpsMap:p}=nr({matchUpFilters:{matchUpTypes:[ti],roundNumbers:[1]},contextFilters:{stages:[ke,ze]},inContext:!0,drawDefinition:s});if(d?.length){let I=w3e({firstRoundDualMatchUps:d,event:o,tournamentRecord:n,drawDefinition:s});if(I?.error)return I}let f=typeof i=="string"&&i,h=f&&xi,m=u.length===2&&u[0].finishingPosition===Kp&&_i(u.map(({stage:I})=>I),[ke,ki]).length===2,g=u.map(({structureId:I})=>I);for(let I of g){if(c.value>=a)break;let v=s.structures.find(y=>y.structureId===I),w=S3e({structure:v,matchUpsMap:p,drawDefinition:s,tournamentRecord:n,event:o,matchUpStatusProfile:e,matchUpFormat:l,matchUpStatus:h,scoreString:f,randomWinningSide:r,completionGoal:a,completedCount:c});if(w?.error)return w;m&&v.finishingPosition===Kp&&t.completeRoundRobinPlayoffs&&sy({structureId:v.structureId,applyPositioning:!0,drawDefinition:s})}return{...W,completedCount:c.value}}function mde(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:s,matchUpFormat:o,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus==="BYE")return;let{matchUpId:d}=a||{},{outcome:p}=jG({matchUpFormat:o,matchUpStatus:s,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),TT({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function U3e(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:s,targetMatchUp:o,scoreString:l,winningSide:u,event:c}=t;if(l||a)return mde(t);let{matchUpId:d}=o||{},{outcome:p}=KG({matchUpStatusProfile:e,matchUpFormat:s,winningSide:u});return TT({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function gde({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:s}){let o=Vi({event:s}).flightProfile,{eventName:l,eventType:u,category:c}=s,{startDate:d}=r,p=[],f=c?.categoryName||c?.ageCategoryCode||c?.ratingType,h=s.drawDefinitions?.map(({drawId:m})=>m);if(Array.isArray(o?.flights))for(let[m,g]of o.flights.entries()){let{drawId:I,stage:v,drawName:w,drawEntries:y}=g;p.push(g.drawId);let b=n[m],{seedsCount:S,generate:U=!0}=b||{};if(U){let T=y.filter(Aa(Eu)).map(Aa(Eu)),D=f||l;if(r&&S&&S<=T.length&&Ce(1,S+1).forEach((M,N)=>{let A={scaleValue:M,scaleName:D,scaleType:nu,eventType:u,scaleDate:d},O=T[N];ly({tournamentRecord:r,participantId:O,scaleItem:A})}),h?.includes(I))break;let P=ST({...b,matchUpType:u,seedingScaleName:D,tournamentRecord:r,drawEntries:y,drawName:w,drawId:I,isMock:a,event:s,stage:v});if(P.error)return{error:P.error,drawIds:[]};let{drawDefinition:E}=P;if(!E)return{error:za};let R=n[m]?.drawExtensions;if(Array.isArray(R)&&R.filter(Sl).forEach(M=>It({element:E,extension:M})),P=UT({suppressNotifications:!0,tournamentRecord:r,drawDefinition:E,event:s}),P.error)return{error:P.error,drawIds:[]};if(b?.withPlayoffs){let M=E.structures?.[0].structureId,N=BN({idPrefix:b.idPrefix,...b.withPlayoffs,tournamentRecord:r,drawDefinition:E,structureId:M,isMock:a,event:s});if(N?.error)return N}let C=b?.completionGoal;if(b?.automated!==!1&&(e||C)){let M=b?.matchUpFormat,N=OE({completeAllMatchUps:!C&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:C,drawDefinition:E,matchUpFormat:M,event:s});if(N.error)return{error:N.error,drawIds:[]};let A=N.completedCount;if(b?.drawType===Pu){let O=E.structures?.find(x=>x.stage===ke);if(!O)return{error:yi};let k=sy({structureId:O.structureId,tournamentRecord:r,drawDefinition:E});if(k.error)return{error:k.error,drawIds:[]};let F=C?C-(A??0):void 0;if(k=OE({completeAllMatchUps:!C&&e,completionGoal:C?F:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:E,matchUpFormat:M,event:s}),k.error)return{error:k.error,drawIds:[]}}}}}return{...W,drawIds:p}}function Ide(t){let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:s,event:o,uuids:l}=t,{category:u,gender:c,eventType:d}=o,p=Di(bl)(d)&&yt||Di(Is)(d)&&mt||d,f=i[ke]||0,h=i[ze]||0,m=a.drawProfiles?.length?f+h:a.participantsProfile?.participantsCount??0,g=vl(c)?c:void 0,I=e?.idPrefix?`E-${s}-${e?.idPrefix}`:void 0,{participants:v}=vy({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n?.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:m,ratingsParameters:r,category:u,idPrefix:I,sex:g}),w=lo({tournamentRecord:n,participants:v});if(w.error)return w;let y=v?.filter(({participantType:S})=>S===p),b=v?.map(wt);return{uniqueDrawParticipants:y,uniqueParticipantIds:b}}function T3e({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=al,qualifyingPositions:s=0,stage:o=ke,drawSize:l=0,drawName:u,drawId:c}=r,d=l-s,p=i.slice(0,d).map(wt);if(p.length){let m=sl({participantIds:p,autoEntryPositions:t,entryStage:o,tournamentRecord:e,event:n});if(m.error)return m}let f=p.map(m=>({entryStatus:ga,entryStage:o,participantId:m})),h=SA({drawName:u||a,qualifyingPositions:s,drawEntries:f,drawId:c,event:n,stage:o});return h.error?h:{...W}}function vde({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:s,event:o}){let l=0;for(let u of n){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=ke,drawSize:f=0}=u,h=f-c,m=d||s||a||p===ze,g=m?t.slice(l,l+h):i[p||ke]||[];m&&(l+=h);let I=T3e({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:u,event:o});if(I.error)return I}return{...W}}function yde(t){let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,publish:p,isMock:f,uuids:h}=t,m=c.gender,g=c.eventName,{eventType:I=bl,policyDefinitions:v,drawProfiles:w=[],eventExtensions:y,surfaceCategory:b,tieFormatName:S,processCodes:U,discipline:T,eventLevel:D,timeItems:P,ballType:E,category:R}=c,C=c.eventId||Et(),M=c.tieFormat||(I===lr?Pc({namedFormat:S,event:{eventId:C,category:R,gender:m},hydrateCollections:s,isMock:f}):void 0),N=u.participants;for(let K of w)!m&&K.gender&&(m=K?.gender);let{stageParticipantsCount:A,uniqueParticipantsCount:O,uniqueParticipantStages:k}=fde({drawProfiles:w,category:R,gender:m}),F=Di(bl)(I)&&yt||Di(Is)(I)&&mt||I,{uniqueDrawParticipants:x=[],uniqueParticipantIds:L=[]}=k?Ide({event:{eventType:I,category:R,gender:m},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,uuids:h}):{},{eventAttributes:$}=c;typeof $!="object"&&($={});let V=R?.categoryName||R?.ageCategoryCode||R?.ratingType;g=g||V||"Generated Event";let _={...$,surfaceCategory:b,processCodes:U,discipline:T,eventLevel:D,eventName:g,eventType:I,tieFormat:M,ballType:E,category:R,eventId:C,gender:m};if(y?.length&&Array.isArray(y)){let K=y.filter(Sl);K?.length&&Object.assign(_,{extensions:K})}if(Array.isArray(P)&&P.forEach(K=>og({event:j,timeItem:K})),typeof v=="object")for(let K of Object.keys(v))ef({policyDefinitions:{[K]:v[K]},event:_});_.category&&(_.category.categoryName=V);let B,G=py({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:_});if(G.error)return G;let j=G?.event,{stageParticipants:Y}=hde({allUniqueParticipantIds:e,stageParticipantsCount:A,eventParticipantType:F,targetParticipants:N});if(w?.length){let K=vde({uniqueDrawParticipants:x,autoEntryPositions:a,stageParticipants:Y,tournamentRecord:u,drawProfiles:w,category:R,gender:m,event:j});if(K.error)return K;let X=gde({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:o,tournamentRecord:u,drawProfiles:w,isMock:f,event:j});if(X.error)return X;B=X.drawIds}else if(c?.participantsProfile?.participantsCount){let K=x.map(wt);if(K.length){let X=sl({participantIds:K,autoEntryPositions:a,tournamentRecord:u,entryStage:ke,event:j});if(X.error)return X}}return p&&hy({tournamentRecord:u,event:j}),{drawIds:B,eventId:C,uniqueParticipantIds:L}}function XG({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!kn(e))return{error:Yi};let n="addSchedulingProfileRound",{extension:a}=rt({name:Qh,tournamentRecords:t,discover:!0}),s=a?.value||[],o=s.find(p=>Su(e,p.scheduleDate));if(!o){let{startDate:p,endDate:f}=oA({tournamentRecords:t}),h=new Date(e);if(p&&h<new Date(p)||f&&h>new Date(f))return{error:Yi};o={scheduleDate:e,venues:[]},s.push(o)}let l=o.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},o.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(f=>!u.includes(f)).sort().map(f=>Ut(p[f])?c(p[f]):p[f]).flat().join("|");if(l.rounds.find(p=>c(p)===c(r)))return q({result:{error:_ie},stack:n});l.rounds.push(r);let d=cy({tournamentRecords:t,schedulingProfile:s});return d.error?d:{...W}}function D3e({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:re};let i=Qv({tournamentRecord:e}).containedStructures,r=Tr({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let s of t){let{scheduleDate:o,venues:l=[]}=s;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:f,winnerFinishingPositionRange:h,roundSegment:m}=p,g=r.filter(I=>{let v=h?.indexOf("-")>0&&h.split("-").map(y=>+y),w=I.finishingPositionRange?.winner;return I.drawId===f&&(!p.roundNumber||I.roundNumber===p.roundNumber)&&(!w||!v||_i(w,v).length===2||lt(w).length===lt(v).length&&_i(w,v).length===lt(w).length)})[0];if(g){let{eventId:I,roundNumber:v,drawName:w,structureName:y,roundName:b}=g,S=g.structureId;v&&!h&&(S=Object.keys(i).find(D=>i[D].includes(S))??S);let U={tournamentId:n,structureId:S,roundNumber:v,roundSegment:m,eventId:I,drawId:f},T=XG({tournamentRecords:{[n]:e},round:U,scheduleDate:o,venueId:d});if(T.error)return T;a.push({structureName:y,roundName:b,drawName:w,...U})}}}}return{scheduledRounds:a}}function FA(t){let e=He(t,[{drawProfile:!0,_ofType:Zn}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:s,hydrateCollections:o,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,isMock:d=!0,drawProfile:p,startDate:f,drawIndex:h,uuids:m}=t,g=xe(p,!1,!0),{excessParticipantAlternates:I=!0,matchUpFormat:v=Ws,drawType:w=al,tournamentAlternates:y=0,alternatesCount:b=0,qualifyingPositions:S,qualifyingProfiles:U,generate:T=!0,eventExtensions:D,drawExtensions:P,completionGoal:E,tieFormatName:R,buildTeams:C,seedsCount:M,timeItems:N,drawName:A,category:O,idPrefix:k,publish:F,gender:x,stage:L}=g,$=g.drawSize||(g.ignoreDefaults?void 0:32),V=g.eventId||Et(),_=p.eventType||p.matchUpType||bl,B=_===Is?mt:yt,G=Ut(p.tieFormat)&&p.tieFormat||_===$t&&Pc({event:{eventId:V,category:O,gender:x},namedFormat:R,hydrateCollections:o,isMock:d})||void 0,j=O?.categoryName||O?.ageCategoryCode||O?.ratingType,Y=p.eventName||j||`Generated ${_}`,K=c?.participants||[],X=(U?.flatMap(ce=>ce.structureProfiles||[]).reduce((ce,be)=>{let we=!be.participantsCount||be.participantsCount>be.drawSize?be.drawSize:be.participantsCount||0;return ce+we},0)||0)*(B===mt?2:1),Z=(!p.participantsCount||p.participantsCount>$?$:p.participantsCount)||0,Q={eventName:Y,eventType:_,tieFormat:G,category:O,eventId:V,gender:x};Array.isArray(N)&&N.forEach(ce=>og({event:Q,timeItem:ce}));let{eventAttributes:ae}=p;if(typeof ae!="object"&&(ae={}),Object.assign(Q,ae),D?.length&&Array.isArray(D)){let ce=D.filter(Sl);ce?.length&&Object.assign(Q,{extensions:ce})}let te=[];if(r?.participantsCount===0||p.uniqueParticipants||X||!c||x||O){let ce=(Z||0)+b+X,be=ce,we={[er]:0,[_r]:0},Ae,ye;if(_===$t){({teamSize:Ae,genders:ye}=YG({alternatesCount:b,tieFormatName:R,tieFormat:G,drawSize:$}));let De=g.teamGenders;if(De){for(let J of Object.keys(De))ye[J]!==void 0&&De[J]>ye[J]&&(ye[J]=De[J]);let Le=(ye[er]||0)+(ye[_r]||0);Le>Ae&&(Ae=Le)}Object.keys(ye).forEach(Le=>{let J=un(Le);J&&vl(Le)&&ye[J]&&(we[J]=$*ye[J])}),be=Ae*(($||0)+X)}let Ne=r?.idPrefix?`D-${h}-${r?.idPrefix}`:void 0,he=vy({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:be,consideredDate:c?.startDate,sex:x||r?.sex,rankingRange:p.rankingRange,uuids:p.uuids||m,ratingsParameters:u,participantType:B,gendersCount:we,idPrefix:Ne,category:O}).participants;if(Q.category&&(Q.category.categoryName=j),c){let De=lo({participants:he,tournamentRecord:c});if(De.error)return De}if(he.forEach(({participantId:De})=>te.push(De)),K=he,_===$t){let De=ye[er]?he.filter(({participantType:Ue,person:dt})=>Ue===yt&&dt?.sex===er).map(wt):[],Le=ye[_r]?he.filter(({participantType:Ue,person:dt})=>Ue===yt&&gp(dt?.sex)).map(wt):[],J=he.filter(({participantType:Ue})=>Ue===yt).map(wt).filter(Ue=>!De.includes(Ue)&&!Le.includes(Ue)),se=[...g.teamNames??[],...kE({count:ce}).names],oe=Ae-(ye[er]+ye[_r]),ue=0,ee=0,Se=0,Pe=Ce(0,ce).map(Ue=>{let dt=Le.slice(ue,ue+ye[_r]),bi=De.slice(ee,ee+ye[er]),qe=J.slice(Se,Se+oe);ue+=ye[_r],ee+=ye[er],Se+=oe;let wi=C!==!1?[...dt,...bi,...qe]:[];return{participantName:se[Ue]||`Team ${Ue+1}`,participantOtherName:`TM${Ue+1}`,participantRole:Qr,individualParticipantIds:wi,participantType:$t,participantId:Et()}}),st=lo({participants:Pe,tournamentRecord:c});if(!st.success)return st;K=Pe}}let ne=ce=>{let{participantType:be}=ce;return Di(bl)(_)&&be===yt||Di(Is)(_)&&be===mt?!0:_===$t&&be===$t},le=ce=>!p.gender||ce.person?.sex===p.gender?!0:ce.individualParticipantIds?.some(be=>{let we=K.find(Ae=>Ae.participantId===be);return we&&le(we)}),de=K.filter(ne).filter(le).filter(({participantId:ce})=>!i.includes(ce)),pe=de.slice(0,Z).map(ce=>ce.participantId);if(d&&pe?.length){let ce=sl({autoEntryPositions:s,entryStage:L,tournamentRecord:c,participantIds:pe,event:Q});if(ce.error)return ce}let ve=X?de.slice(Z,Z+X).map(ce=>ce.participantId):0;if(d&&ve?.length){let ce=0,be=1,we=(ye,Ne)=>ye.stageSequence-Ne.stageSequence,Ae=(ye,Ne)=>ye.roundTarget-Ne.roundTarget;for(let ye of U.sort(Ae)){be=ye.roundTarget||be;let Ne=1,he;for(let De of ye.structureProfiles.sort(we)){let Le=(De.drawSize||RB(De.participantsCount))-(he||0),J=ve.slice(ce,ce+Le),se=sl({entryStage:ze,entryStageSequence:Ne,autoEntryPositions:s,tournamentRecord:c,participantIds:J,roundTarget:be,event:Q});if(se.error)return se;he=De.qualifyingPositions,ce+=Le,Ne+=1}be+=1}}let Me=I&&c?.participants?.filter(({participantId:ce})=>!pe.includes(ce)).filter(ne).filter(le).slice(0,b||$-Z||y).map(ce=>ce.participantId);if(d&&Me?.length){let ce=sl({participantIds:Me,autoEntryPositions:!1,entryStatus:qs,tournamentRecord:c,event:Q});if(ce.error)return ce.error}let Ee=j||Y;c&&M&&M<=pe.length&&Ce(1,M+1).forEach((ce,be)=>{let we={scaleName:Ee,scaleDate:f,scaleType:sV,scaleValue:ce,eventType:_},Ae=pe[be];ly({tournamentRecord:c,participantId:Ae,scaleItem:we})});let Be=ST({...xe(p,!1,!0),tournamentRecord:c,seedingScaleName:Ee,matchUpFormat:v,eventId:V,isMock:d,event:Q});if(Be.error)return Be;if(!Be.drawDefinition)return{error:za};let{drawDefinition:fe}=Be,Te=fe.drawId;if(Array.isArray(P)&&P.filter(Sl).forEach(ce=>It({element:fe,extension:ce})),T){if(UT({drawDefinition:fe,event:Q,suppressNotifications:!0}),p.withPlayoffs){let be=fe.structures?.[0].structureId,we=BN({...p.withPlayoffs,tournamentRecord:c,drawDefinition:fe,structureId:be,idPrefix:k,isMock:d,event:Q});if(we?.error)return we}let ce=p.automated===!1;if(d&&!ce){let be=we=>{let Ae=OE({completeAllMatchUps:we.completeAllMatchUps,completionGoal:we.completionGoal,matchUpStatusProfile:n,randomWinningSide:l,tournamentRecord:c,drawDefinition:fe,matchUpFormat:v,event:Q});if(Ae.error)return Ae;let ye=Ae.completedCount;if(w===Pu){let Ne=fe.structures?.find(Le=>Le.stage===ke);if(!Ne)return{error:yi};sy({structureId:Ne.structureId,tournamentRecord:c,drawDefinition:fe});let he=E?E-(ye??0):void 0,De=OE({completionGoal:E?he:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawDefinition:fe,matchUpFormat:v,event:Q});if(De.error)return De}};if(E&&be({completionGoal:E}),p.outcomes){let{matchUps:we}=xn({inContext:!0,drawDefinition:fe,event:Q});for(let Ae of p.outcomes){let{matchUpStatus:ye=xi,matchUpStatusCodes:Ne,stageSequence:he=1,matchUpIndex:De=0,structureOrder:Le,matchUpFormat:J,drawPositions:se,roundPosition:oe,stage:ue=ke,roundNumber:ee,winningSide:Se,scoreString:Pe}=Ae,st=we?.reduce((qe,wi)=>{let{structureId:li,matchUpId:an}=wi;return qe[li]?qe[li].push(an):qe[li]=[an],qe},{})??[],Ue=Object.assign({},...Object.keys(st).map((qe,wi)=>({[qe]:wi+1}))),dt=we?.filter(qe=>(!ue||qe.stage===ue)&&(!he||qe.stageSequence===he)&&(!ee||qe.roundNumber===ee)&&(!oe||qe.roundPosition===oe)&&(!Le||Ue[qe.structureId]===Le)&&(!se||_i(se,qe.drawPositions).length===2))?.[De],bi=mde({matchUpStatusCodes:Ne,tournamentRecord:c,drawDefinition:fe,targetMatchUp:dt,matchUpFormat:J,matchUpStatus:ye,scoreString:Pe,winningSide:Se});if(bi?.error)return bi}}a&&be({completeAllMatchUps:a})}F&&hy({tournamentRecord:c,event:Q})}else{let ce=SA({drawEntries:fe.entries,drawName:A||w,qualifyingPositions:S,drawId:Te,event:Q,stage:L});if(ce.error)return ce}return{...W,event:je(Q),uniqueParticipantIds:te,targetParticipants:K,drawDefinition:fe,eventId:V,drawId:Te}}var bde=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,indoorOutdoor:void 0,floodlit:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),P3e=bde;function LA({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=go({tournamentRecord:t,venueId:i});if(!a)return{error:Uf};a.courts||(a.courts=[]);let s={...bde(),venueId:i,courtId:r};if(s.courtId||(s.courtId=Et()),a.courts.some(o=>o.courtId===s.courtId))return{error:bre};{let o=(n?.dateAvailability||[]).map(c=>({...c,date:Ze(c.date),startTime:fi(c.startTime),endTime:fi(c.endTime),bookings:c.bookings?.map(({startTime:d,endTime:p,bookingType:f})=>({startTime:fi(d),endTime:fi(p),bookingType:f}))})),l=Object.keys(s);for(let c of l)if(n?.[c])if(c==="dateAvailability"){let d=UN({dateAvailability:o});if(!d.valid&&d.error)return d;s.dateAvailability=o}else s[c]=n[c];let u=s;return a.courts.push(u),e||at({payload:{venue:a,tournamentId:t.tournamentId},topic:Yc,key:a.venueId}),{...W,court:xe(s),venueId:i}}}function JG(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:Qd};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let s of Object.values(r)){let{venue:o}=go({tournamentRecord:s,venueId:i});if(o){let l=E3e({...t,tournamentRecord:s});for(let u of l?.courts??[])n.push(u?.courtId);if(l.error)return l;a=!0}}return a?{...W,courtIds:n}:{error:Uf}}function E3e({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:s,startTime:o,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:Qd};let f=go({tournamentRecord:r,venueId:d});if(f.error)return f;let{venue:h}=f;if(!Ni(s)||!n)return{error:yre};s=s??n.length;let m=Ce(0,s).map(g=>{let I=a?.[g],v=I?p.map(w=>({date:Hs(w),startTime:o,endTime:u,...I})):e;return I&&o&&u&&v.push({startTime:o,endTime:u}),{courtName:n[g]||i&&h?.venueAbbreviation&&`${h?.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:v}}).map((g,I)=>{let v=l?.pop()||c&&`${c}-${I+1}`;return LA({disableNotice:!0,tournamentRecord:r,courtId:v,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==s?q({info:"not all courts could be generated",result:{error:re}}):(h&&at({payload:{venue:h,tournamentId:r.tournamentId},topic:Yc,key:h.venueId}),{...W,courts:xe(m)})}function QG({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,s=[];for(let[o,l]of i.entries()){let{venueAbbreviation:u,venueId:c=r?.pop()??Et(),dateAvailability:d,venueDateAvailability:p,defaultStartTime:f,defaultEndTime:h,startTime:m="07:00",endTime:g="19:00",courtTimings:I,courtsCount:v,courtNames:w,venueName:y,idPrefix:b,courtIds:S}=l,U={venueName:y||`Venue ${o+1}`,venueAbbreviation:u,venueId:c};f&&(U.defaultStartTime=f),h&&(U.defaultEndTime=h),l.isPrimary&&(U.isPrimary=!0),p&&(U.dateAvailability=p);let T=KU({tournamentRecord:t,venue:U});if(T.error){if(e)continue;return T}s.push(c);let D=NI(n,a),P=!Array.isArray(d)&&[{startTime:m,endTime:g}].concat(D.map(E=>({date:Hs(E),startTime:m,endTime:g})));if(v||w){let E=JG({dateAvailability:d||P,tournamentRecord:t,courtTimings:I,courtsCount:v,courtNames:w,startTime:m,idPrefix:b,courtIds:S,endTime:g,venueId:c,dates:D});if(E.error)return E}}return s}function R3e(t){let{tournamentRecord:e,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:s,uuids:o}=t,l=0;for(let c of i){let d=[],{tieFormatName:p=uE,teamProfiles:f=[],teamsCount:h=0,category:m,idPrefix:g,gender:I}=c,v=c.leagueName??c.eventName??`League ${l+1}`,w=c.leagueId??c.eventId??o?.pop()??Et();r.push(w);let y=Ut(c.tieFormat)&&c.tieFormat||Pc({event:{eventId:w,category:m,gender:I},namedFormat:p,isMock:t.isMock})||void 0;if(!y)return{error:jv};let b=Math.max(h,f.length),S=Ce(0,b),{genders:U,teamSize:T}=YG({tieFormat:y,drawSize:b}),D={[_r]:0,[Hm]:0,[tc]:0,[er]:0,ANY:0};Object.keys(U).forEach(E=>D[E]+=U[E]);for(let E of S){let R=f?.[E]?.teamName??`Team ${E+1}`,C=f?.[E]?.teamId||o?.pop()||Et(),M=c.startDate??t.startDate,N=vy({...c?.participantsProfile,participantsCount:T,consideredDate:M,gendersCount:D,category:m,uuids:o}).participants,A=N.map($=>$.participantId),O=$t,k=C??AE({participantType:O,idPrefix:g,index:E,uuids:o});d.push({participantId:k,entryStatus:ga,entryStage:ke});let F=f?.[E]?.venueIds??[],x={participantId:k,participantRole:Qr,participantName:R,individualParticipantIds:A,participantType:O,homeVenueIds:F};F.forEach($=>!n.includes($)&&n.push($)),s.push(...A,k);let L=lo({participants:[x,...N],tournamentRecord:e});if(L.error)return L}let P={eventName:v,entries:d,eventType:$t,tieFormat:y,category:m,eventId:w,gender:I};if(e.events||(e.events=[]),e.events.push(P),d.length){let E=(Ni(c.roundsCount)&&c.roundsCount)??c.roundsCount===b_e?(b-1)*2:b-1,R=ST({automated:c.automated,tournamentRecord:e,drawType:ma,roundsCount:E,drawSize:b,event:P});if(R.error)return R;let{drawDefinition:C}=R;if(C){let M=C?.drawId;UT({drawDefinition:C,event:P,suppressNotifications:!0}),a.push(M)}}l++}let u=n.map(c=>({venueId:c}));QG({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:u,uuids:o})}var C3e=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function wde(t){let{startDate:e,endDate:i}=t??{},{tournamentName:r=wa(C3e),ratingsParameters:n=Er,tournamentExtensions:a,policyDefinitions:s,schedulingProfile:o,venueProfiles:l,uuids:u}=t??{},c=t?.isMock===!1?void 0:!0;if(e&&!kn(e)||i&&!kn(i))return{error:Yi};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:re};if(!e){let v=new Date;e=Hs(i??v),i=Hs(v.setDate(v.getDate()+7))}if(!i){let v=new Date(e);i=Hs(v.setDate(v.getDate()+7))}let d=xA({...t.tournamentAttributes??{},tournamentName:r,startDate:e,endDate:i,isMock:c}),p=l?.length?QG({tournamentRecord:d,venueProfiles:l,uuids:u}):[];if(a?.length&&Array.isArray(a)){let v=a.filter(w=>Sl({extension:w}));v?.length&&Object.assign(d,{extensions:v,isMock:c})}if(typeof s=="object")for(let v of Object.keys(s))ef({policyDefinitions:{[v]:s[v]},tournamentRecord:d});if(!t?.leagueProfiles?.length||t.eventProfiles?.length||t.drawProfiles?.length||t.participantsProfile){let v=pde({tournamentRecord:d,...t});if(!v.success)return v}let f=[],h=[],m=[];if(t.leagueProfiles){let v=R3e({allUniqueParticipantIds:f,tournamentRecord:d,...t,eventIds:h,venueIds:p,drawIds:m});if(v?.error)return v}if(t.drawProfiles){let v=M3e({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:m});if(v?.error)return v}if(t.eventProfiles){let v=N3e({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:m});if(v?.error)return v}let{scheduledRounds:g=void 0,schedulerResult:I={}}=o?A3e({...t,tournamentRecord:d}):{};return r2(),je({...W,tournamentRecord:d,scheduledRounds:g,schedulerResult:I,eventIds:h,venueIds:p,drawIds:m})}function M3e(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,s=0;for(let o of i){let l=FA({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:o,drawIndex:s,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(o?.addEvent!==!1){if(l=py({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),n.push(c)}p?.length&&r.push(...p),s+=1}}function N3e(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let s of e){let o=yde({...t,eventIndex:a,eventProfile:s});if(o.error)return o;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=o;u&&n.push(...u),r.push(l),c?.length&&i.push(...c),a+=1}}function A3e(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,s=D3e({schedulingProfile:e,tournamentRecord:i});if(s.error)return s;let o=s.scheduledRounds;if(r){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:kA({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:n}),scheduledRounds:o}}return{scheduledRounds:o}}var Sde={};ft(Sde,{anonymizeTournamentRecord:()=>Ude,modifyTournamentRecord:()=>Dde});function Ude({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){if(!i)return{error:Ie};let s=Array.isArray(t)?Kq.concat(...t):Kq,o=k=>Array.isArray(t)?k?.extensions?.filter(F=>s.includes(F.name)):k?.extensions,l={};i.extensions=o(i);let u=a||Et();l[i.tournamentId]=u,i.tournamentId=u,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${Hs(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let k of i.participants||[]){k.extensions=o(k),k.onlineResources=[];let F=Et();l[k.participantId]=F,k.participantId=F}for(let k of i.participants||[])Array.isArray(k.individualParticipantIds)&&(k.individualParticipantIds=k.individualParticipantIds.map(F=>l[F]));let c=0;for(let k of i.venues||[]){k.venueAbbreviation=`V${c}`,k.extensions=o(k),k.venueName=`Venue #${c}`,k.onlineResources=[],k.addresses=[];let F=Et();l[k.venueId]=F,k.isMock=!0,c+=1;let x=0;for(let L of k.courts||[])L.courtName=`V${c}C${x}`,L.extensions=o(L),L.onlineResources=[],L.isMock=!0,x+=1}let d=1;for(let k of i.events||[]){k.extensions=o(k),k.onlineResources=[],k.isMock=!0;let F=Et();l[k.eventId]=F,k.eventId=F;let x=k.category?.categoryName||k.category?.ageCategoryCode||k.category?.ratingType||k.gender;if(k.eventName=`Event ${d} ${x}`,Array.isArray(k.entries))for(let $ of k.entries)$.participantId=l[$.participantId];for(let $ of k.drawDefinitions||[]){$.extensions=o($);let V=Et();if(l[$.drawId]=V,$.drawId=V,$.isMock=!0,Array.isArray($.entries))for(let B of $.entries)B.participantId=l[B.participantId];let _=B=>{B.extensions=o(B);let G=Et();l[B.structureId]=G,B.structureId=G;for(let j of B.positionAssignments||[])j.participantId&&(j.participantId=l[j.participantId]);for(let j of B.seedAssignments||[])j.participantId&&(j.participantId=l[j.participantId]);for(let j of B.matchUps||[]){j.isMock=!0;for(let Y of j.sides||[])Y.lineUp&&(Y.lineUp=Y.lineUp.map(({participantId:K,collectionAssignments:X})=>({participantId:l[K],collectionAssignments:X})))}};for(let B of $.structures||[])if(_(B),Array.isArray(B.structures))for(let G of B.structures)_(G);for(let B of $.links||[])B.source.structureId=l[B.source.structureId],B.target.structureId=l[B.target.structureId]}let{extension:L}=rt({name:ao,element:k});Array.isArray(L?.value?.flights)&&L?.value.flights?.forEach($=>{if($.drawId=l[$.drawId],Array.isArray($.drawEntries))for(let V of $.drawEntries)V.participantId=l[V.participantId]}),d+=1}let p=i.startDate||Hs(new Date),f=(i.participants||[]).filter(({participantType:k})=>k===yt),h=f.reduce((k,F)=>{let x=F.person?.sex,L=un(x);return L&&vl(x)?k[L]+=1:k[tc]+=1,k},{[er]:0,[_r]:0,[tc]:0}),m=Object.assign({},...Object.keys(h).map(k=>({[k]:dde({category:{ageCategoryCode:"O18"},count:h[k],personExtensions:[],consideredDate:p,sex:k})?.persons||[]}))),g={[er]:0,[_r]:0,[tc]:0},I=f.length,v=f.reduce((k,F)=>{let x=F.person?.addresses?.[0]||{},{city:L,state:$,postalCode:V}=x;return k.cities.includes(L)||k.cities.push(L),k.states.includes($)||k.states.push($),k.postalCodes.includes(V)||k.postalCodes.push(V),k},{cities:[],postalCodes:[],states:[]}),w=v.postalCodes.length,y=v.cities.length,b=v.states.length,{cities:S}=ode({count:y||I,participantsCount:I}),{states:U}=lde({count:b||I,participantsCount:I}),{postalCodes:T}=ude({count:w||I,participantsCount:I}),D={cities:S,states:U,postalCodes:T};f.forEach((k,F)=>{let x=k?.person,L=x?.sex||tc,$=Ze(x?.birthDate)?.split("-")[0],V=g[L],_=m[L][V];if(g[L]+=1,$){let[,B,G]=_?.birthDate?.split("-")||[],j=[$,B,G].join("-");_.birthDate=j}if(x?.addresses){let B=cde({...D,participantIndex:F,nationalityCode:_.nationalityCode});_.addresses=[B]}_.personId=n?.[F]||Et(),e?(_.standardFamilyName=_.lastName,_.standardGivenName=_.firstName,k.participantName=`${_.standardGivenName} ${_.standardFamilyName}`):(_.standardFamilyName=x?.standardFamilyName,_.standardGivenName=x?.standardGivenName),delete _.firstName,delete _.lastName,_.extensions=o(x),k.person=_,l[x?.personId]=_.personId}),(i.participants||[]).filter(({participantType:k})=>k===mt).forEach(k=>{let{individualParticipantIds:F}=k;k.participantName=k3e({individualParticipantIds:F,individualParticipants:f})});let P=(i.participants||[]).filter(({participantType:k})=>k===$t),E=P.length,R=kE({count:E}).names;P.forEach((k,F)=>{k.participantName=R[F]});let C=(i.participants||[]).filter(({participantType:k})=>k===ts),M=C.length,N=kE({count:M,nameRoot:"Group"}).names;C.forEach((k,F)=>{k.participantName=N[F]});let{extension:A}=rt({element:i,name:Qh});Array.isArray(A?.value)&&A?.value.forEach(k=>{k.tournamentId=l[k.tournamentId],k.structureId=l[k.structureId],k.eventId=l[k.eventId],k.drawId=l[k.drawId]});let{extension:O}=rt({element:i,name:Xv});return Array.isArray(O?.value)&&O?.value.forEach(k=>{k.personId=l[k.personId]}),{...W}}function k3e({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r?.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function O3e({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n}){let{gender:a,category:s,eventType:o}=t,{drawProfiles:l,publish:u}=e,c=Di(bl)(o)&&yt||Di(Is)(o)&&mt||o;if(l){let{stageParticipantsCount:d,uniqueParticipantsCount:p,uniqueParticipantStages:f}=fde({drawProfiles:l,category:s,gender:a}),{uniqueDrawParticipants:h=[],uniqueParticipantIds:m=[]}=f?Ide({event:{eventType:o,category:s,gender:a},uniqueParticipantsCount:p,participantsProfile:e.participantsProfile,ratingsParameters:e.ratingsParameters,tournamentRecord:i,eventProfile:e,uuids:e.uuids}):{};r.push(...m);let{stageParticipants:g}=hde({targetParticipants:i.participants||[],allUniqueParticipantIds:r,stageParticipantsCount:d,eventParticipantType:c}),I=vde({uniqueDrawParticipants:h,autoEntryPositions:e.autoEntryPositions,stageParticipants:g,tournamentRecord:i,drawProfiles:l,category:s,gender:a,event:t});if(I.error||(I=gde({matchUpStatusProfile:e.matchUpStatusProfile,completeAllMatchUps:e.completeAllMatchUps,randomWinningSide:e.randomWinningSide,tournamentRecord:i,drawProfiles:l,isMock:e.isMock,event:t}),I.error))return I;n.push(...I.drawIds)}return u&&hy({tournamentRecord:i,event:t}),W}function Tde(t,e){return t?.find((i,r)=>e.eventIndex!==void 0&&r===e.eventIndex||e.eventName&&i.eventName===e.eventName||e.eventId&&i.eventId===e.eventId)}function x3e({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n,params:a}){return O3e({event:t,eventProfile:{...e,...a},tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n})}function F3e({eventProfile:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s}){let o=yde({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,randomWinningSide:a.randomWinningSide,ratingsParameters:t.ratingsParameters,tournamentRecord:e,eventProfile:t,eventIndex:s,uuids:a.uuids});if(o.error)return o;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=o;return u&&n.push(...u),r.push(l),c?.length&&i.push(...c),{eventIndexIncrement:1}}function L3e({eventProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=e.events?.length||0;for(let o of t){let l=Tde(e.events,o);if(l){let u=x3e({event:l,eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,drawIds:n,params:a});if(u?.error)return u}else{let u=F3e({eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s});if(u?.error)return u;s+=u?.eventIndexIncrement||1}}return W}function _3e({drawProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=(e.events||[]).flatMap(o=>o.drawDefinitions?.map(()=>1)||[]).reduce((o,l)=>o+l,0);for(let o of t){let l=FA({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,hydrateCollections:a.hydrateCollections,randomWinningSide:a.randomWinningSide,ratingsParameters:a.ratingsParameters,tournamentRecord:e,drawProfile:o,drawIndex:s,uuids:a.uuids});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(l=py({tournamentRecord:e,event:d,internalUse:!0}),l.error)return l;u&&n.push(u),r.push(c),p?.length&&i.push(...p),s+=1}return W}function $3e({schedulingProfile:t,autoSchedule:e,periodLength:i,tournamentRecord:r}){let n=[],a={};if(t?.length){let s={[r.tournamentId]:r},o=cy({tournamentRecords:s,schedulingProfile:t});if(o.error)return o;if(e){let{tournamentId:l}=r,u={[l]:r};a=kA({tournamentRecords:u,periodLength:i})}}return{scheduledRounds:n,schedulerResult:a}}function Dde(t){let{participantsProfile:e={},schedulingProfile:i,tournamentRecord:r,autoSchedule:n,eventProfiles:a,periodLength:s,venueProfiles:o,drawProfiles:l,uuids:u}=t;if(!r)return{error:Ie};let c=[],d=[],p=[];a?.forEach(w=>{let y=Tde(r.events,w);y?.gender&&(w.gender=y.gender)});let f=r.participants?.length||void 0;f&&e?.idPrefix&&(e.idPrefix=`${e.idPrefix}-${f}`);let h=pde({startDate:r.startDate,participantsProfile:e,tournamentRecord:r,eventProfiles:a,drawProfiles:l,uuids:u});if(!h.success)return h;if(a){let w=L3e({eventProfiles:a,tournamentRecord:r,allUniqueParticipantIds:c,eventIds:d,drawIds:p,params:t});if(w.error)return w}if(l){let w=_3e({drawProfiles:l,tournamentRecord:r,allUniqueParticipantIds:c,eventIds:d,drawIds:p,params:t});if(w.error)return w}let m=o?.length?QG({tournamentRecord:r,venueProfiles:o}):[],g=$3e({tournamentRecord:r,schedulingProfile:i,autoSchedule:n,periodLength:s});if(g.error)return g;let{scheduledRounds:I,schedulerResult:v}=g;return{totalParticipantsCount:r.participants.length,scheduledRounds:I,schedulerResult:v,...W,eventIds:d,venueIds:m,drawIds:p}}var Pde={};ft(Pde,{addDynamicRatings:()=>lj,addIndividualParticipantIds:()=>PA,addParticipant:()=>Dl,addParticipants:()=>lo,addPenalty:()=>qde,addPersonRequests:()=>Ade,addPersons:()=>Yde,createGroupParticipant:()=>_de,createTeamsFromParticipantAttributes:()=>qG,deleteParticipants:()=>rg,filterParticipants:()=>eT,findParticipant:()=>Lde,getCompetitionParticipants:()=>xj,getPairedParticipant:()=>oo,getParticipantEventDetails:()=>Fj,getParticipantMembership:()=>Lj,getParticipantScaleItem:()=>em,getParticipantSchedules:()=>_j,getParticipantSignInStatus:()=>$j,getParticipantTimeItem:()=>J2,getParticipants:()=>Ei,getScaleValues:()=>Yv,mergeParticipants:()=>zde,modifyIndividualParticipantIds:()=>kde,modifyParticipant:()=>EA,modifyParticipantName:()=>$de,modifyParticipantOtherName:()=>xde,modifyParticipantsSignInStatus:()=>Ode,modifyPenalty:()=>Hde,modifyPersonRequests:()=>Mde,mutate:()=>Ede,participantScaleItem:()=>su,query:()=>Nue,regenerateParticipantNames:()=>Fde,removeIndividualParticipantIds:()=>wV,removeParticipantIdsFromAllTeams:()=>MN,removePenalty:()=>jde,removePersonRequests:()=>Nde,removeRatings:()=>Vde,scaledTeamAssignment:()=>Bde,setParticipantScaleItem:()=>ly,setParticipantScaleItems:()=>Tle,validateLineUp:()=>AN});var Ede={};ft(Ede,{addDynamicRatings:()=>lj,addIndividualParticipantIds:()=>PA,addParticipant:()=>Dl,addParticipants:()=>lo,addPenalty:()=>qde,addPersonRequests:()=>Ade,addPersons:()=>Yde,createGroupParticipant:()=>_de,createTeamsFromParticipantAttributes:()=>qG,deleteParticipants:()=>rg,findParticipant:()=>Lde,mergeParticipants:()=>zde,modifyIndividualParticipantIds:()=>kde,modifyParticipant:()=>EA,modifyParticipantName:()=>$de,modifyParticipantOtherName:()=>xde,modifyParticipantsSignInStatus:()=>Ode,modifyPenalty:()=>Hde,modifyPersonRequests:()=>Mde,regenerateParticipantNames:()=>Fde,removeIndividualParticipantIds:()=>wV,removeParticipantIdsFromAllTeams:()=>MN,removePenalty:()=>jde,removePersonRequests:()=>Nde,removeRatings:()=>Vde,scaledTeamAssignment:()=>Bde,setParticipantScaleItem:()=>ly,setParticipantScaleItems:()=>Tle});function Rde(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function Cde({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:s,endTime:o}=n;return n.requestType===PT&&(a=Ze(a),s=fi(s),o=fi(o),a&&s&&o)?{date:a,startTime:s,endTime:o,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=Rde(),t[e].push(n);return{mergeCount:r.length}}function ZG(t){let{tournamentRecords:e,personRequests:i}=t,r=He(t,[{[fn]:!0}]);if(r.error)return r;if(!i)return{...W};let n=Object.values(e);for(let a of n){let s=a.participants??[],o=[];for(let l of Object.keys(i))if(Cd({tournamentParticipants:s,personId:l})){let u=i[l];u.length&&o.push({personId:l,requests:u})}Object.keys(o).length&&It({element:a,extension:{value:o,name:Xv}})}return{...W}}function Mde(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=He(t,[{[fn]:!0},{requests:!0,[Jn]:on,[Ya]:re}]);if(n.error)return n;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:s}=kf({tournamentRecords:e}),o=u=>{s&&(s[u]=s[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(r&&s?.[r])o(r);else if(s)for(let u of Object.keys(s))o(u);let l=i.filter(u=>!u.requestId);return l.length&&Cde({personRequests:s,personId:r,requests:l}),ZG({tournamentRecords:e,personRequests:s})}function Nde(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,s=He(t,[{[fn]:!0}]);if(s.error)return s;let{personRequests:o}=kf({tournamentRecords:e}),l=c=>{o&&(o[c]=o[c].filter(d=>(!i||d.requestType!==i)&&(!r||d.requestId!==r)&&(!a||d.date!==a)),o?.[c]?.length||delete o[c])},u=!i&&!r&&!n&&!a;if(!u){if(n&&o?.[n])l(n);else if(o)for(let c of Object.keys(o))l(c)}return u||!o||!Object.keys(o).length?On({name:Xv,tournamentRecords:e,discover:!0}):ZG({tournamentRecords:e,personRequests:o})}function Ade(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=He(t,[{[fn]:!0,[E_e]:!0},{requests:!0,[Jn]:on,[Ya]:re}]);if(n.error)return n;let{personRequests:a}=kf({tournamentRecords:e}),{mergeCount:s}=Cde({personRequests:a,personId:i,requests:r});return s&&a?ZG({tournamentRecords:e,personRequests:a}):{error:re}}function kde({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return q({result:{error:Ie},stack:r});if(!e||!t)return q({result:{error:Je},stack:r});let n=i.participants||[],a=n.find(f=>f.participantId===e);if(!a)return q({result:{error:Gi},stack:r});if(![$t,ts].includes(a.participantType))return q({result:{error:Lo},context:{participantType:a.participantType},stack:r});let s=t.filter(f=>n.find(h=>h.participantId===f)?.participantType!==yt);if(s.length)return q({result:{error:Ua,invalidParticipantIds:s},stack:r});let o=a.individualParticipantIds||[],l=t.filter(f=>!o.includes(f)),u=o.filter(f=>!t.includes(f)),c=PA({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return q({result:c,stack:r});let d=wV({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return q({result:d,stack:r});let{topics:p}=Ts();if(p.includes(nn)){let f=n.find(({participantId:h})=>h===e);at({topic:nn,payload:{tournamentId:i.tournamentId,participants:[f]}})}return{...c,...d}}function Ode({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:Ie};if(!Array.isArray(e))return{error:Je};if(![Iw,Bae].includes(i))return{error:re,signInState:i};let r=t.participants||[];if(!r.length)return{error:yU};let n=r.map(wt),a=e.filter(u=>!n.includes(u));if(a.length)return{error:re,context:{invalidParticipantIds:a}};let s=[],o=new Date().toISOString();for(let u of r){let{participantId:c}=u;if(e.includes(c)){let d=KV({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:LU,itemValue:i,createdAt:o}});if(d.error)return d;s.push(u)}}let{topics:l}=Ts();return s.length&&l.includes(nn)&&at({topic:nn,payload:{tournamentId:t.tournamentId,participants:s}}),{...W}}function xde({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:Ie};if(!e)return{error:pr};let{participant:r}=ip({tournamentRecord:t,participantId:e});if(!r)return{error:Gi};r.participantOtherName=i;let{topics:n}=Ts();return n.includes(nn)&&at({topic:nn,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...W}}function q3({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),r=m=>/^[a-z]*$/.test(i(m)),n=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),s=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),o=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,u=m=>m.toLowerCase().indexOf("f")<0,c=m=>m.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=lF(e?.standardGivenName??""),f=lF(e?.standardFamilyName??"");if(!t)return`${p}${d}${f}`;l(t)&&!o(t)&&!s(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),f=f.toLowerCase()):n(t)?(p=p.toUpperCase(),f=f.toUpperCase()):a(t)&&(f=f.toUpperCase());let h=`${p}${d}${f}`;return u(t)?h=f:s(t)&&(o(t)?h=`${f},${d}${p}`:h=`${f}${d}${p}`),h}function B3e({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,s=r&&i[r];if(r!==Gn&&s){let{personFormat:o,doublesJoiner:l}=s;r===yt&&(e.participantName=q3({person:a,personFormat:o})),r===mt&&(e.participantName=n?.map(u=>{let c=t[u]?.person;return q3({person:c,personFormat:o})}).filter(Boolean).join(l??"/"))}}function Fde({tournamentRecord:t,formats:e}){if(!t)return{error:Ie};if(!Ut(e))return{error:Je};let i=t.participants??[],r=hie(i,"participantId");for(let n of i)B3e({participant:n,participantMap:r,formats:e});return{...W}}function Lde(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,s=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Je,stack:"publicFindParticipant"};let o,l;for(let u of Object.values(s)){l=u.tournamentId;let c=u.participants||[];if(o=Cd({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),o)break}return{participant:o,tournamentId:l,...W}}function _de({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=zse,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:Ie};if(!a)return{error:Je,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:re};let s=(Ei({participantFilters:{participantTypes:[yt]},tournamentRecord:r}).participants??[]).map(c=>c.participantId);for(let c of t)if(!s.includes(c))return{error:Lo,participantId:c};let o=je({participantId:n||Et(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:ts,participantRole:i}),l=Dl({participant:o,tournamentRecord:r});if(l.error)return l;let{topics:u}=Ts();return u.includes(Md)&&at({topic:Md,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...W,participant:xe(o)}}function $de({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:Ie};if(!i)return{error:pr};if(!e)return{error:Je,info:"Missing participantName"};let{participant:r}=ip({tournamentRecord:t,participantId:i});if(!r)return{error:Gi};r.participantName=e;let{topics:n}=Ts();return n.includes(nn)&&at({topic:nn,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...W}}function Bde({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:s,scaleAttributes:o,teamNameBase:l,teamsCount:u,eventId:c,event:d}){if(!s)return{error:Ie};if(!Array.isArray(a)&&!ct(u)&&!c||!ct(r)||n&&!Array.isArray(n)||o&&(typeof o!="object"||!Object.keys(o).length))return{error:re};if(!o&&!n.length||!n&&!(e&&o))return{error:Je,info:"Missing scaling details"};if(c&&!a){if(d?.eventType!==Ca)return{error:bu};a=d?.entries?.filter(({entryStatus:I})=>I===ga).map(wt)}if(!a?.length&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Je};let p=e??n.map(({participantId:I})=>I);i&&(a?.reverse(),r+=1),r>(a?.length||0)-1&&(r=0);let f=a?.slice(r).concat(...a.slice(0,r))??[],h=[];for(let I of s.participants??[]){let{participantId:v,participantType:w}=I;if(f.includes(v)){if(w!==Gn)return{error:Lo,participant:I};h.push(I)}}if(u&&h.length<u){let I=u-(h?.length||0),v=l??"Team",w=Ce(0,I).map(U=>({participantName:`${v} ${U+1}`,participantType:Gn,participantRole:Qr})),{participants:y=[]}=lo({participants:w,returnParticipants:!0,tournamentRecord:s}),b=y.map(wt),S=s.participants?.filter(({participantId:U})=>b.includes(U))??[];h.push(...S)}if(!h.length)return{error:XB};if(t)for(let I of h)I.individualParticipantIds=[];else{let I=h.map(v=>v).flat();e?.length?p=p.filter(v=>!I.includes(v)):n=n?.filter(({participantId:v})=>!I.includes(v))}if(!e?.length&&!n?.length)return{error:jM,info:"Nothing to be done"};if(!n.length){for(let I of s.participants??[]){let{participantId:v,participantType:w}=I;if(!p.includes(v))continue;if(w!==yt)return{error:Lo,participant:I};let y=su({scaleAttributes:o,participant:I})?.scaleItem,b=o?.accessor?y?.scaleValue?.[o?.accessor]:y?.scaleValue,S={participantId:v,scaleValue:b};n.push(S)}if(!n.length)return{error:Gi}}n.sort((I,v)=>o?.sortOrder?(v?.scaleValue||0)-(I?.scaleValue||0):(I?.scaleValue||1/0)-(v?.scaleValue||1/0));for(let I of n)if(!I.participantId)return{error:re,scaledParticipant:I};let m=0;for(;m<n.length;){for(let I of h){if(m+1>n.length)break;let v=n[m];I.individualParticipantIds.push(v.participantId),m++}h.reverse()}let g=h.map(wt);for(let I of s.events??[]){if(I.eventType!==Ca)continue;let v=(I.entries??[]).filter(w=>g.includes(w.participantId));for(let w of v){let y=w.participantId,b=h.find(U=>U.participantId===y)?.individualParticipantIds;I.entries=(I.entries??[]).filter(U=>!b.includes(U.participantId)),(I.drawDefinitions??[]).forEach(U=>{U.entries=(U.entries??[]).filter(T=>!b.includes(T.participantId))});let{flightProfile:S}=Vi({event:I});(S?.flights||[]).forEach(U=>{U.drawEntries=(U.drawEntries||[]).filter(T=>!b.includes(T.participantId))})}}return{...W,scaledParticipants:n}}function Vde(t){let e=He(t,[{[gr]:!0,[S2]:!0},{ratingType:!1,[Yr]:s=>Er[s]}]);if(e.error)return e;let i=`${t.ratingType}.${P2}`,r=t.asDynamic?i:t.ratingType,n=[Rd,md,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let s of a)s.timeItems&&(s.timeItems=s.timeItems.filter(o=>o.itemType!==n));return{...W}}function jde(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=V3e({...t,tournamentRecord:i});if(r.error&&r.error!==CI)return r}return{...W}}function V3e({tournamentRecord:t,penaltyId:e}){if(!t)return{error:Ie};if(!e)return{error:WB};let i=t?.participants??[],r=[],n=!1,a;return i.forEach(s=>{let o=!1;s.penalties=(s.penalties??[]).filter(l=>(l.penaltyId===e&&(o=!0,n||(a=l,n=!0)),o&&r.push(s),l.penaltyId!==e))}),a&&at({topic:nn,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...W,penalty:a}:{error:CI}}var j3e=({penaltyId:t=Et()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),Gde=j3e;function Hde(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=G3e({...t,tournamentRecord:i});if(r.error&&r.error!==CI||r.success)return r}return{error:CI}}function G3e({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:Ie};if(!e)return{error:re,modifications:e};if(!i)return{error:WB};let r=t?.participants??[],n=Object.keys(Gde()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:GM};let s,o=[];return r.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),s||(s=c)),c)),u&&o.push(l)}),s&&at({topic:nn,payload:{tournamentId:t.tournamentId,participants:o}}),s?{...W,penalty:s}:{error:CI}}function Wde(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:lt(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=lt(t[n].map(s=>JSON.stringify(s)).concat(e[n].map(s=>JSON.stringify(s)))).map(s=>JSON.parse(s));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=Wde(t[n],e[n],i):r[n]=e[n];return r},{})}function zde({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:Ie};e.participants||(e.participants=[]);let r=t.filter(Aa(Eu)).map(u=>({[u.participantId]:u})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(u=>{if(n[u.participantId]){let c=Wde(u,n[u.participantId],i);return a.push(c),c}return u});let s=e.participants.map(Aa(Eu))||[],o=t.filter(({participantId:u})=>!s.includes(u)),{topics:l}=Ts();return o.length&&(e.participants=e.participants.concat(...o),l.includes(Md)&&at({topic:Md,payload:{participants:o}})),a.length&&l.includes(nn)&&at({topic:nn,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:o.length,...W}}function qde(t){let{tournamentRecord:e,participantIds:i}=t,r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n;for(let a of Object.values(r)){let s=(Ei({tournamentRecord:a}).participants??[])?.map(wt).filter(o=>i.includes(o));s.length&&(n=H3e({...t,penaltyId:t.penaltyId??n,tournamentRecord:a,participantIds:s}).penaltyId)}return n?{...W,penaltyId:n}:{error:Gi}}function H3e({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:s,matchUpId:o,issuedAt:l,notes:u}){if(!e)return{error:Ie};if(!i)return{error:pr};if(!n)return{error:vre};let c=(e?.participants??[]).filter(f=>i.includes(f.participantId));if(!c.length)return{error:Gi};let d=new Date().toISOString(),p=Object.assign(Gde({penaltyId:s}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:o,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(f=>It({element:p,extension:f})),c.forEach(f=>{f.penalties??=[],f.penalties.push(p)}),at({topic:nn,payload:{tournamentId:e.tournamentId,participants:c}}),{...W,penaltyId:p.penaltyId}}function Yde({participantRole:t=Qr,tournamentRecord:e,persons:i}){if(!e)return{error:Ie};if(!Array.isArray(i))return{error:re};if(!Object.keys(bV).includes(t))return{error:ore};let r=new Set((e.participants||[]).map(({person:h})=>h?.personId).filter(Boolean)),n=[],a=i.filter(h=>h&&(!h.personId||!r.has(h.personId))).map(h=>(h.personId||(h.personId=Et()),n.push(h.personId),h)),s=(h,m)=>Object.assign({},...Object.keys(h).filter(g=>!m.includes(g)).map(g=>({[g]:h[g]}))),o=a.map(h=>je({extensions:h.participantExtensions,timeItems:h.participantTimeItems,participantType:yt,participantRole:t,person:s(h,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,u,c=lo({participants:o,tournamentRecord:e});if(c.error)return c;u=c.addedCount||0;let d=[],p=Ei({participantFilters:{participantTypes:[yt]},tournamentRecord:e})?.participants??[];if(t===Qr&&i.filter(({pairedPersons:h})=>h).forEach(({personId:h,pairedPersons:m})=>{Array.isArray(m)&&m.forEach(g=>{let I=[h,g.personId].map(v=>Cd({tournamentParticipants:p,personId:v})).filter(Boolean);if(I.length===2){let v=I.map(wt);d.push(je({extensions:g.participantExtensions,timeItems:g.timeItems,participantRole:Qr,individualParticipantIds:v,participantType:mt}))}})}),d.length){if(c=lo({participants:d,tournamentRecord:e}),c.error)return c;l=c.addedCount||0}let f=u+l;return{...W,addedCount:f,newPersonIds:n}}var Kde={};ft(Kde,{bulkUpdatePublishedEventIds:()=>Xj,getAllEventData:()=>Jj,getCourtInfo:()=>TN,getDrawData:()=>GN,getEventData:()=>hT,getEventPublishStatus:()=>Fa,getPublishState:()=>ig,getTournamentPublishStatus:()=>iy,getVenueData:()=>VI,mutate:()=>Xde,publishEvent:()=>hy,publishEventSeeding:()=>Jde,publishOrderOfPlay:()=>ipe,publishParticipants:()=>tpe,query:()=>_ue,setEventDisplay:()=>wA,unPublishEvent:()=>rpe,unPublishEventSeeding:()=>Qde,unPublishOrderOfPlay:()=>epe,unPublishParticipants:()=>Zde});var Xde={};ft(Xde,{publishEvent:()=>hy,publishEventSeeding:()=>Jde,publishOrderOfPlay:()=>ipe,publishParticipants:()=>tpe,setEventDisplay:()=>wA,unPublishEvent:()=>rpe,unPublishEventSeeding:()=>Qde,unPublishOrderOfPlay:()=>epe,unPublishParticipants:()=>Zde});function Jde({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=rs,drawIds:a=[],event:s}){if(!r)return{error:Ie};if(!s)return{error:ci};let o=Fa({event:s,status:n}),l=(o?.seeding?.seedingScaleNames||i)&&{...o?.seeding?.seedingScaleNames,...i},u=(o?.seeding?.stageSeedingScaleNames||e)&&{...o?.seeding?.stageSeedingScaleNames,...e},c=je({stageSeedingScaleNames:u,seedingScaleNames:l,published:!0,drawIds:a});return fy({statusObject:{seeding:c},removePriorValues:t,status:n,event:s}),at({topic:Oae,payload:{tournamentId:r.tournamentId,eventId:s.eventId,drawIds:a}}),{...W}}function Qde({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=rs,drawIds:n,stages:a,event:s}){if(!i)return{error:Ie};if(!s)return{error:ci};let o=Fa({event:s});if(o){let l=o.seeding;if(Array.isArray(a)&&l.stageSeedingScaleNames)for(let u of a)l.stageSeedingScaleNames[u]&&delete l.stageSeedingScaleNames[u];Array.isArray(e)&&l?.seedingScaleNames&&(l.seedingScaleNames=l.seedingScaleNames.filter(u=>!e.includes(u))),Array.isArray(n)&&l?.drawIds&&(l.drawIds=l.drawIds.filter(u=>!n.includes(u))),(!Object.values(l.stageSeedingScaleNames??{}).length&&!l.seedingScaleNames?.length&&!l.drawIds?.length||!a&&!e&&!n?.length)&&(delete l.stageSeedingScaleNames,delete l.seedingScaleNames,delete l.drawIds,l.published=!1),fy({statusObject:{seeding:l},removePriorValues:t,status:r,event:s})}return at({topic:q2,payload:{tournamentId:i.tournamentId,eventId:s.eventId}}),{...W}}function eH({tournamentRecord:t}){if(!SU(hE))return;let e=iy({tournamentRecord:t});if(!(e?.orderOfPlay?.published||e?.participants?.published)){for(let i of t.events??[]){let r=Fa({event:i})?.drawDetails??{};for(let n of i.drawDefinitions?.map($I)??[])if(RN({drawDetails:r,drawId:n,ignoreEmbargo:!0}))return}at({topic:hE,payload:{tournamentId:t.tournamentId}})}}function Zde(t){let e=Ds(t);if(!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=W3e({tournamentRecord:i,...t});if(r.error)return r}return{...W}}function W3e({removePriorValues:t=!0,tournamentRecord:e,status:i=rs}){if(!e)return{error:Ie};let r=`${rp}.${np}`,{timeItem:n}=Ps({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].participants,Ll({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),at({payload:{tournamentId:e.tournamentId},topic:Lae}),eH({tournamentRecord:e}),{...W}}function epe(t){let e=Ds(t);if(!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=z3e({tournamentRecord:i,...t});if(r.error)return r}return{...W}}function z3e({removePriorValues:t=!0,tournamentRecord:e,status:i=rs}){if(!e)return{error:Ie};let r=`${rp}.${np}`,{timeItem:n}=Ps({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Ll({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),at({topic:Y2,payload:{tournamentId:e.tournamentId}}),eH({tournamentRecord:e}),{...W}}function tpe(t){let e=Ds(t);if(!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=q3e({tournamentRecord:i,...t});if(r.error)return r}return{...W}}function q3e({removePriorValues:t,tournamentRecord:e,status:i=rs,embargo:r,columns:n,language:a}){if(!e)return{error:Ie};let s=`${rp}.${np}`,{timeItem:o}=Ps({element:e,itemType:s}),l=o?.itemValue||{[i]:{}},u={published:!0};return r&&!cd(r)?{error:Bg}:(r&&(u.embargo=r),n&&(u.columns=n),l[i].participants=u,a&&(l[i].language=a),Ll({timeItem:{itemValue:l,itemType:s},element:e,removePriorValues:t}),at({payload:{tournamentId:e.tournamentId},topic:Fae}),{...W})}function ipe(t){let e=Ds(t);if(!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=Y3e({tournamentRecord:i,...t});if(r.error)return r}return{...W}}function Y3e({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=rs,eventIds:n=[],embargo:a,language:s}){if(!i)return{error:Ie};let o=`${rp}.${np}`,{timeItem:l}=Ps({element:i,itemType:o}),u=l?.itemValue||{[r]:{}},c={published:!0,scheduledDates:t,eventIds:n};return a&&!cd(a)?{error:Bg}:(a&&(c.embargo=a),u[r].orderOfPlay=c,s&&(u[r].language=s),Ll({timeItem:{itemValue:u,itemType:o},element:i,removePriorValues:e}),at({topic:xae,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...W})}function rpe({removePriorValues:t=!0,tournamentRecord:e,status:i=rs,event:r}){if(!e)return{error:Ie};if(!r)return{error:ci};let n=`${rp}.${np}`,{timeItem:a}=_U({itemType:n,event:r}),s=a?.itemValue||{[i]:{}};return delete s[i].structureIds,delete s[i].drawDetails,delete s[i].drawIds,og({event:r,timeItem:{itemValue:s,itemType:n},removePriorValues:t}),fy({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),at({topic:z2,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),eH({tournamentRecord:e}),{eventId:r.eventId,...W}}var tH={};ft(tH,{applyTournamentRankingPoints:()=>lpe,generateRankingList:()=>ape,getAwardPoints:()=>RE,getAwardProfile:()=>qj,getParticipantPoints:()=>spe,getQualityWinPoints:()=>zj,getTournamentPoints:()=>uy,mutate:()=>ope,query:()=>npe});var npe={};ft(npe,{generateRankingList:()=>ape,getAwardPoints:()=>RE,getAwardProfile:()=>qj,getParticipantPoints:()=>spe,getQualityWinPoints:()=>zj,getTournamentPoints:()=>uy});function xE({awards:t,pointComponents:e,bestOfCount:i,maxResultsPerLevel:r,mandatoryRules:n}){let a=t.map(d=>{let p=0;for(let f of e)p+=typeof d[f]=="number"?d[f]:0;return{award:d,value:p}});a.sort((d,p)=>p.value-d.value);let s=a,o=[];if(r){let d={};s=[];for(let p of a){let f=p.award.level;f===void 0||!r[f]?s.push(p):(d[f]=(d[f]||0)+1,d[f]<=r[f]?s.push(p):o.push(p))}}if(n?.length)return K3e(s,o,i,n);let l=i>0?s.slice(0,i):s,u=[...i>0?s.slice(i):[],...o],c=l.reduce((d,p)=>d+p.value,0);return{counting:l,dropped:u,bucketTotal:c}}function K3e(t,e,i,r){let n=new Set;for(let p of r){let f=new Set(p.levels),h=[];for(let g=0;g<t.length;g++){let I=t[g].award.level;I!==void 0&&f.has(I)&&h.push(g)}let m=p.bestOfCount?h.slice(0,p.bestOfCount):h;for(let g of m)n.add(g)}let a=[],s=[];for(let p=0;p<t.length;p++)n.has(p)?a.push(t[p]):s.push(t[p]);let o,l;if(i>0){let p=Math.max(0,i-a.length);o=s.slice(0,p),l=s.slice(p)}else o=s,l=[];let u=[...a,...o],c=[...l,...e],d=u.reduce((p,f)=>p+f.value,0);return{counting:u,dropped:c,bucketTotal:d}}function ape({pointAwards:t,aggregationRules:e={},categoryFilter:i,asOfDate:r}){let{rollingPeriodDays:n,countingBuckets:a,tiebreakCriteria:s=[],minCountableResults:o=0,maxResultsPerLevel:l,bestOfCount:u}=e,c=t;if(i&&(c=c.filter(h=>{if(i.ageCategoryCodes?.length){let m=h.category?.ageCategoryCode;if(!m||!i.ageCategoryCodes.includes(m))return!1}if(i.genders?.length){let m=h.category?.gender||h.gender;if(!m||!i.genders.includes(m))return!1}return!(i.eventTypes?.length&&(!h.eventType||!i.eventTypes.includes(h.eventType)))})),n&&r){let h=new Date(r);h.setDate(h.getDate()-n);let m=h.getTime();c=c.filter(g=>g.endDate?new Date(g.endDate).getTime()>=m:!0)}let d={};for(let h of c){let m=h.personId;m&&(d[m]||(d[m]=[]),d[m].push(h))}let p=[];for(let[h,m]of Object.entries(d)){let g=0,I=[],v=[],w;if(a?.length){w=[];for(let S of a){let{bucketName:U,eventTypes:T,pointComponents:D,bestOfCount:P,maxResultsPerLevel:E,mandatoryRules:R}=S,C=m;T?.length&&(C=C.filter(O=>O.eventType&&T.includes(O.eventType)));let{counting:M,dropped:N,bucketTotal:A}=xE({awards:C,pointComponents:D,bestOfCount:P,maxResultsPerLevel:E,mandatoryRules:R});g+=A,I.push(...M.map(O=>O.award)),v.push(...N.map(O=>O.award)),w.push({bucketName:U,countingResults:M.map(O=>O.award),droppedResults:N.map(O=>O.award),bucketTotal:A})}}else{let{counting:S,dropped:U,bucketTotal:T}=xE({awards:m,pointComponents:["points","qualityWinPoints"],bestOfCount:u||0,maxResultsPerLevel:l});g=T,I=S.map(D=>D.award),v=U.map(D=>D.award)}let y=I.length>=o,b={personId:h,totalPoints:g,rank:0,meetsMinimum:y,countingResults:I,droppedResults:v};w&&(b.bucketBreakdown=w),p.push(b)}p.sort((h,m)=>m.totalPoints-h.totalPoints),s.length&&p.sort((h,m)=>{if(h.totalPoints!==m.totalPoints)return m.totalPoints-h.totalPoints;for(let g of s){let I=Y3(g,h,m);if(I!==0)return I}return 0});let f=1;for(let h=0;h<p.length;h++)h>0&&p[h].totalPoints===p[h-1].totalPoints?s.length>0&&s.some(m=>Y3(m,p[h-1],p[h])!==0)?p[h].rank=f:p[h].rank=p[h-1].rank:p[h].rank=f,f=h+2;return p}function Y3(t,e,i){switch(t){case"highestSingleResult":{let r=Math.max(0,...e.countingResults.map(n=>n.points||0));return Math.max(0,...i.countingResults.map(n=>n.points||0))-r}case"mostCountingResults":return i.countingResults.length-e.countingResults.length;case"mostWins":{let r=e.countingResults.reduce((n,a)=>n+(a.winCount||0),0);return i.countingResults.reduce((n,a)=>n+(a.winCount||0),0)-r}default:return 0}}function spe({pointAwards:t,personId:e,aggregationRules:i={}}){let{countingBuckets:r,maxResultsPerLevel:n,bestOfCount:a}=i,s=t.filter(c=>c.personId===e);if(r?.length){let c=[],d=0;for(let p of r){let{bucketName:f,eventTypes:h,pointComponents:m,bestOfCount:g,maxResultsPerLevel:I,mandatoryRules:v}=p,w=s;h?.length&&(w=w.filter(U=>U.eventType&&h.includes(U.eventType)));let{counting:y,dropped:b,bucketTotal:S}=xE({awards:w,pointComponents:m,bestOfCount:g,maxResultsPerLevel:I,mandatoryRules:v});d+=S,c.push({bucketName:f,countingResults:y.map(U=>U.award),droppedResults:b.map(U=>U.award),bucketTotal:S})}return{buckets:c,totalPoints:d}}let{counting:o,dropped:l,bucketTotal:u}=xE({awards:s,pointComponents:["points","qualityWinPoints"],bestOfCount:a||0,maxResultsPerLevel:n});return{buckets:[{bucketName:"All",countingResults:o.map(c=>c.award),droppedResults:l.map(c=>c.award),bucketTotal:u}],totalPoints:u}}var ope={};ft(ope,{applyTournamentRankingPoints:()=>lpe});function lpe({tournamentRecord:t,policyDefinitions:e,participantFilters:i,scaleName:r="RANKING_POINTS",level:n,removePriorValues:a}){if(!t)return{error:Ie};let s=uy({tournamentRecord:t,policyDefinitions:e,participantFilters:i,level:n});if(s.error)return s;let{personPoints:o,pairPoints:l,teamPoints:u}=s,c={};for(let f of t.participants||[])f.person?.personId&&(c[f.person.personId]=f.participantId);let d=t.endDate,p=0;for(let[f,h]of Object.entries(o)){let m=c[f];if(!m)continue;let g={};for(let I of h){let v=I.eventType||"SINGLES";g[v]||(g[v]=[]),g[v].push(I)}for(let[I,v]of Object.entries(g)){let w=v.reduce((b,S)=>b+(S.points||0)+(S.qualityWinPoints||0)+(S.linePoints||0),0),y=ly({tournamentRecord:t,participantId:m,scaleItem:{scaleType:Ru,scaleName:r,eventType:I,scaleDate:d,scaleValue:{points:w,awards:v}},removePriorValues:a});if(y.error)return y;p++}}return{...W,personPoints:o,pairPoints:l,teamPoints:u,modificationsApplied:p}}var upe={};ft(upe,{getEntryStatusReports:()=>J3e,getParticipantStats:()=>X3e,getStructureReports:()=>Z3e,getVenuesReport:()=>aYe});function X3e({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:s,matchUps:o}){if(!n)return{error:Ie};if(o&&!Array.isArray(o))return{error:fa};if(o=o??Tr({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!o?.length)return{error:Bu};let l=[];e&&l.push(e),r&&l.push(r);let u=l.length?{participantIds:l}:{participantTypes:[Gn]},c=Ei({participantFilters:u,tournamentRecord:n}).participants??[];if(!c.every(({participantType:U})=>U===Gn))return{error:Ua};l.length||l.push(...c.map(wt));let d=new Map,p=new Map,f=new Map,h=new Map,m=(U,T="")=>p.get(U)||p.set(U,{participantName:T,participantId:U,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(U);for(let U of c){let{participantId:T,individualParticipantIds:D}=U;h.set(T,D??[]),m(T,U.participantName)}if(r&&!h.get(r))return q({result:{error:Gi},context:{teamParticipantId:r}});if(e&&!h.get(e))return q({result:{error:Gi},context:{opponentParticipantId:e}});let g=[],I=U=>{let T=[[],[]];for(let P of U){let E=P.participant;if(E?.participantName){d.set(E.participantId,{participantName:E.participantName,ratings:E.ratings});let R=p.get(E.participantId);R&&(R.participantName=E.participantName)}}let D=({side:P,individualParticipantIds:E})=>P.participantId&&(!E?.length||E.includes(P.participantId))&&[P.participantId]||P.participant?.individualParticipantIds?.length&&(!E?.length||_i(E,P.participant?.individualParticipantIds).length===P.participant?.individualParticipantIds?.length)&&P.participant.individualParticipantIds;if(h.size){let P=(E,R)=>{for(let C of U){if(!C.participant)continue;let M=D({individualParticipantIds:R,side:C});if(M?.length){let N=C.sideNumber;if(!N)continue;let A=[E];i&&A.push(...M),T[N-1]=A;let O=p.get(E);for(let k of M.filter(Boolean))O&&!O.competitorIds.includes(k)&&O.competitorIds.push(k)}}};if(r)(!e||U.every(E=>E.participant&&(D({individualParticipantIds:h.get(r),side:E})||D({individualParticipantIds:h.get(e),side:E}))))&&P(r,h.get(r));else for(let[E,R]of h)P(E,R)}else if(i)for(let P of U){if(!P.participant)continue;let E=D({individualParticipantIds:[],side:P}),R=P.sideNumber;R&&(T[R-1]=E)}return T};for(let U of o){if(!Ut(U))return{error:fa};let{matchUpStatus:T,matchUpFormat:D,matchUpType:P,winningSide:E,score:R,sides:C}=U;if(!C||!R||P===Wa||T==="BYE")continue;let M=I(C);if(!M.filter(Boolean).length)continue;let N=t&&E&&qU({matchUp:U})?.competitiveness;g.push(U);let A=hV({matchUpStatus:T,matchUpFormat:D,tallyPolicy:s,winningSide:E,score:R}),O=Ase({matchUpStatus:T,matchUpFormat:D,tallyPolicy:s,winningSide:E,score:R}),{pointsTally:k,tiebreaksTally:F}=kse({matchUpFormat:D,score:R});M.forEach((x,L)=>{for(let $ of x){let V=d.get($)?.participantName,_=m($,V);if(_){let B=(X,Z)=>Z.forEach((Q,ae)=>_[X][ae]+=Q),G=L?[...F].reverse():F,j=L?[...k].reverse():k,Y=L?[...O].reverse():O,K=L?[...A].reverse():A;if(B("tiebreaks",G),B("points",j),B("games",Y),B("sets",K),E){let X=E-1===L?0:1;_.matchUps[X]+=1}if(N){let X=N.toLowerCase();_.competitiveness[X]||(_.competitiveness[X]=[0,0]),_.competitiveness[X][L]+=1}if(T){let X=T.toLowerCase();_.matchUpStatuses[X]||(_.matchUpStatuses[X]=0),_.matchUpStatuses[X]+=1}}}})}let v=["tiebreaks","matchUps","points","games","sets"],w=["competitive","routine","decisive"],y=new Map,b=(U,T)=>(U??0)+(T??0);for(let[U,T]of p.entries()){for(let D of v){let P=T[D].reduce(b);if(P){let E=T[D][0]/P,R=`${D}Ratio`,C=parseFloat(E.toFixed(2));T[R]=C,f.set(U,!0),y.has(R)||y.set(R,[]),y.get(R)?.push(C)}}for(let D of w){let P=T.competitiveness?.[D]?.reduce(b);if(P){let E=T.competitiveness[D][0]/P,R=`${D}Ratio`,C=parseFloat(E.toFixed(2));T[R]=C}}}if(!r){let U=(T,D)=>D-T;for(let T of p.values())for(let D of v){let P=`${D}Ratio`;if(typeof T[P]=="number"){let E=y.get(P)?.sort(U).indexOf(T[P]);if(typeof E=="number"&&E>=0){let R=`${D}Rank`;T[R]=E+1}}}}let S={relevantMatchUps:g,...W};return r?(S.teamStats=p.get(r),e&&(S.opponentStats=p.get(e))):S.participatingTeamsCount=f.size,S.allParticipantStats=[...p.values()],S}function FE({participant:t,eventType:e}){let i=t?.person?.personId,r=t?.person?.personOtherIds?.[0],n=t?.person?.tennisId,a=t?.ratings?.[e]?.find(({scaleName:u})=>u==="WTN"),s=a?.scaleValue,{wtnRating:o,confidence:l}=s||{};return{timeStamp:a?.scaleDate,personOtherId:r,confidence:l,wtnRating:o,personId:i,tennisId:n}}function J3e({tournamentRecord:t}){if(!t)return{error:Ie};let e=t.tournamentId,{participantMap:i}=Ei({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(Tr({matchUpFilters:{matchUpTypes:[bh,Hp]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:f,matchUpType:h})=>f?.flatMap(m=>h===Hp?m?.participant?.individualParticipantIds:m?.participant?.participantId||m.participantId).filter(Boolean)).filter(Boolean),n=[],a={},s={},o={},l=0,u=({id:f,entry:h,eventId:m,eventType:g})=>{let{qualifyingSeeding:I,mainSeeding:v,entryStatus:w,entryStage:y,drawId:b}=h;a[f]||(a[f]=[]);let{participant:S,events:U}=i?.[f]??{},T=FE({participant:S,eventType:g}),D=U?.[m]?.ranking;w===$V&&n.push(f),a[f].push({participantType:S?.participantType,participantId:f,tournamentId:e,eventType:g,eventId:m,drawId:b,entryStatus:w,entryStage:y,...T,ranking:D,mainSeeding:v,qualifyingSeeding:I})};for(let f of t.events??[]){let h={},m=U=>{h[U]||(h[U]={count:0}),h[U].count+=1},{drawDefinitions:g=[],eventType:I,eventId:v}=f,w=g.flatMap(U=>{let{drawId:T,entries:D}=U;l+=1;let P=({stage:M,stageSequence:N})=>M===ke&&N===1||M===ze,E=(U.structures??[]).filter(P).flatMap(({positionAssignments:M})=>M).filter(Boolean).map(({participantId:M})=>M),R=({participantId:M})=>E.includes(M),C=M=>{let{participantId:N,entryStatus:A,entryStage:O}=M;m(A);let k=i?.[N]?.draws?.[T]?.seedAssignments?.[ke];return{qualifyingSeeding:i?.[N]?.draws?.[T]?.seedAssignments?.[ze],participantId:N,mainSeeding:k,entryStatus:A,entryStage:O,drawId:T}};return D?.filter(R).map(C)}),y=U=>{let T=U.participantId,D=i?.[T].participant.individualParticipantIds?.filter(P=>r.includes(P));return T&&{[T]:{individualParticipantIds:D}}};I===Ec?(()=>{let U=Object.assign({},...w.map(y).filter(Boolean)),T=D=>{U[D.participantId].individualParticipantIds.forEach(P=>{u({id:P,eventType:I,eventId:v,entry:D})})};w.forEach(T)})():w.forEach(U=>{u({id:U?.participantId,eventType:I,eventId:v,entry:U})});let b=Object.values(h).reduce((U,T)=>U+T.count,0);Object.keys(h).forEach(U=>{h[U].pct=h[U].count/b*100}),o[v]={tournamentId:e,eventId:v,entries:w,entryStatuses:h};let S=Object.assign({},...mo.flatMap(U=>[{[U+"_count"]:h[U]?.count},{[U+"_pct"]:h[U]?.pct}]));s[v]={tournamentId:e,eventId:v,...S}}let c=Object.values(i??{}).filter(({participant:{participantType:f,participantRole:h}})=>f===yt&&h===Qr),d=c.filter(({participant:f})=>!r.includes(f.participantId)).map(({participant:f})=>f.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(o).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(s).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(o).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function Q3e({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=h=>{let m=h?.matchUpFormat;m&&(n[m]||(n[m]=0),n[m]+=1)},s=e.filter(h=>i?h.eventId===i:h.drawId===r).reduce((h,m)=>(a(m),(m.sides??[]).flatMap(g=>(g?.participant?.individualParticipants||[g?.participant]).filter(Boolean)).forEach(g=>h[g.participantId]=g),h),{}),o=Object.values(s),l=o.map(h=>FE({participant:h,eventType:t})).filter(({wtnRating:h})=>h),u=(o.length-l.length)/o.length*100,c=l.reduce((h,m)=>{let{wtnRating:g,confidence:I}=m;return h.totalWTN+=g,h.totalConfidence+=I,h},{totalWTN:0,totalConfidence:0}),d=l?.length?c.totalWTN/l.length:0,p=l?.length?c.totalConfidence/l.length:0,f=Object.values(n).reduce((h,m)=>h+(m||0),0);return{matchUpFormatCounts:n,matchUpsCount:f,avgConfidence:p,pctNoRating:u,avgWTN:d}}function Z3e(t){let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:r,firstStageSequenceOnly:n=!0}=t;if(!e)return{error:EI};let a=[],s={},o={},l=[],u=g=>I=>I.structureId===g,c=Object.assign({},...(i??[]).map(({name:g,label:I,accessor:v})=>{let w=rt({element:e,name:g})?.extension?.value,y=v?Pp({element:w,accessor:v})?.value:w;return{[I??g]:y}})),d=e?.tournamentId,p=Tr({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],f=g=>Ps({itemType:F2,itemSubTypes:[nu],element:{timeItems:g}})?.timeItem?.itemValue?.scaleBasis,h=({positionManipulations:g})=>{g?.forEach(I=>{let{structureId:v,name:w}=I,y=I.drawPositions??[I.drawPosition];s[v]??=[],s[v].push(`${w}: ${y.join("/")}`)})},m=e?.events?.flatMap(({timeItems:g,drawDefinitions:I=[],extensions:v,eventType:w,eventName:y,eventId:b,category:S})=>{let U=v?.find(N=>N.name===ao)?.value?.flights?.map(N=>({[N.drawId]:N.flightNumber})),T=U&&Object.assign({},...U),D=v?.find(N=>N.name===Tp),P=g?.find(N=>N.itemType===Tp),E=D?.value?.length??P?.itemValue??0,R=Object.values(T??{}),C=T&&Math.min(...R),M=f(g);return o[b]={seedingBasis:M?JSON.stringify(M):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:E,tournamentId:d,eventId:b},I.filter(N=>!r||!U||T[N.drawId]===C).flatMap(N=>{let{matchUpFormat:A,tieFormat:O,timeItems:k,extensions:F,structures:x,drawName:L,drawType:$,drawId:V}=N,{matchUpFormatCounts:_,matchUpsCount:B,avgConfidence:G,pctNoRating:j,avgWTN:Y}=Q3e({eventType:w,matchUps:p,drawId:V}),K=f(k)??M,X=eYe({extensions:F}),Z=X?.length??0;return h({positionManipulations:X}),o[b].totalPositionManipulations+=Z,o[b].generatedDrawsCount+=1,Z>o[b].maxPositionManipulations&&(o[b].maxPositionManipulations=Z),x?.filter(Q=>(Q.stageSequence===1||!n)&&[ze,ke,rn,ki].includes(Q.stage)).map(Q=>{let ae=[ke,ki].includes(Q.stage)?tYe(p,Q.structureId):void 0;Q.stage===ke&&a.push({eventName:y,drawName:L,structureId:Q.structureId});let te=iYe(ae)?.participant,ne=rYe(te),le=nYe(te),de=FE({participant:le?.[0]??te,eventType:w}),{personId:pe,personOtherId:ve,tennisId:Me,confidence:Ee,wtnRating:Be}=de||{},fe=FE({participant:le?.[1],eventType:w}),{personId:Te,personOtherId:ce,tennisId:be,confidence:we,wtnRating:Ae}=fe||{},{ageCategoryCode:ye,categoryName:Ne,subType:he}=S??{},De=Q.matchUpFormat??A,Le=(_[De]??0)/B*100,{tieFormatName:J,tieFormatDesc:se}=CE(O),{tieFormatName:oe,tieFormatDesc:ue}=CE(Q.tieFormat),ee=se===ue,Se=!ee&&oe,Pe=Q.tieFormat&&!ee&&ue,st=X?.filter(u(Q.structureId))?.length??0;return{...c,tournamentId:d,eventId:b,structureId:Q.structureId,drawId:V,eventType:w,category:he,categoryName:Ne,ageCategoryCode:ye,flightNumber:T?.[V],drawType:$,stage:Q.stage,seedingBasis:K?JSON.stringify(K):void 0,winningPersonId:pe,winningPersonOtherId:ve,winningPersonTennisId:Me,winningPersonWTNrating:Be,winningPersonWTNconfidence:Ee,winningPerson2Id:Te,winningPerson2OtherId:ce,winningPerson2TennisId:be,winningPerson2WTNrating:Ae,winningPerson2WTNconfidence:we,winningTeamId:ne,positionManipulations:st,pctNoRating:j,matchUpFormat:De,pctInitialMatchUpFormat:Le,matchUpsCount:B,drawTieFormatName:J,drawTieFormatDesc:se,tieFormatName:Se,tieFormatDesc:Pe,avgConfidence:G,avgWTN:Y}})})});return a.forEach(({eventName:g,drawName:I,structureId:v})=>{s[v]?.length&&l.push({eventName:g,drawName:I,actions:s[v]})}),{eventStructureReports:Object.values(o),structureReports:m,flightReports:l}}function eYe({extensions:t}){return t?.find(({name:e})=>e===Xg)?.value?.slice(1)}function tYe(t,e){return t.find(i=>i.structureId===e&&i.finishingRound===1&&i.winningSide)}function iYe(t){if(t?.sides)return t.sides.find(e=>e.sideNumber===t.winningSide)}function rYe(t){return t?.participantType===Gn?t.participantId:void 0}function nYe(t){return t?.participantType===mt?t.individualParticipants??[]:[]}function aYe({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){if(!Array.isArray(n))return{error:re,dates:n};if(!Array.isArray(r))return{error:re,venueIds:r};if(!(e&&Object.keys(e).filter(c=>!i||c===i)||[]).length)return{error:Ci};if(!n.every(kn))return{error:Yi};let a=Hu({tournamentRecords:e,ignoreDisabled:t,dates:n});if(a.error)return a;let s=a?.venues?.filter(({venueId:c})=>!r?.length||r.includes(c)),o=a.courts?.reduce((c,d)=>(d.dateAvailability?.forEach(p=>{let f=p.date;c.includes(f)||c.push(f)}),c),[]).filter(c=>!n.length||n.includes(c)),l={venueIds:s?.map(({venueId:c})=>c)},{matchUps:u}=_o({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:s?.map(c=>sYe(o,c,u))}}function sYe(t,e,i){let{venueId:r,courts:n,venueName:a}=e,s={};return t.forEach(o=>{let l=0,u=0,c=0;for(let f of n){let h=f.dateAvailability.find(g=>g.date===o),m=(h&&my({courtDate:h}).timeSlots)?.reduce((g,I)=>{let{startTime:v,endTime:w}=I,y=Nt(w)-Nt(v);return g+y},0);m&&(c+=1),l+=m}let d=i.filter(({schedule:f})=>f.venueId===r&&Su(o,f.scheduledDate));d.forEach(({schedule:f})=>{let h=fi(f.scheduledTime),m=aa(h,f.averageMinutes),g=Nt(m)-Nt(h);u+=g});let p=l?(u/l*100).toFixed(2):"100";s[o]={scheduledMatchUpsCount:d.length,availableCourts:c,availableMinutes:l,scheduledMinutes:u,percentUtilization:p}}),{venueId:r,venueName:a,venueReport:s}}var cpe={};ft(cpe,{addCourtGridBooking:()=>Spe,addMatchUpCourtOrder:()=>kG,addMatchUpEndTime:()=>xG,addMatchUpOfficial:()=>Gce,addMatchUpResumeTime:()=>LG,addMatchUpScheduleItems:()=>MA,addMatchUpScheduledDate:()=>RA,addMatchUpScheduledTime:()=>op,addMatchUpStartTime:()=>OG,addMatchUpStopTime:()=>FG,addSchedulingProfileRound:()=>XG,allocateTeamMatchUpCourts:()=>CA,assignMatchUpCourt:()=>dg,assignMatchUpVenue:()=>Iy,bulkRescheduleMatchUps:()=>vpe,bulkScheduleMatchUps:()=>ET,bulkScheduleTournamentMatchUps:()=>Rw,bulkUpdateCourtAssignments:()=>hpe,calculateScheduleTimes:()=>iH,clearMatchUpSchedule:()=>bpe,clearScheduledMatchUps:()=>AA,courtGridRows:()=>fA,findMatchUpFormatTiming:()=>cA,findVenue:()=>go,generateBookings:()=>NA,generateVirtualCourts:()=>UA,getMatchUpsToSchedule:()=>uA,getPersonRequests:()=>kf,getProfileRounds:()=>pA,getScheduledRoundsDetails:()=>vT,getSchedulingProfile:()=>Qc,getSchedulingProfileIssues:()=>Qj,matchUpScheduleChange:()=>ype,modifyMatchUpFormatTiming:()=>IG,mutate:()=>dpe,proAutoSchedule:()=>fpe,proConflicts:()=>gpe,publicFindCourt:()=>uV,query:()=>$ue,removeCourtGridBooking:()=>Upe,removeEventMatchUpFormatTiming:()=>bA,removeMatchUpCourtAssignment:()=>ppe,reorderUpcomingMatchUps:()=>Ipe,scheduleMatchUps:()=>mpe,scheduleProfileRounds:()=>kA,setMatchUpDailyLimits:()=>wpe,setMatchUpHomeParticipantId:()=>AG,setSchedulingProfile:()=>cy,toggleParticipantCheckInState:()=>DA,validateSchedulingProfile:()=>dA});var dpe={};ft(dpe,{addCourtGridBooking:()=>Spe,addMatchUpCourtOrder:()=>kG,addMatchUpEndTime:()=>xG,addMatchUpOfficial:()=>Gce,addMatchUpResumeTime:()=>LG,addMatchUpScheduleItems:()=>MA,addMatchUpScheduledDate:()=>RA,addMatchUpScheduledTime:()=>op,addMatchUpStartTime:()=>OG,addMatchUpStopTime:()=>FG,addSchedulingProfileRound:()=>XG,allocateTeamMatchUpCourts:()=>CA,assignMatchUpCourt:()=>dg,assignMatchUpVenue:()=>Iy,bulkRescheduleMatchUps:()=>vpe,bulkScheduleMatchUps:()=>ET,bulkScheduleTournamentMatchUps:()=>Rw,bulkUpdateCourtAssignments:()=>hpe,calculateScheduleTimes:()=>iH,clearMatchUpSchedule:()=>bpe,clearScheduledMatchUps:()=>AA,findMatchUpFormatTiming:()=>cA,generateBookings:()=>NA,generateVirtualCourts:()=>UA,matchUpScheduleChange:()=>ype,modifyMatchUpFormatTiming:()=>IG,proAutoSchedule:()=>fpe,proConflicts:()=>gpe,removeCourtGridBooking:()=>Upe,removeEventMatchUpFormatTiming:()=>bA,removeMatchUpCourtAssignment:()=>ppe,reorderUpcomingMatchUps:()=>Ipe,scheduleMatchUps:()=>mpe,scheduleProfileRounds:()=>kA,setMatchUpDailyLimits:()=>wpe,setMatchUpHomeParticipantId:()=>AG,setSchedulingProfile:()=>cy,toggleParticipantCheckInState:()=>DA,validateSchedulingProfile:()=>dA});function iH({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:s,scheduleDate:o,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:Ci};s=s??TA({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=Hu({dates:[o],ignoreDisabled:!0,tournamentRecords:a}),f=d?.filter(P=>!u||u.includes(P.venueId));l||(l=f?.reduce((P,E)=>{let R=E.dateAvailability?.find(C=>!C.date||Su(o,C.date))?.startTime??E.startTime;return R&&(!P||Nt(R)<Nt(P))?R:P},void 0)),c||(c=f?.reduce((P,E)=>{let R=E.dateAvailability?.find(C=>!C.date||Su(o,C.date))?.endTime??E.endTime;return R&&(!P||Nt(R)>Nt(P))?R:P},void 0));let h=Object.values(a),m=Object.assign({},...h.map(P=>(P.events??[]).map(E=>{let{scheduleTiming:R}=$U({tournamentRecord:P,event:E});return{[E.eventId]:{event:E,scheduleTiming:R}}})).flat()),g=wT({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:o,venueIds:u}}),I=g?.dateMatchUps??[],v=g?.completedMatchUps??[],w=[];w.push(...I),w.push(...v);let y={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},b=w?.map(({eventId:P,schedule:E,matchUpFormat:R})=>{let{event:C,scheduleTiming:M}=m[P],N=C?.eventType,A={...M,defaultTiming:y,matchUpFormat:R},{averageMinutes:O,recoveryMinutes:k}=SN({eventType:N,timingDetails:A}),{courtId:F,venueId:x}=E,L=fi(E.scheduledTime),$=aa(L,O);return{recoveryMinutes:k,averageMinutes:O,periodLength:s,startTime:L,endTime:$,courtId:F,venueId:x}}),S={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:o,clearScheduleDates:n,periodLength:s,startTime:l,endTime:c,bookings:b,courts:f},{scheduleTimes:U}=PG(S),T=u?.length===1&&u[0]||p?.length===1&&p[0].venueId||void 0,D=w.map(yr);return{venueId:T,scheduleTimes:U,dateScheduledMatchUpIds:D}}function ppe(t){let e=He(t,[{[fn]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:s,courtId:o,drawId:l}=t,u=r[n];if(!u)return{error:Ie};let{drawDefinition:c,event:d}=sp({tournamentRecord:u,drawId:l});if(!c)return{error:$e};let p=hi({drawDefinition:c,event:d,matchUpId:s});if(p.error)return p;if(p?.matchUp?.matchUpType===Wa){let{itemValue:f}=Mf({timeItems:p.matchUp.timeItems??[],itemType:Nu}),h=o&&f.filter(m=>m.courtId!==o);return ka({duplicateValues:!1,removePriorValues:i,tournamentRecord:u,drawDefinition:c,matchUpId:s,timeItem:{itemType:Nu,itemValue:h}})}else return dg({tournamentRecord:u,drawDefinition:c,courtDayDate:a,courtId:"",matchUpId:s})}function fpe({scheduleCompletedMatchUps:t,minCourtGridRows:e=10,tournamentRecords:i,scheduledDate:r,matchUps:n}){if(!is(n))return{error:re};if(n.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:VM};let a=wT({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:e,tournamentRecords:i,matchUpFilters:{localPerspective:!0,scheduledDate:r}});if(a.error)return a;let{rows:s}=a,o=[],l=h=>[(h.sides||[]).map(m=>[m.participantId,m.participant?.individualParticipantIds]),(h.potentialParticipants||[]).flat().map(m=>[m.participantId,m.individualParticipantIds])].flat(1/0).filter(Boolean),u=s?.reduce((h,m)=>{let g=[],I=[];Object.values(m).forEach(w=>{if(Ut(w)&&(w.matchUpId&&(g.push(w.matchUpId),o.push(w)),w.sides)){let y=l(w);I.push(...y)}});let v=Object.values(m).filter(w=>Ut(w)&&!w.matchUpId&&!w.isBlocked);return h.concat({matchUpIds:g,availableCourts:v,rowId:m.rowId,participantIds:I})},[]);n.filter(({matchUpStatus:h})=>h&&h!=="BYE"&&(t||!Qi.includes(h))).sort(eg);let c=Io({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:i}).matchUpDependencies,d=[],p=[];for(;n.length&&u.length;){let h=u.shift(),m=[];for(;n.length&&h.availableCourts.length;){let g=n.concat(m).map(D=>D.matchUpId),I=n.shift(),v=I?.matchUpId,w=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),y=v&&g.some(D=>c[v].matchUpIds.includes(D)),b=v&&p.some(D=>c[v].dependentMatchUpIds.includes(D)),S=h.matchUpIds.some(D=>w.includes(D)),U=l(I),T=h.participantIds.some(D=>U.includes(D));if(I&&!S&&!y&&!T&&!b){let D=h.availableCourts.shift();Object.assign(I.schedule,D.schedule),Object.assign(D,I),d.push(I),h.participantIds.push(...U),h.matchUpIds.push(v)}else I&&m.push(I)}n.push(...m),p.push(...h.matchUpIds)}let f=d.map(({matchUpId:h,tournamentId:m,schedule:g,drawId:I})=>({tournamentId:m,matchUpId:h,drawId:I,schedule:{...g,scheduledDate:r}}));return a=ET({tournamentRecords:i,matchUpDetails:f}),{...a,scheduled:d,notScheduled:n}}function hpe(t){let{courtDayDate:e}=t,i=He(t,[{courtAssignments:!0,[Jn]:on,[Ya]:Je},{[fn]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,s)=>{let{tournamentId:o}=s;return a[o]||(a[o]=[]),a[o].push(s),a},{}),n;return Object.keys(r).every(a=>{let s=t[fn][a];if(!s)return n={error:Ie},!1;let o=r[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(o).every(l=>{let{drawDefinition:u}=Kn({tournamentRecord:s,drawId:l});return u?(o[l].every(c=>{let{matchUpId:d,courtId:p}=c,f=dg({tournamentRecord:s,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(f.success)return f?.success;n={error:Cre}}),!0):(n={error:$e},!1)})}),n||W}function mpe(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:o={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:f=30,scheduleDate:h,matchUpIds:m,venueIds:g,startTime:I,endTime:v,dryRun:w}=t,y=He(t,[{[fn]:!0,[NU]:!0},{[Yr]:kn,[Ya]:Yi,[T_e]:!0},{[Yr]:B=>!B||!isNaN(B),[R_e]:!1,[Ya]:re,[C_e]:!1,[M_e]:!1}]);if(y.error)return y;let b=t.competitionMatchUps??_o({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],S=t.matchUpDependencies??Io({includeParticipantDependencies:!0,matchUps:b,tournamentRecords:e}).matchUpDependencies;b.forEach(B=>{B.schedule?.scheduledDate&&Su(h,Ze(B.schedule.scheduledDate))&&WI({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:B})});let U=m.map(B=>b.find(G=>G.matchUpId===B)).filter(Boolean),{venueId:T,scheduleTimes:D,dateScheduledMatchUpIds:P}=iH({tournamentRecords:e,remainingScheduleTimes:d,startTime:fi(I),endTime:fi(v),scheduleDate:Ze(h),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:f,venueIds:g}),E={},R=[],C={},M={},N={};b.filter(({matchUpId:B})=>P?.includes(B)).forEach(B=>{NF({matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUp:B,value:1});let G=B.schedule?.scheduledTime;if(G){C[B.matchUpId]=G;let j=a?.[B.matchUpId];Ew({recoveryMinutes:j||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:S,scheduleTime:G,matchUp:B})}});let A=U.filter(B=>{let G=P?.includes(B.matchUpId),j=["BYE",Yt,xi,Ma,Ur,si].includes(B?.matchUpStatus);return!G&&!B.winningSide&&!j}),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:F}=A.reduce((B,G)=>{let{drawId:j,tournamentId:Y,matchUpType:K}=G,{participantIdsAtLimit:X,relevantParticipantIds:Z}=zG({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,matchUpDailyLimits:u,matchUp:G});return X?.length?(B.overLimitMatchUpIds.push(G.matchUpId),B.participantIdsAtLimit.push(...X),B):(Z.forEach(Q=>{DT({individualParticipantProfiles:o,participantId:Q});let ae=o[Q].counters;ae[K]?ae[K]+=1:ae[K]=1,ae[Ys]?ae[Ys]+=1:ae[Ys]=1}),B.matchUpMap[Y]||(B.matchUpMap[Y]={}),B.matchUpMap[Y][j]?B.matchUpMap[Y][j].push(G):B.matchUpMap[Y][j]=[G],WI({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:G}),B)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});A=A.filter(({matchUpId:B})=>!k.includes(B));let x=0,L=D?.length??0,{personRequests:$}=kf({tournamentRecords:e,requestType:PT});for(;D?.length&&A.length&&x<=L;){x++;let{scheduleTime:B}=D.shift(),G=A.find(j=>{let{matchUpId:Y}=j,{dependenciesScheduled:K,remainingDependencies:X}=GG({matchUpScheduleTimes:C,matchUpDependencies:S,allDateMatchUpIds:i,matchUp:j});if(!K)return N[Y]||(N[Y]=[]),N[Y].push({scheduleTime:B,remainingDependencies:X}),!1;let{enoughTime:Z}=WG({individualParticipantProfiles:o,matchUpNotBeforeTimes:l,matchUpDependencies:S,scheduleTime:B,matchUp:j});if(!Z)return M[Y]||(M[Y]=[]),M[Y].push({scheduleTime:B}),!1;let{conflicts:Q}=HG({potentials:c,averageMatchUpMinutes:r,requestConflicts:E,personRequests:$,scheduleTime:B,scheduleDate:h,matchUp:j});if(Q?.length)return!1;let ae=a?.[j.matchUpId];return Ew({recoveryMinutes:ae||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:S,scheduleTime:B,matchUp:j}),C[j.matchUpId]=B,!0});A=A.filter(({matchUpId:j})=>j!==G?.matchUpId),G||R.push(B)}A.forEach(B=>{NF({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,value:-1,matchUp:B})});let V=[];Object.keys(O).forEach(B=>{let G=e[B];G&&Object.keys(O[B]).forEach(j=>{let{drawDefinition:Y}=sp({tournamentRecord:G,drawId:j});Y&&O[B][j].forEach(({matchUpId:K})=>{let X=C[K];if(X){let Z=X.split(":").map(us).join(":"),Q=`${Ze(h)}T${Z}`;w?V.push(K):(op({drawDefinition:Y,matchUpId:K,scheduledTime:Q}).success&&V.push(K),T&&Iy({tournamentRecords:e,tournamentRecord:G,drawDefinition:Y,matchUpId:K,venueId:T}))}})})});let _=A2(A);return{...W,requestConflicts:Object.values(E),remainingScheduleTimes:D?.map(({scheduleTime:B})=>B),individualParticipantProfiles:o,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:R,overLimitMatchUpIds:k,scheduledMatchUpIds:V,noTimeMatchUpIds:_,recoveryTimeDeferred:M,dependencyDeferred:N}}function gpe({useDeepDependencies:t=!1,tournamentRecords:e,matchUps:i}){if(!is(i))return{error:Bu};if(i.some(({matchUpId:b,hasContext:S})=>b&&!S))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:VM};let r=Math.max(...i.map(({schedule:b})=>b?.courtOrder||1).map(b=>Ke(b))),n=Ce(1,r+1).map(b=>i.filter(S=>Ke(S.schedule?.courtOrder)===b)),a={},s={},o={};n.flat().filter(Boolean).sort(eg).forEach(({schedule:b})=>delete b[LD]);let l=lt(i.map(({drawId:b})=>b)),u=Io({includeParticipantDependencies:!0,tournamentRecords:e,drawIds:l}),c=u.matchUpDependencies,d=t?u.positionDependencies??{}:{},p=n.map((b,S)=>b.reduce((U,T)=>{if(!T.matchUpId)return U;let{matchUpId:D,winnerMatchUpId:P,loserMatchUpId:E,schedule:R,sides:C,potentialParticipants:M}=T,N=R?.courtId;a[D]=S,s[N]=[],U.matchUpIds.push(D),o[D]=T;let A=c[D].matchUpIds;A.length&&U.sourceMatchUpIds.push(...A);let O=C?.flatMap(F=>[F.participant?.individualParticipantIds,F.participantId]).flat().filter(Boolean)??[],k=M?.flat().flatMap(({individualParticipantIds:F,participantId:x})=>[F,x]).flat().filter(Boolean)||[];return U.participantIds.push(...k,...O),P&&U.targetMatchUpIds.push(P),E&&U.targetMatchUpIds.push(E),U},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),f=(b,S)=>c[b].sources.reduce((U,T,D)=>T.includes(S)&&D+1||U,0),h=p.map(()=>[]),m=(b,S,U)=>{U[b]||(U[b]={}),U[b][Hl]||(U[b][Hl]=S.filter(T=>T!==b))},g=(b,S,U)=>{S.participantIds.filter(T=>b.participantIds.includes(T)).forEach(T=>{let D=S.matchUpIds.concat(b.matchUpIds).filter(P=>c[P].participantIds.includes(T));D.forEach(P=>{m(P,D,U)})})},I=(b,S,U)=>{U[b]||(U[b]={}),U[b][Gl]||(U[b][Gl]=S.filter(T=>T!==b))},v=b=>{let S={},U=Ra(b.participantIds),T=new Set(Object.keys(U).filter(P=>U[P]>1)),D=b.matchUpIds.filter(P=>c[P].participantIds.some(E=>T.has(E)));return D.forEach(P=>{I(P,D,S)}),S},w=b=>{let S={},U={};return b.forEach(T=>{let{matchUpId:D,schedule:P}=T;if(!D||!P?.courtId||!P?.scheduledDate)return;let E=`${P.courtId}|${P.scheduledDate}`;U[E]||(U[E]=[]),U[E].push(D)}),Object.values(U).forEach(T=>{T.length>1&&T.forEach(D=>{S[D]=T.filter(P=>P!==D)})}),S},y=(b,S,U,T)=>{if(!o[b].schedule[LD]){o[b].schedule[LD]=S,o[b].schedule[hse]=T,h[a[b]].push({matchUpId:b,issueType:U,issueIds:T,issue:S});let D=o[b].schedule.courtId;s[D]||(s[D]=[]),s[D].push({matchUpId:b,issue:S,issueType:U,issueIds:T})}};if(p.forEach((b,S)=>{let U=S?p[S-1]:void 0,T=p.slice(S+1),D=v(b),P=w(n[S].filter(E=>b.matchUpIds.includes(E.matchUpId)));U&&g(U,b,D),b.matchUpIds.forEach(E=>{let R=c[E].matchUpIds;for(let M of T){let N=M.matchUpIds.filter(A=>R.includes(A));N?.length&&(N.forEach(A=>y(A,Ly,ss,[E])),y(E,Ly,ss,N))}if(P[E]&&y(E,Gl,pse,P[E]),D[E]?.[Gl]&&y(E,Gl,nF,D[E][Gl]),b.sourceMatchUpIds.includes(E)){let M=b.matchUpIds.filter(N=>c[N].matchUpIds.includes(E));y(E,Gl,ss,M),b.matchUpIds.filter(N=>c[N].matchUpIds.includes(E)).forEach(N=>y(N,Gl,ss,[E]))}let C=U?.matchUpIds?.filter(M=>f(E,M)>1);if(C?.length&&(y(E,_y,ss,C),C.forEach(M=>y(M,_y,ss,[E]))),D[E]?.[Hl]&&y(E,Hl,nF,D[E][Hl]),U?.targetMatchUpIds?.includes(E)){let M=o[E].schedule.courtId,N=R.filter(A=>U.matchUpIds.includes(A));N.some(A=>o[A].schedule.courtId===M)||(N.forEach(A=>y(A,Hl,ss,[E])),y(E,Hl,ss,N))}})}),t){let b=new Set(Object.keys(a)),S={};for(let D of b)S[D]=new Set(c[D]?.dependentMatchUpIds??[]);let U=0;for(let D of b){let P=c[D]?.sources?.length??0;P>U&&(U=P)}let T=D=>{let P=new Set(D.participantIds),E={};for(let R of D.matchUpIds){let C=c[R]?.participantIds??[];for(let M of C)P.has(M)||(E[M]||(E[M]=new Set),E[M].add(R))}return E};if(p.forEach((D,P)=>{let E=T(D);for(let[,R]of Object.entries(E))if(R.size>1){let C=[...R];for(let M of C)y(M,Hl,aF,C.filter(N=>N!==M))}if(P>0){let R=p[P-1],C=T(R);for(let[M,N]of Object.entries(E))if(C[M]){let A=[...new Set([...N,...C[M]])];for(let O of A)y(O,Hl,aF,A.filter(k=>k!==O))}}}),p.forEach((D,P)=>{for(let E of D.matchUpIds)for(let R=2;R<=Math.min(P,U);R++){let C=p[P-R];for(let M of C.matchUpIds){let N=f(E,M);N>0&&R<N&&(y(E,_y,ss,[M]),y(M,_y,ss,[E]))}}}),p.forEach((D,P)=>{for(let E of D.matchUpIds){let R=S[E];if(!R?.size)continue;for(let M=0;M<P;M++){let N=p[M].matchUpIds.filter(A=>R.has(A));if(N.length){for(let A of N)y(A,Ly,ss,[E]);y(E,Ly,ss,N)}}let C=D.matchUpIds.filter(M=>M!==E&&R.has(M));if(C.length){for(let M of C)y(M,Gl,ss,[E]);y(E,Gl,ss,C)}}}),Object.keys(d).length){let D=new Set(Object.values(d).flat());p.forEach(P=>{for(let E of P.matchUpIds){let R=(c[E]?.matchUpIds??[]).filter(C=>D.has(C)).filter(C=>!b.has(C));R.length&&y(E,Hl,fse,R)}})}}return{courtIssues:s,rowIssues:h}}function Ipe(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return q({result:{error:Ci},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return q({result:{error:Je},stack:e});let a=r?.length;if(!a)return{...W};let s=0;return r.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,f=u+(n?-1:1);f<0&&(f=a-1),f===a&&(f=0);let h=r[f].schedule.scheduledTime,m=o({tournamentId:c,scheduledTime:h,matchUpId:p,drawId:d});if(m.success)s++;else return m}),s===a?W:q({result:{error:Rre},stack:e});function o({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:f}=sp({tournamentRecord:p,drawId:d});return f?op({drawDefinition:f,scheduledTime:u,matchUpId:c}):{error:za}}}function vpe(t){let{scheduleChange:e,matchUpIds:i,dryRun:r}=t;if(!i||!Array.isArray(i))return{error:$m};if(typeof e!="object")return{error:re};let n=Ds(t),a=[],s=[];for(let l of Object.values(n)){let u=oYe({tournamentRecord:l,scheduleChange:e,matchUpIds:i,dryRun:r});if(u.error)return u;Array.isArray(u.notRescheduled)&&s.push(...u.notRescheduled);let c=A2(u.notRescheduled),d=[];u.rescheduled?.forEach(p=>{let{matchUpId:f}=p;c.includes(f)&&d.push(f),a.push(p)}),d.length&&(s=u?.notRescheduled?.filter(({matchUpId:p})=>!d.includes(p))||[])}let o=!!(a.length&&!s.length);return{...W,rescheduled:a,notRescheduled:s,allRescheduled:o}}function oYe({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){if(!t)return{error:Ie};if(!i||!Array.isArray(i))return{error:$m};if(typeof e!="object")return{error:re};let n=[],a=[],{minutesChange:s,daysChange:o}=e;if(!s&&!o)return{...W};if(s&&isNaN(s))return{error:re};if(o&&isNaN(o))return{error:re};let{matchUps:l}=Tr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:y})=>!Qi.includes(y),c=l?.filter(y=>bT({schedule:y.schedule})).filter(y=>u({matchUpStatus:y.matchUpStatus}));if(!c?.length)return{...W};let{tournamentInfo:d}=lg({tournamentRecord:t}),{startDate:p,endDate:f}=d,h=c?.reduce((y,b)=>{let{matchUpId:S,drawId:U}=b;return y[U]?y[U].push(S):y[U]=[S],y},{}),m=1440;for(let y of Object.keys(h)){let b=sp({tournamentRecord:t,drawId:y});if(b.error)return b;let S=b.drawDefinition,U=h[y].filter(T=>i.includes(T));for(let T of U)if(T&&S){let D=c.find(N=>N.matchUpId===T)?.schedule,{scheduledTime:P,scheduledDate:E}=D,R,C,M;if(!R&&o&&E){let N=Ze(E);M=Fy(N,o),R=new Date(M)<new Date(p)||new Date(M)>new Date(f)}if(s&&P){let N=Ze(P),A=Nt(fi(P))+s;if(R=A<0||A>m,!R){let O=aa(P,s),k=N&&M||E===N&&N;C=k?`${k}T${O}`:O}}if(R)a.push(T);else{if(!r){if(C){let N=op({scheduledTime:C,drawDefinition:S,matchUpId:T});if(N.error)return N}if(M){let N=RA({scheduledDate:M,drawDefinition:S,matchUpId:T});if(N.error)return N}}(C||M)&&n.push(T)}}}let g=Tr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],I=g.filter(({matchUpId:y})=>n.includes(y)),v=g.filter(({matchUpId:y})=>a.includes(y)),w=I.length&&!v.length;return{...W,rescheduled:I,notRescheduled:v,allRescheduled:w}}function ype(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Ci};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:s,courtDayDate:o}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=r||{},{drawId:d,matchUpId:p,tournamentId:f}=n||{};if(!u&&!p)return q({result:{error:Je},stack:e});let{matchUps:h}=_o({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=h?.find(({matchUpId:y})=>y===u),g=h?.find(({matchUpId:y})=>y===p),I=0;if(s&&u&&!p){let y=v({tournamentId:c,matchUpId:u,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y?.success&&I++,y.error)return q({result:y,stack:e})}else if(a&&s&&u&&p){let y=v({tournamentId:c,matchUpId:u,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y.success&&I++,y.error)return q({result:y,stack:e,info:"source"});let b=v({tournamentId:f,sourceCourtId:s,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:o});if(b.success&&I++,b.error)return q({result:b,stack:e,info:"target"})}else return{error:Je};return I?W:q({result:{error:Hv},stack:e});function v(y){let{tournamentRecords:b,tournamentId:S,matchUp:U,drawId:T}=y,D=b[S],{drawDefinition:P}=sp({tournamentRecord:D,drawId:T});return U.matchUpType===ti?w({...y,tournamentRecord:D,drawDefinition:P}):dg({...y,tournamentRecord:D,drawDefinition:P})}function w({removePriorValues:y,tournamentRecords:b,tournamentRecord:S,drawDefinition:U,sourceCourtId:T,courtDayDate:D,matchUpId:P,matchUp:E,courtId:R}){let C=[R].concat(E.schedule.allocatedCourts.map(({courtId:M})=>M).filter(M=>M!==T));return CA({removePriorValues:y,tournamentRecords:b,tournamentRecord:S,drawDefinition:U,courtDayDate:D,matchUpId:P,courtIds:C})}}function bpe({scheduleAttributes:t=[Nu,kd,Xm,Jm,Qm,Uo,Oc,au,uc],tournamentRecord:e,drawDefinition:i,matchUpId:r}){let n="clearMatchUpSchedule",a=i?xn({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps?.[0]:Tr({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps?.[0];if(!a)return{error:pn};let s=(a.timeItems??[]).filter(o=>o?.itemType&&!t.includes(o?.itemType));return a.timeItems=s,Dt({tournamentId:e.tournamentId,context:n,drawDefinition:i,matchUp:a}),{...W}}function wpe(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:Ci};if(typeof r!="object")return{error:zc};let a=Object.keys(n).filter(s=>!i||i===s);if(i&&!a.includes(i))return{error:re};for(let s of a){let o=n[s],l=It({extension:{name:kU,value:{dailyLimits:r}},element:o});if(l.error)return l}return{...W}}function Spe(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,bookingType:n,courtOrder:a,rowCount:s=1,courtId:o,notes:l}=t;if(!e)return q({result:{error:re},info:"tournamentRecord is required"});if(!o)return{error:Dc};if(!r)return q({result:{error:re},info:"scheduledDate is required"});if(!n)return q({result:{error:re},info:"bookingType is required"});if(a==null)return q({result:{error:re},info:"courtOrder is required"});if(!Number.isInteger(a)||a<1)return q({result:{error:re},info:"courtOrder must be a positive integer"});if(!Number.isInteger(s)||s<1)return q({result:{error:re},info:"rowCount must be a positive integer"});let{court:u,venue:c}=ap({tournamentRecord:e,courtId:o});if(!u)return{error:Dc};if(!Fd({court:u,date:r})){u.dateAvailability||(u.dateAvailability=[]);let f={date:r,bookings:[]};u.dateAvailability.push(f)}let d=Fd({court:u,date:r});if(d.bookings){for(let f of d.bookings)if(typeof f.courtOrder=="number"){let h=f.courtOrder,m=h+(f.rowCount||1)-1,g=a,I=a+s-1;if(g<=m&&I>=h)return q({result:{error:wre},info:`Booking conflicts with existing booking at rows ${h}-${m}`})}}let p={courtOrder:a,rowCount:s,bookingType:n,notes:l,createdAt:new Date().toISOString()};return d.bookings||(d.bookings=[]),d.bookings.push(p),!i&&c&&at({payload:{venue:c,tournamentId:e.tournamentId},topic:Yc,key:c.venueId}),{...W,booking:p}}function Upe(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,courtOrder:n,courtId:a}=t;if(!e)return q({result:{error:re},info:"tournamentRecord is required"});if(!a)return{error:Dc};if(!r)return q({result:{error:re},info:"scheduledDate is required"});if(n==null)return q({result:{error:re},info:"courtOrder is required"});let{court:s,venue:o}=ap({tournamentRecord:e,courtId:a});if(!s)return{error:Dc};let l=Fd({court:s,date:r});if(!l?.bookings)return q({result:{error:Hx},info:"No bookings found for this date"});let u=l.bookings.findIndex(d=>d.courtOrder===n);if(u===-1)return q({result:{error:Hx},info:`No booking found at row ${n}`});let c=l.bookings.splice(u,1)[0];return!i&&o&&at({payload:{venue:o,tournamentId:e.tournamentId},topic:Yc,key:o.venueId}),{...W,booking:c}}var Tpe={};ft(Tpe,{addCollectionDefinition:()=>aH,addCollectionGroup:()=>Mpe,aggregateTieFormats:()=>Ape,compareTieFormats:()=>xc,getTieFormat:()=>lA,modifyCollectionDefinition:()=>rH,modifyTieFormat:()=>Npe,mutate:()=>Dpe,orderCollectionDefinitions:()=>Rpe,query:()=>Fue,removeCollectionDefinition:()=>nH,removeCollectionGroup:()=>Epe,tieFormatGenderValidityCheck:()=>YM,validateCollectionDefinition:()=>DU});var Dpe={};ft(Dpe,{addCollectionDefinition:()=>aH,addCollectionGroup:()=>Mpe,aggregateTieFormats:()=>Ape,modifyCollectionDefinition:()=>rH,modifyTieFormat:()=>Npe,orderCollectionDefinitions:()=>Rpe,removeCollectionDefinition:()=>nH,removeCollectionGroup:()=>Epe});function nf({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:s}){let o="getTieFormat",l;if(e=r?.structureId??e,i=n?.matchUpId??i,(i||e)&&!t)return{error:$e};if(a&&s)l=Yo(s);else if(i){if(t&&(!n||!r)){let u=hi({drawDefinition:t,matchUpId:i});if(u.error)return u;if(u.matchUp?.matchUpType!==Wa)return q({result:{error:fa},stack:o});r||(r=u.structure),n||(n=u.matchUp)}l=fb({item:n,drawDefinition:t,structure:r,event:s})||fb({item:r,drawDefinition:t,structure:r,event:s})||Yo(t)||Yo(s)}else if(t&&e){if(!r){let u=tt({drawDefinition:t,structureId:e});if(u.error)return u;r=u?.structure}l=fb({item:r,drawDefinition:t,structure:r,event:s})||Yo(t)||Yo(s)}else l=Yo(t)||Yo(s);return l?{...W,structure:r,tieFormat:l,matchUp:n}:q({result:{error:jv},stack:o})}function LE({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![Qi].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==ho&&!hr(t))}function Jk({from:t,to:e}){let i=Object.keys(t),r=_i(i,Object.keys(e)).length===i.length,n=i.filter(s=>t[s]!==e[s]).map(s=>({countChange:e[s]-t[s],collectionId:s})),a=i.every(s=>t[s]===e[s]);return{equivalent:r&&a,matchUpsCountChanges:n}}function lYe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:s,event:o,uuids:l}){let u="updateTieFormat",c=e?.tournamentId,d=0,p=0,f=0,h=0,m=n?.collectionDefinitions.reduce((S,U)=>(S[U.collectionId]=(S[U.collectionId]||0)+U.matchUpCount,S),{}),g=({tieFormat:S})=>{let U=S?.collectionDefinitions.reduce((T,D)=>(T[D.collectionId]=(T[D.collectionId]||0)+D.matchUpCount,T),{});return Jk({from:U,to:m}).equivalent},I=nf({drawDefinition:i})?.tieFormat,v=nf({event:o})?.tieFormat;if(o&&a){for(let S of o.drawDefinitions??[])w({drawDefinition:S});o.tieFormat=zr(n),h+=1}else if(s){if(!s.tieMatchUps)return q({result:{error:fa},stack:u});let S=Ra(s.tieMatchUps?.map(({collectionId:E})=>E)),U=Jk({to:m,from:S}),{changes:T,changesArePossible:D,cannotChangeReaon:P}=K3({matchUp:s,check:U});if(U.equivalent)if(LE({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=zr(n),h+=1;else return q({result:{error:VB},info:"matchUp is IN_PROGRESS or COMPLETE",stack:u});else if(D)b({tieFormat:n,matchUp:s,changes:T,uuids:l});else return q({context:{collectionMap:m,matchUpMap:S},result:{error:iu},info:P||"specified changes not possible",stack:u});p+=1,Dt({eventId:o?.eventId,context:u,drawDefinition:i,tournamentId:c,matchUp:s})}else if(r){let S=y({inheritedTieFormat:I??v,structure:r})?.modifiedMatchUpsCount;S&&(p+=S,d+=1,h+=1);let U=!r.tieFormat||xc({ancestor:r.tieFormat,descendant:n}).different;U&&(r.tieFormat=zr(n),d+=1,h+=1),(S||U)&&i&&ri({structureIds:[r.structureId],eventId:o?.eventId,drawDefinition:i})}else if(i)w({drawDefinition:i}),i.tieFormat=zr(n),h+=1;else return{error:$e};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:f,modifiedCount:h,...W,tieFormat:n};function w({drawDefinition:S}){let U=S.structures||[],T=[];for(let D of U){if(D.tieFormat)continue;let P=y({inheritedTieFormat:v,structure:D})?.modifiedMatchUpsCount;if(P){d+=1,p+=P;let E=D.structureId;T.push(E)}}return ri({structureIds:T,eventId:o?.eventId,drawDefinition:S}),T.length}function y({inheritedTieFormat:S,structure:U}){let T=0,D=Ot({matchUpFilters:{matchUpTypes:[ti]},structure:U})?.matchUps||[];for(let P of D){let E=LE({matchUp:P,updateInProgressMatchUps:t}),R=!1,C=Ra(P.tieMatchUps?.map(({collectionId:N})=>N)),M=Jk({from:C,to:m});if(M.equivalent)P.tieFormat&&g(P)&&E&&(P.tieFormat=zr(n),R=!0);else{let{changes:N,changesArePossible:A}=K3({matchUp:P,check:M});if(A&&!P.tieFormat)b({changes:N,matchUp:P,tieFormat:n,uuids:l});else if(S)(!P.tieFormat||xc({ancestor:S,descendant:P.tieFormat}).different)&&(P.tieFormat=S,R=!0);else return q({result:{error:jv},stack:u})}R&&(T+=1,Dt({tournamentId:e?.tournamentId,drawDefinition:i,context:u,eventId:a,matchUp:P}))}return{modifiedMatchUpsCount:T}}function b({uuids:S,matchUp:U,tieFormat:T,changes:D}){U.tieFormat=zr(T);let P=[],E=[];return D.forEach(R=>{if(R.countChange>0){let C=Math.max(0,...U.tieMatchUps.filter(A=>A.collectionId===R.collectionId).map(Aa("collectionPosition"))),M=T.collectionDefinitions.find(A=>A.collectionId===R.collectionId),N=oT({matchUpsLimit:R.countChange,collectionPositionOffset:C,collectionDefinition:M,matchUp:U,uuids:S});E.push(...xe(N,!1,!0)),f+=E.length,U.tieMatchUps.push(...N)}else{let C=R.toBePlayedTieMatchUpIds.slice(0,Math.abs(R.countChange));console.log("remove",C.length),P.push(...C),U.tieMatchUps=U.tieMatchUps.filter(({matchUpId:M})=>!C.includes(M))}}),E.length&&Nd({matchUps:E,drawDefinition:i,tournamentId:c,eventId:a}),P.length&&ju({matchUpIds:P,action:"updateTieFormat",drawDefinition:i,tournamentId:c,eventId:a}),{matchUpIdsRemoved:P,matchUpsAdded:E}}}function K3({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let s=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===$i).map(Aa("matchUpId")),o=s.length+a>=0||a>0;return!o&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:s,collectionId:n,countChange:a}),o}),changes:r,cannotChangeReaon:i}}function _A({appliedPolicies:t,drawDefinition:e,auditData:i}){if(!t?.audit?.[db])return;let{extension:r}=rt({name:db,element:e}),n={value:Array.isArray(r?.value)?r?.value.concat(i):[i],name:db};It({element:e,extension:n})}function rH({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:s,matchUpCount:o,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:f,gender:h,event:m,collectionValueProfiles:g,collectionValue:I,matchUpValue:v,scoreValue:w,setValue:y}){let b="modifyCollectionDefinition";if(s&&!qa({matchUpFormat:s}))return q({result:{error:re},context:{matchUpFormat:s},stack:b});if(r&&typeof r!="string")return q({result:{error:re},context:{collectionName:r},stack:b});if(h&&!Object.values(s2).includes(h))return q({result:{error:re},context:{gender:h},stack:b});if(p&&typeof p!="object")return q({result:{error:re},context:{category:p},stack:b});let S={collectionValueProfiles:g,collectionValue:I,matchUpValue:v,scoreValue:w,setValue:y};if(!Object.values(S).filter(Boolean).length&&!i&&!r&&!s&&!o&&!u)return q({result:{error:Je},stack:b});if(Object.values(S).filter(Boolean).length>1)return q({info:"Only one value assignment allowed per collectionDefinition",result:{error:re},stack:b});let U=nf({drawDefinition:a,structureId:c,matchUpId:d,eventId:f,event:m});if(U.error)return q({result:U,stack:b});let{matchUp:T,structure:D,tieFormat:P}=U,E=zr(P),R=P?.collectionDefinitions.find(V=>V.collectionId===l),C=E?.collectionDefinitions.find(V=>V.collectionId===l);if(!R)return q({info:"source collectionDefinition",result:{error:Gr},context:{collectionId:l},stack:b});let M=I??v??w??y;if(g?.length){let V=Uie({matchUpCount:o??R?.matchUpCount??0,collectionValueProfiles:g});if(V.errors)return q({result:{error:re},info:V.errors,stack:b})}else if(M&&!ct(M))return q({result:{error:re},info:"value is not an integer",context:{value:M},stack:b});let N=(V,_)=>_i(Object.keys(V),Object.keys(_)).length===Object.keys(V).length&&_i(Object.values(V),Object.values(_)).length===Object.values(V).length,A=g&&(!R.collectionValueProfiles||!N(R.collectionValueProfiles,g)),O=ct(I)&&R.collectionValue!==I||ct(v)&&R.matchUpValue!==v||ct(w)&&R.scoreValue!==w||ct(y)&&R.setValue!==y||A,k=[];if(O&&(C.collectionValueProfiles=void 0,C.collectionValue=void 0,C.matchUpValue=void 0,C.scoreValue=void 0,C.setValue=void 0,Object.assign(C,S),k.push({collectionId:l,...je(S)})),(ct(w)||ct(y))&&C.collectionGroupNumber){let V=C.collectionGroupNumber;E.collectionDefinitions=E.collectionDefinitions.map(_=>{let{collectionGroupNumber:B,...G}=_;return B===V?G:_}),E.collectionGroups=E.collectionGroups.filter(({groupNumber:_})=>_!==V),k.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:F,valueGoal:x}=cg(E),L=je({aggregateValue:F,valueGoal:x});if((L.aggregateValue!==P?.winCriteria.aggregateValue||L.valueGoal!==P?.winCriteria.valueGoal)&&(E.winCriteria=L,k.push({collectionId:l,winCriteria:L})),ct(i)&&R.collectionOrder!==i&&(C.collectionOrder=i,k.push({collectionId:l,collectionOrder:i})),r&&R.collectionName!==r&&(C.collectionName=r,k.push({collectionId:l,collectionName:r})),s&&R.matchUpFormat!==s&&(C.matchUpFormat=s,k.push({collectionId:l,matchUpFormat:s})),ct(o)&&R.matchUpCount!==o&&(C.matchUpCount=o,k.push({collectionId:l,matchUpCount:o})),u&&R.matchUpType!==u)return q({result:{error:QB},context:{matchUpType:u},stack:b});p&&R.category!==p&&(C.category=p,k.push({collectionId:l,category:p})),h&&R.gender!==h&&(C.gender=h,k.push({collectionId:l,gender:h}));let $=je(E);if(U=qn({tieFormat:$}),U.error)return q({result:U,stack:b});if(!k.length)return q({result:{...W,modifications:k}});if(P?.tieFormatName!==n?($.tieFormatName=n,k.push({tieFormatName:n})):k.length&&(delete $.tieFormatName,k.push("tieFormatName removed: modifications without new tieFormatName")),U=lYe({tieFormat:$,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:D,eventId:f,matchUp:T,event:m}),!U.error){let{appliedPolicies:V}=Ct({tournamentRecord:e}),_=je({collectionDefinition:C,drawId:a?.drawId,action:b,structureId:c,matchUpId:d,eventId:f});_A({appliedPolicies:V,drawDefinition:a,auditData:_})}return q({result:{...U,modifications:k},stack:b})}function uYe({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){let s=[];return n&&a?s=[a]:i&&r?s=Ot({matchUpFilters:{matchUpTypes:[ti]},structure:r})?.matchUps??[]:e&&(s=xn({matchUpFilters:{matchUpTypes:[ti]},drawDefinition:e})?.matchUps??[]),{targetMatchUps:s.filter(o=>!o.winningSide&&o.matchUpStatus!==xi&&(t||o.matchUpStatus!==ho&&!hr(o)))}}function cYe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let s of r){let o=!!s.tieFormat;o&&(s.tieFormat=zr(n));let l;if(t){let u=Ct({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=Jc({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}o&&!l&&Dt({tournamentId:e?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:s,drawDefinition:i})}return{...W}}function Ppe({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:s,structure:o,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:f,valueGoal:h}=cg(l);l.winCriteria=je({aggregateValue:f,valueGoal:h}),(e&&e!==h||f&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:m}=uYe({updateInProgressMatchUps:t,drawDefinition:a,structureId:s,structure:o,matchUpId:u,matchUp:c});cYe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let g=je(l),I=qn({tieFormat:g});if(I.error)return I;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(o)o.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:$e};return ri({drawDefinition:a,eventId:p?.eventId}),{...W}}function Epe({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:s,matchUp:o,eventId:l,event:u}){if(!e)return{error:Je};if(isNaN(e))return{error:re};let c="removeCollectionGroup",d=o?void 0:nf({drawDefinition:r,structureId:a,matchUpId:s,eventId:l,event:u});if(d?.error)return q({result:d,stack:c});let p=d?.structure;o=o??d?.matchUp;let f=d?.tieFormat,h=f?.winCriteria.valueGoal,m=f?.winCriteria.aggregateValue,g=zr(f);if(d=qn({tieFormat:g}),d.error)return q({result:d,stack:c});let I=[];if(g.collectionDefinitions=g.collectionDefinitions.map(v=>{let{collectionGroupNumber:w,...y}=v;return w!==e?v:(I.push(v.collectionId),y)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:v})=>v!==e),d=Ppe({updateInProgressMatchUps:t,originalValueGoal:h,wasAggregateValue:m,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:s,matchUp:o,eventId:l,event:u}),!d.error){let{appliedPolicies:v}=Ct({tournamentRecord:i}),w=je({drawId:r?.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:s,eventId:l});_A({appliedPolicies:v,drawDefinition:r,auditData:w})}return q({result:{...d,modifiedCollectionIds:I},stack:c})}function qI({tieFormat:t,orderMap:e}){let i=zr(t);return i.collectionDefinitions?.forEach(r=>{let n=e[r.collectionId];n&&(r.collectionOrder=n)}),i.collectionDefinitions?.sort((r,n)=>PI(r.collectionOrder)-PI(n.collectionOrder)),i}function Rpe({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:s,event:o}){if(typeof n!="object"||!Object.values(n).every(c=>ct(c)))return q({result:{error:re},context:{orderMap:n}});let l=i?tt({drawDefinition:e,structureId:i}):void 0;if(l?.error)return l;let u=l?.structure;if(a&&o?.tieFormat)X3({tournamentRecord:t,event:o,orderMap:n});else if(r){let c=e&&hi({drawDefinition:e,matchUpId:r});if(c?.error)return c;if(s=c.matchUp,!s)return{error:pa};let d=lA({tournamentRecord:t,matchUpId:r,structure:u,drawDefinition:e,event:o})?.tieFormat;s.tieFormat=qI({tieFormat:d,orderMap:n}),Dt({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:e,matchUp:s})}else if(i)if(u?.tieFormat)u.tieFormat=qI({tieFormat:u.tieFormat,orderMap:n}),Cpe({eventId:o?.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:n}),ri({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)kF({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else if(o?.tieFormat)X3({structureIds:[i],tournamentRecord:t,orderMap:n,event:o});else return{error:Gr};else if(e?.tieFormat)kF({tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else return{error:Gr};return{...W}}function X3({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=qI({tieFormat:r.tieFormat,orderMap:i});e?.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])kF({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function kF({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??n?.tieFormat,s=qI({tieFormat:a,orderMap:r});i?.length||(e.tieFormat=s);let o=[];for(let l of e.structures??[])i?.length&&!i.includes(l.structureId)||((l.tieFormat||i?.includes(l.structureId))&&(l.tieFormat=qI({tieFormat:l.tieFormat??e.tieFormat??n?.tieFormat,orderMap:r})),Cpe({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),o.push(l.structureId));ri({drawDefinition:e,structureIds:o})}function Cpe({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){let a=Ot({matchUpFilters:{matchUpTypes:[ti]},structure:i})?.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=qI({tieFormat:s.tieFormat,orderMap:r}),Dt({tournamentId:t?.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function nH({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:s,matchUpId:o,eventId:l,matchUp:u,event:c}){let d="removeCollectionDefinition",p=u?void 0:nf({drawDefinition:r,structureId:s,matchUpId:o,eventId:l,event:c});if(p?.error)return q({result:p,stack:d});let f=p?.structure;u=u??p?.matchUp;let h=p?.tieFormat,m=zr(h);if(p=qn({tieFormat:m}),p.error)return q({result:p,stack:d});let g=m?.collectionDefinitions?.find(E=>E.collectionId===a);if(!g)return q({result:{error:Gr,collectionId:a}});m.collectionDefinitions=m.collectionDefinitions.filter(E=>E.collectionId!==a),g.collectionGroupNumber&&(m.collectionDefinitions=m.collectionDefinitions.map(E=>{let{collectionGroupNumber:R,...C}=E;return C}),m.collectionGroups=m.collectionGroups.filter(({groupNumber:E})=>E!==g.collectionGroupNumber));let{aggregateValue:I,valueGoal:v}=cg(m);m.winCriteria=je({aggregateValue:I,valueGoal:v});let w=h?.winCriteria.valueGoal,y=h?.winCriteria.aggregateValue;(w&&w!==v||I&&!y)&&(n?m.tieFormatName=n:delete m.tieFormatName);let b=[];o&&u?b=[u]:s&&f?b=Ot({matchUpFilters:{matchUpTypes:[ti]},structure:f})?.matchUps??[]:r?b=xn({matchUpFilters:{matchUpTypes:[ti]},drawDefinition:r})?.matchUps??[]:c&&(b=Gu({matchUpFilters:{matchUpTypes:[ti]}})?.matchUps??[]);let S=(b||[]).filter(E=>{let R=E.tieMatchUps?.filter(M=>M.collectionId===a)?.some(hr),C=e&&E.tieFormat?xc({descendant:E.tieFormat,ancestor:m})?.different:!1;return t&&!R||!E.winningSide&&E.matchUpStatus!==xi&&(t||E.matchUpStatus!==ho&&!hr(E)&&!C)});if(!S.length)return{error:Hv};let{appliedPolicies:U}=Ct({tournamentRecord:i});if(o&&u&&t){let E=u.tieMatchUps?.filter(R=>R.collectionId===a);for(let R of E??[]){let C=Of({matchUpId:R.matchUpId,tieMatchUpId:u?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(C.error||(C=hi({drawDefinition:r,matchUpId:o}),C.error))return C;u=C?.matchUp}}let T=[];for(let E of S){for(let R of E?.sides??[])R.lineUp=(R.lineUp??[]).map(C=>({participantId:C.participantId,collectionAssignments:(C?.collectionAssignments??[]).filter(M=>M.collectionId!==a)}));if(E.tieMatchUps=(E.tieMatchUps??[]).filter(R=>{let C=R.collectionId===a;return C&&T.push(R.matchUpId),!C}),E.tieFormat&&(E.tieFormat=zr(m)),t){let R=Jc({matchUpId:E.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(R.error)return R}Dt({tournamentId:i?.tournamentId,eventId:c?.eventId,drawDefinition:r,context:d,matchUp:E})}T.length&&ju({tournamentId:i?.tournamentId,matchUpIds:T,eventId:c?.eventId,drawDefinition:r});let D=je(m);if(p=qn({tieFormat:D}),p.error)return q({result:p,stack:d});if(l&&c)c.tieFormat=D;else if(o&&u)u.tieFormat=D;else if(f)f.tieFormat=D;else if(r)r.tieFormat=D;else if(!u||!r)return{error:$e};ri({drawDefinition:r,eventId:c?.eventId});let P=je({drawId:r?.drawId,action:d,collectionId:a,structureId:s,matchUpId:o,eventId:l});return _A({appliedPolicies:U,drawDefinition:r,auditData:P}),{tieFormat:D,deletedMatchUpIds:T,targetMatchUps:S,...W}}function Mpe({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:s,matchUpId:o,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(n))return q({result:{error:Je},stack:d});let p=l?void 0:nf({drawDefinition:r,structureId:s,matchUpId:o,eventId:u,event:c});if(p?.error)return q({result:p,stack:d});let f=p?.structure;l=l||p?.matchUp;let h=p?.tieFormat,m=h?.winCriteria.valueGoal,g=zr(h);if(p=qn({tieFormat:g}),p.error)return q({result:p,stack:d});for(let v of g.collectionDefinitions){let{collectionId:w,collectionGroupNumber:y}=v;if(y&&n.includes(w))return q({info:"collectionIds cannot be part of other collectionGroups",result:{error:re},stack:d})}let I=(g.collectionGroups||[]).reduce((v,w)=>w.groupNumber>v?w.groupNumber:v,0)+1;return i.groupNumber=I,g.collectionDefinitions=g.collectionDefinitions.map(v=>n.includes(v.collectionId)?{...v,collectionGroupNumber:I}:v),g.collectionGroups=[...g.collecitonGroups||[],i],Ppe({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:s,structure:f,tieFormat:g,matchUpId:o,matchUp:l,eventId:u,event:c})}function aH({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:s,drawDefinition:o,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:f,uuids:h,event:m}){let g="addCollectionDefinition",I=Ct({tournamentRecord:r,drawDefinition:o,event:m}).appliedPolicies??{},v=n?.[Nr]??I?.[Nr];a=a??v?.participants?.enforceCategory;let w=(u??v?.participants?.enforceGender)!==!1,y=!!((i??m?.category)&&a!==!1),b=!!((s??m?.gender)&&w),S=DU({referenceCategory:i??m?.category,collectionDefinition:e,referenceGender:s,checkCategory:y,checkGender:b,event:m});if(S.error)return q({result:S,stack:g});let U=p?.tieFormat?void 0:nf({drawDefinition:o,structureId:c,matchUpId:d,eventId:f,event:m});if(U?.error)return q({result:{error:U.error},stack:g});let T=U?.structure;p=p??U?.matchUp;let D=p?.tieFormat??U?.tieFormat,P=zr(D);if(U=qn({tieFormat:P}),U?.error)return q({result:{error:U.error},stack:g});if(!e.collectionId)e.collectionId=Et();else if(P.collectionDefinitions.map(({collectionId:x})=>x).includes(e.collectionId))return q({context:{collectionId:e.collectionId},result:{error:Are}});P.collectionDefinitions.push(e),P.collectionDefinitions.sort((x,L)=>(x.collectionOrder||0)-(L.collectionOrder||0)).forEach((x,L)=>x.collectionOrder=L+1);let{aggregateValue:E,valueGoal:R}=cg(P);P.winCriteria=je({aggregateValue:E,valueGoal:R});let C=D?.winCriteria.valueGoal,M=D?.winCriteria.aggregateValue;(C&&C!==R||E&&!M)&&(l?P.tieFormatName=l:delete P.tieFormatName);let N=[],A=[],O=[],k=je(P);if(U=qn({tieFormat:k}),U?.error)return q({result:{error:U.error},stack:g});if(f&&m){m.tieFormat=k;for(let x of m.drawDefinitions??[])if(!x.tieFormat)for(let L of x.structures??[]){if(L.tieFormat)continue;let $=Qk({updateInProgressMatchUps:t,collectionDefinition:e,structure:L,uuids:h});A.push(...$.newMatchUps),O.push(...$.targetMatchUps),N.push(L.structureId)}ZT({modifiedMatchUps:O,eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(c&&T){T.tieFormat=k;let x=Qk({updateInProgressMatchUps:t,collectionDefinition:e,structure:T,uuids:h});A.push(...x.newMatchUps),O=x.targetMatchUps,ZT({modifiedMatchUps:O,eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(d&&p){if(!LE({matchUp:p,updateInProgressMatchUps:t}))return q({result:{error:VB},stack:g});p.tieFormat=k;let x=oT({collectionDefinition:e,matchUp:p,uuids:h});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...x),A.push(...x),ZT({modifiedMatchUps:[p],eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(o){o.tieFormat=k;for(let x of o.structures??[]){let L=Qk({updateInProgressMatchUps:t,collectionDefinition:e,structure:x,uuids:h});N.push(x.structureId),A.push(...L.newMatchUps),O.push(...L.targetMatchUps)}ZT({modifiedMatchUps:O,eventId:m?.eventId,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else return{error:$e};let F=je({drawId:o?.drawId,collectionDefinition:e,action:g,structureId:c,matchUpId:d,eventId:f});return _A({appliedPolicies:I,drawDefinition:o,auditData:F}),{tieFormat:k,targetMatchUps:O,addedMatchUps:A,...W}}function Qk({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){let n=[],a=(Ot({matchUpFilters:{matchUpTypes:[ti]},structure:i})?.matchUps).filter(s=>LE({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let o=oT({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...o),n.push(...o)}return{newMatchUps:n,targetMatchUps:a}}function ZT({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:s}){Nd({tournamentId:e?.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i?.forEach(o=>{Dt({tournamentId:e?.tournamentId,drawDefinition:r,context:s,matchUp:o,eventId:a})}),ri({structureIds:t,drawDefinition:r,eventId:a})}function Npe({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!qn({tieFormat:i}).valid)return q({result:{error:iu},info:"falied validation",stack:d});let p=nf({drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(p.error)return q({result:p,stack:d});let{matchUp:f,tieFormat:h}=p,m=zr(h),g=xc({descendant:i,ancestor:m,considerations:n});if(g.invalid)return q({context:{invalid:g.invalid},result:{error:iu},stack:d});if(!g?.different)return q({result:{...W},info:"Nothing to do",stack:d});let I=m.collectionDefinitions.map(({collectionId:D})=>D),v=i.collectionDefinitions.map(({collectionId:D})=>D),w=I.filter(D=>!v.includes(D)),y=i.collectionDefinitions.filter(({collectionId:D})=>!I.includes(D)),b=y.map(Aa("collectionId")),S=[],U,T=i.tieFormatName;for(let D of i.collectionDefinitions){if(b.includes(D.collectionId))continue;let P=rH({updateInProgressMatchUps:t,...D,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(P.modifications&&S.push(...P.modifications),P.error)return q({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of y){let P=aH({updateInProgressMatchUps:t,collectionDefinition:D,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:s,matchUpId:o,matchUp:f,eventId:l,uuids:u,event:c});if(P.error)return q({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of w){let P=nH({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:D,structureId:s,matchUpId:o,eventId:l,matchUp:f,event:c});if(P.error)return q({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}return h?.tieFormatName!==T?(U.tieFormatName=T,S.push({tieFormatName:T})):(S.length||b.length||w.length)&&(delete U.tieFormatName,S.push("tieFormatName removed: modifications without new tieFormatName")),U.collectionDefinitions=U.collectionDefinitions.sort((D,P)=>PI(D.collectionOrder)-PI(P.collectionOrder)).map((D,P)=>({...D,collectionOrder:P+1})),{processedTieFormat:zr(U),modifications:S,...W}}function Ape({tournamentRecord:t}){if(!t)return{error:Ie};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=u=>{if(!u.tieFormat)return;let c;for(let d of r)xc({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);if(c)u.tieFormatId=c,delete u.tieFormat;else{let d=xe(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Et()),u.tieFormatId=d.tieFormatId,delete u.tieFormat,r.push(d),e+=1}};i.eventType,n({tieFormat:i.tieFormat});for(let u of i.drawDefinitions??[]){n({tieFormat:u.tieFormat});for(let c of u.structures??[])n({tieFormat:c.tieFormat})}let a=(u,c)=>{let d=o.matchUps?.find(p=>p.matchUpId===u);d&&(d.tieFormatId=c,delete d.tieFormat,Dt({tournamentId:t?.tournamentId,eventId:i.eventId,matchUp:d}))},s=u=>{let c=xe(u.tieFormat,void 0,!0);c.tieFormatId||(c.tieFormatId=Et()),r.push(c),e+=1,a(u.matchUpId,c.tieFormatId)},o=Gu({matchUpFilters:{matchUpTypes:[Wa]},event:i}),l=o.matchUps??[];for(let u of l){let c;for(let d of r)u.tieFormat&&xc({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);c?a(u.matchUpId,c):s(u)}r.length&&(i.tieFormats=r)}return{...W,addedCount:e}}var kpe={};ft(kpe,{addDrawDefinitionExtension:()=>lN,addEventExtension:()=>ep,addEventTimeItem:()=>og,addExtension:()=>It,addMutationLock:()=>_pe,addNotes:()=>LN,addOnlineResource:()=>jpe,addParticipantExtension:()=>pae,addParticipantTimeItem:()=>KV,addTimeItem:()=>Ll,addTournamentExtension:()=>R2,addTournamentTimeItem:()=>dT,analyzeDraws:()=>pT,analyzeTournament:()=>Wj,cleanExpiredMutationLocks:()=>Vj,copyTournamentRecord:()=>xpe,createTournamentRecord:()=>xA,generate:()=>Ope,getAggregateTeamResults:()=>Hj,getAllowedDrawTypes:()=>aA,getAllowedMatchUpFormats:()=>Bj,getAppliedPolicies:()=>Ct,getCompetitionDateRange:()=>oA,getCompetitionPenalties:()=>jj,getMutationLocks:()=>Yj,getPolicyDefinitions:()=>Kc,getTournamentInfo:()=>lg,getTournamentPenalties:()=>sA,getTournamentPersons:()=>Gj,getTournamentPoints:()=>uy,getTournamentStructures:()=>AV,getTournamentTimeItem:()=>vN,hydrateTournamentRecord:()=>$pe,mutate:()=>Fpe,query:()=>Aue,removeDrawDefinitionExtension:()=>fae,removeEventExtension:()=>uN,removeExtension:()=>On,removeMutationLock:()=>Lpe,removeNotes:()=>WV,removeOnlineResource:()=>Vpe,removeParticipantExtension:()=>hae,removeTournamentExtension:()=>C2,setTournamentCategories:()=>Wpe,setTournamentDates:()=>$A,setTournamentEndDate:()=>qpe,setTournamentName:()=>Gpe,setTournamentNotes:()=>Hpe,setTournamentStartDate:()=>zpe,setTournamentStatus:()=>Bpe});var Ope={};ft(Ope,{copyTournamentRecord:()=>xpe,createTournamentRecord:()=>xA});function xpe(t){let e=He(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord,n=1440*60*1e3,a=(i&&r?new Date(Ze(r)).getTime()-new Date(Ze(i)).getTime():0)/n,s=t.endDate||c2(t.startDate,a),o=p=>p?.filter(({itemType:f})=>t.itemTypeList?.includes(f)),l=p=>p?.filter(({name:f})=>t.extensionList?.includes(f)),u=p=>{let{timeItems:f,extensions:h,...m}=p;return xe({...m,timeItems:o(f),extensions:l(h)},!1,!0)},c=p=>{let{drawDefinitions:f,timeItems:h,extensions:m,startDate:g,endDate:I,...v}=p;return xe({extensions:l(m),timeItems:o(h),startDate:t.startDate,endDate:s,...v},!1,!0)},d={participants:t.copyParticipants?t.tournamentRecord.participants?.map(u)??[]:[],parentOrganisation:xe({...t.tournamentRecord.parentOrganisation},!1,!0),venues:xe(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:o(t.tournamentRecord.timeItems),events:t.tournamentRecord.events?.map(c)??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:Et(),endDate:s};return{...W,tournamentRecord:d}}var Fpe={};ft(Fpe,{addDrawDefinitionExtension:()=>lN,addEventExtension:()=>ep,addEventTimeItem:()=>og,addExtension:()=>It,addMutationLock:()=>_pe,addNotes:()=>LN,addOnlineResource:()=>jpe,addParticipantExtension:()=>pae,addParticipantTimeItem:()=>KV,addTimeItem:()=>Ll,addTournamentExtension:()=>R2,addTournamentTimeItem:()=>dT,hydrateTournamentRecord:()=>$pe,removeDrawDefinitionExtension:()=>fae,removeEventExtension:()=>uN,removeExtension:()=>On,removeMutationLock:()=>Lpe,removeNotes:()=>WV,removeOnlineResource:()=>Vpe,removeParticipantExtension:()=>hae,removeTournamentExtension:()=>C2,setTournamentCategories:()=>Wpe,setTournamentDates:()=>$A,setTournamentEndDate:()=>qpe,setTournamentName:()=>Gpe,setTournamentNotes:()=>Hpe,setTournamentStartDate:()=>zpe,setTournamentStatus:()=>Bpe});function Lpe(t){let{tournamentRecord:e,drawDefinition:i,event:r,venueId:n,lockId:a,scope:s,lockToken:o,forceRelease:l}=t;if(!e)return{error:Ie};if(!a&&!s)return{error:Je,info:"Provide lockId or scope to identify the lock"};let u;if(i)u=i;else if(r)u=r;else if(n){let h=go({tournamentRecord:e,venueId:n});if(h.error)return{error:h.error};u=h.venue}else u=e;let{extension:c}=rt({element:u,name:En}),d=c?.value??{locks:[]},p=d.locks.findIndex(h=>a?h.lockId===a:h.scope===s);if(p===-1)return{error:$re};let f=d.locks[p];return!l&&f.lockToken!==o?{error:Bre}:(d.locks.splice(p,1),It({element:u,extension:{name:En,value:d},creationTime:!1}),{...W})}function _pe(t){let{tournamentRecord:e,drawDefinition:i,event:r,venueId:n,scope:a,lockToken:s,methods:o}=t,l=t.expiresAt??null;if(!e)return{error:Ie};if(!a||!s)return{error:Je,info:a?"Missing lockToken":"Missing scope"};if(l!==null&&isNaN(Date.parse(l)))return{error:re,info:"Invalid expiresAt; must be ISO 8601 or null"};let u;if(i)u=i;else if(r)u=r;else if(n){let g=go({tournamentRecord:e,venueId:n});if(g.error)return{error:g.error};u=g.venue}else u=e;let{extension:c}=rt({element:u,name:En}),d=c?.value??{locks:[]},p=new Date().toISOString();d.locks=d.locks.filter(g=>g.expiresAt===null||g.expiresAt>p);let f=d.locks.find(g=>g.scope!==a?!1:!g.methods||!o?!0:g.methods.some(I=>o.includes(I)));if(f)return f.lockToken===s?(f.expiresAt=l,o?f.methods=o:delete f.methods,It({element:u,extension:{name:En,value:d},creationTime:!1}),{...W,lockId:f.lockId}):{error:_re};let h=Et(),m={lockId:h,lockToken:s,scope:a,expiresAt:l,createdAt:p,...o&&{methods:o}};return d.locks.push(m),It({element:u,extension:{name:En,value:d},creationTime:!1}),dYe(e,u),{...W,lockId:h}}function dYe(t,e){if(e===t){let{extension:r}=rt({element:t,name:En});r?.value&&!r.value.enabled&&(r.value.enabled=!0,It({element:t,extension:{name:En,value:r.value},creationTime:!1}));return}let{extension:i}=rt({element:t,name:En});i?.value?i.value.enabled||(i.value.enabled=!0,It({element:t,extension:{name:En,value:i.value},creationTime:!1})):It({element:t,extension:{name:En,value:{enabled:!0,locks:[]}},creationTime:!1})}function $pe(t){let{tournamentRecord:e,eventProfiles:i=[],directives:r,policyDefinitions:n}=t;return e?((e.events||[]).forEach(a=>{let s=i.find(o=>o.eventId&&o.eventId===a.eventId);(s?.directives?.hydrateRoundNames||r?.hydrateRoundNames)&&a.drawDefinitions?.forEach(o=>{(s?.policyDefinitions?.[Rc]||n?.[Rc])&&Kue({drawDefinition:o,appliedPolicies:n})})}),{tournamentRecord:e}):{error:Ie}}function Bpe({tournamentRecord:t,status:e}){return t?e&&!Object.keys(sle).includes(e)?{error:re,info:"Unknown status"}:(t.tournamentStatus=e,{...W}):{error:Ie}}function Vpe(t){let e=He(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return q({result:{error:Gr}});wg({element:i.parentOrganisation,onlineResource:r})}else if(a||s){let u=(i.participants??[]).find(c=>s&&c.person?.personId===s||c.participantId===a);if(!u)return q(s?{result:{error:Gr}}:{result:{error:Gi}});if(s){if(u.person?.personId!==s)return q({result:{error:Wp}});wg({element:u.person,onlineResource:r})}else wg({element:u,onlineResource:r})}else if(o){let u=(i.venues??[]).filter(c=>!l||c.venueId===l).flatMap(c=>(c.courts??[]).filter(d=>d.courtId===o))?.[0];if(!u)return q({result:{error:Dc}});wg({element:u,onlineResource:r})}else if(l){let u=(i.venues??[]).find(c=>c.venueId===l);if(!u)return q({result:{error:Uf}});wg({element:u,onlineResource:r})}else wg({element:i,onlineResource:r}),at({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:Df});return{...W}}function wg({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!(r?.[oE]===e[oE]&&r?.[lE]===e[lE]&&r?.[AI]===e[AI]));t.onlineResources=i}function jpe(t){let e=He(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return q({result:{error:Gr}});Sg({element:i.parentOrganisation,onlineResource:r})}else{if(a&&s&&a!==s)return q({result:{error:Wp}});if(a||s){let u=(i.participants??[]).find(c=>s&&c.person?.personId===s||c.participantId===a);if(!u)return q(s?{result:{error:Gr}}:{result:{error:Gi}});if(s){if(u.person?.personId!==s)return q({result:{error:Wp}});Sg({element:u.person,onlineResource:r})}else Sg({element:u,onlineResource:r})}else if(o){let u=(i.venues??[]).filter(c=>!l||c.venueId===l).flatMap(c=>(c.courts??[]).filter(d=>d.courtId===o))?.[0];if(!u)return q({result:{error:Dc}});Sg({element:u,onlineResource:r})}else if(l){let u=(i.venues??[]).find(c=>c.venueId===l);if(!u)return q({result:{error:Uf}});Sg({element:u,onlineResource:r})}else Sg({element:i,onlineResource:r}),at({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:Df})}return{...W}}function Sg({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>r?.[Yx]!==e[Yx]&&r?.[AI]!==e[AI]);return i.push(e),t.onlineResources=i,{...W}}function Gpe({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:Ie};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&at({topic:Df,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...W}}function Hpe({tournamentRecord:t,notes:e}){if(!t)return{error:Ie};let i=e?LN({element:t,notes:e}):WV({element:t});return i.error?i:(at({topic:Df,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...W})}function Wpe({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,at({topic:Df,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...W}):{error:Ie}}function pYe({tournamentRecord:t}){if(!t)return{error:Ie};let{startDate:e,endDate:i}=t,r=NI(e,i),n=[];for(let a of t.venues||[])a?.courts?.length&&n.push(...a.courts);for(let a of n){let{startTime:s,endTime:o}=(a.dateAvailability??[]).reduce((c,d)=>{let p=Nt(c.startTime),f=Nt(c.endTime);return d.startTime&&Nt(d.startTime)<p&&(c.startTime=d.startTime),d.endTime&&Nt(d.endTime)>f&&(c.endTime=d.endTime),c},{startTime:"08:00",endTime:"18:00"}),l=r.map(c=>a.dateAvailability?.find(d=>d.date===c)??{date:c,startTime:s,endTime:o}),u=a.dateAvailability?.find(c=>!c.date);u&&l.unshift(u),a.dateAvailability=l}return{...W}}function $A(t){let{tournamentRecord:e,startDate:i,endDate:r,weekdays:n}=t,a=t.activeDates?.filter(Boolean),s=He(t,[{tournamentRecord:!0},{[Yr]:f=>yl.test(f),[Ya]:Yi,startDate:!1,endDate:!1},{[Yr]:f=>f.filter(Boolean).every(h=>yl.test(h)),[Ya]:Yi,activeDates:!1},{[Yr]:fce,weekdays:!1}]);if(s.error)return s;if(r&&i&&new Date(r)<new Date(i))return{error:re};if(r&&i&&new Date(i)>new Date(r))return{error:re};if(a?.length){let f=i||e.startDate,h=r||e.endDate,m=!f||a.every(I=>new Date(I)>=new Date(f)),g=!h||a.every(I=>new Date(I)<=new Date(h));if(!m||!g)return{error:Yi}}let o;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||r&&e.endDate&&new Date(r)<new Date(e.endDate))&&(o=!0);let l=NI(e.startDate,e.endDate);i&&(e.startDate=i),r&&(e.endDate=r);let u=NI(e.startDate,e.endDate),c=l.filter(f=>!u.includes(f)),d=u.filter(f=>!l.includes(f));for(let f of e.events??[])i&&f.startDate&&new Date(f.startDate)<new Date(i)&&(f.startDate=i),r&&f.startDate&&new Date(f.startDate)>new Date(r)&&(f.startDate=i??r),r&&f.endDate&&new Date(f.endDate)>new Date(r)&&(f.endDate=r),i&&f.endDate&&new Date(f.endDate)<new Date(i)&&(f.endDate=r??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),r&&e.startDate&&new Date(r)<new Date(e.startDate)&&(e.startDate=r),a&&(e.activeDates=a),n&&(e.weekdays=n);let p=o&&fYe({tournamentRecord:e})?.unscheduledMatchUpIds;return pYe({tournamentRecord:e}),at({payload:je({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:n,endDate:r}),topic:Df}),{...W,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:c}}function zpe({tournamentRecord:t,startDate:e}){return e?$A({tournamentRecord:t,startDate:e}):{error:Yi}}function qpe({tournamentRecord:t,endDate:e}){return e?$A({tournamentRecord:t,endDate:e}):{error:Yi}}function fYe({tournamentRecord:t}){let e=Tr({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let s of e){let{schedule:o,matchUpId:l}=s;if(o&&o.scheduledDate){let u=new Date(o.scheduledDate);(i&&u<i||r&&u>r)&&(a.push(l),n.includes(o.scheduledDate)||n.push(o.scheduledDate))}}return n.length&&!AA({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:Pie}:{unscheduledMatchUpIds:a}}var Ype={};ft(Ype,{BLOCK_TYPES:()=>Ft,EvaluatorRegistry:()=>lfe,adjacentBlockEvaluator:()=>gH,applyTemporalAvailabilityToTournamentRecord:()=>gfe,blockDurationEvaluator:()=>vH,buildDayRange:()=>Jpe,buildEdges:()=>lH,buildSchedulingProfileFromUISelections:()=>Ife,calculateCapacityStats:()=>Zpe,calculateCourtHours:()=>Sfe,clampDragToCollisions:()=>afe,clampToDayRange:()=>sH,compareCapacityCurves:()=>ife,computePlanItemId:()=>$E,courtDayKey:()=>vb,courtKey:()=>Hg,courtOverlapEvaluator:()=>hH,createFollowByEvaluator:()=>ufe,dayBoundaryEvaluator:()=>yH,defaultEvaluators:()=>ofe,deriveRailSegments:()=>cH,diffMinutes:()=>RT,extractDay:()=>cp,filterCapacityCurve:()=>efe,findBlocksContainingTime:()=>nfe,formatConflicts:()=>pfe,generateCapacityCurve:()=>pH,getHighestSeverity:()=>dfe,groupConflictsBySeverity:()=>cfe,hhmmToMinutes:()=>Cw,intervalsOverlap:()=>rfe,iterateDayTicks:()=>hfe,lightingEvaluator:()=>IH,maintenanceWindowEvaluator:()=>bH,matchWindowEvaluator:()=>mH,mergeAdjacentSegments:()=>dH,mergeOverlappingAvailability:()=>wfe,minutesToHhmm:()=>BA,overlappingRange:()=>Xpe,railsToDateAvailability:()=>SH,rangesOverlap:()=>oH,resolveCourtId:()=>nh,resolveStatus:()=>_E,resolveVenueId:()=>Rh,runValidationPipeline:()=>mfe,sampleCapacityCurve:()=>tfe,snapIsoToGranularity:()=>ffe,snapToGranularity:()=>wH,sortBlocksByStart:()=>sfe,sortEdges:()=>uH,timeInsideBlock:()=>fH,todsAvailabilityToBlocks:()=>vfe,validateDateAvailability:()=>bfe,validateSchedulingProfileFormat:()=>yfe,validateSegments:()=>Qpe,venueDayKey:()=>Kpe,venueKey:()=>Zf});var Ft={MAINTENANCE:"MAINTENANCE",PRACTICE:"PRACTICE",RESERVED:"RESERVED",BLOCKED:"BLOCKED",CLOSED:"CLOSED",SCHEDULED:"SCHEDULED",SOFT_BLOCK:"SOFT_BLOCK",HARD_BLOCK:"HARD_BLOCK",LOCKED:"LOCKED",AVAILABLE:"AVAILABLE",UNSPECIFIED:"UNSPECIFIED"};function vb(t,e){return`${t.tournamentId}|${t.venueId}|${t.courtId}|${e}`}function Hg(t){return`${t.tournamentId}|${t.venueId}|${t.courtId}`}function Zf(t,e){return`${t}|${e}`}function Kpe(t,e,i){return`${t}|${e}|${i}`}function Rh(t){return t.venueId||t.venueName||"unknown-venue"}function nh(t){return t.courtId||t.courtName||"unknown-court"}function sH(t,e){let i=t.start,r=t.end,n=e?.start,a=e?.end;if(r<=n||i>=a)return null;let s=i<n?n:i,o=r>a?a:r;return{...t,start:s,end:o}}function oH(t,e){return t?.start<e?.end&&e?.start<t?.end}function Xpe(t,e){let i=t?.start>e?.start?t?.start:e?.start,r=t?.end<e?.end?t?.end:e?.end;return{start:i,end:r}}function RT(t,e){let i=new Date(t),r=(new Date(e).getTime()-i.getTime())/(1e3*60);return Number.isNaN(r)?0:r}function _E(t,e,i){if(t.length===0||!i||i.length===0)return Ft.AVAILABLE;let r=new Map(i.map((s,o)=>[s,o])),n=Ft.AVAILABLE,a=1/0;for(let s of t){let o=e.get(s);if(!o)continue;let l=r.get(o.type);l!==void 0&&l<a&&(a=l,n=o.type)}return n}function lH(t){let e=[];if(!Array.isArray(t))return e;for(let i of t)e.push({time:i.start,type:"START",blockId:i.id}),e.push({time:i.end,type:"END",blockId:i.id});return e}function uH(t){return Array.isArray(t)?t.slice().sort((e,i)=>{let r=e.time.localeCompare(i.time);return r!==0?r:e.type==="END"&&i.type==="START"?-1:e.type==="START"&&i.type==="END"?1:0}):[]}function cH(t,e,i){if(!Array.isArray(t)||!e||!i)return[];let r=t.map(u=>sH(u,e)).filter(u=>u!==null);if(r.length===0)return[{start:e.start,end:e.end,status:Ft.AVAILABLE,contributingBlocks:[]}];let n=new Map(r.map(u=>[u.id,u])),a=uH(lH(r)),s=new Set,o=[],l=e.start;for(let u of a){let c=u.time;if(c>l){let d=Array.from(s),p=_E(d,n,i.typePrecedence);o.push({start:l,end:c,status:p,contributingBlocks:d})}u.type==="START"?s.add(u.blockId):s.delete(u.blockId),l=c}if(l<e.end){let u=Array.from(s),c=_E(u,n,i.typePrecedence);o.push({start:l,end:e.end,status:c,contributingBlocks:u})}return dH(o)}function dH(t){if(t.length===0)return t;let e=[],i={...t[0]};for(let r=1;r<t.length;r++){let n=t[r],a=i.status===n.status,s=i.contributingBlocks.length===n.contributingBlocks.length&&i.contributingBlocks.every(l=>n.contributingBlocks.includes(l)),o=i.end===n.start;a&&s&&o?i.end=n.end:(e.push(i),i={...n})}return e.push(i),e}function cp(t){return Ze(t)}function Jpe(t,e){return{start:`${t}T${e?.dayStartTime}:00`,end:`${t}T${e?.dayEndTime}:00`}}function Qpe(t){for(let e=0;e<t.length;e++){let i=t[e];if(i.start>=i.end)return!1;if(e<t.length-1){let r=t[e+1];if(i.end>r.start||i.end!==r.start)return!1}}return!0}function pH(t,e){let i=new Set;if(!Array.isArray(e))return{day:t,points:[]};for(let a of e)for(let s of a.rails)for(let o of s.segments)i.add(o.start),i.add(o.end);let r=Array.from(i).sort(),n=r.map(a=>({time:a,courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0}));for(let a of e)for(let s of a.rails)for(let o=0;o<r.length;o++){let l=r[o],u=hYe(s.segments,l);if(u){let c=n[o];mYe(u,c)}}return{day:t,points:n}}function hYe(t,e){for(let i of t)if(e>=i.start&&e<i.end)return i;return null}function mYe(t,e){switch(t.status){case Ft.AVAILABLE:e.courtsAvailable++;break;case Ft.RESERVED:case Ft.SOFT_BLOCK:e.courtsSoftBlocked++;break;case Ft.BLOCKED:case Ft.PRACTICE:case Ft.MAINTENANCE:case Ft.CLOSED:e.courtsSoftBlocked++;break;case Ft.SCHEDULED:case Ft.HARD_BLOCK:case Ft.LOCKED:e.courtsHardBlocked++;break}}function Zpe(t){if(!t.points||t.points.length===0)return{peakAvailable:0,peakTime:"",minAvailable:0,minTime:"",avgAvailable:0,totalCourtHours:0,utilizationPercent:0,peakUnavailable:0,peakUnavailableTime:"",totalCourts:0,totalAvailableHours:0,totalUnavailableHours:0,availablePercent:0,avgBlockedHoursPerCourt:0};let e=0,i=t.points[0].time,r=1/0,n=t.points[0].time,a=0,s=t.points[0].time,o=0,l=0,u=0;for(let g=0;g<t.points.length-1;g++){let I=t.points[g],v=t.points[g+1],w=(new Date(v.time).getTime()-new Date(I.time).getTime())/(1e3*60*60),y=I.courtsAvailable+I.courtsSoftBlocked+I.courtsHardBlocked;u=Math.max(u,y);let b=I.courtsSoftBlocked+I.courtsHardBlocked;I.courtsAvailable>e&&(e=I.courtsAvailable,i=I.time),I.courtsAvailable<r&&(r=I.courtsAvailable,n=I.time),b>a&&(a=b,s=I.time),o+=I.courtsAvailable*w,l+=b*w}let c=(new Date(t.points.at(-1).time).getTime()-new Date(t.points[0].time).getTime())/(1e3*60*60),d=u*c,p=d>0?o/d*100:0,f=d>0?l/d*100:0,h=u>0?l/u:0,m=t.points.length>1?t.points.slice(0,-1).reduce((g,I)=>g+I.courtsAvailable,0)/(t.points.length-1):0;return{peakAvailable:e,peakTime:i,minAvailable:r===1/0?0:r,minTime:n,avgAvailable:m,totalCourtHours:d,utilizationPercent:f,peakUnavailable:a,peakUnavailableTime:s,totalCourts:u,totalAvailableHours:o,totalUnavailableHours:l,availablePercent:p,avgBlockedHoursPerCourt:h}}function efe(t,e){let i=t.points?.filter(r=>r.time>=e.start&&r.time<=e.end);return{...t,points:i}}function tfe(t,e){if(!t.points||t.points.length===0)return t;let i=[],r=new Date(t.points[0].time),n=new Date(t.points.at(-1).time),a=new Date(r);for(;a<=n;){let s=a.toISOString(),o=gYe(t.points,s);o&&i.push(o),a=new Date(a.getTime()+e*60*1e3)}return{...t,points:i}}function gYe(t,e){for(let i=t.length-1;i>=0;i--)if(t[i].time<=e)return{time:e,courtsAvailable:t[i].courtsAvailable,courtsSoftBlocked:t[i].courtsSoftBlocked,courtsHardBlocked:t[i].courtsHardBlocked};return null}function ife(t,e){let i=[],r=new Set;t.points?.forEach(a=>r.add(a.time)),e?.points?.forEach(a=>r.add(a.time));let n=Array.from(r).sort();for(let a of n){let s=t.points?.find(l=>l.time===a)||{courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0},o=e.points?.find(l=>l.time===a)||{courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0};i.push({time:a,availableDelta:o.courtsAvailable-s.courtsAvailable,softBlockedDelta:o.courtsSoftBlocked-s.courtsSoftBlocked,hardBlockedDelta:o.courtsHardBlocked-s.courtsHardBlocked})}return i}function rfe(t,e){let i=new Date(t.start?.endsWith("Z")?t.start:t.start+"Z").getTime(),r=new Date(t.end?.endsWith("Z")?t.end:t.end+"Z").getTime(),n=new Date(e?.start?.endsWith("Z")?e?.start:e?.start+"Z").getTime(),a=new Date(e?.end?.endsWith("Z")?e?.end:e?.end+"Z").getTime();return i<a&&r>n}function fH(t,e){let i=new Date(e?.start?.endsWith("Z")?e?.start:e?.start+"Z").getTime(),r=new Date(e?.end?.endsWith("Z")?e?.end:e?.end+"Z").getTime();return i<=t&&t<r}function nfe(t,e){return Array.isArray(e)?e.filter(i=>fH(t,i)):[]}function afe(t,e,i){let r=e>=t?"forward":"backward",n=Math.min(t,e),a=Math.max(t,e),s,o,l=!1,u;if(r==="forward"){let c=a;for(let d of i){let p=new Date(d.start.endsWith("Z")?d.start:d.start+"Z").getTime(),f=new Date(d.end.endsWith("Z")?d.end:d.end+"Z").getTime();p>t&&p<a&&p<c&&(c=p,l=!0,u=d),p<a&&f>t&&p<c&&p>t&&(c=p,l=!0,u=d)}s=t,o=c}else{let c=n;if(Array.isArray(i))for(let d of i){let p=new Date(d.start.endsWith("Z")?d.start:d.start+"Z").getTime(),f=new Date(d.end.endsWith("Z")?d.end:d.end+"Z").getTime();f<t&&f>n&&f>c&&(c=f,l=!0,u=d),p<t&&f>n&&f>c&&f<t&&(c=f,l=!0,u=d)}s=c,o=t}return{start:s,end:o,clamped:l,clampedBy:u,direction:r}}function sfe(t){Array.isArray(t)&&t.sort((e,i)=>{let r=new Date(e.start.endsWith("Z")?e.start:e.start+"Z").getTime(),n=new Date(i.start.endsWith("Z")?i.start:i.start+"Z").getTime();return r-n})}var hH={id:"COURT_OVERLAP",description:"Prevent double-booking courts or overriding hard blocks",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Ze(n.start),s=`${n.court.tournamentId}|${n.court.venueId}|${n.court.courtId}|${a}`,o=t.blocksByCourtDay.get(s)||[];for(let l of o){if(l===n.id)continue;let u=t.blocksById.get(l);if(u&&oH(n,u)){let c=u.type===Ft.HARD_BLOCK||u.type===Ft.LOCKED||n.type===Ft.HARD_BLOCK||n.type===Ft.LOCKED?"ERROR":"WARN",d=n.start>u.start?n.start:u.start,p=n.end<u.end?n.end:u.end;i.push({code:"COURT_OVERLAP",message:`Block overlaps existing ${u.type.toLowerCase()} (${u.reason||"no reason"}) on court ${n.court.courtId}`,severity:c,timeRange:{start:d,end:p},courts:[n.court]})}}}return i}},mH={id:"MATCH_WINDOW",description:"Ensure availability windows are large enough for typical matches",evaluate:(t,e)=>{let i=[],r=new Set;for(let n of e){let a=n.block,s=Ze(a.start),o=`${a.court.tournamentId}|${a.court.venueId}|${a.court.courtId}|${s}`;r.add(o)}for(let n of r){let a=(t.blocksByCourtDay.get(n)||[]).map(o=>t.blocksById.get(o)).filter(Boolean).slice().sort((o,l)=>o.start.localeCompare(l.start)),s=null;for(let o of a)if(o.type!==Ft.AVAILABLE&&o.type!==Ft.SOFT_BLOCK&&o.type!==Ft.RESERVED){if(s){let l=RT(s,o.start);l>0&&l<60&&i.push({code:"MATCH_WINDOW_TOO_SMALL",message:`Availability window (${l} minutes) is smaller than typical match duration (60 minutes)`,severity:"WARN",timeRange:{start:s,end:o.start},courts:[o.court]})}s=o.end}}return i}},gH={id:"ADJACENT_BLOCK",description:"Warn about blocks with no transition time",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Ze(n.start),s=`${n.court.tournamentId}|${n.court.venueId}|${n.court.courtId}|${a}`,o=t.blocksByCourtDay.get(s)||[];for(let l of o){if(l===n.id)continue;let u=t.blocksById.get(l);u&&(u.end===n.start||n.end===u.start)&&u.type!==n.type&&i.push({code:"NO_TRANSITION_TIME",message:`${n.type} immediately follows ${u.type} with no transition time (recommended: 15 minutes)`,severity:"INFO",timeRange:{start:u.end,end:n.start},courts:[n.court]})}}return i}},IH={id:"LIGHTING",description:"Prevent scheduling on unlit courts after sunset",evaluate:(t,e)=>{let i=[],r="19:00";for(let n of e){if(n.kind==="REMOVE_BLOCK")continue;let a=n.block;a.end.slice(11,16)>r&&(a.type===Ft.AVAILABLE||a.type===Ft.RESERVED)&&i.push({code:"AFTER_SUNSET",message:`Court scheduled after sunset (${r}). Verify court has adequate lighting.`,severity:"WARN",timeRange:{start:`${a.start.slice(0,11)}${r}:00`,end:a.end},courts:[a.court]})}return i}},vH={id:"BLOCK_DURATION",description:"Validate block durations are reasonable",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=RT(n.start,n.end);a<15?i.push({code:"BLOCK_TOO_SHORT",message:`Block duration (${a} minutes) is unusually short. Minimum recommended: 15 minutes.`,severity:"WARN",timeRange:n,courts:[n.court]}):a>720&&i.push({code:"BLOCK_TOO_LONG",message:`Block duration (${a/60} hours) is unusually long. Maximum recommended: ${720/60} hours.`,severity:"WARN",timeRange:n,courts:[n.court]})}return i}},yH={id:"DAY_BOUNDARY",description:"Ensure blocks do not span multiple days",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Ze(n.start),s=Ze(n.end);a!==s&&i.push({code:"SPANS_MULTIPLE_DAYS",message:`Block spans from ${a} to ${s}. Blocks should be contained within a single day.`,severity:"ERROR",timeRange:n,courts:[n.court]})}return i}},bH={id:"MAINTENANCE_WINDOW",description:"Validate maintenance scheduling practices",evaluate:(t,e)=>{let i=[],r="09:00",n="17:00";for(let a of e){if(a.kind==="REMOVE_BLOCK")continue;let s=a.block;if(s.type===Ft.MAINTENANCE){let o=s.start.slice(11,16),l=s.end.slice(11,16),u=RT(s.start,s.end);(o>=r&&o<n||l>r&&l<=n)&&i.push({code:"MAINTENANCE_DURING_PEAK",message:`Maintenance scheduled during peak hours (${r}-${n}). Consider scheduling during off-peak times.`,severity:"INFO",timeRange:s,courts:[s.court]}),u<30&&i.push({code:"MAINTENANCE_TOO_SHORT",message:`Maintenance duration (${u} minutes) may be insufficient. Recommended minimum: 30 minutes.`,severity:"INFO",timeRange:s,courts:[s.court]})}}return i}},ofe=[hH,yH,vH,mH,gH,IH,bH],lfe=class{constructor(){this.evaluators=new Map}register(t){this.evaluators.set(t.id,t)}unregister(t){this.evaluators.delete(t)}get(t){return this.evaluators.get(t)}getAll(){return Array.from(this.evaluators.values())}clear(){this.evaluators.clear()}},ufe=t=>({id:"FOLLOW_BY",description:"Player rest and follow-by conflicts using Competition Factory",evaluate:(e,i)=>[]});function cfe(t){return Array.isArray(t)?{errors:t?.filter(e=>e.severity==="ERROR"),warnings:t.filter(e=>e.severity==="WARN"),info:t.filter(e=>e.severity==="INFO")}:{errors:[],warnings:[],info:[]}}function dfe(t){return Array.isArray(t)?t.some(e=>e.severity==="ERROR")?"ERROR":t.some(e=>e.severity==="WARN")?"WARN":t.some(e=>e.severity==="INFO")?"INFO":null:null}function pfe(t){return Array.isArray(t)?t.map(e=>{let i=e.courts.map(n=>n.courtId).join(", "),r=`${e.timeRange.start.slice(11,16)}-${e.timeRange.end.slice(11,16)}`;return`[${e.severity}] ${e.code}: ${e.message} (${i} @ ${r})`}):[]}function Cw(t){if(typeof t!="string")return 0;let[e,i]=t.split(":").map(Number);return e*60+i}function BA(t){let e=Math.max(0,Math.min(1439,Math.round(t))),i=Math.floor(e/60),r=e%60;return`${String(i).padStart(2,"0")}:${String(r).padStart(2,"0")}`}function wH(t,e,i="round"){if(e<=0)return t;switch(i){case"floor":return Math.floor(t/e)*e;case"ceil":return Math.ceil(t/e)*e;case"round":return Math.round(t/e)*e}}function ffe(t,e,i="round"){if(!t||typeof t!="string")return t;let r=t.slice(0,10),n=t.slice(11,16),a=Cw(n),s=wH(a,e,i),o=BA(s);return`${r}T${o}:00`}function*hfe(t,e,i){if(i<=0)return;let r=Cw(t),n=Cw(e);for(let a=r;a<n;a+=i)yield BA(a)}function $E(t){let e=[t.day,t.venueId,t.eventId];return t.drawId&&e.push(t.drawId),e.push(`R${t.roundNumber}`),e.join("|")}function IYe(t,e){let i=[],r=new Set(t.getTournamentDays()),n=t.listCourtMeta(),a=new Set(n.map(s=>s.ref.venueId));for(let s of e){r.has(s.day)||i.push({ruleId:"PRECHECK_INVALID_DAY",phase:"PRECHECK",severity:"ERROR",message:`Day '${s.day}' is not within the tournament date range`,context:{day:s.day}});for(let o of s.items)a.has(o.venueId)||i.push({ruleId:"PRECHECK_INVALID_VENUE",phase:"PRECHECK",severity:"ERROR",message:`Venue '${o.venueId}' does not exist in the tournament record`,context:{day:s.day,venueId:o.venueId,planItemId:o.planItemId}}),o.notBeforeTime&&!/^\d{2}:\d{2}$/.test(o.notBeforeTime)&&i.push({ruleId:"PRECHECK_INVALID_TIME_FORMAT",phase:"PRECHECK",severity:"ERROR",message:`notBeforeTime '${o.notBeforeTime}' is not valid HH:MM format`,context:{day:s.day,planItemId:o.planItemId}}),o.roundNumber<1&&i.push({ruleId:"PRECHECK_INVALID_ROUND",phase:"PRECHECK",severity:"ERROR",message:`roundNumber must be >= 1, got ${o.roundNumber}`,context:{day:s.day,planItemId:o.planItemId}})}return i}function vYe(t,e){let i=[],r=new Set;for(let n of e)for(let a of n.items)r.has(a.planItemId)&&i.push({ruleId:"INTEGRITY_DUPLICATE_PLAN_ITEM",phase:"INTEGRITY",severity:"ERROR",message:`Duplicate plan item '${a.planItemId}'`,context:{day:n.day,planItemId:a.planItemId}}),r.add(a.planItemId);return i}function yYe(t,e){let i=[],r=new Map;for(let n of e)for(let a of n.items){let s=`${a.eventId}|${a.drawId||""}`,o=r.get(s)||[];o.push({day:n.day,roundNumber:a.roundNumber,planItemId:a.planItemId}),r.set(s,o)}for(let[n,a]of r.entries()){if(a.length<2)continue;let s=[...a].sort((o,l)=>o.roundNumber-l.roundNumber);for(let o=1;o<s.length;o++){let l=s[o-1],u=s[o];u.day<l.day&&i.push({ruleId:"ORDERING_ROUND_DAY_SEQUENCE",phase:"ORDERING",severity:"WARN",message:`Round ${u.roundNumber} is scheduled on ${u.day} which is before round ${l.roundNumber} on ${l.day} (event: ${n.split("|")[0]})`,context:{day:u.day,planItemId:u.planItemId},fixAction:{type:"MOVE_PLAN_ITEM",description:`Move round ${u.roundNumber} to ${l.day} or later`,payload:{planItemId:u.planItemId,suggestedDay:l.day}}})}}return i}function bYe(t,e){let i=[];for(let r of e){let n=0,a=r.items.filter(p=>p.estimatedDurationMinutes);for(let p of a)n+=p.estimatedDurationMinutes;if(n===0)continue;let s=t.getVisibleTimeRange(r.day),o=J3(s.startTime),l=J3(s.endTime)-o,u=t.listCourtMeta(),c=new Set(r.items.map(p=>p.venueId)),d=(c.size===1?u.filter(p=>p.ref.venueId===[...c][0]):u).length*l;n>d?i.push({ruleId:"CAPACITY_DEMAND_EXCEEDS_SUPPLY",phase:"CAPACITY",severity:"WARN",message:`Estimated demand (${Math.round(n/60)}h) exceeds available court-hours (${Math.round(d/60)}h) on ${r.day}`,context:{day:r.day}}):n>d*.9&&i.push({ruleId:"CAPACITY_NEAR_LIMIT",phase:"CAPACITY",severity:"INFO",message:`Demand is at ${Math.round(n/d*100)}% of capacity on ${r.day}`,context:{day:r.day}})}return i}function J3(t){let[e,i]=t.split(":").map(Number);return e*60+i}var Q3=["PRECHECK","INTEGRITY","ORDERING","CAPACITY"],wYe={PRECHECK:IYe,INTEGRITY:vYe,ORDERING:yYe,CAPACITY:bYe};function mfe(t){let{engine:e,day:i,phases:r}=t,n;if(i){let l=e.getDayPlan(i);n=l?[l]:[]}else n=e?.getAllPlans();let a=r?Q3.filter(l=>r.includes(l)):Q3,s=[];for(let l of a){let u=wYe[l],c=u(e,n);if(s.push(...c),l==="PRECHECK"&&c.some(d=>d.severity==="ERROR"))break}let o=new Map;for(let l of s){let u=l.context?.planItemId||"__global__",c=o.get(u)||[];c.push(l),o.set(u,c)}return{results:s,issueIndex:o}}var SYe={courtToCourtId:t=>t.courtId,isSchedulableStatus:t=>t===Ft.AVAILABLE||t===Ft.SOFT_BLOCK||t===Ft.RESERVED,aggregateByVenue:!1};function SH(t,e={}){let i={...SYe,...e},r=[];for(let n of t){let{day:a,venueId:s,rails:o}=n;for(let l of o){let{court:u,segments:c}=l,d=i.courtToCourtId(u),p=UYe(c,i);for(let f of p)r.push({date:a,startTime:Z3(f.start),endTime:Z3(f.end),venueId:s,courtIds:[d]})}}return i.aggregateByVenue?TYe(r):r}function UYe(t,e){let i=[],r=null,n=null;for(let a of t)e.isSchedulableStatus(a.status)?(r||(r=a.start),n=a.end):(r&&n&&i.push({start:r,end:n}),r=null,n=null);return r&&n&&i.push({start:r,end:n}),i}function Z3(t){return t.slice(11,16)}function TYe(t){let e=new Map;for(let i of t){let r=`${i.venueId}|${i.date}|${i.startTime}|${i.endTime}`;if(e.has(r)){let n=e.get(r);i.courtIds&&(n.courtIds=[...n.courtIds||[],...i.courtIds])}else e.set(r,{...i})}return Array.from(e.values())}function gfe(t){let{tournamentRecord:e,timelines:i,config:r={},engine:n}=t,a=SH(i,r),s=structuredClone(e),o=new Map;for(let l of a){let u=o.get(l.venueId)||[];u.push(l),o.set(l.venueId,u)}if(s.venues&&Array.isArray(s.venues)){let l=n?.getConfig()?.tournamentId;for(let u of s.venues){let c=Rh(u),d=o.get(c);if(d&&(u.dateAvailability=d),n&&l){let p=n.getVenueAvailability(l,c);p&&(u.defaultStartTime=p.startTime,u.defaultEndTime=p.endTime)}}}return s}function Ife(t){let e=[];for(let i of t)!i.scheduleDate||!i.venueIds.length||e.push({scheduleDate:i.scheduleDate,venueIds:i.venueIds,rounds:i.rounds||[]});return e}function vfe(t){let{venue:e,tournamentId:i,blockType:r=Ft.AVAILABLE}=t,n=[];if(!e.dateAvailability)return n;let a=Rh(e);for(let s of e.dateAvailability){let{date:o,startTime:l,endTime:u,courtIds:c}=s;if(c&&c.length>0)for(let d of c)n.push({court:{tournamentId:i,venueId:a,courtId:d},start:`${o}T${l}:00`,end:`${o}T${u}:00`,type:r});else if(e.courts&&e.courts.length>0)for(let d of e.courts){let p=nh(d);n.push({court:{tournamentId:i,venueId:a,courtId:p},start:`${o}T${l}:00`,end:`${o}T${u}:00`,type:r})}}return n}function yfe(t){let e=[];if(!Array.isArray(t))return e.push("Profile must be an array"),{valid:!1,errors:e};for(let i=0;i<t.length;i++){let r=t[i];if(r.scheduleDate?/^\d{4}-\d{2}-\d{2}$/.test(r.scheduleDate)||e.push(`Item ${i}: invalid scheduleDate format (expected YYYY-MM-DD)`):e.push(`Item ${i}: missing scheduleDate`),(!r.venueIds||!Array.isArray(r.venueIds)||r.venueIds.length===0)&&e.push(`Item ${i}: missing or empty venueIds array`),r.rounds)if(!Array.isArray(r.rounds))e.push(`Item ${i}: rounds must be an array`);else for(let n=0;n<r.rounds.length;n++)r.rounds[n].eventId||e.push(`Item ${i}, round ${n}: missing eventId`)}return{valid:e.length===0,errors:e}}function bfe(t){let e=[];if(!Array.isArray(t))return e.push("Entries must be an array"),{valid:!1,errors:e};for(let i=0;i<t.length;i++){let r=t[i];(!r.date||!/^\d{4}-\d{2}-\d{2}$/.test(r.date))&&e.push(`Entry ${i}: invalid or missing date`),(!r.startTime||!/^\d{2}:\d{2}$/.test(r.startTime))&&e.push(`Entry ${i}: invalid or missing startTime (expected HH:MM)`),(!r.endTime||!/^\d{2}:\d{2}$/.test(r.endTime))&&e.push(`Entry ${i}: invalid or missing endTime (expected HH:MM)`),r.startTime&&r.endTime&&r.startTime>=r.endTime&&e.push(`Entry ${i}: startTime must be before endTime`),r.venueId||e.push(`Entry ${i}: missing venueId`)}return{valid:e.length===0,errors:e}}function wfe(t){if(t.length===0)return t;let e=new Map;for(let r of t){let n=`${r.venueId}|${r.date}`,a=e.get(n)||[];a.push(r),e.set(n,a)}let i=[];for(let r of e.values()){r.sort((a,s)=>a.startTime.localeCompare(s.startTime));let n={...r[0]};for(let a=1;a<r.length;a++){let s=r[a];s.startTime<=n.endTime?(n.endTime=s.endTime>n.endTime?s.endTime:n.endTime,n.courtIds&&s.courtIds&&(n.courtIds=[...new Set([...n.courtIds,...s.courtIds])])):(i.push(n),n={...s})}i.push(n)}return i}function Sfe(t){let e=0;for(let i of t){let r=eY(i.startTime),n=(eY(i.endTime)-r)/60,a=i.courtIds?.length||1;e+=n*a}return e}function eY(t){let[e,i]=t.split(":").map(Number);return e*60+i}var Ufe={};ft(Ufe,{addCourt:()=>LA,addCourts:()=>JG,addVenue:()=>KU,deleteCourt:()=>Afe,deleteVenue:()=>PH,deleteVenues:()=>Efe,disableCourts:()=>Rfe,disableVenues:()=>Cfe,enableCourts:()=>Mfe,enableVenues:()=>Nfe,generate:()=>Tfe,generateCourts:()=>DG,getCompetitionVenues:()=>fT,getCourts:()=>dG,getVenuesAndCourts:()=>Hu,modifyCourt:()=>EH,modifyCourtAvailability:()=>TH,modifyVenue:()=>kfe,mutate:()=>Dfe,publicFindVenue:()=>lV,query:()=>zue});var Tfe={};ft(Tfe,{generateCourts:()=>DG});var Dfe={};ft(Dfe,{addCourt:()=>LA,addCourts:()=>JG,addVenue:()=>KU,deleteCourt:()=>Afe,deleteVenue:()=>PH,deleteVenues:()=>Efe,disableCourts:()=>Rfe,disableVenues:()=>Cfe,enableCourts:()=>Mfe,enableVenues:()=>Nfe,modifyCourt:()=>EH,modifyCourtAvailability:()=>TH,modifyVenue:()=>kfe});function UH(t){if(!t?.tournamentRecord&&!Array.isArray(t?.venueMatchUps))return{error:Ie};if(!t?.courtId)return{error:Bm};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:s}=Qc({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:o}=Tr({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:o,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{let f=p.schedule?.allocatedCourts?.map(({courtId:h})=>h);return p.schedule?.courtId===c||f?.includes(c)});return ME({matchUps:d,schedulingProfile:s})}}function DYe({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:Ie};if(!r)return{error:Qd};let{schedulingProfile:n}=Qc({tournamentRecord:e}),{matchUps:a}=Tr({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:s({matchUps:a,venueId:r})};function s({matchUps:o,venueId:l}){let u=o.filter(c=>{let d=c.schedule?.allocatedCourts?.map(({venueId:p})=>p);return c.schedule?.venueId===l||d?.includes(l)});return ME({matchUps:u,schedulingProfile:n})}}function TH({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){if(!t)return{error:Ie};if(!n)return{error:Bm};let s=UN({dateAvailability:e});if(s.error)return s;let{updatedDateAvailability:o,totalMergeCount:l}=PYe(e);e=o;let u=ap({tournamentRecord:t,courtId:n});if(u.error)return u;let{court:c,venue:d}=u,{matchUps:p}=UH({tournamentRecord:t,venueMatchUps:r,courtId:n});if(p?.length){let f=Ct({tournamentRecord:t})?.appliedPolicies,h=a??f?.[Zd]?.allowDeletionWithScoresPresent?.courts,m=[];m.length&&(h||console.log("throw error: scheduled court matchUps",m.length))}return c&&(c.dateAvailability=e,!i&&d&&at({payload:{venue:d,tournamentId:t.tournamentId},topic:Yc,key:d.venueId})),{...W,totalMergeCount:l}}function PYe(t){let e=0,i=t.reduce((n,a)=>{let{date:s,startTime:o,endTime:l,bookings:u}=a;return n[s]||(n[s]=[]),n[s].push({startTime:o,endTime:l,bookings:u}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(Y$e);let{mergedAvailability:a,mergeCount:s}=EYe(i[n]);r.push(...a.map(o=>({date:n,...o}))),e+=s}),{updatedDateAvailability:r,totalMergeCount:e}}function EYe(t){let e,i,r,n=t.length,a=0,s=[];for(;t.length&&n;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(n-=1,!e)e=u,r=d,i=c;else if(UU(ir(i),ir(u),!1)>0){let p={startTime:e,endTime:i};r?.length&&(p.bookings=r),s.push(p),e=u,r=d,i=c}else d&&(r?r.push(d):r=d),i=c,a+=1}let o={startTime:e,endTime:i};return r?.length&&(o.bookings=r),s.push(o),{mergedAvailability:s,mergeCount:a}}function DH({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:Vre,info:e}}function Pfe({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:Dn};if(!e&&!r)return{error:jo};let a;if(!e){if(!t)return{error:Ie};({drawDefinition:e}=Kn({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=hi({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:Ie};let s=Tr({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=Voe({matchUps:s,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(s=>[kd,Nu].includes(s.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:s})=>![kd,Nu].includes(s)),Dt({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...W}):{error:pn}}function PH(t){if(typeof t?.venueId!="string")return{error:Qd};let{tournamentRecord:e,venueId:i,force:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(n).length)return{error:Ie};let a=_o({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],s=Ct({tournamentRecord:e})?.appliedPolicies,o=r??s?.[Zd]?.allowDeletionWithScoresPresent?.venues;if(!a.length||o)for(let l of Object.values(n)){for(let c of a){let d=Pfe({matchUpId:c.matchUpId,drawId:c.drawId,tournamentRecord:l});if(d.error)return d}let u;l.venues=(l.venues??[]).filter(c=>c?.venueId!==i?!0:(u=!0,!1)),u&&at({payload:{venueId:i,tournamentId:l.tournamentId},topic:$2,key:i})}else return DH({matchUpsCount:a.length});return yT({tournamentRecords:n}),{...W}}function Efe({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:Ie};if(!Array.isArray(e))return{error:re};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,s=PH({tournamentRecord:t,venueId:a,force:i});if(s.error)return s}}return{...W}}function Rfe(t){let{courtIds:e,dates:i}=t,r=Ds(t),n=[{[fn]:!0,[sN]:!0}],a=He(t,n);if(a.error)return a;for(let s of Object.values(r))RYe({tournamentRecord:s,courtIds:e,dates:i});return{...W}}function RYe({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>It({extension:{value:r,name:Eo},creationTime:!1,element:a});for(let a of t.venues||[])for(let s of a.courts||[])if(e?.includes(s.courtId)){let o=n(s);if(o.error)return o}return{...W}}function Cfe(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[fn]:!0,[oN]:!0}],a=He(t,n);if(a.error)return a;let s=Object.keys(e).filter(o=>!i||o===i);for(let o of s){let l=e[o];CYe({tournamentRecord:l,venueIds:r})}return{...W}}function CYe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e?.includes(i.venueId)){let r=It({creationTime:!1,element:i,extension:{name:Eo,value:!0}});if(r.error)return r}return{...W}}function Mfe(t){let e=Ds(t),i=[{[fn]:!0}];!t.enableAll&&i.push({[sN]:!0});let r=He(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:s}=t;for(let o of Object.values(e))MYe({tournamentRecord:o,courtIds:a,enableAll:n,dates:s});return{...W}}function MYe({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e?.includes(a.courtId))if(Array.isArray(r)){let{extension:s}=rt({element:a,name:Eo});if(s){let o=s.value;Array.isArray(o.dates)&&(o.dates=o.dates.filter(l=>!r.includes(l))),It({extension:{name:Eo,value:o},creationTime:!1,element:a})}}else On({element:a,name:Eo});return{...W}}function Nfe(t){let e=Ds(t),i=[{[fn]:!0}];!t.enableAll&&i.push({[oN]:!0});let r=He(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let s of Object.values(e))for(let o of s.venues||[])(a||n?.includes(o.venueId))&&On({element:o,name:Eo});return{...W}}function Afe(t){let{courtId:e,disableNotice:i,force:r}=t,n=Ds(t),a=He(t,[{[fn]:!0,[oae]:!0}]);if(a.error)return a;let s,o;for(let l of Object.values(n)){if(o=NYe({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),o.error&&o.error!==Dc)return o;o.success&&(s=!0)}return s?{...W}:o}function NYe({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){let n=ap({tournamentRecord:t,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:s}=UH({tournamentRecord:t,courtId:i}),o=Ct({tournamentRecord:t})?.appliedPolicies,l=r??o?.[Zd]?.allowDeletionWithScoresPresent?.courts;if(!s?.length||l){for(let u of s??[]){let c=Pfe({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:t});if(c.error)return c}a&&(a.courts=(a.courts??[]).filter(u=>u.courtId!==i),e||at({payload:{venue:a,tournamentId:t.tournamentId},topic:Yc,key:a.venueId}))}else return DH({matchUpsCount:s.length});return{...W}}function EH(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,s=Ds(t);if(!Object.keys(s).length)return{error:Ci};let o;for(let l of Object.values(s)){let u=AYe({tournamentRecord:l,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(u?.error)return u;o=!0}return o?{...W}:void 0}function AYe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:Ie};if(!n)return{error:Bm};if(!r||typeof r!="object")return{error:zc};let s=ap({tournamentRecord:t,courtId:n});if(s.error)return s;let{venue:o,court:l}=s,u=Object.keys(P3e()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>u.includes(p)).length)return{error:GM};let c=new Set(u.filter(p=>!["dateAvailability"].includes(p))),d=Object.keys(r).filter(p=>c.has(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=TH({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||at({payload:{venue:o,tournamentId:t.tournamentId},topic:Yc,key:o?.venueId}),{...W,court:xe(l)}}var kYe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,defaultStartTime:void 0,defaultEndTime:void 0,isPrimary:void 0,dateAvailability:[],addresses:[],contacts:[],courts:[],roles:[]}),OYe=kYe;function kfe(t){let{modifications:e,venueId:i,force:r}=t,n=Ds(t);if(!Object.keys(n).length)return{error:Ci};if(typeof i!="string")return{error:Qd};let a,s;for(let o of Object.values(n)){let l=LYe({tournamentRecord:o,modifications:e,venueId:i,force:r});if(l.success&&(s=!0),l.error&&(a=l.error),l.error&&l.error!==Uf)return l}return yT({tournamentRecords:n}),s?{...W}:{error:a}}function xYe({venue:t,modifications:e,tournamentRecord:i,venueMatchUps:r,allowModificationWhenMatchUpsScheduled:n}){let a=t?.courts?.map(u=>u.courtId)??[],s=e.courts?.map(u=>u.courtId)||[],o=s.length?a.filter(u=>!s.includes(u)):e?.courts&&a,l=[];if(o?.length){let u=t?.courts?.filter(c=>o.includes(c.courtId))?.map(c=>{let d=UH({courtId:c.courtId,tournamentRecord:i,venueMatchUps:r});for(let p of d.matchUps??[])l.push({matchUpId:p.matchUpId,drawId:p.drawId});return d.matchUps?.length??0}).reduce((c,d)=>c+d);return t&&(!u||n)?(t.courts=t.courts?.filter(c=>s.includes(c.courtId)),Rw({schedule:{courtId:"",scheduledDate:""},matchUpDetails:l,removePriorValues:!0,tournamentRecord:i}),{success:!0}):DH({matchUpsCount:u})}return{success:!0}}function FYe({modifications:t,tournamentRecord:e,venueMatchUps:i,venueId:r,force:n}){if(t.courts)for(let a of t.courts){let{courtId:s}=a||{},o=EH({modifications:a,disableNotice:!0,tournamentRecord:e,venueMatchUps:i,courtId:s,force:n});if(o?.error===Dc&&(o=LA({disableNotice:!0,tournamentRecord:e,venueId:r,court:a})),o?.error)return o}return{success:!0}}function LYe({tournamentRecord:t,modifications:e,venueId:i,force:r}){if(!t)return{error:Ie};if(!e||typeof e!="object")return{error:zc};if(!i)return{error:Qd};let n=Ct({tournamentRecord:t})?.appliedPolicies,a=r??n?.[Zd]?.allowDeletionWithScoresPresent?.venues,{matchUps:s}=DYe({tournamentRecord:t,venueId:i}),o=go({tournamentRecord:t,venueId:i});if(o.error)return o;let l=o.venue,u=Object.keys(OYe()).filter(g=>g!=="venueId");if(!Object.keys(e).filter(g=>u.includes(g)).length)return{error:GM};let c=new Set(u.filter(g=>!["courts","onlineResources","dateAvailability","isPrimary"].includes(g))),d=Object.keys(e).filter(g=>c.has(g));if(!l)return{error:Uf};let p=e.defaultStartTime??l.defaultStartTime,f=e.defaultEndTime??l.defaultEndTime;if(p||f){if(!p||!f)return{error:re,info:"both defaultStartTime and defaultEndTime are required"};if(!vE({startTime:p,endTime:f}))return{error:re,info:"defaultEndTime must be after defaultStartTime"}}if(d.forEach(g=>Object.assign(l,{[g]:e[g]})),"isPrimary"in e&&(e.isPrimary?(mse({tournamentRecord:t}),l.isPrimary=!0):delete l.isPrimary),e.dateAvailability!==void 0){if(Array.isArray(e.dateAvailability)&&e.dateAvailability.length){let g=UN({dateAvailability:e.dateAvailability});if(g.error)return g}l.dateAvailability=e.dateAvailability}let h=xYe({venue:l,modifications:e,tournamentRecord:t,venueMatchUps:s,allowModificationWhenMatchUpsScheduled:a});if("error"in h&&h.error)return h;let m=FYe({modifications:e,tournamentRecord:t,venueMatchUps:s,venueId:i,force:r});return m?.error?m:(yT({tournamentRecord:t}),l&&at({payload:{venue:l,tournamentId:t.tournamentId},topic:Yc,key:l?.venueId}),{...W,venue:xe(l)})}var RH={};ft(RH,{JSON2CSV:()=>HYe,UUID:()=>Et,UUIDS:()=>dne,allNumeric:()=>bie,attributeFilter:()=>Xh,chunkArray:()=>Sr,chunkByNth:()=>Fx,chunkSizeProfile:()=>yie,constantToString:()=>Zr,countValues:()=>NLe,createMap:()=>hie,dateTime:()=>cne,definedAttributes:()=>je,dehydrateMatchUps:()=>BYe,extractAttributes:()=>vse,flattenJSON:()=>CH,generateDateRange:()=>NI,generateHashCode:()=>PLe,generateRange:()=>Ce,generateTimeCode:()=>Rde,groupValues:()=>Iie,hasAttributeValues:()=>DLe,instanceCount:()=>Ra,intersection:()=>_i,isConvertableInteger:()=>ct,isNumeric:()=>Ni,isOdd:()=>mie,isPowerOf2:()=>xo,isValidEmbargoDate:()=>cd,makeDeepCopy:()=>xe,matchUpScheduleSort:()=>$Ye,matchUpSort:()=>eg,nearestPowerOf2:()=>CB,nextPowerOf2:()=>$v,noNulls:()=>MLe,noNumeric:()=>wie,numericSort:()=>or,occurrences:()=>kLe,overlap:()=>$n,randomMember:()=>xs,randomPop:()=>wa,shuffleArray:()=>An,structureSort:()=>Ym,subSort:()=>OLe,timeZone:()=>f3e,undefinedToNull:()=>Ox,unique:()=>lt,visualizeScheduledMatchUps:()=>_Ye});function _Ye({scheduledMatchUps:t,showGlobalLog:e}){mBe();let i=t?.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:s}=t.find(o=>o.structureId===n);return{[n]:`${a} ${s}`}})};i?.forEach(n=>{Wt({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let a=t.filter(o=>o.structureId===n),s=Un({matchUps:a})?.roundMatchUps||[];Object.keys(s).forEach(o=>{Wt({roundNumber:o,keyColors:{roundNumber:"brightcyan"}},!0),s[o].forEach(({matchUpId:l,schedule:u})=>{let c=fi(u.scheduledTime);Wt({matchUpId:l,time:c,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&hBe()}var{extractTime:tY,timeStringMinutes:iY}=cne;function $Ye(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=iY(tY(i.scheduledTime)),a=iY(tY(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function BYe({tournamentRecord:t}){if(!t)return{error:Ie};if(typeof t!="object"||!t.tournamentId)return{error:re};let{matchUps:e}=Tr({tournamentRecord:t,inContext:!1});if(e?.length){let i=VYe({tournamentRecord:t});GYe(e,i)}return{...W}}function VYe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var jYe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function GYe(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,s=e[r]||e[n]||e[a],o=i.matchUpFormat===s?void 0:i.matchUpFormat;for(let l of Object.keys(i))jYe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}function HYe(t,e){if(e&&typeof e!="object")return{error:re};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:s,onlyHeaderRow:o,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:f='"',columnJoiner:h=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof h!="string"||typeof m!="string"||typeof g!="string"||typeof f!="string")return{error:re};i=Object.assign({},...Object.keys(i).reverse().map(M=>({[M]:Array.isArray(i[M])?i[M]:[typeof i[M]=="string"&&i[M]].filter(Boolean)})));let I=t.filter(Boolean).map(M=>CH(M,g)),v=Object.values(i).flat();r&&l.push(...v);let w=I.reduce((M,N)=>Object.keys(N).every(A=>!M.includes(A)&&M.push(A)||!0)&&M,[]).filter(M=>!l?.length||l.includes(M)),y=Object.assign({},...Object.keys(i).reverse().map(M=>i[M].map(N=>({[N]:M})).flat()).flat()),b=(M,N)=>e?.sortOrder?e.sortOrder.includes(M)&&e.sortOrder.includes(N)&&e.sortOrder.indexOf(M)-e.sortOrder.indexOf(N)||!e.sortOrder.includes(N)&&-1:0,S=w.reduce((M,N)=>{let A=y[N];return A?M.includes(A)||M.push(A):M.push(N),M},[]).sort(b);Object.keys(c).forEach(M=>!S.includes(M)&&S.unshift(M)),Object.keys(i).forEach(M=>!S.includes(M)&&S.unshift(M)),typeof p=="object"&&Object.keys(p).forEach(M=>!S.includes(M)&&S.unshift(M));let U=S.map(M=>c[M]||M);if(o)return[U];let T=M=>`${f}${M}${f}`,D=[],P=M=>Object.values(S.reduce((N,A,O)=>{let k=i[A],F=(k?.length?M[k.find($=>M[$])]:M[A])||p?.[A]||"",x=d[A]?.[F]||F,L=ya(u[A])?u[A](x):x;return N[A]=T(L),L&&(D[O]=(D[O]||0)+1),N},{})),E=I.map(P),R=s&&[...D].map((M,N)=>!M&&N).filter(Ni).reverse();if(R){let M=N=>N.filter((A,O)=>!R.includes(O));E=E.map(M),U=M(U)}let C=E.map(M=>M.join(h));return a?C.map(M=>{let N=M.split(h);return Object.assign({},...N.map((A,O)=>({[U[O]]:A})))}):n?[U.map(T).join(h),...C].join(m):C.join(m)}function CH(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,CH(t[n],e,i.concat(n))),{})}var{FACTORY:rY}=gae;function WYe({tournamentRecord:t,value:e}){let{extension:i}=rt({element:t,name:rY}),r={name:rY,value:{...i?.value,...e}};It({element:t,extension:r})}function Ofe({timeStamp:t}){let e=Gm(),i=r2();return i&&Object.values(e).forEach(r=>{WYe({tournamentRecord:r,value:{version:AM(),timeStamp:t}})}),i}function xfe({engineType:t,methodName:e,elapsed:i,params:r,result:n}){let a=ha();if(typeof a!="object")return;let s={method:e},o=n?.error&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&a.params?.includes(e),u=a.params&&!Array.isArray(a.params)||l,c=Array.isArray(a.exclude)&&a.exclude.includes(e);!c&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(s.elapsed=i),!c&&(o||u)&&(s.params=r),!c&&(o||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&a.result?.includes(e))&&(s.result=n),Object.keys(s).length>1&&Qre(s,t)}function MH({methodName:t,params:e,start:i}){let r={error:HM,methodName:t},n=i?Date.now()-i:0;return xfe({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}var zYe={setMatchUpHomeParticipantId:"SCHEDULING",calculateScheduleTimes:"SCHEDULING",addMatchUpScheduledDate:"SCHEDULING",bulkScheduleTournamentMatchUps:"SCHEDULING",toggleParticipantCheckInState:"SCHEDULING",removeMatchUpCourtAssignment:"SCHEDULING",proAutoSchedule:"SCHEDULING",bulkUpdateCourtAssignments:"SCHEDULING",allocateTeamMatchUpCourts:"SCHEDULING",scheduleMatchUps:"SCHEDULING",addSchedulingProfileRound:"SCHEDULING",proConflicts:"SCHEDULING",reorderUpcomingMatchUps:"SCHEDULING",generateVirtualCourts:"SCHEDULING",bulkRescheduleMatchUps:"SCHEDULING",clearScheduledMatchUps:"SCHEDULING",matchUpScheduleChange:"SCHEDULING",bulkScheduleMatchUps:"SCHEDULING",scheduleProfileRounds:"SCHEDULING",clearMatchUpSchedule:"SCHEDULING",addMatchUpScheduledTime:"SCHEDULING",setMatchUpDailyLimits:"SCHEDULING",assignMatchUpCourt:"SCHEDULING",assignMatchUpVenue:"SCHEDULING",generateBookings:"SCHEDULING",validateSchedulingProfile:"SCHEDULING",setSchedulingProfile:"SCHEDULING",addCourtGridBooking:"SCHEDULING",removeCourtGridBooking:"SCHEDULING",addMatchUpCourtOrder:"SCHEDULING",addMatchUpStartTime:"SCHEDULING",addMatchUpEndTime:"SCHEDULING",addMatchUpStopTime:"SCHEDULING",addMatchUpResumeTime:"SCHEDULING",addMatchUpOfficial:"SCHEDULING",addMatchUpScheduleItems:"SCHEDULING",setDrawParticipantRepresentativeIds:"DRAWS",resetVoluntaryConsolationStructure:"DRAWS",withdrawParticipantAtDrawPosition:"DRAWS",addVoluntaryConsolationStructure:"DRAWS",luckyLoserDrawPositionAssignment:"DRAWS",shiftAdHocRounds:"DRAWS",setPositionAssignments:"DRAWS",swapAdHocRounds:"DRAWS",alternateDrawPositionAssignment:"DRAWS",removeDrawPositionAssignment:"DRAWS",automatedPlayoffPositioning:"DRAWS",modifySeedAssignment:"DRAWS",qualifierDrawPositionAssignment:"DRAWS",qualifierProgression:"DRAWS",setStructureOrder:"DRAWS",attachQualifyingStructure:"DRAWS",renameStructures:"DRAWS",assignDrawPositionBye:"DRAWS",addDrawDefinitionTimeItem:"DRAWS",removeStructure:"DRAWS",addVoluntaryConsolationStage:"DRAWS",resetQualifyingStructure:"DRAWS",swapDrawPositionAssignments:"DRAWS",removeSeededParticipant:"DRAWS",addQualifyingStructure:"DRAWS",adHocPositionSwap:"DRAWS",addPlayoffStructures:"DRAWS",automatedPositioning:"DRAWS",modifyDrawDefinition:"DRAWS",resetDrawDefinition:"DRAWS",pruneDrawDefinition:"DRAWS",assignDrawPosition:"DRAWS",deleteAdHocMatchUps:"DRAWS",removeRoundMatchUps:"DRAWS",updateTeamLineUp:"DRAWS",addAdHocMatchUps:"DRAWS",modifyDrawName:"DRAWS",setSubOrder:"DRAWS",attachConsolationStructures:"DRAWS",attachPlayoffStructures:"DRAWS",attachStructures:"DRAWS",generateDrawTypeAndModifyDrawDefinition:"DRAWS",generateAndPopulatePlayoffStructures:"DRAWS",generateDrawMaticRound:"DRAWS",generateVoluntaryConsolation:"DRAWS",generateDrawDefinition:"DRAWS",generateQualifyingStructure:"DRAWS",generateDrawStructuresAndLinks:"DRAWS",generateAdHocMatchUps:"DRAWS",generateAdHocRounds:"DRAWS",drawMatic:"DRAWS",addFinishingRounds:"DRAWS",buildDrawHierarchy:"DRAWS",autoSeeding:"DRAWS",setMatchUpStatus:"SCORING",setMatchUpState:"SCORING",bulkMatchUpStatusUpdate:"SCORING",setDelegatedOutcome:"SCORING",removeDelegatedOutcome:"SCORING",updateTieMatchUpScore:"SCORING",resetScorecard:"SCORING",setOrderOfFinish:"SCORING",resetAdHocMatchUps:"SCORING",applyLineUps:"SCORING",resetTieFormat:"SCORING",enableTieAutoCalc:"SCORING",disableTieAutoCalc:"SCORING",resetMatchUpLineUps:"SCORING",assignMatchUpSideParticipant:"MATCHUPS",replaceTieMatchUpParticipantId:"MATCHUPS",assignTieMatchUpParticipantId:"MATCHUPS",removeTieMatchUpParticipantId:"MATCHUPS",removeMatchUpSideParticipant:"MATCHUPS",substituteParticipant:"MATCHUPS",checkOutParticipant:"MATCHUPS",checkInParticipant:"MATCHUPS",setMatchUpFormat:"MATCHUPS",createMatchUp:"SCORING",addPoint:"SCORING",resolvePointValue:"SCORING",calculatePointsTo:"SCORING",inferServeSide:"SCORING",modifyPersonRequests:"PARTICIPANTS",removePersonRequests:"PARTICIPANTS",addPersonRequests:"PARTICIPANTS",setParticipantScaleItems:"PARTICIPANTS",setParticipantScaleItem:"PARTICIPANTS",modifyIndividualParticipantIds:"PARTICIPANTS",createTeamsFromParticipantAttributes:"PARTICIPANTS",modifyParticipantsSignInStatus:"PARTICIPANTS",addIndividualParticipantIds:"PARTICIPANTS",modifyParticipantOtherName:"PARTICIPANTS",regenerateParticipantNames:"PARTICIPANTS",addDynamicRatings:"PARTICIPANTS",createGroupParticipant:"PARTICIPANTS",modifyParticipantName:"PARTICIPANTS",scaledTeamAssignment:"PARTICIPANTS",removeRatings:"PARTICIPANTS",removePenalty:"PARTICIPANTS",modifyPenalty:"PARTICIPANTS",deleteParticipants:"PARTICIPANTS",mergeParticipants:"PARTICIPANTS",modifyParticipant:"PARTICIPANTS",addParticipants:"PARTICIPANTS",addPenalty:"PARTICIPANTS",addParticipant:"PARTICIPANTS",addPersons:"PARTICIPANTS",removeIndividualParticipantIds:"PARTICIPANTS",removeParticipantIdsFromAllTeams:"PARTICIPANTS",destroyPairEntries:"ENTRIES",destroyPairEntry:"ENTRIES",setEntryPosition:"ENTRIES",setEntryPositions:"ENTRIES",promoteAlternate:"ENTRIES",promoteAlternates:"ENTRIES",removeDrawEntries:"ENTRIES",modifyEntriesStatus:"ENTRIES",addEventEntryPairs:"ENTRIES",removeEventEntries:"ENTRIES",modifyEventEntries:"ENTRIES",addDrawEntries:"ENTRIES",addEventEntries:"ENTRIES",deleteFlightProfileAndFlightDraws:"EVENTS",modifyEventMatchUpFormatTiming:"EVENTS",removeEventMatchUpFormatTiming:"EVENTS",setEventDates:"EVENTS",setEventEndDate:"EVENTS",setEventStartDate:"EVENTS",deleteFlightAndFlightDraw:"EVENTS",refreshEventDrawOrder:"EVENTS",modifyPairAssignment:"EVENTS",updateDrawIdsOrder:"EVENTS",addDrawDefinition:"EVENTS",deleteDrawDefinitions:"EVENTS",assignSeedPositions:"EVENTS",attachFlightProfile:"EVENTS",removeScaleValues:"EVENTS",setEventDisplay:"EVENTS",validateCategory:"EVENTS",removeSeeding:"EVENTS",deleteEvents:"EVENTS",modifyEvent:"EVENTS",addFlight:"EVENTS",addEvent:"EVENTS",generateEventsFromTieFormat:"EVENTS",modifyCourtAvailability:"VENUES",deleteVenue:"VENUES",deleteVenues:"VENUES",addCourt:"VENUES",addCourts:"VENUES",disableCourts:"VENUES",disableVenues:"VENUES",enableCourts:"VENUES",enableVenues:"VENUES",deleteCourt:"VENUES",modifyCourt:"VENUES",modifyVenue:"VENUES",addVenue:"VENUES",publishEventSeeding:"PUBLISHING",unPublishEventSeeding:"PUBLISHING",unPublishParticipants:"PUBLISHING",unPublishOrderOfPlay:"PUBLISHING",publishParticipants:"PUBLISHING",publishOrderOfPlay:"PUBLISHING",unPublishEvent:"PUBLISHING",publishEvent:"PUBLISHING",setTournamentStatus:"TOURNAMENT",setTournamentName:"TOURNAMENT",setTournamentNotes:"TOURNAMENT",setTournamentCategories:"TOURNAMENT",setTournamentDates:"TOURNAMENT",setTournamentEndDate:"TOURNAMENT",setTournamentStartDate:"TOURNAMENT",addTournamentExtension:"TOURNAMENT",removeTournamentExtension:"TOURNAMENT",modifyCollectionDefinition:"TIE_FORMAT",removeCollectionGroup:"TIE_FORMAT",orderCollectionDefinitions:"TIE_FORMAT",removeCollectionDefinition:"TIE_FORMAT",addCollectionGroup:"TIE_FORMAT",addCollectionDefinition:"TIE_FORMAT",modifyTieFormat:"TIE_FORMAT",aggregateTieFormats:"TIE_FORMAT",attachPolicies:"POLICY",removePolicy:"POLICY",linkTournaments:"COMPETITION",unlinkTournament:"COMPETITION",unlinkTournaments:"COMPETITION",applyTournamentRankingPoints:"RANKING"};function qYe(t,e,i){if(!e||!i||!i.extensions?.find(o=>o?.name===En)?.value?.enabled)return;let r=zYe[t];if(!r)return;let n=e.lockToken,a=new Date().toISOString(),s=[];if(e.drawDefinition&&s.push({element:e.drawDefinition,label:`draw:${e.drawDefinition.drawId}`}),e.event&&s.push({element:e.event,label:`event:${e.event.eventId}`}),e.venueId){let o=go({tournamentRecord:i,venueId:e.venueId});o.venue&&s.push({element:o.venue,label:`venue:${e.venueId}`})}s.push({element:i,label:"tournament"});for(let{element:o,label:l}of s){let u=YYe({element:o,scope:r,methodName:t,lockToken:n,now:a,label:l});if(u)return u}}function YYe({element:t,scope:e,methodName:i,lockToken:r,now:n,label:a}){let{extension:s}=rt({element:t,name:En});if(!s?.value?.locks?.length)return;let o=s.value,l=!1;for(let u=o.locks.length-1;u>=0;u--){let c=o.locks[u];if(c.scope===e&&!(c.methods&&!c.methods.includes(i))){if(c.expiresAt!==null&&c.expiresAt<=n){o.locks.splice(u,1),l=!0;continue}if(r&&r===c.lockToken){l&&It({element:t,extension:{name:En,value:o},creationTime:!1});return}return l&&It({element:t,extension:{name:En,value:o},creationTime:!1}),{error:Lre,info:`Locked by ${a} (scope: ${c.scope}, lockId: ${c.lockId})`}}}l&&It({element:t,extension:{name:En,value:o},creationTime:!1})}function KYe(t,e){if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:Ie};let i=e.drawId||e.matchUp?.drawId;if(i){let{event:a,drawDefinition:s,tournamentId:o}=Kn({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),o&&(e.tournamentId=o),a&&(e.event=a)}if(e.eventId&&!e.event){let{event:a,tournamentId:s}=Kn({eventId:e.eventId,tournamentRecords:t});if(!a)return{error:gs};e.tournamentId=s,e.event=a}let r=e.tournamentId??jm();if(!r&&e)return e;let n=t[r];return r&&!n?{error:Ie}:(n&&(e.tournamentRecord=n),e)}function NH(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),s=jm();i&&(i.activeTournamentId=s);let o=i?.tournamentRecord||a2(s),l=typeof i?.tournamentRecord=="object"&&{[i?.tournamentRecord.tournamentId]:i.tournamentRecord}||Gm(),u=i?xe(i,void 0,!0):void 0,c=i?KYe(l,i):void 0;if(c?.error)return c;let d=qYe(r,c,o);if(d)return d;let p=XYe({params:c,tournamentRecords:l,tournamentRecord:o,methodName:r,method:e}),f=Date.now()-a;return xfe({result:p,methodName:r,elapsed:f,params:u,engineType:n}),p}function XYe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(ha())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return qM({engineName:"engine",methodName:r,params:i,err:a})}}function VA(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=Ts();for(let s of[...a].sort(JYe)){let o=Kre({topic:s});o?.length&&zx({topic:s,notices:o})}e&&n&&a.includes(eF)&&zx({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:eF})}var nY={[q2]:5,[z2]:5,[Y2]:5,[W2]:5,[H2]:5,[j2]:5,[Aae]:5,[kae]:5,[hE]:1,[G2]:1,[hN]:1,[nn]:5,[Yc]:5,[V2]:4,[_2]:4,[$2]:4,[B2]:4,[fN]:3,[x2]:2};function JYe(t,e){return(nY[e]||0)-(nY[t]||0)}function QYe({convertExtensions:t,removeExtensions:e}){let i=Gm();return{tournamentId:jm(),tournamentRecords:xe(i,t,!1,e)}}function ZYe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=t?.tournamentId??jm();if(typeof r!="string")return{};let n=a2(r);return{tournamentRecord:xe(n,e,!1,i)}}function e6e(){let t=Gm(),{extension:e}=rt({name:Xp,tournamentRecords:t,discover:!0}),i=e?.value?.tournamentIds||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),zM(t)}function aY(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:zc}:t?.tournamentId?Xre(e?xe(t):t):{error:re}}function Mw(t,e=!0){if(typeof t!="object")return{error:zc};if(sw(),Array.isArray(t)){if(t.filter(i=>i?.tournamentId).length!==t.length)return{error:_x};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t?.tournamentId)t={[t.tournamentId]:t},sw(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:_x};return zM(e?xe(t):t)}function t6e(t,e,i,r,n,a){let s=Zre(i,r,n,a);if(s.error)return s;let o=s.methods??[];return Object.keys(o).filter(l=>ya(o[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:o[l],...u});if(ha())return c();try{return c()}catch(d){qM({engineName:"engine",methodName:l,params:u,err:d})}}}),{...W,...t}}function Ug(t,e){return e?.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function Ffe(t,e){t.importMethods=(i,r,n,a)=>t6e(t,e,i,r,n,a),t.getTournament=i=>ZYe(i),t.getState=i=>QYe({convertExtensions:i?.convertExtensions,removeExtensions:i?.removeExtensions}),t.version=()=>AM(),t.reset=()=>(zM({}),Ug(t)),t.devContext=i=>(nw(i),Ug(t)),t.getDevContext=i=>ha(i),t.newTournamentRecord=(i={})=>{let r=xA(i),n=r.tournamentId;return r.error?r:(aY(r),sw(n),{...W,tournamentId:n})},t.setState=(i,r,n)=>{aw(r,n);let a=Mw(i,r);return Ug(t,a)},t.setTournamentId=i=>sw(i),t.getTournamentId=()=>jm(),t.setTournamentRecord=(i,r,n)=>{aw(r,n);let a=aY(i,r);return Ug(t,a)},t.removeTournamentRecord=i=>{let r=Jre(i);return Ug(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=e6e();return Ug(t,i)}}function i6e(t,e,i){if(!Array.isArray(e))return{error:re,message:"directives must be an array"};let r=Yre(),n=Date.now(),a=i&&xe(Gm(),!1,!0),s=[];for(let u of e){if(typeof u!="object")return{error:re,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:re,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!r[c])return MH({methodName:c,start:n,params:p});if(d){let h=s.at(-1),m=Object.keys(d);for(let g of m)h[g]&&(p[g]=h[g])}let f=NH(t,r[c],p,c,"sync");if(f?.error)return a&&Mw(a),{...f,rolledBack:!!a};s.push({...f,methodName:c})}let o=Date.now(),l=Ofe({timeStamp:o});return VA({directives:e,mutationStatus:l,timeStamp:o}),wU(),{success:s.every(u=>u.success),results:s}}function sY(t,e){if(!Ut(e))return{error:re,message:"args must be an object"};let i=Object.values(e).filter(ya).length;if(i>1)return{message:"there must be only one arg with typeof function",error:re};let r=i?Object.keys(e).find(f=>ya(e[f])):ai(e.method)&&e.method;if(!r)return{error:HM};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=s.rollbackOnError&&xe(Gm(),!1,!0),l=n||t[r]||t2()[r];if(!l)return MH({methodName:r,params:s});let u=NH(t,l,s,r,"sync")??{};u?.error&&o&&Mw(o);let c=Date.now(),d=Ofe({timeStamp:c}),p=u?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&VA({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:c}),(p||!u?.success||s?.doNotNotify)&&wU(),u}var r6e=(()=>{let t={executionQueue:(e,i)=>i6e(t,e,i),execute:e=>sY(t,e)};return Ffe(t,sY),t})(),AH=r6e;function oY(t,e){if(!Ut(e))return{error:re,message:"args must be an object"};let i=Object.values(e).filter(ya).length;if(i>1)return{message:"there must be only one arg with typeof function",error:re};let r=i?Object.keys(e).find(l=>ya(e[l])):ai(e.method)&&e.method;if(!r)return{error:HM};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=n||t[r]||t2()[r];return o?NH(t,o,s,r,"ask"):MH({methodName:r,params:s})}(()=>{let t={execute:e=>oY(t,e)};return Ffe(t,oY),t})();var Ch={},od;function Lfe(t,e=!0){if(!t)return{error:Je};if(typeof t!="object")return{error:zc};if(t.matchUpId)od=t.matchUpId,Ch[od]=e?xe(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(Ch[i.matchUpId]=e?xe(i):i,od||(od=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(Ch[i.matchUpId]=e?xe(i):i,od||(od=i.matchUpId));return e?xe(t):t}function n6e(){return Ch[od]}function a6e(){return Object.values(Ch)}function s6e(){od=void 0,Ch={}}function o6e(t){return xe(Ch[od],t?.convertExtensions,!1,t?.removeExtensions)}(()=>{let t={getState:i=>o6e(i),version:()=>AM(),reset:()=>(s6e(),{...W}),drawId:void 0,error:void 0,success:!1,devContext:i=>(nw(i),t),setState:(i,r,n)=>{aw(r,n);let a=Lfe(i);return e(a)}};function e(i){return i?.error?(t.error=i.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=i.drawId),t}return l6e(t,[cj]),t})();function l6e(t,e){e.forEach(i=>{Object.keys(i).forEach(r=>{t[r]=n=>{if(ha())return lY(t,{params:n,governor:i,methodName:r});try{return lY(t,{params:n,governor:i,methodName:r})}catch(a){qM({engineName:"matchUpEngine",methodName:r,params:n,err:a})}}})})}function lY(t,{params:e,governor:i,methodName:r}){t.error=void 0,t.success=!1;let n=e?.matchUp||n6e(),a=e?.matchUps||a6e(),s=e?.rollbackOnError&&xe(n,!1,!0);e={...e,matchUpId:n?.matchUpId,matchUps:a,matchUp:n};let o=i[r](e);if(o?.error)return s&&Lfe(s),{...o,rolledBack:!!s};let l=o?.success&&e?.delayNotify!==!0&&e?.doNotNotify!==!0;return l&&VA(),(l||!o?.success||e?.doNotNotify)&&wU(),o}var Zk=!1;(()=>{let t={version:()=>AM(),setDeepCopy:(n,a)=>(aw(n,a),t),devContext:n=>(nw(n),Zk=!0,t)};return i([VG]),t;function e(n,a){let s=n({...a});return s?.error||VA(),wU(),Zk&&(nw(!1),Zk=!1),s}function i(n){n.forEach(a=>{Object.keys(a).forEach(s=>{t[s]=r(a,s)})})}function r(n,a){return s=>{if(ha()){let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&Mw(o.tournamentRecord),o}else try{let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&Mw(o.tournamentRecord),o}catch(o){let l;typeof o=="string"?l=o.toUpperCase():o instanceof Error&&(l=o.message),console.log("ERROR",{params:JSON.stringify(s),method:a,error:l})}}}})();var u6e={};ft(u6e,{BLOCK_TYPES:()=>Ft,EvaluatorRegistry:()=>lfe,TemporalEngine:()=>c6e,adjacentBlockEvaluator:()=>gH,applyTemporalAvailabilityToTournamentRecord:()=>gfe,blockDurationEvaluator:()=>vH,buildDayRange:()=>Jpe,buildEdges:()=>lH,buildSchedulingProfileFromUISelections:()=>Ife,calculateCapacityStats:()=>Zpe,calculateCourtHours:()=>Sfe,clampDragToCollisions:()=>afe,clampToDayRange:()=>sH,compareCapacityCurves:()=>ife,computePlanItemId:()=>$E,courtDayKey:()=>vb,courtKey:()=>Hg,courtOverlapEvaluator:()=>hH,createFollowByEvaluator:()=>ufe,dayBoundaryEvaluator:()=>yH,defaultEvaluators:()=>ofe,deriveRailSegments:()=>cH,diffMinutes:()=>RT,extractDay:()=>cp,filterCapacityCurve:()=>efe,findBlocksContainingTime:()=>nfe,formatConflicts:()=>pfe,generateCapacityCurve:()=>pH,getHighestSeverity:()=>dfe,groupConflictsBySeverity:()=>cfe,hhmmToMinutes:()=>Cw,intervalsOverlap:()=>rfe,iterateDayTicks:()=>hfe,lightingEvaluator:()=>IH,maintenanceWindowEvaluator:()=>bH,matchWindowEvaluator:()=>mH,mergeAdjacentSegments:()=>dH,mergeOverlappingAvailability:()=>wfe,minutesToHhmm:()=>BA,overlappingRange:()=>Xpe,railsToDateAvailability:()=>SH,rangesOverlap:()=>oH,resolveCourtId:()=>nh,resolveStatus:()=>_E,resolveVenueId:()=>Rh,runValidationPipeline:()=>mfe,sampleCapacityCurve:()=>tfe,snapIsoToGranularity:()=>ffe,snapToGranularity:()=>wH,sortBlocksByStart:()=>sfe,sortEdges:()=>uH,timeInsideBlock:()=>fH,todsAvailabilityToBlocks:()=>vfe,validateDateAvailability:()=>bfe,validateSchedulingProfileFormat:()=>yfe,validateSegments:()=>Qpe,venueDayKey:()=>Kpe,venueKey:()=>Zf});var Tg,c6e=(Tg=class{constructor(){this.tournamentRecord=null,this.blocksById=new Map,this.blocksByCourtDay=new Map,this.courtDayAvailability=new Map,this.venueDayAvailability=new Map,this.templates=new Map,this.rules=new Map,this.plans=new Map,this.subscribers=[],this.resolvedGranularity=15,this.nextBlockId=1}init(t,e){this.tournamentRecord=t,this.config={tournamentId:e?.tournamentId||t?.tournamentId||"tournament-1",dayStartTime:e?.dayStartTime||"06:00",dayEndTime:e?.dayEndTime||"23:00",slotMinutes:e?.slotMinutes||15,granularityMinutes:e?.granularityMinutes,typePrecedence:e?.typePrecedence||[Ft.HARD_BLOCK,Ft.LOCKED,Ft.MAINTENANCE,Ft.BLOCKED,Ft.PRACTICE,Ft.RESERVED,Ft.SOFT_BLOCK,Ft.AVAILABLE,Ft.UNSPECIFIED],conflictEvaluators:e?.conflictEvaluators||[]},this.resolvedGranularity=this.config.granularityMinutes??this.config.slotMinutes??15,this.plans.clear(),this.loadBlocksFromTournamentRecord(),this.emit({type:"STATE_CHANGED",payload:{reason:"INIT"}})}updateTournamentRecord(t){this.tournamentRecord=t,this.loadBlocksFromTournamentRecord(),this.emit({type:"STATE_CHANGED",payload:{reason:"TOURNAMENT_RECORD_UPDATED"}})}getConfig(){return{...this.config}}getResolvedGranularityMinutes(){return this.resolvedGranularity}getCourtAvailability(t,e){let i=Hg(t),r=this.courtDayAvailability.get(`${i}|${e}`)??this.courtDayAvailability.get(`${i}|DEFAULT`)??null,n=Zf(t.tournamentId,t.venueId),a=this.venueDayAvailability.get(`${n}|${e}`)??this.venueDayAvailability.get(`${n}|DEFAULT`)??null;if(r&&a){let s=r.startTime>a.startTime?r.startTime:a.startTime,o=r.endTime<a.endTime?r.endTime:a.endTime;return s>=o?a:{startTime:s,endTime:o}}return r||a||this.courtDayAvailability.get("GLOBAL|DEFAULT")||{startTime:this.config.dayStartTime,endTime:this.config.dayEndTime}}setCourtAvailability(t,e,i){let r=Hg(t);this.courtDayAvailability.set(`${r}|${e}`,i),this.emit({type:"AVAILABILITY_CHANGED",payload:{court:t,day:e,avail:i}})}setCourtAvailabilityAllDays(t,e){let i=Hg(t);this.courtDayAvailability.set(`${i}|DEFAULT`,e),this.emit({type:"AVAILABILITY_CHANGED",payload:{court:t,scope:"all-days",avail:e}})}setAllCourtsDefaultAvailability(t){this.courtDayAvailability.set("GLOBAL|DEFAULT",t),this.emit({type:"AVAILABILITY_CHANGED",payload:{scope:"global",avail:t}})}getVenueAvailability(t,e,i){let r=Zf(t,e);if(i){let n=this.venueDayAvailability.get(`${r}|${i}`);if(n)return n}return this.venueDayAvailability.get(`${r}|DEFAULT`)??null}setVenueDefaultAvailability(t,e,i){let r=Zf(t,e);this.venueDayAvailability.set(`${r}|DEFAULT`,i),this.emit({type:"AVAILABILITY_CHANGED",payload:{tournamentId:t,venueId:e,scope:"venue",avail:i}})}setVenueDayAvailability(t,e,i,r){let n=Zf(t,e);this.venueDayAvailability.set(`${n}|${i}`,r),this.emit({type:"AVAILABILITY_CHANGED",payload:{tournamentId:t,venueId:e,day:i,scope:"venue-day",avail:r}})}getVisibleTimeRange(t,e){let i=e&&e.length>0?e:this.getAllCourtsFromTournamentRecord(),r="23:59",n="00:00";for(let a of i){let s=this.getCourtAvailability(a,t);s.startTime<r&&(r=s.startTime),s.endTime>n&&(n=s.endTime)}return i.length===0?{startTime:this.config.dayStartTime,endTime:this.config.dayEndTime}:{startTime:r,endTime:n}}getTournamentDays(){if(!this.tournamentRecord?.startDate)return[];let t=this.tournamentRecord.startDate,e=this.tournamentRecord.endDate||t,i=[],r=new Date(t),n=new Date(e);for(;r<=n;)i.push(r.toISOString().slice(0,10)),r.setDate(r.getDate()+1);return i}getDayTimeline(t){let e=this.getAllCourtsFromTournamentRecord(),i=new Map;for(let n of e){let a=i.get(n.venueId)||[];a.push(n),i.set(n.venueId,a)}let r=[];for(let[n,a]of i.entries()){let s=[];for(let o of a){let l=this.getCourtRail(t,o);l&&s.push(l)}r.push({day:t,venueId:n,rails:s})}return r}getVenueTimeline(t,e){return this.getDayTimeline(t).find(i=>i.venueId===e)||null}getCourtRail(t,e){let i=this.getCourtAvailability(e,t),r={start:`${t}T${i.startTime}:00`,end:`${t}T${i.endTime}:00`},n=vb(e,t),a=(this.blocksByCourtDay.get(n)||[]).map(o=>this.blocksById.get(o)).filter(o=>!!o),s=cH(a,r,this.config);return{court:e,segments:s}}getCapacityCurve(t){let e=this.getDayTimeline(t);return pH(t,e)}getDayBlocks(t){let e=[];for(let i of this.blocksById.values())cp(i.start)===t&&e.push(i);return e}getAllBlocks(){return Array.from(this.blocksById.values())}getTemplates(){return Array.from(this.templates.values())}getTemplate(t){return this.templates.get(t)||null}getRules(){return Array.from(this.rules.values())}getRule(t){return this.rules.get(t)||null}addPlanItem(t){let e=$E(t),i={...t,planItemId:e},r=this.plans.get(t.day)||{day:t.day,items:[]};return r.items=r.items.filter(n=>n.planItemId!==e),r.items.push(i),this.plans.set(t.day,r),this.emit({type:"PLAN_CHANGED",payload:{action:"ADD",planItem:i}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),i}removePlanItem(t){for(let[e,i]of this.plans.entries()){let r=i.items.findIndex(n=>n.planItemId===t);if(r!==-1){let n=i.items.splice(r,1)[0];return i.items.length===0&&this.plans.delete(e),this.emit({type:"PLAN_CHANGED",payload:{action:"REMOVE",planItem:n}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),!0}}return!1}updatePlanItem(t,e){for(let i of this.plans.values()){let r=i.items.find(n=>n.planItemId===t);if(r)return Object.assign(r,e),this.emit({type:"PLAN_CHANGED",payload:{action:"UPDATE",planItem:r}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),r}return null}movePlanItem(t,e){let i=null;for(let[a,s]of this.plans.entries()){let o=s.items.findIndex(l=>l.planItemId===t);if(o!==-1){i=s.items.splice(o,1)[0],s.items.length===0&&this.plans.delete(a);break}}if(!i)return null;let r={...i,day:e};r.planItemId=$E(r);let n=this.plans.get(e)||{day:e,items:[]};return n.items=n.items.filter(a=>a.planItemId!==r.planItemId),n.items.push(r),this.plans.set(e,n),this.emit({type:"PLAN_CHANGED",payload:{action:"MOVE",planItem:r,fromDay:i.day}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),r}getDayPlan(t){return this.plans.get(t)||null}getAllPlans(){return Array.from(this.plans.values())}applyBlock(t){let e=[];for(let i of t.courts){let r=cp(t.timeRange.start),n=this.clampToAvailability(i,r,t.timeRange.start,t.timeRange.end);if(!n)continue;let a={id:this.generateBlockId(),court:i,start:n.start,end:n.end,type:t.type,reason:t.reason,hardSoft:t.hardSoft,source:t.source||"USER"};e.push({kind:"ADD_BLOCK",block:a})}return this.applyMutations(e)}moveBlock(t){let e=this.blocksById.get(t.blockId);if(!e)return{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${t.blockId} not found`}],conflicts:[]};let i=t.newCourt||e.court,r=cp(t.newTimeRange.start),n=this.clampToAvailability(i,r,t.newTimeRange.start,t.newTimeRange.end);if(!n)return{applied:[],rejected:[],warnings:[{code:"OUTSIDE_AVAILABILITY",message:"Block falls outside court availability"}],conflicts:[]};let a={...e,start:n.start,end:n.end,court:i};return this.applyMutations([{kind:"UPDATE_BLOCK",block:a,previousBlock:e}])}resizeBlock(t){let e=this.blocksById.get(t.blockId);if(!e)return{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${t.blockId} not found`}],conflicts:[]};let i=cp(t.newTimeRange.start),r=this.clampToAvailability(e.court,i,t.newTimeRange.start,t.newTimeRange.end);if(!r)return{applied:[],rejected:[],warnings:[{code:"OUTSIDE_AVAILABILITY",message:"Block falls outside court availability"}],conflicts:[]};let n={...e,start:r.start,end:r.end};return this.applyMutations([{kind:"UPDATE_BLOCK",block:n,previousBlock:e}])}removeBlock(t){let e=this.blocksById.get(t);return e?this.applyMutations([{kind:"REMOVE_BLOCK",block:e}]):{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${t} not found`}],conflicts:[]}}applyTemplate(t){return this.templates.get(t.templateId)?{applied:[],rejected:[],warnings:[],conflicts:[]}:{applied:[],rejected:[],warnings:[{code:"TEMPLATE_NOT_FOUND",message:`Template ${t.templateId} not found`}],conflicts:[]}}importScheduledMatchUps(t){let e=[];for(let n of this.blocksById.values())n.type===Ft.SCHEDULED&&n.source==="SYSTEM"&&e.push({kind:"REMOVE_BLOCK",block:n});for(let n of e)this.applyMutation(n);let i=[];for(let n of t){let a=n.startTime.length===5?`${n.startTime}:00`:n.startTime,s=this.timeToMinutes(a)+n.durationMinutes,o=Math.floor(s/60),l=s%60,u=`${String(o).padStart(2,"0")}:${String(l).padStart(2,"0")}:00`,c={id:this.generateBlockId(),court:{tournamentId:this.config.tournamentId,venueId:n.venueId,courtId:n.courtId},start:`${n.date}T${a}`,end:`${n.date}T${u}`,type:Ft.SCHEDULED,source:"SYSTEM",matchUpId:n.matchUpId,reason:"Scheduled Match"};i.push({kind:"ADD_BLOCK",block:c})}let r=this.applyMutations(i);return{...r,applied:[...e,...r.applied]}}timeToMinutes(t){let e=t.split(":").map(Number);return e[0]*60+e[1]}simulateBlocks(t,e){let i=this.createSnapshot(),r=i.applyMutations(t),n=e||this.getFirstAvailableDay(),a=n?i.getDayTimeline(n):[],s=n?i.getCapacityCurve(n):void 0;return{previewRails:a,capacityImpact:s,conflicts:r.conflicts}}subscribe(t){return this.subscribers.push(t),()=>{let e=this.subscribers.indexOf(t);e>-1&&this.subscribers.splice(e,1)}}emit(t){for(let e of this.subscribers)try{e(t)}catch(i){console.error("Error in event listener:",i)}}applyMutations(t){let e=this.evaluateConflicts(t);if(e.filter(r=>r.severity==="ERROR").length>0)return{applied:[],rejected:t,warnings:[],conflicts:e};let i=[];for(let r of t)this.applyMutation(r),i.push(r);return this.emit({type:"BLOCKS_CHANGED",payload:{mutations:i}}),this.emit({type:"STATE_CHANGED",payload:{reason:"BLOCKS_MUTATED"}}),e.length>0&&this.emit({type:"CONFLICTS_CHANGED",payload:{conflicts:e}}),{applied:i,rejected:[],warnings:e.filter(r=>r.severity==="WARN").map(r=>({code:r.code,message:r.message})),conflicts:e}}applyMutation(t){let{kind:e,block:i,previousBlock:r}=t;switch(e){case"ADD_BLOCK":this.blocksById.set(i.id,i),this.indexBlock(i);break;case"UPDATE_BLOCK":r&&this.unindexBlock(r),this.blocksById.set(i.id,i),this.indexBlock(i);break;case"REMOVE_BLOCK":this.unindexBlock(i),this.blocksById.delete(i.id);break}}indexBlock(t){let e=cp(t.start),i=vb(t.court,e),r=this.blocksByCourtDay.get(i)||[];r.includes(t.id)||(r.push(t.id),this.blocksByCourtDay.set(i,r))}unindexBlock(t){let e=cp(t.start),i=vb(t.court,e),r=(this.blocksByCourtDay.get(i)||[]).filter(n=>n!==t.id);r.length>0?this.blocksByCourtDay.set(i,r):this.blocksByCourtDay.delete(i)}evaluateConflicts(t){let e=this.createContext(),i=[];for(let r of this.config.conflictEvaluators||[])try{let n=r.evaluate(e,t);i.push(...n)}catch(n){console.error(`Error in evaluator ${r.id}:`,n)}return i}createContext(){return{config:this.config,tournamentRecord:this.tournamentRecord,blocksById:new Map(this.blocksById),blocksByCourtDay:new Map(this.blocksByCourtDay),templates:new Map(this.templates),rules:new Map(this.rules)}}createSnapshot(){let t=new Tg;return t.config={...this.config},t.tournamentRecord=this.tournamentRecord,t.blocksById=new Map(this.blocksById),t.blocksByCourtDay=new Map(this.blocksByCourtDay),t.courtDayAvailability=new Map(this.courtDayAvailability),t.venueDayAvailability=new Map(this.venueDayAvailability),t.templates=new Map(this.templates),t.rules=new Map(this.rules),t.plans=new Map([...this.plans.entries()].map(([e,i])=>[e,{...i,items:[...i.items]}])),t.nextBlockId=this.nextBlockId,t.resolvedGranularity=this.resolvedGranularity,t}loadBlocksFromTournamentRecord(){if(this.blocksById.clear(),this.blocksByCourtDay.clear(),this.courtDayAvailability.clear(),this.venueDayAvailability.clear(),!!this.tournamentRecord?.venues)for(let t of this.tournamentRecord.venues){let e=Rh(t),i=Zf(this.config.tournamentId,e);if(t.defaultStartTime&&t.defaultEndTime&&this.venueDayAvailability.set(`${i}|DEFAULT`,{startTime:t.defaultStartTime,endTime:t.defaultEndTime}),t.dateAvailability?.length){for(let r of t.dateAvailability)if(r.date?r.startTime&&r.endTime&&this.venueDayAvailability.set(`${i}|${r.date}`,{startTime:r.startTime,endTime:r.endTime}):r.startTime&&r.endTime&&this.venueDayAvailability.set(`${i}|DEFAULT`,{startTime:r.startTime,endTime:r.endTime}),r.bookings?.length&&t.courts?.length){let n=r.date||this.tournamentRecord.startDate;for(let a of r.bookings){if(!a.startTime||!a.endTime)continue;let s=a.startTime.length===5?`${a.startTime}:00`:a.startTime,o=a.endTime.length===5?`${a.endTime}:00`:a.endTime,l=Tg.BOOKING_TYPE_MAP[(a.bookingType||"").toUpperCase()]||Ft.RESERVED;for(let u of t.courts){let c={tournamentId:this.config.tournamentId,venueId:e,courtId:nh(u)},d=this.generateBlockId(),p={id:d,court:c,start:`${n}T${s}`,end:`${n}T${o}`,type:l,reason:a.bookingType||"Booking",source:"SYSTEM"};this.blocksById.set(d,p),this.indexBlock(p)}}}}for(let r of t.courts||[]){if(!r.dateAvailability?.length)continue;let n={tournamentId:this.config.tournamentId,venueId:e,courtId:nh(r)};for(let a of r.dateAvailability){let s=a.date||this.tournamentRecord.startDate;if(a.startTime&&a.endTime){let o=Hg(n);this.courtDayAvailability.set(`${o}|${s}`,{startTime:a.startTime,endTime:a.endTime})}if(a.bookings?.length)for(let o of a.bookings){if(!o.startTime||!o.endTime)continue;let l=o.startTime.length===5?`${o.startTime}:00`:o.startTime,u=o.endTime.length===5?`${o.endTime}:00`:o.endTime,c=Tg.BOOKING_TYPE_MAP[(o.bookingType||"").toUpperCase()]||Ft.RESERVED,d=this.generateBlockId(),p={id:d,court:n,start:`${s}T${l}`,end:`${s}T${u}`,type:c,reason:o.bookingType||"Booking",source:"SYSTEM"};this.blocksById.set(d,p),this.indexBlock(p)}}}}}getAllCourtsFromTournamentRecord(){if(!this.tournamentRecord?.venues)return[];let t=[];for(let e of this.tournamentRecord.venues){let i=Rh(e);if(e.courts)for(let r of e.courts)t.push({tournamentId:this.config.tournamentId,venueId:i,courtId:nh(r)})}return t}getFirstAvailableDay(){return this.tournamentRecord?.startDate?Ze(this.tournamentRecord.startDate):null}generateBlockId(){return`block-${this.nextBlockId++}`}clampToAvailability(t,e,i,r){let n=this.getCourtAvailability(t,e),a=`${e}T${n.startTime}:00`,s=`${e}T${n.endTime}:00`,o=i<a?a:i,l=r>s?s:r;return o>=l?null:{start:o,end:l}}listCourtMeta(){return this.getAllCourtsFromTournamentRecord().map(t=>this.getCourtMeta(t))}getCourtMeta(t){if(this.tournamentRecord?.venues){for(let e of this.tournamentRecord.venues)if(Rh(e)===t.venueId)for(let i of e.courts||[]){if(nh(i)!==t.courtId)continue;let r=this.getFirstAvailableDay(),n=r?this.getCourtAvailability(t,r):void 0;return{ref:t,name:i.courtName||i.courtId,surface:i.surfaceCategory||i.surfaceType||"hard",indoor:i.indoorOutdoor==="INDOOR"||i.indoor||!1,hasLights:i.hasLights||!1,tags:[],openTime:n?.startTime,closeTime:n?.endTime}}}return{ref:t,name:t.courtId,surface:"hard",indoor:!1,hasLights:!1,tags:[]}}},Tg.BOOKING_TYPE_MAP={MAINTENANCE:Ft.MAINTENANCE,PRACTICE:Ft.PRACTICE,RESERVED:Ft.RESERVED,MATCH:Ft.SCHEDULED,SCHEDULED:Ft.SCHEDULED},Tg),d6e={calculateNewRatings:Ele,generateDynamicRatings:Rle};AH.importMethods({...tH,...d6e});AH.importMethods(EB,!0,1);var _fe=AH,p6e={competitionFormatName:"INTENNSE_STANDARD",matchUpFormat:"SET7XA-S:T10P",sport:"INTENNSE",timerProfile:{shotClockSeconds:14,segmentTimers:[{segmentType:"set",direction:"down",minutes:10}],changeoverSeconds:0,setBreakSeconds:120},timeoutRules:{count:5,per:"MATCHUP",durationSeconds:60},substitutionRules:{allowed:!0,allowedMatchUpTypes:["SINGLES","DOUBLES"],timing:"BETWEEN_POINTS"},playerRules:{maxMinutesPerSegment:6,matchUpTypes:["SINGLES"]},penaltyProfile:{sport:"INTENNSE",penaltyTypes:[{penaltyType:"UNSPORTSMANLIKE_CONDUCT",label:"Unsportsmanlike",category:"conduct"},{penaltyType:"BALL_ABUSE",label:"Ball Abuse",category:"conduct"},{penaltyType:"RACKET_ABUSE",label:"Racket Abuse",category:"conduct"}],escalation:[{step:1,consequence:"warning"},{step:2,consequence:"point"},{step:3,consequence:"game"},{step:4,consequence:"default"}]},pointProfile:{sport:"INTENNSE",pointResults:[{result:"Ace",label:"Ace",isServe:!0},{result:"Winner",label:"Winner"},{result:"Serve Winner",label:"Serve Winner",isServe:!0},{result:"Forced Error",label:"Forced Error",isError:!0},{result:"Unforced Error",label:"Unforced Error",isError:!0},{result:"Double Fault",label:"Double Fault",isServe:!0,isError:!0},{result:"Touch",label:"Touch"},{result:"Penalty",label:"Penalty"}]},pointMultipliers:[{condition:{results:["Ace"]},value:2},{condition:{results:["Winner"]},value:2}]},f6e={competitionFormatName:"TENNIS_STANDARD",matchUpFormat:"SET3-S:6/TB7",sport:"TENNIS",timerProfile:{changeoverSeconds:90,setBreakSeconds:120},timeoutRules:{count:0,per:"MATCHUP"},substitutionRules:{allowed:!1},penaltyProfile:{sport:"TENNIS",penaltyTypes:[{penaltyType:"TIME_VIOLATION",label:"Time Violation",category:"time_violation"},{penaltyType:"COACHING",label:"Coaching",category:"code_violation"},{penaltyType:"UNSPORTSMANLIKE_CONDUCT",label:"Unsportsmanlike",category:"conduct"},{penaltyType:"BALL_ABUSE",label:"Ball Abuse",category:"conduct"},{penaltyType:"RACKET_ABUSE",label:"Racket Abuse",category:"conduct"},{penaltyType:"VERBAL_ABUSE",label:"Verbal Abuse",category:"conduct"},{penaltyType:"AUDIBLE_OBSCENITY",label:"Audible Obscenity",category:"conduct"},{penaltyType:"VISIBLE_OBSCENITY",label:"Visible Obscenity",category:"conduct"}],escalation:[{step:1,consequence:"warning"},{step:2,consequence:"point"},{step:3,consequence:"game"},{step:4,consequence:"default"}]},pointProfile:{sport:"TENNIS",pointResults:[{result:"Ace",label:"Ace",isServe:!0},{result:"Winner",label:"Winner"},{result:"Serve Winner",label:"Serve Winner",isServe:!0},{result:"Forced Error",label:"Forced Error",isError:!0},{result:"Unforced Error",label:"Unforced Error",isError:!0},{result:"Double Fault",label:"Double Fault",isServe:!0,isError:!0},{result:"Penalty",label:"Penalty"}]},pointMultipliers:[]},h6e={INTENNSE_STANDARD:p6e,TENNIS_STANDARD:f6e},m6e={[mw]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},g6e={[Cu]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[Dh,gb]}},I6e={[Cu]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[Dh,Sw,im],disabledActions:[]}]}},v6e={[Cu]:{policyName:"positionActionsDisabled",enabledStructures:!1}},y6e={[Kv]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},b6e={[vs]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:Ws,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[ke]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[Ma]:[],[Fl]:[],[Yt]:[],[Na]:[],[Ur]:[],[si]:[]}}},eO="Personal circumstance",w6e={[vs]:{requireAllPositionsAssigned:!1,stage:{[ke]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Ws,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Ws,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[Ma]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[Fl]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[Na]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[Yt]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[si]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:eO,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[Ur]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:eO,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[Mu]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:eO,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},S6e={[As]:{seedingProfile:{positioning:PU},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},U6e={POLICY_AVOIDANCE_COUNTRY:m6e,POLICY_POSITION_ACTIONS_DEFAULT:ule,POLICY_POSITION_ACTIONS_DISABLED:v6e,POLICY_POSITION_ACTIONS_NO_MOVEMENT:I6e,POLICY_POSITION_ACTIONS_UNRESTRICTED:g6e,POLICY_PRIVACY_DEFAULT:y6e,POLICY_ROUND_NAMING_DEFAULT:rV,POLICY_SCHEDULING_DEFAULT:Hue,POLICY_SCORING_DEFAULT:b6e,POLICY_SCORING_USTA:w6e,POLICY_SEEDING_ITF:S6e,POLICY_SEEDING_DEFAULT:Cue},OF={competitionFormats:h6e,ratingsParameters:Er,matchUpFormats:c_e,countryToFlag:Vae,tieFormats:sce,countries:gd,policies:U6e,flagIOC:s$e},CT={};ft(CT,{activeMatchUpStatuses:()=>O2,auditConstants:()=>Xze,competitionFormatConstants:()=>N6e,completedMatchUpStatuses:()=>Qi,directingMatchUpStatuses:()=>Pae,displayConstants:()=>wje,drawDefinitionConstants:()=>iae,entryStatusConstants:()=>m$e,errorConditionConstants:()=>t0e,eventConstants:()=>m_e,extensionConstants:()=>gae,flightConstants:()=>uqe,genderConstants:()=>s2,keyValueConstants:()=>dHe,matchUpActionConstants:()=>Eje,matchUpStatusConstants:()=>pN,matchUpTypes:()=>ULe,nonDirectingMatchUpStatuses:()=>Eae,particicipantsRequiredMatchUpStatuses:()=>Tae,participantConstants:()=>a$e,participantRoles:()=>bV,participantTypes:()=>pb,penaltyConstants:()=>K6e,policyConstants:()=>G_e,positionActionConstants:()=>NVe,rankingConstants:()=>vze,ratingConstants:()=>bBe,recoveryTimeRequiredMatchUpStatuses:()=>t$e,requestConstants:()=>r3e,resourceContants:()=>r_e,resultConstants:()=>LLe,scaleConstants:()=>$_e,scheduleConstants:()=>H$e,sortingConstants:()=>gqe,surfaceConstants:()=>t4e,tieFormatConstants:()=>d_e,timeItemConstants:()=>_$e,topicConstants:()=>i$e,tournamentConstants:()=>sle,upcomingMatchUpStatuses:()=>Rae,validMatchUpStatuses:()=>Dae,venueConstants:()=>n4e,weekdayConstants:()=>pce});var T6e="INTENNSE_STANDARD",D6e="TENNIS_STANDARD",P6e="MATCHUP",E6e="HALF",R6e="SEGMENT",C6e="BETWEEN_GAMES",M6e="BETWEEN_POINTS",N6e={INTENNSE_STANDARD:T6e,TENNIS_STANDARD:D6e,MATCHUP:P6e,SET:"SET",HALF:E6e,SEGMENT:R6e,BETWEEN_GAMES:C6e,BETWEEN_POINTS:M6e,ANY:"ANY"},A6e="Coaching",k6e="Ball Abuse",O6e="Racket Abuse",x6e="Verbal Abuse",F6e="INELIGIBILITY",L6e="Physical Abuse",_6e="Unsportmanlike Conduct",$6e="Dress Code Violation",B6e="Equipment Violation",V6e="Leaving the court",j6e="Failure to complete",G6e="No Show",H6e="Other",W6e="REFUSAL_TO_PLAY",z6e="PROHIBITED_SUBSTANCE",q6e="Puncuality",Y6e="Failure to sign in",K6e={COACHING:A6e,BALL_ABUSE:k6e,RACKET_ABUSE:O6e,VERBAL_ABUSE:x6e,PHYSICAL_ABUSE:L6e,INELIGIBILITY:F6e,UNSPORTSMANLIKE_CONDUCT:_6e,PROHIBITED_SUBSTANCE:z6e,DRESS_CODE_VIOLATION:$6e,EQUIMENT_VIOLATION:B6e,LEAVING_THE_COURT:V6e,REFUSAL_TO_PLAY:W6e,FAILURE_TO_COMPLETE:j6e,NO_SHOW:G6e,OTHER:H6e,PUNCTUALITY:q6e,FAILUIRE_TO_SIGN_IN:Y6e},X6e="CLAY",J6e="HARD",Q6e="GRASS",Z6e="CARPET",e4e="ARTIFICIAL",t4e={CLAY:X6e,HARD:J6e,GRASS:Q6e,CARPET:Z6e,ARTIFICIAL:e4e},i4e="INDOOR",r4e="OUTDOOR",n4e={INDOOR:i4e,OUTDOOR:r4e};const a4e=t=>gn("chc-flag",t?.variant&&`chc-flag--${t.variant}`);function s4e({matchUp:t,individualParticipant:e,spacer:i}){const r=e?.person?.iso2NationalityCode||"",n=r?OF.countryToFlag(r)?.slice(0,4):"",a=document.createElement("span"),s=t?.matchUpType?.toLowerCase();return i||(a.className=a4e({variant:s})),a.innerHTML=i?"":n,a}function tO({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n,side:a,type:s}){if(s==="scale")return wLe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n});const o=e?.configuration||{},l=document.createElement("div");if(s==="flag"&&o.flags)return s4e({matchUp:r,individualParticipant:t,spacer:n});if(s==="seeding"){const u=yLe({className:i,composition:e,side:a});return typeof u=="string"?l:u}return l}const o4e="Qualifier",l4e="BYE",u4e="TBD";function uY(t){const{isWinningSide:e,side:i,sideNumber:r,individualParticipant:n,matchUp:a,composition:s}=t||{},o=e?"winner":void 0,l=t.eventHandlers||{},u=s?.configuration,c={QUALIFIER:u?.placeHolders?.qualifier||o4e,BYE:u?.placeHolders?.bye||l4e,TBD:u?.placeHolders?.tbd||u4e},d=n?.participantName,p=U=>{ia(l?.participantClick)&&(U.stopPropagation(),l.participantClick({individualParticipant:n,pointerEvent:U,matchUp:a,side:i}))},f=document.createElement("div");f.classList.add("tmx-i"),f.setAttribute("sideNumber",String(r)),f.setAttribute("id",n?.participantId),f.onclick=p;const h=document.createElement("div");h.className=v1e();const m=u?.flags&&tO({...t,type:"flag"});if(m)h.appendChild(m);else{const U=tO({type:"scale",...t});U&&h.appendChild(U)}const g=document.createElement("div");g.className=y1e({variant:o});const I=a?.roundNumber===1,v=a?.drawType==="FEED_IN"&&a?.roundNumber>1&&i?.drawPosition&&!i?.sourceMatchUp,w=I||v,y=u?.persistInputFields;if(u?.inlineAssignment&&ia(l?.assignParticipant)&&ia(u?.participantProvider)&&w&&(!i?.bye||y)&&(!i?.qualifier||y)&&a&&(!d||i?.bye||i?.qualifier||y)){let U;i?.bye?U={participantId:"__BYE__",participantName:"â€” BYE â€”"}:i?.qualifier?U={participantId:"__QUALIFIER__",participantName:"â€” QUALIFIER â€”"}:U=n;const T=ILe({matchUp:a,side:i,sideNumber:r,eventHandlers:l,composition:s,currentParticipant:U});g.appendChild(T)}else if(d){const U=document.createElement("span");if(e&&u?.winnerColor)U.style.color=typeof u.winnerColor=="string"?u.winnerColor:"green";else if(u?.genderColor){const T=n?.person?.sex,D=T==="MALE"&&"#2E86C1"||T==="FEMALE"&&"#AA336A"||"";U.style.color=typeof u.genderColor=="string"?u.genderColor:D}U.innerHTML=d,g.appendChild(U)}else{const U=document.createElement("abbr");U.className=I1e({variant:u?.showAddress?"showAddress":""}),U.innerHTML=i?.bye&&c.BYE||i?.qualifier&&c.QUALIFIER||c.TBD,g.appendChild(U)}const b=tO({...t,className:vLe(),type:"seeding"});b&&g.appendChild(b),h.appendChild(g),f.appendChild(h);const S=R1e(t);return f.appendChild(S),{element:f}}const c4e=t=>gn("chc-pill",t?.variant&&`chc-pill--${t.variant}`),{WALKOVER:d4e,DEFAULTED:p4e,DOUBLE_WALKOVER:f4e,DOUBLE_DEFAULT:h4e,ABANDONED:m4e}=pN;function g4e({matchUpStatus:t}){const e=t?.toLowerCase(),i=["defaulted","retired","walkover","defaulted","double_walkover","double_default","cancelled","in_progress","awaiting_result","dead_rubber","incomplete","suspended","abandoned"].includes(e)?e:void 0,r=[d4e,f4e].includes(t||"")?"WO":[p4e,h4e].includes(t||"")?"DEF":t===m4e?"ABD":t?.split("_").join("").slice(0,3)||"",n=document.createElement("div");n.className=c4e(i?{variant:i}:{});const a=document.createElement("abbr");return a.setAttribute("title",t||""),a.style.textDecoration="none",a.style.borderBottom="none",a.innerHTML=r,n.appendChild(a),n}function I4e(t){return t instanceof Element||t}const v4e=()=>"chc-team-logo";function y4e({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=v4e(),e}const b4e=()=>"chc-side-container",w4e=()=>"chc-side-row",S4e=()=>"chc-tick";function U4e({dim:t="20px"}={}){const e=S4e();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}const{WALKOVER:T4e,DEFAULTED:D4e,DOUBLE_WALKOVER:P4e,DOUBLE_DEFAULT:E4e,RETIRED:R4e,SUSPENDED:C4e,CANCELLED:M4e,IN_PROGRESS:N4e,ABANDONED:A4e}=pN;function $fe({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:r,participant:n,placeholder:a,sideNumber:s,matchUp:o}){const{winningSide:l,matchUpType:u,isRoundRobin:c,matchUpStatus:d}=o||{},p=r?.configuration;let f;const h=s?o?.sides?.find(E=>E.sideNumber===s):void 0;n||(n=h?.participant,f=p?.allDrawPositions||p?.drawPositions&&h?.drawPosition&&(o?.roundNumber===t||h?.participantFed||c)?h?.drawPosition:"");const m=u==="DOUBLES",g=m?n?.individualParticipants?.[0]:n,I=m&&n?.individualParticipants?.[1],v=!!(s===l||d==="BYE"&&n),w=p?.winnerChevron&&v,y=p?.teamLogo,b=[R4e,T4e,D4e,P4e,E4e,C4e,M4e,N4e,A4e].includes(d)&&!v,S=p?.gameScoreOnly,U=document.createElement("div");if(i&&(U.className=w1e({drawPosition:f,sideNumber:s}),f&&(U.dataset.drawPosition=String(f))),U.classList.add("tmx-p"),U.setAttribute("id",n?.participantId||""),y){const E=y4e({teamLogo:y});U.appendChild(E)}const T=document.createElement("div");T.className=b1e(m?{variant:"doubles"}:{});const D=document.createElement("div");D.className=S1e({winnerChevron:w,isDoubles:m});const P=uY({individualParticipant:g,eventHandlers:e,isWinningSide:v,composition:r,sideNumber:s,matchUp:o,side:h}).element;if(D.appendChild(P),I){const E=uY({individualParticipant:I,eventHandlers:e,isWinningSide:v,composition:r,sideNumber:s,matchUp:o,side:h}).element;D.appendChild(E)}else m&&a&&I4e(a)&&D.appendChild(a);if(T.appendChild(D),U.appendChild(T),i){const E=document.createElement("div");if(v&&!S){const R=U4e();typeof R=="string"?E.innerHTML=R:E.appendChild(R)}else if(b){const R=g4e({matchUpStatus:d});E.appendChild(R)}U.appendChild(E)}return U}const k4e=()=>"chc-round-header";function O4e({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:r,context:n}){const a=document.createElement("div");a.className=k4e(),a.classList.add("tmx-rh"),a.setAttribute("roundNumber",String(r));const s=ia(t?.roundVisibilityClick),o=ia(t?.roundHeaderClick);o&&(a.onclick=p=>t.roundHeaderClick({roundNumber:r,roundProfile:i,roundMatchUps:e,context:n,pointerEvent:p}));const l=i?.[r]?.roundName;if(!l)return a;const u=document.createElement("div");u.style.cssText="display:flex; flex-direction:row; justify-content:space-between;";const c=document.createElement("div");c.textContent=l,u.appendChild(c);const d=document.createElement("div");if(d.style.cssText="display:flex; align-items:center; gap:4px;",s){const p=n?.roundVisibilityState?.[r],f=p?.hidden===!0,h=p?.embargoed===!0,m=f?"fa-eye-slash":h?"fa-clock":"fa-eye",g=f?"#e74c3c":h?"#f39c12":"inherit",I=f||h?"0.85":"0.7",v=document.createElement("i");v.className=`fa-solid ${m} tmx-rh-vis`,v.style.cssText=`cursor:pointer; font-size:0.85rem; color:${g}; opacity:${I}; transition:opacity 0.15s;`,v.onmouseenter=()=>v.style.opacity="1",v.onmouseleave=()=>v.style.opacity=I,v.onclick=w=>{w.stopPropagation(),t.roundVisibilityClick({roundNumber:r,roundProfile:i,roundMatchUps:e,context:n,pointerEvent:w})},d.appendChild(v)}if(o){const p=document.createElement("span");p.style.cssText="font-weight:bold; cursor:pointer;",p.textContent="â‹®",d.appendChild(p)}return u.appendChild(d),a.appendChild(u),a}const Bfe=()=>"chc-round-container",x4e=()=>"chc-structure",Vfe=t=>gn("chc-round",t?.variant==="adHoc"&&"chc-round--adhoc"),F4e=t=>gn("chc-group-separator",t?.variant===0&&"chc-group-separator--0",t?.roundOrder==="first"&&"chc-group-separator--round-first",t?.roundOrder==="last"&&"chc-group-separator--round-last"),L4e=()=>"chc-group-name",cY=t=>gn("chc-results-item",t?.variant&&`chc-results-item--${t.variant}`),_4e=()=>"chc-results-info";function $4e(){return"chc-selected-matchup"}const B4e=()=>"chc-matchup-container";function V4e({configuration:t}){return t?.matchUpHover?"chc-matchup chc-matchup--custom-hover":"chc-matchup"}function j4e({variant:t}){return gn("chc-center-info",t!=null&&`chc-center-info--${t}`)}const G4e=()=>"chc-column",H4e=()=>"chc-entry",dY=()=>"chc-status";function W4e({eventHandlers:t,entryStatus:e,sideNumber:i,className:r,matchUp:n}){const a=document.createElement("div");ia(t?.centerInfoClick)&&(a.onclick=c=>t.centerInfoClick({matchUp:n,sideNumber:i,pointerEvent:c})),a.className=gn(j4e({variant:i}),r),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",String(i));const s=document.createElement("div");s.className=G4e();const o=document.createElement("div");o.className=H4e();const l=document.createElement("div");l.className=dY(),l.innerHTML=e?"Entry status:&nbsp;":"",o.appendChild(l);const u=document.createElement("div");return u.className=dY(),u.innerHTML=e||"",o.appendChild(u),s.appendChild(o),a.appendChild(s),{element:a}}const pY={scheduleInfo:1.8,centerInfo:1.5};function z4e({composition:t,isDoubles:e,roundFactor:i=1}){const r=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),n=t?.configuration||{},a=n?.connectorWidth||16,s=n.centerInfo?pY.centerInfo*r:0,o=n.scheduleInfo?pY.scheduleInfo*r:0,l=(60+(n.showAddress?r:0))*(e?1.3:1)+s,u=l*i,c=(l+o)*i;return d=>{const p=gn("chc-link",d.isFirstRound&&"chc-link--first-round",d.link==="mr"&&"chc-link--no-link",d.link==="m1"&&"chc-link--m1",d.link==="m2"&&"chc-link--m2",d.link==="m0"&&"chc-link--m0",d.link==="noProgression"&&"chc-link--no-progression");return{className:p,applyStyles(f){f.style.setProperty("--chc-connector-w",`${a}px`),f.style.setProperty("--chc-link-m1-h",`${u}px`),f.style.setProperty("--chc-link-m2-h",`${c}px`)},toString(){return p}}}}const jfe=t=>e=>gn("chc-score-wrapper",(e?.sideNumber===1||String(e?.sideNumber)==="1")&&"chc-score-wrapper--side1",e?.fontSize==="small"&&"chc-score-wrapper--small"),q4e=()=>"chc-tiebreak",Gfe=t=>gn("chc-game-score",t?.variant&&`chc-game-score--${t.variant}`),Y4e=()=>"chc-game-wrapper";function K4e({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=Gfe(),e.value=String(t||""),e}function X4e({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:r}){const n=r===i?.winningSide||i?.winningSide?"loser":void 0,a=r===2?i.side2Score:i.side1Score,s=i.side2TiebreakScore||i.side1TiebreakScore,o=r===2?i.side2TiebreakScore:i.side1TiebreakScore,l=a===void 0&&o,u=l||a,c=e&&i.setNumber%2?"var(--chc-bg-secondary)":"transparent",d=i.editing?i.editing===r:void 0;let p;if(d)p=K4e({value:u});else if(p=document.createElement("p"),p.className=Gfe({variant:n}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=c,p.innerHTML=isNaN(u)?"":u,!t){const f=document.createElement("span");f.className=q4e(),f.innerHTML=s&&!l?String(o):"",p.appendChild(f)}return p}function J4e({participantHeight:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:n}){const a=i?.configuration?.winnerChevron,s=i?.configuration?.gameScoreOnly,o=n?.score?.sets||[],l=i?.configuration?.scoreBox,u=t?r===2?t:t-1:void 0,c=f=>{ia(e?.scoreClick)&&(f.stopPropagation(),e.scoreClick({pointerEvent:f,matchUp:n}))},d=document.createElement("div");d.className=jfe()({...!l&&r===1&&{sideNumber:1},fontSize:"small"}),u&&(d.style.height=`${u}px`),d.classList.add("sideScore"),d.classList.add("tmx-scr"),d.onclick=c;const p=document.createElement("div");p.className=Y4e();for(const f of o||[]){const h=X4e({gameScoreOnly:s,scoreStripes:a,sideNumber:r,set:f});p.appendChild(h)}return d.appendChild(p),d}const Q4e=()=>"chc-scheduling";var xF={exports:{}},Z4e=xF.exports,fY;function eKe(){return fY||(fY=1,(function(t,e){(function(i,r){t.exports=r()})(Z4e,(function(){var i=1e3,r=6e4,n=36e5,a="millisecond",s="second",o="minute",l="hour",u="day",c="week",d="month",p="quarter",f="year",h="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,I=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var N=["th","st","nd","rd"],A=M%100;return"["+M+(N[(A-20)%10]||N[A]||N[0])+"]"}},w=function(M,N,A){var O=String(M);return!O||O.length>=N?M:""+Array(N+1-O.length).join(A)+M},y={s:w,z:function(M){var N=-M.utcOffset(),A=Math.abs(N),O=Math.floor(A/60),k=A%60;return(N<=0?"+":"-")+w(O,2,"0")+":"+w(k,2,"0")},m:function M(N,A){if(N.date()<A.date())return-M(A,N);var O=12*(A.year()-N.year())+(A.month()-N.month()),k=N.clone().add(O,d),F=A-k<0,x=N.clone().add(O+(F?-1:1),d);return+(-(O+(A-k)/(F?k-x:x-k))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:d,y:f,w:c,d:u,D:h,h:l,m:o,s,ms:a,Q:p}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},b="en",S={};S[b]=v;var U="$isDayjsObject",T=function(M){return M instanceof R||!(!M||!M[U])},D=function M(N,A,O){var k;if(!N)return b;if(typeof N=="string"){var F=N.toLowerCase();S[F]&&(k=F),A&&(S[F]=A,k=F);var x=N.split("-");if(!k&&x.length>1)return M(x[0])}else{var L=N.name;S[L]=N,k=L}return!O&&k&&(b=k),k||!O&&b},P=function(M,N){if(T(M))return M.clone();var A=typeof N=="object"?N:{};return A.date=M,A.args=arguments,new R(A)},E=y;E.l=D,E.i=T,E.w=function(M,N){return P(M,{locale:N.$L,utc:N.$u,x:N.$x,$offset:N.$offset})};var R=(function(){function M(A){this.$L=D(A.locale,null,!0),this.parse(A),this.$x=this.$x||A.x||{},this[U]=!0}var N=M.prototype;return N.parse=function(A){this.$d=(function(O){var k=O.date,F=O.utc;if(k===null)return new Date(NaN);if(E.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var x=k.match(g);if(x){var L=x[2]-1||0,$=(x[7]||"0").substring(0,3);return F?new Date(Date.UTC(x[1],L,x[3]||1,x[4]||0,x[5]||0,x[6]||0,$)):new Date(x[1],L,x[3]||1,x[4]||0,x[5]||0,x[6]||0,$)}}return new Date(k)})(A),this.init()},N.init=function(){var A=this.$d;this.$y=A.getFullYear(),this.$M=A.getMonth(),this.$D=A.getDate(),this.$W=A.getDay(),this.$H=A.getHours(),this.$m=A.getMinutes(),this.$s=A.getSeconds(),this.$ms=A.getMilliseconds()},N.$utils=function(){return E},N.isValid=function(){return this.$d.toString()!==m},N.isSame=function(A,O){var k=P(A);return this.startOf(O)<=k&&k<=this.endOf(O)},N.isAfter=function(A,O){return P(A)<this.startOf(O)},N.isBefore=function(A,O){return this.endOf(O)<P(A)},N.$g=function(A,O,k){return E.u(A)?this[O]:this.set(k,A)},N.unix=function(){return Math.floor(this.valueOf()/1e3)},N.valueOf=function(){return this.$d.getTime()},N.startOf=function(A,O){var k=this,F=!!E.u(O)||O,x=E.p(A),L=function(K,X){var Z=E.w(k.$u?Date.UTC(k.$y,X,K):new Date(k.$y,X,K),k);return F?Z:Z.endOf(u)},$=function(K,X){return E.w(k.toDate()[K].apply(k.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(X)),k)},V=this.$W,_=this.$M,B=this.$D,G="set"+(this.$u?"UTC":"");switch(x){case f:return F?L(1,0):L(31,11);case d:return F?L(1,_):L(0,_+1);case c:var j=this.$locale().weekStart||0,Y=(V<j?V+7:V)-j;return L(F?B-Y:B+(6-Y),_);case u:case h:return $(G+"Hours",0);case l:return $(G+"Minutes",1);case o:return $(G+"Seconds",2);case s:return $(G+"Milliseconds",3);default:return this.clone()}},N.endOf=function(A){return this.startOf(A,!1)},N.$set=function(A,O){var k,F=E.p(A),x="set"+(this.$u?"UTC":""),L=(k={},k[u]=x+"Date",k[h]=x+"Date",k[d]=x+"Month",k[f]=x+"FullYear",k[l]=x+"Hours",k[o]=x+"Minutes",k[s]=x+"Seconds",k[a]=x+"Milliseconds",k)[F],$=F===u?this.$D+(O-this.$W):O;if(F===d||F===f){var V=this.clone().set(h,1);V.$d[L]($),V.init(),this.$d=V.set(h,Math.min(this.$D,V.daysInMonth())).$d}else L&&this.$d[L]($);return this.init(),this},N.set=function(A,O){return this.clone().$set(A,O)},N.get=function(A){return this[E.p(A)]()},N.add=function(A,O){var k,F=this;A=Number(A);var x=E.p(O),L=function(_){var B=P(F);return E.w(B.date(B.date()+Math.round(_*A)),F)};if(x===d)return this.set(d,this.$M+A);if(x===f)return this.set(f,this.$y+A);if(x===u)return L(1);if(x===c)return L(7);var $=(k={},k[o]=r,k[l]=n,k[s]=i,k)[x]||1,V=this.$d.getTime()+A*$;return E.w(V,this)},N.subtract=function(A,O){return this.add(-1*A,O)},N.format=function(A){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||m;var F=A||"YYYY-MM-DDTHH:mm:ssZ",x=E.z(this),L=this.$H,$=this.$m,V=this.$M,_=k.weekdays,B=k.months,G=k.meridiem,j=function(X,Z,Q,ae){return X&&(X[Z]||X(O,F))||Q[Z].slice(0,ae)},Y=function(X){return E.s(L%12||12,X,"0")},K=G||function(X,Z,Q){var ae=X<12?"AM":"PM";return Q?ae.toLowerCase():ae};return F.replace(I,(function(X,Z){return Z||(function(Q){switch(Q){case"YY":return String(O.$y).slice(-2);case"YYYY":return E.s(O.$y,4,"0");case"M":return V+1;case"MM":return E.s(V+1,2,"0");case"MMM":return j(k.monthsShort,V,B,3);case"MMMM":return j(B,V);case"D":return O.$D;case"DD":return E.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return j(k.weekdaysMin,O.$W,_,2);case"ddd":return j(k.weekdaysShort,O.$W,_,3);case"dddd":return _[O.$W];case"H":return String(L);case"HH":return E.s(L,2,"0");case"h":return Y(1);case"hh":return Y(2);case"a":return K(L,$,!0);case"A":return K(L,$,!1);case"m":return String($);case"mm":return E.s($,2,"0");case"s":return String(O.$s);case"ss":return E.s(O.$s,2,"0");case"SSS":return E.s(O.$ms,3,"0");case"Z":return x}return null})(X)||x.replace(":","")}))},N.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},N.diff=function(A,O,k){var F,x=this,L=E.p(O),$=P(A),V=($.utcOffset()-this.utcOffset())*r,_=this-$,B=function(){return E.m(x,$)};switch(L){case f:F=B()/12;break;case d:F=B();break;case p:F=B()/3;break;case c:F=(_-V)/6048e5;break;case u:F=(_-V)/864e5;break;case l:F=_/n;break;case o:F=_/r;break;case s:F=_/i;break;default:F=_}return k?F:E.a(F)},N.daysInMonth=function(){return this.endOf(d).$D},N.$locale=function(){return S[this.$L]},N.locale=function(A,O){if(!A)return this.$L;var k=this.clone(),F=D(A,O,!0);return F&&(k.$L=F),k},N.clone=function(){return E.w(this.$d,this)},N.toDate=function(){return new Date(this.valueOf())},N.toJSON=function(){return this.isValid()?this.toISOString():null},N.toISOString=function(){return this.$d.toISOString()},N.toString=function(){return this.$d.toUTCString()},M})(),C=R.prototype;return P.prototype=C,[["$ms",a],["$s",s],["$m",o],["$H",l],["$W",u],["$M",d],["$y",f],["$D",h]].forEach((function(M){C[M[1]]=function(N){return this.$g(N,M[0],M[1])}})),P.extend=function(M,N){return M.$i||(M(N,R,P),M.$i=!0),P},P.locale=D,P.isDayjs=T,P.unix=function(M){return P(1e3*M)},P.en=S[b],P.Ls=S,P.p={},P}))})(xF)),xF.exports}var tKe=eKe();const iKe=bB(tKe);function rKe({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:r,venueAbbreviation:n,courtName:a}=t?.schedule||{},{dateTime:{extractDate:s,extractTime:o}}=RH,l=o(i);let u=s(r),c="ddd D MMMM";l&&(c+=", hh:mm A",u+=`T${l}`);const d=r?iKe(u).format(c):"Not scheduled",p=n&&a?.toString().startsWith(n)&&a||n&&a&&`${n} ${a}`||a||n||"",f=document.createElement("div");f.className=Q4e(),f.classList.add("tmx-sch"),ia(e?.scheduleClick)&&(f.onclick=v=>e.scheduleClick({matchUp:t,pointerEvent:v}));const h=document.createElement("div");h.innerHTML=d,f.append(h);const m=v=>{ia(e?.venueClick)&&(v.stopPropagation(),e.venueClick({pointerEvent:v,matchUp:t}))},g=document.createElement("div");g.style="display: flex; flex-direction: row";const I=document.createElement("div");if(I.style.paddingRight=".2rem",I.onclick=m,I.innerHTML=p,g.append(I),f.append(g),f.onclick){const v=document.createElement("div");v.innerHTML="â‹®",g.append(v)}return f}const{completedMatchUpStatuses:nKe}=CT;function hY({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:r,className:n,matchUp:a}){const s=(i?.configuration||{})?.scheduleInfo,o=a?.score?.scoreStringSide1,l=i?.configuration?.scoreBox&&o,u=a?.matchUpStatus&&nKe.includes(a.matchUpStatus),c=a?.readyToScore&&e?.scoreClick&&!_fe.checkScoreHasValue({matchUp:a})&&!u,d=document.createElement("div");if(d.className=gn(b4e(),n),d.classList.add("tmx-sd"),d.setAttribute("sideNumber",String(r)),s&&r===1){const h=rKe({matchUp:a,eventHandlers:e});d.appendChild(h)}const p=document.createElement("div");p.className=w4e();const f=$fe({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:a});if(p.appendChild(f),l){const h=document.createElement("div");h.style.border="1px solid var(--chc-border-secondary)",p.appendChild(h)}if(o){const h=J4e({eventHandlers:e,composition:i,sideNumber:r,matchUp:a});p.appendChild(h)}if(c){const h=g=>{ia(e?.scoreClick)&&(g.stopPropagation(),e.scoreClick({pointerEvent:g,matchUp:a}))},m=document.createElement("div");m.className=jfe()({...!l&&r===1&&{sideNumber:1},fontSize:"small"}),m.onclick=h,m.innerHTML="[Score]",p.appendChild(m)}return d.appendChild(p),d}function aKe(t){const{composition:e,initialRoundNumber:i=1,matchUp:r,moiety:n,selectedMatchUpId:a,searchActive:s}=t,{roundFactor:o,roundNumber:l,finishingRound:u,matchUpType:c,preFeedRound:d,stage:p}=r,f=t.isFinalRound||(u?Number.parseInt(String(u))===1:!1),h=p==="QUALIFYING"&&f,m=f,g=l?Number.parseInt(String(l))===i:!1,I=c==="DOUBLES",v=(s||r.isRoundRobin||r.collectionId||t.isLucky||t.isAdHoc)&&"mr"||m&&"noProgression"||(h||d)&&"m0"||n&&"m1"||"m2",w=z4e({composition:e,isDoubles:I,roundFactor:o})({isFirstRound:g,link:v}),y=w.className,b=e?.configuration||{},{resultsInfo:S,centerInfo:U}=b||{},T=t.eventHandlers||{},D=N=>{ia(T?.matchUpClick)&&T.matchUpClick({pointerEvent:N,matchUp:r})},P=document.createElement("div");P.className=gn(e?.theme,t?.className,"matchup",B4e()),P.classList.add("tmx-m"),P.setAttribute("id",r?.matchUpId),P.onclick=D;const E=document.createElement("div");E.className=V4e({configuration:b});const R=({sideNumber:N})=>{const A=r?.sides?.find(O=>O.sideNumber===N)?.participant?.entryStatus?.replace("_"," ");return W4e({eventHandlers:T,entryStatus:A,sideNumber:N,className:N===2?y:void 0,matchUp:r})},C=hY({initialRoundNumber:i,eventHandlers:T,sideNumber:1,composition:e,matchUp:r}),M=hY({className:!U&&y,initialRoundNumber:i,eventHandlers:T,sideNumber:2,composition:e,matchUp:r});if(E.appendChild(C),U){const N=R({sideNumber:1}),A=R({sideNumber:2});E.appendChild(N.element),A.element&&w.applyStyles(A.element),E.appendChild(A.element)}if(E.appendChild(M),U||w.applyStyles(M),S){const N=sKe({score:r.score});E.appendChild(N)}if(P.appendChild(E),a===r.matchUpId){const N=document.createElement("div");N.className=$4e(),P.appendChild(N)}return P}function sKe({score:t}){const e=t?.sets?.filter(Boolean).sort((a,s)=>(a.setNumber||0)-(s.setNumber||0)),i=e?.at(-1),r=i?.side1PointsScore||i?.side2PointsScore,n=document.createElement("div");if(n.className=_4e(),r){const a=document.createElement("div");a.className=cY({variant:"points"}),a.innerHTML="PTS",n.appendChild(a)}for(const a of e||[]){const s=document.createElement("div");s.setAttribute("key",String(a.setNumber)),s.className=cY({variant:"set"}),s.innerHTML=String(a.setNumber),n.appendChild(s)}return n}function oKe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,isRoundRobin:n,searchActive:a,composition:s,roundFactor:o,roundNumber:l,roundProfile:u,minWidth:c,matchUps:d,context:p,isLucky:f}){const h=d.filter(P=>P.roundNumber===l).sort((P,E)=>(P.roundPosition||0)-(E.roundPosition||0)),m=h.every(({roundPosition:P,drawPositions:E})=>!P&&!E),g=s?.configuration||{},I=document.createElement("div");if(I.className=Bfe(),I.classList.add("tmx-rd"),I.setAttribute("roundNumber",String(l)),g.roundHeader){const P=O4e({roundProfile:u,roundMatchUps:h,roundNumber:l,eventHandlers:i,context:p});I.appendChild(P)}const v=document.createElement("div");v.className=Vfe({variant:m?"adHoc":void 0}),c&&(v.style.minWidth=c);let w,y,b;if(n){const P=R=>(R||[]).reduce((C,M)=>M+C,0);h.sort((R,C)=>{const M=P(R.drawPositions)-P(C.drawPositions),N=R.drawPositions||[],A=C.drawPositions||[],O=(N.length?Math.min.apply(null,N):0)-(A.length?Math.min.apply(null,A):0);return M||O});const E=h.reduce((R,C)=>(R[C.structureId]=C.structureName,R),{});w=Object.values(E),y=Object.keys(E),b=Object.keys(RH.instanceCount(h.map(({structureId:R})=>R))).length}else m&&h.sort((P,E)=>(P.roundOrder??0)-(E.roundOrder??0));const S=b&&h.length/b,U=Object.keys(u).map(P=>parseInt(P)),T=U.indexOf(l),D=T===0&&"first"||T===U.length-1&&"last";return h.forEach((P,E)=>{const R=S&&!(E%S),C=S&&Math.floor(E/S),M=S&&w[C];if(R){const O=document.createElement("div");O.className=F4e({...C===0&&{variant:0},...D&&{roundOrder:D}}),v.appendChild(O);const k=document.createElement("div");if(k.className=L4e(),ia(i?.groupHeaderClick)){const{drawId:F,containerStructureId:x}=h[0];v.onclick=L=>i.groupHeaderClick({structureId:y[C],containerStructureId:x,pointerEvent:L,drawId:F})}l===t&&(k.innerHTML=M),v.appendChild(k)}const N=E%2===0;o?P.roundFactor=o:P.roundFactor||(P.roundFactor=Math.pow(2,l-t));const A=aKe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,searchActive:a,composition:s,isAdHoc:m,isLucky:f,matchUp:P,moiety:N});v.appendChild(A)}),I.appendChild(v),I}function lKe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:r,composition:n,structureId:a,finalColumn:s,matchUps:o,minWidth:l,context:u}){const{roundNumbers:c,roundProfile:d,hasOddMatchUpsCount:p,isNotEliminationStructure:f}=_fe.getRoundMatchUps({matchUps:o});a=a||u?.structureId||o?.[0]?.structureId;const h=o.some(({isRoundRobin:v})=>v),m=p||f,g=document.createElement("div");g.className=x4e(),g.classList.add("tmx-str"),g.setAttribute("id",a||"");const I=c.length?Math.max.apply(null,c):0;for(const v of c){if(v<t)continue;const w=oKe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:v===I,isRoundRobin:h,searchActive:r,composition:n,roundNumber:v,roundProfile:d,matchUps:o,minWidth:l,context:u,isLucky:m});g.appendChild(w)}if(s&&typeof s!="boolean"){const v=document.createElement("div");v.className=Bfe();const w=document.createElement("div");w.className=Vfe(),w.appendChild(s),v.appendChild(w),g.appendChild(v)}return g}const mY=()=>"chc-container";function uKe({content:t,theme:e}){const i=document.createElement("div");return i.className=e?gn(mY(),e):mY(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}function yy(t,e){return`chc-theme-${t.replace("-theme","")}`}const gY=yy("australian-theme"),cKe=yy("wimbledon-theme"),dKe=yy("french-theme"),pKe=yy("usopen-theme"),IY=yy("basic-theme"),fKe=yy("itf-theme"),hKe={Australian:{configuration:{flags:!0},theme:gY},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:IY},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:IY},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:dKe},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:cKe},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:pKe},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:fKe},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:gY}},{WTN:ztt,UTR:qtt}=CT.ratingConstants;new Date().toISOString().split("T")[0];new Date().toISOString().split("T")[0];const{WTN:Ytt,UTR:Ktt,TRN:Xtt,NTRP:Jtt,DUPR:Qtt}=CT.ratingConstants,{RATING:Ztt}=CT.scaleConstants,{validateMatchUpScore:eit,validateSetScore:tit}=EB.scoreGovernor;var Ks="top",Pl="bottom",El="right",Xs="left",kH="auto",MT=[Ks,Pl,El,Xs],YI="start",Nw="end",mKe="clippingParents",Hfe="viewport",Cy="popper",gKe="reference",vY=MT.reduce(function(t,e){return t.concat([e+"-"+YI,e+"-"+Nw])},[]),Wfe=[].concat(MT,[kH]).reduce(function(t,e){return t.concat([e,e+"-"+YI,e+"-"+Nw])},[]),IKe="beforeRead",vKe="read",yKe="afterRead",bKe="beforeMain",wKe="main",SKe="afterMain",UKe="beforeWrite",TKe="write",DKe="afterWrite",PKe=[IKe,vKe,yKe,bKe,wKe,SKe,UKe,TKe,DKe];function Fc(t){return t?(t.nodeName||"").toLowerCase():null}function $o(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function am(t){var e=$o(t).Element;return t instanceof e||t instanceof Element}function ol(t){var e=$o(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function OH(t){if(typeof ShadowRoot>"u")return!1;var e=$o(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function EKe(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var r=e.styles[i]||{},n=e.attributes[i]||{},a=e.elements[i];!ol(a)||!Fc(a)||(Object.assign(a.style,r),Object.keys(n).forEach(function(s){var o=n[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function RKe(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(r){var n=e.elements[r],a=e.attributes[r]||{},s=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:i[r]),o=s.reduce(function(l,u){return l[u]="",l},{});!ol(n)||!Fc(n)||(Object.assign(n.style,o),Object.keys(a).forEach(function(l){n.removeAttribute(l)}))})}}const zfe={name:"applyStyles",enabled:!0,phase:"write",fn:EKe,effect:RKe,requires:["computeStyles"]};function cc(t){return t.split("-")[0]}var Mh=Math.max,BE=Math.min,KI=Math.round;function FF(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function qfe(){return!/^((?!chrome|android).)*safari/i.test(FF())}function XI(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var r=t.getBoundingClientRect(),n=1,a=1;e&&ol(t)&&(n=t.offsetWidth>0&&KI(r.width)/t.offsetWidth||1,a=t.offsetHeight>0&&KI(r.height)/t.offsetHeight||1);var s=am(t)?$o(t):window,o=s.visualViewport,l=!qfe()&&i,u=(r.left+(l&&o?o.offsetLeft:0))/n,c=(r.top+(l&&o?o.offsetTop:0))/a,d=r.width/n,p=r.height/a;return{width:d,height:p,top:c,right:u+d,bottom:c+p,left:u,x:u,y:c}}function xH(t){var e=XI(t),i=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:r}}function Yfe(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&OH(i)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Ld(t){return $o(t).getComputedStyle(t)}function CKe(t){return["table","td","th"].indexOf(Fc(t))>=0}function xf(t){return((am(t)?t.ownerDocument:t.document)||window.document).documentElement}function jA(t){return Fc(t)==="html"?t:t.assignedSlot||t.parentNode||(OH(t)?t.host:null)||xf(t)}function yY(t){return!ol(t)||Ld(t).position==="fixed"?null:t.offsetParent}function MKe(t){var e=/firefox/i.test(FF()),i=/Trident/i.test(FF());if(i&&ol(t)){var r=Ld(t);if(r.position==="fixed")return null}var n=jA(t);for(OH(n)&&(n=n.host);ol(n)&&["html","body"].indexOf(Fc(n))<0;){var a=Ld(n);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return n;n=n.parentNode}return null}function NT(t){for(var e=$o(t),i=yY(t);i&&CKe(i)&&Ld(i).position==="static";)i=yY(i);return i&&(Fc(i)==="html"||Fc(i)==="body"&&Ld(i).position==="static")?e:i||MKe(t)||e}function FH(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function yb(t,e,i){return Mh(t,BE(e,i))}function NKe(t,e,i){var r=yb(t,e,i);return r>i?i:r}function Kfe(){return{top:0,right:0,bottom:0,left:0}}function Xfe(t){return Object.assign({},Kfe(),t)}function Jfe(t,e){return e.reduce(function(i,r){return i[r]=t,i},{})}var AKe=function(t,e){return t=typeof t=="function"?t(Object.assign({},e.rects,{placement:e.placement})):t,Xfe(typeof t!="number"?t:Jfe(t,MT))};function kKe(t){var e,i=t.state,r=t.name,n=t.options,a=i.elements.arrow,s=i.modifiersData.popperOffsets,o=cc(i.placement),l=FH(o),u=[Xs,El].indexOf(o)>=0,c=u?"height":"width";if(!(!a||!s)){var d=AKe(n.padding,i),p=xH(a),f=l==="y"?Ks:Xs,h=l==="y"?Pl:El,m=i.rects.reference[c]+i.rects.reference[l]-s[l]-i.rects.popper[c],g=s[l]-i.rects.reference[l],I=NT(a),v=I?l==="y"?I.clientHeight||0:I.clientWidth||0:0,w=m/2-g/2,y=d[f],b=v-p[c]-d[h],S=v/2-p[c]/2+w,U=yb(y,S,b),T=l;i.modifiersData[r]=(e={},e[T]=U,e.centerOffset=U-S,e)}}function OKe(t){var e=t.state,i=t.options,r=i.element,n=r===void 0?"[data-popper-arrow]":r;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||Yfe(e.elements.popper,n)&&(e.elements.arrow=n))}const xKe={name:"arrow",enabled:!0,phase:"main",fn:kKe,effect:OKe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function JI(t){return t.split("-")[1]}var FKe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function LKe(t,e){var i=t.x,r=t.y,n=e.devicePixelRatio||1;return{x:KI(i*n)/n||0,y:KI(r*n)/n||0}}function bY(t){var e,i=t.popper,r=t.popperRect,n=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,d=t.isFixed,p=s.x,f=p===void 0?0:p,h=s.y,m=h===void 0?0:h,g=typeof c=="function"?c({x:f,y:m}):{x:f,y:m};f=g.x,m=g.y;var I=s.hasOwnProperty("x"),v=s.hasOwnProperty("y"),w=Xs,y=Ks,b=window;if(u){var S=NT(i),U="clientHeight",T="clientWidth";if(S===$o(i)&&(S=xf(i),Ld(S).position!=="static"&&o==="absolute"&&(U="scrollHeight",T="scrollWidth")),S=S,n===Ks||(n===Xs||n===El)&&a===Nw){y=Pl;var D=d&&S===b&&b.visualViewport?b.visualViewport.height:S[U];m-=D-r.height,m*=l?1:-1}if(n===Xs||(n===Ks||n===Pl)&&a===Nw){w=El;var P=d&&S===b&&b.visualViewport?b.visualViewport.width:S[T];f-=P-r.width,f*=l?1:-1}}var E=Object.assign({position:o},u&&FKe),R=c===!0?LKe({x:f,y:m},$o(i)):{x:f,y:m};if(f=R.x,m=R.y,l){var C;return Object.assign({},E,(C={},C[y]=v?"0":"",C[w]=I?"0":"",C.transform=(b.devicePixelRatio||1)<=1?"translate("+f+"px, "+m+"px)":"translate3d("+f+"px, "+m+"px, 0)",C))}return Object.assign({},E,(e={},e[y]=v?m+"px":"",e[w]=I?f+"px":"",e.transform="",e))}function _Ke(t){var e=t.state,i=t.options,r=i.gpuAcceleration,n=r===void 0?!0:r,a=i.adaptive,s=a===void 0?!0:a,o=i.roundOffsets,l=o===void 0?!0:o,u={placement:cc(e.placement),variation:JI(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,bY(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,bY(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const $Ke={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:_Ke,data:{}};var eD={passive:!0};function BKe(t){var e=t.state,i=t.instance,r=t.options,n=r.scroll,a=n===void 0?!0:n,s=r.resize,o=s===void 0?!0:s,l=$o(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",i.update,eD)}),o&&l.addEventListener("resize",i.update,eD),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",i.update,eD)}),o&&l.removeEventListener("resize",i.update,eD)}}const VKe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:BKe,data:{}};var jKe={left:"right",right:"left",bottom:"top",top:"bottom"};function WD(t){return t.replace(/left|right|bottom|top/g,function(e){return jKe[e]})}var GKe={start:"end",end:"start"};function wY(t){return t.replace(/start|end/g,function(e){return GKe[e]})}function LH(t){var e=$o(t),i=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:i,scrollTop:r}}function _H(t){return XI(xf(t)).left+LH(t).scrollLeft}function HKe(t,e){var i=$o(t),r=xf(t),n=i.visualViewport,a=r.clientWidth,s=r.clientHeight,o=0,l=0;if(n){a=n.width,s=n.height;var u=qfe();(u||!u&&e==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}return{width:a,height:s,x:o+_H(t),y:l}}function WKe(t){var e,i=xf(t),r=LH(t),n=(e=t.ownerDocument)==null?void 0:e.body,a=Mh(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),s=Mh(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-r.scrollLeft+_H(t),l=-r.scrollTop;return Ld(n||i).direction==="rtl"&&(o+=Mh(i.clientWidth,n?n.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function $H(t){var e=Ld(t),i=e.overflow,r=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function Qfe(t){return["html","body","#document"].indexOf(Fc(t))>=0?t.ownerDocument.body:ol(t)&&$H(t)?t:Qfe(jA(t))}function bb(t,e){var i;e===void 0&&(e=[]);var r=Qfe(t),n=r===((i=t.ownerDocument)==null?void 0:i.body),a=$o(r),s=n?[a].concat(a.visualViewport||[],$H(r)?r:[]):r,o=e.concat(s);return n?o:o.concat(bb(jA(s)))}function LF(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function zKe(t,e){var i=XI(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function SY(t,e,i){return e===Hfe?LF(HKe(t,i)):am(e)?zKe(e,i):LF(WKe(xf(t)))}function qKe(t){var e=bb(jA(t)),i=["absolute","fixed"].indexOf(Ld(t).position)>=0,r=i&&ol(t)?NT(t):t;return am(r)?e.filter(function(n){return am(n)&&Yfe(n,r)&&Fc(n)!=="body"}):[]}function YKe(t,e,i,r){var n=e==="clippingParents"?qKe(t):[].concat(e),a=[].concat(n,[i]),s=a[0],o=a.reduce(function(l,u){var c=SY(t,u,r);return l.top=Mh(c.top,l.top),l.right=BE(c.right,l.right),l.bottom=BE(c.bottom,l.bottom),l.left=Mh(c.left,l.left),l},SY(t,s,r));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function Zfe(t){var e=t.reference,i=t.element,r=t.placement,n=r?cc(r):null,a=r?JI(r):null,s=e.x+e.width/2-i.width/2,o=e.y+e.height/2-i.height/2,l;switch(n){case Ks:l={x:s,y:e.y-i.height};break;case Pl:l={x:s,y:e.y+e.height};break;case El:l={x:e.x+e.width,y:o};break;case Xs:l={x:e.x-i.width,y:o};break;default:l={x:e.x,y:e.y}}var u=n?FH(n):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case YI:l[u]=l[u]-(e[c]/2-i[c]/2);break;case Nw:l[u]=l[u]+(e[c]/2-i[c]/2);break}}return l}function Aw(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=r===void 0?t.placement:r,a=i.strategy,s=a===void 0?t.strategy:a,o=i.boundary,l=o===void 0?mKe:o,u=i.rootBoundary,c=u===void 0?Hfe:u,d=i.elementContext,p=d===void 0?Cy:d,f=i.altBoundary,h=f===void 0?!1:f,m=i.padding,g=m===void 0?0:m,I=Xfe(typeof g!="number"?g:Jfe(g,MT)),v=p===Cy?gKe:Cy,w=t.rects.popper,y=t.elements[h?v:p],b=YKe(am(y)?y:y.contextElement||xf(t.elements.popper),l,c,s),S=XI(t.elements.reference),U=Zfe({reference:S,element:w,placement:n}),T=LF(Object.assign({},w,U)),D=p===Cy?T:S,P={top:b.top-D.top+I.top,bottom:D.bottom-b.bottom+I.bottom,left:b.left-D.left+I.left,right:D.right-b.right+I.right},E=t.modifiersData.offset;if(p===Cy&&E){var R=E[n];Object.keys(P).forEach(function(C){var M=[El,Pl].indexOf(C)>=0?1:-1,N=[Ks,Pl].indexOf(C)>=0?"y":"x";P[C]+=R[N]*M})}return P}function KKe(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=i.boundary,a=i.rootBoundary,s=i.padding,o=i.flipVariations,l=i.allowedAutoPlacements,u=l===void 0?Wfe:l,c=JI(r),d=c?o?vY:vY.filter(function(h){return JI(h)===c}):MT,p=d.filter(function(h){return u.indexOf(h)>=0});p.length===0&&(p=d);var f=p.reduce(function(h,m){return h[m]=Aw(t,{placement:m,boundary:n,rootBoundary:a,padding:s})[cc(m)],h},{});return Object.keys(f).sort(function(h,m){return f[h]-f[m]})}function XKe(t){if(cc(t)===kH)return[];var e=WD(t);return[wY(t),e,wY(e)]}function JKe(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!0:s,l=i.fallbackPlacements,u=i.padding,c=i.boundary,d=i.rootBoundary,p=i.altBoundary,f=i.flipVariations,h=f===void 0?!0:f,m=i.allowedAutoPlacements,g=e.options.placement,I=cc(g),v=I===g,w=l||(v||!h?[WD(g)]:XKe(g)),y=[g].concat(w).reduce(function(_,B){return _.concat(cc(B)===kH?KKe(e,{placement:B,boundary:c,rootBoundary:d,padding:u,flipVariations:h,allowedAutoPlacements:m}):B)},[]),b=e.rects.reference,S=e.rects.popper,U=new Map,T=!0,D=y[0],P=0;P<y.length;P++){var E=y[P],R=cc(E),C=JI(E)===YI,M=[Ks,Pl].indexOf(R)>=0,N=M?"width":"height",A=Aw(e,{placement:E,boundary:c,rootBoundary:d,altBoundary:p,padding:u}),O=M?C?El:Xs:C?Pl:Ks;b[N]>S[N]&&(O=WD(O));var k=WD(O),F=[];if(a&&F.push(A[R]<=0),o&&F.push(A[O]<=0,A[k]<=0),F.every(function(_){return _})){D=E,T=!1;break}U.set(E,F)}if(T)for(var x=h?3:1,L=function(_){var B=y.find(function(G){var j=U.get(G);if(j)return j.slice(0,_).every(function(Y){return Y})});if(B)return D=B,"break"},$=x;$>0;$--){var V=L($);if(V==="break")break}e.placement!==D&&(e.modifiersData[r]._skip=!0,e.placement=D,e.reset=!0)}}const QKe={name:"flip",enabled:!0,phase:"main",fn:JKe,requiresIfExists:["offset"],data:{_skip:!1}};function UY(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function TY(t){return[Ks,El,Pl,Xs].some(function(e){return t[e]>=0})}function ZKe(t){var e=t.state,i=t.name,r=e.rects.reference,n=e.rects.popper,a=e.modifiersData.preventOverflow,s=Aw(e,{elementContext:"reference"}),o=Aw(e,{altBoundary:!0}),l=UY(s,r),u=UY(o,n,a),c=TY(l),d=TY(u);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":d})}const e5e={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:ZKe};function t5e(t,e,i){var r=cc(t),n=[Xs,Ks].indexOf(r)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,s=a[0],o=a[1];return s=s||0,o=(o||0)*n,[Xs,El].indexOf(r)>=0?{x:o,y:s}:{x:s,y:o}}function i5e(t){var e=t.state,i=t.options,r=t.name,n=i.offset,a=n===void 0?[0,0]:n,s=Wfe.reduce(function(c,d){return c[d]=t5e(d,e.rects,a),c},{}),o=s[e.placement],l=o.x,u=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[r]=s}const r5e={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:i5e};function n5e(t){var e=t.state,i=t.name;e.modifiersData[i]=Zfe({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const a5e={name:"popperOffsets",enabled:!0,phase:"read",fn:n5e,data:{}};function s5e(t){return t==="x"?"y":"x"}function o5e(t){var e=t.state,i=t.options,r=t.name,n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!1:s,l=i.boundary,u=i.rootBoundary,c=i.altBoundary,d=i.padding,p=i.tether,f=p===void 0?!0:p,h=i.tetherOffset,m=h===void 0?0:h,g=Aw(e,{boundary:l,rootBoundary:u,padding:d,altBoundary:c}),I=cc(e.placement),v=JI(e.placement),w=!v,y=FH(I),b=s5e(y),S=e.modifiersData.popperOffsets,U=e.rects.reference,T=e.rects.popper,D=typeof m=="function"?m(Object.assign({},e.rects,{placement:e.placement})):m,P=typeof D=="number"?{mainAxis:D,altAxis:D}:Object.assign({mainAxis:0,altAxis:0},D),E=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,R={x:0,y:0};if(S){if(a){var C,M=y==="y"?Ks:Xs,N=y==="y"?Pl:El,A=y==="y"?"height":"width",O=S[y],k=O+g[M],F=O-g[N],x=f?-T[A]/2:0,L=v===YI?U[A]:T[A],$=v===YI?-T[A]:-U[A],V=e.elements.arrow,_=f&&V?xH(V):{width:0,height:0},B=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Kfe(),G=B[M],j=B[N],Y=yb(0,U[A],_[A]),K=w?U[A]/2-x-Y-G-P.mainAxis:L-Y-G-P.mainAxis,X=w?-U[A]/2+x+Y+j+P.mainAxis:$+Y+j+P.mainAxis,Z=e.elements.arrow&&NT(e.elements.arrow),Q=Z?y==="y"?Z.clientTop||0:Z.clientLeft||0:0,ae=(C=E?.[y])!=null?C:0,te=O+K-ae-Q,ne=O+X-ae,le=yb(f?BE(k,te):k,O,f?Mh(F,ne):F);S[y]=le,R[y]=le-O}if(o){var de,pe=y==="x"?Ks:Xs,ve=y==="x"?Pl:El,Me=S[b],Ee=b==="y"?"height":"width",Be=Me+g[pe],fe=Me-g[ve],Te=[Ks,Xs].indexOf(I)!==-1,ce=(de=E?.[b])!=null?de:0,be=Te?Be:Me-U[Ee]-T[Ee]-ce+P.altAxis,we=Te?Me+U[Ee]+T[Ee]-ce-P.altAxis:fe,Ae=f&&Te?NKe(be,Me,we):yb(f?be:Be,Me,f?we:fe);S[b]=Ae,R[b]=Ae-Me}e.modifiersData[r]=R}}const l5e={name:"preventOverflow",enabled:!0,phase:"main",fn:o5e,requiresIfExists:["offset"]};function u5e(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function c5e(t){return t===$o(t)||!ol(t)?LH(t):u5e(t)}function d5e(t){var e=t.getBoundingClientRect(),i=KI(e.width)/t.offsetWidth||1,r=KI(e.height)/t.offsetHeight||1;return i!==1||r!==1}function p5e(t,e,i){i===void 0&&(i=!1);var r=ol(e),n=ol(e)&&d5e(e),a=xf(e),s=XI(t,n,i),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((Fc(e)!=="body"||$H(a))&&(o=c5e(e)),ol(e)?(l=XI(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=_H(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function f5e(t){var e=new Map,i=new Set,r=[];t.forEach(function(a){e.set(a.name,a)});function n(a){i.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!i.has(o)){var l=e.get(o);l&&n(l)}}),r.push(a)}return t.forEach(function(a){i.has(a.name)||n(a)}),r}function h5e(t){var e=f5e(t);return PKe.reduce(function(i,r){return i.concat(e.filter(function(n){return n.phase===r}))},[])}function m5e(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function g5e(t){var e=t.reduce(function(i,r){var n=i[r.name];return i[r.name]=n?Object.assign({},n,r,{options:Object.assign({},n.options,r.options),data:Object.assign({},n.data,r.data)}):r,i},{});return Object.keys(e).map(function(i){return e[i]})}var DY={placement:"bottom",modifiers:[],strategy:"absolute"};function PY(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function I5e(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,r=i===void 0?[]:i,n=e.defaultOptions,a=n===void 0?DY:n;return function(s,o,l){l===void 0&&(l=a);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},DY,a),modifiersData:{},elements:{reference:s,popper:o},attributes:{},styles:{}},c=[],d=!1,p={state:u,setOptions:function(m){var g=typeof m=="function"?m(u.options):m;h(),u.options=Object.assign({},a,u.options,g),u.scrollParents={reference:am(s)?bb(s):s.contextElement?bb(s.contextElement):[],popper:bb(o)};var I=h5e(g5e([].concat(r,u.options.modifiers)));return u.orderedModifiers=I.filter(function(v){return v.enabled}),f(),p.update()},forceUpdate:function(){if(!d){var m=u.elements,g=m.reference,I=m.popper;if(PY(g,I)){u.rects={reference:p5e(g,NT(I),u.options.strategy==="fixed"),popper:xH(I)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(T){return u.modifiersData[T.name]=Object.assign({},T.data)});for(var v=0;v<u.orderedModifiers.length;v++){if(u.reset===!0){u.reset=!1,v=-1;continue}var w=u.orderedModifiers[v],y=w.fn,b=w.options,S=b===void 0?{}:b,U=w.name;typeof y=="function"&&(u=y({state:u,options:S,name:U,instance:p})||u)}}}},update:m5e(function(){return new Promise(function(m){p.forceUpdate(),m(u)})}),destroy:function(){h(),d=!0}};if(!PY(s,o))return p;p.setOptions(l).then(function(m){!d&&l.onFirstUpdate&&l.onFirstUpdate(m)});function f(){u.orderedModifiers.forEach(function(m){var g=m.name,I=m.options,v=I===void 0?{}:I,w=m.effect;if(typeof w=="function"){var y=w({state:u,name:g,instance:p,options:v}),b=function(){};c.push(y||b)}})}function h(){c.forEach(function(m){return m()}),c=[]}return p}}var v5e=[VKe,a5e,$Ke,zfe,r5e,QKe,l5e,xKe,e5e],y5e=I5e({defaultModifiers:v5e}),b5e="tippy-box",ehe="tippy-content",w5e="tippy-backdrop",the="tippy-arrow",ihe="tippy-svg-arrow",Kf={passive:!0,capture:!0},rhe=function(){return document.body};function iO(t,e,i){if(Array.isArray(t)){var r=t[e];return r??(Array.isArray(i)?i[e]:i)}return t}function BH(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function nhe(t,e){return typeof t=="function"?t.apply(void 0,e):t}function EY(t,e){if(e===0)return t;var i;return function(r){clearTimeout(i),i=setTimeout(function(){t(r)},e)}}function S5e(t){return t.split(/\s+/).filter(Boolean)}function Cg(t){return[].concat(t)}function RY(t,e){t.indexOf(e)===-1&&t.push(e)}function U5e(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function T5e(t){return t.split("-")[0]}function VE(t){return[].slice.call(t)}function CY(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function wb(){return document.createElement("div")}function GA(t){return["Element","Fragment"].some(function(e){return BH(t,e)})}function D5e(t){return BH(t,"NodeList")}function P5e(t){return BH(t,"MouseEvent")}function E5e(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function R5e(t){return GA(t)?[t]:D5e(t)?VE(t):Array.isArray(t)?t:VE(document.querySelectorAll(t))}function rO(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function MY(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function C5e(t){var e,i=Cg(t),r=i[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function M5e(t,e){var i=e.clientX,r=e.clientY;return t.every(function(n){var a=n.popperRect,s=n.popperState,o=n.props,l=o.interactiveBorder,u=T5e(s.placement),c=s.modifiersData.offset;if(!c)return!0;var d=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,f=u==="right"?c.left.x:0,h=u==="left"?c.right.x:0,m=a.top-r+d>l,g=r-a.bottom-p>l,I=a.left-i+f>l,v=i-a.right-h>l;return m||g||I||v})}function nO(t,e,i){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(n){t[r](n,i)})}function NY(t,e){for(var i=e;i;){var r;if(t.contains(i))return!0;i=i.getRootNode==null||(r=i.getRootNode())==null?void 0:r.host}return!1}var qu={isTouch:!1},AY=0;function N5e(){qu.isTouch||(qu.isTouch=!0,window.performance&&document.addEventListener("mousemove",ahe))}function ahe(){var t=performance.now();t-AY<20&&(qu.isTouch=!1,document.removeEventListener("mousemove",ahe)),AY=t}function A5e(){var t=document.activeElement;if(E5e(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function k5e(){document.addEventListener("touchstart",N5e,Kf),window.addEventListener("blur",A5e)}var O5e=typeof window<"u"&&typeof document<"u",x5e=O5e?!!window.msCrypto:!1,F5e={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},L5e={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},ql=Object.assign({appendTo:rhe,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},F5e,L5e),_5e=Object.keys(ql),$5e=function(t){var e=Object.keys(t);e.forEach(function(i){ql[i]=t[i]})};function she(t){var e=t.plugins||[],i=e.reduce(function(r,n){var a=n.name,s=n.defaultValue;if(a){var o;r[a]=t[a]!==void 0?t[a]:(o=ql[a])!=null?o:s}return r},{});return Object.assign({},t,i)}function B5e(t,e){var i=e?Object.keys(she(Object.assign({},ql,{plugins:e}))):_5e,r=i.reduce(function(n,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return n;if(a==="content")n[a]=s;else try{n[a]=JSON.parse(s)}catch{n[a]=s}return n},{});return r}function kY(t,e){var i=Object.assign({},e,{content:nhe(e.content,[t])},e.ignoreAttributes?{}:B5e(t,e.plugins));return i.aria=Object.assign({},ql.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var V5e=function(){return"innerHTML"};function _F(t,e){t[V5e()]=e}function OY(t){var e=wb();return t===!0?e.className=the:(e.className=ihe,GA(t)?e.appendChild(t):_F(e,t)),e}function xY(t,e){GA(e.content)?(_F(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?_F(t,e.content):t.textContent=e.content)}function $F(t){var e=t.firstElementChild,i=VE(e.children);return{box:e,content:i.find(function(r){return r.classList.contains(ehe)}),arrow:i.find(function(r){return r.classList.contains(the)||r.classList.contains(ihe)}),backdrop:i.find(function(r){return r.classList.contains(w5e)})}}function ohe(t){var e=wb(),i=wb();i.className=b5e,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=wb();r.className=ehe,r.setAttribute("data-state","hidden"),xY(r,t.props),e.appendChild(i),i.appendChild(r),n(t.props,t.props);function n(a,s){var o=$F(e),l=o.box,u=o.content,c=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&xY(u,t.props),s.arrow?c?a.arrow!==s.arrow&&(l.removeChild(c),l.appendChild(OY(s.arrow))):l.appendChild(OY(s.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:n}}ohe.$$tippy=!0;var j5e=1,tD=[],aO=[];function G5e(t,e){var i=kY(t,Object.assign({},ql,she(CY(e)))),r,n,a,s=!1,o=!1,l=!1,u=!1,c,d,p,f=[],h=EY(te,i.interactiveDebounce),m,g=j5e++,I=null,v=U5e(i.plugins),w={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},y={id:g,reference:t,popper:wb(),popperInstance:I,props:i,state:w,plugins:v,clearDelayTimeouts:be,setProps:we,setContent:Ae,show:ye,hide:Ne,hideWithInteractivity:he,enable:Te,disable:ce,unmount:De,destroy:Le};if(!i.render)return y;var b=i.render(y),S=b.popper,U=b.onUpdate;S.setAttribute("data-tippy-root",""),S.id="tippy-"+y.id,y.popper=S,t._tippy=y,S._tippy=y;var T=v.map(function(J){return J.fn(y)}),D=t.hasAttribute("aria-expanded");return Z(),x(),O(),k("onCreate",[y]),i.showOnCreate&&Be(),S.addEventListener("mouseenter",function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()}),S.addEventListener("mouseleave",function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&M().addEventListener("mousemove",h)}),y;function P(){var J=y.props.touch;return Array.isArray(J)?J:[J,0]}function E(){return P()[0]==="hold"}function R(){var J;return!!((J=y.props.render)!=null&&J.$$tippy)}function C(){return m||t}function M(){var J=C().parentNode;return J?C5e(J):document}function N(){return $F(S)}function A(J){return y.state.isMounted&&!y.state.isVisible||qu.isTouch||c&&c.type==="focus"?0:iO(y.props.delay,J?0:1,ql.delay)}function O(J){J===void 0&&(J=!1),S.style.pointerEvents=y.props.interactive&&!J?"":"none",S.style.zIndex=""+y.props.zIndex}function k(J,se,oe){if(oe===void 0&&(oe=!0),T.forEach(function(ee){ee[J]&&ee[J].apply(ee,se)}),oe){var ue;(ue=y.props)[J].apply(ue,se)}}function F(){var J=y.props.aria;if(J.content){var se="aria-"+J.content,oe=S.id,ue=Cg(y.props.triggerTarget||t);ue.forEach(function(ee){var Se=ee.getAttribute(se);if(y.state.isVisible)ee.setAttribute(se,Se?Se+" "+oe:oe);else{var Pe=Se&&Se.replace(oe,"").trim();Pe?ee.setAttribute(se,Pe):ee.removeAttribute(se)}})}}function x(){if(!(D||!y.props.aria.expanded)){var J=Cg(y.props.triggerTarget||t);J.forEach(function(se){y.props.interactive?se.setAttribute("aria-expanded",y.state.isVisible&&se===C()?"true":"false"):se.removeAttribute("aria-expanded")})}}function L(){M().removeEventListener("mousemove",h),tD=tD.filter(function(J){return J!==h})}function $(J){if(!(qu.isTouch&&(l||J.type==="mousedown"))){var se=J.composedPath&&J.composedPath()[0]||J.target;if(!(y.props.interactive&&NY(S,se))){if(Cg(y.props.triggerTarget||t).some(function(oe){return NY(oe,se)})){if(qu.isTouch||y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else k("onClickOutside",[y,J]);y.props.hideOnClick===!0&&(y.clearDelayTimeouts(),y.hide(),o=!0,setTimeout(function(){o=!1}),y.state.isMounted||G())}}}function V(){l=!0}function _(){l=!1}function B(){var J=M();J.addEventListener("mousedown",$,!0),J.addEventListener("touchend",$,Kf),J.addEventListener("touchstart",_,Kf),J.addEventListener("touchmove",V,Kf)}function G(){var J=M();J.removeEventListener("mousedown",$,!0),J.removeEventListener("touchend",$,Kf),J.removeEventListener("touchstart",_,Kf),J.removeEventListener("touchmove",V,Kf)}function j(J,se){K(J,function(){!y.state.isVisible&&S.parentNode&&S.parentNode.contains(S)&&se()})}function Y(J,se){K(J,se)}function K(J,se){var oe=N().box;function ue(ee){ee.target===oe&&(nO(oe,"remove",ue),se())}if(J===0)return se();nO(oe,"remove",d),nO(oe,"add",ue),d=ue}function X(J,se,oe){oe===void 0&&(oe=!1);var ue=Cg(y.props.triggerTarget||t);ue.forEach(function(ee){ee.addEventListener(J,se,oe),f.push({node:ee,eventType:J,handler:se,options:oe})})}function Z(){E()&&(X("touchstart",ae,{passive:!0}),X("touchend",ne,{passive:!0})),S5e(y.props.trigger).forEach(function(J){if(J!=="manual")switch(X(J,ae),J){case"mouseenter":X("mouseleave",ne);break;case"focus":X(x5e?"focusout":"blur",le);break;case"focusin":X("focusout",le);break}})}function Q(){f.forEach(function(J){var se=J.node,oe=J.eventType,ue=J.handler,ee=J.options;se.removeEventListener(oe,ue,ee)}),f=[]}function ae(J){var se,oe=!1;if(!(!y.state.isEnabled||de(J)||o)){var ue=((se=c)==null?void 0:se.type)==="focus";c=J,m=J.currentTarget,x(),!y.state.isVisible&&P5e(J)&&tD.forEach(function(ee){return ee(J)}),J.type==="click"&&(y.props.trigger.indexOf("mouseenter")<0||s)&&y.props.hideOnClick!==!1&&y.state.isVisible?oe=!0:Be(J),J.type==="click"&&(s=!oe),oe&&!ue&&fe(J)}}function te(J){var se=J.target,oe=C().contains(se)||S.contains(se);if(!(J.type==="mousemove"&&oe)){var ue=Ee().concat(S).map(function(ee){var Se,Pe=ee._tippy,st=(Se=Pe.popperInstance)==null?void 0:Se.state;return st?{popperRect:ee.getBoundingClientRect(),popperState:st,props:i}:null}).filter(Boolean);M5e(ue,J)&&(L(),fe(J))}}function ne(J){var se=de(J)||y.props.trigger.indexOf("click")>=0&&s;if(!se){if(y.props.interactive){y.hideWithInteractivity(J);return}fe(J)}}function le(J){y.props.trigger.indexOf("focusin")<0&&J.target!==C()||y.props.interactive&&J.relatedTarget&&S.contains(J.relatedTarget)||fe(J)}function de(J){return qu.isTouch?E()!==J.type.indexOf("touch")>=0:!1}function pe(){ve();var J=y.props,se=J.popperOptions,oe=J.placement,ue=J.offset,ee=J.getReferenceClientRect,Se=J.moveTransition,Pe=R()?$F(S).arrow:null,st=ee?{getBoundingClientRect:ee,contextElement:ee.contextElement||C()}:t,Ue={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(bi){var qe=bi.state;if(R()){var wi=N(),li=wi.box;["placement","reference-hidden","escaped"].forEach(function(an){an==="placement"?li.setAttribute("data-placement",qe.placement):qe.attributes.popper["data-popper-"+an]?li.setAttribute("data-"+an,""):li.removeAttribute("data-"+an)}),qe.attributes.popper={}}}},dt=[{name:"offset",options:{offset:ue}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Se}},Ue];R()&&Pe&&dt.push({name:"arrow",options:{element:Pe,padding:3}}),dt.push.apply(dt,se?.modifiers||[]),y.popperInstance=y5e(st,S,Object.assign({},se,{placement:oe,onFirstUpdate:p,modifiers:dt}))}function ve(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function Me(){var J=y.props.appendTo,se,oe=C();y.props.interactive&&J===rhe||J==="parent"?se=oe.parentNode:se=nhe(J,[oe]),se.contains(S)||se.appendChild(S),y.state.isMounted=!0,pe()}function Ee(){return VE(S.querySelectorAll("[data-tippy-root]"))}function Be(J){y.clearDelayTimeouts(),J&&k("onTrigger",[y,J]),B();var se=A(!0),oe=P(),ue=oe[0],ee=oe[1];qu.isTouch&&ue==="hold"&&ee&&(se=ee),se?r=setTimeout(function(){y.show()},se):y.show()}function fe(J){if(y.clearDelayTimeouts(),k("onUntrigger",[y,J]),!y.state.isVisible){G();return}if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(J.type)>=0&&s)){var se=A(!1);se?n=setTimeout(function(){y.state.isVisible&&y.hide()},se):a=requestAnimationFrame(function(){y.hide()})}}function Te(){y.state.isEnabled=!0}function ce(){y.hide(),y.state.isEnabled=!1}function be(){clearTimeout(r),clearTimeout(n),cancelAnimationFrame(a)}function we(J){if(!y.state.isDestroyed){k("onBeforeUpdate",[y,J]),Q();var se=y.props,oe=kY(t,Object.assign({},se,CY(J),{ignoreAttributes:!0}));y.props=oe,Z(),se.interactiveDebounce!==oe.interactiveDebounce&&(L(),h=EY(te,oe.interactiveDebounce)),se.triggerTarget&&!oe.triggerTarget?Cg(se.triggerTarget).forEach(function(ue){ue.removeAttribute("aria-expanded")}):oe.triggerTarget&&t.removeAttribute("aria-expanded"),x(),O(),U&&U(se,oe),y.popperInstance&&(pe(),Ee().forEach(function(ue){requestAnimationFrame(ue._tippy.popperInstance.forceUpdate)})),k("onAfterUpdate",[y,J])}}function Ae(J){y.setProps({content:J})}function ye(){var J=y.state.isVisible,se=y.state.isDestroyed,oe=!y.state.isEnabled,ue=qu.isTouch&&!y.props.touch,ee=iO(y.props.duration,0,ql.duration);if(!(J||se||oe||ue)&&!C().hasAttribute("disabled")&&(k("onShow",[y],!1),y.props.onShow(y)!==!1)){if(y.state.isVisible=!0,R()&&(S.style.visibility="visible"),O(),B(),y.state.isMounted||(S.style.transition="none"),R()){var Se=N(),Pe=Se.box,st=Se.content;rO([Pe,st],0)}p=function(){var Ue;if(!(!y.state.isVisible||u)){if(u=!0,S.offsetHeight,S.style.transition=y.props.moveTransition,R()&&y.props.animation){var dt=N(),bi=dt.box,qe=dt.content;rO([bi,qe],ee),MY([bi,qe],"visible")}F(),x(),RY(aO,y),(Ue=y.popperInstance)==null||Ue.forceUpdate(),k("onMount",[y]),y.props.animation&&R()&&Y(ee,function(){y.state.isShown=!0,k("onShown",[y])})}},Me()}}function Ne(){var J=!y.state.isVisible,se=y.state.isDestroyed,oe=!y.state.isEnabled,ue=iO(y.props.duration,1,ql.duration);if(!(J||se||oe)&&(k("onHide",[y],!1),y.props.onHide(y)!==!1)){if(y.state.isVisible=!1,y.state.isShown=!1,u=!1,s=!1,R()&&(S.style.visibility="hidden"),L(),G(),O(!0),R()){var ee=N(),Se=ee.box,Pe=ee.content;y.props.animation&&(rO([Se,Pe],ue),MY([Se,Pe],"hidden"))}F(),x(),y.props.animation?R()&&j(ue,y.unmount):y.unmount()}}function he(J){M().addEventListener("mousemove",h),RY(tD,h),h(J)}function De(){y.state.isVisible&&y.hide(),y.state.isMounted&&(ve(),Ee().forEach(function(J){J._tippy.unmount()}),S.parentNode&&S.parentNode.removeChild(S),aO=aO.filter(function(J){return J!==y}),y.state.isMounted=!1,k("onHidden",[y]))}function Le(){!y.state.isDestroyed&&(y.clearDelayTimeouts(),y.unmount(),Q(),delete t._tippy,y.state.isDestroyed=!0,k("onDestroy",[y]))}}function HA(t,e){e===void 0&&(e={});var i=ql.plugins.concat(e.plugins||[]);k5e();var r=Object.assign({},e,{plugins:i}),n=R5e(t),a=n.reduce(function(s,o){var l=o&&G5e(o,r);return l&&s.push(l),s},[]);return GA(t)?a[0]:a}HA.defaultProps=ql;HA.setDefaultProps=$5e;HA.currentInput=qu;Object.assign({},zfe,{effect:function(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow)}});HA.setDefaultProps({render:ohe});function zD(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function H5e(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function lhe(t){let e,i,r;t.length!==2?(e=zD,i=(o,l)=>zD(t(o),l),r=(o,l)=>t(o)-l):(e=t===zD||t===H5e?t:W5e,i=t,r=t);function n(o,l,u=0,c=o.length){if(u<c){if(e(l,l)!==0)return c;do{const d=u+c>>>1;i(o[d],l)<0?u=d+1:c=d}while(u<c)}return u}function a(o,l,u=0,c=o.length){if(u<c){if(e(l,l)!==0)return c;do{const d=u+c>>>1;i(o[d],l)<=0?u=d+1:c=d}while(u<c)}return u}function s(o,l,u=0,c=o.length){const d=n(o,l,u,c-1);return d>u&&r(o[d-1],l)>-r(o[d],l)?d-1:d}return{left:n,center:s,right:a}}function W5e(){return 0}function z5e(t){return t===null?NaN:+t}lhe(zD);lhe(z5e).center;var q5e={value:()=>{}};function uhe(){for(var t=0,e=arguments.length,i={},r;t<e;++t){if(!(r=arguments[t]+"")||r in i||/[\s.]/.test(r))throw new Error("illegal type: "+r);i[r]=[]}return new qD(i)}function qD(t){this._=t}function Y5e(t,e){return t.trim().split(/^|\s+/).map(function(i){var r="",n=i.indexOf(".");if(n>=0&&(r=i.slice(n+1),i=i.slice(0,n)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:r}})}qD.prototype=uhe.prototype={constructor:qD,on:function(t,e){var i=this._,r=Y5e(t+"",i),n,a=-1,s=r.length;if(arguments.length<2){for(;++a<s;)if((n=(t=r[a]).type)&&(n=K5e(i[n],t.name)))return n;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<s;)if(n=(t=r[a]).type)i[n]=FY(i[n],t.name,e);else if(e==null)for(n in i)i[n]=FY(i[n],t.name,null);return this},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new qD(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var i=new Array(n),r=0,n,a;r<n;++r)i[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],r=0,n=a.length;r<n;++r)a[r].value.apply(e,i)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],n=0,a=r.length;n<a;++n)r[n].value.apply(e,i)}};function K5e(t,e){for(var i=0,r=t.length,n;i<r;++i)if((n=t[i]).name===e)return n.value}function FY(t,e,i){for(var r=0,n=t.length;r<n;++r)if(t[r].name===e){t[r]=q5e,t=t.slice(0,r).concat(t.slice(r+1));break}return i!=null&&t.push({name:e,value:i}),t}var BF="http://www.w3.org/1999/xhtml";const LY={svg:"http://www.w3.org/2000/svg",xhtml:BF,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function WA(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),LY.hasOwnProperty(e)?{space:LY[e],local:t}:t}function X5e(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===BF&&e.documentElement.namespaceURI===BF?e.createElement(t):e.createElementNS(i,t)}}function J5e(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function che(t){var e=WA(t);return(e.local?J5e:X5e)(e)}function Q5e(){}function VH(t){return t==null?Q5e:function(){return this.querySelector(t)}}function Z5e(t){typeof t!="function"&&(t=VH(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=new Array(s),l,u,c=0;c<s;++c)(l=a[c])&&(u=t.call(l,l.__data__,c,a))&&("__data__"in l&&(u.__data__=l.__data__),o[c]=u);return new ku(r,this._parents)}function e7e(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function t7e(){return[]}function dhe(t){return t==null?t7e:function(){return this.querySelectorAll(t)}}function i7e(t){return function(){return e7e(t.apply(this,arguments))}}function r7e(t){typeof t=="function"?t=i7e(t):t=dhe(t);for(var e=this._groups,i=e.length,r=[],n=[],a=0;a<i;++a)for(var s=e[a],o=s.length,l,u=0;u<o;++u)(l=s[u])&&(r.push(t.call(l,l.__data__,u,s)),n.push(l));return new ku(r,n)}function phe(t){return function(){return this.matches(t)}}function fhe(t){return function(e){return e.matches(t)}}var n7e=Array.prototype.find;function a7e(t){return function(){return n7e.call(this.children,t)}}function s7e(){return this.firstElementChild}function o7e(t){return this.select(t==null?s7e:a7e(typeof t=="function"?t:fhe(t)))}var l7e=Array.prototype.filter;function u7e(){return Array.from(this.children)}function c7e(t){return function(){return l7e.call(this.children,t)}}function d7e(t){return this.selectAll(t==null?u7e:c7e(typeof t=="function"?t:fhe(t)))}function p7e(t){typeof t!="function"&&(t=phe(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=[],l,u=0;u<s;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&o.push(l);return new ku(r,this._parents)}function hhe(t){return new Array(t.length)}function f7e(){return new ku(this._enter||this._groups.map(hhe),this._parents)}function jE(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}jE.prototype={constructor:jE,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function h7e(t){return function(){return t}}function m7e(t,e,i,r,n,a){for(var s=0,o,l=e.length,u=a.length;s<u;++s)(o=e[s])?(o.__data__=a[s],r[s]=o):i[s]=new jE(t,a[s]);for(;s<l;++s)(o=e[s])&&(n[s]=o)}function g7e(t,e,i,r,n,a,s){var o,l,u=new Map,c=e.length,d=a.length,p=new Array(c),f;for(o=0;o<c;++o)(l=e[o])&&(p[o]=f=s.call(l,l.__data__,o,e)+"",u.has(f)?n[o]=l:u.set(f,l));for(o=0;o<d;++o)f=s.call(t,a[o],o,a)+"",(l=u.get(f))?(r[o]=l,l.__data__=a[o],u.delete(f)):i[o]=new jE(t,a[o]);for(o=0;o<c;++o)(l=e[o])&&u.get(p[o])===l&&(n[o]=l)}function I7e(t){return t.__data__}function v7e(t,e){if(!arguments.length)return Array.from(this,I7e);var i=e?g7e:m7e,r=this._parents,n=this._groups;typeof t!="function"&&(t=h7e(t));for(var a=n.length,s=new Array(a),o=new Array(a),l=new Array(a),u=0;u<a;++u){var c=r[u],d=n[u],p=d.length,f=y7e(t.call(c,c&&c.__data__,u,r)),h=f.length,m=o[u]=new Array(h),g=s[u]=new Array(h),I=l[u]=new Array(p);i(c,d,m,g,I,f,e);for(var v=0,w=0,y,b;v<h;++v)if(y=m[v]){for(v>=w&&(w=v+1);!(b=g[w])&&++w<h;);y._next=b||null}}return s=new ku(s,r),s._enter=o,s._exit=l,s}function y7e(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function b7e(){return new ku(this._exit||this._groups.map(hhe),this._parents)}function w7e(t,e,i){var r=this.enter(),n=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(n=e(n),n&&(n=n.selection())),i==null?a.remove():i(a),r&&n?r.merge(n).order():n}function S7e(t){for(var e=t.selection?t.selection():t,i=this._groups,r=e._groups,n=i.length,a=r.length,s=Math.min(n,a),o=new Array(n),l=0;l<s;++l)for(var u=i[l],c=r[l],d=u.length,p=o[l]=new Array(d),f,h=0;h<d;++h)(f=u[h]||c[h])&&(p[h]=f);for(;l<n;++l)o[l]=i[l];return new ku(o,this._parents)}function U7e(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var r=t[e],n=r.length-1,a=r[n],s;--n>=0;)(s=r[n])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function T7e(t){t||(t=D7e);function e(d,p){return d&&p?t(d.__data__,p.__data__):!d-!p}for(var i=this._groups,r=i.length,n=new Array(r),a=0;a<r;++a){for(var s=i[a],o=s.length,l=n[a]=new Array(o),u,c=0;c<o;++c)(u=s[c])&&(l[c]=u);l.sort(e)}return new ku(n,this._parents).order()}function D7e(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function P7e(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function E7e(){return Array.from(this)}function R7e(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],n=0,a=r.length;n<a;++n){var s=r[n];if(s)return s}return null}function C7e(){let t=0;for(const e of this)++t;return t}function M7e(){return!this.node()}function N7e(t){for(var e=this._groups,i=0,r=e.length;i<r;++i)for(var n=e[i],a=0,s=n.length,o;a<s;++a)(o=n[a])&&t.call(o,o.__data__,a,n);return this}function A7e(t){return function(){this.removeAttribute(t)}}function k7e(t){return function(){this.removeAttributeNS(t.space,t.local)}}function O7e(t,e){return function(){this.setAttribute(t,e)}}function x7e(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function F7e(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function L7e(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function _7e(t,e){var i=WA(t);if(arguments.length<2){var r=this.node();return i.local?r.getAttributeNS(i.space,i.local):r.getAttribute(i)}return this.each((e==null?i.local?k7e:A7e:typeof e=="function"?i.local?L7e:F7e:i.local?x7e:O7e)(i,e))}function mhe(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function $7e(t){return function(){this.style.removeProperty(t)}}function B7e(t,e,i){return function(){this.style.setProperty(t,e,i)}}function V7e(t,e,i){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,i)}}function j7e(t,e,i){return arguments.length>1?this.each((e==null?$7e:typeof e=="function"?V7e:B7e)(t,e,i??"")):QI(this.node(),t)}function QI(t,e){return t.style.getPropertyValue(e)||mhe(t).getComputedStyle(t,null).getPropertyValue(e)}function G7e(t){return function(){delete this[t]}}function H7e(t,e){return function(){this[t]=e}}function W7e(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function z7e(t,e){return arguments.length>1?this.each((e==null?G7e:typeof e=="function"?W7e:H7e)(t,e)):this.node()[t]}function ghe(t){return t.trim().split(/^|\s+/)}function jH(t){return t.classList||new Ihe(t)}function Ihe(t){this._node=t,this._names=ghe(t.getAttribute("class")||"")}Ihe.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function vhe(t,e){for(var i=jH(t),r=-1,n=e.length;++r<n;)i.add(e[r])}function yhe(t,e){for(var i=jH(t),r=-1,n=e.length;++r<n;)i.remove(e[r])}function q7e(t){return function(){vhe(this,t)}}function Y7e(t){return function(){yhe(this,t)}}function K7e(t,e){return function(){(e.apply(this,arguments)?vhe:yhe)(this,t)}}function X7e(t,e){var i=ghe(t+"");if(arguments.length<2){for(var r=jH(this.node()),n=-1,a=i.length;++n<a;)if(!r.contains(i[n]))return!1;return!0}return this.each((typeof e=="function"?K7e:e?q7e:Y7e)(i,e))}function J7e(){this.textContent=""}function Q7e(t){return function(){this.textContent=t}}function Z7e(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function e8e(t){return arguments.length?this.each(t==null?J7e:(typeof t=="function"?Z7e:Q7e)(t)):this.node().textContent}function t8e(){this.innerHTML=""}function i8e(t){return function(){this.innerHTML=t}}function r8e(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function n8e(t){return arguments.length?this.each(t==null?t8e:(typeof t=="function"?r8e:i8e)(t)):this.node().innerHTML}function a8e(){this.nextSibling&&this.parentNode.appendChild(this)}function s8e(){return this.each(a8e)}function o8e(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function l8e(){return this.each(o8e)}function u8e(t){var e=typeof t=="function"?t:che(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function c8e(){return null}function d8e(t,e){var i=typeof t=="function"?t:che(t),r=e==null?c8e:typeof e=="function"?e:VH(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),r.apply(this,arguments)||null)})}function p8e(){var t=this.parentNode;t&&t.removeChild(this)}function f8e(){return this.each(p8e)}function h8e(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function m8e(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function g8e(t){return this.select(t?m8e:h8e)}function I8e(t){return arguments.length?this.property("__data__",t):this.node().__data__}function v8e(t){return function(e){t.call(this,e,this.__data__)}}function y8e(t){return t.trim().split(/^|\s+/).map(function(e){var i="",r=e.indexOf(".");return r>=0&&(i=e.slice(r+1),e=e.slice(0,r)),{type:e,name:i}})}function b8e(t){return function(){var e=this.__on;if(e){for(var i=0,r=-1,n=e.length,a;i<n;++i)a=e[i],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function w8e(t,e,i){return function(){var r=this.__on,n,a=v8e(e);if(r){for(var s=0,o=r.length;s<o;++s)if((n=r[s]).type===t.type&&n.name===t.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=a,n.options=i),n.value=e;return}}this.addEventListener(t.type,a,i),n={type:t.type,name:t.name,value:e,listener:a,options:i},r?r.push(n):this.__on=[n]}}function S8e(t,e,i){var r=y8e(t+""),n,a=r.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,u=o.length,c;l<u;++l)for(n=0,c=o[l];n<a;++n)if((s=r[n]).type===c.type&&s.name===c.name)return c.value}return}for(o=e?w8e:b8e,n=0;n<a;++n)this.each(o(r[n],e,i));return this}function bhe(t,e,i){var r=mhe(t),n=r.CustomEvent;typeof n=="function"?n=new n(e,i):(n=r.document.createEvent("Event"),i?(n.initEvent(e,i.bubbles,i.cancelable),n.detail=i.detail):n.initEvent(e,!1,!1)),t.dispatchEvent(n)}function U8e(t,e){return function(){return bhe(this,t,e)}}function T8e(t,e){return function(){return bhe(this,t,e.apply(this,arguments))}}function D8e(t,e){return this.each((typeof e=="function"?T8e:U8e)(t,e))}function*P8e(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],n=0,a=r.length,s;n<a;++n)(s=r[n])&&(yield s)}var E8e=[null];function ku(t,e){this._groups=t,this._parents=e}function AT(){return new ku([[document.documentElement]],E8e)}function R8e(){return this}ku.prototype=AT.prototype={constructor:ku,select:Z5e,selectAll:r7e,selectChild:o7e,selectChildren:d7e,filter:p7e,data:v7e,enter:f7e,exit:b7e,join:w7e,merge:S7e,selection:R8e,order:U7e,sort:T7e,call:P7e,nodes:E7e,node:R7e,size:C7e,empty:M7e,each:N7e,attr:_7e,style:j7e,property:z7e,classed:X7e,text:e8e,html:n8e,raise:s8e,lower:l8e,append:u8e,insert:d8e,remove:f8e,clone:g8e,datum:I8e,on:S8e,dispatch:D8e,[Symbol.iterator]:P8e};function GH(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function whe(t,e){var i=Object.create(t.prototype);for(var r in e)i[r]=e[r];return i}function kT(){}var kw=.7,GE=1/kw,Zg="\\s*([+-]?\\d+)\\s*",Ow="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",dc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",C8e=/^#([0-9a-f]{3,8})$/,M8e=new RegExp(`^rgb\\(${Zg},${Zg},${Zg}\\)$`),N8e=new RegExp(`^rgb\\(${dc},${dc},${dc}\\)$`),A8e=new RegExp(`^rgba\\(${Zg},${Zg},${Zg},${Ow}\\)$`),k8e=new RegExp(`^rgba\\(${dc},${dc},${dc},${Ow}\\)$`),O8e=new RegExp(`^hsl\\(${Ow},${dc},${dc}\\)$`),x8e=new RegExp(`^hsla\\(${Ow},${dc},${dc},${Ow}\\)$`),_Y={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};GH(kT,xw,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:$Y,formatHex:$Y,formatHex8:F8e,formatHsl:L8e,formatRgb:BY,toString:BY});function $Y(){return this.rgb().formatHex()}function F8e(){return this.rgb().formatHex8()}function L8e(){return She(this).formatHsl()}function BY(){return this.rgb().formatRgb()}function xw(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=C8e.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?VY(e):i===3?new Ls(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?iD(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?iD(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=M8e.exec(t))?new Ls(e[1],e[2],e[3],1):(e=N8e.exec(t))?new Ls(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=A8e.exec(t))?iD(e[1],e[2],e[3],e[4]):(e=k8e.exec(t))?iD(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=O8e.exec(t))?HY(e[1],e[2]/100,e[3]/100,1):(e=x8e.exec(t))?HY(e[1],e[2]/100,e[3]/100,e[4]):_Y.hasOwnProperty(t)?VY(_Y[t]):t==="transparent"?new Ls(NaN,NaN,NaN,0):null}function VY(t){return new Ls(t>>16&255,t>>8&255,t&255,1)}function iD(t,e,i,r){return r<=0&&(t=e=i=NaN),new Ls(t,e,i,r)}function _8e(t){return t instanceof kT||(t=xw(t)),t?(t=t.rgb(),new Ls(t.r,t.g,t.b,t.opacity)):new Ls}function VF(t,e,i,r){return arguments.length===1?_8e(t):new Ls(t,e,i,r??1)}function Ls(t,e,i,r){this.r=+t,this.g=+e,this.b=+i,this.opacity=+r}GH(Ls,VF,whe(kT,{brighter(t){return t=t==null?GE:Math.pow(GE,t),new Ls(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?kw:Math.pow(kw,t),new Ls(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Ls(Nh(this.r),Nh(this.g),Nh(this.b),HE(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:jY,formatHex:jY,formatHex8:$8e,formatRgb:GY,toString:GY}));function jY(){return`#${ah(this.r)}${ah(this.g)}${ah(this.b)}`}function $8e(){return`#${ah(this.r)}${ah(this.g)}${ah(this.b)}${ah((isNaN(this.opacity)?1:this.opacity)*255)}`}function GY(){const t=HE(this.opacity);return`${t===1?"rgb(":"rgba("}${Nh(this.r)}, ${Nh(this.g)}, ${Nh(this.b)}${t===1?")":`, ${t})`}`}function HE(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Nh(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ah(t){return t=Nh(t),(t<16?"0":"")+t.toString(16)}function HY(t,e,i,r){return r<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new zl(t,e,i,r)}function She(t){if(t instanceof zl)return new zl(t.h,t.s,t.l,t.opacity);if(t instanceof kT||(t=xw(t)),!t)return new zl;if(t instanceof zl)return t;t=t.rgb();var e=t.r/255,i=t.g/255,r=t.b/255,n=Math.min(e,i,r),a=Math.max(e,i,r),s=NaN,o=a-n,l=(a+n)/2;return o?(e===a?s=(i-r)/o+(i<r)*6:i===a?s=(r-e)/o+2:s=(e-i)/o+4,o/=l<.5?a+n:2-a-n,s*=60):o=l>0&&l<1?0:s,new zl(s,o,l,t.opacity)}function B8e(t,e,i,r){return arguments.length===1?She(t):new zl(t,e,i,r??1)}function zl(t,e,i,r){this.h=+t,this.s=+e,this.l=+i,this.opacity=+r}GH(zl,B8e,whe(kT,{brighter(t){return t=t==null?GE:Math.pow(GE,t),new zl(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?kw:Math.pow(kw,t),new zl(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,r=i+(i<.5?i:1-i)*e,n=2*i-r;return new Ls(sO(t>=240?t-240:t+120,n,r),sO(t,n,r),sO(t<120?t+240:t-120,n,r),this.opacity)},clamp(){return new zl(WY(this.h),rD(this.s),rD(this.l),HE(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=HE(this.opacity);return`${t===1?"hsl(":"hsla("}${WY(this.h)}, ${rD(this.s)*100}%, ${rD(this.l)*100}%${t===1?")":`, ${t})`}`}}));function WY(t){return t=(t||0)%360,t<0?t+360:t}function rD(t){return Math.max(0,Math.min(1,t||0))}function sO(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}const Uhe=t=>()=>t;function V8e(t,e){return function(i){return t+i*e}}function j8e(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(r){return Math.pow(t+r*e,i)}}function G8e(t){return(t=+t)==1?The:function(e,i){return i-e?j8e(e,i,t):Uhe(isNaN(e)?i:e)}}function The(t,e){var i=e-t;return i?V8e(t,i):Uhe(isNaN(t)?e:t)}const zY=(function t(e){var i=G8e(e);function r(n,a){var s=i((n=VF(n)).r,(a=VF(a)).r),o=i(n.g,a.g),l=i(n.b,a.b),u=The(n.opacity,a.opacity);return function(c){return n.r=s(c),n.g=o(c),n.b=l(c),n.opacity=u(c),n+""}}return r.gamma=t,r})(1);function dp(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}var jF=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,oO=new RegExp(jF.source,"g");function H8e(t){return function(){return t}}function W8e(t){return function(e){return t(e)+""}}function z8e(t,e){var i=jF.lastIndex=oO.lastIndex=0,r,n,a,s=-1,o=[],l=[];for(t=t+"",e=e+"";(r=jF.exec(t))&&(n=oO.exec(e));)(a=n.index)>i&&(a=e.slice(i,a),o[s]?o[s]+=a:o[++s]=a),(r=r[0])===(n=n[0])?o[s]?o[s]+=n:o[++s]=n:(o[++s]=null,l.push({i:s,x:dp(r,n)})),i=oO.lastIndex;return i<e.length&&(a=e.slice(i),o[s]?o[s]+=a:o[++s]=a),o.length<2?l[0]?W8e(l[0].x):H8e(e):(e=l.length,function(u){for(var c=0,d;c<e;++c)o[(d=l[c]).i]=d.x(u);return o.join("")})}var qY=180/Math.PI,Dhe={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Phe(t,e,i,r,n,a){var s,o,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*i+e*r)&&(i-=t*l,r-=e*l),(o=Math.sqrt(i*i+r*r))&&(i/=o,r/=o,l/=o),t*r<e*i&&(t=-t,e=-e,l=-l,s=-s),{translateX:n,translateY:a,rotate:Math.atan2(e,t)*qY,skewX:Math.atan(l)*qY,scaleX:s,scaleY:o}}var nD;function q8e(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Dhe:Phe(e.a,e.b,e.c,e.d,e.e,e.f)}function Y8e(t){return t==null||(nD||(nD=document.createElementNS("http://www.w3.org/2000/svg","g")),nD.setAttribute("transform",t),!(t=nD.transform.baseVal.consolidate()))?Dhe:(t=t.matrix,Phe(t.a,t.b,t.c,t.d,t.e,t.f))}function Ehe(t,e,i,r){function n(u){return u.length?u.pop()+" ":""}function a(u,c,d,p,f,h){if(u!==d||c!==p){var m=f.push("translate(",null,e,null,i);h.push({i:m-4,x:dp(u,d)},{i:m-2,x:dp(c,p)})}else(d||p)&&f.push("translate("+d+e+p+i)}function s(u,c,d,p){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),p.push({i:d.push(n(d)+"rotate(",null,r)-2,x:dp(u,c)})):c&&d.push(n(d)+"rotate("+c+r)}function o(u,c,d,p){u!==c?p.push({i:d.push(n(d)+"skewX(",null,r)-2,x:dp(u,c)}):c&&d.push(n(d)+"skewX("+c+r)}function l(u,c,d,p,f,h){if(u!==d||c!==p){var m=f.push(n(f)+"scale(",null,",",null,")");h.push({i:m-4,x:dp(u,d)},{i:m-2,x:dp(c,p)})}else(d!==1||p!==1)&&f.push(n(f)+"scale("+d+","+p+")")}return function(u,c){var d=[],p=[];return u=t(u),c=t(c),a(u.translateX,u.translateY,c.translateX,c.translateY,d,p),s(u.rotate,c.rotate,d,p),o(u.skewX,c.skewX,d,p),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,d,p),u=c=null,function(f){for(var h=-1,m=p.length,g;++h<m;)d[(g=p[h]).i]=g.x(f);return d.join("")}}}var K8e=Ehe(q8e,"px, ","px)","deg)"),X8e=Ehe(Y8e,", ",")",")"),ZI=0,$y=0,My=0,Rhe=1e3,WE,By,zE=0,sm=0,zA=0,Fw=typeof performance=="object"&&performance.now?performance:Date,Che=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function HH(){return sm||(Che(J8e),sm=Fw.now()+zA)}function J8e(){sm=0}function qE(){this._call=this._time=this._next=null}qE.prototype=Mhe.prototype={constructor:qE,restart:function(t,e,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?HH():+i)+(e==null?0:+e),!this._next&&By!==this&&(By?By._next=this:WE=this,By=this),this._call=t,this._time=i,GF()},stop:function(){this._call&&(this._call=null,this._time=1/0,GF())}};function Mhe(t,e,i){var r=new qE;return r.restart(t,e,i),r}function Q8e(){HH(),++ZI;for(var t=WE,e;t;)(e=sm-t._time)>=0&&t._call.call(void 0,e),t=t._next;--ZI}function YY(){sm=(zE=Fw.now())+zA,ZI=$y=0;try{Q8e()}finally{ZI=0,e9e(),sm=0}}function Z8e(){var t=Fw.now(),e=t-zE;e>Rhe&&(zA-=e,zE=t)}function e9e(){for(var t,e=WE,i,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(i=e._next,e._next=null,e=t?t._next=i:WE=i);By=t,GF(r)}function GF(t){if(!ZI){$y&&($y=clearTimeout($y));var e=t-sm;e>24?(t<1/0&&($y=setTimeout(YY,t-Fw.now()-zA)),My&&(My=clearInterval(My))):(My||(zE=Fw.now(),My=setInterval(Z8e,Rhe)),ZI=1,Che(YY))}}function KY(t,e,i){var r=new qE;return e=e==null?0:+e,r.restart(n=>{r.stop(),t(n+e)},e,i),r}var t9e=uhe("start","end","cancel","interrupt"),i9e=[],Nhe=0,XY=1,HF=2,YD=3,JY=4,WF=5,KD=6;function qA(t,e,i,r,n,a){var s=t.__transition;if(!s)t.__transition={};else if(i in s)return;r9e(t,i,{name:e,index:r,group:n,on:t9e,tween:i9e,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Nhe})}function WH(t,e){var i=Wu(t,e);if(i.state>Nhe)throw new Error("too late; already scheduled");return i}function Zc(t,e){var i=Wu(t,e);if(i.state>YD)throw new Error("too late; already running");return i}function Wu(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function r9e(t,e,i){var r=t.__transition,n;r[e]=i,i.timer=Mhe(a,0,i.time);function a(u){i.state=XY,i.timer.restart(s,i.delay,i.time),i.delay<=u&&s(u-i.delay)}function s(u){var c,d,p,f;if(i.state!==XY)return l();for(c in r)if(f=r[c],f.name===i.name){if(f.state===YD)return KY(s);f.state===JY?(f.state=KD,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete r[c]):+c<e&&(f.state=KD,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete r[c])}if(KY(function(){i.state===YD&&(i.state=JY,i.timer.restart(o,i.delay,i.time),o(u))}),i.state=HF,i.on.call("start",t,t.__data__,i.index,i.group),i.state===HF){for(i.state=YD,n=new Array(p=i.tween.length),c=0,d=-1;c<p;++c)(f=i.tween[c].value.call(t,t.__data__,i.index,i.group))&&(n[++d]=f);n.length=d+1}}function o(u){for(var c=u<i.duration?i.ease.call(null,u/i.duration):(i.timer.restart(l),i.state=WF,1),d=-1,p=n.length;++d<p;)n[d].call(t,c);i.state===WF&&(i.on.call("end",t,t.__data__,i.index,i.group),l())}function l(){i.state=KD,i.timer.stop(),delete r[e];for(var u in r)return;delete t.__transition}}function n9e(t,e){var i=t.__transition,r,n,a=!0,s;if(i){e=e==null?null:e+"";for(s in i){if((r=i[s]).name!==e){a=!1;continue}n=r.state>HF&&r.state<WF,r.state=KD,r.timer.stop(),r.on.call(n?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete i[s]}a&&delete t.__transition}}function a9e(t){return this.each(function(){n9e(this,t)})}function s9e(t,e){var i,r;return function(){var n=Zc(this,t),a=n.tween;if(a!==i){r=i=a;for(var s=0,o=r.length;s<o;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}n.tween=r}}function o9e(t,e,i){var r,n;if(typeof i!="function")throw new Error;return function(){var a=Zc(this,t),s=a.tween;if(s!==r){n=(r=s).slice();for(var o={name:e,value:i},l=0,u=n.length;l<u;++l)if(n[l].name===e){n[l]=o;break}l===u&&n.push(o)}a.tween=n}}function l9e(t,e){var i=this._id;if(t+="",arguments.length<2){for(var r=Wu(this.node(),i).tween,n=0,a=r.length,s;n<a;++n)if((s=r[n]).name===t)return s.value;return null}return this.each((e==null?s9e:o9e)(i,t,e))}function zH(t,e,i){var r=t._id;return t.each(function(){var n=Zc(this,r);(n.value||(n.value={}))[e]=i.apply(this,arguments)}),function(n){return Wu(n,r).value[e]}}function Ahe(t,e){var i;return(typeof e=="number"?dp:e instanceof xw?zY:(i=xw(e))?(e=i,zY):z8e)(t,e)}function u9e(t){return function(){this.removeAttribute(t)}}function c9e(t){return function(){this.removeAttributeNS(t.space,t.local)}}function d9e(t,e,i){var r,n=i+"",a;return function(){var s=this.getAttribute(t);return s===n?null:s===r?a:a=e(r=s,i)}}function p9e(t,e,i){var r,n=i+"",a;return function(){var s=this.getAttributeNS(t.space,t.local);return s===n?null:s===r?a:a=e(r=s,i)}}function f9e(t,e,i){var r,n,a;return function(){var s,o=i(this),l;return o==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=o+"",s===l?null:s===r&&l===n?a:(n=l,a=e(r=s,o)))}}function h9e(t,e,i){var r,n,a;return function(){var s,o=i(this),l;return o==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=o+"",s===l?null:s===r&&l===n?a:(n=l,a=e(r=s,o)))}}function m9e(t,e){var i=WA(t),r=i==="transform"?X8e:Ahe;return this.attrTween(t,typeof e=="function"?(i.local?h9e:f9e)(i,r,zH(this,"attr."+t,e)):e==null?(i.local?c9e:u9e)(i):(i.local?p9e:d9e)(i,r,e))}function g9e(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}function I9e(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}function v9e(t,e){var i,r;function n(){var a=e.apply(this,arguments);return a!==r&&(i=(r=a)&&I9e(t,a)),i}return n._value=e,n}function y9e(t,e){var i,r;function n(){var a=e.apply(this,arguments);return a!==r&&(i=(r=a)&&g9e(t,a)),i}return n._value=e,n}function b9e(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var r=WA(t);return this.tween(i,(r.local?v9e:y9e)(r,e))}function w9e(t,e){return function(){WH(this,t).delay=+e.apply(this,arguments)}}function S9e(t,e){return e=+e,function(){WH(this,t).delay=e}}function U9e(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?w9e:S9e)(e,t)):Wu(this.node(),e).delay}function T9e(t,e){return function(){Zc(this,t).duration=+e.apply(this,arguments)}}function D9e(t,e){return e=+e,function(){Zc(this,t).duration=e}}function P9e(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?T9e:D9e)(e,t)):Wu(this.node(),e).duration}function E9e(t,e){if(typeof e!="function")throw new Error;return function(){Zc(this,t).ease=e}}function R9e(t){var e=this._id;return arguments.length?this.each(E9e(e,t)):Wu(this.node(),e).ease}function C9e(t,e){return function(){var i=e.apply(this,arguments);if(typeof i!="function")throw new Error;Zc(this,t).ease=i}}function M9e(t){if(typeof t!="function")throw new Error;return this.each(C9e(this._id,t))}function N9e(t){typeof t!="function"&&(t=phe(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=[],l,u=0;u<s;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&o.push(l);return new _d(r,this._parents,this._name,this._id)}function A9e(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,r=e.length,n=i.length,a=Math.min(r,n),s=new Array(r),o=0;o<a;++o)for(var l=e[o],u=i[o],c=l.length,d=s[o]=new Array(c),p,f=0;f<c;++f)(p=l[f]||u[f])&&(d[f]=p);for(;o<r;++o)s[o]=e[o];return new _d(s,this._parents,this._name,this._id)}function k9e(t){return(t+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function O9e(t,e,i){var r,n,a=k9e(e)?WH:Zc;return function(){var s=a(this,t),o=s.on;o!==r&&(n=(r=o).copy()).on(e,i),s.on=n}}function x9e(t,e){var i=this._id;return arguments.length<2?Wu(this.node(),i).on.on(t):this.each(O9e(i,t,e))}function F9e(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}function L9e(){return this.on("end.remove",F9e(this._id))}function _9e(t){var e=this._name,i=this._id;typeof t!="function"&&(t=VH(t));for(var r=this._groups,n=r.length,a=new Array(n),s=0;s<n;++s)for(var o=r[s],l=o.length,u=a[s]=new Array(l),c,d,p=0;p<l;++p)(c=o[p])&&(d=t.call(c,c.__data__,p,o))&&("__data__"in c&&(d.__data__=c.__data__),u[p]=d,qA(u[p],e,i,p,u,Wu(c,i)));return new _d(a,this._parents,e,i)}function $9e(t){var e=this._name,i=this._id;typeof t!="function"&&(t=dhe(t));for(var r=this._groups,n=r.length,a=[],s=[],o=0;o<n;++o)for(var l=r[o],u=l.length,c,d=0;d<u;++d)if(c=l[d]){for(var p=t.call(c,c.__data__,d,l),f,h=Wu(c,i),m=0,g=p.length;m<g;++m)(f=p[m])&&qA(f,e,i,m,p,h);a.push(p),s.push(c)}return new _d(a,s,e,i)}var B9e=AT.prototype.constructor;function V9e(){return new B9e(this._groups,this._parents)}function j9e(t,e){var i,r,n;return function(){var a=QI(this,t),s=(this.style.removeProperty(t),QI(this,t));return a===s?null:a===i&&s===r?n:n=e(i=a,r=s)}}function khe(t){return function(){this.style.removeProperty(t)}}function G9e(t,e,i){var r,n=i+"",a;return function(){var s=QI(this,t);return s===n?null:s===r?a:a=e(r=s,i)}}function H9e(t,e,i){var r,n,a;return function(){var s=QI(this,t),o=i(this),l=o+"";return o==null&&(l=o=(this.style.removeProperty(t),QI(this,t))),s===l?null:s===r&&l===n?a:(n=l,a=e(r=s,o))}}function W9e(t,e){var i,r,n,a="style."+e,s="end."+a,o;return function(){var l=Zc(this,t),u=l.on,c=l.value[a]==null?o||(o=khe(e)):void 0;(u!==i||n!==c)&&(r=(i=u).copy()).on(s,n=c),l.on=r}}function z9e(t,e,i){var r=(t+="")=="transform"?K8e:Ahe;return e==null?this.styleTween(t,j9e(t,r)).on("end.style."+t,khe(t)):typeof e=="function"?this.styleTween(t,H9e(t,r,zH(this,"style."+t,e))).each(W9e(this._id,t)):this.styleTween(t,G9e(t,r,e),i).on("end.style."+t,null)}function q9e(t,e,i){return function(r){this.style.setProperty(t,e.call(this,r),i)}}function Y9e(t,e,i){var r,n;function a(){var s=e.apply(this,arguments);return s!==n&&(r=(n=s)&&q9e(t,s,i)),r}return a._value=e,a}function K9e(t,e,i){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Y9e(t,e,i??""))}function X9e(t){return function(){this.textContent=t}}function J9e(t){return function(){var e=t(this);this.textContent=e??""}}function Q9e(t){return this.tween("text",typeof t=="function"?J9e(zH(this,"text",t)):X9e(t==null?"":t+""))}function Z9e(t){return function(e){this.textContent=t.call(this,e)}}function eXe(t){var e,i;function r(){var n=t.apply(this,arguments);return n!==i&&(e=(i=n)&&Z9e(n)),e}return r._value=t,r}function tXe(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,eXe(t))}function iXe(){for(var t=this._name,e=this._id,i=Ohe(),r=this._groups,n=r.length,a=0;a<n;++a)for(var s=r[a],o=s.length,l,u=0;u<o;++u)if(l=s[u]){var c=Wu(l,e);qA(l,t,i,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new _d(r,this._parents,t,i)}function rXe(){var t,e,i=this,r=i._id,n=i.size();return new Promise(function(a,s){var o={value:s},l={value:function(){--n===0&&a()}};i.each(function(){var u=Zc(this,r),c=u.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(l)),u.on=e}),n===0&&a()})}var nXe=0;function _d(t,e,i,r){this._groups=t,this._parents=e,this._name=i,this._id=r}function Ohe(){return++nXe}var id=AT.prototype;_d.prototype={constructor:_d,select:_9e,selectAll:$9e,selectChild:id.selectChild,selectChildren:id.selectChildren,filter:N9e,merge:A9e,selection:V9e,transition:iXe,call:id.call,nodes:id.nodes,node:id.node,size:id.size,empty:id.empty,each:id.each,on:x9e,attr:m9e,attrTween:b9e,style:z9e,styleTween:K9e,text:Q9e,textTween:tXe,remove:L9e,tween:l9e,delay:U9e,duration:P9e,ease:R9e,easeVarying:M9e,end:rXe,[Symbol.iterator]:id[Symbol.iterator]};function aXe(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var sXe={time:null,delay:0,duration:250,ease:aXe};function oXe(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return i}function lXe(t){var e,i;t instanceof _d?(e=t._id,t=t._name):(e=Ohe(),(i=sXe).time=HH(),t=t==null?null:t+"");for(var r=this._groups,n=r.length,a=0;a<n;++a)for(var s=r[a],o=s.length,l,u=0;u<o;++u)(l=s[u])&&qA(l,t,e,u,s,i||oXe(l,e));return new _d(r,this._parents,t,e)}AT.prototype.interrupt=a9e;AT.prototype.transition=lXe;function uXe(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function YE(t,e){if(!isFinite(t)||t===0)return null;var i=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"),r=t.slice(0,i);return[r.length>1?r[0]+r.slice(2):r,+t.slice(i+1)]}function cXe(t){return t=YE(Math.abs(t)),t?t[1]:NaN}function dXe(t,e){return function(i,r){for(var n=i.length,a=[],s=0,o=t[0],l=0;n>0&&o>0&&(l+o+1>r&&(o=Math.max(1,r-l)),a.push(i.substring(n-=o,n+o)),!((l+=o+1)>r));)o=t[s=(s+1)%t.length];return a.reverse().join(e)}}function pXe(t){return function(e){return e.replace(/[0-9]/g,function(i){return t[+i]})}}var fXe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function zF(t){if(!(e=fXe.exec(t)))throw new Error("invalid format: "+t);var e;return new qH({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}zF.prototype=qH.prototype;function qH(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}qH.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function hXe(t){e:for(var e=t.length,i=1,r=-1,n;i<e;++i)switch(t[i]){case".":r=n=i;break;case"0":r===0&&(r=i),n=i;break;default:if(!+t[i])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(n+1):t}var KE;function mXe(t,e){var i=YE(t,e);if(!i)return KE=void 0,t.toPrecision(e);var r=i[0],n=i[1],a=n-(KE=Math.max(-8,Math.min(8,Math.floor(n/3)))*3)+1,s=r.length;return a===s?r:a>s?r+new Array(a-s+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+YE(t,Math.max(0,e+a-1))[0]}function QY(t,e){var i=YE(t,e);if(!i)return t+"";var r=i[0],n=i[1];return n<0?"0."+new Array(-n).join("0")+r:r.length>n+1?r.slice(0,n+1)+"."+r.slice(n+1):r+new Array(n-r.length+2).join("0")}const ZY={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:uXe,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>QY(t*100,e),r:QY,s:mXe,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function e6(t){return t}var t6=Array.prototype.map,i6=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function gXe(t){var e=t.grouping===void 0||t.thousands===void 0?e6:dXe(t6.call(t.grouping,Number),t.thousands+""),i=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",n=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?e6:pXe(t6.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"âˆ’":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function u(d,p){d=zF(d);var f=d.fill,h=d.align,m=d.sign,g=d.symbol,I=d.zero,v=d.width,w=d.comma,y=d.precision,b=d.trim,S=d.type;S==="n"?(w=!0,S="g"):ZY[S]||(y===void 0&&(y=12),b=!0,S="g"),(I||f==="0"&&h==="=")&&(I=!0,f="0",h="=");var U=(p&&p.prefix!==void 0?p.prefix:"")+(g==="$"?i:g==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():""),T=(g==="$"?r:/[%p]/.test(S)?s:"")+(p&&p.suffix!==void 0?p.suffix:""),D=ZY[S],P=/[defgprs%]/.test(S);y=y===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y));function E(R){var C=U,M=T,N,A,O;if(S==="c")M=D(R)+M,R="";else{R=+R;var k=R<0||1/R<0;if(R=isNaN(R)?l:D(Math.abs(R),y),b&&(R=hXe(R)),k&&+R==0&&m!=="+"&&(k=!1),C=(k?m==="("?m:o:m==="-"||m==="("?"":m)+C,M=(S==="s"&&!isNaN(R)&&KE!==void 0?i6[8+KE/3]:"")+M+(k&&m==="("?")":""),P){for(N=-1,A=R.length;++N<A;)if(O=R.charCodeAt(N),48>O||O>57){M=(O===46?n+R.slice(N+1):R.slice(N))+M,R=R.slice(0,N);break}}}w&&!I&&(R=e(R,1/0));var F=C.length+R.length+M.length,x=F<v?new Array(v-F+1).join(f):"";switch(w&&I&&(R=e(x+R,x.length?v-M.length:1/0),x=""),h){case"<":R=C+R+M+x;break;case"=":R=C+x+R+M;break;case"^":R=x.slice(0,F=x.length>>1)+C+R+M+x.slice(F);break;default:R=x+C+R+M;break}return a(R)}return E.toString=function(){return d+""},E}function c(d,p){var f=Math.max(-8,Math.min(8,Math.floor(cXe(p)/3)))*3,h=Math.pow(10,-f),m=u((d=zF(d),d.type="f",d),{suffix:i6[8+f/3]});return function(g){return m(h*g)}}return{format:u,formatPrefix:c}}var aD;IXe({thousands:",",grouping:[3],currency:["$",""]});function IXe(t){return aD=gXe(t),aD.format,aD.formatPrefix,aD}function vXe(t){var e=0,i=t.children,r=i&&i.length;if(!r)e=1;else for(;--r>=0;)e+=i[r].value;t.value=e}function yXe(){return this.eachAfter(vXe)}function bXe(t,e){let i=-1;for(const r of this)t.call(e,r,++i,this);return this}function wXe(t,e){for(var i=this,r=[i],n,a,s=-1;i=r.pop();)if(t.call(e,i,++s,this),n=i.children)for(a=n.length-1;a>=0;--a)r.push(n[a]);return this}function SXe(t,e){for(var i=this,r=[i],n=[],a,s,o,l=-1;i=r.pop();)if(n.push(i),a=i.children)for(s=0,o=a.length;s<o;++s)r.push(a[s]);for(;i=n.pop();)t.call(e,i,++l,this);return this}function UXe(t,e){let i=-1;for(const r of this)if(t.call(e,r,++i,this))return r}function TXe(t){return this.eachAfter(function(e){for(var i=+t(e.data)||0,r=e.children,n=r&&r.length;--n>=0;)i+=r[n].value;e.value=i})}function DXe(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})}function PXe(t){for(var e=this,i=EXe(e,t),r=[e];e!==i;)e=e.parent,r.push(e);for(var n=r.length;t!==i;)r.splice(n,0,t),t=t.parent;return r}function EXe(t,e){if(t===e)return t;var i=t.ancestors(),r=e.ancestors(),n=null;for(t=i.pop(),e=r.pop();t===e;)n=t,t=i.pop(),e=r.pop();return n}function RXe(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e}function CXe(){return Array.from(this)}function MXe(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t}function NXe(){var t=this,e=[];return t.each(function(i){i!==t&&e.push({source:i.parent,target:i})}),e}function*AXe(){var t=this,e,i=[t],r,n,a;do for(e=i.reverse(),i=[];t=e.pop();)if(yield t,r=t.children)for(n=0,a=r.length;n<a;++n)i.push(r[n]);while(i.length)}function xhe(t,e){t instanceof Map?(t=[void 0,t],e===void 0&&(e=xXe)):e===void 0&&(e=OXe);for(var i=new XE(t),r,n=[i],a,s,o,l;r=n.pop();)if((s=e(r.data))&&(l=(s=Array.from(s)).length))for(r.children=s,o=l-1;o>=0;--o)n.push(a=s[o]=new XE(s[o])),a.parent=r,a.depth=r.depth+1;return i.eachBefore(LXe)}function kXe(){return xhe(this).eachBefore(FXe)}function OXe(t){return t.children}function xXe(t){return Array.isArray(t)?t[1]:null}function FXe(t){t.data.value!==void 0&&(t.value=t.data.value),t.data=t.data.data}function LXe(t){var e=0;do t.height=e;while((t=t.parent)&&t.height<++e)}function XE(t){this.data=t,this.depth=this.height=0,this.parent=null}XE.prototype=xhe.prototype={constructor:XE,count:yXe,each:bXe,eachAfter:SXe,eachBefore:wXe,find:UXe,sum:TXe,sort:DXe,path:PXe,ancestors:RXe,descendants:CXe,leaves:MXe,links:NXe,copy:kXe,[Symbol.iterator]:AXe};function Vy(t,e,i){this.k=t,this.x=e,this.y=i}Vy.prototype={constructor:Vy,scale:function(t){return t===1?this:new Vy(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Vy(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Vy.prototype;Object.assign({},...OF.countries.filter(t=>t.ioc).map(t=>({[t.ioc]:t.iso2})),...OF.countries.filter(t=>t.iso).map(t=>({[t.iso]:t.iso2})));const{MALE:_Xe,FEMALE:$Xe}=UR,{PAIR:BXe}=y7,VXe="utr",jXe={utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},Fhe=t=>(e,i,r)=>{const n=e.getColumn().getDefinition(),a=n.field==="side1"&&1||n.field==="side2"&&2,s=document.createElement("div"),o=e.getRow().getData(),l=o.winningSide,u=e.getValue(),c=o.participant||u.participant||o.person&&o;if(c){const d=jXe[VXe],p=h=>$fe({eventHandlers:{participantClick:m=>Zu(t)&&t({...m,event:m.pointerEvent,cell:e})},composition:{configuration:{participantDetail:"TEAM",winnerColor:!0,genderColor:!0,scaleAttributes:d,flag:!1},theme:""},matchUp:o.matchUp,participant:h,placeholder:i,sideNumber:a}),f=h=>{const m=document.createElement("div");return m.className="flexrow flexjustifystart",h.individualParticipants.forEach((g,I)=>{if(m.appendChild(p(g)),!I){const v=document.createElement("span");v.style.width="1em",v.innerHTML="&nbsp;",m.appendChild(v)}}),m};return r==="sideBySide"&&c.participantType===BXe?f(c):p(c)}if(l){const d=n.field===o.winningSide;s.style.color=d?"green":"red"}else{const d=u?.sex||o?.person?.sex,p=d===_Xe&&"#2E86C1"||d===$Xe&&"#AA336A"||"";s.style.color=p}return s.innerHTML=(Ux(u)?u.participantName:u)||"",s};function GXe(t){const e=t.getRow().getData();if(!e.competitiveProfile?.competitiveness)return"";const{competitiveProfile:i,score:r}=e,n=document.createElement("span"),a={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(r){const{competitiveness:s}=i;n.style.fontSize="smaller",n.style.color=a[s],n.innerHTML=s}return n}function HXe(t){const e=t.getRow().getData();if(!e.readyToScore)return"";const i=e.matchUp.matchUpStatus==="WALKOVER",r=document.createElement("span");return r.classList.add("scoreCell"),e.score?(r.style.fontSize="smaller",r.innerHTML=e.score):i?r.innerHTML="WO":(r.style.fontSize="smaller",r.style.color="blue",r.innerHTML="--- --- ---"),r}function WXe(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}function zXe({data:t}){const e=t.some(r=>r.courtName),i=r=>{const n=document.createElement("div");n.className="has-text-warning-dark",n.innerHTML="Select participant";const a=()=>console.log("boo");return r.getValue().participantName&&Fhe(a)(r,n)};return[{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:Hi,minWidth:50,width:50},{formatter:"rownum",headerSort:!1,hozAlign:Gp,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"scheduledDate",title:"Date",width:110},{visible:!!e,field:"courtName",title:"Court",width:100},{field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:i,sorter:YP,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:i,sorter:YP,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{formatter:HXe,sorter:WXe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:h1e,formatter:GXe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:Gp,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70}]}var qXe=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};const{TEAM:YXe}=G1,r6=t=>{const{potentialParticipants:e,structureName:i,matchUpType:r,roundNumber:n,matchUpId:a,roundName:s,schedule:o,eventId:l,drawId:u,sides:c,...d}=t,{scheduledDate:p,scheduleTime:f,courtName:h}=o||{},m=N=>N.person?.standardFamilyName||N.participantName,g=e?.map(N=>({participantName:N.map(m).filter(Boolean).join(" or ")}))||[],I=c?.[0]?.participant||g.shift(),v=c?.[1]?.participant||g.shift(),w={participantName:I?.participantName,sex:I?.person?.sex,participant:I},y={participantName:v?.participantName,sex:v?.person?.sex,participant:v},b=c.flatMap(({participant:N})=>N?.individualParticipantIds?.length?N.individualParticipantIds:N?.participantId).filter(Boolean),S=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,U=!!d.winningSide,T=!!(d.winningSide||d.readyToScore),D=d.score?.scoreStringSide1,P=c.flatMap(N=>{const A=N.participant?.person;return A?[A.standardGivenName,A.standardFamilyName]:N.participant?.individualParticipants?.map(({person:O})=>[O.standardGivenName,O.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),E=qXe([P,I?.participantName,v?.participantName].filter(Boolean).join(" ")).toLowerCase(),R=t.collectionId?YXe:r,C=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,M={score:D,matchUpStatus:t.matchUpStatus,readyToScore:T,complete:U,winningSide:S};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:b,flight:t.drawName,competitiveProfile:C,structureName:i,scheduledDate:p,readyToScore:T,scheduleTime:f,matchUpType:r,scoreDetail:M,winningSide:S,roundNumber:n,searchText:E,courtName:h,eventType:R,matchUpId:a,roundName:s,complete:U,eventId:l,matchUp:t,drawId:u,side1:w,side2:y,score:D}},{CONTAINER:KXe}=kR;async function XXe(t){const{drawId:e,structureId:i,eventData:r}=t;let n,a,s,o,l=t.matchUps;const u=()=>{a=r?.drawsData?.find(y=>y.drawId===e)?.structures?.find(y=>y.structureId===i),o=a?.structureType===KXe;const v=a?.roundMatchUps?Object.values(a?.roundMatchUps||{}).flat():[],w=v.flatMap(y=>y.tieMatchUps||[]);return w.length&&v.push(...w),v.filter(({matchUpStatus:y})=>y!=="BYE").filter(({sides:y})=>!s||y.find(b=>b.participant?.participantName?.toLowerCase().includes(s?.toLowerCase())))};l||(l=await u()),r&&l.forEach(I=>I.eventName=r.eventInfo.eventName);const c=()=>l.map(r6),d=()=>u().map(r6),p=I=>{I.participantFilter&&(s=I.participantFilter),n.replaceData(d())},f=c(),h=zXe({data:f}),m=o?["roundName","structureName"]:["roundName"];return(I=>{aU({anchorId:"flightDisplay"});const v=document.getElementById("flightDisplay");n=new Lv(v,{groupHeader:[f1e,w=>w],headerSortElement:qte(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:m,columns:h,data:I})})(f),{table:n,replaceTableData:p}}const JXe=t=>t.reduce((e,i)=>e+parseFloat(i),0),n6=t=>parseFloat((JXe(t)/t.length).toFixed(2));function a6(t){const{participantResult:e,drawPosition:i,participantId:r,participantMap:n}=t,a=e?.ratingVariation?.length?n6(e.ratingVariation):0,s=e?.pressureScores?.length?n6(e.pressureScores):0,o=`${e?.pointsWon||0}/${e?.pointsLost||0}`,l=`${e?.gamesWon||0}/${e?.gamesLost||0}`,u=`${e?.setsWon||0}/${e?.setsLost||0}`,c=e?.groupOrder||e?.provisionalOrder,d=n[r];return{participantName:d.participantName,groupName:d.groupName,...e,averageVariation:a,averagePressure:s,participantId:r,pointsResult:o,drawPosition:i,participant:d,gamesResult:l,setsResult:u,order:c}}function JE(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:t-e}function Dg(t){const e=t.getValue();return e&&`${(parseFloat(e)*100).toFixed(0)}%`}function s6(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:e-t}function QXe({isAdHoc:t}){return[{formatter:Fhe(({event:e,cell:i,...r})=>console.log("cell clicked",{event:e,cell:i,undefined:void 0,params:r})),sorter:YP,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,title:"Name",widthGrow:2,frozen:!0},{headerHozAlign:Hi,headerWordWrap:!0,title:"Match W/L",hozAlign:Hi,maxWidth:80,field:"result"},{formatter:Dg,headerHozAlign:Hi,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:Hi,maxWidth:80},{headerHozAlign:Hi,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:Hi,maxWidth:80},{formatter:Dg,headerHozAlign:Hi,headerWordWrap:!0,title:"Set Win%",hozAlign:Hi,field:"setsPct",maxWidth:80},{headerHozAlign:Hi,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:Hi,maxWidth:80},{formatter:Dg,headerHozAlign:Hi,headerWordWrap:!0,title:"Game Win%",hozAlign:Hi,field:"gamesPct",maxWidth:80},{headerHozAlign:Hi,headerWordWrap:!0,field:"pointsResult",title:"Points W/L",hozAlign:Hi,maxWidth:80},{formatter:Dg,headerHozAlign:Hi,headerWordWrap:!0,title:"Points Win%",field:"pointsPct",hozAlign:Hi,maxWidth:80},{formatter:Dg,field:"averagePressure",headerHozAlign:Hi,sorter:s6,hozAlign:Hi,maxWidth:70,title:"PS"},{formatter:Dg,field:"averageVariation",headerHozAlign:Hi,sorter:s6,hozAlign:Hi,maxWidth:70,title:"RV"},{headerHozAlign:Hi,field:"pressureOrder",sorter:JE,hozAlign:Hi,visible:t,title:"Order",maxWidth:80},{headerHozAlign:Hi,sorter:JE,visible:!t,hozAlign:Hi,title:"Order",field:"order",maxWidth:80},{field:"groupName",visible:!1,title:"Group"}]}async function ZXe({drawId:t,structureId:e,eventData:i,participants:r=[]}){let n,a,s,l=i?.drawsData?.find(y=>y.drawId===t)?.structures?.find(y=>y.structureId===e);const u=HR.isAdHoc({structure:l}),c=y=>(y??[]).reduce((b,S)=>(b[S.participantId]=S,b),{}),d={},p=()=>(l=i?.drawsData?.find(S=>S.drawId===t)?.structures?.find(S=>S.structureId===e),s||(s=c(r)),(l?.roundMatchUps?Object.values(l.roundMatchUps).flat():[]).forEach(({sides:S,structureName:U,structureId:T})=>{d[T]=U,S.forEach(D=>{D.participantId&&(s[D.participantId].groupName=U)})}),(l?.participantResults??[]).filter(S=>{const U=s[S.participantId];return!a||U?.participantName?.toLowerCase().includes(a?.toLowerCase())})),f=p(),h=()=>f?.map(y=>a6({...y,participantMap:s})).sort((y,b)=>u?JE(y.pressureOrder,b.pressureOrder):JE(y.order,b.order)),m=()=>p()?.map(y=>a6({...y,participantMap:s})),g=y=>{y?.participantFilter!==void 0&&(a=y.participantFilter),n.replaceData(m())},I=h(),v=QXe({isAdHoc:u});return(y=>{aU({anchorId:"flightDisplay"});const b=document.getElementById("flightDisplay"),S=Object.values(d).length>1?["groupName"]:void 0;n=new Lv(b,{headerSortElement:qte(["averageVariation","averagePressure","participantName","gamesResult","matchUpsPct","setsResult","gamesPct","setsPct","result","order"]),height:window.innerHeight*.85,groupHeader:[U=>U],placeholder:"No participants",renderHorizontal:"virtual",index:"matchUpId",groupBy:S,columns:v,data:y})})(I),{table:n,replaceTableData:g}}const{CONTAINER:eJe}=kR;function tJe(t){const{callback:e,structure:i,existingView:r}=t,n=l=>r!==l&&Zu(e)&&e({refresh:!0,view:l}),a=i?.structureType===eJe,s=LNe.isAdHoc({structure:i}),o=[];return r!==zz&&o.push({onClick:()=>n(zz),label:bo(s?"display.columns":"display.draw"),close:!0}),r!==Yz&&o.push({onClick:()=>n(Yz),label:bo("display.tableView"),close:!0}),(s||a)&&r!==qz&&o.push({onClick:()=>n(qz),label:bo("display.statistics"),close:!0}),{label:bo("display.label"),id:"roundDisplayButton",options:o,selection:!1,location:Hh,align:Hh}}function o6({tournamentId:t,eventId:e,header:i,flightDisplay:r,displayFormat:n,drawId:a,structureId:s}){const o=()=>document.getElementById("structureButton")?.remove(),l=()=>document.getElementById("roundDisplayButton")?.remove();zte({tournamentId:t,eventId:e,hydrateParticipants:!1}).then(c=>{const d=c?.data?.eventData||c?.data,p=c?.data?.participants||[];window?.dev&&(window.dev.eventData=d);const f=b=>Object.values(b.roundMatchUps||{}).flat(),h=b=>b.structures?.some(S=>f(S).length>0),m=d?.drawsData.filter(h);{const b=new Map(p.map(U=>[U.participantId,U])),S=U=>{for(const T of U.sides||[])T.participantId&&(T.participant=b.get(T.participantId),T.participant?.individualParticipantIds&&(T.participant.individualParticipants=T.participant.individualParticipantIds.map(D=>b.get(D))))};for(const U of m)for(const T of U.structures)Object.values(T.roundMatchUps||{}).flat().forEach(D=>{S(D),D.tieMatchUps?.forEach(S)})}const g=b=>{const S=m[b];if(!S)return;const U=S.drawId,T=({view:R})=>{R&&(n=R),g(b)},D=R=>{const C=S.structures?.[R];l();const M=tJe({callback:T,structure:C}),N=Ih({button:M});i.appendChild(N);const A=C.structureId,O=Object.values(C.roundMatchUps||{}).flat();HR.isAdHoc({structure:C})&&O.sort(yM.matchUpScheduleSort),r.innerHTML=S.drawName,pp(r);const F={...d?.eventInfo?.display,...S?.display,...C?.display},x=F?.compositionName,L=F?.configuration,$=hKe[x??"National"];if(Object.assign($.configuration,L),$.configuration.genderColor=!0,n==="roundsColumns"){const V=uKe({content:lKe({context:{drawId:U,structureId:A},matchUps:O,composition:$,structureId:A}),theme:$.theme});r.appendChild(V)}else n==="roundsStats"?ZXe({drawId:U,structureId:A,eventData:d,participants:p}):XXe({drawId:U,structureId:A,eventData:d})},P=s?Math.max(S.structures?.findIndex(R=>R.structureId===s)??-1,0):0;if(s=void 0,S.structures?.length>1){const R=S.structures.map(({structureName:N,structureId:A},O)=>({onClick:()=>{sh({tournamentId:t,eventId:e,drawId:U,structureId:A}),D(O)},isActive:O===P,label:N,close:!0})),C={label:S.structures[P].structureName,options:R,id:"structureButton",modifyLabel:!0,selection:!0,location:Gp},M=Ih({button:C});i.appendChild(M)}S.structures?.[P]&&D(P)},I=a?Math.max(m.findIndex(b=>b.drawId===a),0):0;a=void 0;const v=m.map(({drawName:b,drawId:S},U)=>({onClick:()=>{sh({tournamentId:t,eventId:e,drawId:S}),g(U)},isActive:U===I,label:b,close:!0})),w={label:m?.[I]?.drawName,options:v,modifyLabel:!0,id:"flightButton",selection:!0,location:Gp},y=Ih({button:w,stateChange:o});i.appendChild(y),g(I)})}function pp(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}function iJe(t,e,i,r,n){if(n){const a=e.target.value;n(a)?(r.innerHTML="",r.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(r.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),r.classList.add("is-danger"))}}var Js="top",Rl="bottom",Cl="right",Qs="left",YH="auto",OT=[Js,Rl,Cl,Qs],ev="start",Lw="end",rJe="clippingParents",Lhe="viewport",Ny="popper",nJe="reference",l6=OT.reduce(function(t,e){return t.concat([e+"-"+ev,e+"-"+Lw])},[]),_he=[].concat(OT,[YH]).reduce(function(t,e){return t.concat([e,e+"-"+ev,e+"-"+Lw])},[]),aJe="beforeRead",sJe="read",oJe="afterRead",lJe="beforeMain",uJe="main",cJe="afterMain",dJe="beforeWrite",pJe="write",fJe="afterWrite",hJe=[aJe,sJe,oJe,lJe,uJe,cJe,dJe,pJe,fJe];function Lc(t){return t?(t.nodeName||"").toLowerCase():null}function Bo(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function om(t){var e=Bo(t).Element;return t instanceof e||t instanceof Element}function ll(t){var e=Bo(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function KH(t){if(typeof ShadowRoot>"u")return!1;var e=Bo(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function mJe(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var r=e.styles[i]||{},n=e.attributes[i]||{},a=e.elements[i];!ll(a)||!Lc(a)||(Object.assign(a.style,r),Object.keys(n).forEach(function(s){var o=n[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function gJe(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(r){var n=e.elements[r],a=e.attributes[r]||{},s=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:i[r]),o=s.reduce(function(l,u){return l[u]="",l},{});!ll(n)||!Lc(n)||(Object.assign(n.style,o),Object.keys(a).forEach(function(l){n.removeAttribute(l)}))})}}const $he={name:"applyStyles",enabled:!0,phase:"write",fn:mJe,effect:gJe,requires:["computeStyles"]};function pc(t){return t.split("-")[0]}var Ah=Math.max,QE=Math.min,tv=Math.round;function qF(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Bhe(){return!/^((?!chrome|android).)*safari/i.test(qF())}function iv(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var r=t.getBoundingClientRect(),n=1,a=1;e&&ll(t)&&(n=t.offsetWidth>0&&tv(r.width)/t.offsetWidth||1,a=t.offsetHeight>0&&tv(r.height)/t.offsetHeight||1);var s=om(t)?Bo(t):window,o=s.visualViewport,l=!Bhe()&&i,u=(r.left+(l&&o?o.offsetLeft:0))/n,c=(r.top+(l&&o?o.offsetTop:0))/a,d=r.width/n,p=r.height/a;return{width:d,height:p,top:c,right:u+d,bottom:c+p,left:u,x:u,y:c}}function XH(t){var e=iv(t),i=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:r}}function Vhe(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&KH(i)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function $d(t){return Bo(t).getComputedStyle(t)}function IJe(t){return["table","td","th"].indexOf(Lc(t))>=0}function Ff(t){return((om(t)?t.ownerDocument:t.document)||window.document).documentElement}function YA(t){return Lc(t)==="html"?t:t.assignedSlot||t.parentNode||(KH(t)?t.host:null)||Ff(t)}function u6(t){return!ll(t)||$d(t).position==="fixed"?null:t.offsetParent}function vJe(t){var e=/firefox/i.test(qF()),i=/Trident/i.test(qF());if(i&&ll(t)){var r=$d(t);if(r.position==="fixed")return null}var n=YA(t);for(KH(n)&&(n=n.host);ll(n)&&["html","body"].indexOf(Lc(n))<0;){var a=$d(n);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return n;n=n.parentNode}return null}function xT(t){for(var e=Bo(t),i=u6(t);i&&IJe(i)&&$d(i).position==="static";)i=u6(i);return i&&(Lc(i)==="html"||Lc(i)==="body"&&$d(i).position==="static")?e:i||vJe(t)||e}function JH(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function Sb(t,e,i){return Ah(t,QE(e,i))}function yJe(t,e,i){var r=Sb(t,e,i);return r>i?i:r}function jhe(){return{top:0,right:0,bottom:0,left:0}}function Ghe(t){return Object.assign({},jhe(),t)}function Hhe(t,e){return e.reduce(function(i,r){return i[r]=t,i},{})}var bJe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Ghe(typeof e!="number"?e:Hhe(e,OT))};function wJe(t){var e,i=t.state,r=t.name,n=t.options,a=i.elements.arrow,s=i.modifiersData.popperOffsets,o=pc(i.placement),l=JH(o),u=[Qs,Cl].indexOf(o)>=0,c=u?"height":"width";if(!(!a||!s)){var d=bJe(n.padding,i),p=XH(a),f=l==="y"?Js:Qs,h=l==="y"?Rl:Cl,m=i.rects.reference[c]+i.rects.reference[l]-s[l]-i.rects.popper[c],g=s[l]-i.rects.reference[l],I=xT(a),v=I?l==="y"?I.clientHeight||0:I.clientWidth||0:0,w=m/2-g/2,y=d[f],b=v-p[c]-d[h],S=v/2-p[c]/2+w,U=Sb(y,S,b),T=l;i.modifiersData[r]=(e={},e[T]=U,e.centerOffset=U-S,e)}}function SJe(t){var e=t.state,i=t.options,r=i.element,n=r===void 0?"[data-popper-arrow]":r;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||Vhe(e.elements.popper,n)&&(e.elements.arrow=n))}const UJe={name:"arrow",enabled:!0,phase:"main",fn:wJe,effect:SJe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function rv(t){return t.split("-")[1]}var TJe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function DJe(t,e){var i=t.x,r=t.y,n=e.devicePixelRatio||1;return{x:tv(i*n)/n||0,y:tv(r*n)/n||0}}function c6(t){var e,i=t.popper,r=t.popperRect,n=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,d=t.isFixed,p=s.x,f=p===void 0?0:p,h=s.y,m=h===void 0?0:h,g=typeof c=="function"?c({x:f,y:m}):{x:f,y:m};f=g.x,m=g.y;var I=s.hasOwnProperty("x"),v=s.hasOwnProperty("y"),w=Qs,y=Js,b=window;if(u){var S=xT(i),U="clientHeight",T="clientWidth";if(S===Bo(i)&&(S=Ff(i),$d(S).position!=="static"&&o==="absolute"&&(U="scrollHeight",T="scrollWidth")),S=S,n===Js||(n===Qs||n===Cl)&&a===Lw){y=Rl;var D=d&&S===b&&b.visualViewport?b.visualViewport.height:S[U];m-=D-r.height,m*=l?1:-1}if(n===Qs||(n===Js||n===Rl)&&a===Lw){w=Cl;var P=d&&S===b&&b.visualViewport?b.visualViewport.width:S[T];f-=P-r.width,f*=l?1:-1}}var E=Object.assign({position:o},u&&TJe),R=c===!0?DJe({x:f,y:m},Bo(i)):{x:f,y:m};if(f=R.x,m=R.y,l){var C;return Object.assign({},E,(C={},C[y]=v?"0":"",C[w]=I?"0":"",C.transform=(b.devicePixelRatio||1)<=1?"translate("+f+"px, "+m+"px)":"translate3d("+f+"px, "+m+"px, 0)",C))}return Object.assign({},E,(e={},e[y]=v?m+"px":"",e[w]=I?f+"px":"",e.transform="",e))}function PJe(t){var e=t.state,i=t.options,r=i.gpuAcceleration,n=r===void 0?!0:r,a=i.adaptive,s=a===void 0?!0:a,o=i.roundOffsets,l=o===void 0?!0:o,u={placement:pc(e.placement),variation:rv(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,c6(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,c6(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const EJe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:PJe,data:{}};var sD={passive:!0};function RJe(t){var e=t.state,i=t.instance,r=t.options,n=r.scroll,a=n===void 0?!0:n,s=r.resize,o=s===void 0?!0:s,l=Bo(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",i.update,sD)}),o&&l.addEventListener("resize",i.update,sD),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",i.update,sD)}),o&&l.removeEventListener("resize",i.update,sD)}}const CJe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:RJe,data:{}};var MJe={left:"right",right:"left",bottom:"top",top:"bottom"};function XD(t){return t.replace(/left|right|bottom|top/g,function(e){return MJe[e]})}var NJe={start:"end",end:"start"};function d6(t){return t.replace(/start|end/g,function(e){return NJe[e]})}function QH(t){var e=Bo(t),i=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:i,scrollTop:r}}function ZH(t){return iv(Ff(t)).left+QH(t).scrollLeft}function AJe(t,e){var i=Bo(t),r=Ff(t),n=i.visualViewport,a=r.clientWidth,s=r.clientHeight,o=0,l=0;if(n){a=n.width,s=n.height;var u=Bhe();(u||!u&&e==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}return{width:a,height:s,x:o+ZH(t),y:l}}function kJe(t){var e,i=Ff(t),r=QH(t),n=(e=t.ownerDocument)==null?void 0:e.body,a=Ah(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),s=Ah(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-r.scrollLeft+ZH(t),l=-r.scrollTop;return $d(n||i).direction==="rtl"&&(o+=Ah(i.clientWidth,n?n.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function eW(t){var e=$d(t),i=e.overflow,r=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function Whe(t){return["html","body","#document"].indexOf(Lc(t))>=0?t.ownerDocument.body:ll(t)&&eW(t)?t:Whe(YA(t))}function Ub(t,e){var i;e===void 0&&(e=[]);var r=Whe(t),n=r===((i=t.ownerDocument)==null?void 0:i.body),a=Bo(r),s=n?[a].concat(a.visualViewport||[],eW(r)?r:[]):r,o=e.concat(s);return n?o:o.concat(Ub(YA(s)))}function YF(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function OJe(t,e){var i=iv(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function p6(t,e,i){return e===Lhe?YF(AJe(t,i)):om(e)?OJe(e,i):YF(kJe(Ff(t)))}function xJe(t){var e=Ub(YA(t)),i=["absolute","fixed"].indexOf($d(t).position)>=0,r=i&&ll(t)?xT(t):t;return om(r)?e.filter(function(n){return om(n)&&Vhe(n,r)&&Lc(n)!=="body"}):[]}function FJe(t,e,i,r){var n=e==="clippingParents"?xJe(t):[].concat(e),a=[].concat(n,[i]),s=a[0],o=a.reduce(function(l,u){var c=p6(t,u,r);return l.top=Ah(c.top,l.top),l.right=QE(c.right,l.right),l.bottom=QE(c.bottom,l.bottom),l.left=Ah(c.left,l.left),l},p6(t,s,r));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function zhe(t){var e=t.reference,i=t.element,r=t.placement,n=r?pc(r):null,a=r?rv(r):null,s=e.x+e.width/2-i.width/2,o=e.y+e.height/2-i.height/2,l;switch(n){case Js:l={x:s,y:e.y-i.height};break;case Rl:l={x:s,y:e.y+e.height};break;case Cl:l={x:e.x+e.width,y:o};break;case Qs:l={x:e.x-i.width,y:o};break;default:l={x:e.x,y:e.y}}var u=n?JH(n):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case ev:l[u]=l[u]-(e[c]/2-i[c]/2);break;case Lw:l[u]=l[u]+(e[c]/2-i[c]/2);break}}return l}function _w(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=r===void 0?t.placement:r,a=i.strategy,s=a===void 0?t.strategy:a,o=i.boundary,l=o===void 0?rJe:o,u=i.rootBoundary,c=u===void 0?Lhe:u,d=i.elementContext,p=d===void 0?Ny:d,f=i.altBoundary,h=f===void 0?!1:f,m=i.padding,g=m===void 0?0:m,I=Ghe(typeof g!="number"?g:Hhe(g,OT)),v=p===Ny?nJe:Ny,w=t.rects.popper,y=t.elements[h?v:p],b=FJe(om(y)?y:y.contextElement||Ff(t.elements.popper),l,c,s),S=iv(t.elements.reference),U=zhe({reference:S,element:w,placement:n}),T=YF(Object.assign({},w,U)),D=p===Ny?T:S,P={top:b.top-D.top+I.top,bottom:D.bottom-b.bottom+I.bottom,left:b.left-D.left+I.left,right:D.right-b.right+I.right},E=t.modifiersData.offset;if(p===Ny&&E){var R=E[n];Object.keys(P).forEach(function(C){var M=[Cl,Rl].indexOf(C)>=0?1:-1,N=[Js,Rl].indexOf(C)>=0?"y":"x";P[C]+=R[N]*M})}return P}function LJe(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=i.boundary,a=i.rootBoundary,s=i.padding,o=i.flipVariations,l=i.allowedAutoPlacements,u=l===void 0?_he:l,c=rv(r),d=c?o?l6:l6.filter(function(h){return rv(h)===c}):OT,p=d.filter(function(h){return u.indexOf(h)>=0});p.length===0&&(p=d);var f=p.reduce(function(h,m){return h[m]=_w(t,{placement:m,boundary:n,rootBoundary:a,padding:s})[pc(m)],h},{});return Object.keys(f).sort(function(h,m){return f[h]-f[m]})}function _Je(t){if(pc(t)===YH)return[];var e=XD(t);return[d6(t),e,d6(e)]}function $Je(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!0:s,l=i.fallbackPlacements,u=i.padding,c=i.boundary,d=i.rootBoundary,p=i.altBoundary,f=i.flipVariations,h=f===void 0?!0:f,m=i.allowedAutoPlacements,g=e.options.placement,I=pc(g),v=I===g,w=l||(v||!h?[XD(g)]:_Je(g)),y=[g].concat(w).reduce(function(_,B){return _.concat(pc(B)===YH?LJe(e,{placement:B,boundary:c,rootBoundary:d,padding:u,flipVariations:h,allowedAutoPlacements:m}):B)},[]),b=e.rects.reference,S=e.rects.popper,U=new Map,T=!0,D=y[0],P=0;P<y.length;P++){var E=y[P],R=pc(E),C=rv(E)===ev,M=[Js,Rl].indexOf(R)>=0,N=M?"width":"height",A=_w(e,{placement:E,boundary:c,rootBoundary:d,altBoundary:p,padding:u}),O=M?C?Cl:Qs:C?Rl:Js;b[N]>S[N]&&(O=XD(O));var k=XD(O),F=[];if(a&&F.push(A[R]<=0),o&&F.push(A[O]<=0,A[k]<=0),F.every(function(_){return _})){D=E,T=!1;break}U.set(E,F)}if(T)for(var x=h?3:1,L=function(B){var G=y.find(function(j){var Y=U.get(j);if(Y)return Y.slice(0,B).every(function(K){return K})});if(G)return D=G,"break"},$=x;$>0;$--){var V=L($);if(V==="break")break}e.placement!==D&&(e.modifiersData[r]._skip=!0,e.placement=D,e.reset=!0)}}const BJe={name:"flip",enabled:!0,phase:"main",fn:$Je,requiresIfExists:["offset"],data:{_skip:!1}};function f6(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function h6(t){return[Js,Cl,Rl,Qs].some(function(e){return t[e]>=0})}function VJe(t){var e=t.state,i=t.name,r=e.rects.reference,n=e.rects.popper,a=e.modifiersData.preventOverflow,s=_w(e,{elementContext:"reference"}),o=_w(e,{altBoundary:!0}),l=f6(s,r),u=f6(o,n,a),c=h6(l),d=h6(u);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":d})}const jJe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:VJe};function GJe(t,e,i){var r=pc(t),n=[Qs,Js].indexOf(r)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,s=a[0],o=a[1];return s=s||0,o=(o||0)*n,[Qs,Cl].indexOf(r)>=0?{x:o,y:s}:{x:s,y:o}}function HJe(t){var e=t.state,i=t.options,r=t.name,n=i.offset,a=n===void 0?[0,0]:n,s=_he.reduce(function(c,d){return c[d]=GJe(d,e.rects,a),c},{}),o=s[e.placement],l=o.x,u=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[r]=s}const WJe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:HJe};function zJe(t){var e=t.state,i=t.name;e.modifiersData[i]=zhe({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const qJe={name:"popperOffsets",enabled:!0,phase:"read",fn:zJe,data:{}};function YJe(t){return t==="x"?"y":"x"}function KJe(t){var e=t.state,i=t.options,r=t.name,n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!1:s,l=i.boundary,u=i.rootBoundary,c=i.altBoundary,d=i.padding,p=i.tether,f=p===void 0?!0:p,h=i.tetherOffset,m=h===void 0?0:h,g=_w(e,{boundary:l,rootBoundary:u,padding:d,altBoundary:c}),I=pc(e.placement),v=rv(e.placement),w=!v,y=JH(I),b=YJe(y),S=e.modifiersData.popperOffsets,U=e.rects.reference,T=e.rects.popper,D=typeof m=="function"?m(Object.assign({},e.rects,{placement:e.placement})):m,P=typeof D=="number"?{mainAxis:D,altAxis:D}:Object.assign({mainAxis:0,altAxis:0},D),E=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,R={x:0,y:0};if(S){if(a){var C,M=y==="y"?Js:Qs,N=y==="y"?Rl:Cl,A=y==="y"?"height":"width",O=S[y],k=O+g[M],F=O-g[N],x=f?-T[A]/2:0,L=v===ev?U[A]:T[A],$=v===ev?-T[A]:-U[A],V=e.elements.arrow,_=f&&V?XH(V):{width:0,height:0},B=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:jhe(),G=B[M],j=B[N],Y=Sb(0,U[A],_[A]),K=w?U[A]/2-x-Y-G-P.mainAxis:L-Y-G-P.mainAxis,X=w?-U[A]/2+x+Y+j+P.mainAxis:$+Y+j+P.mainAxis,Z=e.elements.arrow&&xT(e.elements.arrow),Q=Z?y==="y"?Z.clientTop||0:Z.clientLeft||0:0,ae=(C=E?.[y])!=null?C:0,te=O+K-ae-Q,ne=O+X-ae,le=Sb(f?QE(k,te):k,O,f?Ah(F,ne):F);S[y]=le,R[y]=le-O}if(o){var de,pe=y==="x"?Js:Qs,ve=y==="x"?Rl:Cl,Me=S[b],Ee=b==="y"?"height":"width",Be=Me+g[pe],fe=Me-g[ve],Te=[Js,Qs].indexOf(I)!==-1,ce=(de=E?.[b])!=null?de:0,be=Te?Be:Me-U[Ee]-T[Ee]-ce+P.altAxis,we=Te?Me+U[Ee]+T[Ee]-ce-P.altAxis:fe,Ae=f&&Te?yJe(be,Me,we):Sb(f?be:Be,Me,f?we:fe);S[b]=Ae,R[b]=Ae-Me}e.modifiersData[r]=R}}const XJe={name:"preventOverflow",enabled:!0,phase:"main",fn:KJe,requiresIfExists:["offset"]};function JJe(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function QJe(t){return t===Bo(t)||!ll(t)?QH(t):JJe(t)}function ZJe(t){var e=t.getBoundingClientRect(),i=tv(e.width)/t.offsetWidth||1,r=tv(e.height)/t.offsetHeight||1;return i!==1||r!==1}function eQe(t,e,i){i===void 0&&(i=!1);var r=ll(e),n=ll(e)&&ZJe(e),a=Ff(e),s=iv(t,n,i),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((Lc(e)!=="body"||eW(a))&&(o=QJe(e)),ll(e)?(l=iv(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=ZH(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function tQe(t){var e=new Map,i=new Set,r=[];t.forEach(function(a){e.set(a.name,a)});function n(a){i.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!i.has(o)){var l=e.get(o);l&&n(l)}}),r.push(a)}return t.forEach(function(a){i.has(a.name)||n(a)}),r}function iQe(t){var e=tQe(t);return hJe.reduce(function(i,r){return i.concat(e.filter(function(n){return n.phase===r}))},[])}function rQe(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function nQe(t){var e=t.reduce(function(i,r){var n=i[r.name];return i[r.name]=n?Object.assign({},n,r,{options:Object.assign({},n.options,r.options),data:Object.assign({},n.data,r.data)}):r,i},{});return Object.keys(e).map(function(i){return e[i]})}var m6={placement:"bottom",modifiers:[],strategy:"absolute"};function g6(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function aQe(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,r=i===void 0?[]:i,n=e.defaultOptions,a=n===void 0?m6:n;return function(o,l,u){u===void 0&&(u=a);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},m6,a),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},d=[],p=!1,f={state:c,setOptions:function(I){var v=typeof I=="function"?I(c.options):I;m(),c.options=Object.assign({},a,c.options,v),c.scrollParents={reference:om(o)?Ub(o):o.contextElement?Ub(o.contextElement):[],popper:Ub(l)};var w=iQe(nQe([].concat(r,c.options.modifiers)));return c.orderedModifiers=w.filter(function(y){return y.enabled}),h(),f.update()},forceUpdate:function(){if(!p){var I=c.elements,v=I.reference,w=I.popper;if(g6(v,w)){c.rects={reference:eQe(v,xT(w),c.options.strategy==="fixed"),popper:XH(w)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(P){return c.modifiersData[P.name]=Object.assign({},P.data)});for(var y=0;y<c.orderedModifiers.length;y++){if(c.reset===!0){c.reset=!1,y=-1;continue}var b=c.orderedModifiers[y],S=b.fn,U=b.options,T=U===void 0?{}:U,D=b.name;typeof S=="function"&&(c=S({state:c,options:T,name:D,instance:f})||c)}}}},update:rQe(function(){return new Promise(function(g){f.forceUpdate(),g(c)})}),destroy:function(){m(),p=!0}};if(!g6(o,l))return f;f.setOptions(u).then(function(g){!p&&u.onFirstUpdate&&u.onFirstUpdate(g)});function h(){c.orderedModifiers.forEach(function(g){var I=g.name,v=g.options,w=v===void 0?{}:v,y=g.effect;if(typeof y=="function"){var b=y({state:c,name:I,instance:f,options:w}),S=function(){};d.push(b||S)}})}function m(){d.forEach(function(g){return g()}),d=[]}return f}}var sQe=[CJe,qJe,EJe,$he,WJe,BJe,XJe,UJe,jJe],oQe=aQe({defaultModifiers:sQe}),lQe="tippy-box",qhe="tippy-content",uQe="tippy-backdrop",Yhe="tippy-arrow",Khe="tippy-svg-arrow",Xf={passive:!0,capture:!0},Xhe=function(){return document.body};function lO(t,e,i){if(Array.isArray(t)){var r=t[e];return r??(Array.isArray(i)?i[e]:i)}return t}function tW(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function Jhe(t,e){return typeof t=="function"?t.apply(void 0,e):t}function I6(t,e){if(e===0)return t;var i;return function(r){clearTimeout(i),i=setTimeout(function(){t(r)},e)}}function cQe(t){return t.split(/\s+/).filter(Boolean)}function Mg(t){return[].concat(t)}function v6(t,e){t.indexOf(e)===-1&&t.push(e)}function dQe(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function pQe(t){return t.split("-")[0]}function ZE(t){return[].slice.call(t)}function y6(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function Tb(){return document.createElement("div")}function KA(t){return["Element","Fragment"].some(function(e){return tW(t,e)})}function fQe(t){return tW(t,"NodeList")}function hQe(t){return tW(t,"MouseEvent")}function mQe(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function gQe(t){return KA(t)?[t]:fQe(t)?ZE(t):Array.isArray(t)?t:ZE(document.querySelectorAll(t))}function uO(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function b6(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function IQe(t){var e,i=Mg(t),r=i[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function vQe(t,e){var i=e.clientX,r=e.clientY;return t.every(function(n){var a=n.popperRect,s=n.popperState,o=n.props,l=o.interactiveBorder,u=pQe(s.placement),c=s.modifiersData.offset;if(!c)return!0;var d=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,f=u==="right"?c.left.x:0,h=u==="left"?c.right.x:0,m=a.top-r+d>l,g=r-a.bottom-p>l,I=a.left-i+f>l,v=i-a.right-h>l;return m||g||I||v})}function cO(t,e,i){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(n){t[r](n,i)})}function w6(t,e){for(var i=e;i;){var r;if(t.contains(i))return!0;i=i.getRootNode==null||(r=i.getRootNode())==null?void 0:r.host}return!1}var Yu={isTouch:!1},S6=0;function yQe(){Yu.isTouch||(Yu.isTouch=!0,window.performance&&document.addEventListener("mousemove",Qhe))}function Qhe(){var t=performance.now();t-S6<20&&(Yu.isTouch=!1,document.removeEventListener("mousemove",Qhe)),S6=t}function bQe(){var t=document.activeElement;if(mQe(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function wQe(){document.addEventListener("touchstart",yQe,Xf),window.addEventListener("blur",bQe)}var SQe=typeof window<"u"&&typeof document<"u",UQe=SQe?!!window.msCrypto:!1,TQe={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},DQe={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Yl=Object.assign({appendTo:Xhe,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},TQe,DQe),PQe=Object.keys(Yl),EQe=function(e){var i=Object.keys(e);i.forEach(function(r){Yl[r]=e[r]})};function Zhe(t){var e=t.plugins||[],i=e.reduce(function(r,n){var a=n.name,s=n.defaultValue;if(a){var o;r[a]=t[a]!==void 0?t[a]:(o=Yl[a])!=null?o:s}return r},{});return Object.assign({},t,i)}function RQe(t,e){var i=e?Object.keys(Zhe(Object.assign({},Yl,{plugins:e}))):PQe,r=i.reduce(function(n,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return n;if(a==="content")n[a]=s;else try{n[a]=JSON.parse(s)}catch{n[a]=s}return n},{});return r}function U6(t,e){var i=Object.assign({},e,{content:Jhe(e.content,[t])},e.ignoreAttributes?{}:RQe(t,e.plugins));return i.aria=Object.assign({},Yl.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var CQe=function(){return"innerHTML"};function KF(t,e){t[CQe()]=e}function T6(t){var e=Tb();return t===!0?e.className=Yhe:(e.className=Khe,KA(t)?e.appendChild(t):KF(e,t)),e}function D6(t,e){KA(e.content)?(KF(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?KF(t,e.content):t.textContent=e.content)}function XF(t){var e=t.firstElementChild,i=ZE(e.children);return{box:e,content:i.find(function(r){return r.classList.contains(qhe)}),arrow:i.find(function(r){return r.classList.contains(Yhe)||r.classList.contains(Khe)}),backdrop:i.find(function(r){return r.classList.contains(uQe)})}}function eme(t){var e=Tb(),i=Tb();i.className=lQe,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=Tb();r.className=qhe,r.setAttribute("data-state","hidden"),D6(r,t.props),e.appendChild(i),i.appendChild(r),n(t.props,t.props);function n(a,s){var o=XF(e),l=o.box,u=o.content,c=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&D6(u,t.props),s.arrow?c?a.arrow!==s.arrow&&(l.removeChild(c),l.appendChild(T6(s.arrow))):l.appendChild(T6(s.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:n}}eme.$$tippy=!0;var MQe=1,oD=[],dO=[];function NQe(t,e){var i=U6(t,Object.assign({},Yl,Zhe(y6(e)))),r,n,a,s=!1,o=!1,l=!1,u=!1,c,d,p,f=[],h=I6(te,i.interactiveDebounce),m,g=MQe++,I=null,v=dQe(i.plugins),w={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},y={id:g,reference:t,popper:Tb(),popperInstance:I,props:i,state:w,plugins:v,clearDelayTimeouts:be,setProps:we,setContent:Ae,show:ye,hide:Ne,hideWithInteractivity:he,enable:Te,disable:ce,unmount:De,destroy:Le};if(!i.render)return y;var b=i.render(y),S=b.popper,U=b.onUpdate;S.setAttribute("data-tippy-root",""),S.id="tippy-"+y.id,y.popper=S,t._tippy=y,S._tippy=y;var T=v.map(function(J){return J.fn(y)}),D=t.hasAttribute("aria-expanded");return Z(),x(),O(),k("onCreate",[y]),i.showOnCreate&&Be(),S.addEventListener("mouseenter",function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()}),S.addEventListener("mouseleave",function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&M().addEventListener("mousemove",h)}),y;function P(){var J=y.props.touch;return Array.isArray(J)?J:[J,0]}function E(){return P()[0]==="hold"}function R(){var J;return!!((J=y.props.render)!=null&&J.$$tippy)}function C(){return m||t}function M(){var J=C().parentNode;return J?IQe(J):document}function N(){return XF(S)}function A(J){return y.state.isMounted&&!y.state.isVisible||Yu.isTouch||c&&c.type==="focus"?0:lO(y.props.delay,J?0:1,Yl.delay)}function O(J){J===void 0&&(J=!1),S.style.pointerEvents=y.props.interactive&&!J?"":"none",S.style.zIndex=""+y.props.zIndex}function k(J,se,oe){if(oe===void 0&&(oe=!0),T.forEach(function(ee){ee[J]&&ee[J].apply(ee,se)}),oe){var ue;(ue=y.props)[J].apply(ue,se)}}function F(){var J=y.props.aria;if(J.content){var se="aria-"+J.content,oe=S.id,ue=Mg(y.props.triggerTarget||t);ue.forEach(function(ee){var Se=ee.getAttribute(se);if(y.state.isVisible)ee.setAttribute(se,Se?Se+" "+oe:oe);else{var Pe=Se&&Se.replace(oe,"").trim();Pe?ee.setAttribute(se,Pe):ee.removeAttribute(se)}})}}function x(){if(!(D||!y.props.aria.expanded)){var J=Mg(y.props.triggerTarget||t);J.forEach(function(se){y.props.interactive?se.setAttribute("aria-expanded",y.state.isVisible&&se===C()?"true":"false"):se.removeAttribute("aria-expanded")})}}function L(){M().removeEventListener("mousemove",h),oD=oD.filter(function(J){return J!==h})}function $(J){if(!(Yu.isTouch&&(l||J.type==="mousedown"))){var se=J.composedPath&&J.composedPath()[0]||J.target;if(!(y.props.interactive&&w6(S,se))){if(Mg(y.props.triggerTarget||t).some(function(oe){return w6(oe,se)})){if(Yu.isTouch||y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else k("onClickOutside",[y,J]);y.props.hideOnClick===!0&&(y.clearDelayTimeouts(),y.hide(),o=!0,setTimeout(function(){o=!1}),y.state.isMounted||G())}}}function V(){l=!0}function _(){l=!1}function B(){var J=M();J.addEventListener("mousedown",$,!0),J.addEventListener("touchend",$,Xf),J.addEventListener("touchstart",_,Xf),J.addEventListener("touchmove",V,Xf)}function G(){var J=M();J.removeEventListener("mousedown",$,!0),J.removeEventListener("touchend",$,Xf),J.removeEventListener("touchstart",_,Xf),J.removeEventListener("touchmove",V,Xf)}function j(J,se){K(J,function(){!y.state.isVisible&&S.parentNode&&S.parentNode.contains(S)&&se()})}function Y(J,se){K(J,se)}function K(J,se){var oe=N().box;function ue(ee){ee.target===oe&&(cO(oe,"remove",ue),se())}if(J===0)return se();cO(oe,"remove",d),cO(oe,"add",ue),d=ue}function X(J,se,oe){oe===void 0&&(oe=!1);var ue=Mg(y.props.triggerTarget||t);ue.forEach(function(ee){ee.addEventListener(J,se,oe),f.push({node:ee,eventType:J,handler:se,options:oe})})}function Z(){E()&&(X("touchstart",ae,{passive:!0}),X("touchend",ne,{passive:!0})),cQe(y.props.trigger).forEach(function(J){if(J!=="manual")switch(X(J,ae),J){case"mouseenter":X("mouseleave",ne);break;case"focus":X(UQe?"focusout":"blur",le);break;case"focusin":X("focusout",le);break}})}function Q(){f.forEach(function(J){var se=J.node,oe=J.eventType,ue=J.handler,ee=J.options;se.removeEventListener(oe,ue,ee)}),f=[]}function ae(J){var se,oe=!1;if(!(!y.state.isEnabled||de(J)||o)){var ue=((se=c)==null?void 0:se.type)==="focus";c=J,m=J.currentTarget,x(),!y.state.isVisible&&hQe(J)&&oD.forEach(function(ee){return ee(J)}),J.type==="click"&&(y.props.trigger.indexOf("mouseenter")<0||s)&&y.props.hideOnClick!==!1&&y.state.isVisible?oe=!0:Be(J),J.type==="click"&&(s=!oe),oe&&!ue&&fe(J)}}function te(J){var se=J.target,oe=C().contains(se)||S.contains(se);if(!(J.type==="mousemove"&&oe)){var ue=Ee().concat(S).map(function(ee){var Se,Pe=ee._tippy,st=(Se=Pe.popperInstance)==null?void 0:Se.state;return st?{popperRect:ee.getBoundingClientRect(),popperState:st,props:i}:null}).filter(Boolean);vQe(ue,J)&&(L(),fe(J))}}function ne(J){var se=de(J)||y.props.trigger.indexOf("click")>=0&&s;if(!se){if(y.props.interactive){y.hideWithInteractivity(J);return}fe(J)}}function le(J){y.props.trigger.indexOf("focusin")<0&&J.target!==C()||y.props.interactive&&J.relatedTarget&&S.contains(J.relatedTarget)||fe(J)}function de(J){return Yu.isTouch?E()!==J.type.indexOf("touch")>=0:!1}function pe(){ve();var J=y.props,se=J.popperOptions,oe=J.placement,ue=J.offset,ee=J.getReferenceClientRect,Se=J.moveTransition,Pe=R()?XF(S).arrow:null,st=ee?{getBoundingClientRect:ee,contextElement:ee.contextElement||C()}:t,Ue={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(qe){var wi=qe.state;if(R()){var li=N(),an=li.box;["placement","reference-hidden","escaped"].forEach(function(Go){Go==="placement"?an.setAttribute("data-placement",wi.placement):wi.attributes.popper["data-popper-"+Go]?an.setAttribute("data-"+Go,""):an.removeAttribute("data-"+Go)}),wi.attributes.popper={}}}},dt=[{name:"offset",options:{offset:ue}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Se}},Ue];R()&&Pe&&dt.push({name:"arrow",options:{element:Pe,padding:3}}),dt.push.apply(dt,se?.modifiers||[]),y.popperInstance=oQe(st,S,Object.assign({},se,{placement:oe,onFirstUpdate:p,modifiers:dt}))}function ve(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function Me(){var J=y.props.appendTo,se,oe=C();y.props.interactive&&J===Xhe||J==="parent"?se=oe.parentNode:se=Jhe(J,[oe]),se.contains(S)||se.appendChild(S),y.state.isMounted=!0,pe()}function Ee(){return ZE(S.querySelectorAll("[data-tippy-root]"))}function Be(J){y.clearDelayTimeouts(),J&&k("onTrigger",[y,J]),B();var se=A(!0),oe=P(),ue=oe[0],ee=oe[1];Yu.isTouch&&ue==="hold"&&ee&&(se=ee),se?r=setTimeout(function(){y.show()},se):y.show()}function fe(J){if(y.clearDelayTimeouts(),k("onUntrigger",[y,J]),!y.state.isVisible){G();return}if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(J.type)>=0&&s)){var se=A(!1);se?n=setTimeout(function(){y.state.isVisible&&y.hide()},se):a=requestAnimationFrame(function(){y.hide()})}}function Te(){y.state.isEnabled=!0}function ce(){y.hide(),y.state.isEnabled=!1}function be(){clearTimeout(r),clearTimeout(n),cancelAnimationFrame(a)}function we(J){if(!y.state.isDestroyed){k("onBeforeUpdate",[y,J]),Q();var se=y.props,oe=U6(t,Object.assign({},se,y6(J),{ignoreAttributes:!0}));y.props=oe,Z(),se.interactiveDebounce!==oe.interactiveDebounce&&(L(),h=I6(te,oe.interactiveDebounce)),se.triggerTarget&&!oe.triggerTarget?Mg(se.triggerTarget).forEach(function(ue){ue.removeAttribute("aria-expanded")}):oe.triggerTarget&&t.removeAttribute("aria-expanded"),x(),O(),U&&U(se,oe),y.popperInstance&&(pe(),Ee().forEach(function(ue){requestAnimationFrame(ue._tippy.popperInstance.forceUpdate)})),k("onAfterUpdate",[y,J])}}function Ae(J){y.setProps({content:J})}function ye(){var J=y.state.isVisible,se=y.state.isDestroyed,oe=!y.state.isEnabled,ue=Yu.isTouch&&!y.props.touch,ee=lO(y.props.duration,0,Yl.duration);if(!(J||se||oe||ue)&&!C().hasAttribute("disabled")&&(k("onShow",[y],!1),y.props.onShow(y)!==!1)){if(y.state.isVisible=!0,R()&&(S.style.visibility="visible"),O(),B(),y.state.isMounted||(S.style.transition="none"),R()){var Se=N(),Pe=Se.box,st=Se.content;uO([Pe,st],0)}p=function(){var dt;if(!(!y.state.isVisible||u)){if(u=!0,S.offsetHeight,S.style.transition=y.props.moveTransition,R()&&y.props.animation){var bi=N(),qe=bi.box,wi=bi.content;uO([qe,wi],ee),b6([qe,wi],"visible")}F(),x(),v6(dO,y),(dt=y.popperInstance)==null||dt.forceUpdate(),k("onMount",[y]),y.props.animation&&R()&&Y(ee,function(){y.state.isShown=!0,k("onShown",[y])})}},Me()}}function Ne(){var J=!y.state.isVisible,se=y.state.isDestroyed,oe=!y.state.isEnabled,ue=lO(y.props.duration,1,Yl.duration);if(!(J||se||oe)&&(k("onHide",[y],!1),y.props.onHide(y)!==!1)){if(y.state.isVisible=!1,y.state.isShown=!1,u=!1,s=!1,R()&&(S.style.visibility="hidden"),L(),G(),O(!0),R()){var ee=N(),Se=ee.box,Pe=ee.content;y.props.animation&&(uO([Se,Pe],ue),b6([Se,Pe],"hidden"))}F(),x(),y.props.animation?R()&&j(ue,y.unmount):y.unmount()}}function he(J){M().addEventListener("mousemove",h),v6(oD,h),h(J)}function De(){y.state.isVisible&&y.hide(),y.state.isMounted&&(ve(),Ee().forEach(function(J){J._tippy.unmount()}),S.parentNode&&S.parentNode.removeChild(S),dO=dO.filter(function(J){return J!==y}),y.state.isMounted=!1,k("onHidden",[y]))}function Le(){y.state.isDestroyed||(y.clearDelayTimeouts(),y.unmount(),Q(),delete t._tippy,y.state.isDestroyed=!0,k("onDestroy",[y]))}}function FT(t,e){e===void 0&&(e={});var i=Yl.plugins.concat(e.plugins||[]);wQe();var r=Object.assign({},e,{plugins:i}),n=gQe(t),a=n.reduce(function(s,o){var l=o&&NQe(o,r);return l&&s.push(l),s},[]);return KA(t)?a[0]:a}FT.defaultProps=Yl;FT.setDefaultProps=EQe;FT.currentInput=Yu;Object.assign({},$he,{effect:function(e){var i=e.state,r={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,r.popper),i.styles=r,i.elements.arrow&&Object.assign(i.elements.arrow.style,r.arrow)}});FT.setDefaultProps({render:eme});function P6(t){const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===Hh?e.style.marginLeft="1em":e.style.marginRight="1em",t.intent&&e.classList.add(t.intent),t.toolTip?.content&&FT(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=Xo),e}const AQe=({target:t})=>(e=[])=>{t.style.backgroundColor=e?.length?"var(--chc-active-bg)":Sx;const i=(r,n,a)=>{const s=t.getElementsByClassName(`options_${r}`)[0];s&&(s.style.display=e?.length?n:a)};i(wx,HT,Xo),i(Gp,Xo,HT),i(Hi,Xo,HT),i(Hh,Xo,HT)};function kQe(t){const{table:e,targetClassName:i,items:r=[],onSelection:n}=t,a=!!t.target,s=t.target||i&&document.getElementsByClassName(i)?.[0];if(!s)return{};let o=0,l=0;const u={},c={};let d;if(a){pp(s);const I=OQe();Object.assign(u,I.elements),s.appendChild(I.anchor)}const p=Object.assign({},...[wx,Gp,Hi,Hh,Hz].map(I=>{const v=s.getElementsByClassName(`options_${I}`)?.[0];return pp(v),{[I]:v}}).filter(Boolean)),f=AQe({target:s}),h=(I,v)=>{Zu(v.onClick)&&(I.stopPropagation(),!v.disabled&&v.onClick(I,e),v.stateChange&&f())},m={onClick:()=>{},location:Hh};for(const I of r){const v={...m};Ux(I)&&Object.assign(v,I);const w=p[v.location];if(!w){console.log(v.location,p);continue}if(v.location===wx&&(o+=1),v.location===Hz){if(Zu(v.headerClick)){const y=s.getElementsByClassName("panelHeader")[0];y&&(y.onclick=v.headerClick)}l+=1}if(!v.hide&&(v.input||v.placeholder||v.search)){const y=document.createElement("p");y.style.marginRight="1em",y.className=`control ${v.search?"has-icons-left has-icons-right":""}`;const b=document.createElement("input");if(v.focus&&(d=b),b.className="input font-medium",b.setAttribute("type","text"),b.setAttribute("autocomplete","cc-number"),b.setAttribute("placeholder",I.placeholder||Sx),v.id&&(c[v.id]=b),v.id&&b.setAttribute("id",v.id),v.onKeyDown&&b.addEventListener("keydown",S=>v.onKeyDown(S,v)),v.onChange&&b.addEventListener("change",S=>v.onChange(S,v)),v.onKeyUp&&b.addEventListener("keyup",S=>{v.clearSearch&&S.key==="Escape"&&(S.stopPropagation(),b.value="",v.clearSearch()),v.onKeyUp(S,v)}),v.class&&b.classList.add(v.class),v.visible===!1&&(y.style.display=Xo),v.value&&(b.value=v.value),y.appendChild(b),v.search){const S=document.createElement("span");if(S.className="icon is-small is-left font-medium",S.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',y.appendChild(S),Zu(v.clearSearch)){const U=document.createElement("span");U.className="icon is-small is-right font-medium",U.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',U.onclick=T=>{T.stopPropagation(),b.value="",v.clearSearch()},y.appendChild(U)}}if(I.validator){const S=document.createElement("p");S.className="help font-medium",y.appendChild(S),b.addEventListener("input",U=>iJe(I,U,b,S,I.validator))}v.id&&(u[v.id]=y,y.id=v.id),w?.appendChild(y);continue}if(!v.hide&&v.text){const y=document.createElement("div");y.className="font-medium",v.id&&(u[v.id]=y,y.id=v.id),y.innerHTML=v.text,y.onclick=b=>h(b,v),w?.appendChild(y);continue}if(!(!v.id&&(!v?.label||v.hide))){if(v.options){const y=Ih({target:w,button:v,stateChange:f});v.visible===!1&&(y.style.display=Xo),v.id&&(u[v.id]=y)}else if(Ux(v.selection)){const{selection:{options:y,actions:b},actionPlacement:S,threshold:U=8,...T}=v;if(y?.length<U){y.length&&(S===Wz?y.unshift({divider:!0}):y.push({divider:!0})),b.forEach(E=>{const{label:R,...C}=E,M={...C,label:`<p style="font-weight: bold">${R}</p>`};S===Wz?y.unshift(M):y.push(M)});const D={...T,options:y},P=Ih({target:w,button:D,stateChange:f});D.visible===!1&&(P.style.display=Xo),D.id&&(u[v.id]=P)}else{const D=P6(v);D.onclick=P=>{P.stopPropagation()},v.id&&(u[v.id]=D),w?.appendChild(D)}}else{const y=P6(v);y.onclick=b=>h(b,v),v.id&&(u[v.id]=y),w?.appendChild(y)}(!v?.label||v.hide)&&(u[v.id].style.display=Xo)}}const g=s.getElementsByClassName("panelHeader")[0];return g&&(g.style.display=l?Sx:Xo),e?.on("rowSelectionChanged",(I,v)=>{Zu(n)&&n(v),o&&f(v)}),f(),d&&setTimeout(()=>d.focus(),200),{elements:u,inputs:c}}function OQe(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=Xo,t.appendChild(e);const i=document.createElement("div");i.className=DAe,i.style.flexWrap="wrap-reverse;";const r={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};r.optionsOverlay.className="options_overlay",r.optionsCenter.className="options_center",r.optionsRight.className="options_right",r.optionsLeft.className="options_left";for(const n of Object.values(r))i.appendChild(n);return t.appendChild(i),{elements:r,anchor:t,header:e}}function xQe(t){const e=p1e(t),i=[{onKeyDown:n=>n.keyCode===8&&n.target.value.length===1&&e(""),onChange:n=>e(n.target.value),onKeyUp:n=>e(n.target.value),clearSearch:()=>e(""),placeholder:"Search tournaments",location:Gp,search:!0}],r=document.getElementById(_6);kQe({target:r,items:i})}function FQe(t){const e=document.createElement("span"),i=document.createElement("table"),r=t.getValue();i.style.width="400px";const n="4em",a=document.createElement("tr"),s=r.tournamentImageURL||r.onlineResources?.find(({name:u,resourceType:c})=>u==="tournamentImage"&&c==="URL")?.identifier,o=s?`<img src='${s}' style='width: ${n}' alt=''>`:"",l=`<td style='min-width: ${n}'>${o}</td><td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${r.tournamentName}</strong></div><div style='margin-left: 1em'>${r.startDate} / ${r.endDate}</div></td>`;return a.innerHTML=l,i.appendChild(a),e.appendChild(i),e}const Jo={};function LQe(){return[{formatter:FQe,cellClick:(e,i)=>{const r=i.getRow().getData().tournamentId;if(r){const n=`/${aR}/${r}`;Jo.router.navigate(n)}},field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3}]}function _Qe({providerAbbr:t}){const e=o=>console.log("Network error",{error:o});let i;const r=({providerAbbr:o})=>{setTimeout(()=>{const u=c=>c?.data?.calendar&&i.replaceData(c.data.calendar);Mx({providerAbbr:o}).then(u,e)},1e3)},n=LQe(),a=o=>{aU({anchorId:vO});const l=document.getElementById(vO);i=new Lv(l,{height:window.innerHeight*.9,placeholder:"No tournaments",index:"tournament.tournamentId",headerVisible:!1,layout:"fitColumns",reactiveData:!0,data:o,columns:n}),i.on("tableBuilt",()=>{xQe(i)})},s=o=>{o.tournaments.sort((l,u)=>new Date(u.tournament.startDate).getTime()-new Date(l.tournament.startDate).getTime()),a(o.tournaments)};if(t){const o=l=>{l?.data?.calendar&&s(l.data.calendar)};Mx({providerAbbr:t}).then(o,e)}return{table:i,replaceTableData:r}}function Wg(t){return`tournament_${t.toLowerCase()}`}function iW(t){return`tab_tournament_${t.toLowerCase()}`}function $Qe({startDate:t,endDate:e}){const i=new Date(t),r=new Date(e),n=["January","February","March","April","May","June","July","August","September","October","November","December"],a=i.getDate()===r.getDate(),s=i.getFullYear()===r.getFullYear(),o=s&&i.getMonth()===r.getMonth(),l=u=>[u.getFullYear(),u.getMonth()+1,u.getDate()].join("/");return a&&s&&o?`${n[i.getMonth()]} ${i.getDate()}, ${i.getFullYear()}`:s&&o?`${n[i.getMonth()]} ${i.getDate()}-${r.getDate()}, ${i.getFullYear()}`:s?`${n[i.getMonth()]} ${i.getDate()} - ${n[r.getMonth()]} ${r.getDate()}, ${i.getFullYear()}`:`${l(i)} - ${l(r)}`}async function BQe(t,e){const i=document.getElementById(Rme);pp(i);const r=t?.data?.tournamentInfo??{},n=r.publishState?.language;n&&!Kge()&&Fn.changeLanguage(n),Jo.participantsPublishConfig=r.publishState?.participants;const a=r.onlineResources?.find(f=>f.name==="tournamentImage"),s=document.getElementById($6);if(a?.identifier?s.innerHTML=`<img src="${a.identifier}" alt="${r.name}" style="max-height: 20em" />`:pp(s),r.tournamentName){const f=document.getElementById(L6),h=`<h1>${r.tournamentName}</h1>`,m=`<h2>${$Qe(r)}</h2>`;f.innerHTML=`${h}${m}`}const o=document.getElementById(Wg("Info")),l=!!r.notes;l?(o.innerHTML=r.notes,lD("Info")):(pp(o),uD("Info"));const u=!!r.eventInfo?.length;if(u){const f=r.tournamentId,h=document.getElementById(Wg("Events"));pp(h);const m=document.createElement("div"),g=document.createElement("div");g.id="flightDisplay";const I=e?.eventId,v=I?Math.max(r.eventInfo.findIndex(T=>T.eventId===I),0):0,w=r.eventInfo.map(({eventId:T,eventName:D},P)=>({onClick:()=>{sh({tournamentId:f,eventId:T}),o6({tournamentId:f,eventId:T,header:m,flightDisplay:g,displayFormat:"roundsColumns"})},isActive:P===v,label:D,close:!0})),y={label:r.eventInfo[v].eventName,options:w,id:"eventButton",modifyLabel:!0,selection:!0,location:Gp},S=Ih({button:y,stateChange:()=>{document.getElementById("structureButton")?.remove(),document.getElementById("flightButton")?.remove()}}),U=r.eventInfo[v].eventId;m.className="block",m.appendChild(S),h.appendChild(m),h.appendChild(g),o6({tournamentId:f,eventId:U,header:m,flightDisplay:g,displayFormat:"roundsColumns",drawId:e?.drawId,structureId:e?.structureId}),lD("Events")}else uD("Events");const c=!!r.publishState?.orderOfPlay?.published;if(c){const f=document.getElementById(Wg("Schedule")),h=document.createElement("div");h.style.width="100%",h.className="block",h.id="scheduleHeader",f.appendChild(h);const m=document.createElement("div");m.id="tournamentSchedule",f.appendChild(m),lD("Schedule")}else uD("Schedule");const d=!!r.publishState?.participants?.published;if(d){const f=document.getElementById(Wg("Players"));pp(f);const h=document.createElement("div");h.style.width="100%",h.className="block",f.appendChild(h);const m=document.createElement("div");m.id="playersTable",f.appendChild(m),lD("Players")}else uD("Players");let p;e?.tab==="Players"&&d?p="Players":e?.tab==="Schedule"&&c?p="Schedule":e?.tab==="Events"&&u||e?.eventId&&u?p="Events":l?p="Info":u&&(p="Events"),p&&Ime(p)}var JF="http://www.w3.org/1999/xhtml";const E6={svg:"http://www.w3.org/2000/svg",xhtml:JF,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function tme(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),E6.hasOwnProperty(e)?{space:E6[e],local:t}:t}function VQe(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===JF&&e.documentElement.namespaceURI===JF?e.createElement(t):e.createElementNS(i,t)}}function jQe(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function rW(t){var e=tme(t);return(e.local?jQe:VQe)(e)}function GQe(){}function ime(t){return t==null?GQe:function(){return this.querySelector(t)}}function HQe(t){typeof t!="function"&&(t=ime(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=new Array(s),l,u,c=0;c<s;++c)(l=a[c])&&(u=t.call(l,l.__data__,c,a))&&("__data__"in l&&(u.__data__=l.__data__),o[c]=u);return new Ml(r,this._parents)}function WQe(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function zQe(){return[]}function qQe(t){return t==null?zQe:function(){return this.querySelectorAll(t)}}function YQe(t){return function(){return WQe(t.apply(this,arguments))}}function KQe(t){typeof t=="function"?t=YQe(t):t=qQe(t);for(var e=this._groups,i=e.length,r=[],n=[],a=0;a<i;++a)for(var s=e[a],o=s.length,l,u=0;u<o;++u)(l=s[u])&&(r.push(t.call(l,l.__data__,u,s)),n.push(l));return new Ml(r,n)}function XQe(t){return function(){return this.matches(t)}}function rme(t){return function(e){return e.matches(t)}}var JQe=Array.prototype.find;function QQe(t){return function(){return JQe.call(this.children,t)}}function ZQe(){return this.firstElementChild}function eZe(t){return this.select(t==null?ZQe:QQe(typeof t=="function"?t:rme(t)))}var tZe=Array.prototype.filter;function iZe(){return Array.from(this.children)}function rZe(t){return function(){return tZe.call(this.children,t)}}function nZe(t){return this.selectAll(t==null?iZe:rZe(typeof t=="function"?t:rme(t)))}function aZe(t){typeof t!="function"&&(t=XQe(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=[],l,u=0;u<s;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&o.push(l);return new Ml(r,this._parents)}function nme(t){return new Array(t.length)}function sZe(){return new Ml(this._enter||this._groups.map(nme),this._parents)}function eR(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}eR.prototype={constructor:eR,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function oZe(t){return function(){return t}}function lZe(t,e,i,r,n,a){for(var s=0,o,l=e.length,u=a.length;s<u;++s)(o=e[s])?(o.__data__=a[s],r[s]=o):i[s]=new eR(t,a[s]);for(;s<l;++s)(o=e[s])&&(n[s]=o)}function uZe(t,e,i,r,n,a,s){var o,l,u=new Map,c=e.length,d=a.length,p=new Array(c),f;for(o=0;o<c;++o)(l=e[o])&&(p[o]=f=s.call(l,l.__data__,o,e)+"",u.has(f)?n[o]=l:u.set(f,l));for(o=0;o<d;++o)f=s.call(t,a[o],o,a)+"",(l=u.get(f))?(r[o]=l,l.__data__=a[o],u.delete(f)):i[o]=new eR(t,a[o]);for(o=0;o<c;++o)(l=e[o])&&u.get(p[o])===l&&(n[o]=l)}function cZe(t){return t.__data__}function dZe(t,e){if(!arguments.length)return Array.from(this,cZe);var i=e?uZe:lZe,r=this._parents,n=this._groups;typeof t!="function"&&(t=oZe(t));for(var a=n.length,s=new Array(a),o=new Array(a),l=new Array(a),u=0;u<a;++u){var c=r[u],d=n[u],p=d.length,f=pZe(t.call(c,c&&c.__data__,u,r)),h=f.length,m=o[u]=new Array(h),g=s[u]=new Array(h),I=l[u]=new Array(p);i(c,d,m,g,I,f,e);for(var v=0,w=0,y,b;v<h;++v)if(y=m[v]){for(v>=w&&(w=v+1);!(b=g[w])&&++w<h;);y._next=b||null}}return s=new Ml(s,r),s._enter=o,s._exit=l,s}function pZe(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function fZe(){return new Ml(this._exit||this._groups.map(nme),this._parents)}function hZe(t,e,i){var r=this.enter(),n=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(n=e(n),n&&(n=n.selection())),i==null?a.remove():i(a),r&&n?r.merge(n).order():n}function mZe(t){for(var e=t.selection?t.selection():t,i=this._groups,r=e._groups,n=i.length,a=r.length,s=Math.min(n,a),o=new Array(n),l=0;l<s;++l)for(var u=i[l],c=r[l],d=u.length,p=o[l]=new Array(d),f,h=0;h<d;++h)(f=u[h]||c[h])&&(p[h]=f);for(;l<n;++l)o[l]=i[l];return new Ml(o,this._parents)}function gZe(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var r=t[e],n=r.length-1,a=r[n],s;--n>=0;)(s=r[n])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function IZe(t){t||(t=vZe);function e(d,p){return d&&p?t(d.__data__,p.__data__):!d-!p}for(var i=this._groups,r=i.length,n=new Array(r),a=0;a<r;++a){for(var s=i[a],o=s.length,l=n[a]=new Array(o),u,c=0;c<o;++c)(u=s[c])&&(l[c]=u);l.sort(e)}return new Ml(n,this._parents).order()}function vZe(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function yZe(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function bZe(){return Array.from(this)}function wZe(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],n=0,a=r.length;n<a;++n){var s=r[n];if(s)return s}return null}function SZe(){let t=0;for(const e of this)++t;return t}function UZe(){return!this.node()}function TZe(t){for(var e=this._groups,i=0,r=e.length;i<r;++i)for(var n=e[i],a=0,s=n.length,o;a<s;++a)(o=n[a])&&t.call(o,o.__data__,a,n);return this}function DZe(t){return function(){this.removeAttribute(t)}}function PZe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function EZe(t,e){return function(){this.setAttribute(t,e)}}function RZe(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function CZe(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function MZe(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function NZe(t,e){var i=tme(t);if(arguments.length<2){var r=this.node();return i.local?r.getAttributeNS(i.space,i.local):r.getAttribute(i)}return this.each((e==null?i.local?PZe:DZe:typeof e=="function"?i.local?MZe:CZe:i.local?RZe:EZe)(i,e))}function ame(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function AZe(t){return function(){this.style.removeProperty(t)}}function kZe(t,e,i){return function(){this.style.setProperty(t,e,i)}}function OZe(t,e,i){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,i)}}function xZe(t,e,i){return arguments.length>1?this.each((e==null?AZe:typeof e=="function"?OZe:kZe)(t,e,i??"")):FZe(this.node(),t)}function FZe(t,e){return t.style.getPropertyValue(e)||ame(t).getComputedStyle(t,null).getPropertyValue(e)}function LZe(t){return function(){delete this[t]}}function _Ze(t,e){return function(){this[t]=e}}function $Ze(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function BZe(t,e){return arguments.length>1?this.each((e==null?LZe:typeof e=="function"?$Ze:_Ze)(t,e)):this.node()[t]}function sme(t){return t.trim().split(/^|\s+/)}function nW(t){return t.classList||new ome(t)}function ome(t){this._node=t,this._names=sme(t.getAttribute("class")||"")}ome.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function lme(t,e){for(var i=nW(t),r=-1,n=e.length;++r<n;)i.add(e[r])}function ume(t,e){for(var i=nW(t),r=-1,n=e.length;++r<n;)i.remove(e[r])}function VZe(t){return function(){lme(this,t)}}function jZe(t){return function(){ume(this,t)}}function GZe(t,e){return function(){(e.apply(this,arguments)?lme:ume)(this,t)}}function HZe(t,e){var i=sme(t+"");if(arguments.length<2){for(var r=nW(this.node()),n=-1,a=i.length;++n<a;)if(!r.contains(i[n]))return!1;return!0}return this.each((typeof e=="function"?GZe:e?VZe:jZe)(i,e))}function WZe(){this.textContent=""}function zZe(t){return function(){this.textContent=t}}function qZe(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function YZe(t){return arguments.length?this.each(t==null?WZe:(typeof t=="function"?qZe:zZe)(t)):this.node().textContent}function KZe(){this.innerHTML=""}function XZe(t){return function(){this.innerHTML=t}}function JZe(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function QZe(t){return arguments.length?this.each(t==null?KZe:(typeof t=="function"?JZe:XZe)(t)):this.node().innerHTML}function ZZe(){this.nextSibling&&this.parentNode.appendChild(this)}function eet(){return this.each(ZZe)}function tet(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function iet(){return this.each(tet)}function ret(t){var e=typeof t=="function"?t:rW(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function net(){return null}function aet(t,e){var i=typeof t=="function"?t:rW(t),r=e==null?net:typeof e=="function"?e:ime(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),r.apply(this,arguments)||null)})}function set(){var t=this.parentNode;t&&t.removeChild(this)}function oet(){return this.each(set)}function uet(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function cet(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function det(t){return this.select(t?cet:uet)}function pet(t){return arguments.length?this.property("__data__",t):this.node().__data__}function fet(t){return function(e){t.call(this,e,this.__data__)}}function het(t){return t.trim().split(/^|\s+/).map(function(e){var i="",r=e.indexOf(".");return r>=0&&(i=e.slice(r+1),e=e.slice(0,r)),{type:e,name:i}})}function met(t){return function(){var e=this.__on;if(e){for(var i=0,r=-1,n=e.length,a;i<n;++i)a=e[i],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function get(t,e,i){return function(){var r=this.__on,n,a=fet(e);if(r){for(var s=0,o=r.length;s<o;++s)if((n=r[s]).type===t.type&&n.name===t.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=a,n.options=i),n.value=e;return}}this.addEventListener(t.type,a,i),n={type:t.type,name:t.name,value:e,listener:a,options:i},r?r.push(n):this.__on=[n]}}function Iet(t,e,i){var r=het(t+""),n,a=r.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,u=o.length,c;l<u;++l)for(n=0,c=o[l];n<a;++n)if((s=r[n]).type===c.type&&s.name===c.name)return c.value}return}for(o=e?get:met,n=0;n<a;++n)this.each(o(r[n],e,i));return this}function cme(t,e,i){var r=ame(t),n=r.CustomEvent;typeof n=="function"?n=new n(e,i):(n=r.document.createEvent("Event"),i?(n.initEvent(e,i.bubbles,i.cancelable),n.detail=i.detail):n.initEvent(e,!1,!1)),t.dispatchEvent(n)}function vet(t,e){return function(){return cme(this,t,e)}}function yet(t,e){return function(){return cme(this,t,e.apply(this,arguments))}}function bet(t,e){return this.each((typeof e=="function"?yet:vet)(t,e))}function*wet(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],n=0,a=r.length,s;n<a;++n)(s=r[n])&&(yield s)}var Uet=[null];function Ml(t,e){this._groups=t,this._parents=e}function Tet(){return this}Ml.prototype={constructor:Ml,select:HQe,selectAll:KQe,selectChild:eZe,selectChildren:nZe,filter:aZe,data:dZe,enter:sZe,exit:fZe,join:hZe,merge:mZe,selection:Tet,order:gZe,sort:IZe,call:yZe,nodes:bZe,node:wZe,size:SZe,empty:UZe,each:TZe,attr:NZe,style:xZe,property:BZe,classed:HZe,text:YZe,html:QZe,raise:eet,lower:iet,append:ret,insert:aet,remove:oet,clone:det,datum:pet,on:Iet,dispatch:bet,[Symbol.iterator]:wet};function Det(t){return typeof t=="string"?new Ml([[document.querySelector(t)]],[document.documentElement]):new Ml([[t]],Uet)}function Pet(t){return Det(rW(t).call(document.documentElement))}function Eet(t={}){const{maxWidth:e="450px",color:i="#000000",strokeWidth:r=5,lineWidth:n=5,fill:a="none",className:s="courthive-logo",serviceLinePosition:o=.3,centerMarkLength:l=12}=t,u=n??r,c=100,d=Math.sqrt(3),p=c*d/2,f=c*d,h=c/2,m=r,g=`M 0,${-h} L ${-p},${-c} L ${-f},${-h} L ${-f},${h} L ${-p},${c} L 0,${h}`,I=`M 0,${-h} L ${p},${-c} L ${f},${-h} L ${f},${h} L ${p},${c} L 0,${h}`,v=o*p,w=-p-v,y=p+v,b=-c+v/d,S=c-v/d,U=Pet("svg").attr("viewBox",`${-f-m} ${-c-m} ${2*f+2*m} ${2*c+2*m}`).attr("xmlns","http://www.w3.org/2000/svg").attr("class",s).style("width","100%").style("max-width",e),T=U.append("g").attr("class","logo-group"),D="stroke-width",P="court-marking";return T.append("path").attr("d",g).attr("fill",a).attr("stroke",i).attr(D,r).attr("stroke-linejoin","miter").attr("stroke-linecap","round"),T.append("path").attr("d",I).attr("fill",a).attr("stroke",i).attr(D,r).attr("stroke-linejoin","miter").attr("stroke-linecap","round"),T.append("line").attr("class",P).attr("x1",0).attr("y1",-h).attr("x2",0).attr("y2",h).attr("stroke",i).attr(D,r),T.append("line").attr("class",P).attr("x1",w).attr("y1",b).attr("x2",w).attr("y2",S).attr("stroke",i).attr(D,u),T.append("line").attr("class",P).attr("x1",y).attr("y1",b).attr("x2",y).attr("y2",S).attr("stroke",i).attr(D,u),T.append("line").attr("class",P).attr("x1",w).attr("y1",0).attr("x2",y).attr("y2",0).attr("stroke",i).attr(D,u),T.append("line").attr("class",P).attr("x1",-f).attr("y1",0).attr("x2",-f+l).attr("y2",0).attr("stroke",i).attr(D,u),T.append("line").attr("class",P).attr("x1",f-l).attr("y1",0).attr("x2",f).attr("y2",0).attr("stroke",i).attr(D,u),U.node()}function Ret(){const t=document.querySelector(`#${Vw}`);t.innerHTML="";const e=document.createElement("div"),i=document.createElement("a");i.href="https://courthive.com",i.target="_blank";const r=Eet({color:"#000000",maxWidth:"300px"});i.appendChild(r),e.appendChild(i);const n=document.createElement("h1");n.className="name",n.textContent="CourtHive",e.appendChild(n),t.appendChild(e)}function tR(t){Cme.forEach(e=>{const i=document.querySelector(`#${e}`);i&&(i.style.display=e===t?"block":"none")})}var Cet=/([:*])(\w+)/g,Met="([^/]+)",Net=/\*/g,Aet="?(?:.*)",ket=/\/\?/g,Oet="/?([^/]+|)",xet="(?:/^|^)",Fet="";function dme(t){return t===void 0&&(t="/"),sW()?location.pathname+location.search+location.hash:t}function Hr(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function iR(t){return typeof t=="string"}function Let(t){return typeof t=="function"}function rR(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function _et(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,r,n){return i===null&&(i={}),i[e[n]]=decodeURIComponent(r),i},null)}function nR(t){var e=Hr(t).split(/\?(.*)?$/);return[Hr(e[0]),e.slice(1).join("")]}function aW(t){for(var e={},i=t.split("&"),r=0;r<i.length;r++){var n=i[r].split("=");if(n[0]!==""){var a=decodeURIComponent(n[0]);e[a]?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(decodeURIComponent(n[1]||""))):e[a]=decodeURIComponent(n[1]||"")}}return e}function pme(t,e){var i=nR(Hr(t.currentLocationPath)),r=i[0],n=i[1],a=n===""?null:aW(n),s=[],o;if(iR(e.path)){if(o=xet+Hr(e.path).replace(Cet,function(d,p,f){return s.push(f),Met}).replace(Net,Aet).replace(ket,Oet)+"$",Hr(e.path)===""&&Hr(r)==="")return{url:r,queryString:n,hashString:rR(t.to),route:e,data:null,params:a}}else o=e.path;var l=new RegExp(o,Fet),u=r.match(l);if(u){var c=iR(e.path)?_et(u,s):u.groups?u.groups:u.slice(1);return{url:Hr(r.replace(new RegExp("^"+t.instance.root),"")),queryString:n,hashString:rR(t.to),route:e,data:c,params:a}}return!1}function fme(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function pg(t,e){return typeof t[e]>"u"||t[e]===!0}function $et(t){if(!t)return{};var e=t.split(","),i={},r;return e.forEach(function(n){var a=n.split(":").map(function(s){return s.replace(/(^ +| +$)/g,"")});switch(a[0]){case"historyAPIMethod":i.historyAPIMethod=a[1];break;case"resolveOptionsStrategy":r||(r={}),r.strategy=a[1];break;case"resolveOptionsHash":r||(r={}),r.hash=a[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[a[0]]=a[1]==="true";break}}),r&&(i.resolveOptions=r),i}function sW(){return typeof window<"u"}function Bet(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(r){i[r]&&(e[r]||(e[r]=[]),e[r].push(i[r]))})}),e}function nc(t,e,i){var r=e||{},n=0;(function a(){if(!t[n]){i&&i(r);return}Array.isArray(t[n])?(t.splice.apply(t,[n,1].concat(t[n][0](r)?t[n][1]:t[n][2])),a()):t[n](r,function(s){typeof s>"u"||s===!0?(n+=1,a()):i&&i(r)})})()}nc.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function R6(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=dme(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function pO(t,e){for(var i=0;i<t.instance.routes.length;i++){var r=t.instance.routes[i],n=pme(t,r);if(n&&(t.matches||(t.matches=[]),t.matches.push(n),t.resolveOptions.strategy==="ONE")){e();return}}e()}function Vet(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function jet(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var C6=sW(),Get=fme();function Het(t,e){if(pg(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),r=C6&&t.resolveOptions&&t.resolveOptions.hash===!0;Get?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",r?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!r){var n=location.hash;location.hash="",location.hash=n}t.instance.__freezeListening=!1},1))):C6&&(window.location.href=t.to)}e()}function hme(t,e){var i=t.instance;if(!i.lastResolved()){e();return}nc(i.lastResolved().map(function(r){return function(n,a){if(!r.route.hooks||!r.route.hooks.leave){a();return}var s=!1,o=t.instance.matchLocation(r.route.path,t.currentLocationPath,!1);if(r.route.path!=="*")s=!o;else{var l=t.matches?t.matches.find(function(u){return r.route.path===u.route.path}):!1;s=!l}if(pg(t.navigateOptions,"callHooks")&&s){nc(r.route.hooks.leave.map(function(u){return function(c,d){return u(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return a()}]));return}else a()}}),{},function(){return e()})}function Wet(t,e){t.match.route.hooks&&t.match.route.hooks.before&&pg(t.navigateOptions,"callHooks")?nc(t.match.route.hooks.before.map(function(i){return function(n,a){return i(function(s){s===!1?t.instance.__markAsClean(t):a()},t.match)}}).concat([function(){return e()}])):e()}function zet(t,e){pg(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function qet(t,e){t.match.route.hooks&&t.match.route.hooks.after&&pg(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function Yet(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(r){r.route.hooks&&r.route.hooks.already&&pg(t.navigateOptions,"callHooks")&&r.route.hooks.already.forEach(function(n){return n(t.match)})}),e(!1);return}e()}function Ket(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var r=nR(t.currentLocationPath),n=r[0],a=r[1],s=rR(t.to);i.path=Hr(n);var o={url:i.path,queryString:a,hashString:s,data:null,route:i,params:a!==""?aW(a):null};t.matches=[o],t.match=o}e()}function Xet(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function Jet(t,e){t.instance._setCurrent(null),e()}function mme(t,e){pg(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var gme=[Yet,Wet,zet,qet],M6=[hme,Ket,nc.if(function(t){var e=t.notFoundHandled;return e},gme.concat([mme]),[Xet,Jet])];function QF(){return QF=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},QF.apply(this,arguments)}function N6(t,e){var i=0;function r(){if(i===t.matches.length){mme(t,e);return}nc(gme,QF({},t,{match:t.matches[i]}),function(){i+=1,r()})}hme(t,r)}function fO(t){t.instance.__markAsClean(t)}function ZF(){return ZF=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},ZF.apply(this,arguments)}var A6="[data-navigo]";function Qet(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:A6},r=this,n="/",a=null,s=[],o=!1,l,u=fme(),c=sW();t?n=Hr(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d(x){return x.indexOf("#")>=0&&(i.hash===!0?x=x.split("#")[1]||"/":x=x.split("#")[0]),x}function p(x){return Hr(n+"/"+Hr(x))}function f(x,L,$,V){return x=iR(x)?p(x):x,{name:V||Hr(String(x)),path:x,handler:L,hooks:Bet($)}}function h(x,L,$){var V=this;return typeof x=="object"&&!(x instanceof RegExp)?(Object.keys(x).forEach(function(_){if(typeof x[_]=="function")V.on(_,x[_]);else{var B=x[_],G=B.uses,j=B.as,Y=B.hooks;s.push(f(_,G,[l,Y],j))}}),this):(typeof x=="function"&&($=L,L=x,x=n),s.push(f(x,L,[l,$])),this)}function m(x,L){if(r.__dirty){r.__waiting.push(function(){return r.resolve(x,L)});return}else r.__dirty=!0;x=x?Hr(n)+"/"+Hr(x):void 0;var $={instance:r,to:x,currentLocationPath:x,navigateOptions:{},resolveOptions:ZF({},i,L)};return nc([R6,pO,nc.if(function(V){var _=V.matches;return _&&_.length>0},N6,M6)],$,fO),$.matches?$.matches:!1}function g(x,L){if(r.__dirty){r.__waiting.push(function(){return r.navigate(x,L)});return}else r.__dirty=!0;x=Hr(n)+"/"+Hr(x);var $={instance:r,to:x,navigateOptions:L||{},resolveOptions:L&&L.resolveOptions?L.resolveOptions:i,currentLocationPath:d(x)};nc([Vet,jet,pO,nc.if(function(V){var _=V.matches;return _&&_.length>0},N6,M6),Het,fO],$,fO)}function I(x,L,$){var V=E(x,L);return V!==null?(g(V.replace(new RegExp("^/?"+n),""),$),!0):!1}function v(x){return this.routes=s=s.filter(function(L){return iR(x)?Hr(L.path)!==Hr(x):Let(x)?x!==L.handler:String(L.path)!==String(x)}),this}function w(){u&&(this.__popstateListener=function(){r.__freezeListening||m()},window.addEventListener("popstate",this.__popstateListener))}function y(){this.routes=s=[],u&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=o=!0}function b(x,L){return r._notFoundRoute=f("*",x,[l,L],"__NOT_FOUND__"),this}function S(){if(c)return U().forEach(function(x){if(x.getAttribute("data-navigo")==="false"||x.getAttribute("target")==="_blank"){x.hasListenerAttached&&x.removeEventListener("click",x.navigoHandler);return}x.hasListenerAttached||(x.hasListenerAttached=!0,x.navigoHandler=function(L){if((L.ctrlKey||L.metaKey)&&L.target.tagName.toLowerCase()==="a")return!1;var $=x.getAttribute("href");if(typeof $>"u"||$===null)return!1;if($.match(/^(http|https)/)&&typeof URL<"u")try{var V=new URL($);$=V.pathname+V.search}catch{}var _=$et(x.getAttribute("data-navigo-options"));o||(L.preventDefault(),L.stopPropagation(),r.navigate(Hr($),_))},x.addEventListener("click",x.navigoHandler))}),r}function U(){return c?[].slice.call(document.querySelectorAll(i.linksSelector||A6)):[]}function T(x){return"/"+n+"/"+Hr(x)}function D(x){return l=x,this}function P(){return a}function E(x,L,$){var V=s.find(function(G){return G.name===x}),_=null;if(V){if(_=V.path,L)for(var B in L)_=_.replace(":"+B,L[B]);_=_.match(/^\//)?_:"/"+_}return _&&$&&!$.includeRoot&&(_=_.replace(new RegExp("^/"+n),"")),_}function R(x){return x.getAttribute("href")}function C(x){var L=nR(Hr(x)),$=L[0],V=L[1],_=V===""?null:aW(V),B=rR(x),G=f($,function(){},[l],$);return{url:$,queryString:V,hashString:B,route:G,data:null,params:_}}function M(){return C(Hr(dme(n)).replace(new RegExp("^"+n),""))}function N(x){var L={instance:r,currentLocationPath:x,to:x,resolveOptions:i};return pO(L,function(){}),L.matches?L.matches:!1}function A(x,L,$){typeof L<"u"&&(typeof $>"u"||$)&&(L=p(L));var V={instance:r,to:L,currentLocationPath:L};R6(V,function(){}),typeof x=="string"&&(x=typeof $>"u"||$?p(x):x);var _=pme(V,{name:String(x),path:x,handler:function(){},hooks:{}});return _||!1}function O(x,L,$){return typeof L=="string"&&(L=k(L)),L?(L.hooks[x]||(L.hooks[x]=[]),L.hooks[x].push($),function(){L.hooks[x]=L.hooks[x].filter(function(V){return V!==$})}):(console.warn("Route doesn't exists: "+L),function(){})}function k(x){return typeof x=="string"?s.find(function(L){return L.name===p(x)}):s.find(function(L){return L.handler===x})}function F(x){x.instance.__dirty=!1,x.instance.__waiting.length>0&&x.instance.__waiting.shift()()}this.root=n,this.routes=s,this.destroyed=o,this.current=a,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=F,this.on=h,this.off=v,this.resolve=m,this.navigate=g,this.navigateByName=I,this.destroy=y,this.notFound=b,this.updatePageLinks=S,this.link=T,this.hooks=D,this.extractGETParameters=function(x){return nR(d(x))},this.lastResolved=P,this.generate=E,this.getLinkPath=R,this.match=N,this.matchLocation=A,this.getCurrentLocation=M,this.addBeforeHook=O.bind(this,"before"),this.addAfterHook=O.bind(this,"after"),this.addAlreadyHook=O.bind(this,"already"),this.addLeaveHook=O.bind(this,"leave"),this.getRoute=k,this._pathToMatchObject=C,this._clean=Hr,this._checkForAHash=d,this._setCurrent=function(x){return a=r.current=x},w.call(this),S.call(this)}function jf({tournamentId:t,eventId:e,drawId:i,structureId:r,tab:n}){const a=document.getElementById("back");a.style.display="block",Jo.tournamentId=t,delete Jo.tab,tR(aR),Wte({tournamentId:t}).then(s=>BQe(s,{eventId:e,drawId:i,structureId:r,tab:n}))}function sh({tournamentId:t,eventId:e,drawId:i,structureId:r,tab:n}){let a=`/tournament/${t}`;n==="Schedule"?a+="/schedule":n==="Events"?a+="/events":n==="Players"?a+="/participants":(e&&(a+=`/event/${e}`),i&&(a+=`/draw/${i}`),r&&(a+=`/structure/${r}`)),history.pushState(null,"",`#${a}`)}function Zet(){const e=new Qet("/",{hash:!0});Jo.router=e;const i=document.getElementById("back");return e.on("/",()=>{console.log("[router] matched: / (splash)"),i.style.display="none",tR(Vw),Ret()}),e.on("/tournaments/:providerAbbr",r=>{console.log("[router] matched: /tournaments/:providerAbbr",r?.data),i.style.display="none";const n=r?.data?.providerAbbr?.toUpperCase();tR(r1),_Qe({providerAbbr:n})}),e.on("/tournament/:tournamentId/event/:eventId/draw/:drawId/structure/:structureId",r=>{console.log("[router] matched: /tournament/.../structure/:structureId",r?.data),jf({tournamentId:r?.data?.tournamentId,eventId:r?.data?.eventId,drawId:r?.data?.drawId,structureId:r?.data?.structureId})}),e.on("/tournament/:tournamentId/event/:eventId/draw/:drawId",r=>{console.log("[router] matched: /tournament/.../draw/:drawId",r?.data),jf({tournamentId:r?.data?.tournamentId,eventId:r?.data?.eventId,drawId:r?.data?.drawId})}),e.on("/tournament/:tournamentId/event/:eventId",r=>{console.log("[router] matched: /tournament/.../event/:eventId",r?.data),jf({tournamentId:r?.data?.tournamentId,eventId:r?.data?.eventId})}),e.on("/tournament/:tournamentId/events",r=>{jf({tournamentId:r?.data?.tournamentId,tab:"Events"})}),e.on("/tournament/:tournamentId/schedule",r=>{jf({tournamentId:r?.data?.tournamentId,tab:"Schedule"})}),e.on("/tournament/:tournamentId/participants",r=>{jf({tournamentId:r?.data?.tournamentId,tab:"Players"})}),e.on("/tournament/:tournamentId",r=>{jf({tournamentId:r?.data?.tournamentId})}),e.notFound(r=>{console.log("[router] notFound â€” url:",r?.url,"hashString:",r?.hashString,"data:",r?.data),e.navigate("/")}),e.resolve(),window.addEventListener("hashchange",()=>e.resolve()),e}const e1=["Info","Events","Schedule","Matches","Players","Stats"];let hO=!1;function Ime(t,e){if(e?.updateUrl){if(hO)return;hO=!0,requestAnimationFrame(()=>{hO=!1})}if(t==="Schedule"?u1e({tournamentId:Jo.tournamentId,hydrateParticipants:!1}).then(r=>{Dxe({data:r?.data})}):t==="Players"&&c1e({tournamentId:Jo.tournamentId}).then(i=>{Pxe({participants:i?.data?.participants||[],columnConfig:Jo.participantsPublishConfig?.columns})}),Jo.tab=t,e1.forEach(i=>{const r=document.getElementById(Wg(i));r.style.display=i===t?"block":"none"}),e?.updateUrl){const i=Jo.tournamentId;sh(t==="Schedule"?{tournamentId:i,tab:"Schedule"}:t==="Events"?{tournamentId:i,tab:"Events"}:t==="Players"?{tournamentId:i,tab:"Players"}:{tournamentId:i})}}function lD(t){const e=document.getElementById(iW(t));e.style.display="block"}function uD(t){const e=document.getElementById(iW(t));e.style.display=Xo}const ett=()=>{const t=document.createElement("div");t.className="container";const e=document.createElement("section");e.className="hero";const i=document.createElement("div");i.className="hero-body",i.id="tournament-hero";const r=document.createElement("div");r.className="columns";const n=document.createElement("div");n.className="column is-one-quarter has-text-centered",n.id=$6,r.appendChild(n);const a=document.createElement("div");a.className="column has-text-centered",a.id=L6,r.appendChild(a),i.appendChild(r),e.appendChild(i),t.appendChild(e);const s=document.createElement("div"),o=document.createElement("div");t.appendChild(s),t.appendChild(o),e1.forEach(u=>{const c=document.createElement("section");c.className="section is-fluid is-centered",c.style.display="none",c.style.width="100%",c.id=Wg(u),o.appendChild(c)}),s.className="tabs is-centered";const l=document.createElement("ul");return e1.forEach(u=>{const c=document.createElement("li");c.id=iW(u),c.style.display="none",c.className="menu";const d=document.createElement("a");d.textContent=bo(`tabs.${u.toLowerCase()}`),d.onclick=()=>Ime(u,{updateUrl:!0}),c.appendChild(d),l.appendChild(c)}),s.appendChild(l),t},vme="chp_theme";let k6=null;function yme(t){return t==="system"?globalThis.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":t}function t1(t){const e=yme(t);document.documentElement.dataset.theme=e,localStorage.setItem(vme,t)}function ttt(){const t=i1();t1(t),k6=globalThis.matchMedia("(prefers-color-scheme: dark)"),k6.addEventListener("change",()=>{i1()==="system"&&t1("system")})}function itt(){const t=yme(i1());t1(t==="light"?"dark":"light")}function i1(){return localStorage.getItem(vme)??"light"}function rtt(){const t=document.createElement("div");t.className="main noselect";const e=document.createElement("nav");e.className="navbar";const i=document.createElement("div");i.className="navbar-brand";const r=document.createElement("div");r.onclick=()=>globalThis.history.back(),r.className="navbar-item",r.innerHTML="<<",r.id="back";const n=document.createElement("div");n.className="navbar-end";const a=document.createElement("button");a.className="navbar-item language-toggle",a.title=bo("language.select"),a.textContent="ðŸŒ",a.onclick=()=>Jge(a),n.appendChild(a);const s=document.createElement("button");s.className="navbar-item theme-toggle",s.title=bo("theme.toggleDark");const o=()=>{const f=document.documentElement.dataset.theme==="dark";s.textContent=f?"â˜€":"â˜¾"};o(),s.onclick=()=>{itt(),o()},n.appendChild(s),i.appendChild(r),e.appendChild(i),e.appendChild(n),t.appendChild(e);const l=document.createElement("div");l.style.display="none",l.id=Vw;const u=document.createElement("div");u.style.display="none",u.id=r1;const c=document.createElement("div");c.className="controlBar flexcol flexgrow flexcenter",c.id=_6,u.appendChild(c);const d=document.createElement("div");d.className="flexcol flexgrow flexcenter box",d.id=vO,u.appendChild(d);const p=document.createElement("div");return p.style.display="none",p.id=aR,p.appendChild(ett()),t.appendChild(u),t.appendChild(p),t.appendChild(l),t}function ntt(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML)){const i=e;i.style.fontWeight="bold",i.style.color="#ed0c76"}}function att(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML)){const i=e;i.style.fontWeight="",i.style.color=""}}const O6=(function(){let t,e={elapsed:1e5,held:void 0,touched:void 0,holdTime:800,holdAction:void 0,holdActions:{}};const i={};let r={};const n=(d,p)=>d.filter(f=>p.indexOf(f)!==-1).filter((f,h,m)=>m.indexOf(f)===h);e.reset=()=>(r={},e),e.register=(d,p,f,h)=>(typeof f=="function"&&(r[p]||(r[p]={},i[p]=[]),r[p][d]={fx:f,delay:h},i[p]=Object.keys(r[p])),e),e.deRegister=(d,p)=>(r[p]&&(delete r[p][d],i[p]=Object.keys(r[p])),e),e.call=(d,p,...f)=>r?.[p]?.[d]?.fx(...f),e.trigger=(d,p,f,h)=>r[p][d].fx(f,h,p),e.list=()=>console.log(r);const a="ontouchstart"in document.documentElement?"touchstart":"click";document.addEventListener(a,d=>o({evt:d,evnt:"tap"})),document.addEventListener("change",d=>o({evt:d,evnt:"change"})),document.addEventListener("click",d=>o({evt:d,evnt:"click"})),document.addEventListener("mouseover",d=>o({evt:d,evnt:"mouseover",stopPropagation:!1})),document.addEventListener("mouseout",d=>o({evt:d,evnt:"mouseout",stopPropagation:!1})),document.addEventListener("keyup",d=>o({evt:d,evnt:"keyup",stopPropagation:!1}));let s=0;function o({evt:d,evnt:p,stopPropagation:f=!0}){f&&d.stopPropagation();const h={x:d.clientX,y:d.clientY,pageX:d.pageX,pageY:d.pageY};let m=Array.from(d.target.classList),g=m.length&&i[p]?n(m,i[p]):[];if(g.length){let I=new Date().getTime();e.elapsed=I-s,s=I,g.forEach(v=>{l({cls:v,evt:d,evnt:p,mouse:h})})}}function l({cls:d,evt:p,evnt:f,mouse:h}){let m=p.target;r[f][d].fx(m,h,f,p)}document.addEventListener("touchstart",d=>{e.touched=d.target,e.coords=[d.touches[0].clientX,d.touches[0].clientY],e.touched&&(t=setTimeout(function(){c()},e.holdTime))},!1),document.addEventListener("touchend",function(){u()},!1),document.addEventListener("touchmove",function(d){e.touched!==d.target&&u()},!1);function u(){clearTimeout(t)}function c(){typeof e.holdAction=="function"&&(e.held=e.touched,e.holdAction(e.held,e.coords))}return(function(){let d=!1,p,f="";function h(){clearTimeout(p),d=!0,f!=="can-touch"&&(f="can-touch",document.documentElement.classList.add(f)),p=setTimeout(function(){d=!1},500)}function m(){!d&&f==="can-touch"&&(d=!1,f="",document.documentElement.classList.remove("can-touch"))}document.addEventListener("touchstart",h,!1),document.addEventListener("mouseover",m,!1)})(),e})();function stt(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=i=>r=>i(r).then(n=>console.log(n.data),n=>console.log(n));ott({...{getServerFactoryVersion:i=>t(d1e)(i),getProviderCalendar:i=>t(Mx)(i),getTournamentInfo:i=>t(Wte)(i),getEventData:i=>t(zte(i))},baseApi:Fm,context:Jo})}function ott(t){if(typeof window?.dev=="object")try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch{console.log("production environment")}}function ltt(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.onunhandledrejection=t=>{t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?console.warn("popup blocked"):console.warn("Unhandled rejection:",e&&(e.stack||e))}}const utt="@VERSION@";const mO=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function gO(t,e,i,r){t.addEventListener?t.addEventListener(e,i,r):t.attachEvent&&t.attachEvent(`on${e}`,i)}function Ay(t,e,i,r){t&&(t.removeEventListener?t.removeEventListener(e,i,r):t.detachEvent&&t.detachEvent(`on${e}`,i))}function bme(t,e){const i=e.slice(0,e.length-1),r=[];for(let n=0;n<i.length;n++)r.push(t[i[n].toLowerCase()]);return r}function wme(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function ctt(t,e){const i=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let n=!0;for(let a=0;a<i.length;a++)r.indexOf(i[a])===-1&&(n=!1);return n}function Sme(t){let e=t.keyCode||t.which||t.charCode;return t.code&&/^Key[A-Z]$/.test(t.code)&&(e=t.code.charCodeAt(3)),e}const $w={backspace:8,"âŒ«":8,tab:9,clear:12,enter:13,"â†©":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"â‡ª":20,",":188,".":190,"/":191,"`":192,"-":mO?173:189,"=":mO?61:187,";":mO?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},ul={"â‡§":16,shift:16,"âŒ¥":18,alt:18,option:18,"âŒƒ":17,ctrl:17,control:17,"âŒ˜":91,cmd:91,meta:91,command:91},jy={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Vn={16:!1,18:!1,17:!1,91:!1},Kr={};for(let t=1;t<20;t++)$w[`f${t}`]=111+t;let Dr=[],Db=null,zg=null,Ume="all";const ad=new Map,by=t=>$w[t.toLowerCase()]||ul[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),dtt=t=>Object.keys($w).find(e=>$w[e]===t),ptt=t=>Object.keys(ul).find(e=>ul[e]===t),Tme=t=>{Ume=t||"all"},Bw=()=>Ume||"all",ftt=()=>Dr.slice(0),htt=()=>Dr.map(t=>dtt(t)||ptt(t)||String.fromCharCode(t)),mtt=()=>{const t=[];return Object.keys(Kr).forEach(e=>{Kr[e].forEach(({key:i,scope:r,mods:n,shortcut:a})=>{t.push({scope:r,shortcut:a,mods:n,keys:i.split("+").map(s=>by(s))})})}),t},Dme=t=>{const e=t.target||t.srcElement,{tagName:i}=e;let r=!0;const n=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(n||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(r=!1),r},gtt=t=>(typeof t=="string"&&(t=by(t)),Dr.indexOf(t)!==-1),Itt=(t,e)=>{let i,r;t||(t=Bw());for(const n in Kr)if(Object.prototype.hasOwnProperty.call(Kr,n))for(i=Kr[n],r=0;r<i.length;)i[r].scope===t?i.splice(r,1).forEach(({element:s})=>oW(s)):r++;Bw()===t&&Tme(e||"all")};function vtt(t){let e=Sme(t);t.key&&t.key.toLowerCase()==="capslock"&&(e=by(t.key));const i=Dr.indexOf(e);if(i>=0&&Dr.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&Dr.splice(0,Dr.length),(e===93||e===224)&&(e=91),e in Vn){Vn[e]=!1;for(const r in ul)ul[r]===e&&(el[r]=!1)}}const Pme=(t,...e)=>{if(typeof t>"u")Object.keys(Kr).forEach(i=>{Array.isArray(Kr[i])&&Kr[i].forEach(r=>cD(r)),delete Kr[i]}),oW(null);else if(Array.isArray(t))t.forEach(i=>{i.key&&cD(i)});else if(typeof t=="object")t.key&&cD(t);else if(typeof t=="string"){let[i,r]=e;typeof i=="function"&&(r=i,i=""),cD({key:t,scope:i,method:r,splitKey:"+"})}},cD=({key:t,scope:e,method:i,splitKey:r="+"})=>{wme(t).forEach(a=>{const s=a.split(r),o=s.length,l=s[o-1],u=l==="*"?"*":by(l);if(!Kr[u])return;e||(e=Bw());const c=o>1?bme(ul,s):[],d=[];Kr[u]=Kr[u].filter(p=>{const h=(i?p.method===i:!0)&&p.scope===e&&ctt(p.mods,c);return h&&d.push(p.element),!h}),d.forEach(p=>oW(p))})};function x6(t,e,i,r){if(e.element!==r)return;let n;if(e.scope===i||e.scope==="all"){n=e.mods.length>0;for(const a in Vn)Object.prototype.hasOwnProperty.call(Vn,a)&&(!Vn[a]&&e.mods.indexOf(+a)>-1||Vn[a]&&e.mods.indexOf(+a)===-1)&&(n=!1);(e.mods.length===0&&!Vn[16]&&!Vn[18]&&!Vn[17]&&!Vn[91]||n||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Dr),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function F6(t,e){const i=Kr["*"];let r=Sme(t);if(t.key&&t.key.toLowerCase()==="capslock"||!(el.filter||Dme).call(this,t))return;if((r===93||r===224)&&(r=91),Dr.indexOf(r)===-1&&r!==229&&Dr.push(r),["metaKey","ctrlKey","altKey","shiftKey"].forEach(l=>{const u=jy[l];t[l]&&Dr.indexOf(u)===-1?Dr.push(u):!t[l]&&Dr.indexOf(u)>-1?Dr.splice(Dr.indexOf(u),1):l==="metaKey"&&t[l]&&(Dr=Dr.filter(c=>c in jy||c===r))}),r in Vn){Vn[r]=!0;for(const l in ul)if(Object.prototype.hasOwnProperty.call(ul,l)){const u=jy[ul[l]];el[l]=t[u]}if(!i)return}for(const l in Vn)Object.prototype.hasOwnProperty.call(Vn,l)&&(Vn[l]=t[jy[l]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Dr.indexOf(17)===-1&&Dr.push(17),Dr.indexOf(18)===-1&&Dr.push(18),Vn[17]=!0,Vn[18]=!0);const a=Bw();if(i)for(let l=0;l<i.length;l++)i[l].scope===a&&(t.type==="keydown"&&i[l].keydown||t.type==="keyup"&&i[l].keyup)&&x6(t,i[l],a,e);if(!(r in Kr))return;const s=Kr[r],o=s.length;for(let l=0;l<o;l++)if((t.type==="keydown"&&s[l].keydown||t.type==="keyup"&&s[l].keyup)&&s[l].key){const u=s[l],{splitKey:c}=u,d=u.key.split(c),p=[];for(let f=0;f<d.length;f++)p.push(by(d[f]));p.sort().join("")===Dr.sort().join("")&&x6(t,u,a,e)}}const el=function t(e,i,r){Dr=[];const n=wme(e);let a=[],s="all",o=document,l=0,u=!1,c=!0,d="+",p=!1,f=!1;if(r===void 0&&typeof i=="function"&&(r=i),Object.prototype.toString.call(i)==="[object Object]"){const h=i;h.scope&&(s=h.scope),h.element&&(o=h.element),h.keyup&&(u=h.keyup),h.keydown!==void 0&&(c=h.keydown),h.capture!==void 0&&(p=h.capture),typeof h.splitKey=="string"&&(d=h.splitKey),h.single===!0&&(f=!0)}for(typeof i=="string"&&(s=i),f&&Pme(e,s);l<n.length;l++){const h=n[l].split(d);a=[],h.length>1&&(a=bme(ul,h));let m=h[h.length-1];m=m==="*"?"*":by(m),m in Kr||(Kr[m]=[]),Kr[m].push({keyup:u,keydown:c,scope:s,mods:a,shortcut:n[l],method:r,key:n[l],splitKey:d,element:o})}if(typeof o<"u"&&typeof window<"u"){if(!ad.has(o)){const h=(g=window.event)=>F6(g,o),m=(g=window.event)=>{F6(g,o),vtt(g)};ad.set(o,{keydownListener:h,keyupListenr:m,capture:p}),gO(o,"keydown",h,p),gO(o,"keyup",m,p)}if(!Db){const h=()=>{Dr=[]};Db={listener:h,capture:p},gO(window,"focus",h,p)}if(!zg&&typeof document<"u"){const h=()=>{Dr=[];for(const I in Vn)Vn[I]=!1;for(const I in ul)t[I]=!1},m=h,g=h;document.addEventListener("fullscreenchange",m),document.addEventListener("webkitfullscreenchange",g),zg={fullscreen:m,webkit:g}}}};function ytt(t,e="all"){Object.keys(Kr).forEach(i=>{Kr[i].filter(n=>n.scope===e&&n.shortcut===t).forEach(n=>{n&&n.method&&n.method({},n)})})}function oW(t){const e=Object.values(Kr).flat();if(e.findIndex(({element:r})=>r===t)<0&&t){const{keydownListener:r,keyupListenr:n,capture:a}=ad.get(t)||{};r&&n&&(Ay(t,"keyup",n,a),Ay(t,"keydown",r,a),ad.delete(t))}if(e.length<=0||ad.size<=0){if(Array.from(ad.keys()).forEach(n=>{const{keydownListener:a,keyupListenr:s,capture:o}=ad.get(n)||{};a&&s&&(Ay(n,"keyup",s,o),Ay(n,"keydown",a,o),ad.delete(n))}),ad.clear(),Object.keys(Kr).forEach(n=>delete Kr[n]),Db){const{listener:n,capture:a}=Db;Ay(window,"focus",n,a),Db=null}zg&&typeof document<"u"&&(document.removeEventListener("fullscreenchange",zg.fullscreen),document.removeEventListener("webkitfullscreenchange",zg.webkit),zg=null)}}const IO={getPressedKeyString:htt,setScope:Tme,getScope:Bw,deleteScope:Itt,getPressedKeyCodes:ftt,getAllKeyCodes:mtt,isPressed:gtt,filter:Dme,trigger:ytt,unbind:Pme,keyMap:$w,modifier:ul,modifierMap:jy};for(const t in IO){const e=t;Object.prototype.hasOwnProperty.call(IO,e)&&(el[e]=IO[e])}if(typeof window<"u"){const t=window.hotkeys;el.noConflict=e=>(e&&window.hotkeys===el&&(window.hotkeys=t),el),window.hotkeys=el}typeof Gy<"u"&&Gy.exports&&(Gy.exports=el,Gy.exports.default=el);const dD=[];function btt(){ttt(),console.log(`%cversion: ${utt}`,"color: lightblue"),el("shift+1,shift+3,esc,/",(t,e)=>{t.preventDefault();const r=el.shift?e.key.split(e.splitKey)[1]:e.key;r==="/"&&dD.splice(0,dD.length),dD.push(r),dD.join("")==="esc13"&&stt()}),tR(Vw),ltt(),O6.register("tmx-tm","mouseover",ntt),O6.register("tmx-tm","mouseout",att)}const wtt=document.body;wtt.appendChild(rtt());btt();Jo.router=Zet()});export default Stt();
//# sourceMappingURL=index-CUN0LxVP.js.map
